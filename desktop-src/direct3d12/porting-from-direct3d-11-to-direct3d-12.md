---
title: Fazendo a portabilidade do Direct3D 11 para o Direct3D 12
description: Esta seção fornece algumas diretrizes sobre como portar de um mecanismo de gráficos do Direct3D 11 personalizado para o Direct3D 12.
ms.assetid: 9EB4AC6B-AFDD-4673-8EB3-54272C151784
ms.localizationpriority: high
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 14b5bc6784d6f96c3c1599a601a57bf68b0d612d
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/20/2020
ms.locfileid: "104548294"
---
# <a name="porting-from-direct3d-11-to-direct3d-12"></a><span data-ttu-id="127bf-103">Fazendo a portabilidade do Direct3D 11 para o Direct3D 12</span><span class="sxs-lookup"><span data-stu-id="127bf-103">Porting from Direct3D 11 to Direct3D 12</span></span>

<span data-ttu-id="127bf-104">Esta seção fornece algumas diretrizes sobre como portar de um mecanismo de gráficos do Direct3D 11 personalizado para o Direct3D 12.</span><span class="sxs-lookup"><span data-stu-id="127bf-104">This section provides some guidance on porting from a custom Direct3D 11 graphics engine to Direct3D 12.</span></span>

-   [<span data-ttu-id="127bf-105">Criação de dispositivo</span><span class="sxs-lookup"><span data-stu-id="127bf-105">Device creation</span></span>](#device-creation)
-   [<span data-ttu-id="127bf-106">Recursos confirmados</span><span class="sxs-lookup"><span data-stu-id="127bf-106">Committed resources</span></span>](#committed-resources)
-   [<span data-ttu-id="127bf-107">Recursos reservados</span><span class="sxs-lookup"><span data-stu-id="127bf-107">Reserved resources</span></span>](#reserved-resources)
-   [<span data-ttu-id="127bf-108">Carregando dados</span><span class="sxs-lookup"><span data-stu-id="127bf-108">Uploading data</span></span>](#uploading-data)
-   [<span data-ttu-id="127bf-109">Sombreadores e objetos de sombreador</span><span class="sxs-lookup"><span data-stu-id="127bf-109">Shaders and shader objects</span></span>](#shaders-and-shader-objects)
-   [<span data-ttu-id="127bf-110">Enviando trabalho para a GPU</span><span class="sxs-lookup"><span data-stu-id="127bf-110">Submitting work to the GPU</span></span>](#submitting-work-to-the-gpu)
-   [<span data-ttu-id="127bf-111">Sincronização de CPU/GPU</span><span class="sxs-lookup"><span data-stu-id="127bf-111">CPU/GPU Synchronization</span></span>](#cpugpu-synchronization)
-   [<span data-ttu-id="127bf-112">Associação de recursos</span><span class="sxs-lookup"><span data-stu-id="127bf-112">Resource Binding</span></span>](#resource-binding)
-   [<span data-ttu-id="127bf-113">Estado do recurso</span><span class="sxs-lookup"><span data-stu-id="127bf-113">Resource state</span></span>](#resource-state)
-   [<span data-ttu-id="127bf-114">Permuta</span><span class="sxs-lookup"><span data-stu-id="127bf-114">Swapchains</span></span>](#swapchains)
-   [<span data-ttu-id="127bf-115">Renderização de função fixa</span><span class="sxs-lookup"><span data-stu-id="127bf-115">Fixed function rendering</span></span>](#fixed-function-rendering)
-   [<span data-ttu-id="127bf-116">Chances e terminações</span><span class="sxs-lookup"><span data-stu-id="127bf-116">Odds and ends</span></span>](#odds-and-ends)
-   [<span data-ttu-id="127bf-117">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="127bf-117">Related topics</span></span>](#related-topics)

## <a name="device-creation"></a><span data-ttu-id="127bf-118">Criação de dispositivo</span><span class="sxs-lookup"><span data-stu-id="127bf-118">Device creation</span></span>

<span data-ttu-id="127bf-119">O Direct3D 11 e o Direct3D 12 compartilham um padrão de criação de dispositivos similar.</span><span class="sxs-lookup"><span data-stu-id="127bf-119">Both Direct3D 11 and Direct3D 12 share a simliar device creation pattern.</span></span> <span data-ttu-id="127bf-120">Os drivers Direct3D 12 existentes são todos **D3D_FEATURE_LEVEL_11_0** ou melhores, portanto, você pode ignorar os níveis de recursos mais antigos e os lmitations associados.</span><span class="sxs-lookup"><span data-stu-id="127bf-120">Existing Direct3D 12 drivers are all **D3D_FEATURE_LEVEL_11_0** or better, so you can ignore the older feature levels and associated lmitations.</span></span>

<span data-ttu-id="127bf-121">Além disso, tenha em mente que, com o Direct3D 12, você deve enumerar explicitamente as informações do dispositivo usando interfaces DXGI.</span><span class="sxs-lookup"><span data-stu-id="127bf-121">Also keep in mind that with Direct3D 12, you should explicitly enumerate device information using DXGI interfaces.</span></span> <span data-ttu-id="127bf-122">No Direct3D 11, você poderia *encadear* o dispositivo dxgi do dispositivo Direct3D e não há suporte para isso no Direct3D 12.</span><span class="sxs-lookup"><span data-stu-id="127bf-122">In Direct3D 11, you could *chain back* to the DXGI device from the Direct3D device, and this is not supported for Direct3D 12.</span></span>

<span data-ttu-id="127bf-123">A criação de um dispositivo de software WARP no Direct3D 12 é feita fornecendo um adaptador explícito obtido de **IDXGIFcatory4:: EnumWarpAdapter**.</span><span class="sxs-lookup"><span data-stu-id="127bf-123">Creating a WARP software device on Direct3D 12 is done by providing an explicit adapter obtained from **IDXGIFcatory4::EnumWarpAdapter**.</span></span> <span data-ttu-id="127bf-124">O dispositivo WARP para o Direct3D 12 está disponível apenas em sistemas com o recurso opcional **ferramentas de gráficos** habilitado.</span><span class="sxs-lookup"><span data-stu-id="127bf-124">The WARP device for Direct3D 12 is available only on systems with the **Graphics Tools** optional feature enabled.</span></span>

> [!NOTE]
> <span data-ttu-id="127bf-125">Não há nenhum equivalente a **D3D11CreateDeviceAndSwapChain**.</span><span class="sxs-lookup"><span data-stu-id="127bf-125">There is no equivalent to **D3D11CreateDeviceAndSwapChain**.</span></span> <span data-ttu-id="127bf-126">Mesmo com o Direct3D 11, desencorajamos o uso dessa função, pois geralmente é melhor criar o dispositivo e SwapChain em etapas distintas.</span><span class="sxs-lookup"><span data-stu-id="127bf-126">Even with Direct3D 11, we discourage the use of this function as it's often better to create the device and swapchain in distinct steps.</span></span>

## <a name="committed-resources"></a><span data-ttu-id="127bf-127">Recursos confirmados</span><span class="sxs-lookup"><span data-stu-id="127bf-127">Committed resources</span></span>

<span data-ttu-id="127bf-128">Os objetos criados com as seguintes interfaces no Direct3D 11, são convertidos em quais são chamados de "recursos confirmados" no Direct3D 12.</span><span class="sxs-lookup"><span data-stu-id="127bf-128">Objects created with the following interfaces in Direct3D 11, translate to what are called "committed resources" in Direct3D 12.</span></span> <span data-ttu-id="127bf-129">Um recurso confirmado é um recurso que tem o espaço de endereço virtual e as páginas físicas associadas a ele.</span><span class="sxs-lookup"><span data-stu-id="127bf-129">A committed resource is a resource which has both virtual address space and physical pages associated with it.</span></span> <span data-ttu-id="127bf-130">Este é um conceito do modelo de memória do Microsoft Windows Device Driver 2 (WDD2), no qual o Direct3D 12 é baseado.</span><span class="sxs-lookup"><span data-stu-id="127bf-130">This is a concept of the Microsoft Windows Device Driver 2 (WDD2) Memory Model, on which Direct3D 12 is based.</span></span>

<span data-ttu-id="127bf-131">Recursos do Direct3D 11:</span><span class="sxs-lookup"><span data-stu-id="127bf-131">Direct3D 11 resources:</span></span>

-   [<span data-ttu-id="127bf-132">**ID3D11Resource**</span><span class="sxs-lookup"><span data-stu-id="127bf-132">**ID3D11Resource**</span></span>](/windows/win32/api/d3d11/nn-d3d11-id3d11resource)
-   <span data-ttu-id="127bf-133">[**ID3D11Buffer**](/windows/win32/api/d3d11/nn-d3d11-id3d11buffer) e [ **ID3D11Device:: CreateBuffer**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-createbuffer)</span><span class="sxs-lookup"><span data-stu-id="127bf-133">[**ID3D11Buffer**](/windows/win32/api/d3d11/nn-d3d11-id3d11buffer) and [**ID3D11Device::CreateBuffer**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-createbuffer)</span></span>
-   <span data-ttu-id="127bf-134">[**ID3D11Texture1D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture1d) e [ **ID3D11Device: CreateTexture1D**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-createtexture1d)</span><span class="sxs-lookup"><span data-stu-id="127bf-134">[**ID3D11Texture1D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture1d) and [**ID3D11Device:CreateTexture1D**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-createtexture1d)</span></span>
-   <span data-ttu-id="127bf-135">[**ID3D11Texture2D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture2d) e [ **ID3D11Device:: CreateTexture2D**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-createtexture2d)</span><span class="sxs-lookup"><span data-stu-id="127bf-135">[**ID3D11Texture2D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture2d) and [**ID3D11Device::CreateTexture2D**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-createtexture2d)</span></span>
-   <span data-ttu-id="127bf-136">[**ID3D11Texture3D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture3d) e [ **ID3D11Device:: CreateTexture3D**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-createtexture3d)</span><span class="sxs-lookup"><span data-stu-id="127bf-136">[**ID3D11Texture3D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture3d) and [**ID3D11Device::CreateTexture3D**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-createtexture3d)</span></span>

<span data-ttu-id="127bf-137">No Direct3D 12, todos são representados por [**ID3D12Resource**](/windows/win32/api/d3d12/nn-d3d12-id3d12resource) e [**ID3D12Device:: CreateCommittedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createcommittedresource).</span><span class="sxs-lookup"><span data-stu-id="127bf-137">In Direct3D 12 these are all represented by [**ID3D12Resource**](/windows/win32/api/d3d12/nn-d3d12-id3d12resource) and [**ID3D12Device::CreateCommittedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createcommittedresource).</span></span>

## <a name="reserved-resources"></a><span data-ttu-id="127bf-138">Recursos reservados</span><span class="sxs-lookup"><span data-stu-id="127bf-138">Reserved resources</span></span>

<span data-ttu-id="127bf-139">Recursos reservados são recursos em que apenas o espaço de endereço virtual foi alocado, a memória física não é alocada até que haja uma chamada para [**ID3D12Device:: createheap**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createheap).</span><span class="sxs-lookup"><span data-stu-id="127bf-139">Reserved resources are resources where only virtual address space has been allocated, physical memory is not allocated until there is a call to [**ID3D12Device::CreateHeap**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createheap).</span></span> <span data-ttu-id="127bf-140">Esse é essencialmente o mesmo conceito que os recursos de lado do xadrez no Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="127bf-140">This is essentially the same concept as tiled resources in Direct3D 11.</span></span>

<span data-ttu-id="127bf-141">Os sinalizadores ([**\_ \_ \_ sinalizador variado do recurso D3D11**](/windows/win32/api/d3d11/ne-d3d11-d3d11_resource_misc_flag)) usados no Direct3D 11 para configurar os recursos do lado do ladrilho e mapeá-los para a memória física.</span><span class="sxs-lookup"><span data-stu-id="127bf-141">The flags ([**D3D11\_RESOURCE\_MISC\_FLAG**](/windows/win32/api/d3d11/ne-d3d11-d3d11_resource_misc_flag)) used in Direct3D 11 to set up tiled resources, then map them to physical memory.</span></span>

-   <span data-ttu-id="127bf-142">D3D11 \_ diversos de recursos de \_ \_ lado</span><span class="sxs-lookup"><span data-stu-id="127bf-142">D3D11\_RESOURCE\_MISC\_TILED</span></span>
-   <span data-ttu-id="127bf-143">\_Pool de \_ \_ blocos diversos do recurso \_ D3D11</span><span class="sxs-lookup"><span data-stu-id="127bf-143">D3D11\_RESOURCE\_MISC\_TILE\_POOL</span></span>

## <a name="uploading-data"></a><span data-ttu-id="127bf-144">Carregando dados</span><span class="sxs-lookup"><span data-stu-id="127bf-144">Uploading data</span></span>

<span data-ttu-id="127bf-145">No Direct3D 11, há a aparência de uma única linha do tempo (chamadas após uma sequência, como dados inicializados com [**\_ \_ dados de subrecurso do D3D11**](/windows/win32/api/d3d11/ns-d3d11-d3d11_subresource_data), uma chamada é feita para [**ID3D11DeviceContext:: UpdateSubresource**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-updatesubresource)e, em seguida, uma chamada para [**ID3D11DeviceContext:: map**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-map)).</span><span class="sxs-lookup"><span data-stu-id="127bf-145">In Direct3D 11 there is the appearance of a single timeline (calls following a sequence, such as data initialized with [**D3D11\_SUBRESOURCE\_DATA**](/windows/win32/api/d3d11/ns-d3d11-d3d11_subresource_data), then a call is made to [**ID3D11DeviceContext::UpdateSubresource**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-updatesubresource), and then a call to [**ID3D11DeviceContext::Map**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-map)).</span></span> <span data-ttu-id="127bf-146">O número de cópias criadas dos dados não é óbvio para um desenvolvedor do Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="127bf-146">The number of copies created of the data is not obvious to a Direct3D 11 developer.</span></span>

<span data-ttu-id="127bf-147">No Direct3D 12, há duas linhas do tempo, o cronograma da GPU (configurado por chamadas para [**CopyTextureRegion**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-copytextureregion)e [**CopyBufferRegion**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-copybufferregion) da memória mapeada) e a linha do tempo da CPU (determinada por chamadas para [**mapa**](/windows/win32/api/d3d12/nf-d3d12-id3d12resource-map)).</span><span class="sxs-lookup"><span data-stu-id="127bf-147">In Direct3D 12 there are two timelines, the GPU timeline (set up by calls to [**CopyTextureRegion**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-copytextureregion), and [**CopyBufferRegion**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-copybufferregion) from mappable memory) and the CPU timeline (determined by calls to [**Map**](/windows/win32/api/d3d12/nf-d3d12-id3d12resource-map)).</span></span> <span data-ttu-id="127bf-148">As funções auxiliares são fornecidas (no arquivo d3dx12. h) chamado [**Updatesubresources**](updatesubresources1.md) que usam uma linha do tempo compartilhada.</span><span class="sxs-lookup"><span data-stu-id="127bf-148">Helper functions are provided (in the d3dx12.h file) called [**Updatesubresources**](updatesubresources1.md) that use a shared timeline.</span></span> <span data-ttu-id="127bf-149">Há várias variações dessa função auxiliar, uma que usa [**ID3D12Device:: GetCopyableFootprints**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-getcopyablefootprints), outra que usa um mecanismo de alocação de heap e outra que usa um mecanismo de alocação de pilha.</span><span class="sxs-lookup"><span data-stu-id="127bf-149">There are several variations of this helper function, one that uses [**ID3D12Device::GetCopyableFootprints**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-getcopyablefootprints), another that uses a heap-allocating mechanism, and another that uses a stack-allocating mechanism.</span></span> <span data-ttu-id="127bf-150">Essas funções auxiliares copiam recursos para a GPU e a CPU, por meio de uma área de preparo intermediária de memória.</span><span class="sxs-lookup"><span data-stu-id="127bf-150">These helper functions copy resources to both the GPU and CPU, via an intermediate staging area of memory.</span></span>

<span data-ttu-id="127bf-151">Normalmente, a GPU e a CPU têm sua própria cópia de um recurso vinculado a sua própria linha do tempo.</span><span class="sxs-lookup"><span data-stu-id="127bf-151">Typically the GPU and CPU each have their own copy of a resource tied to their own timeline.</span></span> <span data-ttu-id="127bf-152">A abordagem de linha do tempo compartilhada mantém duas cópias de forma semelhante.</span><span class="sxs-lookup"><span data-stu-id="127bf-152">The shared timeline approach similarly maintains two copies.</span></span>

## <a name="shaders-and-shader-objects"></a><span data-ttu-id="127bf-153">Sombreadores e objetos de sombreador</span><span class="sxs-lookup"><span data-stu-id="127bf-153">Shaders and shader objects</span></span>

<span data-ttu-id="127bf-154">No Direct3D 11 há muita criação de objetos de sombreador e estado e definição do estado desses objetos, usando os métodos de criação [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) e os métodos set [**ID3D11DeviceContext**](/windows/win32/api/d3d11/nn-d3d11-id3d11devicecontext) .</span><span class="sxs-lookup"><span data-stu-id="127bf-154">In Direct3D 11 there is a lot of creation of shader and state objects, and setting the state of those objects, using the [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) creation methods and the [**ID3D11DeviceContext**](/windows/win32/api/d3d11/nn-d3d11-id3d11devicecontext) set methods.</span></span> <span data-ttu-id="127bf-155">Normalmente, um grande número de chamadas é feito para esses métodos, que são combinados no momento do empate pelo driver para definir o estado de pipeline correto.</span><span class="sxs-lookup"><span data-stu-id="127bf-155">Typically a large number of calls are made to these methods, which are then combined at draw time by the driver to set the correct pipeline state.</span></span>

<span data-ttu-id="127bf-156">No Direct3D 12, essa configuração de estado do pipeline foi combinada em um único objeto ([**CreateComputePipelineState**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createcomputepipelinestate) para um mecanismo de computação e [**CreateGraphicsPipelineState**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-creategraphicspipelinestate) para um mecanismo de gráficos), que é então anexado a uma lista de comandos antes da chamada de desenho com uma chamada para [**setpipelinestate**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-setpipelinestate).</span><span class="sxs-lookup"><span data-stu-id="127bf-156">In Direct3D 12 this setting of pipeline state has been combined into a single object ([**CreateComputePipelineState**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createcomputepipelinestate) for a compute engine, and [**CreateGraphicsPipelineState**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-creategraphicspipelinestate) for a graphics engine), which is then attached to a command list before the draw call with a call to [**SetPipelineState**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-setpipelinestate).</span></span>

<span data-ttu-id="127bf-157">Essas chamadas substituem todas as chamadas individuais para definir sombreadores, layout de entrada, estado de mesclagem, estado do rasterizador, estado de estêncil de profundidade e assim por diante, no Direct3D 11</span><span class="sxs-lookup"><span data-stu-id="127bf-157">These calls replace all the individual calls to set shaders, input layout, blend state, rasterizer state, depth stencil state, and so on, in Direct3D 11</span></span>

- <span data-ttu-id="127bf-158">Métodos do dispositivo 11: ``CreateInputLayout`` , ``CreateXShader`` , ``CreateDepthStencilState`` , andD ``CreateRasterizerState`` .</span><span class="sxs-lookup"><span data-stu-id="127bf-158">Device 11 methods: ``CreateInputLayout``, ``CreateXShader``, ``CreateDepthStencilState``, andD ``CreateRasterizerState``.</span></span>
- <span data-ttu-id="127bf-159">Métodos de contexto de dispositivo 11:  ``IASetInputLayout`` ,, ``xxSetShader`` ``OMSetBlendState`` , ``OMSetDepthStencilState`` e ``RSSetState`` .</span><span class="sxs-lookup"><span data-stu-id="127bf-159">Device Context 11 methods:  ``IASetInputLayout``, ``xxSetShader``, ``OMSetBlendState``, ``OMSetDepthStencilState``, and ``RSSetState``.</span></span>

<span data-ttu-id="127bf-160">Embora o Direct3D 12 possa dar suporte a blobs de sombreador compilados mais antigos, os sombreadores devem ser criados usando o modelo de sombreador 5,1 com as APIs FXC/D3DCompile ou usando o modelo de sombreador 6 usando o compilador DXIL DXC.</span><span class="sxs-lookup"><span data-stu-id="127bf-160">While Direct3D 12 can support older compiled shader blobs, shaders should be built using either Shader Model 5.1 with the FXC/D3DCompile APIs, or using Shader Model 6 using the DXIL DXC compiler.</span></span> <span data-ttu-id="127bf-161">Você deve validar o suporte ao modelo do sombreador 6 com [**CheckFeatureSupport**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-checkfeaturesupport) e **D3D12_FEATURE_SHADER_MODEL**.</span><span class="sxs-lookup"><span data-stu-id="127bf-161">You should validate Shader Model 6 support with [**CheckFeatureSupport**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-checkfeaturesupport) and **D3D12_FEATURE_SHADER_MODEL**.</span></span>

## <a name="submitting-work-to-the-gpu"></a><span data-ttu-id="127bf-162">Enviando trabalho para a GPU</span><span class="sxs-lookup"><span data-stu-id="127bf-162">Submitting work to the GPU</span></span>

<span data-ttu-id="127bf-163">no Direct3D 11, há pouco controle sobre como o trabalho é enviado, ele é amplamente manipulado pelo driver, embora algum controle esteja habilitado por meio das chamadas [**ID3D11DeviceContext:: flush**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-flush) e [**IDXGISwapChain1::P resent1**](/windows/win32/api/dxgi1_2/nf-dxgi1_2-idxgiswapchain1-present1) .</span><span class="sxs-lookup"><span data-stu-id="127bf-163">in Direct3D 11 there is little control over actually how work is submitted, it is largely handled by the driver, though some control is enabled through the [**ID3D11DeviceContext::Flush**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-flush) and [**IDXGISwapChain1::Present1**](/windows/win32/api/dxgi1_2/nf-dxgi1_2-idxgiswapchain1-present1) calls.</span></span>

<span data-ttu-id="127bf-164">No, o envio de trabalho do Direct3D 12 é muito explícito e controlado pelo aplicativo.</span><span class="sxs-lookup"><span data-stu-id="127bf-164">In Direct3D 12 work submission is very explicit and controlled by the app.</span></span> <span data-ttu-id="127bf-165">A construção principal para enviar o trabalho é o [**ID3D12GraphicsCommandList**](/windows/win32/api/d3d12/nn-d3d12-id3d12graphicscommandlist), que é usado para registrar todos os comandos de aplicativos (e é bastante semelhante em conceito ao contexto adiado do ID3D11).</span><span class="sxs-lookup"><span data-stu-id="127bf-165">The primary construct for submitting work is the [**ID3D12GraphicsCommandList**](/windows/win32/api/d3d12/nn-d3d12-id3d12graphicscommandlist), which is used to record all the apps commands (and is quite similar in concept to the ID3D11 deferred context).</span></span> <span data-ttu-id="127bf-166">O armazenamento de backup para uma lista de comandos é fornecido pelo [**ID3D12CommandAllocator**](/windows/win32/api/d3d12/nn-d3d12-id3d12commandallocator), que permite que o aplicativo gerencie a utilização de memória da lista de comandos, na verdade, expondo a memória que o driver do Direct3D 12 vai usar para armazenar a lista de comandos.</span><span class="sxs-lookup"><span data-stu-id="127bf-166">Backing store for a command list is provided by the [**ID3D12CommandAllocator**](/windows/win32/api/d3d12/nn-d3d12-id3d12commandallocator), which enables the app to manage the memory utilization of the command list by actually exposing the memory that the Direct3D 12 driver is going to use to store the command list.</span></span>

<span data-ttu-id="127bf-167">Por fim, o [**ID3D12CommandQueue**](/windows/win32/api/d3d12/nn-d3d12-id3d12commandqueue) é uma fila de primeiro a entrar, que armazena a ordem correta das listas de comandos para envio à GPU.</span><span class="sxs-lookup"><span data-stu-id="127bf-167">Finally the [**ID3D12CommandQueue**](/windows/win32/api/d3d12/nn-d3d12-id3d12commandqueue) is a first-in first-out queue, that stores the correct order of the command lists for submission to the GPU.</span></span> <span data-ttu-id="127bf-168">Somente quando uma lista de comandos tiver concluído a execução na GPU, a próxima lista de comandos da fila será enviada pelo driver.</span><span class="sxs-lookup"><span data-stu-id="127bf-168">Only when one command list has completed execution on the GPU, will the next command list from the queue be submitted by the driver.</span></span>

<span data-ttu-id="127bf-169">No Direct3D 11 não há nenhum conceito explícito de uma fila de comando.</span><span class="sxs-lookup"><span data-stu-id="127bf-169">In Direct3D 11 there is no explicit concept of a command queue.</span></span> <span data-ttu-id="127bf-170">Na configuração comum para o Direct3D 12, a lista de comandos **D3D12_COMMAND_LIST_TYPE_DIRECT** aberta no momento para o quadro atual pode ser considerada análoga ao contexto imediato do Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="127bf-170">In the common setup for Direct3D 12, the currently open **D3D12_COMMAND_LIST_TYPE_DIRECT** command list for the current frame can be considered analogous to the Direct3D 11 immediate context.</span></span> <span data-ttu-id="127bf-171">Isso fornece muitas das mesmas funções.</span><span class="sxs-lookup"><span data-stu-id="127bf-171">This provides many of the same functions.</span></span>


| <span data-ttu-id="127bf-172">D3D11DeviceContext</span><span class="sxs-lookup"><span data-stu-id="127bf-172">D3D11DeviceContext</span></span>                  | <span data-ttu-id="127bf-173">Lista de ID3D12GraphicsCommand</span><span class="sxs-lookup"><span data-stu-id="127bf-173">ID3D12GraphicsCommand List</span></span>     |
|-------------------------------------|--------------------------------|
| <span data-ttu-id="127bf-174">ClearDepthStencilView</span><span class="sxs-lookup"><span data-stu-id="127bf-174">ClearDepthStencilView</span></span>               | <span data-ttu-id="127bf-175">ClearDepthStencilView</span><span class="sxs-lookup"><span data-stu-id="127bf-175">ClearDepthStencilView</span></span>          |
| <span data-ttu-id="127bf-176">ClearRenderTargetView</span><span class="sxs-lookup"><span data-stu-id="127bf-176">ClearRenderTargetView</span></span>               | <span data-ttu-id="127bf-177">ClearRenderTargetView</span><span class="sxs-lookup"><span data-stu-id="127bf-177">ClearRenderTargetView</span></span>          |
| <span data-ttu-id="127bf-178">ClearUnorderedAccess\*</span><span class="sxs-lookup"><span data-stu-id="127bf-178">ClearUnorderedAccess\*</span></span>               | <span data-ttu-id="127bf-179">ClearUnorderedAccess\*</span><span class="sxs-lookup"><span data-stu-id="127bf-179">ClearUnorderedAccess\*</span></span>          |
| <span data-ttu-id="127bf-180">Desenhar, DrawInstanced</span><span class="sxs-lookup"><span data-stu-id="127bf-180">Draw, DrawInstanced</span></span>                 | <span data-ttu-id="127bf-181">DrawInstanced</span><span class="sxs-lookup"><span data-stu-id="127bf-181">DrawInstanced</span></span>                  |
| <span data-ttu-id="127bf-182">DrawIndexed, DrawIndexedInstanced</span><span class="sxs-lookup"><span data-stu-id="127bf-182">DrawIndexed, DrawIndexedInstanced</span></span>   | <span data-ttu-id="127bf-183">DrawIndexedInstanced</span><span class="sxs-lookup"><span data-stu-id="127bf-183">DrawIndexedInstanced</span></span>           |
| <span data-ttu-id="127bf-184">Dispatch</span><span class="sxs-lookup"><span data-stu-id="127bf-184">Dispatch</span></span>                            | <span data-ttu-id="127bf-185">Dispatch</span><span class="sxs-lookup"><span data-stu-id="127bf-185">Dispatch</span></span>                       |
| <span data-ttu-id="127bf-186">IASetInputLayout, xxSetShader, etc.</span><span class="sxs-lookup"><span data-stu-id="127bf-186">IASetInputLayout, xxSetShader, etc.</span></span> | <span data-ttu-id="127bf-187">Setpipelinestate</span><span class="sxs-lookup"><span data-stu-id="127bf-187">SetPipelineState</span></span>               |
| <span data-ttu-id="127bf-188">OMSetBlendState</span><span class="sxs-lookup"><span data-stu-id="127bf-188">OMSetBlendState</span></span>                     | <span data-ttu-id="127bf-189">OMSetBlendFactor</span><span class="sxs-lookup"><span data-stu-id="127bf-189">OMSetBlendFactor</span></span>               |
| <span data-ttu-id="127bf-190">OMSetDepthStencilState</span><span class="sxs-lookup"><span data-stu-id="127bf-190">OMSetDepthStencilState</span></span>              | <span data-ttu-id="127bf-191">OMSetStencilRef</span><span class="sxs-lookup"><span data-stu-id="127bf-191">OMSetStencilRef</span></span>                |
| <span data-ttu-id="127bf-192">OMSetRenderTargets</span><span class="sxs-lookup"><span data-stu-id="127bf-192">OMSetRenderTargets</span></span>                  | <span data-ttu-id="127bf-193">OMSetRenderTargets</span><span class="sxs-lookup"><span data-stu-id="127bf-193">OMSetRenderTargets</span></span>             |
| <span data-ttu-id="127bf-194">RSSetViewports</span><span class="sxs-lookup"><span data-stu-id="127bf-194">RSSetViewports</span></span>                      | <span data-ttu-id="127bf-195">RSSetViewports</span><span class="sxs-lookup"><span data-stu-id="127bf-195">RSSetViewports</span></span>                 |
| <span data-ttu-id="127bf-196">RSSetScissorRects</span><span class="sxs-lookup"><span data-stu-id="127bf-196">RSSetScissorRects</span></span>                   | <span data-ttu-id="127bf-197">RSSetScissorRects</span><span class="sxs-lookup"><span data-stu-id="127bf-197">RSSetScissorRects</span></span>              |
| <span data-ttu-id="127bf-198">IASetPrimitiveTopology</span><span class="sxs-lookup"><span data-stu-id="127bf-198">IASetPrimitiveTopology</span></span>              | <span data-ttu-id="127bf-199">IASetPrimitiveTopology</span><span class="sxs-lookup"><span data-stu-id="127bf-199">IASetPrimitiveTopology</span></span>         |
| <span data-ttu-id="127bf-200">IASetVertexBuffers</span><span class="sxs-lookup"><span data-stu-id="127bf-200">IASetVertexBuffers</span></span>                  | <span data-ttu-id="127bf-201">IASetVertexBuffers</span><span class="sxs-lookup"><span data-stu-id="127bf-201">IASetVertexBuffers</span></span>             |
| <span data-ttu-id="127bf-202">IASetIndexBuffer</span><span class="sxs-lookup"><span data-stu-id="127bf-202">IASetIndexBuffer</span></span>                    | <span data-ttu-id="127bf-203">IASetIndexBuffer</span><span class="sxs-lookup"><span data-stu-id="127bf-203">IASetIndexBuffer</span></span>               |
| <span data-ttu-id="127bf-204">ResolveSubresource</span><span class="sxs-lookup"><span data-stu-id="127bf-204">ResolveSubresource</span></span>                  | <span data-ttu-id="127bf-205">ResolveSubresource</span><span class="sxs-lookup"><span data-stu-id="127bf-205">ResolveSubresource</span></span>             |
| <span data-ttu-id="127bf-206">CopySubresourceRegion</span><span class="sxs-lookup"><span data-stu-id="127bf-206">CopySubresourceRegion</span></span>               | <span data-ttu-id="127bf-207">CopyBufferRegion</span><span class="sxs-lookup"><span data-stu-id="127bf-207">CopyBufferRegion</span></span>               |
| <span data-ttu-id="127bf-208">UpdateSubresource</span><span class="sxs-lookup"><span data-stu-id="127bf-208">UpdateSubresource</span></span>                   | <span data-ttu-id="127bf-209">CopyTextureRegion</span><span class="sxs-lookup"><span data-stu-id="127bf-209">CopyTextureRegion</span></span>              |
| <span data-ttu-id="127bf-210">CopyResource</span><span class="sxs-lookup"><span data-stu-id="127bf-210">CopyResource</span></span>                        | <span data-ttu-id="127bf-211">CopyResource</span><span class="sxs-lookup"><span data-stu-id="127bf-211">CopyResource</span></span>                   |

> [!NOTE]
> <span data-ttu-id="127bf-212">Uma lista de comandos criada com **D3D12_COMMAND_LIST_TYPE_BUNDLE** é similar a um contexto adiado.</span><span class="sxs-lookup"><span data-stu-id="127bf-212">A command list created with **D3D12_COMMAND_LIST_TYPE_BUNDLE** is simliar to a deferred context.</span></span> <span data-ttu-id="127bf-213">O Direct3D 12 também dá suporte ao abiilty para acessar alguns recursos de um *contexto imediato* , simultaneamente à renderização por meio de **D3D12_COMMAND_LIST_TYPE_COPY** e **D3D12_COMMAND_LIST_TYPE_COMPUTE** tipos de lista de comandos.</span><span class="sxs-lookup"><span data-stu-id="127bf-213">Direct3D 12 also supports the abiilty to access some features of an *immediate context* simultaneous to rendering via **D3D12_COMMAND_LIST_TYPE_COPY** and **D3D12_COMMAND_LIST_TYPE_COMPUTE** command list types.</span></span>

## <a name="cpugpu-synchronization"></a><span data-ttu-id="127bf-214">Sincronização de CPU/GPU</span><span class="sxs-lookup"><span data-stu-id="127bf-214">CPU/GPU Synchronization</span></span>

<span data-ttu-id="127bf-215">Na sincronização de CPU/GPU do Direct3D 11 era amplamente automática, e não havia necessidade de o aplicativo manter o status da memória física.</span><span class="sxs-lookup"><span data-stu-id="127bf-215">In Direct3D 11 CPU/GPU synchronization was largely automatic, and there was no need for the app to maintain the status of physical memory.</span></span>

<span data-ttu-id="127bf-216">no Direct3D 12, o aplicativo deve gerenciar as duas linhas do tempo (CPU e GPU) explicitamente.</span><span class="sxs-lookup"><span data-stu-id="127bf-216">in Direct3D 12 the app must manage the two timelines (CPU and GPU) explicitly.</span></span> <span data-ttu-id="127bf-217">Isso exige que as informações precisem ser mantidas, pelo aplicativo, em quais recursos são exigidos pela GPU e por quanto tempo.</span><span class="sxs-lookup"><span data-stu-id="127bf-217">This requires that information needs to be maintained, by the app, on what resources are required by the GPU, and for how long.</span></span> <span data-ttu-id="127bf-218">Isso também significa que o aplicativo é responsável por garantir que o conteúdo dos recursos (recursos confirmados, heaps, alocadores de comando, por exemplo) não mude até que a GPU termine de usá-los.</span><span class="sxs-lookup"><span data-stu-id="127bf-218">This also means that the app is responsible for ensuring the contents of resources (committed resources, heaps, command allocators, for example) do not change until the GPU has finished using them.</span></span>

<span data-ttu-id="127bf-219">O objeto principal para sincronizar as linhas do tempo é o objeto [**ID3D12Fence**](/windows/win32/api/d3d12/nn-d3d12-id3d12fence) .</span><span class="sxs-lookup"><span data-stu-id="127bf-219">The main object for synchronizing the timelines is the [**ID3D12Fence**](/windows/win32/api/d3d12/nn-d3d12-id3d12fence) object.</span></span> <span data-ttu-id="127bf-220">A operação de limites é simples, pois permite que a GPU seja sinalizada quando tiver concluído uma tarefa.</span><span class="sxs-lookup"><span data-stu-id="127bf-220">The operation of fences is failry simple, they enable the GPU to signal when it has completed a task.</span></span> <span data-ttu-id="127bf-221">A GPU e a CPU podem sinalizar e podem esperar por limites.</span><span class="sxs-lookup"><span data-stu-id="127bf-221">The GPU and CPU can both signal, and can both wait on fences.</span></span>

<span data-ttu-id="127bf-222">Normalmente, a abordagem é que, ao enviar uma lista de comandos para execução, um sinal de cerca é transmitido pela GPU na conclusão (quando terminar de ler os dados), permitindo que a CPU reutilize ou destrua os recursos.</span><span class="sxs-lookup"><span data-stu-id="127bf-222">Typically the approach is that when submitting a command list for execution, a fence signal is transmitted by the GPU on completion (when it has finished reading the data), enabling the CPU to reuse or destroy the resources.</span></span>

<span data-ttu-id="127bf-223">No Direct3D 11, o sinalizador [**ID3D11DeviceContext:: map**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-map) D3D11 \_ \_ o descarte de gravação de mapa \_ , essencialmente, tratava de cada recurso como uma quantidade infinita de memória que o aplicativo poderia gravar (um processo conhecido como "renomeando").</span><span class="sxs-lookup"><span data-stu-id="127bf-223">In Direct3D 11 the [**ID3D11DeviceContext::Map**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-map) flag D3D11\_MAP\_WRITE\_DISCARD essentially treated each resource as an endless supply of memory the app could write to (a process known as "renaming").</span></span> <span data-ttu-id="127bf-224">No Direct3D 12, o processo é explícito: a memória adicional precisa ser alocada e os limites devem ser usados para sincronizar as operações.</span><span class="sxs-lookup"><span data-stu-id="127bf-224">In Direct3D 12 again the process is explicit: additional memory needs to be allocated, and fences should be used to sync the operations.</span></span> <span data-ttu-id="127bf-225">Os buffers de anéis (consistindo em grandes buffers) podem ser uma boa técnica para isso, consulte o cenário de buffer de anéis no [Gerenciamento de recursos baseado em isolamento](fence-based-resource-management.md).</span><span class="sxs-lookup"><span data-stu-id="127bf-225">Ring buffers (consisting of large buffers) might be a good technique for this, refer to the ring buffer scenario in [Fence-Based Resource Management](fence-based-resource-management.md).</span></span>

![usando um buffer de anéis](images/ring-buffer-1.png)

## <a name="resource-binding"></a><span data-ttu-id="127bf-227">Associação de recursos</span><span class="sxs-lookup"><span data-stu-id="127bf-227">Resource Binding</span></span>

<span data-ttu-id="127bf-228">As exibições no Direct3D 11 (exibições de recursos do sombreador, exibições de destino de renderização e assim por diante) foram substituídas em grande parte no Direct3D 12 pelo conceito de um descritor.</span><span class="sxs-lookup"><span data-stu-id="127bf-228">Views in Direct3D 11 (shader resource views, render target views, and so on), have largely been replaced in Direct3D 12 with the concept of a descriptor.</span></span> <span data-ttu-id="127bf-229">Os métodos de criação ainda existem no Direct3D 12 (como [**CreateShaderResourceView**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createshaderresourceview) e [**CreateRenderTargetView**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createrendertargetview)), que são chamados após a criação do heap de descritor, para gravar os dados no heap.</span><span class="sxs-lookup"><span data-stu-id="127bf-229">The creation methods still exist in Direct3D 12 (such as [**CreateShaderResourceView**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createshaderresourceview) and [**CreateRenderTargetView**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createrendertargetview)), which are called after the descriptor heap has been created, to write the data into the heap.</span></span> <span data-ttu-id="127bf-230">A associação no Direct3D 12 agora é manipulada por identificadores de descritor descritos em uma assinatura raiz e enviada usando os métodos [**SetGraphicsRootDescriptorTable**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-setgraphicsrootdescriptortable) ou [**SetComputeRootDescriptorTable**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-setcomputerootdescriptortable) .</span><span class="sxs-lookup"><span data-stu-id="127bf-230">Binding in Direct3D 12 is now handled by descriptor handles described in a root signature, and submitted using the [**SetGraphicsRootDescriptorTable**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-setgraphicsrootdescriptortable) or [**SetComputeRootDescriptorTable**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-setcomputerootdescriptortable) methods.</span></span>

<span data-ttu-id="127bf-231">As assinaturas raiz detalham os mapeamentos entre o número do slot de assinatura raiz e as tabelas de descritores, em que a tabela de descritores pode conter referências a recursos disponíveis para sombreadores de vértice, sombreadores de pixel e outros sombreadores, como buffers de constantes, exibições de recursos de sombreador e amostras.</span><span class="sxs-lookup"><span data-stu-id="127bf-231">Root signatures details mappings between the root signature slot number and descriptor tables, where the descriptor table can contain references to resources available to vertex shaders, pixel shaders, and the other shaders, such as constant buffers, shader resource views and samplers.</span></span> <span data-ttu-id="127bf-232">Essa flexibilidade desconecta o espaço de registro HLSL do espaço de associação de API no Direct3D 12, ao contrário do Direct3D 11, em que há um mapeamento de um para um entre eles.</span><span class="sxs-lookup"><span data-stu-id="127bf-232">This flexibility disconnects the HLSL register space from the API binding space in Direct3D 12, unlike Direct3D 11 where there is a one to one mapping between these.</span></span>

<span data-ttu-id="127bf-233">Uma das implicações desse sistema é que o aplicativo é responsável por renomear tabelas de descritores, o que permite aos desenvolvedores entender o custo de desempenho da alteração até mesmo de um único descritor por chamada de desenho.</span><span class="sxs-lookup"><span data-stu-id="127bf-233">One of the implications of this system is that the app is responsible for renaming descriptor tables, which enables developers to understand the performance cost of changing even a single descriptor per draw call.</span></span>

<span data-ttu-id="127bf-234">Um novo recurso do Direct3D 12 é que um aplicativo pode controlar quais descritores são compartilhados entre quais estágios do sombreador.</span><span class="sxs-lookup"><span data-stu-id="127bf-234">A new feature of Direct3D 12 is that an app can control which descriptors are shared between which shader stages.</span></span> <span data-ttu-id="127bf-235">No Direct3D 11, os recursos como UAVs são compartilhados entre todos os estágios do sombreador.</span><span class="sxs-lookup"><span data-stu-id="127bf-235">In Direct3D 11 resources such as UAVs are shared between all shader stages.</span></span> <span data-ttu-id="127bf-236">Ao habilitar os descritores para serem desabilitados em determinados estágios de sombreador, os registros usados pelos descritores que foram desabilitados estão disponíveis para serem usados por descritores que estão habilitados para um determinado estágio do sombreador.</span><span class="sxs-lookup"><span data-stu-id="127bf-236">By enabling descriptors to be disabled for certain shader stages, the registers used by descriptors that have been disabled are available to be used by descriptors which are enabled for a particular shader stage.</span></span>

<span data-ttu-id="127bf-237">A tabela a seguir mostra um exemplo de assinatura de raiz.</span><span class="sxs-lookup"><span data-stu-id="127bf-237">The following table shows an example root signature.</span></span>



| <span data-ttu-id="127bf-238">Slot de parâmetro raiz</span><span class="sxs-lookup"><span data-stu-id="127bf-238">Root Parameter Slot</span></span> | <span data-ttu-id="127bf-239">Entrada da tabela de descritores</span><span class="sxs-lookup"><span data-stu-id="127bf-239">Descriptor Table Entry</span></span>         |
|---------------------|--------------------------------|
| <span data-ttu-id="127bf-240">0</span><span class="sxs-lookup"><span data-stu-id="127bf-240">0</span></span>                   | <span data-ttu-id="127bf-241">Intervalo de descritor do VS B0-B13</span><span class="sxs-lookup"><span data-stu-id="127bf-241">VS Descriptor Range b0-b13</span></span>     |
| <span data-ttu-id="127bf-242">1</span><span class="sxs-lookup"><span data-stu-id="127bf-242">1</span></span>                   | <span data-ttu-id="127bf-243">Intervalo do descritor do VS T0-T127</span><span class="sxs-lookup"><span data-stu-id="127bf-243">VS Descriptor Range t0-t127</span></span>    |
| <span data-ttu-id="127bf-244">2</span><span class="sxs-lookup"><span data-stu-id="127bf-244">2</span></span>                   | <span data-ttu-id="127bf-245">Intervalo do descritor VS S0-S16</span><span class="sxs-lookup"><span data-stu-id="127bf-245">VS Descriptor Range s0-s16</span></span>     |
| <span data-ttu-id="127bf-246">3</span><span class="sxs-lookup"><span data-stu-id="127bf-246">3</span></span>                   | <span data-ttu-id="127bf-247">Intervalo de descritores do PS B0-B13</span><span class="sxs-lookup"><span data-stu-id="127bf-247">PS Descriptor Range b0-b13</span></span>     |
| <span data-ttu-id="127bf-248">...</span><span class="sxs-lookup"><span data-stu-id="127bf-248">...</span></span>                 |                                |
| <span data-ttu-id="127bf-249">14</span><span class="sxs-lookup"><span data-stu-id="127bf-249">14</span></span>                  | <span data-ttu-id="127bf-250">Intervalo de descritor de DS S0-16</span><span class="sxs-lookup"><span data-stu-id="127bf-250">DS Descriptor Range s0-16</span></span>      |
| <span data-ttu-id="127bf-251">15</span><span class="sxs-lookup"><span data-stu-id="127bf-251">15</span></span>                  | <span data-ttu-id="127bf-252">Intervalo de descritor compartilhado U0-u63</span><span class="sxs-lookup"><span data-stu-id="127bf-252">Shared Descriptor Range u0-u63</span></span> |



 

## <a name="resource-state"></a><span data-ttu-id="127bf-253">Estado do recurso</span><span class="sxs-lookup"><span data-stu-id="127bf-253">Resource state</span></span>

<span data-ttu-id="127bf-254">No estado do recurso do Direct3D 11 não é mantido pelo aplicativo, mas pelo driver.</span><span class="sxs-lookup"><span data-stu-id="127bf-254">In Direct3D 11 resource state is not maintained by the app, but by the driver.</span></span>

<span data-ttu-id="127bf-255">No Direct3D 12, a manutenção do estado do recurso se torna a responsabilidade do aplicativo, para habilitar o paralelismo total na gravação de listas de comandos: o aplicativo deve lidar com as linhas do tempo de gravação das listas de comandos (o que pode ser feito em paralelo) e as linhas do tempo de execução que devem ser sequenciais.</span><span class="sxs-lookup"><span data-stu-id="127bf-255">In Direct3D 12 maintaining resource state becomes the responsibility of the app, to enable full parallelism in the recording of command lists: the app must handle the recording timelines for command lists (which can be done in parallel), and the execution timelines which must be sequential.</span></span>

<span data-ttu-id="127bf-256">Uma transição de estado de recurso é tratada pelo método [**ResourceBarrier**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-resourcebarrier) .</span><span class="sxs-lookup"><span data-stu-id="127bf-256">A resource state transition is handled by the [**ResourceBarrier**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-resourcebarrier) method.</span></span> <span data-ttu-id="127bf-257">Principalmente, o aplicativo deve informar o driver quando o uso de recursos estiver sendo alterado.</span><span class="sxs-lookup"><span data-stu-id="127bf-257">Primarily the app must inform the driver when resource usage is changing.</span></span> <span data-ttu-id="127bf-258">Por exemplo, se um recurso estiver sendo usado como um destino de renderização e, em seguida, for usado como entrada para um sombreador de vértice na próxima chamada de desenho, isso poderá exigir uma pequena parada na operação de GPU para concluir a operação de destino de renderização antes de manipular o sombreador de vértice.</span><span class="sxs-lookup"><span data-stu-id="127bf-258">For example if a resource is being used as a render target, and then it is to be used as input to a vertex shader on the next draw call, then this might require a short stall in GPU operation to complete the render target operation before handling the vertex shader.</span></span>

<span data-ttu-id="127bf-259">Esse sistema permite a sincronização refinada (as vagas de GPU) do pipeline de gráficos, bem como liberações de cache e, possivelmente, algumas alterações de layout de memória (como exibição de destino de renderização para descompactação de exibição de estêncil de profundidade).</span><span class="sxs-lookup"><span data-stu-id="127bf-259">This system enables fine grain synchronization (the GPU stalls) of the graphics pipeline, as well as cache flushes and possibly some memory layout changes (such as render target view to depth stencil view decompression).</span></span>

<span data-ttu-id="127bf-260">Isso é conhecido como uma barreira de transição.</span><span class="sxs-lookup"><span data-stu-id="127bf-260">This is known as a transition barrier.</span></span> <span data-ttu-id="127bf-261">Há outros tipos de barreiras, no Direct3D 11, o [**ID3D11DeviceContext2:: TiledResourceBarrier**](/windows/win32/api/d3d11_2/nf-d3d11_2-id3d11devicecontext2-tiledresourcebarrier) habilitou a mesma memória física a ser usada por dois recursos diferentes do lado do ladrilho.</span><span class="sxs-lookup"><span data-stu-id="127bf-261">There are other kinds of barriers, in Direct3D 11 the [**ID3D11DeviceContext2::TiledResourceBarrier**](/windows/win32/api/d3d11_2/nf-d3d11_2-id3d11devicecontext2-tiledresourcebarrier) enabled the same physical memory to be used by two different tiled resources.</span></span> <span data-ttu-id="127bf-262">No Direct3D 12, isso é chamado de "barreira de alias".</span><span class="sxs-lookup"><span data-stu-id="127bf-262">In Direct3D 12 this is referred to as an "aliasing barrier".</span></span> <span data-ttu-id="127bf-263">As barreiras de alias podem ser usadas tanto para os recursos lado e inseridos no Direct3D 12.</span><span class="sxs-lookup"><span data-stu-id="127bf-263">Aliasing barriers can be used for both tiled and placed resources in Direct3D 12.</span></span> <span data-ttu-id="127bf-264">Além disso, há a barreira UAV.</span><span class="sxs-lookup"><span data-stu-id="127bf-264">Additionally there is the UAV barrier.</span></span> <span data-ttu-id="127bf-265">No Direct3D 11, todas as operações de expedição e de envio de UAV devem ser serializadas, mesmo que essas operações possam ser canalizadas ou trabalhar em paralelo.</span><span class="sxs-lookup"><span data-stu-id="127bf-265">In Direct3D 11 all UAV dispatch and draw operations are required to be serialized, even though these operations can be pipelined or work in parallel.</span></span> <span data-ttu-id="127bf-266">Para o Direct3D 12, essa restrição é removida pela adição de uma barreira UAV.</span><span class="sxs-lookup"><span data-stu-id="127bf-266">For Direct3D 12 this restriction is removed by the addition of a UAV barrier.</span></span> <span data-ttu-id="127bf-267">Uma barreira UAV garante que as operações UAV sejam sequenciais, portanto, se uma segunda operação exigir que a primeira seja concluída, a segunda será forçada a aguardar pela adição da barreira.</span><span class="sxs-lookup"><span data-stu-id="127bf-267">A UAV barrier ensures that UAV operations are sequential, so if a second operation requires that the first complete, the second will be forced to wait by the addition of the barrier.</span></span> <span data-ttu-id="127bf-268">A operação padrão para UAVs é simplesmente que as operações continuarão o mais rápido possível.</span><span class="sxs-lookup"><span data-stu-id="127bf-268">The default operation for UAVs is simply that the operations will proceed as quickly as possible.</span></span>

<span data-ttu-id="127bf-269">Claramente, há ganhos de desempenho se uma carga de trabalho pode ser paralelizada.</span><span class="sxs-lookup"><span data-stu-id="127bf-269">Clearly there are performance gains if a workload can be parallelized.</span></span>

## <a name="swapchains"></a><span data-ttu-id="127bf-270">Permuta</span><span class="sxs-lookup"><span data-stu-id="127bf-270">Swapchains</span></span>

<span data-ttu-id="127bf-271">A cadeia de permuta DXGI é a base para cadeias de permuta no Direct3D 11 e 12.</span><span class="sxs-lookup"><span data-stu-id="127bf-271">The DXGI swap chain is the basis for swap chains in both Direct3D 11 and 12.</span></span> <span data-ttu-id="127bf-272">Há algumas pequenas diferenças, no Direct3D 11, os três tipos de cadeia de permuta são SEQUENCIAis, descartar e inverter \_ sequenciais.</span><span class="sxs-lookup"><span data-stu-id="127bf-272">There are some minor differences, in Direct3D 11 the three types of swap chain are SEQUENTIAL, DISCARD, and FLIP\_SEQUENTIAL.</span></span> <span data-ttu-id="127bf-273">Para o Direct3D 12, há apenas dois tipos: inverter \_ sequencial e \_ descartar flip.</span><span class="sxs-lookup"><span data-stu-id="127bf-273">For Direct3D 12 there are just two types: FLIP\_SEQUENTIAL and FLIP\_DISCARD.</span></span> <span data-ttu-id="127bf-274">Conforme observado acima, você deve criar explicitamente seu SwapChain por meio do **IDXGIFactory4**, ou posterior, e usar a mesma interface para qualquer enumeração de adaptador.</span><span class="sxs-lookup"><span data-stu-id="127bf-274">As noted above, you should be explicitly creating your swapchain via **IDXGIFactory4**, or later, and using the same interface for any adapter enumeration.</span></span>

<span data-ttu-id="127bf-275">No Direct3D 11, há uma rotação de BackBuffer automática: somente uma exibição de destino de renderização é necessária para o buffer de fundo 0.</span><span class="sxs-lookup"><span data-stu-id="127bf-275">In Direct3D 11 there is automatic backbuffer rotation: only one render target view is needed for back buffer 0.</span></span> <span data-ttu-id="127bf-276">Na rotação do buffer do Direct3D 12 é explícita, é necessário haver uma exibição de destino de renderização para cada buffer de fundo.</span><span class="sxs-lookup"><span data-stu-id="127bf-276">In Direct3D 12 buffer rotation is explicit, there needs to be a render target view for each back buffer.</span></span> <span data-ttu-id="127bf-277">Use o método [**IDXGISwapChain3:: GetCurrentBackBufferIndex**](/windows/win32/api/dxgi1_4/nf-dxgi1_4-idxgiswapchain3-getcurrentbackbufferindex) para selecionar em qual deles renderizar.</span><span class="sxs-lookup"><span data-stu-id="127bf-277">Use the [**IDXGISwapChain3::GetCurrentBackBufferIndex**](/windows/win32/api/dxgi1_4/nf-dxgi1_4-idxgiswapchain3-getcurrentbackbufferindex) method to select which one to render to.</span></span> <span data-ttu-id="127bf-278">Novamente, essa flexibilidade adicional permite maior paralelização.</span><span class="sxs-lookup"><span data-stu-id="127bf-278">Again this additional flexibility enables greater parallelization.</span></span>

> [!NOTE]
> <span data-ttu-id="127bf-279">Embora haja várias maneiras de configurar seu aplicativo, geralmente os aplicativos têm um **ID3D12CommandAllocator** por buffer de cadeia de permuta.</span><span class="sxs-lookup"><span data-stu-id="127bf-279">While there are numerous ways to set up your application, generally applications have one **ID3D12CommandAllocator** per swap-chain buffer.</span></span> <span data-ttu-id="127bf-280">Isso permite que o aplicativo prossiga com a criação de um conjunto de comandos para o próximo quadro enquanto a GPU renderiza o anterior.</span><span class="sxs-lookup"><span data-stu-id="127bf-280">This allows the application to proceed to building up a set of commands for the next frame while the GPU renders the previous.</span></span>

## <a name="fixed-function-rendering"></a><span data-ttu-id="127bf-281">Renderização de função fixa</span><span class="sxs-lookup"><span data-stu-id="127bf-281">Fixed function rendering</span></span>

<span data-ttu-id="127bf-282">No Direct3D 11, havia alguns métodos que simplificaram várias operações de nível superior, como [**GenerateMips**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-generatemips) (criando cadeias de MIP completas) e [**DrawAuto**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-drawauto) (usando a saída de fluxo como entrada de sombreador sem a entrada adicional do aplicativo).</span><span class="sxs-lookup"><span data-stu-id="127bf-282">In Direct3D 11 there were a few methods that simplified various higher level operations, such as [**GenerateMips**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-generatemips) (creating full mip chains) and [**DrawAuto**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-drawauto) (using stream output as shader input without further input from the app).</span></span> <span data-ttu-id="127bf-283">Esses métodos não estão disponíveis no Direct3D 12, o aplicativo precisa lidar com essas operações criando sombreadores para realizá-las.</span><span class="sxs-lookup"><span data-stu-id="127bf-283">These methods are not available in Direct3D 12, the app needs to handle these operations by creating shaders to perform them.</span></span>

## <a name="odds-and-ends"></a><span data-ttu-id="127bf-284">Chances e terminações</span><span class="sxs-lookup"><span data-stu-id="127bf-284">Odds and ends</span></span>

<span data-ttu-id="127bf-285">A tabela a seguir mostra uma série de recursos semelhantes entre o Direct3D 11 e o 12, mas não são idênticos.</span><span class="sxs-lookup"><span data-stu-id="127bf-285">The following table shows a number of features that are similar between Direct3D 11 and 12, but are not identical.</span></span>



| <span data-ttu-id="127bf-286">Direct3D 11</span><span class="sxs-lookup"><span data-stu-id="127bf-286">Direct3D 11</span></span>                                                                            | <span data-ttu-id="127bf-287">Direct3D 12</span><span class="sxs-lookup"><span data-stu-id="127bf-287">Direct3D 12</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                              |
|----------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="127bf-288">**ID3D11Query**</span><span class="sxs-lookup"><span data-stu-id="127bf-288">**ID3D11Query**</span></span>](/windows/win32/api/d3d11/nn-d3d11-id3d11query)                                              | <span data-ttu-id="127bf-289">O [**ID3D12QueryHeap**](/windows/win32/api/d3d12/nn-d3d12-id3d12queryheap) permite que as consultas sejam agrupadas, reduzindo o custo.</span><span class="sxs-lookup"><span data-stu-id="127bf-289">[**ID3D12QueryHeap**](/windows/win32/api/d3d12/nn-d3d12-id3d12queryheap) allows queries to be grouped together, reducing the cost.</span></span>                                                                                                                                                                                                                                                                                                                                     |
| [<span data-ttu-id="127bf-290">**ID3D11Predicate**</span><span class="sxs-lookup"><span data-stu-id="127bf-290">**ID3D11Predicate**</span></span>](/windows/win32/api/d3d11/nn-d3d11-id3d11predicate)                                      | <span data-ttu-id="127bf-291">O predicação agora está habilitado por ter dados em um buffer totalmente transparente.</span><span class="sxs-lookup"><span data-stu-id="127bf-291">Predication is now enabled by having data in a fully transparent buffer.</span></span> <span data-ttu-id="127bf-292">O objeto Direct3D 11 [**ID3D11Predicate**](/windows/win32/api/d3d11/nn-d3d11-id3d11predicate) é substituído por [**ID3D12Resource:: map**](/windows/win32/api/d3d12/nf-d3d12-id3d12resource-map), que deve seguir uma chamada para [**ResolveQueryData**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-resolvequerydata) e uma operação de sincronização de GPU usando uma cerca para aguardar que os dados estejam prontos.</span><span class="sxs-lookup"><span data-stu-id="127bf-292">The Direct3D 11 [**ID3D11Predicate**](/windows/win32/api/d3d11/nn-d3d11-id3d11predicate) object is replaced by [**ID3D12Resource::Map**](/windows/win32/api/d3d12/nf-d3d12-id3d12resource-map), which must follow a call to [**ResolveQueryData**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-resolvequerydata) and a GPU sync operation using a fence to wait for the data to be ready.</span></span> <span data-ttu-id="127bf-293">Consulte [predicação](predication.md).</span><span class="sxs-lookup"><span data-stu-id="127bf-293">Refer to [Predication](predication.md).</span></span> |
| <span data-ttu-id="127bf-294">UAV/SO contador oculto</span><span class="sxs-lookup"><span data-stu-id="127bf-294">UAV/SO hidden counter</span></span>                                                                  | <span data-ttu-id="127bf-295">O aplicativo é responsável pela alocação e pelo gerenciamento dos contadores de SO/UAV.</span><span class="sxs-lookup"><span data-stu-id="127bf-295">The app is responsible for allocation and management of SO/UAV counters.</span></span> <span data-ttu-id="127bf-296">Consulte [contadores de saída de fluxo](stream-output-counters.md) e contadores de [UAV](uav-counters.md).</span><span class="sxs-lookup"><span data-stu-id="127bf-296">Refer to [Stream Output Counters](stream-output-counters.md) and [UAV Counters](uav-counters.md).</span></span>                                                                                                                                                                                                                                                             |
| <span data-ttu-id="127bf-297">MinLOD dinâmico de recursos (nível de detalhe)</span><span class="sxs-lookup"><span data-stu-id="127bf-297">Resource dynamic MinLOD (minium level of detail)</span></span>                                       | <span data-ttu-id="127bf-298">Isso foi movido para o MinLOD estático do descritor SRV.</span><span class="sxs-lookup"><span data-stu-id="127bf-298">This has been moved to the SRV descriptor static MinLOD.</span></span>                                                                                                                                                                                                                                                                                                                                                                                 |
| <span data-ttu-id="127bf-299">Desenhar \* indireto/[**DispatchIndirect**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-dispatchindirect)</span><span class="sxs-lookup"><span data-stu-id="127bf-299">Draw\*Indirect/[**DispatchIndirect**](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-dispatchindirect)</span></span> | <span data-ttu-id="127bf-300">Os métodos indiretos de desenho são todos mesclados em um método [**ExecuteIndirect**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-executeindirect) .</span><span class="sxs-lookup"><span data-stu-id="127bf-300">Drawing indirect methods are all merged into the one [**ExecuteIndirect**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-executeindirect) method.</span></span>                                                                                                                                                                                                                                                                                                        |
| <span data-ttu-id="127bf-301">Os formatos DepthStencil são intercalados</span><span class="sxs-lookup"><span data-stu-id="127bf-301">DepthStencil formats are interleaved</span></span>                                                   | <span data-ttu-id="127bf-302">Os formatos DepthStencil são planar.</span><span class="sxs-lookup"><span data-stu-id="127bf-302">DepthStencil formats are planar.</span></span> <span data-ttu-id="127bf-303">Por exemplo, um formato de 24 bits de profundidade, 8 bits de estêncil seriam armazenados no formato 24/8/24/8... etc., no Direct3D 11, mas como 24/24/24... seguido por 8/8/8... no Direct3D 12.</span><span class="sxs-lookup"><span data-stu-id="127bf-303">For example a format of 24 bits of depth, 8 bits of stencil would be stored in the format 24/8/24/8... etc in Direct3D 11, but as 24/24/24... followed by 8/8/8... in Direct3D 12.</span></span> <span data-ttu-id="127bf-304">Observe que cada plano é seu próprio subrecurso em D3D12 (consulte [subrecursos](subresources.md)).</span><span class="sxs-lookup"><span data-stu-id="127bf-304">Note that each plane is its own subresource in D3D12 (refer to [Subresources](subresources.md)).</span></span>                                                                                                                    |
| [<span data-ttu-id="127bf-305">**ResizeTilePool**</span><span class="sxs-lookup"><span data-stu-id="127bf-305">**ResizeTilePool**</span></span>](/windows/win32/api/d3d11_2/nf-d3d11_2-id3d11devicecontext2-resizetilepool)                   | <span data-ttu-id="127bf-306">Os recursos reservados podem ser mapeados para vários heaps.</span><span class="sxs-lookup"><span data-stu-id="127bf-306">Reserved resources can be mapped to multiple heaps.</span></span> <span data-ttu-id="127bf-307">Quando um pool de blocos fosse aumentado no D3D11, um heap adicional pode ser alocado em D3D12 em vez disso.</span><span class="sxs-lookup"><span data-stu-id="127bf-307">When a tile pool would have been grown in D3D11, an additional heap can be allocated in D3D12 instead.</span></span>                                                                                                                                                                                                                                                                               |



 

## <a name="related-topics"></a><span data-ttu-id="127bf-308">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="127bf-308">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="127bf-309">Tutoriais de vídeo do DirectX Advanced Learning: guia de portabilidade do DirectX 11 para DirectX 12</span><span class="sxs-lookup"><span data-stu-id="127bf-309">DirectX advanced learning video tutorials : DirectX 11 to DirectX 12 porting guide</span></span>](https://www.youtube.com/watch?v=BV64mdOCgZo)
</dt> <dt>

[<span data-ttu-id="127bf-310">Entendendo o Direct3D 12</span><span class="sxs-lookup"><span data-stu-id="127bf-310">Understanding Direct3D 12</span></span>](directx-12-getting-started.md)
</dt> <dt>

[<span data-ttu-id="127bf-311">Trabalhando com o Direct3D 11, o Direct3D 10 e o Direct2D</span><span class="sxs-lookup"><span data-stu-id="127bf-311">Working with Direct3D 11, Direct3D 10 and Direct2D</span></span>](direct3d-12-interop.md)
</dt> </dl>