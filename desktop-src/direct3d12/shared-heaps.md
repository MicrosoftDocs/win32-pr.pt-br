---
title: Heaps compartilhados
description: O compartilhamento é útil para arquiteturas de vários processos e multiadaptadores.
ms.assetid: 67C6B1D4-BF76-45A9-BADC-7C9520C900EB
ms.localizationpriority: high
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9f4271055f88e38484041c225b6b17c6d75f0d98
ms.sourcegitcommit: d6102d9e2b26368142fe5b006c65acb50c98be65
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/26/2019
ms.locfileid: "74104199"
---
# <a name="shared-heaps"></a><span data-ttu-id="75147-103">Heaps compartilhados</span><span class="sxs-lookup"><span data-stu-id="75147-103">Shared Heaps</span></span>

<span data-ttu-id="75147-104">O compartilhamento é útil para arquiteturas de vários processos e multiadaptadores.</span><span class="sxs-lookup"><span data-stu-id="75147-104">Sharing is useful for multi-process and multi-adapter architectures.</span></span>

-   [<span data-ttu-id="75147-105">Visão geral do compartilhamento</span><span class="sxs-lookup"><span data-stu-id="75147-105">Sharing overview</span></span>](#sharing-overview)
-   [<span data-ttu-id="75147-106">Compartilhando heaps entre processos</span><span class="sxs-lookup"><span data-stu-id="75147-106">Sharing heaps across processes</span></span>](#sharing-heaps-across-processes)
-   [<span data-ttu-id="75147-107">Compartilhando heaps entre adaptadores</span><span class="sxs-lookup"><span data-stu-id="75147-107">Sharing heaps across adapters</span></span>](#sharing-heaps-across-adapters)
-   [<span data-ttu-id="75147-108">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="75147-108">Related topics</span></span>](#related-topics)

## <a name="sharing-overview"></a><span data-ttu-id="75147-109">Visão geral do compartilhamento</span><span class="sxs-lookup"><span data-stu-id="75147-109">Sharing overview</span></span>

<span data-ttu-id="75147-110">As heaps compartilhadas permitem duas coisas: compartilhar dados em um heap em um ou mais processos e impedindo uma opção não determinística de layout de textura indefinido para recursos colocados dentro do heap.</span><span class="sxs-lookup"><span data-stu-id="75147-110">Shared heaps enable two things: sharing data in a heap across one or more processes, and precluding a non-deterministic choice of undefined texture layout for resources placed within the heap.</span></span> <span data-ttu-id="75147-111">O compartilhamento de heaps entre adaptadores também elimina a necessidade de empacotamento de CPU dos dados.</span><span class="sxs-lookup"><span data-stu-id="75147-111">Sharing heaps across adapters also removes the need for CPU marshaling of the data.</span></span>

<span data-ttu-id="75147-112">Os heaps e os recursos confirmados podem ser compartilhados.</span><span class="sxs-lookup"><span data-stu-id="75147-112">Both heaps and committed resources can be shared.</span></span> <span data-ttu-id="75147-113">Compartilhar um recurso confirmado realmente compartilha o heap implícito junto com a descrição do recurso confirmado, de modo que uma descrição de recurso compatível pode ser mapeada para o heap de outro dispositivo.</span><span class="sxs-lookup"><span data-stu-id="75147-113">Sharing a committed resource actually shares the implicit heap along with the committed resource description, such that a compatible resource description can be mapped to the heap from another device.</span></span>

<span data-ttu-id="75147-114">Todos os métodos são de thread livre e herdam a semântica D3D11 existente do design de compartilhamento do identificador NT.</span><span class="sxs-lookup"><span data-stu-id="75147-114">All methods are free-threaded and inherit the existing D3D11 semantics of the NT handle sharing design.</span></span>

-   [<span data-ttu-id="75147-115">**ID3D12Device::CreateSharedHandle**</span><span class="sxs-lookup"><span data-stu-id="75147-115">**ID3D12Device::CreateSharedHandle**</span></span>](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createsharedhandle)
-   [<span data-ttu-id="75147-116">**ID3D12Device::OpenSharedHandle**</span><span class="sxs-lookup"><span data-stu-id="75147-116">**ID3D12Device::OpenSharedHandle**</span></span>](/windows/win32/api/d3d12/nf-d3d12-id3d12device-opensharedhandle)
-   [<span data-ttu-id="75147-117">**ID3D12Device::OpenSharedHandleByName**</span><span class="sxs-lookup"><span data-stu-id="75147-117">**ID3D12Device::OpenSharedHandleByName**</span></span>](/windows/win32/api/d3d12/nf-d3d12-id3d12device-opensharedhandlebyname)

## <a name="sharing-heaps-across-processes"></a><span data-ttu-id="75147-118">Compartilhando heaps entre processos</span><span class="sxs-lookup"><span data-stu-id="75147-118">Sharing heaps across processes</span></span>

<span data-ttu-id="75147-119">As heaps compartilhadas são especificadas com o \_ \_ membro compartilhado do sinalizador heap D3D12 \_ da enumeração [**\_ \_ sinalizadores de heap D3D12**](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags) .</span><span class="sxs-lookup"><span data-stu-id="75147-119">Shared heaps are specified with the D3D12\_HEAP\_FLAG\_SHARED member of the [**D3D12\_HEAP\_FLAGS**](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags) enum.</span></span>

<span data-ttu-id="75147-120">Não há suporte para heaps compartilhados em heaps acessíveis por CPU: \_ carregamento de tipo de heap D3D12 \_ \_ , \_ tipo de heap D3D12 \_ \_ READBACK e \_ tipo de heap D3D12 \_ \_ personalizado sem a propriedade de página de \_ CPU D3D12 \_ \_ \_ não \_ disponível.</span><span class="sxs-lookup"><span data-stu-id="75147-120">Shared heaps are not supported on CPU-accessible heaps: D3D12\_HEAP\_TYPE\_UPLOAD, D3D12\_HEAP\_TYPE\_READBACK, and D3D12\_HEAP\_TYPE\_CUSTOM without D3D12\_CPU\_PAGE\_PROPERTY\_NOT\_AVAILABLE.</span></span>

<span data-ttu-id="75147-121">A impedimento de uma escolha não determinística do layout de textura indefinido pode prejudicar significativamente os cenários de renderização adiados em algumas GPUs, portanto, não é o comportamento padrão para recursos colocados e confirmados.</span><span class="sxs-lookup"><span data-stu-id="75147-121">Precluding a non-deterministic choice of undefined texture layout can significantly impair deferred rendering scenarios on some GPUs, so it is not the default behavior for placed and committed resources.</span></span> <span data-ttu-id="75147-122">A renderização adiada é prejudicada em algumas arquiteturas de GPU porque layouts de textura determinísticas diminuem a largura de banda de memória efetiva obtida ao renderizar simultaneamente para várias texturas de destino de renderização do mesmo formato e tamanho.</span><span class="sxs-lookup"><span data-stu-id="75147-122">Deferred rendering is impaired on some GPU architectures because deterministic texture layouts decrease the effective memory bandwidth achieved when rendering simultaneously to multiple render target textures of the same format and size.</span></span> <span data-ttu-id="75147-123">As arquiteturas de GPU estão evoluindo do aproveitamento de layouts de textura não determinísticas para dar suporte a padrões de swizzle padronizados e layouts padronizados com eficiência para renderização adiada.</span><span class="sxs-lookup"><span data-stu-id="75147-123">GPU architectures are evolving away from leveraging non-deterministic texture layouts in order to support standardized swizzle patterns and standardized layouts efficiently for deferred rendering.</span></span>

<span data-ttu-id="75147-124">Os heaps compartilhados também vêm com outros custos menores:</span><span class="sxs-lookup"><span data-stu-id="75147-124">Shared heaps come with other minor costs as well:</span></span>

-   <span data-ttu-id="75147-125">Os dados de heap compartilhados não podem ser reciclados com flexibilidade como heaps em processo devido a questões de divulgação de informações, portanto, a memória física é zero'ed com mais frequência.</span><span class="sxs-lookup"><span data-stu-id="75147-125">Shared heap data cannot be recycled as flexibly as in-process heaps due to information disclosure concerns, so physical memory is zero'ed more often.</span></span>
-   <span data-ttu-id="75147-126">Há uma menor sobrecarga de CPU adicional e maior uso de memória do sistema durante a criação e destruição de heaps compartilhados.</span><span class="sxs-lookup"><span data-stu-id="75147-126">There is a minor additional CPU overhead and increased system memory usage during creation and destruction of shared heaps.</span></span>

## <a name="sharing-heaps-across-adapters"></a><span data-ttu-id="75147-127">Compartilhando heaps entre adaptadores</span><span class="sxs-lookup"><span data-stu-id="75147-127">Sharing heaps across adapters</span></span>

<span data-ttu-id="75147-128">Os heaps compartilhados entre os adaptadores são especificados com o \_ \_ membro do \_ adaptador cruzado do sinalizador de heap D3D12 compartilhado \_ \_ da enumeração de [**\_ \_ sinalizadores de heap D3D12**](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags) .</span><span class="sxs-lookup"><span data-stu-id="75147-128">Shared heaps across adapters is specified with the D3D12\_HEAP\_FLAG\_SHARED\_CROSS\_ADAPTER member of the [**D3D12\_HEAP\_FLAGS**](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags) enum.</span></span>

<span data-ttu-id="75147-129">As heaps compartilhadas de adaptador cruzado permitem que vários adaptadores compartilhem dados sem que a CPU realize o marshaling dos dados entre eles.</span><span class="sxs-lookup"><span data-stu-id="75147-129">Cross adapter shared heaps enable multiple adapters to share data without the CPU marshaling the data between them.</span></span> <span data-ttu-id="75147-130">Embora os recursos de adaptador variáveis determinem como os adaptadores eficientes podem passar dados entre eles, a simples habilitação das cópias de GPU aumenta a largura de banda efetiva obtida.</span><span class="sxs-lookup"><span data-stu-id="75147-130">While varying adapter capabilities determine how efficient adapters can pass data between them, merely enabling GPU copies increases the effective bandwidth achieved.</span></span> <span data-ttu-id="75147-131">Alguns layouts de textura são permitidos em heaps de adaptador cruzado para dar suporte a um intercâmbio de dados de textura, mesmo que esses layouts de textura não tenham suporte de outra forma.</span><span class="sxs-lookup"><span data-stu-id="75147-131">Some texture layouts are allowed on cross adapter heaps to support an interchange of texture data, even if such texture layouts are not otherwise supported.</span></span> <span data-ttu-id="75147-132">Determinadas restrições podem se aplicar a essas texturas, como apenas a cópia de suporte.</span><span class="sxs-lookup"><span data-stu-id="75147-132">Certain restrictions may apply to such textures, such as only supporting copying.</span></span>

<span data-ttu-id="75147-133">O compartilhamento entre adaptadores funciona com heaps criados chamando [**ID3D12Device:: createheap**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createheap).</span><span class="sxs-lookup"><span data-stu-id="75147-133">Cross-adapter sharing works with heaps created by calling [**ID3D12Device::CreateHeap**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createheap).</span></span> <span data-ttu-id="75147-134">Os aplicativos podem criar recursos por meio do [**CreatePlacedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createplacedresource).</span><span class="sxs-lookup"><span data-stu-id="75147-134">Applications can then create resources via [**CreatePlacedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createplacedresource).</span></span> <span data-ttu-id="75147-135">Ele também é permitido por recursos/heaps criados por [**CreateCommittedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createcommittedresource) , mas somente para recursos de TEXTURE2D de dimensão de recurso de D3D12 de linha principal \_ \_ \_ (consulte [**D3D12 \_ Resource \_ Dimension**](/windows/win32/api/d3d12/ne-d3d12-d3d12_resource_dimension)).</span><span class="sxs-lookup"><span data-stu-id="75147-135">It is also allowed by resources/heaps created by [**CreateCommittedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createcommittedresource) but only for row-major D3D12\_RESOURCE\_DIMENSION\_TEXTURE2D resources (refer to [**D3D12\_RESOURCE\_DIMENSION**](/windows/win32/api/d3d12/ne-d3d12-d3d12_resource_dimension)).</span></span> <span data-ttu-id="75147-136">O compartilhamento entre adaptadores não funciona com [**CreateReservedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createreservedresource).</span><span class="sxs-lookup"><span data-stu-id="75147-136">Cross-adapter sharing does not work with [**CreateReservedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createreservedresource).</span></span>

<span data-ttu-id="75147-137">Para o compartilhamento entre adaptadores, todas as regras comuns de compartilhamento de recursos de fila cruzada ainda se aplicam.</span><span class="sxs-lookup"><span data-stu-id="75147-137">For cross-adapter sharing, all of the usual cross-queue resource sharing rules still apply.</span></span> <span data-ttu-id="75147-138">Os aplicativos devem emitir as barreiras apropriadas para garantir a sincronização adequada e o coerência entre os dois adaptadores.</span><span class="sxs-lookup"><span data-stu-id="75147-138">Applications must issue the appropriate barriers to ensure proper synchronization and coherence between the two adapters.</span></span> <span data-ttu-id="75147-139">Os aplicativos devem usar limites de adaptador cruzado para coordenar o agendamento de listas de comandos enviadas a vários adaptadores.</span><span class="sxs-lookup"><span data-stu-id="75147-139">Applications should use cross-adapter fences to coordinate the scheduling of command lists submitted to multiple adapters.</span></span> <span data-ttu-id="75147-140">Não há nenhum mecanismo para compartilhar recursos entre adaptadores nas versões da API do D3D.</span><span class="sxs-lookup"><span data-stu-id="75147-140">There is no mechanism to share cross-adapter resources across D3D API versions.</span></span> <span data-ttu-id="75147-141">Recursos compartilhados entre adaptadores só têm suporte na memória do sistema.</span><span class="sxs-lookup"><span data-stu-id="75147-141">Cross-adapter shared resources are only supported in system memory.</span></span> <span data-ttu-id="75147-142">Os recursos/heaps compartilhados entre adaptadores têm suporte em heaps padrão de tipo de heap D3D12 e heaps \_ \_ personalizados de \_ \_ \_ tipo de heap D3D12 \_ (com o pool de memória L0 e as propriedades da página de CPU de combinação de gravação).</span><span class="sxs-lookup"><span data-stu-id="75147-142">Cross-adapter shared heaps/resources are supported in D3D12\_HEAP\_TYPE\_DEFAULT heaps and D3D12\_HEAP\_TYPE\_CUSTOM heaps (with the L0 memory pool, and write-combine CPU page properties).</span></span> <span data-ttu-id="75147-143">Os drivers devem ter certeza de que as operações de leitura/gravação de GPU para heaps compartilhados entre adaptadores são coerentes com outras GPUs no sistema.</span><span class="sxs-lookup"><span data-stu-id="75147-143">Drivers must be sure that GPU read/write operations to cross-adapter shared heaps are coherent with other GPUs on the system.</span></span> <span data-ttu-id="75147-144">Por exemplo, o driver pode precisar excluir os dados de heap que residem em caches de GPU que normalmente não precisam ser liberados quando a CPU não pode acessar diretamente os dados de heap.</span><span class="sxs-lookup"><span data-stu-id="75147-144">For example, the driver may need to exclude the heap data from residing in GPU caches that typically don’t need to be flushed when the CPU cannot directly access the heap data.</span></span>

<span data-ttu-id="75147-145">Os aplicativos devem restringir o uso de heaps de adaptador cruzado apenas aos cenários que exigem a funcionalidade que eles fornecem.</span><span class="sxs-lookup"><span data-stu-id="75147-145">Applications should confine the usage of cross adapter heaps to only those scenarios which require the functionality they provide.</span></span> <span data-ttu-id="75147-146">Os heaps de adaptador cruzado estão localizados no \_ pool de memória D3D12 \_ \_ L0, que nem sempre é o que [**GetCustomHeapProperties**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-getcustomheapproperties) sugere.</span><span class="sxs-lookup"><span data-stu-id="75147-146">Cross-adapter heaps are located in D3D12\_MEMORY\_POOL\_L0, which is not always what [**GetCustomHeapProperties**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-getcustomheapproperties) suggests.</span></span> <span data-ttu-id="75147-147">Esse pool de memória não é eficiente para arquiteturas de adaptadores discretos/NUMA.</span><span class="sxs-lookup"><span data-stu-id="75147-147">That memory pool is not efficient for discrete/ NUMA adapter architectures.</span></span> <span data-ttu-id="75147-148">E os layouts de textura mais eficientes nem sempre estão disponíveis.</span><span class="sxs-lookup"><span data-stu-id="75147-148">And, the most efficient texture layouts are not always available.</span></span>

<span data-ttu-id="75147-149">As seguintes limitações também se aplicam:</span><span class="sxs-lookup"><span data-stu-id="75147-149">The following limitations also apply:</span></span>

-   <span data-ttu-id="75147-150">Os sinalizadores de heap relacionados a camadas de heap devem ser \_ sinalizador de heap D3D12 \_ \_ permitir \_ todos os \_ buffers \_ e \_ texturas.</span><span class="sxs-lookup"><span data-stu-id="75147-150">The heap flags related to heap tiers must be D3D12\_HEAP\_FLAG\_ALLOW\_ALL\_BUFFERS\_AND\_TEXTURES.</span></span>
-   <span data-ttu-id="75147-151">O \_ sinalizador de heap D3D12 \_ \_ compartilhado também deve ser definido.</span><span class="sxs-lookup"><span data-stu-id="75147-151">D3D12\_HEAP\_FLAG\_SHARED must also be set.</span></span>
-   <span data-ttu-id="75147-152">O \_ \_ tipo de heap D3D12 \_ padrão deve ser definido ou D3D12 \_ tipo de heap \_ \_ personalizado com D3D12 \_ \_ pool de memória \_ L0 e D3D12 \_ propriedade de página de CPU \_ \_ \_ não \_ disponível deve ser definido.</span><span class="sxs-lookup"><span data-stu-id="75147-152">Either D3D12\_HEAP\_TYPE\_DEFAULT must be set or D3D12\_HEAP\_TYPE\_CUSTOM with D3D12\_MEMORY\_POOL\_L0 and D3D12\_CPU\_PAGE\_PROPERTY\_NOT\_AVAILABLE must be set.</span></span>
-   <span data-ttu-id="75147-153">Somente os recursos com \_ sinalizador de recurso D3D12 \_ \_ permitir \_ adaptador cruzado \_ podem ser colocados em heaps de adaptador cruzado.</span><span class="sxs-lookup"><span data-stu-id="75147-153">Only resources with D3D12\_RESOURCE\_FLAG\_ALLOW\_CROSS\_ADAPTER may be placed on cross-adapter heaps.</span></span>

<span data-ttu-id="75147-154">Para obter mais informações sobre como usar vários adaptadores, consulte a seção [sistemas de vários adaptadores](multi-engine.md) .</span><span class="sxs-lookup"><span data-stu-id="75147-154">For more information on using multiple adapters, refer to the [Multi-adapter systems](multi-engine.md) section.</span></span>

## <a name="related-topics"></a><span data-ttu-id="75147-155">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="75147-155">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="75147-156">Subalocação dentro de heaps</span><span class="sxs-lookup"><span data-stu-id="75147-156">Suballocation Within Heaps</span></span>](suballocation-within-heaps.md)
</dt> </dl>

 

 




