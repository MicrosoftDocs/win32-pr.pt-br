---
title: Trocar cadeias
description: As cadeias de permuta controlam a rotação do buffer de fundo, formando a base da animação de gráficos.
ms.assetid: AABF5FDE-DB49-4B29-BC0E-032E0C7DF9EB
ms.localizationpriority: high
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ebbc7ec1b62ba620b42bc85c1c1f491ff7ba952d
ms.sourcegitcommit: 5b98bf8c68922f8f03c14f793fbe17504900559c
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 02/12/2021
ms.locfileid: "104548263"
---
# <a name="swap-chains"></a><span data-ttu-id="ea004-103">Trocar cadeias</span><span class="sxs-lookup"><span data-stu-id="ea004-103">Swap Chains</span></span>

<span data-ttu-id="ea004-104">As cadeias de permuta controlam a rotação do buffer de fundo, formando a base da animação de gráficos.</span><span class="sxs-lookup"><span data-stu-id="ea004-104">Swap chains control the back buffer rotation, forming the basis of graphics animation.</span></span>

## <a name="overview"></a><span data-ttu-id="ea004-105">Visão geral</span><span class="sxs-lookup"><span data-stu-id="ea004-105">Overview</span></span>

<span data-ttu-id="ea004-106">O modelo de programação para cadeias de permuta no Direct3D 12 não é idêntico ao de versões anteriores do D3D.</span><span class="sxs-lookup"><span data-stu-id="ea004-106">The programming model for swap chains in Direct3D 12 is not identical to that in earlier versions of D3D.</span></span> <span data-ttu-id="ea004-107">A conveniência de programação, por exemplo, de suporte à rotação automática de recursos que estava presente em D3D10 e D3D11 agora não é suportada.</span><span class="sxs-lookup"><span data-stu-id="ea004-107">The programming convenience, for example, of supporting automatic resource rotation that was present in D3D10 and D3D11 is not now supported.</span></span> <span data-ttu-id="ea004-108">Aplicativos habilitados para rotação de recursos automáticos para renderizar o mesmo objeto de API enquanto a superfície real sendo processada altera cada quadro.</span><span class="sxs-lookup"><span data-stu-id="ea004-108">Automatic resource rotation enabled apps to render the same API object while the actual surface being rendered changes each frame.</span></span> <span data-ttu-id="ea004-109">O comportamento de cadeias de permuta é alterado com o Direct3D 12 para permitir que outros recursos do Direct3D 12 tenham baixa sobrecarga de CPU.</span><span class="sxs-lookup"><span data-stu-id="ea004-109">The behavior of swap chains is changed with Direct3D 12 to enable other features of Direct3D 12 to have low CPU overhead.</span></span> <span data-ttu-id="ea004-110">Não há suporte para a chave de cor automática e a multiamostrar, embora ainda seja possível esticar e girar.</span><span class="sxs-lookup"><span data-stu-id="ea004-110">Automatic color key and multisampling are not supported, although notably stretching and rotation still are.</span></span>

### <a name="buffer-lifetime"></a><span data-ttu-id="ea004-111">Tempo de vida do buffer</span><span class="sxs-lookup"><span data-stu-id="ea004-111">Buffer lifetime</span></span>

<span data-ttu-id="ea004-112">Os aplicativos têm permissão para armazenar descritores pré-criados que fazem referência a buffers de fundo isso é habilitado, garantindo que o conjunto de buffers de propriedade de uma cadeia de permuta nunca seja alterado durante o tempo de vida da cadeia de permuta.</span><span class="sxs-lookup"><span data-stu-id="ea004-112">Apps are allowed to store pre-created descriptors which reference back buffers This is enabled by ensuring that the set of buffers owned by a swap chain never changes for the lifetime of the swap chain.</span></span> <span data-ttu-id="ea004-113">O conjunto de buffers retornado por [**IDXGISwapChain:: GetBuffer**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-getbuffer) não é alterado até que determinadas APIs sejam chamadas:</span><span class="sxs-lookup"><span data-stu-id="ea004-113">The set of buffers returned by [**IDXGISwapChain::GetBuffer**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-getbuffer) doesn't change until certain APIs are called:</span></span>

-   [<span data-ttu-id="ea004-114">**IDXGISwapChain::ResizeTarget**</span><span class="sxs-lookup"><span data-stu-id="ea004-114">**IDXGISwapChain::ResizeTarget**</span></span>](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizetarget)
-   [<span data-ttu-id="ea004-115">**IDXGISwapChain::ResizeBuffers**</span><span class="sxs-lookup"><span data-stu-id="ea004-115">**IDXGISwapChain::ResizeBuffers**</span></span>](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizebuffers)

<span data-ttu-id="ea004-116">A ordem dos buffers retornados por [**GetBuffer**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-getbuffer) nunca muda.</span><span class="sxs-lookup"><span data-stu-id="ea004-116">The order of buffers returned by [**GetBuffer**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-getbuffer) never changes.</span></span>

<span data-ttu-id="ea004-117">[**IDXGISwapChain3:: GetCurrentBackBufferIndex**](/windows/desktop/api/dxgi1_4/nf-dxgi1_4-idxgiswapchain3-getcurrentbackbufferindex) retorna o índice do buffer de fundo atual para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ea004-117">[**IDXGISwapChain3::GetCurrentBackBufferIndex**](/windows/desktop/api/dxgi1_4/nf-dxgi1_4-idxgiswapchain3-getcurrentbackbufferindex) returns the index of the current back buffer to the app.</span></span>

### <a name="swap-effects"></a><span data-ttu-id="ea004-118">Efeitos de permuta</span><span class="sxs-lookup"><span data-stu-id="ea004-118">Swap effects</span></span>

<span data-ttu-id="ea004-119">Os únicos efeitos de permuta com suporte são [**DXGI_SWAP_EFFECT_FLIP_SEQUENTIAL**](/windows/win32/api/dxgi/ne-dxgi-dxgi_swap_effect) e [**DXGI_SWAP_EFFECT_FLIP_DISCARD**](/windows/win32/api/dxgi/ne-dxgi-dxgi_swap_effect), o que exige que a contagem de buffers seja maior que um.</span><span class="sxs-lookup"><span data-stu-id="ea004-119">The only supported swap effects are [**DXGI_SWAP_EFFECT_FLIP_SEQUENTIAL**](/windows/win32/api/dxgi/ne-dxgi-dxgi_swap_effect) and [**DXGI_SWAP_EFFECT_FLIP_DISCARD**](/windows/win32/api/dxgi/ne-dxgi-dxgi_swap_effect), which requires the buffer count to be greater than one.</span></span>

### <a name="transitioning-between-windowed-and-full-screen-modes"></a><span data-ttu-id="ea004-120">Transição entre os modos de tela inteira e em janela</span><span class="sxs-lookup"><span data-stu-id="ea004-120">Transitioning between windowed and full-screen modes</span></span>

<span data-ttu-id="ea004-121">O Direct3D 12 não dá suporte ao modo de tela inteira exclusiva (FSE).</span><span class="sxs-lookup"><span data-stu-id="ea004-121">Direct3D 12 doesn't support full-screen exclusive mode (FSE).</span></span> <span data-ttu-id="ea004-122">Em vez disso, quando um jogo é o único aplicativo visível na tela, o sistema operacional usa uma estratégia chamada FSO (optimisations de tela inteira) para obter um efeito semelhante ao FSE sem as desvantagens de desempenho.</span><span class="sxs-lookup"><span data-stu-id="ea004-122">Instead, when a game is the only visible application on-screen, the OS uses a strategy called full-screen optimisations (FSO) to achieve a similar effect to FSE without the performance drawbacks.</span></span> <span data-ttu-id="ea004-123">Para obter mais informações sobre o FSO, consulte [Desmistificando a tela inteira Optimisations](https://devblogs.microsoft.com/directx/demystifying-full-screen-optimizations/).</span><span class="sxs-lookup"><span data-stu-id="ea004-123">For more info about FSO, see [Demystifying Fullscreen Optimisations](https://devblogs.microsoft.com/directx/demystifying-full-screen-optimizations/).</span></span>

<span data-ttu-id="ea004-124">O Direct3D 12 mantém a restrição de que os aplicativos devem chamar [**ResizeBuffers**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizebuffers) após a transição entre os modos de tela inteira e em janela (os cadeias de troca de modelo invertida D3D11 têm as mesmas restrições).</span><span class="sxs-lookup"><span data-stu-id="ea004-124">Direct3D 12 maintains the restriction that applications must call [**ResizeBuffers**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizebuffers) after transitioning between windowed and full-screen modes (D3D11 flip-model swap chains have the same restrictions).</span></span>

<span data-ttu-id="ea004-125">As transições [**IDXGISwapChain:: Setfullscreenstate**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-setfullscreenstate) não alteram o conjunto de buffers visíveis do aplicativo na cadeia de permuta.</span><span class="sxs-lookup"><span data-stu-id="ea004-125">The [**IDXGISwapChain::SetFullscreenState**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-setfullscreenstate) transitions do not change the set of app-visible buffers in the swap chain.</span></span> <span data-ttu-id="ea004-126">Somente as chamadas [**ResizeBuffers**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizebuffers) e [**ResizeTarget**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizetarget) criam ou destruim buffers visíveis ao aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ea004-126">Only the [**ResizeBuffers**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizebuffers) and [**ResizeTarget**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-resizetarget) calls create or destroy app-visible buffers.</span></span> <span data-ttu-id="ea004-127">No entanto, no Direct3D 12 [**IDXGISwapChain:: Setfullscreenstate**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-setfullscreenstate) não entra no modo de tela inteira e simplesmente altera resoluções e taxas de atualização para permitir optimisations de tela inteira.</span><span class="sxs-lookup"><span data-stu-id="ea004-127">However, in Direct3D 12 [**IDXGISwapChain::SetFullscreenState**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-setfullscreenstate) doesn't enter full-screen exclusive mode, and simply changes resolutions and refresh rates to allow full-screen optimisations.</span></span> <span data-ttu-id="ea004-128">Essas alterações podem ser feitas por um aplicativo sem o uso deste método</span><span class="sxs-lookup"><span data-stu-id="ea004-128">These changes can be made by an app without the use of this method</span></span>

<span data-ttu-id="ea004-129">Quando ou [**IDXGISwapChain::P reenviado**](/windows/win32/api/dxgi/nf-dxgi-idxgiswapchain-present) ou [**IDXGISwapChain1::P reenviado**](/windows/desktop/api/dxgi1_2/nf-dxgi1_2-idxgiswapchain1-present1) é chamado, o buffer de fundo a ser apresentado deve estar no estado [**\_ \_ estado \_ atual do recurso D3D12**](/windows/desktop/api/d3d12/ne-d3d12-d3d12_resource_states) .</span><span class="sxs-lookup"><span data-stu-id="ea004-129">When or [**IDXGISwapChain::Present**](/windows/win32/api/dxgi/nf-dxgi-idxgiswapchain-present) or [**IDXGISwapChain1::Present**](/windows/desktop/api/dxgi1_2/nf-dxgi1_2-idxgiswapchain1-present1) is called, the back buffer to be presented must be in the [**D3D12\_RESOURCE\_STATE\_PRESENT**](/windows/desktop/api/d3d12/ne-d3d12-d3d12_resource_states) state.</span></span> <span data-ttu-id="ea004-130">Apresentar falhará com **a \_ \_ \_ chamada inválida de erro dxgi** se não for o caso.</span><span class="sxs-lookup"><span data-stu-id="ea004-130">Present will fail with **DXGI\_ERROR\_INVALID\_CALL** if this is not the case.</span></span>

<span data-ttu-id="ea004-131">As cadeias de permuta em tela inteira continuam a ter a restrição de que [**Setfullscreenstate**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-setfullscreenstate)(false, NULL) deve ser chamada antes da versão final da cadeia de permuta.</span><span class="sxs-lookup"><span data-stu-id="ea004-131">Full-screen swap chains continue to have the restriction that [**SetFullscreenState**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-setfullscreenstate)(FALSE, NULL) must be called before the final release of the swap chain.</span></span> <span data-ttu-id="ea004-132">**Setfullscreenstate**(false) tem sucesso em cadeias de permuta em execução em dispositivos Direct3D 12.</span><span class="sxs-lookup"><span data-stu-id="ea004-132">**SetFullscreenState**(FALSE) succeeds on swap chains running on Direct3D 12 devices.</span></span>

<span data-ttu-id="ea004-133">As operações presentes ocorrem na fila 3D fornecida na criação do SwapChain, e os aplicativos são livres para apresentar simultaneamente várias cadeias de permuta e gravar e executar listas de comandos.</span><span class="sxs-lookup"><span data-stu-id="ea004-133">Present operations occur on the 3D queue provided at swapchain creation, and apps are free to concurrently present multiple swap chains, and record and execute command lists.</span></span>

<span data-ttu-id="ea004-134">Quando a parte final do trabalho de gráficos (por exemplo, o processo de execução de quadros) é feita em uma fila de computação ou não envolve a fila de gráficos do dispositivo, a criação de uma segunda fila 3D para apresentar pode ser benéfica e impedir a latência da apresentação atrasar o início do próximo quadro.</span><span class="sxs-lookup"><span data-stu-id="ea004-134">When the final part of the graphics work (for example, frame postprocessing) is done on a compute queue, or doesn't involve the device's graphics queue, creating a second 3D queue to present on can be beneficial and prevent the latency of presentation delaying the start of the next frame.</span></span> 

### <a name="example"></a><span data-ttu-id="ea004-135">Exemplo</span><span class="sxs-lookup"><span data-stu-id="ea004-135">Example</span></span>

<span data-ttu-id="ea004-136">O código de exemplo a seguir estaria presente no loop de renderização principal:</span><span class="sxs-lookup"><span data-stu-id="ea004-136">The following example code would be present in the main rendering loop:</span></span>

```cpp
void Present()
{
    m_swapChain->Present(0, m_presentFlags);
    m_backBufferIndex = (m_backBufferIndex + 1) % m_backBufferCount;
}
```

### <a name="creating-swap-chains"></a><span data-ttu-id="ea004-137">Criando cadeias de permuta</span><span class="sxs-lookup"><span data-stu-id="ea004-137">Creating swap chains</span></span>

<span data-ttu-id="ea004-138">Ao usar as chamadas [**CreateSwapChainForHwnd**](/windows/desktop/api/dxgi1_2/nf-dxgi1_2-idxgifactory2-createswapchainforhwnd), [**CreateSwapChainForCoreWindow**](/windows/desktop/api/dxgi1_2/nf-dxgi1_2-idxgifactory2-createswapchainforcorewindow)ou [**CreateSwapChainForComposition**](/windows/desktop/api/dxgi1_2/nf-dxgi1_2-idxgifactory2-createswapchainforcomposition) , observe que o parâmetro *pDevice* realmente requer um ponteiro para uma fila de comando direto no Direct3D 12, e não um dispositivo.</span><span class="sxs-lookup"><span data-stu-id="ea004-138">When using the [**CreateSwapChainForHwnd**](/windows/desktop/api/dxgi1_2/nf-dxgi1_2-idxgifactory2-createswapchainforhwnd), [**CreateSwapChainForCoreWindow**](/windows/desktop/api/dxgi1_2/nf-dxgi1_2-idxgifactory2-createswapchainforcorewindow), or [**CreateSwapChainForComposition**](/windows/desktop/api/dxgi1_2/nf-dxgi1_2-idxgifactory2-createswapchainforcomposition) calls, note that the *pDevice* parameter actually requires a pointer to a direct command queue in Direct3D 12, and not a device.</span></span>

### <a name="presenting-on-windows-7"></a><span data-ttu-id="ea004-139">Apresentação no Windows 7</span><span class="sxs-lookup"><span data-stu-id="ea004-139">Presenting on Windows 7</span></span>

<span data-ttu-id="ea004-140">Ao direcionar o Direct3D 12 no Windows 7, os tipos de DXGI necessários para o Direct3D 12 não estão presentes, portanto, você deve usar o **ID3D12CommandQueueDownLevel** fornecido pelo D3D12On7 (consultado fora da fila de comando direto) para apresentar.</span><span class="sxs-lookup"><span data-stu-id="ea004-140">When targeting Direct3D 12 on Windows 7, the necessary DXGI types for Direct3D 12 are not present, so you must use the D3D12On7-provided **ID3D12CommandQueueDownLevel** (queried off of the direct command queue) to present.</span></span>

<span data-ttu-id="ea004-141">Você fornece uma lista de comandos abertos para o método presente do Windows 7, que será usado, fechado e enviado automaticamente para o dispositivo para você.</span><span class="sxs-lookup"><span data-stu-id="ea004-141">You provide an open command list to the Windows 7 present method, which will then be used, closed, and automatically submitted to the device for you.</span></span> <span data-ttu-id="ea004-142">Você deve fornecer um buffer de fundo que deve ser criado pelo aplicativo, deve ser um recurso confirmado, deve ser de amostra única e deve ser um dos formatos a seguir.</span><span class="sxs-lookup"><span data-stu-id="ea004-142">You must provide a back buffer which must be app-created, must be a committed resource, must be single-sampled, and must be one of the following formats.</span></span>

* <span data-ttu-id="ea004-143">**DXGI_FORMAT_R16G16B16A16_FLOAT**</span><span class="sxs-lookup"><span data-stu-id="ea004-143">**DXGI_FORMAT_R16G16B16A16_FLOAT**</span></span>
* <span data-ttu-id="ea004-144">**DXGI_FORMAT_R10G10B10A2_UNORM**</span><span class="sxs-lookup"><span data-stu-id="ea004-144">**DXGI_FORMAT_R10G10B10A2_UNORM**</span></span>
* <span data-ttu-id="ea004-145">**DXGI_FORMAT_R8G8B8A8_UNORM**</span><span class="sxs-lookup"><span data-stu-id="ea004-145">**DXGI_FORMAT_R8G8B8A8_UNORM**</span></span>
* <span data-ttu-id="ea004-146">**DXGI_FORMAT_R8G8B8A8_UNORM_SRGB**</span><span class="sxs-lookup"><span data-stu-id="ea004-146">**DXGI_FORMAT_R8G8B8A8_UNORM_SRGB**</span></span>
* <span data-ttu-id="ea004-147">**DXGI_FORMAT_B8G8R8X8_UNORM**</span><span class="sxs-lookup"><span data-stu-id="ea004-147">**DXGI_FORMAT_B8G8R8X8_UNORM**</span></span>
* <span data-ttu-id="ea004-148">**DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM**</span><span class="sxs-lookup"><span data-stu-id="ea004-148">**DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM**</span></span>
* <span data-ttu-id="ea004-149">**DXGI_FORMAT_B8G8R8A8_UNORM**</span><span class="sxs-lookup"><span data-stu-id="ea004-149">**DXGI_FORMAT_B8G8R8A8_UNORM**</span></span>
* <span data-ttu-id="ea004-150">**DXGI_FORMAT_B8G8R8A8_UNORM_SRGB**</span><span class="sxs-lookup"><span data-stu-id="ea004-150">**DXGI_FORMAT_B8G8R8A8_UNORM_SRGB**</span></span>

## <a name="related-topics"></a><span data-ttu-id="ea004-151">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="ea004-151">Related topics</span></span>

* [<span data-ttu-id="ea004-152">D3D12_HEAP_FLAGS</span><span class="sxs-lookup"><span data-stu-id="ea004-152">D3D12_HEAP_FLAGS</span></span>](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags)
* [<span data-ttu-id="ea004-153">Tutoriais de vídeo do DirectX Advanced Learning: taxa de quadros não limitado</span><span class="sxs-lookup"><span data-stu-id="ea004-153">DirectX advanced learning video tutorials : Unthrottled Framerate</span></span>](https://www.youtube.com/watch?v=wn02zCXa9IU)
* [<span data-ttu-id="ea004-154">Renderização</span><span class="sxs-lookup"><span data-stu-id="ea004-154">Rendering</span></span>](rendering.md)
