---
title: Usando progressos para expressar o layout de enchimento e de memória
description: Os dezenases de DirectML são descritos pelas propriedades conhecidas como os *tamanhos* e os *avanços* do tensor.
ms.custom: Windows 10 May 2019 Update
ms.localizationpriority: high
ms.topic: article
ms.date: 04/19/2019
ms.openlocfilehash: b944b1a2600febe27f209bffcc0e355c6a9fc7db
ms.sourcegitcommit: cba7f424a292fd7f3a8518947b9466439b455419
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/23/2019
ms.locfileid: "104548248"
---
# <a name="using-strides-to-express-padding-and-memory-layout"></a><span data-ttu-id="cb5cb-103">Usando progressos para expressar o layout de enchimento e de memória</span><span class="sxs-lookup"><span data-stu-id="cb5cb-103">Using strides to express padding and memory layout</span></span>

<span data-ttu-id="cb5cb-104">Os tempos &mdash; de DirectML que são apoiados por buffers do Direct3D 12 &mdash; são descritos pelas propriedades conhecidas como os *tamanhos* e os *avanços* do tensor.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-104">DirectML tensors&mdash;which are are backed by Direct3D 12 buffers&mdash;are described by properties known as the *sizes* and the *strides* of the tensor.</span></span> <span data-ttu-id="cb5cb-105">Os *tamanhos* de tensor descrevem as dimensões lógicas do tensor.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-105">The tensor's *sizes* describe the logical dimensions of the tensor.</span></span> <span data-ttu-id="cb5cb-106">Por exemplo, um tensor 2D pode ter uma altura de 2 e uma largura de 3.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-106">For example, a 2D tensor might have a height of 2 and a width of 3.</span></span> <span data-ttu-id="cb5cb-107">Logicamente, o tensor tem 6 elementos distintos, embora os tamanhos não especifiquem como esses elementos são armazenados na memória.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-107">Logically, the tensor has 6 distinct elements, although the sizes don't specify how those elements are stored in memory.</span></span> <span data-ttu-id="cb5cb-108">Os *passos* do tensor descrevem o layout da memória física dos elementos do tensor.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-108">The tensor's *strides* describe the physical memory layout of the tensor's elements.</span></span>

## <a name="two-dimensional-2d-arrays"></a><span data-ttu-id="cb5cb-109">Matrizes bidimensionais (2D)</span><span class="sxs-lookup"><span data-stu-id="cb5cb-109">Two-dimensional (2D) arrays</span></span>

<span data-ttu-id="cb5cb-110">Considere um tensor 2D com altura de 2 e uma largura de 3; os dados incluem caracteres textuais.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-110">Consider a 2D tensor that has a height of 2 and a width of 3; the data comprises textual characters.</span></span> <span data-ttu-id="cb5cb-111">No C/C++, isso pode ser expresso usando uma matriz multidimensional.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-111">In C/C++, this might be expressed using a multi-dimensional array.</span></span>

```cpp
constexpr int rows = 2;
constexpr int columns = 3;
char tensor[rows][columns];
tensor[0][0] = 'A';
tensor[0][1] = 'B';
tensor[0][2] = 'C';
tensor[1][0] = 'D';
tensor[1][1] = 'E';
tensor[1][2] = 'F';
```

<span data-ttu-id="cb5cb-112">A exibição lógica do tensor acima é visualizada abaixo.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-112">The logical view of the above tensor is visualized below.</span></span>

```console
A B C
D E F
```

<span data-ttu-id="cb5cb-113">No C/C++, uma matriz multidimensional é armazenada em ordem de linha principal.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-113">In C/C++, a multi-dimensional array is stored in row-major order.</span></span> <span data-ttu-id="cb5cb-114">Em outras palavras, os elementos consecutivos ao longo da dimensão de largura são armazenados de forma contígua no espaço de memória linear.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-114">In other words, the consecutive elements along the width dimension are stored contiguously in linear memory space.</span></span>

<span data-ttu-id="cb5cb-115">Offset:</span><span class="sxs-lookup"><span data-stu-id="cb5cb-115">Offset:</span></span>|<span data-ttu-id="cb5cb-116">0</span><span class="sxs-lookup"><span data-stu-id="cb5cb-116">0</span></span>|<span data-ttu-id="cb5cb-117">1</span><span class="sxs-lookup"><span data-stu-id="cb5cb-117">1</span></span>|<span data-ttu-id="cb5cb-118">2</span><span class="sxs-lookup"><span data-stu-id="cb5cb-118">2</span></span>|<span data-ttu-id="cb5cb-119">3</span><span class="sxs-lookup"><span data-stu-id="cb5cb-119">3</span></span>|<span data-ttu-id="cb5cb-120">4</span><span class="sxs-lookup"><span data-stu-id="cb5cb-120">4</span></span>|<span data-ttu-id="cb5cb-121">5</span><span class="sxs-lookup"><span data-stu-id="cb5cb-121">5</span></span>
-|-|-|-|-|-|-
<span data-ttu-id="cb5cb-122">Valor:</span><span class="sxs-lookup"><span data-stu-id="cb5cb-122">Value:</span></span>|<span data-ttu-id="cb5cb-123">A</span><span class="sxs-lookup"><span data-stu-id="cb5cb-123">A</span></span>|<span data-ttu-id="cb5cb-124">B</span><span class="sxs-lookup"><span data-stu-id="cb5cb-124">B</span></span>|<span data-ttu-id="cb5cb-125">C</span><span class="sxs-lookup"><span data-stu-id="cb5cb-125">C</span></span>|<span data-ttu-id="cb5cb-126">D</span><span class="sxs-lookup"><span data-stu-id="cb5cb-126">D</span></span>|<span data-ttu-id="cb5cb-127">E</span><span class="sxs-lookup"><span data-stu-id="cb5cb-127">E</span></span>|<span data-ttu-id="cb5cb-128">F</span><span class="sxs-lookup"><span data-stu-id="cb5cb-128">F</span></span>

<span data-ttu-id="cb5cb-129">O *Stride* de uma dimensão é o número de elementos a serem ignorados para acessar o próximo elemento nessa dimensão.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-129">The *stride* of a dimension is the number of elements to skip in order to access the next element in that dimension.</span></span> <span data-ttu-id="cb5cb-130">Os avanços expressam o layout do tensor na memória.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-130">Strides express the layout of the tensor in memory.</span></span> <span data-ttu-id="cb5cb-131">Com uma ordem de linha principal, o stride da dimensão de largura é sempre 1, pois elementos adjacentes ao longo da dimensão são armazenados de forma contígua.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-131">With a row-major order, the stride of the width dimension is always 1, since adjacent elements along the dimension are stored contiguously.</span></span> <span data-ttu-id="cb5cb-132">O stride da dimensão de altura depende do tamanho da dimensão de largura; no exemplo acima, a distância entre elementos consecutivos ao longo da dimensão de altura (por exemplo, a a D) é igual à largura do tensor (que é 3 neste exemplo).</span><span class="sxs-lookup"><span data-stu-id="cb5cb-132">The stride of the height dimension depends on the size of the width dimension; in the above example, the distance between consecutive elements along the height dimension (for example, A to D) is equal to the width of the tensor (which is 3 in this example).</span></span>

<span data-ttu-id="cb5cb-133">Para ilustrar um layout diferente, considere a ordem de coluna principal.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-133">To illustrate a different layout, consider column-major order.</span></span> <span data-ttu-id="cb5cb-134">Em outras palavras, os elementos consecutivos ao longo da dimensão de altura são armazenados de forma contígua no espaço de memória linear.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-134">In other words, the consecutive elements along the height dimension are stored contiguously in linear memory space.</span></span> <span data-ttu-id="cb5cb-135">Nesse caso, o stride de altura é sempre 1 e o stride de largura é 2 (o tamanho da dimensão de altura).</span><span class="sxs-lookup"><span data-stu-id="cb5cb-135">In this case, the height-stride is always 1, and the width-stride is 2 (the size of the height dimension).</span></span>

<span data-ttu-id="cb5cb-136">Offset:</span><span class="sxs-lookup"><span data-stu-id="cb5cb-136">Offset:</span></span>|<span data-ttu-id="cb5cb-137">0</span><span class="sxs-lookup"><span data-stu-id="cb5cb-137">0</span></span>|<span data-ttu-id="cb5cb-138">1</span><span class="sxs-lookup"><span data-stu-id="cb5cb-138">1</span></span>|<span data-ttu-id="cb5cb-139">2</span><span class="sxs-lookup"><span data-stu-id="cb5cb-139">2</span></span>|<span data-ttu-id="cb5cb-140">3</span><span class="sxs-lookup"><span data-stu-id="cb5cb-140">3</span></span>|<span data-ttu-id="cb5cb-141">4</span><span class="sxs-lookup"><span data-stu-id="cb5cb-141">4</span></span>|<span data-ttu-id="cb5cb-142">5</span><span class="sxs-lookup"><span data-stu-id="cb5cb-142">5</span></span>
-|-|-|-|-|-|-
<span data-ttu-id="cb5cb-143">Valor:</span><span class="sxs-lookup"><span data-stu-id="cb5cb-143">Value:</span></span>|<span data-ttu-id="cb5cb-144">A</span><span class="sxs-lookup"><span data-stu-id="cb5cb-144">A</span></span>|<span data-ttu-id="cb5cb-145">D</span><span class="sxs-lookup"><span data-stu-id="cb5cb-145">D</span></span>|<span data-ttu-id="cb5cb-146">B</span><span class="sxs-lookup"><span data-stu-id="cb5cb-146">B</span></span>|<span data-ttu-id="cb5cb-147">E</span><span class="sxs-lookup"><span data-stu-id="cb5cb-147">E</span></span>|<span data-ttu-id="cb5cb-148">C</span><span class="sxs-lookup"><span data-stu-id="cb5cb-148">C</span></span>|<span data-ttu-id="cb5cb-149">F</span><span class="sxs-lookup"><span data-stu-id="cb5cb-149">F</span></span>

## <a name="higher-dimensions"></a><span data-ttu-id="cb5cb-150">Dimensões mais altas</span><span class="sxs-lookup"><span data-stu-id="cb5cb-150">Higher dimensions</span></span>

<span data-ttu-id="cb5cb-151">Quando se trata de mais de duas dimensões, é difícil fazer referência a um layout como linha-principal ou coluna-principal.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-151">When it comes to greater than two dimensions, it's unwieldy to refer to a layout as either row-major or column-major.</span></span> <span data-ttu-id="cb5cb-152">Assim, o restante deste tópico usa termos e rótulos como esses.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-152">So, the rest of this topic uses terms and labels such as these.</span></span>

- <span data-ttu-id="cb5cb-153">2D: &mdash; a altura de "HW" é a dimensão de ordem mais alta (linha-principal).</span><span class="sxs-lookup"><span data-stu-id="cb5cb-153">2D: "HW"&mdash;height is the highest-order dimension (row-major).</span></span>
- <span data-ttu-id="cb5cb-154">2D: a largura "qu" &mdash; é a dimensão de ordem mais alta (coluna-principal).</span><span class="sxs-lookup"><span data-stu-id="cb5cb-154">2D: "WH"&mdash;width is the highest-order dimension (column-major).</span></span>
- <span data-ttu-id="cb5cb-155">3D: a profundidade de "DHW" &mdash; é a dimensão de ordem mais alta, seguida por Height e, em seguida, Width.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-155">3D: "DHW"&mdash;depth is the highest-order dimension, followed by height, and then width.</span></span>
- <span data-ttu-id="cb5cb-156">3D: a largura "WHD" &mdash; é a dimensão de ordem mais alta, seguida por altura e, em seguida, profundidade.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-156">3D: "WHD"&mdash;width is the highest-order dimension, followed by height, and then depth.</span></span>
- <span data-ttu-id="cb5cb-157">4D: "NCHW" &mdash; o número de imagens (tamanho do lote), em seguida, o número de canais, a altura e a largura.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-157">4D: "NCHW"&mdash;the number of images (batch size), then the number of channels, then height, then width.</span></span>

<span data-ttu-id="cb5cb-158">Em geral, o stride *embalado* de uma dimensão é igual ao produto dos tamanhos das dimensões de ordem inferior.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-158">In general, the *packed* stride of a dimension is equal to the product of the sizes of the lower-order dimensions.</span></span> <span data-ttu-id="cb5cb-159">Por exemplo, com um layout "DHW", o D-Stride é igual a H \* W; o H-Stride é igual a W; e o W-Stride é igual a 1.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-159">For example, with a "DHW" layout, the D-stride is equal to H \* W; the H-stride is equal to W; and the W-stride is equal to 1.</span></span> <span data-ttu-id="cb5cb-160">Os passos devem ser *empacotados* quando o tamanho físico total do tensor for igual ao tamanho lógico total do tensor; em outras palavras, não há nenhum espaço extra nem sobreposição de elementos.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-160">Strides are said to be *packed* when the total physical size of the tensor is equal to the total logical size of the tensor; in other words, there's no extra space nor overlapping elements.</span></span>

<span data-ttu-id="cb5cb-161">Vamos estender o exemplo de 2D para três dimensões, para que tenhamos um tensor com profundidade 2, altura 2 e largura 3 (para um total de 12 elementos lógicos).</span><span class="sxs-lookup"><span data-stu-id="cb5cb-161">Let's extend the 2D example to three dimensions, so that we have a tensor with depth 2, height 2, and width 3 (for a total of 12 logical elements).</span></span>

```console
A B C
D E F

G H I
J K L
```

<span data-ttu-id="cb5cb-162">Com um layout "DHW", esse tensor é armazenado da seguinte maneira.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-162">With a "DHW" layout, this tensor is stored as follows.</span></span>

<span data-ttu-id="cb5cb-163">Offset:</span><span class="sxs-lookup"><span data-stu-id="cb5cb-163">Offset:</span></span>|<span data-ttu-id="cb5cb-164">0</span><span class="sxs-lookup"><span data-stu-id="cb5cb-164">0</span></span>|<span data-ttu-id="cb5cb-165">1</span><span class="sxs-lookup"><span data-stu-id="cb5cb-165">1</span></span>|<span data-ttu-id="cb5cb-166">2</span><span class="sxs-lookup"><span data-stu-id="cb5cb-166">2</span></span>|<span data-ttu-id="cb5cb-167">3</span><span class="sxs-lookup"><span data-stu-id="cb5cb-167">3</span></span>|<span data-ttu-id="cb5cb-168">4</span><span class="sxs-lookup"><span data-stu-id="cb5cb-168">4</span></span>|<span data-ttu-id="cb5cb-169">5</span><span class="sxs-lookup"><span data-stu-id="cb5cb-169">5</span></span>|<span data-ttu-id="cb5cb-170">6</span><span class="sxs-lookup"><span data-stu-id="cb5cb-170">6</span></span>|<span data-ttu-id="cb5cb-171">7</span><span class="sxs-lookup"><span data-stu-id="cb5cb-171">7</span></span>|<span data-ttu-id="cb5cb-172">8</span><span class="sxs-lookup"><span data-stu-id="cb5cb-172">8</span></span>|<span data-ttu-id="cb5cb-173">9</span><span class="sxs-lookup"><span data-stu-id="cb5cb-173">9</span></span>|<span data-ttu-id="cb5cb-174">10</span><span class="sxs-lookup"><span data-stu-id="cb5cb-174">10</span></span>|<span data-ttu-id="cb5cb-175">11</span><span class="sxs-lookup"><span data-stu-id="cb5cb-175">11</span></span>|
-|-|-|-|-|-|-|-|-|-|-|-|-|
<span data-ttu-id="cb5cb-176">Valor:</span><span class="sxs-lookup"><span data-stu-id="cb5cb-176">Value:</span></span>|<span data-ttu-id="cb5cb-177">A</span><span class="sxs-lookup"><span data-stu-id="cb5cb-177">A</span></span>|<span data-ttu-id="cb5cb-178">B</span><span class="sxs-lookup"><span data-stu-id="cb5cb-178">B</span></span>|<span data-ttu-id="cb5cb-179">C</span><span class="sxs-lookup"><span data-stu-id="cb5cb-179">C</span></span>|<span data-ttu-id="cb5cb-180">D</span><span class="sxs-lookup"><span data-stu-id="cb5cb-180">D</span></span>|<span data-ttu-id="cb5cb-181">E</span><span class="sxs-lookup"><span data-stu-id="cb5cb-181">E</span></span>|<span data-ttu-id="cb5cb-182">F</span><span class="sxs-lookup"><span data-stu-id="cb5cb-182">F</span></span>|<span data-ttu-id="cb5cb-183">G</span><span class="sxs-lookup"><span data-stu-id="cb5cb-183">G</span></span>|<span data-ttu-id="cb5cb-184">H</span><span class="sxs-lookup"><span data-stu-id="cb5cb-184">H</span></span>|<span data-ttu-id="cb5cb-185">I</span><span class="sxs-lookup"><span data-stu-id="cb5cb-185">I</span></span>|<span data-ttu-id="cb5cb-186">J</span><span class="sxs-lookup"><span data-stu-id="cb5cb-186">J</span></span>|<span data-ttu-id="cb5cb-187">K</span><span class="sxs-lookup"><span data-stu-id="cb5cb-187">K</span></span>|<span data-ttu-id="cb5cb-188">L</span><span class="sxs-lookup"><span data-stu-id="cb5cb-188">L</span></span>|

- <span data-ttu-id="cb5cb-189">D-Stride = altura (2) \* largura (3) = 6 (por exemplo, a distância entre ' A ' e ' G ').</span><span class="sxs-lookup"><span data-stu-id="cb5cb-189">D-stride = height (2) \* width (3) = 6 (for example, the distance between 'A' and 'G').</span></span>
- <span data-ttu-id="cb5cb-190">H-Stride = largura (3) = 3 (por exemplo, a distância entre ' A ' e ' d').</span><span class="sxs-lookup"><span data-stu-id="cb5cb-190">H-stride = width (3) = 3 (for example, the distance between 'A' and 'D').</span></span>
- <span data-ttu-id="cb5cb-191">W-Stride = 1 (por exemplo, a distância entre ' A ' e ' B ').</span><span class="sxs-lookup"><span data-stu-id="cb5cb-191">W-stride = 1 (for example, the distance between 'A' and 'B').</span></span>

<span data-ttu-id="cb5cb-192">O produto de ponto dos índices/coordenadas de um elemento e os avanços fornecem o deslocamento para esse elemento no buffer.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-192">The dot product of the indices/coordinates of an element and the strides provides the offset to that element in the buffer.</span></span> <span data-ttu-id="cb5cb-193">Por exemplo, o deslocamento do elemento H (d = 1, H = 0, w = 1) é 7.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-193">For example, the offset of the H element (d=1, h=0, w=1) is 7.</span></span>

<span data-ttu-id="cb5cb-194">{1, 0, 1} ⋅ {6, 3, 1} = 1 \* 6 + 0 \* 3 + 1 \* 1 = 7</span><span class="sxs-lookup"><span data-stu-id="cb5cb-194">{1, 0, 1} ⋅ {6, 3, 1} = 1 \* 6 + 0 \* 3 + 1 \* 1 = 7</span></span>

## <a name="packed-tensors"></a><span data-ttu-id="cb5cb-195">Dezenases em pacotes</span><span class="sxs-lookup"><span data-stu-id="cb5cb-195">Packed tensors</span></span>

<span data-ttu-id="cb5cb-196">Os exemplos acima ilustram os tempos de *empacotamento* .</span><span class="sxs-lookup"><span data-stu-id="cb5cb-196">The examples above illustrate *packed* tensors.</span></span> <span data-ttu-id="cb5cb-197">Um tensor é considerado *embalado* quando o tamanho lógico do tensor (em elementos) é igual ao tamanho físico do buffer (em elementos) e cada elemento tem um endereço/deslocamento exclusivo.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-197">A tensor is said to be *packed* when the logical size of the tensor (in elements) is equal to the physical size of the buffer (in elements), and each element has a unique address/offset.</span></span> <span data-ttu-id="cb5cb-198">Por exemplo, um 2x2x3 tensor será empacotado se o buffer tiver 12 elementos de comprimento e nenhum par de elementos compartilhar o mesmo deslocamento no buffer.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-198">For example, a 2x2x3 tensor is packed if the buffer is 12 elements in length and no pair of elements share the same offset in the buffer.</span></span> <span data-ttu-id="cb5cb-199">Os dezenases incluídos são o caso mais comum; Mas os avanços permitem layouts de memória mais complexos.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-199">Packed tensors are the most common case; but strides allow more complex memory layouts.</span></span>

## <a name="broadcasting-with-strides"></a><span data-ttu-id="cb5cb-200">Transmitindo com progressos</span><span class="sxs-lookup"><span data-stu-id="cb5cb-200">Broadcasting with strides</span></span>

<span data-ttu-id="cb5cb-201">Se o tamanho do buffer de um tensor (em elementos) for menor do que o produto de suas dimensões lógicas, então, será necessário haver alguma sobreposição de elementos.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-201">If a tensor's buffer size (in elements) is smaller than the product of its logical dimensions, then it follows that there must be some overlapping of elements.</span></span> <span data-ttu-id="cb5cb-202">O caso usual para isso é conhecido como *transmissão*; onde os elementos de uma dimensão são uma duplicata de outra dimensão.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-202">The usual case for this is known as *broadcasting*; where the elements of a dimension are a duplicate of another dimension.</span></span> <span data-ttu-id="cb5cb-203">Por exemplo, Vamos revisitar o exemplo de 2D.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-203">For example, let's revisit the 2D example.</span></span> <span data-ttu-id="cb5cb-204">Digamos que desejamos um tensor que seja logicamente 2x3, mas a segunda linha é idêntica à primeira linha.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-204">Let's say that we want a tensor that is logically 2x3, but the second row is identical to the first row.</span></span> <span data-ttu-id="cb5cb-205">Esta é a aparência.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-205">Here's how that looks.</span></span>

```console
A B C
A B C
```

<span data-ttu-id="cb5cb-206">Isso pode ser armazenado como um tensor de HW/linha-principal empacotado.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-206">This could be stored as a packed HW/row-major tensor.</span></span> <span data-ttu-id="cb5cb-207">Mas um armazenamento mais compacto conterá apenas três elementos (A, B e C) e usará um stride de altura de 0 em vez de 3.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-207">But a more compact storage would contain only 3 elements (A, B, and C) and use a height-stride of 0 instead of 3.</span></span> <span data-ttu-id="cb5cb-208">Nesse caso, o tamanho físico do tensor é de três elementos, mas o tamanho lógico é de 6 elementos.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-208">In this case, the physical size of the tensor is 3 elements, but the logical size is 6 elements.</span></span>

<span data-ttu-id="cb5cb-209">Em geral, se o stride de uma dimensão for 0, todos os elementos nas dimensões de ordem inferior serão repetidos ao longo da dimensão transmitida; por exemplo, se tensor for NCHW e o C-stride for 0, cada canal terá os mesmos valores ao longo de H e W.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-209">In general, if the stride of a dimension is 0, then all elements in the lower-order dimensions are repeated along the broadcasted dimension; for example, if the tensor is NCHW and the C-stride is 0, then each channel has the same values along H and W.</span></span>

## <a name="padding-with-strides"></a><span data-ttu-id="cb5cb-210">Preenchimento com progressos</span><span class="sxs-lookup"><span data-stu-id="cb5cb-210">Padding with strides</span></span>

<span data-ttu-id="cb5cb-211">Um tensor será *preenchido* se seu tamanho físico for maior do que o tamanho mínimo necessário para ajustar seus elementos.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-211">A tensor is said to be *padded* if its physical size is larger than the minimum size needed to fit its elements.</span></span> <span data-ttu-id="cb5cb-212">Quando não há nenhum elemento de difusão nem sobreposição, o tamanho mínimo do tensor (em elementos) é simplesmente o produto de suas dimensões.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-212">When there is no broadcasting nor overlapping elements, the minimum size of the tensor (in elements) is simply the product of its dimensions.</span></span> <span data-ttu-id="cb5cb-213">Você pode usar a função auxiliar `DMLCalcBufferTensorSize` (consulte [funções auxiliares DirectML](dml-helper-functions.md) para obter uma listagem dessa função) para calcular o tamanho *mínimo* do buffer para seus DirectMLs.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-213">You can use the helper function `DMLCalcBufferTensorSize` (see [DirectML helper functions](dml-helper-functions.md) for a listing of that function) to calculate the *minimum* buffer size for your DirectML tensors.</span></span>

<span data-ttu-id="cb5cb-214">Digamos que um buffer contenha os valores a seguir (os elementos ' x ' indicam valores de preenchimento).</span><span class="sxs-lookup"><span data-stu-id="cb5cb-214">Let's say that a buffer contains the following values (the 'x' elements indicate padding values).</span></span>

<span data-ttu-id="cb5cb-215">0</span><span class="sxs-lookup"><span data-stu-id="cb5cb-215">0</span></span>|<span data-ttu-id="cb5cb-216">1</span><span class="sxs-lookup"><span data-stu-id="cb5cb-216">1</span></span>|<span data-ttu-id="cb5cb-217">2</span><span class="sxs-lookup"><span data-stu-id="cb5cb-217">2</span></span>|<span data-ttu-id="cb5cb-218">3</span><span class="sxs-lookup"><span data-stu-id="cb5cb-218">3</span></span>|<span data-ttu-id="cb5cb-219">4</span><span class="sxs-lookup"><span data-stu-id="cb5cb-219">4</span></span>|<span data-ttu-id="cb5cb-220">5</span><span class="sxs-lookup"><span data-stu-id="cb5cb-220">5</span></span>|<span data-ttu-id="cb5cb-221">6</span><span class="sxs-lookup"><span data-stu-id="cb5cb-221">6</span></span>|<span data-ttu-id="cb5cb-222">7</span><span class="sxs-lookup"><span data-stu-id="cb5cb-222">7</span></span>|<span data-ttu-id="cb5cb-223">8</span><span class="sxs-lookup"><span data-stu-id="cb5cb-223">8</span></span>|<span data-ttu-id="cb5cb-224">9</span><span class="sxs-lookup"><span data-stu-id="cb5cb-224">9</span></span>|
-|-|-|-|-|-|-|-|-|-|
<span data-ttu-id="cb5cb-225">A</span><span class="sxs-lookup"><span data-stu-id="cb5cb-225">A</span></span>|<span data-ttu-id="cb5cb-226">B</span><span class="sxs-lookup"><span data-stu-id="cb5cb-226">B</span></span>|<span data-ttu-id="cb5cb-227">C</span><span class="sxs-lookup"><span data-stu-id="cb5cb-227">C</span></span>|<span data-ttu-id="cb5cb-228">x</span><span class="sxs-lookup"><span data-stu-id="cb5cb-228">x</span></span>|<span data-ttu-id="cb5cb-229">x</span><span class="sxs-lookup"><span data-stu-id="cb5cb-229">x</span></span>|<span data-ttu-id="cb5cb-230">D</span><span class="sxs-lookup"><span data-stu-id="cb5cb-230">D</span></span>|<span data-ttu-id="cb5cb-231">E</span><span class="sxs-lookup"><span data-stu-id="cb5cb-231">E</span></span>|<span data-ttu-id="cb5cb-232">F</span><span class="sxs-lookup"><span data-stu-id="cb5cb-232">F</span></span>|<span data-ttu-id="cb5cb-233">x</span><span class="sxs-lookup"><span data-stu-id="cb5cb-233">x</span></span>|<span data-ttu-id="cb5cb-234">x</span><span class="sxs-lookup"><span data-stu-id="cb5cb-234">x</span></span>

<span data-ttu-id="cb5cb-235">O tensor preenchido pode ser descrito usando um stride de altura de 5 em vez de 3.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-235">The padded tensor can be described by using a height-stride of 5 instead of 3.</span></span> <span data-ttu-id="cb5cb-236">Em vez de passar por três elementos para chegar à próxima linha, a etapa é de 5 elementos (três elementos *reais* mais 2 elementos de preenchimento).</span><span class="sxs-lookup"><span data-stu-id="cb5cb-236">Instead of stepping by 3 elements to get to the next row, the step is 5 elements (3 *real* elements plus 2 padding elements).</span></span> <span data-ttu-id="cb5cb-237">O preenchimento é comum em gráficos de computador, por exemplo, para garantir que uma imagem tenha um alinhamento de potência de dois.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-237">Padding is common in computer graphics, for example, to ensure that an image has a power-of-two alignment.</span></span>

```console
A B C
D E F
```

## <a name="directml-buffer-tensor-descriptions"></a><span data-ttu-id="cb5cb-238">Descrições de tensor do buffer DirectML</span><span class="sxs-lookup"><span data-stu-id="cb5cb-238">DirectML buffer tensor descriptions</span></span>

<span data-ttu-id="cb5cb-239">O DirectML pode trabalhar com uma variedade de layouts de tensor físicos, já que a estrutura de [ **DML_BUFFER_TENSOR_DESC**](/windows/desktop/api/directml/ns-directml-dml_buffer_tensor_desc) tem ambos os `Sizes` `Strides` Membros e.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-239">DirectML can work with a variety of physical tensor layouts, since the [**DML_BUFFER_TENSOR_DESC** structure](/windows/desktop/api/directml/ns-directml-dml_buffer_tensor_desc) has both `Sizes` and `Strides` members.</span></span> <span data-ttu-id="cb5cb-240">Algumas implementações de operador podem ser mais eficientes com um layout específico, portanto, não é incomum alterar como os dados de tensor são armazenados para melhorar o desempenho.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-240">Some operator implementations might be more efficient with a specific layout, so it's not uncommon to change how tensor data is stored for better performance.</span></span>

<span data-ttu-id="cb5cb-241">A maioria dos operadores de DirectML requer 4D ou 5D, e a ordem dos valores de tamanhos e de progressos é fixa.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-241">Most DirectML operators require either 4D or 5D tensors, and the order of the sizes and strides values is fixed.</span></span> <span data-ttu-id="cb5cb-242">Ao corrigir a ordem dos tamanhos e valores de Stride em uma descrição de tensor, é possível que DirectML inferir layouts físicos diferentes.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-242">By fixing the order of the sizes and stride values in a tensor description, it's possible for DirectML to infer different physical layouts.</span></span>

<span data-ttu-id="cb5cb-243">**4D**</span><span class="sxs-lookup"><span data-stu-id="cb5cb-243">**4D**</span></span>
- <span data-ttu-id="cb5cb-244">[**DML_BUFFER_TENSOR_DESC:: tamanhos**](/windows/desktop/api/directml/ns-directml-dml_buffer_tensor_desc) = {N-tamanho, C-tamanho, H-tamanho, W-size}</span><span class="sxs-lookup"><span data-stu-id="cb5cb-244">[**DML_BUFFER_TENSOR_DESC::Sizes**](/windows/desktop/api/directml/ns-directml-dml_buffer_tensor_desc) = { N-size, C-size, H-size, W-size }</span></span>
- <span data-ttu-id="cb5cb-245">[**DML_BUFFER_TENSOR_DESC:: prerides**](/windows/desktop/api/directml/ns-directml-dml_buffer_tensor_desc) = {N-Stride, C-Stride, H-Stride, W-Stride}</span><span class="sxs-lookup"><span data-stu-id="cb5cb-245">[**DML_BUFFER_TENSOR_DESC::Strides**](/windows/desktop/api/directml/ns-directml-dml_buffer_tensor_desc) = { N-stride, C-stride, H-stride, W-stride }</span></span>

<span data-ttu-id="cb5cb-246">**5D**</span><span class="sxs-lookup"><span data-stu-id="cb5cb-246">**5D**</span></span>
- <span data-ttu-id="cb5cb-247">**DML_BUFFER_TENSOR_DESC:: tamanhos** = {N-tamanho, C-tamanho, D-tamanho, H-tamanho, W-tamanho}</span><span class="sxs-lookup"><span data-stu-id="cb5cb-247">**DML_BUFFER_TENSOR_DESC::Sizes** = { N-size, C-size, D-size, H-size, W-size }</span></span>
- <span data-ttu-id="cb5cb-248">**DML_BUFFER_TENSOR_DESC:: prerides** = {N-Stride, C-Stride, D-Stride, H-Stride, W-Stride}</span><span class="sxs-lookup"><span data-stu-id="cb5cb-248">**DML_BUFFER_TENSOR_DESC::Strides** = { N-stride, C-stride, D-stride, H-stride, W-stride }</span></span>

<span data-ttu-id="cb5cb-249">Se um operador DirectML exigir um 4D ou um tensor de 5D, mas os dados reais tiverem uma classificação menor (por exemplo, 2D), as dimensões principais deverão ser preenchidas com 1s.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-249">If a DirectML operator requires a 4D or a 5D tensor, but the actual data has a smaller rank (for example, 2D), then the leading dimensions should be filled with 1s.</span></span> <span data-ttu-id="cb5cb-250">Por exemplo, um tensor de "HW" é definido usando **DML_BUFFER_TENSOR_DESC:: sizes** = {1, 1, H, W}.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-250">For example, an "HW" tensor is set using **DML_BUFFER_TENSOR_DESC::Sizes** = { 1, 1, H, W }.</span></span>

<span data-ttu-id="cb5cb-251">Se os dados do tensor forem armazenados em NCHW/NCDHW, não será necessário definir **DML_BUFFER_TENSOR_DESC:: Rides**, a menos que você queira difusão ou preenchimento.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-251">If tensor data is stored in NCHW/NCDHW, then it's not necessary to set **DML_BUFFER_TENSOR_DESC::Strides**, unless you want broadcasting or padding.</span></span> <span data-ttu-id="cb5cb-252">Você pode definir o campo de passos como `nullptr` .</span><span class="sxs-lookup"><span data-stu-id="cb5cb-252">You can set the strides field to `nullptr`.</span></span> <span data-ttu-id="cb5cb-253">No entanto, se os dados de tensor forem armazenados em outro layout, como NHWC, você precisará de sobrerides para expressar a transformação de NCHW para esse layout.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-253">However, if the tensor data is stored in another layout, such as NHWC, then you need strides in order to express the transformation from NCHW to that layout.</span></span>

<span data-ttu-id="cb5cb-254">Para obter um exemplo simples, considere a descrição de um tensor 2D com a altura 3 e a largura 5.</span><span class="sxs-lookup"><span data-stu-id="cb5cb-254">For a simple example, consider the description of a 2D tensor with height 3 and width 5.</span></span>

<span data-ttu-id="cb5cb-255">**NCHW empacotados (sobrerides implícitos)**</span><span class="sxs-lookup"><span data-stu-id="cb5cb-255">**Packed NCHW (implicit strides)**</span></span>
- <span data-ttu-id="cb5cb-256">**DML_BUFFER_TENSOR_DESC:: sizes** = {1, 1, 3, 5}</span><span class="sxs-lookup"><span data-stu-id="cb5cb-256">**DML_BUFFER_TENSOR_DESC::Sizes** = { 1, 1, 3, 5 }</span></span>
- <span data-ttu-id="cb5cb-257">**DML_BUFFER_TENSOR_DESC:: progressos** = `nullptr`</span><span class="sxs-lookup"><span data-stu-id="cb5cb-257">**DML_BUFFER_TENSOR_DESC::Strides** = `nullptr`</span></span>

<span data-ttu-id="cb5cb-258">**NCHW empacotados (transrides explícitos)**</span><span class="sxs-lookup"><span data-stu-id="cb5cb-258">**Packed NCHW (explicit strides)**</span></span>
- <span data-ttu-id="cb5cb-259">N-Stride = C-tamanho \* H-tamanho \* W-tamanho = 1 \* 3 \* 5 = 15</span><span class="sxs-lookup"><span data-stu-id="cb5cb-259">N-stride = C-size \* H-size \* W-size = 1 \* 3 \* 5 = 15</span></span>
- <span data-ttu-id="cb5cb-260">C-Stride = H-tamanho \* W-tamanho = 3 \* 5 = 15</span><span class="sxs-lookup"><span data-stu-id="cb5cb-260">C-stride = H-size \* W-size = 3 \* 5 = 15</span></span>
- <span data-ttu-id="cb5cb-261">H-Stride = W-tamanho = 5</span><span class="sxs-lookup"><span data-stu-id="cb5cb-261">H-stride = W-size = 5</span></span>
- <span data-ttu-id="cb5cb-262">W-Stride = 1</span><span class="sxs-lookup"><span data-stu-id="cb5cb-262">W-stride = 1</span></span>
- <span data-ttu-id="cb5cb-263">**DML_BUFFER_TENSOR_DESC:: sizes** = {1, 1, 3, 5}</span><span class="sxs-lookup"><span data-stu-id="cb5cb-263">**DML_BUFFER_TENSOR_DESC::Sizes** = { 1, 1, 3, 5 }</span></span>
- <span data-ttu-id="cb5cb-264">**DML_BUFFER_TENSOR_DESC:: prerides** = {15, 15, 5, 1}</span><span class="sxs-lookup"><span data-stu-id="cb5cb-264">**DML_BUFFER_TENSOR_DESC::Strides** = { 15, 15, 5, 1 }</span></span>

<span data-ttu-id="cb5cb-265">**NHWC empacotados**</span><span class="sxs-lookup"><span data-stu-id="cb5cb-265">**Packed NHWC**</span></span>
- <span data-ttu-id="cb5cb-266">N-Stride = H-tamanho \* W-tamanho \* C-tamanho = 3 \* 5 \* 1 = 15</span><span class="sxs-lookup"><span data-stu-id="cb5cb-266">N-stride = H-size \* W-size \* C-size = 3 \* 5 \* 1 = 15</span></span>
- <span data-ttu-id="cb5cb-267">H-Stride = W-tamanho \* C-size = 5 \* 1 = 5</span><span class="sxs-lookup"><span data-stu-id="cb5cb-267">H-stride = W-size \* C-size = 5 \* 1 = 5</span></span>
- <span data-ttu-id="cb5cb-268">W-Stride = C-size = 1</span><span class="sxs-lookup"><span data-stu-id="cb5cb-268">W-stride = C-size = 1</span></span>
- <span data-ttu-id="cb5cb-269">C-Stride = 1</span><span class="sxs-lookup"><span data-stu-id="cb5cb-269">C-stride = 1</span></span>
- <span data-ttu-id="cb5cb-270">**DML_BUFFER_TENSOR_DESC:: sizes** = {1, 1, 3, 5}</span><span class="sxs-lookup"><span data-stu-id="cb5cb-270">**DML_BUFFER_TENSOR_DESC::Sizes** = { 1, 1, 3, 5 }</span></span>
- <span data-ttu-id="cb5cb-271">**DML_BUFFER_TENSOR_DESC:: prerides** = {15, 1, 5, 1}</span><span class="sxs-lookup"><span data-stu-id="cb5cb-271">**DML_BUFFER_TENSOR_DESC::Strides** = { 15, 1, 5, 1 }</span></span>

## <a name="see-also"></a><span data-ttu-id="cb5cb-272">Confira também</span><span class="sxs-lookup"><span data-stu-id="cb5cb-272">See also</span></span>

* [<span data-ttu-id="cb5cb-273">Funções auxiliares DirectML</span><span class="sxs-lookup"><span data-stu-id="cb5cb-273">DirectML helper functions</span></span>](dml-helper-functions.md)
* [<span data-ttu-id="cb5cb-274">Estrutura de DML_BUFFER_TENSOR_DESC</span><span class="sxs-lookup"><span data-stu-id="cb5cb-274">DML_BUFFER_TENSOR_DESC structure</span></span>](/windows/desktop/api/directml/ns-directml-dml_buffer_tensor_desc)
