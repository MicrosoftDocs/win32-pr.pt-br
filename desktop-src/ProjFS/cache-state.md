---
title: Estado do cache na raiz de virtualização
description: Descreve os diferentes Estados de cache que um arquivo ou diretório gerenciado pelo provedor pode ter.
ms.assetid: <GUID-GOES-HERE>
ms.date: 01/17/2020
ms.topic: article
ms.openlocfilehash: 43d62ceb1f5ef5bf07000666f336077270b1e86a
ms.sourcegitcommit: 62e758931c610782807c7c9fad284921a6c56232
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/22/2020
ms.locfileid: "104365422"
---
# <a name="cache-state-in-the-virtualization-root"></a><span data-ttu-id="5e12c-103">Estado do cache na raiz de virtualização</span><span class="sxs-lookup"><span data-stu-id="5e12c-103">Cache State In the Virtualization Root</span></span>

<span data-ttu-id="5e12c-104">O provedor usa o sistema de arquivos local na raiz de virtualização como um cache dos itens que ele gerencia.</span><span class="sxs-lookup"><span data-stu-id="5e12c-104">The provider uses the local file system under the virtualization root as a cache of the items that it manages.</span></span>  <span data-ttu-id="5e12c-105">Um item (arquivo ou diretório) pode estar em um dos seis Estados no sistema de arquivos local:</span><span class="sxs-lookup"><span data-stu-id="5e12c-105">An item (file or directory) can be in one of six states on the local file system:</span></span>

* <span data-ttu-id="5e12c-106">Máquina</span><span class="sxs-lookup"><span data-stu-id="5e12c-106">Virtual</span></span>

  <span data-ttu-id="5e12c-107">O item não existe localmente no disco.</span><span class="sxs-lookup"><span data-stu-id="5e12c-107">The item does not exist locally on disk.</span></span>  <span data-ttu-id="5e12c-108">Ele é projetado, ou seja, sintetizado, durante as enumerações de seu diretório pai.</span><span class="sxs-lookup"><span data-stu-id="5e12c-108">It is projected, i.e. synthesized, during enumerations of its parent directory.</span></span>  <span data-ttu-id="5e12c-109">Os itens virtuais são mesclados com os itens que podem existir no disco para apresentar o conteúdo completo do diretório pai.</span><span class="sxs-lookup"><span data-stu-id="5e12c-109">Virtual items are merged with any items that may exist on disk to present the full contents of the parent directory.</span></span>

* <span data-ttu-id="5e12c-110">Espaço reservado</span><span class="sxs-lookup"><span data-stu-id="5e12c-110">Placeholder</span></span>

  <span data-ttu-id="5e12c-111">Para arquivos: o conteúdo do arquivo (fluxo de dados primário) não está presente no disco.</span><span class="sxs-lookup"><span data-stu-id="5e12c-111">For files: The file's content (primary data stream) is not present on the disk.</span></span>  <span data-ttu-id="5e12c-112">Os metadados do arquivo (nome, tamanho, carimbos de data/hora, atributos, etc.) são armazenados em cache no disco.</span><span class="sxs-lookup"><span data-stu-id="5e12c-112">The file’s metadata (name, size, timestamps, attributes, etc.) is cached on the disk.</span></span>
  
  <span data-ttu-id="5e12c-113">Para diretórios: alguns ou todos os descendentes imediatos do diretório (os arquivos e diretórios no diretório) não estão presentes no disco, ou seja, eles ainda são virtuais.</span><span class="sxs-lookup"><span data-stu-id="5e12c-113">For directories: Some or all of the directory’s immediate descendants (the files and directories in the directory) are not present on the disk, i.e. they are still virtual.</span></span>  <span data-ttu-id="5e12c-114">Os metadados do diretório (nome, carimbos de data/hora, atributos, etc.) são armazenados em cache no disco.</span><span class="sxs-lookup"><span data-stu-id="5e12c-114">The directory’s metadata (name, timestamps, attributes, etc.) is cached on the disk.</span></span>

* <span data-ttu-id="5e12c-115">Espaço reservado para alimentador</span><span class="sxs-lookup"><span data-stu-id="5e12c-115">Hydrated placeholder</span></span>

  <span data-ttu-id="5e12c-116">Para arquivos: o conteúdo e os metadados do arquivo foram armazenados em cache no disco.</span><span class="sxs-lookup"><span data-stu-id="5e12c-116">For files: The file’s content and metadata have been cached to the disk.</span></span>  <span data-ttu-id="5e12c-117">Também conhecido como um "arquivo parcial".</span><span class="sxs-lookup"><span data-stu-id="5e12c-117">Also referred to as a "partial file".</span></span>
  
  <span data-ttu-id="5e12c-118">Para diretórios: um diretório que foi criado no disco como um espaço reservado nunca se torna um diretório de espaço reservado alimentado.</span><span class="sxs-lookup"><span data-stu-id="5e12c-118">For directories: A directory that was created on disk as a placeholder never becomes a hydrated placeholder directory.</span></span>  <span data-ttu-id="5e12c-119">Isso permite que o provedor adicione ou remova itens do diretório em seu repositório de backup e que essas alterações sejam refletidas no cache local.</span><span class="sxs-lookup"><span data-stu-id="5e12c-119">This allows the provider to add or remove items from the directory in its backing store and have those changes be reflected in the local cache.</span></span>

* <span data-ttu-id="5e12c-120">Espaço reservado sujo (alimentado ou não)</span><span class="sxs-lookup"><span data-stu-id="5e12c-120">Dirty placeholder (hydrated or not)</span></span>

  <span data-ttu-id="5e12c-121">Os metadados do item foram modificados localmente e não são mais um cache de seu estado no repositório do provedor.</span><span class="sxs-lookup"><span data-stu-id="5e12c-121">The item's metadata has been locally modified and is no longer a cache of its state in the provider's store.</span></span> <span data-ttu-id="5e12c-122">Observe que a criação ou exclusão de um arquivo ou diretório em um diretório de espaço reservado faz com que o diretório de espaço reservado fique sujo.</span><span class="sxs-lookup"><span data-stu-id="5e12c-122">Note that creating or deleting a file or directory under a placeholder directory causes that placeholder directory to become dirty.</span></span>

* <span data-ttu-id="5e12c-123">Arquivo/diretório completo</span><span class="sxs-lookup"><span data-stu-id="5e12c-123">Full file/directory</span></span>

  <span data-ttu-id="5e12c-124">Para arquivos: o conteúdo do arquivo (fluxo de dados primário) foi modificado.</span><span class="sxs-lookup"><span data-stu-id="5e12c-124">For files: The file's content (primary data stream) has been modified.</span></span>  <span data-ttu-id="5e12c-125">O arquivo não é mais um cache de seu estado no repositório do provedor.</span><span class="sxs-lookup"><span data-stu-id="5e12c-125">The file is no longer a cache of its state in the provider's store.</span></span>  <span data-ttu-id="5e12c-126">Os arquivos que foram criados no sistema de arquivos local (ou seja, que não existem no repositório do provedor) também são considerados arquivos completos.</span><span class="sxs-lookup"><span data-stu-id="5e12c-126">Files that have been created on the local file system (i.e. that do not exist in the provider's store at all) are also considered to be full files.</span></span>
  
  <span data-ttu-id="5e12c-127">Para diretórios: diretórios que foram criados no sistema de arquivos local (ou seja, que não existem no repositório do provedor) são considerados diretórios completos.</span><span class="sxs-lookup"><span data-stu-id="5e12c-127">For directories: Directories that have been created on the local file system (i.e. that do not exist in the provider's store at all) are considered to be full directories.</span></span>  <span data-ttu-id="5e12c-128">Um diretório que foi criado no disco como um espaço reservado nunca se torna um diretório completo.</span><span class="sxs-lookup"><span data-stu-id="5e12c-128">A directory that was created on disk as a placeholder never becomes a full directory.</span></span>
  
* <span data-ttu-id="5e12c-129">Marca para exclusão</span><span class="sxs-lookup"><span data-stu-id="5e12c-129">Tombstone</span></span>

  <span data-ttu-id="5e12c-130">Um espaço reservado especial oculto que representa um item que foi excluído do sistema de arquivos local.</span><span class="sxs-lookup"><span data-stu-id="5e12c-130">A special hidden placeholder that represents an item that has been deleted from the local file system.</span></span>  <span data-ttu-id="5e12c-131">Quando um diretório é enumerado, o ProjFS mescla o conjunto de itens locais (espaços reservados, arquivos completos, etc.) com o conjunto de itens de projeto virtual.</span><span class="sxs-lookup"><span data-stu-id="5e12c-131">When a directory is enumerated ProjFS merges the set of local items (placeholders, full files, etc.) with the set of virtual projected items.</span></span>  <span data-ttu-id="5e12c-132">Se um item aparecer nos conjuntos local e projetado, o item local terá precedência.</span><span class="sxs-lookup"><span data-stu-id="5e12c-132">If an item appears in both the local and projected sets, the local item takes precedence.</span></span>  <span data-ttu-id="5e12c-133">Se um arquivo não existir no sistema de arquivos local, não haverá nenhum estado local, portanto, ele apareceria na enumeração.</span><span class="sxs-lookup"><span data-stu-id="5e12c-133">If a file does not exist in the local file system there is no local state, so it would appear in the enumeration.</span></span>  <span data-ttu-id="5e12c-134">No entanto, se esse item tivesse sido excluído, tê-lo exibido na enumeração seria inesperado.</span><span class="sxs-lookup"><span data-stu-id="5e12c-134">However if that item had been deleted, having it appear in the enumeration would be unexpected.</span></span>  <span data-ttu-id="5e12c-135">Substituir um item excluído por uma marca para exclusão resulta nos seguintes efeitos:</span><span class="sxs-lookup"><span data-stu-id="5e12c-135">Replacing a deleted item with a tombstone results in the following effects:</span></span>

  * <span data-ttu-id="5e12c-136">Enumerações não revelam o item.</span><span class="sxs-lookup"><span data-stu-id="5e12c-136">Enumerations to not reveal the item.</span></span>
  * <span data-ttu-id="5e12c-137">Abre o arquivo que espera que o item exista falha com, por exemplo, "arquivo não encontrado".</span><span class="sxs-lookup"><span data-stu-id="5e12c-137">File opens that expect the item to exist fail with e.g. "file not found".</span></span>
  * <span data-ttu-id="5e12c-138">O arquivo cria o que esperará ter sucesso apenas se o item não existir com sucesso; ProjFS remove a marca para exclusão como parte da operação.</span><span class="sxs-lookup"><span data-stu-id="5e12c-138">File creates that expect to succeed only if the item does not exist succeed; ProjFS removes the tombstone as part of the operation.</span></span>

<span data-ttu-id="5e12c-139">Para ilustrar os Estados acima, considere a seguinte sequência, dado um provedor de ProjFS que tem um único arquivo "foo.txt" localizado na raiz de virtualização C:\root.</span><span class="sxs-lookup"><span data-stu-id="5e12c-139">To illustrate the above states, consider the following sequence, given a ProjFS provider that has a single file "foo.txt" located in the virtualization root C:\root.</span></span>

1. <span data-ttu-id="5e12c-140">Um aplicativo enumera C:\root.</span><span class="sxs-lookup"><span data-stu-id="5e12c-140">An app enumerates C:\root.</span></span>  <span data-ttu-id="5e12c-141">Ele vê o arquivo virtual "foo.txt".</span><span class="sxs-lookup"><span data-stu-id="5e12c-141">It sees the virtual file "foo.txt".</span></span>  <span data-ttu-id="5e12c-142">Como o arquivo ainda não foi acessado, o arquivo não existe no disco.</span><span class="sxs-lookup"><span data-stu-id="5e12c-142">Since the file has not yet been accessed, the file does not exist on disk.</span></span>
1. <span data-ttu-id="5e12c-143">O aplicativo abre um identificador para C:\root\foo.txt.</span><span class="sxs-lookup"><span data-stu-id="5e12c-143">The app opens a handle to C:\root\foo.txt.</span></span>  <span data-ttu-id="5e12c-144">ProjFS informa o provedor para criar um espaço reservado para ele.</span><span class="sxs-lookup"><span data-stu-id="5e12c-144">ProjFS tells the provider to create a placeholder for it.</span></span>
1. <span data-ttu-id="5e12c-145">O aplicativo lê o conteúdo do arquivo.</span><span class="sxs-lookup"><span data-stu-id="5e12c-145">The app reads the content of the file.</span></span>  <span data-ttu-id="5e12c-146">O provedor fornece o conteúdo do arquivo para ProjFS e é armazenado em cache para C:\root\foo.txt.</span><span class="sxs-lookup"><span data-stu-id="5e12c-146">The provider provides the file content to ProjFS and it is cached to C:\root\foo.txt.</span></span>  <span data-ttu-id="5e12c-147">O arquivo agora é um espaço reservado para o alimentador.</span><span class="sxs-lookup"><span data-stu-id="5e12c-147">The file is now a hydrated placeholder.</span></span>
1. <span data-ttu-id="5e12c-148">O aplicativo atualiza o carimbo de data/hora da última modificação.</span><span class="sxs-lookup"><span data-stu-id="5e12c-148">The app updates the Last Modified timestamp.</span></span>  <span data-ttu-id="5e12c-149">O arquivo agora é um espaço reservado com problemas.</span><span class="sxs-lookup"><span data-stu-id="5e12c-149">The file is now a dirty hydrated placeholder.</span></span>
1. <span data-ttu-id="5e12c-150">O aplicativo abre um identificador para acesso de gravação ao arquivo.</span><span class="sxs-lookup"><span data-stu-id="5e12c-150">The app opens a handle for write access to the file.</span></span>  <span data-ttu-id="5e12c-151">C:\root\foo.txt agora é um arquivo completo.</span><span class="sxs-lookup"><span data-stu-id="5e12c-151">C:\root\foo.txt is now a full file.</span></span>
1. <span data-ttu-id="5e12c-152">O aplicativo exclui C:\root\foo.txt.</span><span class="sxs-lookup"><span data-stu-id="5e12c-152">The app deletes C:\root\foo.txt.</span></span>  <span data-ttu-id="5e12c-153">ProjFS substitui o arquivo por uma marca para exclusão.</span><span class="sxs-lookup"><span data-stu-id="5e12c-153">ProjFS replaces the file with a tombstone.</span></span>  <span data-ttu-id="5e12c-154">Agora, quando o aplicativo enumera C:\root, ele não vê foo.txt.</span><span class="sxs-lookup"><span data-stu-id="5e12c-154">Now when the app enumerates C:\root it does not see foo.txt.</span></span>  <span data-ttu-id="5e12c-155">Se ele tentar abrir o arquivo, a abertura falhará com ERROR_FILE_NOT_FOUND.</span><span class="sxs-lookup"><span data-stu-id="5e12c-155">If it tries to open the file, the open fails with ERROR_FILE_NOT_FOUND.</span></span>
