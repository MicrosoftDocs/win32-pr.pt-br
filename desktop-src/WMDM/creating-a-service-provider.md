---
title: Criando um provedor de serviços
description: Criando um provedor de serviços
ms.assetid: 7da27fe2-8a57-4adb-94b2-448b6362dc33
keywords:
- Windows Media Gerenciador de Dispositivos, criando provedores de serviços
- Gerenciador de Dispositivos, criando provedores de serviços
- Windows Media Gerenciador de Dispositivos, guia de programação
- Gerenciador de Dispositivos, guia de programação
- Guia de programação, provedores de serviços
- Guia de programação, Windows Media Gerenciador de Dispositivos
- Guia de programação, criando provedores de serviços
- Windows Media Gerenciador de Dispositivos, provedores de serviços
- Gerenciador de Dispositivos, provedores de serviços
- provedores de serviços, criando
- criando provedores de serviços, sobre
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8469c3d656d151457ed818ea6b4192a3c79ed061
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/20/2020
ms.locfileid: "105763750"
---
# <a name="creating-a-service-provider"></a><span data-ttu-id="62214-114">Criando um provedor de serviços</span><span class="sxs-lookup"><span data-stu-id="62214-114">Creating a Service Provider</span></span>

<span data-ttu-id="62214-115">Um provedor de serviços é um componente que serve como um meio entre um aplicativo e um dispositivo.</span><span class="sxs-lookup"><span data-stu-id="62214-115">A service provider is component that serves as a middleman between an application and a device.</span></span> <span data-ttu-id="62214-116">O Windows Media Gerenciador de Dispositivos roteia as solicitações do aplicativo para o provedor de serviços, que é então responsável pela comunicação com o dispositivo ou pela execução da ação solicitada.</span><span class="sxs-lookup"><span data-stu-id="62214-116">Windows Media Device Manager routes requests from the application to the service provider, which is then responsible for communicating with the device or performing the requested action.</span></span> <span data-ttu-id="62214-117">Um provedor de serviços geralmente se comunica com um driver para habilitar a comunicação com o dispositivo.</span><span class="sxs-lookup"><span data-stu-id="62214-117">A service provider usually communicates with a driver to enable communication with the device.</span></span> <span data-ttu-id="62214-118">Um provedor de serviços é um componente COM que implementa as interfaces chamadas pelo Windows Media Gerenciador de Dispositivos.</span><span class="sxs-lookup"><span data-stu-id="62214-118">A service provider is a COM component that implements the interfaces called by Windows Media Device Manager.</span></span> <span data-ttu-id="62214-119">A interface raiz do objeto do provedor de serviços é [**IMDServiceProvider**](/windows/desktop/api/mswmdm/nn-mswmdm-imdserviceprovider).</span><span class="sxs-lookup"><span data-stu-id="62214-119">The root interface of the service provider object is [**IMDServiceProvider**](/windows/desktop/api/mswmdm/nn-mswmdm-imdserviceprovider).</span></span> <span data-ttu-id="62214-120">Depois de obter essa interface, o Windows Media Gerenciador de Dispositivos pode obter outras interfaces por meio da implementação do provedor de serviços de vários métodos.</span><span class="sxs-lookup"><span data-stu-id="62214-120">After obtaining this interface, Windows Media Device Manager can obtain other interfaces through the service provider's implementation of various methods.</span></span> <span data-ttu-id="62214-121">As interfaces que um provedor de serviços deve implementar estão listadas em [interfaces obrigatórias e opcionais](mandatory-and-optional-interfaces.md).</span><span class="sxs-lookup"><span data-stu-id="62214-121">The interfaces that a service provider must implement are listed in [Mandatory and Optional Interfaces](mandatory-and-optional-interfaces.md).</span></span> <span data-ttu-id="62214-122">A hierarquia de interfaces é mostrada em [interfaces para provedores de serviços](interfaces-for-service-providers.md).</span><span class="sxs-lookup"><span data-stu-id="62214-122">The hierarchy of interfaces is shown in [Interfaces for Service Providers](interfaces-for-service-providers.md).</span></span>

> [!Note]  
> <span data-ttu-id="62214-123">Você não deve tentar criar um provedor de serviços MTP; em vez disso, você deve usar o provedor de serviços MTP e os drivers fornecidos pela Microsoft.</span><span class="sxs-lookup"><span data-stu-id="62214-123">You should not try to create an MTP service provider; instead, you should use the MTP service provider and drivers provided by Microsoft.</span></span>

 

<span data-ttu-id="62214-124">Antes de tentar criar um provedor de serviços, você deve compreender totalmente as chamadas que um aplicativo fará em um provedor de serviços.</span><span class="sxs-lookup"><span data-stu-id="62214-124">Before trying to create a service provider, you should thoroughly understand what calls an application will make on a service provider.</span></span> <span data-ttu-id="62214-125">Leia [criando um aplicativo de Gerenciador de dispositivos de mídia do Windows](creating-a-windows-media-device-manager-application.md) para ter uma ideia das tarefas básicas e chamadas que um aplicativo fará em um provedor de serviços quando ele estiver tentando se comunicar com um dispositivo.</span><span class="sxs-lookup"><span data-stu-id="62214-125">Read [Creating a Windows Media Device Manager Application](creating-a-windows-media-device-manager-application.md) to get some idea of the basic tasks and calls that an application will make on a service provider when it is attempting to communicate with a device.</span></span>

<span data-ttu-id="62214-126">A lista a seguir mostra as principais etapas do desenvolvimento de um provedor de serviços:</span><span class="sxs-lookup"><span data-stu-id="62214-126">The following list shows the key steps in developing a service provider:</span></span>

1.  <span data-ttu-id="62214-127">Inclua (e, opcionalmente, compile) o cabeçalho e os arquivos de biblioteca necessários para seu projeto.</span><span class="sxs-lookup"><span data-stu-id="62214-127">Include (and optionally compile) the required header and library files for your project.</span></span> <span data-ttu-id="62214-128">Consulte [bibliotecas e cabeçalhos necessários para um provedor de serviços](required-libraries-and-headers-for-a-service-provider.md) para obter a lista de arquivos necessários.</span><span class="sxs-lookup"><span data-stu-id="62214-128">See [Required Libraries and Headers for a Service Provider](required-libraries-and-headers-for-a-service-provider.md) for the list of required files.</span></span>
2.  <span data-ttu-id="62214-129">Implemente todas as outras interfaces de provedor de serviços necessárias ou opcionais (consulte [interfaces obrigatórias e opcionais](mandatory-and-optional-interfaces.md)).</span><span class="sxs-lookup"><span data-stu-id="62214-129">Implement all the other required or optional service provider interfaces (see [Mandatory and Optional Interfaces](mandatory-and-optional-interfaces.md)).</span></span> <span data-ttu-id="62214-130">Normalmente, as interfaces serão chamadas nesta ordem:</span><span class="sxs-lookup"><span data-stu-id="62214-130">Typically, interfaces will be called in this order:</span></span>
    -   [<span data-ttu-id="62214-131">**IComponentAuthenticate**</span><span class="sxs-lookup"><span data-stu-id="62214-131">**IComponentAuthenticate**</span></span>](/windows/desktop/api/mswmdm/nn-mswmdm-icomponentauthenticate)
    -   <span data-ttu-id="62214-132">[**IMDServiceProvider**](/windows/desktop/api/mswmdm/nn-mswmdm-imdserviceprovider)/2</span><span class="sxs-lookup"><span data-stu-id="62214-132">[**IMDServiceProvider**](/windows/desktop/api/mswmdm/nn-mswmdm-imdserviceprovider)/2</span></span>
    -   [<span data-ttu-id="62214-133">**IMDSPEnumDevice**</span><span class="sxs-lookup"><span data-stu-id="62214-133">**IMDSPEnumDevice**</span></span>](/windows/desktop/api/mswmdm/nn-mswmdm-imdspenumdevice)
    -   <span data-ttu-id="62214-134">[**IMDSPDevice**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspdevice)/2</span><span class="sxs-lookup"><span data-stu-id="62214-134">[**IMDSPDevice**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspdevice)/2</span></span>
    -   [<span data-ttu-id="62214-135">**IMDSPEnumStorage**</span><span class="sxs-lookup"><span data-stu-id="62214-135">**IMDSPEnumStorage**</span></span>](/windows/desktop/api/mswmdm/nn-mswmdm-imdspenumstorage)
    -   <span data-ttu-id="62214-136">[**IMDSPStorage**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspstorage)/2/3</span><span class="sxs-lookup"><span data-stu-id="62214-136">[**IMDSPStorage**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspstorage)/2/3</span></span>
3.  <span data-ttu-id="62214-137">Verifique se o seu provedor de serviços ou dispositivo instala as chaves de registro apropriadas durante a instalação.</span><span class="sxs-lookup"><span data-stu-id="62214-137">Be sure your service provider or device installs the proper registry keys during installation.</span></span> <span data-ttu-id="62214-138">Essas chaves especificam os parâmetros do dispositivo, registram o provedor de serviços como um plug-in e habilitam notificações de Plug and Play para a chegada e a remoção do dispositivo.</span><span class="sxs-lookup"><span data-stu-id="62214-138">These keys specify device parameters, register the service provider as a plug-in, and enable Plug and Play notifications for device arrival and removal.</span></span> <span data-ttu-id="62214-139">Consulte [parâmetros do dispositivo](device-parameters.md), [registrando o provedor de serviços](registering-the-service-provider.md)e [habilitando o PNP para dispositivos](enabling-pnp-for-devices.md).</span><span class="sxs-lookup"><span data-stu-id="62214-139">See [Device Parameters](device-parameters.md), [Registering the Service Provider](registering-the-service-provider.md), and [Enabling PnP for Devices](enabling-pnp-for-devices.md).</span></span>
4.  <span data-ttu-id="62214-140">Na instanciação da sua classe, autentique o provedor de serviços no construtor.</span><span class="sxs-lookup"><span data-stu-id="62214-140">On instantiation of your class, authenticate the service provider in the constructor.</span></span> <span data-ttu-id="62214-141">Para fazer isso, crie uma classe [CSecureChannelServer](csecurechannelserver-class.md) e defina o certificado.</span><span class="sxs-lookup"><span data-stu-id="62214-141">To do this, create a [CSecureChannelServer](csecurechannelserver-class.md) class and set the certificate.</span></span> <span data-ttu-id="62214-142">Implemente a interface [**IComponentAuthenticate**](/windows/desktop/api/mswmdm/nn-mswmdm-icomponentauthenticate) e chame os métodos da classe CSecureChannelServer instanciada anteriormente.</span><span class="sxs-lookup"><span data-stu-id="62214-142">Implement the [**IComponentAuthenticate**](/windows/desktop/api/mswmdm/nn-mswmdm-icomponentauthenticate) interface and call the methods of the CSecureChannelServer class instantiated previously.</span></span> <span data-ttu-id="62214-143">Consulte [Autenticando o provedor de serviços](authenticating-the-service-provider.md) para saber como criar uma instância da classe CSecureChannelServer e implementar os métodos IComponentAuthenticate.</span><span class="sxs-lookup"><span data-stu-id="62214-143">See [Authenticating the Service Provider](authenticating-the-service-provider.md) to learn how to instantiate the CSecureChannelServer class and implement the IComponentAuthenticate methods.</span></span>
5.  <span data-ttu-id="62214-144">O Windows Media Gerenciador de Dispositivos consultará seu provedor de serviços para obter uma lista de dispositivos conectados chamando [**IMDServiceProvider2:: CreateDevice**](/windows/desktop/api/mswmdm/nf-mswmdm-imdserviceprovider2-createdevice) ou [**IMDServiceProvider:: EnumDevices**](/windows/desktop/api/mswmdm/nf-mswmdm-imdserviceprovider-enumdevices), dependendo se o provedor de serviços lida com plug and Play dispositivos.</span><span class="sxs-lookup"><span data-stu-id="62214-144">Windows Media Device Manager will query your service provider for a list of connected devices by calling [**IMDServiceProvider2::CreateDevice**](/windows/desktop/api/mswmdm/nf-mswmdm-imdserviceprovider2-createdevice) or [**IMDServiceProvider::EnumDevices**](/windows/desktop/api/mswmdm/nf-mswmdm-imdserviceprovider-enumdevices), depending on whether the service provider handles Plug and Play devices.</span></span> <span data-ttu-id="62214-145">O provedor de serviços deve retornar uma lista de objetos [**IMDSPDevice**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspdevice) que representam os dispositivos conectados.</span><span class="sxs-lookup"><span data-stu-id="62214-145">The service provider must return a list of [**IMDSPDevice**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspdevice) objects representing connected devices.</span></span> <span data-ttu-id="62214-146">Consulte [enumerando dispositivos](enumerating-devices-service-provider.md) para obter mais detalhes.</span><span class="sxs-lookup"><span data-stu-id="62214-146">See [Enumerating Devices](enumerating-devices-service-provider.md) for more details.</span></span>
6.  <span data-ttu-id="62214-147">Antes de tratar qualquer chamada, verifique se um canal seguro foi estabelecido.</span><span class="sxs-lookup"><span data-stu-id="62214-147">Before handling any call, verify that a secure channel has been established.</span></span> <span data-ttu-id="62214-148">Chame [**CSecureChannelServer:: fIsAuthenticated**](/previous-versions/bb231600(v=vs.85)) antes de executar qualquer ação.</span><span class="sxs-lookup"><span data-stu-id="62214-148">Call [**CSecureChannelServer::fIsAuthenticated**](/previous-versions/bb231600(v=vs.85)) before performing any actions.</span></span> <span data-ttu-id="62214-149">Se essa chamada falhar, retornar WMDM \_ E não \_ certificado.</span><span class="sxs-lookup"><span data-stu-id="62214-149">If this call fails, return WMDM\_E\_NOTCERTIFIED.</span></span>
7.  <span data-ttu-id="62214-150">Você precisará de um par de certificados/chaves emitido pela Microsoft para poder lidar com materiais protegidos por DRM.</span><span class="sxs-lookup"><span data-stu-id="62214-150">You will need a certificate/key pair issued by Microsoft to be able to handle DRM-protected material.</span></span> <span data-ttu-id="62214-151">Consulte [lidando com conteúdo protegido no provedor de serviços](handling-protected-content-in-the-service-provider.md) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="62214-151">See [Handling Protected Content in the Service Provider](handling-protected-content-in-the-service-provider.md) for more information.</span></span>
8.  <span data-ttu-id="62214-152">Para permitir que seu dispositivo seja sincronizado automaticamente com o Windows Media Player, ele deve atender aos requisitos listados em [habilitando a sincronização com o Windows Media Player](enabling-synchronization-with-windows-media-player.md).</span><span class="sxs-lookup"><span data-stu-id="62214-152">To enable your device to synchronize automatically with Windows Media Player, it must fulfill the requirements listed in [Enabling Synchronization with Windows Media Player](enabling-synchronization-with-windows-media-player.md).</span></span>
9.  <span data-ttu-id="62214-153">Para permitir que o dispositivo apareça no Windows Explorer, você deve executar algumas etapas especiais, detalhadas em [requisitos para que players de áudio portáteis apareçam no Windows Explorer](requirements-for-portable-audio-players-to-appear-in-windows-explorer.md).</span><span class="sxs-lookup"><span data-stu-id="62214-153">To enable your device to appear in Windows Explorer, you must take a few special steps, detailed in [Requirements for Portable Audio Players to Appear in Windows Explorer](requirements-for-portable-audio-players-to-appear-in-windows-explorer.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="62214-154">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="62214-154">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="62214-155">**Guia de programação**</span><span class="sxs-lookup"><span data-stu-id="62214-155">**Programming Guide**</span></span>](programming-guide.md)
</dt> </dl>

 

 