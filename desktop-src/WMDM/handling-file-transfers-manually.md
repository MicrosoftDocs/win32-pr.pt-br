---
title: Manipulando transferências de arquivos manualmente
description: Manipulando transferências de arquivos manualmente
ms.assetid: ff94191b-a0f2-4118-996c-d040f214fb9b
keywords:
- Windows Media Gerenciador de Dispositivos, transferências de arquivos manuais
- Gerenciador de Dispositivos, transferências de arquivos manuais
- Guia de programação, transferências de arquivos manuais
- aplicativos de área de trabalho, transferências de arquivos manuais
- Criando aplicativos de Gerenciador de Dispositivos de mídia do Windows, transferências de arquivos manuais
- transferências de arquivos manuais
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a2bf12404e8cd83b6f0c0e4f1c8ec8b0b7bda205
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/20/2020
ms.locfileid: "103641509"
---
# <a name="handling-file-transfers-manually"></a><span data-ttu-id="9c6f0-109">Manipulando transferências de arquivos manualmente</span><span class="sxs-lookup"><span data-stu-id="9c6f0-109">Handling File Transfers Manually</span></span>

<span data-ttu-id="9c6f0-110">Seu aplicativo pode implementar a interface [**IWMDMOperation**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmoperation) para gerenciar parte do processo de leitura ou gravação.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-110">Your application can implement the [**IWMDMOperation**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmoperation) interface to manage part of the reading or writing process.</span></span> <span data-ttu-id="9c6f0-111">Em uma leitura do dispositivo, a implementação permite que o aplicativo receba blocos de dados brutos de um arquivo de dispositivo.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-111">On a read from device, the implementation enables the application to receive blocks of raw data from a device file.</span></span> <span data-ttu-id="9c6f0-112">Em uma gravação no dispositivo, ele permite que o aplicativo envie blocos de dados brutos para um arquivo no dispositivo.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-112">On a write to device, it enables the application to send blocks of raw data to a file on the device.</span></span>

<span data-ttu-id="9c6f0-113">Em operações de leitura e gravação, o método [**IWMDMOperation:: TransferObjectData**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-transferobjectdata) passa os dados entre o computador e o dispositivo.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-113">In both read and write operations, the [**IWMDMOperation::TransferObjectData**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-transferobjectdata) method passes the data between the computer and the device.</span></span> <span data-ttu-id="9c6f0-114">Para saber a direção da transferência de dados, seu aplicativo deve definir um sinalizador quando o Windows Media Gerenciador de Dispositivos chama [**BeginRead**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginread) ou [**BeginWrite**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginwrite).</span><span class="sxs-lookup"><span data-stu-id="9c6f0-114">To know the direction of the data transfer, your application must set a flag when Windows Media Device Manager calls [**BeginRead**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginread) or [**BeginWrite**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginwrite).</span></span> <span data-ttu-id="9c6f0-115">Quando o método [**end**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-end) é chamado, o aplicativo deve redefinir esse sinalizador.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-115">When the [**End**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-end) method is called, the application should reset this flag.</span></span>

> [!Note]  
> <span data-ttu-id="9c6f0-116">Se o provedor de serviços e o dispositivo implementarem corretamente o [**IMDSPObject2**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspobject2), ele primeiro chamará o método [IWMDMOperation3:: TransferObjectDataOnClearChannel](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation3-transferobjectdataonclearchannel) do aplicativo, se implementado.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-116">If the service provider and device properly implement [**IMDSPObject2**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspobject2), it will first call the application's [IWMDMOperation3::TransferObjectDataOnClearChannel](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation3-transferobjectdataonclearchannel) method, if implemented.</span></span> <span data-ttu-id="9c6f0-117">Esse método é uma maneira mais eficiente de transferir dados.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-117">This method is a more efficient way of transferring data.</span></span> <span data-ttu-id="9c6f0-118">**TransferObjectDataOnClearChannel** é manipulado da mesma maneira que **TransferObjectData**, exceto que os dados nunca são criptografados e não têm valores Mac para verificar.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-118">**TransferObjectDataOnClearChannel** is handled the same way as **TransferObjectData**, except that the data is never encrypted and has no MAC values to verify.</span></span>

 

<span data-ttu-id="9c6f0-119">As seções a seguir descrevem o processo de leitura e de gravação, quando seu aplicativo implementa **IWMDMOperation**.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-119">The following sections describe both the reading and the writing process, when your application implements **IWMDMOperation**.</span></span>

<span data-ttu-id="9c6f0-120">**Lendo de um dispositivo**</span><span class="sxs-lookup"><span data-stu-id="9c6f0-120">**Reading from a device**</span></span>

<span data-ttu-id="9c6f0-121">Ao ler um arquivo de um dispositivo, o Windows Media Gerenciador de Dispositivos chama os seguintes métodos **IWMDMOperation** na ordem:</span><span class="sxs-lookup"><span data-stu-id="9c6f0-121">When reading a file from a device, Windows Media Device Manager calls the following **IWMDMOperation** methods in order:</span></span>

-   <span data-ttu-id="9c6f0-122">[**BeginRead**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginread) Chamado para notificar o aplicativo de que uma leitura do dispositivo está começando.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-122">[**BeginRead**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginread) Called to notify the application that a read from device is beginning.</span></span>
-   <span data-ttu-id="9c6f0-123">[**TransferObjectData**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-transferobjectdata) Chamado uma ou mais vezes.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-123">[**TransferObjectData**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-transferobjectdata) Called one or more times.</span></span> <span data-ttu-id="9c6f0-124">O processamento de dados é descrito nas etapas a seguir:</span><span class="sxs-lookup"><span data-stu-id="9c6f0-124">The processing of data is described in the following steps:</span></span>
    1.  <span data-ttu-id="9c6f0-125">O **TransferObjectData** recebe um buffer, *pData*, de tamanho *pdwSize* bytes, preenchidos com dados e um Mac para verificar os dados de entrada.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-125">**TransferObjectData** receives a buffer, *pData*, of size *pdwSize* bytes, filled with data, and a MAC to verify the incoming data.</span></span>
    2.  <span data-ttu-id="9c6f0-126">O aplicativo verifica os parâmetros de entrada com o MAC de entrada de dados.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-126">The application verifies the incoming parameters with the incoming data MAC.</span></span>
    3.  <span data-ttu-id="9c6f0-127">O aplicativo descriptografa e lê a maior parte dos dados no *pData* como ele pode e modifica o valor retornado de *pdwSize* para indicar quantos bytes foram realmente lidos.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-127">The application decrypts and reads as much of the data in *pData* as it can, and modifies the returned value of *pdwSize* to indicate how many bytes were actually read.</span></span>
    4.  <span data-ttu-id="9c6f0-128">O aplicativo descriptografa os dados usando [**CSecureChannelClient::D ecryptparam**](/previous-versions/bb231586(v=vs.85))e os armazena ou usa-os, conforme necessário.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-128">The application decrypts the data, using [**CSecureChannelClient::DecryptParam**](/previous-versions/bb231586(v=vs.85)), and stores it or uses it, as needed.</span></span>
    5.  <span data-ttu-id="9c6f0-129">**TransferObjectData** retorna S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-129">**TransferObjectData** returns S\_OK.</span></span>
    6.  <span data-ttu-id="9c6f0-130">O Windows Media Gerenciador de Dispositivos continua a chamar **TransferObjectData** até que o aplicativo Leia todos os dados do arquivo ou o aplicativo retorna o WMDM \_ E o \_ usuário \_ cancelado para cancelar a operação (nesse caso, a leitura é cancelada e o Windows Media Gerenciador de dispositivos chama **end**).</span><span class="sxs-lookup"><span data-stu-id="9c6f0-130">Windows Media Device Manager continues to call **TransferObjectData** until the application has read all the data from the file, or the application returns WMDM\_E\_USER\_CANCELLED to cancel the operation (in which case the read is canceled, and Windows Media Device Manager calls **End**).</span></span>
-   <span data-ttu-id="9c6f0-131">[**Fim**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-end) Chamado para notificar o aplicativo de que uma leitura do dispositivo está terminando.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-131">[**End**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-end) Called to notify the application that a read from device is ending.</span></span>

<span data-ttu-id="9c6f0-132">**Gravando em um dispositivo**</span><span class="sxs-lookup"><span data-stu-id="9c6f0-132">**Writing to a device**</span></span>

<span data-ttu-id="9c6f0-133">Ao gravar um arquivo no dispositivo, o Windows Media Gerenciador de Dispositivos chama os seguintes métodos **IWMDMOperation** na ordem:</span><span class="sxs-lookup"><span data-stu-id="9c6f0-133">When writing a file to the device, Windows Media Device Manager calls the following **IWMDMOperation** methods in order:</span></span>

-   <span data-ttu-id="9c6f0-134">[**Getobjectname**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-getobjectname) Chamado para permitir que o aplicativo especifique um nome para o novo armazenamento.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-134">[**GetObjectName**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-getobjectname) Called to allow the application to specify a name for the new storage.</span></span> <span data-ttu-id="9c6f0-135">Esse método só será chamado se o aplicativo não tiver especificado um nome no método **Insert** .</span><span class="sxs-lookup"><span data-stu-id="9c6f0-135">This method is only called if the application did not specify a name in the **Insert** method.</span></span>
-   <span data-ttu-id="9c6f0-136">[**Getobjectattributes**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-getobjectattributes) Chamado para permitir que o aplicativo especifique atributos para o novo armazenamento no dispositivo.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-136">[**GetObjectAttributes**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-getobjectattributes) Called to allow the application to specify attributes for the new storage on the device.</span></span>
-   <span data-ttu-id="9c6f0-137">[**BeginWrite**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginwrite) Chamado para notificar que uma gravação no dispositivo está começando.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-137">[**BeginWrite**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginwrite) Called to notify that that a write to device is beginning.</span></span>
-   <span data-ttu-id="9c6f0-138">[**GetObjectTotalSize**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-getobjecttotalsize) Chamado para recuperar o tamanho total do objeto que está sendo gravado no dispositivo, para habilitar a otimização da transferência e também para dar ao Windows Media Gerenciador de Dispositivos uma oportunidade de cancelar a transferência se o arquivo for muito grande para o dispositivo.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-138">[**GetObjectTotalSize**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-getobjecttotalsize) Called to retrieve the total size of the object being written to the device, to enable optimization of the transfer, and also to give Windows Media Device Manager an opportunity to cancel the transfer if the file is too large for the device.</span></span>
-   <span data-ttu-id="9c6f0-139">[**TransferObjectData**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-transferobjectdata) Chamado uma ou mais vezes.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-139">[**TransferObjectData**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-transferobjectdata) Called one or more times.</span></span> <span data-ttu-id="9c6f0-140">O processamento de dados é descrito nas etapas a seguir:</span><span class="sxs-lookup"><span data-stu-id="9c6f0-140">The processing of data is described in the following steps:</span></span>
    1.  <span data-ttu-id="9c6f0-141">**TransferObjectData** recebe um ponteiro para um buffer de tamanho *pdwSize* bytes.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-141">**TransferObjectData** receives a pointer to a buffer of size *pdwSize* bytes.</span></span>
    2.  <span data-ttu-id="9c6f0-142">O aplicativo obtém um bloco de dados para enviar para o dispositivo, normalmente lendo dados de um arquivo e preenche o buffer recebido com até *pdwSize* bytes.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-142">The application gets a block of data to send to the device, usually by reading data from a file, and fills the received buffer with up to *pdwSize* bytes.</span></span> <span data-ttu-id="9c6f0-143">Ele deve modificar *pdwSize* (se necessário) para refletir quantos bytes foram adicionados ao buffer.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-143">It should modify *pdwSize* (if necessary) to reflect how many bytes were added to the buffer.</span></span>
    3.  <span data-ttu-id="9c6f0-144">O aplicativo cria um MAC de todos os parâmetros do método.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-144">The application creates a MAC of all the method parameters.</span></span>
    4.  <span data-ttu-id="9c6f0-145">O aplicativo criptografa os dados no buffer, usando [**CSecureChannelClient:: EncryptParam**](/previous-versions/bb231587(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="9c6f0-145">The application encrypts the data in the buffer, using [**CSecureChannelClient::EncryptParam**](/previous-versions/bb231587(v=vs.85)).</span></span>
    5.  <span data-ttu-id="9c6f0-146">**TransferObjectData** retorna s \_ OK para indicar que há mais dados ou S \_ false para indicar que não há mais dados.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-146">**TransferObjectData** returns S\_OK to indicate that there is more data, or S\_FALSE to indicate that there is no more data.</span></span> <span data-ttu-id="9c6f0-147">Se o aplicativo retornar WMDM \_ e \_ usuário \_ cancelado, a operação de gravação será cancelada e o Windows Media Gerenciador de dispositivos chamará **end**.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-147">If the application returns WMDM\_E\_USER\_CANCELLED, the write operation is canceled and Windows Media Device Manager will call **End**.</span></span>
    6.  <span data-ttu-id="9c6f0-148">O Windows Media Gerenciador de Dispositivos continua a chamar **TransferObjectData** enquanto o aplicativo retorna S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-148">Windows Media Device Manager continues to call **TransferObjectData** as long as the application returns S\_OK.</span></span>
-   <span data-ttu-id="9c6f0-149">[**Fim**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-end) Chamado para notificar que uma gravação no dispositivo está terminando.</span><span class="sxs-lookup"><span data-stu-id="9c6f0-149">[**End**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-end) Called to notify that a write to device is ending.</span></span>

<span data-ttu-id="9c6f0-150">Para obter um exemplo de código, consulte [criptografia e descriptografia](encryption-and-decryption.md).</span><span class="sxs-lookup"><span data-stu-id="9c6f0-150">For a code example, see [Encryption and Decryption](encryption-and-decryption.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="9c6f0-151">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="9c6f0-151">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="9c6f0-152">**Criando um aplicativo de Gerenciador de Dispositivos de mídia do Windows**</span><span class="sxs-lookup"><span data-stu-id="9c6f0-152">**Creating a Windows Media Device Manager Application**</span></span>](creating-a-windows-media-device-manager-application.md)
</dt> </dl>

 

 