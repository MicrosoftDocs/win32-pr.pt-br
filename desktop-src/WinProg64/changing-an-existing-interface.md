---
title: Alterando uma interface existente
description: Sempre que possível, implemente uma nova interface para seu aplicativo, em vez de fazer alterações em uma existente.
ms.assetid: 29845cf5-445c-403d-b298-d4e07c3536b7
keywords:
- alterando as interfaces existentes programação de 64 bits do Windows
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 51a656ee768dcc2e88725d2cff0ddc5604fd771f
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/20/2020
ms.locfileid: "104499088"
---
# <a name="changing-an-existing-interface"></a><span data-ttu-id="ed946-104">Alterando uma interface existente</span><span class="sxs-lookup"><span data-stu-id="ed946-104">Changing an Existing Interface</span></span>

<span data-ttu-id="ed946-105">Sempre que possível, implemente uma nova interface para seu aplicativo, em vez de fazer alterações em uma existente.</span><span class="sxs-lookup"><span data-stu-id="ed946-105">Whenever possible, implement a new interface for your application, rather than making changes to an existing one.</span></span> <span data-ttu-id="ed946-106">Se não for possível evitar a alteração de uma interface existente, use novos tipos de dados somente em novos métodos.</span><span class="sxs-lookup"><span data-stu-id="ed946-106">If you cannot avoid changing an existing interface, use new data types in new methods only.</span></span> <span data-ttu-id="ed946-107">A introdução de um novo tipo de dados ou a modificação de um tipo existente é a fonte mais comum de problemas de incompatibilidade.</span><span class="sxs-lookup"><span data-stu-id="ed946-107">Introducing a new data type or modifying an existing type is the most common source of incompatibility problems.</span></span> <span data-ttu-id="ed946-108">O modelo de tempo de execução RPC pressupõe que o aplicativo de recebimento sabe sobre os tipos de dados que recebe, de modo que os dados são colocados na conexão sem uma descrição de dados genéricos.</span><span class="sxs-lookup"><span data-stu-id="ed946-108">The RPC run-time model assumes that the receiving application knows about the types of data that it receives, so data is put onto the wire without a generic data description.</span></span> <span data-ttu-id="ed946-109">Quando o destinatário espera um tipo de dados diferente daquele que o remetente colocou na conexão, o stub gera uma exceção (ou a transmissão falha de alguma outra maneira menos amigável).</span><span class="sxs-lookup"><span data-stu-id="ed946-109">When the recipient expects a different data type than what the sender has put on the wire, the stub raises an exception (or transmission fails in some other less graceful manner).</span></span>

<span data-ttu-id="ed946-110">Uma interface RPC é definida por seu UUID e seus números de versão principal e secundária.</span><span class="sxs-lookup"><span data-stu-id="ed946-110">An RPC interface is defined by its UUID and its major and minor version numbers.</span></span> <span data-ttu-id="ed946-111">Ao alterar uma interface existente, você deve adicionar os novos métodos no final da interface e alterar o número de versão secundária.</span><span class="sxs-lookup"><span data-stu-id="ed946-111">When you change an existing interface, you should add the new methods at the end of the interface and change the minor version number.</span></span> <span data-ttu-id="ed946-112">Se você adicionar métodos em qualquer outro lugar ou fizer outras alterações na interface, também será necessário alterar o número de versão principal.</span><span class="sxs-lookup"><span data-stu-id="ed946-112">If you add methods anywhere else or make any other changes to the interface, you will also need to change the major version number.</span></span>

<span data-ttu-id="ed946-113">Na verdade, há ocasiões em que não é possível alterar até mesmo o número de versão secundária, pois um novo cliente não poderá se comunicar com um servidor antigo e você não poderá atualizar o servidor.</span><span class="sxs-lookup"><span data-stu-id="ed946-113">Realistically, there are times when you cannot change even the minor version number, because a new client will not be able to communicate with an old server and you cannot update the server.</span></span> <span data-ttu-id="ed946-114">O tempo de execução de RPC gera uma exceção, RPC \_ S \_ PROCNUM \_ fora \_ do \_ intervalo, quando um cliente chama um método além daqueles especificados para sua interface com o servidor.</span><span class="sxs-lookup"><span data-stu-id="ed946-114">The RPC run time raises an exception, RPC\_S\_PROCNUM\_OUT\_OF\_RANGE, when a client calls a method beyond the ones specified for its interface with the server.</span></span> <span data-ttu-id="ed946-115">A solução alternativa é deixar os números de versão inalterados e escrever seu código de cliente para tratar essa exceção normalmente – pelo cliente degradando seu desempenho, por exemplo, ou por qualquer meio que seja apropriado para seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ed946-115">The workaround is to leave the version numbers unchanged and write your client code to handle this exception gracefully—by the client degrading its performance, for example, or by whatever means are appropriate for your application.</span></span>

<span data-ttu-id="ed946-116">Há uma solução alternativa semelhante para um caso especial de alteração de um tipo de dados em um método existente.</span><span class="sxs-lookup"><span data-stu-id="ed946-116">There is a similar workaround for one special case of changing a data type in an existing method.</span></span> <span data-ttu-id="ed946-117">Se você tiver uma [**União**](/windows/desktop/Midl/union) cujas ramificações são ponteiros e que não têm uma ramificação padrão para tipos não reconhecidos, você pode adicionar um novo Branch que usa o novo tipo de dados.</span><span class="sxs-lookup"><span data-stu-id="ed946-117">If you have a [**union**](/windows/desktop/Midl/union) whose branches are pointers and that does not have a default branch for unrecognized types, you can add a new branch that uses the new data type.</span></span> <span data-ttu-id="ed946-118">Isso não alterará o tamanho da estrutura de dados.</span><span class="sxs-lookup"><span data-stu-id="ed946-118">This will not change the size of the data structure.</span></span> <span data-ttu-id="ed946-119">Quando o cliente se comunica com um novo servidor, ele pode usar o novo tipo de dados.</span><span class="sxs-lookup"><span data-stu-id="ed946-119">When your client talks to a new server, it can use the new data type.</span></span> <span data-ttu-id="ed946-120">No entanto, quando o cliente se comunica com um servidor antigo, o tempo de execução irá gerar a exceção RPC \_ S \_ Invalid \_ .</span><span class="sxs-lookup"><span data-stu-id="ed946-120">However, when your client talks to an old server, the run time will raise the exception RPC\_S\_INVALID\_TAG.</span></span> <span data-ttu-id="ed946-121">Novamente, você precisará escrever seu código de cliente para tratar essa exceção adequadamente.</span><span class="sxs-lookup"><span data-stu-id="ed946-121">Again, you will need to write your client code to handle this exception appropriately.</span></span>

<span data-ttu-id="ed946-122">Uma interface DCOM é identificada por seu GUID.</span><span class="sxs-lookup"><span data-stu-id="ed946-122">A DCOM interface is identified by its GUID.</span></span> <span data-ttu-id="ed946-123">No DCOM, as interfaces são consideradas imutáveis e você só pode fazer alterações criando uma nova interface que herda da antiga.</span><span class="sxs-lookup"><span data-stu-id="ed946-123">In DCOM, interfaces are considered immutable and you can make changes only by creating a new interface that inherits from the old one.</span></span> <span data-ttu-id="ed946-124">Essas regras garantem que os clientes e servidores permaneçam compatíveis.</span><span class="sxs-lookup"><span data-stu-id="ed946-124">These rules ensure that clients and servers remain compatible.</span></span>

 

 