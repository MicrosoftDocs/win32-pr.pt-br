---
title: Detalhes da implementação do WOW64
description: O emulador WOW64 é executado no modo de usuário.
ms.assetid: 93daf9d0-dfdb-42c3-8c3d-397b21991e83
keywords:
- Programação WOW64 de 64 bits do Windows, variáveis de ambiente
- Programação do Windows para WOW64 de 64 bits, implementação
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4c7d095369b883171e39bffd4dc629b7f80a7f39
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/20/2020
ms.locfileid: "104084637"
---
# <a name="wow64-implementation-details"></a><span data-ttu-id="38914-105">Detalhes da implementação do WOW64</span><span class="sxs-lookup"><span data-stu-id="38914-105">WOW64 Implementation Details</span></span>

<span data-ttu-id="38914-106">O emulador WOW64 é executado no modo de usuário.</span><span class="sxs-lookup"><span data-stu-id="38914-106">The WOW64 emulator runs in user mode.</span></span> <span data-ttu-id="38914-107">Ele fornece uma interface entre a versão de 32 bits do Ntdll.dll e o kernel do processador e intercepta chamadas de kernel.</span><span class="sxs-lookup"><span data-stu-id="38914-107">It provides an interface between the 32-bit version of Ntdll.dll and the kernel of the processor, and it intercepts kernel calls.</span></span> <span data-ttu-id="38914-108">O emulador WOW64 consiste nas seguintes DLLs:</span><span class="sxs-lookup"><span data-stu-id="38914-108">The WOW64 emulator consists of the following DLLs:</span></span>

-   <span data-ttu-id="38914-109">Wow64.dll fornece a infraestrutura de emulação de núcleo e as conversões para o Ntoskrnl.exe funções de ponto de entrada.</span><span class="sxs-lookup"><span data-stu-id="38914-109">Wow64.dll provides the core emulation infrastructure and the thunks for the Ntoskrnl.exe entry-point functions.</span></span>
-   <span data-ttu-id="38914-110">Wow64Win.dll fornece conversões para o Win32k.sys funções de ponto de entrada.</span><span class="sxs-lookup"><span data-stu-id="38914-110">Wow64Win.dll provides thunks for the Win32k.sys entry-point functions.</span></span>
-   <span data-ttu-id="38914-111">(somente x64) Wow64Cpu.dll fornece suporte para a execução de programas x86 em x64.</span><span class="sxs-lookup"><span data-stu-id="38914-111">(x64 only) Wow64Cpu.dll provides support for running x86 programs on x64.</span></span>
-   <span data-ttu-id="38914-112">(Somente Intel Itanium) IA32Exec. bin contém o emulador de software x86.</span><span class="sxs-lookup"><span data-stu-id="38914-112">(Intel Itanium only) IA32Exec.bin contains the x86 software emulator.</span></span>
-   <span data-ttu-id="38914-113">(Somente Intel Itanium) Wowia32x.dll fornece a interface entre IA32Exec. bin e WOW64.</span><span class="sxs-lookup"><span data-stu-id="38914-113">(Intel Itanium only) Wowia32x.dll provides the interface between IA32Exec.bin and WOW64.</span></span>
-   <span data-ttu-id="38914-114">(Somente ARM64) xtajit.dll contém o emulador de software x86.</span><span class="sxs-lookup"><span data-stu-id="38914-114">(ARM64 only) xtajit.dll contains the x86 software emulator.</span></span>
-   <span data-ttu-id="38914-115">(Somente ARM64) wowarmw.dll fornece suporte para a execução de programas do ARM32 no ARM64.</span><span class="sxs-lookup"><span data-stu-id="38914-115">(ARM64 only) wowarmw.dll provides support for running ARM32 programs on ARM64.</span></span>

<span data-ttu-id="38914-116">Essas DLLs, juntamente com a versão de 64 bits do Ntdll.dll, são os únicos binários de 64 bits que podem ser carregados em um processo de 32 bits.</span><span class="sxs-lookup"><span data-stu-id="38914-116">These DLLs, along with the 64-bit version of Ntdll.dll, are the only 64-bit binaries that can be loaded into a 32-bit process.</span></span> <span data-ttu-id="38914-117">No Windows 10 no ARM, os binários CHPE (compilação portátil híbrida compilado) também podem ser carregados em um processo x86 de 32 bits.</span><span class="sxs-lookup"><span data-stu-id="38914-117">On Windows 10 on ARM, CHPE (Compiled Hybrid Portable Executable) binaries may also be loaded into an x86 32-bit process.</span></span>

<span data-ttu-id="38914-118">Na inicialização, Wow64.dll carrega a versão x86 do Ntdll.dll (ou a versão CHPE, se habilitada) e executa seu código de inicialização, que carrega todas as DLLs de 32 bits necessárias.</span><span class="sxs-lookup"><span data-stu-id="38914-118">At startup, Wow64.dll loads the x86 version of Ntdll.dll (or the CHPE version, if enabled) and runs its initialization code, which loads all necessary 32-bit DLLs.</span></span> <span data-ttu-id="38914-119">Quase todas as DLLs de 32 bits são cópias não modificadas de binários do Windows de 32 bits, embora algumas sejam carregadas como CHPE por motivos de desempenho.</span><span class="sxs-lookup"><span data-stu-id="38914-119">Almost all 32-bit DLLs are unmodified copies of 32-bit Windows binaries, though some are loaded as CHPE for performance reasons.</span></span> <span data-ttu-id="38914-120">Algumas dessas DLLs são escritas para se comportar de forma diferente no WOW64 do que nas janelas de 32 bits, geralmente porque compartilham memória com componentes de sistema de 64 bits.</span><span class="sxs-lookup"><span data-stu-id="38914-120">Some of these DLLs are written to behave differently on WOW64 than they do on 32-bit Windows, usually because they share memory with 64-bit system components.</span></span> <span data-ttu-id="38914-121">Todo o espaço de endereço de modo de usuário acima do limite de 32 bits é reservado pelo sistema.</span><span class="sxs-lookup"><span data-stu-id="38914-121">All user-mode address space above the 32-bit limit is reserved by the system.</span></span> <span data-ttu-id="38914-122">Para obter mais informações, consulte [desempenho e consumo de memória em WOW64](performance-and-memory-consumption.md).</span><span class="sxs-lookup"><span data-stu-id="38914-122">For more information, see [Performance and Memory Consumption under WOW64](performance-and-memory-consumption.md).</span></span>

<span data-ttu-id="38914-123">Em vez de usar a sequência de chamada de serviço do sistema x86, os binários de 32 bits que fazem chamadas do sistema são recriados para usar uma sequência de chamada personalizada.</span><span class="sxs-lookup"><span data-stu-id="38914-123">Instead of using the x86 system-service call sequence, 32-bit binaries that make system calls are rebuilt to use a custom calling sequence.</span></span> <span data-ttu-id="38914-124">Essa sequência de chamada é barata para o WOW64 interceptar porque permanece inteiramente no modo de usuário.</span><span class="sxs-lookup"><span data-stu-id="38914-124">This calling sequence is inexpensive for WOW64 to intercept because it remains entirely in user mode.</span></span> <span data-ttu-id="38914-125">Quando a sequência de chamada personalizada é detectada, a CPU do WOW64 faz a transição de volta para o modo de 64 bits nativo e chama Wow64.dll.</span><span class="sxs-lookup"><span data-stu-id="38914-125">When the custom calling sequence is detected, the WOW64 CPU transitions back to native 64-bit mode and calls into Wow64.dll.</span></span> <span data-ttu-id="38914-126">A conversão é feita no modo de usuário para reduzir o impacto no kernel de 64 bits e reduzir o risco de um bug na conversão que pode causar uma falha no modo kernel, corrupção de dados ou uma brecha de segurança.</span><span class="sxs-lookup"><span data-stu-id="38914-126">Thunking is done in user mode to reduce the impact on the 64-bit kernel and to reduce the risk of a bug in the thunk that might cause a kernel-mode crash, data corruption, or a security hole.</span></span> <span data-ttu-id="38914-127">As conversões extraem argumentos da pilha de 32 bits, estendem-as para 64 bits e, em seguida, fazem a chamada nativa do sistema.</span><span class="sxs-lookup"><span data-stu-id="38914-127">The thunks extract arguments from the 32-bit stack, extend them to 64 bits, then make the native system call.</span></span>

## <a name="environment-variables"></a><span data-ttu-id="38914-128">Variáveis de ambiente</span><span class="sxs-lookup"><span data-stu-id="38914-128">Environment Variables</span></span>

<span data-ttu-id="38914-129">Quando um processo de 32 bits é criado por um processo de 64 bits, ou quando um processo de 64 bits é criado por um processo de 32 bits, o WOW64 define as variáveis de ambiente para o processo criado, conforme mostrado na tabela a seguir.</span><span class="sxs-lookup"><span data-stu-id="38914-129">When a 32-bit process is created by a 64-bit process, or when a 64-bit process is created by a 32-bit process, WOW64 sets the environment variables for the created process as shown in the following table.</span></span>



| <span data-ttu-id="38914-130">Processar</span><span class="sxs-lookup"><span data-stu-id="38914-130">Process</span></span>                   | <span data-ttu-id="38914-131">Variáveis de ambiente</span><span class="sxs-lookup"><span data-stu-id="38914-131">Environment variables</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|---------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="38914-132">processo de 64 bits</span><span class="sxs-lookup"><span data-stu-id="38914-132">64-bit process</span></span><br/> | <span data-ttu-id="38914-133">Arquitetura do processador \_ = AMD64 ou \_ arquitetura do processador = arquitetura do processador/IA64 = \_ ARM64</span><span class="sxs-lookup"><span data-stu-id="38914-133">PROCESSOR\_ARCHITECTURE=AMD64 or PROCESSOR\_ARCHITECTURE=IA64 or PROCESSOR\_ARCHITECTURE=ARM64</span></span><br/> <span data-ttu-id="38914-134">ProgramFiles =% ProgramFiles%</span><span class="sxs-lookup"><span data-stu-id="38914-134">ProgramFiles=%ProgramFiles%</span></span><br/> <span data-ttu-id="38914-135">ProgramW6432 =% ProgramFiles%</span><span class="sxs-lookup"><span data-stu-id="38914-135">ProgramW6432=%ProgramFiles%</span></span><br/> <span data-ttu-id="38914-136">CommonProgramFiles =% CommonProgramFiles%</span><span class="sxs-lookup"><span data-stu-id="38914-136">CommonProgramFiles=%CommonProgramFiles%</span></span><br/> <span data-ttu-id="38914-137">CommonProgramW6432 =% CommonProgramFiles%</span><span class="sxs-lookup"><span data-stu-id="38914-137">CommonProgramW6432=%CommonProgramFiles%</span></span><br/> <span data-ttu-id="38914-138">**Windows server 2008, Windows Vista, Windows server 2003 e Windows XP:** As variáveis de ambiente ProgramW6432 e CommonProgramW6432 foram adicionadas a partir do Windows 7 e do Windows Server 2008 R2.</span><span class="sxs-lookup"><span data-stu-id="38914-138">**Windows Server 2008, Windows Vista, Windows Server 2003 and Windows XP:** The ProgramW6432 and CommonProgramW6432 environment variables were added starting with Windows 7 and Windows Server 2008 R2.</span></span> <br/> |
| <span data-ttu-id="38914-139">processo de 32 bits</span><span class="sxs-lookup"><span data-stu-id="38914-139">32-bit process</span></span><br/> | <span data-ttu-id="38914-140">Arquitetura do processador \_ = x86</span><span class="sxs-lookup"><span data-stu-id="38914-140">PROCESSOR\_ARCHITECTURE=x86</span></span><br/> <span data-ttu-id="38914-141">ARCHITEW6432 do processador \_ =% \_ arquitetura do processador%</span><span class="sxs-lookup"><span data-stu-id="38914-141">PROCESSOR\_ARCHITEW6432=%PROCESSOR\_ARCHITECTURE%</span></span><br/> <span data-ttu-id="38914-142">ProgramFiles =% ProgramFiles (x86)%</span><span class="sxs-lookup"><span data-stu-id="38914-142">ProgramFiles=%ProgramFiles(x86)%</span></span><br/> <span data-ttu-id="38914-143">ProgramW6432 =% ProgramFiles%</span><span class="sxs-lookup"><span data-stu-id="38914-143">ProgramW6432=%ProgramFiles%</span></span><br/> <span data-ttu-id="38914-144">CommonProgramFiles =% CommonProgramFiles (x86)%</span><span class="sxs-lookup"><span data-stu-id="38914-144">CommonProgramFiles=%CommonProgramFiles(x86)%</span></span><br/> <span data-ttu-id="38914-145">CommonProgramW6432 =% CommonProgramFiles%</span><span class="sxs-lookup"><span data-stu-id="38914-145">CommonProgramW6432=%CommonProgramFiles%</span></span><br/>                                                                                                                                                                                                                  |



 

## <a name="global-hooks"></a><span data-ttu-id="38914-146">Ganchos globais</span><span class="sxs-lookup"><span data-stu-id="38914-146">Global Hooks</span></span>

<span data-ttu-id="38914-147">A função [**SetWindowsHookEx**](/windows/win32/api/winuser/nf-winuser-setwindowshookexa) pode ser usada para injetar uma dll em outro processo se as seguintes condições forem atendidas:</span><span class="sxs-lookup"><span data-stu-id="38914-147">The [**SetWindowsHookEx**](/windows/win32/api/winuser/nf-winuser-setwindowshookexa) function can be used to inject a DLL into another process if the following conditions are met:</span></span>

-   <span data-ttu-id="38914-148">Uma DLL de 32 bits pode ser injetada somente em um processo de 32 bits, e uma DLL de bits de 64 pode ser injetada somente em um processo de 64 bits.</span><span class="sxs-lookup"><span data-stu-id="38914-148">A 32-bit DLL can be injected only into a 32-bit process, and a 64-bit DLL can be injected only into a 64-bit process.</span></span> <span data-ttu-id="38914-149">Não é possível injetar uma DLL de 32 bits em um processo de 64 bits ou vice-versa.</span><span class="sxs-lookup"><span data-stu-id="38914-149">It is not possible to inject a 32-bit DLL into a 64-bit process or vice versa.</span></span>
-   <span data-ttu-id="38914-150">As DLLs de 32 bits e 64 bits devem ter nomes diferentes.</span><span class="sxs-lookup"><span data-stu-id="38914-150">The 32-bit and 64-bit DLLs must have different names.</span></span>
-   <span data-ttu-id="38914-151">As arquiteturas da DLL e o processo devem corresponder.</span><span class="sxs-lookup"><span data-stu-id="38914-151">The architectures of the DLL and the process must match.</span></span> <span data-ttu-id="38914-152">Por exemplo, você não pode injetar uma DLL x86 de 32 bits em um processo ARM de 32 bits.</span><span class="sxs-lookup"><span data-stu-id="38914-152">For instance, you cannot inject a 32-bit x86 DLL into a 32-bit ARM process.</span></span>

<span data-ttu-id="38914-153">Para obter mais informações, consulte [**SetWindowsHookEx**](/windows/win32/api/winuser/nf-winuser-setwindowshookexa).</span><span class="sxs-lookup"><span data-stu-id="38914-153">For more information, see [**SetWindowsHookEx**](/windows/win32/api/winuser/nf-winuser-setwindowshookexa).</span></span>

<span data-ttu-id="38914-154">Lembre-se de que o **\_ mouse do qu**, o **\_ teclado** do qu, o **\_ diário \*** do qu, o **\_ shell do qu** e os ganchos de nível baixo podem ser chamados no thread que instalou o gancho, em vez do thread que está processando o gancho.</span><span class="sxs-lookup"><span data-stu-id="38914-154">Be aware that the **WH\_MOUSE**, **WH\_KEYBOARD**, **WH\_JOURNAL\***, **WH\_SHELL**, and low-level hooks can be called on the thread that installed the hook rather than the thread processing the hook.</span></span> <span data-ttu-id="38914-155">Para esses ganchos, é possível que os ganchos de 32 bits e 64 bits sejam chamados se um gancho de 32 bits estiver à frente de um gancho de 64 bits na cadeia de ganchos.</span><span class="sxs-lookup"><span data-stu-id="38914-155">For these hooks, it is possible that both the 32-bit and 64-bit hooks will be called if a 32-bit hook is ahead of a 64-bit hook in the hook chain.</span></span> <span data-ttu-id="38914-156">Para obter mais informações, consulte [usando ganchos](../winmsg/using-hooks.md).</span><span class="sxs-lookup"><span data-stu-id="38914-156">For more information, see [Using Hooks](../winmsg/using-hooks.md).</span></span>

 

