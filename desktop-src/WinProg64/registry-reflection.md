---
title: Reflexão do registro
description: O redirecionador de registro isola os aplicativos de 32 bits e 64 bits fornecendo exibições lógicas separadas de determinadas partes do registro no WOW64. No entanto, os valores de algumas chaves do registro devem ser os mesmos nas exibições de 32 bits e 64 bits.
ms.assetid: eac9038b-9f59-4ac7-8974-f94a4a62a257
keywords:
- reflexão do registro 64-programação do Windows-bit
- Programação de reflexão de 64 bits do Windows
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 523041004d9570bbdf101050e30f5d9139031913
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/20/2020
ms.locfileid: "105807183"
---
# <a name="registry-reflection"></a><span data-ttu-id="73a70-106">Reflexão do registro</span><span class="sxs-lookup"><span data-stu-id="73a70-106">Registry Reflection</span></span>

<span data-ttu-id="73a70-107">\[As informações neste tópico se aplicam ao Windows Server 2008, Windows Vista, Windows Server 2003 e Windows XP.</span><span class="sxs-lookup"><span data-stu-id="73a70-107">\[The information in this topic applies to Windows Server 2008, Windows Vista, Windows Server 2003, and Windows XP.</span></span> <span data-ttu-id="73a70-108">A partir do Windows 7 e do Windows Server 2008 R2, o WOW64 não usa mais a reflexão do registro e, anteriormente, as chaves refletidas são compartilhadas.</span><span class="sxs-lookup"><span data-stu-id="73a70-108">Starting with Windows 7 and Windows Server 2008 R2, WOW64 no longer uses registry reflection and formerly reflected keys are shared instead.</span></span> <span data-ttu-id="73a70-109">Para obter mais informações, consulte [chaves do registro afetadas pelo WOW64](shared-registry-keys.md).\]</span><span class="sxs-lookup"><span data-stu-id="73a70-109">For more information, see [Registry Keys Affected by WOW64](shared-registry-keys.md).\]</span></span>

<span data-ttu-id="73a70-110">O [redirecionador de registro](registry-redirector.md) isola os aplicativos de 32 bits e 64 bits fornecendo exibições lógicas separadas de determinadas partes do registro no WOW64.</span><span class="sxs-lookup"><span data-stu-id="73a70-110">The [registry redirector](registry-redirector.md) isolates 32-bit and 64-bit applications by providing separate logical views of certain portions of the registry on WOW64.</span></span> <span data-ttu-id="73a70-111">No entanto, os valores de algumas chaves do registro devem ser os mesmos nas exibições de 32 bits e 64 bits.</span><span class="sxs-lookup"><span data-stu-id="73a70-111">However, the values of some registry keys must be the same in both the 32-bit and 64-bit views.</span></span>

<span data-ttu-id="73a70-112">O processo de *reflexão do registro* copia chaves e valores do registro entre duas exibições do registro para mantê-las sincronizadas.</span><span class="sxs-lookup"><span data-stu-id="73a70-112">The process of *registry reflection* copies registry keys and values between two registry views to keep them synchronized.</span></span> <span data-ttu-id="73a70-113">Cada exibição tem uma cópia física separada de cada chave do registro refletida, uma para a exibição do registro de 32 bits e a outra para a exibição do registro de 64 bits.</span><span class="sxs-lookup"><span data-stu-id="73a70-113">Each view has a separate physical copy of each reflected registry key, one for the 32-bit registry view and the other for the 64-bit registry view.</span></span>

<span data-ttu-id="73a70-114">Uma chave refletida é copiada quando uma chave é fechada chamando [**falha RegCloseKey**](/windows/desktop/api/winreg/nf-winreg-regclosekey).</span><span class="sxs-lookup"><span data-stu-id="73a70-114">A reflected key is copied when a key is closed by calling [**RegCloseKey**](/windows/desktop/api/winreg/nf-winreg-regclosekey).</span></span> <span data-ttu-id="73a70-115">Observe que isso oferece aumento para uma possível condição de corrida: se mais de um processo alterar a chave refletida, a última chamada **falha RegCloseKey** determinará o valor final da chave.</span><span class="sxs-lookup"><span data-stu-id="73a70-115">Note that this gives rise to a possible race condition: if more than one process changes the reflected key, the last **RegCloseKey** call determines the key's final value.</span></span>

<span data-ttu-id="73a70-116">O refletor copia dados de ativação COM para servidores locais entre os modos de exibição, mas não copia dados em processo porque a combinação de dados em processo 32/64 não é permitida em janelas de 64 bits.</span><span class="sxs-lookup"><span data-stu-id="73a70-116">The reflector copies COM activation data for Local servers between the views, but it does not copy in-process data because 32/64 in-process data mixing is not permitted on 64-bit Windows.</span></span>

<span data-ttu-id="73a70-117">A reflexão não está habilitada para chaves de registro compartilhadas ou para chaves do registro que não são redirecionadas.</span><span class="sxs-lookup"><span data-stu-id="73a70-117">Reflection is not enabled for shared registry keys or for registry keys that are not redirected.</span></span> <span data-ttu-id="73a70-118">Por exemplo, a reflexão não está habilitada para a chave do **\_ \_ \\ sistema do computador local hKey** .</span><span class="sxs-lookup"><span data-stu-id="73a70-118">For example, reflection is not enabled for the **HKEY\_LOCAL\_MACHINE\\System** key.</span></span> <span data-ttu-id="73a70-119">Para obter uma lista de chaves do registro redirecionadas, compartilhadas ou refletidas, consulte [chaves do registro afetadas pelo WOW64](shared-registry-keys.md).</span><span class="sxs-lookup"><span data-stu-id="73a70-119">For a list of registry keys that are redirected, shared, or reflected, see [Registry Keys Affected by WOW64](shared-registry-keys.md).</span></span>

<span data-ttu-id="73a70-120">A reflexão do registro usa uma política "último escritor vence", conforme ilustrado no exemplo a seguir:</span><span class="sxs-lookup"><span data-stu-id="73a70-120">Registry reflection uses a "last writer wins" policy as illustrated in the following example:</span></span>

-   <span data-ttu-id="73a70-121">Após uma instalação limpa do Windows de 64 bits, a Wordpad.exe de 64 bits é registrada para manipular arquivos. doc.</span><span class="sxs-lookup"><span data-stu-id="73a70-121">After a clean installation of 64-bit Windows, 64-bit Wordpad.exe is registered to handle .doc files.</span></span> <span data-ttu-id="73a70-122">O refletor copia o registro. doc da exibição do registro de 64 bits para a exibição do registro de 32 bits.</span><span class="sxs-lookup"><span data-stu-id="73a70-122">The reflector copies the .doc registration from the 64-bit registry view into the 32-bit registry view.</span></span>
-   <span data-ttu-id="73a70-123">Um administrador instala o escritório de 32 bits, que registra Winword.exe de 32 bits para manipular arquivos. doc na exibição de registro de 32 bits.</span><span class="sxs-lookup"><span data-stu-id="73a70-123">An administrator installs 32-bit Office, which registers 32-bit Winword.exe to handle .doc files in the 32-bit registry view.</span></span> <span data-ttu-id="73a70-124">O reflector do registro copia essas informações na exibição do registro de 64 bits, de modo que os aplicativos de 32 bits e de 64 bits iniciem a versão de 32 bits do Winword.exe para arquivos. doc.</span><span class="sxs-lookup"><span data-stu-id="73a70-124">The registry reflector copies this information into the 64-bit registry view, so both 32-bit and 64-bit applications launch the 32-bit version of Winword.exe for .doc files.</span></span>
-   <span data-ttu-id="73a70-125">Um administrador instala o escritório de 64 bits, que registra Winword.exe de 64 bits para manipular arquivos. doc na exibição de registro de 64 bits.</span><span class="sxs-lookup"><span data-stu-id="73a70-125">An administrator installs 64-bit Office, which registers 64-bit Winword.exe to handle .doc files in the 64-bit registry view.</span></span> <span data-ttu-id="73a70-126">O refletor de registro copia essas informações no registro de 32 bits, de modo que os aplicativos de 32 bits e de 64 bits iniciem a versão de 64 bits do Winword.exe para arquivos. doc.</span><span class="sxs-lookup"><span data-stu-id="73a70-126">The registry reflector copies this information into the 32-bit registry, so both 32-bit and 64-bit applications launch the 64-bit version of Winword.exe for .doc files.</span></span>

<span data-ttu-id="73a70-127">Portanto, as informações de associação de arquivo são preservadas para o aplicativo instalado mais recentemente.</span><span class="sxs-lookup"><span data-stu-id="73a70-127">Therefore, the file association information is preserved for the most recently installed application.</span></span>

<span data-ttu-id="73a70-128">Ele pode ser útil para aplicativos de 32 bits e 64 bits para compartilhar valores de chave de registro específicos que são normalmente gravados em exibições de registro separadas.</span><span class="sxs-lookup"><span data-stu-id="73a70-128">It can be useful for 32-bit and 64-bit applications to share specific registry key values that are normally written to separate registry views.</span></span> <span data-ttu-id="73a70-129">Por exemplo, um servidor OLE de 32 bits que pode atender a solicitações de clientes de 32 bits e 64 bits pode disponibilizar seus dados de registro de 32 bits para a exibição de 64 bits do registro do sistema.</span><span class="sxs-lookup"><span data-stu-id="73a70-129">For example, a 32-bit OLE server that can serve requests from both 32-bit and 64-bit clients could make its 32-bit registry data available to the 64-bit view of the system registry.</span></span>

<span data-ttu-id="73a70-130">Quando um componente grava dados no registro do sistema, o WOW64 analisa as informações e faz uma cópia dos dados na exibição alternativa do registro quando apropriado.</span><span class="sxs-lookup"><span data-stu-id="73a70-130">When a component writes data in the system registry, WOW64 analyzes the information and makes a copy of the data in the alternate view of the registry when appropriate.</span></span> <span data-ttu-id="73a70-131">Normalmente, esse processo mantém duas cópias físicas separadas das mesmas chaves do registro em ambas as exibições no registro e é chamada de reflexo do registro ou espelhamento do registro.</span><span class="sxs-lookup"><span data-stu-id="73a70-131">Typically, this process keeps two separate physical copies of the same registry keys in both views in the registry, and is called registry reflection or registry mirroring.</span></span>

<span data-ttu-id="73a70-132">A maioria das chaves sob a raiz de classes está nessa categoria.</span><span class="sxs-lookup"><span data-stu-id="73a70-132">Most of the keys under the classes root are in this category.</span></span> <span data-ttu-id="73a70-133">As atualizações para as chaves são refletidas quando a atualização é concluída e o identificador para a chave é fechado.</span><span class="sxs-lookup"><span data-stu-id="73a70-133">Updates to the keys are reflected when the update completes and the handle to the key closes.</span></span> <span data-ttu-id="73a70-134">Em casos específicos, as gravações em uma chave não serão refletidas se a chave tiver alguma dependência de bit de bits.</span><span class="sxs-lookup"><span data-stu-id="73a70-134">In specific cases, writes to a key are not reflected if the key has some bitness dependency.</span></span> <span data-ttu-id="73a70-135">Por exemplo, a chave InprocServer32 de 32 bits não é relevante para aplicativos de 64 bits, portanto, a chave InprocServer32 não é refletida na exibição do registro de 64 bits.</span><span class="sxs-lookup"><span data-stu-id="73a70-135">For example, the 32-bit InprocServer32 key is not relevant for 64-bit applications, so the InprocServer32 key is not reflected to the 64-bit registry view.</span></span> <span data-ttu-id="73a70-136">No entanto, os aplicativos de 64 bits podem usar a chave LocalServer32 de 32 bits e a chave LocalServer32 é refletida.</span><span class="sxs-lookup"><span data-stu-id="73a70-136">However, 64-bit applications can use the 32-bit LocalServer32 key and the LocalServer32 key gets reflected.</span></span>

<span data-ttu-id="73a70-137">Para **HKEY \_ local \_ Machine \\ software \\ classes \\ CLSID** e **HKEY \_ Current \_ user \\ software \\ classes \\ CLSID**, somente os CLSIDs que não especificam InprocServer32 ou InprocHandler32 são refletidos.</span><span class="sxs-lookup"><span data-stu-id="73a70-137">For **HKEY\_LOCAL\_MACHINE\\Software\\Classes\\CLSID** and **HKEY\_CURRENT\_USER\\Software\\Classes\\CLSID**, only CLSIDs that do not specify InprocServer32 or InprocHandler32 are reflected.</span></span> <span data-ttu-id="73a70-138">Somente os CLSIDs LocalServer32 são refletidos porque são executados fora do processo e podem ser ativados por aplicativos de 32 ou 64 bits.</span><span class="sxs-lookup"><span data-stu-id="73a70-138">Only LocalServer32 CLSIDs are reflected because they run out-of-process and can be activated by either 32- or 64-bit applications.</span></span> <span data-ttu-id="73a70-139">Os CLSIDs InProcServer32 não são refletidos porque não é possível carregar uma DLL de 32 bits para execução em um processo de 64 bits ou uma DLL de 64 bits para execução em um processo de 32 bits.</span><span class="sxs-lookup"><span data-stu-id="73a70-139">InProcServer32 CLSIDs are not reflected because it is not possible to load a 32-bit DLL for execution in a 64-bit process, or a 64-bit DLL for execution in a 32-bit process.</span></span>

<span data-ttu-id="73a70-140">Para **HKEY \_ local \_ Machine \\ software \\ classes \\ AppID** e **HKEY \_ Current \_ user \\ software \\ classes \\ AppID**, os valores de registro [DllSurrogate](../com/dllsurrogate.md) e [DllSurrogateExecutable]( ../com/dllsurrogateexecutable.md) não serão refletidos se seu valor for uma cadeia de caracteres vazia.</span><span class="sxs-lookup"><span data-stu-id="73a70-140">For **HKEY\_LOCAL\_MACHINE\\Software\\Classes\\Appid** and **HKEY\_CURRENT\_USER\\Software\\Classes\\Appid**, the [DllSurrogate](../com/dllsurrogate.md) and [DllSurrogateExecutable]( ../com/dllsurrogateexecutable.md) registry values are not reflected if their value is an empty string.</span></span>

<span data-ttu-id="73a70-141">Para desabilitar e habilitar a reflexão do registro para uma determinada chave refletida, use as funções [**RegDisableReflectionKey**](/windows/desktop/api/winreg/nf-winreg-regdisablereflectionkey) e [**RegEnableReflectionKey**](/windows/desktop/api/winreg/nf-winreg-regenablereflectionkey) .</span><span class="sxs-lookup"><span data-stu-id="73a70-141">To disable and enable registry reflection for a particular reflected key, use the [**RegDisableReflectionKey**](/windows/desktop/api/winreg/nf-winreg-regdisablereflectionkey) and [**RegEnableReflectionKey**](/windows/desktop/api/winreg/nf-winreg-regenablereflectionkey) functions.</span></span> <span data-ttu-id="73a70-142">Essas funções não afetam as chaves que não estão na lista de chaves refletidas anteriormente neste tópico.</span><span class="sxs-lookup"><span data-stu-id="73a70-142">These functions do not affect keys that are not on the list of reflected keys earlier in this topic.</span></span> <span data-ttu-id="73a70-143">Os aplicativos devem desabilitar a reflexão somente para as chaves do registro que elas criam e não tentar desabilitar a reflexão para as chaves predefinidas, como **HKEY \_ local \_ Machine** ou **HKEY \_ Current \_ User**.</span><span class="sxs-lookup"><span data-stu-id="73a70-143">Applications should disable reflection only for the registry keys that they create and not attempt to disable reflection for the predefined keys such as **HKEY\_LOCAL\_MACHINE** or **HKEY\_CURRENT\_USER**.</span></span> <span data-ttu-id="73a70-144">Para determinar se as chaves na lista de reflexão foram desabilitadas, use a função [**RegQueryReflectionKey**](/windows/desktop/api/winreg/nf-winreg-regqueryreflectionkey) .</span><span class="sxs-lookup"><span data-stu-id="73a70-144">To determine whether the keys on the reflection list have been disabled, use the [**RegQueryReflectionKey**](/windows/desktop/api/winreg/nf-winreg-regqueryreflectionkey) function.</span></span>

<span data-ttu-id="73a70-145">As chaves refletidas não devem ser usadas em operações de registro transacionadas.</span><span class="sxs-lookup"><span data-stu-id="73a70-145">Reflected keys should not be used in transacted registry operations.</span></span> <span data-ttu-id="73a70-146">Gravar em chaves refletidas durante uma transação pode fazer com que a transação falhe.</span><span class="sxs-lookup"><span data-stu-id="73a70-146">Writing to reflected keys during a transaction can cause the transaction to fail.</span></span> <span data-ttu-id="73a70-147">Para obter mais informações sobre transações, consulte [kernel Transaction Manager](/windows/desktop/Ktm/kernel-transaction-manager-portal).</span><span class="sxs-lookup"><span data-stu-id="73a70-147">For more information about transactions, see [Kernel Transaction Manager](/windows/desktop/Ktm/kernel-transaction-manager-portal).</span></span>

## <a name="related-topics"></a><span data-ttu-id="73a70-148">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="73a70-148">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="73a70-149">Redirecionador de registro</span><span class="sxs-lookup"><span data-stu-id="73a70-149">Registry Redirector</span></span>](registry-redirector.md)
</dt> <dt>

[<span data-ttu-id="73a70-150">Reflexão do registro no Windows</span><span class="sxs-lookup"><span data-stu-id="73a70-150">Registry Reflection in Windows</span></span>](/windows-hardware/drivers/display/microsoft-windows-vista-display-driver-64-bit-issues)
</dt> <dt>

[<span data-ttu-id="73a70-151">Chaves do Registro afetadas pelo WOW64</span><span class="sxs-lookup"><span data-stu-id="73a70-151">Registry Keys Affected by WOW64</span></span>](shared-registry-keys.md)
</dt> </dl>

 

 