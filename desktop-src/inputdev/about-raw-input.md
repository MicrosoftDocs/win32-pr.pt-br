---
title: Sobre a entrada bruta
description: Este tópico discute a entrada de usuários de dispositivos como joysticks, telas de toque e microfones.
ms.assetid: 013ed309-f667-47ed-ade0-5e7ca5a0997a
keywords:
- entrada do usuário, entrada bruta
- capturando entrada do usuário, entrada bruta
- entrada bruta
- registrando a entrada bruta
- lendo entrada bruta
- entrada bruta do joystick
- entrada bruta de tela sensível ao toque
- entrada bruta do microfone
- HID (Dispositivo de Interface Humana)
- HID (dispositivos de interface humana)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b3535e5601ec63a254c76060611999a1a2f08aeb
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/19/2020
ms.locfileid: "104007541"
---
# <a name="about-raw-input"></a><span data-ttu-id="d332e-113">Sobre a entrada bruta</span><span class="sxs-lookup"><span data-stu-id="d332e-113">About Raw Input</span></span>

<span data-ttu-id="d332e-114">Há muitos dispositivos de entrada de usuário ao lado do teclado e do mouse tradicionais.</span><span class="sxs-lookup"><span data-stu-id="d332e-114">There are many user-input devices beside the traditional keyboard and mouse.</span></span> <span data-ttu-id="d332e-115">Por exemplo, a entrada do usuário pode vir de um joystick, uma tela sensível ao toque, um microfone ou outros dispositivos que permitem grande flexibilidade na entrada do usuário.</span><span class="sxs-lookup"><span data-stu-id="d332e-115">For example, user input can come from a joystick, a touch screen, a microphone, or other devices that allow great flexibility in user input.</span></span> <span data-ttu-id="d332e-116">Esses dispositivos são coletivamente conhecidos como HIDs (dispositivos de interface humana).</span><span class="sxs-lookup"><span data-stu-id="d332e-116">These devices are collectively known as Human Interface Devices (HIDs).</span></span> <span data-ttu-id="d332e-117">A API de entrada bruta fornece uma maneira estável e robusta para que os aplicativos aceitem a entrada bruta de qualquer HID, incluindo o teclado e o mouse.</span><span class="sxs-lookup"><span data-stu-id="d332e-117">The raw input API provides a stable and robust way for applications to accept raw input from any HID, including the keyboard and mouse.</span></span>

<span data-ttu-id="d332e-118">Esta seção contém os seguintes tópicos:</span><span class="sxs-lookup"><span data-stu-id="d332e-118">This section covers the following topics:</span></span>

-   [<span data-ttu-id="d332e-119">Modelo de entrada bruto</span><span class="sxs-lookup"><span data-stu-id="d332e-119">Raw Input Model</span></span>](#raw-input-model)
-   [<span data-ttu-id="d332e-120">Registro de entrada bruta</span><span class="sxs-lookup"><span data-stu-id="d332e-120">Registration for Raw Input</span></span>](#registration-for-raw-input)
-   [<span data-ttu-id="d332e-121">Lendo entrada bruta</span><span class="sxs-lookup"><span data-stu-id="d332e-121">Reading Raw Input</span></span>](#reading-raw-input)

## <a name="raw-input-model"></a><span data-ttu-id="d332e-122">Modelo de entrada bruto</span><span class="sxs-lookup"><span data-stu-id="d332e-122">Raw Input Model</span></span>

<span data-ttu-id="d332e-123">Anteriormente, o teclado e o mouse normalmente geraram dados de entrada.</span><span class="sxs-lookup"><span data-stu-id="d332e-123">Previously, the keyboard and mouse typically generated input data.</span></span> <span data-ttu-id="d332e-124">O sistema interpretou os dados provenientes desses dispositivos de forma a eliminar os detalhes específicos do dispositivo das informações brutas.</span><span class="sxs-lookup"><span data-stu-id="d332e-124">The system interpreted the data coming from these devices in a way that eliminated the device-specific details of the raw information.</span></span> <span data-ttu-id="d332e-125">Por exemplo, o teclado gera o código de verificação específico do dispositivo, mas o sistema fornece um aplicativo com o código de chave virtual.</span><span class="sxs-lookup"><span data-stu-id="d332e-125">For example, the keyboard generates the device-specific scan code but the system provides an application with the virtual key code.</span></span> <span data-ttu-id="d332e-126">Além de ocultar os detalhes da entrada bruta, o Gerenciador de janelas não dava suporte a todos os novos HIDs.</span><span class="sxs-lookup"><span data-stu-id="d332e-126">Besides hiding the details of the raw input, the window manager did not support all the new HIDs.</span></span> <span data-ttu-id="d332e-127">Para obter a entrada do HIDs sem suporte, um aplicativo tinha que fazer muitas coisas: abrir o dispositivo, gerenciar o modo compartilhado, ler periodicamente o dispositivo ou configurar a porta de conclusão de e/s e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="d332e-127">To get input from the unsupported HIDs, an application had to do many things: open the device, manage the shared mode, periodically read the device or set up the I/O completion port, and so forth.</span></span> <span data-ttu-id="d332e-128">O modelo de entrada bruto e as APIs associadas foram desenvolvidas para permitir o acesso simples à entrada bruta de todos os dispositivos de entrada, incluindo o teclado e o mouse.</span><span class="sxs-lookup"><span data-stu-id="d332e-128">The raw input model and the associated APIs were developed to allow simple access to raw input from all input devices, including the keyboard and mouse.</span></span>

<span data-ttu-id="d332e-129">O modelo de entrada bruto é diferente do modelo de entrada original do Windows para o teclado e o mouse.</span><span class="sxs-lookup"><span data-stu-id="d332e-129">The raw input model is different from the original Windows input model for the keyboard and mouse.</span></span> <span data-ttu-id="d332e-130">No modelo de entrada original, um aplicativo recebe entrada independente de dispositivo na forma de mensagens que são enviadas ou postadas em suas janelas, como [**WM \_ Char**](wm-char.md), [**WM \_ MOUSEMOVE**](wm-mousemove.md)e [**WM \_ APPCOMMAND**](wm-appcommand.md).</span><span class="sxs-lookup"><span data-stu-id="d332e-130">In the original input model, an application receives device-independent input in the form of messages that are sent or posted to its windows, such as [**WM\_CHAR**](wm-char.md), [**WM\_MOUSEMOVE**](wm-mousemove.md), and [**WM\_APPCOMMAND**](wm-appcommand.md).</span></span> <span data-ttu-id="d332e-131">Por outro lado, para a entrada bruta, um aplicativo deve registrar os dispositivos do qual deseja obter dados.</span><span class="sxs-lookup"><span data-stu-id="d332e-131">In contrast, for raw input an application must register the devices it wants to get data from.</span></span> <span data-ttu-id="d332e-132">Além disso, o aplicativo obtém a entrada bruta por meio da mensagem de [**\_ entrada do WM**](wm-input.md) .</span><span class="sxs-lookup"><span data-stu-id="d332e-132">Also, the application gets the raw input through the [**WM\_INPUT**](wm-input.md) message.</span></span>

<span data-ttu-id="d332e-133">Há várias vantagens para o modelo de entrada bruto:</span><span class="sxs-lookup"><span data-stu-id="d332e-133">There are several advantages to the raw input model:</span></span>

-   <span data-ttu-id="d332e-134">Um aplicativo não precisa detectar ou abrir o dispositivo de entrada.</span><span class="sxs-lookup"><span data-stu-id="d332e-134">An application does not have to detect or open the input device.</span></span>
-   <span data-ttu-id="d332e-135">Um aplicativo obtém os dados diretamente do dispositivo e processa os dados para suas necessidades.</span><span class="sxs-lookup"><span data-stu-id="d332e-135">An application gets the data directly from the device, and processes the data for its needs.</span></span>
-   <span data-ttu-id="d332e-136">Um aplicativo pode distinguir a origem da entrada mesmo que ela seja do mesmo tipo de dispositivo.</span><span class="sxs-lookup"><span data-stu-id="d332e-136">An application can distinguish the source of the input even if it is from the same type of device.</span></span> <span data-ttu-id="d332e-137">Por exemplo, dois dispositivos de mouse.</span><span class="sxs-lookup"><span data-stu-id="d332e-137">For example, two mouse devices.</span></span>
-   <span data-ttu-id="d332e-138">Um aplicativo gerencia o tráfego de dados especificando dados de uma coleção de dispositivos ou apenas tipos de dispositivos específicos.</span><span class="sxs-lookup"><span data-stu-id="d332e-138">An application manages the data traffic by specifying data from a collection of devices or only specific device types.</span></span>
-   <span data-ttu-id="d332e-139">Os dispositivos HID podem ser usados à medida que se tornam disponíveis no Marketplace, sem aguardar novos tipos de mensagem ou um sistema operacional atualizado para ter novos comandos no [**WM \_ APPCOMMAND**](wm-appcommand.md).</span><span class="sxs-lookup"><span data-stu-id="d332e-139">HID devices can be used as they become available in the marketplace, without waiting for new message types or an updated OS to have new commands in [**WM\_APPCOMMAND**](wm-appcommand.md).</span></span>

<span data-ttu-id="d332e-140">Observe que o [**WM \_ APPCOMMAND**](wm-appcommand.md) fornece alguns dispositivos HID.</span><span class="sxs-lookup"><span data-stu-id="d332e-140">Note that [**WM\_APPCOMMAND**](wm-appcommand.md) does provide for some HID devices.</span></span> <span data-ttu-id="d332e-141">No entanto, o **WM \_ APPCOMMAND** é um evento de entrada independente de dispositivo de nível superior, enquanto a [**\_ entrada do WM**](wm-input.md) envia dados brutos de baixo nível que são específicos para um dispositivo.</span><span class="sxs-lookup"><span data-stu-id="d332e-141">However, **WM\_APPCOMMAND** is a higher level device-independent input event, while [**WM\_INPUT**](wm-input.md) sends raw, low level data that is specific to a device.</span></span>

## <a name="registration-for-raw-input"></a><span data-ttu-id="d332e-142">Registro de entrada bruta</span><span class="sxs-lookup"><span data-stu-id="d332e-142">Registration for Raw Input</span></span>

<span data-ttu-id="d332e-143">Por padrão, nenhum aplicativo recebe entrada bruta.</span><span class="sxs-lookup"><span data-stu-id="d332e-143">By default, no application receives raw input.</span></span> <span data-ttu-id="d332e-144">Para receber a entrada bruta de um dispositivo, um aplicativo deve registrar o dispositivo.</span><span class="sxs-lookup"><span data-stu-id="d332e-144">To receive raw input from a device, an application must register the device.</span></span>

<span data-ttu-id="d332e-145">Para registrar dispositivos, um aplicativo primeiro cria uma matriz de estruturas [**RAWINPUTDEVICE**](/windows/win32/api/winuser/ns-winuser-rawinputdevice) que especificam a [coleção de nível superior](/windows-hardware/drivers/hid/top-level-collections) (TLC) para os dispositivos que ele deseja.</span><span class="sxs-lookup"><span data-stu-id="d332e-145">To register devices, an application first creates an array of [**RAWINPUTDEVICE**](/windows/win32/api/winuser/ns-winuser-rawinputdevice) structures that specify the [top level collection](/windows-hardware/drivers/hid/top-level-collections) (TLC) for the devices it wants.</span></span> <span data-ttu-id="d332e-146">O TLC é definido por uma [página de uso](/windows-hardware/drivers/hid/hid-usages#usage-page) (a classe do dispositivo) e uma [ID de uso](/windows-hardware/drivers/hid/hid-usages#usage-id) (o dispositivo dentro da classe).</span><span class="sxs-lookup"><span data-stu-id="d332e-146">The TLC is defined by a [Usage Page](/windows-hardware/drivers/hid/hid-usages#usage-page) (the class of the device) and a [Usage ID](/windows-hardware/drivers/hid/hid-usages#usage-id) (the device within the class).</span></span> <span data-ttu-id="d332e-147">Por exemplo, para obter o teclado TLC, defina UsagePage = 0x01 e Usageid = 0x06.</span><span class="sxs-lookup"><span data-stu-id="d332e-147">For example, to get the keyboard TLC, set UsagePage = 0x01 and UsageID = 0x06.</span></span> <span data-ttu-id="d332e-148">O aplicativo chama [**RegisterRawInputDevices**](/windows/win32/api/winuser/nf-winuser-registerrawinputdevices) para registrar os dispositivos.</span><span class="sxs-lookup"><span data-stu-id="d332e-148">The application calls [**RegisterRawInputDevices**](/windows/win32/api/winuser/nf-winuser-registerrawinputdevices) to register the devices.</span></span>

<span data-ttu-id="d332e-149">Observe que um aplicativo pode registrar um dispositivo que não está anexado no momento ao sistema.</span><span class="sxs-lookup"><span data-stu-id="d332e-149">Note that an application can register a device that is not currently attached to the system.</span></span> <span data-ttu-id="d332e-150">Quando esse dispositivo estiver anexado, o Gerenciador do Windows enviará automaticamente a entrada bruta para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d332e-150">When this device is attached, the Windows Manager will automatically send the raw input to the application.</span></span> <span data-ttu-id="d332e-151">Para obter a lista de dispositivos de entrada brutos no sistema, um aplicativo chama [**GetRawInputDeviceList**](/windows/win32/api/winuser/nf-winuser-getrawinputdevicelist).</span><span class="sxs-lookup"><span data-stu-id="d332e-151">To get the list of raw input devices on the system, an application calls [**GetRawInputDeviceList**](/windows/win32/api/winuser/nf-winuser-getrawinputdevicelist).</span></span> <span data-ttu-id="d332e-152">Usando o *hDevice* dessa chamada, um aplicativo chama [**GetRawInputDeviceInfo**](/windows/win32/api/winuser/nf-winuser-getrawinputdeviceinfoa) para obter as informações do dispositivo.</span><span class="sxs-lookup"><span data-stu-id="d332e-152">Using the *hDevice* from this call, an application calls [**GetRawInputDeviceInfo**](/windows/win32/api/winuser/nf-winuser-getrawinputdeviceinfoa) to get the device information.</span></span>

<span data-ttu-id="d332e-153">Por meio do membro **dwFlags** de [**RAWINPUTDEVICE**](/windows/win32/api/winuser/ns-winuser-rawinputdevice), um aplicativo pode selecionar os dispositivos a serem escutados e também aqueles que deseja ignorar.</span><span class="sxs-lookup"><span data-stu-id="d332e-153">Through the **dwFlags** member of [**RAWINPUTDEVICE**](/windows/win32/api/winuser/ns-winuser-rawinputdevice), an application can select the devices to listen to and also those it wants to ignore.</span></span> <span data-ttu-id="d332e-154">Por exemplo, um aplicativo pode solicitar entrada de todos os dispositivos de telefonia, exceto para as máquinas de resposta.</span><span class="sxs-lookup"><span data-stu-id="d332e-154">For example, an application can ask for input from all telephony devices except for answering machines.</span></span> <span data-ttu-id="d332e-155">Para obter o código de exemplo, consulte [registrando para entrada bruta](using-raw-input.md).</span><span class="sxs-lookup"><span data-stu-id="d332e-155">For sample code, see [Registering for Raw Input](using-raw-input.md).</span></span>

<span data-ttu-id="d332e-156">Observe que o mouse e o teclado também são HIDs, portanto, os dados deles podem vir por meio da [**\_ entrada do WM**](wm-input.md) de mensagem HID e de mensagens tradicionais.</span><span class="sxs-lookup"><span data-stu-id="d332e-156">Note that the mouse and the keyboard are also HIDs, so data from them can come through both the HID message [**WM\_INPUT**](wm-input.md) and from traditional messages.</span></span> <span data-ttu-id="d332e-157">Um aplicativo pode selecionar um dos métodos pela seleção apropriada de sinalizadores em [**RAWINPUTDEVICE**](/windows/win32/api/winuser/ns-winuser-rawinputdevice).</span><span class="sxs-lookup"><span data-stu-id="d332e-157">An application can select either method by the proper selection of flags in [**RAWINPUTDEVICE**](/windows/win32/api/winuser/ns-winuser-rawinputdevice).</span></span>

<span data-ttu-id="d332e-158">Para obter o status do registro de um aplicativo, chame [**GetRegisteredRawInputDevices**](/windows/win32/api/winuser/nf-winuser-getregisteredrawinputdevices) a qualquer momento.</span><span class="sxs-lookup"><span data-stu-id="d332e-158">To get an application's registration status, call [**GetRegisteredRawInputDevices**](/windows/win32/api/winuser/nf-winuser-getregisteredrawinputdevices) at any time.</span></span>

## <a name="reading-raw-input"></a><span data-ttu-id="d332e-159">Lendo entrada bruta</span><span class="sxs-lookup"><span data-stu-id="d332e-159">Reading Raw Input</span></span>

<span data-ttu-id="d332e-160">Um aplicativo recebe entrada bruta de qualquer HID cuja [coleção de nível superior](/windows-hardware/drivers/hid/top-level-collections) (TLC) corresponde a um TLC do registro.</span><span class="sxs-lookup"><span data-stu-id="d332e-160">An application receives raw input from any HID whose [top level collection](/windows-hardware/drivers/hid/top-level-collections) (TLC) matches a TLC from the registration.</span></span> <span data-ttu-id="d332e-161">Quando um aplicativo recebe entrada bruta, sua fila de mensagens Obtém uma mensagem de [**\_ entrada do WM**](wm-input.md) e o sinalizador de status da fila **QS \_ rawinput** é definido (**QS \_ entrada** também inclui esse sinalizador).</span><span class="sxs-lookup"><span data-stu-id="d332e-161">When an application receives raw input, its message queue gets a [**WM\_INPUT**](wm-input.md) message and the queue status flag **QS\_RAWINPUT** is set (**QS\_INPUT** also includes this flag).</span></span> <span data-ttu-id="d332e-162">Um aplicativo pode receber dados quando estiver em primeiro plano e quando estiver em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="d332e-162">An application can receive data when it is in the foreground and when it is in the background.</span></span>

<span data-ttu-id="d332e-163">Há duas maneiras de ler os dados brutos: o método sem buffer (ou padrão) e o método em buffer.</span><span class="sxs-lookup"><span data-stu-id="d332e-163">There are two ways to read the raw data: the unbuffered (or standard) method and the buffered method.</span></span> <span data-ttu-id="d332e-164">O método sem buffer obtém os dados brutos de uma estrutura [**rawinput**](/windows/win32/api/winuser/ns-winuser-rawinput) por vez e é adequado para muitos HIDS.</span><span class="sxs-lookup"><span data-stu-id="d332e-164">The unbuffered method gets the raw data one [**RAWINPUT**](/windows/win32/api/winuser/ns-winuser-rawinput) structure at a time and is adequate for many HIDs.</span></span> <span data-ttu-id="d332e-165">Aqui, o aplicativo chama [**GetMessage**](/windows/desktop/api/winuser/nf-winuser-getmessage) para obter a mensagem de [**\_ entrada do WM**](wm-input.md) .</span><span class="sxs-lookup"><span data-stu-id="d332e-165">Here, the application calls [**GetMessage**](/windows/desktop/api/winuser/nf-winuser-getmessage) to get the [**WM\_INPUT**](wm-input.md) message.</span></span> <span data-ttu-id="d332e-166">Em seguida, o aplicativo chama [**GetRawInputData**](/windows/win32/api/winuser/nf-winuser-getrawinputdata) usando o identificador **rawinput** contido na **\_ entrada do WM**.</span><span class="sxs-lookup"><span data-stu-id="d332e-166">Then the application calls [**GetRawInputData**](/windows/win32/api/winuser/nf-winuser-getrawinputdata) using the **RAWINPUT** handle contained in **WM\_INPUT**.</span></span> <span data-ttu-id="d332e-167">Para obter um exemplo, consulte [fazendo uma leitura padrão de entrada bruta](using-raw-input.md).</span><span class="sxs-lookup"><span data-stu-id="d332e-167">For an example, see [Doing a Standard Read of Raw Input](using-raw-input.md).</span></span>

<span data-ttu-id="d332e-168">Por outro lado, o método em buffer obtém uma matriz de estruturas [**rawinput**](/windows/win32/api/winuser/ns-winuser-rawinput) de cada vez.</span><span class="sxs-lookup"><span data-stu-id="d332e-168">In contrast, the buffered method gets an array of [**RAWINPUT**](/windows/win32/api/winuser/ns-winuser-rawinput) structures at a time.</span></span> <span data-ttu-id="d332e-169">Isso é fornecido para dispositivos que podem produzir grandes quantidades de entrada bruta.</span><span class="sxs-lookup"><span data-stu-id="d332e-169">This is provided for devices that can produce large amounts of raw input.</span></span> <span data-ttu-id="d332e-170">Nesse método, o aplicativo chama [**GetRawInputBuffer**](/windows/win32/api/winuser/nf-winuser-getrawinputbuffer) para obter uma matriz de estruturas **rawinput** .</span><span class="sxs-lookup"><span data-stu-id="d332e-170">In this method, the application calls [**GetRawInputBuffer**](/windows/win32/api/winuser/nf-winuser-getrawinputbuffer) to get an array of **RAWINPUT** structures.</span></span> <span data-ttu-id="d332e-171">Observe que a macro [**NEXTRAWINPUTBLOCK**](/windows/win32/api/winuser/nf-winuser-nextrawinputblock) é usada para atravessar uma matriz de estruturas **rawinput** .</span><span class="sxs-lookup"><span data-stu-id="d332e-171">Note that the [**NEXTRAWINPUTBLOCK**](/windows/win32/api/winuser/nf-winuser-nextrawinputblock) macro is used to traverse an array of **RAWINPUT** structures.</span></span> <span data-ttu-id="d332e-172">Para obter um exemplo, consulte [fazendo uma leitura em buffer de entrada bruta](using-raw-input.md).</span><span class="sxs-lookup"><span data-stu-id="d332e-172">For an example, see [Doing a Buffered Read of Raw Input](using-raw-input.md).</span></span>

<span data-ttu-id="d332e-173">Para interpretar a entrada bruta, são necessárias informações detalhadas sobre o HIDs.</span><span class="sxs-lookup"><span data-stu-id="d332e-173">To interpret the raw input, detailed information about the HIDs is required.</span></span> <span data-ttu-id="d332e-174">Um aplicativo obtém as informações do dispositivo chamando [**GetRawInputDeviceInfo**](/windows/win32/api/winuser/nf-winuser-getrawinputdeviceinfoa) com o identificador do dispositivo.</span><span class="sxs-lookup"><span data-stu-id="d332e-174">An application gets the device information by calling [**GetRawInputDeviceInfo**](/windows/win32/api/winuser/nf-winuser-getrawinputdeviceinfoa) with the device handle.</span></span> <span data-ttu-id="d332e-175">Esse identificador pode ser proveniente da [**\_ entrada do WM**](wm-input.md) ou do membro **hDevice** de [**RAWINPUTHEADER**](/windows/win32/api/winuser/ns-winuser-rawinputheader).</span><span class="sxs-lookup"><span data-stu-id="d332e-175">This handle can come either from [**WM\_INPUT**](wm-input.md) or from the **hDevice** member of [**RAWINPUTHEADER**](/windows/win32/api/winuser/ns-winuser-rawinputheader).</span></span>