---
description: Confiabilidade e segurança
ms.assetid: 1cbfabce-3d56-4e23-b9a7-02369c67e392
title: Confiabilidade e segurança
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8a0f0e4a244de2c1463cdadb76162c18b041812b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "105784176"
---
# <a name="reliability-and-security"></a><span data-ttu-id="362f3-103">Confiabilidade e segurança</span><span class="sxs-lookup"><span data-stu-id="362f3-103">Reliability and Security</span></span>

<span data-ttu-id="362f3-104">Como os codecs do Windows Imaging Component (WIC) serão invocados de dentro do shell do Windows e da Galeria de fotos, os autores de codec devem fazer cada esforço para garantir um alto nível de confiabilidade e segurança em seus codecs de WIC.</span><span class="sxs-lookup"><span data-stu-id="362f3-104">Because Windows Imaging Component (WIC) codecs will be invoked from within the Windows shell and Photo Gallery, codec authors should make every effort to ensure a high level of reliability and security in their WIC codecs.</span></span>

<span data-ttu-id="362f3-105">Escrever código confiável depende amplamente de práticas recomendadas de codificação, revisões de código eficazes e testes de unidade e testes de cenário completos.</span><span class="sxs-lookup"><span data-stu-id="362f3-105">Writing reliable code largely depends on good coding practices, effective code reviews, and thorough unit testing and scenario testing.</span></span> <span data-ttu-id="362f3-106">Além disso, as diretrizes a seguir ajudarão a garantir que o codec seja compatível com as políticas do Windows Vista relativas à confiabilidade.</span><span class="sxs-lookup"><span data-stu-id="362f3-106">In addition, the following guidelines will help ensure that the codec complies with Windows Vista policies regarding reliability.</span></span>

-   <span data-ttu-id="362f3-107">Habilitar O cancelamento de e/s.</span><span class="sxs-lookup"><span data-stu-id="362f3-107">Enable I/O cancellation.</span></span>

    <span data-ttu-id="362f3-108">Os autores de codec devem fornecer uma maneira para o usuário final cancelar qualquer operação de execução longa.</span><span class="sxs-lookup"><span data-stu-id="362f3-108">Codec authors should provide a way for the end user to cancel any long-running operation.</span></span> <span data-ttu-id="362f3-109">Os codecs do WIC dão suporte a isso implementando IWICBitmapProgressNotification.</span><span class="sxs-lookup"><span data-stu-id="362f3-109">WIC codecs support this by implementing IWICBitmapProgressNotification.</span></span> <span data-ttu-id="362f3-110">Isso permite que um aplicativo de chamada especifique uma função de retorno de chamada para o codec chamar em intervalos especificados para notificar o chamador do progresso da operação atual.</span><span class="sxs-lookup"><span data-stu-id="362f3-110">This allows a calling application to specify a callback function for the codec to call at specified intervals to notify the caller of the progress of the current operation.</span></span> <span data-ttu-id="362f3-111">Quando um aplicativo retorna um erro \_ cancelado da função de retorno de chamada, o codec deve cancelar qualquer operação em andamento e propagar o HRESULT de volta para o chamador.</span><span class="sxs-lookup"><span data-stu-id="362f3-111">When an application returns ERROR\_CANCELLED from the callback function, the codec must cancel whatever operation is in progress and propagate the HRESULT back to the caller.</span></span> <span data-ttu-id="362f3-112">Isso é especialmente importante para codecs BRUTOs, pois pode levar vários segundos para decodificar uma imagem bruta de tamanho completo e os aplicativos precisam de uma maneira de anular esse processamento.</span><span class="sxs-lookup"><span data-stu-id="362f3-112">This is especially important for RAW codecs, because it might take several seconds to decode a full-size RAW image and applications need a way to abort this processing.</span></span>

-   <span data-ttu-id="362f3-113">Certifique-se de que o código seja executado no menor escopo necessário para executar sua função.</span><span class="sxs-lookup"><span data-stu-id="362f3-113">Make sure that code runs in the smallest scope that is required to perform its function.</span></span>

    <span data-ttu-id="362f3-114">Os autores de codecs devem garantir que o codec não consuma mais recursos do que o necessário ou tenha um escopo maior do que o necessário.</span><span class="sxs-lookup"><span data-stu-id="362f3-114">Codec authors must ensure that the codec does not consume more resources than necessary or have a greater scope than is required.</span></span> <span data-ttu-id="362f3-115">O escopo de um codec no WIC é um arquivo de imagem única; o codec é criado quando um arquivo de imagem é carregado e o codec é liberado quando a imagem é fechada.</span><span class="sxs-lookup"><span data-stu-id="362f3-115">The scope of a codec in WIC is a single image file; the codec is created when an image file is loaded, and the codec is released when the image is closed.</span></span> <span data-ttu-id="362f3-116">Como o WIC é uma plataforma baseada em componente extensível, os codecs do WIC terão cargas e descarregamentos sobrepostos, e serão iniciados e interrompidos no mesmo processo.</span><span class="sxs-lookup"><span data-stu-id="362f3-116">Because WIC is an extensible component-based platform, WIC codecs will have overlapping loads and unloads, and starts and stops, all within the same process.</span></span> <span data-ttu-id="362f3-117">Se a infraestrutura subjacente de um codec exigir operações de iniciar e parar em um escopo maior que uma única imagem, a confiabilidade será afetada.</span><span class="sxs-lookup"><span data-stu-id="362f3-117">If the underlying infrastructure of a codec requires start and stop operations at a scope larger than a single image, reliability will be impacted.</span></span> <span data-ttu-id="362f3-118">Os codecs habilitados para WIC serão usados pelo Windows Explorer, bem como por outros aplicativos.</span><span class="sxs-lookup"><span data-stu-id="362f3-118">WIC-enabled codecs will be used by the Windows Explorer, as well as other applications.</span></span> <span data-ttu-id="362f3-119">Portanto, se um codec permanecer carregado durante o tempo de vida do processo, a memória não será liberada com eficiência e uma falha do codec poderá travar o Windows Explorer e, potencialmente, exigir que o computador seja reinicializado.</span><span class="sxs-lookup"><span data-stu-id="362f3-119">Therefore, if a codec remains loaded for the lifetime of the process, memory will not be released efficiently and a failure of the codec could hang Windows Explorer and potentially require the machine to be rebooted.</span></span> <span data-ttu-id="362f3-120">(Considere que o codec será invocado toda vez que uma imagem for reminiatura pela primeira vez no Windows Explorer: é essencial que essa seja uma operação leve.)</span><span class="sxs-lookup"><span data-stu-id="362f3-120">(Consider that the codec will be invoked every time an image is thumbnailed for the first time in Windows Explorer: it is essential that this be a lightweight operation.)</span></span>

-   <span data-ttu-id="362f3-121">Use ferramentas de análise de código estáticos e dinâmicas.</span><span class="sxs-lookup"><span data-stu-id="362f3-121">Use static and dynamic code analysis tools.</span></span>

    -   <span data-ttu-id="362f3-122">Ferramentas de análise estática:</span><span class="sxs-lookup"><span data-stu-id="362f3-122">Static analysis tools:</span></span>

        <span data-ttu-id="362f3-123">Prefixo-para detectar erros no tempo de compilação.</span><span class="sxs-lookup"><span data-stu-id="362f3-123">PREfix - for detecting errors at compile time.</span></span>

        <span data-ttu-id="362f3-124">PREfast – para analisar o código de bugs.</span><span class="sxs-lookup"><span data-stu-id="362f3-124">PREfast - for analyzing code for bugs.</span></span>

    -   <span data-ttu-id="362f3-125">Ferramentas de análise dinâmica:</span><span class="sxs-lookup"><span data-stu-id="362f3-125">Dynamic analysis tools:</span></span>

        <span data-ttu-id="362f3-126">AppVerifier – que ajuda a tornar os aplicativos mais resilientes, simulando problemas comuns de software real.</span><span class="sxs-lookup"><span data-stu-id="362f3-126">AppVerifier - which helps make applications more resilient by simulating common real-world software issues.</span></span>

-   <span data-ttu-id="362f3-127">Verifique todas as entradas nas revisões de código.</span><span class="sxs-lookup"><span data-stu-id="362f3-127">Verify all inputs in code reviews.</span></span>

    <span data-ttu-id="362f3-128">Todos os parâmetros para métodos exportados e todos os dados de arquivo devem ser cuidadosamente verificados quanto à validade e serem rejeitados de forma robusta se houver falha, a fim de se proteger contra estouros de buffer e subexecuções, estouros e estouros aritméticos e tipos inesperados.</span><span class="sxs-lookup"><span data-stu-id="362f3-128">All parameters for exported methods and all file data must be carefully verified for validity and robustly rejected if faulty, in order to protect against buffer overruns and underruns, arithmetic overflows and underflows, and unexpected types.</span></span>

-   <span data-ttu-id="362f3-129">Use técnicas de difusão de arquivos para descobrir possíveis falhas e travamentos.</span><span class="sxs-lookup"><span data-stu-id="362f3-129">Use file fuzzing techniques to discover potential crashes and hangs.</span></span>

    <span data-ttu-id="362f3-130">A difusão de arquivos é o processo de testar o codec com entradas permutadas aleatoriamente.</span><span class="sxs-lookup"><span data-stu-id="362f3-130">File fuzzing is the process of testing the codec with randomly permuted inputs.</span></span>

    <span data-ttu-id="362f3-131">Há duas formas de difusão de arquivos: difusão não direta (aleatória) e difusão direcionada.</span><span class="sxs-lookup"><span data-stu-id="362f3-131">There are two forms of file fuzzing: undirected (random) fuzzing and directed fuzzing.</span></span> <span data-ttu-id="362f3-132">A difusão não direcionada faz algum bit aleatório se invertendo para ver se a entrada aleatória pode travar o codec.</span><span class="sxs-lookup"><span data-stu-id="362f3-132">Undirected fuzzing does some random bit flipping to see if random input can crash the codec.</span></span> <span data-ttu-id="362f3-133">A difusão direcionada permuta a entrada com base em algum conhecimento do formato de arquivo.</span><span class="sxs-lookup"><span data-stu-id="362f3-133">Directed fuzzing permutes the input based on some knowledge of the file format.</span></span> <span data-ttu-id="362f3-134">Por exemplo, se houver uma CRC (verificação de redundância de ciclo) no deslocamento de byte 32, a alteração de qualquer byte sem Atualizar o CRC provavelmente não irá exercitar a maior parte do caminhos.</span><span class="sxs-lookup"><span data-stu-id="362f3-134">For example, if there is a cycle redundancy check (CRC) at byte offset 32, then changing any bytes without updating the CRC will likely not exercise most of the codepaths.</span></span> <span data-ttu-id="362f3-135">Neste exemplo, um difusor direcionado deve corrigir o CRC quando qualquer byte for modificado.</span><span class="sxs-lookup"><span data-stu-id="362f3-135">In this example, a directed fuzzer should fix the CRC when any bytes are modified.</span></span>

    <span data-ttu-id="362f3-136">O conjunto de entradas de imagens para difusão de arquivos deve ser criado para que cada combinação de parâmetros que o decodificador dê suporte seja testada.</span><span class="sxs-lookup"><span data-stu-id="362f3-136">The input set of images for file fuzzing should be created so that each parameter combination that the decoder supports is tested.</span></span> <span data-ttu-id="362f3-137">Por exemplo, se o decodificador oferecer suporte a arquivos pequenos e big-endian e três configurações de compactação, o conjunto de entrada de imagem deverá consistir em arquivos little-endian de cada configuração de compactação e em arquivos big endian para cada configuração de compactação.</span><span class="sxs-lookup"><span data-stu-id="362f3-137">For example, if the decoder supports little- and big-endian files and three compression settings, then the input set of image should consist of little-endian files of each compression setting and big-endian files for each compression setting.</span></span> <span data-ttu-id="362f3-138">Essa abordagem resultará em um conjunto grande, mas muito robusto de imagens de entrada a ser testada.</span><span class="sxs-lookup"><span data-stu-id="362f3-138">This approach will yield a large, but very robust set of input images to be tested.</span></span> <span data-ttu-id="362f3-139">Mesmo que nenhuma câmera produza cada uma das combinações, mas o decodificador dá suporte a essas combinações teóricas, os autores de codec devem difundir essas entradas.</span><span class="sxs-lookup"><span data-stu-id="362f3-139">Even if no camera produces each of the combinations but the decoder supports these theoretical combinations, codec authors should fuzz these inputs.</span></span>

    <span data-ttu-id="362f3-140">A segurança pode ser bastante aprimorada executando testes de difusão regulares de arquivos de imagem durante o desenvolvimento do codec.</span><span class="sxs-lookup"><span data-stu-id="362f3-140">Security can be greatly enhanced by regularly performing fuzz testing of image files during codec development.</span></span> <span data-ttu-id="362f3-141">Os codecs sempre devem ser capazes de detectar corrupção de arquivo de imagem e falhar normalmente no caso de uma solicitação malformada ou de dados malformados.</span><span class="sxs-lookup"><span data-stu-id="362f3-141">Codecs should always be able to detect image file corruption and fail gracefully in the case of a malformed request or of malformed data.</span></span>

-   <span data-ttu-id="362f3-142">Enfatize o código.</span><span class="sxs-lookup"><span data-stu-id="362f3-142">Stress the code.</span></span>

    <span data-ttu-id="362f3-143">Teste o codec executando-o continuamente em vários processos simultâneos, executando todas as operações com suporte em todas as sequências possíveis, em imagens de tamanhos variados (incluindo imagens muito grandes) de todas as câmeras com suporte.</span><span class="sxs-lookup"><span data-stu-id="362f3-143">Stress-test the codec by running it continually in multiple simultaneous processes, performing all supported operations in all possible sequences, on images of varying sizes (including very large images) from every supported camera.</span></span>

-   <span data-ttu-id="362f3-144">Segurança do thread.</span><span class="sxs-lookup"><span data-stu-id="362f3-144">Thread safety.</span></span>

    <span data-ttu-id="362f3-145">A partir do Windows 7, o WIC exige que os CODECs BRUTOs sejam do tipo apartment COM "both".</span><span class="sxs-lookup"><span data-stu-id="362f3-145">As of Windows 7, WIC requires that RAW CODECs be of COM apartment type "Both".</span></span> <span data-ttu-id="362f3-146">Isso significa que você deve fazer o bloqueio apropriado para lidar com chamadores entre apartamento e chamadores em cenários multi-threaded.</span><span class="sxs-lookup"><span data-stu-id="362f3-146">This means that you must do the appropriate locking to handle cross-apartment callers and callers in multi-threaded scenarios.</span></span> <span data-ttu-id="362f3-147">Os objetos dentro de um MTA (multithreaded apartment) podem ser chamados simultaneamente por qualquer número de threads no MTA, permitindo um melhor desempenho em sistemas de vários núcleos e em certos cenários de servidor.</span><span class="sxs-lookup"><span data-stu-id="362f3-147">Objects within an Multi Threaded Apartment (MTA) may be called concurrently by any number of threads within the MTA, allowing for better performance on multi-core systems and certain server scenarios.</span></span> <span data-ttu-id="362f3-148">Além disso, os CODECs do WIC que residem em um MTA podem chamar outros objetos que residem no MTA sem o custo de Marshalling associado à chamada entre threads que residem em apartments STA diferentes.</span><span class="sxs-lookup"><span data-stu-id="362f3-148">In addition, WIC CODECs that live within an MTA can call other objects that live within the MTA without the marshalling cost associated of calling between threads that live in different STA apartments.</span></span> <span data-ttu-id="362f3-149">No Windows 7, todos os CODECs de WIC na caixa foram atualizados para dar suporte a MTAs, incluindo JPEG, TIFF, PNG, GIF, ICO e BMP.</span><span class="sxs-lookup"><span data-stu-id="362f3-149">In Windows 7, all in-box WIC CODECs have been updated to support MTAs, including JPEG, TIFF, PNG, GIF, ICO, and BMP.</span></span> <span data-ttu-id="362f3-150">os CODECs de terceiros que não oferecem suporte a MTAs causarão custos de desempenho significativos em aplicativos multithread devido ao marshaling.</span><span class="sxs-lookup"><span data-stu-id="362f3-150">3rd-party CODECs that do not to support MTAs will cause significant performance costs in multithreaded applications due to marshaling.</span></span> <span data-ttu-id="362f3-151">Habilitar o suporte ao MTA requer que a sincronização adequada seja implementada no CODEC de terceiros.</span><span class="sxs-lookup"><span data-stu-id="362f3-151">Enabling MTA support requires proper synchronization to be implemented in the 3rd-party CODEC.</span></span> <span data-ttu-id="362f3-152">A implementação exata dessas técnicas de sincronização está além do escopo deste documento.</span><span class="sxs-lookup"><span data-stu-id="362f3-152">Exact implementation of these synchronization techniques is beyond the scope of this paper.</span></span> <span data-ttu-id="362f3-153">Uma referência geral para a sincronização de objetos COM é fornecida abaixo.</span><span class="sxs-lookup"><span data-stu-id="362f3-153">A general reference for synchronizing COM objects is provided below.</span></span>

    https://msdn.microsoft.com/library/ms809971.aspx

## <a name="related-topics"></a><span data-ttu-id="362f3-154">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="362f3-154">Related topics</span></span>

<dl> <dt>

<span data-ttu-id="362f3-155">**Conceitua**</span><span class="sxs-lookup"><span data-stu-id="362f3-155">**Conceptual**</span></span>
</dt> <dt>

[<span data-ttu-id="362f3-156">Visão geral do Windows Imaging Component</span><span class="sxs-lookup"><span data-stu-id="362f3-156">Windows Imaging Component Overview</span></span>](-wic-about-windows-imaging-codec.md)
</dt> <dt>

[<span data-ttu-id="362f3-157">Diretrizes do WIC para formatos de imagem bruta de câmera</span><span class="sxs-lookup"><span data-stu-id="362f3-157">WIC Guidelines for Camera RAW Image Formats</span></span>](-wic-rawguidelines.md)
</dt> <dt>

[<span data-ttu-id="362f3-158">Como escrever um CODEC de WIC-Enabled</span><span class="sxs-lookup"><span data-stu-id="362f3-158">How to Write a WIC-Enabled CODEC</span></span>](-wic-howtowriteacodec.md)
</dt> </dl>

 

 



