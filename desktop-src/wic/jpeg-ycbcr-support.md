---
description: A partir do Windows 8.1, o codec JPEG do Windows Imaging Component (WIC) dá suporte à leitura e gravação de dados de imagem em seu formato YCbCr nativo.
ms.assetid: 50B89A96-72E8-4771-9109-207F4CDD06CB
title: Suporte a JPEG YCbCr
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b6a8f05fe55e724a12513f24fc7401d277ebf097
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103921797"
---
# <a name="jpeg-ycbcr-support"></a><span data-ttu-id="29fef-103">Suporte a JPEG YCbCr</span><span class="sxs-lookup"><span data-stu-id="29fef-103">JPEG YCbCr Support</span></span>

<span data-ttu-id="29fef-104">A partir do Windows 8.1, o codec JPEG do [Windows Imaging Component (WIC)](-wic-about-windows-imaging-codec.md) dá suporte à leitura e gravação de dados de imagem em seu formulário YC<sub>b</sub>C<sub>r</sub> nativo.</span><span class="sxs-lookup"><span data-stu-id="29fef-104">Starting with Windows 8.1, the [Windows Imaging Component (WIC)](-wic-about-windows-imaging-codec.md) JPEG codec supports reading and writing image data in its native YC<sub>b</sub>C<sub>r</sub> form.</span></span> <span data-ttu-id="29fef-105">O suporte do WIC YC<sub>b</sub>c<sub>r</sub> pode ser usado em conjunto com [Direct2D](../direct2d/direct2d-portal.md) para renderizar dados do YC<sub>b</sub>C<sub>r</sub> pixel com um efeito de imagem.</span><span class="sxs-lookup"><span data-stu-id="29fef-105">WIC YC<sub>b</sub>C<sub>r</sub> support can be used in conjunction with [Direct2D](../direct2d/direct2d-portal.md) to render YC<sub>b</sub>C<sub>r</sub> pixel data with an image effect.</span></span> <span data-ttu-id="29fef-106">Além disso, o codec JPEG WIC pode consumir dados YC<sub>b</sub>C<sub>r</sub> pixel produzidos por determinados drivers de câmera por meio de Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="29fef-106">In addition, the WIC JPEG codec can consume YC<sub>b</sub>C<sub>r</sub> pixel data produced by certain camera drivers via Media Foundation.</span></span>

<span data-ttu-id="29fef-107">Os dados YC<sub>b</sub>C<sub>r</sub> pixel consumem significativamente menos memória do que os formatos de pixel BGRA padrão.</span><span class="sxs-lookup"><span data-stu-id="29fef-107">YC<sub>b</sub>C<sub>r</sub> pixel data consumes significantly less memory than standard BGRA pixel formats.</span></span> <span data-ttu-id="29fef-108">Além disso, o acesso<sub>aos dados da</sub> YC<sub>b</sub>C permite descarregar alguns estágios do pipeline de decodificação/codificação JPEG em Direct2D que é acelerado por GPU.</span><span class="sxs-lookup"><span data-stu-id="29fef-108">In addition, accessing YC<sub>b</sub>C<sub>r</sub> data allows you to offload some stages of the JPEG decode/encode pipeline to Direct2D which is GPU accelerated.</span></span> <span data-ttu-id="29fef-109">Usando o YC<sub>b</sub>C<sub>r</sub>, seu aplicativo pode reduzir o consumo de memória JPEG e tempos de carregamento para as mesmas imagens de tamanho e qualidade.</span><span class="sxs-lookup"><span data-stu-id="29fef-109">By using YC<sub>b</sub>C<sub>r</sub>, your app can reduce JPEG memory consumption and load times for the same size and quality images.</span></span> <span data-ttu-id="29fef-110">Ou, seu aplicativo pode usar imagens JPEG mais de resolução mais alta sem sofrer penalidades de desempenho.</span><span class="sxs-lookup"><span data-stu-id="29fef-110">Or, your app can use more, higher resolution JPEG images without suffering from performance penalties.</span></span>

<span data-ttu-id="29fef-111">Este tópico descreve como os dados YC<sub>b</sub>C<sub>r</sub> funcionam e como usá-los no WIC e no Direct2D.</span><span class="sxs-lookup"><span data-stu-id="29fef-111">This topic describes how YC<sub>b</sub>C<sub>r</sub> data works and how to use it in WIC and Direct2D.</span></span>

-   [<span data-ttu-id="29fef-112">Sobre dados JPEG YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="29fef-112">About JPEG YC<sub>b</sub>C<sub>r</sub> Data</span></span>](#about-jpeg-ycbcr-data)
    -   [<span data-ttu-id="29fef-113">Modelo de cor do YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="29fef-113">YC<sub>b</sub>C<sub>r</sub> Color Model</span></span>](#ycbcr-color-model)
    -   [<span data-ttu-id="29fef-114">Layouts do planar versus de memória intercalada</span><span class="sxs-lookup"><span data-stu-id="29fef-114">Planar Versus Interleaved Memory Layouts</span></span>](#planar-versus-interleaved-memory-layouts)
    -   [<span data-ttu-id="29fef-115">Subamostragem croma</span><span class="sxs-lookup"><span data-stu-id="29fef-115">Chroma Subsampling</span></span>](#chroma-subsampling)
    -   [<span data-ttu-id="29fef-116">Uso de JPEG de YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="29fef-116">JPEG Usage of YC<sub>b</sub>C<sub>r</sub></span></span>](#jpeg-usage-of-ycbcr)
-   [<span data-ttu-id="29fef-117">Usando dados JPEG YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="29fef-117">Using JPEG YC<sub>b</sub>C<sub>r</sub> Data</span></span>](#using-jpeg-ycbcr-data)
    -   [<span data-ttu-id="29fef-118">Usando imagens YC<sub>b</sub>C<sub>r</sub> JPEG</span><span class="sxs-lookup"><span data-stu-id="29fef-118">Using YC<sub>b</sub>C<sub>r</sub> JPEG images</span></span>](#using-ycbcr-jpeg-images)
    -   [<span data-ttu-id="29fef-119">APIs do Windows Imaging Component</span><span class="sxs-lookup"><span data-stu-id="29fef-119">Windows Imaging Component APIs</span></span>](#windows-imaging-component-apis)
    -   [<span data-ttu-id="29fef-120">APIs do Direct2D</span><span class="sxs-lookup"><span data-stu-id="29fef-120">Direct2D APIs</span></span>](#direct2d-apis)
    -   [<span data-ttu-id="29fef-121">Determinando se há suporte para a configuração YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="29fef-121">Determining if the YC<sub>b</sub>C<sub>r</sub> Configuration is Supported</span></span>](#determining-if-the-ycbcr-configuration-is-supported)
    -   [<span data-ttu-id="29fef-122">Decodificando dados de YC<sub>b</sub>C<sub>r</sub> pixel</span><span class="sxs-lookup"><span data-stu-id="29fef-122">Decoding YC<sub>b</sub>C<sub>r</sub> Pixel Data</span></span>](#decoding-ycbcr-pixel-data)
    -   [<span data-ttu-id="29fef-123">Transformando dados de pixel YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="29fef-123">Transforming YC<sub>b</sub>C<sub>r</sub> Pixel Data</span></span>](#transforming-ycbcr-pixel-data)
    -   [<span data-ttu-id="29fef-124">Codificando dados de YC<sub>b</sub>C<sub>r</sub> pixel</span><span class="sxs-lookup"><span data-stu-id="29fef-124">Encoding YC<sub>b</sub>C<sub>r</sub> Pixel Data</span></span>](#encoding-ycbcr-pixel-data)
    -   [<span data-ttu-id="29fef-125">Decodificando dados do YC<sub>b</sub>C<sub>r</sub> pixel no Windows 10</span><span class="sxs-lookup"><span data-stu-id="29fef-125">Decoding YC<sub>b</sub>C<sub>r</sub> pixel data in Windows 10</span></span>](#decoding-ycbcr-pixel-data-in-windows-10)
-   [<span data-ttu-id="29fef-126">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="29fef-126">Related topics</span></span>](#related-topics)

## <a name="about-jpeg-ycsubbsubcsubrsub-data"></a><span data-ttu-id="29fef-127">Sobre dados JPEG YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="29fef-127">About JPEG YC<sub>b</sub>C<sub>r</sub> Data</span></span>

<span data-ttu-id="29fef-128">Esta seção explica alguns dos principais conceitos necessários para entender como o suporte a YC<sub>b</sub>C<sub>r</sub> no WIC funciona e seus principais benefícios.</span><span class="sxs-lookup"><span data-stu-id="29fef-128">This section explains some key concepts necessary to understand how YC<sub>b</sub>C<sub>r</sub> support in WIC works and its key benefits.</span></span>

### <a name="ycsubbsubcsubrsub-color-model"></a><span data-ttu-id="29fef-129">Modelo de cor do YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="29fef-129">YC<sub>b</sub>C<sub>r</sub> Color Model</span></span>

<span data-ttu-id="29fef-130">O WIC no Windows 8 e versões anteriores oferecem suporte a quatro [modelos de cores](-wic-codec-native-pixel-formats.md)diferentes, o mais comum deles é o RGB/BGR.</span><span class="sxs-lookup"><span data-stu-id="29fef-130">WIC in Windows 8 and earlier supports four different [color models](-wic-codec-native-pixel-formats.md), the most common of which is RGB/BGR.</span></span> <span data-ttu-id="29fef-131">Esse modelo de cores define os dados de cores usando componentes vermelhos, verdes e azuis; um quarto componente alfa também pode ser usado.</span><span class="sxs-lookup"><span data-stu-id="29fef-131">This color model defines color data using red, green and blue components; a fourth alpha component may also be used.</span></span>

<span data-ttu-id="29fef-132">Aqui está uma imagem decomposta em seus componentes vermelho, verde e azul.</span><span class="sxs-lookup"><span data-stu-id="29fef-132">Here is an image decomposed into its red, green and blue components.</span></span>

![uma imagem decomposta em seus componentes vermelho, verde e azul.](graphics/ycbcr1.png)

<span data-ttu-id="29fef-134">O YC<sub>b</sub>C<sub>r</sub> é um modelo de cores alternativo que define os dados de cores usando um componente de luminância (Y) e dois componentes crominância (c<sub>b</sub> e c<sub>r</sub>).</span><span class="sxs-lookup"><span data-stu-id="29fef-134">YC<sub>b</sub>C<sub>r</sub> is an alternate color model that defines color data using a luminance component (Y) and two chrominance components (C<sub>b</sub> and C<sub>r</sub>).</span></span> <span data-ttu-id="29fef-135">Ele é comumente usado em cenários de vídeo e geração de imagens digitais.</span><span class="sxs-lookup"><span data-stu-id="29fef-135">It is commonly used in digital imaging and video scenarios.</span></span> <span data-ttu-id="29fef-136">O termo YC<sub>b</sub>C<sub>r</sub> geralmente é usado de forma intercambiável com YUV, embora os dois sejam tecnicamente distintos.</span><span class="sxs-lookup"><span data-stu-id="29fef-136">The term YC<sub>b</sub>C<sub>r</sub> is often used interchangeably with YUV, although the two are technically distinct.</span></span>

<span data-ttu-id="29fef-137">Há várias variações de YC<sub>b</sub>C<sub>r</sub> que diferem em espaço de cores e definições de intervalo dinâmico – o WIC dá suporte especificamente a dados JPEG JFIF YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="29fef-137">There are several variations of YC<sub>b</sub>C<sub>r</sub> which differ in color space and dynamic range definitions – WIC specifically supports JPEG JFIF YC<sub>b</sub>C<sub>r</sub> data.</span></span> <span data-ttu-id="29fef-138">Para obter mais informações, consulte a [especificação JPEG ITU-T81](https://www.w3.org/Graphics/JPEG/itu-t81.pdf).</span><span class="sxs-lookup"><span data-stu-id="29fef-138">For more information, refer to the [JPEG ITU-T81 specification](https://www.w3.org/Graphics/JPEG/itu-t81.pdf).</span></span>

<span data-ttu-id="29fef-139">Aqui está uma imagem decomposta em seus componentes Y, C<sub>b</sub>e c<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="29fef-139">Here is an image decomposed into its Y, C<sub>b</sub>, and C<sub>r</sub> components.</span></span>

![uma imagem decomposta em seus componentes y, CB e CR.](graphics/ycbcr2.png)

### <a name="planar-versus-interleaved-memory-layouts"></a><span data-ttu-id="29fef-141">Layouts do planar versus de memória intercalada</span><span class="sxs-lookup"><span data-stu-id="29fef-141">Planar Versus Interleaved Memory Layouts</span></span>

<span data-ttu-id="29fef-142">Esta seção descreve algumas diferenças entre acessar e armazenar dados de pixel RGB na memória versus dados de YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="29fef-142">This section describes some differences between accessing and storing RGB pixel data in memory versus YC<sub>b</sub>C<sub>r</sub> data.</span></span>

<span data-ttu-id="29fef-143">Os dados de pixel RGB normalmente são armazenados usando um layout de memória intercalada.</span><span class="sxs-lookup"><span data-stu-id="29fef-143">RGB pixel data is typically stored using an interleaved memory layout.</span></span> <span data-ttu-id="29fef-144">Isso significa que os dados de um único componente de cor são intercalados entre os pixels e cada pixel é armazenado de forma contígua na memória.</span><span class="sxs-lookup"><span data-stu-id="29fef-144">This means that data for a single color component is interleaved between pixels, and each pixel is stored contiguously in memory.</span></span>

<span data-ttu-id="29fef-145">Aqui está uma figura mostrando dados de pixels RGBA armazenados em um layout de memória intercalada.</span><span class="sxs-lookup"><span data-stu-id="29fef-145">Here is a figure showing RGBA pixel data stored in an interleaved memory layout.</span></span>

![uma figura que mostra dados de pixel RGBA armazenados em um layout de memória intercalada.](graphics/ycbcr3.png)

<span data-ttu-id="29fef-147">Os dados YC<sub>b</sub>C<sub>r</sub> normalmente são armazenados usando um layout de memória do planar.</span><span class="sxs-lookup"><span data-stu-id="29fef-147">YC<sub>b</sub>C<sub>r</sub> data is typically stored using a planar memory layout.</span></span> <span data-ttu-id="29fef-148">Isso significa que cada componente de cor é armazenado separadamente em seu próprio plano contíguo, para um total de três planos.</span><span class="sxs-lookup"><span data-stu-id="29fef-148">This means that each color component is stored separately in its own contiguous plane, for a total of three planes.</span></span> <span data-ttu-id="29fef-149">Em outra configuração comum, os componentes C<sub>b</sub> e c<sub>r</sub> são intercalados e armazenados juntos, enquanto o componente Y permanece em seu próprio plano, para um total de dois planos.</span><span class="sxs-lookup"><span data-stu-id="29fef-149">In another common configuration, the C<sub>b</sub> and C<sub>r</sub> components are interleaved and stored together, while the Y component remains in its own plane, for a total of two planes.</span></span>

<span data-ttu-id="29fef-150">Veja a seguir uma figura que mostra dados de pixels de x<sub>b</sub>c<sub>r</sub> e intercalados, um layout comum de memória YC<sub>b</sub>c<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="29fef-150">Here is a figure showing planar Y and interleaved C<sub>b</sub>C<sub>r</sub> pixel data, a common YC<sub>b</sub>C<sub>r</sub> memory layout.</span></span>

![uma figura que mostra dados de pixel CbCr e intercalados do planar, um layout de memória YCbCr comum.](graphics/ycbcr4.png)

<span data-ttu-id="29fef-152">Tanto no WIC quanto no Direct2D, cada plano de cores é tratado como seu próprio objeto distinto (um [IWICBitmapSource](-wic-imp-iwicbitmapsource.md) ou [**ID2D1Bitmap**](/windows/win32/api/d2d1/nn-d2d1-id2d1bitmap)) e, coletivamente, esses planos formam os dados de backup de uma imagem do YC <sub>b</sub>C <sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="29fef-152">In both WIC and Direct2D, each color plane is treated as its own distinct object (either an [IWICBitmapSource](-wic-imp-iwicbitmapsource.md) or [**ID2D1Bitmap**](/windows/win32/api/d2d1/nn-d2d1-id2d1bitmap)), and collectively these planes form the backing data for a YC<sub>b</sub>C<sub>r</sub> image.</span></span>

<span data-ttu-id="29fef-153">Embora o WIC dê suporte ao acesso a dados de YC<sub>b</sub>C<sub>r</sub> nas configurações de 2 e 3 planos, o Direct2D dá suporte apenas ao primeiro (s e c<sub>b</sub><sub>r</sub>).</span><span class="sxs-lookup"><span data-stu-id="29fef-153">While WIC supports accessing YC<sub>b</sub>C<sub>r</sub> data in both the 2 and 3 plane configurations, Direct2D only supports the former (Y and C<sub>b</sub>C<sub>r</sub>).</span></span> <span data-ttu-id="29fef-154">Portanto, ao usar o WIC e o Direct2D juntos, você sempre deve usar a configuração de 2 planos YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="29fef-154">Therefore, when using WIC and Direct2D together you should always use the 2 plane YC<sub>b</sub>C<sub>r</sub> configuration.</span></span>

### <a name="chroma-subsampling"></a><span data-ttu-id="29fef-155">Subamostragem croma</span><span class="sxs-lookup"><span data-stu-id="29fef-155">Chroma Subsampling</span></span>

<span data-ttu-id="29fef-156">O modelo de cor YC<sub>b</sub>C<sub>r</sub> é adequado para cenários de geração de imagens digitais, pois pode tirar proveito de determinados aspectos do sistema visual humano.</span><span class="sxs-lookup"><span data-stu-id="29fef-156">The YC<sub>b</sub>C<sub>r</sub> color model is well suited for digital imaging scenarios because it can take advantage of certain aspects of the human visual system.</span></span> <span data-ttu-id="29fef-157">Em particular, os seres humanos são mais sensíveis a alterações na luminância (brilho) de uma imagem e menos sensíveis ao crominância (cor).</span><span class="sxs-lookup"><span data-stu-id="29fef-157">In particular, humans are more sensitive to changes in the luminance (brightness) of an image and less sensitive to chrominance (color).</span></span> <span data-ttu-id="29fef-158">Ao dividir os dados de cor em componentes de luminância e crominância separados, podemos compactar seletivamente apenas os componentes do crominância para obter economia de espaço com uma perda mínima de qualidade.</span><span class="sxs-lookup"><span data-stu-id="29fef-158">By splitting the color data into separate luminance and chrominance components, we can selectively compress just the chrominance components to achieve space savings with a minimal loss in quality.</span></span>

<span data-ttu-id="29fef-159">Uma técnica para fazer isso é chamada de subamostragem croma.</span><span class="sxs-lookup"><span data-stu-id="29fef-159">One technique for doing this is called chroma subsampling.</span></span> <span data-ttu-id="29fef-160">Os planos C<sub>b</sub> e c<sub>r</sub> são subamostrados (downscaled) em uma ou ambas as dimensões horizontal e vertical.</span><span class="sxs-lookup"><span data-stu-id="29fef-160">The C<sub>b</sub> and C<sub>r</sub> planes are subsampled (downscaled) in one or both of the horizontal and vertical dimensions.</span></span> <span data-ttu-id="29fef-161">Por motivos históricos, cada modo de subamostragem croma é comumente referido usando uma proporção de três partes J:a: b.</span><span class="sxs-lookup"><span data-stu-id="29fef-161">For historical reasons, each chroma subsampling mode is commonly referred to using a three part J:a:b ratio.</span></span>



| <span data-ttu-id="29fef-162">Modo de subamostragem</span><span class="sxs-lookup"><span data-stu-id="29fef-162">Subsampling mode</span></span> | <span data-ttu-id="29fef-163">Diminuir horizontal</span><span class="sxs-lookup"><span data-stu-id="29fef-163">Horizontal downscale</span></span> | <span data-ttu-id="29fef-164">Diminuir vertical</span><span class="sxs-lookup"><span data-stu-id="29fef-164">Vertical downscale</span></span> | <span data-ttu-id="29fef-165">Bits por pixel\*</span><span class="sxs-lookup"><span data-stu-id="29fef-165">Bits per pixel\*</span></span> |
|------------------|----------------------|--------------------|------------------|
| <span data-ttu-id="29fef-166">4:4:4</span><span class="sxs-lookup"><span data-stu-id="29fef-166">4:4:4</span></span>            | <span data-ttu-id="29fef-167">1x</span><span class="sxs-lookup"><span data-stu-id="29fef-167">1x</span></span>                   | <span data-ttu-id="29fef-168">1x</span><span class="sxs-lookup"><span data-stu-id="29fef-168">1x</span></span>                 | <span data-ttu-id="29fef-169">24</span><span class="sxs-lookup"><span data-stu-id="29fef-169">24</span></span>               |
| <span data-ttu-id="29fef-170">4:2:2</span><span class="sxs-lookup"><span data-stu-id="29fef-170">4:2:2</span></span>            | <span data-ttu-id="29fef-171">2</span><span class="sxs-lookup"><span data-stu-id="29fef-171">2x</span></span>                   | <span data-ttu-id="29fef-172">1x</span><span class="sxs-lookup"><span data-stu-id="29fef-172">1x</span></span>                 | <span data-ttu-id="29fef-173">16</span><span class="sxs-lookup"><span data-stu-id="29fef-173">16</span></span>               |
| <span data-ttu-id="29fef-174">4:4:0</span><span class="sxs-lookup"><span data-stu-id="29fef-174">4:4:0</span></span>            | <span data-ttu-id="29fef-175">1x</span><span class="sxs-lookup"><span data-stu-id="29fef-175">1x</span></span>                   | <span data-ttu-id="29fef-176">2</span><span class="sxs-lookup"><span data-stu-id="29fef-176">2x</span></span>                 | <span data-ttu-id="29fef-177">16</span><span class="sxs-lookup"><span data-stu-id="29fef-177">16</span></span>               |
| <span data-ttu-id="29fef-178">4:2:0</span><span class="sxs-lookup"><span data-stu-id="29fef-178">4:2:0</span></span>            | <span data-ttu-id="29fef-179">2</span><span class="sxs-lookup"><span data-stu-id="29fef-179">2x</span></span>                   | <span data-ttu-id="29fef-180">2</span><span class="sxs-lookup"><span data-stu-id="29fef-180">2x</span></span>                 | <span data-ttu-id="29fef-181">12</span><span class="sxs-lookup"><span data-stu-id="29fef-181">12</span></span>               |



 

<span data-ttu-id="29fef-182">\* Inclui dados Y.</span><span class="sxs-lookup"><span data-stu-id="29fef-182">\* Includes Y data.</span></span>

<span data-ttu-id="29fef-183">Na tabela acima, se você usar YC<sub>b</sub>C<sub>r</sub> para armazenar dados de imagem descompactados, poderá obter uma economia de memória de 25% a 62,5% versus 32 bits por pixel RGBA de dados, dependendo de qual modo de subamostragem croma é usado.</span><span class="sxs-lookup"><span data-stu-id="29fef-183">From the above table, if you use YC<sub>b</sub>C<sub>r</sub> to store uncompressed image data you can achieve a memory savings of 25% to 62.5% versus 32 bit per pixel RGBA data, depending on which chroma subsampling mode is used.</span></span>

### <a name="jpeg-usage-of-ycsubbsubcsubrsub"></a><span data-ttu-id="29fef-184">Uso de JPEG de YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="29fef-184">JPEG Usage of YC<sub>b</sub>C<sub>r</sub></span></span>

<span data-ttu-id="29fef-185">Em um alto nível, o pipeline de descompactação JPEG consiste nos seguintes estágios:</span><span class="sxs-lookup"><span data-stu-id="29fef-185">At a high level, the JPEG decompression pipeline consists of the following stages:</span></span>

1.  <span data-ttu-id="29fef-186">Executar a descompactação de entropia (por exemplo, Huffman)</span><span class="sxs-lookup"><span data-stu-id="29fef-186">Perform entropy (e.g. Huffman) decompression</span></span>
2.  <span data-ttu-id="29fef-187">Executar desquantificação</span><span class="sxs-lookup"><span data-stu-id="29fef-187">Perform dequantization</span></span>
3.  <span data-ttu-id="29fef-188">Executar transformação de cosseno discreto inverso</span><span class="sxs-lookup"><span data-stu-id="29fef-188">Perform inverse discrete cosine transform</span></span>
4.  <span data-ttu-id="29fef-189">Executar croma upamostragem em dados C<sub>b</sub>c<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="29fef-189">Perform chroma upsampling on C<sub>b</sub>C<sub>r</sub> data</span></span>
5.  <span data-ttu-id="29fef-190">Converter dados YC<sub>b</sub>C<sub>r</sub> em RGBA (se necessário)</span><span class="sxs-lookup"><span data-stu-id="29fef-190">Convert YC<sub>b</sub>C<sub>r</sub> data to RGBA (if needed)</span></span>

<span data-ttu-id="29fef-191">Fazendo com que o codec JPEG produza dados YC<sub>b</sub>C<sub>r</sub> , podemos evitar as duas etapas finais do processo de decodificação ou adie-las para a GPU.</span><span class="sxs-lookup"><span data-stu-id="29fef-191">By having the JPEG codec produce YC<sub>b</sub>C<sub>r</sub> data, we can avoid the final two steps of the decode process, or defer them to the GPU.</span></span> <span data-ttu-id="29fef-192">Além das economias de memória listadas na seção anterior, isso reduz significativamente o tempo geral necessário para decodificar a imagem.</span><span class="sxs-lookup"><span data-stu-id="29fef-192">In addition to the memory savings listed in the previous section, this significantly reduces overall time needed to decode the image.</span></span> <span data-ttu-id="29fef-193">A mesma economia se aplicam ao codificar dados de YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="29fef-193">The same savings apply when encoding YC<sub>b</sub>C<sub>r</sub> data.</span></span>

## <a name="using-jpeg-ycsubbsubcsubrsub-data"></a><span data-ttu-id="29fef-194">Usando dados JPEG YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="29fef-194">Using JPEG YC<sub>b</sub>C<sub>r</sub> Data</span></span>

<span data-ttu-id="29fef-195">Esta seção explica como usar o WIC e o Direct2D para operar em dados do YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="29fef-195">This section explains how to use WIC and Direct2D to operate on YC<sub>b</sub>C<sub>r</sub> data.</span></span>

<span data-ttu-id="29fef-196">Para ver as diretrizes deste documento usadas na prática, consulte o [exemplo de otimizações do JPEG YCbCr no Direct2D e o WIC](https://github.com/microsoftarchive/msdn-code-gallery-microsoft/tree/master/Official%20Windows%20Platform%20Sample/JPEG%20YCbCr%20optimizations%20in%20Direct2D%20and%20WIC%20sample) , que demonstra todas as etapas necessárias para decodificar e renderizar o conteúdo do YC<sub>b</sub>C<sub>r</sub> em um aplicativo Direct2D.</span><span class="sxs-lookup"><span data-stu-id="29fef-196">To see the guidance from this document used in practice, see the [JPEG YCbCr optimizations in Direct2D and WIC sample](https://github.com/microsoftarchive/msdn-code-gallery-microsoft/tree/master/Official%20Windows%20Platform%20Sample/JPEG%20YCbCr%20optimizations%20in%20Direct2D%20and%20WIC%20sample) which demonstrates all of the steps needed to decode and render YC<sub>b</sub>C<sub>r</sub> content in a Direct2D app.</span></span>

### <a name="using-ycsubbsubcsubrsub-jpeg-images"></a><span data-ttu-id="29fef-197">Usando imagens YC<sub>b</sub>C<sub>r</sub> JPEG</span><span class="sxs-lookup"><span data-stu-id="29fef-197">Using YC<sub>b</sub>C<sub>r</sub> JPEG images</span></span>

<span data-ttu-id="29fef-198">A grande maioria das imagens JPEG é armazenada como YC<sub>b</sub>C<sub>r</sub>.</span><span class="sxs-lookup"><span data-stu-id="29fef-198">The vast majority of JPEG images are stored as YC<sub>b</sub>C<sub>r</sub>.</span></span> <span data-ttu-id="29fef-199">Alguns JPEGs contêm dados CMYK ou tons de cinza e não usam YC<sub>b</sub>C<sub>r</sub>.</span><span class="sxs-lookup"><span data-stu-id="29fef-199">Some JPEGs contain CMYK or grayscale data and do not use YC<sub>b</sub>C<sub>r</sub>.</span></span> <span data-ttu-id="29fef-200">Isso significa que você normalmente, mas nem sempre, pode usar diretamente conteúdo JPEG pré-existente sem nenhuma modificação.</span><span class="sxs-lookup"><span data-stu-id="29fef-200">This means that you typically, but not always, can directly use pre-existing JPEG content without any modifications.</span></span>

<span data-ttu-id="29fef-201">O WIC e o Direct2D não dão suporte a todas as configurações de YC<sub>b</sub>c<sub>r</sub> possíveis e o suporte a YC<sub>b</sub>c<sub>r</sub> no Direct2D depende do driver e hardware de gráficos subjacentes.</span><span class="sxs-lookup"><span data-stu-id="29fef-201">WIC and Direct2D do not support every possible YC<sub>b</sub>C<sub>r</sub> configuration, and YC<sub>b</sub>C<sub>r</sub> support in Direct2D is dependent upon the underlying graphics hardware and driver.</span></span> <span data-ttu-id="29fef-202">Por isso, um pipeline de geração de imagens de uso geral precisa ser robusto para imagens que não usam YC<sub>b</sub>C<sub>r</sub> (incluindo outros formatos de imagem comuns, como png ou bmp), ou para casos em que o suporte a C<sub>r</sub> do YC<sub>b</sub>não está disponível.</span><span class="sxs-lookup"><span data-stu-id="29fef-202">Because of this, a general purpose imaging pipeline needs to be robust to images that do not use YC<sub>b</sub>C<sub>r</sub> (including other common image formats such as PNG or BMP) or to cases where YC<sub>b</sub>C<sub>r</sub> support is not available.</span></span> <span data-ttu-id="29fef-203">Recomendamos que você mantenha seu pipeline de imagens baseado em BGRA existente e habilite o YC<sub>b</sub>C<sub>r</sub> como uma otimização de desempenho, quando disponível.</span><span class="sxs-lookup"><span data-stu-id="29fef-203">We recommend that you keep your existing BGRA based imaging pipeline and enable YC<sub>b</sub>C<sub>r</sub> as a performance optimization when available.</span></span>

### <a name="windows-imaging-component-apis"></a><span data-ttu-id="29fef-204">APIs do Windows Imaging Component</span><span class="sxs-lookup"><span data-stu-id="29fef-204">Windows Imaging Component APIs</span></span>

<span data-ttu-id="29fef-205">O WIC no Windows 8.1 adiciona três novas interfaces para fornecer acesso aos dados JPEG YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="29fef-205">WIC in Windows 8.1 adds three new interfaces to provide access to JPEG YC<sub>b</sub>C<sub>r</sub> data.</span></span>

### <a name="iwicplanarbitmapsourcetransform"></a><span data-ttu-id="29fef-206">IWICPlanarBitmapSourceTransform</span><span class="sxs-lookup"><span data-stu-id="29fef-206">IWICPlanarBitmapSourceTransform</span></span>

<span data-ttu-id="29fef-207">[**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform) é análogo a [**IWICBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsourcetransform), exceto pelo fato de que ele produz pixels em uma configuração de planar, incluindo dados de YC <sub>b</sub>C <sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="29fef-207">[**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform) is analogous to [**IWICBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsourcetransform), except that it produces pixels in a planar configuration, including YC<sub>b</sub>C<sub>r</sub> data.</span></span> <span data-ttu-id="29fef-208">Você pode obter essa interface chamando QueryInterface em uma implementação de [**IWICBitmapSource**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsource) que dá suporte ao acesso planar.</span><span class="sxs-lookup"><span data-stu-id="29fef-208">You can obtain this interface by calling QueryInterface on an implementation of [**IWICBitmapSource**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsource) that supports planar access.</span></span> <span data-ttu-id="29fef-209">Isso inclui a implementação do codec JPEG de [**IWICBitmapFrameDecode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframedecode) , bem como [**IWICBitmapScaler**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapscaler), [**IWICBitmapFlipRotator**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapfliprotator)e [**IWICColorTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwiccolortransform).</span><span class="sxs-lookup"><span data-stu-id="29fef-209">This includes the JPEG codec’s implementation of [**IWICBitmapFrameDecode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframedecode) as well as [**IWICBitmapScaler**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapscaler), [**IWICBitmapFlipRotator**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapfliprotator), and [**IWICColorTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwiccolortransform).</span></span>

### <a name="iwicplanarbitmapframeencode"></a><span data-ttu-id="29fef-210">IWICPlanarBitmapFrameEncode</span><span class="sxs-lookup"><span data-stu-id="29fef-210">IWICPlanarBitmapFrameEncode</span></span>

<span data-ttu-id="29fef-211">O [**IWICPlanarBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapframeencode) fornece a capacidade de codificar dados de pixel planar, incluindo dados do YC <sub>b</sub>C <sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="29fef-211">[**IWICPlanarBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapframeencode) provides the ability to encode planar pixel data, including YC<sub>b</sub>C<sub>r</sub> data.</span></span> <span data-ttu-id="29fef-212">Você pode obter essa interface chamando QueryInterface na implementação do codec JPEG do [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode).</span><span class="sxs-lookup"><span data-stu-id="29fef-212">You can obtain this interface by calling QueryInterface on the JPEG codec’s implementation of [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode).</span></span>

### <a name="iwicplanarformatconverter"></a><span data-ttu-id="29fef-213">IWICPlanarFormatConverter</span><span class="sxs-lookup"><span data-stu-id="29fef-213">IWICPlanarFormatConverter</span></span>

<span data-ttu-id="29fef-214">[**IWICPlanarFormatConverter**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarformatconverter) permite que o [**IWICFormatConverter**](/windows/desktop/api/Wincodec/nn-wincodec-iwicformatconverter) consuma dados de pixel planar, incluindo YC <sub>b</sub>C <sub>r</sub>, e converta-o em um formato de pixel intercalado.</span><span class="sxs-lookup"><span data-stu-id="29fef-214">[**IWICPlanarFormatConverter**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarformatconverter) allows [**IWICFormatConverter**](/windows/desktop/api/Wincodec/nn-wincodec-iwicformatconverter) to consume planar pixel data, including YC<sub>b</sub>C<sub>r</sub>, and convert it to an interleaved pixel format.</span></span> <span data-ttu-id="29fef-215">Ele não expõe a capacidade de converter dados de pixel intercalados em um formato planar.</span><span class="sxs-lookup"><span data-stu-id="29fef-215">It does not expose the ability to convert interleaved pixel data to a planar format.</span></span> <span data-ttu-id="29fef-216">Você pode obter essa interface chamando QueryInterface na implementação fornecida pelo Windows do **IWICFormatConverter**.</span><span class="sxs-lookup"><span data-stu-id="29fef-216">You can obtain this interface by calling QueryInterface on the Windows provided implementation of **IWICFormatConverter**.</span></span>

### <a name="direct2d-apis"></a><span data-ttu-id="29fef-217">APIs do Direct2D</span><span class="sxs-lookup"><span data-stu-id="29fef-217">Direct2D APIs</span></span>

<span data-ttu-id="29fef-218">Direct2D em Windows 8.1 dá suporte a dados de pixel do YC<sub>b</sub>c<sub>r</sub> com o novo efeito de imagem do YC<sub>b</sub>c<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="29fef-218">Direct2D in Windows 8.1 supports YC<sub>b</sub>C<sub>r</sub> planar pixel data with the new YC<sub>b</sub>C<sub>r</sub> image effect .</span></span> <span data-ttu-id="29fef-219">Esse efeito fornece a capacidade de renderizar dados de YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="29fef-219">This effect provides the ability to render YC<sub>b</sub>C<sub>r</sub> data.</span></span> <span data-ttu-id="29fef-220">O efeito usa como entrada duas interfaces [**ID2D1Bitmap**](/windows/win32/api/d2d1/nn-d2d1-id2d1bitmap) : uma contendo dados Y planar no formato \_ UNORM de R8 de formato dxgi \_ \_ e uma contendo dados intercalados de CbCr no formato \_ dxgi \_ R8G8 \_ UNORM.</span><span class="sxs-lookup"><span data-stu-id="29fef-220">The effect takes as input two [**ID2D1Bitmap**](/windows/win32/api/d2d1/nn-d2d1-id2d1bitmap) interfaces: one containing planar Y data in the DXGI\_FORMAT\_R8\_UNORM format, and one containing interleaved CbCr data in the DXGI\_FORMAT\_R8G8\_UNORM format.</span></span> <span data-ttu-id="29fef-221">Normalmente, você usa esse efeito no lugar do **ID2D1Bitmap** que teria contido nos dados do BGRA pixel.</span><span class="sxs-lookup"><span data-stu-id="29fef-221">You typically use this effect in place of the **ID2D1Bitmap** that would have contained BGRA pixel data.</span></span>

<span data-ttu-id="29fef-222">O efeito de imagem YC<sub>b</sub>c<sub>r</sub> deve ser usado em conjunto com as APIs do WIC YC<sub>b</sub>c<sub>r</sub> que fornecem os dados de YC<sub>b</sub>c<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="29fef-222">The YC<sub>b</sub>C<sub>r</sub> image effect is intended to be used in conjunction with the WIC YC<sub>b</sub>C<sub>r</sub> APIs which provide the YC<sub>b</sub>C<sub>r</sub> data.</span></span> <span data-ttu-id="29fef-223">Isso efetivamente atua para descarregar parte do trabalho de decodificação da CPU para a GPU, onde ela pode ser processada muito mais rapidamente e em paralelo.</span><span class="sxs-lookup"><span data-stu-id="29fef-223">This effectively acts to offload some of the decode work from the CPU to the GPU, where it can be processed much quicker and in parallel.</span></span>

### <a name="determining-if-the-ycsubbsubcsubrsub-configuration-is-supported"></a><span data-ttu-id="29fef-224">Determinando se há suporte para a configuração YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="29fef-224">Determining if the YC<sub>b</sub>C<sub>r</sub> Configuration is Supported</span></span>

<span data-ttu-id="29fef-225">Conforme observado anteriormente, seu aplicativo deve ser robusto para casos em que o suporte a YC<sub>b</sub>C<sub>r</sub> não está disponível.</span><span class="sxs-lookup"><span data-stu-id="29fef-225">As noted before, your app should be robust to cases where YC<sub>b</sub>C<sub>r</sub> support is not available.</span></span> <span data-ttu-id="29fef-226">Esta seção aborda as condições que seu aplicativo deve verificar.</span><span class="sxs-lookup"><span data-stu-id="29fef-226">This section discusses the conditions that your app should check for.</span></span> <span data-ttu-id="29fef-227">Se qualquer uma das verificações a seguir falhar, seu aplicativo deverá retornar a um pipeline padrão baseado em BGRA.</span><span class="sxs-lookup"><span data-stu-id="29fef-227">If any of the following checks fail, your app should fall back to a standard BGRA-based pipeline.</span></span>

### <a name="does-the-wic-component-support-ycsubbsubcsubrsub-data-access"></a><span data-ttu-id="29fef-228">O componente do WIC dá suporte ao acesso a dados do YC<sub>b</sub>C<sub>r</sub> ?</span><span class="sxs-lookup"><span data-stu-id="29fef-228">Does the WIC component support YC<sub>b</sub>C<sub>r</sub> data access?</span></span>

<span data-ttu-id="29fef-229">Somente o codec JPEG fornecido pelo Windows e determinadas transformações de WIC dão suporte ao acesso a dados YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="29fef-229">Only the Windows provided JPEG codec and certain WIC transforms support YC<sub>b</sub>C<sub>r</sub> data access.</span></span> <span data-ttu-id="29fef-230">Para obter uma lista completa, consulte a seção [Windows Imaging Component APIs](#windows-imaging-component-apis) .</span><span class="sxs-lookup"><span data-stu-id="29fef-230">For a complete list, refer to the [Windows Imaging Component APIs](#windows-imaging-component-apis) section.</span></span>

<span data-ttu-id="29fef-231">Para obter uma das interfaces planar YC<sub>b</sub>C<sub>r</sub> , chame QueryInterface na interface original.</span><span class="sxs-lookup"><span data-stu-id="29fef-231">To obtain one of the planar YC<sub>b</sub>C<sub>r</sub> interfaces, call QueryInterface on the original interface.</span></span> <span data-ttu-id="29fef-232">Isso falhará se o componente não oferecer suporte ao acesso a dados YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="29fef-232">This will fail if the component does not support YC<sub>b</sub>C<sub>r</sub> data access.</span></span>

### <a name="is-the-requested-wic-transform-supported-for-ycsubbsubcsubrsub"></a><span data-ttu-id="29fef-233">A transformação de WIC solicitada tem suporte para o YC<sub>b</sub>C<sub>r</sub>?</span><span class="sxs-lookup"><span data-stu-id="29fef-233">Is the requested WIC transform supported for YC<sub>b</sub>C<sub>r</sub>?</span></span>

<span data-ttu-id="29fef-234">Depois de obter um [**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform), você deve primeiro chamar [**DoesSupportTransform**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapsourcetransform-doessupporttransform).</span><span class="sxs-lookup"><span data-stu-id="29fef-234">After obtaining an [**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform), you should first call [**DoesSupportTransform**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapsourcetransform-doessupporttransform).</span></span> <span data-ttu-id="29fef-235">Esse método usa como parâmetros de entrada o conjunto completo de transformações que você deseja aplicar<sub>aos dados planar</sub> YC<sub>b</sub>C e retorna um valor booleano que indica suporte, bem como as dimensões mais próximas para o tamanho solicitado que pode ser retornado.</span><span class="sxs-lookup"><span data-stu-id="29fef-235">This method takes as input parameters the complete set of transforms that you want to be applied to the planar YC<sub>b</sub>C<sub>r</sub> data, and returns a Boolean indicating support, as well as the closest dimensions to the requested size that can be returned.</span></span> <span data-ttu-id="29fef-236">Você deve verificar todos os três valores antes de acessar os dados de pixel com [**IWICPlanarBitmapSourceTransform:: CopyPixels**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapsourcetransform-copypixels).</span><span class="sxs-lookup"><span data-stu-id="29fef-236">You should check all three values before accessing the pixel data with [**IWICPlanarBitmapSourceTransform::CopyPixels**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapsourcetransform-copypixels).</span></span>

<span data-ttu-id="29fef-237">Esse padrão é semelhante a como o [**IWICBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsourcetransform) é usado.</span><span class="sxs-lookup"><span data-stu-id="29fef-237">This pattern is similar to how [**IWICBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsourcetransform) is used.</span></span>

### <a name="does-the-graphics-driver-support-the-features-necessary-to-use-ycsubbsubcsubrsub-with-direct2d"></a><span data-ttu-id="29fef-238">O driver de gráficos dá suporte aos recursos necessários para usar o YC<sub>b</sub>C<sub>r</sub> com Direct2D?</span><span class="sxs-lookup"><span data-stu-id="29fef-238">Does the graphics driver support the features necessary to use YC<sub>b</sub>C<sub>r</sub> with Direct2D?</span></span>

<span data-ttu-id="29fef-239">Essa verificação só será necessária se você estiver usando o efeito Direct2D YC<sub>b</sub>c<sub>r</sub> para renderizar o conteúdo do YC<sub>b</sub>c<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="29fef-239">This check is only necessary if you are using the Direct2D YC<sub>b</sub>C<sub>r</sub> effect to render YC<sub>b</sub>C<sub>r</sub> content.</span></span> <span data-ttu-id="29fef-240">O Direct2D armazena dados de YC<sub>b</sub>C<sub>r</sub> usando os formatos de de \_ R8 de formato dxgi \_ \_ UNORM e dxgi \_ \_ R8G8 \_ UNORM de pixel, que não estão disponíveis em todos os drivers gráficos.</span><span class="sxs-lookup"><span data-stu-id="29fef-240">Direct2D stores YC<sub>b</sub>C<sub>r</sub> data using the DXGI\_FORMAT\_R8\_UNORM and DXGI\_FORMAT\_R8G8\_UNORM pixel formats, which are not available from all graphics drivers.</span></span>

<span data-ttu-id="29fef-241">Antes de usar o efeito de imagem YC <sub>b</sub>C <sub>r</sub> , você deve chamar [**ID2D1DeviceContext:: IsDxgiFormatSupported**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-isdxgiformatsupported) para garantir que os dois formatos tenham suporte do driver.</span><span class="sxs-lookup"><span data-stu-id="29fef-241">Before using the YC <sub>b</sub>C <sub>r</sub> image effect, you should call [**ID2D1DeviceContext::IsDxgiFormatSupported**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-isdxgiformatsupported) to ensure that both formats are supported by the driver.</span></span>

### <a name="sample-code"></a><span data-ttu-id="29fef-242">Código de exemplo</span><span class="sxs-lookup"><span data-stu-id="29fef-242">Sample code</span></span>

<span data-ttu-id="29fef-243">Veja abaixo um exemplo de código que demonstra as verificações recomendadas.</span><span class="sxs-lookup"><span data-stu-id="29fef-243">Below is a code example demonstrating the recommended checks.</span></span> <span data-ttu-id="29fef-244">Este exemplo foi tirado das [otimizações JPEG YCbCr no exemplo de Direct2D e WIC](https://github.com/microsoftarchive/msdn-code-gallery-microsoft/tree/master/Official%20Windows%20Platform%20Sample/JPEG%20YCbCr%20optimizations%20in%20Direct2D%20and%20WIC%20sample).</span><span class="sxs-lookup"><span data-stu-id="29fef-244">This example was taken from the [JPEG YCbCr optimizations in Direct2D and WIC sample](https://github.com/microsoftarchive/msdn-code-gallery-microsoft/tree/master/Official%20Windows%20Platform%20Sample/JPEG%20YCbCr%20optimizations%20in%20Direct2D%20and%20WIC%20sample).</span></span>


```C++
bool DirectXSampleRenderer::DoesWicSupportRequestedYCbCr()
{
    ComPtr<IWICPlanarBitmapSourceTransform> wicPlanarSource;
    HRESULT hr = m_wicScaler.As(&wicPlanarSource);
    if (SUCCEEDED(hr))
    {
        BOOL isTransformSupported;
        uint32 supportedWidth = m_cachedBitmapPixelWidth;
        uint32 supportedHeight = m_cachedBitmapPixelHeight;
        DX::ThrowIfFailed(
            wicPlanarSource->DoesSupportTransform(
                &supportedWidth,
                &supportedHeight,
                WICBitmapTransformRotate0,
                WICPlanarOptionsDefault,
                SampleConstants::WicYCbCrFormats,
                m_planeDescriptions,
                SampleConstants::NumPlanes,
                &isTransformSupported
                )
            );

        // The returned width and height may be larger if IWICPlanarBitmapSourceTransform does not
        // exactly support what is requested.
        if ((isTransformSupported == TRUE) &&
            (supportedWidth == m_cachedBitmapPixelWidth) &&
            (supportedHeight == m_cachedBitmapPixelHeight))
        {
            return true;
        }
    }

    return false;
}

bool DirectXSampleRenderer::DoesDriverSupportYCbCr()
{
    auto d2dContext = m_deviceResources->GetD2DDeviceContext();

    return (d2dContext->IsDxgiFormatSupported(DXGI_FORMAT_R8_UNORM)) &&
        (d2dContext->IsDxgiFormatSupported(DXGI_FORMAT_R8G8_UNORM));
}
```



### <a name="decoding-ycsubbsubcsubrsub-pixel-data"></a><span data-ttu-id="29fef-245">Decodificando dados de YC<sub>b</sub>C<sub>r</sub> pixel</span><span class="sxs-lookup"><span data-stu-id="29fef-245">Decoding YC<sub>b</sub>C<sub>r</sub> Pixel Data</span></span>

<span data-ttu-id="29fef-246">Se você quiser obter dados de YC <sub>b</sub>C <sub>r</sub> pixel, deverá chamar [**IWICPlanarBitmapSourceTransform:: CopyPixels**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapsourcetransform-copypixels).</span><span class="sxs-lookup"><span data-stu-id="29fef-246">If you want to obtain YC <sub>b</sub>C <sub>r</sub> pixel data you should call [**IWICPlanarBitmapSourceTransform::CopyPixels**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapsourcetransform-copypixels).</span></span> <span data-ttu-id="29fef-247">Esse método copia dados de pixel em uma matriz de estruturas [**WICBitmapPlane**](/windows/desktop/api/Wincodec/ns-wincodec-wicbitmapplane) preenchidas, uma para cada plano de dados desejado (por exemplo, Y e c <sub>b</sub><sub>r</sub>).</span><span class="sxs-lookup"><span data-stu-id="29fef-247">This method copies pixel data into an array of filled-out [**WICBitmapPlane**](/windows/desktop/api/Wincodec/ns-wincodec-wicbitmapplane) structures, one for each plane of data you want (for example, Y and C<sub>b</sub>C<sub>r</sub>).</span></span> <span data-ttu-id="29fef-248">Um **WICBitmapPlane** contém informações sobre os dados de pixel e aponta para o buffer de memória que receberá os dados.</span><span class="sxs-lookup"><span data-stu-id="29fef-248">A **WICBitmapPlane** contains info about the pixel data and points to the memory buffer that will receive the data.</span></span>

<span data-ttu-id="29fef-249">Se você quiser usar os dados do YC <sub>b</sub>C <sub>r</sub> pixel com outras APIs do WIC, você deve criar um [**IWICBitmap**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmap)configurado adequadamente, chamar [**Lock**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmap-lock) para obter o buffer de memória subjacente e associar o buffer ao [**WICBitmapPlane**](/windows/desktop/api/Wincodec/ns-wincodec-wicbitmapplane) usado para receber os dados do YC <sub>b</sub>C <sub>r</sub> pixel.</span><span class="sxs-lookup"><span data-stu-id="29fef-249">If you want to use the YC <sub>b</sub>C <sub>r</sub> pixel data with other WIC APIs you should create an appropriately configured [**IWICBitmap**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmap), call [**Lock**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmap-lock) to obtain the underlying memory buffer, and associate the buffer with the [**WICBitmapPlane**](/windows/desktop/api/Wincodec/ns-wincodec-wicbitmapplane) used to receive the YC<sub>b</sub>C<sub>r</sub> pixel data.</span></span> <span data-ttu-id="29fef-250">Em seguida, você pode usar o [IWICBitmap](-wic-imp-iwicbitmapdecoder.md) normalmente.</span><span class="sxs-lookup"><span data-stu-id="29fef-250">You can then use the [IWICBitmap](-wic-imp-iwicbitmapdecoder.md) normally.</span></span>

<span data-ttu-id="29fef-251">Por fim, se você quiser renderizar os dados YC <sub>b</sub>C <sub>r</sub> em Direct2D, deverá criar um [**ID2D1Bitmap**](/windows/win32/api/d2d1/nn-d2d1-id2d1bitmap) de cada [**IWICBitmap**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmap) e usá-los como fonte para o efeito de imagem do YC <sub>b</sub>C <sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="29fef-251">Finally, if you want to render the YC <sub>b</sub>C <sub>r</sub> data in Direct2D, you should create an [**ID2D1Bitmap**](/windows/win32/api/d2d1/nn-d2d1-id2d1bitmap) from each [**IWICBitmap**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmap) and use them as source for the YC<sub>b</sub>C<sub>r</sub> image effect.</span></span> <span data-ttu-id="29fef-252">O WIC permite que você solicite várias configurações de planar.</span><span class="sxs-lookup"><span data-stu-id="29fef-252">WIC allows you to request multiple planar configurations.</span></span> <span data-ttu-id="29fef-253">Ao interoperar com o Direct2D, você deve solicitar dois planos, um usando \_ o GUID WICPixelFormat8bppY e o outro usando o GUID \_ WICPixelFormat16bppCbCr, pois essa é a configuração esperada por Direct2D.</span><span class="sxs-lookup"><span data-stu-id="29fef-253">When interoperating with Direct2D you should request two planes, one using GUID\_WICPixelFormat8bppY and the other using GUID\_WICPixelFormat16bppCbCr, as this is the configuration expected by Direct2D.</span></span>

### <a name="code-sample"></a><span data-ttu-id="29fef-254">Exemplo de código</span><span class="sxs-lookup"><span data-stu-id="29fef-254">Code Sample</span></span>

<span data-ttu-id="29fef-255">Veja abaixo um exemplo de código que demonstra as etapas para decodificar e renderizar dados YC<sub>b</sub>C<sub>r</sub> em Direct2D.</span><span class="sxs-lookup"><span data-stu-id="29fef-255">Below is a code example demonstrating the steps to decode and render YC<sub>b</sub>C<sub>r</sub> data in Direct2D.</span></span> <span data-ttu-id="29fef-256">Este exemplo foi tirado das [otimizações JPEG YCbCr no exemplo de Direct2D e WIC](https://github.com/microsoftarchive/msdn-code-gallery-microsoft/tree/master/Official%20Windows%20Platform%20Sample/JPEG%20YCbCr%20optimizations%20in%20Direct2D%20and%20WIC%20sample).</span><span class="sxs-lookup"><span data-stu-id="29fef-256">This example was taken from the [JPEG YCbCr optimizations in Direct2D and WIC sample](https://github.com/microsoftarchive/msdn-code-gallery-microsoft/tree/master/Official%20Windows%20Platform%20Sample/JPEG%20YCbCr%20optimizations%20in%20Direct2D%20and%20WIC%20sample).</span></span>


```C++
void DirectXSampleRenderer::CreateYCbCrDeviceResources()
{
    auto wicFactory = m_deviceResources->GetWicImagingFactory();
    auto d2dContext = m_deviceResources->GetD2DDeviceContext();

    ComPtr<IWICPlanarBitmapSourceTransform> wicPlanarSource;
    DX::ThrowIfFailed(
        m_wicScaler.As(&wicPlanarSource)
        );

    ComPtr<IWICBitmap> bitmaps[SampleConstants::NumPlanes];
    ComPtr<IWICBitmapLock> locks[SampleConstants::NumPlanes];
    WICBitmapPlane planes[SampleConstants::NumPlanes];

    for (uint32 i = 0; i < SampleConstants::NumPlanes; i++)
    {
        DX::ThrowIfFailed(
            wicFactory->CreateBitmap(
                m_planeDescriptions[i].Width,
                m_planeDescriptions[i].Height,
                m_planeDescriptions[i].Format,
                WICBitmapCacheOnLoad,
                &bitmaps[i]
                )
            );

        LockBitmap(bitmaps[i].Get(), WICBitmapLockWrite, nullptr, &locks[i], &planes[i]);
    }

    DX::ThrowIfFailed(
        wicPlanarSource->CopyPixels(
            nullptr, // Copy the entire source region.
            m_cachedBitmapPixelWidth,
            m_cachedBitmapPixelHeight,
            WICBitmapTransformRotate0,
            WICPlanarOptionsDefault,
            planes,
            SampleConstants::NumPlanes
            )
        );

    DX::ThrowIfFailed(d2dContext->CreateEffect(CLSID_D2D1YCbCr, &m_d2dYCbCrEffect));

    ComPtr<ID2D1Bitmap1> d2dBitmaps[SampleConstants::NumPlanes];
    for (uint32 i = 0; i < SampleConstants::NumPlanes; i++)
    {
        // IWICBitmapLock must be released before using the IWICBitmap.
        locks[i] = nullptr;

        // First ID2D1Bitmap1 is DXGI_FORMAT_R8 (Y), second is DXGI_FORMAT_R8G8 (CbCr).
        DX::ThrowIfFailed(d2dContext->CreateBitmapFromWicBitmap(bitmaps[i].Get(), &d2dBitmaps[i]));
        m_d2dYCbCrEffect->SetInput(i, d2dBitmaps[i].Get());
    }
}

void DirectXSampleRenderer::LockBitmap(
    _In_ IWICBitmap *pBitmap,
    DWORD bitmapLockFlags,
    _In_opt_ const WICRect *prcSource,
    _Outptr_ IWICBitmapLock **ppBitmapLock,
    _Out_ WICBitmapPlane *pPlane
    )
{
    // ComPtr guarantees the IWICBitmapLock is released if an exception is thrown.
    ComPtr<IWICBitmapLock> lock;
    DX::ThrowIfFailed(pBitmap->Lock(prcSource, bitmapLockFlags, &lock));
    DX::ThrowIfFailed(lock->GetStride(&pPlane->cbStride));
    DX::ThrowIfFailed(lock->GetDataPointer(&pPlane->cbBufferSize, &pPlane->pbBuffer));
    DX::ThrowIfFailed(lock->GetPixelFormat(&pPlane->Format));
    *ppBitmapLock = lock.Detach();
}
```



### <a name="transforming-ycsubbsubcsubrsub-pixel-data"></a><span data-ttu-id="29fef-257">Transformando dados de pixel YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="29fef-257">Transforming YC<sub>b</sub>C<sub>r</sub> Pixel Data</span></span>

<span data-ttu-id="29fef-258">A transformação de dados YC <sub>b</sub>C <sub>r</sub> é quase idêntica à decodificação, pois ambos envolvem [**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform).</span><span class="sxs-lookup"><span data-stu-id="29fef-258">Transforming YC <sub>b</sub>C <sub>r</sub> data is nearly identical to decoding, as both involve [**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform).</span></span> <span data-ttu-id="29fef-259">A única diferença é o objeto WIC do qual você obteve a interface.</span><span class="sxs-lookup"><span data-stu-id="29fef-259">The only difference is which WIC object you obtained the interface from.</span></span> <span data-ttu-id="29fef-260">O dimensionador fornecido pelo Windows, o flip rotação e a transformação de cor dão suporte ao acesso de YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="29fef-260">The Windows provided scaler, flip rotator and color transform all support YC<sub>b</sub>C<sub>r</sub> access.</span></span>

### <a name="chaining-transforms-together"></a><span data-ttu-id="29fef-261">Encadeamento de transformações em conjunto</span><span class="sxs-lookup"><span data-stu-id="29fef-261">Chaining Transforms Together</span></span>

<span data-ttu-id="29fef-262">O WIC dá suporte à noção de encadear várias transformações.</span><span class="sxs-lookup"><span data-stu-id="29fef-262">WIC supports the notion of chaining together multiple transforms.</span></span> <span data-ttu-id="29fef-263">Por exemplo, você pode criar o seguinte pipeline de WIC:</span><span class="sxs-lookup"><span data-stu-id="29fef-263">For example, you can create the following WIC pipeline:</span></span>

![um diagrama de um pipeline de WIC começando com um decodificador JPEG.](graphics/ycbcr5.png)

<span data-ttu-id="29fef-265">Em seguida, você pode chamar QueryInterface no [**IWICColorTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwiccolortransform) para obter [**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform).</span><span class="sxs-lookup"><span data-stu-id="29fef-265">You can then call QueryInterface on the [**IWICColorTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwiccolortransform) to obtain [**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform).</span></span> <span data-ttu-id="29fef-266">A transformação de cor pode se comunicar com as transformações anteriores e pode expor os recursos agregados de cada estágio no pipeline.</span><span class="sxs-lookup"><span data-stu-id="29fef-266">The color transform can communicate with the preceding transforms and can expose the aggregate capabilities of every stage in the pipeline.</span></span> <span data-ttu-id="29fef-267">O WIC garante que os dados YC<sub>b</sub>C<sub>r</sub> sejam preservados por todo o processo.</span><span class="sxs-lookup"><span data-stu-id="29fef-267">WIC ensures that the YC<sub>b</sub>C<sub>r</sub> data is preserved through the entire process.</span></span> <span data-ttu-id="29fef-268">Esse encadeamento só funciona ao usar componentes que dão suporte ao acesso a YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="29fef-268">This chaining only works when using components that support YC<sub>b</sub>C<sub>r</sub> access.</span></span>

### <a name="jpeg-codec-optimizations"></a><span data-ttu-id="29fef-269">Otimizações de codec JPEG</span><span class="sxs-lookup"><span data-stu-id="29fef-269">JPEG Codec Optimizations</span></span>

<span data-ttu-id="29fef-270">Semelhante à implementação de decodificação de quadros JPEG de [**IWICBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsourcetransform), a implementação de decodificação de quadros JPEG do [**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform) dá suporte ao dimensionamento e à rotação de domínio JPEG DCT nativo.</span><span class="sxs-lookup"><span data-stu-id="29fef-270">Similar to the JPEG frame decode implementation of [**IWICBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsourcetransform), the JPEG frame decode implementation of [**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform) supports native JPEG DCT domain scaling and rotation.</span></span> <span data-ttu-id="29fef-271">Você pode solicitar uma potência de dois diminuir ou uma rotação diretamente do decodificador JPEG.</span><span class="sxs-lookup"><span data-stu-id="29fef-271">You can request a power of two downscale or a rotation directly from the JPEG decoder.</span></span> <span data-ttu-id="29fef-272">Isso normalmente resulta em maior qualidade e desempenho do que o uso de transformações discretas.</span><span class="sxs-lookup"><span data-stu-id="29fef-272">This typically results in higher quality and performance than using the discrete transforms.</span></span>

<span data-ttu-id="29fef-273">Além disso, quando você encadea uma ou mais transformações de WIC após o decodificador JPEG, ela pode aproveitar a escala e a rotação de JPEG nativa para atender à operação de agregação solicitada.</span><span class="sxs-lookup"><span data-stu-id="29fef-273">In addition, when you chain one or more WIC transforms after the JPEG decoder, it can leverage native JPEG scaling and rotation to satisfy the aggregate requested operation.</span></span>

### <a name="format-conversions"></a><span data-ttu-id="29fef-274">Conversões de formato</span><span class="sxs-lookup"><span data-stu-id="29fef-274">Format Conversions</span></span>

<span data-ttu-id="29fef-275">Use [**IWICPlanarFormatConverter**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarformatconverter) para converter dados de pixel planar YC <sub>b</sub>C <sub>r</sub> em um formato de pixel intercalado, como GUID \_ WICPixelFormat32bppPBGRA.</span><span class="sxs-lookup"><span data-stu-id="29fef-275">Use [**IWICPlanarFormatConverter**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarformatconverter) to convert planar YC<sub>b</sub>C<sub>r</sub> pixel data to an interleaved pixel format such as GUID\_WICPixelFormat32bppPBGRA.</span></span> <span data-ttu-id="29fef-276">O WIC no Windows 8.1 não fornece a capacidade de converter em um formato planar YC<sub>b</sub>C<sub>r</sub> pixel.</span><span class="sxs-lookup"><span data-stu-id="29fef-276">WIC in Windows 8.1 does not provide the ability to convert to a planar YC<sub>b</sub>C<sub>r</sub> pixel format.</span></span>

### <a name="encoding-ycsubbsubcsubrsub-pixel-data"></a><span data-ttu-id="29fef-277">Codificando dados de YC<sub>b</sub>C<sub>r</sub> pixel</span><span class="sxs-lookup"><span data-stu-id="29fef-277">Encoding YC<sub>b</sub>C<sub>r</sub> Pixel Data</span></span>

<span data-ttu-id="29fef-278">Use [**IWICPlanarBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapframeencode) para codificar os dados do YC <sub>b</sub>C <sub>r</sub> pixel para o codificador JPEG.</span><span class="sxs-lookup"><span data-stu-id="29fef-278">Use [**IWICPlanarBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapframeencode) to encode YC<sub>b</sub>C<sub>r</sub> pixel data to the JPEG encoder.</span></span> <span data-ttu-id="29fef-279">A codificação YC <sub>b</sub>C <sub>r</sub> data **IWICPlanarBitmapFrameEncode** é semelhante, mas não é idêntica à codificação de dados intercalados usando [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode).</span><span class="sxs-lookup"><span data-stu-id="29fef-279">Encoding YC <sub>b</sub>C <sub>r</sub> data **IWICPlanarBitmapFrameEncode** is similar but not identical to encoding interleaved data using [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode).</span></span> <span data-ttu-id="29fef-280">A interface planar só expõe a capacidade de gravar dados de imagem de quadro planar, e você deve continuar usando a interface de codificação de quadros para definir metadados ou uma miniatura e para confirmar no final da operação.</span><span class="sxs-lookup"><span data-stu-id="29fef-280">The planar interface only exposes the ability to write planar frame image data, and you should continue to use the frame encode interface to set metadata or a thumbnail and to commit at the end of the operation.</span></span>

<span data-ttu-id="29fef-281">Para o caso típico, você deve seguir estas etapas:</span><span class="sxs-lookup"><span data-stu-id="29fef-281">For the typical case, you should follow these steps:</span></span>

1.  <span data-ttu-id="29fef-282">Obtenha o [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode) como normal.</span><span class="sxs-lookup"><span data-stu-id="29fef-282">Obtain the [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode) as normal.</span></span> <span data-ttu-id="29fef-283">Se você quiser configurar a subamostragem croma, defina a opção de codificador [**JpegYCrCbSubsampling**](/windows/desktop/api/Wincodec/ne-wincodec-wicjpegycrcbsubsamplingoption) ao criar o quadro.</span><span class="sxs-lookup"><span data-stu-id="29fef-283">If you want to configure chroma subsampling, set the [**JpegYCrCbSubsampling**](/windows/desktop/api/Wincodec/ne-wincodec-wicjpegycrcbsubsamplingoption) encoder option when creating the frame.</span></span>
2.  <span data-ttu-id="29fef-284">Se você precisar definir metadados ou uma miniatura, faça isso usando [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode) como normal.</span><span class="sxs-lookup"><span data-stu-id="29fef-284">If you need to set metadata or a thumbnail, do this using [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode) as normal.</span></span>
3.  <span data-ttu-id="29fef-285">QueryInterface para o [**IWICPlanarBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapframeencode).</span><span class="sxs-lookup"><span data-stu-id="29fef-285">QueryInterface for the [**IWICPlanarBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapframeencode).</span></span>
4.  <span data-ttu-id="29fef-286">Defina os dados do YC <sub>b</sub>C <sub>r</sub> pixel usando [**IWICPlanarBitmapFrameEncode:: WriteName**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapframeencode-writesource) ou [**IWICPlanarBitmapFrameEncode:: WritePixels**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapframeencode-writepixels).</span><span class="sxs-lookup"><span data-stu-id="29fef-286">Set the YC <sub>b</sub>C <sub>r</sub> pixel data using [**IWICPlanarBitmapFrameEncode::WriteSource**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapframeencode-writesource) or [**IWICPlanarBitmapFrameEncode::WritePixels**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapframeencode-writepixels).</span></span> <span data-ttu-id="29fef-287">Ao contrário de suas contrapartes de [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode) , você fornece esses métodos com uma matriz de [**IWICBitmapSource**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsource) ou [**WICBitmapPlane**](/windows/desktop/api/Wincodec/ns-wincodec-wicbitmapplane) que contêm os planos de pixels de YC <sub>b</sub>C <sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="29fef-287">Unlike with their [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode) counterparts, you provide these methods with an array of [**IWICBitmapSource**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsource) or [**WICBitmapPlane**](/windows/desktop/api/Wincodec/ns-wincodec-wicbitmapplane) which contain the YC<sub>b</sub>C<sub>r</sub> pixel planes.</span></span>
5.  <span data-ttu-id="29fef-288">Quando tiver terminado, chame [**IWICBitmapFrameEncode:: Commit**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapframeencode-commit).</span><span class="sxs-lookup"><span data-stu-id="29fef-288">When you are finished, call [**IWICBitmapFrameEncode::Commit**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapframeencode-commit).</span></span>

### <a name="decoding-ycsubbsubcsubrsub-pixel-data-in-windows-10"></a><span data-ttu-id="29fef-289">Decodificando dados do YC<sub>b</sub>C<sub>r</sub> pixel no Windows 10</span><span class="sxs-lookup"><span data-stu-id="29fef-289">Decoding YC<sub>b</sub>C<sub>r</sub> pixel data in Windows 10</span></span>

<span data-ttu-id="29fef-290">A partir do Windows 10 Build 1507, o Direct2D fornece o [**ID2D1ImageSourceFromWic**](/windows/win32/api/d2d1_3/nn-d2d1_3-id2d1imagesourcefromwic), uma maneira mais simples de DEcodificar jpegs em Direct2D ao mesmo tempo em que aproveita as otimizações de YC <sub>b</sub>C <sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="29fef-290">Starting in Windows 10 build 1507, Direct2D provides [**ID2D1ImageSourceFromWic**](/windows/win32/api/d2d1_3/nn-d2d1_3-id2d1imagesourcefromwic), a simpler way to decode JPEGs into Direct2D while leveraging YC<sub>b</sub>C<sub>r</sub> optimizations.</span></span> <span data-ttu-id="29fef-291">O **ID2D1ImageSourceFromWic** executa automaticamente todas as verificações de funcionalidade do YC <sub>b</sub>C <sub>r</sub> necessárias para você; Ele usa o codepath otimizado quando possível e usa um fallback de outra forma.</span><span class="sxs-lookup"><span data-stu-id="29fef-291">**ID2D1ImageSourceFromWic** automatically performs all of the necessary YC<sub>b</sub>C<sub>r</sub> capability checks for you; it uses the optimized codepath when possible, and uses a fallback otherwise.</span></span> <span data-ttu-id="29fef-292">Ele também permite novas otimizações, como armazenar somente as subregiãos de cache da imagem que são necessárias por vez.</span><span class="sxs-lookup"><span data-stu-id="29fef-292">It also enables new optimizations such as only caching subregions of the image that are needed at a time.</span></span>

<span data-ttu-id="29fef-293">Para obter mais informações sobre como usar o [**ID2D1ImageSourceFromWic**](/windows/win32/api/d2d1_3/nn-d2d1_3-id2d1imagesourcefromwic), consulte o [exemplo](https://github.com/Microsoft/Windows-universal-samples/tree/master/Samples/D2DPhotoAdjustment)de SDK de ajuste de foto do Direct2D.</span><span class="sxs-lookup"><span data-stu-id="29fef-293">For more information about using [**ID2D1ImageSourceFromWic**](/windows/win32/api/d2d1_3/nn-d2d1_3-id2d1imagesourcefromwic), refer to the Direct2D Photo Adjustment SDK [sample](https://github.com/Microsoft/Windows-universal-samples/tree/master/Samples/D2DPhotoAdjustment).</span></span>

## <a name="related-topics"></a><span data-ttu-id="29fef-294">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="29fef-294">Related topics</span></span>

* [<span data-ttu-id="29fef-295">Otimizações de YCbCr JPEG no exemplo de Direct2D e WIC</span><span class="sxs-lookup"><span data-stu-id="29fef-295">JPEG YCbCr optimizations in Direct2D and WIC sample</span></span>](https://github.com/microsoftarchive/msdn-code-gallery-microsoft/tree/master/Official%20Windows%20Platform%20Sample/JPEG%20YCbCr%20optimizations%20in%20Direct2D%20and%20WIC%20sample)
