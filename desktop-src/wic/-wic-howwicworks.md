---
description: 'Saiba mais sobre: como funciona o Windows Imaging Component'
ms.assetid: c233e25b-bec6-4e67-8fbf-2bf9b70c7522
title: Como funciona o Windows Imaging Component
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9bc9fe31ae4346f2c2d1f0b273e78ed10a0ec7e6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "103662600"
---
# <a name="how-the-windows-imaging-component-works"></a><span data-ttu-id="becc1-103">Como funciona o Windows Imaging Component</span><span class="sxs-lookup"><span data-stu-id="becc1-103">How the Windows Imaging Component Works</span></span>

<span data-ttu-id="becc1-104">Este tópico contém as seguintes seções:</span><span class="sxs-lookup"><span data-stu-id="becc1-104">This topic contains the following sections:</span></span>

-   [<span data-ttu-id="becc1-105">Descoberta e arbitragem</span><span class="sxs-lookup"><span data-stu-id="becc1-105">Discovery and Arbitration</span></span>](#discovery-and-arbitration)
-   [<span data-ttu-id="becc1-106">Decodificação</span><span class="sxs-lookup"><span data-stu-id="becc1-106">Decoding</span></span>](#decoding)
-   [<span data-ttu-id="becc1-107">Codificação</span><span class="sxs-lookup"><span data-stu-id="becc1-107">Encoding</span></span>](#encoding)
-   [<span data-ttu-id="becc1-108">O tempo de vida de um codec</span><span class="sxs-lookup"><span data-stu-id="becc1-108">The Lifetime of a Codec</span></span>](#the-lifetime-of-a-codec)
-   [<span data-ttu-id="becc1-109">Como habilitar um codec por WIC</span><span class="sxs-lookup"><span data-stu-id="becc1-109">How to WIC-enabled a Codec</span></span>](#how-to-wic-enabled-a-codec)
-   [<span data-ttu-id="becc1-110">Suporte a multi-threaded apartment no WIC</span><span class="sxs-lookup"><span data-stu-id="becc1-110">Multi-Threaded Apartment Support in WIC</span></span>](#multi-threaded-apartment-support-in-wic)
-   [<span data-ttu-id="becc1-111">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="becc1-111">Related topics</span></span>](#related-topics)

## <a name="discovery-and-arbitration"></a><span data-ttu-id="becc1-112">Descoberta e arbitragem</span><span class="sxs-lookup"><span data-stu-id="becc1-112">Discovery and Arbitration</span></span>

<span data-ttu-id="becc1-113">Antes que uma imagem possa ser decodificada, é necessário encontrar um codec apropriado que possa decodificar esse formato de imagem.</span><span class="sxs-lookup"><span data-stu-id="becc1-113">Before an image can be decoded, an appropriate codec must be found that can decode that image format.</span></span> <span data-ttu-id="becc1-114">Na maioria dos sistemas, como os formatos de imagem com suporte são embutidos em código, nenhum processo de descoberta é necessário.</span><span class="sxs-lookup"><span data-stu-id="becc1-114">In most systems, because the supported image formats are hard-coded, no discovery process is required.</span></span> <span data-ttu-id="becc1-115">Como a plataforma do Windows Imaging Component (WIC) é extensível, é necessário poder identificar o formato de uma imagem e fazer a correspondência com um codec apropriado.</span><span class="sxs-lookup"><span data-stu-id="becc1-115">Because the Windows Imaging Component (WIC) platform is extensible, it’s necessary to be able to identify the format of an image and match it with an appropriate codec.</span></span>

<span data-ttu-id="becc1-116">Para dar suporte à descoberta de tempo de execução, cada formato de imagem deve ter um padrão de identificação que possa ser usado para identificar o decodificador apropriado para esse formato.</span><span class="sxs-lookup"><span data-stu-id="becc1-116">To support run-time discovery, each image format must have an identifying pattern that can be used to identify the appropriate decoder for that format.</span></span> <span data-ttu-id="becc1-117">(É altamente recomendável que, para novos formatos de arquivo, você use um GUID para o padrão de identificação, porque é garantido que ele seja exclusivo.) O padrão de identificação deve ser inserido em cada arquivo de imagem que esteja de acordo com esse formato de imagem.</span><span class="sxs-lookup"><span data-stu-id="becc1-117">(It is strongly recommended that, for new file formats, you use a GUID for the identifying pattern, because it is guaranteed to be unique.) The identifying pattern must be embedded in each image file that conforms to that image format.</span></span> <span data-ttu-id="becc1-118">Cada decodificador tem uma entrada de registro que especifica o padrão de identificação ou padrões dos formatos de imagem que pode decodificar.</span><span class="sxs-lookup"><span data-stu-id="becc1-118">Each decoder has a registry entry that specifies the identifying pattern or patterns of the image formats it can decode.</span></span> <span data-ttu-id="becc1-119">Quando um aplicativo precisa abrir uma imagem, ele solicita um decodificador do WIC.</span><span class="sxs-lookup"><span data-stu-id="becc1-119">When an application needs to open an image, it requests a decoder from WIC.</span></span> <span data-ttu-id="becc1-120">O WIC pesquisa os decodificadores disponíveis no registro e verifica cada entrada do registro em busca de um padrão de identificação que corresponda ao padrão inserido no arquivo de imagem.</span><span class="sxs-lookup"><span data-stu-id="becc1-120">WIC looks up the available decoders in the registry, and checks each registry entry for an identifying pattern that matches the pattern embedded in the image file.</span></span> <span data-ttu-id="becc1-121">Para obter mais informações sobre entradas de registro de decodificador, consulte [entradas de registro específicas do codificador](-wic-decoderregentries.md)</span><span class="sxs-lookup"><span data-stu-id="becc1-121">For more information on decoder registry entries, see [Encoder-Specific Registry Entries](-wic-decoderregentries.md)</span></span>

<span data-ttu-id="becc1-122">Quando o WIC encontra um único decodificador que corresponde ao padrão de identificação na imagem, ele cria uma instância do decodificador e passa o arquivo de imagem para ele.</span><span class="sxs-lookup"><span data-stu-id="becc1-122">When WIC finds a single decoder that matches the identifying pattern in the image, it creates an instance of the decoder and passes the image file to it.</span></span> <span data-ttu-id="becc1-123">Se o WIC encontrar mais de uma correspondência, ele invocará um método chamado [**QueryCapability**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapdecoder-querycapability) em cada decodificador correspondente para arbitrar entre eles e encontrará a melhor correspondência.</span><span class="sxs-lookup"><span data-stu-id="becc1-123">If WIC finds more than one match, it invokes a method called [**QueryCapability**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapdecoder-querycapability) on each matching decoder to arbitrate among them and find the best match.</span></span> <span data-ttu-id="becc1-124">Para obter mais informações, consulte a seção [QueryCapabilities](-wic-imp-iwicbitmapdecoder.md) em [Implementing IWICBitmapDecoder](-wic-imp-iwicbitmapdecoder.md).</span><span class="sxs-lookup"><span data-stu-id="becc1-124">For more information, see the [QueryCapabilities](-wic-imp-iwicbitmapdecoder.md) section in the [Implementing IWICBitmapDecoder](-wic-imp-iwicbitmapdecoder.md).</span></span>

## <a name="decoding"></a><span data-ttu-id="becc1-125">Decodificação</span><span class="sxs-lookup"><span data-stu-id="becc1-125">Decoding</span></span>

<span data-ttu-id="becc1-126">Depois que o decodificador apropriado tiver sido selecionado e instanciado, o aplicativo se comunica diretamente com o decodificador.</span><span class="sxs-lookup"><span data-stu-id="becc1-126">After the appropriate decoder has been selected and instantiated, the application talks directly to the decoder.</span></span> <span data-ttu-id="becc1-127">O decodificador tem várias responsabilidades, que ele implementa por meio de várias interfaces.</span><span class="sxs-lookup"><span data-stu-id="becc1-127">The decoder has several responsibilities, which it implements through various interfaces.</span></span> <span data-ttu-id="becc1-128">Esses serviços podem ser classificados como:</span><span class="sxs-lookup"><span data-stu-id="becc1-128">These services can be classified as:</span></span>

-   <span data-ttu-id="becc1-129">Serviços de nível de contêiner</span><span class="sxs-lookup"><span data-stu-id="becc1-129">Container-level services</span></span>
-   <span data-ttu-id="becc1-130">Serviços de nível de quadro</span><span class="sxs-lookup"><span data-stu-id="becc1-130">Frame-level services</span></span>
-   <span data-ttu-id="becc1-131">Serviços de enumeração de metadados</span><span class="sxs-lookup"><span data-stu-id="becc1-131">Metadata enumeration services</span></span>
-   <span data-ttu-id="becc1-132">Transformações de decodificador nativo</span><span class="sxs-lookup"><span data-stu-id="becc1-132">Native decoder transforms</span></span>
-   <span data-ttu-id="becc1-133">Notificações de progresso e suporte ao cancelamento</span><span class="sxs-lookup"><span data-stu-id="becc1-133">Progress notifications and cancellation support</span></span>
-   <span data-ttu-id="becc1-134">Serviços de processamento bruto</span><span class="sxs-lookup"><span data-stu-id="becc1-134">Raw processing services</span></span>

<span data-ttu-id="becc1-135">Os serviços de nível de contêiner incluem a recuperação da miniatura de nível superior (se houver suporte), visualização, contextos de cor, paleta (se aplicável) e formato de contêiner, além de fornecer acesso aos quadros de imagem individuais no contêiner.</span><span class="sxs-lookup"><span data-stu-id="becc1-135">Container-level services include retrieving the top-level thumbnail (if supported), preview, color contexts, palette (if applicable), and container format, as well as providing access to the individual image frames within the container.</span></span> <span data-ttu-id="becc1-136">(Alguns contêineres contêm apenas um único quadro, enquanto outros, como TIFF, podem conter vários quadros.) Esse conjunto de serviços também inclui fornecer informações sobre o próprio decodificador e seus recursos em relação a um arquivo de imagem específico.</span><span class="sxs-lookup"><span data-stu-id="becc1-136">(Some containers contain only a single frame while others, such as Tagged Image File Format (TIFF), can contain multiple frames.) This set of services also includes providing information about the decoder itself, and its capabilities with respect to a specific image file.</span></span>

<span data-ttu-id="becc1-137">Quadros individuais têm suas próprias miniaturas e também podem ter seus próprios contextos de cor, paletas e outras propriedades, que são expostos no nível do quadro.</span><span class="sxs-lookup"><span data-stu-id="becc1-137">Individual frames have their own thumbnails, and may also have their own color contexts, palettes, and other properties, which are exposed at the frame level.</span></span> <span data-ttu-id="becc1-138">No entanto, a operação mais importante executada no nível de quadro é a decodificação real dos bits de imagem para esse quadro.</span><span class="sxs-lookup"><span data-stu-id="becc1-138">The most important operation performed at the frame level, though, is the actual decoding of the image bits for that frame.</span></span>

<span data-ttu-id="becc1-139">O WIC fornece leitores de metadados para os formatos de metadados mais comuns (IFD, EXIF, IPTC, XMP, APP0, APP1 e outros formatos) e também oferece suporte a extensibilidade para formatos de metadados de terceiros.</span><span class="sxs-lookup"><span data-stu-id="becc1-139">WIC provides metadata readers for the most common metadata formats (IFD, EXIF, IPTC, XMP, APP0, APP1, and other formats), and also supports extensibility for third-party metadata formats.</span></span> <span data-ttu-id="becc1-140">Isso libera o codec da responsabilidade de análise de metadados.</span><span class="sxs-lookup"><span data-stu-id="becc1-140">This frees the codec of the responsibility for parsing metadata.</span></span> <span data-ttu-id="becc1-141">No entanto, o codec é responsável por enumerar os blocos de metadados e solicitar um leitor de metadados para cada bloco.</span><span class="sxs-lookup"><span data-stu-id="becc1-141">However, the codec is responsible for enumerating the metadata blocks and requesting a metadata reader for each block.</span></span> <span data-ttu-id="becc1-142">O WIC executa a descoberta de manipuladores de metadados da mesma maneira que faz para codecs, com base em um padrão no cabeçalho de bloco que corresponde a um padrão na entrada de registro do manipulador de metadados.</span><span class="sxs-lookup"><span data-stu-id="becc1-142">WIC performs discovery for metadata handlers the same way it does for codecs, based on a pattern in the block header matching a pattern in the metadata handler’s registry entry.</span></span> <span data-ttu-id="becc1-143">Para obter mais informações, consulte as [entradas de registro específicas do codificador](-wic-decoderregentries.md)</span><span class="sxs-lookup"><span data-stu-id="becc1-143">For more information, see the [Encoder-Specific Registry Entries](-wic-decoderregentries.md)</span></span>

<span data-ttu-id="becc1-144">Os decodificadores não são necessários para dar suporte nativo a operações de transformação, mas isso permite otimizações de desempenho significativas que fornecem uma melhor experiência do usuário final.</span><span class="sxs-lookup"><span data-stu-id="becc1-144">Decoders are not required to natively support transform operations, but doing so enables significant performance optimizations that provide a better end-user experience.</span></span> <span data-ttu-id="becc1-145">Por exemplo, um aplicativo pode criar um pipeline de várias transformações (dimensionamento, corte, rotação e conversão de formato de pixel) para executar em uma imagem antes que a imagem seja renderizada.</span><span class="sxs-lookup"><span data-stu-id="becc1-145">For example, an application can create a pipeline of various transforms (scaling, cropping, rotation, and pixel format conversion) to perform on an image before the image is rendered.</span></span> <span data-ttu-id="becc1-146">Para obter mais informações sobre pipelines de transformação, consulte [IWICBitmapSource](-wic-imp-iwicbitmapsource.md).</span><span class="sxs-lookup"><span data-stu-id="becc1-146">For more information on transform pipelines, see [IWICBitmapSource](-wic-imp-iwicbitmapsource.md).</span></span> <span data-ttu-id="becc1-147">Depois de criar um pipeline de transformação, o aplicativo solicita a transformação final no pipeline para produzir o bitmap resultante da aplicação de todas as transformações à origem da imagem.</span><span class="sxs-lookup"><span data-stu-id="becc1-147">After creating a transform pipeline, the application requests the final transform in the pipeline to produce the bitmap that results from applying all the transforms to the image source.</span></span> <span data-ttu-id="becc1-148">Nesse ponto, se o próprio decodificador for capaz de executar operações de transformação, o WIC perguntará quais das transformações solicitadas ele pode executar.</span><span class="sxs-lookup"><span data-stu-id="becc1-148">At that point, if the decoder itself is able to perform transform operations, WIC asks which of the requested transforms it can perform.</span></span> <span data-ttu-id="becc1-149">Todas as transformações solicitadas que o decodificador não pode executar serão executadas pelo WIC na imagem decodificada antes de retorná-la ao chamador.</span><span class="sxs-lookup"><span data-stu-id="becc1-149">Any requested transforms the decoder cannot perform will be performed by WIC on the decoded image before returning it to the caller.</span></span> <span data-ttu-id="becc1-150">Esse pipeline de transformação otimizado fornece melhor desempenho do que executar cada transformação sequencialmente na memória, especialmente quando algumas ou todas as transformações podem ser realizadas durante o processo de decodificação.</span><span class="sxs-lookup"><span data-stu-id="becc1-150">This optimized transform pipeline provides better performance than performing each transform sequentially in memory, particularly when some or all of the transforms can be accomplished during the decoding process.</span></span>

<span data-ttu-id="becc1-151">As notificações de progresso e o suporte ao cancelamento permitem que um aplicativo solicite notificações de progresso para operações demoradas e também permite que o usuário dê uma oportunidade para cancelar uma operação que está demorando muito.</span><span class="sxs-lookup"><span data-stu-id="becc1-151">Progress notifications and cancellation support enable an application to request progress notifications for lengthy operations, and also enable the application to give the user an opportunity to cancel an operation that is taking too long.</span></span> <span data-ttu-id="becc1-152">Isso é importante porque, se um usuário não puder cancelar uma operação, ele poderá sentir que o processo foi suspenso e tentar cancelá-lo fechando o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="becc1-152">This is important because if a user cannot cancel an operation, he or she may feel the process has hung, and try to cancel it by closing the application.</span></span>

<span data-ttu-id="becc1-153">Essas interfaces são descritas em detalhes na seção sobre como [implementar um decodificador de WIC-Enabled](-wic-implementingwicdecoder.md).</span><span class="sxs-lookup"><span data-stu-id="becc1-153">These interfaces are described in detail in the section on [Implementing a WIC-Enabled Decoder](-wic-implementingwicdecoder.md).</span></span>

<span data-ttu-id="becc1-154">Os serviços de processamento bruto incluem o ajuste das configurações da câmera, como exposição, contraste e nitidez, ou a alteração do espaço de cores antes de processar os bits brutos.</span><span class="sxs-lookup"><span data-stu-id="becc1-154">Raw processing services include adjusting camera settings, such as exposure, contrast, and sharpening, or changing the color space before processing the raw bits.</span></span>

## <a name="encoding"></a><span data-ttu-id="becc1-155">Codificação</span><span class="sxs-lookup"><span data-stu-id="becc1-155">Encoding</span></span>

<span data-ttu-id="becc1-156">Como os decodificadores, os codificadores têm responsabilidades que eles implementam por meio de interfaces.</span><span class="sxs-lookup"><span data-stu-id="becc1-156">Like decoders, encoders have responsibilities that they implement through interfaces.</span></span> <span data-ttu-id="becc1-157">Os serviços que os codificadores fornecem são complementares aos serviços fornecidos pelos decodificadores, exceto pelo fato de eles gravarem dados de imagem em vez de lê-los.</span><span class="sxs-lookup"><span data-stu-id="becc1-157">The services that encoders provide are complementary to the services provided by decoders, except they write out image data rather than reading it.</span></span> <span data-ttu-id="becc1-158">Os codificadores também fornecem serviços nas seguintes categorias:</span><span class="sxs-lookup"><span data-stu-id="becc1-158">Encoders also provide services in the following categories:</span></span>

-   <span data-ttu-id="becc1-159">Serviços de nível de contêiner</span><span class="sxs-lookup"><span data-stu-id="becc1-159">Container-level services</span></span>
-   <span data-ttu-id="becc1-160">Serviços de nível de quadro</span><span class="sxs-lookup"><span data-stu-id="becc1-160">Frame-level services</span></span>
-   <span data-ttu-id="becc1-161">Serviços de enumeração e atualização de metadados</span><span class="sxs-lookup"><span data-stu-id="becc1-161">Metadata enumeration and update services</span></span>
-   <span data-ttu-id="becc1-162">Notificação de progresso e suporte ao cancelamento</span><span class="sxs-lookup"><span data-stu-id="becc1-162">Progress notification and cancellation support</span></span>

<span data-ttu-id="becc1-163">Os serviços de nível de contêiner para um codificador incluem a definição da miniatura de nível superior (se houver suporte), a visualização e a paleta (se aplicável) e a iteração por meio de quadros de imagem individuais para que eles possam ser serializados no contêiner.</span><span class="sxs-lookup"><span data-stu-id="becc1-163">Container-level services for an encoder include setting the top-level thumbnail (if supported), preview, and palette (if applicable), and iterating through the individual image frames so they can be serialized into the container.</span></span>

<span data-ttu-id="becc1-164">Os serviços de nível de quadro para um codificador espelham aqueles para o decodificador, exceto que eles gravam os dados da imagem, a miniatura e qualquer paleta associada ou outro componente, em vez de lê-los.</span><span class="sxs-lookup"><span data-stu-id="becc1-164">Frame-level services for an encoder mirror those for the decoder, except that they write out the image data, thumbnail, and any associated palette or other component, rather than reading them.</span></span>

<span data-ttu-id="becc1-165">Além disso, os serviços de enumeração de metadados para um codificador incluem a iteração através dos blocos de metadados a serem gravados e a invocação dos gravadores de metadados apropriados para serializar os metadados no disco.</span><span class="sxs-lookup"><span data-stu-id="becc1-165">Also, metadata enumeration services for an encoder include iterating through the metadata blocks to be written, and invoking the appropriate metadata writers to serialize the metadata to disk.</span></span>

<span data-ttu-id="becc1-166">Essas interfaces são descritas em detalhes na seção sobre como [implementar um codificador de WIC-Enabled](-wic-implementingwicencoder.md).</span><span class="sxs-lookup"><span data-stu-id="becc1-166">These interfaces are described in detail in the section on [Implementing a WIC-Enabled Encoder](-wic-implementingwicencoder.md).</span></span>

## <a name="the-lifetime-of-a-codec"></a><span data-ttu-id="becc1-167">O tempo de vida de um codec</span><span class="sxs-lookup"><span data-stu-id="becc1-167">The Lifetime of a Codec</span></span>

<span data-ttu-id="becc1-168">Um codec do WIC é instanciado para lidar com uma única imagem e geralmente tem um tempo de vida curto.</span><span class="sxs-lookup"><span data-stu-id="becc1-168">A WIC codec is instantiated to handle a single image, and usually has a short lifetime.</span></span> <span data-ttu-id="becc1-169">Ele é criado quando uma imagem é carregada e liberada quando a imagem é fechada.</span><span class="sxs-lookup"><span data-stu-id="becc1-169">It’s created when an image is loaded and is released when the image is closed.</span></span> <span data-ttu-id="becc1-170">Um aplicativo pode usar um grande número de codecs simultaneamente com tempos de vida sobrepostos (imagine a rolagem por meio de um diretório contendo centenas de imagens) e vários aplicativos podem estar fazendo isso ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="becc1-170">An application may use a large number of codecs simultaneously with overlapping lifetimes (think of scrolling through a directory containing hundreds of images), and multiple applications may be doing this at the same time.</span></span>

<span data-ttu-id="becc1-171">Embora alguns codecs tenham um tempo de vida definido para o tempo de vida do processo no qual residem, esse não é o caso dos codecs do WIC.</span><span class="sxs-lookup"><span data-stu-id="becc1-171">Although some codecs have a lifetime that is scoped to the lifetime of the process in which they live, this is not the case with WIC codecs.</span></span> <span data-ttu-id="becc1-172">A Galeria de fotos do Windows Vista, o Windows Explorer e o Visualizador de fotos, bem como vários outros aplicativos, se baseiam no WIC e usarão seu codec para exibir imagens e miniaturas.</span><span class="sxs-lookup"><span data-stu-id="becc1-172">The Windows Vista Photo Gallery, Windows Explorer, and Photo Viewer, as well as numerous other applications, are built on WIC and will be using your codec to display images and thumbnails.</span></span> <span data-ttu-id="becc1-173">Se o tempo de vida do seu codec estivesse no escopo da vida útil do processo, sempre que uma imagem ou miniatura fosse exibida no Windows Vista Explorer, o codec instanciado para decodificar essa imagem permaneceria na memória até a próxima vez que o usuário reiniciou seu computador.</span><span class="sxs-lookup"><span data-stu-id="becc1-173">If the lifetime of your codec were scoped to the lifetime of the process, every time an image or thumbnail was displayed in the Windows Vista Explorer, the codec instantiated to decode that image would remain in memory until the next time the user restarted his or her computer.</span></span> <span data-ttu-id="becc1-174">Se o codec nunca for descarregado, seus recursos estarão, em vigor, "vazados" porque não podem ser usados por nenhum outro componente no sistema.</span><span class="sxs-lookup"><span data-stu-id="becc1-174">If your codec is never unloaded, its resources are, in effect, "leaked" because they can't be used by any other component in the system.</span></span>

## <a name="how-to-wic-enabled-a-codec"></a><span data-ttu-id="becc1-175">Como habilitar um codec por WIC</span><span class="sxs-lookup"><span data-stu-id="becc1-175">How to WIC-enabled a Codec</span></span>

1.  <span data-ttu-id="becc1-176">Implemente uma classe de decodificador de nível de contêiner e uma classe de decodificador de nível de quadro que expõe as interfaces WIC necessárias para decodificar imagens e iterar por meio de blocos de metadados.</span><span class="sxs-lookup"><span data-stu-id="becc1-176">Implement a container-level decoder class and a frame-level decoder class that exposes the required WIC interfaces for decoding images and iterating through blocks of metadata.</span></span> <span data-ttu-id="becc1-177">Isso permite que todos os aplicativos baseados em WIC interajam com o codec da mesma maneira que interagem com formatos de imagem padrão.</span><span class="sxs-lookup"><span data-stu-id="becc1-177">This enables all WIC-based applications to interact with your codec the same way they interact with standard image formats.</span></span>
2.  <span data-ttu-id="becc1-178">Implemente uma classe de codificador de nível de contêiner e uma classe de codificador de nível de quadro que exponha as interfaces WIC necessárias para codificar imagens e serializar blocos de metadados em um arquivo de imagem.</span><span class="sxs-lookup"><span data-stu-id="becc1-178">Implement a container-level encoder class and a frame-level encoder class that exposes the required WIC interfaces for encoding images and serializing blocks of metadata into an image file.</span></span>
3.  <span data-ttu-id="becc1-179">Se o formato do contêiner não for baseado em um contêiner TIFF ou JPEG, talvez seja necessário gravar manipuladores de metadados para os formatos de metadados comuns (EXIF, XMP).</span><span class="sxs-lookup"><span data-stu-id="becc1-179">If your container format is not based on a TIFF or JPEG container, you may need to write metadata handlers for the common metadata formats (EXIF, XMP).</span></span> <span data-ttu-id="becc1-180">No entanto, se você usar um formato de contêiner baseado em TIFF ou JPEG, isso não é necessário porque você pode delegar aos manipuladores de metadados fornecidos pelo sistema.</span><span class="sxs-lookup"><span data-stu-id="becc1-180">However, if you use a TIFF-based or JPEG-based container format, this is not necessary because you can delegate to the system-provided metadata handlers.</span></span>
4.  <span data-ttu-id="becc1-181">Insira um padrão de identificação exclusivo (recomendamos um GUID) em todos os arquivos de imagem.</span><span class="sxs-lookup"><span data-stu-id="becc1-181">Embed a unique identifying pattern (we recommend a GUID) in all your image files.</span></span> <span data-ttu-id="becc1-182">Isso permite que seu formato de imagem seja correspondido em relação ao seu codec durante a descoberta.</span><span class="sxs-lookup"><span data-stu-id="becc1-182">This enables your image format to be matched against your codec during the discovery.</span></span> <span data-ttu-id="becc1-183">Se você estiver escrevendo um wrapper de WIC para um formato de imagem existente, deverá encontrar um padrão de bits que o codificador sempre grava em seus arquivos de imagem que sejam exclusivos desse formato de imagem e usá-lo como o padrão de identificação.)</span><span class="sxs-lookup"><span data-stu-id="becc1-183">If you are writing a WIC wrapper for an existing image format, you must find a pattern of bits that the encoder always writes into its image files that’s unique to that image format, and use this as the identifying pattern.)</span></span>
5.  <span data-ttu-id="becc1-184">Registre seu codec no momento da instalação.</span><span class="sxs-lookup"><span data-stu-id="becc1-184">Register your codec at installation time.</span></span> <span data-ttu-id="becc1-185">Isso permite que o codec seja descoberto em tempo de execução, combinando o padrão de identificação no registro com o padrão inserido no arquivo de imagem.</span><span class="sxs-lookup"><span data-stu-id="becc1-185">This enables your codec to be discovered at run time by matching the identifying pattern in the registry with the pattern embedded in the image file.</span></span>
6.  <span data-ttu-id="becc1-186">A partir do Windows 7, o WIC exige que os codecs sejam do tipo apartment COM "both".</span><span class="sxs-lookup"><span data-stu-id="becc1-186">As of Windows 7, WIC requires that codecs be of COM apartment type "Both".</span></span> <span data-ttu-id="becc1-187">Isso significa que você deve fazer o bloqueio apropriado para lidar com chamadores entre apartamento e chamadores em cenários multi-threaded.</span><span class="sxs-lookup"><span data-stu-id="becc1-187">This means that you must do the appropriate locking to handle cross-apartment callers and callers in multi-threaded scenarios.</span></span> <span data-ttu-id="becc1-188">Para obter mais informações, consulte a próxima seção sobre o suporte a multi-threaded apartment.</span><span class="sxs-lookup"><span data-stu-id="becc1-188">For more information, see the next section on multi-threaded apartment support.</span></span>
7.  <span data-ttu-id="becc1-189">Suporte para plataformas de 64 bits: para o Windows 7, o WIC exigirá que os codecs de WIC de terceiros sejam entregues como binários nativos de 32 bits e de 64 bits.</span><span class="sxs-lookup"><span data-stu-id="becc1-189">Support for 64-bit platforms: For Windows 7, WIC will require that third-party WIC codecs be delivered as both 32-bit and 64-bit native binaries.</span></span> <span data-ttu-id="becc1-190">Além disso, o formato de 32 bits deve ser instalado e executado em sistemas de 64 bits, e o instalador de codecs do Windows 7 de terceiros deve instalar os binários de 32 bits e de 64 bits em sistemas de bits de 64.</span><span class="sxs-lookup"><span data-stu-id="becc1-190">Further, the 32-bit form must install and run on 64-bit systems, and the third party Windows 7 codec installer must install both the 32-bit and 64-bit binaries on 64-bit systems.</span></span>

## <a name="multi-threaded-apartment-support-in-wic"></a><span data-ttu-id="becc1-191">Suporte a multi-threaded apartment no WIC</span><span class="sxs-lookup"><span data-stu-id="becc1-191">Multi-Threaded Apartment Support in WIC</span></span>

<span data-ttu-id="becc1-192">Os objetos em um multi-threaded apartment (MTA) podem ser chamados simultaneamente por qualquer número de threads dentro do MTA.</span><span class="sxs-lookup"><span data-stu-id="becc1-192">Objects within a Multi-Threaded Apartment (MTA) may be called concurrently by any number of threads within the MTA.</span></span> <span data-ttu-id="becc1-193">Isso permite um melhor desempenho em sistemas de vários núcleos e em determinados cenários de servidor.</span><span class="sxs-lookup"><span data-stu-id="becc1-193">This allows for better performance on multi-core systems and certain server scenarios.</span></span> <span data-ttu-id="becc1-194">Além disso, os codecs do WIC em um MTA podem chamar outros objetos no MTA sem o custo de Marshalling associado à chamada entre threads em apartments STA diferentes.</span><span class="sxs-lookup"><span data-stu-id="becc1-194">In addition, WIC codecs in an MTA can call other objects in the MTA without the marshalling cost associated with calling between threads in different STA apartments.</span></span> <span data-ttu-id="becc1-195">No Windows 7, todos os codecs de WIC na caixa foram atualizados para dar suporte a MTAs, incluindo JPEG, TIFF, PNG, GIF, ICO e BMP.</span><span class="sxs-lookup"><span data-stu-id="becc1-195">In Windows 7, all in-box WIC codecs have been updated to support MTAs, including JPEG, TIFF, PNG, GIF, ICO, and BMP.</span></span> <span data-ttu-id="becc1-196">É altamente recomendável que os codecs de terceiros sejam escritos para dar suporte a MTAs.</span><span class="sxs-lookup"><span data-stu-id="becc1-196">It is highly recommended that third-party codecs be written to support MTAs.</span></span> <span data-ttu-id="becc1-197">Os codecs de terceiros que não oferecem suporte a MTAs causam custos de desempenho significativos em aplicativos multi-threaded devido ao marshaling.</span><span class="sxs-lookup"><span data-stu-id="becc1-197">Third-party codecs that do not to support MTAs cause significant performance costs in multi-threaded applications because of marshaling.</span></span> <span data-ttu-id="becc1-198">Habilitar o suporte ao MTA requer que a sincronização adequada seja implementada no codec de terceiros.</span><span class="sxs-lookup"><span data-stu-id="becc1-198">Enabling MTA support requires proper synchronization to be implemented in the third-party codec.</span></span> <span data-ttu-id="becc1-199">A implementação exata dessas técnicas de sincronização está além do escopo deste documento.</span><span class="sxs-lookup"><span data-stu-id="becc1-199">Exact implementation of these synchronization techniques is beyond the scope of this paper.</span></span> <span data-ttu-id="becc1-200">Para obter mais informações sobre a sincronização de objetos COM, consulte [compreendendo e usando modelos de THREADING com](/previous-versions/ms809971(v=msdn.10)).</span><span class="sxs-lookup"><span data-stu-id="becc1-200">For more information on synchronizing COM objects, see [Understanding and Using COM Threading Models](/previous-versions/ms809971(v=msdn.10)).</span></span>

## <a name="related-topics"></a><span data-ttu-id="becc1-201">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="becc1-201">Related topics</span></span>

<dl> <dt>

<span data-ttu-id="becc1-202">**Conceitua**</span><span class="sxs-lookup"><span data-stu-id="becc1-202">**Conceptual**</span></span>
</dt> <dt>

[<span data-ttu-id="becc1-203">Introdução (como escrever um CODEC de WIC-Enabled)</span><span class="sxs-lookup"><span data-stu-id="becc1-203">Introduction (How to Write a WIC-Enabled CODEC)</span></span>](-wic-howtowriteacodec-intro.md)
</dt> <dt>

[<span data-ttu-id="becc1-204">Implementando um decodificador de WIC-Enabled</span><span class="sxs-lookup"><span data-stu-id="becc1-204">Implementing a WIC-Enabled Decoder</span></span>](-wic-implementingwicdecoder.md)
</dt> <dt>

[<span data-ttu-id="becc1-205">Como escrever um CODEC de WIC-Enabled</span><span class="sxs-lookup"><span data-stu-id="becc1-205">How to Write a WIC-Enabled CODEC</span></span>](-wic-howtowriteacodec.md)
</dt> <dt>

[<span data-ttu-id="becc1-206">Visão geral do Windows Imaging Component</span><span class="sxs-lookup"><span data-stu-id="becc1-206">Windows Imaging Component Overview</span></span>](-wic-about-windows-imaging-codec.md)
</dt> <dt>

[<span data-ttu-id="becc1-207">Visão geral dos metadados do WIC</span><span class="sxs-lookup"><span data-stu-id="becc1-207">WIC Metadata Overview</span></span>](-wic-about-metadata.md)
</dt> </dl>

 

 



