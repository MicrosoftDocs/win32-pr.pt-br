---
description: Um aplicativo com reconhecimento de IME que processa a \_ mensagem de composição do IME do WM \_ testa os bits no parâmetro lParam e chama a função ImmGetCompositionString para recuperar a cadeia de caracteres ou os dados indicados.
ms.assetid: 6d9cb9e2-f30e-4299-9af5-a705cd40b185
title: Processando a mensagem de WM_IME_COMPOSITION
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 059ff6f38531cfdea781d5633226d32d054f13b2
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104164411"
---
# <a name="processing-the-wm_ime_composition-message"></a><span data-ttu-id="e3c72-103">Processando a \_ mensagem de composição do IME do WM \_</span><span class="sxs-lookup"><span data-stu-id="e3c72-103">Processing the WM\_IME\_COMPOSITION Message</span></span>

<span data-ttu-id="e3c72-104">Um aplicativo com reconhecimento de IME que processa a mensagem de [**\_ \_ composição do IME do WM**](wm-ime-composition.md) testa os bits no parâmetro *lParam* e chama a função [**ImmGetCompositionString**](/windows/desktop/api/Imm/nf-imm-immgetcompositionstringa) para recuperar a cadeia de caracteres ou os dados indicados.</span><span class="sxs-lookup"><span data-stu-id="e3c72-104">An IME-aware application that processes the [**WM\_IME\_COMPOSITION**](wm-ime-composition.md) message tests the bits in *lParam* parameter and calls the [**ImmGetCompositionString**](/windows/desktop/api/Imm/nf-imm-immgetcompositionstringa) function to retrieve the indicated string or data.</span></span> <span data-ttu-id="e3c72-105">O exemplo a seguir verifica a cadeia de caracteres de resultado, aloca memória suficiente para a cadeia de caracteres e recupera a cadeia de caracteres de resultado do IME.</span><span class="sxs-lookup"><span data-stu-id="e3c72-105">The following example checks for the result string, allocates sufficient memory for the string, and retrieves the result string from the IME.</span></span>


```C++
HIMC hIMC;
DWORD dwSize;
HGLOBAL hstr;
LPSTR lpstr;

case WM_IME_COMPOSITION:
    if (lParam & GCS_RESULTSTR) 
    {
        hIMC = ImmGetContext(hWnd);

        if (!hIMC)
            MyError(ERROR_NULLCONTEXT);

        // Get the size of the result string. 
        dwSize = ImmGetCompositionString(hIMC, GCS_RESULTSTR, NULL, 0);

        // increase buffer size for terminating null character,  
        //   maybe it is in UNICODE 
        dwSize += sizeof(WCHAR);

        hstr = GlobalAlloc(GHND,dwSize);
        if (hstr == NULL)
             MyError(ERROR_GLOBALALLOC);

        lpstr = (LPSTR)GlobalLock(hstr);
        if (lpstr == NULL)
             MyError(ERROR_GLOBALLOCK);

        // Get the result strings that is generated by IME into lpstr. 
        ImmGetCompositionString(hIMC, GCS_RESULTSTR, lpstr, dwSize);
        ImmReleaseContext(hWnd, hIMC);

        // add this string into text buffer of application 

        GlobalUnlock(hstr);
        GlobalFree(hstr);
    }
```



## <a name="related-topics"></a><span data-ttu-id="e3c72-106">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="e3c72-106">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="e3c72-107">Usando o Gerenciador de métodos de entrada</span><span class="sxs-lookup"><span data-stu-id="e3c72-107">Using Input Method Manager</span></span>](using-input-method-manager.md)
</dt> </dl>

 

 



