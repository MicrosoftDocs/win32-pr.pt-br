---
title: Como o AMSI ajuda você a se defender contra malware
description: Como desenvolvedor de aplicativos, você pode participar ativamente da defesa contra malware. Especificamente, você pode ajudar a proteger seus clientes contra malwares baseados em script dinâmicos e de caminhos não tradicionais do cyberattack.
ms.topic: article
ms.date: 02/27/2019
ms.openlocfilehash: 0d6aee30034312073123f5ab14b1924fd01e6eac
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/16/2019
ms.locfileid: "103635118"
---
# <a name="how-the-antimalware-scan-interface-amsi-helps-you-defend-against-malware"></a><span data-ttu-id="c8c75-104">Como a interface de verificação antimalware (AMSI) ajuda você a se defender contra malware</span><span class="sxs-lookup"><span data-stu-id="c8c75-104">How the Antimalware Scan Interface (AMSI) helps you defend against malware</span></span>

<span data-ttu-id="c8c75-105">Para obter uma introdução à AMSI (interface de verificação antimalware) do Windows, consulte [interface de verificação antimalware (AMSI)](antimalware-scan-interface-portal.md).</span><span class="sxs-lookup"><span data-stu-id="c8c75-105">For an introduction to the Windows Antimalware Scan Interface (AMSI), see [Antimalware Scan Interface (AMSI)](antimalware-scan-interface-portal.md).</span></span>

<span data-ttu-id="c8c75-106">Como desenvolvedor de aplicativos, você pode participar ativamente da defesa contra malware.</span><span class="sxs-lookup"><span data-stu-id="c8c75-106">As an application developer, you can actively participate in malware defense.</span></span> <span data-ttu-id="c8c75-107">Especificamente, você pode ajudar a proteger seus clientes contra malwares baseados em script dinâmicos e de caminhos não tradicionais do cyberattack.</span><span class="sxs-lookup"><span data-stu-id="c8c75-107">Specifically, you can help protect your customers from dynamic script-based malware, and from non-traditional avenues of cyberattack.</span></span>

<span data-ttu-id="c8c75-108">Por meio de um exemplo, digamos que seu aplicativo seja programável por script: ele aceita um script arbitrário e o executa por meio de um mecanismo de script.</span><span class="sxs-lookup"><span data-stu-id="c8c75-108">By way of an example, let's say that your application is scriptable: it accepts arbitrary script, and executes it via a scripting engine.</span></span> <span data-ttu-id="c8c75-109">No ponto em que um script está pronto para ser fornecido ao mecanismo de script, seu aplicativo pode chamar as APIs AMSI do Windows para solicitar uma verificação do conteúdo.</span><span class="sxs-lookup"><span data-stu-id="c8c75-109">At the point when a script is ready to be supplied to the scripting engine, your application can call the Windows AMSI APIs to request a scan of the content.</span></span> <span data-ttu-id="c8c75-110">Dessa forma, você pode determinar com segurança se o script é mal-intencionado antes de decidir continuar e executá-lo.</span><span class="sxs-lookup"><span data-stu-id="c8c75-110">That way, you can safely determine whether or not the script is malicious before you decide to go ahead and execute it.</span></span>

<span data-ttu-id="c8c75-111">Isso é verdadeiro mesmo que o script tenha sido gerado em tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="c8c75-111">This is true even if the script was generated at runtime.</span></span> <span data-ttu-id="c8c75-112">Script (mal-intencionado ou de outra forma) pode passar por várias passagens de desofuscação.</span><span class="sxs-lookup"><span data-stu-id="c8c75-112">Script (malicious or otherwise), might go through several passes of de-obfuscation.</span></span> <span data-ttu-id="c8c75-113">Mas, em última instância, você precisa fornecer o mecanismo de script com código simples e não ofuscado.</span><span class="sxs-lookup"><span data-stu-id="c8c75-113">But you ultimately need to supply the scripting engine with plain, un-obfuscated code.</span></span> <span data-ttu-id="c8c75-114">E esse é o ponto no qual você invoca as APIs AMSI.</span><span class="sxs-lookup"><span data-stu-id="c8c75-114">And that's the point at which you invoke the AMSI APIs.</span></span>

<span data-ttu-id="c8c75-115">Aqui está uma ilustração da arquitetura AMSI, em que seu próprio aplicativo é representado por uma das caixas "outros aplicativos".</span><span class="sxs-lookup"><span data-stu-id="c8c75-115">Here's an illustration of the AMSI architecture, where your own application is represented by one of the "Other Application" boxes.</span></span>

![a arquitetura AMSI](images/AMSI7Archi.jpg)

<span data-ttu-id="c8c75-117">A interface AMSI do Windows está aberta.</span><span class="sxs-lookup"><span data-stu-id="c8c75-117">The Windows AMSI interface is open.</span></span> <span data-ttu-id="c8c75-118">O que significa que qualquer aplicativo pode chamá-lo; e qualquer mecanismo Antimalware registrado pode processar o conteúdo enviado a ele.</span><span class="sxs-lookup"><span data-stu-id="c8c75-118">Which means that any application can call it; and any registered Antimalware engine can process the content submitted to it.</span></span>

<span data-ttu-id="c8c75-119">Também não precisamos limitar a discussão a mecanismos de script.</span><span class="sxs-lookup"><span data-stu-id="c8c75-119">We needn't limit the discussion to scripting engines, either.</span></span> <span data-ttu-id="c8c75-120">Talvez seu aplicativo seja um aplicativo de comunicação e examine mensagens instantâneas em busca de vírus antes de mostrar a eles os clientes.</span><span class="sxs-lookup"><span data-stu-id="c8c75-120">Perhaps your application is a communication app, and it scans instant messages for viruses before it shows them to your customers.</span></span> <span data-ttu-id="c8c75-121">Ou talvez seu software seja um jogo que valida os plug-ins antes de instalá-los.</span><span class="sxs-lookup"><span data-stu-id="c8c75-121">Or maybe your software is a game that validates plugins before installing them.</span></span> <span data-ttu-id="c8c75-122">Há muitas oportunidades e cenários para usar o AMSI.</span><span class="sxs-lookup"><span data-stu-id="c8c75-122">There are plenty of opportunities and scenarios for using AMSI.</span></span>

## <a name="amsi-in-action"></a><span data-ttu-id="c8c75-123">AMSI em ação</span><span class="sxs-lookup"><span data-stu-id="c8c75-123">AMSI in action</span></span>

<span data-ttu-id="c8c75-124">Vamos dar uma olhada em AMSI em ação.</span><span class="sxs-lookup"><span data-stu-id="c8c75-124">Let's take a look at AMSI in action.</span></span> <span data-ttu-id="c8c75-125">Neste exemplo, o Windows Defender é o aplicativo que está chamando APIs AMSI.</span><span class="sxs-lookup"><span data-stu-id="c8c75-125">In this example, Windows Defender is the application that's calling AMSI APIs.</span></span> <span data-ttu-id="c8c75-126">Mas você pode chamar as mesmas APIs de dentro de seu próprio aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c8c75-126">But you can call the same APIs from within your own application.</span></span>

<span data-ttu-id="c8c75-127">Aqui está um exemplo de um script que usa a técnica de codificação XOR para ocultar sua intenção (se essa intenção é benigna ou não).</span><span class="sxs-lookup"><span data-stu-id="c8c75-127">Here's a sample of a script that uses the XOR-encoding technique to hide its intent (whether that intent is benign or not).</span></span> <span data-ttu-id="c8c75-128">Para esta ilustração, podemos imaginar que esse script foi baixado da Internet.</span><span class="sxs-lookup"><span data-stu-id="c8c75-128">For this illustration, we can imagine that this script was downloaded from the Internet.</span></span>

![script de exemplo codificado em base64](images/AMSI8.png)

<span data-ttu-id="c8c75-130">Para tornar as coisas mais interessantes, podemos inserir esse script manualmente na linha de comando para que não haja nenhum arquivo real a ser monitorado.</span><span class="sxs-lookup"><span data-stu-id="c8c75-130">To make things more interesting, we can enter this script manually at the command line so that there is no actual file to monitor.</span></span> <span data-ttu-id="c8c75-131">Isso espelha o que é conhecido como "ameaça de arquivo".</span><span class="sxs-lookup"><span data-stu-id="c8c75-131">This mirrors what's known as a "fileless threat".</span></span> <span data-ttu-id="c8c75-132">Não é tão simples quanto verificar arquivos em disco.</span><span class="sxs-lookup"><span data-stu-id="c8c75-132">It's not as simple as scanning files on disk.</span></span> <span data-ttu-id="c8c75-133">A ameaça pode ser um backdoor que reside apenas na memória de um computador.</span><span class="sxs-lookup"><span data-stu-id="c8c75-133">The threat might be a backdoor that lives only in the memory of a machine.</span></span>

<span data-ttu-id="c8c75-134">A seguir, vemos o resultado da execução do script no Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="c8c75-134">Below, we see the result of running the script in Windows PowerShell.</span></span> <span data-ttu-id="c8c75-135">Você verá que o Windows Defender é capaz de detectar o exemplo de teste AMSI nesse cenário complicado, simplesmente usando a assinatura de exemplo de teste AMSI padrão.</span><span class="sxs-lookup"><span data-stu-id="c8c75-135">You'll see that Windows Defender is able to detect the AMSI test sample in this complicated scenario, merely by using the standard AMSI test sample signature.</span></span>

![Windows Defender detectando o exemplo de teste do AMSI](images/AMSI9proper.png)

## <a name="amsi-integration-with-javascriptvba"></a><span data-ttu-id="c8c75-137">Integração do AMSI com JavaScript/VBA</span><span class="sxs-lookup"><span data-stu-id="c8c75-137">AMSI integration with JavaScript/VBA</span></span>

<span data-ttu-id="c8c75-138">O fluxo de trabalho ilustrado abaixo descreve o fluxo de ponta a ponta de outro exemplo, no qual Demonstramos a integração de AMSI com a execução de macro dentro de Microsoft Office.</span><span class="sxs-lookup"><span data-stu-id="c8c75-138">The illustrated workflow below describes the end-to-end flow of another example, in which we demonstrate AMSI's integration with macro execution within Microsoft Office.</span></span>

![Integração do AMSI com JavaScript/VBA](images/integ-js-vba.png)

- <span data-ttu-id="c8c75-140">O usuário recebe um documento que contém uma macro (mal-intencionado), que evita exames de software antivírus estáticos empregando técnicas como ofuscação, arquivos protegidos por senha ou outros.</span><span class="sxs-lookup"><span data-stu-id="c8c75-140">The user receives a document containing a (malicious) macro, which evades static antivirus software scans by employing techniques such as obfuscation, password-protected files, or other.</span></span>
- <span data-ttu-id="c8c75-141">O usuário abre o documento que contém a macro (mal-intencionado).</span><span class="sxs-lookup"><span data-stu-id="c8c75-141">The user then opens the document containing the (malicious) macro.</span></span> <span data-ttu-id="c8c75-142">Se o documento for aberto no modo de exibição protegido, o usuário clica em **Habilitar edição** para sair da exibição protegida.</span><span class="sxs-lookup"><span data-stu-id="c8c75-142">If the document opens in Protected View, then the user clicks **Enable Editing** to exit Protected View.</span></span>
- <span data-ttu-id="c8c75-143">O usuário clica em **habilitar macros** para permitir a execução de macros.</span><span class="sxs-lookup"><span data-stu-id="c8c75-143">The user clicks **Enable Macros** to allow macros to run.</span></span>
- <span data-ttu-id="c8c75-144">À medida que a macro é executada, o tempo de execução do VBA usa um buffer circular para registrar \[ 1 \] dados e parâmetros relacionados a chamadas para APIs do Win32, com e VBA.</span><span class="sxs-lookup"><span data-stu-id="c8c75-144">As the macro runs, the VBA runtime uses a circular buffer to log \[1\] data and parameters related to calls to Win32, COM, and VBA APIs.</span></span>
- <span data-ttu-id="c8c75-145">Quando APIs específicas do Win32 ou COM que são consideradas alto risco (também conhecidos como *gatilhos*) \[ 2 \] são observadas, a execução da macro é interrompida e o conteúdo do buffer circular é passado para AMSI.</span><span class="sxs-lookup"><span data-stu-id="c8c75-145">When specific Win32 or COM APIs that are considered high risk (also known as *triggers*) \[2\] are observed, macro execution is halted, and the contents of the circular buffer are passed to AMSI.</span></span>
- <span data-ttu-id="c8c75-146">O provedor de serviços Antimalware AMSI registrado responde com um veredicto para indicar se o comportamento da macro é mal-intencionado ou não.</span><span class="sxs-lookup"><span data-stu-id="c8c75-146">The registered AMSI anti-malware service provider responds with a verdict to indicate whether or not the macro behavior is malicious.</span></span>
- <span data-ttu-id="c8c75-147">Se o comportamento for não-mal-intencionado, a execução da macro continuará.</span><span class="sxs-lookup"><span data-stu-id="c8c75-147">If the behavior is non-malicious, then macro execution proceeds.</span></span>
- <span data-ttu-id="c8c75-148">Caso contrário, se o comportamento for mal-intencionado, Microsoft Office fechar a sessão em resposta ao alerta \[ 3 \] , e o AV poderá colocar o arquivo em quarentena.</span><span class="sxs-lookup"><span data-stu-id="c8c75-148">Otherwise, if the behavior is malicious, then Microsoft Office closes the session in response to the alert \[3\], and the AV can quarantine the file.</span></span>

## <a name="what-does-this-mean-for-you"></a><span data-ttu-id="c8c75-149">O que isso significa para você?</span><span class="sxs-lookup"><span data-stu-id="c8c75-149">What does this mean for you?</span></span>

<span data-ttu-id="c8c75-150">Para usuários do Windows, qualquer software mal-intencionado que usa técnicas de ofuscação e evasão nos hosts de script internos do Windows 10 é inspecionado automaticamente em um nível muito mais profundo do que nunca, fornecendo níveis adicionais de proteção.</span><span class="sxs-lookup"><span data-stu-id="c8c75-150">For Windows users, any malicious software that uses obfuscation and evasion techniques on Windows 10's built-in scripting hosts is automatically inspected at a much deeper level than ever before, providing additional levels of protection.</span></span>

<span data-ttu-id="c8c75-151">Para você como desenvolvedor de aplicativos, considere fazer com que seu aplicativo chame a interface AMSI do Windows se você quiser se beneficiar (e proteger seus clientes com) a verificação extra e a análise de conteúdo potencialmente mal-intencionado.</span><span class="sxs-lookup"><span data-stu-id="c8c75-151">For you as an application developer, consider having your application call the Windows AMSI interface if you want to benefit from (and protect your customers with) extra scanning and analysis of potentially malicious content.</span></span>

<span data-ttu-id="c8c75-152">Como um fornecedor de software antivírus, você pode considerar a implementação de suporte para a interface AMSI.</span><span class="sxs-lookup"><span data-stu-id="c8c75-152">As an antivirus software vendor, you can consider implementing support for the AMSI interface.</span></span> <span data-ttu-id="c8c75-153">Quando você fizer isso, seu mecanismo terá uma percepção muito mais profunda dos dados que os aplicativos (incluindo hosts de script interno do Windows 10) consideram potencialmente mal-intencionados.</span><span class="sxs-lookup"><span data-stu-id="c8c75-153">When you do, your engine will have much deeper insight into the data that applications (including Windows 10's built-in scripting hosts) consider to be potentially malicious.</span></span>

## <a name="more-background-info-about-fileless-threats"></a><span data-ttu-id="c8c75-154">Mais informações básicas sobre ameaças de arquivo</span><span class="sxs-lookup"><span data-stu-id="c8c75-154">More background info about fileless threats</span></span>

<span data-ttu-id="c8c75-155">Você pode estar curioso para obter mais informações sobre os tipos de ameaças de arquivo que o Windows AMSI foi projetado para ajudá-lo a se defender.</span><span class="sxs-lookup"><span data-stu-id="c8c75-155">You may be curious for more background info about the kinds of fileless threats that Windows AMSI is designed to help you defend against.</span></span> <span data-ttu-id="c8c75-156">Nesta seção, vamos dar uma olhada no jogo tradicional de gato e mouse que é executado no ecossistema de malware.</span><span class="sxs-lookup"><span data-stu-id="c8c75-156">In this section, we'll take a look at the traditional cat-and-mouse game that plays out in the malware ecosystem.</span></span>

<span data-ttu-id="c8c75-157">Usaremos o PowerShell como exemplo.</span><span class="sxs-lookup"><span data-stu-id="c8c75-157">We'll use PowerShell as an example.</span></span> <span data-ttu-id="c8c75-158">Mas você pode aproveitar as mesmas técnicas e processos que demonstraremos com qualquer linguagem dinâmica &mdash; VBScript, Perl, Python, Ruby e muito mais.</span><span class="sxs-lookup"><span data-stu-id="c8c75-158">But you can leverage the same techniques and processes we'll demonstrate with any dynamic language&mdash;VBScript, Perl, Python, Ruby, and more.</span></span>

<span data-ttu-id="c8c75-159">Aqui está um exemplo de um script do PowerShell mal-intencionado.</span><span class="sxs-lookup"><span data-stu-id="c8c75-159">Here's an example of a malicious PowerShell script.</span></span>

![um exemplo de um script do PowerShell mal-intencionado](images/AMSI1.png)

<span data-ttu-id="c8c75-161">Embora esse script simplesmente grave uma mensagem na tela, o malware normalmente é mais perigoso.</span><span class="sxs-lookup"><span data-stu-id="c8c75-161">While this script simply writes a message to the screen, malware is typically more nefarious.</span></span> <span data-ttu-id="c8c75-162">Mas você pode facilmente escrever uma assinatura para detectar esta.</span><span class="sxs-lookup"><span data-stu-id="c8c75-162">But you could easily write a signature to detect this one.</span></span> <span data-ttu-id="c8c75-163">Por exemplo, a assinatura pode pesquisar a cadeia de caracteres "Write-Host ' pWnd! '"</span><span class="sxs-lookup"><span data-stu-id="c8c75-163">For example, the signature could search for the string "Write-Host 'pwnd!'"</span></span> <span data-ttu-id="c8c75-164">em qualquer arquivo que o usuário abrir.</span><span class="sxs-lookup"><span data-stu-id="c8c75-164">in any file that the user opens.</span></span> <span data-ttu-id="c8c75-165">Ótimo: detectamos nosso primeiro malware!</span><span class="sxs-lookup"><span data-stu-id="c8c75-165">Great: we've detected our first malware!</span></span>

<span data-ttu-id="c8c75-166">Depois de ser detectado pela nossa primeira assinatura, no entanto, os autores de malware responderão.</span><span class="sxs-lookup"><span data-stu-id="c8c75-166">After being detected by our first signature, though, malware authors will respond.</span></span> <span data-ttu-id="c8c75-167">Eles respondem Criando scripts dinâmicos, como este exemplo.</span><span class="sxs-lookup"><span data-stu-id="c8c75-167">They respond by creating dynamic scripts such as this example.</span></span>

![um exemplo de um script dinâmico](images/AMSI2.png)

<span data-ttu-id="c8c75-169">Nesse cenário, os autores de malware criam uma cadeia de caracteres que representa o script do PowerShell a ser executado.</span><span class="sxs-lookup"><span data-stu-id="c8c75-169">In that scenario, malware authors create a string representing the PowerShell script to run.</span></span> <span data-ttu-id="c8c75-170">Mas eles usam uma técnica de concatenação de cadeia de caracteres simples para interromper nossa assinatura anterior.</span><span class="sxs-lookup"><span data-stu-id="c8c75-170">But they use a simple string concatenation technique to break our earlier signature.</span></span> <span data-ttu-id="c8c75-171">Se você já tiver exibido a origem de uma página da Web AD-carregados, verá muitas instâncias dessa técnica sendo usadas para evitar o software de bloqueio de anúncios.</span><span class="sxs-lookup"><span data-stu-id="c8c75-171">If you ever view the source of an ad-laden web page, you'll see many instances of this technique being used to avoid ad-blocking software.</span></span>

<span data-ttu-id="c8c75-172">Por fim, o autor de malware passa essa cadeia de caracteres concatenada para o `Invoke-Expression` &mdash; mecanismo do PowerShell do cmdlet para avaliar os scripts que são compostos ou criados no tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="c8c75-172">Finally, the malware author passes this concatenated string to the `Invoke-Expression` cmdlet&mdash;PowerShell's mechanism to evaluate scripts that are composed or created at runtime.</span></span>

<span data-ttu-id="c8c75-173">Em resposta, o software antimalware começa a fazer a emulação de linguagem básica.</span><span class="sxs-lookup"><span data-stu-id="c8c75-173">In response, antimalware software starts to do basic language emulation.</span></span> <span data-ttu-id="c8c75-174">Por exemplo, se observarmos que duas cadeias de caracteres estão sendo concatenadas, emularemos a concatenação dessas duas cadeias de caracteres e, em seguida, executaremos nossas assinaturas no resultado.</span><span class="sxs-lookup"><span data-stu-id="c8c75-174">For example, if we see two strings being concatenated, then we emulate the concatenation of those two strings, and then run our signatures on the result.</span></span> <span data-ttu-id="c8c75-175">Infelizmente, essa é uma abordagem bastante frágil, porque as linguagens tendem a ter várias maneiras de representar e concatenar cadeias de caracteres.</span><span class="sxs-lookup"><span data-stu-id="c8c75-175">Unfortunately, this is a fairly fragile approach, because languages tend to have a lot of ways to represent and concatenate strings.</span></span>

<span data-ttu-id="c8c75-176">Então, depois de ser capturado por essa assinatura, os autores de malware mudarão para algo mais complicado, &mdash; por exemplo, codificando o conteúdo do script em base64, como neste exemplo a seguir.</span><span class="sxs-lookup"><span data-stu-id="c8c75-176">So, after being caught by this signature, malware authors will move to something more complicated&mdash;for example, encoding script content in Base64, as in this next example.</span></span>

![um exemplo de conteúdo de script em base64](images/AMSI3.png)

<span data-ttu-id="c8c75-178">Sendo versátil, a maioria dos mecanismos antimalware implementam a emulação de decodificação de Base64 também.</span><span class="sxs-lookup"><span data-stu-id="c8c75-178">Being resourceful, most antimalware engines implement Base64 decoding emulation, as well.</span></span> <span data-ttu-id="c8c75-179">Portanto, como também implementamos a emulação de decodificação de Base64, estamos à frente por um tempo.</span><span class="sxs-lookup"><span data-stu-id="c8c75-179">So, since we also implement Base64 decoding emulation, we're ahead for a time.</span></span>

<span data-ttu-id="c8c75-180">Em resposta, os autores de malware mudam para ofuscação de algoritmo &mdash; , como um mecanismo simples de codificação XOR nos scripts que eles executam.</span><span class="sxs-lookup"><span data-stu-id="c8c75-180">In response, malware authors move to algorithmic obfuscation&mdash;such as a simple XOR-encoding mechanism in the scripts they run.</span></span>

![um exemplo de um script de ofuscação de algoritmo](images/AMSI4.png)

<span data-ttu-id="c8c75-182">Neste ponto, geralmente, nos deparamos com o que os mecanismos antivírus irão emular ou detectar, portanto, não detectaremos necessariamente o que esse script está fazendo.</span><span class="sxs-lookup"><span data-stu-id="c8c75-182">At this point, we're generally past what antivirus engines will emulate or detect, so we won't necessarily detect what this script is doing.</span></span> <span data-ttu-id="c8c75-183">No entanto, podemos começar a escrever assinaturas com base nas técnicas de ofuscação e codificação.</span><span class="sxs-lookup"><span data-stu-id="c8c75-183">However, we can start to write signatures against the obfuscation and encoding techniques.</span></span> <span data-ttu-id="c8c75-184">Na verdade, é isso que as contas para a grande maioria das assinaturas para malware baseado em script.</span><span class="sxs-lookup"><span data-stu-id="c8c75-184">In fact, that's what accounts for the vast majority of signatures for script-based malware.</span></span>

<span data-ttu-id="c8c75-185">Mas e se o ofuscador for tão trivial que parece muitos scripts bem comparados?</span><span class="sxs-lookup"><span data-stu-id="c8c75-185">But what if the obfuscator is so trivial that it looks like many well-behaved scripts?</span></span> <span data-ttu-id="c8c75-186">Uma assinatura para ela geraria um número inaceitável de falsos positivos.</span><span class="sxs-lookup"><span data-stu-id="c8c75-186">A signature for it would generate an unacceptable number of false positives.</span></span> <span data-ttu-id="c8c75-187">Aqui está um exemplo de script de *estágio* que é benigno demais para detectar por conta própria.</span><span class="sxs-lookup"><span data-stu-id="c8c75-187">Here's a sample *stager* script that's too benign to detect on its own.</span></span>

![um exemplo de script de teste que é benigno demais para detectar por conta própria](images/AMSI5.png)

<span data-ttu-id="c8c75-189">Nesse exemplo, estamos baixando uma página da Web e invocando algum conteúdo dela.</span><span class="sxs-lookup"><span data-stu-id="c8c75-189">In that example, we're downloading a web page, and invoking some content from it.</span></span> <span data-ttu-id="c8c75-190">Aqui está o equivalente em Visual Basic Script.</span><span class="sxs-lookup"><span data-stu-id="c8c75-190">Here's the equivalent in Visual Basic script.</span></span>

![o equivalente em Visual Basic script](images/AMSI6.png)

<span data-ttu-id="c8c75-192">O que torna as coisas piores em ambos os exemplos é que o mecanismo antivírus inspeciona os arquivos que estão sendo abertos pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="c8c75-192">What makes things worse in both of these examples is that the antivirus engine inspects files being opened by the user.</span></span> <span data-ttu-id="c8c75-193">Se o conteúdo mal-intencionado residir apenas na memória, o ataque pode potencialmente não ser detectado.</span><span class="sxs-lookup"><span data-stu-id="c8c75-193">If the malicious content lives only in memory, then the attack can potentially go undetected.</span></span>

<span data-ttu-id="c8c75-194">Esta seção mostrou as limitações de detecção usando assinaturas tradicionais.</span><span class="sxs-lookup"><span data-stu-id="c8c75-194">This section showed the limitations of detection using traditional signatures.</span></span> <span data-ttu-id="c8c75-195">Mas, embora um script mal-intencionado possa passar por várias passagens de desofuscação, ele, por fim, precisa fornecer o mecanismo de script com código simples e sem ofuscação.</span><span class="sxs-lookup"><span data-stu-id="c8c75-195">But, while a malicious script might go through several passes of de-obfuscation, it ultimately needs to supply the scripting engine with plain, unobfuscated code.</span></span> <span data-ttu-id="c8c75-196">E nesse ponto &mdash; , conforme descrito na primeira seção acima, os &mdash; hosts de script internos do Windows 10 chamam as APIs AMSI para solicitar uma verificação desse conteúdo desprotegido.</span><span class="sxs-lookup"><span data-stu-id="c8c75-196">And at that point&mdash;as we described in the first section above&mdash;Windows 10's built-in scripting hosts call the AMSI APIs to request a scan of this unprotected content.</span></span> <span data-ttu-id="c8c75-197">E seu aplicativo pode fazer a mesma coisa.</span><span class="sxs-lookup"><span data-stu-id="c8c75-197">And your application can do the same thing.</span></span>

## <a name="related-resources"></a><span data-ttu-id="c8c75-198">Recursos relacionados</span><span class="sxs-lookup"><span data-stu-id="c8c75-198">Related resources</span></span>

* [<span data-ttu-id="c8c75-199">Ameaças sem arquivo</span><span class="sxs-lookup"><span data-stu-id="c8c75-199">Fileless threats</span></span>](/windows/security/threat-protection/intelligence/fileless-threats)
* [<span data-ttu-id="c8c75-200">Office VBA + AMSI: parte do vela em macros mal-intencionadas</span><span class="sxs-lookup"><span data-stu-id="c8c75-200">Office VBA + AMSI: Parting the veil on malicious macros</span></span>](https://cloudblogs.microsoft.com/microsoftsecure/2018/09/12/office-vba-amsi-parting-the-veil-on-malicious-macros/)
* [<span data-ttu-id="c8c75-201">Fora de visão, mas não invisível: disparando malware sem arquivo com monitoramento de comportamento, AMSI e AV de próxima geração</span><span class="sxs-lookup"><span data-stu-id="c8c75-201">Out of sight but not invisible: Defeating fileless malware with behavior monitoring, AMSI, and next-gen AV</span></span>](https://cloudblogs.microsoft.com/microsoftsecure/2018/09/27/out-of-sight-but-not-invisible-defeating-fileless-malware-with-behavior-monitoring-amsi-and-next-gen-av/)
