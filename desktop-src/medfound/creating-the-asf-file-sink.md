---
description: O coletor de arquivos ASF é uma implementação de IMFMediaSink fornecida pelo Media Foundation que um aplicativo pode usar para arquivar dados de mídia ASF em um arquivo. Para obter informações sobre o modelo de objeto de coletor de mídia ASF e uso geral, consulte coletores de mídia ASF.
ms.assetid: 991f3345-a6b4-45c2-a89d-3c13c70b6bbc
title: Criando o coletor de arquivo ASF
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c43625bcbc581b4967d4db99cef71a0fc779f070
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104089768"
---
# <a name="creating-the-asf-file-sink"></a><span data-ttu-id="574fa-104">Criando o coletor de arquivo ASF</span><span class="sxs-lookup"><span data-stu-id="574fa-104">Creating the ASF File Sink</span></span>

<span data-ttu-id="574fa-105">O coletor de arquivos ASF é uma implementação de [**IMFMediaSink**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasink) fornecida pelo Media Foundation que um aplicativo pode usar para arquivar dados de mídia ASF em um arquivo.</span><span class="sxs-lookup"><span data-stu-id="574fa-105">The ASF file sink is an implementation of [**IMFMediaSink**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasink) provided by Media Foundation that an application can use to archive ASF media data to a file.</span></span> <span data-ttu-id="574fa-106">Para obter informações sobre o modelo de objeto do coletor de mídia ASF e o uso geral, consulte [coletores de mídia ASF](asf-media-sinks.md).</span><span class="sxs-lookup"><span data-stu-id="574fa-106">For information about ASF Media Sinks' object model and general usage, see [ASF Media Sinks](asf-media-sinks.md).</span></span>

<span data-ttu-id="574fa-107">Há duas maneiras de criar uma instância do coletor de arquivos ASF.</span><span class="sxs-lookup"><span data-stu-id="574fa-107">There are two ways of creating an instance of the ASF file sink.</span></span> <span data-ttu-id="574fa-108">Você pode chamar [**MFCreateASFMediaSink**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink) ou [**MFCreateASFMediaSinkActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate).</span><span class="sxs-lookup"><span data-stu-id="574fa-108">You can call [**MFCreateASFMediaSink**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink) or [**MFCreateASFMediaSinkActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate).</span></span>

<span data-ttu-id="574fa-109">Se você chamar [**MFCreateASFMediaSink**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink), deverá especificar um fluxo de bytes para o arquivo de saída, no qual o coletor gravará o conteúdo do ASF durante uma sessão de codificação.</span><span class="sxs-lookup"><span data-stu-id="574fa-109">If you call [**MFCreateASFMediaSink**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink), you must specify a byte stream, for the output file, into which the sink will write the ASF content during an encoding session.</span></span> <span data-ttu-id="574fa-110">O fluxo de bytes especificado deve ter recursos pesquisáveis e graváveis, caso contrário, a chamada **MFCreateASFMediaSink** falhará com o \_ código de erro E falha.</span><span class="sxs-lookup"><span data-stu-id="574fa-110">The specified byte stream must have seekable and writable capabilities otherwise the **MFCreateASFMediaSink** call fails with the E\_FAIL error code.</span></span> <span data-ttu-id="574fa-111">Essa chamada cria um objeto de coletor de arquivo em processo e retorna um ponteiro para a interface [**IMFMediaSink**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasink) do coletor de arquivos.</span><span class="sxs-lookup"><span data-stu-id="574fa-111">This call creates an in-process file sink object and returns a pointer to the [**IMFMediaSink**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasink) interface of the file sink.</span></span>

<span data-ttu-id="574fa-112">Se você chamar [**MFCreateASFMediaSinkActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate), deverá especificar a URL do arquivo de saída no qual o coletor de arquivos gravará os dados de mídia.</span><span class="sxs-lookup"><span data-stu-id="574fa-112">If you call [**MFCreateASFMediaSinkActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate), you must specify the URL of the output file into which the file sink will write media data.</span></span> <span data-ttu-id="574fa-113">Nesse caso, o coletor de arquivos cria internamente o fluxo de bytes.</span><span class="sxs-lookup"><span data-stu-id="574fa-113">In this case, the file sink internally creates the byte stream.</span></span> <span data-ttu-id="574fa-114">A função retorna um ponteiro para a interface [**IMFActivate**](/windows/desktop/api/mfobjects/nn-mfobjects-imfactivate) do coletor de arquivos.</span><span class="sxs-lookup"><span data-stu-id="574fa-114">The function returns a pointer to the [**IMFActivate**](/windows/desktop/api/mfobjects/nn-mfobjects-imfactivate) interface of the file sink.</span></span> <span data-ttu-id="574fa-115">Para</span><span class="sxs-lookup"><span data-stu-id="574fa-115">To</span></span>

<span data-ttu-id="574fa-116">Considere [**MFCreateASFMediaSinkActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate) em vez de [**MFCreateASFMediaSink**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink), quando sua topologia de codificação for projetada da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="574fa-116">Consider [**MFCreateASFMediaSinkActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate) instead of [**MFCreateASFMediaSink**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink), when your encoding topology is designed as follows:</span></span>

-   <span data-ttu-id="574fa-117">A topologia de codificação é para o caminho de mídia protegida (PMP) e o coletor de arquivos é usado fora do processo.</span><span class="sxs-lookup"><span data-stu-id="574fa-117">The encoding topology is for the protected media path (PMP) and the file sink is used out-of-process.</span></span>
-   <span data-ttu-id="574fa-118">O nó de saída da topologia é criado usando o ponteiro retornado para o objeto Activate do coletor de arquivos e seu aplicativo está controlando os fluxos no coletor de arquivos por números de fluxo.</span><span class="sxs-lookup"><span data-stu-id="574fa-118">The output node of the topology is created by using the returned pointer to the activate object of the file sink and your application is keeping track of the streams in the file sink by stream numbers.</span></span>
    > [!Note]  
    > <span data-ttu-id="574fa-119">Você pode ativar o coletor de arquivos chamando [**IMFActivate:: activateobject**](/windows/desktop/api/mfobjects/nf-mfobjects-imfactivate-activateobject).</span><span class="sxs-lookup"><span data-stu-id="574fa-119">You can activate the file sink by calling [**IMFActivate::ActivateObject**](/windows/desktop/api/mfobjects/nf-mfobjects-imfactivate-activateobject).</span></span> <span data-ttu-id="574fa-120">No entanto, não é necessário ativar o objeto explicitamente.</span><span class="sxs-lookup"><span data-stu-id="574fa-120">However you do not need to activate the object explictly.</span></span> <span data-ttu-id="574fa-121">A sessão de mídia controla o objeto de ativação e ativa o coletor de arquivos automaticamente durante a sessão de codificação.</span><span class="sxs-lookup"><span data-stu-id="574fa-121">The Media Session keeps track of the activation object and activates the file sink automatically during the encoding session.</span></span>

     

-   <span data-ttu-id="574fa-122">As informações de fluxo são configuradas no objeto ContentInfo.</span><span class="sxs-lookup"><span data-stu-id="574fa-122">The stream information is configured in the ContentInfo object.</span></span> <span data-ttu-id="574fa-123">Disucssed na próxima subseção.</span><span class="sxs-lookup"><span data-stu-id="574fa-123">Disucssed in the next sub-section.</span></span>

<span data-ttu-id="574fa-124">Depois de criar o coletor de arquivos ASF, ele deve ser configurado antes da criação da topologia.</span><span class="sxs-lookup"><span data-stu-id="574fa-124">After creating the ASF file sink it must be configured before building the topology.</span></span> <span data-ttu-id="574fa-125">O coletor de arquivos precisa saber as informações a seguir para gerar o arquivo de saída.</span><span class="sxs-lookup"><span data-stu-id="574fa-125">The file sink needs to know the following information in order to generate the output file.</span></span>

-   <span data-ttu-id="574fa-126">Informações básicas de fluxo</span><span class="sxs-lookup"><span data-stu-id="574fa-126">Basic stream information</span></span>
-   <span data-ttu-id="574fa-127">Informações do modo de codificação</span><span class="sxs-lookup"><span data-stu-id="574fa-127">Encoding mode information</span></span>
-   <span data-ttu-id="574fa-128">Metadados</span><span class="sxs-lookup"><span data-stu-id="574fa-128">Metadata</span></span>

<span data-ttu-id="574fa-129">O coletor de arquivo implementa o [objeto ContentInfo do ASF](asf-contentinfo-object.md) e expõe a interface [**IMFASFContentInfo**](/windows/desktop/api/wmcontainer/nn-wmcontainer-imfasfcontentinfo) para que um aplicativo possa usá-lo para definir informações relacionadas aos fluxos e à codificação.</span><span class="sxs-lookup"><span data-stu-id="574fa-129">The file sink implements the [ASF ContentInfo Object](asf-contentinfo-object.md) and exposes the [**IMFASFContentInfo**](/windows/desktop/api/wmcontainer/nn-wmcontainer-imfasfcontentinfo) interface so that an application can use it to set information related to the streams and encoding.</span></span> <span data-ttu-id="574fa-130">Dependendo da função que você chamou para criar o coletor de arquivos, há duas maneiras de obter uma referência à interface **IMFASFContentInfo** .</span><span class="sxs-lookup"><span data-stu-id="574fa-130">Depending on the function you called to create the file sink, there are two ways of getting a reference to the **IMFASFContentInfo** interface.</span></span>

-   <span data-ttu-id="574fa-131">Se você chamar a função [**MFCreateASFMediaSink**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink) , o aplicativo deverá consultar a interface [**IMFASFContentInfo**](/windows/desktop/api/wmcontainer/nn-wmcontainer-imfasfcontentinfo) chamando **IMFMediaSink:: QueryInterface** no coletor de arquivo retornado.</span><span class="sxs-lookup"><span data-stu-id="574fa-131">If you call the [**MFCreateASFMediaSink**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink) function, the application must query for [**IMFASFContentInfo**](/windows/desktop/api/wmcontainer/nn-wmcontainer-imfasfcontentinfo) interface by calling **IMFMediaSink::QueryInterface** on the returned file sink.</span></span>
-   <span data-ttu-id="574fa-132">Se você optar por chamar [**MFCreateASFMediaSinkActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate), essa função espera que você tenha um objeto ContentInfo totalmente configurado antes da chamada.</span><span class="sxs-lookup"><span data-stu-id="574fa-132">If you choose to call [**MFCreateASFMediaSinkActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate), this function expects that you have a fully-configured ContentInfo object prior to the call.</span></span> <span data-ttu-id="574fa-133">Para fazer isso, você precisa criar um objeto ContentInfo vazio chamando [**MFCreateASFContentInfo**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfcontentinfo) e, em seguida, configurá-lo com todas as informações necessárias.</span><span class="sxs-lookup"><span data-stu-id="574fa-133">To do this, you need to create an empty ContentInfo object by calling [**MFCreateASFContentInfo**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfcontentinfo) and then configure it with all the required information.</span></span> <span data-ttu-id="574fa-134">Passe o objeto ContentInfo configurado para o **MFCreateASFMediaSinkActivate** para receber um ponteiro para o objeto ativar coletor.</span><span class="sxs-lookup"><span data-stu-id="574fa-134">Pass the configured ContentInfo object to the **MFCreateASFMediaSinkActivate** to receive a pointer to the sink activate object.</span></span> <span data-ttu-id="574fa-135">Você não pode ativar o coletor de arquivos usando o objeto de ativação retornado e, em seguida, alterar qualquer fluxo ou informações de codificação.</span><span class="sxs-lookup"><span data-stu-id="574fa-135">You cannot activate the file sink by using the returned activation object and then change any stream or encoding information.</span></span>

<span data-ttu-id="574fa-136">Para obter informações sobre como configurar fluxos de coletor e propriedades específicas, consulte os seguintes tópicos:</span><span class="sxs-lookup"><span data-stu-id="574fa-136">For information about configuring sink streams and specific properties, see the following topics:</span></span>

-   [<span data-ttu-id="574fa-137">Adicionando informações de fluxo ao coletor de arquivo ASF</span><span class="sxs-lookup"><span data-stu-id="574fa-137">Adding Stream Information to the ASF File Sink</span></span>](adding-stream-information-to-the-asf-file-sink.md)
-   [<span data-ttu-id="574fa-138">Definindo propriedades no coletor de arquivos</span><span class="sxs-lookup"><span data-stu-id="574fa-138">Setting Properties in the File Sink</span></span>](setting-properties-in-the-file-sink.md)
-   [<span data-ttu-id="574fa-139">Adicionando metadados ao coletor de arquivos</span><span class="sxs-lookup"><span data-stu-id="574fa-139">Adding Metadata to the File Sink</span></span>](adding-metadata-to-the-file-sink.md)

## <a name="related-topics"></a><span data-ttu-id="574fa-140">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="574fa-140">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="574fa-141">Coletores de mídia ASF</span><span class="sxs-lookup"><span data-stu-id="574fa-141">ASF Media Sinks</span></span>](asf-media-sinks.md)
</dt> <dt>

[<span data-ttu-id="574fa-142">Componentes ASF da camada de pipeline</span><span class="sxs-lookup"><span data-stu-id="574fa-142">Pipeline Layer ASF Components</span></span>](pipeline-layer-asf-components.md)
</dt> <dt>

[<span data-ttu-id="574fa-143">Suporte a ASF no Media Foundation</span><span class="sxs-lookup"><span data-stu-id="574fa-143">ASF Support in Media Foundation</span></span>](asf-support-in-media-foundation.md)
</dt> </dl>

 

 



