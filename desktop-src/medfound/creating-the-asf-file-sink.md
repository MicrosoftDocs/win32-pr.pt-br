---
description: Saiba mais sobre como criar o sink de arquivo ASF, que um aplicativo pode usar para arquivar dados de mídia ASF em um arquivo.
ms.assetid: 991f3345-a6b4-45c2-a89d-3c13c70b6bbc
title: Criando o sink de arquivo ASF
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6fcd9ea19f0200dfd330f421fd5dac2cd100b702
ms.sourcegitcommit: 5d4e99f4c8f42f5f543e52cb9beb9fb13ec56c5f
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 06/19/2021
ms.locfileid: "112409919"
---
# <a name="creating-the-asf-file-sink"></a><span data-ttu-id="52157-103">Criando o sink de arquivo ASF</span><span class="sxs-lookup"><span data-stu-id="52157-103">Creating the ASF File Sink</span></span>

<span data-ttu-id="52157-104">O sink de arquivo ASF é uma implementação de [**IMFMediaSink**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasink) fornecida pelo Media Foundation que um aplicativo pode usar para arquivar dados de mídia ASF em um arquivo.</span><span class="sxs-lookup"><span data-stu-id="52157-104">The ASF file sink is an implementation of [**IMFMediaSink**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasink) provided by Media Foundation that an application can use to archive ASF media data to a file.</span></span> <span data-ttu-id="52157-105">Para obter informações sobre o modelo de objeto e o uso geral dos sinks de mídia do ASF, consulte [AsF Media Sinks](asf-media-sinks.md).</span><span class="sxs-lookup"><span data-stu-id="52157-105">For information about ASF Media Sinks' object model and general usage, see [ASF Media Sinks](asf-media-sinks.md).</span></span>

<span data-ttu-id="52157-106">Há duas maneiras de criar uma instância do sink de arquivo ASF.</span><span class="sxs-lookup"><span data-stu-id="52157-106">There are two ways of creating an instance of the ASF file sink.</span></span> <span data-ttu-id="52157-107">Você pode chamar [**MFCreateASFMediaSink**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink) ou [**MFCreateASFMediaSinkActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate).</span><span class="sxs-lookup"><span data-stu-id="52157-107">You can call [**MFCreateASFMediaSink**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink) or [**MFCreateASFMediaSinkActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate).</span></span>

<span data-ttu-id="52157-108">Se você chamar [**MFCreateASFMediaSink**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink), deverá especificar um fluxo de byte para o arquivo de saída, no qual o sink gravará o conteúdo ASF durante uma sessão de codificação.</span><span class="sxs-lookup"><span data-stu-id="52157-108">If you call [**MFCreateASFMediaSink**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink), you must specify a byte stream, for the output file, into which the sink will write the ASF content during an encoding session.</span></span> <span data-ttu-id="52157-109">O fluxo de byte especificado deve ter funcionalidades que podem ser buscadas e que podem ser escritas; caso contrário, a chamada **MFCreateASFMediaSink** falhará com o código de erro E \_ FAIL.</span><span class="sxs-lookup"><span data-stu-id="52157-109">The specified byte stream must have seekable and writable capabilities otherwise the **MFCreateASFMediaSink** call fails with the E\_FAIL error code.</span></span> <span data-ttu-id="52157-110">Essa chamada cria um objeto de sink de arquivo em processo e retorna um ponteiro para a interface [**IMFMediaSink**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasink) do sink de arquivo.</span><span class="sxs-lookup"><span data-stu-id="52157-110">This call creates an in-process file sink object and returns a pointer to the [**IMFMediaSink**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasink) interface of the file sink.</span></span>

<span data-ttu-id="52157-111">Se você chamar [**MFCreateASFMediaSinkActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate), deverá especificar a URL do arquivo de saída no qual o sink de arquivo gravará dados de mídia.</span><span class="sxs-lookup"><span data-stu-id="52157-111">If you call [**MFCreateASFMediaSinkActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate), you must specify the URL of the output file into which the file sink will write media data.</span></span> <span data-ttu-id="52157-112">Nesse caso, o sink de arquivo cria internamente o fluxo de byte.</span><span class="sxs-lookup"><span data-stu-id="52157-112">In this case, the file sink internally creates the byte stream.</span></span> <span data-ttu-id="52157-113">A função retorna um ponteiro para a interface [**IMFActivate**](/windows/desktop/api/mfobjects/nn-mfobjects-imfactivate) do sink de arquivo.</span><span class="sxs-lookup"><span data-stu-id="52157-113">The function returns a pointer to the [**IMFActivate**](/windows/desktop/api/mfobjects/nn-mfobjects-imfactivate) interface of the file sink.</span></span> <span data-ttu-id="52157-114">Para</span><span class="sxs-lookup"><span data-stu-id="52157-114">To</span></span>

<span data-ttu-id="52157-115">Considere [**MFCreateASFMediaSinkActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate) em vez de [**MFCreateASFMediaSink**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink), quando sua topologia de codificação for projetada da seguinte forma:</span><span class="sxs-lookup"><span data-stu-id="52157-115">Consider [**MFCreateASFMediaSinkActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate) instead of [**MFCreateASFMediaSink**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink), when your encoding topology is designed as follows:</span></span>

-   <span data-ttu-id="52157-116">A topologia de codificação é para o caminho de mídia protegido (PMP) e o sink de arquivo é usado fora do processo.</span><span class="sxs-lookup"><span data-stu-id="52157-116">The encoding topology is for the protected media path (PMP) and the file sink is used out-of-process.</span></span>
-   <span data-ttu-id="52157-117">O nó de saída da topologia é criado usando o ponteiro retornado para o objeto de ativação do sink de arquivo e seu aplicativo está acompanhando os fluxos no sink de arquivos por números de fluxo.</span><span class="sxs-lookup"><span data-stu-id="52157-117">The output node of the topology is created by using the returned pointer to the activate object of the file sink and your application is keeping track of the streams in the file sink by stream numbers.</span></span>
    > [!Note]  
    > <span data-ttu-id="52157-118">Você pode ativar o sink de arquivo chamando [**IMFActivate::ActivateObject**](/windows/desktop/api/mfobjects/nf-mfobjects-imfactivate-activateobject).</span><span class="sxs-lookup"><span data-stu-id="52157-118">You can activate the file sink by calling [**IMFActivate::ActivateObject**](/windows/desktop/api/mfobjects/nf-mfobjects-imfactivate-activateobject).</span></span> <span data-ttu-id="52157-119">No entanto, você não precisa ativar o objeto de forma explictly.</span><span class="sxs-lookup"><span data-stu-id="52157-119">However you do not need to activate the object explictly.</span></span> <span data-ttu-id="52157-120">A Sessão de Mídia mantém o controle do objeto de ativação e ativa o sink de arquivo automaticamente durante a sessão de codificação.</span><span class="sxs-lookup"><span data-stu-id="52157-120">The Media Session keeps track of the activation object and activates the file sink automatically during the encoding session.</span></span>

     

-   <span data-ttu-id="52157-121">As informações de fluxo são configuradas no objeto ContentInfo.</span><span class="sxs-lookup"><span data-stu-id="52157-121">The stream information is configured in the ContentInfo object.</span></span> <span data-ttu-id="52157-122">Desaprovado na próxima subseção.</span><span class="sxs-lookup"><span data-stu-id="52157-122">Disucssed in the next sub-section.</span></span>

<span data-ttu-id="52157-123">Depois de criar o sink de arquivo ASF, ele deve ser configurado antes de criar a topologia.</span><span class="sxs-lookup"><span data-stu-id="52157-123">After creating the ASF file sink it must be configured before building the topology.</span></span> <span data-ttu-id="52157-124">O sink de arquivo precisa saber as informações a seguir para gerar o arquivo de saída.</span><span class="sxs-lookup"><span data-stu-id="52157-124">The file sink needs to know the following information in order to generate the output file.</span></span>

-   <span data-ttu-id="52157-125">Informações básicas do fluxo</span><span class="sxs-lookup"><span data-stu-id="52157-125">Basic stream information</span></span>
-   <span data-ttu-id="52157-126">Informações do modo de codificação</span><span class="sxs-lookup"><span data-stu-id="52157-126">Encoding mode information</span></span>
-   <span data-ttu-id="52157-127">Metadados</span><span class="sxs-lookup"><span data-stu-id="52157-127">Metadata</span></span>

<span data-ttu-id="52157-128">O sink de arquivo implementa o Objeto [ContentInfo do ASF](asf-contentinfo-object.md) e expõe a interface [**IMFASFContentInfo**](/windows/desktop/api/wmcontainer/nn-wmcontainer-imfasfcontentinfo) para que um aplicativo possa usá-lo para definir informações relacionadas aos fluxos e codificação.</span><span class="sxs-lookup"><span data-stu-id="52157-128">The file sink implements the [ASF ContentInfo Object](asf-contentinfo-object.md) and exposes the [**IMFASFContentInfo**](/windows/desktop/api/wmcontainer/nn-wmcontainer-imfasfcontentinfo) interface so that an application can use it to set information related to the streams and encoding.</span></span> <span data-ttu-id="52157-129">Dependendo da função que você chamou para criar o sink de arquivo, há duas maneiras de obter uma referência à interface **IMFASFContentInfo.**</span><span class="sxs-lookup"><span data-stu-id="52157-129">Depending on the function you called to create the file sink, there are two ways of getting a reference to the **IMFASFContentInfo** interface.</span></span>

-   <span data-ttu-id="52157-130">Se você chamar a [**função MFCreateASFMediaSink,**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink) o aplicativo deverá consultar a interface [**IMFASFContentInfo**](/windows/desktop/api/wmcontainer/nn-wmcontainer-imfasfcontentinfo) chamando **IMFMediaSink::QueryInterface** no sink de arquivo retornado.</span><span class="sxs-lookup"><span data-stu-id="52157-130">If you call the [**MFCreateASFMediaSink**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink) function, the application must query for [**IMFASFContentInfo**](/windows/desktop/api/wmcontainer/nn-wmcontainer-imfasfcontentinfo) interface by calling **IMFMediaSink::QueryInterface** on the returned file sink.</span></span>
-   <span data-ttu-id="52157-131">Se você optar por chamar [**MFCreateASFMediaSinkActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate), essa função espera que você tenha um objeto ContentInfo totalmente configurado antes da chamada.</span><span class="sxs-lookup"><span data-stu-id="52157-131">If you choose to call [**MFCreateASFMediaSinkActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate), this function expects that you have a fully-configured ContentInfo object prior to the call.</span></span> <span data-ttu-id="52157-132">Para fazer isso, você precisa criar um objeto ContentInfo vazio chamando [**MFCreateASFContentInfo**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfcontentinfo) e configurá-lo com todas as informações necessárias.</span><span class="sxs-lookup"><span data-stu-id="52157-132">To do this, you need to create an empty ContentInfo object by calling [**MFCreateASFContentInfo**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfcontentinfo) and then configure it with all the required information.</span></span> <span data-ttu-id="52157-133">Passe o objeto ContentInfo configurado para **O MFCreateASFMediaSinkActivate** para receber um ponteiro para o objeto de ativação do sink.</span><span class="sxs-lookup"><span data-stu-id="52157-133">Pass the configured ContentInfo object to the **MFCreateASFMediaSinkActivate** to receive a pointer to the sink activate object.</span></span> <span data-ttu-id="52157-134">Você não pode ativar o sink de arquivo usando o objeto de ativação retornado e, em seguida, alterar qualquer informação de fluxo ou codificação.</span><span class="sxs-lookup"><span data-stu-id="52157-134">You cannot activate the file sink by using the returned activation object and then change any stream or encoding information.</span></span>

<span data-ttu-id="52157-135">Para obter informações sobre como configurar fluxos de sink e propriedades específicas, consulte os seguintes tópicos:</span><span class="sxs-lookup"><span data-stu-id="52157-135">For information about configuring sink streams and specific properties, see the following topics:</span></span>

-   [<span data-ttu-id="52157-136">Adicionando informações de fluxo ao sink do arquivo ASF</span><span class="sxs-lookup"><span data-stu-id="52157-136">Adding Stream Information to the ASF File Sink</span></span>](adding-stream-information-to-the-asf-file-sink.md)
-   [<span data-ttu-id="52157-137">Definindo propriedades no sink de arquivo</span><span class="sxs-lookup"><span data-stu-id="52157-137">Setting Properties in the File Sink</span></span>](setting-properties-in-the-file-sink.md)
-   [<span data-ttu-id="52157-138">Adicionando metadados ao sink de arquivo</span><span class="sxs-lookup"><span data-stu-id="52157-138">Adding Metadata to the File Sink</span></span>](adding-metadata-to-the-file-sink.md)

## <a name="related-topics"></a><span data-ttu-id="52157-139">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="52157-139">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="52157-140">Sinks de mídia do ASF</span><span class="sxs-lookup"><span data-stu-id="52157-140">ASF Media Sinks</span></span>](asf-media-sinks.md)
</dt> <dt>

[<span data-ttu-id="52157-141">Componentes ASF da camada de pipeline</span><span class="sxs-lookup"><span data-stu-id="52157-141">Pipeline Layer ASF Components</span></span>](pipeline-layer-asf-components.md)
</dt> <dt>

[<span data-ttu-id="52157-142">Suporte a ASF no Media Foundation</span><span class="sxs-lookup"><span data-stu-id="52157-142">ASF Support in Media Foundation</span></span>](asf-support-in-media-foundation.md)
</dt> </dl>

 

 



