---
description: Sobre o MFTs
ms.assetid: ca9cef70-b897-4fd5-9a13-8bf1c2b84b00
title: Sobre o MFTs
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 09adce4bc93c110cf98e4fd8ed427ffcd009c3c1
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103827207"
---
# <a name="about-mfts"></a><span data-ttu-id="76d98-103">Sobre o MFTs</span><span class="sxs-lookup"><span data-stu-id="76d98-103">About MFTs</span></span>

<span data-ttu-id="76d98-104">Transformações de Media Foundation (MFTs) fornecem um modelo genérico para o processamento de dados de mídia.</span><span class="sxs-lookup"><span data-stu-id="76d98-104">Media Foundation transforms (MFTs) provide a generic model for processing media data.</span></span> <span data-ttu-id="76d98-105">MFTs são usados para decodificadores, codificadores e processadores de sinais digitais (DSPs).</span><span class="sxs-lookup"><span data-stu-id="76d98-105">MFTs are used for decoders, encoders, and digital signal processors (DSPs).</span></span> <span data-ttu-id="76d98-106">Em suma, tudo que fica no pipeline de mídia entre a origem da mídia e o coletor de mídia é uma MFT.</span><span class="sxs-lookup"><span data-stu-id="76d98-106">In short, anything that sits in the media pipeline between the media source and the media sink is an MFT.</span></span>

<span data-ttu-id="76d98-107">Para a maioria dos aplicativos, os detalhes do processamento de dados de MFT ficam ocultos por camadas mais altas da arquitetura de Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="76d98-107">For most applications, the details of MFT data processing are hidden by higher layers of the Media Foundation architecture.</span></span> <span data-ttu-id="76d98-108">Muitos aplicativos Media Foundation nunca farão uma chamada direta para um MFT.</span><span class="sxs-lookup"><span data-stu-id="76d98-108">Many Media Foundation applications will never make a direct call to an MFT.</span></span> <span data-ttu-id="76d98-109">No entanto, é certamente possível hospedar um MFT diretamente em seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="76d98-109">However, it is certainly possible to host an MFT directly in your application.</span></span>

<span data-ttu-id="76d98-110">MFTs são uma evolução do modelo de transformação introduzido pela primeira vez com o DirectX Media Objects (DMOs).</span><span class="sxs-lookup"><span data-stu-id="76d98-110">MFTs are an evolution of the transform model first introduced with DirectX Media Objects (DMOs).</span></span> <span data-ttu-id="76d98-111">Na verdade, é relativamente fácil criar uma transformação que dê suporte a ambos os modelos.</span><span class="sxs-lookup"><span data-stu-id="76d98-111">In fact, it is relatively easy to create a transform that supports both models.</span></span> <span data-ttu-id="76d98-112">Em comparação com DMOs, os comportamentos necessários de MFTs são mais claramente especificados, o que facilita a gravação de uma implementação correta.</span><span class="sxs-lookup"><span data-stu-id="76d98-112">Compared with DMOs, the required behaviors of MFTs are more clearly specified, which makes it easier to write a correct implementation.</span></span> <span data-ttu-id="76d98-113">Além disso, o MFTs pode dar suporte ao processamento de vídeo acelerado por hardware.</span><span class="sxs-lookup"><span data-stu-id="76d98-113">In addition, MFTs can support hardware-accelerated video processing.</span></span>

<span data-ttu-id="76d98-114">Este tópico fornece uma breve visão geral do modelo de processamento de MFT, com foco no design geral, em vez de chamadas de método específicas.</span><span class="sxs-lookup"><span data-stu-id="76d98-114">This topic gives a brief overview of the MFT processing model, focusing on the overall design rather than specific method calls.</span></span> <span data-ttu-id="76d98-115">Para obter uma descrição mais detalhada e passo a passo, consulte [modelo básico de processamento de MFT](basic-mft-processing-model.md).</span><span class="sxs-lookup"><span data-stu-id="76d98-115">For a more detailed, step-by-step description, see [Basic MFT Processing Model](basic-mft-processing-model.md).</span></span>

## <a name="streams"></a><span data-ttu-id="76d98-116">Fluxos</span><span class="sxs-lookup"><span data-stu-id="76d98-116">Streams</span></span>

<span data-ttu-id="76d98-117">Uma MFT tem fluxos de entrada e fluxos de saída.</span><span class="sxs-lookup"><span data-stu-id="76d98-117">An MFT has input streams and output streams.</span></span> <span data-ttu-id="76d98-118">Os fluxos de entrada recebem dados e os fluxos de saída produzem dados.</span><span class="sxs-lookup"><span data-stu-id="76d98-118">Input streams receive data, and output streams produce data.</span></span> <span data-ttu-id="76d98-119">Por exemplo, um decodificador tem um fluxo de entrada, que recebe os dados codificados e um fluxo de saída, que produz os dados decodificados.</span><span class="sxs-lookup"><span data-stu-id="76d98-119">For example, a decoder has one input stream, which receives the encoded data, and one output stream, which produces the decoded data.</span></span>

<span data-ttu-id="76d98-120">Os fluxos em uma MFT não são representados como objetos COM distintos.</span><span class="sxs-lookup"><span data-stu-id="76d98-120">The streams on an MFT are not represented as distinct COM objects.</span></span> <span data-ttu-id="76d98-121">Em vez disso, cada fluxo tem um identificador de fluxo designado e os métodos na interface [**IMFTransform**](/windows/desktop/api/mftransform/nn-mftransform-imftransform) usam identificadores de fluxo como parâmetros de entrada.</span><span class="sxs-lookup"><span data-stu-id="76d98-121">Instead, each stream has a designated stream identifier, and the methods in the [**IMFTransform**](/windows/desktop/api/mftransform/nn-mftransform-imftransform) interface take stream identifiers as input parameters.</span></span>

<span data-ttu-id="76d98-122">Alguns MFTs têm um número fixo de fluxos.</span><span class="sxs-lookup"><span data-stu-id="76d98-122">Some MFTs have a fixed number of streams.</span></span> <span data-ttu-id="76d98-123">Por exemplo, decodificadores e codificadores normalmente têm exatamente uma entrada e uma saída.</span><span class="sxs-lookup"><span data-stu-id="76d98-123">For example, decoders and encoders normally have exactly one input and one output.</span></span> <span data-ttu-id="76d98-124">Outros MFTs têm um número dinâmico de fluxos.</span><span class="sxs-lookup"><span data-stu-id="76d98-124">Other MFTs have a dynamic number of streams.</span></span> <span data-ttu-id="76d98-125">Se uma MFT oferecer suporte a fluxos dinâmicos, o cliente poderá adicionar novos fluxos de entrada.</span><span class="sxs-lookup"><span data-stu-id="76d98-125">If an MFT supports dynamic streams, the client can add new input streams.</span></span> <span data-ttu-id="76d98-126">O cliente não pode adicionar fluxos de saída, mas o MFT pode adicionar ou remover fluxos de saída durante o processamento.</span><span class="sxs-lookup"><span data-stu-id="76d98-126">The client cannot add output streams, but the MFT might add or remove output streams during processing.</span></span> <span data-ttu-id="76d98-127">Por exemplo, os multiplexadores geralmente permitem que o cliente adicione fluxos de entrada e tenha uma saída para o fluxo multiplexado.</span><span class="sxs-lookup"><span data-stu-id="76d98-127">For example, multiplexers typically allow the client to add input streams and have one output for the multiplexed stream.</span></span> <span data-ttu-id="76d98-128">Os demultiplexadores são o inverso, com uma entrada, mas um número dinâmico de fluxos de saída, dependendo do conteúdo do fluxo de entrada.</span><span class="sxs-lookup"><span data-stu-id="76d98-128">Demultiplexers are the reverse, with one input but a dynamic number of output streams, depending on the contents of the input stream.</span></span> <span data-ttu-id="76d98-129">A ilustração a seguir mostra a diferença entre o multiplexador e o demultiplexador.</span><span class="sxs-lookup"><span data-stu-id="76d98-129">The following illustration shows the difference between multiplexer and demultiplexer.</span></span>

![diagrama mostrando um codificador/decodificador (1 entrada, 1 saída), um multiplexador (2 entradas, 1 saída) e um demultiplexador (1 entrada, 2 saídas)](images/f2b95bd5-f862-4d66-9d75-550a90f6cc97.gif)

## <a name="media-types"></a><span data-ttu-id="76d98-131">Tipos de mídia</span><span class="sxs-lookup"><span data-stu-id="76d98-131">Media Types</span></span>

<span data-ttu-id="76d98-132">Quando um MFT é criado pela primeira vez, nenhum dos fluxos tem um formato estabelecido.</span><span class="sxs-lookup"><span data-stu-id="76d98-132">When an MFT is first created, none of the streams has an established format.</span></span> <span data-ttu-id="76d98-133">Antes que o MFT possa processar dados, o cliente deve definir os formatos para os fluxos.</span><span class="sxs-lookup"><span data-stu-id="76d98-133">Before the MFT can process data, the client must set the formats for the streams.</span></span> <span data-ttu-id="76d98-134">Por exemplo, com um decodificador, o formato de entrada é o formato de compactação usado no arquivo de origem original, e o formato de saída é um formato descompactado, como áudio PCM ou vídeo RGB.</span><span class="sxs-lookup"><span data-stu-id="76d98-134">For example, with a decoder, the input format is the compression format used in the original source file, and the output format is an uncompressed format, such as PCM audio or RGB video.</span></span> <span data-ttu-id="76d98-135">Os formatos de fluxo são descritos usando [tipos de mídia](media-types.md).</span><span class="sxs-lookup"><span data-stu-id="76d98-135">The stream formats are described using [Media Types](media-types.md).</span></span>

<span data-ttu-id="76d98-136">Dependendo do estado interno do MFT, ele pode fornecer uma lista de possíveis tipos de mídia para cada fluxo.</span><span class="sxs-lookup"><span data-stu-id="76d98-136">Depending on the internal state of the MFT, it might provide a list of possible media types for each stream.</span></span> <span data-ttu-id="76d98-137">Você pode usar essa lista como uma dica ao definir os tipos de mídia.</span><span class="sxs-lookup"><span data-stu-id="76d98-137">You can use this list as a hint when you set the media types.</span></span> <span data-ttu-id="76d98-138">Definir o tipo de mídia em um fluxo pode alterar a lista de tipos possíveis para um outro fluxo.</span><span class="sxs-lookup"><span data-stu-id="76d98-138">Setting the media type on one stream can change the list of possible types for a another stream.</span></span> <span data-ttu-id="76d98-139">Por exemplo, um decodificador normalmente não pode fornecer tipos de saída até que o cliente defina o tipo de entrada.</span><span class="sxs-lookup"><span data-stu-id="76d98-139">For example, a decoder typically cannot provide any output types until the client sets the input type.</span></span> <span data-ttu-id="76d98-140">O tipo de entrada contém as informações de que o decodificador precisa para retornar uma lista de possíveis tipos de saída.</span><span class="sxs-lookup"><span data-stu-id="76d98-140">The input type contains the information that the decoder needs to return a list of possible output types.</span></span>

<span data-ttu-id="76d98-141">Para definir o tipo de mídia em um fluxo, chame [**IMFTransform:: SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) ou [**IMFTransform:: SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype).</span><span class="sxs-lookup"><span data-stu-id="76d98-141">To set the media type on a stream, call [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) or [**IMFTransform::SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype).</span></span> <span data-ttu-id="76d98-142">Para obter a lista de possíveis tipos de mídia para um fluxo, chame [**IMFTransform:: GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) ou [**IMFTransform:: GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype).</span><span class="sxs-lookup"><span data-stu-id="76d98-142">To get the list of possible media types for a stream, call [**IMFTransform::GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) or [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype).</span></span>

## <a name="processing-data"></a><span data-ttu-id="76d98-143">Processando dados</span><span class="sxs-lookup"><span data-stu-id="76d98-143">Processing Data</span></span>

<span data-ttu-id="76d98-144">Depois que o cliente define os tipos de mídia nos fluxos, o MFT está pronto para processar dados.</span><span class="sxs-lookup"><span data-stu-id="76d98-144">After the client sets the media types on the streams, the MFT is ready to process data.</span></span> <span data-ttu-id="76d98-145">Para fazer isso acontecer, o cliente alterna entre fornecer dados de entrada para o MFT e obter dados de saída do MFT:</span><span class="sxs-lookup"><span data-stu-id="76d98-145">To make this happen, the client alternates between providing input data to the MFT and getting output data from the MFT:</span></span>

-   <span data-ttu-id="76d98-146">Para fornecer dados de entrada para o MFT, chame [**IMFTransform::P rocessinput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span><span class="sxs-lookup"><span data-stu-id="76d98-146">To give input data to the MFT, call [**IMFTransform::ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span></span>
-   <span data-ttu-id="76d98-147">Para efetuar pull de dados de saída do MFT, chame [**IMFTransform::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="76d98-147">To pull output data from the MFT, call [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>

<span data-ttu-id="76d98-148">O método [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) usa um ponteiro para um exemplo de mídia alocado pelo cliente.</span><span class="sxs-lookup"><span data-stu-id="76d98-148">The [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) method takes a pointer to a media sample allocated by the client.</span></span> <span data-ttu-id="76d98-149">O exemplo de mídia contém um ou mais buffers, e cada buffer contém dados de entrada para o MFT processar.</span><span class="sxs-lookup"><span data-stu-id="76d98-149">The media sample contains one or more buffers, and each buffer contains input data for the MFT to process.</span></span>

<span data-ttu-id="76d98-150">O método [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) dá suporte a dois modelos de alocação diferentes: ou o MFT aloca os buffers de saída ou o cliente aloca os buffers de saída.</span><span class="sxs-lookup"><span data-stu-id="76d98-150">The [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) method supports two different allocation models: Either the MFT allocates the output buffers, or the client allocates the output buffers.</span></span> <span data-ttu-id="76d98-151">Alguns MFTs dão suporte a ambos os modelos de alocação, mas não são necessários para que um MFT dê suporte a ambos.</span><span class="sxs-lookup"><span data-stu-id="76d98-151">Some MFTs support both allocation models, but it is not required for an MFT to support both.</span></span> <span data-ttu-id="76d98-152">Por exemplo, um MFT pode exigir que o cliente aloque os buffers de saída.</span><span class="sxs-lookup"><span data-stu-id="76d98-152">For example, an MFT might require the client to allocate the output buffers.</span></span> <span data-ttu-id="76d98-153">O método [**IMFTransform:: GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) retorna informações sobre um fluxo de saída, incluindo a qual modelo de alocação o MFT dá suporte.</span><span class="sxs-lookup"><span data-stu-id="76d98-153">The [**IMFTransform::GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) method returns information about an output stream, including which allocation model the MFT supports.</span></span>

<span data-ttu-id="76d98-154">MFTs são projetados para armazenar em buffer o mínimo possível de dados, a fim de minimizar a latência no pipeline.</span><span class="sxs-lookup"><span data-stu-id="76d98-154">MFTs are designed to buffer as little data as possible, in order to minimize latency in the pipeline.</span></span> <span data-ttu-id="76d98-155">Portanto, a qualquer momento, o MFT pode sinalizar uma das seguintes condições:</span><span class="sxs-lookup"><span data-stu-id="76d98-155">Therefore, at any given time, the MFT can signal one of the following conditions:</span></span>

-   <span data-ttu-id="76d98-156">O MFT requer mais dados de entrada.</span><span class="sxs-lookup"><span data-stu-id="76d98-156">The MFT requires more input data.</span></span> <span data-ttu-id="76d98-157">Nesse estado, o MFT não pode produzir saída até que o cliente chame [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) pelo menos uma vez.</span><span class="sxs-lookup"><span data-stu-id="76d98-157">In this state, the MFT cannot produce output until the client calls [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) at least once.</span></span>
-   <span data-ttu-id="76d98-158">O MFT não aceitará mais nenhuma entrada até que o cliente chame [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) pelo menos uma vez.</span><span class="sxs-lookup"><span data-stu-id="76d98-158">The MFT will not accept any more input until the client calls [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) at least once.</span></span>

<span data-ttu-id="76d98-159">Por exemplo, suponha que você esteja usando um decodificador de vídeo para decodificar um fluxo de vídeo que contém uma mistura de quadros-chave e quadros Delta.</span><span class="sxs-lookup"><span data-stu-id="76d98-159">For example, suppose that you are using a video decoder to decode a video stream that contains a mix of key frames and delta frames.</span></span> <span data-ttu-id="76d98-160">Inicialmente, o MFT requer alguma entrada antes de poder decodificar qualquer quadro.</span><span class="sxs-lookup"><span data-stu-id="76d98-160">Initially, the MFT requires some input before it can decode any frames.</span></span> <span data-ttu-id="76d98-161">O cliente chama [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) para entregar o primeiro quadro.</span><span class="sxs-lookup"><span data-stu-id="76d98-161">The client calls [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) to deliver the first frame.</span></span> <span data-ttu-id="76d98-162">Suponha que o primeiro quadro seja um quadro Delta (mostrado no diagrama a seguir como "P" para o quadro previsto).</span><span class="sxs-lookup"><span data-stu-id="76d98-162">Suppose that the first frame is a delta frame (shown in the following diagram as 'P' for predicted frame).</span></span> <span data-ttu-id="76d98-163">O decodificador se mantém nesse quadro, mas não pode produzir nenhuma saída até obter o próximo quadro chave.</span><span class="sxs-lookup"><span data-stu-id="76d98-163">The decoder holds onto this frame, but it cannot produce any output until it gets the next key frame.</span></span>

![diagrama mostrando o MFT que precisa de entrada, apontando para um quadro previsto](images/f5a88ac6-24da-40e5-b356-649aa6f811c3.gif)

<span data-ttu-id="76d98-165">O cliente continua a chamar [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) e, eventualmente, atinge o próximo quadro-chave (mostrado no próximo diagrama como ' I ' para o quadro embutido).</span><span class="sxs-lookup"><span data-stu-id="76d98-165">The client continues to call [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) and eventually reaches the next key frame (shown in the next diagram as 'I' for intra-coded frame).</span></span> <span data-ttu-id="76d98-166">Agora, o decodificador tem quadros suficientes para iniciar a decodificação.</span><span class="sxs-lookup"><span data-stu-id="76d98-166">Now the decoder has enough frames to start decoding.</span></span> <span data-ttu-id="76d98-167">Neste ponto, ele deixa de aceitar a entrada e o cliente deve chamar [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) para obter os quadros decodificados.</span><span class="sxs-lookup"><span data-stu-id="76d98-167">At this point it stops accepting input, and the client must call [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) to get the decoded frames.</span></span>

![diagrama mostrando um MFT que não está aceitando entrada, apontando para um quadro embutido e três quadros previstos](images/ae014a1a-9d03-4cfa-a04d-4a63bdc83f73.gif)

<span data-ttu-id="76d98-169">A abordagem mais simples para o cliente é simplesmente para chamadas alternativas para [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) e [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="76d98-169">The simplest approach for the client is simply to alternate calls to [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) and [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span> <span data-ttu-id="76d98-170">Um algoritmo mais sofisticado é descrito no tópico [modelo de processamento de MFT básico](basic-mft-processing-model.md).</span><span class="sxs-lookup"><span data-stu-id="76d98-170">A more sophisticated algorithm is described in the topic [Basic MFT Processing Model](basic-mft-processing-model.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="76d98-171">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="76d98-171">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="76d98-172">Transformações de Media Foundation</span><span class="sxs-lookup"><span data-stu-id="76d98-172">Media Foundation Transforms</span></span>](media-foundation-transforms.md)
</dt> </dl>

 

 



