---
description: Este tópico descreve o processamento de dados assíncronos para transformações de Media Foundation (MFTs).
ms.assetid: d438ffae-fc50-454f-8ce4-2d6676500fff
title: MFTs assíncrona
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4a16950cf431eff16f2befb382a77910c49ccb2e
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105760635"
---
# <a name="asynchronous-mfts"></a><span data-ttu-id="400eb-103">MFTs assíncrona</span><span class="sxs-lookup"><span data-stu-id="400eb-103">Asynchronous MFTs</span></span>

<span data-ttu-id="400eb-104">Este tópico descreve o processamento de dados assíncronos para transformações de Media Foundation (MFTs).</span><span class="sxs-lookup"><span data-stu-id="400eb-104">This topic describes asynchronous data processing for Media Foundation transforms (MFTs).</span></span>

> [!Note]  
> <span data-ttu-id="400eb-105">Este tópico aplica-se ao Windows 7 ou posterior.</span><span class="sxs-lookup"><span data-stu-id="400eb-105">This topic applies to Windows 7 or later.</span></span>

 

-   [<span data-ttu-id="400eb-106">Sobre MFTs assíncronas</span><span class="sxs-lookup"><span data-stu-id="400eb-106">About Asynchronous MFTs</span></span>](#about-asynchronous-mfts)
-   [<span data-ttu-id="400eb-107">Requisitos gerais</span><span class="sxs-lookup"><span data-stu-id="400eb-107">General Requirements</span></span>](#general-requirements)
-   [<span data-ttu-id="400eb-108">Eventos</span><span class="sxs-lookup"><span data-stu-id="400eb-108">Events</span></span>](#events)
-   [<span data-ttu-id="400eb-109">ProcessInput</span><span class="sxs-lookup"><span data-stu-id="400eb-109">ProcessInput</span></span>](#processinput)
-   [<span data-ttu-id="400eb-110">ProcessOutput</span><span class="sxs-lookup"><span data-stu-id="400eb-110">ProcessOutput</span></span>](#processoutput)
-   [<span data-ttu-id="400eb-111">Drenagem</span><span class="sxs-lookup"><span data-stu-id="400eb-111">Draining</span></span>](#draining)
-   [<span data-ttu-id="400eb-112">Liberação</span><span class="sxs-lookup"><span data-stu-id="400eb-112">Flushing</span></span>](#flushing)
-   [<span data-ttu-id="400eb-113">Marcadores</span><span class="sxs-lookup"><span data-stu-id="400eb-113">Markers</span></span>](#markers)
-   [<span data-ttu-id="400eb-114">Alterações de formato</span><span class="sxs-lookup"><span data-stu-id="400eb-114">Format Changes</span></span>](#format-changes)
-   [<span data-ttu-id="400eb-115">Atributos</span><span class="sxs-lookup"><span data-stu-id="400eb-115">Attributes</span></span>](#attributes)
-   [<span data-ttu-id="400eb-116">Desbloqueando MFTs assíncronas</span><span class="sxs-lookup"><span data-stu-id="400eb-116">Unlocking Asynchronous MFTs</span></span>](#unlocking-asynchronous-mfts)
-   [<span data-ttu-id="400eb-117">Desligando o MFT</span><span class="sxs-lookup"><span data-stu-id="400eb-117">Shutting Down the MFT</span></span>](#shutting-down-the-mft)
-   [<span data-ttu-id="400eb-118">Registro e enumeração</span><span class="sxs-lookup"><span data-stu-id="400eb-118">Registration and Enumeration</span></span>](#registration-and-enumeration)
-   [<span data-ttu-id="400eb-119">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="400eb-119">Related topics</span></span>](#related-topics)

## <a name="about-asynchronous-mfts"></a><span data-ttu-id="400eb-120">Sobre MFTs assíncronas</span><span class="sxs-lookup"><span data-stu-id="400eb-120">About Asynchronous MFTs</span></span>

<span data-ttu-id="400eb-121">Quando MFTs foram introduzidos no Windows Vista, a API foi projetada para o processamento de dados *síncrono* .</span><span class="sxs-lookup"><span data-stu-id="400eb-121">When MFTs were introduced in Windows Vista, the API was designed for *synchronous* data processing.</span></span> <span data-ttu-id="400eb-122">Nesse modelo, a MFT está sempre esperando para obter entrada ou aguardando para produzir a saída.</span><span class="sxs-lookup"><span data-stu-id="400eb-122">In that model, the MFT is always either waiting to get input, or waiting to produce output.</span></span>

<span data-ttu-id="400eb-123">Considere um decodificador de vídeo típico.</span><span class="sxs-lookup"><span data-stu-id="400eb-123">Consider a typical video decoder.</span></span> <span data-ttu-id="400eb-124">Para obter um quadro decodificado, o cliente chama [**IMFTransform::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="400eb-124">To get a decoded frame, the client calls [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span> <span data-ttu-id="400eb-125">Se o decodificador tiver dados suficientes para decodificar um quadro, o **ProcessOutput** será bloqueado enquanto o MFT decodificar o quadro.</span><span class="sxs-lookup"><span data-stu-id="400eb-125">If the decoder has enough data to decode a frame, **ProcessOutput** blocks while the MFT decodes the frame.</span></span> <span data-ttu-id="400eb-126">Caso contrário, **ProcessOutput** retornará **MF_E_TRANSFORM_NEED_MORE_INPUT**, indicando que o cliente deve chamar [**IMFTransform::P rocessinput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span><span class="sxs-lookup"><span data-stu-id="400eb-126">Otherwise, **ProcessOutput** returns **MF_E_TRANSFORM_NEED_MORE_INPUT**, indicating that the client should call [**IMFTransform::ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span></span>

<span data-ttu-id="400eb-127">Esse modelo funciona bem se o decodificador executa todas as suas operações de decodificação em um thread.</span><span class="sxs-lookup"><span data-stu-id="400eb-127">This model works well if the decoder performs all of its decoding operations on one thread.</span></span> <span data-ttu-id="400eb-128">Mas suponha que o decodificador use vários threads para decodificar quadros em paralelo.</span><span class="sxs-lookup"><span data-stu-id="400eb-128">But suppose the decoder uses several threads to decode frames in parallel.</span></span> <span data-ttu-id="400eb-129">Para obter o melhor desempenho, o decodificador deve receber nova entrada sempre que um thread de decodificação se tornar ocioso.</span><span class="sxs-lookup"><span data-stu-id="400eb-129">For the best performance, the decoder should receive new input whenever a decoding thread becomes idle.</span></span> <span data-ttu-id="400eb-130">Mas a taxa em que os threads concluíram as operações de decodificação não serão alinhadas exatamente às chamadas do cliente para [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) e [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput), resultando em threads aguardando o trabalho.</span><span class="sxs-lookup"><span data-stu-id="400eb-130">But the rate at which threads complete decoding operations will not align exactly with the client's calls to [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) and [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput), resulting in threads waiting for work.</span></span>

<span data-ttu-id="400eb-131">O Windows 7 introduz o processamento *assíncrono* controlado por eventos para MFTs.</span><span class="sxs-lookup"><span data-stu-id="400eb-131">Windows 7 introduces event-driven, *asynchronous* processing for MFTs.</span></span> <span data-ttu-id="400eb-132">Nesse modelo, sempre que o MFT precisa de entrada ou tem saída, ele envia um evento para o cliente.</span><span class="sxs-lookup"><span data-stu-id="400eb-132">In this model, whenever the MFT needs input or has output, it sends an event to the client.</span></span>

## <a name="general-requirements"></a><span data-ttu-id="400eb-133">Requisitos gerais</span><span class="sxs-lookup"><span data-stu-id="400eb-133">General Requirements</span></span>

<span data-ttu-id="400eb-134">Este tópico descreve como o MFTs assíncrono difere do MFT síncrono.</span><span class="sxs-lookup"><span data-stu-id="400eb-134">This topic describes how asynchronous MFTs differ from synchronous MFT.</span></span> <span data-ttu-id="400eb-135">Exceto quando indicado neste tópico, os dois modelos de processamento são os mesmos.</span><span class="sxs-lookup"><span data-stu-id="400eb-135">Except where noted in this topic, the two processing models are the same.</span></span> <span data-ttu-id="400eb-136">(Em particular, a negociação de formato é a mesma.)</span><span class="sxs-lookup"><span data-stu-id="400eb-136">(In particular, format negotiation is the same.)</span></span>

<span data-ttu-id="400eb-137">Uma MFT assíncrona deve implementar as seguintes interfaces:</span><span class="sxs-lookup"><span data-stu-id="400eb-137">An asynchronous MFT must implement the following interfaces:</span></span>

-   [<span data-ttu-id="400eb-138">**IMFTransform**</span><span class="sxs-lookup"><span data-stu-id="400eb-138">**IMFTransform**</span></span>](/windows/desktop/api/mftransform/nn-mftransform-imftransform)
-   [<span data-ttu-id="400eb-139">**IMFMediaEventGenerator**</span><span class="sxs-lookup"><span data-stu-id="400eb-139">**IMFMediaEventGenerator**</span></span>](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator)
-   [<span data-ttu-id="400eb-140">**IMFShutdown**</span><span class="sxs-lookup"><span data-stu-id="400eb-140">**IMFShutdown**</span></span>](/windows/desktop/api/mfidl/nn-mfidl-imfshutdown)

## <a name="events"></a><span data-ttu-id="400eb-141">Eventos</span><span class="sxs-lookup"><span data-stu-id="400eb-141">Events</span></span>

<span data-ttu-id="400eb-142">Um MFT assíncrono usa os seguintes eventos para sinalizar seu status de processamento de dados:</span><span class="sxs-lookup"><span data-stu-id="400eb-142">An asynchronous MFT uses the following events to signal its data-processing status:</span></span>



| <span data-ttu-id="400eb-143">Evento</span><span class="sxs-lookup"><span data-stu-id="400eb-143">Event</span></span>                                                    | <span data-ttu-id="400eb-144">Descrição</span><span class="sxs-lookup"><span data-stu-id="400eb-144">Description</span></span>                                                       |
|----------------------------------------------------------|-------------------------------------------------------------------|
| [<span data-ttu-id="400eb-145">METransformNeedInput</span><span class="sxs-lookup"><span data-stu-id="400eb-145">METransformNeedInput</span></span>](metransformneedinput.md)         | <span data-ttu-id="400eb-146">Enviado quando o MFT pode aceitar mais entradas.</span><span class="sxs-lookup"><span data-stu-id="400eb-146">Sent when the MFT can accept more input.</span></span>                          |
| [<span data-ttu-id="400eb-147">METransformHaveOutput</span><span class="sxs-lookup"><span data-stu-id="400eb-147">METransformHaveOutput</span></span>](metransformhaveoutput.md)       | <span data-ttu-id="400eb-148">Enviado quando o MFT tem saída.</span><span class="sxs-lookup"><span data-stu-id="400eb-148">Sent when the MFT has output.</span></span>                                     |
| [<span data-ttu-id="400eb-149">METransformDrainComplete</span><span class="sxs-lookup"><span data-stu-id="400eb-149">METransformDrainComplete</span></span>](metransformdraincomplete.md) | <span data-ttu-id="400eb-150">Enviado quando uma operação de descarga é concluída.</span><span class="sxs-lookup"><span data-stu-id="400eb-150">Sent when a drain operation completes.</span></span> <span data-ttu-id="400eb-151">Consulte [drenagem](#draining).</span><span class="sxs-lookup"><span data-stu-id="400eb-151">See [Draining](#draining).</span></span> |
| [<span data-ttu-id="400eb-152">METransformMarker</span><span class="sxs-lookup"><span data-stu-id="400eb-152">METransformMarker</span></span>](metransformmarker.md)               | <span data-ttu-id="400eb-153">Enviado quando um marcador é processado.</span><span class="sxs-lookup"><span data-stu-id="400eb-153">Sent when a marker is process.</span></span> <span data-ttu-id="400eb-154">Consulte [marcadores](#markers).</span><span class="sxs-lookup"><span data-stu-id="400eb-154">See [Markers](#markers).</span></span>           |



 

<span data-ttu-id="400eb-155">Esses eventos são enviados fora de banda.</span><span class="sxs-lookup"><span data-stu-id="400eb-155">These events are sent out-of-band.</span></span> <span data-ttu-id="400eb-156">É importante entender a diferença entre eventos em banda e fora de banda no contexto de uma MFT.</span><span class="sxs-lookup"><span data-stu-id="400eb-156">It is important to understand the difference between in-band and out-of-band events in the context of an MFT.</span></span>

<span data-ttu-id="400eb-157">O design de MFT original dá suporte a eventos *em banda* .</span><span class="sxs-lookup"><span data-stu-id="400eb-157">The original MFT design supports *in-band* events.</span></span> <span data-ttu-id="400eb-158">Um evento em banda contém informações sobre o fluxo de dados, como informações sobre uma alteração de formato.</span><span class="sxs-lookup"><span data-stu-id="400eb-158">An in-band event contains information about the data stream, such as information about a format change.</span></span> <span data-ttu-id="400eb-159">O cliente envia eventos em banda para o MFT chamando [**IMFTransform::P rocessevent**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processevent).</span><span class="sxs-lookup"><span data-stu-id="400eb-159">The client sends in-band events to the MFT by calling [**IMFTransform::ProcessEvent**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processevent).</span></span> <span data-ttu-id="400eb-160">O MFT pode enviar eventos em banda de volta para o cliente no método [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) .</span><span class="sxs-lookup"><span data-stu-id="400eb-160">The MFT can send in-band events back to the client in the [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) method.</span></span> <span data-ttu-id="400eb-161">(Especificamente, os eventos são transmitidos no membro **pEvents** da estrutura [**MFT_OUTPUT_DATA_BUFFER**](/windows/desktop/api/mftransform/ns-mftransform-mft_output_data_buffer) .)</span><span class="sxs-lookup"><span data-stu-id="400eb-161">(Specifically, events are conveyed in the **pEvents** member of the [**MFT_OUTPUT_DATA_BUFFER**](/windows/desktop/api/mftransform/ns-mftransform-mft_output_data_buffer) structure.)</span></span>

<span data-ttu-id="400eb-162">Uma MFT envia eventos fora de banda por meio da interface [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator) da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="400eb-162">An MFT sends out-of-band events through the [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator) interface as follows:</span></span>

1.  <span data-ttu-id="400eb-163">O MFT implementa a interface [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator) , conforme descrito em [geradores de eventos de mídia](media-event-generators.md).</span><span class="sxs-lookup"><span data-stu-id="400eb-163">The MFT implements the [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator) interface, as described in [Media Event Generators](media-event-generators.md).</span></span>
2.  <span data-ttu-id="400eb-164">O cliente chama **IUnknown:: QueryInterface** no MFT para a interface [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator) .</span><span class="sxs-lookup"><span data-stu-id="400eb-164">The client calls **IUnknown::QueryInterface** on the MFT for the [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator) interface.</span></span> <span data-ttu-id="400eb-165">Uma MFT assíncrona deve expor essa interface.</span><span class="sxs-lookup"><span data-stu-id="400eb-165">An asynchronous MFT must expose this interface.</span></span> <span data-ttu-id="400eb-166">O MFTs síncrono não deve expor essa interface.</span><span class="sxs-lookup"><span data-stu-id="400eb-166">Synchronous MFTs should not expose this interface.</span></span>
3.  <span data-ttu-id="400eb-167">O cliente chama [**IMFMediaEventGenerator:: BeginGetEvent**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-begingetevent) e [**IMFMediaEventGenerator:: EndGetEvent**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-endgetevent) para receber eventos fora de banda do MFT.</span><span class="sxs-lookup"><span data-stu-id="400eb-167">The client calls [**IMFMediaEventGenerator::BeginGetEvent**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-begingetevent) and [**IMFMediaEventGenerator::EndGetEvent**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-endgetevent) to receive out-of-band events from the MFT.</span></span>

## <a name="processinput"></a><span data-ttu-id="400eb-168">ProcessInput</span><span class="sxs-lookup"><span data-stu-id="400eb-168">ProcessInput</span></span>

<span data-ttu-id="400eb-169">O método [**IMFTransform::P rocessinput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) é modificado da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="400eb-169">The [**IMFTransform::ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) method is modified as follows:</span></span>

1.  <span data-ttu-id="400eb-170">Quando o streaming é iniciado, o cliente envia a mensagem de [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) .</span><span class="sxs-lookup"><span data-stu-id="400eb-170">When streaming starts, the client sends the [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) message.</span></span>
2.  <span data-ttu-id="400eb-171">Durante o streaming, o MFT solicita dados enviando um evento [METransformNeedInput](metransformneedinput.md) .</span><span class="sxs-lookup"><span data-stu-id="400eb-171">During streaming, the MFT requests data by sending an [METransformNeedInput](metransformneedinput.md) event.</span></span> <span data-ttu-id="400eb-172">Os dados do evento são o identificador de fluxo.</span><span class="sxs-lookup"><span data-stu-id="400eb-172">The event data is the stream identifier.</span></span>
3.  <span data-ttu-id="400eb-173">Para cada evento [METransformNeedInput](metransformneedinput.md) , o cliente chama [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) para o fluxo especificado.</span><span class="sxs-lookup"><span data-stu-id="400eb-173">For each [METransformNeedInput](metransformneedinput.md) event, the client calls [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) for the specified stream.</span></span>
4.  <span data-ttu-id="400eb-174">No final do streaming, o cliente pode chamar [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) com a mensagem [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md) .</span><span class="sxs-lookup"><span data-stu-id="400eb-174">At the end of streaming, the client may call [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md) message.</span></span>

<span data-ttu-id="400eb-175">Notas de implementação:</span><span class="sxs-lookup"><span data-stu-id="400eb-175">Implementation notes:</span></span>

-   <span data-ttu-id="400eb-176">O MFT não deve enviar nenhum evento [METransformNeedInput](metransformneedinput.md) até receber a mensagem de [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) .</span><span class="sxs-lookup"><span data-stu-id="400eb-176">The MFT must not send any [METransformNeedInput](metransformneedinput.md) events until it receives the [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) message.</span></span>
-   <span data-ttu-id="400eb-177">Durante o streaming, o MFT pode enviar eventos [METransformNeedInput](metransformneedinput.md) a qualquer momento.</span><span class="sxs-lookup"><span data-stu-id="400eb-177">During streaming, the MFT may send [METransformNeedInput](metransformneedinput.md) events at any time.</span></span>
-   <span data-ttu-id="400eb-178">O MFT deve manter uma contagem de eventos [METransformNeedInput](metransformneedinput.md) pendentes.</span><span class="sxs-lookup"><span data-stu-id="400eb-178">The MFT should maintain a count of pending [METransformNeedInput](metransformneedinput.md) events.</span></span> <span data-ttu-id="400eb-179">Qualquer chamada para [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) que não corresponde a um evento METransformNeedInput deve retornar **MF_E_NOTACCEPTING**.</span><span class="sxs-lookup"><span data-stu-id="400eb-179">Any call to [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) that does not correspond to an METransformNeedInput event must return **MF_E_NOTACCEPTING**.</span></span>
-   <span data-ttu-id="400eb-180">Quando o MFT recebe a mensagem de [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md) , ele redefine a contagem de eventos [METransformNeedInput](metransformneedinput.md) pendentes para zero.</span><span class="sxs-lookup"><span data-stu-id="400eb-180">When the MFT receives the [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md) message, it resets the count of pending [METransformNeedInput](metransformneedinput.md) events to zero.</span></span>
-   <span data-ttu-id="400eb-181">A MFT não deve enviar nenhum evento [METransformNeedInput](metransformneedinput.md) depois que receber a mensagem de [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md) .</span><span class="sxs-lookup"><span data-stu-id="400eb-181">The MFT must not send any [METransformNeedInput](metransformneedinput.md) events after it receives the [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md) message.</span></span>
-   <span data-ttu-id="400eb-182">Se [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) for chamado antes de [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) ou depois de [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md), o método deverá retornar **MF_E_NOTACCEPTING**.</span><span class="sxs-lookup"><span data-stu-id="400eb-182">If [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) is called before [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) or after [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md), the method must return **MF_E_NOTACCEPTING**.</span></span>

## <a name="processoutput"></a><span data-ttu-id="400eb-183">ProcessOutput</span><span class="sxs-lookup"><span data-stu-id="400eb-183">ProcessOutput</span></span>

<span data-ttu-id="400eb-184">O método [**IMFTransform::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) é modificado da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="400eb-184">The [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) method is modified as follows:</span></span>

1.  <span data-ttu-id="400eb-185">Sempre que o MFT tiver saída, ele enviará um evento [METransformHaveOutput](metransformhaveoutput.md) .</span><span class="sxs-lookup"><span data-stu-id="400eb-185">Whenever the MFT has output, it sends an [METransformHaveOutput](metransformhaveoutput.md) event.</span></span>
2.  <span data-ttu-id="400eb-186">Para cada evento [METransformHaveOutput](metransformhaveoutput.md) , o cliente chama [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="400eb-186">For each [METransformHaveOutput](metransformhaveoutput.md) event, the client calls [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>

<span data-ttu-id="400eb-187">Notas de implementação:</span><span class="sxs-lookup"><span data-stu-id="400eb-187">Implementation notes:</span></span>

-   <span data-ttu-id="400eb-188">Se o cliente chamar [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) a qualquer outro momento, o método retornará **E_UNEXPECTED**.</span><span class="sxs-lookup"><span data-stu-id="400eb-188">If the client calls [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) at any other time, the method returns **E_UNEXPECTED**.</span></span>
-   <span data-ttu-id="400eb-189">Um MFT assíncrono nunca deve retornar **MF_E_TRANSFORM_NEED_MORE_INPUT** do método [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) .</span><span class="sxs-lookup"><span data-stu-id="400eb-189">An asynchronous MFT should never return **MF_E_TRANSFORM_NEED_MORE_INPUT** from the [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) method.</span></span> <span data-ttu-id="400eb-190">Se o MFT exigir mais entrada, ele enviará um evento [METransformNeedInput](metransformneedinput.md) .</span><span class="sxs-lookup"><span data-stu-id="400eb-190">If the MFT requires more input, it sends an [METransformNeedInput](metransformneedinput.md) event.</span></span>

## <a name="draining"></a><span data-ttu-id="400eb-191">Drenagem</span><span class="sxs-lookup"><span data-stu-id="400eb-191">Draining</span></span>

<span data-ttu-id="400eb-192">O descarregamento de uma MFT faz com que o MFT produza o máximo de saída possível de qualquer dado de entrada já enviado.</span><span class="sxs-lookup"><span data-stu-id="400eb-192">Draining an MFT causes the MFT to produce as much output as it can from whatever input data has already been sent.</span></span> <span data-ttu-id="400eb-193">O descarregamento de um MFT assíncrono funciona da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="400eb-193">Draining an asynchronous MFT works as follows:</span></span>

1.  <span data-ttu-id="400eb-194">O cliente envia a mensagem de [**MFT_MESSAGE_COMMAND_DRAIN**](mft-message-command-drain.md) .</span><span class="sxs-lookup"><span data-stu-id="400eb-194">The client sends the [**MFT_MESSAGE_COMMAND_DRAIN**](mft-message-command-drain.md) message.</span></span>
2.  <span data-ttu-id="400eb-195">O MFT continua enviando eventos [METransformHaveOutput](metransformhaveoutput.md) até que não haja mais dados a serem processados.</span><span class="sxs-lookup"><span data-stu-id="400eb-195">The MFT continues to send [METransformHaveOutput](metransformhaveoutput.md) events until it has no more data to process.</span></span> <span data-ttu-id="400eb-196">Ele não envia eventos [METransformNeedInput](metransformneedinput.md) durante esse tempo.</span><span class="sxs-lookup"><span data-stu-id="400eb-196">It does not send [METransformNeedInput](metransformneedinput.md) events during this time.</span></span>
3.  <span data-ttu-id="400eb-197">Depois que o MFT envia o último evento [METransformHaveOutput](metransformhaveoutput.md) , ele envia um evento [METransformDrainComplete](metransformdraincomplete.md) .</span><span class="sxs-lookup"><span data-stu-id="400eb-197">After the MFT sends the last [METransformHaveOutput](metransformhaveoutput.md) event, it sends an [METransformDrainComplete](metransformdraincomplete.md) event.</span></span>

<span data-ttu-id="400eb-198">Após a conclusão do descarregamento, o MFT não envia outro evento [METransformNeedInput](metransformneedinput.md) até receber uma mensagem de [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) do cliente.</span><span class="sxs-lookup"><span data-stu-id="400eb-198">After draining is complete, the MFT does not send another [METransformNeedInput](metransformneedinput.md) event until it receives an [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) message from the client.</span></span>

## <a name="flushing"></a><span data-ttu-id="400eb-199">Liberação</span><span class="sxs-lookup"><span data-stu-id="400eb-199">Flushing</span></span>

<span data-ttu-id="400eb-200">O cliente pode liberar o MFT enviando a mensagem de [**MFT_MESSAGE_COMMAND_FLUSH**](mft-message-command-flush.md) .</span><span class="sxs-lookup"><span data-stu-id="400eb-200">The client can flush the MFT by sending the [**MFT_MESSAGE_COMMAND_FLUSH**](mft-message-command-flush.md) message.</span></span> <span data-ttu-id="400eb-201">A MFT descarta todas as amostras de entrada e saída que está segurando.</span><span class="sxs-lookup"><span data-stu-id="400eb-201">The MFT drops all of the input and output samples it is holding.</span></span>

<span data-ttu-id="400eb-202">O MFT não envia outro evento [METransformNeedInput](metransformneedinput.md) até receber uma mensagem de [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) do cliente.</span><span class="sxs-lookup"><span data-stu-id="400eb-202">The MFT does not send another [METransformNeedInput](metransformneedinput.md) event until it receives an [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) message from the client.</span></span>

## <a name="markers"></a><span data-ttu-id="400eb-203">Marcadores</span><span class="sxs-lookup"><span data-stu-id="400eb-203">Markers</span></span>

<span data-ttu-id="400eb-204">O cliente pode marcar um ponto no fluxo enviando a mensagem de [**MFT_MESSAGE_COMMAND_MARKER**](mft-message-command-marker.md) .</span><span class="sxs-lookup"><span data-stu-id="400eb-204">The client can mark a point in the stream by sending the [**MFT_MESSAGE_COMMAND_MARKER**](mft-message-command-marker.md) message.</span></span> <span data-ttu-id="400eb-205">O MFT responde da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="400eb-205">The MFT responds as follows:</span></span>

1.  <span data-ttu-id="400eb-206">O MFT gera tantas amostras de saída quanto possível dos dados de entrada existentes, enviando um evento [METransformHaveOutput](metransformhaveoutput.md) para cada exemplo de saída.</span><span class="sxs-lookup"><span data-stu-id="400eb-206">The MFT generates as many output samples as it can from the existing input data, sending an [METransformHaveOutput](metransformhaveoutput.md) event for each output sample.</span></span>
2.  <span data-ttu-id="400eb-207">Depois que toda a saída é gerada, o MFT envia um evento [METransformMarker](metransformmarker.md) .</span><span class="sxs-lookup"><span data-stu-id="400eb-207">After all of the output is generated, the MFT sends an [METransformMarker](metransformmarker.md) event.</span></span> <span data-ttu-id="400eb-208">Esse evento deve ser enviado após todos os eventos [METransformHaveOutput](metransformhaveoutput.md) .</span><span class="sxs-lookup"><span data-stu-id="400eb-208">This event must be sent after all of the [METransformHaveOutput](metransformhaveoutput.md) events.</span></span>

<span data-ttu-id="400eb-209">Por exemplo, suponha que um decodificador tenha dados de entrada suficientes para produzir quatro amostras de saída.</span><span class="sxs-lookup"><span data-stu-id="400eb-209">For example, suppose that a decoder has enough input data to produce four output samples.</span></span> <span data-ttu-id="400eb-210">Se o cliente enviar a mensagem de [**MFT_MESSAGE_COMMAND_MARKER**](mft-message-command-marker.md) , o MFT enfileirará quatro eventos [METransformHaveOutput](metransformhaveoutput.md) (um por exemplo de saída), seguido por um evento [METransformMarker](metransformmarker.md) .</span><span class="sxs-lookup"><span data-stu-id="400eb-210">If the client sends the [**MFT_MESSAGE_COMMAND_MARKER**](mft-message-command-marker.md) message, the MFT will queue four [METransformHaveOutput](metransformhaveoutput.md) events (one per output sample), followed by an [METransformMarker](metransformmarker.md) event.</span></span>

<span data-ttu-id="400eb-211">A mensagem do marcador é semelhante à mensagem de dreno.</span><span class="sxs-lookup"><span data-stu-id="400eb-211">The marker message is similar to the drain message.</span></span> <span data-ttu-id="400eb-212">No entanto, um dreno é considerado um intervalo no fluxo, enquanto um marcador não é.</span><span class="sxs-lookup"><span data-stu-id="400eb-212">However, a drain is considered a break in the stream, whereas a marker is not.</span></span> <span data-ttu-id="400eb-213">A descarga e os marcadores têm as seguintes diferenças.</span><span class="sxs-lookup"><span data-stu-id="400eb-213">Draining and markers have the following differences.</span></span>

<span data-ttu-id="400eb-214">Drenagem</span><span class="sxs-lookup"><span data-stu-id="400eb-214">Draining:</span></span>

-   <span data-ttu-id="400eb-215">Durante o descarregamento, o MFT não envia eventos [METransformNeedInput](metransformneedinput.md) .</span><span class="sxs-lookup"><span data-stu-id="400eb-215">While draining, the MFT does not send [METransformNeedInput](metransformneedinput.md) events.</span></span>
-   <span data-ttu-id="400eb-216">O MFT descarta todos os dados de entrada que não podem ser usados para criar um exemplo de saída.</span><span class="sxs-lookup"><span data-stu-id="400eb-216">The MFT discards any input data that cannot be used to create an output sample.</span></span>
-   <span data-ttu-id="400eb-217">Alguns MFTs produzem uma "cauda" no final dos dados.</span><span class="sxs-lookup"><span data-stu-id="400eb-217">Some MFTs produce a "tail" at the end of the data.</span></span> <span data-ttu-id="400eb-218">Por exemplo, efeitos de áudio como reverberação ou eco produzem dados extras depois que os dados de entrada são interrompidos.</span><span class="sxs-lookup"><span data-stu-id="400eb-218">For example, audio effects such as reverb or echo produce extra data after the input data has stopped.</span></span> <span data-ttu-id="400eb-219">Um MFT que gera uma parte final deve fazer isso no final de uma operação de descarga.</span><span class="sxs-lookup"><span data-stu-id="400eb-219">An MFT that generates a tail should do so at the end of a drain operation.</span></span>
-   <span data-ttu-id="400eb-220">Após a conclusão da descarga da MFT, ela marca o próximo exemplo de saída com o atributo [**MFSampleExtension_Discontinuity**](mfsampleextension-discontinuity-attribute.md) , para indicar uma descontinuidade no fluxo.</span><span class="sxs-lookup"><span data-stu-id="400eb-220">After the MFT has finished draining, it marks the next output sample with the [**MFSampleExtension_Discontinuity**](mfsampleextension-discontinuity-attribute.md) attribute, to indicate a discontinuity in the stream.</span></span>

<span data-ttu-id="400eb-221">Marker</span><span class="sxs-lookup"><span data-stu-id="400eb-221">Marker:</span></span>

-   <span data-ttu-id="400eb-222">O MFT continua enviando eventos [METransformNeedInput](metransformneedinput.md) antes de enviar o evento de marcador.</span><span class="sxs-lookup"><span data-stu-id="400eb-222">The MFT continues to send [METransformNeedInput](metransformneedinput.md) events before sending the marker event.</span></span>
-   <span data-ttu-id="400eb-223">O MFT não descarta nenhum dado de entrada.</span><span class="sxs-lookup"><span data-stu-id="400eb-223">The MFT does not discard any input data.</span></span> <span data-ttu-id="400eb-224">Se houver dados parciais, ele deverá ser processado após o ponto do marcador.</span><span class="sxs-lookup"><span data-stu-id="400eb-224">If there is partial data, it should be processed after the marker point.</span></span>
-   <span data-ttu-id="400eb-225">O MFT não produz uma parte final no ponto do marcador.</span><span class="sxs-lookup"><span data-stu-id="400eb-225">The MFT does not produce a tail at the marker point.</span></span>
-   <span data-ttu-id="400eb-226">O MFT não define o sinalizador de discontinuidade após o ponto do marcador.</span><span class="sxs-lookup"><span data-stu-id="400eb-226">The MFT does not set the discontinuity flag after the marker point.</span></span>

## <a name="format-changes"></a><span data-ttu-id="400eb-227">Alterações de formato</span><span class="sxs-lookup"><span data-stu-id="400eb-227">Format Changes</span></span>

<span data-ttu-id="400eb-228">Um MFT assíncrono deve dar suporte a alterações de formato dinâmico, conforme descrito em [manipulando alterações de fluxo](handling-stream-changes.md).</span><span class="sxs-lookup"><span data-stu-id="400eb-228">An asynchronous MFT must support dynamic format changes, as described in [Handling Stream Changes](handling-stream-changes.md).</span></span>

## <a name="attributes"></a><span data-ttu-id="400eb-229">Atributos</span><span class="sxs-lookup"><span data-stu-id="400eb-229">Attributes</span></span>

<span data-ttu-id="400eb-230">Uma MFT assíncrona deve implementar o método [**IMFTransform:: GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes) para retornar um repositório de atributos válido.</span><span class="sxs-lookup"><span data-stu-id="400eb-230">An asynchronous MFT must implement the [**IMFTransform::GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes) method to return a valid attribute store.</span></span> <span data-ttu-id="400eb-231">Os seguintes atributos se aplicam a MFTs assíncronas:</span><span class="sxs-lookup"><span data-stu-id="400eb-231">The following attributes apply to asynchronous MFTs:</span></span>



| <span data-ttu-id="400eb-232">Atributo</span><span class="sxs-lookup"><span data-stu-id="400eb-232">Attribute</span></span>                                                                                    | <span data-ttu-id="400eb-233">Descrição</span><span class="sxs-lookup"><span data-stu-id="400eb-233">Description</span></span>                                                                                                                       |
|----------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="400eb-234">MF_TRANSFORM_ASYNC</span><span class="sxs-lookup"><span data-stu-id="400eb-234">MF_TRANSFORM_ASYNC</span></span>](mf-transform-async.md)                                               | <span data-ttu-id="400eb-235">O MFT deve definir esse atributo como **true** (1).</span><span class="sxs-lookup"><span data-stu-id="400eb-235">The MFT must set this attribute to **TRUE** (1).</span></span> <span data-ttu-id="400eb-236">O cliente pode consultar esse atributo para descobrir se o MFT é assíncrono.</span><span class="sxs-lookup"><span data-stu-id="400eb-236">The client can query this attribute to discover whether the MFT is asynchronous.</span></span> |
| [<span data-ttu-id="400eb-237">MF_TRANSFORM_ASYNC_UNLOCK</span><span class="sxs-lookup"><span data-stu-id="400eb-237">MF_TRANSFORM_ASYNC_UNLOCK</span></span>](mf-transform-async-unlock.md)                                |                                                                                                                                   |
| [<span data-ttu-id="400eb-238">**MFT_SUPPORT_DYNAMIC_FORMAT_CHANGE**</span><span class="sxs-lookup"><span data-stu-id="400eb-238">**MFT_SUPPORT_DYNAMIC_FORMAT_CHANGE**</span></span>](mft-support-dynamic-format-change-attribute.md) | <span data-ttu-id="400eb-239">O MFT deve definir esse atributo como **true** (1).</span><span class="sxs-lookup"><span data-stu-id="400eb-239">The MFT must set this attribute to **TRUE** (1).</span></span> <span data-ttu-id="400eb-240">O cliente pode assumir que esse atributo está definido.</span><span class="sxs-lookup"><span data-stu-id="400eb-240">The client can assume that this attribute is set.</span></span>                                |



 

## <a name="unlocking-asynchronous-mfts"></a><span data-ttu-id="400eb-241">Desbloqueando MFTs assíncronas</span><span class="sxs-lookup"><span data-stu-id="400eb-241">Unlocking Asynchronous MFTs</span></span>

<span data-ttu-id="400eb-242">MFTs assíncronas não são compatíveis com o modelo original de processamento de dados de MFT.</span><span class="sxs-lookup"><span data-stu-id="400eb-242">Asynchronous MFTs are not compatible with the original MFT data processing model.</span></span> <span data-ttu-id="400eb-243">Para evitar que MFTs assíncronas quebrem aplicativos existentes, o mecanismo a seguir é definido:</span><span class="sxs-lookup"><span data-stu-id="400eb-243">To prevent asynchronous MFTs from breaking existing applications, the following mechanism is defined:</span></span>

<dl> <span data-ttu-id="400eb-244">O cliente chama os <a href="/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes">atributos IMFTransform::</a> getno MFT.</span><span class="sxs-lookup"><span data-stu-id="400eb-244">The client calls <a href="/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes">IMFTransform::GetAttributes</a> on the MFT.</span></span>  
<span data-ttu-id="400eb-245">O cliente consulta o para este atributo de <a href="mf-transform-async.md">MF_TRANSFORM_ASYNC</a> .</span><span class="sxs-lookup"><span data-stu-id="400eb-245">The client queries the for this <a href="mf-transform-async.md">MF_TRANSFORM_ASYNC</a> attribute.</span></span> <span data-ttu-id="400eb-246">Para uma MFT assíncrona, o valor desse atributo é **true**.</span><span class="sxs-lookup"><span data-stu-id="400eb-246">For an asynchronous MFT, the value of this attribute is **TRUE**.</span></span>  
<span data-ttu-id="400eb-247">Para desbloquear o MFT, o cliente deve definir o atributo <a href="mf-transform-async-unlock.md">MF_TRANSFORM_ASYNC_UNLOCK</a> como **true**.</span><span class="sxs-lookup"><span data-stu-id="400eb-247">To unlock the MFT, the client must sets the <a href="mf-transform-async-unlock.md">MF_TRANSFORM_ASYNC_UNLOCK</a> attribute to **TRUE**.</span></span>  
</dl>

<span data-ttu-id="400eb-248">Até que o cliente desbloqueie o MFT, todos os métodos [**IMFTransform**](/windows/desktop/api/mftransform/nn-mftransform-imftransform) devem retornar **MF_E_TRANSFORM_ASYNC_LOCKED**, com as seguintes exceções:</span><span class="sxs-lookup"><span data-stu-id="400eb-248">Until the client unlocks the MFT, all [**IMFTransform**](/windows/desktop/api/mftransform/nn-mftransform-imftransform) methods should return **MF_E_TRANSFORM_ASYNC_LOCKED**, with the following exceptions:</span></span>

-   <span data-ttu-id="400eb-249">[**IMFTransform:: GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes) (todos os MFTs assíncronos)</span><span class="sxs-lookup"><span data-stu-id="400eb-249">[**IMFTransform::GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes) (all asynchronous MFTs)</span></span>
-   <span data-ttu-id="400eb-250">[**IMFTransform:: GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) (todos os MFTs assíncronos)</span><span class="sxs-lookup"><span data-stu-id="400eb-250">[**IMFTransform::GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) (all asynchronous MFTs)</span></span>
-   <span data-ttu-id="400eb-251">[**IMFTransform:: GetOutputCurrentType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputcurrenttype) (somente codificadores)</span><span class="sxs-lookup"><span data-stu-id="400eb-251">[**IMFTransform::GetOutputCurrentType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputcurrenttype) (encoders only)</span></span>
-   <span data-ttu-id="400eb-252">[**IMFTransform:: SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) (somente codificadores)</span><span class="sxs-lookup"><span data-stu-id="400eb-252">[**IMFTransform::SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) (encoders only)</span></span>
-   <span data-ttu-id="400eb-253">[**IMFTransform:: GetStreamCount**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamcount) (todos os MFTs assíncronos)</span><span class="sxs-lookup"><span data-stu-id="400eb-253">[**IMFTransform::GetStreamCount**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamcount) (all asynchronous MFTs)</span></span>
-   <span data-ttu-id="400eb-254">[**IMFTransform:: GetStreamIDs**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamids) (todos os MFTs assíncronos)</span><span class="sxs-lookup"><span data-stu-id="400eb-254">[**IMFTransform::GetStreamIDs**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamids) (all asynchronous MFTs)</span></span>

<span data-ttu-id="400eb-255">O código a seguir mostra como desbloquear um MFT assíncrono:</span><span class="sxs-lookup"><span data-stu-id="400eb-255">The following code shows how to unlock an asynchronous MFT:</span></span>


```C++
HRESULT UnlockAsyncMFT(IMFTransform *pMFT)
{
    IMFAttributes *pAttributes = NULL;

    HRESULT hr = hr = pMFT->GetAttributes(&pAttributes);

    if (SUCCEEDED(hr))
    {
        hr = pAttributes->SetUINT32(MF_TRANSFORM_ASYNC_UNLOCK, TRUE);
        pAttributes->Release();
    }
    
    return hr;
}
```



## <a name="shutting-down-the-mft"></a><span data-ttu-id="400eb-256">Desligando o MFT</span><span class="sxs-lookup"><span data-stu-id="400eb-256">Shutting Down the MFT</span></span>

<span data-ttu-id="400eb-257">O MFTs assíncrono deve implementar a interface [**IMFShutdown**](/windows/desktop/api/mfidl/nn-mfidl-imfshutdown) .</span><span class="sxs-lookup"><span data-stu-id="400eb-257">Asynchronous MFTs must implement the [**IMFShutdown**](/windows/desktop/api/mfidl/nn-mfidl-imfshutdown) interface.</span></span>

-   <span data-ttu-id="400eb-258">[**Desligamento**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-shutdown): o MFT deve desligar sua fila de eventos.</span><span class="sxs-lookup"><span data-stu-id="400eb-258">[**Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-shutdown): The MFT must shut down its event queue.</span></span> <span data-ttu-id="400eb-259">Se estiver usando a fila de eventos padrão, chame [**IMFMediaEventQueue:: Shutdown**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventqueue-shutdown).</span><span class="sxs-lookup"><span data-stu-id="400eb-259">If using the standard event queue, call [**IMFMediaEventQueue::Shutdown**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventqueue-shutdown).</span></span> <span data-ttu-id="400eb-260">Opcionalmente, o MFT pode liberar outros recursos.</span><span class="sxs-lookup"><span data-stu-id="400eb-260">Optionally, the MFT may release other resources.</span></span> <span data-ttu-id="400eb-261">O cliente não deve usar o MFT depois de chamar o **desligamento**.</span><span class="sxs-lookup"><span data-stu-id="400eb-261">The client must not use the MFT after calling **Shutdown**.</span></span>
-   <span data-ttu-id="400eb-262">[**GetShutdownStatus**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-getshutdownstatus): após o [**desligamento**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-shutdown) ter sido chamado, o MFT deve retornar o valor **MFSHUTDOWN_COMPLETED** no parâmetro *pStatus* .</span><span class="sxs-lookup"><span data-stu-id="400eb-262">[**GetShutdownStatus**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-getshutdownstatus): After [**Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-shutdown) has been called, the MFT should return the value **MFSHUTDOWN_COMPLETED** in the *pStatus* parameter.</span></span> <span data-ttu-id="400eb-263">Ele não deve retornar o valor **MFSHUTDOWN_INITIATED**.</span><span class="sxs-lookup"><span data-stu-id="400eb-263">It should not return the value **MFSHUTDOWN_INITIATED**.</span></span>

## <a name="registration-and-enumeration"></a><span data-ttu-id="400eb-264">Registro e enumeração</span><span class="sxs-lookup"><span data-stu-id="400eb-264">Registration and Enumeration</span></span>

<span data-ttu-id="400eb-265">Para registrar uma MFT assíncrona, chame a função [**MFTRegister**](/windows/desktop/api/mfapi/nf-mfapi-mftregister) e defina o sinalizador **MFT_ENUM_FLAG_ASYNCMFT** no parâmetro *flags* .</span><span class="sxs-lookup"><span data-stu-id="400eb-265">To register an asynchronous MFT, call the [**MFTRegister**](/windows/desktop/api/mfapi/nf-mfapi-mftregister) function and set the **MFT_ENUM_FLAG_ASYNCMFT** flag in the *Flags* parameter.</span></span> <span data-ttu-id="400eb-266">(Anteriormente, esse sinalizador foi reservado.)</span><span class="sxs-lookup"><span data-stu-id="400eb-266">(Previously this flag was reserved.)</span></span>

<span data-ttu-id="400eb-267">Para enumerar MFTs assíncronas, chame a função [**MFTEnumEx**](/windows/desktop/api/mfapi/nf-mfapi-mftenumex) e defina o sinalizador **MFT_ENUM_FLAG_ASYNCMFT** no parâmetro *flags* .</span><span class="sxs-lookup"><span data-stu-id="400eb-267">To enumerate asynchronous MFTs, call the [**MFTEnumEx**](/windows/desktop/api/mfapi/nf-mfapi-mftenumex) function and set the **MFT_ENUM_FLAG_ASYNCMFT** flag in the *Flags* parameter.</span></span> <span data-ttu-id="400eb-268">Para compatibilidade com versões anteriores, a função [**MFTEnum**](/windows/desktop/api/mfapi/nf-mfapi-mftenum) não enumera MFTs assíncrono.</span><span class="sxs-lookup"><span data-stu-id="400eb-268">For backward compatibility, the [**MFTEnum**](/windows/desktop/api/mfapi/nf-mfapi-mftenum) function does not enumerate asynchronous MFTs.</span></span> <span data-ttu-id="400eb-269">Caso contrário, a instalação de uma MFT assíncrona no computador do usuário poderá interromper os aplicativos existentes.</span><span class="sxs-lookup"><span data-stu-id="400eb-269">Otherwise, installing an asynchronous MFT on the user's computer could break existing applications.</span></span>

## <a name="related-topics"></a><span data-ttu-id="400eb-270">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="400eb-270">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="400eb-271">Transformações de Media Foundation</span><span class="sxs-lookup"><span data-stu-id="400eb-271">Media Foundation Transforms</span></span>](media-foundation-transforms.md)
</dt> </dl>

 

 



