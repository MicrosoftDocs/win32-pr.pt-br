---
description: Os modos de codificação de duas passagens têm suporte por determinados codificadores de mídia do Windows e Media Foundation na camada de pipeline.
ms.assetid: 3fd5baff-142f-453e-bb97-b355ee6678fc
title: Como criar uma topologia para Two-Pass a codificação de mídia do Windows
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7c813b9a3c31fafaa3efbea83180c997bc46079d
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/03/2021
ms.locfileid: "103930127"
---
# <a name="how-to-create-a-topology-for-two-pass-windows-media-encoding"></a><span data-ttu-id="68755-103">Como criar uma topologia para Two-Pass a codificação de mídia do Windows</span><span class="sxs-lookup"><span data-stu-id="68755-103">How to Create a Topology for Two-Pass Windows Media Encoding</span></span>

<span data-ttu-id="68755-104">Os modos de codificação de duas passagens têm suporte por determinados codificadores de mídia do Windows e Media Foundation na camada de pipeline.</span><span class="sxs-lookup"><span data-stu-id="68755-104">Two-pass encoding modes are supported by certain Windows Media encoders and Media Foundation at the pipeline layer.</span></span> <span data-ttu-id="68755-105">O aplicativo deve configurar e configurar a topologia de codificação semelhante àquela na codificação de passagem única, mas no modo de codificação de duas passagens, o aplicativo deve executar a sessão de codificação duas vezes.</span><span class="sxs-lookup"><span data-stu-id="68755-105">The application must configure and set up the encoding topology similar to that in single-pass encoding but in the 2-pass encoding mode, the application must run the encoding session twice.</span></span> <span data-ttu-id="68755-106">Na primeira passagem, o codificador reúne informações sobre o conteúdo do fluxo.</span><span class="sxs-lookup"><span data-stu-id="68755-106">On the first pass, the encoder gathers information about the content of the stream.</span></span> <span data-ttu-id="68755-107">Na segunda passagem, usando as informações coletadas na primeira passagem, o arquivo de saída final é gerado.</span><span class="sxs-lookup"><span data-stu-id="68755-107">On the second pass, by using the information gathered on the first pass, the final output file is generated.</span></span> <span data-ttu-id="68755-108">Ao processar os exemplos para o fluxo duas vezes, a codificação de duas passagens otimiza o processo de codificação e produz arquivos codificados com maior qualidade.</span><span class="sxs-lookup"><span data-stu-id="68755-108">By processing the samples for the stream twice, two-pass encoding optimizes the encoding process and produces higher quality encoded files.</span></span> <span data-ttu-id="68755-109">Modos de codificação de duas passagens não podem ser usados em fluxos ao vivo.</span><span class="sxs-lookup"><span data-stu-id="68755-109">Two-pass encoding modes cannot be used on live streams.</span></span>

<span data-ttu-id="68755-110">O Media Foundation dá suporte aos seguintes modos de codificação de duas passagens:</span><span class="sxs-lookup"><span data-stu-id="68755-110">Media Foundation supports the following two-pass encoding modes:</span></span>

-   [<span data-ttu-id="68755-111">Codificação de taxa de bits variável irrestrita</span><span class="sxs-lookup"><span data-stu-id="68755-111">Unconstrained Variable Bit Rate Encoding</span></span>](unconstrained-variable-bit-rate--vbr--encoding.md)
-   [<span data-ttu-id="68755-112">Codificação de taxa de bits de variável com restrição de pico</span><span class="sxs-lookup"><span data-stu-id="68755-112">Peak-Constrained Variable Bit Rate Encoding</span></span>](peak-constrained-variable-bit-rate--vbr--encoding.md)

<span data-ttu-id="68755-113">A criação de uma topologia de codificação para codificação de duas passagens é semelhante a modos de passagem única.</span><span class="sxs-lookup"><span data-stu-id="68755-113">Building an encoding topology for two-pass encoding is similar to single pass modes.</span></span> <span data-ttu-id="68755-114">A lista a seguir mostra as principais diferenças.</span><span class="sxs-lookup"><span data-stu-id="68755-114">The following list shows the key differences.</span></span>

-   <span data-ttu-id="68755-115">A configuração do codificador deve incluir a propriedade [**MFPKEY \_ PASSESUSED**](mfpkey-passesusedproperty.md) definida como 2 e a propriedade [**MFPKEY \_ VBRENABLED**](mfpkey-vbrenabledproperty.md) como Variant \_ true.</span><span class="sxs-lookup"><span data-stu-id="68755-115">Encoder configuration must include the [**MFPKEY\_PASSESUSED**](mfpkey-passesusedproperty.md) property that is set to 2 and the [**MFPKEY\_VBRENABLED**](mfpkey-vbrenabledproperty.md) property to VARIANT\_TRUE.</span></span> <span data-ttu-id="68755-116">Isso filtra os recursos do codificador para modos de duas passagens.</span><span class="sxs-lookup"><span data-stu-id="68755-116">This filters the encoder’s capabilities to two-pass modes.</span></span> <span data-ttu-id="68755-117">Se você estiver usando objetos de ativação, passe essas propriedades para [**MFCreateWMAEncoderActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmaencoderactivate) ou [**MFCreateWMVEncoderActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmvencoderactivate).</span><span class="sxs-lookup"><span data-stu-id="68755-117">If you are using activation objects, pass these properties to [**MFCreateWMAEncoderActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmaencoderactivate) or [**MFCreateWMVEncoderActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmvencoderactivate).</span></span>
-   <span data-ttu-id="68755-118">Para a primeira passagem, use um coletor de mídia fictício no nó de saída porque os exemplos gerados nessa passagem não são adicionados ao arquivo final.</span><span class="sxs-lookup"><span data-stu-id="68755-118">For the first pass, use a dummy media sink in the output node because the samples that are generated in this pass are not added to the final file.</span></span>
-   <span data-ttu-id="68755-119">Para a segunda passagem, consulte o codificador para as propriedades de pós-codificação necessárias e substitua o nó do coletor de mídia fictício pelo coletor de mídia do ASF por essas propriedades definidas.</span><span class="sxs-lookup"><span data-stu-id="68755-119">For the second pass, query the encoder for the required post-encoding properties and replace the dummy media sink node with the ASF media sink with these properties set.</span></span>

<span data-ttu-id="68755-120">Para obter mais informações sobre como configurar uma topologia de codificação, consulte [tutorial: codificação de mídia única de passagem do Windows](tutorial--1-pass-windows-media-encoding.md).</span><span class="sxs-lookup"><span data-stu-id="68755-120">For more information about setting up an encoding topology see, [Tutorial: Single Pass Windows Media Encoding](tutorial--1-pass-windows-media-encoding.md).</span></span>

<span data-ttu-id="68755-121">O procedimento a seguir resume as etapas para codificar o conteúdo do Windows Media em um contêiner ASF usando um modo de codificação de duas passagens.</span><span class="sxs-lookup"><span data-stu-id="68755-121">The following procedure summarizes the steps for encoding Windows Media content in an ASF container by using a two-pass encoding mode.</span></span>

1.  <span data-ttu-id="68755-122">Crie uma origem de mídia para o especificado usando o resolvedor de origem.</span><span class="sxs-lookup"><span data-stu-id="68755-122">Create a media source for the specified by using the source resolver.</span></span>
2.  <span data-ttu-id="68755-123">Enumere os fluxos na origem da mídia.</span><span class="sxs-lookup"><span data-stu-id="68755-123">Enumerate the streams in the media source.</span></span>
3.  <span data-ttu-id="68755-124">Crie o coletor de mídia ASF e adicione coletores de fluxo dependendo dos fluxos na origem de mídia que precisam ser codificados.</span><span class="sxs-lookup"><span data-stu-id="68755-124">Create the ASF media sink and add stream sinks depending on the streams in the media source that need to be encoded.</span></span>
4.  <span data-ttu-id="68755-125">Crie o coletor de mídia.</span><span class="sxs-lookup"><span data-stu-id="68755-125">Create the media sink.</span></span>
5.  <span data-ttu-id="68755-126">Crie os codificadores de mídia do Windows para os fluxos no arquivo de saída.</span><span class="sxs-lookup"><span data-stu-id="68755-126">Create the Windows Media encoders for the streams in the output file.</span></span>
6.  <span data-ttu-id="68755-127">Configure os codificadores com as propriedades de codificação de 2 passagens.</span><span class="sxs-lookup"><span data-stu-id="68755-127">Configure the encoders with the 2-pass encoding properties.</span></span>
7.  <span data-ttu-id="68755-128">Crie uma topologia de codificação parcial conectando a origem, os codificadores e o coletor de mídia.</span><span class="sxs-lookup"><span data-stu-id="68755-128">Build a partial encoding topology by connecting the source, encoders, and the media sink.</span></span>
8.  <span data-ttu-id="68755-129">Crie uma instância da sessão de mídia e defina a topologia na sessão de mídia.</span><span class="sxs-lookup"><span data-stu-id="68755-129">Instantiate the Media Session and set the topology on the Media Session.</span></span>
9.  <span data-ttu-id="68755-130">Execute a primeira passagem de codificação controlando a sessão de mídia e obtendo todos os eventos relevantes da sessão de mídia.</span><span class="sxs-lookup"><span data-stu-id="68755-130">Run the first encoding pass by controlling the Media Session and getting all the relevant events from the Media Session.</span></span>
10. <span data-ttu-id="68755-131">Feche e desligue a sessão de codificação.</span><span class="sxs-lookup"><span data-stu-id="68755-131">Close and shutdown the encoding session.</span></span>
11. <span data-ttu-id="68755-132">Consulte o codificador para as seguintes propriedades, dependendo do tipo de codificação:</span><span class="sxs-lookup"><span data-stu-id="68755-132">Query the encoder for the following properties depending on the type of encoding:</span></span> 

    | <span data-ttu-id="68755-133">Tipo de codificação</span><span class="sxs-lookup"><span data-stu-id="68755-133">Encoding type</span></span>                                                                                        | <span data-ttu-id="68755-134">Nome da propriedade</span><span class="sxs-lookup"><span data-stu-id="68755-134">Property name</span></span>                                                                                                                                                                                                                                                                                                                                                     |
    |------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
    | [<span data-ttu-id="68755-135">Codificação de taxa de bits variável irrestrita</span><span class="sxs-lookup"><span data-stu-id="68755-135">Unconstrained Variable Bit Rate Encoding</span></span>](unconstrained-variable-bit-rate--vbr--encoding.md)       | [<span data-ttu-id="68755-136">**MFPKEY \_ PASSESUSED**</span><span class="sxs-lookup"><span data-stu-id="68755-136">**MFPKEY\_PASSESUSED**</span></span>](mfpkey-passesusedproperty.md)<br/> [<span data-ttu-id="68755-137">**MFPKEY \_ VBRENABLED**</span><span class="sxs-lookup"><span data-stu-id="68755-137">**MFPKEY\_VBRENABLED**</span></span>](mfpkey-vbrenabledproperty.md)<br/> [<span data-ttu-id="68755-138">**MFPKEY \_ BAVG**</span><span class="sxs-lookup"><span data-stu-id="68755-138">**MFPKEY\_BAVG**</span></span>](mfpkey-bavgproperty.md)<br/> [<span data-ttu-id="68755-139">**MFPKEY \_ RAVG**</span><span class="sxs-lookup"><span data-stu-id="68755-139">**MFPKEY\_RAVG**</span></span>](mfpkey-ravgproperty.md)<br/>                                                                                                               |
    | [<span data-ttu-id="68755-140">Codificação de taxa de bits de variável com restrição de pico</span><span class="sxs-lookup"><span data-stu-id="68755-140">Peak-Constrained Variable Bit Rate Encoding</span></span>](peak-constrained-variable-bit-rate--vbr--encoding.md) | [<span data-ttu-id="68755-141">**MFPKEY \_ PASSESUSED**</span><span class="sxs-lookup"><span data-stu-id="68755-141">**MFPKEY\_PASSESUSED**</span></span>](mfpkey-passesusedproperty.md)<br/> [<span data-ttu-id="68755-142">**MFPKEY \_ VBRENABLED**</span><span class="sxs-lookup"><span data-stu-id="68755-142">**MFPKEY\_VBRENABLED**</span></span>](mfpkey-vbrenabledproperty.md)<br/> [<span data-ttu-id="68755-143">**MFPKEY \_ BAVG**</span><span class="sxs-lookup"><span data-stu-id="68755-143">**MFPKEY\_BAVG**</span></span>](mfpkey-bavgproperty.md)<br/> [<span data-ttu-id="68755-144">**MFPKEY \_ RAVG**</span><span class="sxs-lookup"><span data-stu-id="68755-144">**MFPKEY\_RAVG**</span></span>](mfpkey-ravgproperty.md)<br/> [<span data-ttu-id="68755-145">**MFPKEY \_ BMAX**</span><span class="sxs-lookup"><span data-stu-id="68755-145">**MFPKEY\_BMAX**</span></span>](mfpkey-bmaxproperty.md)<br/> [<span data-ttu-id="68755-146">**MFPKEY \_ RMAX**</span><span class="sxs-lookup"><span data-stu-id="68755-146">**MFPKEY\_RMAX**</span></span>](mfpkey-rmaxproperty.md)<br/> |

    

     

12. <span data-ttu-id="68755-147">Crie o coletor de arquivo ASF e adicione os coletores de fluxo necessários dependendo dos fluxos que você deseja incluir no arquivo de saída final.</span><span class="sxs-lookup"><span data-stu-id="68755-147">Create the ASF file sink and add the required stream sinks depending on the streams you want to include in the final output file.</span></span>
13. <span data-ttu-id="68755-148">Defina as propriedades do codificador recuperadas na etapa 11 no coletor de arquivos.</span><span class="sxs-lookup"><span data-stu-id="68755-148">Set the encoder properties retrieved in step 11 on the file sink.</span></span>
14. <span data-ttu-id="68755-149">Substitua o coletor de mídia no nó de saída pelo coletor de arquivos recém-criado.</span><span class="sxs-lookup"><span data-stu-id="68755-149">Replace the media sink in the output node with the newly created file sink.</span></span>
15. <span data-ttu-id="68755-150">Crie uma instância da sessão de mídia e defina a topologia atualizada na sessão de mídia.</span><span class="sxs-lookup"><span data-stu-id="68755-150">Instantiate the Media Session and set the updated topology on the Media Session.</span></span>
16. <span data-ttu-id="68755-151">Execute a segunda passagem de codificação controlando a sessão de mídia e obtendo todos os eventos relevantes da sessão de mídia.</span><span class="sxs-lookup"><span data-stu-id="68755-151">Run second encoding pass by controlling the Media Session and getting all the relevant events from the Media Session.</span></span>
17. <span data-ttu-id="68755-152">Aguarde o evento [MEEndOfPresentation](meendofpresentation.md) da sessão de mídia e, no manipulador de eventos, obtenha os valores de propriedade de codificação do codificador e defina-os no coletor de arquivos.</span><span class="sxs-lookup"><span data-stu-id="68755-152">Wait for the [MEEndOfPresentation](meendofpresentation.md) event from the Media Session and in the event handler get the encoding property values from the encoder and set them on the file sink.</span></span> <span data-ttu-id="68755-153">Para obter mais informações, consulte "atualizar propriedades de codificação no coletor de arquivos" no [tutorial: codificação única de transmissão do Windows Media](tutorial--1-pass-windows-media-encoding.md).</span><span class="sxs-lookup"><span data-stu-id="68755-153">For more information, see "Update Encoding Properties in the File Sink" in [Tutorial: Single Pass Windows Media Encoding](tutorial--1-pass-windows-media-encoding.md).</span></span>
18. <span data-ttu-id="68755-154">Feche e desligue a sessão de codificação.</span><span class="sxs-lookup"><span data-stu-id="68755-154">Close and shutdown the encoding session.</span></span>

## <a name="related-topics"></a><span data-ttu-id="68755-155">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="68755-155">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="68755-156">Componentes ASF da camada de pipeline</span><span class="sxs-lookup"><span data-stu-id="68755-156">Pipeline Layer ASF Components</span></span>](pipeline-layer-asf-components.md)
</dt> </dl>

 

 




