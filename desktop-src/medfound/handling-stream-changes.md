---
description: Este tópico descreve como uma Media Foundation transformação (MFT) deve tratar as alterações de formato durante o streaming.
ms.assetid: b0a94760-b4dd-4e50-a5ce-a1f674dde156
title: Manipulando alterações de fluxo
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2adf3cbc0504a37fe611b77047c73f85b9d1e742
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104164844"
---
# <a name="handling-stream-changes"></a><span data-ttu-id="4b2c4-103">Manipulando alterações de fluxo</span><span class="sxs-lookup"><span data-stu-id="4b2c4-103">Handling Stream Changes</span></span>

<span data-ttu-id="4b2c4-104">Este tópico descreve como uma Media Foundation transformação (MFT) deve tratar as alterações de formato durante o streaming.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-104">This topic describes how a Media Foundation transform (MFT) should handle format changes during streaming.</span></span>

> [!IMPORTANT]
>
> <span data-ttu-id="4b2c4-105">Este tópico não se aplica a codificadores.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-105">This topic does not apply to encoders.</span></span> <span data-ttu-id="4b2c4-106">Os codificadores não devem propagar alterações de formato conforme descrito neste tópico.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-106">Encoders should not propagate format changes as described in this topic.</span></span> <span data-ttu-id="4b2c4-107">Os codificadores devem aceitar apenas um tipo de entrada que corresponda ao tipo de saída atualmente configurado.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-107">Encoders should only accept an input type that matches the currently configured output type.</span></span>

 

## <a name="overview-of-format-changes"></a><span data-ttu-id="4b2c4-108">Visão geral das alterações de formato</span><span class="sxs-lookup"><span data-stu-id="4b2c4-108">Overview of Format Changes</span></span>

<span data-ttu-id="4b2c4-109">Em geral, há dois motivos pelos quais um formato pode ser alterado durante o streaming.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-109">Generally, there are two reasons that a format can change during streaming.</span></span>

-   <span data-ttu-id="4b2c4-110">O cliente pode mudar para um fluxo com um novo formato.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-110">The client might switch to a stream with a new format.</span></span> <span data-ttu-id="4b2c4-111">Por exemplo, na televisão digital, isso pode ocorrer devido a uma alteração de canal.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-111">For example, in digital television, this can occur due to a channel change.</span></span>
-   <span data-ttu-id="4b2c4-112">Em alguns formatos de vídeo, como H. 264, o fragmentado pode sinalizar uma alteração de formato.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-112">In some video formats, such as H.264, the bitstream can signal a format change.</span></span> <span data-ttu-id="4b2c4-113">Essas alterações podem incluir alterações no campo predominância, resolução de vídeo ou taxa de proporção de pixel.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-113">Such changes might include changes in field dominance, video resolution, or pixel aspect ratio.</span></span>

<span data-ttu-id="4b2c4-114">Se o tipo de codificação for alterado, o cliente poderá precisar remover o MFT do pipeline e substituí-lo por outra MFT.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-114">If the encoding type changes, the client might need to remove the MFT from the pipeline and replace it with another MFT.</span></span> <span data-ttu-id="4b2c4-115">(Por exemplo, o cliente pode precisar trocar um novo decodificador.) Este tópico não aborda essa situação.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-115">(For example, the client might need to swap in a new decoder.) This topic does not cover that situation.</span></span> <span data-ttu-id="4b2c4-116">Este tópico aborda apenas o caso em que o MFT atual pode manipular o novo formato.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-116">This topic covers only the case where the current MFT can handle the new format.</span></span>

<span data-ttu-id="4b2c4-117">Se o formato for alterado, o MFT poderá exigir um novo tipo de entrada, um novo tipo de saída ou ambos.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-117">If the format changes, the MFT might require a new input type, a new output type, or both.</span></span>

-   <span data-ttu-id="4b2c4-118">As alterações no tipo de entrada são iniciadas pelo cliente.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-118">Changes to input type are initiated by the client.</span></span> <span data-ttu-id="4b2c4-119">Um MFT nunca altera seu próprio tipo de entrada.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-119">An MFT never changes its own input type.</span></span>
-   <span data-ttu-id="4b2c4-120">As alterações no tipo de saída são iniciadas pelo MFT.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-120">Changes to output type are initiated by the MFT.</span></span> <span data-ttu-id="4b2c4-121">O MFT sinaliza que ele requer um novo tipo de saída, e o cliente negocia o novo tipo de saída com o MFT.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-121">The MFT signals that it requires a new output type, and the client negotiates the new output type with the MFT.</span></span>

<span data-ttu-id="4b2c4-122">Assim, três casos distintos são possíveis:</span><span class="sxs-lookup"><span data-stu-id="4b2c4-122">Thus, three distinct cases are possible:</span></span>

-   <span data-ttu-id="4b2c4-123">O cliente define um novo tipo de entrada.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-123">The client sets a new input type.</span></span> <span data-ttu-id="4b2c4-124">O MFT consome o novo formato, sem alteração em seu tipo de saída.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-124">The MFT consumes the new format, with no change to its output type.</span></span>
-   <span data-ttu-id="4b2c4-125">O cliente define um novo tipo de entrada, e isso dispara uma alteração no tipo de saída.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-125">The client sets a new input type, and this triggers a change in the output type.</span></span>
-   <span data-ttu-id="4b2c4-126">O tipo de entrada não é alterado, mas o MFT detecta uma alteração de formato no fragmentado, que requer um novo tipo de saída.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-126">The input type does not change, but the MFT detects a format change in the bitstream, which requires a new output type.</span></span>

## <a name="implementing-format-changes"></a><span data-ttu-id="4b2c4-127">Implementando alterações de formato</span><span class="sxs-lookup"><span data-stu-id="4b2c4-127">Implementing Format Changes</span></span>

<span data-ttu-id="4b2c4-128">O restante deste tópico descreve como o cliente deve processar uma alteração de formato e como implementar alterações de formato em um MFT.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-128">The remainder of this topic describes how the client should process a format change, and how to implement format changes in an MFT.</span></span>

### <a name="output-type"></a><span data-ttu-id="4b2c4-129">Tipo de saída</span><span class="sxs-lookup"><span data-stu-id="4b2c4-129">Output Type</span></span>

<span data-ttu-id="4b2c4-130">Qualquer MFT pode iniciar uma alteração em seu tipo de saída, da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="4b2c4-130">Any MFT can initiate a change to its output type, as follows:</span></span>

1.  <span data-ttu-id="4b2c4-131">O cliente chama [**IMFTransform::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="4b2c4-131">The client calls [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span> <span data-ttu-id="4b2c4-132">O MFT responde da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="4b2c4-132">The MFT responds as follows:</span></span>
    1.  <span data-ttu-id="4b2c4-133">O MFT não produz um exemplo de saída em [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="4b2c4-133">The MFT does not produce an output sample in [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>
    2.  <span data-ttu-id="4b2c4-134">O MFT define o sinalizador de alteração do formato do buffer de dados de saída do MFT no membro **dwStatus** da estrutura do [**buffer de dados de saída da MFT \_ \_ \_**](/windows/desktop/api/mftransform/ns-mftransform-mft_output_data_buffer) . **\_ \_ \_ \_ \_**</span><span class="sxs-lookup"><span data-stu-id="4b2c4-134">The MFT sets the **MFT\_OUTPUT\_DATA\_BUFFER\_FORMAT\_CHANGE** flag in the **dwStatus** member of the [**MFT\_OUTPUT\_DATA\_BUFFER**](/windows/desktop/api/mftransform/ns-mftransform-mft_output_data_buffer) structure.</span></span>
    3.  <span data-ttu-id="4b2c4-135">O método [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) retorna o código de erro **MF \_ E \_ Transform \_ Stream \_ Change**.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-135">The [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) method returns the error code **MF\_E\_TRANSFORM\_STREAM\_CHANGE**.</span></span>
2.  <span data-ttu-id="4b2c4-136">O cliente chama [**IMFTransform:: GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype).</span><span class="sxs-lookup"><span data-stu-id="4b2c4-136">The client calls [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype).</span></span> <span data-ttu-id="4b2c4-137">Esse método retorna um conjunto atualizado de tipos de saída.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-137">This method returns an updated set of output types.</span></span>
3.  <span data-ttu-id="4b2c4-138">O cliente chama [**Setoutputtypetype**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) para definir um novo tipo de saída.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-138">The client calls [**SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) to set a new output type.</span></span>
4.  <span data-ttu-id="4b2c4-139">O cliente retoma a chamada de [**ProcessInput**](/windows/desktop/api/mfidl/nf-mfidl-imfqualitymanager-notifyprocessinput) / [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="4b2c4-139">The client resumes calling [**ProcessInput**](/windows/desktop/api/mfidl/nf-mfidl-imfqualitymanager-notifyprocessinput)/[**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>

### <a name="input-type"></a><span data-ttu-id="4b2c4-140">Tipo de entrada</span><span class="sxs-lookup"><span data-stu-id="4b2c4-140">Input Type</span></span>

<span data-ttu-id="4b2c4-141">As alterações no tipo de entrada são iniciadas pelo cliente, nunca pela MFT.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-141">Changes to the input type are initiated by the client, never by the MFT.</span></span> <span data-ttu-id="4b2c4-142">Se o tipo de entrada for alterado, ele poderá disparar uma alteração no tipo de saída.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-142">If the input type changes, it might trigger a change to the output type.</span></span>

<span data-ttu-id="4b2c4-143">A sequência exata de eventos depende do valor do atributo de [**\_ alteração de \_ \_ formato dinâmico \_ de suporte de MFT**](mft-support-dynamic-format-change-attribute.md) .</span><span class="sxs-lookup"><span data-stu-id="4b2c4-143">The exact sequence of events depends on the value of the [**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE**](mft-support-dynamic-format-change-attribute.md) attribute.</span></span>



| <span data-ttu-id="4b2c4-144">Valor</span><span class="sxs-lookup"><span data-stu-id="4b2c4-144">Value</span></span>     | <span data-ttu-id="4b2c4-145">Descrição</span><span class="sxs-lookup"><span data-stu-id="4b2c4-145">Description</span></span>                                                     |
|-----------|-----------------------------------------------------------------|
| <span data-ttu-id="4b2c4-146">**FALSE**</span><span class="sxs-lookup"><span data-stu-id="4b2c4-146">**FALSE**</span></span> | <span data-ttu-id="4b2c4-147">Antes que o cliente defina um novo tipo de entrada, ele deve drenar o MFT.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-147">Before the client sets a new input type, it must drain the MFT.</span></span> |
| <span data-ttu-id="4b2c4-148">**TRUE**</span><span class="sxs-lookup"><span data-stu-id="4b2c4-148">**TRUE**</span></span>  | <span data-ttu-id="4b2c4-149">O cliente pode definir um novo tipo de entrada sem descarregar o MFT.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-149">The client can set a new input type without draining the MFT.</span></span>   |



 

<span data-ttu-id="4b2c4-150">Um MFT expõe esse atributo por meio de seu método [**IMFTransform:: GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes) .</span><span class="sxs-lookup"><span data-stu-id="4b2c4-150">An MFT exposes this attribute through its [**IMFTransform::GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes) method.</span></span> <span data-ttu-id="4b2c4-151">O valor padrão desse atributo é **false**; Se o MFT não definir o atributo, trate o valor como **false**.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-151">The default value of this attribute is **FALSE**; if the MFT does not set the attribute, treat the value as **FALSE**.</span></span>

<span data-ttu-id="4b2c4-152">**O MFT \_ dá suporte à \_ alteração de \_ formato dinâmico \_ é falso**</span><span class="sxs-lookup"><span data-stu-id="4b2c4-152">**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE is FALSE**</span></span>

1.  <span data-ttu-id="4b2c4-153">O cliente envia a mensagem de [**dreno do comando de mensagem do MFT \_ \_ \_**](mft-message-command-drain.md) .</span><span class="sxs-lookup"><span data-stu-id="4b2c4-153">The client sends the [**MFT\_MESSAGE\_COMMAND\_DRAIN**](mft-message-command-drain.md) message.</span></span>
2.  <span data-ttu-id="4b2c4-154">O cliente drena o MFT chamando [**IMFTransform::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) até que **ProcessOutput** retorne **MF \_ E \_ transformação \_ precisam de \_ mais \_ entradas**.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-154">The client drains the MFT by calling [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) until **ProcessOutput** returns **MF\_E\_TRANSFORM\_NEED\_MORE\_INPUT**.</span></span>
3.  <span data-ttu-id="4b2c4-155">O cliente chama [**IMFTransform:: SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) para definir o novo tipo de entrada.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-155">The client calls [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) to set the new input type.</span></span>
4.  <span data-ttu-id="4b2c4-156">O MFT valida o tipo de entrada.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-156">The MFT validates the input type.</span></span> <span data-ttu-id="4b2c4-157">Se o tipo for inválido, [**SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) retornará **MF \_ E \_ INVALIDMEDIATYPE** ou outro código de erro.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-157">If the type is invalid, [**SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) returns **MF\_E\_INVALIDMEDIATYPE** or another error code.</span></span> <span data-ttu-id="4b2c4-158">Caso contrário, **SetInputType** retornará S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-158">Otherwise, **SetInputType** returns S\_OK.</span></span>
5.  <span data-ttu-id="4b2c4-159">Supondo que o tipo de entrada seja válido, o MFT avalia se o tipo de saída também é alterado.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-159">Assuming the input type is valid, the MFT evaluates whether the output type also changes.</span></span> <span data-ttu-id="4b2c4-160">Caso contrário, o streaming continuará e nenhuma ação adicional será necessária.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-160">If not, streaming continues, and no further action is required.</span></span>
6.  <span data-ttu-id="4b2c4-161">Se o tipo de saída for alterado:</span><span class="sxs-lookup"><span data-stu-id="4b2c4-161">If the output type changes:</span></span>
    1.  <span data-ttu-id="4b2c4-162">O MFT invalida seu tipo de mídia de saída atual e atualiza a lista de tipos de mídia de saída disponíveis.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-162">The MFT invalidates its current output media type, and updates the list of available output media types.</span></span>
    2.  <span data-ttu-id="4b2c4-163">A próxima chamada para [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) retorna **a \_ \_ alteração do \_ fluxo \_ de MF e de transformação**, conforme descrito na seção anterior.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-163">The next call to [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) returns **MF\_E\_TRANSFORM\_STREAM\_CHANGE**, as described in the previous section.</span></span>
    3.  <span data-ttu-id="4b2c4-164">O cliente chama [**IMFTransform:: GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) para obter a lista atualizada de tipos de saída.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-164">The client calls [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) to get the updated list of output types.</span></span>
    4.  <span data-ttu-id="4b2c4-165">O cliente chama [**Setoutputtypetype**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype).</span><span class="sxs-lookup"><span data-stu-id="4b2c4-165">The client calls [**SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype).</span></span>

<span data-ttu-id="4b2c4-166">**O MFT \_ dá suporte à \_ alteração de \_ formato dinâmico \_ é verdadeiro**</span><span class="sxs-lookup"><span data-stu-id="4b2c4-166">**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE is TRUE**</span></span>

1.  <span data-ttu-id="4b2c4-167">O cliente chama [**IMFTransform:: SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) para definir o novo tipo de entrada.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-167">The client calls [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) to set the new input type.</span></span>
2.  <span data-ttu-id="4b2c4-168">O MFT valida o tipo de entrada.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-168">The MFT validates the input type.</span></span> <span data-ttu-id="4b2c4-169">Se o tipo for inválido, [**SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) retornará **MF \_ E \_ INVALIDMEDIATYPE** ou outro código de erro.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-169">If the type is invalid, [**SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) returns **MF\_E\_INVALIDMEDIATYPE** or another error code.</span></span> <span data-ttu-id="4b2c4-170">Caso contrário, **SetInputType** retornará S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-170">Otherwise, **SetInputType** returns S\_OK.</span></span>
3.  <span data-ttu-id="4b2c4-171">Supondo que o tipo de entrada seja válido, o MFT avalia se o tipo de saída também é alterado.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-171">Assuming the input type is valid, the MFT evaluates whether the output type also changes.</span></span> <span data-ttu-id="4b2c4-172">Caso contrário, o streaming continuará e nenhuma ação adicional será necessária.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-172">If not, streaming continues, and no further action is required.</span></span>
4.  <span data-ttu-id="4b2c4-173">Antes que o tipo de saída seja alterado, o MFT deve processar qualquer amostra de entrada armazenada em cache, da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="4b2c4-173">Before the output type changes, the MFT must process any cached input samples, as follows:</span></span>
    1.  <span data-ttu-id="4b2c4-174">O MFT não invalida seu tipo de saída atual.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-174">The MFT does not invalidate its current output type.</span></span>
    2.  <span data-ttu-id="4b2c4-175">O MFT produz o máximo de saída possível dos exemplos de entrada em cache.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-175">The MFT produces as much output as it can from the cached input samples.</span></span>
    3.  <span data-ttu-id="4b2c4-176">É opcional se o MFT aceita novos exemplos de entrada enquanto processa as amostras armazenadas em cache.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-176">It is optional whether the MFT accepts new input samples while it processes the cached samples.</span></span> <span data-ttu-id="4b2c4-177">Nesse caso, os novos exemplos de entrada usarão o novo formato de entrada, de modo que o MFT deve manter o controle do ponto quando o formato for alterado.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-177">If so, the new input samples will use the new input format, so the MFT must keep track of the point when the format changed.</span></span>
5.  <span data-ttu-id="4b2c4-178">Depois que o MFT processa todos os exemplos recebidos antes do tipo de entrada alterado, o [**IMFTransform::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) retorna **MF \_ E \_ Transform \_ Stream \_ Change**.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-178">After the MFT processes all of the samples that it received before the input type changed, the [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) returns **MF\_E\_TRANSFORM\_STREAM\_CHANGE**.</span></span>
6.  <span data-ttu-id="4b2c4-179">O MFT invalida seu tipo de saída atual e atualiza a lista de tipos de mídia de saída disponíveis.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-179">The MFT invalidates its current output type, and updates the list of available output media types.</span></span>
7.  <span data-ttu-id="4b2c4-180">O cliente negocia o novo tipo de saída, conforme descrito anteriormente.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-180">The client negotiates the new output type, as described previously.</span></span>

<span data-ttu-id="4b2c4-181">O [MFTs assíncrono](asynchronous-mfts.md) deve retornar o valor **true** para o atributo de [**\_ \_ \_ \_ alteração de formato dinâmico de suporte de MFT**](mft-support-dynamic-format-change-attribute.md) .</span><span class="sxs-lookup"><span data-stu-id="4b2c4-181">[Asynchronous MFTs](asynchronous-mfts.md) must return the value **TRUE** for the [**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE**](mft-support-dynamic-format-change-attribute.md) attribute.</span></span> <span data-ttu-id="4b2c4-182">Ao usar uma MFT assíncrona, o cliente pode assumir que o atributo de **\_ \_ \_ \_ alteração de formato dinâmico de suporte de MFT** está definido como **true**.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-182">When using an asynchronous MFT, the client can assume that the **MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE** attribute is set to **TRUE**.</span></span>

<span data-ttu-id="4b2c4-183">Quando o [**MFT \_ dá suporte à \_ \_ \_ alteração de formato dinâmico**](mft-support-dynamic-format-change-attribute.md) é **verdadeiro**, a principal diferença é que o cliente não precisa drenar o MFT antes de definir um novo tipo de entrada.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-183">When [**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE**](mft-support-dynamic-format-change-attribute.md) is **TRUE**, the main difference is that the client is not required to drain the MFT before setting a new input type.</span></span> <span data-ttu-id="4b2c4-184">Como resultado, o tipo de entrada pode mudar enquanto o MFT estiver mantendo os exemplos de entrada.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-184">As a result, the input type might change while the MFT is holding onto input samples.</span></span> <span data-ttu-id="4b2c4-185">É importante que o MFT não simplesmente descarte esses exemplos.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-185">It is important that the MFT does not simply drop these samples.</span></span> <span data-ttu-id="4b2c4-186">Além disso, o tipo de saída não pode ser alterado até que o MFT processe todos os seus dados armazenados em cache.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-186">Also, the output type cannot change until the MFT processes all of its cached data.</span></span>

<span data-ttu-id="4b2c4-187">O parágrafo anterior se aplica especialmente a decodificadores de vídeo, que podem receber quadros embutidos fora da ordem temporal e, portanto, precisam armazená-los em cache.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-187">The previous paragraph applies especially to video decoders, which can receive inter-coded frames out of temporal order, and thus need to cache them.</span></span> <span data-ttu-id="4b2c4-188">Se uma MFT não armazenar amostras de entrada em cache, o descarregamento é essencialmente um não op.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-188">If an MFT does not cache input samples, draining is essentially a no-op.</span></span> <span data-ttu-id="4b2c4-189">Nesse caso, o MFT pode definir a [**\_ alteração de \_ \_ formato dinâmico \_ do suporte de MFT**](mft-support-dynamic-format-change-attribute.md) para **false** (ou deixar a definição do atributo).</span><span class="sxs-lookup"><span data-stu-id="4b2c4-189">In that case, the MFT can set [**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE**](mft-support-dynamic-format-change-attribute.md) to **FALSE** (or leave the attribute unset).</span></span>

<span data-ttu-id="4b2c4-190">Além disso, observe que cada MFT é esperado para tratar as alterações de formato corretamente após serem descarregadas.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-190">Also, note that every MFT is expected to handle format changes correctly after being drained.</span></span> <span data-ttu-id="4b2c4-191">O atributo de [**\_ \_ \_ \_ alteração de formato dinâmico de suporte de MFT**](mft-support-dynamic-format-change-attribute.md) indica se o MFT dá suporte a alterações de formato sem drenagem.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-191">The [**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE**](mft-support-dynamic-format-change-attribute.md) attribute indicates whether the MFT supports format changes without draining.</span></span>

## <a name="change-in-interlace-mode"></a><span data-ttu-id="4b2c4-192">Alterar no modo de entrelaçamento</span><span class="sxs-lookup"><span data-stu-id="4b2c4-192">Change in Interlace Mode</span></span>

<span data-ttu-id="4b2c4-193">As alterações no modo de entrelaçamento de vídeo são um caso especial, porque não invalidam o tipo de mídia atual.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-193">Changes in the video interlacing mode are a special case, because they do not invalidate the current media type.</span></span> <span data-ttu-id="4b2c4-194">Em vez disso, o modo de entrelaçamento é especificado para cada quadro de vídeo definindo atributos no exemplo de mídia.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-194">Instead, the interlace mode is specified for each video frame by setting attributes on the media sample.</span></span> <span data-ttu-id="4b2c4-195">Um MFT de vídeo deve verificar cada exemplo de entrada para a presença desses sinalizadores.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-195">A video MFT should check each input sample for the presence of these flags.</span></span>

<span data-ttu-id="4b2c4-196">O modo de entrelaçamento pode ser alterado quando o campo predominância alterna do campo de cima para baixo, ou quando o vídeo alterna entre imagens progressivas e entrelaçadas.</span><span class="sxs-lookup"><span data-stu-id="4b2c4-196">The interlace mode can change when the field dominance switches from top-field to bottom-field, or when the video switches between progressive and interlaced pictures.</span></span>

<span data-ttu-id="4b2c4-197">Para obter mais informações, consulte os [sinalizadores de entrelaçamento em exemplos](video-interlacing.md).</span><span class="sxs-lookup"><span data-stu-id="4b2c4-197">For more information, see [Interlace Flags on Samples](video-interlacing.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="4b2c4-198">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="4b2c4-198">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="4b2c4-199">Gravando uma MFT personalizada</span><span class="sxs-lookup"><span data-stu-id="4b2c4-199">Writing a Custom MFT</span></span>](writing-a-custom-mft.md)
</dt> </dl>

 

 



