---
description: Este tópico descreve como dar suporte ao Microsoft Direct3D 11 em um decodificador Microsoft Media Foundation.
ms.assetid: 656556AA-0266-4318-9D3C-AED75BD728F6
title: Dando suporte à decodificação de vídeo do Direct3D 11 no Media Foundation
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 542f7244922dc7947f22e4d33027fdcac1962fe5
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/03/2021
ms.locfileid: "105755922"
---
# <a name="supporting-direct3d-11-video-decoding-in-media-foundation"></a><span data-ttu-id="0edc7-103">Dando suporte à decodificação de vídeo do Direct3D 11 no Media Foundation</span><span class="sxs-lookup"><span data-stu-id="0edc7-103">Supporting Direct3D 11 Video Decoding in Media Foundation</span></span>

<span data-ttu-id="0edc7-104">Este tópico descreve como dar suporte ao Microsoft Direct3D 11 em um decodificador Microsoft Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="0edc7-104">This topic describes how to support Microsoft Direct3D 11 in a Microsoft Media Foundation decoder.</span></span> <span data-ttu-id="0edc7-105">Especificamente, ele descreve a comunicação entre o decodificador e o processador de vídeo.</span><span class="sxs-lookup"><span data-stu-id="0edc7-105">Specifically, it describes the communication between the decoder and the video renderer.</span></span> <span data-ttu-id="0edc7-106">Este tópico não descreve como implementar as operações de decodificação.</span><span class="sxs-lookup"><span data-stu-id="0edc7-106">This topic does not describe how to implement the decoding operations.</span></span>

-   [<span data-ttu-id="0edc7-107">Visão geral</span><span class="sxs-lookup"><span data-stu-id="0edc7-107">Overview</span></span>](#overview)
-   [<span data-ttu-id="0edc7-108">Abrir um identificador de dispositivo</span><span class="sxs-lookup"><span data-stu-id="0edc7-108">Open a Device Handle</span></span>](#open-a-device-handle)
-   [<span data-ttu-id="0edc7-109">Localizar uma configuração de decodificador</span><span class="sxs-lookup"><span data-stu-id="0edc7-109">Find a Decoder Configuration</span></span>](#find-a-decoder-configuration)
-   [<span data-ttu-id="0edc7-110">Fallback para decodificação de software</span><span class="sxs-lookup"><span data-stu-id="0edc7-110">Fallback to Software Decoding</span></span>](#fallback-to-software-decoding)
-   [<span data-ttu-id="0edc7-111">Alocando buffers descompactados</span><span class="sxs-lookup"><span data-stu-id="0edc7-111">Allocating Uncompressed Buffers</span></span>](#allocating-uncompressed-buffers)
-   [<span data-ttu-id="0edc7-112">Decodificação</span><span class="sxs-lookup"><span data-stu-id="0edc7-112">Decoding</span></span>](#supporting-direct3d-11-video-decoding-in-media-foundation)
-   [<span data-ttu-id="0edc7-113">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="0edc7-113">Related topics</span></span>](#related-topics)

## <a name="overview"></a><span data-ttu-id="0edc7-114">Visão geral</span><span class="sxs-lookup"><span data-stu-id="0edc7-114">Overview</span></span>

<span data-ttu-id="0edc7-115">No restante deste tópico, são usados os seguintes termos:</span><span class="sxs-lookup"><span data-stu-id="0edc7-115">In the remainder of this topic, the following terms are used:</span></span>

-   <span data-ttu-id="0edc7-116">**Decodificador de software**.</span><span class="sxs-lookup"><span data-stu-id="0edc7-116">**Software decoder**.</span></span> <span data-ttu-id="0edc7-117">O decodificador de software é a Media Foundation transformação (MFT) que recebe amostras de vídeo compactadas e gera quadros de vídeo descompactados.</span><span class="sxs-lookup"><span data-stu-id="0edc7-117">The software decoder is the Media Foundation transform (MFT) that receives compressed video samples and outputs uncompressed video frames.</span></span>
-   <span data-ttu-id="0edc7-118">**Dispositivo decodificador**.</span><span class="sxs-lookup"><span data-stu-id="0edc7-118">**Decoder device**.</span></span> <span data-ttu-id="0edc7-119">O dispositivo decodificador é o acelerador de vídeo e é implementado pelo driver de gráficos.</span><span class="sxs-lookup"><span data-stu-id="0edc7-119">The decoder device is the video accelerator, and is implemented by the graphics driver.</span></span> <span data-ttu-id="0edc7-120">O dispositivo decodificador executa operações de decodificação aceleradas.</span><span class="sxs-lookup"><span data-stu-id="0edc7-120">The decoder device performs accelerated decoding operations.</span></span>
-   <span data-ttu-id="0edc7-121">**Pipeline**.</span><span class="sxs-lookup"><span data-stu-id="0edc7-121">**Pipeline**.</span></span> <span data-ttu-id="0edc7-122">O pipeline hospeda o decodificador de software e entrega buffers de e para o decodificador de software.</span><span class="sxs-lookup"><span data-stu-id="0edc7-122">The pipeline hosts the software decoder and delivers buffers to and from the software decoder.</span></span> <span data-ttu-id="0edc7-123">Dependendo do aplicativo, o pipeline pode ser a sessão de [mídia](media-session.md), o [leitor de origem](source-reader.md)ou o código do aplicativo que chama diretamente o MFT.</span><span class="sxs-lookup"><span data-stu-id="0edc7-123">Depending on the application, the pipeline might be the [Media Session](media-session.md), the [Source Reader](source-reader.md), or application code that directly calls into the MFT.</span></span>

<span data-ttu-id="0edc7-124">Para executar a decodificação usando o Direct3D 11, o decodificador de software deve ter um ponteiro para um dispositivo Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="0edc7-124">To perform decoding using Direct3D 11, the software decoder must have a pointer to a Direct3D 11 device.</span></span> <span data-ttu-id="0edc7-125">O dispositivo Direct3D 11 é criado externamente ao decodificador de software.</span><span class="sxs-lookup"><span data-stu-id="0edc7-125">The Direct3D 11 device is created externally to the software decoder.</span></span> <span data-ttu-id="0edc7-126">Em um cenário de [sessão de mídia](media-session.md) , o processador de vídeo cria o dispositivo Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="0edc7-126">In a [Media Session](media-session.md) scenario, the video renderer creates the Direct3D 11 device.</span></span> <span data-ttu-id="0edc7-127">Em um cenário de [leitor de origem](source-reader.md) , normalmente o aplicativo cria o dispositivo Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="0edc7-127">In a [Source Reader](source-reader.md) scenario, typically the application creates the Direct3D 11 device.</span></span>

<span data-ttu-id="0edc7-128">O Gerenciador de Dispositivos DXGI é usado para compartilhar o Direct3D 11 entre componentes.</span><span class="sxs-lookup"><span data-stu-id="0edc7-128">The DXGI Device Manager is used to share the Direct3D 11 between components.</span></span> <span data-ttu-id="0edc7-129">O Gerenciador de Dispositivos DXGI expõe a interface [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) .</span><span class="sxs-lookup"><span data-stu-id="0edc7-129">The DXGI Device Manager exposes the [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) interface.</span></span> <span data-ttu-id="0edc7-130">O pipeline define o ponteiro **IMFDXGIDeviceManager** no decodificador de software enviando a mensagem [**MFT do Gerenciador de mensagens do conjunto de valores do \_ \_ \_ D3D \_**](mft-message-set-d3d-manager.md) .</span><span class="sxs-lookup"><span data-stu-id="0edc7-130">The pipeline sets the **IMFDXGIDeviceManager** pointer on the software decoder by sending the [**MFT\_MESSAGE\_SET\_D3D\_MANAGER**](mft-message-set-d3d-manager.md) message.</span></span>

<span data-ttu-id="0edc7-131">O diagrama a seguir mostra a relação entre o decodificador de software, o Direct3D 11 e o pipeline.</span><span class="sxs-lookup"><span data-stu-id="0edc7-131">The following diagram shows the relation between the software decoder, the Direct3D 11, and the pipeline.</span></span>

![um diagrama que mostra o decodificador de software e o Gerenciador de dispositivos dxgi.](images/d3d11video01.png)

<span data-ttu-id="0edc7-133">Aqui estão as etapas básicas que um decodificador de software deve executar para dar suporte ao Direct3D 11 em Media Foundation:</span><span class="sxs-lookup"><span data-stu-id="0edc7-133">Here are the basic steps that a software decoder must perform to support Direct3D 11 in Media Foundation:</span></span>

1.  <span data-ttu-id="0edc7-134">Abra um identificador para o dispositivo Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="0edc7-134">Open a handle to the Direct3D 11 device.</span></span>
2.  <span data-ttu-id="0edc7-135">Encontre uma configuração de decodificador.</span><span class="sxs-lookup"><span data-stu-id="0edc7-135">Find a decoder configuration.</span></span>
3.  <span data-ttu-id="0edc7-136">Aloque buffers descompactados.</span><span class="sxs-lookup"><span data-stu-id="0edc7-136">Allocate uncompressed buffers.</span></span>
4.  <span data-ttu-id="0edc7-137">Decodificar quadros.</span><span class="sxs-lookup"><span data-stu-id="0edc7-137">Decode frames.</span></span>

<span data-ttu-id="0edc7-138">Essas etapas são descritas mais detalhadamente no restante deste tópico.</span><span class="sxs-lookup"><span data-stu-id="0edc7-138">These steps are described in more detail in the remainder of this topic.</span></span>

## <a name="open-a-device-handle"></a><span data-ttu-id="0edc7-139">Abrir um identificador de dispositivo</span><span class="sxs-lookup"><span data-stu-id="0edc7-139">Open a Device Handle</span></span>

<span data-ttu-id="0edc7-140">O MFT do decodificador usa o Gerenciador de dispositivos DXGI para obter um identificador para o dispositivo Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="0edc7-140">The decoder MFT uses the DXGI device manager to get a handle to the Direct3D 11 device.</span></span> <span data-ttu-id="0edc7-141">Para abrir o identificador do dispositivo, execute as seguintes etapas:</span><span class="sxs-lookup"><span data-stu-id="0edc7-141">To open the device handle, perform the following steps:</span></span>

1.  <span data-ttu-id="0edc7-142">O MFT do decodificador deve expor o atributo [MF \_ SA \_ D3D11 \_ Aware](mf-sa-d3d11-aware.md) com o valor **true**.</span><span class="sxs-lookup"><span data-stu-id="0edc7-142">The decoder MFT must expose the [MF\_SA\_D3D11\_AWARE](mf-sa-d3d11-aware.md) attribute with the value **TRUE**.</span></span>
2.  <span data-ttu-id="0edc7-143">O carregador de topologia consulta esse atributo chamando [**IMFTransform:: GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes).</span><span class="sxs-lookup"><span data-stu-id="0edc7-143">The Topology Loader queries this attribute by calling [**IMFTransform::GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes).</span></span> <span data-ttu-id="0edc7-144">O valor **true** indica que o MFT dá suporte ao Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="0edc7-144">The value **TRUE** indicates that the MFT supports Direct3D 11.</span></span>
3.  <span data-ttu-id="0edc7-145">O carregador de topologia chama [**IMFTransform::P rocessmessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) com a mensagem [**MFT do conjunto de mensagens do \_ \_ \_ \_ Gerenciador de D3D**](mft-message-set-d3d-manager.md) .</span><span class="sxs-lookup"><span data-stu-id="0edc7-145">The Topology Loader calls [**IMFTransform::ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_SET\_D3D\_MANAGER**](mft-message-set-d3d-manager.md) message.</span></span> <span data-ttu-id="0edc7-146">O parâmetro *ulParam* é um ponteiro [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) para o Gerenciador de dispositivos dxgi.</span><span class="sxs-lookup"><span data-stu-id="0edc7-146">The *ulParam* parameter is an [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) pointer to the DXGI device manager.</span></span> <span data-ttu-id="0edc7-147">Consulte este ponteiro para a interface [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) .</span><span class="sxs-lookup"><span data-stu-id="0edc7-147">Query this pointer for the [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) interface.</span></span>
4.  <span data-ttu-id="0edc7-148">Chame [**IMFDXGIDeviceManager:: OpenDeviceHandle**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-opendevicehandle) para obter um identificador para o dispositivo Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="0edc7-148">Call [**IMFDXGIDeviceManager::OpenDeviceHandle**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-opendevicehandle) to get a handle to the Direct3D 11 device.</span></span>
5.  <span data-ttu-id="0edc7-149">Para obter um ponteiro para o dispositivo do Direct3D 11, chame [**IMFDXGIDeviceManager:: GetVideoService**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-getvideoservice).</span><span class="sxs-lookup"><span data-stu-id="0edc7-149">To get a pointer to the Direct3D 11 device, call [**IMFDXGIDeviceManager::GetVideoService**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-getvideoservice).</span></span> <span data-ttu-id="0edc7-150">Passe o identificador do dispositivo e o valor **IID \_ ID3D11Device**.</span><span class="sxs-lookup"><span data-stu-id="0edc7-150">Pass in the device handle and the value **IID\_ID3D11Device**.</span></span> <span data-ttu-id="0edc7-151">O método retorna um ponteiro para a interface [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) .</span><span class="sxs-lookup"><span data-stu-id="0edc7-151">The method returns a pointer to the [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) interface.</span></span>
6.  <span data-ttu-id="0edc7-152">Para obter um ponteiro para o acelerador de vídeo, chame [**IMFDXGIDeviceManager:: GetVideoService**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-getvideoservice) novamente.</span><span class="sxs-lookup"><span data-stu-id="0edc7-152">To get a pointer to the video accelerator, call [**IMFDXGIDeviceManager::GetVideoService**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-getvideoservice) again.</span></span> <span data-ttu-id="0edc7-153">Desta vez, passe o identificador do dispositivo e o valor **IID \_ ID3D11VideoDevice**.</span><span class="sxs-lookup"><span data-stu-id="0edc7-153">This time, pass in the device handle and the value **IID\_ID3D11VideoDevice**.</span></span> <span data-ttu-id="0edc7-154">O método retorna um ponteiro para a interface [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) .</span><span class="sxs-lookup"><span data-stu-id="0edc7-154">The method returns a pointer to the [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) interface.</span></span>
7.  <span data-ttu-id="0edc7-155">Chame [**ID3D11Device:: GetImmediateContext**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-getimmediatecontext) para obter um ponteiro [**ID3D11DeviceContext**](/windows/win32/api/d3d11/nn-d3d11-id3d11devicecontext) .</span><span class="sxs-lookup"><span data-stu-id="0edc7-155">Call [**ID3D11Device::GetImmediateContext**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-getimmediatecontext) to get an [**ID3D11DeviceContext**](/windows/win32/api/d3d11/nn-d3d11-id3d11devicecontext) pointer.</span></span>
8.  <span data-ttu-id="0edc7-156">Chame [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) no [**ID3D11DeviceContext**](/windows/win32/api/d3d11/nn-d3d11-id3d11devicecontext) para obter um ponteiro [**ID3D11VideoContext**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videocontext) .</span><span class="sxs-lookup"><span data-stu-id="0edc7-156">Call [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) on the [**ID3D11DeviceContext**](/windows/win32/api/d3d11/nn-d3d11-id3d11devicecontext) to get an [**ID3D11VideoContext**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videocontext) pointer.</span></span>
9.  <span data-ttu-id="0edc7-157">É recomendável que você use a proteção de vários threads no contexto do dispositivo para evitar problemas de deadlock que às vezes pode acontecer quando você chama [**ID3D11VideoContext:: GetDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) ou [**ID3D11VideoContext:: ReleaseDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-releasedecoderbuffer).</span><span class="sxs-lookup"><span data-stu-id="0edc7-157">It is recommended that you use multi-thread protection on the device context to prevent deadlock issues that can sometimes happen when you call [**ID3D11VideoContext::GetDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) or [**ID3D11VideoContext::ReleaseDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-releasedecoderbuffer).</span></span> <span data-ttu-id="0edc7-158">Para definir a proteção de vários threads, primeiro chame [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) em [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) para obter um ponteiro [**ID3D10Multithread**](/windows/win32/api/d3d10/nn-d3d10-id3d10multithread) .</span><span class="sxs-lookup"><span data-stu-id="0edc7-158">To set multi-thread protection, first call [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) on [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) to get an [**ID3D10Multithread**](/windows/win32/api/d3d10/nn-d3d10-id3d10multithread) pointer.</span></span> <span data-ttu-id="0edc7-159">Em seguida, chame [**ID3D10Multithread:: SetMultithreadProtected**](/windows/win32/api/d3d10/nf-d3d10-id3d10multithread-setmultithreadprotected), passando **true** para *bMTProtect*.</span><span class="sxs-lookup"><span data-stu-id="0edc7-159">Then call [**ID3D10Multithread::SetMultithreadProtected**](/windows/win32/api/d3d10/nf-d3d10-id3d10multithread-setmultithreadprotected), passing in **true** for *bMTProtect*.</span></span>

## <a name="find-a-decoder-configuration"></a><span data-ttu-id="0edc7-160">Localizar uma configuração de decodificador</span><span class="sxs-lookup"><span data-stu-id="0edc7-160">Find a Decoder Configuration</span></span>

<span data-ttu-id="0edc7-161">Para executar a decodificação, o decodificador de software deve encontrar uma configuração compatível com suporte do dispositivo decodificador, incluindo um formato de destino de renderização.</span><span class="sxs-lookup"><span data-stu-id="0edc7-161">To perform decoding, the software decoder must find a compatible configuration that is supported by the decoder device, including a render-target format.</span></span> <span data-ttu-id="0edc7-162">Essa etapa ocorre dentro do método [**IMFTransform:: SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) , como a seguir.</span><span class="sxs-lookup"><span data-stu-id="0edc7-162">This step occurs inside the [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) method, as follows.</span></span>

1.  <span data-ttu-id="0edc7-163">Valide o tipo de mídia de entrada.</span><span class="sxs-lookup"><span data-stu-id="0edc7-163">Validate the input media type.</span></span> <span data-ttu-id="0edc7-164">Se o tipo for rejeitado, ignore as etapas restantes e retorne um código de erro.</span><span class="sxs-lookup"><span data-stu-id="0edc7-164">If the type is rejected, skip the remaining steps and return an error code.</span></span>
2.  <span data-ttu-id="0edc7-165">Chame [**ID3D11VideoDevice:: GetVideoDecoderProfileCount**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderprofilecount) para obter o número de perfis com suporte.</span><span class="sxs-lookup"><span data-stu-id="0edc7-165">Call [**ID3D11VideoDevice::GetVideoDecoderProfileCount**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderprofilecount) to get the number of supported profiles.</span></span>
3.  <span data-ttu-id="0edc7-166">Chame [**ID3D11VideoDevice:: GetVideoDecoderProfile**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderprofile) para enumerar os perfis e obter os GUIDs de perfil.</span><span class="sxs-lookup"><span data-stu-id="0edc7-166">Call [**ID3D11VideoDevice::GetVideoDecoderProfile**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderprofile) to enumerate the profiles and get the profile GUIDs.</span></span>
4.  <span data-ttu-id="0edc7-167">Procure um GUID de perfil que corresponda ao formato de vídeo e aos recursos do decodificador de software.</span><span class="sxs-lookup"><span data-stu-id="0edc7-167">Look for a profile GUID that matches the video format and the capabilities of the software decoder.</span></span> <span data-ttu-id="0edc7-168">Por exemplo, um decodificador MPEG-2 procura o perfil de decodificador **D3D11 \_ \_ \_ MPEG2 \_ MOCOMP**,**perfil de \_ decodificador do D3D11 \_ \_ MPEG2 \_ IDCT** e **D3D11 de perfil do \_ decodificador \_ \_ MPEG2 \_ VLD**.</span><span class="sxs-lookup"><span data-stu-id="0edc7-168">For example, an MPEG-2 decoder would look for **D3D11\_DECODER\_PROFILE\_MPEG2\_MOCOMP**,**D3D11\_DECODER\_PROFILE\_MPEG2\_IDCT**, and **D3D11\_DECODER\_PROFILE\_MPEG2\_VLD**.</span></span>
5.  <span data-ttu-id="0edc7-169">Se um GUID de decodificador adequado for encontrado, verifique o formato de saída chamando o método [**ID3D11VideoDevice:: CheckVideoDecoderFormat**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-checkvideodecoderformat) .</span><span class="sxs-lookup"><span data-stu-id="0edc7-169">If a suitable decoder GUID is found, check the output format by calling the [**ID3D11VideoDevice::CheckVideoDecoderFormat**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-checkvideodecoderformat) method.</span></span> <span data-ttu-id="0edc7-170">Passe o GUID do decodificador e um valor de **\_ formato dxgi** que especifica o formato de destino de renderização.</span><span class="sxs-lookup"><span data-stu-id="0edc7-170">Pass in the decoder GUID and a **DXGI\_FORMAT** value that specifies the render-target format.</span></span>
6.  <span data-ttu-id="0edc7-171">Em seguida, encontre uma configuração adequada para o decodificador.</span><span class="sxs-lookup"><span data-stu-id="0edc7-171">Next, find a suitable configuration for the decoder.</span></span>
    1.  <span data-ttu-id="0edc7-172">Chame [**ID3D11VideoDevice:: GetVideoDecoderConfigCount**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderconfigcount) para obter o número de configurações de decodificador.</span><span class="sxs-lookup"><span data-stu-id="0edc7-172">Call [**ID3D11VideoDevice::GetVideoDecoderConfigCount**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderconfigcount) to get the number of decoder configurations.</span></span> <span data-ttu-id="0edc7-173">Passe o mesmo GUID do dispositivo decodificador, junto com uma estrutura [**\_ \_ \_ desc de decodificador de vídeo D3D11**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_decoder_desc) que descreve o formato de destino render proposto.</span><span class="sxs-lookup"><span data-stu-id="0edc7-173">Pass in the same decoder device GUID, along with a [**D3D11\_VIDEO\_DECODER\_DESC**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_decoder_desc) structure that describes the proposed render-target format.</span></span>
    2.  <span data-ttu-id="0edc7-174">Chame [**ID3D11VideoDevice:: GetVideoDecoderConfig**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderconfig) para enumerar as configurações do decodificador.</span><span class="sxs-lookup"><span data-stu-id="0edc7-174">Call [**ID3D11VideoDevice::GetVideoDecoderConfig**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderconfig) to enumerate the decoder configurations.</span></span>

<span data-ttu-id="0edc7-175">No método [**IMFTransform:: GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) , retorne um formato de vídeo descompactado com base no formato de destino render proposto.</span><span class="sxs-lookup"><span data-stu-id="0edc7-175">In the [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) method, return an uncompressed video format based on the proposed render-target format.</span></span>

<span data-ttu-id="0edc7-176">No método [**IMFTransform:: SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) , verifique o tipo de mídia em relação ao formato de destino de renderização.</span><span class="sxs-lookup"><span data-stu-id="0edc7-176">In the [**IMFTransform::SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) method, check the media type against the render target format.</span></span>

## <a name="fallback-to-software-decoding"></a><span data-ttu-id="0edc7-177">Fallback para decodificação de software</span><span class="sxs-lookup"><span data-stu-id="0edc7-177">Fallback to Software Decoding</span></span>

<span data-ttu-id="0edc7-178">O MFT pode não conseguir localizar uma configuração.</span><span class="sxs-lookup"><span data-stu-id="0edc7-178">The MFT might be unable to find a configuration.</span></span> <span data-ttu-id="0edc7-179">Por exemplo, o driver de gráficos pode não oferecer suporte aos recursos corretos.</span><span class="sxs-lookup"><span data-stu-id="0edc7-179">For example, the graphics driver might not support the right capabilities.</span></span> <span data-ttu-id="0edc7-180">Nesse caso, o MFT deve retornar à decodificação de software, da seguinte maneira.</span><span class="sxs-lookup"><span data-stu-id="0edc7-180">In that case, the MFT must fall back to software decoding, as follows.</span></span>

1.  <span data-ttu-id="0edc7-181">Os métodos [**setparâmetrosdeentrada**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) e [**SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) devem retornar **MF \_ e \_ sem suporte \_ \_ tipo D3D**.</span><span class="sxs-lookup"><span data-stu-id="0edc7-181">The [**SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) and [**SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) methods should both return **MF\_E\_UNSUPPORTED\_D3D\_TYPE**.</span></span>
2.  <span data-ttu-id="0edc7-182">Em resposta, o carregador de topologia enviará a mensagem do Gerenciador de D3D do conjunto de  mensagens de [**MFT \_ \_ \_ \_**](mft-message-set-d3d-manager.md) com o valor NULL para o parâmetro *ulParam* .</span><span class="sxs-lookup"><span data-stu-id="0edc7-182">In response, the Topology Loader will send the [**MFT\_MESSAGE\_SET\_D3D\_MANAGER**](mft-message-set-d3d-manager.md) message with the value **NULL** for the *ulParam* parameter.</span></span>
3.  <span data-ttu-id="0edc7-183">O MFT libera seu ponteiro para a interface [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) .</span><span class="sxs-lookup"><span data-stu-id="0edc7-183">The MFT releases its pointer to the [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) interface.</span></span>
4.  <span data-ttu-id="0edc7-184">O carregador de topologia renegocia o tipo de mídia.</span><span class="sxs-lookup"><span data-stu-id="0edc7-184">The Topology Loader renegotiates the media type.</span></span>

<span data-ttu-id="0edc7-185">Neste ponto, o MFT pode usar a decodificação de software.</span><span class="sxs-lookup"><span data-stu-id="0edc7-185">At this point, the MFT can use software decoding.</span></span>

## <a name="allocating-uncompressed-buffers"></a><span data-ttu-id="0edc7-186">Alocando buffers descompactados</span><span class="sxs-lookup"><span data-stu-id="0edc7-186">Allocating Uncompressed Buffers</span></span>

<span data-ttu-id="0edc7-187">O decodificador é responsável por alocar texturas do Direct3D 11 para usar como buffers de vídeo não compactados.</span><span class="sxs-lookup"><span data-stu-id="0edc7-187">The decoder is responsible for allocating Direct3D 11 textures to use as uncompressed video buffers.</span></span> <span data-ttu-id="0edc7-188">O [atributo \_ \_ contagem de \_ \_ exemplo \_ de saída mínima de MF](mf-sa-minimum-output-sample-count.md) de e/ou no fluxo de saída atributos (consulte [**IMFTransform:: GetOutputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreamattributes)) é usado para determinar quantas superfícies o decodificador deve alocar para o processador de vídeo usar para desentrelaçamento.</span><span class="sxs-lookup"><span data-stu-id="0edc7-188">The [MF\_SA\_MINIMUM\_OUTPUT\_SAMPLE\_COUNT](mf-sa-minimum-output-sample-count.md) attribute in the output stream attributes (see [**IMFTransform::GetOutputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreamattributes)) is used to determine how many surfaces the decoder should allocate for the video renderer to use for deinterlacing .</span></span> <span data-ttu-id="0edc7-189">Um decodificador deve usar esse valor delimitadondo-o para alguns limites superiores e inferiores razoáveis, por exemplo, 3-32.</span><span class="sxs-lookup"><span data-stu-id="0edc7-189">A decoder should use this value bounding it for some reasonable upper and lower limits, for example 3-32.</span></span> <span data-ttu-id="0edc7-190">Para conteúdo progressivo, consulte a [contagem de amostra de saída mínima de MF de \_ \_ \_ entrada \_ \_ \_ progressiva](mf-sa-minimum-output-sample-count-progressive.md).</span><span class="sxs-lookup"><span data-stu-id="0edc7-190">For progressive content see [MF\_SA\_MINIMUM\_OUTPUT\_SAMPLE\_COUNT\_PROGRESSIVE](mf-sa-minimum-output-sample-count-progressive.md).</span></span>

<span data-ttu-id="0edc7-191">No método [**IMFTransform:: GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) , defina o **fluxo de saída do MFT fornece um sinalizador de \_ \_ \_ \_ exemplos** na estrutura de informações do [**fluxo de saída do MFT \_ \_ \_**](/windows/win32/api/mftransform/ne-mftransform-_mft_output_stream_info_flags) .</span><span class="sxs-lookup"><span data-stu-id="0edc7-191">In the [**IMFTransform::GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) method, set the **MFT\_OUTPUT\_STREAM\_PROVIDES\_SAMPLES** flag in the [**MFT\_OUTPUT\_STREAM\_INFO**](/windows/win32/api/mftransform/ne-mftransform-_mft_output_stream_info_flags) structure.</span></span> <span data-ttu-id="0edc7-192">Esse sinalizador notifica a sessão de mídia de que a MFT aloca seus próprios exemplos de saída.</span><span class="sxs-lookup"><span data-stu-id="0edc7-192">This flag notifies the Media Session that the MFT allocates its own output samples.</span></span> <span data-ttu-id="0edc7-193">Para alocar os exemplos de saída, o MFT executa as seguintes etapas:</span><span class="sxs-lookup"><span data-stu-id="0edc7-193">To allocate the output samples, the MFT performs the following steps:</span></span>

1.  <span data-ttu-id="0edc7-194">Crie uma matriz de textura 2D chamando [**ID3D11Device:: CreateTexture2D**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-createtexture2d).</span><span class="sxs-lookup"><span data-stu-id="0edc7-194">Create a 2D texture array by calling [**ID3D11Device::CreateTexture2D**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-createtexture2d).</span></span> <span data-ttu-id="0edc7-195">Na estrutura [**\_ \_ desc de D3D11 TEXTURE2D**](/windows/win32/api/d3d11/ns-d3d11-d3d11_texture2d_desc) , defina **matrizes** igual ao número de superfícies que o decodificador precisa.</span><span class="sxs-lookup"><span data-stu-id="0edc7-195">In the [**D3D11\_TEXTURE2D\_DESC**](/windows/win32/api/d3d11/ns-d3d11-d3d11_texture2d_desc) structure, set **ArraySize** equal to the number of surfaces that the decoder needs.</span></span> <span data-ttu-id="0edc7-196">Isso inclui:</span><span class="sxs-lookup"><span data-stu-id="0edc7-196">This includes:</span></span>
    -   <span data-ttu-id="0edc7-197">Superfícies para quadros de referência.</span><span class="sxs-lookup"><span data-stu-id="0edc7-197">Surfaces for reference frames.</span></span>
    -   <span data-ttu-id="0edc7-198">Superfícies para desentrelaçamento (três superfícies).</span><span class="sxs-lookup"><span data-stu-id="0edc7-198">Surfaces for deinterlacing (three surfaces).</span></span>
    -   <span data-ttu-id="0edc7-199">Superfícies de que o decodificador precisa para o armazenamento em buffer.</span><span class="sxs-lookup"><span data-stu-id="0edc7-199">Surfaces that the decoder needs for buffering.</span></span>

    <span data-ttu-id="0edc7-200">Os sinalizadores de associação (**BindFlags**) devem incluir o sinalizador de **\_ \_ decodificador de associação D3D11** e todos os sinalizadores de associação definidos por meio do atributo [MF \_ SA \_ D3D11 \_ BindFlags](mf-sa-d3d11-bindflags.md) nos atributos do fluxo de saída.</span><span class="sxs-lookup"><span data-stu-id="0edc7-200">The binding flags (**BindFlags**) should include the **D3D11\_BIND\_DECODER** flag and any bind flags set through the [MF\_SA\_D3D11\_BINDFLAGS](mf-sa-d3d11-bindflags.md) attribute in the output stream attributes.</span></span>
2.  <span data-ttu-id="0edc7-201">Para cada superfície na matriz de textura, chame [**ID3D11VideoDevice:: CreateVideoDecoderOutputView**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoderoutputview) para criar uma exibição de saída de decodificador de vídeo.</span><span class="sxs-lookup"><span data-stu-id="0edc7-201">For each surface in the texture array, call [**ID3D11VideoDevice::CreateVideoDecoderOutputView**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoderoutputview) to create a video decoder output view.</span></span> <span data-ttu-id="0edc7-202">Durante a decodificação, essas exibições de saída serão passadas para o método [**ID3D11VideoContext::D ecoderbeginframe**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe) .</span><span class="sxs-lookup"><span data-stu-id="0edc7-202">During decoding, these output views will be passed to the [**ID3D11VideoContext::DecoderBeginFrame**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe) method.</span></span>
3.  <span data-ttu-id="0edc7-203">Para cada superfície na matriz de textura, crie um exemplo de mídia da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="0edc7-203">For each surface in the texture array, create a media sample as follows:</span></span>
    1.  <span data-ttu-id="0edc7-204">Crie um buffer de mídia DXGI chamando a função [**MFCreateDXGISurfaceBuffer**](/windows/desktop/api/mfapi/nf-mfapi-mfcreatedxgisurfacebuffer) .</span><span class="sxs-lookup"><span data-stu-id="0edc7-204">Create a DXGI media buffer by calling the [**MFCreateDXGISurfaceBuffer**](/windows/desktop/api/mfapi/nf-mfapi-mfcreatedxgisurfacebuffer) function.</span></span> <span data-ttu-id="0edc7-205">Passe o ponteiro [**ID3D11Texture2D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture2d) e o deslocamento para cada elemento na matriz de textura.</span><span class="sxs-lookup"><span data-stu-id="0edc7-205">Pass in the [**ID3D11Texture2D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture2d) pointer and the offset for each element in the texture array.</span></span> <span data-ttu-id="0edc7-206">A função retorna um ponteiro [**IMFMediaBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediabuffer) .</span><span class="sxs-lookup"><span data-stu-id="0edc7-206">The function returns an [**IMFMediaBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediabuffer) pointer.</span></span>
    2.  <span data-ttu-id="0edc7-207">Crie um exemplo de mídia vazio chamando a função [**MFCreateVideoSampleFromSurface**](/windows/desktop/api/evr/nc-evr-mfcreatevideosamplefromsurface) .</span><span class="sxs-lookup"><span data-stu-id="0edc7-207">Create an empty media sample by calling the [**MFCreateVideoSampleFromSurface**](/windows/desktop/api/evr/nc-evr-mfcreatevideosamplefromsurface) function.</span></span> <span data-ttu-id="0edc7-208">Defina o parâmetro *pUnkSurface* igual a **NULL**.</span><span class="sxs-lookup"><span data-stu-id="0edc7-208">Set the *pUnkSurface* parameter equal to **NULL**.</span></span> <span data-ttu-id="0edc7-209">A função retorna um ponteiro [**IMFSample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) .</span><span class="sxs-lookup"><span data-stu-id="0edc7-209">The function returns an [**IMFSample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) pointer.</span></span>
    3.  <span data-ttu-id="0edc7-210">Chame [**IMFSample:: addbuffer**](/windows/desktop/api/mfobjects/nf-mfobjects-imfsample-addbuffer) para adicionar o buffer de mídia ao exemplo.</span><span class="sxs-lookup"><span data-stu-id="0edc7-210">Call [**IMFSample::AddBuffer**](/windows/desktop/api/mfobjects/nf-mfobjects-imfsample-addbuffer) to add the media buffer to the sample.</span></span>

<span data-ttu-id="0edc7-211">Você deve destruir todas as texturas que criar ao mesmo tempo, em vez de destruir apenas algumas e continuar a usar o lembrete.</span><span class="sxs-lookup"><span data-stu-id="0edc7-211">You should destroy all the textures you create at the same time, rather then destroying only some and continuing to use the reminder.</span></span>

## <a name="decoding"></a><span data-ttu-id="0edc7-212">Decodificação</span><span class="sxs-lookup"><span data-stu-id="0edc7-212">Decoding</span></span>

<span data-ttu-id="0edc7-213">Para criar o dispositivo decodificador, chame [**ID3D11VideoDevice:: CreateVideoDecoder**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoder).</span><span class="sxs-lookup"><span data-stu-id="0edc7-213">To create the decoder device, call [**ID3D11VideoDevice::CreateVideoDecoder**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoder).</span></span> <span data-ttu-id="0edc7-214">O método retorna um ponteiro para a interface [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder) .</span><span class="sxs-lookup"><span data-stu-id="0edc7-214">The method returns a pointer to the [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder) interface.</span></span> <span data-ttu-id="0edc7-215">A decodificação deve ocorrer dentro do método [**IMFTransform::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) .</span><span class="sxs-lookup"><span data-stu-id="0edc7-215">Decoding should occur inside the [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) method.</span></span> <span data-ttu-id="0edc7-216">Em cada quadro, chame [**IMFDXGIDeviceManager:: TestDevice**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-testdevice) para testar a disponibilidade do dxgi.</span><span class="sxs-lookup"><span data-stu-id="0edc7-216">On each frame, call [**IMFDXGIDeviceManager::TestDevice**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-testdevice) to test the availability of the DXGI.</span></span> <span data-ttu-id="0edc7-217">Se o dispositivo tiver sido alterado, o decodificador de software deverá recriar o dispositivo decodificador da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="0edc7-217">If the device has changed, the software decoder must recreate the decoder device, as follows:</span></span>

1.  <span data-ttu-id="0edc7-218">Feche o identificador do dispositivo chamando [**IMFDXGIDeviceManager:: CloseDeviceHandle**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-closedevicehandle).</span><span class="sxs-lookup"><span data-stu-id="0edc7-218">Close the device handle by calling [**IMFDXGIDeviceManager::CloseDeviceHandle**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-closedevicehandle).</span></span>
2.  <span data-ttu-id="0edc7-219">Libere todos os recursos associados ao dispositivo Direct3D 11 anterior, incluindo as interfaces [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder), [**ID3D11VideoContext**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videocontext), [**ID3D11Texture2D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture2d)e [**ID3D11VideoDecoderOutputView**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoderoutputview) .</span><span class="sxs-lookup"><span data-stu-id="0edc7-219">Release all resources associated with the previous Direct3D 11 device, including the [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder), [**ID3D11VideoContext**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videocontext), [**ID3D11Texture2D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture2d), and [**ID3D11VideoDecoderOutputView**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoderoutputview) interfaces.</span></span>
3.  <span data-ttu-id="0edc7-220">Abra um novo identificador de dispositivo.</span><span class="sxs-lookup"><span data-stu-id="0edc7-220">Open a new device handle.</span></span>
4.  <span data-ttu-id="0edc7-221">Negocie uma nova configuração de decodificador, conforme descrito anteriormente em [Localizar uma configuração de decodificador](#find-a-decoder-configuration).</span><span class="sxs-lookup"><span data-stu-id="0edc7-221">Negotiate a new decoder configuration, as described previously in [Find a Decoder Configuration](#find-a-decoder-configuration).</span></span> <span data-ttu-id="0edc7-222">Esta etapa é necessária porque os recursos do dispositivo podem ter sido alterados.</span><span class="sxs-lookup"><span data-stu-id="0edc7-222">This step is necessary because the device capabilities might have changed.</span></span>
5.  <span data-ttu-id="0edc7-223">Crie um novo dispositivo de decodificador.</span><span class="sxs-lookup"><span data-stu-id="0edc7-223">Create a new decoder device.</span></span>

<span data-ttu-id="0edc7-224">Supondo que o identificador do dispositivo seja válido, o processo de decodificação funciona da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="0edc7-224">Assuming that the device handle is valid, the decoding process works as follows:</span></span>

1.  <span data-ttu-id="0edc7-225">Obtenha uma superfície disponível que não esteja em uso no momento.</span><span class="sxs-lookup"><span data-stu-id="0edc7-225">Get an available surface that is not currently in use.</span></span> <span data-ttu-id="0edc7-226">Inicialmente, todas as superfícies estão disponíveis.</span><span class="sxs-lookup"><span data-stu-id="0edc7-226">Initially, all of the surfaces are available.</span></span>
2.  <span data-ttu-id="0edc7-227">Consulte o exemplo de mídia para a interface [**IMFTrackedSample**](/windows/win32/api/mfidl/nn-mfidl-imftrackedsample) .</span><span class="sxs-lookup"><span data-stu-id="0edc7-227">Query the media sample for the [**IMFTrackedSample**](/windows/win32/api/mfidl/nn-mfidl-imftrackedsample) interface.</span></span>
3.  <span data-ttu-id="0edc7-228">Chame [**IMFTrackedSample:: Setalocador**](/windows/win32/api/mfidl/nf-mfidl-imftrackedsample-setallocator) e forneça um ponteiro para a interface [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) .</span><span class="sxs-lookup"><span data-stu-id="0edc7-228">Call [**IMFTrackedSample::SetAllocator**](/windows/win32/api/mfidl/nf-mfidl-imftrackedsample-setallocator) and provide a pointer to the [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) interface.</span></span> <span data-ttu-id="0edc7-229">(O decodificador de software deve implementar essa interface.) Quando o processador de vídeo libera o exemplo, o retorno de chamada será invocado.</span><span class="sxs-lookup"><span data-stu-id="0edc7-229">(The software decoder must implement this interface.) When the video renderer releases the sample, the callback will be invoked.</span></span> <span data-ttu-id="0edc7-230">Use este retorno de chamada para acompanhar quais exemplos estão disponíveis no momento e quais estão em uso.</span><span class="sxs-lookup"><span data-stu-id="0edc7-230">Use this callback to keep track of which samples are currently available and which are in use.</span></span>
4.  <span data-ttu-id="0edc7-231">Chame [**ID3D11VideoContext::D ecoderbeginframe**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe).</span><span class="sxs-lookup"><span data-stu-id="0edc7-231">Call [**ID3D11VideoContext::DecoderBeginFrame**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe).</span></span> <span data-ttu-id="0edc7-232">Passe os ponteiros para a interface [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder) para o dispositivo decodificador e a interface [**ID3D11VideoDecoderOutputView**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoderoutputview) para a exibição de saída.</span><span class="sxs-lookup"><span data-stu-id="0edc7-232">Pass in the pointers to the [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder) interface for the decoder device and the [**ID3D11VideoDecoderOutputView**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoderoutputview) interface for the output view.</span></span>
5.  <span data-ttu-id="0edc7-233">Faça o seguinte uma ou mais vezes:</span><span class="sxs-lookup"><span data-stu-id="0edc7-233">Do the following one or more times:</span></span>
    1.  <span data-ttu-id="0edc7-234">Chame [**ID3D11VideoContext:: GetDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) para obter um buffer.</span><span class="sxs-lookup"><span data-stu-id="0edc7-234">Call [**ID3D11VideoContext::GetDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) to get a buffer.</span></span>
    2.  <span data-ttu-id="0edc7-235">Preencha o buffer.</span><span class="sxs-lookup"><span data-stu-id="0edc7-235">Fill the buffer.</span></span>
    3.  <span data-ttu-id="0edc7-236">Chame [**ID3D11VideoContext:: ReleaseDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-releasedecoderbuffer).</span><span class="sxs-lookup"><span data-stu-id="0edc7-236">Call [**ID3D11VideoContext::ReleaseDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-releasedecoderbuffer).</span></span>
    4.  <span data-ttu-id="0edc7-237">Chame [**ID3D11VideoContext:: SubmitDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-submitdecoderbuffers).</span><span class="sxs-lookup"><span data-stu-id="0edc7-237">Call [**ID3D11VideoContext::SubmitDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-submitdecoderbuffers).</span></span> <span data-ttu-id="0edc7-238">Esse método instrui o dispositivo decodificador a executar as operações de decodificação no quadro.</span><span class="sxs-lookup"><span data-stu-id="0edc7-238">This method instructs the decoder device to perform the decoding operations on the frame.</span></span>
6.  <span data-ttu-id="0edc7-239">Chame [**ID3D11VideoContext::D ecoderendframe**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderendframe) para sinalizar o fim da decodificação do quadro atual.</span><span class="sxs-lookup"><span data-stu-id="0edc7-239">Call [**ID3D11VideoContext::DecoderEndFrame**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderendframe) to signal the end of decoding for the current frame.</span></span>

<span data-ttu-id="0edc7-240">O Direct3D 11 usa as mesmas estruturas de dados que a DXVA 2,0 para operações de decodificação.</span><span class="sxs-lookup"><span data-stu-id="0edc7-240">Direct3D 11 uses the same data structures as DXVA 2.0 for decoding operations.</span></span> <span data-ttu-id="0edc7-241">Para o conjunto original de perfis de DXVA (para H. 261, H. 263 e MPEG-2), essas estruturas de dados são descritas na [especificação DXVA 1,0](/windows-hardware/drivers/display/directx-video-acceleration).</span><span class="sxs-lookup"><span data-stu-id="0edc7-241">For the original set of DXVA profiles (for H.261, H.263, and MPEG-2), these data structures are described in the [DXVA 1.0 specification](/windows-hardware/drivers/display/directx-video-acceleration).</span></span>

<span data-ttu-id="0edc7-242">Dentro de cada par de chamadas [**DecoderBeginFrame**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe) e [**SubmitDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-submitdecoderbuffers) , você pode chamar [**GetDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) várias vezes, mas apenas uma vez para cada tipo de buffer.</span><span class="sxs-lookup"><span data-stu-id="0edc7-242">Within each pair of [**DecoderBeginFrame**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe) and [**SubmitDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-submitdecoderbuffers) calls, you may call [**GetDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) multiple times, but only once for each type of buffer.</span></span> <span data-ttu-id="0edc7-243">Se você usar o mesmo tipo de buffer duas vezes sem chamar **SubmitDecoderBuffer**, os dados serão substituídos no buffer.</span><span class="sxs-lookup"><span data-stu-id="0edc7-243">If you use the same buffer type twice without calling **SubmitDecoderBuffer**, you will overwrite the data in the buffer.</span></span>

## <a name="related-topics"></a><span data-ttu-id="0edc7-244">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="0edc7-244">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="0edc7-245">APIs de vídeo do Direct3D 11</span><span class="sxs-lookup"><span data-stu-id="0edc7-245">Direct3D 11 Video APIs</span></span>](direct3d-11-video-apis.md)
</dt> <dt>

[<span data-ttu-id="0edc7-246">Aceleração de vídeo do DirectX 2,0</span><span class="sxs-lookup"><span data-stu-id="0edc7-246">DirectX Video Acceleration 2.0</span></span>](directx-video-acceleration-2-0.md)
</dt> </dl>

 

 
