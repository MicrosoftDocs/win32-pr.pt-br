---
description: Este tópico descreve como um cliente usa uma Media Foundation transformação (MFT) para processar dados. O cliente é qualquer coisa que chama diretamente os métodos no MFT. Esse pode ser o aplicativo ou o pipeline de Media Foundation.
ms.assetid: be977d75-999e-4e57-9672-00a89246a2c1
title: Modelo de processamento de MFT básico
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9ca54df6d9765aaf54456c3d9dc4461a82a93d41
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104010329"
---
# <a name="basic-mft-processing-model"></a><span data-ttu-id="63d64-105">Modelo de processamento de MFT básico</span><span class="sxs-lookup"><span data-stu-id="63d64-105">Basic MFT Processing Model</span></span>

<span data-ttu-id="63d64-106">Este tópico descreve como um cliente usa uma Media Foundation transformação (MFT) para processar dados.</span><span class="sxs-lookup"><span data-stu-id="63d64-106">This topic describes how a client uses a Media Foundation transform (MFT) to process data.</span></span> <span data-ttu-id="63d64-107">O *cliente* é qualquer coisa que chama diretamente os métodos no MFT.</span><span class="sxs-lookup"><span data-stu-id="63d64-107">The *client* is anything that directly calls methods on the MFT.</span></span> <span data-ttu-id="63d64-108">Esse pode ser o aplicativo ou o pipeline de Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="63d64-108">This might be the application or the Media Foundation pipeline.</span></span>

<span data-ttu-id="63d64-109">Leia este tópico se você estiver:</span><span class="sxs-lookup"><span data-stu-id="63d64-109">Read this topic if you are:</span></span>

-   <span data-ttu-id="63d64-110">Gravar um aplicativo que faz chamadas diretas para um ou mais MFTs.</span><span class="sxs-lookup"><span data-stu-id="63d64-110">Writing an application that makes direct calls to one or more MFTs.</span></span>
-   <span data-ttu-id="63d64-111">Gravar uma MFT personalizada e desejar entender o comportamento esperado de um MFT.</span><span class="sxs-lookup"><span data-stu-id="63d64-111">Writing a custom MFT and want to understand the expected behavior of an MFT.</span></span>

<span data-ttu-id="63d64-112">Este tópico descreve um modelo de processamento *síncrono* .</span><span class="sxs-lookup"><span data-stu-id="63d64-112">This topic describes a *synchronous* processing model.</span></span> <span data-ttu-id="63d64-113">Nesse modelo, todos os métodos de processamento de dados são bloqueados até que sejam concluídos.</span><span class="sxs-lookup"><span data-stu-id="63d64-113">In this model, all data-processing methods block until they complete.</span></span> <span data-ttu-id="63d64-114">O MFTs também pode oferecer suporte a um modelo *assíncrono* , que é descrito no tópico [MFTs assíncrona](asynchronous-mfts.md).</span><span class="sxs-lookup"><span data-stu-id="63d64-114">MFTs can also support an *asynchronous* model, which is described in the topic [Asynchronous MFTs](asynchronous-mfts.md).</span></span>

-   [<span data-ttu-id="63d64-115">Modelo de processamento básico</span><span class="sxs-lookup"><span data-stu-id="63d64-115">Basic Processing Model</span></span>](#basic-processing-model)
    -   [<span data-ttu-id="63d64-116">Criar o MFT</span><span class="sxs-lookup"><span data-stu-id="63d64-116">Create the MFT</span></span>](#create-the-mft)
    -   [<span data-ttu-id="63d64-117">Obter identificadores de fluxo</span><span class="sxs-lookup"><span data-stu-id="63d64-117">Get Stream Identifiers</span></span>](#get-stream-identifiers)
    -   [<span data-ttu-id="63d64-118">Definir tipos de mídia</span><span class="sxs-lookup"><span data-stu-id="63d64-118">Set Media Types</span></span>](#set-media-types)
    -   [<span data-ttu-id="63d64-119">Obter requisitos de buffer</span><span class="sxs-lookup"><span data-stu-id="63d64-119">Get Buffer Requirements</span></span>](#get-buffer-requirements)
    -   [<span data-ttu-id="63d64-120">Processar dados</span><span class="sxs-lookup"><span data-stu-id="63d64-120">Process Data</span></span>](#process-data)
-   [<span data-ttu-id="63d64-121">Extensões para o modelo básico</span><span class="sxs-lookup"><span data-stu-id="63d64-121">Extensions to the Basic Model</span></span>](#extensions-to-the-basic-model)
-   [<span data-ttu-id="63d64-122">IMF2DBuffer</span><span class="sxs-lookup"><span data-stu-id="63d64-122">IMF2DBuffer</span></span>](#imf2dbuffer)
-   [<span data-ttu-id="63d64-123">Liberando uma MFT</span><span class="sxs-lookup"><span data-stu-id="63d64-123">Flushing an MFT</span></span>](#flushing-an-mft)
-   [<span data-ttu-id="63d64-124">Drenagem de um MFT</span><span class="sxs-lookup"><span data-stu-id="63d64-124">Draining an MFT</span></span>](#draining-an-mft)
-   [<span data-ttu-id="63d64-125">Atributos de exemplo</span><span class="sxs-lookup"><span data-stu-id="63d64-125">Sample Attributes</span></span>](#sample-attributes)
-   [<span data-ttu-id="63d64-126">Descontinuidades</span><span class="sxs-lookup"><span data-stu-id="63d64-126">Discontinuities</span></span>](#discontinuities)
-   [<span data-ttu-id="63d64-127">Alterações de formato dinâmico</span><span class="sxs-lookup"><span data-stu-id="63d64-127">Dynamic Format Changes</span></span>](#dynamic-format-changes)
-   [<span data-ttu-id="63d64-128">Eventos de fluxo</span><span class="sxs-lookup"><span data-stu-id="63d64-128">Stream Events</span></span>](#stream-events)
-   [<span data-ttu-id="63d64-129">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="63d64-129">Related topics</span></span>](#related-topics)

## <a name="basic-processing-model"></a><span data-ttu-id="63d64-130">Modelo de processamento básico</span><span class="sxs-lookup"><span data-stu-id="63d64-130">Basic Processing Model</span></span>

### <a name="create-the-mft"></a><span data-ttu-id="63d64-131">Criar o MFT</span><span class="sxs-lookup"><span data-stu-id="63d64-131">Create the MFT</span></span>

<span data-ttu-id="63d64-132">Há várias maneiras de criar um MFT:</span><span class="sxs-lookup"><span data-stu-id="63d64-132">There are several ways to create an MFT:</span></span>

-   <span data-ttu-id="63d64-133">Chame a função [**MFTEnum**](/windows/desktop/api/mfapi/nf-mfapi-mftenum) .</span><span class="sxs-lookup"><span data-stu-id="63d64-133">Call the [**MFTEnum**](/windows/desktop/api/mfapi/nf-mfapi-mftenum) function.</span></span>
-   <span data-ttu-id="63d64-134">Chame a função [**MFTEnumEx**](/windows/desktop/api/mfapi/nf-mfapi-mftenumex) .</span><span class="sxs-lookup"><span data-stu-id="63d64-134">Call the [**MFTEnumEx**](/windows/desktop/api/mfapi/nf-mfapi-mftenumex) function.</span></span>
-   <span data-ttu-id="63d64-135">Se você já souber o CLSID do MFT, basta chamar **CoCreateInstance**.</span><span class="sxs-lookup"><span data-stu-id="63d64-135">If you already know the CLSID of the MFT, simply call **CoCreateInstance**.</span></span>

<span data-ttu-id="63d64-136">Alguns MFTs podem fornecer outras opções, como uma função de criação especializada.</span><span class="sxs-lookup"><span data-stu-id="63d64-136">Some MFTs might provide other options, such as a specialized creation function.</span></span>

### <a name="get-stream-identifiers"></a><span data-ttu-id="63d64-137">Obter identificadores de fluxo</span><span class="sxs-lookup"><span data-stu-id="63d64-137">Get Stream Identifiers</span></span>

<span data-ttu-id="63d64-138">Uma MFT tem um ou mais *fluxos*.</span><span class="sxs-lookup"><span data-stu-id="63d64-138">An MFT has one or more *streams*.</span></span> <span data-ttu-id="63d64-139">Os fluxos de entrada recebem dados de entrada e os fluxos de saída geram dados de saída.</span><span class="sxs-lookup"><span data-stu-id="63d64-139">Input streams receive input data, and output streams generate output data.</span></span> <span data-ttu-id="63d64-140">Os fluxos não são representados como objetos distintos.</span><span class="sxs-lookup"><span data-stu-id="63d64-140">Streams are not represented as distinct objects.</span></span> <span data-ttu-id="63d64-141">Em vez disso, vários métodos de MFT usam identificadores de fluxo como parâmetros.</span><span class="sxs-lookup"><span data-stu-id="63d64-141">Instead, various MFT methods take stream identifiers as parameters.</span></span>

<span data-ttu-id="63d64-142">Alguns MFTs permitem que o cliente adicione ou remova fluxos de entrada.</span><span class="sxs-lookup"><span data-stu-id="63d64-142">Some MFTs allow the client to add or remove input streams.</span></span> <span data-ttu-id="63d64-143">Durante o streaming, um MFT pode adicionar ou remover fluxos de saída.</span><span class="sxs-lookup"><span data-stu-id="63d64-143">During streaming, an MFT can add or remove output streams.</span></span> <span data-ttu-id="63d64-144">(O cliente não pode adicionar ou remover fluxos de saída.)</span><span class="sxs-lookup"><span data-stu-id="63d64-144">(The client cannot add or remove output streams.)</span></span>

1.  <span data-ttu-id="63d64-145">(Opcional.) Chame [**IMFTransform:: GetStreamLimits**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamlimits) para obter o número mínimo e máximo de fluxos para os quais o MFT pode dar suporte.</span><span class="sxs-lookup"><span data-stu-id="63d64-145">(Optional.) Call [**IMFTransform::GetStreamLimits**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamlimits) to get the minimum and maximum number of streams that the MFT can support.</span></span> <span data-ttu-id="63d64-146">Se o mínimo e o máximo forem os mesmos, o MFT terá um número fixo de fluxos.</span><span class="sxs-lookup"><span data-stu-id="63d64-146">If the minimum and maximum are the same, the MFT has a fixed number of streams.</span></span>
2.  <span data-ttu-id="63d64-147">Chame [**IMFTransform:: GetStreamCount**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamcount) para obter o número inicial de fluxos.</span><span class="sxs-lookup"><span data-stu-id="63d64-147">Call [**IMFTransform::GetStreamCount**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamcount) to get the initial number of streams.</span></span>
3.  <span data-ttu-id="63d64-148">Chame [**IMFTransform:: GetStreamIDs**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamids) para obter os identificadores de fluxo.</span><span class="sxs-lookup"><span data-stu-id="63d64-148">Call [**IMFTransform::GetStreamIDs**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamids) to get the stream identifiers.</span></span> <span data-ttu-id="63d64-149">Se esse método retornar E \_ NOTIMPL, isso significará que o MFT tem um número fixo de fluxos e que os identificadores de fluxo são consecutivos a partir de zero.</span><span class="sxs-lookup"><span data-stu-id="63d64-149">If this method returns E\_NOTIMPL, it means the MFT has a fixed number of streams, and the stream identifiers are consecutive starting from zero.</span></span>
4.  <span data-ttu-id="63d64-150">(Opcional.) Se a MFT não tiver um número fixo de fluxos, chame [**IMFTransform:: AddInputStreams**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-addinputstreams) para adicionar mais fluxos de entrada ou [**IMFTransform::D eleteinputstream**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-deleteinputstream) para remover os fluxos de entrada.</span><span class="sxs-lookup"><span data-stu-id="63d64-150">(Optional.) If the MFT does not have a fixed number of streams, call [**IMFTransform::AddInputStreams**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-addinputstreams) to add more input streams, or [**IMFTransform::DeleteInputStream**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-deleteinputstream) to remove input streams.</span></span> <span data-ttu-id="63d64-151">(Você não pode adicionar ou remover fluxos de saída.)</span><span class="sxs-lookup"><span data-stu-id="63d64-151">(You cannot add or remove output streams.)</span></span>

### <a name="set-media-types"></a><span data-ttu-id="63d64-152">Definir tipos de mídia</span><span class="sxs-lookup"><span data-stu-id="63d64-152">Set Media Types</span></span>

<span data-ttu-id="63d64-153">Antes que um MFT possa processar dados, o cliente deve definir um tipo de mídia para cada um dos fluxos do MFT.</span><span class="sxs-lookup"><span data-stu-id="63d64-153">Before an MFT can process data, the client must set a media types for each of the streams of the MFT.</span></span> <span data-ttu-id="63d64-154">Um MFT pode exigir que o cliente defina os tipos de entrada antes de definir os tipos de saída ou que possam exigir a ordem oposta (os tipos de saída primeiro).</span><span class="sxs-lookup"><span data-stu-id="63d64-154">An MFT might require that the client set the input types before setting the output types, or might require the opposite order (output types first).</span></span> <span data-ttu-id="63d64-155">Alguns MFTs não têm um requisito no pedido.</span><span class="sxs-lookup"><span data-stu-id="63d64-155">Some MFTs do not have a requirement on the order.</span></span>

<span data-ttu-id="63d64-156">Uma MFT pode fornecer uma lista de tipos de mídia preferenciais para um fluxo.</span><span class="sxs-lookup"><span data-stu-id="63d64-156">An MFT can provide a list of preferred media types for a stream.</span></span> <span data-ttu-id="63d64-157">Além disso, o MFTs pode indicar os formatos gerais aos quais eles dão suporte adicionando essas informações ao registro.</span><span class="sxs-lookup"><span data-stu-id="63d64-157">Also, MFTs can indicate the general formats that they support by adding this information to the registry.</span></span>

<span data-ttu-id="63d64-158">Para definir os tipos de mídia, faça o seguinte:</span><span class="sxs-lookup"><span data-stu-id="63d64-158">To set the media types, do the following:</span></span>

1.  <span data-ttu-id="63d64-159">(Opcional.) Para cada fluxo de entrada, chame [**IMFTransform:: GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) para obter a lista de tipos preferenciais para esse fluxo.</span><span class="sxs-lookup"><span data-stu-id="63d64-159">(Optional.) For each input stream, call [**IMFTransform::GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) to get the list of preferred types for that stream.</span></span>
    -   <span data-ttu-id="63d64-160">Se esse método retornar \_ \_ \_ o tipo de impressão MF e Transform \_ não \_ definido, você deverá primeiro definir os tipos de saída; pule para a etapa 3.</span><span class="sxs-lookup"><span data-stu-id="63d64-160">If this method returns MF\_E\_TRANSFORM\_TYPE\_NOT\_SET, you must set the output types first; skip to step 3.</span></span>
    -   <span data-ttu-id="63d64-161">Se o método retornar E \_ NOTIMPL, o MFT não terá uma lista de tipos de entrada preferenciais; pule para a etapa 2.</span><span class="sxs-lookup"><span data-stu-id="63d64-161">If the method returns E\_NOTIMPL, the MFT does not have a list of preferred input types; skip to step 2.</span></span>
2.  <span data-ttu-id="63d64-162">Para cada fluxo de entrada, chame [**IMFTransform:: SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) para definir o tipo de entrada.</span><span class="sxs-lookup"><span data-stu-id="63d64-162">For each input stream, call [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) to set the input type.</span></span> <span data-ttu-id="63d64-163">Você pode usar um tipo de mídia da etapa 1 ou um tipo que descreva os dados de entrada.</span><span class="sxs-lookup"><span data-stu-id="63d64-163">You can use a media type from step 1, or a type that describes your input data.</span></span> <span data-ttu-id="63d64-164">Se qualquer fluxo retornar o \_ tipo de MF E de \_ transformação \_ \_ não \_ definido, pule para a etapa 3.</span><span class="sxs-lookup"><span data-stu-id="63d64-164">If any stream returns MF\_E\_TRANSFORM\_TYPE\_NOT\_SET, skip to step 3.</span></span>
3.  <span data-ttu-id="63d64-165">(Opcional.) Para cada fluxo de saída, chame [**IMFTransform:: GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) para obter uma lista de tipos preferenciais para esse fluxo.</span><span class="sxs-lookup"><span data-stu-id="63d64-165">(Optional.) For each output stream, call [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) to get a list of preferred types for that stream.</span></span>
    -   <span data-ttu-id="63d64-166">Se esse método retornar \_ \_ \_ o tipo de saída MF e Transform \_ não \_ definido, você deverá definir os tipos de entrada primeiro; volte para a etapa 1.</span><span class="sxs-lookup"><span data-stu-id="63d64-166">If this method returns MF\_E\_TRANSFORM\_TYPE\_NOT\_SET, you must set the input types first; go back to step 1.</span></span>
    -   <span data-ttu-id="63d64-167">Se qualquer fluxo retornar E \_ NOTIMPL, o MFT não terá uma lista de tipos de saída preferenciais; pule para a etapa 4.</span><span class="sxs-lookup"><span data-stu-id="63d64-167">If any stream returns E\_NOTIMPL, the MFT does not have a list of preferred output types; skip to step 4.</span></span>
4.  <span data-ttu-id="63d64-168">Para cada fluxo de saída, chame [**IMFTransform:: SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) para definir o tipo de saída.</span><span class="sxs-lookup"><span data-stu-id="63d64-168">For each output stream, call [**IMFTransform::SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) to set the output type.</span></span> <span data-ttu-id="63d64-169">Você pode usar um tipo de mídia da etapa 3 ou um tipo que descreva o formato de saída necessário.</span><span class="sxs-lookup"><span data-stu-id="63d64-169">You can use a media type from step 3, or a type that describes your required output format.</span></span>
5.  <span data-ttu-id="63d64-170">Se qualquer fluxo de entrada não tiver um tipo de mídia, volte para a etapa 1.</span><span class="sxs-lookup"><span data-stu-id="63d64-170">If any input streams do not have a media type, go back to step 1.</span></span>

### <a name="get-buffer-requirements"></a><span data-ttu-id="63d64-171">Obter requisitos de buffer</span><span class="sxs-lookup"><span data-stu-id="63d64-171">Get Buffer Requirements</span></span>

<span data-ttu-id="63d64-172">Depois que o cliente define os tipos de mídia, ele deve obter os requisitos de buffer para cada fluxo:</span><span class="sxs-lookup"><span data-stu-id="63d64-172">After the client sets the media types, it should get the buffer requirements for each stream:</span></span>

-   <span data-ttu-id="63d64-173">Para cada fluxo de entrada, chame [**IMFTransform:: GetInputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreaminfo).</span><span class="sxs-lookup"><span data-stu-id="63d64-173">For each input stream, call [**IMFTransform::GetInputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreaminfo).</span></span>
-   <span data-ttu-id="63d64-174">Para cada fluxo de saída, chame [**IMFTransform:: GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo).</span><span class="sxs-lookup"><span data-stu-id="63d64-174">For each output stream, call [**IMFTransform::GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo).</span></span>

### <a name="process-data"></a><span data-ttu-id="63d64-175">Processar Dados</span><span class="sxs-lookup"><span data-stu-id="63d64-175">Process Data</span></span>

<span data-ttu-id="63d64-176">Uma MFT foi projetada para ser uma máquina de estado confiável.</span><span class="sxs-lookup"><span data-stu-id="63d64-176">An MFT is designed to be a reliable state machine.</span></span> <span data-ttu-id="63d64-177">Ele não faz nenhuma chamada de volta para o cliente.</span><span class="sxs-lookup"><span data-stu-id="63d64-177">It does not make any calls back to the client.</span></span>

1.  <span data-ttu-id="63d64-178">Chame [**IMFTransform::P rocessmessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) com a [**\_ mensagem MFT \_ notificar \_ Iniciar \_**](mft-message-notify-begin-streaming.md) mensagem de streaming.</span><span class="sxs-lookup"><span data-stu-id="63d64-178">Call [**IMFTransform::ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_NOTIFY\_BEGIN\_STREAMING**](mft-message-notify-begin-streaming.md) message.</span></span> <span data-ttu-id="63d64-179">Essa mensagem solicita que o MFT aloque os recursos necessários durante o streaming.</span><span class="sxs-lookup"><span data-stu-id="63d64-179">This message requests the MFT to allocate any resources it needs during streaming.</span></span>
2.  <span data-ttu-id="63d64-180">Chame [**IMFTransform::P rocessinput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) em pelo menos um fluxo de entrada para entregar um exemplo de entrada para o MFT.</span><span class="sxs-lookup"><span data-stu-id="63d64-180">Call [**IMFTransform::ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) on at least one input stream to deliver an input sample to the MFT.</span></span>
3.  <span data-ttu-id="63d64-181">(Opcional.) Chame [**IMFTransform:: GetOutputStatus**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstatus) para consultar se o MFT pode gerar um exemplo de saída.</span><span class="sxs-lookup"><span data-stu-id="63d64-181">(Optional.) Call [**IMFTransform::GetOutputStatus**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstatus) to query whether the MFT can generate an output sample.</span></span> <span data-ttu-id="63d64-182">Se o método retornar S \_ OK, verifique o parâmetro *pdwFlags* .</span><span class="sxs-lookup"><span data-stu-id="63d64-182">If the method returns S\_OK, check the *pdwFlags* parameter.</span></span> <span data-ttu-id="63d64-183">Se *pdwFlags* contiver o sinalizador **\_ \_ \_ \_ pronto de exemplo status de saída do MFT** , vá para a etapa 4.</span><span class="sxs-lookup"><span data-stu-id="63d64-183">If *pdwFlags* contains the **MFT\_OUTPUT\_STATUS\_SAMPLE\_READY** flag, go to step 4.</span></span> <span data-ttu-id="63d64-184">Se *pdwFlags* for zero, volte para a etapa 2.</span><span class="sxs-lookup"><span data-stu-id="63d64-184">If *pdwFlags* is zero, go back to step 2.</span></span> <span data-ttu-id="63d64-185">Se o método retornar E \_ NOTIMPL, vá para a etapa 4.</span><span class="sxs-lookup"><span data-stu-id="63d64-185">If the method returns E\_NOTIMPL, go to step 4.</span></span>
4.  <span data-ttu-id="63d64-186">Chame [**IMFTransform::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) para obter dados de saída.</span><span class="sxs-lookup"><span data-stu-id="63d64-186">Call [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) to get output data.</span></span>
    -   <span data-ttu-id="63d64-187">Se o método retornar **MF \_ E a \_ transformação \_ precisar de \_ mais \_ entradas**, isso significará que o MFT requer mais dados de entrada; volte para a etapa 2.</span><span class="sxs-lookup"><span data-stu-id="63d64-187">If the method returns **MF\_E\_TRANSFORM\_NEED\_MORE\_INPUT**, it means the MFT requires more input data; go back to step 2.</span></span>
    -   <span data-ttu-id="63d64-188">Se o método retornar **a \_ \_ alteração de \_ fluxo \_ de MF e de transformação**, isso significará que o número de fluxos de saída foi alterado ou o formato de saída foi alterado.</span><span class="sxs-lookup"><span data-stu-id="63d64-188">If the method returns **MF\_E\_TRANSFORM\_STREAM\_CHANGE**, it means the number of output streams has changed, or the output format has changed.</span></span> <span data-ttu-id="63d64-189">O cliente pode precisar consultar novos identificadores de fluxo ou definir novos tipos de mídia.</span><span class="sxs-lookup"><span data-stu-id="63d64-189">The client might need to query for new stream identifiers or set new media types.</span></span> <span data-ttu-id="63d64-190">Para obter mais informações, consulte a documentação de [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="63d64-190">For more information, see the documentation for [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>
5.  <span data-ttu-id="63d64-191">Se ainda houver dados de entrada para processar, vá para a etapa 2.</span><span class="sxs-lookup"><span data-stu-id="63d64-191">If there is still input data to process, go to step 2.</span></span> <span data-ttu-id="63d64-192">Se o MFT tiver consumido todos os dados de entrada disponíveis, vá para a etapa 6.</span><span class="sxs-lookup"><span data-stu-id="63d64-192">If the MFT has consumed all of the available input data, proceed to step 6.</span></span>
6.  <span data-ttu-id="63d64-193">Chame [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) com a [**mensagem de MFT \_ \_ notificar \_ fim \_ da mensagem de \_ fluxo**](mft-message-notify-end-of-stream.md) .</span><span class="sxs-lookup"><span data-stu-id="63d64-193">Call [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_NOTIFY\_END\_OF\_STREAM**](mft-message-notify-end-of-stream.md) message.</span></span>
7.  <span data-ttu-id="63d64-194">Chame [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) com a mensagem de [**\_ dreno de \_ comando \_ de mensagem MFT**](mft-message-command-drain.md) .</span><span class="sxs-lookup"><span data-stu-id="63d64-194">Call [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_COMMAND\_DRAIN**](mft-message-command-drain.md) message.</span></span>
8.  <span data-ttu-id="63d64-195">Chame [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) para obter a saída restante.</span><span class="sxs-lookup"><span data-stu-id="63d64-195">Call [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) to get the remaining output.</span></span> <span data-ttu-id="63d64-196">Repita essa etapa até que o método retorne **MF \_ E a \_ transformação \_ precise de \_ mais \_ entradas**.</span><span class="sxs-lookup"><span data-stu-id="63d64-196">Repeat this step until the method returns **MF\_E\_TRANSFORM\_NEED\_MORE\_INPUT**.</span></span> <span data-ttu-id="63d64-197">Esse valor de retorno sinaliza que toda a saída foi descarregada da MFT.</span><span class="sxs-lookup"><span data-stu-id="63d64-197">This return value signals that all of the output has been drained from the MFT.</span></span> <span data-ttu-id="63d64-198">(Não trate isso como uma condição de erro.)</span><span class="sxs-lookup"><span data-stu-id="63d64-198">(Do not treat this as an error condition.)</span></span>

<span data-ttu-id="63d64-199">A sequência descrita aqui mantém o mínimo possível de dados na MFT.</span><span class="sxs-lookup"><span data-stu-id="63d64-199">The sequence described here keeps as little data as possible in the MFT.</span></span> <span data-ttu-id="63d64-200">Depois de cada chamada para [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput), o cliente tenta obter a saída.</span><span class="sxs-lookup"><span data-stu-id="63d64-200">After every call to [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput), the client attempts to get output.</span></span> <span data-ttu-id="63d64-201">Várias amostras de entrada podem ser necessárias para produzir um exemplo de saída ou um único exemplo de entrada pode gerar várias amostras de saída.</span><span class="sxs-lookup"><span data-stu-id="63d64-201">Several input samples might be needed to produce one output sample, or a single input sample might generate several output samples.</span></span> <span data-ttu-id="63d64-202">O comportamento ideal para o cliente é efetuar pull de amostras de saída do MFT até que a MFT exija mais entrada.</span><span class="sxs-lookup"><span data-stu-id="63d64-202">The optimal behavior for the client is to pull output samples from the MFT until the MFT requires more input.</span></span>

<span data-ttu-id="63d64-203">No entanto, o MFT deve ser capaz de lidar com uma ordem diferente de chamadas de método pelo cliente.</span><span class="sxs-lookup"><span data-stu-id="63d64-203">However, the MFT should be able to handle a different order of method calls by the client.</span></span> <span data-ttu-id="63d64-204">Por exemplo, o cliente pode simplesmente alternar entre chamadas para [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) e [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="63d64-204">For example, the client might simply alternate between calls to [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) and [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span> <span data-ttu-id="63d64-205">O MFT deve restringir a quantidade de entrada obtida retornando **MF E não \_ \_ aceitando** de **ProcessInput** sempre que tiver alguma saída a ser produzida.</span><span class="sxs-lookup"><span data-stu-id="63d64-205">The MFT should restrict the amount of input that it gets by returning **MF\_E\_NOTACCEPTING** from **ProcessInput** whenever it has some output to produce.</span></span>

<span data-ttu-id="63d64-206">A ordem das chamadas de método descritas aqui não é a única sequência válida de eventos.</span><span class="sxs-lookup"><span data-stu-id="63d64-206">The order of method calls described here is not the only valid sequence of events.</span></span> <span data-ttu-id="63d64-207">Por exemplo, as etapas 3 e 4 pressupõem que o cliente comece com os tipos de entrada e, em seguida, tente os tipos de saída.</span><span class="sxs-lookup"><span data-stu-id="63d64-207">For example, steps 3 and 4 assume that the client starts with the input types and then tries the output types.</span></span> <span data-ttu-id="63d64-208">O cliente também pode reverter essa ordem e começar com os tipos de saída.</span><span class="sxs-lookup"><span data-stu-id="63d64-208">The client can also reverse this order and start with the output types.</span></span> <span data-ttu-id="63d64-209">Em ambos os casos, se o MFT exigir a ordem oposta, ele deverá retornar o código de erro MF \_ E o \_ tipo de transformação \_ \_ não \_ definido.</span><span class="sxs-lookup"><span data-stu-id="63d64-209">In either case, if the MFT requires the opposite order, it should return the error code MF\_E\_TRANSFORM\_TYPE\_NOT\_SET.</span></span>

<span data-ttu-id="63d64-210">O cliente pode chamar métodos informativos, como [**GetInputCurrentType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputcurrenttype) e [**GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo), a qualquer momento durante o streaming.</span><span class="sxs-lookup"><span data-stu-id="63d64-210">The client can call informational methods, such as [**GetInputCurrentType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputcurrenttype) and [**GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo), at any time during streaming.</span></span> <span data-ttu-id="63d64-211">O cliente também pode tentar alterar os tipos de mídia a qualquer momento.</span><span class="sxs-lookup"><span data-stu-id="63d64-211">The client can also attempt to change the media types at any time.</span></span> <span data-ttu-id="63d64-212">O MFT deve retornar um código de erro se essa não for uma operação válida.</span><span class="sxs-lookup"><span data-stu-id="63d64-212">The MFT should return an error code if this is not a valid operation.</span></span> <span data-ttu-id="63d64-213">Em suma, MFTs deve assumir muito pouco a ordem das operações, além da que está documentada nas próprias chamadas.</span><span class="sxs-lookup"><span data-stu-id="63d64-213">In short, MFTs should assume very little about the order of operations, other than what is documented in the calls themselves.</span></span>

<span data-ttu-id="63d64-214">O diagrama a seguir mostra um gráfico de fluxo dos procedimentos descritos neste tópico.</span><span class="sxs-lookup"><span data-stu-id="63d64-214">The following diagram shows a flow chart of the procedures described in this topic.</span></span>

![fluxograma que leva de identificadores de fluxo Get por meio de loops que definem tipos de entrada, recebem entrada e saída de processo](images/mft-processing.gif)

## <a name="extensions-to-the-basic-model"></a><span data-ttu-id="63d64-216">Extensões para o modelo básico</span><span class="sxs-lookup"><span data-stu-id="63d64-216">Extensions to the Basic Model</span></span>

<span data-ttu-id="63d64-217">Opcionalmente, uma MFT pode dar suporte a algumas extensões para o modelo de streaming básico.</span><span class="sxs-lookup"><span data-stu-id="63d64-217">Optionally, an MFT can support some extensions to the basic streaming model.</span></span>

-   <span data-ttu-id="63d64-218">Fluxos de leitura lenta.</span><span class="sxs-lookup"><span data-stu-id="63d64-218">Lazy-read streams.</span></span> <span data-ttu-id="63d64-219">Se o método [**IMFTransform:: GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) retornar o sinalizador de **\_ \_ \_ \_ leitura lenta do fluxo de saída do MFT** para um fluxo de saída, o cliente não precisará coletar dados desse fluxo de saída.</span><span class="sxs-lookup"><span data-stu-id="63d64-219">If the [**IMFTransform::GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) method returns the **MFT\_OUTPUT\_STREAM\_LAZY\_READ** flag for an output stream, the client does not have to collect data from that output stream.</span></span> <span data-ttu-id="63d64-220">O MFT continua aceitando a entrada e, em algum momento, o MFT descartará os dados de saída desse fluxo.</span><span class="sxs-lookup"><span data-stu-id="63d64-220">The MFT continues to accept input, and at some point the MFT will discard the output data from that stream.</span></span> <span data-ttu-id="63d64-221">Se todos os fluxos de saída tiverem esse sinalizador, o MFT nunca falhará ao aceitar a entrada.</span><span class="sxs-lookup"><span data-stu-id="63d64-221">If all of the output streams have this flag, the MFT will never fail to accept input.</span></span> <span data-ttu-id="63d64-222">Um exemplo pode ser uma transformação de visualização, em que o cliente obtém a saída somente quando tem ciclos de CPU sobressalentes para desenhar a visualização.</span><span class="sxs-lookup"><span data-stu-id="63d64-222">An example might be a visualization transform, where the client gets the output only when it has spare CPU cycles to draw the visualization.</span></span>
-   <span data-ttu-id="63d64-223">Fluxos descartados.</span><span class="sxs-lookup"><span data-stu-id="63d64-223">Discardable streams.</span></span> <span data-ttu-id="63d64-224">Se o método [**GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) retornar o **sinalizador \_ \_ \_ descartado do fluxo de saída do MFT** para um fluxo de saída, o cliente poderá solicitar que o MFT descarte a saída, mas o MFT não descartará nenhuma saída, a menos que solicitado.</span><span class="sxs-lookup"><span data-stu-id="63d64-224">If the [**GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) method returns the **MFT\_OUTPUT\_STREAM\_DISCARDABLE** flag for an output stream, the client can request the MFT to discard output, but the MFT will not discard any output unless requested.</span></span> <span data-ttu-id="63d64-225">Quando o MFT atinge seu buffer de entrada máximo, o cliente deve coletar alguns dados de saída ou solicitar o MFT para descartar a saída.</span><span class="sxs-lookup"><span data-stu-id="63d64-225">When the MFT reaches its maximum input buffer, the client must either collect some output data or request the MFT to discard the output.</span></span>
-   <span data-ttu-id="63d64-226">Fluxos opcionais.</span><span class="sxs-lookup"><span data-stu-id="63d64-226">Optional streams.</span></span> <span data-ttu-id="63d64-227">Se o método [**GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) retornar o **sinalizador \_ \_ \_ opcional do fluxo de saída do MFT** para um fluxo de saída ou o método [**IMFTransform:: GetInputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreaminfo) retornar o sinalizador **\_ \_ \_ opcional do fluxo de entrada do MFT** para um fluxo de entrada, esse fluxo será opcional.</span><span class="sxs-lookup"><span data-stu-id="63d64-227">If the [**GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) method returns the **MFT\_OUTPUT\_STREAM\_OPTIONAL** flag for an output stream, or the [**IMFTransform::GetInputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreaminfo) method returns the **MFT\_INPUT\_STREAM\_OPTIONAL** flag for an input stream, that stream is optional.</span></span> <span data-ttu-id="63d64-228">O cliente não precisa definir um tipo de mídia no fluxo.</span><span class="sxs-lookup"><span data-stu-id="63d64-228">The client does not have to set a media type on the stream.</span></span> <span data-ttu-id="63d64-229">Se o cliente não definir o tipo, o fluxo será desmarcado.</span><span class="sxs-lookup"><span data-stu-id="63d64-229">If the client does not set the type, the stream is deselected.</span></span> <span data-ttu-id="63d64-230">Um fluxo de saída desmarcado não produz amostras e o cliente não fornece um buffer para o fluxo quando chama [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="63d64-230">A deselected output stream does not produce samples, and the client does not provide a buffer for the stream when it calls [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span> <span data-ttu-id="63d64-231">Um fluxo de entrada desmarcado não aceita dados de entrada.</span><span class="sxs-lookup"><span data-stu-id="63d64-231">A deselected input stream does not accept input data.</span></span> <span data-ttu-id="63d64-232">Um MFT pode marcar todos os seus fluxos de entrada e saída como opcionais.</span><span class="sxs-lookup"><span data-stu-id="63d64-232">An MFT can mark all of its input and output streams as optional.</span></span> <span data-ttu-id="63d64-233">No entanto, espera-se que pelo menos uma entrada e uma saída devam ser selecionadas para que o MFT funcione.</span><span class="sxs-lookup"><span data-stu-id="63d64-233">However, it is expected that at least one input and one output must be selected for the MFT to work.</span></span>
-   <span data-ttu-id="63d64-234">Processamento assíncrono.</span><span class="sxs-lookup"><span data-stu-id="63d64-234">Asynchronous processing.</span></span> <span data-ttu-id="63d64-235">O modelo de processamento assíncrono foi introduzido no Windows 7.</span><span class="sxs-lookup"><span data-stu-id="63d64-235">The asynchronous processing model was introduced in Windows 7.</span></span> <span data-ttu-id="63d64-236">Ele é descrito no tópico [MFTs assíncrona](asynchronous-mfts.md).</span><span class="sxs-lookup"><span data-stu-id="63d64-236">It is described in the topic [Asynchronous MFTs](asynchronous-mfts.md).</span></span>

## <a name="imf2dbuffer"></a><span data-ttu-id="63d64-237">IMF2DBuffer</span><span class="sxs-lookup"><span data-stu-id="63d64-237">IMF2DBuffer</span></span>

<span data-ttu-id="63d64-238">Se um MFT processar dados de vídeo descompactados, ele deverá usar a interface [**IMF2DBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imf2dbuffer) para manipular os buffers de exemplo.</span><span class="sxs-lookup"><span data-stu-id="63d64-238">If an MFT processes uncompressed video data, it should use the [**IMF2DBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imf2dbuffer) interface to manipulate the sample buffers.</span></span> <span data-ttu-id="63d64-239">Para obter essa interface, consulte a interface [**IMFMediaBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediabuffer) em qualquer buffer de entrada ou saída.</span><span class="sxs-lookup"><span data-stu-id="63d64-239">To get this interface, query the [**IMFMediaBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediabuffer) interface on any input or output buffer.</span></span> <span data-ttu-id="63d64-240">Não usar essa interface quando ela estiver disponível pode resultar em cópias de buffer adicionais.</span><span class="sxs-lookup"><span data-stu-id="63d64-240">Not using this interface when it is available may result in additional buffer copies.</span></span> <span data-ttu-id="63d64-241">Para fazer uso adequado dessa interface, a transformação não deve bloquear o buffer usando a interface **IMFMediaBuffer** quando **IMF2DBuffer** está disponível.</span><span class="sxs-lookup"><span data-stu-id="63d64-241">To make proper use of this interface, the transform should not lock the buffer using the **IMFMediaBuffer** interface when **IMF2DBuffer** is available.</span></span>

<span data-ttu-id="63d64-242">Para obter mais informações sobre o processamento de dados de vídeo, consulte [buffers de vídeo não compactados](uncompressed-video-buffers.md).</span><span class="sxs-lookup"><span data-stu-id="63d64-242">For more information about processing video data, see [Uncompressed Video Buffers](uncompressed-video-buffers.md).</span></span>

## <a name="flushing-an-mft"></a><span data-ttu-id="63d64-243">Liberando uma MFT</span><span class="sxs-lookup"><span data-stu-id="63d64-243">Flushing an MFT</span></span>

<span data-ttu-id="63d64-244">A *liberação* de um MFT faz com que o MFT descarte todos os seus dados de entrada.</span><span class="sxs-lookup"><span data-stu-id="63d64-244">*Flushing* an MFT causes the MFT to discard all of its input data.</span></span> <span data-ttu-id="63d64-245">Isso pode causar uma interrupção no fluxo de saída.</span><span class="sxs-lookup"><span data-stu-id="63d64-245">This can cause a break in the output stream.</span></span> <span data-ttu-id="63d64-246">Um cliente normalmente liberaria um MFT antes de buscar um novo ponto no fluxo de entrada ou alternando para um novo fluxo de entrada, quando o cliente não se preocupa com a perda de dados.</span><span class="sxs-lookup"><span data-stu-id="63d64-246">A client would typically flush an MFT before seeking to a new point in the input stream or switching to a new input stream, when the client does not care about losing data.</span></span>

<span data-ttu-id="63d64-247">Para liberar uma MFT, chame [**IMFTransform::P rocessmessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) com a mensagem de [**\_ liberação de \_ comando \_ da mensagem MFT**](mft-message-command-flush.md) .</span><span class="sxs-lookup"><span data-stu-id="63d64-247">To flush an MFT, call [**IMFTransform::ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_COMMAND\_FLUSH**](mft-message-command-flush.md) message.</span></span>

## <a name="draining-an-mft"></a><span data-ttu-id="63d64-248">Drenagem de um MFT</span><span class="sxs-lookup"><span data-stu-id="63d64-248">Draining an MFT</span></span>

<span data-ttu-id="63d64-249">O *descarregamento* de uma MFT faz com que o MFT produza o máximo de saída possível de qualquer dado de entrada já enviado.</span><span class="sxs-lookup"><span data-stu-id="63d64-249">*Draining* an MFT causes the MFT to produce as much output as it can from whatever input data has already been sent.</span></span> <span data-ttu-id="63d64-250">Se o MFT não puder produzir um exemplo de saída completa da entrada disponível, ele removerá os dados de entrada.</span><span class="sxs-lookup"><span data-stu-id="63d64-250">If the MFT cannot produce a complete output sample from the available input, it will drop input data.</span></span> <span data-ttu-id="63d64-251">Um cliente normalmente drenaria um MFT quando atingiu o final do fluxo de origem, ou imediatamente antes de uma alteração de formato no fluxo de origem.</span><span class="sxs-lookup"><span data-stu-id="63d64-251">A client would typically drain an MFT when it reached the end of the source stream, or immediately before a format change in the source stream.</span></span> <span data-ttu-id="63d64-252">Para drenar uma MFT, faça o seguinte:</span><span class="sxs-lookup"><span data-stu-id="63d64-252">To drain an MFT, do the following:</span></span>

1.  <span data-ttu-id="63d64-253">Chame [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) com a mensagem de [**\_ dreno de \_ comando \_ de mensagem MFT**](mft-message-command-drain.md) .</span><span class="sxs-lookup"><span data-stu-id="63d64-253">Call [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_COMMAND\_DRAIN**](mft-message-command-drain.md) message.</span></span> <span data-ttu-id="63d64-254">Essa mensagem notifica o MFT de que ele deve fornecer tantos dados de saída quanto puder dos dados de entrada que já foram enviados.</span><span class="sxs-lookup"><span data-stu-id="63d64-254">This message notifies the MFT that it should deliver as much output data as it can from the input data that has already been sent.</span></span>
2.  <span data-ttu-id="63d64-255">Chame [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) para obter dados de saída, até que o método retorne **MF \_ E \_ Transform \_ precise de \_ mais \_ entradas**.</span><span class="sxs-lookup"><span data-stu-id="63d64-255">Call [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) to get output data, until the method returns **MF\_E\_TRANSFORM\_NEED\_MORE\_INPUT**.</span></span>

<span data-ttu-id="63d64-256">Enquanto a MFT está sendo descarregada, ela não aceitará mais nenhuma entrada.</span><span class="sxs-lookup"><span data-stu-id="63d64-256">While the MFT is being drained, it will not accept any more input.</span></span>

## <a name="sample-attributes"></a><span data-ttu-id="63d64-257">Atributos de exemplo</span><span class="sxs-lookup"><span data-stu-id="63d64-257">Sample Attributes</span></span>

<span data-ttu-id="63d64-258">Os exemplos de entrada podem ter atributos que devem ser copiados para os exemplos de saída correspondentes.</span><span class="sxs-lookup"><span data-stu-id="63d64-258">The input samples might have attributes that must be copied to the corresponding output samples.</span></span>

-   <span data-ttu-id="63d64-259">Se o MFT retornar a **variante \_ true** para a propriedade [**\_ \_ com suporte do exattribute MFPKEY**](mfpkey-exattribute-supported-property.md) , o MFT deverá copiar os atributos.</span><span class="sxs-lookup"><span data-stu-id="63d64-259">If the MFT returns **VARIANT\_TRUE** for the [**MFPKEY\_EXATTRIBUTE\_SUPPORTED**](mfpkey-exattribute-supported-property.md) property, the MFT must copy the attributes.</span></span>
-   <span data-ttu-id="63d64-260">Se a [**propriedade \_ \_ com suporte do exattribute MFPKEY**](mfpkey-exattribute-supported-property.md) for **Variant \_ false** ou não estiver definida, o cliente deverá copiar os atributos.</span><span class="sxs-lookup"><span data-stu-id="63d64-260">If the [**MFPKEY\_EXATTRIBUTE\_SUPPORTED**](mfpkey-exattribute-supported-property.md) property is either **VARIANT\_FALSE** or is not set, the client must copy the attributes.</span></span>

<span data-ttu-id="63d64-261">Para um MFT com uma entrada e uma saída, você pode usar a seguinte regra geral:</span><span class="sxs-lookup"><span data-stu-id="63d64-261">For an MFT with one input and one output, you can use the following general rule:</span></span>

-   <span data-ttu-id="63d64-262">Se cada amostra de entrada produzir exatamente um exemplo de saída, você poderá permitir que o cliente Copie os atributos.</span><span class="sxs-lookup"><span data-stu-id="63d64-262">If each input sample produces exactly one output sample, you can let the client copy the attributes.</span></span> <span data-ttu-id="63d64-263">Deixe a [**propriedade \_ \_ com suporte FileAttribute MFPKEY**](mfpkey-exattribute-supported-property.md) .</span><span class="sxs-lookup"><span data-stu-id="63d64-263">Leave the [**MFPKEY\_EXATTRIBUTE\_SUPPORTED**](mfpkey-exattribute-supported-property.md) property unset.</span></span>
-   <span data-ttu-id="63d64-264">Se não houver uma correspondência um-para-um entre amostras de entrada e amostras de saída, o MFT deverá determinar os atributos corretos para exemplos de saída.</span><span class="sxs-lookup"><span data-stu-id="63d64-264">If there is not a one-to-one correspondence between input samples and output samples, the MFT must determine the correct attributes for output samples.</span></span> <span data-ttu-id="63d64-265">Defina a [**propriedade \_ \_ com suporte do FileAttribute MFPKEY**](mfpkey-exattribute-supported-property.md) como **Variant \_ true**.</span><span class="sxs-lookup"><span data-stu-id="63d64-265">Set the [**MFPKEY\_EXATTRIBUTE\_SUPPORTED**](mfpkey-exattribute-supported-property.md) property to **VARIANT\_TRUE**.</span></span>

## <a name="discontinuities"></a><span data-ttu-id="63d64-266">Descontinuidades</span><span class="sxs-lookup"><span data-stu-id="63d64-266">Discontinuities</span></span>

<span data-ttu-id="63d64-267">Uma descontinuidade é uma interrupção em um fluxo de áudio ou vídeo.</span><span class="sxs-lookup"><span data-stu-id="63d64-267">A discontinuity is a break in an audio or video stream.</span></span> <span data-ttu-id="63d64-268">Descontinuidades pode ser causado por pacotes descartados em uma conexão de rede, dados de arquivo corrompidos, uma mudança de um fluxo de origem para outro ou uma ampla gama de outras causas.</span><span class="sxs-lookup"><span data-stu-id="63d64-268">Discontinuities can be caused by dropped packets on a network connection, corrupt file data, a switch from one source stream to another, or a wide range of other causes.</span></span> <span data-ttu-id="63d64-269">Descontinuidades são sinalizados definindo o atributo [**de \_ descontinuidade MFSampleExtension**](mfsampleextension-discontinuity-attribute.md) no primeiro exemplo após a descontinuidade.</span><span class="sxs-lookup"><span data-stu-id="63d64-269">Discontinuities are signaled by setting the [**MFSampleExtension\_Discontinuity**](mfsampleextension-discontinuity-attribute.md) attribute on the first sample after the discontinuity.</span></span> <span data-ttu-id="63d64-270">Não é possível sinalizar uma descontinuidade no meio de um exemplo.</span><span class="sxs-lookup"><span data-stu-id="63d64-270">It is not possible to signal a discontinuity in the middle of a sample.</span></span> <span data-ttu-id="63d64-271">Portanto, todos os dados descontínuos devem ser enviados em amostras separadas.</span><span class="sxs-lookup"><span data-stu-id="63d64-271">Therefore, any discontinuous data should be sent in separate samples.</span></span>

<span data-ttu-id="63d64-272">Algumas transformações, especialmente aquelas que lidam com dados não compactados, como efeitos de áudio e vídeo, devem ignorar descontinuidades quando processam dados de entrada.</span><span class="sxs-lookup"><span data-stu-id="63d64-272">Some transforms, especially those that handle uncompressed data, such as audio and video effects, should ignore discontinuities when they process input data.</span></span> <span data-ttu-id="63d64-273">Esses MFTs geralmente são projetados para lidar com dados contínuos e devem tratar todos os dados que receberem como contínuos, mesmo após uma descontinuidade.</span><span class="sxs-lookup"><span data-stu-id="63d64-273">These MFTs are generally designed to handle continuous data, and should treat any data they receive as continuous, even after a discontinuity.</span></span>

<span data-ttu-id="63d64-274">Se uma MFT ignorar uma descontinuidade nos dados de entrada, ela ainda deverá definir o sinalizador de discontinuidade no exemplo de saída, se o exemplo de saída tiver o mesmo carimbo de data/hora que o exemplo de entrada.</span><span class="sxs-lookup"><span data-stu-id="63d64-274">If an MFT ignores a discontinuity on input data, it should still set the discontinuity flag on the output sample, if the output sample has the same time stamp as the input sample.</span></span> <span data-ttu-id="63d64-275">No entanto, se o exemplo de saída tiver um carimbo de data/hora diferente, o MFT não deverá propagar a descontinuidade.</span><span class="sxs-lookup"><span data-stu-id="63d64-275">If the output sample has a different time stamp, however, the MFT should not propagate the discontinuity.</span></span> <span data-ttu-id="63d64-276">(Esse seria o caso em alguns reamostradores de áudio, por exemplo.) Uma descontinuidade no local errado no fluxo é pior do que nenhuma descontinuidade.</span><span class="sxs-lookup"><span data-stu-id="63d64-276">(This would be the case in some audio resamplers, for example.) A discontinuity at the wrong place in the stream is worse than no discontinuity.</span></span>

<span data-ttu-id="63d64-277">A maioria dos decodificadores não pode ignorar descontinuidades, porque uma descontinuidade afeta a interpretação da próxima amostra.</span><span class="sxs-lookup"><span data-stu-id="63d64-277">Most decoders cannot ignore discontinuities, because a discontinuity affects the interpretation of the next sample.</span></span> <span data-ttu-id="63d64-278">Qualquer tecnologia de codificação que usa compactação entre quadros, como MPEG-2, se encaixa nessa categoria.</span><span class="sxs-lookup"><span data-stu-id="63d64-278">Any encoding technology that uses inter-frame compression, such as MPEG-2, falls into this category.</span></span> <span data-ttu-id="63d64-279">Alguns esquemas de codificação usam apenas a compactação intra-frame, como DV e MJPEG.</span><span class="sxs-lookup"><span data-stu-id="63d64-279">Some encoding schemes use only intra-frame compression, such as DV and MJPEG.</span></span> <span data-ttu-id="63d64-280">Esses decodificadores podem ignorar descontinuidades com segurança.</span><span class="sxs-lookup"><span data-stu-id="63d64-280">These decoders can safely ignore discontinuities.</span></span>

<span data-ttu-id="63d64-281">As transformações que respondem a descontinuidades devem geralmente produzir a mesma quantidade de dados antes da descontinuidade como podem e descartar o restante.</span><span class="sxs-lookup"><span data-stu-id="63d64-281">Transforms that respond to discontinuities should generally output as much of the data before the discontinuity as they can, and discard the rest.</span></span> <span data-ttu-id="63d64-282">O exemplo de entrada com o sinalizador de descontinuidade deve ser processado como se fosse o primeiro exemplo no fluxo.</span><span class="sxs-lookup"><span data-stu-id="63d64-282">The input sample with the discontinuity flag should be processed as though it were the first sample in the stream.</span></span> <span data-ttu-id="63d64-283">(Esse comportamento corresponde ao que é especificado para a mensagem de [**\_ dreno de \_ comando \_ de mensagem MFT**](mft-message-command-drain.md) .) No entanto, os detalhes exatos dependerão do formato de mídia.</span><span class="sxs-lookup"><span data-stu-id="63d64-283">(This behavior matches what is specified for the [**MFT\_MESSAGE\_COMMAND\_DRAIN**](mft-message-command-drain.md) message.) However, the exact details will depend on the media format.</span></span>

<span data-ttu-id="63d64-284">Se um decodificador não faz nada para mitigar uma descontinuidade, ele deve copiar o sinalizador de descontinuidade para os dados de saída.</span><span class="sxs-lookup"><span data-stu-id="63d64-284">If a decoder does nothing to mitigate a discontinuity, it should copy the discontinuity flag to the output data.</span></span> <span data-ttu-id="63d64-285">Demultiplexadores e outros MFTs que funcionam inteiramente com dados compactados devem copiar qualquer descontinuidades para seus fluxos de saída.</span><span class="sxs-lookup"><span data-stu-id="63d64-285">Demultiplexers and other MFTs that work entirely with compressed data must copy any discontinuities to their output streams.</span></span> <span data-ttu-id="63d64-286">Caso contrário, os componentes downstream talvez não consigam decodificar os dados compactados corretamente.</span><span class="sxs-lookup"><span data-stu-id="63d64-286">Otherwise, the downstream components may not be able to decode the compressed data correctly.</span></span> <span data-ttu-id="63d64-287">Em geral, é quase sempre correto para passar descontinuidades downstream, a menos que o MFT contenha um código explícito para suavizar o descontinuidades.</span><span class="sxs-lookup"><span data-stu-id="63d64-287">In general, it is almost always correct to pass discontinuities downstream, unless the MFT contains explicit code to smooth out discontinuities.</span></span>

## <a name="dynamic-format-changes"></a><span data-ttu-id="63d64-288">Alterações de formato dinâmico</span><span class="sxs-lookup"><span data-stu-id="63d64-288">Dynamic Format Changes</span></span>

<span data-ttu-id="63d64-289">Os formatos podem ser alterados durante o streaming.</span><span class="sxs-lookup"><span data-stu-id="63d64-289">Formats can change during streaming.</span></span> <span data-ttu-id="63d64-290">Por exemplo, a taxa de proporção pode ser alterada no meio de um fluxo de vídeo.</span><span class="sxs-lookup"><span data-stu-id="63d64-290">For example, aspect ratio can change in the middle of a video stream.</span></span>

<span data-ttu-id="63d64-291">Para obter detalhes sobre como as alterações de fluxo são tratadas por um MFT, consulte [manipulando alterações de fluxo](handling-stream-changes.md).</span><span class="sxs-lookup"><span data-stu-id="63d64-291">For details about how stream changes are handled by an MFT, see [Handling Stream Changes](handling-stream-changes.md).</span></span>

## <a name="stream-events"></a><span data-ttu-id="63d64-292">Eventos de fluxo</span><span class="sxs-lookup"><span data-stu-id="63d64-292">Stream Events</span></span>

<span data-ttu-id="63d64-293">Para enviar um evento para um MFT, chame [**IMFTransform::P rocessevent**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processevent).</span><span class="sxs-lookup"><span data-stu-id="63d64-293">To send an event to an MFT, call [**IMFTransform::ProcessEvent**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processevent).</span></span> <span data-ttu-id="63d64-294">Se o método retornar **o \_ evento MF S \_ Transform \_ \_ não \_ propagar \_**, o MFT retornará o evento para o chamador em uma chamada subsequente para [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="63d64-294">If the method returns **MF\_S\_TRANSFORM\_DO\_NOT\_PROPAGATE\_EVENT**, the MFT will return the event to the caller on a subsequent call to [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span> <span data-ttu-id="63d64-295">Se o método retornar qualquer outro valor **HRESULT** , o MFT não retornará o evento para o cliente em **ProcessOutput**.</span><span class="sxs-lookup"><span data-stu-id="63d64-295">If the method returns any other **HRESULT** value, the MFT will not return the event to the client in **ProcessOutput**.</span></span> <span data-ttu-id="63d64-296">Nesse caso, o cliente é responsável por propagar o downstream de evento para o próximo componente no pipeline, se aplicável.</span><span class="sxs-lookup"><span data-stu-id="63d64-296">In that case, the client is responsible for propagating the event downstream to the next component in the pipeline, if applicable.</span></span> <span data-ttu-id="63d64-297">Para obter mais informações, consulte [**IMFTransform::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="63d64-297">For more information, see [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>

## <a name="related-topics"></a><span data-ttu-id="63d64-298">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="63d64-298">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="63d64-299">Transformações de Media Foundation</span><span class="sxs-lookup"><span data-stu-id="63d64-299">Media Foundation Transforms</span></span>](media-foundation-transforms.md)
</dt> </dl>

 

 



