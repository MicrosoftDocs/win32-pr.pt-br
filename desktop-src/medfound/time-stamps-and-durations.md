---
description: Este tópico descreve como Media Foundation transformações devem lidar com carimbos de data/hora.
ms.assetid: 4ab576ce-becd-4736-921e-e463c0dff841
title: Carimbos de data/hora e durações
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2323c11fa0e3ec2b2b2d5ba1cefe4f5d5fa80c5b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104091029"
---
# <a name="time-stamps-and-durations"></a><span data-ttu-id="3b18c-103">Carimbos de data/hora e durações</span><span class="sxs-lookup"><span data-stu-id="3b18c-103">Time Stamps and Durations</span></span>

<span data-ttu-id="3b18c-104">Este tópico descreve como [Media Foundation transformações](media-foundation-transforms.md) devem lidar com carimbos de data/hora.</span><span class="sxs-lookup"><span data-stu-id="3b18c-104">This topic describes how [Media Foundation Transforms](media-foundation-transforms.md) should handle time stamps.</span></span>

<span data-ttu-id="3b18c-105">Uma MFT deve definir a precisão de um carimbo de data/hora e a duração possível em todas as amostras de saída.</span><span class="sxs-lookup"><span data-stu-id="3b18c-105">An MFT must set as accurate a time stamp and duration as possible on all output samples.</span></span> <span data-ttu-id="3b18c-106">Para um MFT simples que usa um buffer de entrada e o processa completamente em um buffer de saída, o MFT deve simplesmente copiar o carimbo de data/hora e a duração diretamente do exemplo de entrada para o exemplo de saída.</span><span class="sxs-lookup"><span data-stu-id="3b18c-106">For a simple MFT that takes one input buffer and completely processes it into an output buffer, the MFT should just copy the time stamp and duration directly from the input sample to the output sample.</span></span> <span data-ttu-id="3b18c-107">No entanto, muitas transformações são mais complexas do que isso e podem exigir cálculos mais complexos de tempo de saída.</span><span class="sxs-lookup"><span data-stu-id="3b18c-107">However, many transforms are more complex than this and may require more complex calculations of output time.</span></span> <span data-ttu-id="3b18c-108">Todos os MFTs devem observar as seguintes regras básicas:</span><span class="sxs-lookup"><span data-stu-id="3b18c-108">All MFTs should observe the following basic rules:</span></span>

-   <span data-ttu-id="3b18c-109">Um MFT deve tentar colocar um carimbo de data/hora e uma duração em todos os exemplos de saída de áudio ou vídeo não compactados se um carimbo de data/hora preciso ou a duração for dada nos exemplos de entrada ou puder ser calculado.</span><span class="sxs-lookup"><span data-stu-id="3b18c-109">An MFT should try to put a time stamp and duration on all uncompressed video or audio output samples if an accurate time stamp or duration is given on the input samples or can be calculated.</span></span> <span data-ttu-id="3b18c-110">A interpolação pode ser necessária para alguns carimbos de hora de saída, especialmente para decodificadores.</span><span class="sxs-lookup"><span data-stu-id="3b18c-110">Interpolation may be required for some output time stamps, especially for decoders.</span></span>
-   <span data-ttu-id="3b18c-111">Os carimbos de data/hora e as durações dos exemplos de entrada devem ser preservados nas amostras de saída tanto quanto possível.</span><span class="sxs-lookup"><span data-stu-id="3b18c-111">The time stamps and durations of the input samples should be preserved on the output samples as much as possible.</span></span>
-   <span data-ttu-id="3b18c-112">As durações ou os carimbos de data/hora de saída podem não corresponder à entrada porque o MFT está mantendo dados de volta ou dividindo a saída em partes de tamanhos diferentes da entrada.</span><span class="sxs-lookup"><span data-stu-id="3b18c-112">The output time stamps or durations might not match the input because the MFT is holding back data or breaking the output into different-sized pieces than the input.</span></span> <span data-ttu-id="3b18c-113">Nesse caso, o MFT deve calcular o carimbo de data/hora de saída do exemplo de entrada mais antigo que contém os dados usados para criar o exemplo de saída.</span><span class="sxs-lookup"><span data-stu-id="3b18c-113">In that case, the MFT should calculate the output time stamp from the earliest input sample that contains data used to create the output sample.</span></span> <span data-ttu-id="3b18c-114">Para calcular o carimbo de data/hora de saída, adicione o carimbo de data/hora de entrada do exemplo de entrada apropriado à duração dos dados que já foram transformados nesse exemplo.</span><span class="sxs-lookup"><span data-stu-id="3b18c-114">To calculate the output time stamp, add the input time stamp of the appropriate input sample to the duration of data that has already been transformed from that sample.</span></span> <span data-ttu-id="3b18c-115">O segundo exemplo no final desta seção ilustra essa ideia.</span><span class="sxs-lookup"><span data-stu-id="3b18c-115">The second example at the end of this section illustrates this idea.</span></span>
-   <span data-ttu-id="3b18c-116">Se os exemplos de entrada tiverem duração, essa duração deverá ser preservada.</span><span class="sxs-lookup"><span data-stu-id="3b18c-116">If the input samples have duration, that duration should be preserved.</span></span> <span data-ttu-id="3b18c-117">Se uma amostra de entrada não tiver duração, o MFT deverá calcular uma duração, se possível, a partir do tamanho do buffer de saída ou da taxa de dados fornecida pelo tipo de mídia.</span><span class="sxs-lookup"><span data-stu-id="3b18c-117">If an input sample does not have duration, the MFT should calculate a duration if possible from the size of the output buffer or the data rate given by the media type.</span></span>
-   <span data-ttu-id="3b18c-118">As durações calculadas devem ser truncadas (arredondadas), não arredondadas para o incremento mais próximo.</span><span class="sxs-lookup"><span data-stu-id="3b18c-118">Calculated durations should be truncated (rounded down), not rounded to the nearest increment.</span></span> <span data-ttu-id="3b18c-119">O pipeline tem uma margem de atraso suficiente para lidar com as durações que são ligeiramente imprecisas, mas é mais fácil para o pipeline lidar com uma duração que é de 1% muito curta do que uma duração que é de 1% muito longa.</span><span class="sxs-lookup"><span data-stu-id="3b18c-119">The pipeline has enough slack to handle durations that are slightly inaccurate, but it is easier for the pipeline to handle a duration that is 1% too short than a duration that is 1% too long.</span></span> <span data-ttu-id="3b18c-120">Dito isso, não há motivo para reduzir deliberadamente as durações, além do arredondamento.</span><span class="sxs-lookup"><span data-stu-id="3b18c-120">That said, there is no reason to deliberately shorten the durations, other than by rounding.</span></span>

### <a name="decoders"></a><span data-ttu-id="3b18c-121">Decodificadores</span><span class="sxs-lookup"><span data-stu-id="3b18c-121">Decoders</span></span>

<span data-ttu-id="3b18c-122">Um decodificador converte pacotes compactados em dados descompactados.</span><span class="sxs-lookup"><span data-stu-id="3b18c-122">A decoder converts compressed packets into uncompressed data.</span></span> <span data-ttu-id="3b18c-123">Como a saída é descompactada, os decodificadores têm uma obrigação especial para obter os carimbos de data/hora e as durações corretas.</span><span class="sxs-lookup"><span data-stu-id="3b18c-123">Because the output is uncompressed, decoders have a special obligation to get the time stamps and durations correct.</span></span> <span data-ttu-id="3b18c-124">Alguns formatos compactados, mais notavelmente MPEG-2, não têm carimbos de data/hora em todos os pacotes de entrada e geralmente não têm duração em nenhum pacote.</span><span class="sxs-lookup"><span data-stu-id="3b18c-124">Some compressed formats, most notably MPEG-2, do not have time stamps on all input packets and often have no duration on any packet.</span></span> <span data-ttu-id="3b18c-125">Para esses formatos, o decodificador é responsável por colocar um carimbo de data/hora e uma duração válidos em cada amostra de saída, somando as durações implícitas de todas as saídas desde o último exemplo de entrada com carimbo de data/hora.</span><span class="sxs-lookup"><span data-stu-id="3b18c-125">For these formats, the decoder is responsible for putting a valid time stamp and duration on every output sample, by summing the implied durations of all the output since the last time-stamped input sample.</span></span>

<span data-ttu-id="3b18c-126">Para vídeo, se a duração não estiver disponível no formato compactado, o decodificador deverá calcular a duração como o inverso da taxa de quadros, convertido em unidades de 100 nanossegundos e arredondado para baixo.</span><span class="sxs-lookup"><span data-stu-id="3b18c-126">For video, if the duration is not available in the compressed format, the decoder should calculate the duration as the inverse of the frame rate, converted to 100-nanosecond units and rounded down.</span></span>

<span data-ttu-id="3b18c-127">Para áudio, se a duração não estiver disponível no formato compactado, o decodificador deverá calcular a duração como o inverso da taxa de amostra de áudio multiplicado pelo número de amostras no buffer de saída, convertido em unidades de 100 nanossegundos e arredondado para baixo.</span><span class="sxs-lookup"><span data-stu-id="3b18c-127">For audio, if the duration is not available in the compressed format, the decoder should calculate the duration as the inverse of the audio sample rate multiplied by the number of samples in the output buffer, converted to 100-nanosecond units and rounded down.</span></span>

<span data-ttu-id="3b18c-128">A única vez que uma transformação deve gerar uma amostra sem um carimbo de data/hora é se a MFT nunca recebeu um carimbo de data/hora em um exemplo de entrada ou se não há nenhuma maneira de calcular um carimbo de data/hora de saída preciso do carimbo de data/hora de entrada anterior.</span><span class="sxs-lookup"><span data-stu-id="3b18c-128">The only time a transform should output a sample without a time stamp is if the MFT has never received a time stamp on an input sample, or if there is no way to calculate an accurate output time stamp from the previous input time stamp.</span></span>

### <a name="audio-decoders"></a><span data-ttu-id="3b18c-129">Decodificadores de áudio</span><span class="sxs-lookup"><span data-stu-id="3b18c-129">Audio Decoders</span></span>

<span data-ttu-id="3b18c-130">Para decodificadores de áudio, a duração de cada exemplo de saída é calculada a partir da taxa de amostragem de áudio e o número de amostras de PCM por canal no buffer de saída.</span><span class="sxs-lookup"><span data-stu-id="3b18c-130">For audio decoders, the duration of each output sample is calculated from the audio sampling rate and the number of PCM samples per channel in the output buffer.</span></span>

<span data-ttu-id="3b18c-131">A maneira correta de calcular carimbos de hora de saída depende se os exemplos de entrada contêm carimbos de data/hora.</span><span class="sxs-lookup"><span data-stu-id="3b18c-131">The correct way to calculate output time stamps depends on whether the input samples contain time stamps.</span></span>

<span data-ttu-id="3b18c-132">Se os exemplos de entrada contiverem carimbos de data/hora, o decodificador calculará os carimbos de data/hora de saída dos carimbos de data/hora</span><span class="sxs-lookup"><span data-stu-id="3b18c-132">If the input samples contain time stamps, the decoder calculates the output time stamps from the input time stamps, as follows:</span></span>

-   <span data-ttu-id="3b18c-133">Se cada buffer de entrada contiver um ou mais quadros compactados completos, sem quadros parciais, o carimbo de data/hora de saída será igual ao carimbo de data/hora de entrada, menos a latência conhecida do decodificador.</span><span class="sxs-lookup"><span data-stu-id="3b18c-133">If each input buffer contains a one or more complete compressed frames, with no partial frames, the output time stamp equals the input time stamp, minus the known latency of the decoder.</span></span> <span data-ttu-id="3b18c-134">Por exemplo, um decodificador Dolby Digital (AC-3) tem uma latência de 256 amostras de PCM.</span><span class="sxs-lookup"><span data-stu-id="3b18c-134">For example, a Dolby Digital (AC-3) decoder has a latency of 256 PCM samples.</span></span> <span data-ttu-id="3b18c-135">Por exemplo, com taxa de amostragem de 48-kHz, a latência é de 5,33 milissegundos (MS).</span><span class="sxs-lookup"><span data-stu-id="3b18c-135">For example, at 48-kHz sampling rate, the latency is 5.33 milliseconds (msec).</span></span> <span data-ttu-id="3b18c-136">Portanto, se o carimbo de data/hora de entrada for 1000 mseg, o carimbo de data/hora de saída será 1000 – 5,33 = 994,66 MS.</span><span class="sxs-lookup"><span data-stu-id="3b18c-136">Therefore, if the input time stamp is 1000 msec, the output time stamp is 1000 – 5.33 = 994.66 msec.</span></span> <span data-ttu-id="3b18c-137">Se o buffer de entrada incluir mais de um quadro compactado inteiro, o decodificador produzirá um exemplo de saída para cada quadro no exemplo de entrada.</span><span class="sxs-lookup"><span data-stu-id="3b18c-137">If the input buffer includes more than one whole compressed frame, the decoder will produce one output sample for every frame in the input sample.</span></span> <span data-ttu-id="3b18c-138">Todos os exemplos de saída serão marcados corretamente de modo que não haja intervalos.</span><span class="sxs-lookup"><span data-stu-id="3b18c-138">All output samples will be time stamped correctly such that there are no gaps.</span></span>
-   <span data-ttu-id="3b18c-139">Dependendo do formato de transporte, um buffer de entrada pode conter quadros parciais.</span><span class="sxs-lookup"><span data-stu-id="3b18c-139">Depending on the transport format, an input buffer might contain partial frames.</span></span> <span data-ttu-id="3b18c-140">Por exemplo, um buffer pode conter parte de um quadro do buffer de entrada anterior, seguido por um ou mais quadros completos, seguidos do início do próximo quadro.</span><span class="sxs-lookup"><span data-stu-id="3b18c-140">For example, a buffer might contain part of a frame from the previous input buffer, followed by one or more complete frames, followed by the start of the next frame.</span></span> <span data-ttu-id="3b18c-141">Nesse caso, geralmente está correto para assumir que o carimbo de data/hora de entrada corresponde ao primeiro quadro que começa dentro do buffer.</span><span class="sxs-lookup"><span data-stu-id="3b18c-141">In this case, it is generally correct to assume that the input time stamp corresponds to the first frame that starts within the buffer.</span></span> <span data-ttu-id="3b18c-142">(Ou seja, um quadro parcial iniciado no buffer anterior não está incluído no carimbo de data/hora do buffer atual.) Calcule o carimbo de hora de saída de acordo.</span><span class="sxs-lookup"><span data-stu-id="3b18c-142">(That is, a partial frame that started in the previous buffer is not included in the time stamp for the current buffer.) Calculate the output time stamp accordingly.</span></span>

<span data-ttu-id="3b18c-143">Se os exemplos de entrada não contiverem carimbos de data/hora:</span><span class="sxs-lookup"><span data-stu-id="3b18c-143">If the input samples do not contain any time stamps:</span></span>

-   <span data-ttu-id="3b18c-144">O decodificador deve gerar seus próprios carimbos de data/hora, definindo o primeiro carimbo de hora de saída como zero.</span><span class="sxs-lookup"><span data-stu-id="3b18c-144">The decoder should generate its own time stamps, setting the first output time stamp to zero.</span></span>
-   <span data-ttu-id="3b18c-145">A duração da amostra é calculada a partir do número de amostras de saída no buffer e da taxa de amostra.</span><span class="sxs-lookup"><span data-stu-id="3b18c-145">The sample duration is calculated from the number of output samples in the buffer and the sample rate.</span></span>
-   <span data-ttu-id="3b18c-146">Carimbos de data/hora subsequentes são calculados do carimbo de data/hora anterior: carimbo de data/hora atual + duração atual = próximo carimbo de data/hora.</span><span class="sxs-lookup"><span data-stu-id="3b18c-146">Subsequent time stamps are calculated from the previous time stamp and duration: Current time stamp + current duration = next time stamp.</span></span> <span data-ttu-id="3b18c-147">Não deve haver lacunas nos carimbos de data/hora de saída.</span><span class="sxs-lookup"><span data-stu-id="3b18c-147">There should be no gaps in the output time stamps.</span></span>

<span data-ttu-id="3b18c-148">Se o fluxo de entrada contiver inicialmente carimbos de data/hora, mas, por algum motivo, mudar para nenhum carimbo de data/hora, o decodificador deverá continuar a gerar seus próprios carimbos de hora de saída, de modo que eles sejam contínuos e não haja nenhum intervalo</span><span class="sxs-lookup"><span data-stu-id="3b18c-148">If the input stream initially contains time stamps, but for some reason switches to no time stamps, the decoder should continue to generate its own output time stamps, such that they are continuous and there is no gap.</span></span>

<span data-ttu-id="3b18c-149">Se o fluxo de entrada contiver carimbos de data/hora, mas houver lacunas nos horários, o decodificador simplesmente propagará essas lacunas.</span><span class="sxs-lookup"><span data-stu-id="3b18c-149">If the input stream contains time stamps, but there are gaps in the times, the decoder will simply propagate these gaps.</span></span> <span data-ttu-id="3b18c-150">Em outras palavras, o decodificador não deve tentar corrigir carimbos de data/hora inconsistentes no fluxo de entrada.</span><span class="sxs-lookup"><span data-stu-id="3b18c-150">In other words, the decoder should not attempt to fix inconsistent time stamps in the input stream.</span></span>

### <a name="mixers"></a><span data-ttu-id="3b18c-151">Mixers</span><span class="sxs-lookup"><span data-stu-id="3b18c-151">Mixers</span></span>

> [!Note]  
> <span data-ttu-id="3b18c-152">No Windows Vista, o pipeline Media Foundation não dá suporte a MFTs com mais de uma entrada.</span><span class="sxs-lookup"><span data-stu-id="3b18c-152">In Windows Vista, the Media Foundation pipeline does not support MFTs with more than one input.</span></span> <span data-ttu-id="3b18c-153">Há suporte para MFTs de várias entradas no Windows 7.</span><span class="sxs-lookup"><span data-stu-id="3b18c-153">Multiple-input MFTs are supported in Windows 7.</span></span>

 

<span data-ttu-id="3b18c-154">Um mixer usa várias entradas e as combina em uma saída.</span><span class="sxs-lookup"><span data-stu-id="3b18c-154">A mixer takes multiple inputs and mixes them into one output.</span></span> <span data-ttu-id="3b18c-155">Se os fluxos de entrada não forem completamente bloqueados por taxas ou forem ligeiramente deslocados no tempo uns dos outros, poderá haver ambiguidade sobre qual tempo deve ser definido na saída.</span><span class="sxs-lookup"><span data-stu-id="3b18c-155">If the input streams are not completely rate-locked, or are slightly offset in time from each other, there can be ambiguity about which time to set on the output.</span></span> <span data-ttu-id="3b18c-156">Aqui estão algumas diretrizes, dependendo do tipo de mídia:</span><span class="sxs-lookup"><span data-stu-id="3b18c-156">Here are some guidelines, depending on the media type:</span></span>

-   <span data-ttu-id="3b18c-157">Sonoro.</span><span class="sxs-lookup"><span data-stu-id="3b18c-157">Audio.</span></span> <span data-ttu-id="3b18c-158">Na inicialização ou imediatamente após uma descarga ou liberação, um mixer de áudio deve aguardar para produzir amostras de saída até receber uma amostra de entrada em todos os fluxos de entrada necessários.</span><span class="sxs-lookup"><span data-stu-id="3b18c-158">At startup or immediately after a drain or flush, an audio mixer should wait to produce output samples until it has received an input sample on all required input streams.</span></span> <span data-ttu-id="3b18c-159">Nesse ponto, ele deve escolher o carimbo de data/hora mais antigo dos exemplos iniciais para usar como uma linha de base para os carimbos de data/hora de saída.</span><span class="sxs-lookup"><span data-stu-id="3b18c-159">At that point, it should choose the earliest time stamp of the initial samples to use as a baseline for the output time stamps.</span></span> <span data-ttu-id="3b18c-160">Os outros fluxos devem ser preenchidos com silêncio para fazer qualquer discrepância de tempo.</span><span class="sxs-lookup"><span data-stu-id="3b18c-160">The other streams should be padded with silence to make up any time discrepancy.</span></span> <span data-ttu-id="3b18c-161">Se um exemplo for recebido em um fluxo de entrada opcional, ele também deverá ser acrescentado ao cálculo.</span><span class="sxs-lookup"><span data-stu-id="3b18c-161">If a sample is received on an optional input stream, it should also be factored into the calculation.</span></span> <span data-ttu-id="3b18c-162">Desse ponto em diante, o MFT deve se esforçar para produzir uma cadeia contínua e não quebrada de carimbos de hora de saída.</span><span class="sxs-lookup"><span data-stu-id="3b18c-162">From that point on, the MFT should strive to produce a continuous and unbroken chain of output time stamps.</span></span> <span data-ttu-id="3b18c-163">Em geral, o MFT não deve tentar considerar uma descompasso de fluxo em relação a outra.</span><span class="sxs-lookup"><span data-stu-id="3b18c-163">In general, the MFT should not try to account for one stream drifting relative to another.</span></span> <span data-ttu-id="3b18c-164">Em vez disso, ele deve calcular os carimbos de hora de saída do carimbo de data/hora de linha de base, a taxa de saída e os tamanhos de buffer.</span><span class="sxs-lookup"><span data-stu-id="3b18c-164">Instead, it should calculate the output time stamps from the baseline time stamp, the output rate, and the buffer sizes.</span></span> <span data-ttu-id="3b18c-165">Quando outro dreno ou liberação ocorre, o MFT deve redefinir seus carimbos de data/hora de linha de base.</span><span class="sxs-lookup"><span data-stu-id="3b18c-165">When another drain or flush occurs, the MFT should reset its baseline time stamps.</span></span>

-   <span data-ttu-id="3b18c-166">Vídeo.</span><span class="sxs-lookup"><span data-stu-id="3b18c-166">Video.</span></span> <span data-ttu-id="3b18c-167">Na inicialização ou imediatamente após uma descarga ou liberação, um mixer de vídeo deve aguardar para produzir amostras de saída até receber uma amostra de entrada em todos os fluxos de entrada necessários.</span><span class="sxs-lookup"><span data-stu-id="3b18c-167">At startup or immediately after a drain or flush, a video mixer should wait to produce output samples until it has received an input sample on all required input streams.</span></span> <span data-ttu-id="3b18c-168">Nesse ponto, ele deve escolher o carimbo de data/hora mais antigo dos exemplos iniciais para usar como uma linha de base para os carimbos de data/hora de saída.</span><span class="sxs-lookup"><span data-stu-id="3b18c-168">At that point, it should choose the earliest time stamp of the initial samples to use as a baseline for the output time stamps.</span></span> <span data-ttu-id="3b18c-169">Em geral, ele deve se esforçar para manter carimbos de hora de saída contínuos e regulares e durações fixas, mesmo que a entrada não seja tão regular, se necessário, repetindo quadros de entrada.</span><span class="sxs-lookup"><span data-stu-id="3b18c-169">In general, it should strive to keep continuous and regular output time stamps and fixed durations, even if the input is not as regular, if necessary by repeating input frames.</span></span>

### <a name="encoders"></a><span data-ttu-id="3b18c-170">Codificadores</span><span class="sxs-lookup"><span data-stu-id="3b18c-170">Encoders</span></span>

<span data-ttu-id="3b18c-171">Um codificador converte áudio ou vídeo descompactado em pacotes compactados.</span><span class="sxs-lookup"><span data-stu-id="3b18c-171">An encoder converts uncompressed audio or video into compressed packets.</span></span> <span data-ttu-id="3b18c-172">Um codificador deve seguir estas diretrizes:</span><span class="sxs-lookup"><span data-stu-id="3b18c-172">An encoder should follow these guidelines:</span></span>

-   <span data-ttu-id="3b18c-173">O codificador deve seguir as convenções do formato de saída.</span><span class="sxs-lookup"><span data-stu-id="3b18c-173">The encoder should follow the conventions of the output format.</span></span> <span data-ttu-id="3b18c-174">Se o formato normalmente não carimbar o tempo de cada amostra, como em MPEG-2, nem todos os exemplos de saída precisam ter um carimbo de data/hora e uma duração.</span><span class="sxs-lookup"><span data-stu-id="3b18c-174">If the format does not typically time stamp every sample, as in MPEG-2, not every output sample needs to have a time stamp and a duration.</span></span>

-   <span data-ttu-id="3b18c-175">Os carimbos de data/hora de entrada devem ser preservados no formato de saída, se o formato tiver campos para carimbos de data/hora, a menos que as informações de melhor hora estejam disponíveis de outra fonte, como o próprio aplicativo.</span><span class="sxs-lookup"><span data-stu-id="3b18c-175">The input time stamps should be preserved in the output format, if the format has fields for time stamps, unless better time information is a available from another source, such as the application itself.</span></span>

### <a name="multiplexers"></a><span data-ttu-id="3b18c-176">Multiplexadores</span><span class="sxs-lookup"><span data-stu-id="3b18c-176">Multiplexers</span></span>

> [!Note]  
> <span data-ttu-id="3b18c-177">No Windows Vista, o pipeline Media Foundation não dá suporte a MFTs com mais de uma entrada.</span><span class="sxs-lookup"><span data-stu-id="3b18c-177">In Windows Vista, the Media Foundation pipeline does not support MFTs with more than one input.</span></span> <span data-ttu-id="3b18c-178">Há suporte para MFTs de várias entradas no Windows 7.</span><span class="sxs-lookup"><span data-stu-id="3b18c-178">Multiple-input MFTs are supported in Windows 7.</span></span>

 

<span data-ttu-id="3b18c-179">Um multiplexador combina dois fluxos de áudio ou vídeo diferentes em um formato intercalado, como o fluxo de transporte AVI ou MPEG-2.</span><span class="sxs-lookup"><span data-stu-id="3b18c-179">A multiplexer combines two different audio or video streams into one interleaved format, such as AVI or MPEG-2 Transport Stream.</span></span> <span data-ttu-id="3b18c-180">Um multiplexador deve seguir estas diretrizes:</span><span class="sxs-lookup"><span data-stu-id="3b18c-180">A multiplexer should follow these guidelines:</span></span>

-   <span data-ttu-id="3b18c-181">O multiplexador deve seguir as convenções do formato de saída.</span><span class="sxs-lookup"><span data-stu-id="3b18c-181">The multiplexer should follow the conventions of the output format.</span></span> <span data-ttu-id="3b18c-182">Se o formato normalmente não carimbar o tempo de cada amostra, como em MPEG-2, nem todos os exemplos de saída precisam ter um carimbo de data/hora e uma duração.</span><span class="sxs-lookup"><span data-stu-id="3b18c-182">If the format does not typically time stamp every sample, as in MPEG-2, not every output sample needs to have a time stamp and a duration.</span></span>

-   <span data-ttu-id="3b18c-183">O carimbo de data/hora deve refletir a hora mais antiga que seria colocada em qualquer quadro que começa nesse pacote ou a hora do primeiro exemplo de áudio que seria decodificada a partir desse pacote.</span><span class="sxs-lookup"><span data-stu-id="3b18c-183">The time stamp should reflect the earliest time that would be placed on any frame that begins in that packet, or the time of the first audio sample that would be decoded from that packet.</span></span> <span data-ttu-id="3b18c-184">Ignore essa diretriz se ela entrar em conflito com as convenções do formato de saída.</span><span class="sxs-lookup"><span data-stu-id="3b18c-184">Ignore this guideline if it conflicts with the conventions of the output format.</span></span>

### <a name="demultiplexers"></a><span data-ttu-id="3b18c-185">Demultiplexadores</span><span class="sxs-lookup"><span data-stu-id="3b18c-185">Demultiplexers</span></span>

<span data-ttu-id="3b18c-186">Um demultiplexador divide um formato intercalado, como o fluxo de transporte AVI ou MPEG-2, nos fluxos de áudio e vídeo subjacentes.</span><span class="sxs-lookup"><span data-stu-id="3b18c-186">A demultiplexer splits an interleaved format, such as AVI or MPEG-2 Transport Stream, into the underlying audio and video streams.</span></span>

<span data-ttu-id="3b18c-187">Se o formato contiver informações de carimbo de data/hora específicas que podem ser usadas para calcular carimbos de tempo de saída precisos com base nos carimbos de data/hora, essas informações deverão ser usadas.</span><span class="sxs-lookup"><span data-stu-id="3b18c-187">If the format contains specific time stamp information that can be used to calculate accurate output time stamps based on the input time stamps, that information should be used.</span></span> <span data-ttu-id="3b18c-188">No entanto, se o formato contiver vezes em uma base completamente diferente que não tenha nenhuma relação com os carimbos de data/hora de entrada, e um deslocamento preciso para o carimbo de data/hora de entrada não puder ser calculado, os tempos próprios do formato deverão ser ignorados.</span><span class="sxs-lookup"><span data-stu-id="3b18c-188">However, if the format contains times in a completely different base that bear no relation to the input time stamps, and an accurate offset to the input time stamp cannot be calculated, the format's own times should be ignored.</span></span>

<span data-ttu-id="3b18c-189">Se o formato não tiver informações de carimbo de data/hora utilizáveis, o demultiplexador deverá seguir estas regras:</span><span class="sxs-lookup"><span data-stu-id="3b18c-189">If the format does not have usable time stamp information, the demultiplexer should follow these rules:</span></span>

-   <span data-ttu-id="3b18c-190">Fluxos de saída não compactados devem ter carimbos de data e durações válidos, se possível, calculados a partir do carimbo de data/hora de entrada anterior mais próximo.</span><span class="sxs-lookup"><span data-stu-id="3b18c-190">Uncompressed output streams should have valid time stamps and durations if possible, calculated from the closest previous input time stamp.</span></span>

-   <span data-ttu-id="3b18c-191">Fluxos de saída compactados devem ter carimbos de data/hora somente no primeiro exemplo de saída derivado de um exemplo de entrada com um carimbo de data/hora.</span><span class="sxs-lookup"><span data-stu-id="3b18c-191">Compressed output streams should have time stamps on only the first output sample derived from an input sample with a time stamp.</span></span> <span data-ttu-id="3b18c-192">Se a amostra de entrada não tiver um carimbo de data/hora, nenhuma amostra de saída derivada desse exemplo de entrada deverá ter um carimbo de data/hora.</span><span class="sxs-lookup"><span data-stu-id="3b18c-192">If the input sample does not have a time stamp, no output samples derived from that input sample should have a time stamp.</span></span> <span data-ttu-id="3b18c-193">Se o exemplo de entrada for dividido em vários exemplos de saída, somente o primeiro exemplo de saída deverá ter um carimbo de data/hora e o restante não deverá ter carimbos de data/hora.</span><span class="sxs-lookup"><span data-stu-id="3b18c-193">If the input sample is broken into multiple output samples, only the first output sample should have a time stamp, and the rest should have no time stamps.</span></span>

### <a name="examples"></a><span data-ttu-id="3b18c-194">Exemplos</span><span class="sxs-lookup"><span data-stu-id="3b18c-194">Examples</span></span>

<span data-ttu-id="3b18c-195">Exemplo 1.</span><span class="sxs-lookup"><span data-stu-id="3b18c-195">Example 1.</span></span> <span data-ttu-id="3b18c-196">Suponha que um efeito de vídeo sempre assuma um quadro de entrada descompactado, aplique o efeito e o copie para a saída.</span><span class="sxs-lookup"><span data-stu-id="3b18c-196">Suppose that a video effect always takes an uncompressed input frame, applies the effect, and copies it to the output.</span></span> <span data-ttu-id="3b18c-197">Ele nunca retorne nenhum quadro ou buffers qualquer entrada.</span><span class="sxs-lookup"><span data-stu-id="3b18c-197">It never holds back any frames or buffers any input.</span></span> <span data-ttu-id="3b18c-198">Essa MFT simplesmente copia o carimbo de data/hora e a duração do exemplo de entrada para o exemplo de saída, se eles estiverem disponíveis, e não houver nenhum cálculo de tempo.</span><span class="sxs-lookup"><span data-stu-id="3b18c-198">This MFT simply copies the time stamp and duration from the input sample to the output sample, if they are available, and does no time calculations at all.</span></span>

<span data-ttu-id="3b18c-199">Exemplo 2.</span><span class="sxs-lookup"><span data-stu-id="3b18c-199">Example 2.</span></span> <span data-ttu-id="3b18c-200">Suponha que um efeito de áudio transforme todos, exceto 10 milissegundos (MS) de cada buffer de entrada, economizando 10 ms extra para combinar com o próximo buffer.</span><span class="sxs-lookup"><span data-stu-id="3b18c-200">Suppose that an audio effect transforms all but 10 milliseconds (ms) of each input buffer, saving the extra 10 ms to combine with the next buffer.</span></span> <span data-ttu-id="3b18c-201">Ele obtém um fluxo de exemplos que têm uma duração de 50 ms.</span><span class="sxs-lookup"><span data-stu-id="3b18c-201">It gets a stream of samples that all have a duration of 50 ms.</span></span> <span data-ttu-id="3b18c-202">Os tempos de entrada são mostrados na tabela a seguir.</span><span class="sxs-lookup"><span data-stu-id="3b18c-202">The input times are shown in the following table.</span></span>



| <span data-ttu-id="3b18c-203">Amostra</span><span class="sxs-lookup"><span data-stu-id="3b18c-203">Sample</span></span> | <span data-ttu-id="3b18c-204">Hora de entrada</span><span class="sxs-lookup"><span data-stu-id="3b18c-204">Input time</span></span> | <span data-ttu-id="3b18c-205">Duração da entrada</span><span class="sxs-lookup"><span data-stu-id="3b18c-205">Input duration</span></span> | <span data-ttu-id="3b18c-206">Tempo de saída</span><span class="sxs-lookup"><span data-stu-id="3b18c-206">Output time</span></span> | <span data-ttu-id="3b18c-207">Duração da saída</span><span class="sxs-lookup"><span data-stu-id="3b18c-207">Output duration</span></span> |
|--------|------------|----------------|-------------|-----------------|
| <span data-ttu-id="3b18c-208">1</span><span class="sxs-lookup"><span data-stu-id="3b18c-208">1</span></span>      | <span data-ttu-id="3b18c-209">20</span><span class="sxs-lookup"><span data-stu-id="3b18c-209">20</span></span>         | <span data-ttu-id="3b18c-210">50</span><span class="sxs-lookup"><span data-stu-id="3b18c-210">50</span></span>             | <span data-ttu-id="3b18c-211">20</span><span class="sxs-lookup"><span data-stu-id="3b18c-211">20</span></span>          | <span data-ttu-id="3b18c-212">40</span><span class="sxs-lookup"><span data-stu-id="3b18c-212">40</span></span>              |
| <span data-ttu-id="3b18c-213">2</span><span class="sxs-lookup"><span data-stu-id="3b18c-213">2</span></span>      | <span data-ttu-id="3b18c-214">70</span><span class="sxs-lookup"><span data-stu-id="3b18c-214">70</span></span>         | <span data-ttu-id="3b18c-215">50</span><span class="sxs-lookup"><span data-stu-id="3b18c-215">50</span></span>             | <span data-ttu-id="3b18c-216">60</span><span class="sxs-lookup"><span data-stu-id="3b18c-216">60</span></span>          | <span data-ttu-id="3b18c-217">50</span><span class="sxs-lookup"><span data-stu-id="3b18c-217">50</span></span>              |
| <span data-ttu-id="3b18c-218">3</span><span class="sxs-lookup"><span data-stu-id="3b18c-218">3</span></span>      | <span data-ttu-id="3b18c-219">121</span><span class="sxs-lookup"><span data-stu-id="3b18c-219">121</span></span>        | <span data-ttu-id="3b18c-220">50</span><span class="sxs-lookup"><span data-stu-id="3b18c-220">50</span></span>             | <span data-ttu-id="3b18c-221">110</span><span class="sxs-lookup"><span data-stu-id="3b18c-221">110</span></span>         | <span data-ttu-id="3b18c-222">50</span><span class="sxs-lookup"><span data-stu-id="3b18c-222">50</span></span>              |
| <span data-ttu-id="3b18c-223">4</span><span class="sxs-lookup"><span data-stu-id="3b18c-223">4</span></span>      | <span data-ttu-id="3b18c-224">171</span><span class="sxs-lookup"><span data-stu-id="3b18c-224">171</span></span>        | <span data-ttu-id="3b18c-225">50</span><span class="sxs-lookup"><span data-stu-id="3b18c-225">50</span></span>             | <span data-ttu-id="3b18c-226">161</span><span class="sxs-lookup"><span data-stu-id="3b18c-226">161</span></span>         | <span data-ttu-id="3b18c-227">50</span><span class="sxs-lookup"><span data-stu-id="3b18c-227">50</span></span>              |



 

<span data-ttu-id="3b18c-228">Observe a discrepância de 1-MS entre a duração real da amostra 2 e a duração implícita com base no próximo carimbo de data/hora (121?</span><span class="sxs-lookup"><span data-stu-id="3b18c-228">Note the 1-ms discrepancy between the actual duration of sample 2 and the implied duration based on the next time stamp (121 ?</span></span> <span data-ttu-id="3b18c-229">70 = 51).</span><span class="sxs-lookup"><span data-stu-id="3b18c-229">70 = 51).</span></span>

<span data-ttu-id="3b18c-230">Como a MFT retém 10 ms, ela gera o primeiro 40 MS do exemplo de entrada 1 como exemplo de saída 1, com um carimbo de data/hora de 20 ms e uma duração de 40 MS.</span><span class="sxs-lookup"><span data-stu-id="3b18c-230">Because the MFT holds back 10 ms, it outputs the first 40 ms of input sample 1 as output sample 1, with a time stamp of 20 ms and a duration of 40 ms.</span></span>

<span data-ttu-id="3b18c-231">A amostra de saída 2 combina os 10 ms retidos anteriormente com 40 MS da amostra de entrada 2.</span><span class="sxs-lookup"><span data-stu-id="3b18c-231">Output sample 2 combines the 10 ms previously held back with 40 ms of input sample 2.</span></span> <span data-ttu-id="3b18c-232">Este exemplo recebe um carimbo de data/hora de 60 MS (o carimbo de data/hora do exemplo de entrada anterior, 20 ms, além da duração dos dados já processados desse exemplo, 40ms).</span><span class="sxs-lookup"><span data-stu-id="3b18c-232">This sample is given a time stamp of 60 ms (the time stamp of the previous input sample, 20ms, plus the duration of the data already processed from that sample, 40ms).</span></span> <span data-ttu-id="3b18c-233">Ela recebe uma duração de 50 ms.</span><span class="sxs-lookup"><span data-stu-id="3b18c-233">It is given a duration of 50ms.</span></span>

<span data-ttu-id="3b18c-234">Da mesma forma, o exemplo a seguir tem um carimbo de data/hora de 110ms (70ms + 40ms) com uma duração de 50 ms.</span><span class="sxs-lookup"><span data-stu-id="3b18c-234">Similarly, the next sample has a time stamp of 110ms (70ms + 40ms) with a duration of 50 ms.</span></span>

<span data-ttu-id="3b18c-235">O próximo cálculo é mais interessante.</span><span class="sxs-lookup"><span data-stu-id="3b18c-235">The next calculation is more interesting.</span></span> <span data-ttu-id="3b18c-236">O carimbo de data/hora implícito do tempo de saída anterior e a duração seriam 160 ms (carimbo de data/hora 110 MS + duração 50 ms).</span><span class="sxs-lookup"><span data-stu-id="3b18c-236">The implied time stamp from the previous output time and duration would be 160 ms (time stamp 110 ms + duration 50 ms).</span></span> <span data-ttu-id="3b18c-237">No entanto, o carimbo de data/hora de saída deve ser calculado a partir do carimbo de data/hora de entrada do exemplo de entrada mais antigo que sobrepõe a amostra de saída no tempo, mais o comprimento de todos os dados já processados a partir desse exemplo.</span><span class="sxs-lookup"><span data-stu-id="3b18c-237">However, the output time stamp is supposed to be calculated from the input time stamp of the earliest input sample that overlaps the output sample in time, plus the length of any data already processed from that sample.</span></span> <span data-ttu-id="3b18c-238">A amostra de entrada sobreposta mais próxima é a amostra 4 (carimbo de data/hora = 171), mas essa não é a primeira.</span><span class="sxs-lookup"><span data-stu-id="3b18c-238">The closest overlapping input sample is the sample 4 (time stamp = 171), but this is not the earliest one.</span></span> <span data-ttu-id="3b18c-239">O exemplo mais antigo sobreposto é o exemplo 3 (carimbo de data/hora = 121).</span><span class="sxs-lookup"><span data-stu-id="3b18c-239">The earliest overlapping sample is sample 3 (time stamp = 121).</span></span> <span data-ttu-id="3b18c-240">Adicionar o 40ms que já foi processado desse exemplo, o resultado é 161.</span><span class="sxs-lookup"><span data-stu-id="3b18c-240">Adding the 40ms that has already been processed from that sample, the result is 161.</span></span>

## <a name="related-topics"></a><span data-ttu-id="3b18c-241">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="3b18c-241">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="3b18c-242">Gravando uma MFT personalizada</span><span class="sxs-lookup"><span data-stu-id="3b18c-242">Writing a Custom MFT</span></span>](writing-a-custom-mft.md)
</dt> </dl>

 

 



