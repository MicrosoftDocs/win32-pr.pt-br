---
description: Este tópico descreve como gravar uma MFT (Media Foundation transformação) que atua como um proxy para um codificador de hardware, decodificador ou DSP (processador de sinal digital).
ms.assetid: 9922d403-5d0d-433f-ad9f-c86142ac0f46
title: MFTs de hardware
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ac5ce05b4fdad6040b51f66f543c1737fc3918d2
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104164843"
---
# <a name="hardware-mfts"></a><span data-ttu-id="8add6-103">MFTs de hardware</span><span class="sxs-lookup"><span data-stu-id="8add6-103">Hardware MFTs</span></span>

> [!Note]  
> <span data-ttu-id="8add6-104">Este tópico aplica-se ao Windows 7 ou posterior.</span><span class="sxs-lookup"><span data-stu-id="8add6-104">This topic applies to Windows 7 or later.</span></span>

 

<span data-ttu-id="8add6-105">Este tópico descreve como gravar uma MFT (Media Foundation transformação) que atua como um proxy para um codificador de hardware, decodificador ou DSP (processador de sinal digital).</span><span class="sxs-lookup"><span data-stu-id="8add6-105">This topic describes how to write a Media Foundation transform (MFT) that acts as a proxy to a hardware encoder, decoder, or digital signal processor (DSP).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="8add6-106">Se um codec de hardware usar o driver de classe multimídia AVStream, ele não exigirá uma MFT personalizada.</span><span class="sxs-lookup"><span data-stu-id="8add6-106">If a hardware codec uses the AVStream multimedia class driver, it does not require a custom MFT.</span></span> <span data-ttu-id="8add6-107">Media Foundation fornece um proxy AVStream para essa finalidade.</span><span class="sxs-lookup"><span data-stu-id="8add6-107">Media Foundation provides an AVStream proxy for this purpose.</span></span> <span data-ttu-id="8add6-108">As informações neste tópico aplicam-se somente ao caso especial em que o codec de hardware não usa AVStream.</span><span class="sxs-lookup"><span data-stu-id="8add6-108">The information in this topic applies only in the special case where the hardware codec does not use AVStream.</span></span> <span data-ttu-id="8add6-109">Para obter mais informações, consulte [hardware codec support in AVStream](https://msdn.microsoft.com/library/dd568169.aspx).</span><span class="sxs-lookup"><span data-stu-id="8add6-109">For more information, see [Hardware Codec Support in AVStream](https://msdn.microsoft.com/library/dd568169.aspx).</span></span>

 

<span data-ttu-id="8add6-110">Este tópico contém as seguintes seções:</span><span class="sxs-lookup"><span data-stu-id="8add6-110">This topic contains the following sections:</span></span>

-   [<span data-ttu-id="8add6-111">Introdução</span><span class="sxs-lookup"><span data-stu-id="8add6-111">Introduction</span></span>](#introduction)
-   [<span data-ttu-id="8add6-112">Atributos de MFT de hardware</span><span class="sxs-lookup"><span data-stu-id="8add6-112">Hardware MFT Attributes</span></span>](#hardware-mft-attributes)
-   [<span data-ttu-id="8add6-113">Sequência de handshake de hardware</span><span class="sxs-lookup"><span data-stu-id="8add6-113">Hardware Handshake Sequence</span></span>](#hardware-handshake-sequence)
-   [<span data-ttu-id="8add6-114">Processamento de dados</span><span class="sxs-lookup"><span data-stu-id="8add6-114">Data Processing</span></span>](#data-processing)
-   [<span data-ttu-id="8add6-115">Decodificador/codificador emparelhado</span><span class="sxs-lookup"><span data-stu-id="8add6-115">Paired Decoder/Encoder</span></span>](#paired-decoderencoder)
-   [<span data-ttu-id="8add6-116">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="8add6-116">Related topics</span></span>](#related-topics)

## <a name="introduction"></a><span data-ttu-id="8add6-117">Introdução</span><span class="sxs-lookup"><span data-stu-id="8add6-117">Introduction</span></span>

<span data-ttu-id="8add6-118">Qualquer codec de hardware que não esteja baseado em AVStream deve fornecer seu próprio MFT para atuar como um proxy para o driver.</span><span class="sxs-lookup"><span data-stu-id="8add6-118">Any hardware codec that is not based on AVStream must provide its own MFT to act as a proxy to the driver.</span></span> <span data-ttu-id="8add6-119">Um codec de hardware pode incorporar vários blocos funcionais distintos:</span><span class="sxs-lookup"><span data-stu-id="8add6-119">A hardware codec might incorporate several distinct functional blocks:</span></span>

-   <span data-ttu-id="8add6-120">Codificador</span><span class="sxs-lookup"><span data-stu-id="8add6-120">Encoder</span></span>
-   <span data-ttu-id="8add6-121">Decodificador</span><span class="sxs-lookup"><span data-stu-id="8add6-121">Decoder</span></span>
-   <span data-ttu-id="8add6-122">Escala de quadros/conversão de formato</span><span class="sxs-lookup"><span data-stu-id="8add6-122">Frame scaling/format conversion</span></span>

<span data-ttu-id="8add6-123">Cada uma dessas funções deve ser gerenciada por um MFT separado.</span><span class="sxs-lookup"><span data-stu-id="8add6-123">Each of these functions should be managed by a separate MFT.</span></span> <span data-ttu-id="8add6-124">Um MFT de hardware nunca deve atuar como um "transcodificador" multipropósito.</span><span class="sxs-lookup"><span data-stu-id="8add6-124">A hardware MFT should never act as a multi-purpose "transcoder."</span></span> <span data-ttu-id="8add6-125">Em vez disso, coloque funções de codificação em um MFT do codificador e decodifique funções em um MFT do decodificador.</span><span class="sxs-lookup"><span data-stu-id="8add6-125">Instead, put encoding functions into an encoder MFT and decoding functions into a decoder MFT.</span></span> <span data-ttu-id="8add6-126">Se o hardware oferecer conversões de formato e dimensionamento de quadros, coloque essas funções em um processador de vídeo separado, registrado na categoria MFT, na categoria do **\_ \_ \_ processador de vídeo** .</span><span class="sxs-lookup"><span data-stu-id="8add6-126">If the hardware offers frame scaling and format conversions, place those functions in a separate video processor, registered in the **MFT\_CATEGORY\_VIDEO\_PROCESSOR** category.</span></span> <span data-ttu-id="8add6-127">Se o hardware não oferecer suporte à escala de quadros ou à conversão de formato, Media Foundation fornecerá um processador de vídeo de software.</span><span class="sxs-lookup"><span data-stu-id="8add6-127">If the hardware does not support frame scaling or format conversion, Media Foundation provides a software video processor.</span></span>

<span data-ttu-id="8add6-128">Os MFTs de hardware têm os seguintes requisitos gerais:</span><span class="sxs-lookup"><span data-stu-id="8add6-128">Hardware MFTs have the following general requirements:</span></span>

-   <span data-ttu-id="8add6-129">Os MFTs de hardware devem usar o novo modelo de processamento assíncrono, conforme descrito em [MFTs assíncrona](asynchronous-mfts.md).</span><span class="sxs-lookup"><span data-stu-id="8add6-129">Hardware MFTs must use the new asynchronous processing model, as described in [Asynchronous MFTs](asynchronous-mfts.md).</span></span>
-   <span data-ttu-id="8add6-130">O hardware MFTs deve dar suporte a alterações de formato dinâmico, conforme descrito em [alterações de formato dinâmico](basic-mft-processing-model.md).</span><span class="sxs-lookup"><span data-stu-id="8add6-130">Hardware MFTs must support dynamic format changes, as described in [Dynamic Format Changes](basic-mft-processing-model.md).</span></span>

## <a name="hardware-mft-attributes"></a><span data-ttu-id="8add6-131">Atributos de MFT de hardware</span><span class="sxs-lookup"><span data-stu-id="8add6-131">Hardware MFT Attributes</span></span>

<span data-ttu-id="8add6-132">Um MFT de hardware deve implementar os seguintes métodos relacionados a atributos:</span><span class="sxs-lookup"><span data-stu-id="8add6-132">A hardware MFT must implement following methods related to attributes:</span></span>

-   <span data-ttu-id="8add6-133">[**IMFTransform:: GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes): retorna um repositório de atributos para atributos MFT globais.</span><span class="sxs-lookup"><span data-stu-id="8add6-133">[**IMFTransform::GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes): Returns an attribute store for global MFT attributes.</span></span>
-   <span data-ttu-id="8add6-134">[**IMFTransform:: GetInputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreamattributes): retorna um repositório de atributos para um fluxo de entrada.</span><span class="sxs-lookup"><span data-stu-id="8add6-134">[**IMFTransform::GetInputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreamattributes): Returns an attribute store for an input stream.</span></span>
-   <span data-ttu-id="8add6-135">[**IMFTransform:: GetOutputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreamattributes): retorna um repositório de atributos para um fluxo de saída.</span><span class="sxs-lookup"><span data-stu-id="8add6-135">[**IMFTransform::GetOutputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreamattributes): Returns an attribute store for an output stream.</span></span>

<span data-ttu-id="8add6-136">Quando o MFT é criado pela primeira vez, ele deve definir os seguintes atributos em seu próprio repositório de atributo global (ou seja, o repositório de atributos retornado por [**GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes)):</span><span class="sxs-lookup"><span data-stu-id="8add6-136">When the MFT is first created, it must set the following attributes on its own global attribute store (that is, the attribute store returned by [**GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes)):</span></span>



| <span data-ttu-id="8add6-137">Atributo</span><span class="sxs-lookup"><span data-stu-id="8add6-137">Attribute</span></span>                                                                                    | <span data-ttu-id="8add6-138">Descrição</span><span class="sxs-lookup"><span data-stu-id="8add6-138">Description</span></span>                                                                                                                                                                            |
|----------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="8add6-139">transformação do MF em \_ \_ Async</span><span class="sxs-lookup"><span data-stu-id="8add6-139">MF\_TRANSFORM\_ASYNC</span></span>](mf-transform-async.md)                                               | <span data-ttu-id="8add6-140">Deve ser definido como **true**.</span><span class="sxs-lookup"><span data-stu-id="8add6-140">Must be set to **TRUE**.</span></span> <span data-ttu-id="8add6-141">Indica que o MFT executa o processamento assíncrono.</span><span class="sxs-lookup"><span data-stu-id="8add6-141">Indicates that the MFT performs asynchronous processing.</span></span>                                                                                                      |
| [<span data-ttu-id="8add6-142">\_Atributo de \_ URL de hardware de enumeração de MFT \_ \_</span><span class="sxs-lookup"><span data-stu-id="8add6-142">MFT\_ENUM\_HARDWARE\_URL\_Attribute</span></span>](mft-enum-hardware-url-attribute.md)                   | <span data-ttu-id="8add6-143">Contém o link simbólico para o dispositivo de hardware.</span><span class="sxs-lookup"><span data-stu-id="8add6-143">Contains the symbolic link for the hardware device.</span></span><br/> <span data-ttu-id="8add6-144">O carregador de topologia usa a presença desse atributo para testar se um MFT representa um dispositivo de hardware.</span><span class="sxs-lookup"><span data-stu-id="8add6-144">The topology loader uses the presence of this attribute to test whether an MFT represents a hardware device.</span></span><br/> |
| [<span data-ttu-id="8add6-145">**o MFT \_ dá suporte à \_ alteração de \_ formato dinâmico \_**</span><span class="sxs-lookup"><span data-stu-id="8add6-145">**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE**</span></span>](mft-support-dynamic-format-change-attribute.md) | <span data-ttu-id="8add6-146">Deve ser definido como **true**.</span><span class="sxs-lookup"><span data-stu-id="8add6-146">Must be set to **TRUE**.</span></span> <span data-ttu-id="8add6-147">Indica que o MFT dá suporte a alterações de formato dinâmico.</span><span class="sxs-lookup"><span data-stu-id="8add6-147">Indicates that the MFT supports dynamic format changes.</span></span>                                                                                                       |



 

## <a name="hardware-handshake-sequence"></a><span data-ttu-id="8add6-148">Sequência de handshake de hardware</span><span class="sxs-lookup"><span data-stu-id="8add6-148">Hardware Handshake Sequence</span></span>

<span data-ttu-id="8add6-149">Se dois MFTs representam o mesmo dispositivo físico, eles podem trocar dados no hardware — por exemplo, em um barramento de hardware.</span><span class="sxs-lookup"><span data-stu-id="8add6-149">If two MFTs represent the same physical device, they can exchange data within the hardware—for example, over a hardware bus.</span></span> <span data-ttu-id="8add6-150">Não é necessário copiar os dados na memória do sistema e, em seguida, voltar para o dispositivo.</span><span class="sxs-lookup"><span data-stu-id="8add6-150">There is no need to copy the data into system memory and then back to the device.</span></span>

<span data-ttu-id="8add6-151">No diagrama a seguir, o MFTs rotulado como "A" e "B" representam blocos funcionais dentro do mesmo hardware.</span><span class="sxs-lookup"><span data-stu-id="8add6-151">In the following diagram, the MFTs labeled "A" and "B" represent functional blocks within the same hardware.</span></span> <span data-ttu-id="8add6-152">Por exemplo, em um cenário de transcodificação, "A" pode representar um decodificador de hardware e "B" pode representar um codificador de hardware.</span><span class="sxs-lookup"><span data-stu-id="8add6-152">For example, in a transcoding scenario, "A" might represent a hardware decoder and "B" might represent a hardware encoder.</span></span> <span data-ttu-id="8add6-153">O fluxo de dados entre "A" e "B" ocorre no hardware.</span><span class="sxs-lookup"><span data-stu-id="8add6-153">The data flow between "A" and "B" occurs within the hardware.</span></span> <span data-ttu-id="8add6-154">O MFT rotulado como "C" é um MFT de software.</span><span class="sxs-lookup"><span data-stu-id="8add6-154">The MFT labeled "C" is a software MFT.</span></span> <span data-ttu-id="8add6-155">O fluxo de dados de "B" para "C" usa a memória do sistema.</span><span class="sxs-lookup"><span data-stu-id="8add6-155">Data flow from "B" to "C" uses system memory.</span></span>

![diagrama mostrando caixas rotuladas a por c e um codec de hardware: um aponta para b e o codec, o codec aponta para b e b aponta para c](images/proxy-mft.png)

<span data-ttu-id="8add6-157">Para estabelecer uma conexão de hardware, os dois MFTs de hardware devem usar um canal de comunicação privada.</span><span class="sxs-lookup"><span data-stu-id="8add6-157">To establish a hardware connection, the two hardware MFTs must use a private communication channel.</span></span> <span data-ttu-id="8add6-158">Essa conexão é estabelecida durante a negociação de formato, antes que os tipos de mídia sejam definidos e antes da primeira chamada para [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span><span class="sxs-lookup"><span data-stu-id="8add6-158">This connection is established during format negotiation, before the media types are set and before the first call to [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span></span> <span data-ttu-id="8add6-159">O processo de conexão funciona da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="8add6-159">The connection process works as follows:</span></span>

1.  <span data-ttu-id="8add6-160">O carregador de topologia verifica ambos os MFTs para a presença do atributo de [atributo de URL de hardware de enumeração de MFT \_ \_ \_ \_ ](mft-enum-hardware-url-attribute.md) .</span><span class="sxs-lookup"><span data-stu-id="8add6-160">The topology loader checks both MFTs for the presence of the [MFT\_ENUM\_HARDWARE\_URL\_Attribute](mft-enum-hardware-url-attribute.md) attribute.</span></span> <span data-ttu-id="8add6-161">Observe que ele não examina o valor desse atributo.</span><span class="sxs-lookup"><span data-stu-id="8add6-161">Note that it does not examine the value of this attribute.</span></span>
2.  <span data-ttu-id="8add6-162">Se [o \_ \_ atributo de \_ URL \_ de hardware de enumeração de MFT](mft-enum-hardware-url-attribute.md) estiver presente em ambos os MFTs, o carregador de topologia fará o seguinte:</span><span class="sxs-lookup"><span data-stu-id="8add6-162">If [MFT\_ENUM\_HARDWARE\_URL\_Attribute](mft-enum-hardware-url-attribute.md) is present on both MFTs, the topology loader does the following:</span></span>
    1.  <span data-ttu-id="8add6-163">O carregador de topologia chama [**IMFTransform:: GetOutputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreamattributes) no MFT upstream (A).</span><span class="sxs-lookup"><span data-stu-id="8add6-163">The topology loader calls [**IMFTransform::GetOutputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreamattributes) on the upstream MFT (A).</span></span> <span data-ttu-id="8add6-164">Esse método retorna um ponteiro [**IMFAttributes**](/windows/desktop/api/mfobjects/nn-mfobjects-imfattributes) .</span><span class="sxs-lookup"><span data-stu-id="8add6-164">This method returns an [**IMFAttributes**](/windows/desktop/api/mfobjects/nn-mfobjects-imfattributes) pointer.</span></span> <span data-ttu-id="8add6-165">Deixe que esse ponteiro seja denotado *pUpstream*.</span><span class="sxs-lookup"><span data-stu-id="8add6-165">Let this pointer be denoted *pUpstream*.</span></span>
    2.  <span data-ttu-id="8add6-166">O carregador de topologia chama [**IMFTransform:: GetInputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreamattributes) no MFT downstream (B).</span><span class="sxs-lookup"><span data-stu-id="8add6-166">The topology loader calls [**IMFTransform::GetInputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreamattributes) on the downstream MFT (B).</span></span> <span data-ttu-id="8add6-167">Essa chamada também retorna um ponteiro [**IMFAttributes**](/windows/desktop/api/mfobjects/nn-mfobjects-imfattributes) .</span><span class="sxs-lookup"><span data-stu-id="8add6-167">This call also returns an [**IMFAttributes**](/windows/desktop/api/mfobjects/nn-mfobjects-imfattributes) pointer.</span></span> <span data-ttu-id="8add6-168">Deixe que esse ponteiro seja denotado *pDownstream*.</span><span class="sxs-lookup"><span data-stu-id="8add6-168">Let this pointer be denoted *pDownstream*.</span></span>
    3.  <span data-ttu-id="8add6-169">O carregador de topologia define o atributo de [atributo de fluxo do MFT \_ \_ \_ conectado](mft-connected-stream-attribute.md) em *PDownstream* chamando [**IMFAttributes:: setunknown**](/windows/desktop/api/mfobjects/nf-mfobjects-imfattributes-setunknown).</span><span class="sxs-lookup"><span data-stu-id="8add6-169">The topology loader sets the [MFT\_CONNECTED\_STREAM\_ATTRIBUTE](mft-connected-stream-attribute.md) attribute on *pDownstream* by calling [**IMFAttributes::SetUnknown**](/windows/desktop/api/mfobjects/nf-mfobjects-imfattributes-setunknown).</span></span> <span data-ttu-id="8add6-170">O valor do atributo é o ponteiro *pUpstream* .</span><span class="sxs-lookup"><span data-stu-id="8add6-170">The value of the attribute is the *pUpstream* pointer.</span></span>
    4.  <span data-ttu-id="8add6-171">O carregador de topologia define [a MFT \_ conectada ao atributo de \_ \_ \_ fluxo de HW](mft-connected-to-hw-stream.md) como **true** em *pDownstream* e *pUpstream*.</span><span class="sxs-lookup"><span data-stu-id="8add6-171">The topology loader sets the [MFT\_CONNECTED\_TO\_HW\_STREAM](mft-connected-to-hw-stream.md) attribute to **TRUE** on both *pDownstream* and *pUpstream*.</span></span>
3.  <span data-ttu-id="8add6-172">Neste ponto, o MFT downstream tem um ponteiro para o armazenamento de atributos do MFT upstream, conforme mostrado no diagrama a seguir.</span><span class="sxs-lookup"><span data-stu-id="8add6-172">At this point, the downstream MFT has a pointer to the upstream MFT's attribute store, as shown in the following diagram.</span></span>

    ![diagrama com cada MFTs apontando para seu fluxo, cada fluxo apontando para seu armazenamento e o armazenamento de entrada com uma linha tracejada para o repositório de saída](images/proxy-mft2.png)

    > [!Note]  
    > <span data-ttu-id="8add6-174">Para maior clareza, esse diagrama mostra os fluxos e os repositórios de atributos como objetos distintos, mas isso não é necessário para a implementação.</span><span class="sxs-lookup"><span data-stu-id="8add6-174">For clarity, this diagram shows the streams and the attribute stores as distinct objects, but that is not required for the implementation.</span></span>

     

4.  <span data-ttu-id="8add6-175">O MFT downstream usa o ponteiro [**IMFAttributes**](/windows/desktop/api/mfobjects/nn-mfobjects-imfattributes) para estabelecer um canal de comunicação privada com o MFT upstream.</span><span class="sxs-lookup"><span data-stu-id="8add6-175">The downstream MFT uses the [**IMFAttributes**](/windows/desktop/api/mfobjects/nn-mfobjects-imfattributes) pointer to establish a private communication channel with the upstream MFT.</span></span> <span data-ttu-id="8add6-176">Como o canal é privado, o mecanismo exato é definido pela implementação.</span><span class="sxs-lookup"><span data-stu-id="8add6-176">Because the channel is private, the exact mechanism is defined by the implementation.</span></span> <span data-ttu-id="8add6-177">Por exemplo, o MFT pode consultar uma interface COM privada.</span><span class="sxs-lookup"><span data-stu-id="8add6-177">For example, the MFT might query for a private COM interface.</span></span>

<span data-ttu-id="8add6-178">Durante a etapa 4, o MFT downstream deve verificar se os dois MFTs compartilham o mesmo dispositivo físico.</span><span class="sxs-lookup"><span data-stu-id="8add6-178">During step 4, the downstream MFT must verify whether the two MFTs share the same physical device.</span></span> <span data-ttu-id="8add6-179">Caso contrário, eles deverão fazer fallback para usar a memória do sistema para o transporte de dados.</span><span class="sxs-lookup"><span data-stu-id="8add6-179">If not, they must fall back to using system memory for data transport.</span></span> <span data-ttu-id="8add6-180">Isso permite que o MFT opere corretamente com MFTs de software e outros dispositivos de hardware.</span><span class="sxs-lookup"><span data-stu-id="8add6-180">This enables the MFT to operate correctly with software MFTs and other hardware devices.</span></span>

<span data-ttu-id="8add6-181">Se o handshake for bem sucedido e os dois MFTs compartilharem um canal de dados privado, eles não usarão o modelo de processamento de dados padrão (descrito na próxima seção) no ponto de conexão.</span><span class="sxs-lookup"><span data-stu-id="8add6-181">If the handshake succeeds and the two MFTs share a private data channel, they do not use the standard data processing model (described in the next section) at the connection point.</span></span> <span data-ttu-id="8add6-182">Especificamente, o MFT downstream não envia eventos [METransformNeedInput](metransformneedinput.md) ; para obter mais detalhes, consulte a próxima seção neste tópico.</span><span class="sxs-lookup"><span data-stu-id="8add6-182">Specifically, the downstream MFT does not send [METransformNeedInput](metransformneedinput.md) events; for more details, refer to the next section in this topic.</span></span>

## <a name="data-processing"></a><span data-ttu-id="8add6-183">Processamento de dados</span><span class="sxs-lookup"><span data-stu-id="8add6-183">Data Processing</span></span>

<span data-ttu-id="8add6-184">Quando um MFT de hardware usa a memória do sistema para o transporte de dados, o processo funciona da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="8add6-184">When a hardware MFT uses system memory for data transport, the process works as follows:</span></span>

1.  <span data-ttu-id="8add6-185">Para solicitar mais entrada, o MFT envia um evento [METransformNeedInput](metransformneedinput.md) .</span><span class="sxs-lookup"><span data-stu-id="8add6-185">To request more input, the MFT sends an [METransformNeedInput](metransformneedinput.md) event.</span></span>
2.  <span data-ttu-id="8add6-186">O evento [METransformNeedInput](metransformneedinput.md) faz com que o pipeline chame [**IMFTransform::P rocessinput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span><span class="sxs-lookup"><span data-stu-id="8add6-186">The [METransformNeedInput](metransformneedinput.md) event causes the pipeline to call [**IMFTransform::ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span></span>
3.  <span data-ttu-id="8add6-187">Quando o MFT tem dados de saída, o MFT envia um evento [METransformHaveOutput](metransformhaveoutput.md) .</span><span class="sxs-lookup"><span data-stu-id="8add6-187">When the MFT has output data, the MFT sends an [METransformHaveOutput](metransformhaveoutput.md) event.</span></span>
4.  <span data-ttu-id="8add6-188">O evento [METransformHaveOutput](metransformhaveoutput.md) faz com que o pipeline chame [**IMFTransform::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="8add6-188">The [METransformHaveOutput](metransformhaveoutput.md) event causes the pipeline to call [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>

<span data-ttu-id="8add6-189">Para obter detalhes, consulte [MFTs assíncrono](asynchronous-mfts.md).</span><span class="sxs-lookup"><span data-stu-id="8add6-189">For details, refer to [Asynchronous MFTs](asynchronous-mfts.md).</span></span>

<span data-ttu-id="8add6-190">No entanto, se o MFT usar um canal de hardware, ele não enviará esses eventos no ponto de conexão de hardware, pois toda a transferência de dados ocorre internamente no hardware.</span><span class="sxs-lookup"><span data-stu-id="8add6-190">If the MFT uses a hardware channel, however, it does not send these events at the hardware connection point, because all data transfer happens internally within the hardware.</span></span> <span data-ttu-id="8add6-191">Portanto, o pipeline não chama [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) ou [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) no ponto de conexão.</span><span class="sxs-lookup"><span data-stu-id="8add6-191">Therefore, the pipeline does not call [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) or [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) at the connection point.</span></span>

<span data-ttu-id="8add6-192">Por exemplo, considere o primeiro diagrama neste tópico.</span><span class="sxs-lookup"><span data-stu-id="8add6-192">For example, consider the first diagram in this topic.</span></span> <span data-ttu-id="8add6-193">Dada essa configuração, o processamento de dados ocorrerá da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="8add6-193">Given this configuration, data processing would occur as follows:</span></span>

1.  <span data-ttu-id="8add6-194">"A" envia [METransformNeedInput](metransformneedinput.md) para dados de solicitação.</span><span class="sxs-lookup"><span data-stu-id="8add6-194">"A" sends [METransformNeedInput](metransformneedinput.md) to request data.</span></span>
2.  <span data-ttu-id="8add6-195">O pipeline chama [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) em "A".</span><span class="sxs-lookup"><span data-stu-id="8add6-195">The pipeline calls [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) on "A".</span></span>
3.  <span data-ttu-id="8add6-196">"A" e "B" processam os dados no hardware.</span><span class="sxs-lookup"><span data-stu-id="8add6-196">"A" and "B" process the data in hardware.</span></span>
4.  <span data-ttu-id="8add6-197">Quando o processamento for concluído, "B" enviará um evento [METransformHaveOutput](metransformhaveoutput.md) .</span><span class="sxs-lookup"><span data-stu-id="8add6-197">When the processing is complete, "B" sends an [METransformHaveOutput](metransformhaveoutput.md) event.</span></span>
5.  <span data-ttu-id="8add6-198">O pipeline chama [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) em "B".</span><span class="sxs-lookup"><span data-stu-id="8add6-198">The pipeline calls [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) on "B".</span></span>

## <a name="paired-decoderencoder"></a><span data-ttu-id="8add6-199">Decodificador/codificador emparelhado</span><span class="sxs-lookup"><span data-stu-id="8add6-199">Paired Decoder/Encoder</span></span>

<span data-ttu-id="8add6-200">Se um decodificador e um codificador estiverem localizados no mesmo chip de hardware, poderá ser preferível usá-los juntos ao transcodificar.</span><span class="sxs-lookup"><span data-stu-id="8add6-200">If a decoder and encoder are located on the same hardware chip, it may be preferable to use them together when transcoding.</span></span> <span data-ttu-id="8add6-201">Ou seja, a seleção de uma deve fazer com que a outra seja selecionada no pipeline de transcodificação.</span><span class="sxs-lookup"><span data-stu-id="8add6-201">That is, selecting one should cause the other to be selected in the transcoding pipeline.</span></span> <span data-ttu-id="8add6-202">Para garantir que os codecs de hardware correspondentes sejam escolhidos, o codec MFTs deve oferecer um tipo de mídia personalizado.</span><span class="sxs-lookup"><span data-stu-id="8add6-202">To ensure that matching hardware codecs are chosen, both codec MFTs should offer a custom media type.</span></span> <span data-ttu-id="8add6-203">Para criar um tipo de mídia personalizado:</span><span class="sxs-lookup"><span data-stu-id="8add6-203">To create a custom media type:</span></span>

-   <span data-ttu-id="8add6-204">Defina o atributo de [**\_ \_ \_ tipo principal MF MT**](mf-mt-major-type-attribute.md) como **MFMediaType \_ Audio** ou **MFMediaType \_ Video**, conforme apropriado.</span><span class="sxs-lookup"><span data-stu-id="8add6-204">Set the [**MF\_MT\_MAJOR\_TYPE**](mf-mt-major-type-attribute.md) attribute to **MFMediaType\_Audio** or **MFMediaType\_Video**, as appropriate.</span></span>
-   <span data-ttu-id="8add6-205">Defina o atributo de [**\_ \_ subtipo MF MT**](mf-mt-subtype-attribute.md) como um valor de GUID personalizado.</span><span class="sxs-lookup"><span data-stu-id="8add6-205">Set the [**MF\_MT\_SUBTYPE**](mf-mt-subtype-attribute.md) attribute to a custom GUID value.</span></span>

<span data-ttu-id="8add6-206">Outros atributos de tipo são opcionais.</span><span class="sxs-lookup"><span data-stu-id="8add6-206">Other type attributes are optional.</span></span> <span data-ttu-id="8add6-207">O decodificador retorna o tipo personalizado de seu [**IMFTransform:: GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype), e o codificador retorna o tipo personalizado do seu método [**IMFTransform:: GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) .</span><span class="sxs-lookup"><span data-stu-id="8add6-207">The decoder returns the custom type from its [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype), and the encoder returns the custom type from its [**IMFTransform::GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) method.</span></span> <span data-ttu-id="8add6-208">Em ambos os casos, o tipo personalizado deve ser a primeira entrada na lista (*dwTypeIndex* = 0).</span><span class="sxs-lookup"><span data-stu-id="8add6-208">In both cases, the custom type must be the first entry in the list (*dwTypeIndex* = 0).</span></span>

<span data-ttu-id="8add6-209">Para trabalhar com codecs de software, o codec também deve retornar pelo menos um formato padrão, como NV12 para vídeo.</span><span class="sxs-lookup"><span data-stu-id="8add6-209">To work with software codecs, the codec should also return at least one standard format, such as NV12 for video.</span></span> <span data-ttu-id="8add6-210">Os formatos padrão devem aparecer após o tipo personalizado (*dwTypeIndex* > 0).</span><span class="sxs-lookup"><span data-stu-id="8add6-210">Standard formats should appear after the custom type (*dwTypeIndex* > 0).</span></span> <span data-ttu-id="8add6-211">Se os dois codecs precisarem ser sempre emparelhados e não puderem interoperar com os codecs de software, o MFTs deverá retornar apenas o formato personalizado e não retornar nenhum formato padrão.</span><span class="sxs-lookup"><span data-stu-id="8add6-211">If the two codecs must always be paired and cannot interoperate with software codecs, the MFTs should return only the custom format and not return any standard formats.</span></span>

> [!Note]  
> <span data-ttu-id="8add6-212">Se um decodificador não retornar nenhum formato padrão, ele não poderá ser usado para reprodução com o [processador de vídeo aprimorado](enhanced-video-renderer.md).</span><span class="sxs-lookup"><span data-stu-id="8add6-212">If a decoder does not return any standard formats, it cannot be used for playback with the [Enhanced Video Renderer](enhanced-video-renderer.md).</span></span> <span data-ttu-id="8add6-213">Nesse caso, ele deve ser registrado como um decodificador somente de transcodificação.</span><span class="sxs-lookup"><span data-stu-id="8add6-213">In that case, it should be registered as a transcode-only decoder.</span></span> <span data-ttu-id="8add6-214">Consulte [decodificadores somente de transcodificação](implementing-a-codec-mft.md).</span><span class="sxs-lookup"><span data-stu-id="8add6-214">See [Transcode-Only Decoders](implementing-a-codec-mft.md).</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="8add6-215">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="8add6-215">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="8add6-216">Gravando uma MFT personalizada</span><span class="sxs-lookup"><span data-stu-id="8add6-216">Writing a Custom MFT</span></span>](writing-a-custom-mft.md)
</dt> <dt>

[<span data-ttu-id="8add6-217">Implementando uma MFT do codec</span><span class="sxs-lookup"><span data-stu-id="8add6-217">Implementing a Codec MFT</span></span>](implementing-a-codec-mft.md)
</dt> <dt>

[<span data-ttu-id="8add6-218">Transformações de Media Foundation</span><span class="sxs-lookup"><span data-stu-id="8add6-218">Media Foundation Transforms</span></span>](media-foundation-transforms.md)
</dt> </dl>

 

 




