---
description: Este tópico descreve como implementar uma fonte de mídia personalizada no Microsoft Media Foundation.
ms.assetid: 82db6f32-ad94-4563-b8bd-8a5072c5b221
title: Gravando uma fonte de mídia personalizada
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8769fa16d4dcbfd3438b66f9a9e78c34274735a5
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/03/2021
ms.locfileid: "105762343"
---
# <a name="writing-a-custom-media-source"></a><span data-ttu-id="62cd8-103">Gravando uma fonte de mídia personalizada</span><span class="sxs-lookup"><span data-stu-id="62cd8-103">Writing a Custom Media Source</span></span>

<span data-ttu-id="62cd8-104">Este tópico descreve como implementar uma fonte de mídia personalizada no Microsoft Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="62cd8-104">This topic describes how to implement a custom media source in Microsoft Media Foundation.</span></span> <span data-ttu-id="62cd8-105">Ele contém as seções a seguir:</span><span class="sxs-lookup"><span data-stu-id="62cd8-105">It contains the following sections:</span></span>

-   [<span data-ttu-id="62cd8-106">Criando o descritor de apresentação</span><span class="sxs-lookup"><span data-stu-id="62cd8-106">Creating the Presentation Descriptor</span></span>](#creating-the-presentation-descriptor)
-   [<span data-ttu-id="62cd8-107">Iniciando a origem da mídia</span><span class="sxs-lookup"><span data-stu-id="62cd8-107">Starting the Media Source</span></span>](#starting-the-media-source)
    -   [<span data-ttu-id="62cd8-108">Atingir</span><span class="sxs-lookup"><span data-stu-id="62cd8-108">Seeking</span></span>](#seeking)
-   [<span data-ttu-id="62cd8-109">Pausando a origem da mídia</span><span class="sxs-lookup"><span data-stu-id="62cd8-109">Pausing the Media Source</span></span>](#pausing-the-media-source)
-   [<span data-ttu-id="62cd8-110">Gerando dados de origem</span><span class="sxs-lookup"><span data-stu-id="62cd8-110">Generating Source Data</span></span>](#generating-source-data)
    -   [<span data-ttu-id="62cd8-111">Solicitações de amostra</span><span class="sxs-lookup"><span data-stu-id="62cd8-111">Sample Requests</span></span>](#sample-requests)
    -   [<span data-ttu-id="62cd8-112">Alocando amostras</span><span class="sxs-lookup"><span data-stu-id="62cd8-112">Allocating Samples</span></span>](#allocating-samples)
    -   [<span data-ttu-id="62cd8-113">Lacunas no fluxo</span><span class="sxs-lookup"><span data-stu-id="62cd8-113">Gaps in the Stream</span></span>](#gaps-in-the-stream)
-   [<span data-ttu-id="62cd8-114">Desligando a origem da mídia</span><span class="sxs-lookup"><span data-stu-id="62cd8-114">Shutting Down the Media Source</span></span>](#shutting-down-the-media-source)
-   [<span data-ttu-id="62cd8-115">Fontes dinâmicas</span><span class="sxs-lookup"><span data-stu-id="62cd8-115">Live Sources</span></span>](#live-sources)
-   [<span data-ttu-id="62cd8-116">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="62cd8-116">Related topics</span></span>](#related-topics)

## <a name="creating-the-presentation-descriptor"></a><span data-ttu-id="62cd8-117">Criando o descritor de apresentação</span><span class="sxs-lookup"><span data-stu-id="62cd8-117">Creating the Presentation Descriptor</span></span>

<span data-ttu-id="62cd8-118">O método [**IMFMediaSource:: CreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-createpresentationdescriptor) retorna uma cópia do descritor de apresentação da origem.</span><span class="sxs-lookup"><span data-stu-id="62cd8-118">The [**IMFMediaSource::CreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-createpresentationdescriptor) method returns a copy of the source's presentation descriptor.</span></span> <span data-ttu-id="62cd8-119">Para criar o descritor de apresentação, você deve saber o número de fluxos no conteúdo de origem e os formatos possíveis de cada fluxo.</span><span class="sxs-lookup"><span data-stu-id="62cd8-119">To create the presentation descriptor, you must know the number of streams in the source content, and the possible formats of each stream.</span></span> <span data-ttu-id="62cd8-120">Para cada fluxo, crie um descritor de fluxo da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="62cd8-120">For each stream, create a stream descriptor as follows:</span></span>

1.  <span data-ttu-id="62cd8-121">Crie uma matriz de tipos de mídia.</span><span class="sxs-lookup"><span data-stu-id="62cd8-121">Create an array of media types.</span></span> <span data-ttu-id="62cd8-122">Cada tipo de mídia na matriz representa um formato possível para o fluxo.</span><span class="sxs-lookup"><span data-stu-id="62cd8-122">Each media type in the array represents a possible format for the stream.</span></span> <span data-ttu-id="62cd8-123">Para obter mais informações sobre como criar tipos de mídia, consulte [tipos de mídia](media-types.md).</span><span class="sxs-lookup"><span data-stu-id="62cd8-123">For more information about creating media types, see [Media Types](media-types.md).</span></span>
2.  <span data-ttu-id="62cd8-124">Chame [**MFCreateStreamDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatestreamdescriptor) para criar o descritor de fluxo.</span><span class="sxs-lookup"><span data-stu-id="62cd8-124">Call [**MFCreateStreamDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatestreamdescriptor) to create the stream descriptor.</span></span> <span data-ttu-id="62cd8-125">Passe a matriz de tipos de mídia.</span><span class="sxs-lookup"><span data-stu-id="62cd8-125">Pass in the array of media types.</span></span> <span data-ttu-id="62cd8-126">A função retorna um ponteiro [**IMFStreamDescriptor**](/windows/desktop/api/mfidl/nn-mfidl-imfstreamdescriptor) .</span><span class="sxs-lookup"><span data-stu-id="62cd8-126">The function returns an [**IMFStreamDescriptor**](/windows/desktop/api/mfidl/nn-mfidl-imfstreamdescriptor) pointer.</span></span>
3.  <span data-ttu-id="62cd8-127">Chame [**IMFStreamDescriptor:: GetMediaTypeHandler**](/windows/desktop/api/mfidl/nf-mfidl-imfstreamdescriptor-getmediatypehandler) para obter o manipulador de tipo de mídia do descritor de fluxo.</span><span class="sxs-lookup"><span data-stu-id="62cd8-127">Call [**IMFStreamDescriptor::GetMediaTypeHandler**](/windows/desktop/api/mfidl/nf-mfidl-imfstreamdescriptor-getmediatypehandler) to get the stream descriptor's media type handler.</span></span>
4.  <span data-ttu-id="62cd8-128">Chame [**IMFMediaTypeHandler:: SetCurrentMediaType**](/windows/desktop/api/mfidl/nf-mfidl-imfmediatypehandler-setcurrentmediatype) para definir o formato de fluxo padrão.</span><span class="sxs-lookup"><span data-stu-id="62cd8-128">Call [**IMFMediaTypeHandler::SetCurrentMediaType**](/windows/desktop/api/mfidl/nf-mfidl-imfmediatypehandler-setcurrentmediatype) to set the default stream format.</span></span> <span data-ttu-id="62cd8-129">Use um dos tipos de mídia que você criou na etapa 1.</span><span class="sxs-lookup"><span data-stu-id="62cd8-129">Use one of the media types that you created in step 1.</span></span> <span data-ttu-id="62cd8-130">Em geral, você deve usar o formato com a qualidade mais alta.</span><span class="sxs-lookup"><span data-stu-id="62cd8-130">Generally, you should use the format with the highest quality.</span></span>
5.  <span data-ttu-id="62cd8-131">Opcionalmente, defina atributos no descritor de fluxo.</span><span class="sxs-lookup"><span data-stu-id="62cd8-131">Optionally, set attributes on the stream descriptor.</span></span> <span data-ttu-id="62cd8-132">Para obter uma lista de atributos que se aplicam aos descritores de fluxo, consulte [atributos de descritor de fluxo](stream-descriptor-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="62cd8-132">For a list of attributes that apply to stream descriptors, see [Stream Descriptor Attributes](stream-descriptor-attributes.md).</span></span>

<span data-ttu-id="62cd8-133">Agora, crie o descritor de apresentação:</span><span class="sxs-lookup"><span data-stu-id="62cd8-133">Now create the presentation descriptor:</span></span>

1.  <span data-ttu-id="62cd8-134">Chame [**MFCreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepresentationdescriptor) e transmita a matriz de descritores de fluxo.</span><span class="sxs-lookup"><span data-stu-id="62cd8-134">Call [**MFCreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepresentationdescriptor) and pass in the array of stream descriptors.</span></span> <span data-ttu-id="62cd8-135">A função retorna um ponteiro [**IMFPresentationDescriptor**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationdescriptor) .</span><span class="sxs-lookup"><span data-stu-id="62cd8-135">The function returns an [**IMFPresentationDescriptor**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationdescriptor) pointer.</span></span>
2.  <span data-ttu-id="62cd8-136">Escolha a seleção de fluxo padrão chamando [**IMFPresentationDescriptor:: SelectStream**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationdescriptor-selectstream) para selecionar um ou mais fluxos.</span><span class="sxs-lookup"><span data-stu-id="62cd8-136">Choose the default stream selection by calling [**IMFPresentationDescriptor::SelectStream**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationdescriptor-selectstream) to select one or more streams.</span></span> <span data-ttu-id="62cd8-137">Pelo menos um fluxo deve ser selecionado na configuração padrão.</span><span class="sxs-lookup"><span data-stu-id="62cd8-137">At least one stream must be selected in the default configuration.</span></span>
3.  <span data-ttu-id="62cd8-138">Opcionalmente, defina atributos no descritor de apresentação.</span><span class="sxs-lookup"><span data-stu-id="62cd8-138">Optionally, set attributes on the presentation descriptor.</span></span> <span data-ttu-id="62cd8-139">Para obter uma lista dos atributos que se aplicam aos descritores de fluxo, consulte [atributos do descritor de apresentação](presentation-descriptor-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="62cd8-139">For a list of attributes that apply to stream descriptors, see [Presentation Descriptor Attributes](presentation-descriptor-attributes.md).</span></span>

<span data-ttu-id="62cd8-140">Você deve criar o descritor de apresentação uma vez, na inicialização ou depois que a origem tiver analisado o suficiente dos dados de origem para determinar o conteúdo.</span><span class="sxs-lookup"><span data-stu-id="62cd8-140">You should create the presentation descriptor once, either at startup or after the source has parsed enough of the source data to determine the contents.</span></span> <span data-ttu-id="62cd8-141">O método [**CreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-createpresentationdescriptor) deve retornar uma cópia do descritor de apresentação.</span><span class="sxs-lookup"><span data-stu-id="62cd8-141">The [**CreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-createpresentationdescriptor) method should return a copy of presentation descriptor.</span></span> <span data-ttu-id="62cd8-142">Para criar a cópia, chame [**IMFPresentationDescriptor:: clone**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationdescriptor-clone).</span><span class="sxs-lookup"><span data-stu-id="62cd8-142">To create the copy, call [**IMFPresentationDescriptor::Clone**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationdescriptor-clone).</span></span> <span data-ttu-id="62cd8-143">Retornar uma cópia impede que o cliente modifique o estado do descritor de apresentação original, como os atributos ou a seleção de fluxo.</span><span class="sxs-lookup"><span data-stu-id="62cd8-143">Returning a copy prevents the client from modifying the state of the original presentation descriptor, such as the attributes or the stream selection.</span></span> <span data-ttu-id="62cd8-144">No entanto, lembre-se de que o **clone** cria uma cópia superficial, de modo que o cliente pode potencialmente modificar os descritores de fluxo subjacentes.</span><span class="sxs-lookup"><span data-stu-id="62cd8-144">However, be aware that **Clone** creates a shallow copy, so the client can potentially modify the underlying stream descriptors.</span></span>

## <a name="starting-the-media-source"></a><span data-ttu-id="62cd8-145">Iniciando a origem da mídia</span><span class="sxs-lookup"><span data-stu-id="62cd8-145">Starting the Media Source</span></span>

<span data-ttu-id="62cd8-146">O método [**IMFMediaSource:: Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) inicia a origem da mídia ou busca uma nova posição.</span><span class="sxs-lookup"><span data-stu-id="62cd8-146">The [**IMFMediaSource::Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method starts the media source or seeks to a new position.</span></span> <span data-ttu-id="62cd8-147">Uma chamada para **Start** faz com que uma *busca* quando o estado anterior fosse pausado ou em execução e uma nova hora de início seja especificada.</span><span class="sxs-lookup"><span data-stu-id="62cd8-147">A call to **Start** causes a *seek* when the previous state was either paused or running, and a new start time is specified.</span></span> <span data-ttu-id="62cd8-148">Caso contrário, o método **Start** causará um *início*.</span><span class="sxs-lookup"><span data-stu-id="62cd8-148">Otherwise, the **Start** method causes a *start*.</span></span> <span data-ttu-id="62cd8-149">Quando a operação de **inicialização** for concluída, envie os eventos a seguir.</span><span class="sxs-lookup"><span data-stu-id="62cd8-149">When the **Start** operation completes, send the following events.</span></span>

1.  <span data-ttu-id="62cd8-150">Envie um evento [MENewStream](menewstream.md) para cada novo fluxo — ou seja, cada fluxo que foi previamente desmarcado e agora está selecionado.</span><span class="sxs-lookup"><span data-stu-id="62cd8-150">Send an [MENewStream](menewstream.md) event for each new stream—that is, each stream that was previously deselected and is now selected.</span></span> <span data-ttu-id="62cd8-151">Os dados do evento são um ponteiro para o fluxo.</span><span class="sxs-lookup"><span data-stu-id="62cd8-151">The event data is a pointer to the stream.</span></span>
2.  <span data-ttu-id="62cd8-152">Envie um evento [MEUpdatedStream](meupdatedstream.md) para cada fluxo que foi selecionado anteriormente e ainda está selecionado.</span><span class="sxs-lookup"><span data-stu-id="62cd8-152">Send an [MEUpdatedStream](meupdatedstream.md) event for each stream that was previously selected and is still selected.</span></span> <span data-ttu-id="62cd8-153">Os dados do evento são um ponteiro para o fluxo.</span><span class="sxs-lookup"><span data-stu-id="62cd8-153">The event data is a pointer to the stream.</span></span> <span data-ttu-id="62cd8-154">(Não envie um evento para fluxos desmarcados.)</span><span class="sxs-lookup"><span data-stu-id="62cd8-154">(Do not send an event for deselected streams.)</span></span>
3.  <span data-ttu-id="62cd8-155">Se a origem estiver procurando, envie um evento [MESourceSeeked](mesourceseeked.md) .</span><span class="sxs-lookup"><span data-stu-id="62cd8-155">If the source is seeking, send an [MESourceSeeked](mesourceseeked.md) event.</span></span> <span data-ttu-id="62cd8-156">Caso contrário, envie um evento [MESourceStarted](mesourcestarted.md) .</span><span class="sxs-lookup"><span data-stu-id="62cd8-156">Otherwise, send an [MESourceStarted](mesourcestarted.md) event.</span></span> <span data-ttu-id="62cd8-157">Os dados do evento são a hora de início que foi especificada no método [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) .</span><span class="sxs-lookup"><span data-stu-id="62cd8-157">The event data is the start time that was specified in the [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method.</span></span> <span data-ttu-id="62cd8-158">Para o evento MESourceStarted, se a hora de início for VT \_ Empty, defina o atributo de [**\_ \_ \_ \_ início real da origem do evento MF**](mf-event-source-actual-start-attribute.md) no evento.</span><span class="sxs-lookup"><span data-stu-id="62cd8-158">For the MESourceStarted event, if the start time is VT\_EMPTY, set the [**MF\_EVENT\_SOURCE\_ACTUAL\_START**](mf-event-source-actual-start-attribute.md) attribute on the event.</span></span> <span data-ttu-id="62cd8-159">O valor do atributo é a hora de início real.</span><span class="sxs-lookup"><span data-stu-id="62cd8-159">The attribute value is the actual start time.</span></span>
4.  <span data-ttu-id="62cd8-160">Para cada fluxo, se a origem estiver procurando, envie um evento [MEStreamSeeked](mestreamseeked.md) .</span><span class="sxs-lookup"><span data-stu-id="62cd8-160">For each stream, if the source is seeking, send an [MEStreamSeeked](mestreamseeked.md) event.</span></span> <span data-ttu-id="62cd8-161">Caso contrário, envie um evento [MEStreamStarted](mestreamstarted.md) .</span><span class="sxs-lookup"><span data-stu-id="62cd8-161">Otherwise, send an [MEStreamStarted](mestreamstarted.md) event.</span></span> <span data-ttu-id="62cd8-162">Os dados do evento são a hora de início.</span><span class="sxs-lookup"><span data-stu-id="62cd8-162">The event data is the start time.</span></span> <span data-ttu-id="62cd8-163">(A origem da mídia pode enfileirar um evento no fluxo chamando o método [**IMFMediaEventGenerator:: QueueEvent**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-queueevent) do fluxo.)</span><span class="sxs-lookup"><span data-stu-id="62cd8-163">(The media source can queue an event on the stream by calling the stream's [**IMFMediaEventGenerator::QueueEvent**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-queueevent) method.)</span></span>

<span data-ttu-id="62cd8-164">Quando um fluxo é desmarcado, desligue o fluxo.</span><span class="sxs-lookup"><span data-stu-id="62cd8-164">When a stream is deselected, shut down the stream.</span></span> <span data-ttu-id="62cd8-165">O fluxo não deve enfileirar nenhum outro evento nesse ponto.</span><span class="sxs-lookup"><span data-stu-id="62cd8-165">The stream should not queue any more events at that point.</span></span>

<span data-ttu-id="62cd8-166">O formato de hora para o método [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) é fornecido no parâmetro *pguidTimeFormat* .</span><span class="sxs-lookup"><span data-stu-id="62cd8-166">The time format for the [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method is given in the *pguidTimeFormat* parameter.</span></span> <span data-ttu-id="62cd8-167">O formato de hora padrão, indicado por **GUID \_ NULL**, é unidades de 100 nanossegundos.</span><span class="sxs-lookup"><span data-stu-id="62cd8-167">The standard time format, indicated by **GUID\_NULL**, is 100-nanosecond units.</span></span> <span data-ttu-id="62cd8-168">Uma origem de mídia deve dar suporte a esse formato de hora.</span><span class="sxs-lookup"><span data-stu-id="62cd8-168">A media source must support this time format.</span></span>

### <a name="seeking"></a><span data-ttu-id="62cd8-169">Atingir</span><span class="sxs-lookup"><span data-stu-id="62cd8-169">Seeking</span></span>

<span data-ttu-id="62cd8-170">Ao procurar, a posição inicial solicitada pode não estar em um limite de amostra exato.</span><span class="sxs-lookup"><span data-stu-id="62cd8-170">When seeking, the requested start position might not fall on an exact sample boundary.</span></span> <span data-ttu-id="62cd8-171">Além disso, para conteúdo compactado, a posição inicial pode ficar entre os quadros-chave.</span><span class="sxs-lookup"><span data-stu-id="62cd8-171">Also, for compressed content, the start position might fall between key frames.</span></span> <span data-ttu-id="62cd8-172">Um fluxo deve fornecer exemplos do ponto mais antigo necessário para produzir uma amostra não compactada na posição inicial solicitada.</span><span class="sxs-lookup"><span data-stu-id="62cd8-172">A stream should deliver samples from the earliest point needed to produce an uncompressed sample at the requested start position.</span></span> <span data-ttu-id="62cd8-173">Para vídeo, isso significa iniciar a partir do quadro de chave anterior.</span><span class="sxs-lookup"><span data-stu-id="62cd8-173">For video, that means starting from the previous key frame.</span></span> <span data-ttu-id="62cd8-174">O pipeline é responsável por remover os quadros extras do decodificador, para que a reprodução comece no horário solicitado.</span><span class="sxs-lookup"><span data-stu-id="62cd8-174">The pipeline is responsible for dropping the extra frames from the decoder, so that playback starts at the requested time.</span></span>

<span data-ttu-id="62cd8-175">A hora de início fornecida nos eventos de origem ([MESourceStarted](mesourcestarted.md), [MESourceSeeked](mesourceseeked.md), [MEStreamStarted](mestreamstarted.md)e [MEStreamSeeked](mestreamseeked.md)) é a hora de início solicitada (o valor fornecido no método [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) ), independentemente da posição inicial real.</span><span class="sxs-lookup"><span data-stu-id="62cd8-175">The starting time given in the source events ([MESourceStarted](mesourcestarted.md), [MESourceSeeked](mesourceseeked.md), [MEStreamStarted](mestreamstarted.md), and [MEStreamSeeked](mestreamseeked.md)) is the requested starting time (the value given in the [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method), regardless of the actual start position.</span></span>

<span data-ttu-id="62cd8-176">Por exemplo, suponha que os primeiros quadros de um fluxo de vídeo tenham as seguintes características:</span><span class="sxs-lookup"><span data-stu-id="62cd8-176">For example, suppose the first few frames of a video stream have the following characteristics:</span></span>



| <span data-ttu-id="62cd8-177">Amostra</span><span class="sxs-lookup"><span data-stu-id="62cd8-177">Sample</span></span>     | <span data-ttu-id="62cd8-178">1</span><span class="sxs-lookup"><span data-stu-id="62cd8-178">1</span></span>       | <span data-ttu-id="62cd8-179">2</span><span class="sxs-lookup"><span data-stu-id="62cd8-179">2</span></span>       | <span data-ttu-id="62cd8-180">3</span><span class="sxs-lookup"><span data-stu-id="62cd8-180">3</span></span>        | <span data-ttu-id="62cd8-181">4</span><span class="sxs-lookup"><span data-stu-id="62cd8-181">4</span></span>        |
|------------|---------|---------|----------|----------|
| <span data-ttu-id="62cd8-182">Hora</span><span class="sxs-lookup"><span data-stu-id="62cd8-182">Time</span></span>       | <span data-ttu-id="62cd8-183">33 MS</span><span class="sxs-lookup"><span data-stu-id="62cd8-183">33 msec</span></span> | <span data-ttu-id="62cd8-184">66 MS</span><span class="sxs-lookup"><span data-stu-id="62cd8-184">66 msec</span></span> | <span data-ttu-id="62cd8-185">100 ms</span><span class="sxs-lookup"><span data-stu-id="62cd8-185">100 msec</span></span> | <span data-ttu-id="62cd8-186">133 MS</span><span class="sxs-lookup"><span data-stu-id="62cd8-186">133 msec</span></span> |
| <span data-ttu-id="62cd8-187">Quadro-chave?</span><span class="sxs-lookup"><span data-stu-id="62cd8-187">Key frame?</span></span> | <span data-ttu-id="62cd8-188">Sim</span><span class="sxs-lookup"><span data-stu-id="62cd8-188">Yes</span></span>     | <span data-ttu-id="62cd8-189">Não</span><span class="sxs-lookup"><span data-stu-id="62cd8-189">No</span></span>      | <span data-ttu-id="62cd8-190">Não</span><span class="sxs-lookup"><span data-stu-id="62cd8-190">No</span></span>       | <span data-ttu-id="62cd8-191">Sim</span><span class="sxs-lookup"><span data-stu-id="62cd8-191">Yes</span></span>      |



 

<span data-ttu-id="62cd8-192">Se o método [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) for chamado com um valor de 100 milissegundos, a origem precisará gerar um vídeo a partir do quadro 1, o primeiro quadro-chave antes dessa hora.</span><span class="sxs-lookup"><span data-stu-id="62cd8-192">If the [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method is called with a value of 100 milliseconds, the source needs to output video starting from frame 1, the first key frame prior to this time.</span></span> <span data-ttu-id="62cd8-193">O evento iniciar ainda indicará 100 milissegundos nos dados do evento.</span><span class="sxs-lookup"><span data-stu-id="62cd8-193">The start event will still indicate 100 milliseconds in the event data.</span></span>

## <a name="pausing-the-media-source"></a><span data-ttu-id="62cd8-194">Pausando a origem da mídia</span><span class="sxs-lookup"><span data-stu-id="62cd8-194">Pausing the Media Source</span></span>

<span data-ttu-id="62cd8-195">O método [**IMFMediaSource::P ause**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-pause) faz uma pausa na origem da mídia.</span><span class="sxs-lookup"><span data-stu-id="62cd8-195">The [**IMFMediaSource::Pause**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-pause) method pauses the media source.</span></span>

<span data-ttu-id="62cd8-196">Enquanto a origem é pausada, um fluxo pode criar novos exemplos e armazená-los em uma fila, mas o fluxo não fornece os exemplos.</span><span class="sxs-lookup"><span data-stu-id="62cd8-196">While the source is paused, a stream can create new samples and store them on a queue, but the stream does not deliver the samples.</span></span> <span data-ttu-id="62cd8-197">Aqui estão algumas exceções a essa regra:</span><span class="sxs-lookup"><span data-stu-id="62cd8-197">Here are some exceptions to this rule:</span></span>

-   <span data-ttu-id="62cd8-198">As fontes dinâmicas devem descartar os dados enquanto estiverem em pausa.</span><span class="sxs-lookup"><span data-stu-id="62cd8-198">Live sources should drop data while paused.</span></span>
-   <span data-ttu-id="62cd8-199">Se a origem obtém dados de uma rede, ele pode pausar o servidor.</span><span class="sxs-lookup"><span data-stu-id="62cd8-199">If the source gets data from a network, it might pause the server.</span></span>

<span data-ttu-id="62cd8-200">Se o cliente chamar [**IMFMediaStream:: RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) enquanto a origem estiver pausada, a solicitação também será enfileirada até que a origem seja iniciada novamente.</span><span class="sxs-lookup"><span data-stu-id="62cd8-200">If the client calls [**IMFMediaStream::RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) while the source is paused, the request is also queued until the source is started again.</span></span> <span data-ttu-id="62cd8-201">As solicitações não devem ser descartadas.</span><span class="sxs-lookup"><span data-stu-id="62cd8-201">Requests should not be dropped.</span></span>

<span data-ttu-id="62cd8-202">A pausa só é permitida a partir do estado iniciado.</span><span class="sxs-lookup"><span data-stu-id="62cd8-202">Pausing is allowed only from the started state.</span></span> <span data-ttu-id="62cd8-203">Caso contrário, [**Pause**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-pause) deve retornar **MF \_ E \_ \_ \_ transição de estado inválida**.</span><span class="sxs-lookup"><span data-stu-id="62cd8-203">Otherwise, [**Pause**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-pause) should return **MF\_E\_INVALID\_STATE\_TRANSITION**.</span></span>

## <a name="generating-source-data"></a><span data-ttu-id="62cd8-204">Gerando dados de origem</span><span class="sxs-lookup"><span data-stu-id="62cd8-204">Generating Source Data</span></span>

<span data-ttu-id="62cd8-205">Media Foundation usa um *modelo de pull*, o que significa que os fluxos geram e entregam amostras em resposta a solicitações do pipeline.</span><span class="sxs-lookup"><span data-stu-id="62cd8-205">Media Foundation uses a *pull model*, meaning that streams generate and deliver samples in response to requests from the pipeline.</span></span> <span data-ttu-id="62cd8-206">Um fluxo pode fornecer exemplos quando a origem da mídia está em execução e o fluxo é selecionado.</span><span class="sxs-lookup"><span data-stu-id="62cd8-206">A stream can deliver samples when the media source is running and the stream is selected.</span></span> <span data-ttu-id="62cd8-207">Um fluxo só fornece dados quando o cliente solicita um novo exemplo.</span><span class="sxs-lookup"><span data-stu-id="62cd8-207">A stream delivers data only when the client requests a new sample.</span></span>

### <a name="sample-requests"></a><span data-ttu-id="62cd8-208">Solicitações de Amostra</span><span class="sxs-lookup"><span data-stu-id="62cd8-208">Sample Requests</span></span>

<span data-ttu-id="62cd8-209">O cliente solicita um novo exemplo chamando [**IMFMediaStream:: RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span><span class="sxs-lookup"><span data-stu-id="62cd8-209">The client requests a new sample by calling [**IMFMediaStream::RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span></span> <span data-ttu-id="62cd8-210">Aqui está a sequência de operações:</span><span class="sxs-lookup"><span data-stu-id="62cd8-210">Here is the sequence of operations:</span></span>

1.  <span data-ttu-id="62cd8-211">O cliente chama [**IMFMediaStream:: RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span><span class="sxs-lookup"><span data-stu-id="62cd8-211">The client calls [**IMFMediaStream::RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span></span> <span data-ttu-id="62cd8-212">O argumento é um ponteiro para um objeto de *token* opcional que o cliente usa para rastrear a solicitação.</span><span class="sxs-lookup"><span data-stu-id="62cd8-212">The argument is a pointer to an optional *token* object that the client uses to track the request.</span></span> <span data-ttu-id="62cd8-213">O cliente implementa o token.</span><span class="sxs-lookup"><span data-stu-id="62cd8-213">The client implements the token.</span></span> <span data-ttu-id="62cd8-214">Os tokens devem expor a interface **IUnknown** .</span><span class="sxs-lookup"><span data-stu-id="62cd8-214">Tokens must expose the **IUnknown** interface.</span></span> <span data-ttu-id="62cd8-215">O cliente também pode passar um ponteiro nulo em vez de um token.</span><span class="sxs-lookup"><span data-stu-id="62cd8-215">The client can also pass in a NULL pointer instead of a token.</span></span>
2.  <span data-ttu-id="62cd8-216">Se o cliente forneceu um token, o fluxo de mídia chama **AddRef** no token e coloca o token em uma fila primeiro a entrar, primeiro a sair.</span><span class="sxs-lookup"><span data-stu-id="62cd8-216">If the client provided a token, the media stream calls **AddRef** on the token and places the token in a first-in, first-out queue.</span></span> <span data-ttu-id="62cd8-217">O método retorna, e as etapas restantes ocorrem de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="62cd8-217">The method returns, and the remaining steps occur asynchronously.</span></span>

3.  <span data-ttu-id="62cd8-218">Quando mais dados estiverem disponíveis, o fluxo de mídia criará um novo exemplo.</span><span class="sxs-lookup"><span data-stu-id="62cd8-218">When more data is available, the media stream creates a new sample.</span></span> <span data-ttu-id="62cd8-219">(Essa etapa é descrita mais detalhadamente na próxima seção.)</span><span class="sxs-lookup"><span data-stu-id="62cd8-219">(This step is described in more detail in the next section.)</span></span>
4.  <span data-ttu-id="62cd8-220">O fluxo de mídia efetua pull do primeiro token da fila.</span><span class="sxs-lookup"><span data-stu-id="62cd8-220">The media stream pulls the first token from the queue.</span></span>
5.  <span data-ttu-id="62cd8-221">Se o token não for **nulo**, o fluxo de mídia definirá o atributo de [**\_ token MFSampleExtension**](mfsampleextension-token-attribute.md) no exemplo de mídia.</span><span class="sxs-lookup"><span data-stu-id="62cd8-221">If the token is not **NULL**, the media stream sets the [**MFSampleExtension\_Token**](mfsampleextension-token-attribute.md) attribute on the media sample.</span></span> <span data-ttu-id="62cd8-222">O valor do atributo é um ponteiro para o token.</span><span class="sxs-lookup"><span data-stu-id="62cd8-222">The value of the attribute is a pointer to the token.</span></span>
6.  <span data-ttu-id="62cd8-223">O fluxo de mídia envia um evento [MEMediaSample](memediasample.md) .</span><span class="sxs-lookup"><span data-stu-id="62cd8-223">The media stream sends an [MEMediaSample](memediasample.md) event.</span></span> <span data-ttu-id="62cd8-224">Os dados do evento são um ponteiro para a interface [**IMFSample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) do exemplo.</span><span class="sxs-lookup"><span data-stu-id="62cd8-224">The event data is a pointer to the sample's [**IMFSample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) interface.</span></span>
7.  <span data-ttu-id="62cd8-225">Se o cliente forneceu um token, o fluxo de mídia chama a **versão** no objeto de token.</span><span class="sxs-lookup"><span data-stu-id="62cd8-225">If the client provided a token, the media stream calls **Release** on the token object.</span></span>

<span data-ttu-id="62cd8-226">Se o fluxo de mídia não puder atender à solicitação de [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) do cliente, ele extrairá o token da fila e chamará a **versão** no token, mas não enviará um evento [MEMediaSample](memediasample.md) .</span><span class="sxs-lookup"><span data-stu-id="62cd8-226">If the media stream cannot fulfill the client's [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) request, it pulls the token from the queue and calls **Release** on the token, but does not send an [MEMediaSample](memediasample.md) event.</span></span>

<span data-ttu-id="62cd8-227">O cliente pode usar o token para acompanhar o status da solicitação.</span><span class="sxs-lookup"><span data-stu-id="62cd8-227">The client can use the token to track the status of the request.</span></span> <span data-ttu-id="62cd8-228">Quando o cliente recebe o evento [MEMediaSample](memediasample.md) , ele pode obter o token do exemplo e fazer a correspondência com a solicitação original.</span><span class="sxs-lookup"><span data-stu-id="62cd8-228">When the client receives the [MEMediaSample](memediasample.md) event, it can get the token from the sample and match it against the original request.</span></span> <span data-ttu-id="62cd8-229">O cliente também pode usar o token para detectar se a origem da mídia descartou a solicitação.</span><span class="sxs-lookup"><span data-stu-id="62cd8-229">The client can also use the token to detect if the media source dropped the request.</span></span> <span data-ttu-id="62cd8-230">Se a contagem de referência do token cair em zero e o fluxo de mídia não enviar um evento MEMediaSample, isso significa que a solicitação foi cancelada.</span><span class="sxs-lookup"><span data-stu-id="62cd8-230">If the token's reference count falls to zero and the media stream does not send an MEMediaSample event, it means that the request was dropped.</span></span>

<span data-ttu-id="62cd8-231">As etapas listadas aqui pressupõem que o método [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) seja implementado como uma operação assíncrona.</span><span class="sxs-lookup"><span data-stu-id="62cd8-231">The steps listed here assume that [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) method is implemented as an asynchronous operation.</span></span> <span data-ttu-id="62cd8-232">Se o método for síncrono, você não precisará colocar o token de solicitação em uma fila.</span><span class="sxs-lookup"><span data-stu-id="62cd8-232">If the method is synchronous, you do not need to put the request token on a queue.</span></span> <span data-ttu-id="62cd8-233">No entanto, se a geração de dados levar qualquer quantidade significativa de tempo, uma abordagem assíncrona será recomendada, por exemplo, se a origem ler dados de um fluxo de bytes.</span><span class="sxs-lookup"><span data-stu-id="62cd8-233">However, if generating data takes any significant amount of time, an asynchronous approach is recommended—for example, if the source reads data from a byte stream.</span></span>

<span data-ttu-id="62cd8-234">O fluxo é responsável por armazenar em buffer todos os dados que são acumulados entre chamadas para [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span><span class="sxs-lookup"><span data-stu-id="62cd8-234">The stream is responsible for buffering any data that accumulates between calls to [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span></span>

<span data-ttu-id="62cd8-235">Quando o fluxo de mídia atingir o final do fluxo, ele enviará um evento [MEEndOfStream](meendofstream.md) após o último exemplo.</span><span class="sxs-lookup"><span data-stu-id="62cd8-235">When the media stream reaches the end of the stream, it sends an [MEEndOfStream](meendofstream.md) event after the last sample.</span></span> <span data-ttu-id="62cd8-236">Após a finalização de cada fluxo, a origem da mídia envia um evento [MEEndOfPresentation](meendofpresentation.md) .</span><span class="sxs-lookup"><span data-stu-id="62cd8-236">After every stream has ended, the media source sends an [MEEndOfPresentation](meendofpresentation.md) event.</span></span> <span data-ttu-id="62cd8-237">Depois que um fluxo de mídia envia o evento MEEndOfStream, o método [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) retorna **MF \_ E \_ end \_ of \_ Stream** até que a origem seja reiniciada.</span><span class="sxs-lookup"><span data-stu-id="62cd8-237">After a media stream sends the MEEndOfStream event, the [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) method returns **MF\_E\_END\_OF\_STREAM** until the source is restarted.</span></span>

### <a name="allocating-samples"></a><span data-ttu-id="62cd8-238">Alocando amostras</span><span class="sxs-lookup"><span data-stu-id="62cd8-238">Allocating Samples</span></span>

<span data-ttu-id="62cd8-239">Quando o fluxo está pronto para preencher uma solicitação de exemplo pendente, ele cria um novo exemplo e adiciona um ou mais buffers de mídia ao exemplo.</span><span class="sxs-lookup"><span data-stu-id="62cd8-239">When the stream is ready to fill a pending sample request, it creates a new sample and adds one or more media buffers to the sample.</span></span> <span data-ttu-id="62cd8-240">Para obter mais informações sobre como criar buffers de mídia, consulte [buffers de mídia](media-buffers.md).</span><span class="sxs-lookup"><span data-stu-id="62cd8-240">For more information about creating media buffers, see [Media Buffers](media-buffers.md).</span></span>

<span data-ttu-id="62cd8-241">O fluxo deve definir o carimbo de data/hora e a duração, se conhecido.</span><span class="sxs-lookup"><span data-stu-id="62cd8-241">The stream must set the time stamp and the duration, if known.</span></span> <span data-ttu-id="62cd8-242">O carimbo de data/hora é relativo à origem.</span><span class="sxs-lookup"><span data-stu-id="62cd8-242">The time stamp is relative to the source.</span></span> <span data-ttu-id="62cd8-243">Na maioria dos casos, o início do conteúdo corresponde a um carimbo de data/hora igual a zero.</span><span class="sxs-lookup"><span data-stu-id="62cd8-243">In most cases, the start of the content corresponds to a time stamp of zero.</span></span> <span data-ttu-id="62cd8-244">Por exemplo, se a origem lê de um arquivo de mídia, o início do arquivo teria um carimbo de data/hora igual a zero.</span><span class="sxs-lookup"><span data-stu-id="62cd8-244">For example, if the source reads from a media file, the start of the file would have a time stamp of zero.</span></span>

<span data-ttu-id="62cd8-245">O carimbo de data/hora no exemplo não é necessariamente igual ao tempo de apresentação.</span><span class="sxs-lookup"><span data-stu-id="62cd8-245">The time stamp on the sample does not necessarily equal the presentation time.</span></span> <span data-ttu-id="62cd8-246">A sessão de mídia é traduzida do tempo de origem para o tempo de apresentação.</span><span class="sxs-lookup"><span data-stu-id="62cd8-246">The Media Session translates from source time to presentation time.</span></span> <span data-ttu-id="62cd8-247">Para dados compactados, o fluxo deve gerar dados a partir do quadro de chave mais próximo antes da hora de início.</span><span class="sxs-lookup"><span data-stu-id="62cd8-247">For compressed data, the stream should generate data starting from the nearest key frame before the start time.</span></span> <span data-ttu-id="62cd8-248">Isso permite que o decodificador entregue o quadro que aparece na hora de início solicitada.</span><span class="sxs-lookup"><span data-stu-id="62cd8-248">This enables the decoder to deliver the frame that appears at the requested start time.</span></span> <span data-ttu-id="62cd8-249">(Caso contrário, o decodificador precisaria aguardar até o quadro-chave a seguir.)</span><span class="sxs-lookup"><span data-stu-id="62cd8-249">(Otherwise, the decoder would need to wait until the following key frame.)</span></span>

<span data-ttu-id="62cd8-250">Se a taxa de reprodução for mais rápida ou mais lenta que 1,0, o pipeline ajustará a taxa do relógio de apresentação.</span><span class="sxs-lookup"><span data-stu-id="62cd8-250">If the playback rate is faster or slower than 1.0, the pipeline adjusts the rate of the presentation clock.</span></span> <span data-ttu-id="62cd8-251">A origem não ajusta os carimbos de data/hora em exemplos.</span><span class="sxs-lookup"><span data-stu-id="62cd8-251">The source does not adjust the time stamps on samples.</span></span>

<span data-ttu-id="62cd8-252">A fonte pode definir informações adicionais sobre o exemplo definindo atributos.</span><span class="sxs-lookup"><span data-stu-id="62cd8-252">The source can set additional information on the sample by setting attributes.</span></span> <span data-ttu-id="62cd8-253">Para obter uma lista de atributos de exemplo, consulte [atributos de exemplo](sample-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="62cd8-253">For a list of sample attributes, see [Sample Attributes](sample-attributes.md).</span></span>

### <a name="gaps-in-the-stream"></a><span data-ttu-id="62cd8-254">Lacunas no fluxo</span><span class="sxs-lookup"><span data-stu-id="62cd8-254">Gaps in the Stream</span></span>

<span data-ttu-id="62cd8-255">Se um fluxo contiver um intervalo de comprimento significativo, é recomendável que o fluxo envie um evento [MEStreamTick](mestreamtick.md) .</span><span class="sxs-lookup"><span data-stu-id="62cd8-255">If a stream contains a gap of significant length, it is recommended that the stream send an [MEStreamTick](mestreamtick.md) event.</span></span> <span data-ttu-id="62cd8-256">Esse evento notifica o cliente de que um exemplo está ausente.</span><span class="sxs-lookup"><span data-stu-id="62cd8-256">This event notifies the client that a sample is missing.</span></span> <span data-ttu-id="62cd8-257">Os dados do evento são o carimbo de data/hora do exemplo ausente, em unidades de 100 a nanossegundos (**VT \_ i8**).</span><span class="sxs-lookup"><span data-stu-id="62cd8-257">The event data is the time stamp of the missing sample, in 100-nanosecond units (**VT\_I8**).</span></span> <span data-ttu-id="62cd8-258">Esse evento pode salvar componentes downstream de esperar por exemplos que não serão recebidos.</span><span class="sxs-lookup"><span data-stu-id="62cd8-258">This event can save downstream components from waiting for samples that will not arrive.</span></span> <span data-ttu-id="62cd8-259">O fluxo pode enviar quantos eventos MEStreamTick forem necessários para abranger a lacuna no fluxo.</span><span class="sxs-lookup"><span data-stu-id="62cd8-259">The stream can send as many MEStreamTick events as needed to span the gap in the stream.</span></span>

## <a name="shutting-down-the-media-source"></a><span data-ttu-id="62cd8-260">Desligando a origem da mídia</span><span class="sxs-lookup"><span data-stu-id="62cd8-260">Shutting Down the Media Source</span></span>

<span data-ttu-id="62cd8-261">Quando o cliente é concluído usando a origem de mídia, ele chama [**IMFMediaSource:: Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-shutdown).</span><span class="sxs-lookup"><span data-stu-id="62cd8-261">When the client is done using the media source, it calls [**IMFMediaSource::Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-shutdown).</span></span> <span data-ttu-id="62cd8-262">Dentro desse método, a origem da mídia deve interromper quaisquer contagens de referência circulares.</span><span class="sxs-lookup"><span data-stu-id="62cd8-262">Inside this method, the media source should break any circular reference counts.</span></span> <span data-ttu-id="62cd8-263">Normalmente, haverá referências circulares entre a origem da mídia e os fluxos de mídia.</span><span class="sxs-lookup"><span data-stu-id="62cd8-263">Typically, there will be circular references between the media source and the media streams.</span></span>

<span data-ttu-id="62cd8-264">Se você estiver usando a fila de eventos para implementar [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator), chame [**IMFMediaEventQueue:: Shutdown**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventqueue-shutdown) na fila de eventos.</span><span class="sxs-lookup"><span data-stu-id="62cd8-264">If you are using the event queue to implement [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator), call [**IMFMediaEventQueue::Shutdown**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventqueue-shutdown) on the event queue.</span></span> <span data-ttu-id="62cd8-265">Esse método desliga a fila de eventos e sinaliza qualquer chamador que esteja aguardando um evento no momento.</span><span class="sxs-lookup"><span data-stu-id="62cd8-265">This method shuts down the event queue and signals any caller that is currently waiting for an event.</span></span>

<span data-ttu-id="62cd8-266">Após o desligamento, todos os métodos na origem retornam **MF \_ E \_ Shutdown**, com exceção dos métodos **IUnknown** .</span><span class="sxs-lookup"><span data-stu-id="62cd8-266">After shutdown, all methods on the source return **MF\_E\_SHUTDOWN**, with the exception of **IUnknown** methods.</span></span>

## <a name="live-sources"></a><span data-ttu-id="62cd8-267">Fontes dinâmicas</span><span class="sxs-lookup"><span data-stu-id="62cd8-267">Live Sources</span></span>

<span data-ttu-id="62cd8-268">A partir do Windows 7, o Media Foundation oferece suporte automático a dispositivos de captura de áudio e vídeo.</span><span class="sxs-lookup"><span data-stu-id="62cd8-268">Starting in Windows 7, Media Foundation automatically supports audio and video capture devices.</span></span> <span data-ttu-id="62cd8-269">Para vídeo, o dispositivo deve fornecer um minidriver de streaming de kernel (KS) na categoria de captura de vídeo.</span><span class="sxs-lookup"><span data-stu-id="62cd8-269">For video, the device must provide a kernel streaming (KS) minidriver in the video capture category.</span></span> <span data-ttu-id="62cd8-270">Media Foundation usa o caminho PnP para enumerar o dispositivo.</span><span class="sxs-lookup"><span data-stu-id="62cd8-270">Media Foundation uses the PnP path to enumerate the device.</span></span> <span data-ttu-id="62cd8-271">Para áudio, Media Foundation usa a API do dispositivo de multimídia do Windows (MMDevice) para enumerar dispositivos de ponto de extremidade de áudio.</span><span class="sxs-lookup"><span data-stu-id="62cd8-271">For audio, Media Foundation uses the Windows Multimedia Device (MMDevice) API to enumerate audio endpoint devices.</span></span> <span data-ttu-id="62cd8-272">Se o dispositivo atender a esses critérios, não será necessário implementar uma fonte de mídia personalizada.</span><span class="sxs-lookup"><span data-stu-id="62cd8-272">If the device meets these criteria, there is no need to implement a custom media source.</span></span>

<span data-ttu-id="62cd8-273">No entanto, talvez você queira implementar uma fonte de mídia personalizada para algum outro tipo de dispositivo ou outra fonte de dados ao vivo.</span><span class="sxs-lookup"><span data-stu-id="62cd8-273">However, you might want to implement a custom media source for some other type of device or other live data source.</span></span> <span data-ttu-id="62cd8-274">Há apenas algumas diferenças entre uma fonte dinâmica e outras fontes de mídia:</span><span class="sxs-lookup"><span data-stu-id="62cd8-274">There are only a few differences between a live source and other media sources:</span></span>

-   <span data-ttu-id="62cd8-275">No método [**IMFMediaSource:: getcaracterísticas**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-getcharacteristics) , retorne o **MFMEDIASOURCE \_ é \_** o sinalizador Live.</span><span class="sxs-lookup"><span data-stu-id="62cd8-275">In the [**IMFMediaSource::GetCharacteristics**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-getcharacteristics) method, return the **MFMEDIASOURCE\_IS\_LIVE** flag.</span></span>
-   <span data-ttu-id="62cd8-276">O primeiro exemplo deve ter um carimbo de data/hora igual a zero.</span><span class="sxs-lookup"><span data-stu-id="62cd8-276">The first sample should have a time stamp of zero.</span></span>
-   <span data-ttu-id="62cd8-277">Os eventos e os Estados de streaming são tratados da mesma forma que as fontes de mídia, com exceção do estado em pausa.</span><span class="sxs-lookup"><span data-stu-id="62cd8-277">Events and streaming states are handled the same as media sources, with the exception of the paused state.</span></span>
-   <span data-ttu-id="62cd8-278">Enquanto estiver em pausa, não coloque amostras na fila.</span><span class="sxs-lookup"><span data-stu-id="62cd8-278">While paused, do not queue samples.</span></span> <span data-ttu-id="62cd8-279">Descarte todos os dados gerados enquanto estiverem em pausa.</span><span class="sxs-lookup"><span data-stu-id="62cd8-279">Drop any data that is generated while paused.</span></span>
-   <span data-ttu-id="62cd8-280">As fontes dinâmicas normalmente não dão suporte a busca, reprodução reversa ou controle de taxa.</span><span class="sxs-lookup"><span data-stu-id="62cd8-280">Live sources typically do not support seeking, reverse play, or rate control.</span></span>

## <a name="related-topics"></a><span data-ttu-id="62cd8-281">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="62cd8-281">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="62cd8-282">Fontes de mídia</span><span class="sxs-lookup"><span data-stu-id="62cd8-282">Media Sources</span></span>](media-sources.md)
</dt> <dt>

[<span data-ttu-id="62cd8-283">Tutorial: escrevendo uma fonte de mídia personalizada</span><span class="sxs-lookup"><span data-stu-id="62cd8-283">Tutorial: Writing a Custom Media Source</span></span>](tutorial--writing-a-custom-media-source.md)
</dt> </dl>

 

 



