---
description: Negociação de tipo de mídia no codificador
ms.assetid: c8ae543e-68f7-4c74-9cb7-2a200bd51820
title: Negociação de tipo de mídia no codificador
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c7845e9d50c5d418198dc0e08313e2e9329ffab8
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/03/2021
ms.locfileid: "103930202"
---
# <a name="media-type-negotiation-on-the-encoder"></a><span data-ttu-id="c521f-103">Negociação de tipo de mídia no codificador</span><span class="sxs-lookup"><span data-stu-id="c521f-103">Media Type Negotiation on the Encoder</span></span>

<span data-ttu-id="c521f-104">Em Microsoft Media Foundation, os codificadores são implementados como [transformações de Media Foundation](media-foundation-transforms.md) (MFTs) com uma entrada e uma saída.</span><span class="sxs-lookup"><span data-stu-id="c521f-104">In Microsoft Media Foundation, encoders are implemented as [Media Foundation transforms](media-foundation-transforms.md) (MFTs) with one input and one output.</span></span> <span data-ttu-id="c521f-105">Antes de uma sessão de codificação, um codificador precisa saber as características do fluxo que ele receberá como entrada e o formato do fluxo que ele produzirá como saída.</span><span class="sxs-lookup"><span data-stu-id="c521f-105">Before an encoding session, an encoder needs to know the characteristics of the stream it will receive as input and the format of the stream it will produce as output.</span></span> <span data-ttu-id="c521f-106">Você deve definir os tipos de mídia de entrada e saída e as características relacionadas antes de passar os dados por meio do codificador.</span><span class="sxs-lookup"><span data-stu-id="c521f-106">You must set the input and output media types and related characteristics before you pass data through the encoder.</span></span> <span data-ttu-id="c521f-107">Você deve fornecer os formatos de entrada e saída especificando os [GUIDs de tipo de mídia](media-type-guids.md) apropriados e definir as características do fluxo de saída definindo os [atributos de tipo de mídia](media-type-attributes.md) relevantes no tipo de mídia de saída.</span><span class="sxs-lookup"><span data-stu-id="c521f-107">You must supply the input and output formats by specifying the appropriate [Media Type GUIDs](media-type-guids.md) and set the characteristics of the output stream by setting the relevant [Media Type Attributes](media-type-attributes.md) on the output media type.</span></span> <span data-ttu-id="c521f-108">Um codificador instanciado recentemente não tem nenhum tipo de mídia definido.</span><span class="sxs-lookup"><span data-stu-id="c521f-108">A newly instantiated encoder does not have any set media types.</span></span>

<span data-ttu-id="c521f-109">O tipo de mídia de entrada é um formato descompactado, como áudio PCM ou vídeo RGB.</span><span class="sxs-lookup"><span data-stu-id="c521f-109">The input media type is an uncompressed format, such as PCM audio or RGB video.</span></span> <span data-ttu-id="c521f-110">Os tipos de formato usados pelo codificador são limitados aos descritos pelas estruturas **VIDEOINFOHEADER** e **WAVEFORMATEX** .</span><span class="sxs-lookup"><span data-stu-id="c521f-110">The format types that are used by the encoder are limited to those described by the **VIDEOINFOHEADER** and **WAVEFORMATEX** structures.</span></span> <span data-ttu-id="c521f-111">Para obter mais informações sobre essas estruturas, consulte a documentação do SDK do Windows. O Media Foundation fornece funções auxiliares para criar tipos de mídia a partir de estruturas de formato.</span><span class="sxs-lookup"><span data-stu-id="c521f-111">For more information about these structures, see the Windows SDK documentation.Media foundation provides helper functions to create media types from format structures.</span></span> <span data-ttu-id="c521f-112">Por exemplo, a função [**MFInitMediaTypeFromVideoInfoHeader**](/windows/desktop/api/mfapi/nf-mfapi-mfinitmediatypefromvideoinfoheader) Inicializa um tipo de vídeo de uma estrutura **VIDEOINFOHEADER** e a função [**MFInitMediaTypeFromWaveFormatEx**](/windows/desktop/api/mfapi/nf-mfapi-mfinitmediatypefromwaveformatex) Inicializa um tipo de vídeo de uma estrutura **WAVEFORMATEX** ou **WAVEFORMATEXTENSIBLE** .</span><span class="sxs-lookup"><span data-stu-id="c521f-112">For example, the [**MFInitMediaTypeFromVideoInfoHeader**](/windows/desktop/api/mfapi/nf-mfapi-mfinitmediatypefromvideoinfoheader) function initializes a video type from a **VIDEOINFOHEADER** structure, and the [**MFInitMediaTypeFromWaveFormatEx**](/windows/desktop/api/mfapi/nf-mfapi-mfinitmediatypefromwaveformatex) function initializes a video type from a **WAVEFORMATEX** or **WAVEFORMATEXTENSIBLE** structure.</span></span> <span data-ttu-id="c521f-113">Para obter mais informações, consulte [conversões de tipo de mídia](media-type-conversions.md).</span><span class="sxs-lookup"><span data-stu-id="c521f-113">For more information, see [Media Type Conversions](media-type-conversions.md).</span></span> <span data-ttu-id="c521f-114">Você deve definir o tipo de mídia de entrada no codificador chamando [**IMFTransform:: SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype).</span><span class="sxs-lookup"><span data-stu-id="c521f-114">You must set the input media type on the encoder by calling [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype).</span></span>

<span data-ttu-id="c521f-115">O tipo de mídia de saída é o formato de compactação usado no arquivo ou fluxo de origem final.</span><span class="sxs-lookup"><span data-stu-id="c521f-115">The output media type is the compression format used in the final source stream or file.</span></span> <span data-ttu-id="c521f-116">Você pode definir o tipo de mídia de saída disponível somente depois de definir o tipo de mídia de entrada.</span><span class="sxs-lookup"><span data-stu-id="c521f-116">You can set the available output media type only after setting the input media type.</span></span> <span data-ttu-id="c521f-117">Você pode recuperar os tipos de saída com suporte chamando [**IMFTransform:: GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) em um loop até que o codificador retorne o **MF \_ E \_ não \_ mais \_ tipos**.</span><span class="sxs-lookup"><span data-stu-id="c521f-117">You can retrieve the supported output types by calling [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) in a loop until the encoder returns **MF\_E\_NO\_MORE\_TYPES**.</span></span> <span data-ttu-id="c521f-118">Incrementar o índice de tipo com cada iteração.</span><span class="sxs-lookup"><span data-stu-id="c521f-118">Increment the type index with each iteration.</span></span> <span data-ttu-id="c521f-119">Quando encontrar um tipo de mídia apropriado, defina o tipo de mídia de saída chamando [**IMFTransform:: SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype).</span><span class="sxs-lookup"><span data-stu-id="c521f-119">When you find an appropriate media type, set the output media type by calling [**IMFTransform::SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype).</span></span>

<span data-ttu-id="c521f-120">O fator decisivo na escolha do tipo de mídia de saída depende do tipo de codificação e dos requisitos de codificação.</span><span class="sxs-lookup"><span data-stu-id="c521f-120">The deciding factor in choosing the output media type depends on the type of encoding and your encoding requirements.</span></span> <span data-ttu-id="c521f-121">Por exemplo, para fluxos de áudio que são codificados em CBR, você deseja encontrar um tipo de mídia que corresponde à sua entrada e tem uma taxa de bits mais próxima possível de um valor de destino.</span><span class="sxs-lookup"><span data-stu-id="c521f-121">For example, for audio streams that are CBR-encoded, you want to find a media type that matches your input and has a bit rate that is as close as possible to a target value.</span></span>

<span data-ttu-id="c521f-122">Se você quiser usar um modo de codificação diferente de CBR, deverá definir o modo e, em seguida, enumerar os tipos de saída para esse modo, pois o codificador altera os tipos de saída com suporte, dependendo do conjunto de modos.</span><span class="sxs-lookup"><span data-stu-id="c521f-122">If you want to use an encoding mode other than CBR, you must set the mode and then enumerate the output types for that mode, because the encoder changes the supported output types depending upon the mode set.</span></span> <span data-ttu-id="c521f-123">As propriedades que controlam o modo de codificação são [**MFPKEY \_ VBRENABLED**](mfpkey-vbrenabledproperty.md) e [**MFPKEY \_ PASSESUSED**](mfpkey-passesusedproperty.md).</span><span class="sxs-lookup"><span data-stu-id="c521f-123">The properties that control the encoding mode are [**MFPKEY\_VBRENABLED**](mfpkey-vbrenabledproperty.md) and [**MFPKEY\_PASSESUSED**](mfpkey-passesusedproperty.md).</span></span> <span data-ttu-id="c521f-124">Por exemplo, se você estiver enumerando tipos de saída para codificação de qualidade VBR, o tipo de mídia dependerá do valor de qualidade que você decidir usar.</span><span class="sxs-lookup"><span data-stu-id="c521f-124">For example, if you are enumerating output types for VBR-quality encoding, the media type depends on the quality value you decide to use.</span></span> <span data-ttu-id="c521f-125">Para obter informações sobre como definir essas propriedades, consulte [Propriedades de codificação](configuring-the-encoder.md).</span><span class="sxs-lookup"><span data-stu-id="c521f-125">For information about setting these properties, see [Encoding Properties](configuring-the-encoder.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="c521f-126">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="c521f-126">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="c521f-127">Criando uma instância de um MFT do codificador</span><span class="sxs-lookup"><span data-stu-id="c521f-127">Instantiating an Encoder MFT</span></span>](instantiating-the-encoder-mft.md)
</dt> <dt>

[<span data-ttu-id="c521f-128">Codificadores de mídia do Windows</span><span class="sxs-lookup"><span data-stu-id="c521f-128">Windows Media Encoders</span></span>](windows-media-encoders.md)
</dt> </dl>

 

 



