---
description: Sessão de mídia do PMP
ms.assetid: CF3A427D-31D2-45FF-BE87-F192B758204E
title: Sessão de mídia do PMP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: abf2cb1ff173d6fd085f6e98dd4608c84ff40200
ms.sourcegitcommit: 95685061d5b0333bbf9e6ebd208dde8190f97005
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/28/2021
ms.locfileid: "108092714"
---
# <a name="pmp-media-session"></a><span data-ttu-id="9c3a9-103">Sessão de mídia do PMP</span><span class="sxs-lookup"><span data-stu-id="9c3a9-103">PMP Media Session</span></span>

<span data-ttu-id="9c3a9-104">Um aplicativo pode criar a [sessão de mídia](media-session.md) em um processo separado chamado de processo PMP ( [caminho de mídia protegido](protected-media-path.md) ).</span><span class="sxs-lookup"><span data-stu-id="9c3a9-104">An application can create the [Media Session](media-session.md) in a separate process called the [Protected Media Path](protected-media-path.md) (PMP) process.</span></span> <span data-ttu-id="9c3a9-105">A principal finalidade do processo de PMP é habilitar a reprodução de conteúdo protegido usando o DRM (gerenciamento de direitos digitais).</span><span class="sxs-lookup"><span data-stu-id="9c3a9-105">The main purpose of the PMP process is to enable playback of protected content using digital rights management (DRM).</span></span> <span data-ttu-id="9c3a9-106">Por padrão, o processo de PMP é criado dentro de um ambiente protegido (PE).</span><span class="sxs-lookup"><span data-stu-id="9c3a9-106">By default, the PMP process is created inside a Protected Environment (PE).</span></span> <span data-ttu-id="9c3a9-107">Somente os componentes confiáveis e assinados podem ser carregados dentro de um PE.</span><span class="sxs-lookup"><span data-stu-id="9c3a9-107">Only trusted, signed components can be loaded inside a PE.</span></span> <span data-ttu-id="9c3a9-108">Um benefício secundário do processo de PMP é que ele isola o processo do aplicativo do pipeline de mídia.</span><span class="sxs-lookup"><span data-stu-id="9c3a9-108">A secondary benefit of the PMP process is that it isolates the application process from the media pipeline.</span></span> <span data-ttu-id="9c3a9-109">Para obter mais informações sobre o processo de PMP, consulte [proteção de caminho de mídia](protected-media-path.md).</span><span class="sxs-lookup"><span data-stu-id="9c3a9-109">For more information about the PMP process, see [Protected Media Path](protected-media-path.md).</span></span>

<span data-ttu-id="9c3a9-110">Para criar a sessão de mídia dentro do processo do PMP, chame a função [**MFCreatePMPMediaSession**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepmpmediasession) .</span><span class="sxs-lookup"><span data-stu-id="9c3a9-110">To create the Media Session inside the PMP process, call the [**MFCreatePMPMediaSession**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepmpmediasession) function.</span></span> <span data-ttu-id="9c3a9-111">Opcionalmente, você pode passar o sinalizador **de \_ \_ processo desprotegido do MFPMPSESSION** .</span><span class="sxs-lookup"><span data-stu-id="9c3a9-111">Optionally, you can pass in the **MFPMPSESSION\_UNPROTECTED\_PROCESS** flag.</span></span> <span data-ttu-id="9c3a9-112">Se esse sinalizador for definido, o processo de PMP será criado dentro de um processo desprotegido e não como um processo PE.</span><span class="sxs-lookup"><span data-stu-id="9c3a9-112">If this flag is set, the PMP process is created inside an unprotected process, and not a PE process.</span></span> <span data-ttu-id="9c3a9-113">O processo desprotegido não pode ser usado para reprodução de DRM, mas oferece os benefícios do isolamento do processo.</span><span class="sxs-lookup"><span data-stu-id="9c3a9-113">The unprotected process cannot be used for DRM playback, but does give you the benefits of process isolation.</span></span>

<span data-ttu-id="9c3a9-114">A função [**MFCreatePMPMediaSession**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepmpmediasession) retorna um ponteiro para um objeto proxy para a sessão de mídia.</span><span class="sxs-lookup"><span data-stu-id="9c3a9-114">The [**MFCreatePMPMediaSession**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepmpmediasession) function returns a pointer to a proxy object for the Media Session.</span></span> <span data-ttu-id="9c3a9-115">O aplicativo se comunica com a sessão de mídia por meio do proxy.</span><span class="sxs-lookup"><span data-stu-id="9c3a9-115">The application communicates with the Media Session through the proxy.</span></span>

![uma ilustração da sessão de mídia dentro do processo de PMP](images/pmp01.png)

<span data-ttu-id="9c3a9-117">Por padrão, quando o aplicativo cria uma topologia, a origem da mídia é criada dentro do processo do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="9c3a9-117">By default, when the application creates a topology, the media source is created inside the application process.</span></span> <span data-ttu-id="9c3a9-118">Um proxy para a origem da mídia é criado dentro do processo do PMP.</span><span class="sxs-lookup"><span data-stu-id="9c3a9-118">A proxy to the media source is created inside the PMP process.</span></span> <span data-ttu-id="9c3a9-119">A origem da mídia pode criar objetos dentro do processo de PMP usando a interface [**IMFPMPHost**](/windows/desktop/api/mfidl/nf-mfidl-imfpmphost-createobjectbyclsid) .</span><span class="sxs-lookup"><span data-stu-id="9c3a9-119">The media source can create objects inside the PMP process by using the [**IMFPMPHost**](/windows/desktop/api/mfidl/nf-mfidl-imfpmphost-createobjectbyclsid) interface.</span></span> <span data-ttu-id="9c3a9-120">Por exemplo, para dar suporte a DRM, uma origem de mídia cria um objeto chamado de ita ( *autoridade de confiança de entrada* ).</span><span class="sxs-lookup"><span data-stu-id="9c3a9-120">For example, to support DRM, a media source creates an object called an *input trust authority* (ITA).</span></span> <span data-ttu-id="9c3a9-121">O ITA deve ser criado dentro do processo de PMP.</span><span class="sxs-lookup"><span data-stu-id="9c3a9-121">The ITA must be created inside the PMP process.</span></span> <span data-ttu-id="9c3a9-122">(Para obter mais informações sobre ITAs, consulte o [caminho de mídia protegido](protected-media-path.md).) Para usar a interface [**IMFPMPHost**](/windows/desktop/api/mfidl/nn-mfidl-imfpmphost) , faça o seguinte:</span><span class="sxs-lookup"><span data-stu-id="9c3a9-122">(For more information about ITAs, see [Protected Media Path](protected-media-path.md).) To use the [**IMFPMPHost**](/windows/desktop/api/mfidl/nn-mfidl-imfpmphost) interface, do the following:</span></span>

1.  <span data-ttu-id="9c3a9-123">A origem da mídia deve implementar a interface [**IMFPMPClient**](/windows/desktop/api/mfidl/nn-mfidl-imfpmpclient) .</span><span class="sxs-lookup"><span data-stu-id="9c3a9-123">The media source must implement the [**IMFPMPClient**](/windows/desktop/api/mfidl/nn-mfidl-imfpmpclient) interface.</span></span>
2.  <span data-ttu-id="9c3a9-124">Durante a resolução da topologia, o proxy de sessão de mídia chama o método [**IMFPMPClient:: SetPMPHost**](/windows/desktop/api/mfidl/nf-mfidl-imfpmpclient-setpmphost) na origem da mídia.</span><span class="sxs-lookup"><span data-stu-id="9c3a9-124">During topology resolution, the Media Session proxy calls the [**IMFPMPClient::SetPMPHost**](/windows/desktop/api/mfidl/nf-mfidl-imfpmpclient-setpmphost) method on the media source.</span></span>
3.  <span data-ttu-id="9c3a9-125">A origem de mídia chama [**IMFPMPHost:: CreateObjectByCLSID**](/windows/desktop/api/mfidl/nf-mfidl-imfpmphost-createobjectbyclsid) para criar o objeto dentro do processo de PMP.</span><span class="sxs-lookup"><span data-stu-id="9c3a9-125">The media source calls [**IMFPMPHost::CreateObjectByCLSID**](/windows/desktop/api/mfidl/nf-mfidl-imfpmphost-createobjectbyclsid) to create the object inside the PMP process.</span></span> <span data-ttu-id="9c3a9-126">O objeto deve ter um CLSID registrado.</span><span class="sxs-lookup"><span data-stu-id="9c3a9-126">The object must have a registered CLSID.</span></span> <span data-ttu-id="9c3a9-127">Além disso, para carregar dentro do PE, o objeto deve ser confiável e assinado digitalmente.</span><span class="sxs-lookup"><span data-stu-id="9c3a9-127">Also, to load inside the PE, the object must be trusted and digitally signed.</span></span> <span data-ttu-id="9c3a9-128">Para obter informações sobre componentes de mídia protegidos por assinatura de código, consulte o white paper [assinatura de código para componentes de mídia protegidos no Windows Vista](/windows-hardware/test/hlk/)</span><span class="sxs-lookup"><span data-stu-id="9c3a9-128">For information about code signing protected media components, see the white paper [Code Signing for Protected Media Components in Windows Vista](/windows-hardware/test/hlk/)</span></span>

<span data-ttu-id="9c3a9-129">A ilustração a seguir mostra a origem da mídia criada no processo do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="9c3a9-129">The following illustration shows the media source created in the application process.</span></span>

![uma ilustração de uma origem de mídia no processo do aplicativo.](images/pmp02.png)

<span data-ttu-id="9c3a9-131">Outra alternativa é criar a origem da mídia dentro da sessão do PMP.</span><span class="sxs-lookup"><span data-stu-id="9c3a9-131">Another alternative is to create the media source inside the PMP session.</span></span>

1.  <span data-ttu-id="9c3a9-132">Defina o [**atributo \_ \_ modo de \_ origem \_ remoto da sessão MF**](mf-session-remote-source-mode-attribute.md) ao criar a sessão de mídia.</span><span class="sxs-lookup"><span data-stu-id="9c3a9-132">Set the [**MF\_SESSION\_REMOTE\_SOURCE\_MODE**](mf-session-remote-source-mode-attribute.md) attribute when you create the Media Session.</span></span> <span data-ttu-id="9c3a9-133">Os atributos de configuração são especificados no parâmetro *pConfiguration* da função [**MFCreatePMPMediaSession**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepmpmediasession) .</span><span class="sxs-lookup"><span data-stu-id="9c3a9-133">Configuration attributes are specified in the *pConfiguration* parameter of the [**MFCreatePMPMediaSession**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepmpmediasession) function.</span></span>
2.  <span data-ttu-id="9c3a9-134">Chame [**MFGetService**](/windows/desktop/api/mfidl/nf-mfidl-mfgetservice) na sessão de mídia para obter um ponteiro para a interface [**IMFPMPHost**](/windows/desktop/api/mfidl/nn-mfidl-imfpmphost) .</span><span class="sxs-lookup"><span data-stu-id="9c3a9-134">Call [**MFGetService**](/windows/desktop/api/mfidl/nf-mfidl-mfgetservice) on the Media Session to get a pointer to the [**IMFPMPHost**](/windows/desktop/api/mfidl/nn-mfidl-imfpmphost) interface.</span></span> <span data-ttu-id="9c3a9-135">O identificador de serviço é o **\_ \_ serviço MF PMP**.</span><span class="sxs-lookup"><span data-stu-id="9c3a9-135">The service identifier is **MF\_PMP\_SERVICE**.</span></span>
3.  <span data-ttu-id="9c3a9-136">Chame [**IMFPMPHost:: CreateObjectByCLSID**](/windows/desktop/api/mfidl/nf-mfidl-imfpmphost-createobjectbyclsid) com o CLSID do identificador de classe **\_ MFSourceResolver** para criar o resolvedor de origem dentro do processo de PMP.</span><span class="sxs-lookup"><span data-stu-id="9c3a9-136">Call [**IMFPMPHost::CreateObjectByCLSID**](/windows/desktop/api/mfidl/nf-mfidl-imfpmphost-createobjectbyclsid) with the class identifier **CLSID\_MFSourceResolver** to create the source resolver inside the PMP process.</span></span> <span data-ttu-id="9c3a9-137">O método retorna um ponteiro para um proxy para o resolvedor de origem.</span><span class="sxs-lookup"><span data-stu-id="9c3a9-137">The method returns a pointer to a proxy for the source resolver.</span></span>
4.  <span data-ttu-id="9c3a9-138">Chame [**IMFSourceResolver:: BeginCreateObjectFromURL**](/windows/desktop/api/mfidl/nf-mfidl-imfsourceresolver-begincreateobjectfromurl) ou [**IMFSourceResolver:: BeginCreateObjectFromByteStream**](/windows/desktop/api/mfidl/nf-mfidl-imfsourceresolver-begincreateobjectfrombytestream) para criar a origem da mídia.</span><span class="sxs-lookup"><span data-stu-id="9c3a9-138">Call [**IMFSourceResolver::BeginCreateObjectFromURL**](/windows/desktop/api/mfidl/nf-mfidl-imfsourceresolver-begincreateobjectfromurl) or [**IMFSourceResolver::BeginCreateObjectFromByteStream**](/windows/desktop/api/mfidl/nf-mfidl-imfsourceresolver-begincreateobjectfrombytestream) to create the media source.</span></span>
    > [!Note]  
    > <span data-ttu-id="9c3a9-139">Nesse caso, você deve usar as versões assíncronas desses métodos, pois as versões síncronas não são remotas.</span><span class="sxs-lookup"><span data-stu-id="9c3a9-139">In this case, you must use the asynchronous versions of these methods, because the synchronous versions are not remotable.</span></span>

     

<span data-ttu-id="9c3a9-140">A ilustração a seguir mostra a origem da mídia criada no processo do PMP.</span><span class="sxs-lookup"><span data-stu-id="9c3a9-140">The following illustration shows the media source created in the PMP process.</span></span>

![uma ilustração de uma fonte de mídia no processo do PMP.](images/pmp03.png)

## <a name="related-topics"></a><span data-ttu-id="9c3a9-142">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="9c3a9-142">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="9c3a9-143">Como reproduzir arquivos de mídia protegidos</span><span class="sxs-lookup"><span data-stu-id="9c3a9-143">How to Play Protected Media Files</span></span>](how-to-play-protected-media-files.md)
</dt> <dt>

[<span data-ttu-id="9c3a9-144">Sessão de mídia</span><span class="sxs-lookup"><span data-stu-id="9c3a9-144">Media Session</span></span>](media-session.md)
</dt> <dt>

[<span data-ttu-id="9c3a9-145">Caminho de mídia protegido</span><span class="sxs-lookup"><span data-stu-id="9c3a9-145">Protected Media Path</span></span>](protected-media-path.md)
</dt> </dl>

 

 
