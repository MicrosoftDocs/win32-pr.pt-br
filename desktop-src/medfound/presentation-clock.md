---
description: Relógio de apresentação
ms.assetid: cb8bb62a-ef80-4de0-9a44-3bb77edc9dd5
title: Relógio de apresentação
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5f61ad02537a2591c681db78721376651f7854ec
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104091041"
---
# <a name="presentation-clock"></a><span data-ttu-id="fa439-103">Relógio de apresentação</span><span class="sxs-lookup"><span data-stu-id="fa439-103">Presentation Clock</span></span>

<span data-ttu-id="fa439-104">O *relógio de apresentação* é um objeto que gera a hora do relógio de uma apresentação.</span><span class="sxs-lookup"><span data-stu-id="fa439-104">The *presentation clock* is an object that generates the clock time for a presentation.</span></span> <span data-ttu-id="fa439-105">A hora relatada pelo relógio de apresentação é chamada de *hora de apresentação*.</span><span class="sxs-lookup"><span data-stu-id="fa439-105">The time reported by the presentation clock is called the *presentation time*.</span></span> <span data-ttu-id="fa439-106">Todos os fluxos em uma apresentação são sincronizados com a hora da apresentação.</span><span class="sxs-lookup"><span data-stu-id="fa439-106">All streams in a presentation are synchronized to the presentation time.</span></span> <span data-ttu-id="fa439-107">O relógio de apresentação expõe as interfaces a seguir.</span><span class="sxs-lookup"><span data-stu-id="fa439-107">The presentation clock exposes the following interfaces.</span></span>



| <span data-ttu-id="fa439-108">Interface</span><span class="sxs-lookup"><span data-stu-id="fa439-108">Interface</span></span>                                            | <span data-ttu-id="fa439-109">Descrição</span><span class="sxs-lookup"><span data-stu-id="fa439-109">Description</span></span>                                         |
|------------------------------------------------------|-----------------------------------------------------|
| [<span data-ttu-id="fa439-110">**IMFPresentationClock**</span><span class="sxs-lookup"><span data-stu-id="fa439-110">**IMFPresentationClock**</span></span>](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationclock) | <span data-ttu-id="fa439-111">Interface primária para usar o relógio de apresentação.</span><span class="sxs-lookup"><span data-stu-id="fa439-111">Primary interface for using the presentation clock.</span></span> |
| [<span data-ttu-id="fa439-112">**IMFRateControl**</span><span class="sxs-lookup"><span data-stu-id="fa439-112">**IMFRateControl**</span></span>](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol)             | <span data-ttu-id="fa439-113">Controla a taxa de clock.</span><span class="sxs-lookup"><span data-stu-id="fa439-113">Controls the clock rate.</span></span>                            |
| [<span data-ttu-id="fa439-114">**IMFTimer**</span><span class="sxs-lookup"><span data-stu-id="fa439-114">**IMFTimer**</span></span>](/windows/desktop/api/mfidl/nn-mfidl-imftimer)                         | <span data-ttu-id="fa439-115">Fornece um retorno de chamada do temporizador.</span><span class="sxs-lookup"><span data-stu-id="fa439-115">Provides a timer callback.</span></span>                          |
| [<span data-ttu-id="fa439-116">**IMFShutdown**</span><span class="sxs-lookup"><span data-stu-id="fa439-116">**IMFShutdown**</span></span>](/windows/desktop/api/mfidl/nn-mfidl-imfshutdown)                   | <span data-ttu-id="fa439-117">Desliga o relógio de apresentação.</span><span class="sxs-lookup"><span data-stu-id="fa439-117">Shuts down the presentation clock.</span></span>                  |



 

<span data-ttu-id="fa439-118">Os coletores de mídia usam o tempo de apresentação para agendar quando renderizar exemplos.</span><span class="sxs-lookup"><span data-stu-id="fa439-118">Media sinks use the presentation time to schedule when to render samples.</span></span> <span data-ttu-id="fa439-119">Sempre que um coletor de mídia recebe um novo exemplo, ele obtém o carimbo de data/hora do exemplo e renderiza o exemplo no horário indicado, ou o mais próximo possível do tempo possível.</span><span class="sxs-lookup"><span data-stu-id="fa439-119">Whenever a media sink receives a new sample, it gets the time stamp from the sample and renders the sample at the indicated time, or as close to that time as possible.</span></span> <span data-ttu-id="fa439-120">Como todos os coletores de mídia em uma topologia compartilham o mesmo relógio de apresentação, vários fluxos (como áudio e vídeo) são sincronizados.</span><span class="sxs-lookup"><span data-stu-id="fa439-120">Because all of the media sinks in a topology share the same presentation clock, multiple streams (such as audio and video) are synchronized.</span></span> <span data-ttu-id="fa439-121">As fontes de mídia e as transformações não usam o relógio de apresentação, pois não agendam quando fornecer amostras.</span><span class="sxs-lookup"><span data-stu-id="fa439-121">Media sources and transforms do not use the presentation clock, because they do not schedule when to deliver samples.</span></span> <span data-ttu-id="fa439-122">Em vez disso, eles produzem amostras sempre que o pipeline solicita um novo exemplo.</span><span class="sxs-lookup"><span data-stu-id="fa439-122">Instead, they produce samples whenever the pipeline requests a new sample.</span></span>

<span data-ttu-id="fa439-123">Se você estiver usando a sessão de mídia para reprodução, a sessão de mídia manipulará todos os detalhes da criação do relógio de apresentação, selecionando uma fonte de tempo e notificando os coletores de mídia.</span><span class="sxs-lookup"><span data-stu-id="fa439-123">If you are using the Media Session for playback, the Media Session handles all of the details of creating the presentation clock, selecting a time source, and notifying the media sinks.</span></span> <span data-ttu-id="fa439-124">Seu aplicativo pode usar o relógio de apresentação para obter o tempo de apresentação atual durante a reprodução, mas, caso contrário, não chamará nenhum método no relógio de apresentação.</span><span class="sxs-lookup"><span data-stu-id="fa439-124">Your application might use the presentation clock to get the current presentation time during playback, but otherwise will not call any methods on the presentation clock.</span></span>

## <a name="clock-time-and-clock-states"></a><span data-ttu-id="fa439-125">Hora do relógio e Estados do relógio</span><span class="sxs-lookup"><span data-stu-id="fa439-125">Clock Time and Clock States</span></span>

<span data-ttu-id="fa439-126">Para obter a hora do relógio mais recente do relógio de apresentação, chame [**IMFPresentationClock:: getTime**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-gettime).</span><span class="sxs-lookup"><span data-stu-id="fa439-126">To get the latest clock time from the presentation clock, call [**IMFPresentationClock::GetTime**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-gettime).</span></span> <span data-ttu-id="fa439-127">Os horários de relógio estão sempre em unidades de 100 nanossegundos e, portanto, um segundo é de 10 milhões (10 ^ 7) tiques.</span><span class="sxs-lookup"><span data-stu-id="fa439-127">Clock times are always in 100-nanosecond units, so one second is 10,000,000 (10^7) ticks.</span></span> <span data-ttu-id="fa439-128">Isso corresponde a uma frequência de 10 MHz.</span><span class="sxs-lookup"><span data-stu-id="fa439-128">This corresponds to a frequency of 10 MHz.</span></span>

<span data-ttu-id="fa439-129">O relógio de apresentação tem três Estados: em execução, em pausa e parado.</span><span class="sxs-lookup"><span data-stu-id="fa439-129">The presentation clock has three states: Running, paused, and stopped.</span></span>

-   <span data-ttu-id="fa439-130">Para executar o relógio, chame [**IMFPresentationClock:: Start**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-start).</span><span class="sxs-lookup"><span data-stu-id="fa439-130">To run the clock, call [**IMFPresentationClock::Start**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-start).</span></span> <span data-ttu-id="fa439-131">O método **Start** especifica a hora de início do relógio.</span><span class="sxs-lookup"><span data-stu-id="fa439-131">The **Start** method specifies the clock's starting time.</span></span> <span data-ttu-id="fa439-132">Enquanto o relógio estiver em execução, a hora do relógio será incrementada a partir da hora de início, na taxa de relógio atual.</span><span class="sxs-lookup"><span data-stu-id="fa439-132">While the clock is running, the clock time increments from the starting time, at the current clock rate.</span></span>
-   <span data-ttu-id="fa439-133">Para pausar o relógio, chame [**IMFPresentationClock::P ause**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-pause).</span><span class="sxs-lookup"><span data-stu-id="fa439-133">To pause the clock, call [**IMFPresentationClock::Pause**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-pause).</span></span> <span data-ttu-id="fa439-134">Enquanto o relógio está pausado, a hora do relógio não avança e [**getTime**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-gettime) retorna a hora em que o relógio foi pausado.</span><span class="sxs-lookup"><span data-stu-id="fa439-134">While the clock is paused, the clock time does not advance, and [**GetTime**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-gettime) returns the time at which the clock was paused.</span></span>
-   <span data-ttu-id="fa439-135">Para parar o relógio, chame [**IMFPresentationClock:: Stop**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-stop).</span><span class="sxs-lookup"><span data-stu-id="fa439-135">To stop the clock, call [**IMFPresentationClock::Stop**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-stop).</span></span> <span data-ttu-id="fa439-136">Quando o relógio é interrompido, a hora do relógio não avança e [**getTime**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-gettime) retorna zero.</span><span class="sxs-lookup"><span data-stu-id="fa439-136">When the clock is stopped, the clock time does not advance, and [**GetTime**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-gettime) returns zero.</span></span>

<span data-ttu-id="fa439-137">Por padrão, o relógio avança a uma taxa de 1,0, significando 1 tique por 100 nanossegundos.</span><span class="sxs-lookup"><span data-stu-id="fa439-137">By default, the clock advances at a rate of 1.0, meaning 1 tick per 100 nanoseconds.</span></span> <span data-ttu-id="fa439-138">Para alterar a taxa na qual o relógio avança, consulte o relógio de apresentação para a interface [**IMFRateControl**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol) e chame [**IMFRateControl:: SetRate**](/windows/desktop/api/mfidl/nf-mfidl-imfratecontrol-setrate).</span><span class="sxs-lookup"><span data-stu-id="fa439-138">To change the rate at which the clock advances, query the presentation clock for the [**IMFRateControl**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol) interface and call [**IMFRateControl::SetRate**](/windows/desktop/api/mfidl/nf-mfidl-imfratecontrol-setrate).</span></span>

<span data-ttu-id="fa439-139">Os objetos podem receber notificações de alterações de estado (incluindo alterações de taxa) do relógio de apresentação.</span><span class="sxs-lookup"><span data-stu-id="fa439-139">Objects can receive notifications of state changes (including rate changes) from the presentation clock.</span></span> <span data-ttu-id="fa439-140">Para receber notificações, implemente a interface [**IMFClockStateSink**](/windows/desktop/api/mfidl/nn-mfidl-imfclockstatesink) e chame [**IMFPresentationClock:: AddClockStateSink**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-addclockstatesink) no relógio de apresentação.</span><span class="sxs-lookup"><span data-stu-id="fa439-140">To receive notifications, implement the [**IMFClockStateSink**](/windows/desktop/api/mfidl/nn-mfidl-imfclockstatesink) interface and call [**IMFPresentationClock::AddClockStateSink**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-addclockstatesink) on the presentation clock.</span></span> <span data-ttu-id="fa439-141">Antes de desligar, chame [**IMFPresentationClock:: RemoveClockStateSink**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-removeclockstatesink) para cancelar o registro do objeto.</span><span class="sxs-lookup"><span data-stu-id="fa439-141">Before shutting down, call [**IMFPresentationClock::RemoveClockStateSink**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-removeclockstatesink) to unregister the object.</span></span> <span data-ttu-id="fa439-142">Os coletores de mídia usam esse mecanismo para receber notificações do relógio.</span><span class="sxs-lookup"><span data-stu-id="fa439-142">Media sinks use this mechanism to receive notifications from the clock.</span></span>

## <a name="presentation-times"></a><span data-ttu-id="fa439-143">Tempos de apresentação</span><span class="sxs-lookup"><span data-stu-id="fa439-143">Presentation Times</span></span>

<span data-ttu-id="fa439-144">Um coletor de mídia tenta agendar cada exemplo para que o exemplo seja renderizado no horário correto ou o mais próximo possível do tempo correto.</span><span class="sxs-lookup"><span data-stu-id="fa439-144">A media sink tries to schedule each sample so that the sample is rendered at the correct time, or as close to the correct time as possible.</span></span> <span data-ttu-id="fa439-145">As seguintes definições se aplicam:</span><span class="sxs-lookup"><span data-stu-id="fa439-145">The following definitions apply:</span></span>

-   <span data-ttu-id="fa439-146">*Hora da apresentação.*</span><span class="sxs-lookup"><span data-stu-id="fa439-146">*Presentation time.*</span></span> <span data-ttu-id="fa439-147">A hora em que uma amostra deve ser renderizada.</span><span class="sxs-lookup"><span data-stu-id="fa439-147">The time when a sample should be rendered.</span></span> <span data-ttu-id="fa439-148">O tempo é fornecido em unidades de 100 nanossegundos.</span><span class="sxs-lookup"><span data-stu-id="fa439-148">Time is given in units of 100 nanoseconds.</span></span>
-   <span data-ttu-id="fa439-149">*Tempo de mídia.*</span><span class="sxs-lookup"><span data-stu-id="fa439-149">*Media time.*</span></span> <span data-ttu-id="fa439-150">Tempo relativo ao início do conteúdo.</span><span class="sxs-lookup"><span data-stu-id="fa439-150">Time relative to the start of the content.</span></span> <span data-ttu-id="fa439-151">Por exemplo, se um arquivo de vídeo tiver 10 segundos de comprimento, a metade do ponto no arquivo terá um tempo de mídia de 5 segundos.</span><span class="sxs-lookup"><span data-stu-id="fa439-151">For example, if a video file is 10 seconds long, the point half way through the file has a media time of 5 seconds.</span></span>
-   <span data-ttu-id="fa439-152">*Carimbo de data/hora.*</span><span class="sxs-lookup"><span data-stu-id="fa439-152">*Time stamp.*</span></span> <span data-ttu-id="fa439-153">O tempo marcado em um exemplo de mídia.</span><span class="sxs-lookup"><span data-stu-id="fa439-153">The time marked on a media sample.</span></span> <span data-ttu-id="fa439-154">Para obter o carimbo de data/hora, chame [**IMFSample:: Getsampletime**](/windows/desktop/api/mfobjects/nf-mfobjects-imfsample-getsampletime).</span><span class="sxs-lookup"><span data-stu-id="fa439-154">To get the time stamp, call [**IMFSample::GetSampleTime**](/windows/desktop/api/mfobjects/nf-mfobjects-imfsample-getsampletime).</span></span> <span data-ttu-id="fa439-155">Quando uma origem de mídia produz um exemplo, ela define o carimbo de data/hora igual ao tempo de mídia.</span><span class="sxs-lookup"><span data-stu-id="fa439-155">When a media source produces a sample, it sets the time stamp equal to the media time.</span></span> <span data-ttu-id="fa439-156">A sessão de mídia converte o carimbo de data/hora em tempo de apresentação.</span><span class="sxs-lookup"><span data-stu-id="fa439-156">The Media Session translates the time stamp into presentation time.</span></span>

<span data-ttu-id="fa439-157">Por padrão, a hora de mídia e a hora da apresentação são as mesmas, por exemplo, se um quadro de vídeo aparecer 5 segundos no arquivo de origem, o tempo de mídia e a hora da apresentação serão ambos 5 segundos.</span><span class="sxs-lookup"><span data-stu-id="fa439-157">By default, media time and presentation time are the same, For example, if a video frame appears 5 seconds into the source file, the media time and the presentation time are both 5 seconds.</span></span> <span data-ttu-id="fa439-158">Se você estiver usando a [origem do Sequencer](sequencer-source.md), o modelo de tempo será um pouco mais complicado para permitir transições suaves entre os segmentos.</span><span class="sxs-lookup"><span data-stu-id="fa439-158">If you are using the [Sequencer Source](sequencer-source.md), the timing model is somewhat more complicated, to enable smooth transitions between segments.</span></span> <span data-ttu-id="fa439-159">Para obter mais informações sobre o modelo de tempo da origem do Sequencer, consulte [tempos de apresentação da sequência](sequence-presentation-times.md).</span><span class="sxs-lookup"><span data-stu-id="fa439-159">For more information about the sequencer source's timing model, see [Sequence Presentation Times](sequence-presentation-times.md).</span></span>

<span data-ttu-id="fa439-160">A origem da mídia sempre define o carimbo de data/hora igual ao horário da mídia.</span><span class="sxs-lookup"><span data-stu-id="fa439-160">The media source always sets the time stamp equal to the media time.</span></span> <span data-ttu-id="fa439-161">Se o tempo de apresentação não estiver alinhado com o tempo de mídia, a sessão de mídia converterá os carimbos de data/hora nos exemplos de mídia.</span><span class="sxs-lookup"><span data-stu-id="fa439-161">If presentation time is not aligned with media time, the Media Session converts the time stamps on the media samples.</span></span> <span data-ttu-id="fa439-162">No momento em que o coletor recebe um exemplo, o carimbo de data/hora do exemplo foi convertido em tempo de apresentação.</span><span class="sxs-lookup"><span data-stu-id="fa439-162">By the time the sink receives a sample, the sample's time stamp has been converted to presentation time.</span></span> <span data-ttu-id="fa439-163">O coletor agenda o exemplo na hora atual do relógio de apresentação.</span><span class="sxs-lookup"><span data-stu-id="fa439-163">The sink schedules the sample against the presentation clock's current time.</span></span> <span data-ttu-id="fa439-164">(Coletores sem tarifas são uma exceção, pois eles ignoram o relógio de apresentação.)</span><span class="sxs-lookup"><span data-stu-id="fa439-164">(Rateless sinks are an exception, because they ignore the presentation clock.)</span></span>

<span data-ttu-id="fa439-165">Se o aplicativo procurar uma nova posição, a sessão de mídia reiniciará o relógio de apresentação no tempo de busca especificado.</span><span class="sxs-lookup"><span data-stu-id="fa439-165">If the application seeks to a new position, the Media Session restarts the presentation clock at the specified seek time.</span></span> <span data-ttu-id="fa439-166">Por exemplo, se o aplicativo busca a posição de 5 segundos no arquivo, a sessão de mídia inicia o relógio em 5 segundos.</span><span class="sxs-lookup"><span data-stu-id="fa439-166">For example, if the application seeks to the 5-second position in the file, the Media Session starts the clock at 5 seconds.</span></span> <span data-ttu-id="fa439-167">A origem da mídia pode fornecer amostras com um carimbo de data/hora ligeiramente anterior se o tempo de busca não cair em um limite de quadro de chave.</span><span class="sxs-lookup"><span data-stu-id="fa439-167">The media source might deliver samples with a slightly earlier time stamp if the seek time does not fall on a key-frame boundary.</span></span> <span data-ttu-id="fa439-168">Isso é necessário para que os decodificadores possam decodificar todos os quadros.</span><span class="sxs-lookup"><span data-stu-id="fa439-168">This is required so that the decoders can decode all of the frames.</span></span> <span data-ttu-id="fa439-169">A sessão de mídia descarta ou corta amostras antes que elas atinjam os coletores de mídia, a fim de corresponder ao tempo de busca solicitado.</span><span class="sxs-lookup"><span data-stu-id="fa439-169">The Media Session drops or trims samples before they reach the media sinks, in order to match the requested seek time.</span></span> <span data-ttu-id="fa439-170">Por exemplo, se o tempo de busca for de 5 segundos, o primeiro exemplo de áudio poderá começar em 4,5 segundos.</span><span class="sxs-lookup"><span data-stu-id="fa439-170">For example, if the seek time is 5 seconds, the first audio sample might start at 4.5 seconds.</span></span> <span data-ttu-id="fa439-171">A sessão de mídia irá cortar os primeiros 0,5 segundos do primeiro exemplo de áudio decodificado.</span><span class="sxs-lookup"><span data-stu-id="fa439-171">The Media Session will trim the first 0.5 seconds from the first decoded audio sample.</span></span>

## <a name="creating-the-presentation-clock"></a><span data-ttu-id="fa439-172">Criando o relógio de apresentação</span><span class="sxs-lookup"><span data-stu-id="fa439-172">Creating the Presentation Clock</span></span>

<span data-ttu-id="fa439-173">Para criar o relógio de apresentação, chame [**MFCreatePresentationClock**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepresentationclock).</span><span class="sxs-lookup"><span data-stu-id="fa439-173">To create the presentation clock, call [**MFCreatePresentationClock**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepresentationclock).</span></span> <span data-ttu-id="fa439-174">Para desligar o relógio, consulte a interface [**IMFShutdown**](/windows/desktop/api/mfidl/nn-mfidl-imfshutdown) e chame [**IMFShutdown:: Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-shutdown).</span><span class="sxs-lookup"><span data-stu-id="fa439-174">To shut down the clock, query for the [**IMFShutdown**](/windows/desktop/api/mfidl/nn-mfidl-imfshutdown) interface and call [**IMFShutdown::Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-shutdown).</span></span> <span data-ttu-id="fa439-175">O chamador de **MFCreatePresentationClock** é responsável por chamar o **desligamento**; na maioria dos casos, essa é a sessão de mídia em vez do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="fa439-175">The caller of **MFCreatePresentationClock** is responsible for calling **Shutdown**; in most cases, this is the Media Session rather than the application.</span></span>

## <a name="presentation-time-sources"></a><span data-ttu-id="fa439-176">Fontes de tempo de apresentação</span><span class="sxs-lookup"><span data-stu-id="fa439-176">Presentation Time Sources</span></span>

<span data-ttu-id="fa439-177">Apesar de seu nome, o relógio de apresentação não implementa de fato um relógio.</span><span class="sxs-lookup"><span data-stu-id="fa439-177">Despite its name, the presentation clock does not actually implement a clock.</span></span> <span data-ttu-id="fa439-178">Em vez disso, ele obtém os tempos do relógio de outro objeto, chamado de *fonte de tempo de apresentação*.</span><span class="sxs-lookup"><span data-stu-id="fa439-178">Instead, it gets the clock times from another object, called a *presentation time source*.</span></span> <span data-ttu-id="fa439-179">A fonte de tempo pode ser qualquer objeto que gere tiques de relógio precisos e expor a interface [**IMFPresentationTimeSource**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource) .</span><span class="sxs-lookup"><span data-stu-id="fa439-179">The time source can be any object that generates accurate clock ticks and exposes the [**IMFPresentationTimeSource**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource) interface.</span></span> <span data-ttu-id="fa439-180">A ilustração a seguir mostra este processo.</span><span class="sxs-lookup"><span data-stu-id="fa439-180">The following illustration shows this process.</span></span>

![diagrama mostrando a relação entre o relógio de apresentação e a fonte de hora da apresentação](images/dedc255c-eb6d-49fc-8892-7b6076ed4488.gif)

<span data-ttu-id="fa439-182">Quando o relógio de apresentação é criado pela primeira vez, ele não tem uma fonte de tempo.</span><span class="sxs-lookup"><span data-stu-id="fa439-182">When the presentation clock is first created, it does not have a time source.</span></span> <span data-ttu-id="fa439-183">Para definir a origem do tempo, chame [**IMFPresentationClock:: Settimename**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-settimesource) com um ponteiro para a interface [**IMFPresentationTimeSource**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource) da fonte de tempo.</span><span class="sxs-lookup"><span data-stu-id="fa439-183">To set the time source, call [**IMFPresentationClock::SetTimeSource**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-settimesource) with a pointer to the time source's [**IMFPresentationTimeSource**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource) interface.</span></span> <span data-ttu-id="fa439-184">Uma fonte de tempo dá suporte aos mesmos Estados que o relógio de apresentação (em execução, pausado e parada) e deve implementar a interface [**IMFClockStateSink**](/windows/desktop/api/mfidl/nn-mfidl-imfclockstatesink) .</span><span class="sxs-lookup"><span data-stu-id="fa439-184">A time source supports the same states as the presentation clock (running, paused, and stop), and must implement the [**IMFClockStateSink**](/windows/desktop/api/mfidl/nn-mfidl-imfclockstatesink) interface.</span></span> <span data-ttu-id="fa439-185">O relógio de apresentação usa essa interface para notificar a fonte de tempo quando alterar o estado.</span><span class="sxs-lookup"><span data-stu-id="fa439-185">The presentation clock uses this interface to notify the time source when to change state.</span></span> <span data-ttu-id="fa439-186">Dessa forma, a fonte de tempo fornece os tiques do relógio, mas o relógio de apresentação inicia as alterações de estado no relógio.</span><span class="sxs-lookup"><span data-stu-id="fa439-186">In this way, the time source provides the clock ticks, but the presentation clock initiates state changes in the clock.</span></span>

<span data-ttu-id="fa439-187">Alguns coletores de mídia têm acesso a um relógio preciso e, portanto, expõem a interface [**IMFPresentationTimeSource**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource) .</span><span class="sxs-lookup"><span data-stu-id="fa439-187">Some media sinks have access to an accurate clock, and therefore expose the [**IMFPresentationTimeSource**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource) interface.</span></span> <span data-ttu-id="fa439-188">Em particular, o processador de áudio pode usar a frequência da placa de som como um relógio.</span><span class="sxs-lookup"><span data-stu-id="fa439-188">In particular, the audio renderer can use the frequency of the sound card as a clock.</span></span> <span data-ttu-id="fa439-189">Na reprodução de áudio, é útil que o processador de áudio atue como a fonte de tempo, para que o vídeo seja sincronizado com a taxa de reprodução de áudio.</span><span class="sxs-lookup"><span data-stu-id="fa439-189">In audio playback, it is useful for the audio renderer to act as the time source, so that video is synchronized to the audio playback rate.</span></span> <span data-ttu-id="fa439-190">Isso geralmente produz resultados melhores do que tentar corresponder o áudio a um relógio externo.</span><span class="sxs-lookup"><span data-stu-id="fa439-190">This generally produces better results than attempting to match the audio to an external clock.</span></span>

<span data-ttu-id="fa439-191">Media Foundation também fornece uma fonte de tempo de apresentação com base no relógio do sistema.</span><span class="sxs-lookup"><span data-stu-id="fa439-191">Media Foundation also provides a presentation time source based on the system clock.</span></span> <span data-ttu-id="fa439-192">Para criar esse objeto, chame [**MFCreateSystemTimeSource**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatesystemtimesource).</span><span class="sxs-lookup"><span data-stu-id="fa439-192">To create this object, call [**MFCreateSystemTimeSource**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatesystemtimesource).</span></span> <span data-ttu-id="fa439-193">A fonte de tempo do sistema pode ser usada quando nenhum coletor de mídia fornece uma fonte de tempo.</span><span class="sxs-lookup"><span data-stu-id="fa439-193">The system time source can be used when no media sinks provide a time source.</span></span>

<span data-ttu-id="fa439-194">Em geral, um coletor de mídia deve usar o relógio de apresentação fornecido a ele, independentemente de qual fonte de tempo o relógio de apresentação usa.</span><span class="sxs-lookup"><span data-stu-id="fa439-194">In general, a media sink must use the presentation clock provided to it, regardless of which time source the presentation clock uses.</span></span> <span data-ttu-id="fa439-195">Essa regra se aplica mesmo quando um coletor de mídia implementa [**IMFPresentationTimeSource**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource).</span><span class="sxs-lookup"><span data-stu-id="fa439-195">This rule applies even when a media sink implements [**IMFPresentationTimeSource**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource).</span></span> <span data-ttu-id="fa439-196">Se o relógio de apresentação usar alguma outra fonte de tempo, o coletor de mídia deverá seguir essa fonte de tempo, não seu próprio relógio interno.</span><span class="sxs-lookup"><span data-stu-id="fa439-196">If the presentation clock uses some other time source, the media sink must follow that time source, not its own internal clock.</span></span>

<span data-ttu-id="fa439-197">Há duas situações em que um coletor de mídia não segue o relógio de apresentação:</span><span class="sxs-lookup"><span data-stu-id="fa439-197">There are two situations when a media sink will not follow the presentation clock:</span></span>

-   <span data-ttu-id="fa439-198">Alguns coletores de mídia são sem *taxa*.</span><span class="sxs-lookup"><span data-stu-id="fa439-198">Some media sinks are *rateless*.</span></span> <span data-ttu-id="fa439-199">Se um coletor de mídia for sem taxa, ele consumirá amostras o mais rápido possível, sem agendá-los de acordo com o relógio de apresentação.</span><span class="sxs-lookup"><span data-stu-id="fa439-199">If a media sink is rateless, it consumes samples as quickly as possible, without scheduling them according to the presentation clock.</span></span> <span data-ttu-id="fa439-200">Normalmente, os coletores sem taxa gravam dados em um arquivo, portanto, é desejável concluir a operação o mais rápido possível.</span><span class="sxs-lookup"><span data-stu-id="fa439-200">Typically, rateless sinks write data to a file, so it is desirable to complete the operation as quickly as possible.</span></span> <span data-ttu-id="fa439-201">Um coletor sem taxa retorna o sinalizador sem taxa de MEDIASINK \_ em seu método [**IMFMediaSink:: getcaracterísticas**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasink-getcharacteristics) .</span><span class="sxs-lookup"><span data-stu-id="fa439-201">A rateless sink returns the MEDIASINK\_RATELESS flag in its [**IMFMediaSink::GetCharacteristics**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasink-getcharacteristics) method.</span></span> <span data-ttu-id="fa439-202">Quando todos os coletores em uma topologia são sem taxa, a sessão de mídia envia dados por push pelo pipeline o mais rápido possível.</span><span class="sxs-lookup"><span data-stu-id="fa439-202">When all the sinks in a topology are rateless, the Media Session pushes data through the pipeline as quickly as possible.</span></span>

-   <span data-ttu-id="fa439-203">Alguns coletores de mídia não podem corresponder a taxas com uma fonte de tempo diferente de si mesmos.</span><span class="sxs-lookup"><span data-stu-id="fa439-203">Some media sinks cannot match rates with a time source other than themselves.</span></span> <span data-ttu-id="fa439-204">Nesse caso, o coletor retorna o MEDIASINK \_ não pode \_ corresponder ao \_ sinalizador Clock em seu método [**getcaracterísticas**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasink-getcharacteristics) .</span><span class="sxs-lookup"><span data-stu-id="fa439-204">If so, the sink returns the MEDIASINK\_CANNOT\_MATCH\_CLOCK flag in its [**GetCharacteristics**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasink-getcharacteristics) method.</span></span> <span data-ttu-id="fa439-205">O pipeline ainda pode usar outra fonte de tempo, mas os resultados serão menos do que o ideal.</span><span class="sxs-lookup"><span data-stu-id="fa439-205">The pipeline can still use another time source, but the results will be less than optimal.</span></span> <span data-ttu-id="fa439-206">O coletor provavelmente ficará atrás e causará problemas durante a reprodução.</span><span class="sxs-lookup"><span data-stu-id="fa439-206">The sink will likely fall behind and cause glitches during playback.</span></span>

## <a name="related-topics"></a><span data-ttu-id="fa439-207">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="fa439-207">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="fa439-208">APIs da plataforma Media Foundation</span><span class="sxs-lookup"><span data-stu-id="fa439-208">Media Foundation Platform APIs</span></span>](media-foundation-platform-apis.md)
</dt> </dl>

 

 



