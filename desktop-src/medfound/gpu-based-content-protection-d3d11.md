---
description: Este tópico descreve o conteúdo de vídeo&\# 8211; recursos de proteção que um driver de gráficos pode fornecer.
ms.assetid: 3FDB4908-C75D-4AE0-B32E-93F840E4F30A
title: GPU-Based Proteção de Conteúdo com vídeo D3D11
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 78097492d375d50688f2472f5d2de99cc21f8594
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104010306"
---
# <a name="gpu-based-content-protection-with-d3d11-video"></a><span data-ttu-id="e6083-103">GPU-Based Proteção de Conteúdo com vídeo D3D11</span><span class="sxs-lookup"><span data-stu-id="e6083-103">GPU-Based Content Protection with D3D11 Video</span></span>

<span data-ttu-id="e6083-104">Este tópico descreve o conteúdo de vídeo – recursos de proteção que um driver de gráficos pode fornecer.</span><span class="sxs-lookup"><span data-stu-id="e6083-104">This topic describes video content–protection capabilities that a graphics driver can provide.</span></span>

-   [<span data-ttu-id="e6083-105">Introdução</span><span class="sxs-lookup"><span data-stu-id="e6083-105">Introduction</span></span>](#introduction)
-   [<span data-ttu-id="e6083-106">Visão geral do processo de decodificação</span><span class="sxs-lookup"><span data-stu-id="e6083-106">Overview of the Decoding Process</span></span>](#overview-of-the-decoding-process)
-   [<span data-ttu-id="e6083-107">Criptografando buffers de vídeo compactados para o decodificador</span><span class="sxs-lookup"><span data-stu-id="e6083-107">Encrypting Compressed Video Buffers for the Decoder</span></span>](#encrypting-compressed-video-buffers-for-the-decoder)
    -   [<span data-ttu-id="e6083-108">1. consulte os recursos de Proteção de Conteúdo do driver</span><span class="sxs-lookup"><span data-stu-id="e6083-108">1. Query the Content Protection Capabilities of the Driver</span></span>](#1-query-the-content-protection-capabilities-of-the-driver)
    -   [<span data-ttu-id="e6083-109">2. configurar o canal autenticado</span><span class="sxs-lookup"><span data-stu-id="e6083-109">2. Configure the Authenticated Channel</span></span>](#2-configure-the-authenticated-channel)
    -   [<span data-ttu-id="e6083-110">3. configurar a sessão de criptografia</span><span class="sxs-lookup"><span data-stu-id="e6083-110">3. Configure the Cryptographic Session</span></span>](#3-configure-the-cryptographic-session)
    -   [<span data-ttu-id="e6083-111">4. associar o decodificador à sessão de criptografia</span><span class="sxs-lookup"><span data-stu-id="e6083-111">4. Associate the decoder with the Cryptographic Session</span></span>](#4-associate-the-decoder-with-the-cryptographic-session)
-   [<span data-ttu-id="e6083-112">Enviando comandos de canal autenticado</span><span class="sxs-lookup"><span data-stu-id="e6083-112">Sending Authenticated Channel Commands</span></span>](#sending-authenticated-channel-commands)
-   [<span data-ttu-id="e6083-113">Enviando consultas de canal autenticado</span><span class="sxs-lookup"><span data-stu-id="e6083-113">Sending Authenticated Channel Queries</span></span>](#sending-authenticated-channel-queries)
-   [<span data-ttu-id="e6083-114">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="e6083-114">Related topics</span></span>](#related-topics)

## <a name="introduction"></a><span data-ttu-id="e6083-115">Introdução</span><span class="sxs-lookup"><span data-stu-id="e6083-115">Introduction</span></span>

<span data-ttu-id="e6083-116">O diagrama a seguir mostra uma exibição simplificada de como o conteúdo de vídeo protegido passa pelo pipeline para ser renderizado.</span><span class="sxs-lookup"><span data-stu-id="e6083-116">The following diagram shows a simplified view of how protected video content travels through the pipeline to be rendered.</span></span>

![um diagrama que mostra o conteúdo de vídeo protegido.](images/d3d9video01.png)

> [!Note]
>
> <span data-ttu-id="e6083-118">O [caminho de mídia protegido](protected-media-path.md) (PMP) não está descrito neste diagrama.</span><span class="sxs-lookup"><span data-stu-id="e6083-118">The [Protected Media Path](protected-media-path.md) (PMP) is not depicted in this diagram.</span></span> <span data-ttu-id="e6083-119">O fluxo de dados mostrado aqui pode ocorrer em um processo de PMP ou em um processo de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e6083-119">The data flow that is shown here might occur within a PMP process, or within an application process.</span></span>

 

<span data-ttu-id="e6083-120">O decodificador recebe dados de vídeo criptografados e compactados de uma fonte externa.</span><span class="sxs-lookup"><span data-stu-id="e6083-120">The decoder receives encrypted, compressed video data from an external source.</span></span> <span data-ttu-id="e6083-121">Presume-se também que o decodificador também receba uma chave de criptografia para descriptografar esses dados.</span><span class="sxs-lookup"><span data-stu-id="e6083-121">It is assumed also the decoder also receives a cryptographic key to decrypt this data.</span></span> <span data-ttu-id="e6083-122">Este tópico não descreve a troca de chaves entre a fonte de vídeo e o decodificador, mas a PMP define um mecanismo possível.</span><span class="sxs-lookup"><span data-stu-id="e6083-122">This topic does not describe the key exchange between the video source and decoder, but the PMP defines one possible mechanism.</span></span> <span data-ttu-id="e6083-123">A GPU não está envolvida neste estágio.</span><span class="sxs-lookup"><span data-stu-id="e6083-123">The GPU is not involved at this stage.</span></span>

<span data-ttu-id="e6083-124">Para a decodificação acelerada por hardware, o decodificador de software passa o conteúdo de vídeo compactado para a GPU.</span><span class="sxs-lookup"><span data-stu-id="e6083-124">For hardware-accelerated decoding, the software decoder passes compressed video content to the GPU.</span></span> <span data-ttu-id="e6083-125">Para proteger esse conteúdo, o decodificador criptografa novamente os dados, normalmente usando AES-CTR, antes de passá-los para o acelerador de hardware.</span><span class="sxs-lookup"><span data-stu-id="e6083-125">To protect this content, the decoder re-encrypts the data, typically using AES-CTR, before passing it to the hardware accelerator.</span></span> <span data-ttu-id="e6083-126">Um mecanismo de troca de chaves é definido entre o decodificador e o driver de gráficos.</span><span class="sxs-lookup"><span data-stu-id="e6083-126">A key-exchange mechanism is defined between the decoder and the graphics driver.</span></span>

<span data-ttu-id="e6083-127">Os quadros de vídeo decodificados são armazenados na memória de vídeo, geralmente em claro.</span><span class="sxs-lookup"><span data-stu-id="e6083-127">Decoded video frames are stored in video memory, generally in the clear.</span></span> <span data-ttu-id="e6083-128">Neste ponto, os quadros são processados e, em seguida, apresentados.</span><span class="sxs-lookup"><span data-stu-id="e6083-128">At this point, the frames are processed and then presented.</span></span> <span data-ttu-id="e6083-129">Há duas opções principais para apresentação.</span><span class="sxs-lookup"><span data-stu-id="e6083-129">There are two main options for presentation.</span></span>

-   <span data-ttu-id="e6083-130">Ao usar a API D3D9, os quadros podem ser apresentados usando uma sobreposição de hardware.</span><span class="sxs-lookup"><span data-stu-id="e6083-130">When using the D3D9 API, frames can be presented using a hardware overlay.</span></span> <span data-ttu-id="e6083-131">Hardware sem suporte no D3D11.</span><span class="sxs-lookup"><span data-stu-id="e6083-131">Hardware overly is not supported in D3D11.</span></span> <span data-ttu-id="e6083-132">Para obter mais informações, consulte [suporte à sobreposição de hardware](hardware-overlay-support.md).</span><span class="sxs-lookup"><span data-stu-id="e6083-132">For more information, see [Hardware Overlay Support](hardware-overlay-support.md).</span></span>
-   <span data-ttu-id="e6083-133">Os quadros podem ser apresentados pelo DWM (gerenciamento de janelas da área de trabalho) usando uma superfície compartilhada.</span><span class="sxs-lookup"><span data-stu-id="e6083-133">Frames can be presented by the Desktop Window Manage (DWM) using a shared surface.</span></span>

<span data-ttu-id="e6083-134">A última etapa é exibir o quadro no monitor, o que pode exigir proteção de link entre a placa gráfica e o dispositivo de vídeo.</span><span class="sxs-lookup"><span data-stu-id="e6083-134">The last step is to display the frame on the monitor, which may require link protection between the graphics card and the display device.</span></span> <span data-ttu-id="e6083-135">Um exemplo de proteção de link é High-Bandwidth Proteção de Conteúdo Digital (HDCP).</span><span class="sxs-lookup"><span data-stu-id="e6083-135">An example of link protection is High-Bandwidth Digital Content Protection (HDCP).</span></span> <span data-ttu-id="e6083-136">A proteção de link é configurada usando o [Gerenciador de proteção de saída](output-protection-manager.md) (OPM).</span><span class="sxs-lookup"><span data-stu-id="e6083-136">Link protection is configured using [Output Protection Manager](output-protection-manager.md) (OPM).</span></span> <span data-ttu-id="e6083-137">Este tópico não descreve OPM; para obter mais informações, consulte [usando o Gerenciador de proteção de saída](using-output-protection-manager.md).</span><span class="sxs-lookup"><span data-stu-id="e6083-137">This topic does not describe OPM; for more information, see [Using Output Protection Manager](using-output-protection-manager.md).</span></span>

## <a name="overview-of-the-decoding-process"></a><span data-ttu-id="e6083-138">Visão geral do processo de decodificação</span><span class="sxs-lookup"><span data-stu-id="e6083-138">Overview of the Decoding Process</span></span>

<span data-ttu-id="e6083-139">Durante a decodificação acelerada por hardware, o decodificador de software deve passar dados de vídeo compactados para a placa gráfica.</span><span class="sxs-lookup"><span data-stu-id="e6083-139">During hardware-accelerated decoding, the software decoder must pass compressed video data to the graphics card.</span></span> <span data-ttu-id="e6083-140">Para conteúdo premium, esses dados normalmente devem ser criptografados, usando criptografia de chave simétrica, antes de serem enviados para a GPU.</span><span class="sxs-lookup"><span data-stu-id="e6083-140">For premium content, this data typically must be encrypted, using symmetric-key encryption, before it is sent to the GPU.</span></span>

<span data-ttu-id="e6083-141">Para criptografar o vídeo para decodificação, o decodificador de software usa as seguintes interfaces:</span><span class="sxs-lookup"><span data-stu-id="e6083-141">To encrypt the video for decoding, the software decoder uses the following interfaces:</span></span>

-   <span data-ttu-id="e6083-142">[**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder).</span><span class="sxs-lookup"><span data-stu-id="e6083-142">[**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder).</span></span> <span data-ttu-id="e6083-143">Representa o dispositivo decodificador, também chamado de acelerador.</span><span class="sxs-lookup"><span data-stu-id="e6083-143">Represents the decoder device, also called the accelerator.</span></span>
-   <span data-ttu-id="e6083-144">[**ID3D11CryptoSession**](/windows/desktop/api/d3d11/nn-d3d11-id3d11cryptosession).</span><span class="sxs-lookup"><span data-stu-id="e6083-144">[**ID3D11CryptoSession**](/windows/desktop/api/d3d11/nn-d3d11-id3d11cryptosession).</span></span> <span data-ttu-id="e6083-145">Representa uma sessão criptográfica, que fornece a chave de criptografia.</span><span class="sxs-lookup"><span data-stu-id="e6083-145">Represents a cryptographic session, which provides the encryption key.</span></span>
-   <span data-ttu-id="e6083-146">[**ID3D11AuthenticatedChannel**](/windows/desktop/api/d3d11/nn-d3d11-id3d11authenticatedchannel).</span><span class="sxs-lookup"><span data-stu-id="e6083-146">[**ID3D11AuthenticatedChannel**](/windows/desktop/api/d3d11/nn-d3d11-id3d11authenticatedchannel).</span></span> <span data-ttu-id="e6083-147">Representa um canal autenticado, que permite que o decodificador de software associe a sessão criptográfica ao decodificador.</span><span class="sxs-lookup"><span data-stu-id="e6083-147">Represents an authenticated channel, which enables the software decoder to associate the cryptographic session with the decoder.</span></span>

![um diagrama que mostra as interfaces de decodificação de Direct3D9.](images/d3d9video02.png)

<span data-ttu-id="e6083-149">Todas essas interfaces são obtidas do dispositivo Direct3D11, da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="e6083-149">All of these interfaces are obtained from the Direct3D11 device, as follows:</span></span>



| <span data-ttu-id="e6083-150">Interface</span><span class="sxs-lookup"><span data-stu-id="e6083-150">Interface</span></span>                                                        | <span data-ttu-id="e6083-151">Criação</span><span class="sxs-lookup"><span data-stu-id="e6083-151">Creation</span></span>                                                                                                                                                |
|------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="e6083-152">**ID3D11VideoDecoder**</span><span class="sxs-lookup"><span data-stu-id="e6083-152">**ID3D11VideoDecoder**</span></span>](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder)                 | <span data-ttu-id="e6083-153">Chame [**ID3D11VideoDevice:: CreateVideoDecoder**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoderoutputview).</span><span class="sxs-lookup"><span data-stu-id="e6083-153">Call [**ID3D11VideoDevice::CreateVideoDecoder**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoderoutputview).</span></span> <span data-ttu-id="e6083-154">O tipo de decodificador é identificado por um GUID de perfil.</span><span class="sxs-lookup"><span data-stu-id="e6083-154">The decoder type is identified by a profile GUID.</span></span> |
| [<span data-ttu-id="e6083-155">**ID3D11CryptoSession**</span><span class="sxs-lookup"><span data-stu-id="e6083-155">**ID3D11CryptoSession**</span></span>](/windows/desktop/api/d3d11/nn-d3d11-id3d11cryptosession)               | <span data-ttu-id="e6083-156">Chame [**ID3D11VideoDevice:: CreateCryptoSession**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createcryptosession).</span><span class="sxs-lookup"><span data-stu-id="e6083-156">Call [**ID3D11VideoDevice::CreateCryptoSession**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createcryptosession).</span></span>                                                           |
| [<span data-ttu-id="e6083-157">**ID3D11AuthenticatedChannel**</span><span class="sxs-lookup"><span data-stu-id="e6083-157">**ID3D11AuthenticatedChannel**</span></span>](/windows/desktop/api/d3d11/nn-d3d11-id3d11authenticatedchannel) | <span data-ttu-id="e6083-158">Chame [**ID3D11VideoDevice:: CreateAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createauthenticatedchannel).</span><span class="sxs-lookup"><span data-stu-id="e6083-158">Call [**ID3D11VideoDevice::CreateAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createauthenticatedchannel).</span></span>                                             |



 

> [!Note]  
> <span data-ttu-id="e6083-159">Para obter um ponteiro para a interface [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) , chame [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) na interface [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) .</span><span class="sxs-lookup"><span data-stu-id="e6083-159">To get a pointer to the [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) interface, call [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) on [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) interface.</span></span>

 

<span data-ttu-id="e6083-160">O canal autenticado fornece um canal de comunicação confiável entre o decodificador de software e o driver.</span><span class="sxs-lookup"><span data-stu-id="e6083-160">The authenticated channel provides a trusted communication channel between the software decoder and the driver.</span></span> <span data-ttu-id="e6083-161">O canal de comunicação funciona da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="e6083-161">The communication channel works as follows:</span></span>

-   <span data-ttu-id="e6083-162">O driver fornece uma cadeia de certificados X. 509 cujo certificado raiz é assinado pela Microsoft.</span><span class="sxs-lookup"><span data-stu-id="e6083-162">The driver provides an X.509 certificate chain whose root certificate is signed by Microsoft.</span></span>
-   <span data-ttu-id="e6083-163">O certificado contém uma chave pública RSA para o driver.</span><span class="sxs-lookup"><span data-stu-id="e6083-163">The certificate contains an RSA public key for the driver.</span></span>
-   <span data-ttu-id="e6083-164">O decodificador de software usa a chave pública para enviar o driver a uma chave de sessão AES de 128 bits.</span><span class="sxs-lookup"><span data-stu-id="e6083-164">The software decoder uses the public key to send the driver a 128-bit AES session key.</span></span>
-   <span data-ttu-id="e6083-165">O decodificador de software envia consultas e comandos para o canal autenticado.</span><span class="sxs-lookup"><span data-stu-id="e6083-165">The software decoder sends queries and commands to the authenticated channel.</span></span>
-   <span data-ttu-id="e6083-166">A chave de sessão é usada para computar MACs (códigos de autenticação de mensagem) para as consultas e comandos.</span><span class="sxs-lookup"><span data-stu-id="e6083-166">The session key is used to compute message authentication codes (MACs) for the queries and commands.</span></span> <span data-ttu-id="e6083-167">O driver usa os MACs para verificar a integridade dos dados de consulta/comando, e o decodificador de software os usa para verificar a integridade dos dados de resposta do driver.</span><span class="sxs-lookup"><span data-stu-id="e6083-167">The driver uses the MACs to verify the integrity of the query/command data, and the software decoder uses them to verify the integrity of the response data from the driver.</span></span>

## <a name="encrypting-compressed-video-buffers-for-the-decoder"></a><span data-ttu-id="e6083-168">Criptografando buffers de vídeo compactados para o decodificador</span><span class="sxs-lookup"><span data-stu-id="e6083-168">Encrypting Compressed Video Buffers for the Decoder</span></span>

<span data-ttu-id="e6083-169">Aqui está uma visão geral de alto nível do processo de criptografia e decodificação:</span><span class="sxs-lookup"><span data-stu-id="e6083-169">Here is a high-level overview of the encryption and decoding process:</span></span>

1.  <span data-ttu-id="e6083-170">O decodificador de software recebe um fluxo de dados criptografados da fonte de vídeo.</span><span class="sxs-lookup"><span data-stu-id="e6083-170">The software decoder receives a stream of encrypted data from the video source.</span></span> <span data-ttu-id="e6083-171">O decodificador descriptografa esse fluxo.</span><span class="sxs-lookup"><span data-stu-id="e6083-171">The decoder decrypts this stream.</span></span>
2.  <span data-ttu-id="e6083-172">O decodificador de software negocia uma chave de sessão com a sessão criptográfica.</span><span class="sxs-lookup"><span data-stu-id="e6083-172">The software decoder negotiates a session key with the cryptographic session.</span></span>
3.  <span data-ttu-id="e6083-173">O decodificador de software usa o canal autenticado para associar a sessão criptográfica ao dispositivo decodificador.</span><span class="sxs-lookup"><span data-stu-id="e6083-173">The software decoder uses the authenticated channel to associate the cryptographic session with the decoder device.</span></span>
4.  <span data-ttu-id="e6083-174">O decodificador de software coloca dados compactados em buffers que obtém do dispositivo decodificador (acelerador).</span><span class="sxs-lookup"><span data-stu-id="e6083-174">The software decoder puts compressed data in buffers that it gets from the decoder device (accelerator).</span></span> <span data-ttu-id="e6083-175">Para conteúdo protegido, o codificador de software criptografa os dados que são colocados nos buffers, usando a chave de sessão para a criptografia.</span><span class="sxs-lookup"><span data-stu-id="e6083-175">For protected content, the software encoder encrypts the data that is puts into the buffers, using the session key for the encryption.</span></span>
    > [!Note]  
    > <span data-ttu-id="e6083-176">Alguns drivers usam uma chave de conteúdo, em vez da chave de sessão, para criptografia.</span><span class="sxs-lookup"><span data-stu-id="e6083-176">Some drivers use a content key, instead of the session key, for encryption.</span></span> <span data-ttu-id="e6083-177">A chave de conteúdo pode mudar de um quadro para o outro.</span><span class="sxs-lookup"><span data-stu-id="e6083-177">The content key could change from one frame to the next.</span></span>

     

5.  <span data-ttu-id="e6083-178">O decodificador envia os buffers compactados criptografados para o acelerador.</span><span class="sxs-lookup"><span data-stu-id="e6083-178">The decoder submits the encrypted compressed buffers to the accelerator.</span></span> <span data-ttu-id="e6083-179">Para AES-CTR, o decodificador também passa o vetor de inicialização.</span><span class="sxs-lookup"><span data-stu-id="e6083-179">For AES-CTR, the decoder also passes the initialization vector.</span></span> <span data-ttu-id="e6083-180">Se uma chave de conteúdo for usada, o decodificador passará a chave de conteúdo, criptografada usando a chave de sessão.</span><span class="sxs-lookup"><span data-stu-id="e6083-180">If a content key is used, the decoder passes the content key, encrypted using the session key.</span></span>

<span data-ttu-id="e6083-181">O Direct3D11 tem suporte padrão para o AES-CTR de 128 bits, mas foi projetado para estender para tipos de criptografia adicionais.</span><span class="sxs-lookup"><span data-stu-id="e6083-181">Direct3D11 has standard support for 128-bit AES-CTR, but is designed to extend to additional encryption types.</span></span>

<span data-ttu-id="e6083-182">As próximas cinco seções fornecem etapas mais detalhadas.</span><span class="sxs-lookup"><span data-stu-id="e6083-182">The next five sections give more detailed steps.</span></span>

-   [<span data-ttu-id="e6083-183">1. consulte os recursos de Proteção de Conteúdo do driver</span><span class="sxs-lookup"><span data-stu-id="e6083-183">1. Query the Content Protection Capabilities of the Driver</span></span>](#1-query-the-content-protection-capabilities-of-the-driver)
-   [<span data-ttu-id="e6083-184">2. configurar o canal autenticado</span><span class="sxs-lookup"><span data-stu-id="e6083-184">2. Configure the Authenticated Channel</span></span>](#2-configure-the-authenticated-channel)
-   [<span data-ttu-id="e6083-185">3. configurar a sessão de criptografia</span><span class="sxs-lookup"><span data-stu-id="e6083-185">3. Configure the Cryptographic Session</span></span>](#3-configure-the-cryptographic-session)
-   [<span data-ttu-id="e6083-186">4. associar o decodificador à sessão de criptografia</span><span class="sxs-lookup"><span data-stu-id="e6083-186">4. Associate the decoder with the Cryptographic Session</span></span>](#4-associate-the-decoder-with-the-cryptographic-session)

### <a name="1-query-the-content-protection-capabilities-of-the-driver"></a><span data-ttu-id="e6083-187">1. consulte os recursos de Proteção de Conteúdo do driver</span><span class="sxs-lookup"><span data-stu-id="e6083-187">1. Query the Content Protection Capabilities of the Driver</span></span>

<span data-ttu-id="e6083-188">Antes de tentar aplicar a criptografia, obtenha os recursos de proteção de conteúdo do driver.</span><span class="sxs-lookup"><span data-stu-id="e6083-188">Before attempting to apply encryption, get the content protection capabilities of the driver.</span></span>

1.  <span data-ttu-id="e6083-189">Obtenha um ponteiro para a interface ID3D11Device.</span><span class="sxs-lookup"><span data-stu-id="e6083-189">Get a pointer to the ID3D11Device interface.</span></span>
2.  <span data-ttu-id="e6083-190">Chame [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) para a interface [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) .</span><span class="sxs-lookup"><span data-stu-id="e6083-190">Call [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) for the [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) interface.</span></span>
3.  <span data-ttu-id="e6083-191">Chame [**ID3D11VideoDevice:: GetContentProtectionCaps**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getcontentprotectioncaps).</span><span class="sxs-lookup"><span data-stu-id="e6083-191">Call [**ID3D11VideoDevice::GetContentProtectionCaps**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getcontentprotectioncaps).</span></span> <span data-ttu-id="e6083-192">Esse método preenche uma estrutura de [**D3D11_VIDEO_CONTENT_PROTECTION_CAPS**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_content_protection_caps) com os recursos de proteção de conteúdo do driver.</span><span class="sxs-lookup"><span data-stu-id="e6083-192">This method fills in a [**D3D11_VIDEO_CONTENT_PROTECTION_CAPS**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_content_protection_caps) structure with the driver’s content protection capabilities.</span></span>

<span data-ttu-id="e6083-193">Em particular, procure os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="e6083-193">In particular, look for the following capabilities:</span></span>

-   <span data-ttu-id="e6083-194">Se o membro **Caps** contiver o sinalizador **D3D11_CONTENT_PROTECTION_CAPS_SOFTWARE** ou **D3D11_CONTENT_PROTECTION_CAPS_HARDWARE** , o driver poderá executar a criptografia.</span><span class="sxs-lookup"><span data-stu-id="e6083-194">If the **Caps** member contains the **D3D11_CONTENT_PROTECTION_CAPS_SOFTWARE** or **D3D11_CONTENT_PROTECTION_CAPS_HARDWARE** flag, the driver can perform encryption.</span></span>
-   <span data-ttu-id="e6083-195">Se o membro **Caps** contiver o sinalizador **D3D11_CONTENT_PROTECTION_CAPS_CONTENT_KEY** , o driver usará uma chave de conteúdo separada para descriptografia.</span><span class="sxs-lookup"><span data-stu-id="e6083-195">If the **Caps** member contains the **D3D11_CONTENT_PROTECTION_CAPS_CONTENT_KEY** flag, the driver uses a separate content key for decryption.</span></span>
-   <span data-ttu-id="e6083-196">Chame [**ID3D11VideoDevice:: CheckCryptoKeyExchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-checkcryptokeyexchange) para determinar os tipos de trocas de chave que o driver suporta para gerar a chave de sessão.</span><span class="sxs-lookup"><span data-stu-id="e6083-196">Call [**ID3D11VideoDevice::CheckCryptoKeyExchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-checkcryptokeyexchange) to determine which types of key exchanges the driver supports for generating the session key.</span></span>

<span data-ttu-id="e6083-197">Recursos adicionais são indicados no membro **Caps** .</span><span class="sxs-lookup"><span data-stu-id="e6083-197">Additional capabilities are indicated in the **Caps** member.</span></span>

### <a name="2-configure-the-authenticated-channel"></a><span data-ttu-id="e6083-198">2. configurar o canal autenticado</span><span class="sxs-lookup"><span data-stu-id="e6083-198">2. Configure the Authenticated Channel</span></span>

<span data-ttu-id="e6083-199">A próxima etapa é configurar o canal autenticado.</span><span class="sxs-lookup"><span data-stu-id="e6083-199">The next step is to configure the authenticated channel.</span></span>

1.  <span data-ttu-id="e6083-200">Chame [**ID3D11VideoDevice:: CreateAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createauthenticatedchannel) para criar o canal autenticado.</span><span class="sxs-lookup"><span data-stu-id="e6083-200">Call [**ID3D11VideoDevice::CreateAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createauthenticatedchannel) to create the authenticated channel.</span></span> <span data-ttu-id="e6083-201">Para o parâmetro *channelType* , especifique um tipo de canal que corresponda aos recursos do driver.</span><span class="sxs-lookup"><span data-stu-id="e6083-201">For the *ChannelType* parameter, specify a channel type that matches the capabilities of the driver.</span></span>
    -   <span data-ttu-id="e6083-202">O tipo de canal **D3D11_AUTHENTICATED_CHANNEL_DRIVER_SOFTWARE** corresponde a **D3D11_CONTENT_PROTECTION_CAPS_SOFTWARE**.</span><span class="sxs-lookup"><span data-stu-id="e6083-202">The **D3D11_AUTHENTICATED_CHANNEL_DRIVER_SOFTWARE** channel type corresponds to **D3D11_CONTENT_PROTECTION_CAPS_SOFTWARE**.</span></span>
    -   <span data-ttu-id="e6083-203">O tipo de canal **D3D11_AUTHENTICATED_CHANNEL_DRIVER_HARDWARE** corresponde a **D3D11_CONTENT_PROTECTION_CAPS_HARDWARE**.</span><span class="sxs-lookup"><span data-stu-id="e6083-203">The **D3D11_AUTHENTICATED_CHANNEL_DRIVER_HARDWARE** channel type corresponds to **D3D11_CONTENT_PROTECTION_CAPS_HARDWARE**.</span></span>

    <span data-ttu-id="e6083-204">O método **CreateAuthenticatedChannel** retorna um ponteiro para a interface [**ID3D11AuthenticatedChannel**](/windows/desktop/api/d3d11/nn-d3d11-id3d11authenticatedchannel) .</span><span class="sxs-lookup"><span data-stu-id="e6083-204">The **CreateAuthenticatedChannel** method returns a pointer to the [**ID3D11AuthenticatedChannel**](/windows/desktop/api/d3d11/nn-d3d11-id3d11authenticatedchannel) interface.</span></span>
2.  <span data-ttu-id="e6083-205">Chame [**ID3D11AuthenticatedChannel:: Getcertificates**](/windows/desktop/api/d3d11/nf-d3d11-id3d11authenticatedchannel-getcertificatesize) para obter o tamanho do certificado X. 509 do driver.</span><span class="sxs-lookup"><span data-stu-id="e6083-205">Call [**ID3D11AuthenticatedChannel::GetCertificateSize**](/windows/desktop/api/d3d11/nf-d3d11-id3d11authenticatedchannel-getcertificatesize) to get the size of the driver's X.509 certificate.</span></span> <span data-ttu-id="e6083-206">Aloque um buffer do tamanho necessário.</span><span class="sxs-lookup"><span data-stu-id="e6083-206">Allocate a buffer of the required size.</span></span>
3.  <span data-ttu-id="e6083-207">Chame [**ID3D11AuthenticatedChannel:: Getcertificate**](/windows/desktop/api/d3d11/nf-d3d11-id3d11authenticatedchannel-getcertificate) para obter o certificado.</span><span class="sxs-lookup"><span data-stu-id="e6083-207">Call [**ID3D11AuthenticatedChannel::GetCertificate**](/windows/desktop/api/d3d11/nf-d3d11-id3d11authenticatedchannel-getcertificate) to get the certificate.</span></span> <span data-ttu-id="e6083-208">O método copia o certificado no buffer que foi alocado na etapa anterior.</span><span class="sxs-lookup"><span data-stu-id="e6083-208">The method copies the certificate into the buffer that was allocated in the previous step.</span></span>
4.  <span data-ttu-id="e6083-209">Verifique se o certificado do driver foi assinado pela Microsoft e não foi revogado.</span><span class="sxs-lookup"><span data-stu-id="e6083-209">Verify that the driver’s certificate was signed by Microsoft and has not been revoked.</span></span>
5.  <span data-ttu-id="e6083-210">Obtenha a chave pública do certificado.</span><span class="sxs-lookup"><span data-stu-id="e6083-210">Get the public key from the certificate.</span></span>
6.  <span data-ttu-id="e6083-211">Gere uma chave de sessão de RSA aleatória.</span><span class="sxs-lookup"><span data-stu-id="e6083-211">Generate a random RSA session key.</span></span> <span data-ttu-id="e6083-212">Essa chave de sessão é usada para assinar dados que são enviados para o canal autenticado.</span><span class="sxs-lookup"><span data-stu-id="e6083-212">This session key is used to sign data that is sent to the authenticated channel.</span></span> <span data-ttu-id="e6083-213">Criptografe a chave de sessão usando a chave pública do driver.</span><span class="sxs-lookup"><span data-stu-id="e6083-213">Encrypt the session key using the driver's public key.</span></span>
7.  <span data-ttu-id="e6083-214">Chame [**ID3D11VideoContext:: NegotiateAuthenticatedChannelKeyExchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-negotiateauthenticatedchannelkeyexchange) para enviar a chave de sessão criptografada para o driver.</span><span class="sxs-lookup"><span data-stu-id="e6083-214">Call [**ID3D11VideoContext::NegotiateAuthenticatedChannelKeyExchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-negotiateauthenticatedchannelkeyexchange) to send the encrypted session key to the driver.</span></span>
8.  <span data-ttu-id="e6083-215">Inicialize o canal seguro da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="e6083-215">Initialize the secure channel as follows:</span></span>
    1.  <span data-ttu-id="e6083-216">Preencha uma estrutura de [**D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input) , conforme descrito na documentação.</span><span class="sxs-lookup"><span data-stu-id="e6083-216">Fill in a [**D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input) structure as described in the documentation.</span></span>
    2.  <span data-ttu-id="e6083-217">Envie o comando [**D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input) chamando [**ID3D11VideoContext:: ConfigureAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel) conforme descrito na seção [enviando comandos de canal autenticados](#sending-authenticated-channel-commands).</span><span class="sxs-lookup"><span data-stu-id="e6083-217">Send the [**D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input) command by calling [**ID3D11VideoContext::ConfigureAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel) as described in the section [Sending Authenticated Channel Commands](#sending-authenticated-channel-commands).</span></span> <span data-ttu-id="e6083-218">Esse comando contém os números de sequência iniciais para os comandos e consultas que são enviados para o canal autenticado.</span><span class="sxs-lookup"><span data-stu-id="e6083-218">This command contains the starting sequence numbers for the commands and queries that are sent to the authenticated channel.</span></span>
9.  <span data-ttu-id="e6083-219">Verifique o tipo de canal enviando uma consulta [**D3D11_AUTHENTICATED_QUERY_CHANNEL_TYPE**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_channel_type_output) para o canal autenticado, conforme descrito na seção [enviando consultas de canal autenticado](#sending-authenticated-channel-queries).</span><span class="sxs-lookup"><span data-stu-id="e6083-219">Verify the channel type by sending a [**D3D11_AUTHENTICATED_QUERY_CHANNEL_TYPE**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_channel_type_output) query to the authenticated channel, as described in the section [Sending Authenticated Channel Queries](#sending-authenticated-channel-queries).</span></span> <span data-ttu-id="e6083-220">Verifique se o tipo de canal corresponde ao que você especificou no método [**CreateAuthenticatedChannel**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9video-createauthenticatedchannel) .</span><span class="sxs-lookup"><span data-stu-id="e6083-220">Check that the channel type matches what you specified in the [**CreateAuthenticatedChannel**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9video-createauthenticatedchannel) method.</span></span>

### <a name="3-configure-the-cryptographic-session"></a><span data-ttu-id="e6083-221">3. configurar a sessão de criptografia</span><span class="sxs-lookup"><span data-stu-id="e6083-221">3. Configure the Cryptographic Session</span></span>

<span data-ttu-id="e6083-222">Em seguida, configure a sessão de criptografia e estabeleça a chave de sessão.</span><span class="sxs-lookup"><span data-stu-id="e6083-222">Next, configure the cryptographic session and establish the session key.</span></span>

1.  <span data-ttu-id="e6083-223">Chame [**ID3D11VideoDevice:: CreateCryptoSession**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createcryptosession) para criar a sessão criptográfica.</span><span class="sxs-lookup"><span data-stu-id="e6083-223">Call [**ID3D11VideoDevice::CreateCryptoSession**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createcryptosession) to create the cryptographic session.</span></span> <span data-ttu-id="e6083-224">Esse método retorna um ponteiro para a interface [**ID3D11CryptoSession**](/windows/desktop/api/d3d11/nn-d3d11-id3d11cryptosession) .</span><span class="sxs-lookup"><span data-stu-id="e6083-224">This method returns a pointer to the [**ID3D11CryptoSession**](/windows/desktop/api/d3d11/nn-d3d11-id3d11cryptosession) interface.</span></span>
2.  <span data-ttu-id="e6083-225">Chame [**ID3D11CryptoSession:: Getcertificates**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcertificatesize) para obter o tamanho do certificado X. 509 do driver.</span><span class="sxs-lookup"><span data-stu-id="e6083-225">Call [**ID3D11CryptoSession::GetCertificateSize**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcertificatesize) to get the size of the driver's X.509 certificate.</span></span> <span data-ttu-id="e6083-226">Aloque um buffer do tamanho necessário.</span><span class="sxs-lookup"><span data-stu-id="e6083-226">Allocate a buffer of the required size.</span></span>
3.  <span data-ttu-id="e6083-227">Chame [**ID3D11CryptoSession:: Getcertificate**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcertificate) para obter o certificado.</span><span class="sxs-lookup"><span data-stu-id="e6083-227">Call [**ID3D11CryptoSession::GetCertificate**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcertificate) to get the certificate.</span></span> <span data-ttu-id="e6083-228">O método copia o certificado no buffer que foi alocado na etapa anterior.</span><span class="sxs-lookup"><span data-stu-id="e6083-228">The method copies the certificate into the buffer that was allocated in the previous step.</span></span>
4.  <span data-ttu-id="e6083-229">Verifique se o certificado do driver foi assinado pela Microsoft e não foi revogado.</span><span class="sxs-lookup"><span data-stu-id="e6083-229">Verify that the driver’s certificate was signed by Microsoft and has not been revoked.</span></span>
5.  <span data-ttu-id="e6083-230">Obtenha a chave pública do certificado.</span><span class="sxs-lookup"><span data-stu-id="e6083-230">Get the public key from the certificate.</span></span>
6.  <span data-ttu-id="e6083-231">Gere uma chave de sessão de RSA aleatória.</span><span class="sxs-lookup"><span data-stu-id="e6083-231">Generate a random RSA session key.</span></span> <span data-ttu-id="e6083-232">Essa é uma chave de sessão separada da chave de sessão de canal autenticado.</span><span class="sxs-lookup"><span data-stu-id="e6083-232">This is a separate session key from the authenticated channel session key.</span></span> <span data-ttu-id="e6083-233">Criptografe a chave de sessão usando a chave pública do driver.</span><span class="sxs-lookup"><span data-stu-id="e6083-233">Encrypt the session key using the driver's public key.</span></span>
7.  <span data-ttu-id="e6083-234">Chame [**ID3D11VideoContext:: NegotiateCryptoSessionKeyExchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-negotiatecryptosessionkeyexchange) para enviar a chave de sessão criptografada para o driver.</span><span class="sxs-lookup"><span data-stu-id="e6083-234">Call [**ID3D11VideoContext::NegotiateCryptoSessionKeyExchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-negotiatecryptosessionkeyexchange) to send the encrypted session key to the driver.</span></span>
8.  <span data-ttu-id="e6083-235">Se os recursos de proteção de conteúdo incluírem **3D11_CONTENT_PROTECTION_CAPS_CONTENT_KEY**, crie uma chave de conteúdo de RSA aleatória.</span><span class="sxs-lookup"><span data-stu-id="e6083-235">If the content protection capabilities include **3D11_CONTENT_PROTECTION_CAPS_CONTENT_KEY**, create a random RSA content key.</span></span> <span data-ttu-id="e6083-236">Isso será usado posteriormente no processo de decodificação.</span><span class="sxs-lookup"><span data-stu-id="e6083-236">This will be used later in the decoding process.</span></span>

### <a name="4-associate-the-decoder-with-the-cryptographic-session"></a><span data-ttu-id="e6083-237">4. associar o decodificador à sessão de criptografia</span><span class="sxs-lookup"><span data-stu-id="e6083-237">4. Associate the decoder with the Cryptographic Session</span></span>

<span data-ttu-id="e6083-238">Em seguida, associe o dispositivo decodificador ao dispositivo Direct3D11 e a sessão criptográfica, da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="e6083-238">Next, associate the decoder device with the Direct3D11 device and the cryptographic session, as follows:</span></span>

1.  <span data-ttu-id="e6083-239">Obtenha um identificador para o dispositivo Direct3D11, enviando uma consulta de [**D3D11_AUTHENTICATED_QUERY_DEVICE_HANDLE**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_device_handle_output) para o canal autenticado.</span><span class="sxs-lookup"><span data-stu-id="e6083-239">Get a handle to the Direct3D11 device, by sending a [**D3D11_AUTHENTICATED_QUERY_DEVICE_HANDLE**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_device_handle_output) query to the authenticated channel.</span></span>
2.  <span data-ttu-id="e6083-240">Preencha uma estrutura de [**D3D11_AUTHENTICATED_CONFIGURE_CRYPTO_SESSION_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_crypto_session_input) com as seguintes informações:</span><span class="sxs-lookup"><span data-stu-id="e6083-240">Fill in a [**D3D11_AUTHENTICATED_CONFIGURE_CRYPTO_SESSION_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_crypto_session_input) structure with the following information:</span></span>
    -   <span data-ttu-id="e6083-241">Defina o membro **DecodeHandle** para o identificador retornado de [**ID3D11VideoDecoder:: GetDriverHandle**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodecoder-getdriverhandle).</span><span class="sxs-lookup"><span data-stu-id="e6083-241">Set the **DecodeHandle** member to the handle returned from [**ID3D11VideoDecoder::GetDriverHandle**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodecoder-getdriverhandle).</span></span>
    -   <span data-ttu-id="e6083-242">Defina o membro **CryptoSessionHandle** para o identificador retornado de [**ID3D11CryptoSession:: GetCryptoSessionHandle**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcryptosessionhandle).</span><span class="sxs-lookup"><span data-stu-id="e6083-242">Set the **CryptoSessionHandle** member to the handle returned from [**ID3D11CryptoSession::GetCryptoSessionHandle**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcryptosessionhandle).</span></span>
    -   <span data-ttu-id="e6083-243">Defina o membro **DeviceHandle** para o identificador do dispositivo Direct3D11.</span><span class="sxs-lookup"><span data-stu-id="e6083-243">Set the **DeviceHandle** member to the Direct3D11 device handle.</span></span>
3.  <span data-ttu-id="e6083-244">Chame [**ID3D11VideoContext:: ConfigureAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel) para enviar um comando [**D3D11_AUTHENTICATED_CONFIGURE_CRYPTO_SESSION**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_crypto_session_input) para o canal autenticado.</span><span class="sxs-lookup"><span data-stu-id="e6083-244">Call [**ID3D11VideoContext::ConfigureAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel) to send a [**D3D11_AUTHENTICATED_CONFIGURE_CRYPTO_SESSION**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_crypto_session_input) command to the authenticated channel.</span></span>

<span data-ttu-id="e6083-245">O diagrama a seguir ilustra a troca de identificadores:</span><span class="sxs-lookup"><span data-stu-id="e6083-245">The following diagram illustrates the exchange of handles:</span></span>

![um diagrama que mostra como o decodificador DXVA está associado à sessão criptográfica.](images/d3d9video03.png)

<span data-ttu-id="e6083-247">O decodificador de software agora pode usar a chave de sessão de criptografia para criptografar os buffers de vídeo compactados.</span><span class="sxs-lookup"><span data-stu-id="e6083-247">The software decoder can now use the cryptographic session key to encrypt the compressed video buffers.</span></span> <span data-ttu-id="e6083-248">Cada buffer compactado terá seu próprio vetor de inicialização (IV) especificado no membro **pIV** da estrutura de [**D3D11_VIDEO_DECODER_BUFFER_DESC**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_decoder_buffer_desc) .</span><span class="sxs-lookup"><span data-stu-id="e6083-248">Each compressed buffer will have its own initialization vector (IV) specified in the **pIV** member of the [**D3D11_VIDEO_DECODER_BUFFER_DESC**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_decoder_buffer_desc) structure.</span></span>

## <a name="sending-authenticated-channel-commands"></a><span data-ttu-id="e6083-249">Enviando comandos de canal autenticado</span><span class="sxs-lookup"><span data-stu-id="e6083-249">Sending Authenticated Channel Commands</span></span>

<span data-ttu-id="e6083-250">Um conjunto de comandos é definido para configurar o canal autenticado e definir várias proteções de conteúdo.</span><span class="sxs-lookup"><span data-stu-id="e6083-250">A set of commands are defined for configuring the authenticated channel and setting various content protections.</span></span> <span data-ttu-id="e6083-251">Para obter uma lista de comandos, consulte [proteção de conteúdo comandos](content-protection-commands.md).</span><span class="sxs-lookup"><span data-stu-id="e6083-251">For a list of commands, see [Content Protection Commands](content-protection-commands.md).</span></span>

<span data-ttu-id="e6083-252">Para enviar um comando para o canal autenticado, execute as etapas a seguir.</span><span class="sxs-lookup"><span data-stu-id="e6083-252">To send a command to the authenticated channel, perform the following steps.</span></span>

1.  <span data-ttu-id="e6083-253">Preencha a estrutura de dados de entrada.</span><span class="sxs-lookup"><span data-stu-id="e6083-253">Fill in the input data structure.</span></span> <span data-ttu-id="e6083-254">Essa estrutura de dados é sempre uma estrutura de [**D3D11_AUTHENTICATED_CONFIGURE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_input) seguida por campos adicionais.</span><span class="sxs-lookup"><span data-stu-id="e6083-254">This data structure is always a [**D3D11_AUTHENTICATED_CONFIGURE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_input) structure followed by additional fields.</span></span> <span data-ttu-id="e6083-255">Preencha a estrutura de **D3D11_AUTHENTICATED_CONFIGURE_INPUT** , conforme mostrado na tabela a seguir.</span><span class="sxs-lookup"><span data-stu-id="e6083-255">Fill in the **D3D11_AUTHENTICATED_CONFIGURE_INPUT** structure as shown in the following table.</span></span>

    <table>
    <colgroup>
    <col style="width: 50%" />
    <col style="width: 50%" />
    </colgroup>
    <thead>
    <tr class="header">
    <th><span data-ttu-id="e6083-256">Membro</span><span class="sxs-lookup"><span data-stu-id="e6083-256">Member</span></span></th>
    <th><span data-ttu-id="e6083-257">DESCRIÇÃO</span><span class="sxs-lookup"><span data-stu-id="e6083-257">Description</span></span></th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td><span data-ttu-id="e6083-258"><strong>omac</strong></span><span class="sxs-lookup"><span data-stu-id="e6083-258"><strong>omac</strong></span></span></td>
    <td><span data-ttu-id="e6083-259">Ignore este campo por enquanto.</span><span class="sxs-lookup"><span data-stu-id="e6083-259">Skip this field for now.</span></span></td>
    </tr>
    <tr class="even">
    <td><span data-ttu-id="e6083-260"><strong>Configuratype</strong></span><span class="sxs-lookup"><span data-stu-id="e6083-260"><strong>ConfigureType</strong></span></span></td>
    <td><span data-ttu-id="e6083-261">GUID que identifica o comando.</span><span class="sxs-lookup"><span data-stu-id="e6083-261">GUID that identifies the command.</span></span> <span data-ttu-id="e6083-262">Para obter uma lista de comandos, consulte <a href="content-protection-commands.md">proteção de conteúdo comandos</a>.</span><span class="sxs-lookup"><span data-stu-id="e6083-262">For a list of commands, see <a href="content-protection-commands.md">Content Protection Commands</a>.</span></span></td>
    </tr>
    <tr class="odd">
    <td><span data-ttu-id="e6083-263"><strong>hChannel</strong></span><span class="sxs-lookup"><span data-stu-id="e6083-263"><strong>hChannel</strong></span></span></td>
    <td><span data-ttu-id="e6083-264">O identificador para o canal autenticado.</span><span class="sxs-lookup"><span data-stu-id="e6083-264">The handle to the authenticated channel.</span></span></td>
    </tr>
    <tr class="even">
    <td><span data-ttu-id="e6083-265"><strong>SequenceNumber</strong></span><span class="sxs-lookup"><span data-stu-id="e6083-265"><strong>SequenceNumber</strong></span></span></td>
    <td><span data-ttu-id="e6083-266">O número de sequência.</span><span class="sxs-lookup"><span data-stu-id="e6083-266">The sequence number.</span></span> <span data-ttu-id="e6083-267">O primeiro número de sequência é especificado com o envio de um comando <a href="/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input"><strong>D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE</strong></a> .</span><span class="sxs-lookup"><span data-stu-id="e6083-267">The first sequence number is specified by sending a <a href="/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input"><strong>D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE</strong></a> command.</span></span> <span data-ttu-id="e6083-268">Cada vez que você enviar outro comando, aumente esse número em 1.</span><span class="sxs-lookup"><span data-stu-id="e6083-268">Each time you send another command, increment this number by 1.</span></span> <span data-ttu-id="e6083-269">O número de sequência protege contra ataques de repetição.</span><span class="sxs-lookup"><span data-stu-id="e6083-269">The sequence number guards against replay attacks.</span></span>
    <blockquote>
    [!Note]<br />
<span data-ttu-id="e6083-270">Dois números de sequência separados são usados, um para comandos e outro para consultas.</span><span class="sxs-lookup"><span data-stu-id="e6083-270">Two separate sequence numbers are used, one for commands and one for queries.</span></span>
    </blockquote>
    <br/> <br/></td>
    </tr>
    </tbody>
    </table>

    

     

2.  <span data-ttu-id="e6083-271">Calcule a marca OMAC para o bloco de dados que aparece após o membro **OMAC** da estrutura de entrada.</span><span class="sxs-lookup"><span data-stu-id="e6083-271">Calculate the OMAC tag for the block of data that appears after the **omac** member of the input structure.</span></span> <span data-ttu-id="e6083-272">Em seguida, copie esse valor de marca para o membro **OMAC** .</span><span class="sxs-lookup"><span data-stu-id="e6083-272">Then copy this tag value into the **omac** member.</span></span>
3.  <span data-ttu-id="e6083-273">Chame [**ID3D11VideoContext:: ConfigureAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel).</span><span class="sxs-lookup"><span data-stu-id="e6083-273">Call [**ID3D11VideoContext::ConfigureAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel).</span></span>
4.  <span data-ttu-id="e6083-274">O driver coloca a saída do comando na estrutura de [**D3D11_AUTHENTICATED_CONFIGURE_OUTPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_output) .</span><span class="sxs-lookup"><span data-stu-id="e6083-274">The driver places the output from the command in the [**D3D11_AUTHENTICATED_CONFIGURE_OUTPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_output) structure.</span></span>
5.  <span data-ttu-id="e6083-275">Calcule a marca OMAC para o bloco de dados que aparece após o membro **OMAC** da estrutura de saída.</span><span class="sxs-lookup"><span data-stu-id="e6083-275">Calculate the OMAC tag for the block of data that appears after the **omac** member of the output structure.</span></span> <span data-ttu-id="e6083-276">Compare isso com o valor do membro **OMAC** .</span><span class="sxs-lookup"><span data-stu-id="e6083-276">Compare this with the value of the **omac** member.</span></span> <span data-ttu-id="e6083-277">Falha se eles não corresponderem.</span><span class="sxs-lookup"><span data-stu-id="e6083-277">Fail if they do not match.</span></span>
6.  <span data-ttu-id="e6083-278">Compare os valores dos membros **configuratype**, **hChannel** e **SequenceNumber** na estrutura de saída com seus valores para esses membros.</span><span class="sxs-lookup"><span data-stu-id="e6083-278">Compare the values of the **ConfigureType**, **hChannel**, and **SequenceNumber** members in the output structure against your values for those members.</span></span> <span data-ttu-id="e6083-279">Falha se eles não corresponderem.</span><span class="sxs-lookup"><span data-stu-id="e6083-279">Fail if they do not match.</span></span>
7.  <span data-ttu-id="e6083-280">Incrementar o número de sequência para o próximo comando.</span><span class="sxs-lookup"><span data-stu-id="e6083-280">Increment the sequence number for the next command.</span></span>

## <a name="sending-authenticated-channel-queries"></a><span data-ttu-id="e6083-281">Enviando consultas de canal autenticado</span><span class="sxs-lookup"><span data-stu-id="e6083-281">Sending Authenticated Channel Queries</span></span>

<span data-ttu-id="e6083-282">Um conjunto de consultas é definido para recuperar informações sobre o canal autenticado.</span><span class="sxs-lookup"><span data-stu-id="e6083-282">A set of queries are defined for retrieving information about the authenticated channel.</span></span> <span data-ttu-id="e6083-283">Para obter uma lista de consultas, consulte [proteção de conteúdo consultas](content-protection-queries.md).</span><span class="sxs-lookup"><span data-stu-id="e6083-283">For a list of queries, see [Content Protection Queries](content-protection-queries.md).</span></span>

<span data-ttu-id="e6083-284">Para enviar um comando para o canal autenticado, execute as etapas a seguir.</span><span class="sxs-lookup"><span data-stu-id="e6083-284">To send a command to the authenticated channel, perform the following steps.</span></span>

1.  <span data-ttu-id="e6083-285">Preencha a estrutura de dados de entrada.</span><span class="sxs-lookup"><span data-stu-id="e6083-285">Fill in the input data structure.</span></span> <span data-ttu-id="e6083-286">Essa estrutura de dados é sempre uma estrutura de [**D3D11_AUTHENTICATED_QUERY_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_input) , possivelmente seguida por campos adicionais.</span><span class="sxs-lookup"><span data-stu-id="e6083-286">This data structure is always a [**D3D11_AUTHENTICATED_QUERY_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_input) structure, possibly followed by additional fields.</span></span> <span data-ttu-id="e6083-287">Preencha a estrutura de **D3D11_AUTHENTICATED_QUERY_INPUT** , conforme mostrado na tabela a seguir.</span><span class="sxs-lookup"><span data-stu-id="e6083-287">Fill in the **D3D11_AUTHENTICATED_QUERY_INPUT** structure as shown in the following table.</span></span>

    <table>
    <colgroup>
    <col style="width: 50%" />
    <col style="width: 50%" />
    </colgroup>
    <thead>
    <tr class="header">
    <th><span data-ttu-id="e6083-288">Membro</span><span class="sxs-lookup"><span data-stu-id="e6083-288">Member</span></span></th>
    <th><span data-ttu-id="e6083-289">DESCRIÇÃO</span><span class="sxs-lookup"><span data-stu-id="e6083-289">Description</span></span></th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td><span data-ttu-id="e6083-290"><strong>QueryType</strong></span><span class="sxs-lookup"><span data-stu-id="e6083-290"><strong>QueryType</strong></span></span></td>
    <td><span data-ttu-id="e6083-291">GUID que identifica a consulta.</span><span class="sxs-lookup"><span data-stu-id="e6083-291">GUID that identifies the query.</span></span> <span data-ttu-id="e6083-292">Para obter uma lista de consultas, consulte <a href="content-protection-queries.md">proteção de conteúdo consultas</a>.</span><span class="sxs-lookup"><span data-stu-id="e6083-292">For a list of queries, see <a href="content-protection-queries.md">Content Protection Queries</a>.</span></span></td>
    </tr>
    <tr class="even">
    <td><span data-ttu-id="e6083-293"><strong>hChannel</strong></span><span class="sxs-lookup"><span data-stu-id="e6083-293"><strong>hChannel</strong></span></span></td>
    <td><span data-ttu-id="e6083-294">O identificador para o canal autenticado.</span><span class="sxs-lookup"><span data-stu-id="e6083-294">The handle to the authenticated channel.</span></span></td>
    </tr>
    <tr class="odd">
    <td><span data-ttu-id="e6083-295"><strong>SequenceNumber</strong></span><span class="sxs-lookup"><span data-stu-id="e6083-295"><strong>SequenceNumber</strong></span></span></td>
    <td><span data-ttu-id="e6083-296">O número de sequência.</span><span class="sxs-lookup"><span data-stu-id="e6083-296">The sequence number.</span></span> <span data-ttu-id="e6083-297">O primeiro número de sequência é especificado com o envio de um comando <a href="/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input"><strong>D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE</strong></a> .</span><span class="sxs-lookup"><span data-stu-id="e6083-297">The first sequence number is specified by sending a <a href="/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input"><strong>D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE</strong></a> command.</span></span> <span data-ttu-id="e6083-298">Cada vez que você enviar outra consulta, aumente esse número em 1.</span><span class="sxs-lookup"><span data-stu-id="e6083-298">Each time you send another query, increment this number by 1.</span></span> <span data-ttu-id="e6083-299">O número de sequência protege contra ataques de repetição.</span><span class="sxs-lookup"><span data-stu-id="e6083-299">The sequence number guards against replay attacks.</span></span>
    <blockquote>
    [!Note]<br />
<span data-ttu-id="e6083-300">Dois números de sequência separados são usados, um para comandos e outro para consultas.</span><span class="sxs-lookup"><span data-stu-id="e6083-300">Two separate sequence numbers are used, one for commands and one for queries.</span></span>
    </blockquote>
    <br/> <br/></td>
    </tr>
    </tbody>
    </table>

    

     

2.  <span data-ttu-id="e6083-301">Chame [**ID3D11VideoContext:: QueryAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-queryauthenticatedchannel).</span><span class="sxs-lookup"><span data-stu-id="e6083-301">Call [**ID3D11VideoContext::QueryAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-queryauthenticatedchannel).</span></span>
3.  <span data-ttu-id="e6083-302">O driver coloca a saída da consulta em uma estrutura de [**D3D11_AUTHENTICATED_QUERY_OUTPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_output) .</span><span class="sxs-lookup"><span data-stu-id="e6083-302">The driver places the output from the query in a [**D3D11_AUTHENTICATED_QUERY_OUTPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_output) structure.</span></span> <span data-ttu-id="e6083-303">Essa estrutura é seguida por campos adicionais, dependendo do tipo de consulta.</span><span class="sxs-lookup"><span data-stu-id="e6083-303">This structure is followed by additional fields, depending on the query type.</span></span>
4.  <span data-ttu-id="e6083-304">Calcule a marca OMAC para o bloco de dados que aparece após o membro **OMAC** da estrutura de saída.</span><span class="sxs-lookup"><span data-stu-id="e6083-304">Calculate the OMAC tag for the block of data that appears after the **omac** member of the output structure.</span></span> <span data-ttu-id="e6083-305">Compare isso com o valor do membro **OMAC** .</span><span class="sxs-lookup"><span data-stu-id="e6083-305">Compare this with the value of the **omac** member.</span></span> <span data-ttu-id="e6083-306">Falha se eles não corresponderem.</span><span class="sxs-lookup"><span data-stu-id="e6083-306">Fail if they do not match.</span></span>
5.  <span data-ttu-id="e6083-307">Compare os valores dos membros **configuratype**, **hChannel** e **SequenceNumber** na estrutura de saída com seus valores para esses membros.</span><span class="sxs-lookup"><span data-stu-id="e6083-307">Compare the values of the **ConfigureType**, **hChannel**, and **SequenceNumber** members in the output structure against your values for those members.</span></span> <span data-ttu-id="e6083-308">Falha se eles não corresponderem.</span><span class="sxs-lookup"><span data-stu-id="e6083-308">Fail if they do not match.</span></span>
6.  <span data-ttu-id="e6083-309">Incrementar o número de sequência para a próxima consulta.</span><span class="sxs-lookup"><span data-stu-id="e6083-309">Increment the sequence number for the next query.</span></span>

## <a name="related-topics"></a><span data-ttu-id="e6083-310">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="e6083-310">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="e6083-311">APIs de vídeo do Direct3D 11</span><span class="sxs-lookup"><span data-stu-id="e6083-311">Direct3D 11 Video APIs</span></span>](direct3d-11-video-apis.md)
</dt> </dl>

 

 
