---
description: 'Este tópico discute três tópicos inter-relacionados: ambiente protegido, gateway de interoperabilidade de mídia e revogação e renovação.'
ms.assetid: e88806ae-0041-4b4a-a8df-69718a651e82
title: Caminho de mídia protegido
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7304edadf1623d41bc2f1f5c6b2b4cda2dd5f598
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/03/2021
ms.locfileid: "104553621"
---
# <a name="protected-media-path"></a><span data-ttu-id="37d2c-103">Caminho de mídia protegido</span><span class="sxs-lookup"><span data-stu-id="37d2c-103">Protected Media Path</span></span>

<span data-ttu-id="37d2c-104">Este tópico discute três tópicos inter-relacionados: ambiente protegido, gateway de interoperabilidade de mídia e revogação e renovação.</span><span class="sxs-lookup"><span data-stu-id="37d2c-104">This topic discusses three interrelated topics: protected environment, media interoperability gateway, and revocation and renewal.</span></span>

-   <span data-ttu-id="37d2c-105">Um PE (ambiente protegido) é um conjunto de tecnologias que permite que o conteúdo protegido flua de e para o Windows Vista de maneira protegida.</span><span class="sxs-lookup"><span data-stu-id="37d2c-105">A protected environment (PE) is a set of technologies that enables protected content to flow from and through Windows Vista in a protected fashion.</span></span> <span data-ttu-id="37d2c-106">Todos os componentes dentro de um ambiente protegido são confiáveis e o processo é protegido contra violação.</span><span class="sxs-lookup"><span data-stu-id="37d2c-106">All components inside a protected environment are trusted and the process is protected against tampering.</span></span>
-   <span data-ttu-id="37d2c-107">O caminho de mídia protegido (PMP) é um executável que é executado em um ambiente protegido.</span><span class="sxs-lookup"><span data-stu-id="37d2c-107">The protected media path (PMP) is an executable that runs in a protected environment.</span></span>
-   <span data-ttu-id="37d2c-108">Se um componente confiável no PE for comprometido, após o processo de conclusão, ele será revogado.</span><span class="sxs-lookup"><span data-stu-id="37d2c-108">If a trusted component in the PE becomes compromised, after due process it will be revoked.</span></span> <span data-ttu-id="37d2c-109">No entanto, a Microsoft fornece um mecanismo de renovação para instalar uma versão confiável mais recente do componente quando uma estiver disponível.</span><span class="sxs-lookup"><span data-stu-id="37d2c-109">However, Microsoft provides a renewal mechanism to install a newer trusted version of the component when one becomes available.</span></span>

<span data-ttu-id="37d2c-110">Para obter informações sobre componentes de mídia protegidos por assinatura de código, consulte o white paper [assinatura de código para componentes de mídia protegidos no Windows Vista](/windows-hardware/test/hlk/).</span><span class="sxs-lookup"><span data-stu-id="37d2c-110">For information about code signing protected media components, see the white paper [Code Signing for Protected Media Components in Windows Vista](/windows-hardware/test/hlk/).</span></span>

<span data-ttu-id="37d2c-111">Este tópico contém as seguintes seções:</span><span class="sxs-lookup"><span data-stu-id="37d2c-111">This topic contains the following sections:</span></span>

-   [<span data-ttu-id="37d2c-112">Ambiente protegido</span><span class="sxs-lookup"><span data-stu-id="37d2c-112">Protected Environment</span></span>](#protected-environment)
-   [<span data-ttu-id="37d2c-113">Design do ambiente protegido</span><span class="sxs-lookup"><span data-stu-id="37d2c-113">Design of the Protected Environment</span></span>](#design-of-the-protected-environment)
-   [<span data-ttu-id="37d2c-114">Caminho de mídia protegido</span><span class="sxs-lookup"><span data-stu-id="37d2c-114">Protected Media Path</span></span>](#protected-media-path)
    -   [<span data-ttu-id="37d2c-115">Autoridades de confiança de entrada</span><span class="sxs-lookup"><span data-stu-id="37d2c-115">Input Trust Authorities</span></span>](#input-trust-authorities)
    -   [<span data-ttu-id="37d2c-116">Autoridades de confiança de saída</span><span class="sxs-lookup"><span data-stu-id="37d2c-116">Output Trust Authorities</span></span>](#output-trust-authorities)
    -   [<span data-ttu-id="37d2c-117">Objetos de política</span><span class="sxs-lookup"><span data-stu-id="37d2c-117">Policy Objects</span></span>](#policy-objects)
    -   [<span data-ttu-id="37d2c-118">Criando objetos no PMP</span><span class="sxs-lookup"><span data-stu-id="37d2c-118">Creating Objects in the PMP</span></span>](#creating-objects-in-the-pmp)
-   [<span data-ttu-id="37d2c-119">Visão geral da negociação de política</span><span class="sxs-lookup"><span data-stu-id="37d2c-119">Overview of Policy Negotiation</span></span>](#overview-of-policy-negotiation)
-   [<span data-ttu-id="37d2c-120">Revogação e renovação</span><span class="sxs-lookup"><span data-stu-id="37d2c-120">Revocation and Renewal</span></span>](#revocation-and-renewal)
-   [<span data-ttu-id="37d2c-121">Proteção de link de saída</span><span class="sxs-lookup"><span data-stu-id="37d2c-121">Output Link Protection</span></span>](#output-link-protection)
-   [<span data-ttu-id="37d2c-122">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="37d2c-122">Related topics</span></span>](#related-topics)

## <a name="protected-environment"></a><span data-ttu-id="37d2c-123">Ambiente protegido</span><span class="sxs-lookup"><span data-stu-id="37d2c-123">Protected Environment</span></span>

<span data-ttu-id="37d2c-124">A proteção de conteúdo abrange várias tecnologias, cada uma delas tentando garantir que o conteúdo não possa ser usado de forma inconsistente com a intenção do proprietário do conteúdo ou do provedor.</span><span class="sxs-lookup"><span data-stu-id="37d2c-124">Content protection encompasses multiple technologies, each of which attempts to ensure that content cannot be used in a way that is inconsistent with the intent of the content owner or provider.</span></span> <span data-ttu-id="37d2c-125">Essas tecnologias incluem proteção contra cópia, proteção de link, acesso condicional e DRM (gerenciamento de direitos digitais).</span><span class="sxs-lookup"><span data-stu-id="37d2c-125">These technologies include copy protection, link protection, conditional access, and digital rights management (DRM).</span></span> <span data-ttu-id="37d2c-126">A base de cada um é confiável: o acesso ao conteúdo é concedido somente a componentes de software que aderem aos termos de uso atribuídos a esse conteúdo.</span><span class="sxs-lookup"><span data-stu-id="37d2c-126">The foundation of each is trust: Access to the content is granted only to software components that adhere to the terms of use assigned to that content.</span></span>

<span data-ttu-id="37d2c-127">Para minimizar as ameaças contra o conteúdo protegido, o Windows Vista e o software Media Foundation permitem que o código confiável seja executado em um ambiente protegido.</span><span class="sxs-lookup"><span data-stu-id="37d2c-127">To minimize threats against protected content, Windows Vista and Media Foundation Software enable trusted code to run in a protected environment.</span></span> <span data-ttu-id="37d2c-128">Um PE é um conjunto de componentes, diretrizes e ferramentas projetadas para aumentar a proteção contra pirataria de conteúdo.</span><span class="sxs-lookup"><span data-stu-id="37d2c-128">A PE is a set of components, guidelines, and tools designed to increase protection against content piracy.</span></span>

<span data-ttu-id="37d2c-129">Antes de examinar o PE com mais detalhes, é importante entender as ameaças que ele foi projetado para minimizar.</span><span class="sxs-lookup"><span data-stu-id="37d2c-129">Before examining the PE more closely, it is important to understand the threats it is designed to minimize.</span></span> <span data-ttu-id="37d2c-130">Suponha que você esteja executando um aplicativo de mídia em um processo de modo de usuário.</span><span class="sxs-lookup"><span data-stu-id="37d2c-130">Suppose you are running a media application in a user-mode process.</span></span> <span data-ttu-id="37d2c-131">O aplicativo é vinculado às várias DLLs (bibliotecas de vínculo dinâmico) que contêm plug-ins de mídia, como decodificadores.</span><span class="sxs-lookup"><span data-stu-id="37d2c-131">The application is linked to the various dynamic link libraries (DLLs) that contain media plug-ins, such as decoders.</span></span> <span data-ttu-id="37d2c-132">Outros processos também estão sendo executados no modo de usuário e vários drivers são carregados no kernel.</span><span class="sxs-lookup"><span data-stu-id="37d2c-132">Other processes are also running in user mode, and various drivers are loaded in the kernel.</span></span> <span data-ttu-id="37d2c-133">Se nenhum mecanismo de confiança estiver em vigor, haverá as seguintes ameaças:</span><span class="sxs-lookup"><span data-stu-id="37d2c-133">If no trust mechanism is in place, the following threats exist:</span></span>

-   <span data-ttu-id="37d2c-134">O aplicativo pode acessar a mídia protegida diretamente ou invadir a memória do processo.</span><span class="sxs-lookup"><span data-stu-id="37d2c-134">The application can access protected media directly or hack the process memory.</span></span>
-   <span data-ttu-id="37d2c-135">Os plug-ins podem acessar o conteúdo diretamente ou invadir a memória do processo.</span><span class="sxs-lookup"><span data-stu-id="37d2c-135">Plug-ins can access the content directly or hack the process memory.</span></span>
-   <span data-ttu-id="37d2c-136">Outros processos podem invadir a memória do processo de mídia diretamente ou injetando código.</span><span class="sxs-lookup"><span data-stu-id="37d2c-136">Other processes can hack the media process memory either directly or by injecting code.</span></span>
-   <span data-ttu-id="37d2c-137">Os drivers de kernel podem invadir a memória do processo de mídia.</span><span class="sxs-lookup"><span data-stu-id="37d2c-137">Kernel drivers can hack the media process memory.</span></span>
-   <span data-ttu-id="37d2c-138">O conteúdo pode ser enviado fora do sistema por um meio desprotegido.</span><span class="sxs-lookup"><span data-stu-id="37d2c-138">Content might be sent outside the system over an unprotected medium.</span></span> <span data-ttu-id="37d2c-139">(A proteção de link foi projetada para mitigar essa ameaça.)</span><span class="sxs-lookup"><span data-stu-id="37d2c-139">(Link protection is designed to mitigate against this threat.)</span></span>

## <a name="design-of-the-protected-environment"></a><span data-ttu-id="37d2c-140">Design do ambiente protegido</span><span class="sxs-lookup"><span data-stu-id="37d2c-140">Design of the Protected Environment</span></span>

<span data-ttu-id="37d2c-141">Um ambiente protegido é executado em um processo protegido separado do aplicativo de mídia.</span><span class="sxs-lookup"><span data-stu-id="37d2c-141">A protected environment runs in a separate protected process from the media application.</span></span> <span data-ttu-id="37d2c-142">O recurso de processo protegido do Windows Vista impede que outros processos acessem o processo protegido.</span><span class="sxs-lookup"><span data-stu-id="37d2c-142">The protected process feature of Windows Vista stops other processes from accessing the protected process.</span></span>

<span data-ttu-id="37d2c-143">Quando um processo protegido é criado, os principais componentes do kernel identificam componentes e plug-ins não confiáveis para que o ambiente protegido possa se recusar a carregá-los.</span><span class="sxs-lookup"><span data-stu-id="37d2c-143">When a protected process is created, core kernel components identify untrusted components and plug-ins so that the protected environment can refuse to load them.</span></span> <span data-ttu-id="37d2c-144">Um componente confiável é aquele que foi assinado adequadamente pela Microsoft.</span><span class="sxs-lookup"><span data-stu-id="37d2c-144">A trusted component is one that has been appropriately signed by Microsoft.</span></span> <span data-ttu-id="37d2c-145">O kernel também controla os módulos que carregam nele, permitindo que o ambiente protegido pare a reprodução do conteúdo protegido se um módulo não confiável for carregado.</span><span class="sxs-lookup"><span data-stu-id="37d2c-145">The kernel also tracks modules that load into it, enabling the protected environment to stop playback of protected content if an untrusted module is loaded.</span></span> <span data-ttu-id="37d2c-146">Antes que um componente de kernel seja carregado, o kernel verifica se ele é confiável.</span><span class="sxs-lookup"><span data-stu-id="37d2c-146">Before a kernel component is loaded, the kernel checks to determine whether it is trusted.</span></span> <span data-ttu-id="37d2c-147">Se não for, os componentes confiáveis que já estão no PE se recusam a processar o conteúdo protegido.</span><span class="sxs-lookup"><span data-stu-id="37d2c-147">If it is not, trusted components already in the PE refuse to process protected content.</span></span> <span data-ttu-id="37d2c-148">Para habilitar isso, os componentes do PE executam periodicamente um handshake protegido criptograficamente com o kernel.</span><span class="sxs-lookup"><span data-stu-id="37d2c-148">To enable this, PE components periodically perform a cryptographically-protected handshake with the kernel.</span></span> <span data-ttu-id="37d2c-149">Se um componente de modo kernel não confiável estiver presente, o handshake falhará e indicará ao PE que existe um componente não confiável.</span><span class="sxs-lookup"><span data-stu-id="37d2c-149">If an untrusted kernel mode component is present, the handshake fails and indicates to the PE that an untrusted component exists.</span></span>

<span data-ttu-id="37d2c-150">Se um componente confiável for comprometido, após o processo de conclusão, ele poderá ser revogado.</span><span class="sxs-lookup"><span data-stu-id="37d2c-150">If a trusted component becomes compromised, after due process it can be revoked.</span></span> <span data-ttu-id="37d2c-151">A Microsoft fornece um mecanismo de renovação para instalar uma versão confiável mais recente, quando disponível.</span><span class="sxs-lookup"><span data-stu-id="37d2c-151">Microsoft provides a renewal mechanism to install a newer trusted version when available.</span></span>

## <a name="protected-media-path"></a><span data-ttu-id="37d2c-152">Caminho de mídia protegido</span><span class="sxs-lookup"><span data-stu-id="37d2c-152">Protected Media Path</span></span>

<span data-ttu-id="37d2c-153">O caminho de mídia protegido (PMP) é o executável do PE primário para Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="37d2c-153">The protected media path (PMP) is the primary PE executable for Media Foundation.</span></span> <span data-ttu-id="37d2c-154">O PMP é extensível, para que os mecanismos de proteção de conteúdo de terceiros possam ter suporte.</span><span class="sxs-lookup"><span data-stu-id="37d2c-154">The PMP is extensible, so that third-party content protection mechanisms can be supported.</span></span>

<span data-ttu-id="37d2c-155">O PMP aceita conteúdo protegido e políticas associadas de qualquer fonte de Media Foundation usando qualquer sistema de proteção de conteúdo, incluindo aqueles fornecidos por terceiros.</span><span class="sxs-lookup"><span data-stu-id="37d2c-155">The PMP accepts protected content and associated policies from any Media Foundation source using any content protection system, including those provided by third parties.</span></span> <span data-ttu-id="37d2c-156">Ele envia conteúdo para qualquer coletor de Media Foundation, desde que o coletor esteja em conformidade com as políticas especificadas pela origem.</span><span class="sxs-lookup"><span data-stu-id="37d2c-156">It sends content to any Media Foundation sink, as long as the sink complies with the policies specified by the source.</span></span> <span data-ttu-id="37d2c-157">Ele também dá suporte a transformações entre a origem e o coletor, incluindo transformações de terceiros, desde que sejam confiáveis.</span><span class="sxs-lookup"><span data-stu-id="37d2c-157">It also supports transforms between the source and the sink, including third-party transforms, as long as they are trusted.</span></span>

<span data-ttu-id="37d2c-158">O PMP é executado em um processo protegido isolado do aplicativo de mídia.</span><span class="sxs-lookup"><span data-stu-id="37d2c-158">The PMP runs in a protected process isolated from the media application.</span></span> <span data-ttu-id="37d2c-159">O aplicativo só tem a capacidade de trocar mensagens de comando e controle com o PMP, mas não tem acesso ao conteúdo depois que ele é passado para a PMP.</span><span class="sxs-lookup"><span data-stu-id="37d2c-159">The application only has the ability to exchange command and control messages with the PMP, but does not have access to content after it is passed to the PMP.</span></span> <span data-ttu-id="37d2c-160">O diagrama a seguir ilustra esse processo.</span><span class="sxs-lookup"><span data-stu-id="37d2c-160">The following diagram illustrates this process.</span></span>

![diagrama do caminho de mídia protegido](images/pmp04.png)

<span data-ttu-id="37d2c-162">As caixas sombreadas representam componentes que podem ser fornecidos por terceiros.</span><span class="sxs-lookup"><span data-stu-id="37d2c-162">Shaded boxes represent components that might be provided by third parties.</span></span> <span data-ttu-id="37d2c-163">Todos os componentes criados dentro do processo protegido devem ser assinados e confiáveis.</span><span class="sxs-lookup"><span data-stu-id="37d2c-163">All components created inside the protected process must be signed and trusted.</span></span>

<span data-ttu-id="37d2c-164">O aplicativo cria uma instância da sessão de mídia dentro do processo protegido e recebe um ponteiro para uma sessão de mídia de proxy, que realiza marshaling de ponteiros de interface no limite do processo.</span><span class="sxs-lookup"><span data-stu-id="37d2c-164">The application creates an instance of the Media Session inside the protected process and receives a pointer to a proxy Media Session, which marshals interface pointers across the process boundary.</span></span>

<span data-ttu-id="37d2c-165">A origem da mídia pode ser criada dentro do processo do aplicativo, como mostrado aqui ou dentro do processo protegido.</span><span class="sxs-lookup"><span data-stu-id="37d2c-165">The media source can be created either within the application process, as shown here, or inside the protected process.</span></span> <span data-ttu-id="37d2c-166">Se a origem da mídia for criada dentro do processo do aplicativo, a origem criará um proxy para si mesmo no processo protegido.</span><span class="sxs-lookup"><span data-stu-id="37d2c-166">If the media source is created inside the application process, the source creates a proxy for itself in the protected process.</span></span>

<span data-ttu-id="37d2c-167">Todos os outros componentes de pipeline, como decodificadores e coletores de mídia, são criados no processo protegido.</span><span class="sxs-lookup"><span data-stu-id="37d2c-167">All other pipeline components, such as decoders and media sinks, are created in the protected process.</span></span> <span data-ttu-id="37d2c-168">Se esses objetos expõem qualquer interface personalizada para aplicativos, eles devem fornecer um proxy/stub DCOM para realizar marshaling da interface.</span><span class="sxs-lookup"><span data-stu-id="37d2c-168">If these objects expose any custom interfaces for applications, they must provide a DCOM proxy/stub to marshal the interface.</span></span>

<span data-ttu-id="37d2c-169">Para impor a política no conteúdo protegido conforme ele flui através do pipeline, o PMP usa três tipos de componentes: ITAs (autoridades de confiança de entrada), OTAs (autoridades de confiança de saída) e objetos de política.</span><span class="sxs-lookup"><span data-stu-id="37d2c-169">To enforce policy on protected content as it flows through the pipeline, the PMP uses three types of components: input trust authorities (ITAs), output trust authorities (OTAs), and policy objects.</span></span> <span data-ttu-id="37d2c-170">Esses componentes funcionam em conjunto para conceder ou restringir direitos de uso de conteúdo e para especificar as proteções de link que devem ser empregadas durante a reprodução de conteúdo, como a HDCP (Proteção de Conteúdo Digital de alta largura de banda).</span><span class="sxs-lookup"><span data-stu-id="37d2c-170">These components work together to grant or restrict rights to use content, and to specify the link protections that must be employed when playing content, such as High-bandwidth Digital Content Protection (HDCP).</span></span>

### <a name="input-trust-authorities"></a><span data-ttu-id="37d2c-171">Autoridades de confiança de entrada</span><span class="sxs-lookup"><span data-stu-id="37d2c-171">Input Trust Authorities</span></span>

<span data-ttu-id="37d2c-172">Um ITA é criado por uma fonte de mídia confiável e executa várias funções:</span><span class="sxs-lookup"><span data-stu-id="37d2c-172">An ITA is created by a trusted media source, and performs several functions:</span></span>

-   <span data-ttu-id="37d2c-173">Especifica os direitos para usar o conteúdo.</span><span class="sxs-lookup"><span data-stu-id="37d2c-173">Specifies rights to use content.</span></span> <span data-ttu-id="37d2c-174">Os direitos podem incluir o direito de reproduzir conteúdo, transferi-lo para um dispositivo e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="37d2c-174">Rights can include the right to play content, transfer it to a device, and so on.</span></span> <span data-ttu-id="37d2c-175">Ele define uma lista ordenada de sistemas de proteção de saída aprovados e as políticas de saída correspondentes para cada sistema.</span><span class="sxs-lookup"><span data-stu-id="37d2c-175">It defines an ordered list of approved output protection systems and the corresponding output policies for each system.</span></span> <span data-ttu-id="37d2c-176">O ITA armazena essas informações em um objeto de política.</span><span class="sxs-lookup"><span data-stu-id="37d2c-176">The ITA stores this information in a policy object.</span></span>
-   <span data-ttu-id="37d2c-177">Fornece o descriptografador necessário para descriptografar o conteúdo.</span><span class="sxs-lookup"><span data-stu-id="37d2c-177">Provides the decryptor needed to decrypt the content.</span></span>
-   <span data-ttu-id="37d2c-178">Estabelece uma relação de confiança com o módulo kernel no ambiente protegido, para garantir que o ITA esteja em execução dentro de um ambiente confiável.</span><span class="sxs-lookup"><span data-stu-id="37d2c-178">Establishes trust with the kernel module in the protected environment, to ensure that the ITA is running inside a trusted environment.</span></span>

<span data-ttu-id="37d2c-179">Um ITA é associado a um fluxo individual que contém conteúdo protegido.</span><span class="sxs-lookup"><span data-stu-id="37d2c-179">An ITA is associated with an individual stream containing protected content.</span></span> <span data-ttu-id="37d2c-180">Um fluxo pode ter apenas um ITA, e uma instância de um ITA pode ser associada a apenas um fluxo.</span><span class="sxs-lookup"><span data-stu-id="37d2c-180">A stream can have only one ITA, and an instance of an ITA can be associated with only one stream.</span></span>

### <a name="output-trust-authorities"></a><span data-ttu-id="37d2c-181">Autoridades de confiança de saída</span><span class="sxs-lookup"><span data-stu-id="37d2c-181">Output Trust Authorities</span></span>

<span data-ttu-id="37d2c-182">Um OTA é associado a uma saída confiável.</span><span class="sxs-lookup"><span data-stu-id="37d2c-182">An OTA is associated with a trusted output.</span></span> <span data-ttu-id="37d2c-183">O OTA expõe uma ação que a saída confiável pode executar no conteúdo, como reprodução ou cópia.</span><span class="sxs-lookup"><span data-stu-id="37d2c-183">The OTA exposes an action that the trusted output can perform on the content, such as playback or copying.</span></span> <span data-ttu-id="37d2c-184">Sua função é impor um ou mais sistemas de proteção de saída exigidos pelo ITA.</span><span class="sxs-lookup"><span data-stu-id="37d2c-184">Its role is to enforce one or more output protection systems that are required by the ITA.</span></span> <span data-ttu-id="37d2c-185">O OTA consulta o objeto de política fornecido pelo ITA para determinar qual sistema de proteção ele deve impor.</span><span class="sxs-lookup"><span data-stu-id="37d2c-185">The OTA queries the policy object provided by ITA to determine which protection system it must enforce.</span></span>

### <a name="policy-objects"></a><span data-ttu-id="37d2c-186">Objetos de política</span><span class="sxs-lookup"><span data-stu-id="37d2c-186">Policy Objects</span></span>

<span data-ttu-id="37d2c-187">Um objeto de política encapsula os requisitos de proteção de conteúdo de um ITA.</span><span class="sxs-lookup"><span data-stu-id="37d2c-187">A policy object encapsulates the content protection requirements of an ITA.</span></span> <span data-ttu-id="37d2c-188">Ele é usado pelo mecanismo de política para negociar o suporte à proteção de conteúdo com um OTA.</span><span class="sxs-lookup"><span data-stu-id="37d2c-188">It is used by the policy engine to negotiate content protection support with an OTA.</span></span> <span data-ttu-id="37d2c-189">OTAs objetos de política de consulta para determinar quais sistemas de proteção eles devem impor em cada saída do conteúdo atual.</span><span class="sxs-lookup"><span data-stu-id="37d2c-189">OTAs query policy objects to determine what protection systems they must enforce on each output of the current content.</span></span>

### <a name="creating-objects-in-the-pmp"></a><span data-ttu-id="37d2c-190">Criando objetos no PMP</span><span class="sxs-lookup"><span data-stu-id="37d2c-190">Creating Objects in the PMP</span></span>

<span data-ttu-id="37d2c-191">Para criar um objeto no caminho de mídia protegida (PMP), o [**IMFMediaSource**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasource) chama [**IMFPMPHostApp:: ActivateClassById**](/windows/desktop/api/mfidl/nf-mfidl-imfpmphostapp-activateclassbyid), com o **IStream** de entrada especificado, formatado da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="37d2c-191">To create an object in the protected media path (PMP), the [**IMFMediaSource**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasource) calls [**IMFPMPHostApp::ActivateClassById**](/windows/desktop/api/mfidl/nf-mfidl-imfpmphostapp-activateclassbyid), with the specified input **IStream** formatted in the following way:</span></span>

``` syntax
Format: (All DWORD values are serialized in little-endian order)
[GUID (content protection system guid, obtained from Windows.Media.Protection.MediaProtectionSystemId)]
[DWORD (track count, use the actual track count even if all tracks are encrypted using the same data, note that zero is invalid)]
[DWORD (next track ID, use -1 if all remaining tracks are encrypted using the same data)]
[DWORD (next track's binary data size)]
[BYTE* (next track's binary data)]
{ Repeat from "next track ID" above for each stream }
```

## <a name="overview-of-policy-negotiation"></a><span data-ttu-id="37d2c-192">Visão geral da negociação de política</span><span class="sxs-lookup"><span data-stu-id="37d2c-192">Overview of Policy Negotiation</span></span>

<span data-ttu-id="37d2c-193">Há três requisitos fundamentais que devem ser atendidos antes que o conteúdo protegido possa ser processado no PMP.</span><span class="sxs-lookup"><span data-stu-id="37d2c-193">There are three fundamental requirements that must be met before protected content can be processed in the PMP.</span></span> <span data-ttu-id="37d2c-194">Primeiro, o conteúdo protegido deve ser enviado somente para saídas confiáveis.</span><span class="sxs-lookup"><span data-stu-id="37d2c-194">First, protected content must be sent only to trusted outputs.</span></span> <span data-ttu-id="37d2c-195">Segundo, somente as ações permitidas devem ser aplicadas a um fluxo.</span><span class="sxs-lookup"><span data-stu-id="37d2c-195">Second, only permitted actions must be applied to a stream.</span></span> <span data-ttu-id="37d2c-196">Terceiro, somente os sistemas de proteção de saída aprovados devem ser usados para reproduzir um fluxo.</span><span class="sxs-lookup"><span data-stu-id="37d2c-196">Third, only approved output protection systems must be used to play a stream.</span></span> <span data-ttu-id="37d2c-197">O mecanismo de política coordena entre ITAs e OTAs para garantir que esses requisitos sejam atendidos.</span><span class="sxs-lookup"><span data-stu-id="37d2c-197">The policy engine coordinates between ITAs and OTAs to ensure that these requirements are met.</span></span>

<span data-ttu-id="37d2c-198">A maneira mais fácil de entender o processo é percorrer um exemplo simplificado que identifica as etapas necessárias para reproduzir o conteúdo do formato de sistema avançado (ASF) protegido pelo WMDRM (Windows Media Digital Rights Management).</span><span class="sxs-lookup"><span data-stu-id="37d2c-198">The easiest way to understand process is to walk through a simplified example that identifies the steps necessary to play Advanced System Format (ASF) content protected by Windows Media Digital Rights Management (WMDRM).</span></span>

<span data-ttu-id="37d2c-199">Quando um usuário inicia um aplicativo de Player e abre um arquivo ASF que tem um fluxo de áudio protegido e um fluxo de vídeo protegido, as seguintes etapas devem ser executadas:</span><span class="sxs-lookup"><span data-stu-id="37d2c-199">When a user launches a player application and opens an ASF file that has a protected audio stream and a protected video stream, the following steps must be performed:</span></span>

1.  <span data-ttu-id="37d2c-200">O aplicativo cria a origem de mídia do ASF e a sessão do PMP (caminho de mídia protegida).</span><span class="sxs-lookup"><span data-stu-id="37d2c-200">The application creates the ASF media source and the protected media path (PMP) session.</span></span> <span data-ttu-id="37d2c-201">Media Foundation cria um processo de PMP.</span><span class="sxs-lookup"><span data-stu-id="37d2c-201">Media Foundation creates a PMP process.</span></span>
2.  <span data-ttu-id="37d2c-202">O aplicativo cria uma topologia parcial que contém um nó de fonte de áudio conectado ao processador de áudio e um nó de fonte de vídeo conectado ao processador de vídeo avançado (EVR).</span><span class="sxs-lookup"><span data-stu-id="37d2c-202">The application creates a partial topology that contains an audio source node connected to the audio renderer, and a video source node connected to the enhanced video renderer (EVR).</span></span> <span data-ttu-id="37d2c-203">Para os renderizadores, o aplicativo não cria diretamente o renderizador.</span><span class="sxs-lookup"><span data-stu-id="37d2c-203">For the renderers, the application does not directly create the renderer.</span></span> <span data-ttu-id="37d2c-204">Em vez disso, o aplicativo cria no processo desprotegido um objeto conhecido como um *objeto de ativação*.</span><span class="sxs-lookup"><span data-stu-id="37d2c-204">Instead, the application creates in the unprotected process an object known as an *activation object*.</span></span> <span data-ttu-id="37d2c-205">O PMP usa o objeto de ativação para criar os renderizadores no processo protegido.</span><span class="sxs-lookup"><span data-stu-id="37d2c-205">The PMP uses the activation object to create the renderers in the protected process.</span></span> <span data-ttu-id="37d2c-206">(Para obter mais informações sobre objetos de ativação, consulte [objetos de ativação](activation-objects.md).)</span><span class="sxs-lookup"><span data-stu-id="37d2c-206">(For more information about activation objects, see [Activation Objects](activation-objects.md).)</span></span>
3.  <span data-ttu-id="37d2c-207">O aplicativo define a topologia parcial na sessão do PMP.</span><span class="sxs-lookup"><span data-stu-id="37d2c-207">The application sets the partial topology on the PMP session.</span></span>
4.  <span data-ttu-id="37d2c-208">A sessão do PMP serializa a topologia e a transmite para o host do PMP no processo protegido.</span><span class="sxs-lookup"><span data-stu-id="37d2c-208">The PMP session serializes the topology and passes it to the PMP host in the protected process.</span></span> <span data-ttu-id="37d2c-209">O host do PMP envia a topologia para o mecanismo de política.</span><span class="sxs-lookup"><span data-stu-id="37d2c-209">The PMP host sends the topology to the policy engine.</span></span>
5.  <span data-ttu-id="37d2c-210">O carregador de topologia chama [**IMFInputTrustAuthority:: Getdescriptografar**](/windows/desktop/api/mfidl/nf-mfidl-imfinputtrustauthority-getdecrypter) no ITAs e insere os descriptografadores na topologia imediatamente downstream dos nós de origem correspondentes.</span><span class="sxs-lookup"><span data-stu-id="37d2c-210">The topology loader calls [**IMFInputTrustAuthority::GetDecrypter**](/windows/desktop/api/mfidl/nf-mfidl-imfinputtrustauthority-getdecrypter) on the ITAs and inserts the decrypters into the topology immediately downstream of the corresponding source nodes.</span></span>
6.  <span data-ttu-id="37d2c-211">O carregador de topologia insere os decodificadores de áudio e vídeo downstream dos nós Decrypter.</span><span class="sxs-lookup"><span data-stu-id="37d2c-211">The topology loader inserts the audio and video decoders downstream of the decrypter nodes.</span></span>
7.  <span data-ttu-id="37d2c-212">O mecanismo de política examina os nós inseridos para determinar se qualquer implementação da interface [**IMFTrustedOutput**](/windows/desktop/api/mfidl/nn-mfidl-imftrustedoutput) .</span><span class="sxs-lookup"><span data-stu-id="37d2c-212">The policy engine scans the inserted nodes to determine whether any implement the [**IMFTrustedOutput**](/windows/desktop/api/mfidl/nn-mfidl-imftrustedoutput) interface.</span></span> <span data-ttu-id="37d2c-213">O EVR e o processador de áudio implementam **IMFTrustedOutput**, pois eles enviam dados fora do PMP.</span><span class="sxs-lookup"><span data-stu-id="37d2c-213">The EVR and the audio renderer both implement **IMFTrustedOutput**, because they send data outside the PMP.</span></span>
8.  <span data-ttu-id="37d2c-214">Cada ITA confirma que está sendo executado dentro de um processo protegido executando um handshake criptográfico com um módulo de kernel do ambiente protegido.</span><span class="sxs-lookup"><span data-stu-id="37d2c-214">Each ITA confirms that it is running inside a protected process by performing a cryptographic handshake with a protected environment kernel module.</span></span>
9.  <span data-ttu-id="37d2c-215">Para cada fluxo, o mecanismo de política negocia a política obtendo um objeto de política do ITA e passando-o para o OTA.</span><span class="sxs-lookup"><span data-stu-id="37d2c-215">For each stream, the policy engine negotiates policy by getting a policy object from the ITA and passing it to the OTA.</span></span> <span data-ttu-id="37d2c-216">O OTA fornece uma lista dos sistemas de proteção que ele suporta e o objeto de política indica quais sistemas de proteção devem ser aplicados, juntamente com as configurações corretas.</span><span class="sxs-lookup"><span data-stu-id="37d2c-216">The OTA provides a list of the protection systems that it supports, and the policy object indicates which protection systems must be applied, along with the correct settings.</span></span> <span data-ttu-id="37d2c-217">Em seguida, o OTA aplica essas configurações.</span><span class="sxs-lookup"><span data-stu-id="37d2c-217">The OTA then applies these settings.</span></span> <span data-ttu-id="37d2c-218">Se ele não puder fazer isso, o conteúdo será bloqueado.</span><span class="sxs-lookup"><span data-stu-id="37d2c-218">If it cannot do so, the content is blocked.</span></span>

## <a name="revocation-and-renewal"></a><span data-ttu-id="37d2c-219">Revogação e renovação</span><span class="sxs-lookup"><span data-stu-id="37d2c-219">Revocation and Renewal</span></span>

<span data-ttu-id="37d2c-220">Um componente confiável pode ser revogado se for comprometido ou for descoberto que está violando os contratos de licença sob os quais ele foi inicialmente confiável.</span><span class="sxs-lookup"><span data-stu-id="37d2c-220">A trusted component can be revoked if it becomes compromised or is discovered to be violating the license agreements under which it was initially trusted.</span></span> <span data-ttu-id="37d2c-221">Existe um mecanismo de renovação para instalar uma versão mais recente e mais confiável do componente.</span><span class="sxs-lookup"><span data-stu-id="37d2c-221">A renewal mechanism exists to install a newer, more trusted version of the component.</span></span>

<span data-ttu-id="37d2c-222">Os componentes confiáveis são assinados usando um certificado criptográfico.</span><span class="sxs-lookup"><span data-stu-id="37d2c-222">Trusted components are signed using a cryptographic certificate.</span></span> <span data-ttu-id="37d2c-223">A Microsoft publica uma lista de revogação global (GRL) que identifica os componentes que foram revogados.</span><span class="sxs-lookup"><span data-stu-id="37d2c-223">Microsoft publishes a global revocation list (GRL) which identifies components that have been revoked.</span></span> <span data-ttu-id="37d2c-224">O GRL é assinado digitalmente para garantir sua autenticidade.</span><span class="sxs-lookup"><span data-stu-id="37d2c-224">The GRL is digitally signed to ensure its authenticity.</span></span> <span data-ttu-id="37d2c-225">Os proprietários de conteúdo podem garantir, por meio do mecanismo de política, que a versão atual do GRL está presente no computador do usuário.</span><span class="sxs-lookup"><span data-stu-id="37d2c-225">Content owners can ensure, through the policy mechanism, that the current version of the GRL is present on the user's computer.</span></span>

## <a name="output-link-protection"></a><span data-ttu-id="37d2c-226">Proteção de link de saída</span><span class="sxs-lookup"><span data-stu-id="37d2c-226">Output Link Protection</span></span>

<span data-ttu-id="37d2c-227">Quando o conteúdo de vídeo Premium é exibido, os quadros descriptografados e descompactados viajam através de um conector físico para o dispositivo de vídeo.</span><span class="sxs-lookup"><span data-stu-id="37d2c-227">When premium video content is viewed, the decrypted, uncompressed frames travel across a physical connector to the display device.</span></span> <span data-ttu-id="37d2c-228">Os provedores de conteúdo podem exigir que os quadros de vídeo sejam protegidos neste ponto, à medida que viajam pelo conector físico.</span><span class="sxs-lookup"><span data-stu-id="37d2c-228">Content providers may require the video frames to be protected at this point, as they travel across the physical connector.</span></span> <span data-ttu-id="37d2c-229">Existem vários mecanismos de proteção para essa finalidade, incluindo High-Bandwidth Proteção de Conteúdo Digital (HDCP) e Proteção de Conteúdo DisplayPort (DPCP).</span><span class="sxs-lookup"><span data-stu-id="37d2c-229">Various protection mechanisms exist for this purpose, including High-Bandwidth Digital Content Protection (HDCP) and DisplayPort Content Protection (DPCP).</span></span> <span data-ttu-id="37d2c-230">O vídeo OTA impõe essas proteções usando o [Gerenciador de proteção de saída](output-protection-manager.md) (OPM).</span><span class="sxs-lookup"><span data-stu-id="37d2c-230">The video OTA enforces these protections by using the [Output Protection Manager](output-protection-manager.md) (OPM).</span></span> <span data-ttu-id="37d2c-231">O Gerenciador de proteção de saída envia comandos para o driver de gráficos e o driver de gráficos impõe quaisquer mecanismos de proteção de link exigidos pela política.</span><span class="sxs-lookup"><span data-stu-id="37d2c-231">The Output Protection Manager sends commands to the graphics driver, and the graphics driver enforces whatever link protection mechanisms are required by the policy.</span></span>

![um diagrama que mostra a relação entre o vídeo OTA e o OPM.](images/pmp05.png)

## <a name="related-topics"></a><span data-ttu-id="37d2c-233">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="37d2c-233">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="37d2c-234">Sobre o Media Foundation</span><span class="sxs-lookup"><span data-stu-id="37d2c-234">About Media Foundation</span></span>](about-the-media-foundation-sdk.md)
</dt> <dt>

[<span data-ttu-id="37d2c-235">Arquitetura Media Foundation</span><span class="sxs-lookup"><span data-stu-id="37d2c-235">Media Foundation Architecture</span></span>](media-foundation-architecture.md)
</dt> <dt>

[<span data-ttu-id="37d2c-236">Proteção de Conteúdo baseado em GPU</span><span class="sxs-lookup"><span data-stu-id="37d2c-236">GPU-Based Content Protection</span></span>](gpu-based-content-protection.md)
</dt> <dt>

[<span data-ttu-id="37d2c-237">Gerenciador de proteção de saída</span><span class="sxs-lookup"><span data-stu-id="37d2c-237">Output Protection Manager</span></span>](output-protection-manager.md)
</dt> <dt>

[<span data-ttu-id="37d2c-238">Sessão de mídia do PMP</span><span class="sxs-lookup"><span data-stu-id="37d2c-238">PMP Media Session</span></span>](pmp-media-session.md)
</dt> </dl>

 

 
