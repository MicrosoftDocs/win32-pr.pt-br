---
description: Mapeamento de coordenadas no VMR
ms.assetid: f0821b90-51d1-4e77-8aed-04337a3dd623
title: Mapeamento de coordenadas no VMR
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c18b38249471e6e68e36f1b9051f51e920f62b31
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/06/2021
ms.locfileid: "103825626"
---
# <a name="coordinate-mapping-in-the-vmr"></a><span data-ttu-id="e18a5-103">Mapeamento de coordenadas no VMR</span><span class="sxs-lookup"><span data-stu-id="e18a5-103">Coordinate Mapping in the VMR</span></span>

<span data-ttu-id="e18a5-104">Esta seção descreve as cinco transformações que são aplicadas a uma imagem de origem antes de serem mapeadas pelo VMR na imagem de saída final.</span><span class="sxs-lookup"><span data-stu-id="e18a5-104">This section describes the five transformations that are applied to a source image before it is mapped by the VMR onto the final output image.</span></span>

1.  <span data-ttu-id="e18a5-105">A transformação *T (src)* mapeia o retângulo de origem para o retângulo de destino.</span><span class="sxs-lookup"><span data-stu-id="e18a5-105">The transformation *T(Src)* maps the source rectangle to the destination rectangle.</span></span> <span data-ttu-id="e18a5-106">Eles são especificados pelos membros **rcSource** e **RcTarget** da estrutura [**VIDEOINFOHEADER**](/previous-versions/windows/desktop/api/amvideo/ns-amvideo-videoinfoheader) ou [**VIDEOINFOHEADER2**](/previous-versions/windows/desktop/api/dvdmedia/ns-dvdmedia-videoinfoheader2) no tipo de mídia.</span><span class="sxs-lookup"><span data-stu-id="e18a5-106">These are specified by the **rcSource** and **rcTarget** members of the [**VIDEOINFOHEADER**](/previous-versions/windows/desktop/api/amvideo/ns-amvideo-videoinfoheader) or [**VIDEOINFOHEADER2**](/previous-versions/windows/desktop/api/dvdmedia/ns-dvdmedia-videoinfoheader2) structure in the media type.</span></span> <span data-ttu-id="e18a5-107">Esse mapeamento processa a imagem de origem conforme ela passa para o VMR.</span><span class="sxs-lookup"><span data-stu-id="e18a5-107">This mapping preprocesses the source image as it passes to the VMR.</span></span>
2.  <span data-ttu-id="e18a5-108">A transformação *T (Flag)* executa quaisquer manipulações de imagem especificadas por sinalizadores no exemplo de mídia.</span><span class="sxs-lookup"><span data-stu-id="e18a5-108">The transformation *T(Flag)* performs any image manipulations specified by flags in the media sample.</span></span> <span data-ttu-id="e18a5-109">Elas incluíram transformações, como a tradução vertical e a escala para acomodar os sinalizadores de entrelaçamento de Bob.</span><span class="sxs-lookup"><span data-stu-id="e18a5-109">These included transformations such as the vertical translation and scale to accommodate the bob interlace flags.</span></span> <span data-ttu-id="e18a5-110">A transformação entrelaçar dobra a altura da imagem e possivelmente traduz a imagem pela metade de uma linha de vídeo se ela estiver no campo ímpar.</span><span class="sxs-lookup"><span data-stu-id="e18a5-110">The interlace transformation doubles the image height and possibly translates the image by half of a video line if it is in the odd field.</span></span>
3.  <span data-ttu-id="e18a5-111">A transformação *T (ar)* ajusta a imagem para pixels quadrados, com base na taxa de proporção da imagem.</span><span class="sxs-lookup"><span data-stu-id="e18a5-111">The transformation *T(AR)* adjusts the image to square pixels, based on the image aspect ratio.</span></span> <span data-ttu-id="e18a5-112">Para tipos de mídia **VIDEOINFOHEADER** , a taxa de proporção é determinada pelo tamanho da imagem.</span><span class="sxs-lookup"><span data-stu-id="e18a5-112">For **VIDEOINFOHEADER** media types, the aspect ratio is determined by the image size.</span></span> <span data-ttu-id="e18a5-113">Para tipos **VIDEOINFOHEADER2** , a taxa de proporção é determinada pelos campos **dwPictAspectRatioX** e **dwPictAspectRatioY** , a menos que o \_ painel AMCONTROL \_ para \_ 16x9 ou AMCONTROL \_ pad \_ para \_ 4x3 flags seja definido.</span><span class="sxs-lookup"><span data-stu-id="e18a5-113">For **VIDEOINFOHEADER2** types, the aspect ratio is determined by the **dwPictAspectRatioX** and **dwPictAspectRatioY** fields, unless the AMCONTROL\_PAD\_TO\_16x9 or AMCONTROL\_PAD\_TO\_4x3 flags are set.</span></span> <span data-ttu-id="e18a5-114">Essa transformação pressupõe que a configuração de exibição do monitor corresponda à taxa de proporção física do monitor.</span><span class="sxs-lookup"><span data-stu-id="e18a5-114">This transformation assumes that the monitor display setting matches the physical aspect ratio of the monitor.</span></span> <span data-ttu-id="e18a5-115">Por exemplo, se o usuário tiver um monitor com taxa de proporção de 4 x 3, mas definir a exibição como 1280 x 768 pixels (5 x 3), a imagem não terá a taxa de proporção correta.</span><span class="sxs-lookup"><span data-stu-id="e18a5-115">For example, if the user has a monitor with 4 x 3 aspect ratio, but sets the display to 1280 x 768 pixels (5 x 3), the image will not have the correct aspect ratio.</span></span>
4.  <span data-ttu-id="e18a5-116">As transformações *T (Mix)* de transformação posicionam a imagem na imagem de destino, usando os retângulos normalizados especificados nos métodos [**IVMRMixerControl**](/windows/desktop/api/Strmif/nn-strmif-ivmrmixercontrol) .</span><span class="sxs-lookup"><span data-stu-id="e18a5-116">The transformation *T(Mix)* transforms positions the image within the destination image, using the normalized rectangles specified in the [**IVMRMixerControl**](/windows/desktop/api/Strmif/nn-strmif-ivmrmixercontrol) methods.</span></span> <span data-ttu-id="e18a5-117">Os retângulos normalizados permitem que o aplicativo organize como os fluxos de origem são posicionados e dimensionados em relação uns com os outros.</span><span class="sxs-lookup"><span data-stu-id="e18a5-117">The normalized rectangles enable the application to organize how the source streams are positioned and scaled relative to each other.</span></span> <span data-ttu-id="e18a5-118">O VMR computa a imagem de destino computando as dimensões máximas de todas as imagens de origem e centralizando cada uma dentro de um retângulo delimitador geral.</span><span class="sxs-lookup"><span data-stu-id="e18a5-118">The VMR computes the destination image by computing the maximum dimensions of all the source images and centering each inside an overall bounding rectangle.</span></span> <span data-ttu-id="e18a5-119">Os cantos do retângulo delimitador são atribuídos ao intervalo (0, 0) a (1, 1).</span><span class="sxs-lookup"><span data-stu-id="e18a5-119">The corners of the bounding rectangle are assigned the range (0,0) to (1,1).</span></span> <span data-ttu-id="e18a5-120">O retângulo delimitador é corrigido antes que o grafo seja executado e permaneça constante, mesmo se os fluxos forem adicionados ou excluídos.</span><span class="sxs-lookup"><span data-stu-id="e18a5-120">The bounding rectangle is fixed before the graph runs and remains constant even if streams are added or deleted.</span></span> <span data-ttu-id="e18a5-121">Os retângulos de destino de cada fluxo podem ficar fora do intervalo (0, 0) a (1, 1) e ainda ser válidos.</span><span class="sxs-lookup"><span data-stu-id="e18a5-121">Destination rectangles for each stream can lie outside of the range (0,0) to (1,1) and still be valid.</span></span>
5.  <span data-ttu-id="e18a5-122">Por fim, uma parte da imagem mista pode ser transformada pelo *T de mapeamento (DST)*, especificado pelos retângulos de origem e de destino na interface [**IBasicVideo**](/windows/desktop/api/Control/nn-control-ibasicvideo) no VMR.</span><span class="sxs-lookup"><span data-stu-id="e18a5-122">Finally, a portion of the mixed image can be transformed by the mapping *T(Dst)*, specified by the source and destination rectangles in the [**IBasicVideo**](/windows/desktop/api/Control/nn-control-ibasicvideo) interface on the VMR.</span></span> <span data-ttu-id="e18a5-123">Se a Allocator-Presenter for substituída e a interface **IBasicVideo** não for usada, o aplicativo deverá implementar a interface [**IVMRWindowlessControl**](/windows/desktop/api/Strmif/nn-strmif-ivmrwindowlesscontrol) e mapear as coordenadas de volta para um espaço linear 2D.</span><span class="sxs-lookup"><span data-stu-id="e18a5-123">If the Allocator-Presenter is replaced and the **IBasicVideo** interface is not used, the application must implement the [**IVMRWindowlessControl**](/windows/desktop/api/Strmif/nn-strmif-ivmrwindowlesscontrol) interface and map the coordinates back into a 2D linear space.</span></span> <span data-ttu-id="e18a5-124">As coordenadas do mouse retornadas para o navegador de DVD também devem estar nesse espaço.</span><span class="sxs-lookup"><span data-stu-id="e18a5-124">The mouse coordinates returned to the DVD navigator must also be in this space.</span></span> <span data-ttu-id="e18a5-125">Por exemplo, se um aplicativo renderizar o vídeo em um cubo de rotação, ele relatará a exibição inteira para o controle sem janela e retornará as coordenadas do mouse relativas à exibição.</span><span class="sxs-lookup"><span data-stu-id="e18a5-125">For example, if an application renders video onto a spinning cube, they would report back the entire display for the windowless control and return mouse coordinates relative to the display.</span></span>

<span data-ttu-id="e18a5-126">A transformação de imagem geral dos dados de origem para o renderizador final é:</span><span class="sxs-lookup"><span data-stu-id="e18a5-126">The overall image transformation from the source data to the final renderer is:</span></span>

<span data-ttu-id="e18a5-127">T = T (src) \* t (Flag) t (ar) t (Mix) \* t (DST)\*</span><span class="sxs-lookup"><span data-stu-id="e18a5-127">T = T(Src)\* T(Flag)T(Ar)T(Mix)\* T(Dst)\*</span></span>

<span data-ttu-id="e18a5-128">onde \* indica que a imagem pode ser recortada para a imagem de destino nesse estágio.</span><span class="sxs-lookup"><span data-stu-id="e18a5-128">where \* indicates that the image could be clipped to the destination image at that stage.</span></span> <span data-ttu-id="e18a5-129">Observe que todas são transformações afim, de modo que o VMR pode combiná-las em uma única transformação.</span><span class="sxs-lookup"><span data-stu-id="e18a5-129">Note that these are all affine transformations, so the VMR can combine them into a single transformation.</span></span>

<span data-ttu-id="e18a5-130">O inverso da transformação é:</span><span class="sxs-lookup"><span data-stu-id="e18a5-130">The inverse of the transformation is:</span></span>

![transformação inversa](images/vmrmapping-t-1.png)

<span data-ttu-id="e18a5-132">O fator T (src) T (Flag) T (ar) é relativo à resolução de origem.</span><span class="sxs-lookup"><span data-stu-id="e18a5-132">The factor T(Src) T(Flag) T(Ar) is relative to the source resolution.</span></span> <span data-ttu-id="e18a5-133">No fator T (Mix), o retângulo de origem normalizado é relativo à imagem com correção de aspecto.</span><span class="sxs-lookup"><span data-stu-id="e18a5-133">In the factor T(Mix), the normalized source rectangle is relative to the aspect-corrected image.</span></span> <span data-ttu-id="e18a5-134">O retângulo de destino normalizado é relativo à resolução de saída.</span><span class="sxs-lookup"><span data-stu-id="e18a5-134">The normalized destination rectangle is relative to the output resolution.</span></span> <span data-ttu-id="e18a5-135">O diagrama a seguir mostra essas relações.</span><span class="sxs-lookup"><span data-stu-id="e18a5-135">The following diagram shows these relationships.</span></span>

![etapas de transformação de imagem](images/vmrmapping-transform-steps.png)

## <a name="related-topics"></a><span data-ttu-id="e18a5-137">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="e18a5-137">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="e18a5-138">Usando o VMR para desenvolvedores de filtro do DirectShow</span><span class="sxs-lookup"><span data-stu-id="e18a5-138">Using the VMR for DirectShow Filter Developers</span></span>](using-the-vmr-for-directshow-filter-developers.md)
</dt> </dl>

 

 



