---
description: Implemente o suporte para negociação de tipo de mídia como parte da gravação de um filtro de transformação. O tipo de mídia descreve o formato dos dados.
ms.assetid: b2b5dafc-d38d-4ec3-a390-55229495b4f9
title: Etapa 3. Suporte à negociação de tipo de mídia
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3a23784e70330f751325fc5f780463d5a3904d20
ms.sourcegitcommit: 5d4e99f4c8f42f5f543e52cb9beb9fb13ec56c5f
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 06/19/2021
ms.locfileid: "112410039"
---
# <a name="step-3-support-media-type-negotiation"></a><span data-ttu-id="3d552-105">Etapa 3.</span><span class="sxs-lookup"><span data-stu-id="3d552-105">Step 3.</span></span> <span data-ttu-id="3d552-106">Suporte à negociação de tipo de mídia</span><span class="sxs-lookup"><span data-stu-id="3d552-106">Support Media Type Negotiation</span></span>

<span data-ttu-id="3d552-107">Esta é a etapa 3 do tutorial [escrevendo filtros de transformação](writing-transform-filters.md).</span><span class="sxs-lookup"><span data-stu-id="3d552-107">This is step 3 of the tutorial [Writing Transform Filters](writing-transform-filters.md).</span></span>

<span data-ttu-id="3d552-108">Quando dois Pins se conectam, eles devem concordar com um tipo de mídia para a conexão.</span><span class="sxs-lookup"><span data-stu-id="3d552-108">When two pins connect, they must agree on a media type for the connection.</span></span> <span data-ttu-id="3d552-109">O tipo de mídia descreve o formato dos dados.</span><span class="sxs-lookup"><span data-stu-id="3d552-109">The media type describes the format of the data.</span></span> <span data-ttu-id="3d552-110">Sem o tipo de mídia, um filtro pode fornecer um tipo de dados, apenas para que outro filtro o trate como algo mais.</span><span class="sxs-lookup"><span data-stu-id="3d552-110">Without the media type, a filter might deliver one kind of data, only to have another filter treat it as something else.</span></span>

<span data-ttu-id="3d552-111">O mecanismo básico para negociar tipos de mídia é o método [**IPin:: ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) .</span><span class="sxs-lookup"><span data-stu-id="3d552-111">The basic mechanism for negotiating media types is the [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) method.</span></span> <span data-ttu-id="3d552-112">O pino de saída chama esse método no pino de entrada com um tipo de mídia proposto.</span><span class="sxs-lookup"><span data-stu-id="3d552-112">The output pin calls this method on the input pin with a proposed media type.</span></span> <span data-ttu-id="3d552-113">O PIN de entrada aceita a conexão ou a rejeita.</span><span class="sxs-lookup"><span data-stu-id="3d552-113">The input pin accepts the connection or rejects it.</span></span> <span data-ttu-id="3d552-114">Se ele rejeitar a conexão, o pino de saída poderá tentar outro tipo de mídia.</span><span class="sxs-lookup"><span data-stu-id="3d552-114">If it rejects the connection, the output pin can try another media type.</span></span> <span data-ttu-id="3d552-115">Se nenhum tipo adequado for encontrado, a conexão falhará.</span><span class="sxs-lookup"><span data-stu-id="3d552-115">If no suitable types are found, the connection fails.</span></span> <span data-ttu-id="3d552-116">Opcionalmente, o pino de entrada pode anunciar uma lista de tipos que ele prefere, por meio do método [**IPin:: EnumMediaTypes**](/windows/desktop/api/Strmif/nf-strmif-ipin-enummediatypes) .</span><span class="sxs-lookup"><span data-stu-id="3d552-116">Optionally, the input pin can advertise a list of types that it prefers, through the [**IPin::EnumMediaTypes**](/windows/desktop/api/Strmif/nf-strmif-ipin-enummediatypes) method.</span></span> <span data-ttu-id="3d552-117">O pino de saída pode usar essa lista quando propõe tipos de mídia, embora não seja necessário.</span><span class="sxs-lookup"><span data-stu-id="3d552-117">The output pin can use this list when it proposes media types, although it does not have to.</span></span>

<span data-ttu-id="3d552-118">A classe **CTransformFilter** implementa uma estrutura geral para esse processo, da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="3d552-118">The **CTransformFilter** class implements a general framework for this process, as follows:</span></span>

-   <span data-ttu-id="3d552-119">O PIN de entrada não tem nenhum tipo de mídia preferencial.</span><span class="sxs-lookup"><span data-stu-id="3d552-119">The input pin has no preferred media types.</span></span> <span data-ttu-id="3d552-120">Ele se baseia inteiramente no filtro upstream para propor o tipo de mídia.</span><span class="sxs-lookup"><span data-stu-id="3d552-120">It relies entirely on the upstream filter to propose the media type.</span></span> <span data-ttu-id="3d552-121">Para dados de vídeo, isso faz sentido, pois o tipo de mídia inclui o tamanho da imagem e a taxa de quadros.</span><span class="sxs-lookup"><span data-stu-id="3d552-121">For video data, this makes sense, because the media type includes the image size and the frame rate.</span></span> <span data-ttu-id="3d552-122">Normalmente, essas informações devem ser fornecidas por um filtro de origem upstream ou um filtro de analisador.</span><span class="sxs-lookup"><span data-stu-id="3d552-122">Typically, that information must be supplied by an upstream source filter or parser filter.</span></span> <span data-ttu-id="3d552-123">No caso de dados de áudio, o conjunto de formatos possíveis é menor, portanto, pode ser prático para o pino de entrada oferecer alguns tipos preferenciais.</span><span class="sxs-lookup"><span data-stu-id="3d552-123">In the case of audio data, the set of possible formats is smaller, so it may be practical for the input pin to offer some preferred types.</span></span> <span data-ttu-id="3d552-124">Nesse caso, substitua [**CBasePin:: GetMediaType**](cbasepin-getmediatype.md) no pino de entrada.</span><span class="sxs-lookup"><span data-stu-id="3d552-124">In that case, override [**CBasePin::GetMediaType**](cbasepin-getmediatype.md) on the input pin.</span></span>
-   <span data-ttu-id="3d552-125">Quando o filtro upstream propõe um tipo de mídia, o pino de entrada chama o método [**CTransformFilter:: CheckInputType**](ctransformfilter-checkinputtype.md) , que aceita ou rejeita o tipo.</span><span class="sxs-lookup"><span data-stu-id="3d552-125">When the upstream filter proposes a media type, the input pin calls the [**CTransformFilter::CheckInputType**](ctransformfilter-checkinputtype.md) method, which accepts or rejects the type.</span></span>
-   <span data-ttu-id="3d552-126">O pino de saída não será conectado, a menos que o PIN de entrada seja conectado primeiro.</span><span class="sxs-lookup"><span data-stu-id="3d552-126">The output pin will not connect unless the input pin is connected first.</span></span> <span data-ttu-id="3d552-127">Esse comportamento é típico para filtros de transformação.</span><span class="sxs-lookup"><span data-stu-id="3d552-127">This behavior is typical for transform filters.</span></span> <span data-ttu-id="3d552-128">Na maioria dos casos, o filtro deve determinar o tipo de entrada antes de poder definir o tipo de saída.</span><span class="sxs-lookup"><span data-stu-id="3d552-128">In most cases, the filter must determine the input type before it can set the output type.</span></span>
-   <span data-ttu-id="3d552-129">Quando o pino de saída se conecta, ele tem uma lista de tipos de mídia que ele propõe ao filtro downstream.</span><span class="sxs-lookup"><span data-stu-id="3d552-129">When the output pin does connect, it has a list of media types that it proposes to the downstream filter.</span></span> <span data-ttu-id="3d552-130">Ele chama o método [**CTransformFilter:: GetMediaType**](ctransformfilter-getmediatype.md) para gerar essa lista.</span><span class="sxs-lookup"><span data-stu-id="3d552-130">It calls the [**CTransformFilter::GetMediaType**](ctransformfilter-getmediatype.md) method to generate this list.</span></span> <span data-ttu-id="3d552-131">O pino de saída também tentará quaisquer tipos de mídia que o filtro de downstream propõe.</span><span class="sxs-lookup"><span data-stu-id="3d552-131">The output pin will also try any media types that the downstream filter proposes.</span></span>
-   <span data-ttu-id="3d552-132">Para verificar se um tipo de saída específico é compatível com o tipo de entrada, o pino de saída chama o método [**CTransformFilter:: CheckTransform**](ctransformfilter-checktransform.md) .</span><span class="sxs-lookup"><span data-stu-id="3d552-132">To check whether a particular output type is compatible with the input type, the output pin calls the [**CTransformFilter::CheckTransform**](ctransformfilter-checktransform.md) method.</span></span>

<span data-ttu-id="3d552-133">Os três métodos **CTransformFilter** listados anteriormente são métodos virtuais puros, portanto, sua classe derivada deve implementá-los.</span><span class="sxs-lookup"><span data-stu-id="3d552-133">The three **CTransformFilter** methods listed previously are pure virtual methods, so your derived class must implement them.</span></span> <span data-ttu-id="3d552-134">Nenhum desses métodos pertence a uma interface COM; Eles são simplesmente parte da implementação fornecida pelas classes base.</span><span class="sxs-lookup"><span data-stu-id="3d552-134">None of these methods belongs to a COM interface; they are simply part of the implementation provided by the base classes.</span></span>

<span data-ttu-id="3d552-135">As seções a seguir descrevem cada método em mais detalhes:</span><span class="sxs-lookup"><span data-stu-id="3d552-135">The following sections describe each method in more detail:</span></span>

-   [<span data-ttu-id="3d552-136">Etapa 3A. Implementar o método CheckInputType</span><span class="sxs-lookup"><span data-stu-id="3d552-136">Step 3A. Implement the CheckInputType Method</span></span>](step-3a--implement-the-checkinputtype-method.md)
-   [<span data-ttu-id="3d552-137">Etapa 3B. Implementar o método GetMediaType</span><span class="sxs-lookup"><span data-stu-id="3d552-137">Step 3B. Implement the GetMediaType Method</span></span>](step-3b--implement-the-getmediatype-method.md)
-   [<span data-ttu-id="3d552-138">Etapa 3C. Implementar o método CheckTransform</span><span class="sxs-lookup"><span data-stu-id="3d552-138">Step 3C. Implement the CheckTransform Method</span></span>](step-3c--implement-the-checktransform-method.md)

## <a name="related-topics"></a><span data-ttu-id="3d552-139">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="3d552-139">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="3d552-140">Como os filtros se conectam</span><span class="sxs-lookup"><span data-stu-id="3d552-140">How Filters Connect</span></span>](how-filters-connect.md)
</dt> <dt>

[<span data-ttu-id="3d552-141">Gravando filtros do DirectShow</span><span class="sxs-lookup"><span data-stu-id="3d552-141">Writing DirectShow Filters</span></span>](writing-directshow-filters.md)
</dt> </dl>

 

 



