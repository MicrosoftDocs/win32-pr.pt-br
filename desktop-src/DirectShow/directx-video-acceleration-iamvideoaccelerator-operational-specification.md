---
description: Especificação operacional do IAMVideoAccelerator de aceleração de vídeo DirectX
ms.assetid: 25ee05d5-8554-4739-9122-e3c0255bf965
title: Especificação operacional do IAMVideoAccelerator de aceleração de vídeo DirectX
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3360e18e91197f2a15a36fb112f0419b6382e915
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/06/2021
ms.locfileid: "103919710"
---
# <a name="directx-video-acceleration-iamvideoaccelerator-operational-specification"></a><span data-ttu-id="dc419-103">Especificação operacional do IAMVideoAccelerator de aceleração de vídeo DirectX</span><span class="sxs-lookup"><span data-stu-id="dc419-103">DirectX Video Acceleration IAMVideoAccelerator Operational Specification</span></span>

<span data-ttu-id="dc419-104">O mecanismo preciso de operação é o seguinte:</span><span class="sxs-lookup"><span data-stu-id="dc419-104">The precise mechanism of operation is as follows:</span></span>

1.  <span data-ttu-id="dc419-105">Cada perfil de modo restrito definido neste documento tem um GUID VA do DirectX associado, que pode ser suportado por um pino de entrada downstream [**IPin:: QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) e [**IPin:: ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) e listado em [**IAMVideoAccelerator:: GetVideoAcceleratorGUIDs**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getvideoacceleratorguids).</span><span class="sxs-lookup"><span data-stu-id="dc419-105">Each restricted mode profile defined herein has an associated DirectX VA GUID which can be supported by a downstream input pin's [**IPin::QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) and [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) and listed in [**IAMVideoAccelerator::GetVideoAcceleratorGUIDs**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getvideoacceleratorguids).</span></span>
2.  <span data-ttu-id="dc419-106">Da mesma forma, cada tipo de protocolo de criptografia para uso com DirectX VA deve ter um GUID de tipo de protocolo de criptografia associado, que pode ser suportado por um pino de entrada downstream [**IPin:: QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) e [**IPin:: ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) e listado em **IAMVideoAccelerator:: GetVideoAcceleratorGUIDs**.</span><span class="sxs-lookup"><span data-stu-id="dc419-106">Similarly, each encryption protocol type for use with DirectX VA shall have an associated encryption protocol type GUID which can be supported by a downstream input pin's [**IPin::QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) and [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) and listed in **IAMVideoAccelerator::GetVideoAcceleratorGUIDs**.</span></span> <span data-ttu-id="dc419-107">O GUID de "sem criptografia" DXVA \_ noencrypt não deve ser enviado nesta lista, pois o suporte para ele é necessário e, portanto, implícito.</span><span class="sxs-lookup"><span data-stu-id="dc419-107">The "no encryption" GUID DXVA\_NoEncrypt shall not be sent in this list, as support for it is required and therefore implicit.</span></span>
3.  <span data-ttu-id="dc419-108">Depois de chamar [**IPin:: ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) para tentar uma conexão com o pino de entrada downstream, o [**IAMVideoAcceleratorNotify:: GetCreateVideoAcceleratorData**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoacceleratornotify-getcreatevideoacceleratordata) do decodificador deve retornar um ponteiro para uma estrutura de dados de conexão de DXVA \_ que contém as informações do modo de conexão para a conexão.</span><span class="sxs-lookup"><span data-stu-id="dc419-108">After calling [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) to attempt a connection to the downstream input pin, the decoder's [**IAMVideoAcceleratorNotify::GetCreateVideoAcceleratorData**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoacceleratornotify-getcreatevideoacceleratordata) shall return a pointer to a DXVA\_ConnectMode data structure containing the connection mode information for the connection.</span></span> <span data-ttu-id="dc419-109">[**IAMVideoAccelerator:: GetCompBufferInfo**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getcompbufferinfo) deve ser chamado com \* pdwNumTypesCompBuffers = 16 e deve retornar informações de buffer compactadas com base na Convenção de que o número de tipo de cada buffer (conforme definido na seção 3,4 da especificação do DirectX VA) pode ser usado diretamente como o índice de base zero na matriz de estruturas de dados **AMVACompBufferInfo** que é retornada.</span><span class="sxs-lookup"><span data-stu-id="dc419-109">[**IAMVideoAccelerator::GetCompBufferInfo**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getcompbufferinfo) shall be called with \*pdwNumTypesCompBuffers = 16 and shall return compressed buffer information based on the convention that the type number of each buffer (as defined in Section 3.4 of the DirectX VA specification) can be used directly as the zero-based index into the array of **AMVACompBufferInfo** data structures that is returned.</span></span> <span data-ttu-id="dc419-110">Isso requer que, para qualquer tipo de buffer que não seja usado (incluindo o tipo de buffer 0, como não há nenhum uso definido desse tipo de buffer), o driver de acelerador fornecerá estruturas de dados AMVACompBufferInfo com alguma forma de valores de parâmetro "fictícios" (como dwNumCompBuffers = 0, dwWidthToCreate = 0, dwHeightToCreate = 0 e dwBytesToAllocate = 0).</span><span class="sxs-lookup"><span data-stu-id="dc419-110">This requires that for any buffer types that will not be used (including buffer type 0, since there is no defined use of that buffer type), the accelerator driver will provide AMVACompBufferInfo data structures with some form of "dummy" parameter values (such as dwNumCompBuffers=0, dwWidthToCreate=0, dwHeightToCreate=0, and dwBytesToAllocate=0).</span></span>
4.  <span data-ttu-id="dc419-111">As indicações de função DXVA e os buffers de dados associados são enviados usando [**IAMVideoAccelerator:: execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute).</span><span class="sxs-lookup"><span data-stu-id="dc419-111">DXVA function indications and associated data buffers are sent using [**IAMVideoAccelerator::Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute).</span></span> <span data-ttu-id="dc419-112">A função DXVA é indicada no parâmetro dwFunction da chamada.</span><span class="sxs-lookup"><span data-stu-id="dc419-112">The DXVA function is indicated in the dwFunction parameter of the call.</span></span> <span data-ttu-id="dc419-113">As únicas funções de DXVA que são relevantes para a inicialização são a DXVA \_ ConfigQueryOrReplyFunc e a DXVA \_ EncryptProtocolFunc.</span><span class="sxs-lookup"><span data-stu-id="dc419-113">The only DXVA functions that are relevant for initialization are DXVA\_ConfigQueryOrReplyFunc and DXVA\_EncryptProtocolFunc.</span></span>
    -   <span data-ttu-id="dc419-114">Se dwFunction contiver um DXVA \_ ConfigQueryOrReplyFunc, o ponteiro lpPrivateInputData para passar dados para o acelerador nessa chamada deverá apontar para uma estrutura de dados de configuração, o ponteiro lpPrivateOutputData para receber informações do acelerador deve apontar para uma área em que uma estrutura de dados de configuração alternativa ou duplicada pode ser colocada, o ponteiro pamvaBufferInfo para uma matriz de AMVABUFFERINFO deve ser **nulo** e dwNumBuffers deve ser zero.</span><span class="sxs-lookup"><span data-stu-id="dc419-114">If dwFunction contains a DXVA\_ConfigQueryOrReplyFunc, the lpPrivateInputData pointer for passing data to the accelerator in this call shall point to a configuration data structure, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area where an alternative or duplicate configuration data structure can be placed, the pamvaBufferInfo pointer for an array of AMVABUFFERINFO shall be **NULL**, and dwNumBuffers shall be zero.</span></span> <span data-ttu-id="dc419-115">O HRESULT retornado contém a \_ indicação s OK ou s \_ false ou \_ falha ou \_ INVALIDARG ou alguma outra indicação de erro HRESULT no caso de um problema grave na execução do protocolo (como um parâmetro de configuração inválido).</span><span class="sxs-lookup"><span data-stu-id="dc419-115">The returned HRESULT contains the S\_OK or S\_FALSE indication, or E\_FAIL or E\_INVALIDARG or some other error indication HRESULT in the event of a severe problem in protocol execution (such as an invalid configuration parameter).</span></span> <span data-ttu-id="dc419-116">Todas as chamadas para **IAMVideoAccelerator:: execute** para todos os usos de DXVA \_ ConfigQueryOrReplyFunc devem preceder todas as outras chamadas para **IAMVideoAccelerator:: execute**.</span><span class="sxs-lookup"><span data-stu-id="dc419-116">All calls to **IAMVideoAccelerator::Execute** for all uses of DXVA\_ConfigQueryOrReplyFunc shall precede all other calls to **IAMVideoAccelerator::Execute**.</span></span>
    -   <span data-ttu-id="dc419-117">Se dwFunction contiver um DXVA \_ EncryptProtocolFunc, o ponteiro lpPrivateInputData para passar dados para o acelerador nessa chamada deverá apontar para uma estrutura de dados de protocolo de criptografia que comece com o DXVA \_ EncryptProtocolHeader, o ponteiro lpPrivateOutputData para receber informações do acelerador deve apontar para uma área em que os dados a serem retornados (como um certificado) pelo protocolo de criptografia (que começará com o DXVA \_ EncryptProtocolHeader) podem ser colocados, o ponteiro pamvaBufferInfo para uma matriz de AMVABUFFERINFO deve ser **nulo** e dwNumBuffers deve ser zero.</span><span class="sxs-lookup"><span data-stu-id="dc419-117">If dwFunction contains a DXVA\_EncryptProtocolFunc, the lpPrivateInputData pointer for passing data to the accelerator in this call shall point to an encryption protocol data structure that begins with DXVA\_EncryptProtocolHeader, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area where the data to be returned (such as a certificate) by the encryption protocol (which will begin with DXVA\_EncryptProtocolHeader) can be placed, the pamvaBufferInfo pointer for an array of AMVABUFFERINFO shall be **NULL**, and dwNumBuffers shall be zero.</span></span> <span data-ttu-id="dc419-118">O HRESULT retornado contém S \_ OK, desde que o protocolo de criptografia esteja funcionando normalmente e contenha e \_ falhe ou e \_ INVALIDARG ou alguma outra indicação de erro HRESULT no caso de um problema grave na execução do protocolo.</span><span class="sxs-lookup"><span data-stu-id="dc419-118">The returned HRESULT contains S\_OK as long as the encryption protocol is functioning normally and contains E\_FAIL or E\_INVALIDARG or some other error indication HRESULT in the event of a severe problem in protocol execution.</span></span>

        <span data-ttu-id="dc419-119">Após a inicialização da operação no modo anterior, a operação real do decodificador continua da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="dc419-119">After initialization of operation in the above fashion, the actual operation of the decoder proceeds as follows:</span></span>

5.  <span data-ttu-id="dc419-120">**IAMVideoAccelerator:: BeginFrame** deve ser chamado antes de enviar qualquer bDXVA \_ Func com parâmetros de buffer compactados que causam gravações em uma superfície de destino descompactada.</span><span class="sxs-lookup"><span data-stu-id="dc419-120">**IAMVideoAccelerator::BeginFrame** shall be called prior to sending any bDXVA\_Func with compressed buffer parameters which cause writes to an uncompressed destination surface.</span></span> <span data-ttu-id="dc419-121">A finalidade de [**IAMVideoAccelerator:: BeginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) no DirectX VA é associar as superfícies de destino a valores de índice e notificar o driver de acelerador de vídeo da intenção de iniciar a gravação de uma superfície para que o driver possa responder com uma indicação de se a superfície está pronta para ser substituída.</span><span class="sxs-lookup"><span data-stu-id="dc419-121">The purpose of [**IAMVideoAccelerator::BeginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) in DirectX VA is to associate destination surfaces with index values and to notify the video accelerator driver of the intent to initiate writes a surface so that the driver can respond with an indication of whether the surface is ready to be overwritten.</span></span> <span data-ttu-id="dc419-122">A estrutura **AMVABeginFrameInfo** passada em **IAMVideoAccelerator:: BeginFrame** deve conter um ponteiro pInputData para o parâmetro single Word wBeginPictureIndex que corresponde ao índice de quadro passado em **IAMVideoAccelerator:: BeginFrame** (e dwSizeInputData deve ser 2).</span><span class="sxs-lookup"><span data-stu-id="dc419-122">The **AMVABeginFrameInfo** structure passed in **IAMVideoAccelerator::BeginFrame** shall contain a pInputData pointer to single WORD wBeginPictureIndex parameter matching the frame index passed into **IAMVideoAccelerator::BeginFrame** (and dwSizeInputData shall be 2).</span></span> <span data-ttu-id="dc419-123">Este é o índice a ser usado em um buffer compactado para gravar uma gravação na superfície (por exemplo, para ser usado como wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex ou wPicResampleDestPicIndex).</span><span class="sxs-lookup"><span data-stu-id="dc419-123">This is the index to be used in a compressed buffer to command a write to the surface (for example, to be used as wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex).</span></span> <span data-ttu-id="dc419-124">Cada chamada para **IAMVideoAccelerator:: BeginFrame** deve ser emparelhada com uma chamada correspondente para [**IAMVideoAccelerator:: endframe**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) conforme descrito abaixo.</span><span class="sxs-lookup"><span data-stu-id="dc419-124">Each call to **IAMVideoAccelerator::BeginFrame** shall be paired with a corresponding call to [**IAMVideoAccelerator::EndFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) as described below.</span></span> <span data-ttu-id="dc419-125">Por exemplo, se uma imagem compactada for decodificada e alfa combinada usando a mesclagem de buffer de front-end para buffer com uma imagem gráfica, haveria uma chamada para **IAMVideoAccelerator:: BeginFrame** antes de decodificar a imagem compactada em uma superfície especificada em wDecodedPictureIndex, em seguida, uma chamada para **IAMVideoAccelerator:: endframe** depois de passar todos os buffers compactados usados para decodificar a imagem e, em seguida, uma segunda chamada para **IAMVideoAccelerator:: BeginFrame** antes de fazer o comando da combinação de mistura alfa da origem gráfica com a imagem decodificada em uma superfície especificada em wBlendedDestinationIndex e depois uma segunda chamada para **IAMVideoAccelerator:: endframe** após a operação de combinação O ponteiro pOutputData em AMVABeginFrameInfo deve ser **nulo** (e dwSizeOutputData deve ser "0").</span><span class="sxs-lookup"><span data-stu-id="dc419-125">For example, if a compressed picture is to be decoded and then alpha blended using front-end buffer-to-buffer blending with a graphic image, there would be a call to **IAMVideoAccelerator::BeginFrame** prior to decoding the compressed picture into a surface specified in wDecodedPictureIndex, then a call to **IAMVideoAccelerator::EndFrame** after passing all compressed buffers used to decode the picture, then a second call to **IAMVideoAccelerator::BeginFrame** prior to commanding alpha blending combination of the graphic source with the decoded picture into a surface specified in wBlendedDestinationIndex, and then a second call to **IAMVideoAccelerator::EndFrame** after the alpha blend combination operation.The pointer pOutputData in AMVABeginFrameInfo shall be **NULL** (and dwSizeOutputData shall be "0").</span></span> <span data-ttu-id="dc419-126">O HRESULT retornado por **IAMVideoAccelerator:: BeginFrame** deve ser:</span><span class="sxs-lookup"><span data-stu-id="dc419-126">The HRESULT that is returned by **IAMVideoAccelerator::BeginFrame** shall be:</span></span>
    -   <span data-ttu-id="dc419-127">S \_ OK se a superfície não compactada estiver disponível e pronta para uso.</span><span class="sxs-lookup"><span data-stu-id="dc419-127">S\_OK if the uncompressed surface is available and ready for use.</span></span>
    -   <span data-ttu-id="dc419-128">E \_ pendente se a superfície descompactada ainda não estiver disponível para uso, mas será disponibilizada em breve (se a superfície não compactada estiver sendo lida para exibição e a leitura/exibição da superfície ainda não tiver sido concluída).</span><span class="sxs-lookup"><span data-stu-id="dc419-128">E\_PENDING if the uncompressed surface is not yet available for use but will become available soon (if the uncompressed surface is being read for display and the reading/display of the surface has not yet been completed).</span></span>
    -   <span data-ttu-id="dc419-129">E \_ Fail ou \_ INVALIDARG alguma outra indicação de erro somente se um erro de protocolo ou formato de dados for detectado (como um valor incorreto de dwSizeInputData ou um POutputData não **nulo** ).</span><span class="sxs-lookup"><span data-stu-id="dc419-129">E\_FAIL or E\_INVALIDARG some other error indication only if a data format or protocol error is detected (such as an incorrect value of dwSizeInputData or a non-**NULL** pOutputData).</span></span>
6.  <span data-ttu-id="dc419-130">As indicações de função DXVA e os buffers de dados associados são enviados usando **IAMVideoAccelerator:: execute**.</span><span class="sxs-lookup"><span data-stu-id="dc419-130">DXVA function indications and associated data buffers are sent using **IAMVideoAccelerator::Execute**.</span></span> <span data-ttu-id="dc419-131">Mais de um \_ valor de Func bDXVA pode ser indicado na mesma chamada para [**IAMVideoAccelerator:: execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute).</span><span class="sxs-lookup"><span data-stu-id="dc419-131">More than one bDXVA\_Func value may be indicated in the same call to [**IAMVideoAccelerator::Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute).</span></span> <span data-ttu-id="dc419-132">Os \_ valores de Func bDXVA devem ser incluídos no parâmetro dwFunction da chamada, com o primeiro comando Function nos oito MSBs, o próximo comando nos próximos oito bits e assim por diante, com quaisquer bits restantes preenchidos com zeros.</span><span class="sxs-lookup"><span data-stu-id="dc419-132">The bDXVA\_Func values shall be packed into the dwFunction parameter of the call, with the first function command in the eight MSBs, the next command in the next eight bits, and so on, with any remaining bits padded out with zeros.</span></span> <span data-ttu-id="dc419-133">O valor 0xFF para bDXVA \_ Func indica que o \_ Func bDXVA é estendido para dois ou quatro bytes.</span><span class="sxs-lookup"><span data-stu-id="dc419-133">The value 0xFF for bDXVA\_Func indicates that the bDXVA\_Func is extended to two or four bytes.</span></span> <span data-ttu-id="dc419-134">Se o segundo byte também for 0xFF, isso indica que bDXVA \_ Func é estendido para quatro bytes.</span><span class="sxs-lookup"><span data-stu-id="dc419-134">If the second byte is also 0xFF, this indicates that bDXVA\_Func is extended to four bytes.</span></span> <span data-ttu-id="dc419-135">Se os quatro bits superiores do terceiro byte forem 0xF ou 0x0, isso indica que bDXVA \_ Func contém um DXVA \_ CONFIGQUERYORREPLYFUNC ou DXVA \_ EncryptProtocolFunc.</span><span class="sxs-lookup"><span data-stu-id="dc419-135">If the upper four bits of the third byte are 0xF or 0x0, this indicates that bDXVA\_Func contains a DXVA\_ConfigQueryOrReplyFunc or DXVA\_EncryptProtocolFunc.</span></span> <span data-ttu-id="dc419-136">Comandos de vários bytes não devem indicar continuação após o final do dwFunction.</span><span class="sxs-lookup"><span data-stu-id="dc419-136">Multi-byte commands shall not indicate continuation past the end of dwFunction.</span></span> <span data-ttu-id="dc419-137">É necessário tomar cuidado com o decodificador para garantir que nenhuma dependência sequencial esteja presente entre diferentes \_ valores de Func bDXVA especificados na mesma chamada para **IAMVideoAccelerator:: execute** e que todas as possíveis condições de corrida (como entre a decodificação de imagem e a mesclagem de subimagem, entre o carregamento de subimagem e a mesclagem de subimagem e assim por diante) são impedidas por chamadas apropriadas para **IAMVideoAccelerator:: BeginFrame** e [**IAMVideoAccelerator:: QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) antes de chamadas subsequentes para **IAMVideoAccelerator:: execute**.</span><span class="sxs-lookup"><span data-stu-id="dc419-137">Care must be taken by the decoder to ensure that no sequential dependencies are present between different bDXVA\_Func values specified in the same call to **IAMVideoAccelerator::Execute** and that all potential race conditions (such as between picture decoding and sub-picture blending, between sub-picture loading and sub-picture blending, and so on) are prevented by appropriate calls to **IAMVideoAccelerator::BeginFrame** and [**IAMVideoAccelerator::QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) before subsequent calls to **IAMVideoAccelerator::Execute**.</span></span>
    -   <span data-ttu-id="dc419-138">Se dwFunction contiver um DXVA \_ ConfigQueryOrReplyFunc, o ponteiro lpPrivateInputData para passar dados para o acelerador nessa chamada deverá apontar para uma estrutura de dados de configuração, o ponteiro lpPrivateOutputData para receber informações do acelerador deve apontar para uma área em que uma estrutura de dados de configuração alternativa ou duplicada pode ser colocada, o ponteiro pamvaBufferInfo para uma matriz de AMVABUFFERINFO deve ser **nulo** e dwNumBuffers deve ser zero.</span><span class="sxs-lookup"><span data-stu-id="dc419-138">If dwFunction contains a DXVA\_ConfigQueryOrReplyFunc, the lpPrivateInputData pointer for passing data to the accelerator in this call shall point to a configuration data structure, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area where an alternative or duplicate configuration data structure can be placed, the pamvaBufferInfo pointer for an array of AMVABUFFERINFO shall be **NULL**, and dwNumBuffers shall be zero.</span></span> <span data-ttu-id="dc419-139">O HRESULT retornado contém a \_ indicação s OK ou s \_ false em resposta à consulta, ou e \_ falha ou e \_ INVALIDARG alguma outra indicação de erro HRESULT no caso de um problema grave na execução do protocolo (como um parâmetro invalid.configuração).</span><span class="sxs-lookup"><span data-stu-id="dc419-139">The returned HRESULT contains the S\_OK or S\_FALSE indication in response to the query, or E\_FAIL or E\_INVALIDARG some other error indication HRESULT in the event of a severe problem in protocol execution (such as an invalid.configuration parameter).</span></span> <span data-ttu-id="dc419-140">Todas as chamadas para **IAMVideoAccelerator:: execute** para todos os usos de DXVA \_ ConfigQueryOrReplyFunc devem preceder todas as outras chamadas para **IAMVideoAccelerator:: execute**.</span><span class="sxs-lookup"><span data-stu-id="dc419-140">All calls to **IAMVideoAccelerator::Execute** for all uses of DXVA\_ConfigQueryOrReplyFunc shall precede all other calls to **IAMVideoAccelerator::Execute**.</span></span>
    -   <span data-ttu-id="dc419-141">Se dwFunction contiver um DXVA \_ EncryptProtocolFunc, o ponteiro lpPrivateInputData para passar dados para o acelerador nessa chamada deverá apontar para uma estrutura de dados de protocolo de criptografia que comece com o DXVA \_ EncryptProtocolHeader, o ponteiro lpPrivateOutputData para receber informações do acelerador deve apontar para uma área em que os dados a serem retornados (como um certificado) pelo protocolo de criptografia (que começará com o DXVA \_ EncryptProtocolHeader) podem ser colocados, o ponteiro pamvaBufferInfo para uma matriz de AMVABUFFERINFO deve ser **nulo** e dwNumBuffers deve ser zero.</span><span class="sxs-lookup"><span data-stu-id="dc419-141">If dwFunction contains a DXVA\_EncryptProtocolFunc, the lpPrivateInputData pointer for passing data to the accelerator in this call shall point to an encryption protocol data structure that begins with DXVA\_EncryptProtocolHeader, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area where the data to be returned (such as a certificate) by the encryption protocol (which will begin with DXVA\_EncryptProtocolHeader) can be placed, the pamvaBufferInfo pointer for an array of AMVABUFFERINFO shall be **NULL**, and dwNumBuffers shall be zero.</span></span> <span data-ttu-id="dc419-142">O HRESULT retornado contém S \_ OK, desde que o protocolo de criptografia esteja funcionando normalmente e contenha e \_ falhe ou e \_ INVALIDARG ou alguma outra indicação de erro HRESULT no caso de um problema grave na execução do protocolo.</span><span class="sxs-lookup"><span data-stu-id="dc419-142">The returned HRESULT contains S\_OK as long as the encryption protocol is functioning normally and contains E\_FAIL or E\_INVALIDARG or some other error indication HRESULT in the event of a severe problem in protocol execution.</span></span>
    -   <span data-ttu-id="dc419-143">Se dwFunction não contiver um DXVA \_ ConfigQueryOrReplyFunc ou DXVA \_ EncryptProtocolFunc, o ponteiro lpPrivateInputData para passar dados para o acelerador deverá apontar para uma lista de descrição do buffer.</span><span class="sxs-lookup"><span data-stu-id="dc419-143">If dwFunction does not contain a DXVA\_ConfigQueryOrReplyFunc or DXVA\_EncryptProtocolFunc, the lpPrivateInputData pointer for passing data to the accelerator shall point to a buffer description list.</span></span> <span data-ttu-id="dc419-144">As quatro primeiras entradas na estrutura da lista de descrição do buffer para cada buffer (dwTypeIndex, dwBufferIndex, dwDataOffset e dwDataSize) devem ser iguais àquelas na estrutura de dados AMVABUFFERINFO para o mesmo buffer.</span><span class="sxs-lookup"><span data-stu-id="dc419-144">The first four entries in the buffer description list structure for each buffer (dwTypeIndex, dwBufferIndex, dwDataOffset, and dwDataSize) shall be equal to those in the AMVABUFFERINFO data structure for the same buffer.</span></span> <span data-ttu-id="dc419-145">Se bDXVA \_ Func for igual a "1" for especificado em dwFunction e bPicReadbackRequests for "1", o ponteiro lpPrivateOutputData para receber informações do acelerador deve apontar para uma área de memória persistente (por exemplo, heap) a ser preenchida com os dados de macrobloco de leitura do acelerador (esses dados não são garantidos até **IAMVideoAccelerator:: QueryRenderStatus** para gravar nos mesmos parâmetros de imagem. o buffer indica S \_ OK, conforme descrito no item 10 abaixo).</span><span class="sxs-lookup"><span data-stu-id="dc419-145">If bDXVA\_Func is equal to "1" is specified within dwFunction and bPicReadbackRequests is "1", the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area of persistent memory (for example heap) to be filled in with read-back macroblock data from the accelerator (such data not guaranteed to be present until **IAMVideoAccelerator::QueryRenderStatus** for writing to the same picture parameters buffer indicates S\_OK as described in item 10 below).</span></span> <span data-ttu-id="dc419-146">Caso contrário, o ponteiro lpPrivateOutputData para receber informações do acelerador deve apontar para um único DWORD a ser definido como um dos seguintes valores de indicação (particularmente útil para relatar erros fragmentado na operação VLD fora do host).</span><span class="sxs-lookup"><span data-stu-id="dc419-146">Otherwise, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to a single DWORD to be set to one of the following indication values (particularly useful for reporting bitstream errors in off-host VLD operation).</span></span>

        | <span data-ttu-id="dc419-147">Valor</span><span class="sxs-lookup"><span data-stu-id="dc419-147">Value</span></span> | <span data-ttu-id="dc419-148">Descrição</span><span class="sxs-lookup"><span data-stu-id="dc419-148">Description</span></span>                                     |
        |-------|-------------------------------------------------|
        | <span data-ttu-id="dc419-149">0</span><span class="sxs-lookup"><span data-stu-id="dc419-149">0</span></span>     | <span data-ttu-id="dc419-150">Execução OK.</span><span class="sxs-lookup"><span data-stu-id="dc419-150">Execution OK.</span></span>                                   |
        | <span data-ttu-id="dc419-151">1</span><span class="sxs-lookup"><span data-stu-id="dc419-151">1</span></span>     | <span data-ttu-id="dc419-152">Foi encontrado um problema secundário no formato de dados.</span><span class="sxs-lookup"><span data-stu-id="dc419-152">Minor problem in data format encountered.</span></span>       |
        | <span data-ttu-id="dc419-153">2</span><span class="sxs-lookup"><span data-stu-id="dc419-153">2</span></span>     | <span data-ttu-id="dc419-154">Foi encontrado um problema significativo no formato de dados.</span><span class="sxs-lookup"><span data-stu-id="dc419-154">Significant problem in data format encountered.</span></span> |
        | <span data-ttu-id="dc419-155">3</span><span class="sxs-lookup"><span data-stu-id="dc419-155">3</span></span>     | <span data-ttu-id="dc419-156">Foi encontrado um problema grave no formato de dados.</span><span class="sxs-lookup"><span data-stu-id="dc419-156">Severe problem in data format encountered.</span></span>      |
        | <span data-ttu-id="dc419-157">4</span><span class="sxs-lookup"><span data-stu-id="dc419-157">4</span></span>     | <span data-ttu-id="dc419-158">Outro problema grave encontrado.</span><span class="sxs-lookup"><span data-stu-id="dc419-158">Other severe problem encountered.</span></span>               |

        

         

        <span data-ttu-id="dc419-159">Se qualquer tipo de problema "grave" for indicado, o decodificador de software deverá parar de operar a (s) função (ões), a menos que a ação corretiva possa ser tomada.</span><span class="sxs-lookup"><span data-stu-id="dc419-159">If either type of "severe" problem is indicated, the software decoder should cease to operate the function(s) unless corrective action can be taken.</span></span> <span data-ttu-id="dc419-160">Esses dados retornados do acelerador não devem ser lidos pelo host até que a renderização do buffer para a imagem seja concluída, pois pode ser testada por [**IAMVideoAccelerator:: QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus).</span><span class="sxs-lookup"><span data-stu-id="dc419-160">This data returned from the accelerator shall not be read by the host until after the buffer rendering for the picture has completed, as can be tested by [**IAMVideoAccelerator::QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus).</span></span> <span data-ttu-id="dc419-161">O HRESULT retornado contém S \_ OK, desde que a operação de interface esteja funcionando normalmente e possa retornar e \_ falhar ou \_ INVALIDARG ou alguma outra indicação de erro HRESULT no caso de um problema grave.</span><span class="sxs-lookup"><span data-stu-id="dc419-161">The returned HRESULT contains S\_OK as long as the interface operation is functioning normally and may return E\_FAIL or E\_INVALIDARG or some other error indication HRESULT in the event of a severe problem.</span></span>

7.  <span data-ttu-id="dc419-162">O buffer de parâmetros de decodificação de imagem deve estar entre os primeiros buffers enviados para a decodificação de cada imagem ao usar [**IAMVideoAccelerator:: execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute) com bDXVA \_ Func igual a "1", e todos os buffers para decodificar uma imagem em um fragmentado devem ser enviados antes de qualquer buffer para decodificar imagens subsequentes.</span><span class="sxs-lookup"><span data-stu-id="dc419-162">The picture decoding parameters buffer shall be among the first buffers sent for the decoding of each picture when using [**IAMVideoAccelerator::Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute) with bDXVA\_Func equal to "1", and all the buffers for decoding a picture in a bitstream shall be sent before any buffers for decoding subsequent pictures.</span></span> <span data-ttu-id="dc419-163">Se um buffer de comando de controle macrobloco for enviado, um buffer de dados de diferença residual correspondente deverá ser enviado (contendo dados para o mesmo macroblocos) com a mesma chamada **IAMVideoAccelerator:: execute** .</span><span class="sxs-lookup"><span data-stu-id="dc419-163">If a macroblock control command buffer is sent, a corresponding residual difference data buffer shall be sent (containing data for the same macroblocks) with the same **IAMVideoAccelerator::Execute** call.</span></span>
8.  <span data-ttu-id="dc419-164">[**IAMVideoAccelerator:: endframe**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) deve ser chamado depois que todos os buffers compactados tiverem sido enviados que causarão a criação do conteúdo de saída em uma superfície descompactada especificada (um resultado de operações especificadas para WDecodedPictureIndex, WDeblockedPictureIndex, WBlendedDestinationIndex ou wPicResampleDestPicIndex).</span><span class="sxs-lookup"><span data-stu-id="dc419-164">[**IAMVideoAccelerator::EndFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) shall be called after all compressed buffers have been sent that will cause the creation of the output content in a specified uncompressed surface (a result of operations specified for wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex).</span></span> <span data-ttu-id="dc419-165">A finalidade dessa chamada para **IAMVideoAccelerator:: endframe** é notificar o hardware acelerador de vídeo que todos os dados necessários para a operação especificada foram enviados.</span><span class="sxs-lookup"><span data-stu-id="dc419-165">The purpose of this call to **IAMVideoAccelerator::EndFrame** is to notify the video accelerator hardware that all data needed for the specified operation has been sent.</span></span> <span data-ttu-id="dc419-166">O ponteiro para dados para enviar downstream por meio de **IAMVideoAccelerator:: endframe** deve apontar para uma única palavra wEndPictureIndex que contém o índice do quadro que está terminando.</span><span class="sxs-lookup"><span data-stu-id="dc419-166">The pointer to data to send downstream through **IAMVideoAccelerator::EndFrame** shall point to a single WORD wEndPictureIndex containing the index of the frame that is ending.</span></span> <span data-ttu-id="dc419-167">Esse parâmetro deve corresponder ao valor de wBeginPictureIndex especificado na chamada anterior para [**IAMVideoAccelerator:: BeginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) antes do envio dos buffers compactados relevantes.</span><span class="sxs-lookup"><span data-stu-id="dc419-167">This parameter shall match the wBeginPictureIndex value specified in the prior call to [**IAMVideoAccelerator::BeginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) before the sending of the relevant compressed buffers.</span></span> <span data-ttu-id="dc419-168">Subsequentemente para uma chamada para **IAMVideoAccelerator:: endframe**, a superfície não compactada com o índice wEndPictureIndex não será encontrada nas WDecodedPictureIndex, WDeblockedPictureIndex, WBlendedDestinationIndex ou wPicResampleDestPicIndex de qualquer imagem até que outra chamada para **IAMVideoAccelerator:: BeginFrame** seja emitida para anunciar que isso ocorrerá e um s \_ OK tenha sido retornado como resultado.</span><span class="sxs-lookup"><span data-stu-id="dc419-168">Subsequent to a call to **IAMVideoAccelerator::EndFrame**, the uncompressed surface with index wEndPictureIndex shall not be found in any picture's wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex until after another call to **IAMVideoAccelerator::BeginFrame** is issued to announce that this will occur and an S\_OK has been returned as a result.</span></span> <span data-ttu-id="dc419-169">No entanto, esse índice de superfície de destino pode ocorrer em comandos de acesso de leitura subsequentes, como wForwardRefPictureIndex, wBackwardRefPictureIndex, wPicResampleSourcePicIndex ou bRefPicSelect \[ i \] .</span><span class="sxs-lookup"><span data-stu-id="dc419-169">However, that destination surface index may occur in subsequent read access commands such as wForwardRefPictureIndex, wBackwardRefPictureIndex, wPicResampleSourcePicIndex, or bRefPicSelect\[i\].</span></span> <span data-ttu-id="dc419-170">O HRESULT retornado por **IAMVideoAccelerator:: endframe** deve ser S \_ OK, a menos que haja algum tipo de formato de dados ou erro de protocolo; nesse caso, ele pode ser e \_ Fail ou \_ INVALIDARG ou alguma outra indicação de erro.</span><span class="sxs-lookup"><span data-stu-id="dc419-170">The HRESULT returned by **IAMVideoAccelerator::EndFrame** shall be S\_OK unless there is some kind of data format or protocol error, in which case it can be E\_FAIL or E\_INVALIDARG or some other error indication.</span></span>
9.  <span data-ttu-id="dc419-171">No caso da decodificação baseada em campo (por exemplo, em MPEG-2 fragmentado), não haverá um mapeamento um-para-um de imagens funcionais no fragmentado para superfícies descompactadas na interface do acelerador.</span><span class="sxs-lookup"><span data-stu-id="dc419-171">In the case of field based decoding (for example, in MPEG-2 bitstreams) there will not be a one-to-one mapping of functional pictures in the bitstream to uncompressed surfaces in the accelerator interface.</span></span> <span data-ttu-id="dc419-172">Ao decodificar imagens de campo em um fragmentado MPEG-2, haverá duas "imagens" decodificadas para produzir uma superfície não compactada de saída completa.</span><span class="sxs-lookup"><span data-stu-id="dc419-172">When decoding field pictures in an MPEG-2 bitstream, there will be two "pictures" decoded to produce one complete output uncompressed surface.</span></span> <span data-ttu-id="dc419-173">Na definição de interface do DirectX VA, cada quadro corresponde a cada uso de wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex ou wPicResampleDestPicIndex.</span><span class="sxs-lookup"><span data-stu-id="dc419-173">In the DirectX VA interface definition, each frame corresponds to each use of wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex.</span></span> <span data-ttu-id="dc419-174">Portanto, dois pares de chamadas para **IAMVideoAccelerator:: BeginFrame** e **IAMVideoAccelerator:: endframe** são necessários para a decodificação de imagens de campo em superfícies não compactadas de saída.</span><span class="sxs-lookup"><span data-stu-id="dc419-174">Thus two pairs of calls to **IAMVideoAccelerator::BeginFrame** and **IAMVideoAccelerator::EndFrame** are required for the decoding of field pictures into output uncompressed surfaces.</span></span>
10. <span data-ttu-id="dc419-175">Uma chamada para [**IAMVideoAccelerator:: QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) com dwFlags igual a zero que ocorre em algum momento após uma chamada para **IAMVideoAccelerator:: endframe** com um wEndPictureIndex específico e verifica o status de um buffer que foi enviado que continha o WEndPictureIndex em WDecodedPictureIndex, WDeblockedPictureIndex, wBlendedDestinationIndex ou WPicResampleDestPicIndex retornará uma \_ indicação S ok se todas as operações para gravar os dados na superfície descompactada forem concluídas e retornarão e serão \_ pendentes se a operação ainda não tiver sido concluída.</span><span class="sxs-lookup"><span data-stu-id="dc419-175">A call to [**IAMVideoAccelerator::QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) with dwFlags equal to zero which occurs sometime after a call to **IAMVideoAccelerator::EndFrame** with a particular wEndPictureIndex and checks the status of a buffer that was sent that contained the wEndPictureIndex in wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex will return an S\_OK indication if all of the operations to write the data to the uncompressed surface have completed and will return E\_PENDING if the operation has not yet completed.</span></span> <span data-ttu-id="dc419-176">E \_ Fail ou \_ INVALIDARG ou alguma outra indicação de erro pode ser retornada no caso de um erro de protocolo.</span><span class="sxs-lookup"><span data-stu-id="dc419-176">E\_FAIL or E\_INVALIDARG or some other error indication may be returned in the event of a protocol error.</span></span>

## <a name="related-topics"></a><span data-ttu-id="dc419-177">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="dc419-177">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="dc419-178">Mapeando a aceleração de vídeo DirectX para IAMVideoAccelerator</span><span class="sxs-lookup"><span data-stu-id="dc419-178">Mapping DirectX Video Acceleration to IAMVideoAccelerator</span></span>](mapping-directx-video-acceleration-to-iamvideoaccelerator.md)
</dt> </dl>

 

 



