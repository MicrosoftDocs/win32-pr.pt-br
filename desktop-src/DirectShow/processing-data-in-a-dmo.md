---
description: Processando dados em um DMO
ms.assetid: 715482d9-23f4-40d0-9c09-7a81e148c543
title: Processando dados em um DMO
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ea9f5d5d820dc1467c25f9d411d46a9c66935e8b
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/06/2021
ms.locfileid: "103825834"
---
# <a name="processing-data-in-a-dmo"></a><span data-ttu-id="61282-103">Processando dados em um DMO</span><span class="sxs-lookup"><span data-stu-id="61282-103">Processing Data in a DMO</span></span>

<span data-ttu-id="61282-104">Esta seção explica como processar um fluxo de dados usando um DMO.</span><span class="sxs-lookup"><span data-stu-id="61282-104">This section explains how to process a stream of data using a DMO.</span></span> <span data-ttu-id="61282-105">As etapas listadas nesta seção são o comportamento padrão; todos os DMOs devem dar suporte aos métodos descritos aqui.</span><span class="sxs-lookup"><span data-stu-id="61282-105">The steps listed in this section are the default behavior; all DMOs must support the methods described here.</span></span> <span data-ttu-id="61282-106">Esses métodos usam buffers separados para entrada e saída.</span><span class="sxs-lookup"><span data-stu-id="61282-106">These methods use separate buffers for input and output.</span></span> <span data-ttu-id="61282-107">Alguns DMOs também dão suporte ao processamento in-loco, usando um único buffer.</span><span class="sxs-lookup"><span data-stu-id="61282-107">Some DMOs also support in-place processing, using a single buffer.</span></span> <span data-ttu-id="61282-108">Para obter mais informações sobre o processamento in-loco, consulte [processamento](in-place-processing.md)in-loco.</span><span class="sxs-lookup"><span data-stu-id="61282-108">For more information about in-place processing, see [In-Place Processing](in-place-processing.md).</span></span>

<span data-ttu-id="61282-109">**Alocando buffers**</span><span class="sxs-lookup"><span data-stu-id="61282-109">**Allocating Buffers**</span></span>

<span data-ttu-id="61282-110">O cliente é responsável por toda a alocação de buffer.</span><span class="sxs-lookup"><span data-stu-id="61282-110">The client is responsible for all buffer allocation.</span></span> <span data-ttu-id="61282-111">Depois de definir os tipos de mídia no DMO, consulte os requisitos de buffer do DMO para cada fluxo.</span><span class="sxs-lookup"><span data-stu-id="61282-111">After you set the media types on the DMO, query the DMO for each stream's buffer requirements.</span></span> <span data-ttu-id="61282-112">Eles podem mudar dependendo do tipo de mídia.</span><span class="sxs-lookup"><span data-stu-id="61282-112">These can change depending on the media type.</span></span> <span data-ttu-id="61282-113">Para cada fluxo, chame o método [**IMediaObject:: GetInputSizeInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputsizeinfo) ou [**IMediaObject:: GetOutputSizeInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getoutputsizeinfo) .</span><span class="sxs-lookup"><span data-stu-id="61282-113">For each stream, call the [**IMediaObject::GetInputSizeInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputsizeinfo) or [**IMediaObject::GetOutputSizeInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getoutputsizeinfo) method.</span></span> <span data-ttu-id="61282-114">Esses métodos retornam as seguintes informações:</span><span class="sxs-lookup"><span data-stu-id="61282-114">These methods return the following information:</span></span>

-   <span data-ttu-id="61282-115">Tamanho mínimo do buffer, em bytes.</span><span class="sxs-lookup"><span data-stu-id="61282-115">Minimum buffer size, in bytes.</span></span>
-   <span data-ttu-id="61282-116">Requisitos de alinhamento, se houver.</span><span class="sxs-lookup"><span data-stu-id="61282-116">Alignment requirements, if any.</span></span> <span data-ttu-id="61282-117">Um buffer será alinhado se o endereço inicial for um múltiplo de algum número inteiro especificado.</span><span class="sxs-lookup"><span data-stu-id="61282-117">A buffer is aligned if the start address is a multiple of some specified integer.</span></span>
-   <span data-ttu-id="61282-118">A quantidade máxima de dados que o DMO manterá para o lookahead.</span><span class="sxs-lookup"><span data-stu-id="61282-118">The maximum amount of data the DMO will hold for lookahead.</span></span> <span data-ttu-id="61282-119">Esse número se aplica somente a fluxos de entrada.</span><span class="sxs-lookup"><span data-stu-id="61282-119">This number applies only to input streams.</span></span> <span data-ttu-id="61282-120">Para alguns tipos de dados (por exemplo, codificação MPEG), um DMO pode precisar olhar para a frente no fluxo.</span><span class="sxs-lookup"><span data-stu-id="61282-120">For some kinds of data (for example, MPEG encoding), a DMO might need to look forward in the stream.</span></span> <span data-ttu-id="61282-121">O valor de lookahead indica a quantidade de dados de entrada que o DMO precisará antes de produzir a saída.</span><span class="sxs-lookup"><span data-stu-id="61282-121">The lookahead value indicates how much input data the DMO will require before it can produce output.</span></span>

<span data-ttu-id="61282-122">O cliente deve alocar buffers que correspondam a esses requisitos.</span><span class="sxs-lookup"><span data-stu-id="61282-122">The client must allocate buffers that match these requirements.</span></span> <span data-ttu-id="61282-123">Além disso, o DMO pode ter requisitos sobre como o cliente empacota os dados de entrada.</span><span class="sxs-lookup"><span data-stu-id="61282-123">In addition, the DMO might have requirements about how the client packages the input data.</span></span> <span data-ttu-id="61282-124">Por exemplo, o DMO pode exigir que cada buffer contenha exatamente um exemplo (ou quadro de vídeo).</span><span class="sxs-lookup"><span data-stu-id="61282-124">For example, the DMO might require each buffer to contain exactly one sample (or video frame).</span></span> <span data-ttu-id="61282-125">Para determinar esses requisitos, chame o método [**IMediaObject:: GetInputStreamInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputstreaminfo) .</span><span class="sxs-lookup"><span data-stu-id="61282-125">To determine these requirements, call the [**IMediaObject::GetInputStreamInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputstreaminfo) method.</span></span> <span data-ttu-id="61282-126">O método [**IMediaObject:: GetOutputStreamInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getoutputstreaminfo) retorna informações semelhantes sobre um fluxo de saída.</span><span class="sxs-lookup"><span data-stu-id="61282-126">The [**IMediaObject::GetOutputStreamInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getoutputstreaminfo) method returns similar information about an output stream.</span></span>

<span data-ttu-id="61282-127">No modelo de streaming padrão, o cliente não passa ponteiros de buffer brutos para o DMO.</span><span class="sxs-lookup"><span data-stu-id="61282-127">In the default streaming model, the client does not pass raw buffer pointers to the DMO.</span></span> <span data-ttu-id="61282-128">Em vez disso, ele usa um objeto COM leve que expõe a interface [**IMediaBuffer**](/previous-versions/windows/desktop/api/Mediaobj/nn-mediaobj-imediabuffer) .</span><span class="sxs-lookup"><span data-stu-id="61282-128">Instead, it uses a lightweight COM object that exposes the [**IMediaBuffer**](/previous-versions/windows/desktop/api/Mediaobj/nn-mediaobj-imediabuffer) interface.</span></span> <span data-ttu-id="61282-129">A interface **IMediaBuffer** age como um wrapper com para um bloco de memória.</span><span class="sxs-lookup"><span data-stu-id="61282-129">The **IMediaBuffer** interface acts as a COM wrapper for a block of memory.</span></span> <span data-ttu-id="61282-130">Como ele é um objeto COM, ele dá suporte à contagem de referência, o que ajuda a garantir que os buffers não sejam liberados enquanto ainda estiverem em uso.</span><span class="sxs-lookup"><span data-stu-id="61282-130">Because it is a COM object, it supports reference counting, which helps to ensure that buffers are not released while still in use.</span></span>

> [!Note]  
> <span data-ttu-id="61282-131">A interface **IMediaBuffer** serve uma função semelhante à interface **IMediaSample** no DirectShow.</span><span class="sxs-lookup"><span data-stu-id="61282-131">The **IMediaBuffer** interface serves a function similar to the **IMediaSample** interface in DirectShow.</span></span>

 

<span data-ttu-id="61282-132">O cliente deve implementar o objeto **IMediaBuffer** .</span><span class="sxs-lookup"><span data-stu-id="61282-132">The client must implement the **IMediaBuffer** object.</span></span> <span data-ttu-id="61282-133">Para obter mais informações, consulte [Implementing IMediaBuffer](implementing-imediabuffer.md).</span><span class="sxs-lookup"><span data-stu-id="61282-133">For more information, see [Implementing IMediaBuffer](implementing-imediabuffer.md).</span></span>

<span data-ttu-id="61282-134">**Processando os dados**</span><span class="sxs-lookup"><span data-stu-id="61282-134">**Processing the Data**</span></span>

<span data-ttu-id="61282-135">Para processar dados, faça o seguinte:</span><span class="sxs-lookup"><span data-stu-id="61282-135">To process data, do the following:</span></span>

1.  <span data-ttu-id="61282-136">Para cada fluxo de entrada, preencha um buffer com dados de entrada.</span><span class="sxs-lookup"><span data-stu-id="61282-136">For each input stream, fill a buffer with input data.</span></span>
2.  <span data-ttu-id="61282-137">Chame [**IMediaObject::P rocessinput**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-processinput) para entregar cada buffer.</span><span class="sxs-lookup"><span data-stu-id="61282-137">Call [**IMediaObject::ProcessInput**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-processinput) to deliver each buffer.</span></span>
3.  <span data-ttu-id="61282-138">Chame [**IMediaObject::P rocessoutput**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-processoutput) para processar os dados.</span><span class="sxs-lookup"><span data-stu-id="61282-138">Call [**IMediaObject::ProcessOutput**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-processoutput) to process the data.</span></span> <span data-ttu-id="61282-139">Esse método usa uma matriz de buffers, uma para cada fluxo de saída.</span><span class="sxs-lookup"><span data-stu-id="61282-139">This method takes an array of buffers, one for each output stream.</span></span>
4.  <span data-ttu-id="61282-140">Repita até que não haja mais dados de entrada.</span><span class="sxs-lookup"><span data-stu-id="61282-140">Repeat until there is no more input data.</span></span>

<span data-ttu-id="61282-141">O método **ProcessInput** aceita a entrada para um fluxo de cada vez.</span><span class="sxs-lookup"><span data-stu-id="61282-141">The **ProcessInput** method accepts input for one stream at a time.</span></span> <span data-ttu-id="61282-142">Normalmente, o método retorna imediatamente e o DMO mantém uma contagem de referência no objeto **IMediaBuffer** .</span><span class="sxs-lookup"><span data-stu-id="61282-142">Typically the method returns immediately, and the DMO holds a reference count on the **IMediaBuffer** object.</span></span> <span data-ttu-id="61282-143">Ele libera o objeto depois de processar todos os dados no buffer ou quando o aplicativo libera o DMO.</span><span class="sxs-lookup"><span data-stu-id="61282-143">It releases the object after it processes all of the data in the buffer, or when the application flushes the DMO.</span></span> <span data-ttu-id="61282-144">Não use novamente um buffer até que o DMO o tenha liberado.</span><span class="sxs-lookup"><span data-stu-id="61282-144">Do not re-use a buffer until the DMO has released it.</span></span> <span data-ttu-id="61282-145">Para determinar se um fluxo de entrada pode aceitar mais dados, chame o método [**IMediaObject:: GetInputStatus**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputstatus) .</span><span class="sxs-lookup"><span data-stu-id="61282-145">To determine whether an input stream can accept more data, call the [**IMediaObject::GetInputStatus**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputstatus) method.</span></span> <span data-ttu-id="61282-146">Esse método retornará o \_ sinalizador de entrada de dados STATUSF Input do DMO \_ \_ \_ se o fluxo puder aceitar mais entradas.</span><span class="sxs-lookup"><span data-stu-id="61282-146">This method returns the DMO\_INPUT\_STATUSF\_ACCEPT\_DATA flag if the stream can accept more input.</span></span>

<span data-ttu-id="61282-147">O método **ProcessOutput** gera a saída para todos os fluxos de saída de uma vez.</span><span class="sxs-lookup"><span data-stu-id="61282-147">The **ProcessOutput** method generates output for all of the output streams at once.</span></span> <span data-ttu-id="61282-148">O aplicativo passa em uma matriz de estruturas de buffer de dados de saída de DMO, uma para cada fluxo de saída. [**\_ \_ \_**](/previous-versions/windows/desktop/api/Mediaobj/ns-mediaobj-dmo_output_data_buffer)</span><span class="sxs-lookup"><span data-stu-id="61282-148">The application passes in an array of [**DMO\_OUTPUT\_DATA\_BUFFER**](/previous-versions/windows/desktop/api/Mediaobj/ns-mediaobj-dmo_output_data_buffer) structures, one for each output stream.</span></span> <span data-ttu-id="61282-149">Cada estrutura na matriz tem um ponteiro para um objeto **IMediaBuffer** .</span><span class="sxs-lookup"><span data-stu-id="61282-149">Each structure in the array has a pointer to an **IMediaBuffer** object.</span></span> <span data-ttu-id="61282-150">O DMO grava tantos dados de saída quanto podem nos buffers.</span><span class="sxs-lookup"><span data-stu-id="61282-150">The DMO writes as much output data as it can into the buffers.</span></span> <span data-ttu-id="61282-151">Ele também define vários sinalizadores para relatar o status da operação.</span><span class="sxs-lookup"><span data-stu-id="61282-151">It also sets various flags to report the status of the operation.</span></span> <span data-ttu-id="61282-152">O \_ sinalizador incompleto de dados de saída do DMO \_ \_ \_ indica que o DMO pode produzir mais resultados da entrada existente.</span><span class="sxs-lookup"><span data-stu-id="61282-152">The DMO\_OUTPUT\_DATA\_BUFFERF\_INCOMPLETE flag indicates the DMO can produce more output from the existing input.</span></span> <span data-ttu-id="61282-153">Nesse caso, o cliente pode chamar **ProcessOutput** novamente.</span><span class="sxs-lookup"><span data-stu-id="61282-153">In that case, the client can call **ProcessOutput** again.</span></span> <span data-ttu-id="61282-154">Caso contrário, ele deve chamar **ProcessInput** com mais dados de entrada.</span><span class="sxs-lookup"><span data-stu-id="61282-154">Otherwise, it should call **ProcessInput** with more input data.</span></span> <span data-ttu-id="61282-155">O DMO nunca modifica os dados nos buffers de entrada; Ele grava somente nos buffers de saída.</span><span class="sxs-lookup"><span data-stu-id="61282-155">The DMO never modifies the data in the input buffers; it writes only to the output buffers.</span></span>

<span data-ttu-id="61282-156">Depois de entregar todos os dados a um fluxo de entrada, chame o método [**IMediaObject::D iscontinuion**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-discontinuity) .</span><span class="sxs-lookup"><span data-stu-id="61282-156">After you have delivered all of the data to an input stream, call the [**IMediaObject::Discontinuity**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-discontinuity) method.</span></span> <span data-ttu-id="61282-157">O DMO não aceita outras entradas para esse fluxo até que você processe a saída restante (ou libere o DMO).</span><span class="sxs-lookup"><span data-stu-id="61282-157">The DMO does not accept further input to that stream until you process the remaining output (or flush the DMO).</span></span>

<span data-ttu-id="61282-158">A qualquer momento depois que o streaming começa, o DMO é capaz de receber entrada ou produzir saída, ou ambos.</span><span class="sxs-lookup"><span data-stu-id="61282-158">At any point after streaming begins, the DMO is able to receive input or produce output, or both.</span></span> <span data-ttu-id="61282-159">Portanto, **GetInputStatus** retorna a \_ entrada DMO \_ STATUSF \_ aceita \_ dados, ou **ProcessOutput** retorna DMO \_ dados de saída \_ \_ BUFFERF \_ incompletos.</span><span class="sxs-lookup"><span data-stu-id="61282-159">Therefore, either **GetInputStatus** returns DMO\_INPUT\_STATUSF\_ACCEPT\_DATA, or **ProcessOutput** returns DMO\_OUTPUT\_DATA\_BUFFERF\_INCOMPLETE.</span></span> <span data-ttu-id="61282-160">O aplicativo mantém os dados fluindo para esses sinalizadores e chamando **ProcessInput** ou **ProcessOutput** de acordo.</span><span class="sxs-lookup"><span data-stu-id="61282-160">The application keeps data flowing by testing for these flags and calling **ProcessInput** or **ProcessOutput** accordingly.</span></span> <span data-ttu-id="61282-161">Para interromper o fluxo de dados, chame o método [**IMediaObject:: flush**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-flush) .</span><span class="sxs-lookup"><span data-stu-id="61282-161">To interrupt the data flow, call the [**IMediaObject::Flush**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-flush) method.</span></span> <span data-ttu-id="61282-162">Esse método faz com que o DMO descarte todos os buffers que está segurando internamente.</span><span class="sxs-lookup"><span data-stu-id="61282-162">This method causes the DMO to discard any buffers it is holding internally.</span></span>

## <a name="related-topics"></a><span data-ttu-id="61282-163">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="61282-163">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="61282-164">Hospedando diretamente um DMO</span><span class="sxs-lookup"><span data-stu-id="61282-164">Directly Hosting a DMO</span></span>](directly-hosting-a-dmo.md)
</dt> <dt>

[<span data-ttu-id="61282-165">Processamento in-loco</span><span class="sxs-lookup"><span data-stu-id="61282-165">In-Place Processing</span></span>](in-place-processing.md)
</dt> </dl>

 

 



