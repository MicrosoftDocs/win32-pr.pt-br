---
description: Manipulando alterações de formato do processador de vídeo
ms.assetid: ac7d7b1c-3c9a-4693-87ea-0a10a8ab915c
title: Manipulando alterações de formato do processador de vídeo
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d731ac4b9d6985cf5ad92f642b6d8262209fa91d
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/06/2021
ms.locfileid: "105748000"
---
# <a name="handling-format-changes-from-the-video-renderer"></a><span data-ttu-id="7d60d-103">Manipulando alterações de formato do processador de vídeo</span><span class="sxs-lookup"><span data-stu-id="7d60d-103">Handling Format Changes from the Video Renderer</span></span>

<span data-ttu-id="7d60d-104">Esta seção descreve como um filtro de decodificador ou de transformação deve tratar as alterações de formato do processador de vídeo.</span><span class="sxs-lookup"><span data-stu-id="7d60d-104">This section describes how a decoder filter or transform filter should handle format changes from the video renderer.</span></span>

<span data-ttu-id="7d60d-105">**Filtro de renderização de vídeo**</span><span class="sxs-lookup"><span data-stu-id="7d60d-105">**Video Renderer Filter**</span></span>

<span data-ttu-id="7d60d-106">Quando o filtro antigo do [processador de vídeo](video-renderer-filter.md) se conecta, ele requer um formato RGB que corresponda ao formato de exibição do monitor primário.</span><span class="sxs-lookup"><span data-stu-id="7d60d-106">When the old [Video Renderer](video-renderer-filter.md) filter connects, it requires an RGB format that matches the display format of the primary monitor.</span></span> <span data-ttu-id="7d60d-107">Isso permite que ele use GDI para renderização se o DirectDraw não estiver disponível.</span><span class="sxs-lookup"><span data-stu-id="7d60d-107">This enables it to use GDI for rendering if DirectDraw is not available.</span></span> <span data-ttu-id="7d60d-108">Quando a reprodução é iniciada, o processador de vídeo pode mudar para um formato compatível com o DirectDraw.</span><span class="sxs-lookup"><span data-stu-id="7d60d-108">When playback starts, the Video Renderer may switch to a DirectDraw-compatible format.</span></span> <span data-ttu-id="7d60d-109">Para verfify se o filtro upstream pode dar suporte ao novo formato, o processador de vídeo chama [**IPin:: QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) no pino de saída do filtro upstream.</span><span class="sxs-lookup"><span data-stu-id="7d60d-109">To verfify whether the upstream filter can support the new format, the Video Renderer calls [**IPin::QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) on the upstream filter's output pin.</span></span> <span data-ttu-id="7d60d-110">Se o filtro upstream aceitar o novo formato, o método **QueryAccept** retornará S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="7d60d-110">If the upstream filter accepts the new format, the **QueryAccept** method returns S\_OK.</span></span> <span data-ttu-id="7d60d-111">O processador de vídeo alterna os formatos anexando um tipo de mídia com o novo formato à próxima amostra de mídia retornada por seu alocador.</span><span class="sxs-lookup"><span data-stu-id="7d60d-111">The Video Renderer switches formats by attaching a media type with the new format to the next media sample returned by its allocator.</span></span> <span data-ttu-id="7d60d-112">O filtro upstream deve verificar se há alterações de formato chamando [**IMediaSample:: GetMediaType**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getmediatype) em cada exemplo.</span><span class="sxs-lookup"><span data-stu-id="7d60d-112">The upstream filter should check for format changes by calling [**IMediaSample::GetMediaType**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getmediatype) on each sample.</span></span> <span data-ttu-id="7d60d-113">O processador de vídeo pode alternar entre o formato original e o novo formato a qualquer momento durante o streaming.</span><span class="sxs-lookup"><span data-stu-id="7d60d-113">The Video Renderer may switch back and forth between the original format and new format at any time during streaming.</span></span> <span data-ttu-id="7d60d-114">Ele não chama **QueryAccept** após a primeira alteração de formato.</span><span class="sxs-lookup"><span data-stu-id="7d60d-114">It does not call **QueryAccept** after the first format change.</span></span> <span data-ttu-id="7d60d-115">Depois que o filtro upstream aceitar o novo formato, ele deverá ser capaz de alternar para frente e para trás.</span><span class="sxs-lookup"><span data-stu-id="7d60d-115">Once the upstream filter has accepted the new format, it must be able to switch back and forth.</span></span>

<span data-ttu-id="7d60d-116">O filtro upstream pode rejeitar a alteração de formato retornando S \_ false de **QueryAccept**.</span><span class="sxs-lookup"><span data-stu-id="7d60d-116">The upstream filter can reject the format change by returning S\_FALSE from **QueryAccept**.</span></span> <span data-ttu-id="7d60d-117">Nesse caso, o processador de vídeo continua a usar o GDI com o formato original.</span><span class="sxs-lookup"><span data-stu-id="7d60d-117">In that case, the Video Renderer continues to use GDI with the original format.</span></span>

<span data-ttu-id="7d60d-118">**Filtro de processador de mixagem de vídeo**</span><span class="sxs-lookup"><span data-stu-id="7d60d-118">**Video Mixing Renderer Filter**</span></span>

<span data-ttu-id="7d60d-119">O filtro de processador de mixagem de vídeo (VMR-7 e VMR-9) se conectará com qualquer formato que tenha suporte do hardware de gráficos no sistema.</span><span class="sxs-lookup"><span data-stu-id="7d60d-119">The Video Mixing Renderer filter (VMR-7 and VMR-9) will connect with any format that is supported by the graphics hardware on the system.</span></span> <span data-ttu-id="7d60d-120">O VMR-7 sempre usa o DirectDraw para renderização e aloca as superfícies do DirectDraw subjacentes quando o filtro upstream se conecta.</span><span class="sxs-lookup"><span data-stu-id="7d60d-120">The VMR-7 always uses DirectDraw for rendering, and allocates the underlying DirectDraw surfaces when the upstream filter connects.</span></span> <span data-ttu-id="7d60d-121">O VMR-9 sempre usa o Direct3D para renderização e aloca as superfícies do Direct3D subjacentes quando o filtro upstream se conecta.</span><span class="sxs-lookup"><span data-stu-id="7d60d-121">The VMR-9 always uses Direct3D for rendering, and allocates the underlying Direct3D surfaces when the upstream filter connects.</span></span>

<span data-ttu-id="7d60d-122">O hardware de gráficos pode exigir um stride de superfície maior do que a largura da imagem.</span><span class="sxs-lookup"><span data-stu-id="7d60d-122">The graphics hardware may require a larger surface stride than the image width.</span></span> <span data-ttu-id="7d60d-123">Nesse caso, o VMR solicita um novo formato chamando **QueryAccept**.</span><span class="sxs-lookup"><span data-stu-id="7d60d-123">In that case, the VMR requests a new format by calling **QueryAccept**.</span></span> <span data-ttu-id="7d60d-124">Ele relata o stride da superfície no membro de **semilargura** do [**BITMAPINFOHEADER**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfoheader) no formato de vídeo.</span><span class="sxs-lookup"><span data-stu-id="7d60d-124">It reports the surface stride in the **biWidth** member of the [**BITMAPINFOHEADER**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfoheader) in the video format.</span></span> <span data-ttu-id="7d60d-125">Se o filtro upstream não retornar S \_ OK de **QueryAccept**, o VMR rejeitará o formato e tentará se conectar usando o próximo formato anunciado pelo filtro upstream.</span><span class="sxs-lookup"><span data-stu-id="7d60d-125">If the upstream filter does not return S\_OK from **QueryAccept**, the VMR rejects the format and tries to connect using the next format advertised by the upstream filter.</span></span> <span data-ttu-id="7d60d-126">O VMR anexa o tipo de mídia com o novo formato ao primeiro exemplo de mídia.</span><span class="sxs-lookup"><span data-stu-id="7d60d-126">The VMR attaches the media type with the new format to the first media sample.</span></span> <span data-ttu-id="7d60d-127">Após a primeira amostra, o formato permanece constante; o VMR não alternará os formatos enquanto o grafo estiver em execução.</span><span class="sxs-lookup"><span data-stu-id="7d60d-127">After the first sample, the format remains constant; the VMR will not switch formats while the graph is running.</span></span>

<span data-ttu-id="7d60d-128">**Renderização de vídeo avançada (EVR)**</span><span class="sxs-lookup"><span data-stu-id="7d60d-128">**Enhanced Video Render (EVR)**</span></span>

<span data-ttu-id="7d60d-129">O EVR sempre usa o Direct3D para renderização.</span><span class="sxs-lookup"><span data-stu-id="7d60d-129">The EVR always uses Direct3D for rendering.</span></span> <span data-ttu-id="7d60d-130">Se for necessário um stride de superfície maior, o EVR usará o mesmo mecanismo **QueryAccept** que o VMR.</span><span class="sxs-lookup"><span data-stu-id="7d60d-130">If a larger surface stride is needed, the EVR uses the same **QueryAccept** mechanism as the VMR.</span></span>

## <a name="related-topics"></a><span data-ttu-id="7d60d-131">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="7d60d-131">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="7d60d-132">QueryAccept (upstream)</span><span class="sxs-lookup"><span data-stu-id="7d60d-132">QueryAccept (Upstream)</span></span>](queryaccept--upstream.md)
</dt> </dl>

 

 



