---
description: Entregando exemplos
ms.assetid: 31aabb6d-dec6-41fa-b24d-35a77b67bc4a
title: Entregando exemplos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 083bc8c88649c04bdf9f93f86ebcc277ee48e75e
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/06/2021
ms.locfileid: "104370339"
---
# <a name="delivering-samples"></a><span data-ttu-id="a4633-103">Entregando exemplos</span><span class="sxs-lookup"><span data-stu-id="a4633-103">Delivering Samples</span></span>

<span data-ttu-id="a4633-104">Este artigo descreve como um filtro fornece um exemplo.</span><span class="sxs-lookup"><span data-stu-id="a4633-104">This article describes how a filter delivers a sample.</span></span> <span data-ttu-id="a4633-105">Ele descreve o modelo de push, usando métodos [**IMemInputPin**](/windows/desktop/api/Strmif/nn-strmif-imeminputpin) e o modelo de pull, usando [**IAsyncReader**](/windows/desktop/api/Strmif/nn-strmif-iasyncreader).</span><span class="sxs-lookup"><span data-stu-id="a4633-105">It describes both the push model, using [**IMemInputPin**](/windows/desktop/api/Strmif/nn-strmif-imeminputpin) methods, and the pull model, using [**IAsyncReader**](/windows/desktop/api/Strmif/nn-strmif-iasyncreader).</span></span>

<span data-ttu-id="a4633-106">**Modelo de push: entregando um exemplo**</span><span class="sxs-lookup"><span data-stu-id="a4633-106">**Push Model: Delivering a Sample**</span></span>

<span data-ttu-id="a4633-107">O pino de saída fornece um exemplo chamando o método [**IMemInputPin:: Receive**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receive) ou o método [**IMemInputPin:: ReceiveMultiple**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receivemultiple) , que é equivalente, mas fornece uma matriz de exemplos.</span><span class="sxs-lookup"><span data-stu-id="a4633-107">The output pin delivers a sample by calling the [**IMemInputPin::Receive**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receive) method or the [**IMemInputPin::ReceiveMultiple**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receivemultiple) method, which is equivalent but delivers an array of samples.</span></span> <span data-ttu-id="a4633-108">O PIN de entrada pode bloquear dentro de **Receive** (ou **ReceiveMultiple**).</span><span class="sxs-lookup"><span data-stu-id="a4633-108">The input pin can block inside **Receive** (or **ReceiveMultiple**).</span></span> <span data-ttu-id="a4633-109">Se o PIN puder ser bloqueado, seu método [**IMemInputPin:: ReceiveCanBlock**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receivecanblock) deverá retornar S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="a4633-109">If the pin might block, its [**IMemInputPin::ReceiveCanBlock**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receivecanblock) method should return S\_OK.</span></span> <span data-ttu-id="a4633-110">Se o PIN garantir que nunca seja bloqueado, **ReceiveCanBlock** deverá retornar S \_ false.</span><span class="sxs-lookup"><span data-stu-id="a4633-110">If the pin guarantees never to block, **ReceiveCanBlock** should return S\_FALSE.</span></span> <span data-ttu-id="a4633-111">O \_ valor de retorno S OK não significa que o **Receive** Always Block, exatamente o que ele pode.</span><span class="sxs-lookup"><span data-stu-id="a4633-111">The S\_OK return value does not mean that **Receive** always blocks, just that it might.</span></span>

<span data-ttu-id="a4633-112">Embora **Receive** possa bloquear a espera de um recurso ficar disponível, ele não deve bloquear para aguardar mais dados do filtro upstream.</span><span class="sxs-lookup"><span data-stu-id="a4633-112">Although **Receive** can block to wait for a resource to become available, it should not block to wait for more data from the upstream filter.</span></span> <span data-ttu-id="a4633-113">Isso pode causar um deadlock em que o filtro upstream aguarda o filtro downstream liberar o exemplo, o que nunca acontece porque o filtro downstream está aguardando o filtro upstream.</span><span class="sxs-lookup"><span data-stu-id="a4633-113">Doing so can cause a deadlock where the upstream filter waits for the downstream filter to release the sample, which never happens because the downstream filter is waiting on the upstream filter.</span></span> <span data-ttu-id="a4633-114">No entanto, se um filtro tiver vários Pins de entrada, um PIN poderá esperar por outro PIN para receber dados.</span><span class="sxs-lookup"><span data-stu-id="a4633-114">If a filter has multiple input pins, however, one pin can wait for another pin to receive data.</span></span> <span data-ttu-id="a4633-115">Por exemplo, o filtro [AVI Mux](avi-mux-filter.md) faz isso para que ele possa intercalar dados de áudio e vídeo.</span><span class="sxs-lookup"><span data-stu-id="a4633-115">For example, the [AVI Mux](avi-mux-filter.md) filter does this so that it can interleave audio and video data.</span></span>

<span data-ttu-id="a4633-116">Um PIN pode rejeitar um exemplo por vários motivos:</span><span class="sxs-lookup"><span data-stu-id="a4633-116">A pin might reject a sample for a number of reasons:</span></span>

-   <span data-ttu-id="a4633-117">O PIN está sendo liberado (consulte [liberando](flushing.md)).</span><span class="sxs-lookup"><span data-stu-id="a4633-117">The pin is flushing (see [Flushing](flushing.md)).</span></span>
-   <span data-ttu-id="a4633-118">O PIN não está conectado.</span><span class="sxs-lookup"><span data-stu-id="a4633-118">The pin is not connected.</span></span>
-   <span data-ttu-id="a4633-119">O filtro está parado.</span><span class="sxs-lookup"><span data-stu-id="a4633-119">The filter is stopped.</span></span>
-   <span data-ttu-id="a4633-120">Ocorreu algum outro erro.</span><span class="sxs-lookup"><span data-stu-id="a4633-120">Some other error occurred.</span></span>

<span data-ttu-id="a4633-121">O método **Receive** deve retornar S \_ false no primeiro caso e um código de falha nos outros casos.</span><span class="sxs-lookup"><span data-stu-id="a4633-121">The **Receive** method should return S\_FALSE in the first case, and a failure code in the other cases.</span></span> <span data-ttu-id="a4633-122">O filtro upstream deve parar de enviar amostras quando o código de retorno é algo diferente de S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="a4633-122">The upstream filter should stop sending samples when the return code is anything other than S\_OK.</span></span>

<span data-ttu-id="a4633-123">Você pode considerar os três primeiros casos como falhas "esperadas", no sentido de que o filtro estava no estado incorreto para receber exemplos.</span><span class="sxs-lookup"><span data-stu-id="a4633-123">You can consider the first three cases to be "expected" failures, in the sense that the filter was in the wrong state to receive samples.</span></span> <span data-ttu-id="a4633-124">Uma falha inesperada seria aquela que faz com que o PIN rejeite um exemplo, embora o PIN esteja em um estado de recebimento.</span><span class="sxs-lookup"><span data-stu-id="a4633-124">An unexpected failure would be one that causes the pin to reject a sample even though the pin is in a receiving state.</span></span> <span data-ttu-id="a4633-125">Se ocorrer um erro desse tipo, o PIN deverá enviar um downstream de notificação de fim de fluxo e enviar um evento de [**\_ ERRORABORT do EC**](ec-errorabort.md) para o Gerenciador do grafo de filtro.</span><span class="sxs-lookup"><span data-stu-id="a4633-125">If an error of this type occurs, the pin should send an end-of-stream notification downstream, and send an [**EC\_ERRORABORT**](ec-errorabort.md) event to the Filter Graph Manager.</span></span>

<span data-ttu-id="a4633-126">Nas classes base do DirectShow, o método [**CBaseInputPin:: CheckStreaming**](cbaseinputpin-checkstreaming.md) verifica os casos de falha gerais, liberando, parou e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="a4633-126">In the DirectShow base classes, the [**CBaseInputPin::CheckStreaming**](cbaseinputpin-checkstreaming.md) method checks for the general failure cases—flushing, stopped, and so forth.</span></span> <span data-ttu-id="a4633-127">A classe derivada precisará verificar se há falhas específicas para o filtro.</span><span class="sxs-lookup"><span data-stu-id="a4633-127">The derived class will need to check for failures that are specific to the filter.</span></span> <span data-ttu-id="a4633-128">No caso de um erro, o método [**CBaseInputPin:: Receive**](cbaseinputpin-receive.md) envia a notificação de fim de fluxo e o evento de \_ ERRORABORT do EC.</span><span class="sxs-lookup"><span data-stu-id="a4633-128">In case of an error, the [**CBaseInputPin::Receive**](cbaseinputpin-receive.md) method sends the end-of-stream notification and the EC\_ERRORABORT event.</span></span>

<span data-ttu-id="a4633-129">**Modelo de pull: solicitando um exemplo**</span><span class="sxs-lookup"><span data-stu-id="a4633-129">**Pull Model: Requesting a Sample**</span></span>

<span data-ttu-id="a4633-130">Na interface **IAsyncReader** , o pino de entrada solicita amostras do pino de saída chamando um dos seguintes métodos:</span><span class="sxs-lookup"><span data-stu-id="a4633-130">In the **IAsyncReader** interface, the input pin requests samples from the output pin by calling one of the following methods:</span></span>

-   [<span data-ttu-id="a4633-131">**IAsyncReader:: solicitação**</span><span class="sxs-lookup"><span data-stu-id="a4633-131">**IAsyncReader::Request**</span></span>](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-request)
-   [<span data-ttu-id="a4633-132">**IAsyncReader::SyncRead**</span><span class="sxs-lookup"><span data-stu-id="a4633-132">**IAsyncReader::SyncRead**</span></span>](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-syncread)
-   [<span data-ttu-id="a4633-133">**IAsyncReader::SyncReadAligned**</span><span class="sxs-lookup"><span data-stu-id="a4633-133">**IAsyncReader::SyncReadAligned**</span></span>](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-syncreadaligned)

<span data-ttu-id="a4633-134">O método de **solicitação** é assíncrono; o pino de entrada chama [**IAsyncReader:: WaitForNext**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-waitfornext) para aguardar a conclusão da solicitação.</span><span class="sxs-lookup"><span data-stu-id="a4633-134">The **Request** method is asynchronous; the input pin calls [**IAsyncReader::WaitForNext**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-waitfornext) to wait for the request to complete.</span></span> <span data-ttu-id="a4633-135">Os outros dois métodos são síncronos.</span><span class="sxs-lookup"><span data-stu-id="a4633-135">The other two methods are synchronous.</span></span>

<span data-ttu-id="a4633-136">**Quando entregar dados**</span><span class="sxs-lookup"><span data-stu-id="a4633-136">**When to Deliver Data**</span></span>

<span data-ttu-id="a4633-137">Um filtro sempre fornece amostras enquanto está no estado executando.</span><span class="sxs-lookup"><span data-stu-id="a4633-137">A filter always delivers samples while it is in the running state.</span></span> <span data-ttu-id="a4633-138">Na maioria dos casos, um filtro também fornece amostras enquanto está em pausa.</span><span class="sxs-lookup"><span data-stu-id="a4633-138">In most cases, a filter also delivers samples while paused.</span></span> <span data-ttu-id="a4633-139">Isso permite que o grafo marque os dados para que a reprodução seja iniciada imediatamente quando a **execução** for chamada (consulte [Estados de filtro](filter-states.md)).</span><span class="sxs-lookup"><span data-stu-id="a4633-139">This enables the graph to cue up the data so that playback starts immediately when **Run** is called (see [Filter States](filter-states.md)).</span></span> <span data-ttu-id="a4633-140">Se o filtro não entregar dados enquanto estiver em pausa, o método **IMediaFilter:: GetState** do filtro deverá retornar VFW \_ s não poderá \_ \_ indicar no estado pausado.</span><span class="sxs-lookup"><span data-stu-id="a4633-140">If your filter does not deliver data while paused, the filter's **IMediaFilter::GetState** method should return VFW\_S\_CANT\_CUE in the paused state.</span></span> <span data-ttu-id="a4633-141">Esse código de retorno sinaliza o gráfico de filtro para não aguardar dados do filtro antes de concluir a transição de pausa.</span><span class="sxs-lookup"><span data-stu-id="a4633-141">This return code signals the filter graph not to wait for data from your filter before it completes the pause transition.</span></span> <span data-ttu-id="a4633-142">Caso contrário, o método **Pause** será bloqueado indefinidamente.</span><span class="sxs-lookup"><span data-stu-id="a4633-142">Otherwise, the **Pause** method will block indefinitely.</span></span> <span data-ttu-id="a4633-143">Para obter um exemplo de código, consulte [**CBaseFilter:: GetState**](cbasefilter-getstate.md).</span><span class="sxs-lookup"><span data-stu-id="a4633-143">For example code, see [**CBaseFilter::GetState**](cbasefilter-getstate.md).</span></span>

<span data-ttu-id="a4633-144">Aqui estão alguns exemplos de quando um filtro pode precisar retornar VFW \_ S não \_ conseguir a \_ indicação:</span><span class="sxs-lookup"><span data-stu-id="a4633-144">Here are some examples of when a filter might need to return VFW\_S\_CANT\_CUE:</span></span>

-   <span data-ttu-id="a4633-145">Fontes dinâmicas, como filtros de captura, não devem enviar dados enquanto estiverem em pausa.</span><span class="sxs-lookup"><span data-stu-id="a4633-145">Live sources, such as capture filters, should not send data while paused.</span></span> <span data-ttu-id="a4633-146">Consulte [produzindo dados em um filtro de captura](producing-data-in-a-capture-filter.md).</span><span class="sxs-lookup"><span data-stu-id="a4633-146">See [Producing Data in a Capture Filter](producing-data-in-a-capture-filter.md).</span></span>
-   <span data-ttu-id="a4633-147">Um filtro de divisão pode ou não enviar dados enquanto estiver em pausa, dependendo da implementação.</span><span class="sxs-lookup"><span data-stu-id="a4633-147">A splitter filter might or might not send data while paused, depending on the implementation.</span></span> <span data-ttu-id="a4633-148">Se o filtro usar threads separados para enfileirar dados em cada pino de saída, ele poderá enviar dados enquanto estiver em pausa.</span><span class="sxs-lookup"><span data-stu-id="a4633-148">If the filter uses separate threads to queue data on each output pin, then it can send data while paused.</span></span> <span data-ttu-id="a4633-149">Mas se o filtro usar um único thread para cada pino de saída, o primeiro PIN poderá bloquear o thread quando ele chamar **Receive**, o que impedirá que os outros Pins enviem dados.</span><span class="sxs-lookup"><span data-stu-id="a4633-149">But if the filter uses a single thread for every output pin, the first pin might block the thread when it calls **Receive**, which will prevent the other pins from sending data.</span></span> <span data-ttu-id="a4633-150">Nesse caso, você deve retornar VFW S e não \_ \_ conseguir a \_ indicação.</span><span class="sxs-lookup"><span data-stu-id="a4633-150">In that case, you should return VFW\_S\_CANT\_CUE.</span></span>
-   <span data-ttu-id="a4633-151">Um filtro pode fornecer dados esporadicamente.</span><span class="sxs-lookup"><span data-stu-id="a4633-151">A filter might deliver data sporadically.</span></span> <span data-ttu-id="a4633-152">Por exemplo, ele pode analisar um fluxo de dados personalizado e filtrar alguns pacotes ao entregar outros.</span><span class="sxs-lookup"><span data-stu-id="a4633-152">For example, it might parse a custom data stream and filter out some packets while delivering others.</span></span> <span data-ttu-id="a4633-153">Nesse caso, o filtro pode não ter a garantia de entregar dados enquanto estiver em pausa.</span><span class="sxs-lookup"><span data-stu-id="a4633-153">In that case, the filter may not be guaranteed to deliver data while paused.</span></span>

<span data-ttu-id="a4633-154">Um filtro de origem (usando o modelo de push) ou um filtro do analisador (usando o modelo push/pull) cria um ou mais threads de streaming, que fornecem amostras o mais rápido possível.</span><span class="sxs-lookup"><span data-stu-id="a4633-154">A source filter (using the push model) or a parser filter (using the push/pull model) creates one or more streaming threads, which deliver samples as quickly as possible.</span></span> <span data-ttu-id="a4633-155">Filtros downstream, como decodificadores e transformações, normalmente enviam dados somente quando **Receive** é chamado em seus PINs de entrada.</span><span class="sxs-lookup"><span data-stu-id="a4633-155">Downstream filters, such as decoders and transforms, typically send data only when **Receive** is called on their input pins.</span></span>

## <a name="related-topics"></a><span data-ttu-id="a4633-156">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="a4633-156">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="a4633-157">Recebendo e entregando exemplos</span><span class="sxs-lookup"><span data-stu-id="a4633-157">Receiving and Delivering Samples</span></span>](receiving-and-delivering-samples.md)
</dt> </dl>

 

 



