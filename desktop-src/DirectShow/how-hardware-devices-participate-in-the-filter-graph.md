---
description: Como os dispositivos de hardware participam do grafo de filtro
ms.assetid: 27e1c097-9bb4-4f9c-b9f9-0d4225c0d290
title: Como os dispositivos de hardware participam do grafo de filtro
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 68794bbc046e633e9a435b2628a20b8ea8aab174
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/06/2021
ms.locfileid: "104456379"
---
# <a name="how-hardware-devices-participate-in-the-filter-graph"></a><span data-ttu-id="8984d-103">Como os dispositivos de hardware participam do grafo de filtro</span><span class="sxs-lookup"><span data-stu-id="8984d-103">How Hardware Devices Participate in the Filter Graph</span></span>

<span data-ttu-id="8984d-104">Este artigo descreve como o DirectShow interage com o hardware de áudio e vídeo.</span><span class="sxs-lookup"><span data-stu-id="8984d-104">This article describes how DirectShow interacts with audio and video hardware.</span></span>

<span data-ttu-id="8984d-105">**Filtros de wrapper**</span><span class="sxs-lookup"><span data-stu-id="8984d-105">**Wrapper Filters**</span></span>

<span data-ttu-id="8984d-106">Todos os filtros do DirectShow são componentes de software no modo de usuário.</span><span class="sxs-lookup"><span data-stu-id="8984d-106">All DirectShow filters are user mode software components.</span></span> <span data-ttu-id="8984d-107">Para um dispositivo de hardware de modo kernel, como um cartão de captura de vídeo, para ingressar em um grafo de filtro do DirectShow, o dispositivo deve ser representado como um filtro de modo de usuário.</span><span class="sxs-lookup"><span data-stu-id="8984d-107">In order for a kernel mode hardware device, such as a video capture card, to join a DirectShow filter graph, the device must be represented as a user-mode filter.</span></span> <span data-ttu-id="8984d-108">Essa função é executada por filtros "wrapper" especializados fornecidos com o DirectShow.</span><span class="sxs-lookup"><span data-stu-id="8984d-108">This function is performed by specialized "wrapper" filters provided with DirectShow.</span></span> <span data-ttu-id="8984d-109">Esses filtros incluem o filtro de [captura de áudio](audio-capture.md) , o filtro de [captura VFW](vfw-capture-filter.md) , o filtro de [sintonização de TV](tv-tuner-filter.md) , o filtro de áudio de [TV](tv-audio-filter.md) e o filtro [Crossbar de vídeo analógico](analog-video-crossbar-filter.md) .</span><span class="sxs-lookup"><span data-stu-id="8984d-109">These filters include the [Audio Capture](audio-capture.md) filter, the [VFW Capture](vfw-capture-filter.md) filter, the [TV Tuner](tv-tuner-filter.md) filter, the [TV Audio](tv-audio-filter.md) filter, and the [Analog Video Crossbar](analog-video-crossbar-filter.md) filter.</span></span> <span data-ttu-id="8984d-110">O DirectShow também fornece um filtro chamado KsProxy, que pode representar qualquer tipo de dispositivo de streaming de Windows Driver Model (WDM).</span><span class="sxs-lookup"><span data-stu-id="8984d-110">DirectShow also provides a filter called KsProxy, which can represent any type of Windows Driver Model (WDM) streaming device.</span></span> <span data-ttu-id="8984d-111">Os fornecedores de hardware podem estender o KsProxy para dar suporte à funcionalidade personalizada, fornecendo um *plug-in KsProxy*, que é um objeto com agregado pelo KsProxy.</span><span class="sxs-lookup"><span data-stu-id="8984d-111">Hardware vendors can extend KsProxy to support custom functionality, by providing a *Ksproxy plug-in*, which is a COM object aggregated by KsProxy.</span></span>

<span data-ttu-id="8984d-112">Os filtros de wrapper expõem interfaces COM que representam os recursos do dispositivo.</span><span class="sxs-lookup"><span data-stu-id="8984d-112">The wrapper filters expose COM interfaces that represent the capabilities of the device.</span></span> <span data-ttu-id="8984d-113">O aplicativo usa essas interfaces para passar informações de e para o filtro.</span><span class="sxs-lookup"><span data-stu-id="8984d-113">The application uses these interfaces to pass information to and from the filter.</span></span> <span data-ttu-id="8984d-114">O filtro converte as chamadas de método COM em chamadas de driver de dispositivo, passa essas informações para o driver no modo kernel e converte o resultado de volta para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="8984d-114">The filter translates the COM method calls into device driver calls, passes that information to the driver in kernel mode, and then translates the result back to the application.</span></span> <span data-ttu-id="8984d-115">Os filtros TV Tuner, áudio de TV, vídeo analógico e KsProxy dão suporte a propriedades de driver personalizadas por meio da interface [**IKsPropertySet**](ikspropertyset.md) .</span><span class="sxs-lookup"><span data-stu-id="8984d-115">The TV Tuner, TV Audio, Analog Video Crossbar, and KsProxy filters support custom driver properties through the [**IKsPropertySet**](ikspropertyset.md) interface.</span></span> <span data-ttu-id="8984d-116">O filtro de captura VFW e o filtro de captura de áudio não são extensíveis dessa maneira.</span><span class="sxs-lookup"><span data-stu-id="8984d-116">The VFW Capture filter and the Audio Capture filter are not extensible in this way.</span></span>

<span data-ttu-id="8984d-117">Para desenvolvedores de aplicativos, os filtros de wrapper permitem que o aplicativo controle dispositivos da mesma forma que controlam qualquer outro filtro do DirectShow.</span><span class="sxs-lookup"><span data-stu-id="8984d-117">For application developers, wrapper filters enable the application to control devices just as they control any other DirectShow filter.</span></span> <span data-ttu-id="8984d-118">Nenhuma programação especial é necessária; os detalhes da comunicação com o dispositivo de modo kernel são encapsulados dentro do filtro.</span><span class="sxs-lookup"><span data-stu-id="8984d-118">No special programming is required; the details of communicating with the kernel-mode device are encapsulated within the filter.</span></span>

<span data-ttu-id="8984d-119">**Vídeo para dispositivos Windows**</span><span class="sxs-lookup"><span data-stu-id="8984d-119">**Video for Windows Devices**</span></span>

<span data-ttu-id="8984d-120">O filtro de captura VFW dá suporte aos cartões de captura de vídeo para Windows (VfW) anteriores.</span><span class="sxs-lookup"><span data-stu-id="8984d-120">The VFW Capture filter supports earlier Video for Windows (VfW) capture cards.</span></span> <span data-ttu-id="8984d-121">Quando um cartão VfW está presente no sistema de destino, ele pode ser descoberto e adicionado ao gráfico de filtro usando o [enumerador de dispositivo do sistema](system-device-enumerator.md)DirectShow.</span><span class="sxs-lookup"><span data-stu-id="8984d-121">When a VfW card is present on the target system, it can be discovered and added to the filter graph using the DirectShow [System Device Enumerator](system-device-enumerator.md).</span></span> <span data-ttu-id="8984d-122">Para obter detalhes, consulte [enumerando dispositivos e filtros](enumerating-devices-and-filters.md).</span><span class="sxs-lookup"><span data-stu-id="8984d-122">For details, see [Enumerating Devices and Filters](enumerating-devices-and-filters.md).</span></span>

<span data-ttu-id="8984d-123">**Dispositivos de captura e mixagem de áudio (cartões de som)**</span><span class="sxs-lookup"><span data-stu-id="8984d-123">**Audio Capture and Mixing Devices (Sound Cards)**</span></span>

<span data-ttu-id="8984d-124">Placas de som mais novas têm conectores de entrada para microfones e outros tipos de dispositivos.</span><span class="sxs-lookup"><span data-stu-id="8984d-124">Newer sound cards have input jacks for microphones and other types of devices.</span></span> <span data-ttu-id="8984d-125">Normalmente, esses cartões também têm recursos de mixagem integrada para controlar o volume, os agudos e os graves de cada entrada individual.</span><span class="sxs-lookup"><span data-stu-id="8984d-125">Typically these cards also have on-board mixing capabilities for controlling the volume, treble, and bass of each individual input.</span></span> <span data-ttu-id="8984d-126">No DirectShow, as entradas e o mixer da placa de som são encapsulados pelo filtro de captura de áudio.</span><span class="sxs-lookup"><span data-stu-id="8984d-126">In DirectShow, the sound card's inputs and mixer are wrapped by the Audio Capture filter.</span></span> <span data-ttu-id="8984d-127">Cada placa de som pode ser descoberta com o enumerador de dispositivo do sistema.</span><span class="sxs-lookup"><span data-stu-id="8984d-127">Each sound card can be discovered with the System Device Enumerator.</span></span> <span data-ttu-id="8984d-128">Para exibir as placas de som em seu sistema, execute GraphEdit e selecione na categoria fontes de captura de áudio.</span><span class="sxs-lookup"><span data-stu-id="8984d-128">To view the sound cards in your system, run GraphEdit and select from the Audio Capture Sources category.</span></span> <span data-ttu-id="8984d-129">Cada filtro nessa categoria é uma instância separada do filtro de captura de áudio.</span><span class="sxs-lookup"><span data-stu-id="8984d-129">Each filter in that category is a separate instance of the Audio Capture filter.</span></span> <span data-ttu-id="8984d-130">(Consulte [usando GraphEdit](using-graphedit.md).)</span><span class="sxs-lookup"><span data-stu-id="8984d-130">(See [Using GraphEdit](using-graphedit.md).)</span></span>

<span data-ttu-id="8984d-131">**Dispositivos de streaming WDM**</span><span class="sxs-lookup"><span data-stu-id="8984d-131">**WDM Streaming Devices**</span></span>

<span data-ttu-id="8984d-132">Os decodificadores de hardware mais recentes e os cartões de captura estão em conformidade com a especificação de Windows Driver Model (WDM).</span><span class="sxs-lookup"><span data-stu-id="8984d-132">Newer hardware decoders and capture cards conform to the Windows Driver Model (WDM) specification.</span></span> <span data-ttu-id="8984d-133">Esses dispositivos têm maior funcionalidade do que os dispositivos VfW.</span><span class="sxs-lookup"><span data-stu-id="8984d-133">These devices have greater functionality than VfW devices.</span></span> <span data-ttu-id="8984d-134">Os cartões de captura de vídeo WDM podem dar suporte a recursos que não estão disponíveis em VfW, incluindo a enumeração de formatos de captura, o controle programático de parâmetros de vídeo, como matiz e brilho, seleção de entrada programática e suporte a sintonizador de TV.</span><span class="sxs-lookup"><span data-stu-id="8984d-134">WDM video capture cards can support features that are not available under VfW, including the enumeration of capture formats, programmatic control of video parameters such as hue and brightness, programmatic input selection, and TV Tuner support.</span></span>

<span data-ttu-id="8984d-135">Para oferecer suporte a dispositivos de streaming WDM, o DirectShow fornece o filtro KsProxy (ksproxy.ax).</span><span class="sxs-lookup"><span data-stu-id="8984d-135">To support WDM streaming devices, DirectShow provides the KsProxy filter (ksproxy.ax).</span></span> <span data-ttu-id="8984d-136">KsProxy foi chamado de "filtro de faca do exército suíço", pois ele faz muitas coisas diferentes.</span><span class="sxs-lookup"><span data-stu-id="8984d-136">KsProxy has been called the "Swiss Army Knife filter" because it does so many different things.</span></span> <span data-ttu-id="8984d-137">O número de Pins no filtro e o número de interfaces COM expostas pelo filtro dependem dos recursos do driver subjacente.</span><span class="sxs-lookup"><span data-stu-id="8984d-137">The number of pins on the filter, and the number of COM interfaces exposed by the filter, depend on the capabilities of the underlying driver.</span></span> <span data-ttu-id="8984d-138">KsProxy não aparece no grafo de filtro sob o nome "KsProxy".</span><span class="sxs-lookup"><span data-stu-id="8984d-138">KsProxy does not appear in the filter graph under the name "KsProxy."</span></span> <span data-ttu-id="8984d-139">Ele sempre usa o nome amigável do dispositivo, que é encontrado no registro.</span><span class="sxs-lookup"><span data-stu-id="8984d-139">It always takes the friendly name of the device, which is found in the registry.</span></span> <span data-ttu-id="8984d-140">Para exibir os dispositivos WDM no seu sistema, execute GraphEdit e selecione nas categorias de streaming WDM.</span><span class="sxs-lookup"><span data-stu-id="8984d-140">To view the WDM devices on your system, run GraphEdit and select from the WDM Streaming categories.</span></span> <span data-ttu-id="8984d-141">Mesmo que você tenha apenas uma placa WDM em seu sistema, esse cartão pode conter mais de um dispositivo.</span><span class="sxs-lookup"><span data-stu-id="8984d-141">Even if you have only one WDM card on your system, that card might contain more than one device.</span></span> <span data-ttu-id="8984d-142">Cada dispositivo é representado como um filtro separado, e cada um desses filtros é realmente KsProxy.</span><span class="sxs-lookup"><span data-stu-id="8984d-142">Each device is represented as a separate filter, and each of these filters is actually KsProxy.</span></span>

<span data-ttu-id="8984d-143">Um aplicativo usa o enumerador de dispositivo do sistema para localizar monikers de dispositivo WDM no sistema.</span><span class="sxs-lookup"><span data-stu-id="8984d-143">An application uses the System Device Enumerator to find WDM device monikers on the system.</span></span> <span data-ttu-id="8984d-144">KsProxy é instanciado chamando **BindToObject** no moniker.</span><span class="sxs-lookup"><span data-stu-id="8984d-144">KsProxy is instantiated by calling **BindToObject** on the moniker.</span></span> <span data-ttu-id="8984d-145">Como KsProxy pode representar todos os tipos de dispositivos WDM, ele deve consultar o driver para determinar a quais conjuntos de propriedades o driver dá suporte.</span><span class="sxs-lookup"><span data-stu-id="8984d-145">Because KsProxy can represent all kinds of WDM devices, it must query the driver to determine which property sets the driver supports.</span></span> <span data-ttu-id="8984d-146">Os conjuntos de propriedades são coleções de estruturas de dados usadas por drivers WDM e também por alguns filtros de modo de usuário, como decodificadores de software MPEG-2.</span><span class="sxs-lookup"><span data-stu-id="8984d-146">Property sets are collections of data structures used by WDM drivers, and also by some user mode filters, such as MPEG-2 software decoders.</span></span> <span data-ttu-id="8984d-147">O KsProxy se configura para expor as interfaces COM que correspondem a esses conjuntos de propriedades.</span><span class="sxs-lookup"><span data-stu-id="8984d-147">KsProxy configures itself to expose the COM interfaces that correspond to those property sets.</span></span> <span data-ttu-id="8984d-148">KsProxy converte as chamadas de método COM em conjuntos de propriedades e as envia para o driver.</span><span class="sxs-lookup"><span data-stu-id="8984d-148">KsProxy translates the COM method calls into property sets and sends these to the driver.</span></span> <span data-ttu-id="8984d-149">Os fornecedores de hardware podem estender o KsProxy fornecendo plug-ins, que são interfaces específicas do fornecedor que expõem os recursos especiais de um dispositivo.</span><span class="sxs-lookup"><span data-stu-id="8984d-149">Hardware vendors can extend KsProxy by supplying plug-ins, which are vendor-specific interfaces that expose the special capabilities of a device.</span></span> <span data-ttu-id="8984d-150">Todos esses detalhes estão ocultos do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="8984d-150">All these details are hidden from application.</span></span> <span data-ttu-id="8984d-151">O aplicativo controla o dispositivo por meio do KsProxy, da mesma forma que qualquer outro filtro do DirectShow.</span><span class="sxs-lookup"><span data-stu-id="8984d-151">The application controls the device by way of KsProxy, in the same way as any other DirectShow filter.</span></span>

<span data-ttu-id="8984d-152">**Streaming de kernel**</span><span class="sxs-lookup"><span data-stu-id="8984d-152">**Kernel Streaming**</span></span>

<span data-ttu-id="8984d-153">Os dispositivos WDM dão suporte ao streaming de kernel, no qual os dados são transmitidos inteiramente no modo kernel sem mudar para o modo de usuário.</span><span class="sxs-lookup"><span data-stu-id="8984d-153">WDM devices support kernel streaming, in which data is streamed entirely in kernel mode without ever switching to user mode.</span></span> <span data-ttu-id="8984d-154">Alternar entre o modo kernel e o modo de usuário é computacionalmente caro; o streaming de kernel permite taxas de bits altas sem sobrecarregar a CPU do host.</span><span class="sxs-lookup"><span data-stu-id="8984d-154">Switching between kernel mode and user mode is computationally expensive; kernel streaming allows for high bit rates without burdening the host CPU.</span></span> <span data-ttu-id="8984d-155">Os filtros baseados em WDM podem usar o streaming de kernel para transmitir dados de multimídia diretamente de um dispositivo de hardware para outro, seja no mesmo cartão ou em um cartão diferente, sem copiar os dados para a memória principal do sistema.</span><span class="sxs-lookup"><span data-stu-id="8984d-155">WDM-based filters can use kernel streaming to pass multimedia data directly from one hardware device to another, either on the same card or on a different card, without copying the data into the system's main memory.</span></span>

<span data-ttu-id="8984d-156">Do ponto de vista de um aplicativo, ele aparece como se os dados se movem de um filtro de modo de usuário para o próximo.</span><span class="sxs-lookup"><span data-stu-id="8984d-156">From an application's point of view, it appears as if the data moves from one user-mode filter to the next.</span></span> <span data-ttu-id="8984d-157">Na realidade, os dados podem nunca passar para o modo de usuário, mas podem ser transmitidos diretamente de um dispositivo de modo kernel para outro até que ele seja renderizado na placa gráfica de vídeo.</span><span class="sxs-lookup"><span data-stu-id="8984d-157">In reality, the data might never pass into user mode at all, but instead might be streamed directly from one kernel-mode device to another until it is rendered on the video graphics card.</span></span> <span data-ttu-id="8984d-158">Alguns cenários, como a captura de um arquivo, exigem que os dados passem do modo kernel para o modo de usuário em algum momento.</span><span class="sxs-lookup"><span data-stu-id="8984d-158">Some scenarios, such as capture to a file, require that the data pass from kernel mode to user mode at some point.</span></span> <span data-ttu-id="8984d-159">No entanto, essa opção não exige necessariamente que os dados sejam copiados para um novo local na memória.</span><span class="sxs-lookup"><span data-stu-id="8984d-159">However, this switch does not necessarily require the data to be copied to a new location in memory.</span></span>

<span data-ttu-id="8984d-160">Os desenvolvedores de aplicativos geralmente não precisam se preocupar com os detalhes do streaming de kernel, exceto como informações de segundo plano.</span><span class="sxs-lookup"><span data-stu-id="8984d-160">Application developers generally do not need to be concerned with the details of kernel streaming, except as background information.</span></span> <span data-ttu-id="8984d-161">Consulte o Microsoft DDK para obter informações mais detalhadas sobre WDM, kernel streaming, KsProxy e tópicos relacionados.</span><span class="sxs-lookup"><span data-stu-id="8984d-161">See the Microsoft DDK for more detailed information about WDM, kernel streaming, KsProxy, and related topics.</span></span>

## <a name="related-topics"></a><span data-ttu-id="8984d-162">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="8984d-162">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="8984d-163">O gráfico de filtro e seus componentes</span><span class="sxs-lookup"><span data-stu-id="8984d-163">The Filter Graph and Its Components</span></span>](the-filter-graph-and-its-components.md)
</dt> </dl>

 

 



