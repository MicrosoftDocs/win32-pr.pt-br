---
description: Compartilhando dados entre fluxos
ms.assetid: e18eecf8-9475-420a-9a60-4b1b5f8fd43a
title: Compartilhando dados entre fluxos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ee0b2f53fe1952bbc16711f7c7e39c3182ba94a7
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/06/2021
ms.locfileid: "104456688"
---
# <a name="sharing-data-between-streams"></a><span data-ttu-id="d9d4b-103">Compartilhando dados entre fluxos</span><span class="sxs-lookup"><span data-stu-id="d9d4b-103">Sharing Data Between Streams</span></span>

> [!Note]  
> <span data-ttu-id="d9d4b-104">Essas APIs são preteridas.</span><span class="sxs-lookup"><span data-stu-id="d9d4b-104">These APIs are deprecated.</span></span> <span data-ttu-id="d9d4b-105">Os aplicativos devem usar o filtro de [**apoio de exemplo**](sample-grabber-filter.md) ou implementar um filtro personalizado para obter dados de um grafo de filtro do DirectShow.</span><span class="sxs-lookup"><span data-stu-id="d9d4b-105">Applications should use the [**Sample Grabber**](sample-grabber-filter.md) filter or implement a custom filter to get data from a DirectShow filter graph.</span></span>

 

<span data-ttu-id="d9d4b-106">O processamento de dados de multimídia geralmente requer uma grande quantidade de recursos do sistema; Portanto, você deve evitar copiar dados sempre que possível.</span><span class="sxs-lookup"><span data-stu-id="d9d4b-106">Processing multimedia data typically requires a great deal of system resources; therefore, you should avoid copying data whenever possible.</span></span> <span data-ttu-id="d9d4b-107">A arquitetura de streaming dá suporte a exemplos de fluxo compartilhados, um mecanismo que move dados de um fluxo para outro sem copiá-los.</span><span class="sxs-lookup"><span data-stu-id="d9d4b-107">The streaming architecture supports shared stream samples, a mechanism that moves data from one stream to another without copying it.</span></span> <span data-ttu-id="d9d4b-108">Esse buffer permite o transporte eficiente de dados entre dois fluxos, mesmo que o fluxo de destino não ofereça suporte especificamente ao formato de dados subjacente.</span><span class="sxs-lookup"><span data-stu-id="d9d4b-108">This buffer enables the efficient transportation of data between two streams even if the destination stream doesn't specifically support the underlying data format.</span></span>

<span data-ttu-id="d9d4b-109">Por exemplo, suponha que você tenha um fluxo de multimídia com três fluxos de dados: vídeo e áudio e dados de URL com carimbo de data/hora para corresponder ao conteúdo do vídeo.</span><span class="sxs-lookup"><span data-stu-id="d9d4b-109">For example, assume that you have a multimedia stream with three data streams: video and audio, and URL data time-stamped to match the video content.</span></span> <span data-ttu-id="d9d4b-110">Você deseja escrever um aplicativo que adiciona um aviso de direitos autorais em cada quadro de vídeo e grava os dados em outro fluxo para armazenamento, mas seu aplicativo não entende nenhum formato de dados, exceto o fluxo de vídeo.</span><span class="sxs-lookup"><span data-stu-id="d9d4b-110">You want to write an application that adds a copyright notice on every video frame and writes the data to another stream for storage, but your application doesn't understand any data formats except the video stream.</span></span> <span data-ttu-id="d9d4b-111">Para o fluxo de vídeo, você cria um exemplo anexado à superfície do DirectDraw desejada.</span><span class="sxs-lookup"><span data-stu-id="d9d4b-111">For the video stream, you create a sample attached to the desired DirectDraw surface.</span></span> <span data-ttu-id="d9d4b-112">Em seguida, você pode criar um fluxo de saída chamando o método [**IDirectDrawMediaStream:: createsample**](/previous-versions/windows/desktop/api/ddstream/nf-ddstream-idirectdrawmediastream-createsample) com esse ponteiro para a mesma superfície ou [**IMediaStream:: CreateSharedSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-createsharedsample).</span><span class="sxs-lookup"><span data-stu-id="d9d4b-112">You can then create an output stream by calling either the [**IDirectDrawMediaStream::CreateSample**](/previous-versions/windows/desktop/api/ddstream/nf-ddstream-idirectdrawmediastream-createsample) method with that pointer to the same surface, or [**IMediaStream::CreateSharedSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-createsharedsample).</span></span> <span data-ttu-id="d9d4b-113">Em ambos os casos, os fluxos de entrada e saída compartilham a superfície do DirectDraw.</span><span class="sxs-lookup"><span data-stu-id="d9d4b-113">In both cases, the input and output streams share the DirectDraw surface.</span></span> <span data-ttu-id="d9d4b-114">Como você entende o formato de vídeo, você pode acessar essa superfície conforme necessário.</span><span class="sxs-lookup"><span data-stu-id="d9d4b-114">Because you understand the video format, you can access this surface as needed.</span></span>

<span data-ttu-id="d9d4b-115">Para recuperar os outros ponteiros de fluxo de origem (áudio e URL), enumere o fluxo do contêiner de origem e pegue os ponteiros para os fluxos de não vídeo.</span><span class="sxs-lookup"><span data-stu-id="d9d4b-115">To retrieve the other source stream pointers (audio and URL), enumerate the source container stream and grab pointers to the nonvideo streams.</span></span> <span data-ttu-id="d9d4b-116">Cada um desses fluxos de origem tem um fluxo de saída associado no contêiner de fluxo de saída.</span><span class="sxs-lookup"><span data-stu-id="d9d4b-116">Each of these source streams has an associated output stream in the output stream container.</span></span> <span data-ttu-id="d9d4b-117">Recupere esses ponteiros de saída chamando o método [**IMultiMediaStream:: GetMediaStream**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-getmediastream) no contêiner de saída com cada um dos ponteiros de fluxo de origem.</span><span class="sxs-lookup"><span data-stu-id="d9d4b-117">Retrieve these output pointers by calling the [**IMultiMediaStream::GetMediaStream**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-getmediastream) method on the output container with each of the source stream pointers.</span></span> <span data-ttu-id="d9d4b-118">As etapas a seguir descrevem esse processo.</span><span class="sxs-lookup"><span data-stu-id="d9d4b-118">The following steps describe this process.</span></span>

1.  <span data-ttu-id="d9d4b-119">Chame [**IMultiMediaStream:: EnumMediaStreams**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-enummediastreams) para recuperar um ponteiro para um fluxo de origem.</span><span class="sxs-lookup"><span data-stu-id="d9d4b-119">Call [**IMultiMediaStream::EnumMediaStreams**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-enummediastreams) to retrieve a pointer to a source stream.</span></span> <span data-ttu-id="d9d4b-120">Certifique-se de que não seja o fluxo de vídeo, porque seu aplicativo já entende seu formato.</span><span class="sxs-lookup"><span data-stu-id="d9d4b-120">Make sure that it's not the video stream, because your application already understands its format.</span></span>
2.  <span data-ttu-id="d9d4b-121">Chame [**IMultiMediaStream:: GetMediaStream**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-getmediastream) no fluxo do contêiner de saída com o ponteiro da etapa 1.</span><span class="sxs-lookup"><span data-stu-id="d9d4b-121">Call [**IMultiMediaStream::GetMediaStream**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-getmediastream) on the output container stream with the pointer from step 1.</span></span> <span data-ttu-id="d9d4b-122">Isso retorna um ponteiro para o fluxo de saída desejado.</span><span class="sxs-lookup"><span data-stu-id="d9d4b-122">This returns a pointer to the desired output stream.</span></span>
3.  <span data-ttu-id="d9d4b-123">Chame [**AllocateSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-allocatesample) no fluxo de origem.</span><span class="sxs-lookup"><span data-stu-id="d9d4b-123">Call [**AllocateSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-allocatesample) on the source stream.</span></span>
4.  <span data-ttu-id="d9d4b-124">Chame [**CreateSharedSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-createsharedsample) no fluxo de saída.</span><span class="sxs-lookup"><span data-stu-id="d9d4b-124">Call [**CreateSharedSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-createsharedsample) on the output stream.</span></span>
5.  <span data-ttu-id="d9d4b-125">Chame [**Update**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-istreamsample-update) no fluxo de origem para ler os dados.</span><span class="sxs-lookup"><span data-stu-id="d9d4b-125">Call [**Update**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-istreamsample-update) on the source stream to read the data.</span></span>
6.  <span data-ttu-id="d9d4b-126">Chame [**Update**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-istreamsample-update) no fluxo de saída para gravar os dados.</span><span class="sxs-lookup"><span data-stu-id="d9d4b-126">Call [**Update**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-istreamsample-update) on the output stream to write the data.</span></span>

<span data-ttu-id="d9d4b-127">Repita essas etapas para cada fluxo cujo formato você não dá suporte.</span><span class="sxs-lookup"><span data-stu-id="d9d4b-127">Repeat these steps for each stream whose format you don't support.</span></span> <span data-ttu-id="d9d4b-128">Quando ambos os exemplos terminarem de atualizar, o fluxo de saída terá todos os dados do fluxo de origem e você terminará.</span><span class="sxs-lookup"><span data-stu-id="d9d4b-128">When both samples finish updating, the output stream has all data from the source stream and you are done.</span></span>

 

 



