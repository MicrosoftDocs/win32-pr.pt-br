---
description: Este tópico descreve como gravar um filtro de origem personalizado para o DirectShow.
ms.assetid: 032f7624-2237-41cd-844a-18ed4a2e420d
title: Como escrever um filtro de origem para o DirectShow
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 87af99595a43c86be0e2f4ecaa51768a211e9674
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/06/2021
ms.locfileid: "104500667"
---
# <a name="how-to-write-a-source-filter-for-directshow"></a><span data-ttu-id="5e6ba-103">Como escrever um filtro de origem para o DirectShow</span><span class="sxs-lookup"><span data-stu-id="5e6ba-103">How to Write a Source Filter for DirectShow</span></span>

<span data-ttu-id="5e6ba-104">Este tópico descreve como gravar um filtro de origem personalizado para o DirectShow.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-104">This topic describes how to write a custom source filter for DirectShow.</span></span>

> [!Note]  
> <span data-ttu-id="5e6ba-105">Este tópico descreve somente as fontes push; Ele não descreve fontes de pull, como o filtro de leitor assíncrono ou filtros de Splitter que se conectam a fontes de pull.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-105">This topic describes push sources only; it does not describe pull sources, such as the Async Reader Filter, or splitter filters that connect to pull sources.</span></span> <span data-ttu-id="5e6ba-106">Para a distinção entre as fontes *Push* e *pull* , consulte [fluxo de dados para os desenvolvedores de filtro](data-flow-for-filter-developers.md).</span><span class="sxs-lookup"><span data-stu-id="5e6ba-106">For the distinction between *push* and *pull* sources, see [Data Flow for Filter Developers](data-flow-for-filter-developers.md).</span></span>

 

## <a name="the-directshow-streaming-model"></a><span data-ttu-id="5e6ba-107">O modelo de streaming do DirectShow</span><span class="sxs-lookup"><span data-stu-id="5e6ba-107">The DirectShow Streaming Model</span></span>

<span data-ttu-id="5e6ba-108">Quando você escreve um filtro de origem, é importante entender que uma fonte Push não é a mesma coisa que uma fonte dinâmica.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-108">When you write a source filter, it is important to understand that a push source is not the same thing as a live source.</span></span> <span data-ttu-id="5e6ba-109">Uma fonte dinâmica obtém dados de alguma fonte externa, como uma câmera ou um fluxo de rede.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-109">A live source gets data from some external source, such as a camera or a network stream.</span></span> <span data-ttu-id="5e6ba-110">Geralmente, uma fonte dinâmica não pode controlar a taxa de entrada de dados.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-110">Generally, a live source cannot control the incoming rate of data.</span></span> <span data-ttu-id="5e6ba-111">Se os filtros downstream não consumirem os dados com rapidez suficiente, a fonte precisará descartar os exemplos.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-111">If the downstream filters do not consume the data fast enough, the source will need to drop samples.</span></span>

<span data-ttu-id="5e6ba-112">Mas uma fonte Push não precisa ser uma fonte dinâmica.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-112">But a push source does not have to be a live source.</span></span> <span data-ttu-id="5e6ba-113">Por exemplo, uma fonte Push pode ler dados de um arquivo local.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-113">For example, a push source can read data from a local file.</span></span> <span data-ttu-id="5e6ba-114">Nesse caso, os filtros de renderizador downstream determinam a rapidez com que eles consomem os dados da origem, com base no relógio de referência e nos carimbos de data/hora de exemplo.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-114">In that case, the downstream renderer filters determine how fast they consume the data from the source, based on the reference clock and the sample time stamps.</span></span> <span data-ttu-id="5e6ba-115">O filtro de origem fornece amostras o mais rápido possível, mas o fluxo de dados real é restrito pelos renderizadores.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-115">The source filter delivers samples as quickly as possible, but the actual data flow is gated limited by the renderers.</span></span> <span data-ttu-id="5e6ba-116">Os mecanismos para a retenção do fluxo de dados são descritos em [fluxo de dados para os desenvolvedores de filtro](data-flow-for-filter-developers.md).</span><span class="sxs-lookup"><span data-stu-id="5e6ba-116">The mechanisms for gating the data flow are described in [Data Flow for Filter Developers](data-flow-for-filter-developers.md).</span></span>

<span data-ttu-id="5e6ba-117">Cada pino de saída no filtro de origem cria um thread chamado *thread de streaming*.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-117">Each output pin on the source filter creates a thread called a *streaming thread*.</span></span> <span data-ttu-id="5e6ba-118">O PIN fornece exemplos no thread de streaming.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-118">The pin delivers samples on the streaming thread.</span></span> <span data-ttu-id="5e6ba-119">Normalmente, toda a decodificação, processamento e renderização ocorre nesse thread, embora alguns filtros downstream possam criar threads adicionais para enfileirar suas amostras de saída.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-119">Typically, all of the decoding, processing, and rendering happens on this thread, although some downstream filters might create additional threads to queue their output samples.</span></span>

<span data-ttu-id="5e6ba-120">O thread de streaming executa um loop com a seguinte estrutura:</span><span class="sxs-lookup"><span data-stu-id="5e6ba-120">The streaming thread runs a loop with the following structure:</span></span>

``` syntax
until (stopped)
  1. Get a media sample from the allocator.
  2. Fill the sample with data.
  3. Time stamp the sample. 
  4. Deliver the sample downstream.
```

<span data-ttu-id="5e6ba-121">Se não houver amostras disponíveis, a etapa 1 será bloqueada até que um exemplo se torne disponível.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-121">If no samples are available, step 1 blocks until a sample becomes available.</span></span> <span data-ttu-id="5e6ba-122">A etapa 4 também pode bloquear; por exemplo, ele pode bloquear enquanto o grafo é pausado.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-122">Step 4 can also block; for example, it can block while the graph is paused.</span></span>

<span data-ttu-id="5e6ba-123">O loop é executado o mais rapidamente possível, mas é limitado pela rapidez com que o filtro de renderizador renderiza cada exemplo.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-123">The loop runs as quickly as possible, but is limited by how quickly the renderer filter renders each sample.</span></span> <span data-ttu-id="5e6ba-124">Supondo que o grafo de filtro tenha um relógio de referência, a taxa é determinada pelos tempos de apresentação nos exemplos.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-124">Assuming the filter graph has a reference clock, the rate is determined by the presentation times on the samples.</span></span> <span data-ttu-id="5e6ba-125">Se não houver nenhum relógio de referência, o renderizador consumirá amostras o mais rápido possível.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-125">If there is no reference clock, the renderer consumes samples as quickly as possible.</span></span>

## <a name="using-csource-and-csourcestream"></a><span data-ttu-id="5e6ba-126">Usando CSource e CSourceStream</span><span class="sxs-lookup"><span data-stu-id="5e6ba-126">Using CSource and CSourceStream</span></span>

<span data-ttu-id="5e6ba-127">As classes base do DirectShow incluem duas classes que dão suporte a fontes push: [**CSource**](csource.md) e [**CSourceStream**](csourcestream.md).</span><span class="sxs-lookup"><span data-stu-id="5e6ba-127">The DirectShow base classes include two classes that support push sources: [**CSource**](csource.md) and [**CSourceStream**](csourcestream.md).</span></span>

-   <span data-ttu-id="5e6ba-128">[**CSource**](csource.md) é a classe base para o filtro e implementa a interface [**IBaseFilter**](/windows/desktop/api/Strmif/nn-strmif-ibasefilter) .</span><span class="sxs-lookup"><span data-stu-id="5e6ba-128">[**CSource**](csource.md) is the base class for the filter and implements the [**IBaseFilter**](/windows/desktop/api/Strmif/nn-strmif-ibasefilter) interface.</span></span>
-   <span data-ttu-id="5e6ba-129">[**CSourceStream**](csourcestream.md) é a classe base para os Pins de saída e implementa a interface [**IPin**](/windows/desktop/api/Strmif/nn-strmif-ipin) .</span><span class="sxs-lookup"><span data-stu-id="5e6ba-129">[**CSourceStream**](csourcestream.md) is the base class for the output pins, and implements the [**IPin**](/windows/desktop/api/Strmif/nn-strmif-ipin) interface.</span></span>

### <a name="output-pins"></a><span data-ttu-id="5e6ba-130">Pins de saída</span><span class="sxs-lookup"><span data-stu-id="5e6ba-130">Output Pins</span></span>

<span data-ttu-id="5e6ba-131">Um filtro de origem pode ter mais de um pino de saída.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-131">A source filter can have more than one output pin.</span></span> <span data-ttu-id="5e6ba-132">No método do construtor do filtro, crie um ou mais Pins derivados de [**CSourceStream**](csourcestream.md) (um PIN por fluxo de saída).</span><span class="sxs-lookup"><span data-stu-id="5e6ba-132">In your filter's constructor method, create one or more pins derived from [**CSourceStream**](csourcestream.md) (one pin per output stream).</span></span> <span data-ttu-id="5e6ba-133">Você não precisa armazenar ponteiros para os Pins; os PINs se adicionam automaticamente ao filtro quando eles são criados.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-133">You don't need to store pointers to the pins; the pins automatically add themselves to the filter when they are created.</span></span>

### <a name="output-formats"></a><span data-ttu-id="5e6ba-134">Formatos de saída</span><span class="sxs-lookup"><span data-stu-id="5e6ba-134">Output Formats</span></span>

<span data-ttu-id="5e6ba-135">O pino de saída lida com a negociação de formato com os seguintes métodos [**CSourceStream**](csourcestream.md) :</span><span class="sxs-lookup"><span data-stu-id="5e6ba-135">The output pin handles format negotiation with the following [**CSourceStream**](csourcestream.md) methods:</span></span>



| <span data-ttu-id="5e6ba-136">Método</span><span class="sxs-lookup"><span data-stu-id="5e6ba-136">Method</span></span>                                                 | <span data-ttu-id="5e6ba-137">Descrição</span><span class="sxs-lookup"><span data-stu-id="5e6ba-137">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|--------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="5e6ba-138">**GetMediaType**</span><span class="sxs-lookup"><span data-stu-id="5e6ba-138">**GetMediaType**</span></span>](csourcestream-getmediatype.md)     | <span data-ttu-id="5e6ba-139">Obtém um tipo de mídia do pino de saída.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-139">Gets a media type from the output pin.</span></span> <br/> <span data-ttu-id="5e6ba-140">O PIN deve propor pelo menos um tipo de mídia, pois o filtro downstream pode não propor nenhum tipo.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-140">The pin must propose at least one media type, because the downstream filter might not propose any types.</span></span> <span data-ttu-id="5e6ba-141">Na maioria dos casos, o filtro downstream será um decodificador ou um processador, dependendo se o filtro de origem fornece dados compactados ou descompactados.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-141">In most cases, the downstream filter will be a decoder or a renderer, depending on whether the source filter delivers compressed or uncompressed data.</span></span> <span data-ttu-id="5e6ba-142">Um filtro de renderizador geralmente requer um tipo de mídia completo, contendo todas as informações de formato necessárias para renderizar o fluxo.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-142">A renderer filter usually requires a complete media type, containing all of the format information needed to render the stream.</span></span> <span data-ttu-id="5e6ba-143">Para um decodificador, a quantidade de informações necessárias no tipo de mídia depende muito do formato de codificação.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-143">For a decoder, the amount of information that is required in the media type depends very much on the encoding format.</span></span><br/> |
| [<span data-ttu-id="5e6ba-144">**CheckMediaType**</span><span class="sxs-lookup"><span data-stu-id="5e6ba-144">**CheckMediaType**</span></span>](csourcestream-checkmediatype.md) | <span data-ttu-id="5e6ba-145">Verifica se o PIN de saída aceita um determinado tipo de mídia.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-145">Checks if the output pin accepts a given media type.</span></span> <span data-ttu-id="5e6ba-146">A substituição desse método é opcional, dependendo de como você implementa [**GetMediaType**](csourcestream-getmediatype.md).</span><span class="sxs-lookup"><span data-stu-id="5e6ba-146">Overriding this method is optional, depending on how you implement [**GetMediaType**](csourcestream-getmediatype.md).</span></span>                                                                                                                                                                                                                                                                                                                                                                                                         |



 

<span data-ttu-id="5e6ba-147">O método [**GetMediaType**](csourcestream-getmediatype.md) está sobrecarregado:</span><span class="sxs-lookup"><span data-stu-id="5e6ba-147">The [**GetMediaType**](csourcestream-getmediatype.md) method is overloaded:</span></span>

-   <span data-ttu-id="5e6ba-148">[**GetMediaType**](csourcestream-getmediatype.md) (1) usa um único parâmetro, um ponteiro para um objeto [**CMediaType**](cmediatype.md) .</span><span class="sxs-lookup"><span data-stu-id="5e6ba-148">[**GetMediaType**](csourcestream-getmediatype.md) (1) takes a single parameter, a pointer to a [**CMediaType**](cmediatype.md) object.</span></span>
-   <span data-ttu-id="5e6ba-149">[**GetMediaType**](csourcestream-getmediatype2.md) (2) pega uma variável de índice e um ponteiro para um objeto [**CMediaType**](cmediatype.md) .</span><span class="sxs-lookup"><span data-stu-id="5e6ba-149">[**GetMediaType**](csourcestream-getmediatype2.md) (2) takes an index variable and a pointer to a [**CMediaType**](cmediatype.md) object.</span></span>

<span data-ttu-id="5e6ba-150">Se o pino de saída do filtro de origem der suporte a exatamente um formato de mídia, você deverá substituir (1) para inicializar o objeto [**CMediaType**](cmediatype.md) com esse formato.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-150">If the source filter's output pin supports exactly one media format, you should override (1) to initialize the [**CMediaType**](cmediatype.md) object with that format.</span></span> <span data-ttu-id="5e6ba-151">Deixe a implementação padrão de (2) e também deixe a implementação padrão de [**CheckMediaType**](csourcestream-checkmediatype.md).</span><span class="sxs-lookup"><span data-stu-id="5e6ba-151">Leave the default implementation of (2) and also leave the default implementation of [**CheckMediaType**](csourcestream-checkmediatype.md).</span></span>

<span data-ttu-id="5e6ba-152">Se o PIN der suporte a mais de um formato, substitua (2).</span><span class="sxs-lookup"><span data-stu-id="5e6ba-152">If the pin supports more than one format, override (2).</span></span> <span data-ttu-id="5e6ba-153">Inicialize o objeto [**CMediaType**](cmediatype.md) de acordo com o valor da variável de índice.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-153">Initialize the [**CMediaType**](cmediatype.md) object according to the value of the index variable.</span></span> <span data-ttu-id="5e6ba-154">O PIN deve retornar os formatos como uma lista ordenada.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-154">The pin should return the formats as an ordered list.</span></span> <span data-ttu-id="5e6ba-155">Nesse caso, você também deve substituir o [**CheckMediaType**](csourcestream-checkmediatype.md) para verificar o tipo de mídia em sua lista de formatos.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-155">In this case, you must also override the [**CheckMediaType**](csourcestream-checkmediatype.md) to check the media type against your list of formats.</span></span>

<span data-ttu-id="5e6ba-156">Para formatos de vídeo descompactados, lembre-se de que o filtro downstream pode propor formatos com vários valores de Stride.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-156">For uncompressed video formats, remember that the downstream filter can propose formats with various stride values.</span></span> <span data-ttu-id="5e6ba-157">O filtro deve aceitar qualquer valor de Stride válido.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-157">Your filter should accept any valid stride value.</span></span> <span data-ttu-id="5e6ba-158">Para obter mais informações, consulte [**BITMAPINFOHEADER**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfoheader).</span><span class="sxs-lookup"><span data-stu-id="5e6ba-158">For more information, see [**BITMAPINFOHEADER**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfoheader).</span></span>

<span data-ttu-id="5e6ba-159">Você também deve substituir o método puro-virtual [**CBaseOutputPin::D ecidebuffersize**](cbaseoutputpin-decidebuffersize.md) .</span><span class="sxs-lookup"><span data-stu-id="5e6ba-159">You must also override the pure-virtual [**CBaseOutputPin::DecideBufferSize**](cbaseoutputpin-decidebuffersize.md) method.</span></span> <span data-ttu-id="5e6ba-160">Use esse método para definir o tamanho dos buffers de exemplo.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-160">Use this method to set the size of the sample buffers.</span></span>

### <a name="streaming"></a><span data-ttu-id="5e6ba-161">Streaming</span><span class="sxs-lookup"><span data-stu-id="5e6ba-161">Streaming</span></span>

<span data-ttu-id="5e6ba-162">A classe [**CSourceStream**](csourcestream.md) cria o thread de streaming para o PIN.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-162">The [**CSourceStream**](csourcestream.md) class creates the streaming thread for the pin.</span></span> <span data-ttu-id="5e6ba-163">O procedimento de thread é implementado no método [**CSourceStream::D obufferprocessingloop**](csourcestream-dobufferprocessingloop.md) .</span><span class="sxs-lookup"><span data-stu-id="5e6ba-163">The thread procedure is implemented in the [**CSourceStream::DoBufferProcessingLoop**](csourcestream-dobufferprocessingloop.md) method.</span></span> <span data-ttu-id="5e6ba-164">Esse método chama o método puro-virtual [**CSourceStream:: FillBuffer**](csourcestream-fillbuffer.md) , que a classe derivada deve substituir.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-164">This method calls the pure-virtual [**CSourceStream::FillBuffer**](csourcestream-fillbuffer.md) method, which the derived class must override.</span></span> <span data-ttu-id="5e6ba-165">Esse método é onde o PIN preenche o buffer com os dados.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-165">This method is where the pin fills the buffer with data.</span></span> <span data-ttu-id="5e6ba-166">Por exemplo, se o filtro fornecer vídeo descompactado, é aqui que você desenharia os quadros de vídeo.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-166">For example, if your filter delivers uncompressed video, this is where you would draw the video frames.</span></span>

<span data-ttu-id="5e6ba-167">A classe base inicia automaticamente e interrompe o loop de thread nos momentos certos, quando o filtro pausa ou para.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-167">The base class automatically starts and stops the thread loop at the right times, when the filter pauses or stops.</span></span> <span data-ttu-id="5e6ba-168">Quando isso acontece, a classe [**CSourceStream**](csourcestream.md) chama alguns métodos para notificar sua classe derivada:</span><span class="sxs-lookup"><span data-stu-id="5e6ba-168">When this happens, the [**CSourceStream**](csourcestream.md) class calls some methods to notify your derived class:</span></span>

-   [<span data-ttu-id="5e6ba-169">**CSourceStream::OnThreadCreate**</span><span class="sxs-lookup"><span data-stu-id="5e6ba-169">**CSourceStream::OnThreadCreate**</span></span>](csourcestream-onthreadcreate.md)
-   [<span data-ttu-id="5e6ba-170">**CSourceStream::OnThreadDestroy**</span><span class="sxs-lookup"><span data-stu-id="5e6ba-170">**CSourceStream::OnThreadDestroy**</span></span>](csourcestream-onthreaddestroy.md)
-   [<span data-ttu-id="5e6ba-171">**CSourceStream::OnThreadStartPlay**</span><span class="sxs-lookup"><span data-stu-id="5e6ba-171">**CSourceStream::OnThreadStartPlay**</span></span>](csourcestream-onthreadstartplay.md)

<span data-ttu-id="5e6ba-172">Você poderá substituir esses métodos se precisar adicionar qualquer manipulação especial.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-172">You can override these methods if you need to add any special handling.</span></span> <span data-ttu-id="5e6ba-173">Caso contrário, as implementações padrão simplesmente retornam **S \_ OK**.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-173">Otherwise, the default implementations simply return **S\_OK**.</span></span>

## <a name="seeking"></a><span data-ttu-id="5e6ba-174">Atingir</span><span class="sxs-lookup"><span data-stu-id="5e6ba-174">Seeking</span></span>

<span data-ttu-id="5e6ba-175">Se você tiver um filtro de origem com um pino de saída, poderá usar a classe [**CSourceSeeking**](csourceseeking.md) como um ponto de partida para implementar a busca.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-175">If you have a source filter with one output pin, you can use the [**CSourceSeeking**](csourceseeking.md) class as a starting point for implementing seeking.</span></span> <span data-ttu-id="5e6ba-176">Herde sua classe PIN de [**CSourceStream**](csourcestream.md) e **CSourceSeeking**.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-176">Inherit your pin class from both [**CSourceStream**](csourcestream.md) and **CSourceSeeking**.</span></span>

> [!Note]  
> <span data-ttu-id="5e6ba-177">[**CSourceSeeking**](csourceseeking.md) não é recomendado para um filtro com mais de um pino de saída.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-177">[**CSourceSeeking**](csourceseeking.md) is not recommended for a filter with more than one output pin.</span></span> <span data-ttu-id="5e6ba-178">O principal problema é que apenas um PIN deve responder às solicitações de busca.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-178">The main issue is that only one pin should respond to seeking requests.</span></span> <span data-ttu-id="5e6ba-179">Normalmente, isso requer a comunicação entre os PINs e o filtro.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-179">Typically this requires communication among the pins and the filter.</span></span>

 

<span data-ttu-id="5e6ba-180">A classe [**CSourceSeeking**](csourceseeking.md) gerencia a taxa de reprodução, a hora de início, a hora de parada e a duração.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-180">The [**CSourceSeeking**](csourceseeking.md) class manages the playback rate, start time, stop time, and duration.</span></span> <span data-ttu-id="5e6ba-181">Sua classe derivada deve definir a hora de parada inicial e a duração.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-181">Your derived class should set the initial stop time and duration.</span></span> <span data-ttu-id="5e6ba-182">Sempre que um desses valores é alterado, o método [**CSourceSeeking:: disqueteira**](csourceseeking-changerate.md), [**CSourceSeeking:: altere**](csourceseeking-changestart.md)ou [**CSourceSeeking:: ChangeStop**](csourceseeking-changestop.md) é chamado, conforme apropriado.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-182">Whenever one of these values changes, the [**CSourceSeeking::ChangeRate**](csourceseeking-changerate.md), [**CSourceSeeking::ChangeStart**](csourceseeking-changestart.md), or [**CSourceSeeking::ChangeStop**](csourceseeking-changestop.md) method is called, as appropriate.</span></span> <span data-ttu-id="5e6ba-183">Os métodos são todos métodos virtuais puros.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-183">The methods are all pure virtual methods.</span></span> <span data-ttu-id="5e6ba-184">A classe de PIN derivada substitui esses métodos para fazer o seguinte:</span><span class="sxs-lookup"><span data-stu-id="5e6ba-184">The derived pin class overrides these methods to do the following:</span></span>

1.  <span data-ttu-id="5e6ba-185">Chame [**IPin:: BeginFlush**](/windows/desktop/api/Strmif/nf-strmif-ipin-beginflush) no PIN do downstream.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-185">Call [**IPin::BeginFlush**](/windows/desktop/api/Strmif/nf-strmif-ipin-beginflush) on the downstream pin.</span></span> <span data-ttu-id="5e6ba-186">Isso faz com que os filtros downstream liberem amostras que estão mantendo e rejeitam novos exemplos.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-186">This causes downstream filters to release samples they are holding and reject new samples.</span></span>
2.  <span data-ttu-id="5e6ba-187">Chame [**CSourceStream:: Stop**](csourcestream-stop.md) para interromper o thread de streaming.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-187">Call [**CSourceStream::Stop**](csourcestream-stop.md) to stop the streaming thread.</span></span> <span data-ttu-id="5e6ba-188">O filtro de origem suspende a produção de novos dados.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-188">The source filter suspends producing new data.</span></span>
3.  <span data-ttu-id="5e6ba-189">Chame [**IPin:: EndFlush**](/windows/desktop/api/Strmif/nf-strmif-ipin-endflush) no PIN do downstream.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-189">Call [**IPin::EndFlush**](/windows/desktop/api/Strmif/nf-strmif-ipin-endflush) on the downstream pin.</span></span> <span data-ttu-id="5e6ba-190">Isso sinaliza os filtros downstream para aceitar novos dados.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-190">This signals the downstream filters to accept new data.</span></span>
4.  <span data-ttu-id="5e6ba-191">Chame [**IPin:: NewSegment**](/windows/desktop/api/Strmif/nf-strmif-ipin-newsegment) com as novas horas de início e parada e a taxa.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-191">Call [**IPin::NewSegment**](/windows/desktop/api/Strmif/nf-strmif-ipin-newsegment) with the new start and stop times and rate.</span></span>
5.  <span data-ttu-id="5e6ba-192">Defina a propriedade de descontinuidade no próximo exemplo.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-192">Set the discontinuity property on the next sample.</span></span>

<span data-ttu-id="5e6ba-193">Para obter mais informações, consulte [dando suporte à busca em um filtro de origem](supporting-seeking-in-a-source-filter.md).</span><span class="sxs-lookup"><span data-stu-id="5e6ba-193">For more information, see [Supporting Seeking in a Source Filter](supporting-seeking-in-a-source-filter.md).</span></span>

<span data-ttu-id="5e6ba-194">Se o filtro der suporte à busca, a posição do fluxo agora é independente do tempo de apresentação.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-194">If your filter supports seeking, the stream position is now independent of the presentation time.</span></span> <span data-ttu-id="5e6ba-195">Após uma busca, os carimbos de data/hora são redefinidos para zero.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-195">After a seek, time stamps reset to zero.</span></span> <span data-ttu-id="5e6ba-196">A fórmula geral para carimbos de data/hora é:</span><span class="sxs-lookup"><span data-stu-id="5e6ba-196">The general formula for time stamps is:</span></span>

-   <span data-ttu-id="5e6ba-197">hora de início da amostra = tempo decorrido/taxa de reprodução</span><span class="sxs-lookup"><span data-stu-id="5e6ba-197">sample start time = time elapsed / playback rate</span></span>
-   <span data-ttu-id="5e6ba-198">hora de término da amostra = hora de início da amostra + (hora por período/taxa de reprodução)</span><span class="sxs-lookup"><span data-stu-id="5e6ba-198">sample end time = sample start time + (time per frame / playback rate)</span></span>

<span data-ttu-id="5e6ba-199">Quando o *tempo decorrido* é o tempo decorrido desde que o filtro começou a ser executado ou desde o último comando de busca.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-199">where *time elapsed* is the time that has elapsed since the filter started running or since the last seek command.</span></span>

### <a name="time-formats-for-seeking"></a><span data-ttu-id="5e6ba-200">Formatos de hora para busca</span><span class="sxs-lookup"><span data-stu-id="5e6ba-200">Time Formats for Seeking</span></span>

<span data-ttu-id="5e6ba-201">Por padrão, os comandos de busca estão em unidades de 100 a nanossegundos.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-201">By default, seek commands are in units of 100-nanoseconds.</span></span> <span data-ttu-id="5e6ba-202">O filtro de origem pode dar suporte a formatos de tempo adicionais, como busca por número de quadro.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-202">Your source filter can support additional time formats, such as seeking by frame number.</span></span> <span data-ttu-id="5e6ba-203">Cada formato de hora é identificado por um GUID; consulte [**GUIDs de formato de hora**](time-format-guids.md).</span><span class="sxs-lookup"><span data-stu-id="5e6ba-203">Each time format is identified by a GUID; see [**Time Format GUIDs**](time-format-guids.md).</span></span>

<span data-ttu-id="5e6ba-204">Para dar suporte a formatos de tempo adicionais, você deve implementar os seguintes métodos no seu pino de saída:</span><span class="sxs-lookup"><span data-stu-id="5e6ba-204">To support additional time formats, you must implement the following methods on your output pin:</span></span>

-   [<span data-ttu-id="5e6ba-205">**IMediaSeeking::ConvertTimeFormat**</span><span class="sxs-lookup"><span data-stu-id="5e6ba-205">**IMediaSeeking::ConvertTimeFormat**</span></span>](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-converttimeformat)
-   [<span data-ttu-id="5e6ba-206">**IMediaSeeking::GetTimeFormat**</span><span class="sxs-lookup"><span data-stu-id="5e6ba-206">**IMediaSeeking::GetTimeFormat**</span></span>](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-gettimeformat)
-   [<span data-ttu-id="5e6ba-207">**IMediaSeeking::IsFormatSupported**</span><span class="sxs-lookup"><span data-stu-id="5e6ba-207">**IMediaSeeking::IsFormatSupported**</span></span>](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-isformatsupported)
-   [<span data-ttu-id="5e6ba-208">**IMediaSeeking::IsUsingTimeFormat**</span><span class="sxs-lookup"><span data-stu-id="5e6ba-208">**IMediaSeeking::IsUsingTimeFormat**</span></span>](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-isusingtimeformat)
-   [<span data-ttu-id="5e6ba-209">**IMediaSeeking::QueryPreferredFormat**</span><span class="sxs-lookup"><span data-stu-id="5e6ba-209">**IMediaSeeking::QueryPreferredFormat**</span></span>](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-querypreferredformat)
-   [<span data-ttu-id="5e6ba-210">**IMediaSeeking::SetTimeFormat**</span><span class="sxs-lookup"><span data-stu-id="5e6ba-210">**IMediaSeeking::SetTimeFormat**</span></span>](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-settimeformat)

<span data-ttu-id="5e6ba-211">Se o aplicativo definir um novo formato de hora, todos os parâmetros de posição nos métodos [**IMediaSeeking**](/windows/desktop/api/Strmif/nn-strmif-imediaseeking) serão interpretados em termos do novo formato de hora.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-211">If the application sets a new time format, all of the position parameters in the [**IMediaSeeking**](/windows/desktop/api/Strmif/nn-strmif-imediaseeking) methods are interpreted in terms of the new time format.</span></span> <span data-ttu-id="5e6ba-212">Por exemplo, se o formato de hora for frames, o método [**IMediaSeeking:: getDuration**](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-getduration) deverá retornar a duração em quadros.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-212">For example, if the time format is frames, the [**IMediaSeeking::GetDuration**](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-getduration) method must return the duration in frames.</span></span>

<span data-ttu-id="5e6ba-213">Na prática, alguns filtros do DirectShow dão suporte a formatos de tempo adicionais e, como resultado, alguns aplicativos do DirectShow usam esse recurso.</span><span class="sxs-lookup"><span data-stu-id="5e6ba-213">In practice, few DirectShow filters support additional time formats, and as a result, few DirectShow applications make use of this capability.</span></span>

## <a name="related-topics"></a><span data-ttu-id="5e6ba-214">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="5e6ba-214">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="5e6ba-215">Gravando filtros de origem</span><span class="sxs-lookup"><span data-stu-id="5e6ba-215">Writing Source Filters</span></span>](writing-source-filters.md)
</dt> </dl>

 

 




