---
description: Processando dados
ms.assetid: 823615df-ce50-4e20-957a-f83d3be66658
title: Processando dados
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9bbece449df36c2de88414f313d477b8a16ba896
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/06/2021
ms.locfileid: "105780628"
---
# <a name="processing-data"></a><span data-ttu-id="39517-103">Processando dados</span><span class="sxs-lookup"><span data-stu-id="39517-103">Processing Data</span></span>

<span data-ttu-id="39517-104">**Analisando dados de mídia**</span><span class="sxs-lookup"><span data-stu-id="39517-104">**Parsing Media Data**</span></span>

<span data-ttu-id="39517-105">Se o filtro analisar os dados de mídia, não confie nos cabeçalhos ou outros dados autodescritivos no conteúdo.</span><span class="sxs-lookup"><span data-stu-id="39517-105">If your filter parses media data, do not trust headers or other self-describing data in the content.</span></span> <span data-ttu-id="39517-106">Por exemplo, não confie nos valores de tamanho que aparecem nas partes do AVI RIFF ou nos pacotes MPEG.</span><span class="sxs-lookup"><span data-stu-id="39517-106">For example, do not trust size values that appear in AVI RIFF chunks or MPEG packets.</span></span> <span data-ttu-id="39517-107">Exemplos comuns desse tipo de erro incluem:</span><span class="sxs-lookup"><span data-stu-id="39517-107">Common examples of this kind of error include:</span></span>

-   <span data-ttu-id="39517-108">Leitura de *N* bytes de dados, em que o valor de *N* veio do conteúdo, sem verificar *N* em relação ao tamanho real do buffer.</span><span class="sxs-lookup"><span data-stu-id="39517-108">Reading *N* bytes of data, where the value of *N* came from the content, without checking *N* against the actual size of your buffer.</span></span>
-   <span data-ttu-id="39517-109">Saltar para um deslocamento de byte dentro de um buffer, sem verificar se o deslocamento está dentro do buffer.</span><span class="sxs-lookup"><span data-stu-id="39517-109">Jumping to a byte offset within a buffer, without verifying that the offset falls within the buffer.</span></span>

<span data-ttu-id="39517-110">Outra classe comum de erros envolve não validar descrições de formato encontradas no conteúdo.</span><span class="sxs-lookup"><span data-stu-id="39517-110">Another common class of errors involves not validating format descriptions that are found in the content.</span></span> <span data-ttu-id="39517-111">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="39517-111">For example:</span></span>

-   <span data-ttu-id="39517-112">Uma estrutura [**BITMAPINFOHEADER**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfoheader) pode ser seguida por uma tabela de cores.</span><span class="sxs-lookup"><span data-stu-id="39517-112">A [**BITMAPINFOHEADER**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfoheader) structure can be followed by a color table.</span></span> <span data-ttu-id="39517-113">A estrutura **BITMAPINFO** é definida como uma estrutura **BITMAPINFOHEADER** seguida por uma matriz de valores **RGBQUAD** que compõem a tabela de cores.</span><span class="sxs-lookup"><span data-stu-id="39517-113">The **BITMAPINFO** structure is defined as a **BITMAPINFOHEADER** structure followed by an array of **RGBQUAD** values that make up the color table.</span></span> <span data-ttu-id="39517-114">O tamanho da matriz é determinado pelo valor de **biClrUsed**.</span><span class="sxs-lookup"><span data-stu-id="39517-114">The size of the array is determined by the value of **biClrUsed**.</span></span> <span data-ttu-id="39517-115">Nunca Copie uma tabela de cores em um **BITMAPINFO** sem primeiro verificar o tamanho do buffer que foi alocado para a estrutura **BITMAPINFO** .</span><span class="sxs-lookup"><span data-stu-id="39517-115">Never copy a color table into a **BITMAPINFO** without first checking the size of the buffer that was allocated for the **BITMAPINFO** structure.</span></span>
-   <span data-ttu-id="39517-116">Uma estrutura [**WAVEFORMATEX**](/previous-versions/dd757713(v=vs.85)) pode ter informações de formato extras acrescentadas à estrutura.</span><span class="sxs-lookup"><span data-stu-id="39517-116">A [**WAVEFORMATEX**](/previous-versions/dd757713(v=vs.85)) structure might have extra format information appended to the structure.</span></span> <span data-ttu-id="39517-117">O membro **cbSize** especifica o tamanho das informações adicionais.</span><span class="sxs-lookup"><span data-stu-id="39517-117">The **cbSize** member specifies the size of the extra information.</span></span>

<span data-ttu-id="39517-118">Durante a conexão do PIN, um filtro deve verificar se todas as estruturas de formato estão bem formadas e contêm valores razoáveis.</span><span class="sxs-lookup"><span data-stu-id="39517-118">During pin connection, a filter should verify that all format structures are well-formed and contain reasonable values.</span></span> <span data-ttu-id="39517-119">Caso contrário, rejeite a conexão.</span><span class="sxs-lookup"><span data-stu-id="39517-119">If not, reject the connection.</span></span> <span data-ttu-id="39517-120">No código que valida a estrutura de formato, seja especialmente cuidadoso com o estouro aritmético.</span><span class="sxs-lookup"><span data-stu-id="39517-120">In the code that validates the format structure, be especially careful about arithmetic overflow.</span></span> <span data-ttu-id="39517-121">Por exemplo, em um **BITMAPINFOHEADER**, a largura e a altura são valores **longos** de 32 bits, mas o tamanho da imagem (que é uma função do produto dos dois) é apenas um valor **DWORD** .</span><span class="sxs-lookup"><span data-stu-id="39517-121">For example, in a **BITMAPINFOHEADER**, the width and height are 32-bit **long** values but the image size (which is a function of the product of the two) is only a **DWORD** value.</span></span>

<span data-ttu-id="39517-122">Se os dados de formato da origem forem maiores do que o buffer alocado, não truncará os dados de origem para copiá-los para o buffer.</span><span class="sxs-lookup"><span data-stu-id="39517-122">If format data from the source is larger than your allocated buffer, do not truncate the source data in order to copy it into your buffer.</span></span> <span data-ttu-id="39517-123">Isso pode criar uma estrutura cujo tamanho implícito seja maior do que seu tamanho real.</span><span class="sxs-lookup"><span data-stu-id="39517-123">Doing so can create a structure whose implicit size is larger than its actual size.</span></span> <span data-ttu-id="39517-124">Por exemplo, um cabeçalho de bitmap pode especificar uma tabela de paleta que não existe mais.</span><span class="sxs-lookup"><span data-stu-id="39517-124">For example, a bitmap header might specify a palette table which no longer exists.</span></span> <span data-ttu-id="39517-125">Em vez disso, realoque o buffer ou simplesmente falhe a conexão.</span><span class="sxs-lookup"><span data-stu-id="39517-125">Instead, reallocate the buffer or simply fail the connection.</span></span>

<span data-ttu-id="39517-126">**Erros durante o streaming**</span><span class="sxs-lookup"><span data-stu-id="39517-126">**Errors During Streaming**</span></span>

<span data-ttu-id="39517-127">Quando o grafo estiver em execução, se o filtro receber conteúdo malformado, ele deverá terminar o streaming.</span><span class="sxs-lookup"><span data-stu-id="39517-127">When the graph is running, if your filter receives malformed content, it should terminate streaming.</span></span> <span data-ttu-id="39517-128">Faça o seguinte:</span><span class="sxs-lookup"><span data-stu-id="39517-128">Do the following:</span></span>

-   <span data-ttu-id="39517-129">Retornar um código de erro de **Receive**.</span><span class="sxs-lookup"><span data-stu-id="39517-129">Return an error code from **Receive**.</span></span>
-   <span data-ttu-id="39517-130">Chame [**IPin:: EndOfStream**](/windows/desktop/api/Strmif/nf-strmif-ipin-endofstream) no filtro downstream.</span><span class="sxs-lookup"><span data-stu-id="39517-130">Call [**IPin::EndOfStream**](/windows/desktop/api/Strmif/nf-strmif-ipin-endofstream) on the downstream filter.</span></span>
-   <span data-ttu-id="39517-131">Chame [**CBaseFilter:: NotifyEvent**](cbasefilter-notifyevent.md) para postar um evento de [**\_ ERRORABORT do EC**](ec-errorabort.md) .</span><span class="sxs-lookup"><span data-stu-id="39517-131">Call [**CBaseFilter::NotifyEvent**](cbasefilter-notifyevent.md) to post an [**EC\_ERRORABORT**](ec-errorabort.md) event.</span></span>

<span data-ttu-id="39517-132">**Alterações de formato**</span><span class="sxs-lookup"><span data-stu-id="39517-132">**Format Changes**</span></span>

<span data-ttu-id="39517-133">Existem vários mecanismos para filtros para alterar os formatos de meio fluxo.</span><span class="sxs-lookup"><span data-stu-id="39517-133">Several mechanisms exist for filters to change formats mid-stream.</span></span> <span data-ttu-id="39517-134">Cada um deles envolve mais de uma etapa, o que cria o potencial para falsas aceitação.</span><span class="sxs-lookup"><span data-stu-id="39517-134">Each of them involves more than one step, which creates the potential for false acceptances.</span></span> <span data-ttu-id="39517-135">Se o filtro receber uma solicitação de alteração de formato dinâmico, ele deverá rejeitar a solicitação ou aceitar o novo formato quando chegar.</span><span class="sxs-lookup"><span data-stu-id="39517-135">If your filter gets a request for a dynamic format change, then it must either reject the request, or else honor the new format when it arrives.</span></span> <span data-ttu-id="39517-136">Da mesma forma, nunca mude os formatos, a menos que o outro filtro concorde.</span><span class="sxs-lookup"><span data-stu-id="39517-136">Similarly, never switch formats unless the other filter agrees.</span></span> <span data-ttu-id="39517-137">Para obter mais informações, consulte [Dynamic Format Changes](dynamic-format-changes.md).</span><span class="sxs-lookup"><span data-stu-id="39517-137">For more information, see [Dynamic Format Changes](dynamic-format-changes.md).</span></span>

 

 
