---
description: Negociando alocadores
ms.assetid: fe13477c-1a7b-4098-9d0f-c54783102bc9
title: Negociando alocadores
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2faa393ba9fcd8585d68947cec172d4cfca6decf
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/06/2021
ms.locfileid: "105780047"
---
# <a name="negotiating-allocators"></a><span data-ttu-id="f79dc-103">Negociando alocadores</span><span class="sxs-lookup"><span data-stu-id="f79dc-103">Negotiating Allocators</span></span>

<span data-ttu-id="f79dc-104">Quando dois Pins se conectam, eles precisam de um mecanismo para a troca de dados de mídia.</span><span class="sxs-lookup"><span data-stu-id="f79dc-104">When two pins connect, they need a mechanism for exchanging media data.</span></span> <span data-ttu-id="f79dc-105">Esse mecanismo é chamado de *transporte*.</span><span class="sxs-lookup"><span data-stu-id="f79dc-105">This mechanism is called the *transport*.</span></span> <span data-ttu-id="f79dc-106">Em geral, a arquitetura do DirectShow é neutra em relação aos transportes.</span><span class="sxs-lookup"><span data-stu-id="f79dc-106">In general, the DirectShow architecture is neutral about transports.</span></span> <span data-ttu-id="f79dc-107">Dois filtros podem concordar em se conectar usando qualquer transporte com suporte.</span><span class="sxs-lookup"><span data-stu-id="f79dc-107">Two filters can agree to connect using any transport that both support.</span></span>

<span data-ttu-id="f79dc-108">O transporte mais comum é o transporte de *memória local* , no qual os dados de mídia residem na memória principal.</span><span class="sxs-lookup"><span data-stu-id="f79dc-108">The most common transport is the *local memory* transport, in which the media data resides in main memory.</span></span> <span data-ttu-id="f79dc-109">Existem dois tipos de transporte de memória local, o *modelo de push* e o modelo de *pull*.</span><span class="sxs-lookup"><span data-stu-id="f79dc-109">Two flavors of local memory transport exist, the *push model* and the *pull model*.</span></span> <span data-ttu-id="f79dc-110">No modelo de push, o filtro de origem envia dados por push para o filtro downstream, usando a interface [**IMemInputPin**](/windows/desktop/api/Strmif/nn-strmif-imeminputpin) no pino de entrada do filtro downstream.</span><span class="sxs-lookup"><span data-stu-id="f79dc-110">In the push model, the source filter pushes data to the downstream filter, using the [**IMemInputPin**](/windows/desktop/api/Strmif/nn-strmif-imeminputpin) interface on the downstream filter's input pin.</span></span> <span data-ttu-id="f79dc-111">No modelo de pull, o filtro downstream solicita dados do filtro de origem, usando a interface [**IAsyncReader**](/windows/desktop/api/Strmif/nn-strmif-iasyncreader) no pino de saída do filtro de origem.</span><span class="sxs-lookup"><span data-stu-id="f79dc-111">In the pull model, the downstream filter requests data from the source filter, using the [**IAsyncReader**](/windows/desktop/api/Strmif/nn-strmif-iasyncreader) interface on the source filter's output pin.</span></span> <span data-ttu-id="f79dc-112">Para obter mais informações sobre esses dois modelos de fluxo de dados, consulte [fluxo de dados no grafo de filtro](data-flow-in-the-filter-graph.md).</span><span class="sxs-lookup"><span data-stu-id="f79dc-112">For more information on these two data-flow models, see [Data Flow in the Filter Graph](data-flow-in-the-filter-graph.md).</span></span>

<span data-ttu-id="f79dc-113">No transporte de memória local, o objeto responsável pela alocação de buffers de memória é chamado de *alocador*.</span><span class="sxs-lookup"><span data-stu-id="f79dc-113">In local memory transport, the object responsible for allocating memory buffers is called the *allocator*.</span></span> <span data-ttu-id="f79dc-114">Um alocador dá suporte à interface [**IMemAllocator**](/windows/desktop/api/Strmif/nn-strmif-imemallocator) .</span><span class="sxs-lookup"><span data-stu-id="f79dc-114">An allocator supports the [**IMemAllocator**](/windows/desktop/api/Strmif/nn-strmif-imemallocator) interface.</span></span> <span data-ttu-id="f79dc-115">Ambos os Pins compartilham um único alocador.</span><span class="sxs-lookup"><span data-stu-id="f79dc-115">Both pins share a single allocator.</span></span> <span data-ttu-id="f79dc-116">O PIN pode fornecer um alocador, mas o PIN de saída seleciona qual alocador usar.</span><span class="sxs-lookup"><span data-stu-id="f79dc-116">Either pin can provide an allocator, but the output pin selects which allocator to use.</span></span>

<span data-ttu-id="f79dc-117">O PIN de saída também define as propriedades do alocador, que determinam quantos buffers são criados pelo alocador, o tamanho de cada buffer e o alinhamento da memória.</span><span class="sxs-lookup"><span data-stu-id="f79dc-117">The output pin also sets the allocator properties, which determine how many buffers are created by the allocator, the size of each buffer, and the memory alignment.</span></span> <span data-ttu-id="f79dc-118">O pino de saída pode adiar para o pino de entrada para os requisitos de buffer.</span><span class="sxs-lookup"><span data-stu-id="f79dc-118">The output pin might defer to the input pin for the buffer requirements.</span></span>

<span data-ttu-id="f79dc-119">Em uma conexão **IMemInputPin** , a negociação de alocador funciona da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="f79dc-119">In an **IMemInputPin** connection, allocator negotiation works as follows:</span></span>

1.  <span data-ttu-id="f79dc-120">Opcionalmente, o pino de saída chama [**IMemInputPin:: GetAllocatorRequirements**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-getallocatorrequirements).</span><span class="sxs-lookup"><span data-stu-id="f79dc-120">Optionally, the output pin calls [**IMemInputPin::GetAllocatorRequirements**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-getallocatorrequirements).</span></span> <span data-ttu-id="f79dc-121">Esse método recupera os requisitos de buffer do pino de entrada, como o alinhamento de memória.</span><span class="sxs-lookup"><span data-stu-id="f79dc-121">This method retrieves the input pin's buffer requirements, such as memory alignment.</span></span> <span data-ttu-id="f79dc-122">Em geral, o pino de saída deve respeitar a solicitação do pino de entrada, a menos que haja um bom motivo para não.</span><span class="sxs-lookup"><span data-stu-id="f79dc-122">In general, the output pin should honor the input pin's request, unless there is a good reason not to.</span></span>
2.  <span data-ttu-id="f79dc-123">Opcionalmente, o pino de saída chama [**IMemInputPin:: Getalocador**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-getallocator).</span><span class="sxs-lookup"><span data-stu-id="f79dc-123">Optionally, the output pin calls [**IMemInputPin::GetAllocator**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-getallocator).</span></span> <span data-ttu-id="f79dc-124">Esse método solicita um alocador do PIN de entrada.</span><span class="sxs-lookup"><span data-stu-id="f79dc-124">This method requests an allocator from the input pin.</span></span> <span data-ttu-id="f79dc-125">O PIN de entrada fornece um ou retorna um código de erro.</span><span class="sxs-lookup"><span data-stu-id="f79dc-125">The input pin provides one, or returns an error code.</span></span>
3.  <span data-ttu-id="f79dc-126">O pino de saída seleciona um alocador.</span><span class="sxs-lookup"><span data-stu-id="f79dc-126">The output pin selects an allocator.</span></span> <span data-ttu-id="f79dc-127">Ele pode usar um fornecido pelo PIN de entrada ou criar seu próprio.</span><span class="sxs-lookup"><span data-stu-id="f79dc-127">It can use one provided by the input pin, or create its own.</span></span>
4.  <span data-ttu-id="f79dc-128">O pino de saída chama [**IMemAllocator:: SetProperties**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-setproperties) para definir as propriedades do alocador.</span><span class="sxs-lookup"><span data-stu-id="f79dc-128">The output pin calls [**IMemAllocator::SetProperties**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-setproperties) to set the allocator properties.</span></span> <span data-ttu-id="f79dc-129">No entanto, o alocador pode não honrar as propriedades solicitadas.</span><span class="sxs-lookup"><span data-stu-id="f79dc-129">However, the allocator might not honor the requested properties.</span></span> <span data-ttu-id="f79dc-130">(Por exemplo, isso pode acontecer se o PIN de entrada fornecer o alocador.) O alocador retorna as propriedades reais como um parâmetro de saída no método **SetProperties** .</span><span class="sxs-lookup"><span data-stu-id="f79dc-130">(For example, this can happen if the input pin provides the allocator.) The allocator returns the actual properties as an output parameter in the **SetProperties** method.</span></span>
5.  <span data-ttu-id="f79dc-131">O outpin chama [**IMemInputPin:: NotifyAllocator**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-notifyallocator) para informar o pino de entrada da seleção.</span><span class="sxs-lookup"><span data-stu-id="f79dc-131">The outpin calls [**IMemInputPin::NotifyAllocator**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-notifyallocator) to inform the input pin of the selection.</span></span>
6.  <span data-ttu-id="f79dc-132">O pino de entrada deve chamar [**IMemAllocator:: GetProperties**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-getproperties) para verificar se as propriedades do alocador são aceitáveis.</span><span class="sxs-lookup"><span data-stu-id="f79dc-132">The input pin should call [**IMemAllocator::GetProperties**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-getproperties) to verify whether the allocator properties are acceptable.</span></span>
7.  <span data-ttu-id="f79dc-133">O pino de saída é responsável por confirmar e desconfirmar o alocador.</span><span class="sxs-lookup"><span data-stu-id="f79dc-133">The output pin is responsible for committing and decommitting the allocator.</span></span> <span data-ttu-id="f79dc-134">Isso ocorre quando o streaming começa e para.</span><span class="sxs-lookup"><span data-stu-id="f79dc-134">This occurs when streaming starts and stops.</span></span>

<span data-ttu-id="f79dc-135">Em uma conexão **IAsyncReader** , a negociação de alocador funciona da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="f79dc-135">In an **IAsyncReader** connection, allocator negotiation works as follows:</span></span>

1.  <span data-ttu-id="f79dc-136">O pino de entrada chama [**IAsyncReader:: RequestAllocator**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-requestallocator) no pino de saída.</span><span class="sxs-lookup"><span data-stu-id="f79dc-136">The input pin calls [**IAsyncReader::RequestAllocator**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-requestallocator) on the output pin.</span></span> <span data-ttu-id="f79dc-137">O PIN de entrada especifica seus requisitos de buffer e, opcionalmente, fornece um alocador.</span><span class="sxs-lookup"><span data-stu-id="f79dc-137">The input pin specifies its buffer requirements and, optionally, provides an allocator.</span></span>
2.  <span data-ttu-id="f79dc-138">O pino de saída seleciona um alocador.</span><span class="sxs-lookup"><span data-stu-id="f79dc-138">The output pin selects an allocator.</span></span> <span data-ttu-id="f79dc-139">Ele pode usar aquele fornecido pelo PIN de entrada, se houver, ou criar seu próprio.</span><span class="sxs-lookup"><span data-stu-id="f79dc-139">It can use the one provided by the input pin, if any, or create its own.</span></span>
3.  <span data-ttu-id="f79dc-140">O pino de saída retorna o alocador como um parâmetro de saída no método **RequestAllocator** .</span><span class="sxs-lookup"><span data-stu-id="f79dc-140">The output pin returns the allocator as an outgoing parameter in the **RequestAllocator** method.</span></span> <span data-ttu-id="f79dc-141">O PIN de entrada deve verificar as propriedades do alocador.</span><span class="sxs-lookup"><span data-stu-id="f79dc-141">The input pin should check the allocator properties.</span></span>
4.  <span data-ttu-id="f79dc-142">O PIN de entrada é responsável por confirmar e desconfirmar o alocador.</span><span class="sxs-lookup"><span data-stu-id="f79dc-142">The input pin is responsible for committing and decommitting the allocator.</span></span>
5.  <span data-ttu-id="f79dc-143">A qualquer momento durante o processo de negociação de alocador, o PIN pode falhar na conexão.</span><span class="sxs-lookup"><span data-stu-id="f79dc-143">At any time during the allocator negotiation process, either pin can fail the connection.</span></span>
6.  <span data-ttu-id="f79dc-144">Se o pino de saída usar o alocador do pino de entrada, ele poderá usar esse alocador somente para fornecer amostras para esse pino de entrada.</span><span class="sxs-lookup"><span data-stu-id="f79dc-144">If the output pin uses the input pin's allocator, it can use that allocator only to deliver samples to that input pin.</span></span> <span data-ttu-id="f79dc-145">O filtro proprietário não deve usar o alocador para fornecer amostras a outros Pins.</span><span class="sxs-lookup"><span data-stu-id="f79dc-145">The owning filter must not use the allocator to deliver samples to other pins.</span></span>

## <a name="related-topics"></a><span data-ttu-id="f79dc-146">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="f79dc-146">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="f79dc-147">Fornecendo um alocador personalizado</span><span class="sxs-lookup"><span data-stu-id="f79dc-147">Providing a Custom Allocator</span></span>](providing-a-custom-allocator.md)
</dt> </dl>

 

 



