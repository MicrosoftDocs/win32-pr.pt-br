---
description: Usando o modelo de classe DMO
ms.assetid: 5193ad08-aaee-47e3-93eb-a126a66d8f23
title: Usando o modelo de classe DMO
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4db80017372f11f6c928e0e6a83b591967a84ee7
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "104011321"
---
# <a name="using-the-dmo-class-template"></a><span data-ttu-id="9b895-103">Usando o modelo de classe DMO</span><span class="sxs-lookup"><span data-stu-id="9b895-103">Using the DMO Class Template</span></span>

<span data-ttu-id="9b895-104">O DirectShow inclui um modelo de classe, [**IMediaObjectImpl**](imediaobjectimpl-class-template.md), para implementar DMOs.</span><span class="sxs-lookup"><span data-stu-id="9b895-104">DirectShow includes a class template, [**IMediaObjectImpl**](imediaobjectimpl-class-template.md), for implementing DMOs.</span></span> <span data-ttu-id="9b895-105">O modelo lida com muitas das tarefas "de escrituração", como a validação de parâmetros de entrada.</span><span class="sxs-lookup"><span data-stu-id="9b895-105">The template handles many of the "bookkeeping" tasks, such as validating input parameters.</span></span> <span data-ttu-id="9b895-106">Usando o modelo, você pode se concentrar na funcionalidade que é específica para o DMO.</span><span class="sxs-lookup"><span data-stu-id="9b895-106">By using the template, you can focus on the functionality that is specific to your DMO.</span></span> <span data-ttu-id="9b895-107">Além disso, o modelo ajuda a garantir que você crie uma implementação robusta.</span><span class="sxs-lookup"><span data-stu-id="9b895-107">In addition, the template helps to ensure that you create a robust implementation.</span></span> <span data-ttu-id="9b895-108">O modelo é definido no arquivo de cabeçalho Dmoimpl. h, localizado no diretório de inclusão do SDK.</span><span class="sxs-lookup"><span data-stu-id="9b895-108">The template is defined in the header file Dmoimpl.h, located in the Include directory of the SDK.</span></span>

<span data-ttu-id="9b895-109">O modelo **IMediaObjectImpl** herda a interface [**IMediaObject**](/previous-versions/windows/desktop/api/Mediaobj/nn-mediaobj-imediaobject) .</span><span class="sxs-lookup"><span data-stu-id="9b895-109">The **IMediaObjectImpl** template inherits the [**IMediaObject**](/previous-versions/windows/desktop/api/Mediaobj/nn-mediaobj-imediaobject) interface.</span></span> <span data-ttu-id="9b895-110">Para criar um DMO usando o modelo, defina uma nova classe que derive de **IMediaObjectImpl**.</span><span class="sxs-lookup"><span data-stu-id="9b895-110">To create a DMO using the template, define a new class that derives from **IMediaObjectImpl**.</span></span> <span data-ttu-id="9b895-111">O modelo implementa todos os métodos **IMediaObject** .</span><span class="sxs-lookup"><span data-stu-id="9b895-111">The template implements all of the **IMediaObject** methods.</span></span> <span data-ttu-id="9b895-112">Na maioria dos casos, o modelo chama um método particular correspondente na classe derivada.</span><span class="sxs-lookup"><span data-stu-id="9b895-112">In most cases, the template calls a corresponding private method on the derived class.</span></span> <span data-ttu-id="9b895-113">O modelo fornece os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="9b895-113">The template provides the following features:</span></span>

-   <span data-ttu-id="9b895-114">Verificação de parâmetro básica.</span><span class="sxs-lookup"><span data-stu-id="9b895-114">Basic parameter checking.</span></span> <span data-ttu-id="9b895-115">Os métodos de modelo verificam se os parâmetros obrigatórios não são **nulos**, se os índices de fluxo estão dentro do intervalo e se os sinalizadores são válidos.</span><span class="sxs-lookup"><span data-stu-id="9b895-115">The template methods verify that required parameters are not **NULL**, that stream indexes are within range, and that flags are valid.</span></span>
-   <span data-ttu-id="9b895-116">Bloqueio.</span><span class="sxs-lookup"><span data-stu-id="9b895-116">Locking.</span></span> <span data-ttu-id="9b895-117">Os métodos de modelo chamam dois métodos internos, **Lock** e **Unlock**, para serializar operações no DMO.</span><span class="sxs-lookup"><span data-stu-id="9b895-117">The template methods call two internal methods, **Lock** and **Unlock**, to serialize operations on the DMO.</span></span> <span data-ttu-id="9b895-118">Esse recurso garante que o DMO seja thread-safe.</span><span class="sxs-lookup"><span data-stu-id="9b895-118">This feature ensures that the DMO is thread-safe.</span></span>
-   <span data-ttu-id="9b895-119">Tipos de mídia.</span><span class="sxs-lookup"><span data-stu-id="9b895-119">Media types.</span></span> <span data-ttu-id="9b895-120">O modelo armazena os tipos de mídia definidos pelo cliente e fornece métodos de acessador para os tipos de mídia.</span><span class="sxs-lookup"><span data-stu-id="9b895-120">The template stores the media types set by the client, and provides accessor methods for the media types.</span></span>
-   <span data-ttu-id="9b895-121">Transmiti.</span><span class="sxs-lookup"><span data-stu-id="9b895-121">Streaming.</span></span> <span data-ttu-id="9b895-122">O modelo impede o streaming até que o cliente defina os tipos de mídia para todos os fluxos não opcionais.</span><span class="sxs-lookup"><span data-stu-id="9b895-122">The template prevents streaming until the client has set media types for all non-optional streams.</span></span> <span data-ttu-id="9b895-123">Ele também garante que o método [**IMediaObject:: AllocateStreamingResources**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-allocatestreamingresources) seja chamado antes do início do streaming, o que garante que os recursos sejam alocados.</span><span class="sxs-lookup"><span data-stu-id="9b895-123">It also ensures that the [**IMediaObject::AllocateStreamingResources**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-allocatestreamingresources) method is called before streaming begins, which guarantees that resources are allocated.</span></span>

<span data-ttu-id="9b895-124">A classe derivada deve implementar a interface **IUnknown** ; o modelo não fornece essa interface.</span><span class="sxs-lookup"><span data-stu-id="9b895-124">The derived class must implement the **IUnknown** interface; the template does not provide this interface.</span></span> <span data-ttu-id="9b895-125">Você pode usar o Active Template Library (ATL) para implementar **IUnknown** ou pode fornecer alguma outra implementação.</span><span class="sxs-lookup"><span data-stu-id="9b895-125">You can use the Active Template Library (ATL) to implement **IUnknown**, or you can provide some other implementation.</span></span> <span data-ttu-id="9b895-126">O modelo também não implementa o mecanismo de bloqueio.</span><span class="sxs-lookup"><span data-stu-id="9b895-126">The template also does not implement the locking mechanism.</span></span> <span data-ttu-id="9b895-127">A classe derivada deve implementar os métodos **Lock** e **Unlock** .</span><span class="sxs-lookup"><span data-stu-id="9b895-127">The derived class must implement the **Lock** and **Unlock** methods.</span></span> <span data-ttu-id="9b895-128">Se você criar sua classe usando ATL, poderá usar as implementações padrão da ATL.</span><span class="sxs-lookup"><span data-stu-id="9b895-128">If you create your class using ATL, you can use the default ATL implementations.</span></span>

<span data-ttu-id="9b895-129">**Declarando a classe derivada**</span><span class="sxs-lookup"><span data-stu-id="9b895-129">**Declaring the Derived Class**</span></span>

<span data-ttu-id="9b895-130">O modelo de classe **IMediaObjectImpl** é declarado da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="9b895-130">The **IMediaObjectImpl** class template is declared as follows:</span></span>


```C++
template <class _DERIVED_, int NUMBEROFINPUTS, int NUMBEROFOUTPUTS>
class IMediaObjectImpl : public ImediaObject
```



<span data-ttu-id="9b895-131">Os três parâmetros de modelo são \_ derivados \_ , NUMBEROFINPUTS e NUMBEROFOUTPUTS.</span><span class="sxs-lookup"><span data-stu-id="9b895-131">The three template parameters are \_DERIVED\_, NUMBEROFINPUTS, and NUMBEROFOUTPUTS.</span></span> <span data-ttu-id="9b895-132">Defina \_ derivado \_ igual ao nome da sua classe.</span><span class="sxs-lookup"><span data-stu-id="9b895-132">Set \_DERIVED\_ equal to the name of your class.</span></span> <span data-ttu-id="9b895-133">Os outros dois parâmetros definem o número de fluxos de entrada e fluxos de saída no DMO.</span><span class="sxs-lookup"><span data-stu-id="9b895-133">The other two parameters define the number of input streams and output streams on the DMO.</span></span> <span data-ttu-id="9b895-134">Por exemplo, para criar uma classe DMO chamada CMyDmo que dá suporte a um fluxo de entrada e dois fluxos de saída, use a seguinte declaração:</span><span class="sxs-lookup"><span data-stu-id="9b895-134">For example, to create a DMO class named CMyDmo that supports one input stream and two output streams, use the following declaration:</span></span>


```C++
class CMyDmo : public IMediaObjectImpl<CMyDmo, 1, 2>
```



<span data-ttu-id="9b895-135">O restante desta seção descreve como o modelo implementa os vários métodos no **IMediaObject**.</span><span class="sxs-lookup"><span data-stu-id="9b895-135">The remainder of this section describes how the template implements the various methods in **IMediaObject**.</span></span>

<span data-ttu-id="9b895-136">**Métodos para definir tipos de mídia**</span><span class="sxs-lookup"><span data-stu-id="9b895-136">**Methods for Setting Media Types**</span></span>

<span data-ttu-id="9b895-137">Os métodos a seguir definem ou recuperam os tipos de mídia no DMO:</span><span class="sxs-lookup"><span data-stu-id="9b895-137">The following methods set or retrieve media types on the DMO:</span></span>

-   <span data-ttu-id="9b895-138">**Getparâmetrosdeentrada**, **GetOutputType**.</span><span class="sxs-lookup"><span data-stu-id="9b895-138">**GetInputType**, **GetOutputType**.</span></span> <span data-ttu-id="9b895-139">Esses métodos retornam tipos de mídia preferenciais, por número de fluxo e índice de tipo.</span><span class="sxs-lookup"><span data-stu-id="9b895-139">These methods return preferred media types, by stream number and type index.</span></span> <span data-ttu-id="9b895-140">O modelo chama **InternalGetInputType** ou **InternalGetOutputType** na classe derivada.</span><span class="sxs-lookup"><span data-stu-id="9b895-140">The template calls **InternalGetInputType** or **InternalGetOutputType** on the derived class.</span></span>
-   <span data-ttu-id="9b895-141">**Setparâmetrosdeentrada**, **SetOutputType**.</span><span class="sxs-lookup"><span data-stu-id="9b895-141">**SetInputType**, **SetOutputType**.</span></span> <span data-ttu-id="9b895-142">Esses métodos definem o tipo de mídia em um fluxo, testam um tipo de mídia ou desmarcam um tipo de mídia.</span><span class="sxs-lookup"><span data-stu-id="9b895-142">These methods set the media type on a stream, test a media type, or clear a media type.</span></span> <span data-ttu-id="9b895-143">Para validar o tipo de mídia, o modelo chama **InternalCheckInputType** ou **InternalCheckOutputType** na classe derivada.</span><span class="sxs-lookup"><span data-stu-id="9b895-143">To validate the media type, the template calls **InternalCheckInputType** or **InternalCheckOutputType** on the derived class.</span></span> <span data-ttu-id="9b895-144">A classe derivada retorna S \_ OK para aceitar o tipo ou DMO \_ E \_ invalidatype para rejeitar o tipo.</span><span class="sxs-lookup"><span data-stu-id="9b895-144">The derived class returns S\_OK to accept the type or DMO\_E\_INVALIDTYPE to reject the type.</span></span> <span data-ttu-id="9b895-145">O modelo manipula a configuração ou a limpeza do tipo de mídia.</span><span class="sxs-lookup"><span data-stu-id="9b895-145">The template handles setting or clearing the media type.</span></span>
-   <span data-ttu-id="9b895-146">**GetInputCurrentType**, **GetOutputCurrentType**.</span><span class="sxs-lookup"><span data-stu-id="9b895-146">**GetInputCurrentType**, **GetOutputCurrentType**.</span></span> <span data-ttu-id="9b895-147">Esses métodos retornam o tipo de mídia atual para um fluxo, ou DMO \_ e \_ tipo \_ não \_ definido se nenhum tipo for definido.</span><span class="sxs-lookup"><span data-stu-id="9b895-147">These methods return the current media type for a stream, or DMO\_E\_TYPE\_NOT\_SET if no type is set.</span></span> <span data-ttu-id="9b895-148">O modelo implementa completamente esses métodos.</span><span class="sxs-lookup"><span data-stu-id="9b895-148">The template completely implements these methods.</span></span>

<span data-ttu-id="9b895-149">**Métodos informativos**</span><span class="sxs-lookup"><span data-stu-id="9b895-149">**Informational Methods**</span></span>

<span data-ttu-id="9b895-150">Os métodos a seguir fornecem informações sobre o DMO.</span><span class="sxs-lookup"><span data-stu-id="9b895-150">The following methods provide information about the DMO.</span></span>

-   <span data-ttu-id="9b895-151">**GetInputMaxLatency**, **SetInputMaxLatency**.</span><span class="sxs-lookup"><span data-stu-id="9b895-151">**GetInputMaxLatency**, **SetInputMaxLatency**.</span></span> <span data-ttu-id="9b895-152">Esses métodos recuperam ou definem a latência máxima.</span><span class="sxs-lookup"><span data-stu-id="9b895-152">These methods retrieve or set the maximum latency.</span></span> <span data-ttu-id="9b895-153">O modelo chama **InternalGetInputMaxLatency** ou **InternalSetInputMaxLatency** na classe derivada.</span><span class="sxs-lookup"><span data-stu-id="9b895-153">The template calls **InternalGetInputMaxLatency** or **InternalSetInputMaxLatency** on the derived class.</span></span>
-   <span data-ttu-id="9b895-154">**GetInputSizeInfo**, **GetOutputSizeInfo**.</span><span class="sxs-lookup"><span data-stu-id="9b895-154">**GetInputSizeInfo**, **GetOutputSizeInfo**.</span></span> <span data-ttu-id="9b895-155">Esses métodos retornam os requisitos de buffer de DMO para um fluxo especificado.</span><span class="sxs-lookup"><span data-stu-id="9b895-155">These methods return the DMO's buffer requirements for a specified stream.</span></span> <span data-ttu-id="9b895-156">Se nenhum tipo de mídia tiver sido definido nesse fluxo, o modelo retornará o \_ tipo DMO E \_ \_ não \_ definido.</span><span class="sxs-lookup"><span data-stu-id="9b895-156">If no media type has been set on that stream, the template returns DMO\_E\_TYPE\_NOT\_SET.</span></span> <span data-ttu-id="9b895-157">Caso contrário, ele chama **InternalGetInputSizeInfo** ou **InternalGetOutputSizeInfo** na classe derivada.</span><span class="sxs-lookup"><span data-stu-id="9b895-157">Otherwise, it calls **InternalGetInputSizeInfo** or **InternalGetOutputSizeInfo** on the derived class.</span></span>
-   <span data-ttu-id="9b895-158">**GetInputStreamInfo**, **GetOutputStreamInfo**.</span><span class="sxs-lookup"><span data-stu-id="9b895-158">**GetInputStreamInfo**, **GetOutputStreamInfo**.</span></span> <span data-ttu-id="9b895-159">Esses métodos retornam vários sinalizadores que indicam como o cliente deve formatar os dados.</span><span class="sxs-lookup"><span data-stu-id="9b895-159">These methods return various flags that indicate how the client should format the data.</span></span> <span data-ttu-id="9b895-160">O modelo chama **InternalGetInputStreamInfo** ou **InternalGetOutputStreamInfo** na classe derivada.</span><span class="sxs-lookup"><span data-stu-id="9b895-160">The template calls **InternalGetInputStreamInfo** or **InternalGetOutputStreamInfo** on the derived class.</span></span>
-   <span data-ttu-id="9b895-161">**GetStreamCount**.</span><span class="sxs-lookup"><span data-stu-id="9b895-161">**GetStreamCount**.</span></span> <span data-ttu-id="9b895-162">Esse método retorna o número de fluxos de entrada e saída.</span><span class="sxs-lookup"><span data-stu-id="9b895-162">This method returns the number of input and output streams.</span></span> <span data-ttu-id="9b895-163">O modelo implementa esse método, usando os parâmetros de modelo.</span><span class="sxs-lookup"><span data-stu-id="9b895-163">The template implements this method, using the template parameters.</span></span>

<span data-ttu-id="9b895-164">**Métodos para alocação de recursos**</span><span class="sxs-lookup"><span data-stu-id="9b895-164">**Methods for Resource Allocation**</span></span>

-   <span data-ttu-id="9b895-165">O método **AllocateStreamingResources** aloca todos os recursos que o DMO precisa antes que o streaming comece.</span><span class="sxs-lookup"><span data-stu-id="9b895-165">The **AllocateStreamingResources** method allocates any resources the DMO needs before streaming begins.</span></span> <span data-ttu-id="9b895-166">O método **FreeStreamingResources** libera os mesmos recursos.</span><span class="sxs-lookup"><span data-stu-id="9b895-166">The **FreeStreamingResources** method releases the same resources.</span></span> <span data-ttu-id="9b895-167">O modelo chama **InternalAllocateStreamingResources** e **InternalFreeStreamingResources**, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="9b895-167">The template calls **InternalAllocateStreamingResources** and **InternalFreeStreamingResources**, respectively.</span></span>

<span data-ttu-id="9b895-168">O cliente do DMO não é necessário para chamar esses métodos, mas o modelo chama **AllocateStreamingResources** automaticamente antes de iniciar o streaming.</span><span class="sxs-lookup"><span data-stu-id="9b895-168">The client of the DMO is not required to call these methods, but the template automatically calls **AllocateStreamingResources** before streaming starts.</span></span> <span data-ttu-id="9b895-169">Portanto, o DMO pode assumir que os recursos foram alocados corretamente pela hora em que o **ProcessInput** é chamado.</span><span class="sxs-lookup"><span data-stu-id="9b895-169">Therefore, the DMO can assume that resources are have been allocated correctly by the time **ProcessInput** is called.</span></span> <span data-ttu-id="9b895-170">O DMO deve chamar **FreeStreamingResources** em seu destruidor.</span><span class="sxs-lookup"><span data-stu-id="9b895-170">The DMO should call **FreeStreamingResources** in its destructor.</span></span>

<span data-ttu-id="9b895-171">Além disso, quando o modelo chama **InternalAllocateStreamingResources**, ele define um sinalizador interno, para que ele não chame esse método novamente até chamar **InternalFreeStreamingResources**.</span><span class="sxs-lookup"><span data-stu-id="9b895-171">Also, when the template calls **InternalAllocateStreamingResources**, it sets an internal flag, so that it does not call that method again until calling **InternalFreeStreamingResources**.</span></span> <span data-ttu-id="9b895-172">Isso garante que os recursos não sejam novamente alocados acidentalmente, o que pode causar vazamentos de memória.</span><span class="sxs-lookup"><span data-stu-id="9b895-172">This ensures that resources are not re-allocated accidentally, which could cause memory leaks.</span></span>

<span data-ttu-id="9b895-173">**Métodos para streaming**</span><span class="sxs-lookup"><span data-stu-id="9b895-173">**Methods for Streaming**</span></span>

<span data-ttu-id="9b895-174">Os métodos a seguir são usados para transmitir dados:</span><span class="sxs-lookup"><span data-stu-id="9b895-174">The following methods are used to stream data:</span></span>

-   <span data-ttu-id="9b895-175">**GetInputStatus**.</span><span class="sxs-lookup"><span data-stu-id="9b895-175">**GetInputStatus**.</span></span> <span data-ttu-id="9b895-176">Esse método indica se o DMO pode aceitar entrada no momento.</span><span class="sxs-lookup"><span data-stu-id="9b895-176">This method indicates whether the DMO can accept input at this time.</span></span> <span data-ttu-id="9b895-177">O modelo chama **InternalAcceptingInput** na classe derivada.</span><span class="sxs-lookup"><span data-stu-id="9b895-177">The template calls **InternalAcceptingInput** on the derived class.</span></span> <span data-ttu-id="9b895-178">Se o DMO puder aceitar a entrada, a classe derivada retornará S \_ OK e o modelo definirá o \_ bit de entrada \_ STATUSF Accept de \_ \_ dados no parâmetro *dwFlags* .</span><span class="sxs-lookup"><span data-stu-id="9b895-178">If the DMO can accept input, the derived class returns S\_OK and the template sets the DMO\_INPUT\_STATUSF\_ACCEPT\_DATA bit in the *dwFlags* parameter.</span></span> <span data-ttu-id="9b895-179">Caso contrário, a classe derivada retornará S \_ false e o modelo definirá *dwFlags* como zero.</span><span class="sxs-lookup"><span data-stu-id="9b895-179">Otherwise, the derived class returns S\_FALSE and the template sets *dwFlags* to zero.</span></span>
-   <span data-ttu-id="9b895-180">**ProcessInput**.</span><span class="sxs-lookup"><span data-stu-id="9b895-180">**ProcessInput**.</span></span> <span data-ttu-id="9b895-181">Esse método processa um buffer de entrada.</span><span class="sxs-lookup"><span data-stu-id="9b895-181">This method processes an input buffer.</span></span> <span data-ttu-id="9b895-182">O modelo chama **AllocateStreamingResources**, descrito anteriormente.</span><span class="sxs-lookup"><span data-stu-id="9b895-182">The template calls **AllocateStreamingResources**, described previously.</span></span> <span data-ttu-id="9b895-183">Em seguida, ele chama **InternalAcceptingInput** na classe derivada.</span><span class="sxs-lookup"><span data-stu-id="9b895-183">Then it calls **InternalAcceptingInput** on the derived class.</span></span> <span data-ttu-id="9b895-184">Se o DMO puder aceitar nova entrada, o modelo chamará **InternalProcessInput**.</span><span class="sxs-lookup"><span data-stu-id="9b895-184">If the DMO can accept new input, the template calls **InternalProcessInput**.</span></span>
-   <span data-ttu-id="9b895-185">**ProcessOutput**.</span><span class="sxs-lookup"><span data-stu-id="9b895-185">**ProcessOutput**.</span></span> <span data-ttu-id="9b895-186">Esse método processa um conjunto de buffers de saída, um buffer para cada fluxo de saída.</span><span class="sxs-lookup"><span data-stu-id="9b895-186">This method processes a set of output buffers, one buffer for each output stream.</span></span> <span data-ttu-id="9b895-187">O modelo chama **AllocateStreamingResources** e, em seguida, **InternalProcessOutput**.</span><span class="sxs-lookup"><span data-stu-id="9b895-187">The template calls **AllocateStreamingResources** and then **InternalProcessOutput**.</span></span>
-   <span data-ttu-id="9b895-188">**Descontinuidade**.</span><span class="sxs-lookup"><span data-stu-id="9b895-188">**Discontinuity**.</span></span> <span data-ttu-id="9b895-189">Esse método sinaliza uma descontinuidade em um fluxo de entrada.</span><span class="sxs-lookup"><span data-stu-id="9b895-189">This method signals a discontinuity in an input stream.</span></span> <span data-ttu-id="9b895-190">O modelo chama **InternalAcceptingInput** na classe derivada.</span><span class="sxs-lookup"><span data-stu-id="9b895-190">The template calls **InternalAcceptingInput** on the derived class.</span></span> <span data-ttu-id="9b895-191">Se esse método retornar S \_ OK, o modelo chamará **InternalDiscontinuity** na classe derivada.</span><span class="sxs-lookup"><span data-stu-id="9b895-191">If that method returns S\_OK, the template calls **InternalDiscontinuity** on the derived class.</span></span>
-   <span data-ttu-id="9b895-192">**Liberar**.</span><span class="sxs-lookup"><span data-stu-id="9b895-192">**Flush**.</span></span> <span data-ttu-id="9b895-193">Esse método libera o DMO.</span><span class="sxs-lookup"><span data-stu-id="9b895-193">This method flushes the DMO.</span></span> <span data-ttu-id="9b895-194">O modelo chama **InternalFlush** na classe derivada.</span><span class="sxs-lookup"><span data-stu-id="9b895-194">The template calls **InternalFlush** on the derived class.</span></span> <span data-ttu-id="9b895-195">O DMO deve descartar os buffers de entrada que ele ainda mantém para ser processado.</span><span class="sxs-lookup"><span data-stu-id="9b895-195">The DMO should discard any input buffers that it still holds to be processed.</span></span>

<span data-ttu-id="9b895-196">O modelo não fornece nenhum suporte direto para a interface [**IMediaObjectInPlace**](/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediaobjectinplace) .</span><span class="sxs-lookup"><span data-stu-id="9b895-196">The template does not provide any direct support for the [**IMediaObjectInPlace**](/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediaobjectinplace) interface.</span></span>

<span data-ttu-id="9b895-197">**Métodos para bloqueio**</span><span class="sxs-lookup"><span data-stu-id="9b895-197">**Methods for Locking**</span></span>

<span data-ttu-id="9b895-198">O bloqueio é usado para proteger o estado de DMO em um ambiente multi-threaded.</span><span class="sxs-lookup"><span data-stu-id="9b895-198">Locking is used to protect the DMO's state in a multithreaded environment.</span></span> <span data-ttu-id="9b895-199">Em um projeto ATL, o método [**IMediaObject:: Lock**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-lock) causa um conflito de nome com o método de **bloqueio** ATL.</span><span class="sxs-lookup"><span data-stu-id="9b895-199">In an ATL project, the [**IMediaObject::Lock**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-lock) method causes a name conflict with the ATL **Lock** method.</span></span> <span data-ttu-id="9b895-200">Para resolver o conflito, o modelo renomeia o método **IMediaObject** para **DMOLock**.</span><span class="sxs-lookup"><span data-stu-id="9b895-200">To resolve the conflict, the template renames the **IMediaObject** method to **DMOLock**.</span></span> <span data-ttu-id="9b895-201">Ao compilar a classe derivada, defina corrigir \_ nome do bloqueio \_ antes de incluir o arquivo de cabeçalho DMO. h:</span><span class="sxs-lookup"><span data-stu-id="9b895-201">When you compile the derived class, define FIX\_LOCK\_NAME before including the header file Dmo.h:</span></span>


```C++
#define FIX_LOCK_NAME
#include <dmo.h>
```



<span data-ttu-id="9b895-202">Essa diretiva faz com que o pré-processador substitua **DMOLock** por **bloqueio** na declaração da interface **IMediaObject** .</span><span class="sxs-lookup"><span data-stu-id="9b895-202">This directive causes the preprocessor to substitute **DMOLock** for **Lock** in the declaration of the **IMediaObject** interface.</span></span> <span data-ttu-id="9b895-203">Os aplicativos ainda podem invocar o método usando o nome **Lock**, pois a ordem vtable não é alterada.</span><span class="sxs-lookup"><span data-stu-id="9b895-203">Applications can still invoke the method using the name **Lock**, because the vtable order does not change.</span></span> <span data-ttu-id="9b895-204">O método **DMOLock** chama **Lock** ou **Unlock** na classe derivada.</span><span class="sxs-lookup"><span data-stu-id="9b895-204">The **DMOLock** method calls **Lock** or **Unlock** on the derived class.</span></span> <span data-ttu-id="9b895-205">Se você estiver usando a ATL para implementar a classe derivada, esses métodos já serão definidos pela ATL, portanto, nenhum código adicional será necessário.</span><span class="sxs-lookup"><span data-stu-id="9b895-205">If you are using ATL to implement the derived class, these methods are already defined by ATL, so no additional code is necessary.</span></span> <span data-ttu-id="9b895-206">Se você não estiver usando a ATL, deverá fornecer os métodos **Lock** e **Unlock** em sua classe derivada.</span><span class="sxs-lookup"><span data-stu-id="9b895-206">If you are not using ATL, you must provide **Lock** and **Unlock** methods in your derived class.</span></span>

<span data-ttu-id="9b895-207">O modelo bloqueia automaticamente o DMO em cada um dos métodos **IMediaObject** .</span><span class="sxs-lookup"><span data-stu-id="9b895-207">The template automatically locks the DMO in each of the **IMediaObject** methods.</span></span> <span data-ttu-id="9b895-208">A classe derivada pode precisar bloquear o DMO dentro de outros métodos públicos que ele implementa (por exemplo, se ele dá suporte a **IMediaObjectInPlace**).</span><span class="sxs-lookup"><span data-stu-id="9b895-208">The derived class might need to lock the DMO inside other public methods that it implements (for example, if it supports **IMediaObjectInPlace**).</span></span> <span data-ttu-id="9b895-209">O modelo de classe também fornece uma classe auxiliar interna, [**IMediaObjectImpl:: Lockit**](imediaobjectimpl-lockit.md), que é útil para bloquear e desbloquear o DMO.</span><span class="sxs-lookup"><span data-stu-id="9b895-209">The class template also provides an internal helper class, [**IMediaObjectImpl::LockIt**](imediaobjectimpl-lockit.md), which is useful for locking and unlocking the DMO.</span></span>

<span data-ttu-id="9b895-210">**Resumo**</span><span class="sxs-lookup"><span data-stu-id="9b895-210">**Summary**</span></span>

<span data-ttu-id="9b895-211">Para os seguintes métodos **IMediaObject** , o modelo chama um método correspondente com a mesma assinatura na classe derivada.</span><span class="sxs-lookup"><span data-stu-id="9b895-211">For the following **IMediaObject** methods, the template calls a corresponding method with the same signature on the derived class.</span></span> <span data-ttu-id="9b895-212">A classe derivada deve implementar cada um dos métodos mostrados na segunda coluna.</span><span class="sxs-lookup"><span data-stu-id="9b895-212">The derived class must implement each of the methods shown in the second column.</span></span>



| <span data-ttu-id="9b895-213">Método IMediaObject</span><span class="sxs-lookup"><span data-stu-id="9b895-213">IMediaObject Method</span></span>            | <span data-ttu-id="9b895-214">Método de classe derivada</span><span class="sxs-lookup"><span data-stu-id="9b895-214">Derived Class Method</span></span>                   |
|--------------------------------|----------------------------------------|
| <span data-ttu-id="9b895-215">**AllocateStreamingResources**</span><span class="sxs-lookup"><span data-stu-id="9b895-215">**AllocateStreamingResources**</span></span> | <span data-ttu-id="9b895-216">**InternalAllocateStreamingResources**</span><span class="sxs-lookup"><span data-stu-id="9b895-216">**InternalAllocateStreamingResources**</span></span> |
| <span data-ttu-id="9b895-217">**Descontinuidade**</span><span class="sxs-lookup"><span data-stu-id="9b895-217">**Discontinuity**</span></span>              | <span data-ttu-id="9b895-218">**InternalDiscontinuity**</span><span class="sxs-lookup"><span data-stu-id="9b895-218">**InternalDiscontinuity**</span></span>              |
| <span data-ttu-id="9b895-219">**Liberar**</span><span class="sxs-lookup"><span data-stu-id="9b895-219">**Flush**</span></span>                      | <span data-ttu-id="9b895-220">**InternalFlush**</span><span class="sxs-lookup"><span data-stu-id="9b895-220">**InternalFlush**</span></span>                      |
| <span data-ttu-id="9b895-221">**FreeStreamingResources**</span><span class="sxs-lookup"><span data-stu-id="9b895-221">**FreeStreamingResources**</span></span>     | <span data-ttu-id="9b895-222">**InternalFreeStreamingResources**</span><span class="sxs-lookup"><span data-stu-id="9b895-222">**InternalFreeStreamingResources**</span></span>     |
| <span data-ttu-id="9b895-223">**GetInputMaxLatency**</span><span class="sxs-lookup"><span data-stu-id="9b895-223">**GetInputMaxLatency**</span></span>         | <span data-ttu-id="9b895-224">**InternalGetInputMaxLatency**</span><span class="sxs-lookup"><span data-stu-id="9b895-224">**InternalGetInputMaxLatency**</span></span>         |
| <span data-ttu-id="9b895-225">**GetInputSizeInfo**</span><span class="sxs-lookup"><span data-stu-id="9b895-225">**GetInputSizeInfo**</span></span>           | <span data-ttu-id="9b895-226">**InternalGetInputSizeInfo**</span><span class="sxs-lookup"><span data-stu-id="9b895-226">**InternalGetInputSizeInfo**</span></span>           |
| <span data-ttu-id="9b895-227">**GetInputStreamInfo**</span><span class="sxs-lookup"><span data-stu-id="9b895-227">**GetInputStreamInfo**</span></span>         | <span data-ttu-id="9b895-228">**InternalGetInputStreamInfo**</span><span class="sxs-lookup"><span data-stu-id="9b895-228">**InternalGetInputStreamInfo**</span></span>         |
| <span data-ttu-id="9b895-229">**GetInputType**</span><span class="sxs-lookup"><span data-stu-id="9b895-229">**GetInputType**</span></span>               | <span data-ttu-id="9b895-230">**InternalGetInputType**</span><span class="sxs-lookup"><span data-stu-id="9b895-230">**InternalGetInputType**</span></span>               |
| <span data-ttu-id="9b895-231">**GetOutputSizeInfo**</span><span class="sxs-lookup"><span data-stu-id="9b895-231">**GetOutputSizeInfo**</span></span>          | <span data-ttu-id="9b895-232">**InternalGetOutputSizeInfo**</span><span class="sxs-lookup"><span data-stu-id="9b895-232">**InternalGetOutputSizeInfo**</span></span>          |
| <span data-ttu-id="9b895-233">**GetOutputStreamInfo**</span><span class="sxs-lookup"><span data-stu-id="9b895-233">**GetOutputStreamInfo**</span></span>        | <span data-ttu-id="9b895-234">**InternalGetOutputStreamInfo**</span><span class="sxs-lookup"><span data-stu-id="9b895-234">**InternalGetOutputStreamInfo**</span></span>        |
| <span data-ttu-id="9b895-235">**GetOutputType**</span><span class="sxs-lookup"><span data-stu-id="9b895-235">**GetOutputType**</span></span>              | <span data-ttu-id="9b895-236">**InternalGetOutputType**</span><span class="sxs-lookup"><span data-stu-id="9b895-236">**InternalGetOutputType**</span></span>              |
| <span data-ttu-id="9b895-237">**ProcessInput**</span><span class="sxs-lookup"><span data-stu-id="9b895-237">**ProcessInput**</span></span>               | <span data-ttu-id="9b895-238">**InternalProcessInput**</span><span class="sxs-lookup"><span data-stu-id="9b895-238">**InternalProcessInput**</span></span>               |
| <span data-ttu-id="9b895-239">**ProcessOutput**</span><span class="sxs-lookup"><span data-stu-id="9b895-239">**ProcessOutput**</span></span>              | <span data-ttu-id="9b895-240">**InternalProcessOutput**</span><span class="sxs-lookup"><span data-stu-id="9b895-240">**InternalProcessOutput**</span></span>              |
| <span data-ttu-id="9b895-241">**SetInputMaxLatency**</span><span class="sxs-lookup"><span data-stu-id="9b895-241">**SetInputMaxLatency**</span></span>         | <span data-ttu-id="9b895-242">**InternalSetInputMaxLatency**</span><span class="sxs-lookup"><span data-stu-id="9b895-242">**InternalSetInputMaxLatency**</span></span>         |



 

<span data-ttu-id="9b895-243">Para os demais métodos **IMediaObject** , não há uma correspondência um-para-um entre métodos de modelo e métodos de classe derivada.</span><span class="sxs-lookup"><span data-stu-id="9b895-243">For the remaining **IMediaObject** methods, there is not a one-to-one correspondence between template methods and derived-class methods.</span></span> <span data-ttu-id="9b895-244">A tabela a seguir resume quais métodos são totalmente implementados pelo modelo e quais métodos chamam outros métodos na classe derivada.</span><span class="sxs-lookup"><span data-stu-id="9b895-244">The following table summarizes which methods are fully implemented by the template, and which methods call other methods on the derived class.</span></span>



| <span data-ttu-id="9b895-245">Método IMediaObject</span><span class="sxs-lookup"><span data-stu-id="9b895-245">IMediaObject Method</span></span>                   | <span data-ttu-id="9b895-246">Método de classe derivada</span><span class="sxs-lookup"><span data-stu-id="9b895-246">Derived Class Method</span></span>                                                             |
|---------------------------------------|----------------------------------------------------------------------------------|
| <span data-ttu-id="9b895-247">**GetInputCurrentType**</span><span class="sxs-lookup"><span data-stu-id="9b895-247">**GetInputCurrentType**</span></span>               | <span data-ttu-id="9b895-248">Totalmente implementado</span><span class="sxs-lookup"><span data-stu-id="9b895-248">Fully implemented</span></span>                                                                |
| <span data-ttu-id="9b895-249">**GetOutputCurrentType**</span><span class="sxs-lookup"><span data-stu-id="9b895-249">**GetOutputCurrentType**</span></span>              | <span data-ttu-id="9b895-250">Totalmente implementado</span><span class="sxs-lookup"><span data-stu-id="9b895-250">Fully implemented</span></span>                                                                |
| <span data-ttu-id="9b895-251">**GetStreamCount**</span><span class="sxs-lookup"><span data-stu-id="9b895-251">**GetStreamCount**</span></span>                    | <span data-ttu-id="9b895-252">Totalmente implementado</span><span class="sxs-lookup"><span data-stu-id="9b895-252">Fully implemented</span></span>                                                                |
| <span data-ttu-id="9b895-253">**GetInputStatus**</span><span class="sxs-lookup"><span data-stu-id="9b895-253">**GetInputStatus**</span></span>                    | <span data-ttu-id="9b895-254">[**InternalAcceptingInput**](/previous-versions/ms809095(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="9b895-254">[**InternalAcceptingInput**](/previous-versions/ms809095(v=msdn.10))</span></span>        |
| <span data-ttu-id="9b895-255">**Bloqueio** (implementado como **DMOLock**)</span><span class="sxs-lookup"><span data-stu-id="9b895-255">**Lock** (implemented as **DMOLock**)</span></span> | <span data-ttu-id="9b895-256">[**Bloquear**](/previous-versions/ms809100(v=msdn.10)), [ **desbloquear**](/previous-versions/ms809101(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="9b895-256">[**Lock**](/previous-versions/ms809100(v=msdn.10)), [**Unlock**](/previous-versions/ms809101(v=msdn.10))</span></span> |
| <span data-ttu-id="9b895-257">**SetInputType**</span><span class="sxs-lookup"><span data-stu-id="9b895-257">**SetInputType**</span></span>                      | <span data-ttu-id="9b895-258">[**InternalCheckInputType**](/previous-versions/ms809096(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="9b895-258">[**InternalCheckInputType**](/previous-versions/ms809096(v=msdn.10))</span></span>        |
| <span data-ttu-id="9b895-259">**Setoutputtypetype**</span><span class="sxs-lookup"><span data-stu-id="9b895-259">**SetOutputType**</span></span>                     | <span data-ttu-id="9b895-260">[**InternalCheckOutputType**](/previous-versions/ms809098(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="9b895-260">[**InternalCheckOutputType**](/previous-versions/ms809098(v=msdn.10))</span></span>      |



 

## <a name="related-topics"></a><span data-ttu-id="9b895-261">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="9b895-261">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="9b895-262">**Modelo de classe IMediaObjectImpl**</span><span class="sxs-lookup"><span data-stu-id="9b895-262">**IMediaObjectImpl Class Template**</span></span>](imediaobjectimpl-class-template.md)
</dt> <dt>

[<span data-ttu-id="9b895-263">Escrevendo um DMO</span><span class="sxs-lookup"><span data-stu-id="9b895-263">Writing a DMO</span></span>](writing-a-dmo.md)
</dt> </dl>

 

 
