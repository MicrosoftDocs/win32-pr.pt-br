---
description: QueryAccept (downstream)
ms.assetid: 3ca30f62-c320-40ea-9bf5-022abad912c4
title: QueryAccept (downstream)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9015e0a246abb9fb996c0771e4bc935cccda054d
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/06/2021
ms.locfileid: "104568707"
---
# <a name="queryaccept-downstream"></a><span data-ttu-id="abcf6-103">QueryAccept (downstream)</span><span class="sxs-lookup"><span data-stu-id="abcf6-103">QueryAccept (Downstream)</span></span>

<span data-ttu-id="abcf6-104">Esse mecanismo permite que um pino de saída proponha um novo formato a seu par downstream.</span><span class="sxs-lookup"><span data-stu-id="abcf6-104">This mechanism enables an output pin to propose a new format to its downstream peer.</span></span> <span data-ttu-id="abcf6-105">O novo formato não deve exigir um tamanho de buffer maior.</span><span class="sxs-lookup"><span data-stu-id="abcf6-105">The new format must not require a larger buffer size.</span></span> <span data-ttu-id="abcf6-106">O pino de saída faz o seguinte:</span><span class="sxs-lookup"><span data-stu-id="abcf6-106">The output pin does the following:</span></span>

1.  <span data-ttu-id="abcf6-107">Chama [**IPin:: QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) ou [**IPinConnection::D ynamicqueryaccept**](/windows/desktop/api/Strmif/nf-strmif-ipinconnection-dynamicqueryaccept) no pino downstream, para verificar se o outro PIN pode aceitar o novo tipo de mídia (veja A ilustração, etapa A).</span><span class="sxs-lookup"><span data-stu-id="abcf6-107">Calls [**IPin::QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) or [**IPinConnection::DynamicQueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipinconnection-dynamicqueryaccept) on the downstream pin, to verify whether the other pin can accept the new media type (see illustration, step A).</span></span>
2.  <span data-ttu-id="abcf6-108">Se o valor de retorno da etapa 1 for S \_ OK, o PIN anexará o tipo de mídia ao próximo exemplo.</span><span class="sxs-lookup"><span data-stu-id="abcf6-108">If the return value from step 1 is S\_OK, the pin attaches the media type to the next sample.</span></span> <span data-ttu-id="abcf6-109">Para fazer isso, primeiro ele chama [**IMemAllocator:: GetBuffer**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-getbuffer) para obter o exemplo (B).</span><span class="sxs-lookup"><span data-stu-id="abcf6-109">To do this, first it calls [**IMemAllocator::GetBuffer**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-getbuffer) to obtain the sample (B).</span></span> <span data-ttu-id="abcf6-110">Em seguida, ele chama [**IMediaSample:: SetMediaType**](/windows/desktop/api/Strmif/nf-strmif-imediasample-setmediatype) para anexar o tipo de mídia a esse exemplo (C).</span><span class="sxs-lookup"><span data-stu-id="abcf6-110">Then it calls [**IMediaSample::SetMediaType**](/windows/desktop/api/Strmif/nf-strmif-imediasample-setmediatype) to attach the media type to that sample (C).</span></span> <span data-ttu-id="abcf6-111">Ao anexar o tipo de mídia ao exemplo, o filtro indica que o formato foi alterado, começando com esse exemplo.</span><span class="sxs-lookup"><span data-stu-id="abcf6-111">By attaching the media type to the sample, the filter indicates that the format has changed, starting with that sample.</span></span>
3.  <span data-ttu-id="abcf6-112">O PIN entrega o exemplo (D).</span><span class="sxs-lookup"><span data-stu-id="abcf6-112">The pin delivers the sample (D).</span></span>
4.  <span data-ttu-id="abcf6-113">Quando o filtro downstream recebe o exemplo, ele chama [**IMediaSample:: GetMediaType**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getmediatype) para recuperar o novo tipo de mídia.</span><span class="sxs-lookup"><span data-stu-id="abcf6-113">When the downstream filter receives the sample, it calls [**IMediaSample::GetMediaType**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getmediatype) to retrieve the new media type.</span></span>

    ![QueryAccept (downstream)](images/dynformat3.png)

<span data-ttu-id="abcf6-115">Todos os Pins dão suporte ao `QueryAccept` método.</span><span class="sxs-lookup"><span data-stu-id="abcf6-115">All pins support the `QueryAccept` method.</span></span> <span data-ttu-id="abcf6-116">No entanto, esse método é um pouco ambíguo, pois um valor de retorno de S \_ OK nem sempre garante que você possa alterar o formato enquanto o grafo estiver ativo.</span><span class="sxs-lookup"><span data-stu-id="abcf6-116">However, this method is slightly ambiguous, because a return value of S\_OK does not always guarantee that you can change the format while the graph is active.</span></span> <span data-ttu-id="abcf6-117">Alguns filtros podem retornar S \_ OK, mas rejeitar a alteração se o grafo estiver ativo.</span><span class="sxs-lookup"><span data-stu-id="abcf6-117">Some filters might return S\_OK but reject the change if the graph is active.</span></span> <span data-ttu-id="abcf6-118">O método **DynamicQueryAccept** , que é suportado por alguns Pins de entrada, define explicitamente \_ os S OK para significar que o PIN pode alterar os formatos enquanto ativo.</span><span class="sxs-lookup"><span data-stu-id="abcf6-118">The **DynamicQueryAccept** method, which is supported by some input pins, explicitly defines S\_OK to mean the pin can change formats while active.</span></span> <span data-ttu-id="abcf6-119">Se um PIN de entrada der suporte à interface **IPinConnection** , você deverá chamar **DynamicQueryAccept** em vez de `QueryAccept` .</span><span class="sxs-lookup"><span data-stu-id="abcf6-119">If an input pin supports the **IPinConnection** interface, you should call **DynamicQueryAccept** rather than `QueryAccept`.</span></span>

<span data-ttu-id="abcf6-120">Na maioria dos casos, esse mecanismo não permite alterações drásticas no formato, como a alteração da profundidade de bits.</span><span class="sxs-lookup"><span data-stu-id="abcf6-120">In most cases, this mechanism does not allow for drastic changes to the format, such as changing the bit depth.</span></span> <span data-ttu-id="abcf6-121">Uma situação na qual ela pode ser usada é quando um decodificador de vídeo alterna as paletas.</span><span class="sxs-lookup"><span data-stu-id="abcf6-121">One situation in which it can be used is when a video decoder switches palettes.</span></span> <span data-ttu-id="abcf6-122">Os detalhes básicos do formato permanecem os mesmos, como as dimensões de imagem e a profundidade de bits, mas o novo tipo de mídia tem um conjunto diferente de entradas de paleta.</span><span class="sxs-lookup"><span data-stu-id="abcf6-122">The basic details of the format stay the same, such as the image dimensions and the bit depth, but the new media type has a different set of palette entries.</span></span>

<span data-ttu-id="abcf6-123">**Observação de implementação**</span><span class="sxs-lookup"><span data-stu-id="abcf6-123">**Implementation Note**</span></span>

<span data-ttu-id="abcf6-124">Nas classes base do DirectShow, [**CBasePin:: QueryAccept**](cbasepin-queryaccept.md) chama o método **CheckMediaType** , que também é chamado durante a conexão inicial do PIN.</span><span class="sxs-lookup"><span data-stu-id="abcf6-124">In the DirectShow base classes, [**CBasePin::QueryAccept**](cbasepin-queryaccept.md) calls the **CheckMediaType** method, which is also called during the initial pin connection.</span></span> <span data-ttu-id="abcf6-125">No caso de um filtro de transformação, o método **CheckMediaType** do pino de entrada deve sempre verificar se o pino de saída está conectado e, nesse caso, se o tipo de mídia de entrada é compatível com o tipo de mídia de saída.</span><span class="sxs-lookup"><span data-stu-id="abcf6-125">In the case of a transform filter, the input pin's **CheckMediaType** method should always check whether the output pin is connected, and if so, whether the input media type is compatible with the output media type.</span></span> <span data-ttu-id="abcf6-126">Portanto, essa implementação provavelmente será válida para o `QueryAccept` .</span><span class="sxs-lookup"><span data-stu-id="abcf6-126">Therefore, this implementation will likely be valid for `QueryAccept`.</span></span> <span data-ttu-id="abcf6-127">Caso contrário, você deve substituir `QueryAccept` para executar quaisquer verificações adicionais necessárias.</span><span class="sxs-lookup"><span data-stu-id="abcf6-127">If not, you should override `QueryAccept` in order to perform any additional checks that are needed.</span></span> <span data-ttu-id="abcf6-128">Além disso, observe que a classe [**CTransformFilter**](ctransformfilter.md) encapsula essa lógica nos métodos **CheckInputType** e **CheckTransform** .</span><span class="sxs-lookup"><span data-stu-id="abcf6-128">Also, note that the [**CTransformFilter**](ctransformfilter.md) class encapsulates this logic within the **CheckInputType** and **CheckTransform** methods.</span></span> <span data-ttu-id="abcf6-129">A classe [**CTransInPlaceFilter**](ctransinplacefilter.md) , por outro lado, sempre chama `QueryAccept` o próximo filtro upstream ou downstream.</span><span class="sxs-lookup"><span data-stu-id="abcf6-129">The [**CTransInPlaceFilter**](ctransinplacefilter.md) class, on the other hand, always calls `QueryAccept` on the next upstream or downstream filter.</span></span>

<span data-ttu-id="abcf6-130">O método [**CBaseInputPin:: Receive**](cbaseinputpin-receive.md) verifica um tipo de mídia no exemplo de entrada e, se houver um, chama **CheckMediaType**.</span><span class="sxs-lookup"><span data-stu-id="abcf6-130">The [**CBaseInputPin::Receive**](cbaseinputpin-receive.md) method checks for a media type on the incoming sample, and if there is one, calls **CheckMediaType**.</span></span> <span data-ttu-id="abcf6-131">No entanto, ele não atualiza o membro do **m \_ MT** do PIN, que mantém o tipo de mídia atual.</span><span class="sxs-lookup"><span data-stu-id="abcf6-131">However, it does not update the pin's **m\_mt** member, which holds the current media type.</span></span> <span data-ttu-id="abcf6-132">Quando o filtro processa o exemplo, você deve verificar o exemplo para um tipo de mídia.</span><span class="sxs-lookup"><span data-stu-id="abcf6-132">When your filter processes the sample, you should check the sample for a media type.</span></span> <span data-ttu-id="abcf6-133">Se houver um novo tipo, você provavelmente precisará armazená-lo, chamando **SetMediaType** no PIN ou definindo o valor de **m \_ MT** diretamente.</span><span class="sxs-lookup"><span data-stu-id="abcf6-133">If there is a new type, you will probably need to store it, either by calling **SetMediaType** on your pin or by setting the value of **m\_mt** directly.</span></span> <span data-ttu-id="abcf6-134">Por outro lado, a classe [**CVideoTransformFilter**](cvideotransformfilter.md) , que é projetada para filtros de transformação de vídeo, armazena o tipo de mídia quando ele é alterado.</span><span class="sxs-lookup"><span data-stu-id="abcf6-134">On the other hand, the [**CVideoTransformFilter**](cvideotransformfilter.md) class, which is designed for video transform filters, stores the media type when it changes.</span></span> <span data-ttu-id="abcf6-135">Para obter detalhes, consulte o código-fonte para [**CVideoTransformFilter:: Receive**](cvideotransformfilter-receive.md) na biblioteca de classes base do DirectShow.</span><span class="sxs-lookup"><span data-stu-id="abcf6-135">For details, see the source code for [**CVideoTransformFilter::Receive**](cvideotransformfilter-receive.md) in the DirectShow base class library.</span></span>

<span data-ttu-id="abcf6-136">Em alguns casos, você pode simplesmente passar o `QueryAccept` downstream de chamada e, em seguida, anexar o tipo de mídia ao exemplo de saída e deixar que o filtro downstream manipule a alteração do formato.</span><span class="sxs-lookup"><span data-stu-id="abcf6-136">In some cases, you might simply pass the `QueryAccept` call downstream, then attach the media type to the output sample and let the downstream filter handle the format change.</span></span>

 

 



