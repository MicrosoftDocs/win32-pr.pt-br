---
title: Considerações de armazenamento de propriedade
description: IPropertyStorage ReadMultiple lê quantas propriedades especificadas na matriz rgpspec como são encontradas no conjunto de propriedades.
ms.assetid: 7540966f-a3b2-46c9-9e04-b15133a517eb
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2aad6aabf8b22a7c01f91a090136e6cc8156c791
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/20/2020
ms.locfileid: "105749440"
---
# <a name="property-storage-considerations"></a><span data-ttu-id="51217-103">Considerações de armazenamento de propriedade</span><span class="sxs-lookup"><span data-stu-id="51217-103">Property Storage Considerations</span></span>

<span data-ttu-id="51217-104">[**IPropertyStorage:: ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) lê quantas propriedades especificadas na matriz *rgpspec* como são encontradas no conjunto de propriedades.</span><span class="sxs-lookup"><span data-stu-id="51217-104">[**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) reads as many of the properties specified in the *rgpspec* array as are found in the property set.</span></span> <span data-ttu-id="51217-105">Desde que qualquer uma das propriedades solicitadas seja lida, uma solicitação para recuperar uma propriedade que não existe não é um erro.</span><span class="sxs-lookup"><span data-stu-id="51217-105">As long as any of the properties requested is read, a request to retrieve a property that does not exist is not an error.</span></span> <span data-ttu-id="51217-106">Em vez disso, isso deve fazer com \_ que o VT vazio seja gravado para  essa propriedade \[ \] na matriz rgVar no retorno.</span><span class="sxs-lookup"><span data-stu-id="51217-106">Instead, this must cause VT\_EMPTY to be written for that property to the *rgvar*\[\] array on return.</span></span> <span data-ttu-id="51217-107">Quando nenhuma das propriedades solicitadas existir, o método deverá retornar S \_ false e definir o VT \_ vazio em cada [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant).</span><span class="sxs-lookup"><span data-stu-id="51217-107">When none of the requested properties exist, the method should return S\_FALSE, and set VT\_EMPTY in each [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant).</span></span> <span data-ttu-id="51217-108">Se qualquer outro erro for retornado, nenhum valor de propriedade será recuperado e o chamador não precisará se preocupar em liberá-los.</span><span class="sxs-lookup"><span data-stu-id="51217-108">If any other error is returned, no property values are retrieved, and the caller need not worry about releasing them.</span></span>

<span data-ttu-id="51217-109">O parâmetro *rgpspec* é uma matriz de estruturas [**PROPSPEC**](/windows/win32/api/propidlbase/ns-propidlbase-propspec) , que especificam para cada propriedade seu identificador de propriedade ou, se uma for atribuída, um identificador de cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="51217-109">The *rgpspec* parameter is an array of [**PROPSPEC**](/windows/win32/api/propidlbase/ns-propidlbase-propspec) structures, which specify for each property either its property identifier or, if one is assigned, a string identifier.</span></span> <span data-ttu-id="51217-110">Você pode mapear uma cadeia de caracteres para um identificador de propriedade chamando [**IPropertyStorage:: WritePropertyNames**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writepropertynames).</span><span class="sxs-lookup"><span data-stu-id="51217-110">You can map a string to a property identifier by calling [**IPropertyStorage::WritePropertyNames**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writepropertynames).</span></span> <span data-ttu-id="51217-111">O uso de identificadores de propriedade, no entanto, provavelmente será significativamente mais eficiente do que o uso de cadeias de caracteres.</span><span class="sxs-lookup"><span data-stu-id="51217-111">The use of property identifiers is, however, likely to be significantly more efficient than the use of strings.</span></span>

<span data-ttu-id="51217-112">As propriedades que são solicitadas pelo nome da cadeia de caracteres (PRSPEC \_ LPWSTR) são mapeadas sem diferenciação de maiúsculas e minúsculas para identificadores de propriedade (IDs), pois elas são especificadas no conjunto de propriedades atual (e de acordo com a localidade do sistema atual).</span><span class="sxs-lookup"><span data-stu-id="51217-112">Properties that are requested by string name (PRSPEC\_LPWSTR) are mapped case-insensitively to property identifiers (IDs) as they are specified in the current property set (and according to the current system locale).</span></span>

<span data-ttu-id="51217-113">Quando o tipo de propriedade é VT \_ LPSTR e a propriedade é lida de um conjunto de propriedades ANSI, ou seja, a página de código para o conjunto de propriedades é definida como algo diferente de Unicode, o valor da propriedade usa a mesma página de código que o conjunto de propriedades.</span><span class="sxs-lookup"><span data-stu-id="51217-113">When the property type is VT\_LPSTR and the property is read from an ANSI property set, that is, the code page for the property set is set to something other than Unicode, the value of the property uses the same code page as the property set.</span></span> <span data-ttu-id="51217-114">Quando uma propriedade ' VT \_ LPSTR ' é lida de um conjunto de propriedades Unicode, o valor da propriedade usa a página de código ANSI padrão atual do sistema, ou seja, a página de código retornada da função **GetACP** .</span><span class="sxs-lookup"><span data-stu-id="51217-114">When a VT\_LPSTR property is read from a Unicode property set, the value of the property uses the system's current default ANSI code page, that is, the code page returned from the **GetACP** function.</span></span>

<span data-ttu-id="51217-115">Um [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant), exceto aqueles que são ponteiros para fluxos e armazenamentos, é chamado de **PROPVARIANT** simples.</span><span class="sxs-lookup"><span data-stu-id="51217-115">A [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant), except for those that are pointers to streams and storages, is called a simple **PROPVARIANT**.</span></span> <span data-ttu-id="51217-116">Esses **PROPVARIANT** simples recebem dados por valor, portanto, uma chamada para [**IPropertyStorage:: ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) fornece uma cópia dos dados que o chamador possui.</span><span class="sxs-lookup"><span data-stu-id="51217-116">These simple **PROPVARIANT** s receive data by value, so a call to [**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) supplies a copy of the data that the caller then owns.</span></span> <span data-ttu-id="51217-117">Para criar ou atualizar essas propriedades, chame [**IPropertyStorage:: WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span><span class="sxs-lookup"><span data-stu-id="51217-117">To create or update these properties, call [**IPropertyStorage::WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span></span>

<span data-ttu-id="51217-118">Por outro lado, os tipos de variantes VT \_ Stream, VT \_ Streamed \_ Object, VT \_ Storage e VT \_ armazenado \_ são propriedades não simples, porque em vez de fornecer um valor, o método recupera um ponteiro para a interface indicada, da qual os dados podem ser lidos.</span><span class="sxs-lookup"><span data-stu-id="51217-118">In contrast, the variant types VT\_STREAM, VT\_STREAMED\_OBJECT, VT\_STORAGE, and VT\_STORED\_OBJECT are non-simple properties, because rather than supplying a value, the method retrieves a pointer to the indicated interface, from which the data can then be read.</span></span> <span data-ttu-id="51217-119">Esses tipos permitem o armazenamento de grandes quantidades de informações por meio de uma única propriedade.</span><span class="sxs-lookup"><span data-stu-id="51217-119">These types permit the storage of large amounts of information through a single property.</span></span> <span data-ttu-id="51217-120">Há vários problemas que surgem no uso de propriedades não simples.</span><span class="sxs-lookup"><span data-stu-id="51217-120">There are several issues that arise in using nonsimple properties.</span></span>

<span data-ttu-id="51217-121">Para criar essas propriedades, como para as outras propriedades, chame [**IPropertyStorage:: WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span><span class="sxs-lookup"><span data-stu-id="51217-121">To create these properties, as for the other properties, call [**IPropertyStorage::WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span></span> <span data-ttu-id="51217-122">Em vez de chamar o mesmo método para atualizar, no entanto, é mais eficiente primeiro chamar [**IPropertyStorage:: ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) para obter o ponteiro de interface para o fluxo ou armazenamento e, em seguida, gravar dados usando os métodos [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) ou [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) .</span><span class="sxs-lookup"><span data-stu-id="51217-122">Rather than calling the same method to update, however, it is more efficient to first call [**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) to get the interface pointer to the stream or storage, then write data using the [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) or [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) methods.</span></span> <span data-ttu-id="51217-123">Um fluxo ou armazenamento aberto por meio de uma propriedade é sempre aberto no modo direto, portanto, um nível adicional de transação aninhada não é introduzido.</span><span class="sxs-lookup"><span data-stu-id="51217-123">A stream or storage opened through a property is always opened in direct mode, so an additional level of nested transaction is not introduced.</span></span> <span data-ttu-id="51217-124">No entanto, pode ainda haver uma transação no conjunto de propriedades como um todo, dependendo de como ela foi aberta ou criada por meio de [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage).</span><span class="sxs-lookup"><span data-stu-id="51217-124">There may, however, still be a transaction on the property set as a whole, depending on how it was opened or created through [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage).</span></span> <span data-ttu-id="51217-125">Além disso, as marcas de acesso e modo de compartilhamento especificadas quando o conjunto de propriedades é aberto ou criado são passadas para fluxos baseados em propriedade ou armazenamentos.</span><span class="sxs-lookup"><span data-stu-id="51217-125">Further, the access and share mode tags specified when the property set is opened or created, are passed to property-based streams or storages.</span></span>

<span data-ttu-id="51217-126">Os tempos de vida do fluxo baseado em propriedade ou ponteiros de armazenamento, embora teoricamente independente dos seus ponteiros [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) e [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) associados, na verdade, dependem efetivamente deles.</span><span class="sxs-lookup"><span data-stu-id="51217-126">The lifetimes of property-based stream or storage pointers, although theoretically independent of their associated [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) and [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) pointers, in fact, effectively depend on them.</span></span> <span data-ttu-id="51217-127">Os dados visíveis por meio do fluxo ou do armazenamento estão relacionados à transação no objeto de armazenamento de Propriedade do qual ele é recuperado, assim como para um objeto de armazenamento (com suporte a [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage)) com o fluxo e subobjetos de armazenamento contidos.</span><span class="sxs-lookup"><span data-stu-id="51217-127">The data visible through the stream or storage is related to the transaction on the property storage object from which it is retrieved, just as for a storage object (supporting [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage)) with contained stream and storage sub-objects.</span></span> <span data-ttu-id="51217-128">Se a transação no objeto pai for anulada, os ponteiros [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) e **IStorage** existentes subordinados a esse objeto não estarão mais acessíveis.</span><span class="sxs-lookup"><span data-stu-id="51217-128">If the transaction on the parent object is aborted, existing [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) and **IStorage** pointers subordinate to that object are no longer accessible.</span></span> <span data-ttu-id="51217-129">Como **IPropertyStorage** é a única interface no objeto de armazenamento de propriedade, o tempo de vida útil dos ponteiros **IStream** e **IStorage** contidos é limitado pelo tempo de vida da interface **IPropertyStorage** .</span><span class="sxs-lookup"><span data-stu-id="51217-129">Because **IPropertyStorage** is the only interface on the property storage object, the useful lifetime of the contained **IStream** and **IStorage** pointers is bounded by the lifetime of the **IPropertyStorage** interface.</span></span>

<span data-ttu-id="51217-130">A implementação também deve lidar com a situação em que a mesma propriedade com valor de fluxo ou de armazenamento é solicitada várias vezes por meio da mesma instância de interface [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) .</span><span class="sxs-lookup"><span data-stu-id="51217-130">The implementation must also deal with the situation where the same stream- or storage-valued property is requested multiple times through the same [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) interface instance.</span></span> <span data-ttu-id="51217-131">Por exemplo, na implementação do arquivo composto COM, a abertura terá êxito ou falhará dependendo se a propriedade já estiver aberta ou não.</span><span class="sxs-lookup"><span data-stu-id="51217-131">For example, in the COM compound file implementation, the open will succeed or fail depending on whether or not the property is already open.</span></span>

<span data-ttu-id="51217-132">Outro problema é várias aberturas no modo transacionado.</span><span class="sxs-lookup"><span data-stu-id="51217-132">Another issue is multiple opens in transacted mode.</span></span> <span data-ttu-id="51217-133">O resultado depende do nível de isolamento que foi especificado por meio de uma chamada para métodos [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) (o método [**Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) ou [**Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) , por meio dos sinalizadores STGM) no momento em que o armazenamento de propriedade foi aberto.</span><span class="sxs-lookup"><span data-stu-id="51217-133">The result depends on the isolation level that was specified through a call to [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) methods, (either the [**Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) or [**Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) method, through the STGM flags) at the time that the property storage was opened.</span></span>

<span data-ttu-id="51217-134">Se a chamada para abrir o conjunto de propriedades especificar o acesso de leitura/gravação, as propriedades com valor de [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) e [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream)sempre serão abertas com acesso de leitura/gravação.</span><span class="sxs-lookup"><span data-stu-id="51217-134">If the call to open the property set specifies read-write access, [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) and [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream)-valued properties are always opened with read-write access.</span></span> <span data-ttu-id="51217-135">Os dados podem então ser escritos por meio dessas interfaces, alterando o valor da propriedade, que é a maneira mais eficiente de atualizar essas propriedades.</span><span class="sxs-lookup"><span data-stu-id="51217-135">Data can then be written through these interfaces, changing the value of the property, which is the most efficient way to update these properties.</span></span> <span data-ttu-id="51217-136">O próprio valor da propriedade não tem um nível adicional de aninhamento de transações, portanto, as alterações têm o escopo definido na transação (se houver) no objeto de armazenamento de propriedade.</span><span class="sxs-lookup"><span data-stu-id="51217-136">The property value itself does not have an additional level of transaction nesting, so changes are scoped under the transaction (if any) on the property storage object.</span></span>

## <a name="storage-and-stream-properties"></a><span data-ttu-id="51217-137">Propriedades de armazenamento e fluxo</span><span class="sxs-lookup"><span data-stu-id="51217-137">Storage and Stream Properties</span></span>

<span data-ttu-id="51217-138">Para gravar um fluxo ou um objeto de armazenamento em um conjunto de propriedades, o conjunto de propriedades deve ter sido criado como não simples.</span><span class="sxs-lookup"><span data-stu-id="51217-138">To write a stream or storage object to a property set, the property set must have been created as nonsimple.</span></span> <span data-ttu-id="51217-139">Para obter mais informações sobre conjuntos de propriedades simples e não simples, consulte a seção intitulada [armazenamento e objetos de fluxo para um conjunto de propriedades](storage-vs--stream-for-a-property-set.md).</span><span class="sxs-lookup"><span data-stu-id="51217-139">For more information on simple and nonsimple property sets, see the section titled [Storage and Stream Objects for a Property Set](storage-vs--stream-for-a-property-set.md).</span></span> <span data-ttu-id="51217-140">Os tipos de propriedade a seguir, conforme especificado no campo *VT* dos elementos da matriz *rgVar* , são tipos de armazenamento ou de fluxo: VT \_ Stream, \_ armazenamento VT, \_ objeto transmitido por VT \_ , \_ objeto armazenado VT \_ .</span><span class="sxs-lookup"><span data-stu-id="51217-140">The following property types, as specified in the *vt* field of the *rgvar* array elements, are stream or storage types: VT\_STREAM, VT\_STORAGE, VT\_STREAMED\_OBJECT, VT\_STORED\_OBJECT.</span></span>

<span data-ttu-id="51217-141">Para gravar um fluxo ou um objeto de armazenamento como uma propriedade em um conjunto de propriedades não simples, chame [**IPropertyStorage:: WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span><span class="sxs-lookup"><span data-stu-id="51217-141">To write a stream or storage object as a property in a non-simple property set, call [**IPropertyStorage::WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span></span> <span data-ttu-id="51217-142">Embora você também chame esse método para atualizar propriedades simples, ele não é uma maneira eficiente de atualizar o fluxo e os objetos de armazenamento em um conjunto de propriedades.</span><span class="sxs-lookup"><span data-stu-id="51217-142">While you would also call this method to update simple properties, it is not an efficient way to update stream and storage objects in a property set.</span></span> <span data-ttu-id="51217-143">Isso ocorre porque a atualização de uma dessas propriedades por meio de uma chamada para **WriteMultiple** cria no objeto de armazenamento de propriedade uma cópia dos dados passados e os ponteiros [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) ou [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) não são mantidos além da duração dessa chamada.</span><span class="sxs-lookup"><span data-stu-id="51217-143">This is because updating one of these properties through a call to **WriteMultiple** creates in the property storage object a copy of the passed-in data, and the [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) or [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) pointers are not retained beyond the duration of this call.</span></span> <span data-ttu-id="51217-144">Geralmente, é mais eficiente atualizar os objetos Stream ou Storage diretamente chamando [**IPropertyStorage:: ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) para obter o ponteiro de interface para o fluxo ou armazenamento e, em seguida, gravar dados por meio dos métodos **IStream** ou **IStorage** .</span><span class="sxs-lookup"><span data-stu-id="51217-144">It is usually more efficient to update stream or storage objects directly by first calling [**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) to get the interface pointer to the stream or storage, then writing data through the **IStream** or **IStorage** methods.</span></span>

<span data-ttu-id="51217-145">Por exemplo, você pode chamar [**IPropertyStorage:: WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) para gravar um fluxo **nulo** ou objeto de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="51217-145">For example, you can call [**IPropertyStorage::WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) to write a **NULL** stream or storage object.</span></span> <span data-ttu-id="51217-146">Em seguida, a implementação criará um objeto vazio no conjunto de propriedades.</span><span class="sxs-lookup"><span data-stu-id="51217-146">The implementation will then create an empty object in the property set.</span></span> <span data-ttu-id="51217-147">Você pode obter acesso a esse objeto chamando [**IPropertyStorage:: ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple).</span><span class="sxs-lookup"><span data-stu-id="51217-147">You can then get access to this object by calling [**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple).</span></span> <span data-ttu-id="51217-148">Quando você terminar de atualizar esse objeto, não precisará gravá-lo no conjunto de propriedades, pois as atualizações entrarão diretamente no conjunto de propriedades.</span><span class="sxs-lookup"><span data-stu-id="51217-148">When you finish updating this object you need not write it to the property set, as your updates were going directly into the property set.</span></span>

<span data-ttu-id="51217-149">Um fluxo ou armazenamento aberto por meio de uma propriedade é sempre aberto no modo direto, portanto, um nível adicional de transação aninhada não é introduzido.</span><span class="sxs-lookup"><span data-stu-id="51217-149">A stream or storage opened through a property is always opened in direct mode, so an additional level of nested transaction is not introduced.</span></span> <span data-ttu-id="51217-150">Ainda pode haver uma transação no conjunto de propriedades como um todo.</span><span class="sxs-lookup"><span data-stu-id="51217-150">There still may be a transaction on the property set as a whole.</span></span> <span data-ttu-id="51217-151">(Por exemplo, se o [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) foi obtido chamando [**IPropertySetStorage:: Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) com o STGM \_ Sinalizador transacionado definido no parâmetro *grfMode* .) Além disso, um armazenamento ou fluxo baseado em propriedade é aberto no modo de leitura/gravação, se possível, dado o modo no conjunto de propriedades; caso contrário, o modo de leitura será usado.</span><span class="sxs-lookup"><span data-stu-id="51217-151">(For example, if the [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) was obtained by calling [**IPropertySetStorage::Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) with the STGM\_TRANSACTED flag set in the *grfmode* parameter.) Further, a property-based stream or storage is opened in read-write mode, if possible, given the mode on the property set; otherwise, read mode is used.</span></span>

<span data-ttu-id="51217-152">Como mencionado anteriormente, quando um fluxo ou objeto de armazenamento é gravado em um conjunto de propriedades com o método [**WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) , uma cópia do objeto é feita.</span><span class="sxs-lookup"><span data-stu-id="51217-152">As mentioned earlier, when a stream or storage object is written to a property set with the [**WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) method, a copy of the object is made.</span></span> <span data-ttu-id="51217-153">Quando tal cópia é feita em um objeto de fluxo, a operação de cópia começa na posição de busca atual da origem.</span><span class="sxs-lookup"><span data-stu-id="51217-153">When such a copy is made on a stream object, the copy operation starts at the current seek position of the source.</span></span> <span data-ttu-id="51217-154">A posição de busca é indefinida em caso de falha, mas em caso de sucesso ela está no final do fluxo; o ponteiro de busca não é restaurado para sua posição original.</span><span class="sxs-lookup"><span data-stu-id="51217-154">The seek position is undefined on failure, but on success it is at the end of the stream; the seek pointer is not restored to its original position.</span></span>

<span data-ttu-id="51217-155">Se uma propriedade de fluxo ou de armazenamento tiver sido lida de um conjunto de propriedades com [**ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple), ainda estiver aberta e uma chamada subsequente para [**WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) para a mesma propriedade for feita, a operação **WriteMultiple** terá sucesso.</span><span class="sxs-lookup"><span data-stu-id="51217-155">If a stream or storage property has been read from a property set with [**ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple), is still held open, and a subsequent call to [**WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) for the same property is made, the **WriteMultiple** operation will succeed.</span></span> <span data-ttu-id="51217-156">O fluxo ou a propriedade de armazenamento aberta anteriormente é colocada no estado revertido (todas as chamadas para ela retornarão STG \_ E \_ erro revertido).</span><span class="sxs-lookup"><span data-stu-id="51217-156">The previously opened stream or storage property is placed in the reverted state (all calls to it will return STG\_E\_REVERTED error).</span></span>

<span data-ttu-id="51217-157">Se o método [**WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) retornar um erro ao gravar uma matriz de propriedades ou até mesmo propriedades individuais não simples, a quantidade de dados realmente gravados será indefinida.</span><span class="sxs-lookup"><span data-stu-id="51217-157">If the [**WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) method returns an error when writing an array of properties, or even individual non-simple properties, the amount of data actually written is undefined.</span></span>

## <a name="reference-properties"></a><span data-ttu-id="51217-158">Propriedades de referência</span><span class="sxs-lookup"><span data-stu-id="51217-158">Reference Properties</span></span>

<span data-ttu-id="51217-159">Se uma estrutura [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant) especificada incluir o \_ sinalizador VT ByRef em seu membro **VT** , a propriedade associada será uma propriedade de referência.</span><span class="sxs-lookup"><span data-stu-id="51217-159">If a specified [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant) structure includes the VT\_BYREF flag in its **vt** member, the associated property is a reference property.</span></span> <span data-ttu-id="51217-160">Uma propriedade de referência é desreferenciada automaticamente antes de gravar o valor no conjunto de propriedades.</span><span class="sxs-lookup"><span data-stu-id="51217-160">A reference property is automatically dereferenced before writing the value to the property set.</span></span> <span data-ttu-id="51217-161">Por exemplo, se o membro **VT** da estrutura **PROPVARIANT** especifica um valor do tipo VT \_ ByRef \| VT \_ i4, o valor real gravado é um tipo VT \_ i4.</span><span class="sxs-lookup"><span data-stu-id="51217-161">For example, if the **vt** member of the **PROPVARIANT** structure specifies a value of type VT\_BYREF \| VT\_I4, the actual value written is a VT\_I4 type.</span></span> <span data-ttu-id="51217-162">Uma chamada subsequente para o método [**IPropertyStorage:: ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) retorna um valor como VT \_ i4.</span><span class="sxs-lookup"><span data-stu-id="51217-162">A subsequent call to the [**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) method returns a value as VT\_I4.</span></span> <span data-ttu-id="51217-163">O uso de propriedades de referência é semelhante à chamada da função [VariantCopyInd](/windows/win32/api/oleauto/nf-oleauto-variantcopyind) .</span><span class="sxs-lookup"><span data-stu-id="51217-163">Using reference properties is similar to calling the [VariantCopyInd](/windows/win32/api/oleauto/nf-oleauto-variantcopyind) function.</span></span> <span data-ttu-id="51217-164">O [VariantCopyInd](/windows/win32/api/oleauto/nf-oleauto-variantcopyind) libera a variante de destino e faz uma cópia do VARIANTARG de origem, executando o indireção necessário se a origem for especificada como VT \_ ByRef.</span><span class="sxs-lookup"><span data-stu-id="51217-164">[VariantCopyInd](/windows/win32/api/oleauto/nf-oleauto-variantcopyind) frees the destination variant and makes a copy of the source VARIANTARG, performing the necessary indirection if the source is specified to be VT\_BYREF.</span></span> <span data-ttu-id="51217-165">Essa função é útil quando uma cópia de uma variante é necessária e para garantir que ela não seja um VT \_ ByRef, por exemplo, ao manipular argumentos em uma implementação de [**IDispatch:: Invoke**](/windows/win32/api/oaidl/nf-oaidl-idispatch-invoke).</span><span class="sxs-lookup"><span data-stu-id="51217-165">This function is useful when a copy of a variant is needed, and to guarantee that it is not VT\_BYREF, for example when handling arguments in an implementation of [**IDispatch::Invoke**](/windows/win32/api/oaidl/nf-oaidl-idispatch-invoke).</span></span>

## <a name="notes-to-callers"></a><span data-ttu-id="51217-166">Notas aos Chamadores</span><span class="sxs-lookup"><span data-stu-id="51217-166">Notes to Callers</span></span>

<span data-ttu-id="51217-167">É recomendável que os conjuntos de propriedades sejam criados como Unicode, não definindo o \_ sinalizador ANSI PROPSETFLAG no parâmetro *GrfFlags* de [**IPropertySetStorage:: Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create).</span><span class="sxs-lookup"><span data-stu-id="51217-167">It is recommended that property sets be created as Unicode, by not setting the PROPSETFLAG\_ANSI flag in the *grfFlags* parameter of [**IPropertySetStorage::Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create).</span></span> <span data-ttu-id="51217-168">Também é recomendável que você evite usar \_ valores de ' VT LPSTR ' e use valores do VT \_ LPWSTR em vez disso.</span><span class="sxs-lookup"><span data-stu-id="51217-168">It is also recommended that you avoid using VT\_LPSTR values, and use VT\_LPWSTR values instead.</span></span> <span data-ttu-id="51217-169">Quando a página de código do conjunto de propriedades é Unicode, \_ os valores da cadeia de caracteres VT LPSTR são convertidos em Unicode quando armazenados e de volta para valores de cadeia de caracteres multibyte quando recuperados.</span><span class="sxs-lookup"><span data-stu-id="51217-169">When the property set code page is Unicode, VT\_LPSTR string values are converted to Unicode when stored, and back to multibyte string values when retrieved.</span></span> <span data-ttu-id="51217-170">Quando a página de código do conjunto de propriedades não for Unicode, os nomes de propriedade, \_ cadeias de caracteres VT BSTR e valores de propriedade não simples serão convertidos em cadeias de caracteres multibyte quando armazenados e convertidos de volta para Unicode quando recuperados, todos usando a página de código ANSI do sistema atual.</span><span class="sxs-lookup"><span data-stu-id="51217-170">When the code page of the property set is not Unicode, property names, VT\_BSTR strings, and non-simple property values are converted to multibyte strings when stored, and converted back to Unicode when retrieved, all using the current system ANSI code page.</span></span>

## <a name="notes-to-implementers"></a><span data-ttu-id="51217-171">Notas aos Implementadores</span><span class="sxs-lookup"><span data-stu-id="51217-171">Notes to Implementers</span></span>

<span data-ttu-id="51217-172">Ao alocar um identificador de propriedade, a implementação pode escolher qualquer valor que não esteja atualmente em uso no conjunto de propriedades para um identificador de propriedade, desde que não seja 0 ou 1 ou maior que 0x80000000, todos os quais são valores reservados.</span><span class="sxs-lookup"><span data-stu-id="51217-172">When allocating a property identifier, the implementation can choose any value not currently in use in the property set for a property identifier, as long as it is not 0 or 1 or greater than 0x80000000, all of which are reserved values.</span></span> <span data-ttu-id="51217-173">O parâmetro *propidNameFirst* estabelece um valor mínimo para identificadores de propriedade dentro do conjunto e deve ser maior que 1 e menor que 0x80000000.</span><span class="sxs-lookup"><span data-stu-id="51217-173">The *propidNameFirst* parameter establishes a minimum value for property identifiers within the set, and must be greater than 1 and less than 0x80000000.</span></span> <span data-ttu-id="51217-174">Consulte a seção de comentários acima.</span><span class="sxs-lookup"><span data-stu-id="51217-174">See Remarks section above.</span></span>

## <a name="related-topics"></a><span data-ttu-id="51217-175">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="51217-175">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="51217-176">IPropertyStorage-implementação de arquivo composto</span><span class="sxs-lookup"><span data-stu-id="51217-176">IPropertyStorage-Compound File Implementation</span></span>](ipropertystorage-compound-file-implementation.md)
</dt> <dt>

[<span data-ttu-id="51217-177">IPropertyStorage-implementação do sistema de arquivos NTFS</span><span class="sxs-lookup"><span data-stu-id="51217-177">IPropertyStorage-NTFS File System Implementation</span></span>](ipropertystorage-ntfs-file-system-implementation.md)
</dt> <dt>

[<span data-ttu-id="51217-178">Implementação IPropertyStorage-autônoma</span><span class="sxs-lookup"><span data-stu-id="51217-178">IPropertyStorage-Stand-alone Implementation</span></span>](ipropertystorage-stand-alone-implementation.md)
</dt> </dl>

 

 