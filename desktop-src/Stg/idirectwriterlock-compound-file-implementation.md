---
title: IDirectWriterLock-implementação de arquivo composto
description: A implementação do arquivo composto do IDirectWriterLock fornece uma maneira de abrir um arquivo composto no modo direto com um único gravador e vários leitores.
ms.assetid: 4b247dae-d937-430a-bdb7-c47fa3c026b6
keywords:
- IDirectWriterLock Strctd STG, implementação de arquivo composto
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 861935a4c373ce03408c0e633e581e56d39623da
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/16/2019
ms.locfileid: "103635219"
---
# <a name="idirectwriterlock---compound-file-implementation"></a><span data-ttu-id="d9792-104">IDirectWriterLock-implementação de arquivo composto</span><span class="sxs-lookup"><span data-stu-id="d9792-104">IDirectWriterLock - Compound File Implementation</span></span>

<span data-ttu-id="d9792-105">A implementação do arquivo composto do [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) fornece uma maneira de abrir um arquivo composto no modo direto com um único gravador e vários leitores.</span><span class="sxs-lookup"><span data-stu-id="d9792-105">The compound file implementation of [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) provides a way to open a compound file in direct mode with a single writer and multiple readers.</span></span>

<span data-ttu-id="d9792-106">Os arquivos compostos podem ser abertos no modo direto usando o \_ sinalizador direto STGM.</span><span class="sxs-lookup"><span data-stu-id="d9792-106">Compound files can be opened in direct mode using the STGM\_DIRECT flag.</span></span> <span data-ttu-id="d9792-107">A interface [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) define o \_ sinalizador de \| negação de gravação STGM ReadWrite STGM \_ share \_ \_ como válido no modo direto, sem a necessidade da sobrecarga de uma cópia de instantâneo.</span><span class="sxs-lookup"><span data-stu-id="d9792-107">The [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) interface sets the STGM\_READWRITE\|STGM\_SHARE\_DENY\_WRITE flag as valid in direct mode without requiring the overhead of a snapshot copy.</span></span>

<span data-ttu-id="d9792-108">Quando um arquivo composto é aberto no modo transacionado usando o \_ sinalizador transacionado STGM, você também pode ter vários leitores e um único gravador usando o \_ sinalizador de gravação de \| \_ negação de compartilhamento STGM ReadWrite STGM \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="d9792-108">When a compound file is opened in transacted mode using the STGM\_TRANSACTED flag, you can also have multiple readers and a single writer using the STGM\_READWRITE\|STGM\_SHARE\_DENY\_WRITE flag.</span></span> <span data-ttu-id="d9792-109">No entanto, nesse caso, uma cópia de instantâneo do arquivo é feita para os leitores.</span><span class="sxs-lookup"><span data-stu-id="d9792-109">However, in this case, a snapshot copy of the file is made for the readers.</span></span> <span data-ttu-id="d9792-110">Geralmente, há uma sobrecarga de uma cópia transitória.</span><span class="sxs-lookup"><span data-stu-id="d9792-110">There is often overhead of a scratch copy.</span></span>

## <a name="when-to-use"></a><span data-ttu-id="d9792-111">Quando usar</span><span class="sxs-lookup"><span data-stu-id="d9792-111">When to Use</span></span>

<span data-ttu-id="d9792-112">Use a implementação fornecida pelo sistema do [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) ao abrir um armazenamento no modo direto (STGM \_ Direct) com os sinalizadores de \_ \| gravação de \_ negação do compartilhamento STGM do STGM ReadWrite \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="d9792-112">Use the system-supplied implementation of [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) when you open a storage in direct mode (STGM\_DIRECT) with the STGM\_READWRITE\|STGM\_SHARE\_DENY\_WRITE flags.</span></span>

<span data-ttu-id="d9792-113">Para obter um ponteiro para [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock), chame **QueryInterface** em [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) para obter o objeto de armazenamento raiz para o arquivo composto.</span><span class="sxs-lookup"><span data-stu-id="d9792-113">To obtain a pointer to [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock), call **QueryInterface** on [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) to get the root storage object for the compound file.</span></span>

<span data-ttu-id="d9792-114">Chame [**IDirectWriterLock:: WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) para obter acesso de gravação exclusivo a um arquivo composto.</span><span class="sxs-lookup"><span data-stu-id="d9792-114">Call [**IDirectWriterLock::WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) to obtain exclusive write access to a compound file.</span></span> <span data-ttu-id="d9792-115">Chame [**IDirectWriterLock:: ReleaseWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-releasewriteaccess) para liberar acesso de gravação exclusivo.</span><span class="sxs-lookup"><span data-stu-id="d9792-115">Call [**IDirectWriterLock::ReleaseWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-releasewriteaccess) to release exclusive write access.</span></span>

<span data-ttu-id="d9792-116">[**IDirectWriterLock:: HaveWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-havewriteaccess) indica se o arquivo está bloqueado no momento.</span><span class="sxs-lookup"><span data-stu-id="d9792-116">[**IDirectWriterLock::HaveWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-havewriteaccess) indicates whether the file is currently locked.</span></span>

## <a name="remarks"></a><span data-ttu-id="d9792-117">Comentários</span><span class="sxs-lookup"><span data-stu-id="d9792-117">Remarks</span></span>

<span data-ttu-id="d9792-118">A implementação do arquivo composto do recurso de gravador único e de vários leitores baseia-se no bloqueio de intervalo.</span><span class="sxs-lookup"><span data-stu-id="d9792-118">The compound file implementation of the single-writer, multiple-reader feature is based on range locking.</span></span> <span data-ttu-id="d9792-119">O gravador obtém acesso exclusivo ao armazenamento para gravação depois que todos os leitores atuais tiverem fechado o armazenamento.</span><span class="sxs-lookup"><span data-stu-id="d9792-119">The writer obtains exclusive access to the storage to write after all current readers have closed the storage.</span></span> <span data-ttu-id="d9792-120">Enquanto o gravador está ativo, os leitores subsequentes não podem abrir o armazenamento.</span><span class="sxs-lookup"><span data-stu-id="d9792-120">While the writer is active, subsequent readers cannot open the storage.</span></span> <span data-ttu-id="d9792-121">O gravador chama [**IDirectWriterLock:: WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) para obter acesso de gravação exclusivo.</span><span class="sxs-lookup"><span data-stu-id="d9792-121">The writer calls [**IDirectWriterLock::WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) to obtain exclusive write access.</span></span> <span data-ttu-id="d9792-122">O gravador deve então chamar [**IDirectWriterLock:: ReleaseWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-releasewriteaccess) para liberar o armazenamento.</span><span class="sxs-lookup"><span data-stu-id="d9792-122">The writer must then call [**IDirectWriterLock::ReleaseWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-releasewriteaccess) to release the storage.</span></span>

<span data-ttu-id="d9792-123">A chamada para [**IDirectWriterLock:: WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) é necessária antes de gravar neste modo de leitor único e de vários gravadores.</span><span class="sxs-lookup"><span data-stu-id="d9792-123">The call to [**IDirectWriterLock::WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) is required before writing in this single-reader, multiple-writer mode.</span></span> <span data-ttu-id="d9792-124">Tentativas de gravar no arquivo sem chamar **IDirectWriterLock:: WaitForWriteAccess** primeiro resultam em STG \_ E \_ ACCESSDENIED.</span><span class="sxs-lookup"><span data-stu-id="d9792-124">Attempts to write to the file without calling **IDirectWriterLock::WaitForWriteAccess** first result in STG\_E\_ACCESSDENIED.</span></span> <span data-ttu-id="d9792-125">Esse erro é retornado mesmo se o gravador abrir o arquivo inicialmente e nenhum leitor tiver o arquivo aberto no momento.</span><span class="sxs-lookup"><span data-stu-id="d9792-125">This error is returned even if the writer opened the file initially, and no readers currently have the file open.</span></span>

## <a name="marshaling-considerations"></a><span data-ttu-id="d9792-126">Considerações sobre marshaling</span><span class="sxs-lookup"><span data-stu-id="d9792-126">Marshaling Considerations</span></span>

<span data-ttu-id="d9792-127">O empacotamento personalizado normalmente é usado quando um arquivo composto é empacotado para outro processo no mesmo computador.</span><span class="sxs-lookup"><span data-stu-id="d9792-127">Custom marshaling is typically used when a compound file is marshaled to another process on the same machine.</span></span> <span data-ttu-id="d9792-128">Ao realizar marshaling de armazenamentos, os direitos de acesso não são considerados e o ponteiro [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) é passado para o novo processo com os mesmos modos de acesso e direitos que o processo de marshaling original.</span><span class="sxs-lookup"><span data-stu-id="d9792-128">When marshaling storages, access rights are not considered, and the [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) pointer is passed to the new process with the same access modes and rights as the original marshaling process.</span></span> <span data-ttu-id="d9792-129">Para obter mais informações sobre modos de acesso, consulte [**constantes STGM**](stgm-constants.md).</span><span class="sxs-lookup"><span data-stu-id="d9792-129">For more information about access modes, see [**STGM Constants**](stgm-constants.md).</span></span> <span data-ttu-id="d9792-130">Durante o marshaling, nenhum bloqueio é obtido ou verificado para garantir acesso de gravação exclusivo.</span><span class="sxs-lookup"><span data-stu-id="d9792-130">During marshaling, no locks are taken or verified to ensure exclusive write access.</span></span> <span data-ttu-id="d9792-131">Nesse caso, não há nenhuma imposição da política de gravador único para arquivos compostos abertos no modo de gravador único e de vários leitores.</span><span class="sxs-lookup"><span data-stu-id="d9792-131">In this case, there is no enforcement of the single-writer policy for compound files opened in the single-writer, multiple-reader mode.</span></span> <span data-ttu-id="d9792-132">Em vez disso, a imposição é manipulada internamente pela implementação do arquivo composto.</span><span class="sxs-lookup"><span data-stu-id="d9792-132">Instead, enforcement is handled internally by the compound file implementation.</span></span>

<span data-ttu-id="d9792-133">Como o ponteiro [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) é passado para outro processo durante o marshaling, é possível que dois processos tenham acesso simultâneo ao mesmo arquivo composto.</span><span class="sxs-lookup"><span data-stu-id="d9792-133">Because the [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) pointer is passed to another process during marshaling, it is possible for two processes to have simultaneous access to the same compound file.</span></span> <span data-ttu-id="d9792-134">Embora um chamador possa ter obtido acesso de gravação exclusivo para o armazenamento chamando [**IDirectWriterLock:: WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess), a versão com marshaling também pode ter acesso simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="d9792-134">Even though a caller may have obtained exclusive write access to the storage by calling [**IDirectWriterLock::WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess), the marshaled version can also have access simultaneously.</span></span> <span data-ttu-id="d9792-135">As versões com marshaling não são forçadas a fechar enquanto o único gravador acessa o arquivo.</span><span class="sxs-lookup"><span data-stu-id="d9792-135">The marshaled versions are not forced to close while the single writer accesses the file.</span></span> <span data-ttu-id="d9792-136">Nesse caso, a implementação do arquivo composto sincroniza as gravações internamente.</span><span class="sxs-lookup"><span data-stu-id="d9792-136">In this case, the compound file implementation synchronizes the writes internally.</span></span>

<span data-ttu-id="d9792-137">Se um único gravador obtiver acesso exclusivo chamando, [**IDirectWriterLock:: WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess), o armazenamento com marshaling também terá acesso de gravação e não precisará chamar **IDirectWriterLock:: WaitForWriteAccess**.</span><span class="sxs-lookup"><span data-stu-id="d9792-137">If a single writer obtains exclusive access by calling, [**IDirectWriterLock::WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess), the marshaled storage also has write access and does not have to call **IDirectWriterLock::WaitForWriteAccess**.</span></span> <span data-ttu-id="d9792-138">Ambos os processos têm acesso de gravação e a sincronização é controlada pela implementação do arquivo composto interno.</span><span class="sxs-lookup"><span data-stu-id="d9792-138">Both processes have write access and synchronization is controlled by the internal compound file implementation.</span></span>

## <a name="related-topics"></a><span data-ttu-id="d9792-139">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="d9792-139">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d9792-140">**IDirectWriterLock**</span><span class="sxs-lookup"><span data-stu-id="d9792-140">**IDirectWriterLock**</span></span>](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock)
</dt> </dl>

 

 




