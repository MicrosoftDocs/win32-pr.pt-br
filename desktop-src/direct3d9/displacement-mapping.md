---
description: Os mapas de deslocamento são semelhantes aos mapas de textura, mas são acessados pelo mecanismo de vértice.
ms.assetid: d6f16ff2-5a66-48a3-82c4-523faaafa6ae
title: Mapeamento de deslocamento (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b687583b0109223d8c2dac807425e235ddf280e4
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/06/2021
ms.locfileid: "104456714"
---
# <a name="displacement-mapping-direct3d-9"></a><span data-ttu-id="78c46-103">Mapeamento de deslocamento (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="78c46-103">Displacement Mapping (Direct3D 9)</span></span>

<span data-ttu-id="78c46-104">Os mapas de deslocamento são semelhantes aos mapas de textura, mas são acessados pelo mecanismo de vértice.</span><span class="sxs-lookup"><span data-stu-id="78c46-104">Displacement maps are similar to texture maps but are accessed by the vertex engine.</span></span>

## <a name="block-diagram"></a><span data-ttu-id="78c46-105">Diagrama de bloco</span><span class="sxs-lookup"><span data-stu-id="78c46-105">Block Diagram</span></span>

<span data-ttu-id="78c46-106">Um estágio de amostra adicional está presente na parte inicial do pipe de vértice, conforme mostrado no diagrama a seguir, que pode fazer uma amostragem de um mapa de deslocamento para fornecer dados de deslocamento de vértice.</span><span class="sxs-lookup"><span data-stu-id="78c46-106">An additional sampler stage is present in the early part of the vertex pipe, as shown in the following diagram, which can sample a displacement map to provide vertex displacement data.</span></span>

![diagrama do estágio de amostra no pipe de vértice](images/tessellatordx9.png)

<span data-ttu-id="78c46-108">O estado de amostra do mapa de deslocamento pode ser definido pelo [**Setsamplestate**](/windows/desktop/api) usando o número de estágio 256, que é um novo número de estágio.</span><span class="sxs-lookup"><span data-stu-id="78c46-108">The displacement map sampler state can be set by the [**SetSamplerState**](/windows/desktop/api) using stage number 256, which is a new stage number.</span></span> <span data-ttu-id="78c46-109">A textura do mapa de deslocamento é definida por [**SetTexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-settexture).</span><span class="sxs-lookup"><span data-stu-id="78c46-109">The displacement map texture is set by [**SetTexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-settexture).</span></span>

<span data-ttu-id="78c46-110">O mapa pode ser de amostra ou não, o que significa que ele pode ser ordenado de uma maneira que permita a pesquisa dos valores de deslocamento sem filtragem.</span><span class="sxs-lookup"><span data-stu-id="78c46-110">The map can be presampled or not, which means that it can be ordered in a way that enables the lookup of the displacement values without filtering.</span></span>

-   <span data-ttu-id="78c46-111">Os mapas de deslocamento são análogos aos mapas de textura, mas são acessados pelo mecanismo de vértice.</span><span class="sxs-lookup"><span data-stu-id="78c46-111">Displacement maps are analogous to texture maps but are accessed by the vertex engine.</span></span>
-   <span data-ttu-id="78c46-112">Um estágio de amostra adicional está presente na parte inicial do pipe de vértice que pode fazer uma amostragem de um mapa de deslocamento.</span><span class="sxs-lookup"><span data-stu-id="78c46-112">An additional sampler stage is present in the early part of the vertex pipe that can sample a displacement map.</span></span> <span data-ttu-id="78c46-113">Esse estágio é acessado pela API setsamplestate usual, mas o número do estágio é D3DDMAPSAMPLER = 256.</span><span class="sxs-lookup"><span data-stu-id="78c46-113">This stage is accessed by the usual SetSamplerState API but the stage number is D3DDMAPSAMPLER = 256.</span></span>
-   <span data-ttu-id="78c46-114">O estado de amostra do mapa de deslocamento pode ser definido pelo setsamplestate (D3DDMAPSAMPLER,...) API.</span><span class="sxs-lookup"><span data-stu-id="78c46-114">The displacement map sampler state can be set by the SetSamplerState(D3DDMAPSAMPLER, ...) API.</span></span>
-   <span data-ttu-id="78c46-115">A textura do mapa de deslocamento é definida pela API SetTexture (D3DDMAPSAMPLER, Texture).</span><span class="sxs-lookup"><span data-stu-id="78c46-115">The displacement map texture is set by the SetTexture(D3DDMAPSAMPLER, texture) API.</span></span>
-   <span data-ttu-id="78c46-116">O mapa pode ser previamente amostrado ou não.</span><span class="sxs-lookup"><span data-stu-id="78c46-116">The map can be pre-sampled or not.</span></span> <span data-ttu-id="78c46-117">Isso significa que ele pode ser ordenado de uma maneira específica que permite a pesquisa dos valores de deslocamento sem filtragem.</span><span class="sxs-lookup"><span data-stu-id="78c46-117">This means that it can be ordered in a particular way that enables the lookup of the displacement values without filtering.</span></span>
-   <span data-ttu-id="78c46-118">As alterações na estrutura da declaração permitem a especificação da coordenada de textura usada para pesquisar o mapa de textura.</span><span class="sxs-lookup"><span data-stu-id="78c46-118">The changes in the declaration structure allow the specification of the texture coordinate used to look up the texture map.</span></span> <span data-ttu-id="78c46-119">Por exemplo, Stream0, offset, FLOAT2, pesquisa, valor de deslocamento \_ .</span><span class="sxs-lookup"><span data-stu-id="78c46-119">For example, Stream0, Offset, FLOAT2, LOOKUP, Displacement\_value.</span></span> <span data-ttu-id="78c46-120">Isso diz ao Tessellator para usar o vetor float 2D em stream0 em um determinado deslocamento como uma coordenada de textura para pesquisar o mapa de deslocamento e associar a \_ semântica de uso do valor de deslocamento a ele.</span><span class="sxs-lookup"><span data-stu-id="78c46-120">This tells the tessellator to use the 2D float vector in stream0 at a certain offset as a texture coordinate to look up the displacement map and associate the Displacement\_value usage semantic to it.</span></span> <span data-ttu-id="78c46-121">A declaração de sombreador de vértice contém uma linha semelhante a {DCL \_ Texture0, V0} indicando que a semântica Texture0 deve ser associada ao registro de entrada V0.</span><span class="sxs-lookup"><span data-stu-id="78c46-121">The vertex shader declaration would contain a line similar to {dcl\_texture0, v0} indicating that the texture0 semantic is to be associated with the v0 input register.</span></span> <span data-ttu-id="78c46-122">O valor de deslocamento procurado é copiado para o registro de entrada V0.</span><span class="sxs-lookup"><span data-stu-id="78c46-122">The displacement value looked up is copied into input register v0.</span></span>
-   <span data-ttu-id="78c46-123">Há um tipo especial de mapeamento de deslocamento, quando o mapa de textura é previamente amostrado.</span><span class="sxs-lookup"><span data-stu-id="78c46-123">There is a special type of displacement mapping, when the texture map is pre-sampled.</span></span> <span data-ttu-id="78c46-124">O índice sequencial dos vértices gerados é usado como uma coordenada de textura para um mapa de textura.</span><span class="sxs-lookup"><span data-stu-id="78c46-124">Sequential index of generated vertices is used as a texture coordinate to a texture map.</span></span> <span data-ttu-id="78c46-125">Por exemplo, 0, 0, (D3DDECLTYPE) 0, D3DDECLMETHOD \_ LOOKUPPRESAMPLED, Usage, UsageIndex.</span><span class="sxs-lookup"><span data-stu-id="78c46-125">For example, 0,0,(D3DDECLTYPE)0,D3DDECLMETHOD\_LOOKUPPRESAMPLED, Usage, UsageIndex.</span></span>
-   <span data-ttu-id="78c46-126">A saída da pesquisa é 4 floats.</span><span class="sxs-lookup"><span data-stu-id="78c46-126">The output of the lookup is 4 floats.</span></span>
-   <span data-ttu-id="78c46-127">Há suporte para o mapeamento de deslocamento apenas com N-patches.</span><span class="sxs-lookup"><span data-stu-id="78c46-127">Displacement mapping is supported only with N-patches.</span></span>
-   <span data-ttu-id="78c46-128">Os drivers precisam ignorar D3DDMAPSAMPLER em SetTextureStageState se não tratarem de mapas de substituição.</span><span class="sxs-lookup"><span data-stu-id="78c46-128">Drivers need to ignore D3DDMAPSAMPLER in SetTextureStageState if they do not handle displacement maps.</span></span>
-   <span data-ttu-id="78c46-129">\_Não há suporte para o modo de filtro D3DTEXF ANISOTROPIC.</span><span class="sxs-lookup"><span data-stu-id="78c46-129">D3DTEXF\_ANISOTROPIC filter mode is not supported.</span></span>
-   <span data-ttu-id="78c46-130">Quando D3DSAMP \_ MIPFILTER na amostra do mapa de deslocamento não for D3DTEXF \_ None, o nível de detalhe será calculado da seguinte maneira (Observe que o estado de mosaico adaptável será usado mesmo se D3DRS \_ ENABLEADAPTIVETESSELLATION for **false**): tmax = Process State D3DRS \_ MAXTESSELLATIONLEVEL</span><span class="sxs-lookup"><span data-stu-id="78c46-130">When D3DSAMP\_MIPFILTER in the displacement map sampler is not D3DTEXF\_NONE, the level of detail is computed as follows (Note that the adaptive tessellation state is used even if the D3DRS\_ENABLEADAPTIVETESSELLATION is **FALSE**): Tmax = render state D3DRS\_MAXTESSELLATIONLEVEL</span></span>
-   <span data-ttu-id="78c46-131">O te do nível de mosaico de computação para um vértice vi: (XI, Yi, Zi) da mesma maneira que descrito na seção "mosaico adaptável".</span><span class="sxs-lookup"><span data-stu-id="78c46-131">Compute tessellation level Te for a vertex Vi: (Xi, Yi, Zi) the same way as described in the "Adaptive tessellation" section.</span></span> <span data-ttu-id="78c46-132">Nível de detalhe L = log2 (tmax)-log2 (te).</span><span class="sxs-lookup"><span data-stu-id="78c46-132">Level of detail L = log2(Tmax) - log2 (Te).</span></span>
-   <span data-ttu-id="78c46-133">As operações de filtragem e amostragem de textura seguem as mesmas regras que o pipeline de pixel (a tendência de nível de detalhe (LOD) é aplicada, etc.).</span><span class="sxs-lookup"><span data-stu-id="78c46-133">Texture filtering and sampling operations follow the same rules as the pixel pipeline (level of detail (LOD) bias is applied, etc.).</span></span>
-   <span data-ttu-id="78c46-134">Nem todos os formatos podem ser usados como mapas de deslocamento, mas apenas aqueles que dão suporte ao D3DUSAGE \_ DMAP.</span><span class="sxs-lookup"><span data-stu-id="78c46-134">Not all formats can be used as displacement maps but only those that support the D3DUSAGE\_DMAP.</span></span> <span data-ttu-id="78c46-135">O aplicativo pode consultar isso com o CheckDeviceFormat [**CheckDeviceFormat**](/windows/win32/api/d3d9/nf-d3d9-idirect3d9-checkdeviceformat).</span><span class="sxs-lookup"><span data-stu-id="78c46-135">The application can query that with the CheckDeviceFormat [**CheckDeviceFormat**](/windows/win32/api/d3d9/nf-d3d9-idirect3d9-checkdeviceformat).</span></span>
-   <span data-ttu-id="78c46-136">D3DUSAGE \_ DMAP deve ser especificado em [**CreateTexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createtexture) para notificar o driver de que essa textura deve ser usada como um mapa de deslocamento.</span><span class="sxs-lookup"><span data-stu-id="78c46-136">D3DUSAGE\_DMAP must be specified in [**CreateTexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createtexture) to notify the driver that this texture is to be used as a displacement map.</span></span>
-   <span data-ttu-id="78c46-137">D3DUSAGE \_ DMAP só pode ser usado com texturas.</span><span class="sxs-lookup"><span data-stu-id="78c46-137">D3DUSAGE\_DMAP can only be used with textures.</span></span> <span data-ttu-id="78c46-138">Ele não pode ser usado com mapas ou volumes de cubo.</span><span class="sxs-lookup"><span data-stu-id="78c46-138">It cannot be used with cube maps or volumes.</span></span>
-   <span data-ttu-id="78c46-139">As texturas e os destinos de renderização criados com D3DUSAGE \_ DMAP podem ser definidos em estágios de amostra regulares e como destinos de renderização.</span><span class="sxs-lookup"><span data-stu-id="78c46-139">Textures and render targets created with D3DUSAGE\_DMAP can be set at regular sampler stages and as render targets.</span></span>
-   <span data-ttu-id="78c46-140">Os Estados de renderização para definir o modo de encapsulamento das coordenadas de textura são ignorados no mapeamento de deslocamento.</span><span class="sxs-lookup"><span data-stu-id="78c46-140">The render states to set the wrap mode for the texture coordinates are ignored in displacement mapping.</span></span> <span data-ttu-id="78c46-141">Em geral, não há nenhum modo de encapsulamento para o mecanismo Tessellator.</span><span class="sxs-lookup"><span data-stu-id="78c46-141">In general, there are no wrap modes for the tessellator engine.</span></span>
-   <span data-ttu-id="78c46-142">Um amostra de mapa de deslocamento tem comportamento idêntico ao dos exemplos de textura de pixel.</span><span class="sxs-lookup"><span data-stu-id="78c46-142">A displacement map sampler has behavior identical to that of the pixel texture samplers.</span></span> <span data-ttu-id="78c46-143">Se uma textura com menos de quatro canais (como R32f) for pesquisada, os valores de pesquisa irão para os canais apropriados do registro de destino (o registro de entrada do sombreador de vértice marcado com a \_ semântica de exemplo), enquanto os outros canais padrão são (1, 1, 1).</span><span class="sxs-lookup"><span data-stu-id="78c46-143">If a texture with less than four channels (like R32f) is looked up, the looked-up values go to the appropriate channels of the destination register (the vertex shader input register tagged with the \_sample semantic), while the other channels default to (1, 1, 1).</span></span> <span data-ttu-id="78c46-144">Quando pesquisado, \_ o L8 D3DFMT Obtém a difusão nos canais R, G, B e um padrão como 1.</span><span class="sxs-lookup"><span data-stu-id="78c46-144">When looked up, D3DFMT\_L8 gets broadcast into the R, G, B channels and A defaults to 1.</span></span> <span data-ttu-id="78c46-145">O rasterizador de referência tem os detalhes da implementação completa.</span><span class="sxs-lookup"><span data-stu-id="78c46-145">The reference rasterizer has the full implementation details.</span></span>

## <a name="pre-sampled-displacement-mapping"></a><span data-ttu-id="78c46-146">Mapeamento de deslocamento de amostra</span><span class="sxs-lookup"><span data-stu-id="78c46-146">Pre-Sampled Displacement Mapping</span></span>

-   <span data-ttu-id="78c46-147">Novo estado de amostra é introduzido: D3DSAMP \_ DMAPOFFSET (DWORD)-offset (em vértices) em um mapa de deslocamento de amostra.</span><span class="sxs-lookup"><span data-stu-id="78c46-147">New sampler state is introduced: D3DSAMP\_DMAPOFFSET (DWORD) - offset (in vertices) in a pre-sampled displacement map.</span></span>
-   <span data-ttu-id="78c46-148">O novo método de declaração foi introduzido: D3DDECLMETHOD \_ LOOKUPPRESAMPLED.</span><span class="sxs-lookup"><span data-stu-id="78c46-148">New declaration method is introduced: D3DDECLMETHOD\_LOOKUPPRESAMPLED.</span></span>
-   <span data-ttu-id="78c46-149">O mosaico adaptável deve ser desabilitado.</span><span class="sxs-lookup"><span data-stu-id="78c46-149">Adaptive tessellation should be disabled.</span></span>
-   <span data-ttu-id="78c46-150">As configurações de filtro de textura são ignoradas.</span><span class="sxs-lookup"><span data-stu-id="78c46-150">Texture filter settings are ignored.</span></span> <span data-ttu-id="78c46-151">A amostragem de ponto é feita.</span><span class="sxs-lookup"><span data-stu-id="78c46-151">Point sampling is done.</span></span> <span data-ttu-id="78c46-152">O filtro de textura MIP é considerado como D3DTEXF \_ nenhum.</span><span class="sxs-lookup"><span data-stu-id="78c46-152">The mip texture filter is assumed to be D3DTEXF\_NONE.</span></span> <span data-ttu-id="78c46-153">Todos os outros modos de filtro de textura são assumidos como \_ ponto D3DTEXF.</span><span class="sxs-lookup"><span data-stu-id="78c46-153">All other texture filter modes are assumed to be D3DTEXF\_POINT.</span></span>
-   <span data-ttu-id="78c46-154">As coordenadas de textura são computadas como: U = (índice% TextureWidthInPixeles)/(float) (TextureWidthInPixeles) V = (index/TextureWidthInPixeles)/(float) (TextureHeightInPixeles), em que index é um índice sequencial de vértices gerados mais TSS D3DSAMP \[ \_ DMAPOFFSET \] .</span><span class="sxs-lookup"><span data-stu-id="78c46-154">Texture coordinates are computed as: U = (Index % TextureWidthInPixeles) / (float)(TextureWidthInPixeles) V = (Index / TextureWidthInPixeles) / (float)(TextureHeightInPixeles) where Index is a sequential index of generated vertices plus TSS\[D3DSAMP\_DMAPOFFSET\].</span></span> <span data-ttu-id="78c46-155">O índice sequencial é definido como zero no início de cada primitivo e aumenta após a geração de um vértice.</span><span class="sxs-lookup"><span data-stu-id="78c46-155">The sequential index is set to zero at the start of each primitive and is increased after a vertex is generated.</span></span>

<span data-ttu-id="78c46-156">Essas são as alterações de API que dão suporte ao mapeamento de deslocamento.</span><span class="sxs-lookup"><span data-stu-id="78c46-156">These are the API changes that support displacement mapping.</span></span>

-   <span data-ttu-id="78c46-157">Um único formato de canal adicionado, D3DFMT \_ L16.</span><span class="sxs-lookup"><span data-stu-id="78c46-157">A single channel format added, D3DFMT\_L16.</span></span>
-   <span data-ttu-id="78c46-158">Um novo sinalizador de uso, D3DUSAGE \_ DMAP.</span><span class="sxs-lookup"><span data-stu-id="78c46-158">A new usage flag, D3DUSAGE\_DMAP.</span></span>
-   <span data-ttu-id="78c46-159">Um estágio de textura especial, usado para definir uma textura de mapa de deslocamento, D3DDMAPSAMPLER.</span><span class="sxs-lookup"><span data-stu-id="78c46-159">A special texture stage, used to set a displacement map texture, D3DDMAPSAMPLER.</span></span>
-   <span data-ttu-id="78c46-160">Novos limites de hardware foram adicionados, D3DDEVCAPS2 \_ DMAPNPATCH e D3DDEVCAPS2 \_ PRESAMPLEDDMAPNPATCH.</span><span class="sxs-lookup"><span data-stu-id="78c46-160">New hardware caps have been added, D3DDEVCAPS2\_DMAPNPATCH and D3DDEVCAPS2\_PRESAMPLEDDMAPNPATCH.</span></span> <span data-ttu-id="78c46-161">Consulte [D3DDEVCAPS2](d3ddevcaps2.md).</span><span class="sxs-lookup"><span data-stu-id="78c46-161">See [D3DDEVCAPS2](d3ddevcaps2.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="78c46-162">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="78c46-162">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="78c46-163">Pipeline de vértice</span><span class="sxs-lookup"><span data-stu-id="78c46-163">Vertex Pipeline</span></span>](vertex-pipeline.md)
</dt> </dl>

 

 
