---
title: Instantâneos do sistema
description: Os instantâneos estão no centro das funções de ajuda da ferramenta. Um instantâneo é uma cópia somente leitura do estado atual de uma ou mais das listas a seguir que residem em processos de memória do sistema, threads, módulos e heaps.
ms.assetid: a8122960-f078-4efb-8e01-bf6fb69ee0dd
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6ab6f9a45ad2e12eda53d3143e43c9234c20aae3
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/20/2020
ms.locfileid: "103823863"
---
# <a name="snapshots-of-the-system"></a><span data-ttu-id="65099-104">Instantâneos do sistema</span><span class="sxs-lookup"><span data-stu-id="65099-104">Snapshots of the System</span></span>

<span data-ttu-id="65099-105">Os instantâneos estão no centro das funções de ajuda da ferramenta.</span><span class="sxs-lookup"><span data-stu-id="65099-105">Snapshots are at the core of the tool help functions.</span></span> <span data-ttu-id="65099-106">Um instantâneo é uma cópia somente leitura do estado atual de uma ou mais das listas a seguir que residem na memória do sistema: processos, threads, módulos e heaps.</span><span class="sxs-lookup"><span data-stu-id="65099-106">A snapshot is a read-only copy of the current state of one or more of the following lists that reside in system memory: processes, threads, modules, and heaps.</span></span>

<span data-ttu-id="65099-107">Processos que usam funções de ajuda da ferramenta acessam essas listas de instantâneos em vez de diretamente do sistema operacional.</span><span class="sxs-lookup"><span data-stu-id="65099-107">Processes that use tool help functions access these lists from snapshots instead of directly from the operating system.</span></span> <span data-ttu-id="65099-108">As listas na alteração da memória do sistema quando os processos são iniciados e encerrados, os threads são criados e destruídos, os módulos executáveis são carregados e descarregados da memória do sistema e os heaps são criados e destruídos.</span><span class="sxs-lookup"><span data-stu-id="65099-108">The lists in system memory change when processes are started and ended, threads are created and destroyed, executable modules are loaded and unloaded from system memory, and heaps are created and destroyed.</span></span> <span data-ttu-id="65099-109">O uso de informações de um instantâneo impede inconsistências.</span><span class="sxs-lookup"><span data-stu-id="65099-109">The use of information from a snapshot prevents inconsistencies.</span></span> <span data-ttu-id="65099-110">Caso contrário, as alterações em uma lista podem fazer com que um thread percorra incorretamente a lista ou cause uma violação de acesso (uma falha de GP).</span><span class="sxs-lookup"><span data-stu-id="65099-110">Otherwise, changes to a list could possibly cause a thread to incorrectly traverse the list or cause an access violation (a GP fault).</span></span> <span data-ttu-id="65099-111">Por exemplo, se um aplicativo atravessa a lista de threads enquanto outros threads são criados ou encerrados, as informações que o aplicativo está usando para atravessar a lista de threads podem se tornar desatualizadas e podem causar um erro para que o aplicativo percorra a lista.</span><span class="sxs-lookup"><span data-stu-id="65099-111">For example, if an application traverses the thread list while other threads are created or terminated, information that the application is using to traverse the thread list might become outdated and could cause an error for the application traversing the list.</span></span>

<span data-ttu-id="65099-112">Para tirar um instantâneo da memória do sistema, use a função [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) .</span><span class="sxs-lookup"><span data-stu-id="65099-112">To take a snapshot of the system memory, use the [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) function.</span></span> <span data-ttu-id="65099-113">Você pode controlar o conteúdo de um instantâneo especificando um ou mais dos seguintes valores ao chamar essa função:</span><span class="sxs-lookup"><span data-stu-id="65099-113">You can control the content of a snapshot by specifying one or more of the following values when calling this function:</span></span>

-   <span data-ttu-id="65099-114">**TH32CS \_ SNAPHEAPLIST**</span><span class="sxs-lookup"><span data-stu-id="65099-114">**TH32CS\_SNAPHEAPLIST**</span></span>
-   <span data-ttu-id="65099-115">**TH32CS \_ SNAPMODULE**</span><span class="sxs-lookup"><span data-stu-id="65099-115">**TH32CS\_SNAPMODULE**</span></span>
-   <span data-ttu-id="65099-116">**TH32CS \_ SNAPPROCESS**</span><span class="sxs-lookup"><span data-stu-id="65099-116">**TH32CS\_SNAPPROCESS**</span></span>
-   <span data-ttu-id="65099-117">**TH32CS \_ SNAPTHREAD**</span><span class="sxs-lookup"><span data-stu-id="65099-117">**TH32CS\_SNAPTHREAD**</span></span>

<span data-ttu-id="65099-118">Os valores **TH32CS \_ SNAPHEAPLIST** e **TH32CS \_ SNAPMODULE** são específicos do processo.</span><span class="sxs-lookup"><span data-stu-id="65099-118">The **TH32CS\_SNAPHEAPLIST** and **TH32CS\_SNAPMODULE** values are process specific.</span></span> <span data-ttu-id="65099-119">Quando esses valores são especificados, as listas de heap e módulo do processo especificado são incluídas no instantâneo.</span><span class="sxs-lookup"><span data-stu-id="65099-119">When these values are specified, the heap and module lists of the specified process are included in the snapshot.</span></span> <span data-ttu-id="65099-120">Se você especificar zero como o identificador do processo, o processo atual será usado.</span><span class="sxs-lookup"><span data-stu-id="65099-120">If you specify zero as the process identifier, the current process is used.</span></span> <span data-ttu-id="65099-121">O valor de **TH32CS \_ SNAPTHREAD** sempre cria um instantâneo em todo o sistema, mesmo se um identificador de processo for passado para [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot).</span><span class="sxs-lookup"><span data-stu-id="65099-121">The **TH32CS\_SNAPTHREAD** value always creates a system-wide snapshot even if a process identifier is passed to [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot).</span></span>

<span data-ttu-id="65099-122">Para enumerar o estado de heap ou de módulo para todos os processos, especifique o valor de **\_ SNAPALL TH32CS** e o identificador de processo do processo atual.</span><span class="sxs-lookup"><span data-stu-id="65099-122">To enumerate the heap or module state for all processes, specify the **TH32CS\_SNAPALL** value and the process identifier of the current process.</span></span> <span data-ttu-id="65099-123">Em seguida, para cada processo adicional no instantâneo, chame [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) novamente, especificando seu identificador de processo e o valor **TH32CS \_ SNAPHEAPLIST** ou **TH32CS \_ SNAPMODULE** .</span><span class="sxs-lookup"><span data-stu-id="65099-123">Then, for each additional process in the snapshot, call [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) again, specifying its process identifier and the **TH32CS\_SNAPHEAPLIST** or **TH32CS\_SNAPMODULE** value.</span></span>

<span data-ttu-id="65099-124">Você pode recuperar um código de status de erro estendido para [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) usando a função [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) .</span><span class="sxs-lookup"><span data-stu-id="65099-124">You can retrieve an extended error status code for [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) by using the [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) function.</span></span>

<span data-ttu-id="65099-125">Quando o processo terminar de usar um instantâneo, destrua-o usando a função [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle) .</span><span class="sxs-lookup"><span data-stu-id="65099-125">When your process finishes using a snapshot, destroy it using the [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle) function.</span></span> <span data-ttu-id="65099-126">Se você não destruir um instantâneo, o processo irá vazar memória até que ele saia, quando o sistema recuperar a memória.</span><span class="sxs-lookup"><span data-stu-id="65099-126">If you do not destroy a snapshot, the process will leak memory until the it exits, at which time the system reclaims the memory.</span></span>

> [!Note]  
> <span data-ttu-id="65099-127">O identificador de instantâneo funciona como um identificador de arquivo e está sujeito às mesmas regras em relação aos processos e threads nos quais ele pode ser usado.</span><span class="sxs-lookup"><span data-stu-id="65099-127">The snapshot handle acts like a file handle and is subject to the same rules regarding the processes and threads in which it can be used.</span></span> <span data-ttu-id="65099-128">Para especificar que o identificador é herdável, crie o instantâneo usando o valor de **\_ herança TH32CS** .</span><span class="sxs-lookup"><span data-stu-id="65099-128">To specify that the handle is inheritable, create the snapshot using the **TH32CS\_INHERIT** value.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="65099-129">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="65099-129">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="65099-130">Fazendo um instantâneo e exibindo processos</span><span class="sxs-lookup"><span data-stu-id="65099-130">Taking a Snapshot and Viewing Processes</span></span>](taking-a-snapshot-and-viewing-processes.md)
</dt> </dl>

 

 