---
title: Uso da API de cliente de Serviços de Implantação do Windows
description: Em ambientes em que uma solução padrão de WDS (serviços de implantação do Windows) não pode ser usada para instalar o Windows, a API do cliente WDS permite que os desenvolvedores gravem aplicativos de implantação personalizados.
ms.assetid: abe2a7c7-989a-456e-80df-90d5b816db38
keywords:
- Serviços de implantação do Windows serviços de implantação do Windows, usando a API do cliente
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 872422a5c84bf1d8ea7c3688b122ba2389c1e968
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/20/2020
ms.locfileid: "104007693"
---
# <a name="using-the-windows-deployment-services-client-api"></a><span data-ttu-id="eb860-104">Uso da API de cliente de Serviços de Implantação do Windows</span><span class="sxs-lookup"><span data-stu-id="eb860-104">Using the Windows Deployment Services Client API</span></span>

<span data-ttu-id="eb860-105">Em ambientes em que uma solução padrão de WDS (serviços de implantação do Windows) não pode ser usada para instalar o Windows, a API do cliente WDS permite que os desenvolvedores gravem aplicativos de implantação personalizados.</span><span class="sxs-lookup"><span data-stu-id="eb860-105">In environments where a standard Windows Deployment Services (WDS) solution cannot be used to install Windows, the API of the WDS client enables developers to write custom deployment applications.</span></span> <span data-ttu-id="eb860-106">Os aplicativos podem usar essa API para se comunicar com o servidor WDS para obter informações sobre as imagens do sistema disponíveis no servidor.</span><span class="sxs-lookup"><span data-stu-id="eb860-106">Applications can use this API to communicate with the WDS server to get information about system images available from the server.</span></span> <span data-ttu-id="eb860-107">Os aplicativos cliente do WDS personalizados devem aderir às diretrizes a seguir.</span><span class="sxs-lookup"><span data-stu-id="eb860-107">Custom WDS client applications should adhere to the following guidelines.</span></span>

## <a name="install-the-wds-role-on-the-server"></a><span data-ttu-id="eb860-108">Instalar a função do WDS no servidor</span><span class="sxs-lookup"><span data-stu-id="eb860-108">Install the WDS Role on the Server</span></span>

-   <span data-ttu-id="eb860-109">O WDS (serviços de implantação do Windows) é a versão revisada do RIS (serviços de instalação remota), você precisará da função de servidor do WDS no servidor para implementar soluções personalizadas de cliente do WDS.</span><span class="sxs-lookup"><span data-stu-id="eb860-109">Windows Deployment Services (WDS) is the revised version of Remote Installation Services (RIS), you will need the WDS server role on the server to implement custom WDS client solutions.</span></span>
-   <span data-ttu-id="eb860-110">O WDS substitui o RIS como o componente padrão a partir do Windows Server 2008 e do Windows Server 2003 com Service Pack 2 (SP2).</span><span class="sxs-lookup"><span data-stu-id="eb860-110">WDS replaces RIS as the standard component starting with Windows Server 2008 and Windows Server 2003 with Service Pack 2 (SP2).</span></span>
-   <span data-ttu-id="eb860-111">Você deve atualizar o servidor RIS para o WDS no Windows Server 2003 com Service Pack 1 (SP1).</span><span class="sxs-lookup"><span data-stu-id="eb860-111">You must update the RIS server to WDS on Windows Server 2003 with Service Pack 1 (SP1).</span></span> <span data-ttu-id="eb860-112">Você pode instalar a função de servidor do WDS com o [WAIK (Kit de instalação automatizada do Windows)](https://www.microsoft.com/download/details.aspx?id=10333).</span><span class="sxs-lookup"><span data-stu-id="eb860-112">You can install the WDS server role with the [Windows Automated Installation Kit (WAIK)](https://www.microsoft.com/download/details.aspx?id=10333).</span></span>

## <a name="start-windows-pe-20"></a><span data-ttu-id="eb860-113">Iniciar o Windows PE 2,0</span><span class="sxs-lookup"><span data-stu-id="eb860-113">Start Windows PE 2.0</span></span>

<span data-ttu-id="eb860-114">O Windows PE 2,0 deve ser iniciado, se ainda não tiver iniciado.</span><span class="sxs-lookup"><span data-stu-id="eb860-114">Windows PE 2.0 must be started, if not already started.</span></span> <span data-ttu-id="eb860-115">O cliente do WDS e as DLLs de suporte são carregados somente pelo setup.exe quando está na fase do Microsoft Ambiente de Pré-Instalação do Windows (Windows PE 2,0) do processamento da instalação.</span><span class="sxs-lookup"><span data-stu-id="eb860-115">The WDS client and supporting DLLs are only loaded by setup.exe when it is in the Microsoft Windows Preinstallation Environment (Windows PE 2.0) phase of setup processing.</span></span>

-   <span data-ttu-id="eb860-116">Quando um novo computador está conectado à rede, a tecnologia de PXE (Preboot Execution Environment) interna pode ser usada para baixar o programa de inicialização de rede.</span><span class="sxs-lookup"><span data-stu-id="eb860-116">When a new computer is connected to the network, the built-in preboot execution environment (PXE) technology can be used to download the Network Boot Program.</span></span> <span data-ttu-id="eb860-117">Para obter mais informações sobre a inicialização PXE de um computador para instalar o Windows, consulte [o guia passo a passo de atualização dos serviços de implantação do Windows](/previous-versions/windows/it-pro/windows-vista/cc766320(v=ws.10)).</span><span class="sxs-lookup"><span data-stu-id="eb860-117">For more information about PXE-booting a computer to install Windows, see [The Windows Deployment Services Update Step-by-Step Guide](/previous-versions/windows/it-pro/windows-vista/cc766320(v=ws.10)).</span></span>
-   <span data-ttu-id="eb860-118">Uma imagem inicializável de RAMDISK do Windows PE 2,0 pode ser armazenada no. Formato WIM e baixado como parte do processo de inicialização de rede.</span><span class="sxs-lookup"><span data-stu-id="eb860-118">A RAMDISK bootable image of Windows PE 2.0 can be stored in the .WIM format and downloaded as part of the network boot process.</span></span> <span data-ttu-id="eb860-119">O Windows PE pode ser carregado e executado diretamente dessa mídia.</span><span class="sxs-lookup"><span data-stu-id="eb860-119">Windows PE can then be loaded and run directly from that media.</span></span>

## <a name="open-a-session-with-the-wds-server"></a><span data-ttu-id="eb860-120">Abrir uma sessão com o servidor WDS</span><span class="sxs-lookup"><span data-stu-id="eb860-120">Open a session with the WDS server</span></span>

<span data-ttu-id="eb860-121">O cliente do WDS deve abrir uma sessão com um servidor WDS.</span><span class="sxs-lookup"><span data-stu-id="eb860-121">The WDS client must open a session with a WDS server.</span></span>

-   <span data-ttu-id="eb860-122">Use a função [**WdsCliCreateSession**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclicreatesession) para abrir uma sessão com um servidor WDS.</span><span class="sxs-lookup"><span data-stu-id="eb860-122">Use the [**WdsCliCreateSession**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclicreatesession) function to open a session with a WDS server.</span></span> <span data-ttu-id="eb860-123">Essa função usa o nome ou o endereço IP do servidor e recebe o endereço do identificador para a sessão de cliente do WDS.</span><span class="sxs-lookup"><span data-stu-id="eb860-123">This function takes the name or IP address of the server and receives the address of the handle for the WDS client session.</span></span>
-   <span data-ttu-id="eb860-124">Se a abertura da sessão com o servidor exigir autenticação do cliente WDS, o aplicativo deverá fornecer o endereço de uma estrutura de [**\_ \_ credenciais da CLI do WDS**](/windows/win32/api/wdsclientapi/ns-wdsclientapi-wds_cli_cred) que contém as credenciais do cliente ao chamar a função [**WdsCliCreateSession**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclicreatesession) .</span><span class="sxs-lookup"><span data-stu-id="eb860-124">If opening the session with the server will require authenticating the WDS client, the application should provide the address of a [**WDS\_CLI\_CRED**](/windows/win32/api/wdsclientapi/ns-wdsclientapi-wds_cli_cred) structure containing the client credentials when calling the [**WdsCliCreateSession**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclicreatesession) function.</span></span> <span data-ttu-id="eb860-125">O aplicativo pode usar a função [**WdsCliAuthorizeSession**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscliauthorizesession) para converter uma sessão anônima em uma sessão autenticada.</span><span class="sxs-lookup"><span data-stu-id="eb860-125">The application can use the [**WdsCliAuthorizeSession**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscliauthorizesession) function to convert an anonymous session into an authenticated session.</span></span>
-   <span data-ttu-id="eb860-126">Quando a sessão aberta com a função [**WdsCliCreateSession**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclicreatesession) não for mais necessária, o aplicativo deverá usar a função [**WdsCliClose**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscliclose) para fechar a alça e liberar os recursos mantidos pela sessão.</span><span class="sxs-lookup"><span data-stu-id="eb860-126">When the session opened with the [**WdsCliCreateSession**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclicreatesession) function is no longer needed, the application should use the [**WdsCliClose**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscliclose) function to close the handle and release resources held by the session.</span></span>

## <a name="enumerate-system-images-on-the-wds-server"></a><span data-ttu-id="eb860-127">Enumerar imagens do sistema no servidor WDS</span><span class="sxs-lookup"><span data-stu-id="eb860-127">Enumerate system images on the WDS server</span></span>

<span data-ttu-id="eb860-128">O cliente do WDS pode usar a API para enumerar as imagens do sistema no servidor do WDS.</span><span class="sxs-lookup"><span data-stu-id="eb860-128">The WDS client can use the API to enumerate the system images on the WDS server.</span></span>

-   <span data-ttu-id="eb860-129">Use a função [**WdsCliFindFirstImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindfirstimage) para obter um identificador para a primeira imagem e para inicializar a enumeração de imagens no servidor WDS.</span><span class="sxs-lookup"><span data-stu-id="eb860-129">Use the [**WdsCliFindFirstImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindfirstimage) function to obtain a handle to the first image and to initialize the enumeration of images on the WDS server.</span></span>
-   <span data-ttu-id="eb860-130">Use a função [**WdsCliFindNextImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindnextimage) para incrementar a enumeração iniciada pela função [**WdsCliFindFirstImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindfirstimage) .</span><span class="sxs-lookup"><span data-stu-id="eb860-130">Use the [**WdsCliFindNextImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindnextimage) function to increment the enumeration started by the [**WdsCliFindFirstImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindfirstimage) function.</span></span> <span data-ttu-id="eb860-131">A função **WdsCliFindNextImage** Obtém o identificador para a próxima imagem.</span><span class="sxs-lookup"><span data-stu-id="eb860-131">The **WdsCliFindNextImage** function gets the handle for the next image.</span></span>
-   <span data-ttu-id="eb860-132">Use a função [**WdsCliGetImageIndex**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimageindex) para obter o índice de imagem para a imagem atual.</span><span class="sxs-lookup"><span data-stu-id="eb860-132">Use the [**WdsCliGetImageIndex**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimageindex) function to obtain the image index for the current image.</span></span> <span data-ttu-id="eb860-133">Esse valor é válido somente até que as funções [**WdsCliFindNextImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindnextimage) ou [**WdsCliClose**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscliclose) sejam usadas novamente.</span><span class="sxs-lookup"><span data-stu-id="eb860-133">This value is valid only until the [**WdsCliFindNextImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindnextimage) or [**WdsCliClose**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscliclose) functions are used again.</span></span>
-   <span data-ttu-id="eb860-134">Use a função [**WdsCliGetEnumerationFlags**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetenumerationflags) para obter sinalizadores informativos sobre filtragem de imagem.</span><span class="sxs-lookup"><span data-stu-id="eb860-134">Use the [**WdsCliGetEnumerationFlags**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetenumerationflags) function to get informational flags about image filtering.</span></span>

## <a name="get-information-about-images"></a><span data-ttu-id="eb860-135">Obter informações sobre imagens</span><span class="sxs-lookup"><span data-stu-id="eb860-135">Get information about images</span></span>

<span data-ttu-id="eb860-136">O cliente WDS pode usar a API para obter informações sobre as imagens em um servidor WDS.</span><span class="sxs-lookup"><span data-stu-id="eb860-136">The WDS client can use the API to get information about the images on a WDS server.</span></span> <span data-ttu-id="eb860-137">As funções a seguir obtêm informações sobre a imagem atual.</span><span class="sxs-lookup"><span data-stu-id="eb860-137">The following functions get information about the current image.</span></span> <span data-ttu-id="eb860-138">Como as funções [**WdsCliFindFirstImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindfirstimage) e [**WdsCliFindNextImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindnextimage) alteram o valor do identificador da imagem atual, o aplicativo deve armazenar todas as informações obtidas e serão necessárias no futuro antes de chamar as funções **WdsCliFindFirstImage** ou **WdsCliFindNextImage** novamente.</span><span class="sxs-lookup"><span data-stu-id="eb860-138">Because the [**WdsCliFindFirstImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindfirstimage) and [**WdsCliFindNextImage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclifindnextimage) functions change the current image handle value, the application should store any information it gets and will need in the future before calling the **WdsCliFindFirstImage** or **WdsCliFindNextImage** functions again.</span></span>

-   <span data-ttu-id="eb860-139">Use a função [**WdsCliGetImageArchitecture**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagearchitecture) para obter a arquitetura do processador da imagem atual.</span><span class="sxs-lookup"><span data-stu-id="eb860-139">Use the [**WdsCliGetImageArchitecture**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagearchitecture) function to get the processor architecture of the current image.</span></span>
-   <span data-ttu-id="eb860-140">Use a função [**WdsCliGetImagePath**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagepath) para obter o caminho relativo para o arquivo de imagem que contém a imagem atual.</span><span class="sxs-lookup"><span data-stu-id="eb860-140">Use the [**WdsCliGetImagePath**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagepath) function to get the relative path to the image file that contains the current image.</span></span>
-   <span data-ttu-id="eb860-141">Use a função [**WdsCliGetImageSize**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagesize) para obter o tamanho da imagem.</span><span class="sxs-lookup"><span data-stu-id="eb860-141">Use the [**WdsCliGetImageSize**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagesize) function to get the image size.</span></span>
-   <span data-ttu-id="eb860-142">Use a função [**WdsCliGetImageVersion**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimageversion) para obter a versão da imagem.</span><span class="sxs-lookup"><span data-stu-id="eb860-142">Use the [**WdsCliGetImageVersion**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimageversion) function to get the image version.</span></span>
-   <span data-ttu-id="eb860-143">Use a função [**WdsCliGetImageLanguage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagelanguage) para obter o idioma padrão da imagem atual.</span><span class="sxs-lookup"><span data-stu-id="eb860-143">Use the [**WdsCliGetImageLanguage**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagelanguage) function to get the default language of the current image.</span></span>
-   <span data-ttu-id="eb860-144">Use a função [**WdsCliGetImageLanguages**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagelanguages) para obter uma matriz de idiomas com suporte pela imagem atual.</span><span class="sxs-lookup"><span data-stu-id="eb860-144">Use the [**WdsCliGetImageLanguages**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagelanguages) function to get an array of languages supported by the current image.</span></span>
-   <span data-ttu-id="eb860-145">Use o [**WdsCliGetImageLastModifiedTime**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagelastmodifiedtime) retorna a hora da última modificação da imagem atual.</span><span class="sxs-lookup"><span data-stu-id="eb860-145">Use the [**WdsCliGetImageLastModifiedTime**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagelastmodifiedtime) returns the last-modified time for the current image.</span></span>
-   <span data-ttu-id="eb860-146">Use a função [**WdsCliGetImageName**](/windows/win32/api/WdsClientApi/nf-wdsclientapi-wdscligetimagename) para obter o nome da imagem atual.</span><span class="sxs-lookup"><span data-stu-id="eb860-146">Use the [**WdsCliGetImageName**](/windows/win32/api/WdsClientApi/nf-wdsclientapi-wdscligetimagename) function to get the name of the current image.</span></span>
-   <span data-ttu-id="eb860-147">Use a função [**WdsCliGetImageDescription**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagedescription) para obter a descrição da imagem atual.</span><span class="sxs-lookup"><span data-stu-id="eb860-147">Use the [**WdsCliGetImageDescription**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagedescription) function to get the description of the current image.</span></span>
-   <span data-ttu-id="eb860-148">Use a função [**WdsCliGetImageGroup**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagegroup) para obter o nome do grupo de imagens para a imagem atual.</span><span class="sxs-lookup"><span data-stu-id="eb860-148">Use the [**WdsCliGetImageGroup**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagegroup) function to get the image group name for the current image.</span></span>
-   <span data-ttu-id="eb860-149">Use a função [**WdsCliGetImageHalName**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagehalname) para obter o nome da camada de abstração de hardware (Hal) para a imagem atual.</span><span class="sxs-lookup"><span data-stu-id="eb860-149">Use the [**WdsCliGetImageHalName**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscligetimagehalname) function to get the Hardware Abstraction Layer (HAL) name for the current image.</span></span>

## <a name="log-wds-client-events"></a><span data-ttu-id="eb860-150">Registrar eventos do cliente do WDS</span><span class="sxs-lookup"><span data-stu-id="eb860-150">Log WDS Client Events</span></span>

<span data-ttu-id="eb860-151">A funcionalidade de log da biblioteca de cliente do WDS permite que os eventos de progresso da instalação sejam enviados do cliente para o servidor do WDS.</span><span class="sxs-lookup"><span data-stu-id="eb860-151">The logging functionality of the WDS client library enables installation progress events to be sent from the client to the WDS server.</span></span>

-   <span data-ttu-id="eb860-152">Use a função [**WdsCliInitializeLog**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscliinitializelog) para inicializar o log para a sessão de cliente do WDS.</span><span class="sxs-lookup"><span data-stu-id="eb860-152">Use the [**WdsCliInitializeLog**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdscliinitializelog) function to initialize the log for the WDS client session.</span></span>
-   <span data-ttu-id="eb860-153">Use a função [**WdsCliLog**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclilog) para gravar mensagens de evento no log do servidor WDS.</span><span class="sxs-lookup"><span data-stu-id="eb860-153">Use the [**WdsCliLog**](/windows/win32/api/WdsClientAPI/nf-wdsclientapi-wdsclilog) function to write event messages to the WDS server log.</span></span>
-   <span data-ttu-id="eb860-154">No Windows Server 2008, o servidor WDS grava eventos do cliente em um log de eventos específico do aplicativo que é visível por meio de eventvwr.exe, bem como o log de rastreamento de depuração.</span><span class="sxs-lookup"><span data-stu-id="eb860-154">On Windows Server 2008, the WDS server writes client events to an application specific event log that is viewable through eventvwr.exe as well as the debug trace log.</span></span> <span data-ttu-id="eb860-155">No Windows Server 2003 com log de depuração habilitado, o servidor WDS gravará eventos de cliente no arquivo de log localizado em% windir% \\ Tracing \\ wdsserver. log.</span><span class="sxs-lookup"><span data-stu-id="eb860-155">On Windows Server 2003 with debug logging enabled, the WDS server will write client events to the log file located at %windir%\\tracing\\wdsserver.log.</span></span> <span data-ttu-id="eb860-156">O registro em log do cliente do WDS deve estar habilitado no servidor para capturar esses eventos.</span><span class="sxs-lookup"><span data-stu-id="eb860-156">WDS Client logging must be enabled on the server to capture these events.</span></span>

## <a name="related-topics"></a><span data-ttu-id="eb860-157">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="eb860-157">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="eb860-158">Sobre a API dos serviços de implantação do Windows</span><span class="sxs-lookup"><span data-stu-id="eb860-158">About the Windows Deployment Services API</span></span>](about-the-windows-deployment-services-api.md)
</dt> <dt>

[<span data-ttu-id="eb860-159">Uso da API de servidor de Serviços de Implantação do Windows</span><span class="sxs-lookup"><span data-stu-id="eb860-159">Using the Windows Deployment Services Server API</span></span>](using-the-windows-deployment-services-server-api.md)
</dt> </dl>

 

 