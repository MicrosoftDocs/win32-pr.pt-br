---
description: Os aplicativos TAPI residem em seu próprio espaço de processo.
ms.assetid: 57dedad1-7264-48fc-9ac2-c6c72f7fee27
title: Visão geral do provedor de serviços TAPI
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7e847ed49879e9ff55662477a762fa7297443d12
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "104559741"
---
# <a name="tapi-service-provider-overview"></a><span data-ttu-id="cbedf-103">Visão geral do provedor de serviços TAPI</span><span class="sxs-lookup"><span data-stu-id="cbedf-103">TAPI Service Provider Overview</span></span>

<span data-ttu-id="cbedf-104">Os aplicativos TAPI residem em seu próprio espaço de processo.</span><span class="sxs-lookup"><span data-stu-id="cbedf-104">TAPI applications reside in their own process space.</span></span> <span data-ttu-id="cbedf-105">Os aplicativos TAPI carregam o Tapi32.dll ou Tapi3.dll em seu processo, e a TAPI se comunica com o TAPISRV por meio de uma interface RPC privada.</span><span class="sxs-lookup"><span data-stu-id="cbedf-105">TAPI applications load the Tapi32.dll or Tapi3.dll into their process, and TAPI communicates with TAPISRV through a private RPC interface.</span></span> <span data-ttu-id="cbedf-106">Um TSP é executado no contexto de TAPISRV.</span><span class="sxs-lookup"><span data-stu-id="cbedf-106">A TSP runs in the context of TAPISRV.</span></span> <span data-ttu-id="cbedf-107">Um determinado TSP pode residir em um computador diferente do computador do usuário e é acessado usando um TSP remoto.</span><span class="sxs-lookup"><span data-stu-id="cbedf-107">A given TSP may reside on a machine other than the user's machine and is accessed using a remote TSP.</span></span> <span data-ttu-id="cbedf-108">O TAPISRV é implementado como um processo de serviço no SVCHOST.</span><span class="sxs-lookup"><span data-stu-id="cbedf-108">TAPISRV is implemented as a service process within SVCHOST.</span></span> <span data-ttu-id="cbedf-109">Um MSP reside no espaço de processo do aplicativo e sempre é local.</span><span class="sxs-lookup"><span data-stu-id="cbedf-109">An MSP lives within the process space of the application and is always local.</span></span>

<span data-ttu-id="cbedf-110">Um par de TSP/MSP pode ser considerado como tendo um caminho de comunicação privada virtual.</span><span class="sxs-lookup"><span data-stu-id="cbedf-110">A TSP/MSP pair can be regarded as having a virtual private communication path.</span></span> <span data-ttu-id="cbedf-111">As informações podem ser enviadas entre os dois usando buffers opacos que não são interpretados pelo TAPISRV ou pela DLL TAPI.</span><span class="sxs-lookup"><span data-stu-id="cbedf-111">Information can be sent between the two using opaque buffers that are not interpreted by either TAPISRV or the TAPI DLL.</span></span>

<span data-ttu-id="cbedf-112">Alguns provedores de serviços implementam operações específicas ao hardware envolvido.</span><span class="sxs-lookup"><span data-stu-id="cbedf-112">Some service providers implement operations specific to the hardware involved.</span></span> <span data-ttu-id="cbedf-113">A TAPI 2. x fornece acesso a essas operações por meio da função [**lineDevSpecific**](/windows/win32/api/tapi/nf-tapi-linedevspecific) ou [**phoneDevSpecific**](/windows/win32/api/tapi/nf-tapi-phonedevspecific) .</span><span class="sxs-lookup"><span data-stu-id="cbedf-113">TAPI 2.x provides access to such operations through the [**lineDevSpecific**](/windows/win32/api/tapi/nf-tapi-linedevspecific) or [**phoneDevSpecific**](/windows/win32/api/tapi/nf-tapi-phonedevspecific) function.</span></span> <span data-ttu-id="cbedf-114">A TAPI 3. x expõe [interfaces específicas do provedor](./provider-specific-interfaces.md).</span><span class="sxs-lookup"><span data-stu-id="cbedf-114">TAPI 3.x exposes [provider-specific Interfaces](./provider-specific-interfaces.md).</span></span>

<span data-ttu-id="cbedf-115">O diagrama a seguir ilustra o fluxo de controles e informações, mostrando um TSP autônomo (Unimodem) e um par de TSP/MSP (H. 323).</span><span class="sxs-lookup"><span data-stu-id="cbedf-115">The following diagram illustrates the flow of controls and information, showing one stand-alone TSP (Unimodem) and one TSP/MSP pair (H.323).</span></span>

![TSP autônomo e fluxo de dados e controle de TSP/MSP emparelhados](images/tsp-msp1.png)

<span data-ttu-id="cbedf-117">O diagrama a seguir ilustra o progresso de uma chamada de entrada que envolve um TSP e um MSP.</span><span class="sxs-lookup"><span data-stu-id="cbedf-117">The following diagram illustrates the progress of an incoming call that involves both a TSP and an MSP.</span></span>

![chamada de entrada com um TSP e um MSP](images/tspmspin.png)

## <a name="incoming-call-setup"></a><span data-ttu-id="cbedf-119">Configuração de chamada de entrada</span><span class="sxs-lookup"><span data-stu-id="cbedf-119">Incoming Call Setup</span></span>

-   <span data-ttu-id="cbedf-120">O TSP envia uma mensagem de [**\_ NewCall de linha**](line-newcall.md) para TAPISRV.</span><span class="sxs-lookup"><span data-stu-id="cbedf-120">The TSP sends a [**LINE\_NEWCALL**](line-newcall.md) message to TAPISRV.</span></span> <span data-ttu-id="cbedf-121">O [**estado de chamada**](./linecallstate--constants.md) é \_ oferta de LINECALLSTATE.</span><span class="sxs-lookup"><span data-stu-id="cbedf-121">The [**call state**](./linecallstate--constants.md) is LINECALLSTATE\_OFFERING.</span></span>
-   <span data-ttu-id="cbedf-122">TAPISRV notifica os clientes sobre a chamada.</span><span class="sxs-lookup"><span data-stu-id="cbedf-122">TAPISRV notifies clients of the call.</span></span>
-   <span data-ttu-id="cbedf-123">TAPI3 cria o objeto de chamada TAPI e, em seguida, chama [**ITMSPAddress:: CreateMSPCall**](/windows/win32/api/tapi3/nf-tapi3-itmspaddress-createmspcall), que é implementado pelo msp.</span><span class="sxs-lookup"><span data-stu-id="cbedf-123">TAPI3 creates the TAPI Call object, then calls [**ITMSPAddress::CreateMSPCall**](/windows/win32/api/tapi3/nf-tapi3-itmspaddress-createmspcall), which is implemented by the MSP.</span></span>
-   <span data-ttu-id="cbedf-124">O MSP cria um objeto de chamada MSP e fluxos padrão com base nos [**tipos de mídia**](./tapimediatype--constants.md) necessários para a chamada.</span><span class="sxs-lookup"><span data-stu-id="cbedf-124">The MSP creates an MSP Call object and default streams based on the [**media types**](./tapimediatype--constants.md) required for the call.</span></span> <span data-ttu-id="cbedf-125">Ele retorna um ponteiro IUnknown para o objeto de chamada MSP.</span><span class="sxs-lookup"><span data-stu-id="cbedf-125">It returns an IUnknown pointer to the MSP call object.</span></span>
-   <span data-ttu-id="cbedf-126">TAPI3 agrega o objeto de chamada MSP ao objeto de chamada TAPI, tornando interfaces como [**ITStreamControl**](/windows/win32/api/tapi3if/nn-tapi3if-itstreamcontrol) disponíveis para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="cbedf-126">TAPI3 aggregates the MSP Call object into the TAPI Call object, making interfaces such as [**ITStreamControl**](/windows/win32/api/tapi3if/nn-tapi3if-itstreamcontrol) available to the application.</span></span> <span data-ttu-id="cbedf-127">Em seguida, ele notifica a aplicação da nova chamada.</span><span class="sxs-lookup"><span data-stu-id="cbedf-127">It then notifies the application of the new call.</span></span>

<span data-ttu-id="cbedf-128">O aplicativo pode então usar métodos como [**ITStream:: SelectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal) para concluir preparações para a conclusão da chamada.</span><span class="sxs-lookup"><span data-stu-id="cbedf-128">The application may then use methods such as [**ITStream::SelectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal) to complete preparations for call completion.</span></span>

## <a name="incoming-call-completion"></a><span data-ttu-id="cbedf-129">Conclusão de chamada de entrada</span><span class="sxs-lookup"><span data-stu-id="cbedf-129">Incoming Call Completion</span></span>

-   <span data-ttu-id="cbedf-130">O aplicativo chama [**ITBasicCallControl:: answer**](/windows/win32/api/tapi3if/nf-tapi3if-itbasiccallcontrol-answer).</span><span class="sxs-lookup"><span data-stu-id="cbedf-130">The application calls [**ITBasicCallControl::Answer**](/windows/win32/api/tapi3if/nf-tapi3if-itbasiccallcontrol-answer).</span></span>
-   <span data-ttu-id="cbedf-131">TAPI3 chama [**lineAnswer**](/windows/win32/api/tapi/nf-tapi-lineanswer).</span><span class="sxs-lookup"><span data-stu-id="cbedf-131">TAPI3 calls [**lineAnswer**](/windows/win32/api/tapi/nf-tapi-lineanswer).</span></span>
-   <span data-ttu-id="cbedf-132">TAPISERV chama [**TSPI \_ lineAnswer**](/windows/win32/api/tspi/nf-tspi-tspi_lineanswer).</span><span class="sxs-lookup"><span data-stu-id="cbedf-132">TAPISERV calls [**TSPI\_lineAnswer**](/windows/win32/api/tspi/nf-tspi-tspi_lineanswer).</span></span>
-   <span data-ttu-id="cbedf-133">O TSP inicia o streaming de chamadas.</span><span class="sxs-lookup"><span data-stu-id="cbedf-133">The TSP initiates call streaming.</span></span> <span data-ttu-id="cbedf-134">Normalmente, o TSP envia uma mensagem para o MSP correspondente e o MSP inicia os fluxos.</span><span class="sxs-lookup"><span data-stu-id="cbedf-134">Usually, the TSP sends a message to the corresponding MSP, and the MSP starts the streams.</span></span> <span data-ttu-id="cbedf-135">Em algumas implementações do TSP/MSP, o TSP inicia os fluxos.</span><span class="sxs-lookup"><span data-stu-id="cbedf-135">In some TSP/MSP implementations, the TSP starts the streams.</span></span>

## <a name="tspmsp-communication-during-call-progress"></a><span data-ttu-id="cbedf-136">Comunicação do TSP/MSP durante o andamento da chamada</span><span class="sxs-lookup"><span data-stu-id="cbedf-136">TSP/MSP Communication During Call Progress</span></span>

<span data-ttu-id="cbedf-137">Após a chamada estar em andamento, o TSP e o MSP se comunicam passando buffers opacos por meio de TAPISRV e TAPI3.</span><span class="sxs-lookup"><span data-stu-id="cbedf-137">After the call is in progress, the TSP and the MSP communicate by passing opaque buffers through TAPISRV and TAPI3.</span></span>

-   <span data-ttu-id="cbedf-138">O TSP envia informações para o MSP enviando a mensagem de [**linha \_ SENDMSPDATA**](line-sendmspdata.md) para TAPISRV.</span><span class="sxs-lookup"><span data-stu-id="cbedf-138">The TSP sends information to the MSP by sending the [**LINE\_SENDMSPDATA**](line-sendmspdata.md) message to TAPISRV.</span></span>
-   <span data-ttu-id="cbedf-139">O MSP recebe informações do TSP por meio do método [**ITMSPAddress:: ReceiveTSPData**](/windows/win32/api/tapi3/nf-tapi3-itmspaddress-receivetspdata) .</span><span class="sxs-lookup"><span data-stu-id="cbedf-139">The MSP receives information from the TSP through the [**ITMSPAddress::ReceiveTSPData**](/windows/win32/api/tapi3/nf-tapi3-itmspaddress-receivetspdata) method.</span></span> <span data-ttu-id="cbedf-140">Se os dados estiverem relacionados a um objeto de chamada MSP, um ponteiro de interface para o objeto de chamada MSP será fornecido como um parâmetro desse método.</span><span class="sxs-lookup"><span data-stu-id="cbedf-140">If the data is related to a MSP call object, an interface pointer to the MSP call object is provided as a parameter of that method.</span></span>
-   <span data-ttu-id="cbedf-141">O MSP envia informações para o TSP enviando um evento MSP \_ tsp \_ data para TAPI 3.</span><span class="sxs-lookup"><span data-stu-id="cbedf-141">The MSP sends information to the TSP by sending a MSP\_TSP\_DATA event to TAPI 3.</span></span>
-   <span data-ttu-id="cbedf-142">O TSP recebe informações do MSP por meio da função [**TSPI \_ lineReceiveMSPData**](/windows/win32/api/tspi/nf-tspi-tspi_linereceivemspdata) .</span><span class="sxs-lookup"><span data-stu-id="cbedf-142">The TSP receives information from the MSP through the [**TSPI\_lineReceiveMSPData**](/windows/win32/api/tspi/nf-tspi-tspi_linereceivemspdata) function.</span></span>

<span data-ttu-id="cbedf-143">O processo exato e o conteúdo de comunicação entre provedores de serviço é específico para um determinado conjunto de TSP/MSP.</span><span class="sxs-lookup"><span data-stu-id="cbedf-143">The exact process and content of communication between service providers is specific to a given TSP/MSP set.</span></span>

> [!Note]  
> <span data-ttu-id="cbedf-144">Para chamadas de saída, o MSP normalmente conhece a chamada antes do TSP.</span><span class="sxs-lookup"><span data-stu-id="cbedf-144">For outgoing calls, the MSP typically knows about the call before the TSP.</span></span> <span data-ttu-id="cbedf-145">Se o MSP tentar se comunicar com o TSP antes que o TSP seja informado sobre uma chamada, a comunicação falhará.</span><span class="sxs-lookup"><span data-stu-id="cbedf-145">If the MSP tries to communicate with the TSP before the TSP is informed about a call, the communication will fail.</span></span> <span data-ttu-id="cbedf-146">Quando o MSP e o TSP precisam trocar informações relacionadas a uma chamada específica, o TSP deve iniciar a comunicação.</span><span class="sxs-lookup"><span data-stu-id="cbedf-146">When the MSP and the TSP need to exchange information concerning a specific call, the TSP should initiate communication.</span></span>

 

 

 
