---
description: Na arquitetura TAPI, todos os TSPs são executados no contexto de TAPISRV, que é implementado como um processo de serviço no SVCHOST.
ms.assetid: f47662f9-2fca-4044-ab26-617e5b1f9eae
title: Arquitetura MSP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e8c1229ddce90f79c122c47572b4567d230b0b4e
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104370558"
---
# <a name="msp-architecture"></a><span data-ttu-id="708bc-103">Arquitetura MSP</span><span class="sxs-lookup"><span data-stu-id="708bc-103">MSP Architecture</span></span>

<span data-ttu-id="708bc-104">Na arquitetura TAPI, todos os TSPs são executados no contexto de TAPISRV, que é implementado como um processo de serviço no SVCHOST.</span><span class="sxs-lookup"><span data-stu-id="708bc-104">In TAPI architecture, all TSPs are run in the context of TAPISRV, which is implemented as a service process within SVCHOST.</span></span> <span data-ttu-id="708bc-105">Os aplicativos TAPI residem em seu próprio processo.</span><span class="sxs-lookup"><span data-stu-id="708bc-105">TAPI applications live in their own process.</span></span> <span data-ttu-id="708bc-106">Os aplicativos TAPI carregam Tapi3.dll e qualquer MSPs necessária em seu próprio processo, e a DLL TAPI se comunica com o TAPISRV por meio de uma interface RPC privada.</span><span class="sxs-lookup"><span data-stu-id="708bc-106">TAPI applications load Tapi3.dll and any needed MSPs into their own process, and the TAPI DLL communicates with TAPISRV through a private RPC interface.</span></span> <span data-ttu-id="708bc-107">O diagrama a seguir ilustra a interação desses componentes.</span><span class="sxs-lookup"><span data-stu-id="708bc-107">The following diagram illustrates the interaction of these components.</span></span>

![interações entre TapiSrv, aplicativos TAPI e MSPs](images/tsp-msp1.png)

<span data-ttu-id="708bc-109">Um MSP (provedor de serviços de mídia) fornece streaming de mídia usando as abstrações de terminais, fluxos e subfluxos.</span><span class="sxs-lookup"><span data-stu-id="708bc-109">A media service provider (MSP) provides media streaming using the abstractions of Terminals, Streams, and SubStreams.</span></span>

<span data-ttu-id="708bc-110">Um terminal é um coletor ou origem para um fluxo de mídia.</span><span class="sxs-lookup"><span data-stu-id="708bc-110">A Terminal is a sink or source for a media stream.</span></span> <span data-ttu-id="708bc-111">Pode ser um objeto físico, como um orador ou um microfone, ou pode ser uma abstração de um dispositivo, como uma janela de vídeo.</span><span class="sxs-lookup"><span data-stu-id="708bc-111">It may be a physical object, such as a speaker or a microphone, or it may be an abstraction of a device, such as a video window.</span></span> <span data-ttu-id="708bc-112">O [objeto terminal](terminal-object.md) expõe a interface [**ITTerminal**](/windows/win32/api/tapi3if/nn-tapi3if-itterminal) .</span><span class="sxs-lookup"><span data-stu-id="708bc-112">The [Terminal Object](terminal-object.md) exposes the [**ITTerminal**](/windows/win32/api/tapi3if/nn-tapi3if-itterminal) interface.</span></span> <span data-ttu-id="708bc-113">A classe de terminal é descrita pelo GUID de [**classe de terminal**](terminal-class.md) .</span><span class="sxs-lookup"><span data-stu-id="708bc-113">The class of terminal is described by the [**Terminal Class**](terminal-class.md) GUID.</span></span> <span data-ttu-id="708bc-114">Um MSP pode definir suas próprias classes de terminal.</span><span class="sxs-lookup"><span data-stu-id="708bc-114">An MSP may define its own terminal classes.</span></span>

<span data-ttu-id="708bc-115">Os fluxos dividem a mídia de uma chamada com base no tipo ou tipo de [**mídia**](tapimediatype--constants.md) , na [**direção**](/windows/desktop/api/Tapi3if/ne-tapi3if-terminal_direction)do fluxo e no endereço de destino da mídia.</span><span class="sxs-lookup"><span data-stu-id="708bc-115">Streams divide the media of a call based on the [**media type**](tapimediatype--constants.md) or type, the stream's [**direction**](/windows/desktop/api/Tapi3if/ne-tapi3if-terminal_direction), and the destination address of the media.</span></span> <span data-ttu-id="708bc-116">Por exemplo, um fluxo de áudio de entrada de um modem é um objeto de fluxo, um fluxo de vídeo de saída para um endereço IP e a porta é um objeto de fluxo, os fluxos de vídeo provenientes de um grupo de multicast IP também são considerados como um objeto de fluxo.</span><span class="sxs-lookup"><span data-stu-id="708bc-116">For example, an incoming audio stream from a modem is a stream object, an outgoing video stream to an IP address and port is a stream object, the video streams coming from a IP multicast group are also considered as one stream object.</span></span> <span data-ttu-id="708bc-117">O objeto de fluxo é representado pela interface [**ITStreamControl**](/windows/win32/api/tapi3if/nn-tapi3if-itstreamcontrol) .</span><span class="sxs-lookup"><span data-stu-id="708bc-117">The Stream object is represented by the [**ITStreamControl**](/windows/win32/api/tapi3if/nn-tapi3if-itstreamcontrol) interface.</span></span>

<span data-ttu-id="708bc-118">Os subfluxos permitem um controle mais preciso sobre a mídia.</span><span class="sxs-lookup"><span data-stu-id="708bc-118">SubStreams allow finer control over the media.</span></span> <span data-ttu-id="708bc-119">Por exemplo, no caso de multicast IP, o objeto de fluxo de vídeo de entrada pode representar várias pessoas.</span><span class="sxs-lookup"><span data-stu-id="708bc-119">For example, in the IP multicast case, the incoming video stream object might represent several people.</span></span> <span data-ttu-id="708bc-120">O aplicativo provavelmente desejará que cada participante tenha um processador separado.</span><span class="sxs-lookup"><span data-stu-id="708bc-120">The application will most likely want each participant to have a separate renderer.</span></span> <span data-ttu-id="708bc-121">O fluxo de vídeo de entrada pode ser dividido em vários subfluxos, um para cada pessoa.</span><span class="sxs-lookup"><span data-stu-id="708bc-121">The incoming video stream can be divided into several substreams, one for each person.</span></span> <span data-ttu-id="708bc-122">Um subfluxo corresponderia a uma pessoa e pode ser configurado e controlado separadamente.</span><span class="sxs-lookup"><span data-stu-id="708bc-122">One substream would correspond to one person, and can be configured and controlled separately.</span></span> <span data-ttu-id="708bc-123">O objeto de substream é representado pela interface [**ITSubStreamControl**](/windows/win32/api/tapi3if/nn-tapi3if-itsubstreamcontrol) .</span><span class="sxs-lookup"><span data-stu-id="708bc-123">The SubStream object is represented by the [**ITSubStreamControl**](/windows/win32/api/tapi3if/nn-tapi3if-itsubstreamcontrol) interface.</span></span>

<span data-ttu-id="708bc-124">Quando um aplicativo chama [**ITAddress:: createcall**](/windows/desktop/api/tapi3if/nf-tapi3if-itaddress-createcall) para configurar uma chamada, ele deve especificar o tipo de mídia necessário.</span><span class="sxs-lookup"><span data-stu-id="708bc-124">When an application calls [**ITAddress::CreateCall**](/windows/desktop/api/tapi3if/nf-tapi3if-itaddress-createcall) to set up a call, it must specify the type of media required.</span></span> <span data-ttu-id="708bc-125">Em uma chamada de saída, ele simplesmente informa a TAPI quando a chamada é criada.</span><span class="sxs-lookup"><span data-stu-id="708bc-125">On an outgoing call, it simply tells TAPI when the call is created.</span></span> <span data-ttu-id="708bc-126">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="708bc-126">For example:</span></span>

``` syntax
HRESULT hr = pAddress->CreateCall( 
       pszDestAddress, 
       lAddressType, 
       TAPIMEDIATYPE_AUDIO | TAPIMEDIATYPE_VIDEO, 
       &pCall 
       ); 
// If (hr != S_OK ) process the error here
```

<span data-ttu-id="708bc-127">Nesse caso, o aplicativo está criando uma chamada de vídeo de saída de áudio.</span><span class="sxs-lookup"><span data-stu-id="708bc-127">In this case, the application is creating an outgoing audio-video call.</span></span>

<span data-ttu-id="708bc-128">Os tipos de mídia passados indicam a mídia em que o aplicativo está interessado durante o tempo de vida da chamada.</span><span class="sxs-lookup"><span data-stu-id="708bc-128">The media types passed in indicate the media that the application is interested in over the lifetime of the call.</span></span> <span data-ttu-id="708bc-129">Por exemplo, o aplicativo pode especificar áudio e vídeo ao criar a chamada, mas selecionar somente terminais de áudio no início.</span><span class="sxs-lookup"><span data-stu-id="708bc-129">For example, the application may specify audio and video when creating the call, but select only audio terminals at the beginning.</span></span> <span data-ttu-id="708bc-130">O MSP começará a transmitir apenas o áudio, mas não rejeitará uma solicitação de vídeo local ou remota feita posteriormente no tempo de vida da chamada.</span><span class="sxs-lookup"><span data-stu-id="708bc-130">The MSP will start streaming only audio, but will not reject a local or remote video request made later in the lifetime of the call.</span></span>

<span data-ttu-id="708bc-131">Quando o aplicativo chama [**ITBasicCallControl:: Connect**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-connect), a TAPI 3 chama [**TSPI \_ lineMakeCall**](/windows/win32/api/tspi/nf-tspi-tspi_linemakecall) no tsp.</span><span class="sxs-lookup"><span data-stu-id="708bc-131">When the application then calls [**ITBasicCallControl::Connect**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-connect), TAPI 3 calls [**TSPI\_lineMakeCall**](/windows/win32/api/tspi/nf-tspi-tspi_linemakecall) in the TSP.</span></span> <span data-ttu-id="708bc-132">Depois que uma chamada é estabelecida, o MSP e o TSP podem se comunicar conforme necessário.</span><span class="sxs-lookup"><span data-stu-id="708bc-132">After a call is established, the MSP and TSP can communicate as necessary.</span></span>

<span data-ttu-id="708bc-133">Quando uma chamada está desconectando, cabe ao MSP e ao TSP se comunicarem sobre a subdivisão da chamada.</span><span class="sxs-lookup"><span data-stu-id="708bc-133">When a call is disconnecting, it is up to the MSP and TSP to communicate about tearing down the call.</span></span> <span data-ttu-id="708bc-134">Tapi3.dll chamará [**TSPI \_ lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop) se o aplicativo chamar [**Disconnect**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-disconnect).</span><span class="sxs-lookup"><span data-stu-id="708bc-134">Tapi3.dll will call [**TSPI\_lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop) if the application calls [**Disconnect**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-disconnect).</span></span>

 

 
