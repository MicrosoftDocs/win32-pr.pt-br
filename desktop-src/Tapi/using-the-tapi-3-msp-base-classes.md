---
description: O procedimento a seguir descreve como implementar um MSP usando a ATL versão 2,1 ou a ATL versão 3,0 e as classes base MSP.
ms.assetid: 7485c34a-3c8a-412f-9cb9-8eb895084292
title: Usando as classes base TAPI 3 MSP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: eb8ad4fd160cf0fc4c7dd682a44f3a4ff0bcec25
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "105813043"
---
# <a name="using-the-tapi-3-msp-base-classes"></a><span data-ttu-id="f79fc-103">Usando as classes base TAPI 3 MSP</span><span class="sxs-lookup"><span data-stu-id="f79fc-103">Using The TAPI 3 MSP Base Classes</span></span>

<span data-ttu-id="f79fc-104">O procedimento a seguir descreve como implementar um MSP usando a ATL versão 2,1 ou a ATL versão 3,0 e as classes base MSP.</span><span class="sxs-lookup"><span data-stu-id="f79fc-104">The following procedure describes how to implement an MSP using ATL version 2.1 or ATL version 3.0 and the MSP base classes.</span></span> <span data-ttu-id="f79fc-105">Para obter mais informações e uma lista de bibliotecas e cabeçalhos, consulte [classes base TAPI 3 MSP](tapi-3-msp-base-classes.md).</span><span class="sxs-lookup"><span data-stu-id="f79fc-105">For more information and a list of libraries and headers, see [TAPI 3 MSP Base Classes](tapi-3-msp-base-classes.md).</span></span> <span data-ttu-id="f79fc-106">O conteúdo contido neste tópico pressupõe que o desenvolvedor tem um entendimento prático da ATL e COM e tem experiência na implementação de DLLs COM usando a ATL.</span><span class="sxs-lookup"><span data-stu-id="f79fc-106">The content contained in this topic assumes that the developer has a working understanding of ATL and COM, and has experience implementing COM DLLs using ATL.</span></span>

<span data-ttu-id="f79fc-107">**Para implementar e MSP usando ATL 2,1 ou ATL 3,0**</span><span class="sxs-lookup"><span data-stu-id="f79fc-107">**To implement and MSP using ATL 2.1 or ATL 3.0**</span></span>

1.  <span data-ttu-id="f79fc-108">Crie um arquivo IDL para seu MSP.</span><span class="sxs-lookup"><span data-stu-id="f79fc-108">Create an IDL file for your MSP.</span></span> <span data-ttu-id="f79fc-109">Esse arquivo define um CLSID para o MSP.</span><span class="sxs-lookup"><span data-stu-id="f79fc-109">This file defines a CLSID for your MSP.</span></span> <span data-ttu-id="f79fc-110">Declare sua "coclass" do MSP como implementando a interface [**ITMSPAddress**](/windows/desktop/api/msp/nn-msp-itmspaddress) e declare essa interface como a interface padrão em seu objeto de classe.</span><span class="sxs-lookup"><span data-stu-id="f79fc-110">Declare your MSP "coclass" as implementing the [**ITMSPAddress**](/windows/desktop/api/msp/nn-msp-itmspaddress) interface, and declare this interface as the default interface on your class object.</span></span> <span data-ttu-id="f79fc-111">Para a definição de **ITMSPAddress**, importe o arquivo "msp. idl".</span><span class="sxs-lookup"><span data-stu-id="f79fc-111">For the definition of **ITMSPAddress**, import the file "msp.idl".</span></span> <span data-ttu-id="f79fc-112">Inclua sua "coclasse" MSP em uma biblioteca de tipos para seu MSP.</span><span class="sxs-lookup"><span data-stu-id="f79fc-112">Include your MSP "coclass" in a type library for your MSP.</span></span> <span data-ttu-id="f79fc-113">Se o seu MSP der suporte a interfaces privadas (personalizadas), defina-as aqui e inclua-as em sua biblioteca de tipos.</span><span class="sxs-lookup"><span data-stu-id="f79fc-113">If your MSP supports private (custom) interfaces, define them here and include them in your type library.</span></span> <span data-ttu-id="f79fc-114">O exemplo de código a seguir é um arquivo IDL, conforme descrito acima, sem interfaces personalizadas.</span><span class="sxs-lookup"><span data-stu-id="f79fc-114">The following code example is an IDL file as described above, without custom interfaces.</span></span>

    ``` syntax
    import "msp.idl";
    [
          uuid(4DDB6D35-3BC1-11d2-86F2-006008B0E5D2),
          version(2.0),
          helpstring("Wave MSP 2.0 Type Library")
    ]
    library WAVEMSPLib
    {
    importlib("stdole32.tlb");
    importlib("stdole2.tlb");

    [
    uuid(4DDB6D36-3BC1-11d2-86F2-006008B0E5D2),
    helpstring("Wave MSP Class")
    ]
    coclass WaveMSP
    {
    [default] interface ITMSPAddress;
    };
    };
    ```

2.  <span data-ttu-id="f79fc-115">Modifique seu TSP para anunciar o CLSID do seu MSP quando Tapi3.dll solicitá-lo.</span><span class="sxs-lookup"><span data-stu-id="f79fc-115">Modify your TSP to advertise the CLSID of your MSP when Tapi3.dll requests it.</span></span> <span data-ttu-id="f79fc-116">Verifique se (1) seu TSP pode negociar \_ a TAPI VERSION3 \_ 0 ou superior na função TSPI [**TSPI \_ lineNegotiateTSPIVersion**](/windows/win32/api/tspi/nf-tspi-tspi_linenegotiatetspiversion), (2) sua estrutura de [**LINEDEVCAPS**](/windows/win32/api/tapi/ns-tapi-linedevcaps) do TSP tem o \_ sinalizador LINEDEVCAPFLAGS MSP definido no membro **dwDevCapFlags** e (3) o seu tsp retorna o CLSID msp na função TSPI [**\_**](/windows/win32/api/tspi/nf-tspi-tspi_linemspidentify)TSPI lineMSPIdentify.</span><span class="sxs-lookup"><span data-stu-id="f79fc-116">Ensure that (1) your TSP can negotiate TAPI\_VERSION3\_0 or higher in the TSPI function [**TSPI\_lineNegotiateTSPIVersion**](/windows/win32/api/tspi/nf-tspi-tspi_linenegotiatetspiversion), (2) your TSP [**LINEDEVCAPS**](/windows/win32/api/tapi/ns-tapi-linedevcaps) structure has the LINEDEVCAPFLAGS\_MSP flag set in the **dwDevCapFlags** member, and (3) your TSP returns your MSP CLSID in the TSPI function [**TSPI\_lineMSPIdentify**](/windows/win32/api/tspi/nf-tspi-tspi_linemspidentify).</span></span> <span data-ttu-id="f79fc-117">Deve ser o mesmo CLSID especificado em seu arquivo IDL; por exemplo, a segunda linha "UUID" no arquivo IDL de exemplo na etapa anterior.</span><span class="sxs-lookup"><span data-stu-id="f79fc-117">This should be the same CLSID specified in your IDL file; for example, the second "uuid" line in the example IDL file in the previous step.</span></span>
3.  <span data-ttu-id="f79fc-118">Compile o aplicativo de exemplo MSPBase, localizado no SDK (Software Development Kit) da plataforma, para criar a biblioteca MSPBaseSample. lib.</span><span class="sxs-lookup"><span data-stu-id="f79fc-118">Compile the MSPBase sample application, located in the Platform Software Development Kit (SDK), to create the MSPBaseSample.lib library.</span></span>
4.  <span data-ttu-id="f79fc-119">Vincule sua DLL MSP com a biblioteca MSPBaseSample. lib.</span><span class="sxs-lookup"><span data-stu-id="f79fc-119">Link your MSP DLL with the MSPBaseSample.lib library.</span></span>
5.  <span data-ttu-id="f79fc-120">Inclua Mspbase. h do SDK para definições de classe base MSP.</span><span class="sxs-lookup"><span data-stu-id="f79fc-120">Include Mspbase.h from the SDK for MSP base class definitions.</span></span>
6.  <span data-ttu-id="f79fc-121">Implemente suas exportações de DLL (por exemplo, DllMain).</span><span class="sxs-lookup"><span data-stu-id="f79fc-121">Implement your DLL exports (for example, DllMain).</span></span> <span data-ttu-id="f79fc-122">Microsoft Visual C++ irá gerá-los para você.</span><span class="sxs-lookup"><span data-stu-id="f79fc-122">Microsoft Visual C++ will generate these for you.</span></span> <span data-ttu-id="f79fc-123">Em DllMain, em DLL \_ processo \_ anexar e \_ \_ reanexar processo dll, respectivamente, use as macros **MSPLOGREGISTER** e **MSPLOGDEREGISTER** para habilitar os recursos de log para sua dll.</span><span class="sxs-lookup"><span data-stu-id="f79fc-123">In DllMain, on DLL\_PROCESS\_ATTACH and DLL\_PROCESS\_DETACH, respectively, use the **MSPLOGREGISTER** and **MSPLOGDEREGISTER** macros to enable up logging features for your DLL.</span></span> <span data-ttu-id="f79fc-124">Especifique o nome da sua DLL na chamada **MSPLOGDEREGISTER** .</span><span class="sxs-lookup"><span data-stu-id="f79fc-124">Specify the name of your DLL in the **MSPLOGDEREGISTER** call.</span></span>
7.  <span data-ttu-id="f79fc-125">Use a macro de LOG, definida em Msplog. h, para gerar mensagens de rastreamento da mesma maneira que as classes base.</span><span class="sxs-lookup"><span data-stu-id="f79fc-125">Use the LOG macro, defined in Msplog.h, to output trace messages in the same fashion as the base classes.</span></span> <span data-ttu-id="f79fc-126">Defina o símbolo de pré-processador MSPLOG para incluir o registro em log em sua DLL; Deixe-o indefinido para criar uma DLL que não tenha registro em log.</span><span class="sxs-lookup"><span data-stu-id="f79fc-126">Define the MSPLOG preprocessor symbol to include logging in your DLL; leave it undefined to build a DLL that does not have logging.</span></span>
8.  <span data-ttu-id="f79fc-127">Derive uma classe de CMSPAddress que implementa endereços para seu MSP.</span><span class="sxs-lookup"><span data-stu-id="f79fc-127">Derive a class from CMSPAddress that implements addresses for your MSP.</span></span> <span data-ttu-id="f79fc-128">Declare um mapa de objeto ATL global que instrui a ATL a criar uma instância de sua classe Address quando solicitado a **Cocriar** no CLSID especificado em seu arquivo IDL.</span><span class="sxs-lookup"><span data-stu-id="f79fc-128">Declare a global ATL object map which instructs ATL to create an instance of your address class when asked to **CoCreate** on the CLSID you specified in your IDL file.</span></span> <span data-ttu-id="f79fc-129">Além disso, derive sua classe address do modelo ATL **CComCoClass** e inclua uma \_ declaração Declare Registry \_ ResourceId em sua classe address.</span><span class="sxs-lookup"><span data-stu-id="f79fc-129">Also, derive your address class from the ATL **CComCoClass** template, and include a DECLARE\_REGISTRY\_RESOURCEID declaration in your address class.</span></span> <span data-ttu-id="f79fc-130">Construa um script de recurso e um arquivo de cabeçalho correspondentes, como para qualquer outra DLL de COM ATL.</span><span class="sxs-lookup"><span data-stu-id="f79fc-130">Construct a corresponding resource script and header file, as for any other ATL COM DLL.</span></span>
9.  <span data-ttu-id="f79fc-131">Implemente as substituições de CMSPAddress necessárias para sua classe de endereço.</span><span class="sxs-lookup"><span data-stu-id="f79fc-131">Implement the required CMSPAddress overrides for your address class.</span></span> <span data-ttu-id="f79fc-132">Para [**MSPAddressAddRef**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-mspaddressaddref) e [**MSPAddressRelease**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-mspaddressrelease), chame os modelos de função auxiliar fornecidos.</span><span class="sxs-lookup"><span data-stu-id="f79fc-132">For [**MSPAddressAddRef**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-mspaddressaddref) and [**MSPAddressRelease**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-mspaddressrelease), call the provided helper function templates.</span></span> <span data-ttu-id="f79fc-133">Para [**GetCallMediaTypes**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-getcallmediatypes), basta retornar um bitmap **DWORD** com todas as suas TAPIMEDIAMODEs or com suporte para MSP juntas.</span><span class="sxs-lookup"><span data-stu-id="f79fc-133">For [**GetCallMediaTypes**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-getcallmediatypes), simply return a **DWORD** bitmap with all of your MSP-supported TAPIMEDIAMODEs ORed together.</span></span> <span data-ttu-id="f79fc-134">Para [**CreateMSPCall**](/windows/desktop/api/msp/nf-msp-itmspaddress-createmspcall) e [**ShutdownMSPCall**](/windows/desktop/api/msp/nf-msp-itmspaddress-shutdownmspcall), retorne e \_ NOTIMPL e compile e vincule seu MSP neste ponto.</span><span class="sxs-lookup"><span data-stu-id="f79fc-134">For [**CreateMSPCall**](/windows/desktop/api/msp/nf-msp-itmspaddress-createmspcall) and [**ShutdownMSPCall**](/windows/desktop/api/msp/nf-msp-itmspaddress-shutdownmspcall), return E\_NOTIMPL and compile and link your MSP at this point.</span></span> <span data-ttu-id="f79fc-135">Agora, verifique se você pode registrar e criar uma instância do MSP a partir de aplicativos TAPI 3, mas não criar chamadas com êxito.</span><span class="sxs-lookup"><span data-stu-id="f79fc-135">Now, verify that you can register and instantiate your MSP from TAPI 3 applications, but not successfully create calls.</span></span>
10. <span data-ttu-id="f79fc-136">Derive uma classe de CMSPCallMultiGraph para implementar seus objetos de chamada MSP.</span><span class="sxs-lookup"><span data-stu-id="f79fc-136">Derive a class from CMSPCallMultiGraph to implement your MSP call objects.</span></span> <span data-ttu-id="f79fc-137">Talvez você queira derivar de [**CMSPCallBase**](/windows/desktop/api/Mspcall/nl-mspcall-cmspcallbase) em vez de [**CMSPCallMultiGraph**](/windows/desktop/api/Mspcall/nl-mspcall-cmspcallmultigraph) se o modelo Filter-grafo-per-Stream não atender aos seus requisitos; Isso aumentará a complexidade da tarefa (no momento da redação deste artigo, todos os MSPs derivarão objetos de chamada diretamente do **CMSPCallMultiGraph**).</span><span class="sxs-lookup"><span data-stu-id="f79fc-137">You may want to derive from [**CMSPCallBase**](/windows/desktop/api/Mspcall/nl-mspcall-cmspcallbase) instead of [**CMSPCallMultiGraph**](/windows/desktop/api/Mspcall/nl-mspcall-cmspcallmultigraph) if the filter-graph-per-stream model does not fit your requirements; this will increase the complexity of the task (as of this writing, all MSPs derive call objects directly from **CMSPCallMultiGraph**).</span></span> <span data-ttu-id="f79fc-138">No seu objeto de endereço, implemente [**CreateMSPCall**](/windows/desktop/api/msp/nf-msp-itmspaddress-createmspcall) e [**ShutdownMSPCall**](/windows/desktop/api/msp/nf-msp-itmspaddress-shutdownmspcall) para criar e desligar seu tipo específico de objeto de chamada usando os modelos de função auxiliar fornecidos.</span><span class="sxs-lookup"><span data-stu-id="f79fc-138">In your address object, implement [**CreateMSPCall**](/windows/desktop/api/msp/nf-msp-itmspaddress-createmspcall) and [**ShutdownMSPCall**](/windows/desktop/api/msp/nf-msp-itmspaddress-shutdownmspcall) to create and shut down your specific type of call object using the provided helper function templates.</span></span> <span data-ttu-id="f79fc-139">Em seu objeto de chamada, substitua [**Createstreamobject**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-createstreamobject) para retornar E \_ NOTIMPL.</span><span class="sxs-lookup"><span data-stu-id="f79fc-139">In your call object, override [**CreateStreamObject**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-createstreamobject) to return E\_NOTIMPL.</span></span> <span data-ttu-id="f79fc-140">Substitua [**MSPCallAddRef**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-mspcalladdref) e [**MSPCallRelease**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-mspcallrelease) de maneira idêntica aos métodos de endereço correspondentes.</span><span class="sxs-lookup"><span data-stu-id="f79fc-140">Override [**MSPCallAddRef**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-mspcalladdref) and [**MSPCallRelease**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-mspcallrelease) in a manner identical to the corresponding address methods.</span></span> <span data-ttu-id="f79fc-141">Novamente, você deve ser capaz de compilar e vincular seu MSP; Agora, ele deve ser capaz de criar e desligar chamadas, mas as chamadas não farão streaming útil.</span><span class="sxs-lookup"><span data-stu-id="f79fc-141">Again, you should be able to compile and link your MSP; it should now be able to create and shut down calls, but the calls will not do any useful streaming.</span></span>
11. <span data-ttu-id="f79fc-142">Derive uma classe de CMSPStream para implementar seus objetos de fluxo MSP.</span><span class="sxs-lookup"><span data-stu-id="f79fc-142">Derive a class from CMSPStream to implement your MSP stream objects.</span></span> <span data-ttu-id="f79fc-143">Em seu objeto de chamada, implemente [**Createstreamobject**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-createstreamobject) para criar e inicializar seu objeto Stream (normalmente chamando o ATL **CreateInstance** seguido pelo ATL **\_ InternalQueryInterface** para [**ITStream**](/windows/win32/api/tapi3if/nn-tapi3if-itstream) seguido chamando **init** no seu objeto Stream).</span><span class="sxs-lookup"><span data-stu-id="f79fc-143">In your call object, implement [**CreateStreamObject**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-createstreamobject) to create and initialize your stream object (typically by calling the ATL **CreateInstance** followed by the ATL **\_InternalQueryInterface** for [**ITStream**](/windows/win32/api/tapi3if/nn-tapi3if-itstream) followed by calling **Init** on your stream object).</span></span> <span data-ttu-id="f79fc-144">Para dar suporte a um número fixo de fluxos (isso é comum para MSPs que não dão suporte à modificação de configurações de fluxo por outros pontos de extremidade na chamada), substitua **init**, [**CreateStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstreamcontrol-createstream)e [**RemoveStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstreamcontrol-removestream) em seu objeto de chamada.</span><span class="sxs-lookup"><span data-stu-id="f79fc-144">To support a fixed number of streams (this is common for MSPs which do not support modification of stream configurations by other endpoints on the call), override **Init**, [**CreateStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstreamcontrol-createstream), and [**RemoveStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstreamcontrol-removestream) on your call object.</span></span> <span data-ttu-id="f79fc-145">(A chamada **init** cria todos os fluxos inicialmente, e **CreateStream** e **RemoveStream** retornam os códigos de erro TAPI apropriados para impedir que o aplicativo crie ou remova fluxos).</span><span class="sxs-lookup"><span data-stu-id="f79fc-145">(The call **Init** creates all of your streams initially, and **CreateStream** and **RemoveStream** return the appropriate TAPI error codes to prevent the application from creating or removing streams).</span></span> <span data-ttu-id="f79fc-146">Caso contrário, substitua o método **init** da chamada para criar alguma configuração padrão inicial de fluxos usando os tipos de mídia solicitados para a chamada.</span><span class="sxs-lookup"><span data-stu-id="f79fc-146">Otherwise, override the call's **Init** method to create some initial default configuration of streams using the media types requested for the call.</span></span> <span data-ttu-id="f79fc-147">Ao criar qualquer objeto de fluxo padrão no método **init** de sua chamada, use o método auxiliar [**InternalCreateStream**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-internalcreatestream) .</span><span class="sxs-lookup"><span data-stu-id="f79fc-147">When creating any default stream objects in your call's **Init** method, use the [**InternalCreateStream**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-internalcreatestream) helper method.</span></span>
12. <span data-ttu-id="f79fc-148">Implemente seu objeto Stream.</span><span class="sxs-lookup"><span data-stu-id="f79fc-148">Implement your stream object.</span></span> <span data-ttu-id="f79fc-149">A única substituição necessária é o método [**Get \_ Name**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-get_name) , que simplesmente retorna um nome amigável para o fluxo.</span><span class="sxs-lookup"><span data-stu-id="f79fc-149">The only required override is the [**get\_Name**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-get_name) method, which simply returns a friendly name for the stream.</span></span> <span data-ttu-id="f79fc-150">Além disso, será necessário substituir vários outros métodos.</span><span class="sxs-lookup"><span data-stu-id="f79fc-150">In addition, you will need to override several other methods.</span></span> <span data-ttu-id="f79fc-151">Exatamente quais métodos substituir dependem de sua implementação e quando você decide executar as várias tarefas envolvidas na construção e na desconstrução de seu gráfico de filtro.</span><span class="sxs-lookup"><span data-stu-id="f79fc-151">Exactly which methods to override depends on your implementation and when you decide to perform the various tasks involved in constructing and deconstructing your filter graph.</span></span> <span data-ttu-id="f79fc-152">Essas tarefas incluem a criação de filtros de "transporte" apropriados, codecs e assim por diante, e a inserção deles e sua remoção dos gráficos de filtro nos horários apropriados.</span><span class="sxs-lookup"><span data-stu-id="f79fc-152">These tasks include creating the appropriate "transport" filters, codecs, and so on, and inserting them and removing them from the filter graphs at the appropriate times.</span></span> <span data-ttu-id="f79fc-153">Você também precisará usar a interface [**ITTerminalControl**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol) em objetos de terminal para conectar os terminais selecionados aos seus fluxos.</span><span class="sxs-lookup"><span data-stu-id="f79fc-153">You will also have to use the [**ITTerminalControl**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol) interface on terminal objects to connect the selected terminals to your streams.</span></span> <span data-ttu-id="f79fc-154">Talvez você queira substituir [**SelectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal) e [**UnselectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-unselectterminal) no seu objeto de fluxo para limitar as configurações de terminal que seus fluxos aceitarão; limitar cada fluxo a um único terminal simplificará, especialmente, a construção de seus gráficos de filtro, mas sacrificará a funcionalidade do aplicativo, como visualização de vídeo.</span><span class="sxs-lookup"><span data-stu-id="f79fc-154">You may want to override [**SelectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal) and [**UnselectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-unselectterminal) on your stream object to limit the terminal configurations that your streams will accept; limiting each stream to a single terminal will especially simplify construction of your filter graphs, but will sacrifice application functionality such as video preview.</span></span> <span data-ttu-id="f79fc-155">Dependendo de sua implementação, você posicionará a construção do grafo, a deconstrução e o código de conexão do terminal nos métodos [**StartStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-startstream), [**StopStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-stopstream), [**PauseStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-pausestream), [**Initialize**](/windows/desktop/api/msp/nf-msp-itmspaddress-initialize), [**Shutdown**](/windows/desktop/api/msp/nf-msp-itmspaddress-shutdown), [**SelectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal)e [**UnselectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-unselectterminal) , ou em seus próprios métodos com base na comunicação do tsp privado.</span><span class="sxs-lookup"><span data-stu-id="f79fc-155">Depending on your implementation, you will place your graph construction, deconstruction, and terminal connection code in the [**StartStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-startstream), [**StopStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-stopstream), [**PauseStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-pausestream), [**Initialize**](/windows/desktop/api/msp/nf-msp-itmspaddress-initialize), [**Shutdown**](/windows/desktop/api/msp/nf-msp-itmspaddress-shutdown), [**SelectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal), and [**UnselectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-unselectterminal) methods, or in your own methods based on private TSP communication.</span></span> <span data-ttu-id="f79fc-156">Lembre-se de que um fluxo sem terminais selecionado deve controlar o estado do grafo desejado; uma chamada de **StartStream** seguida de uma chamada de **SelectTerminal** nesse fluxo deve resultar em um fluxo de dados.</span><span class="sxs-lookup"><span data-stu-id="f79fc-156">Be aware that a stream with no terminals selected must track the desired graph state; a **StartStream** call followed by a **SelectTerminal** call on such a stream must result in a data stream.</span></span> <span data-ttu-id="f79fc-157">Substitua a maioria desses métodos para garantir que a construção, a desconstrução, a conexão e a desconexão corretas ocorram em cada caso, dependendo do estado do fluxo.</span><span class="sxs-lookup"><span data-stu-id="f79fc-157">Override most of these methods to ensure that the correct construction, deconstruction, connection, and disconnection happens in each case depending on the state of the stream.</span></span>
13. <span data-ttu-id="f79fc-158">Implemente sua comunicação do TSP.</span><span class="sxs-lookup"><span data-stu-id="f79fc-158">Implement your TSP communication.</span></span> <span data-ttu-id="f79fc-159">Substitua [**CMSPAddress:: ReceiveTSPAddressData**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-receivetspaddressdata) e/ou [**CMSPCallBase:: ReceiveTSPCallData**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-receivetspcalldata)e/ou chamando [**IsEvent**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-postevent) no seu objeto address ou [**HandleStreamEvent**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-handlestreamevent) em seu objeto de chamada (de seus objetos Call ou Stream).</span><span class="sxs-lookup"><span data-stu-id="f79fc-159">Override [**CMSPAddress::ReceiveTSPAddressData**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-receivetspaddressdata) and/or [**CMSPCallBase::ReceiveTSPCallData**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-receivetspcalldata), and/or by calling [**PostEvent**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-postevent) on your address object, or [**HandleStreamEvent**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-handlestreamevent) on your call object (from either your call or stream objects).</span></span>
14. <span data-ttu-id="f79fc-160">Use o CreateEvent em seu objeto address ou HandleStreamEvent em seu objeto de chamada (de seus objetos Call ou Stream) para enviar eventos de mídia de chamada para o aplicativo por meio de Tapi3.dll.</span><span class="sxs-lookup"><span data-stu-id="f79fc-160">Use PostEvent on your address object, or HandleStreamEvent on your call object (from either your call or stream objects) to send call media events to the application via Tapi3.dll.</span></span> <span data-ttu-id="f79fc-161">Normalmente, você fará isso em seu objeto Stream, em métodos substituídos, incluindo os métodos [**ProcessGraphEvent**](/windows/desktop/api/Mspstrm/nf-mspstrm-cmspstream-processgraphevent), [**StopStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-stopstream), [**StartStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-startstream), [**PauseStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-pausestream), [**SelectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal)e [**UnselectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-unselectterminal) , dependendo de como você implementa seus fluxos.</span><span class="sxs-lookup"><span data-stu-id="f79fc-161">You will typically do this on your stream object, in overridden methods including the [**ProcessGraphEvent**](/windows/desktop/api/Mspstrm/nf-mspstrm-cmspstream-processgraphevent), [**StopStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-stopstream), [**StartStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-startstream), [**PauseStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-pausestream), [**SelectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal), and [**UnselectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-unselectterminal) methods, depending on how you implement your streams.</span></span>
15. <span data-ttu-id="f79fc-162">Implemente quaisquer interfaces privadas ou subfluxos desejados em seus objetos existentes (endereço, chamada e fluxo).</span><span class="sxs-lookup"><span data-stu-id="f79fc-162">Implement any desired private interfaces or substreams on your existing objects (address, call, and stream).</span></span> <span data-ttu-id="f79fc-163">Normalmente, não há nenhum.</span><span class="sxs-lookup"><span data-stu-id="f79fc-163">Usually there are none.</span></span> <span data-ttu-id="f79fc-164">Lembre-se de que, ao implementar suas interfaces privadas, especifique o LIBID de sua biblioteca de tipos do seu arquivo IDL.</span><span class="sxs-lookup"><span data-stu-id="f79fc-164">Be aware that when implementing your private interfaces, specify the LIBID of your type library from your IDL file.</span></span> <span data-ttu-id="f79fc-165">Ou seja, os programadores de aplicativos devem usar sua biblioteca de tipos MSP ao usar suas interfaces personalizadas.</span><span class="sxs-lookup"><span data-stu-id="f79fc-165">That is, application programmers must use your MSP type library when using your custom interfaces.</span></span> <span data-ttu-id="f79fc-166">As interfaces padrão do MSP, implementadas nas classes base MSP, usam o Tapi3.dll LIBID e, portanto, são acessíveis a todos os aplicativos TAPI 3.</span><span class="sxs-lookup"><span data-stu-id="f79fc-166">The standard MSP interfaces, implemented in the MSP base classes, use the Tapi3.dll LIBID and are therefore accessible to all TAPI 3 applications.</span></span>
16. <span data-ttu-id="f79fc-167">Se estiver implementando objetos de terminal estáticos ou dinâmicos específicos do MSP para os terminais estáticos padrão (não típicos), você poderá usar as classes base de terminal fornecidas.</span><span class="sxs-lookup"><span data-stu-id="f79fc-167">If implementing MSP-specific static or dynamic terminal objects or replacements for the default static terminals (not typical), you can use the provided terminal base classes.</span></span> <span data-ttu-id="f79fc-168">Você precisará substituir vários métodos em seu objeto de endereço para fornecer métodos alternativos ou adicionais de criação de objetos de terminal.</span><span class="sxs-lookup"><span data-stu-id="f79fc-168">You will have to override various methods on your address object to provide alternative or additional methods of creating terminal objects.</span></span>
17. <span data-ttu-id="f79fc-169">Implemente a interface IObjectSafety em seus objetos de endereço, chamada, fluxo e terminal.</span><span class="sxs-lookup"><span data-stu-id="f79fc-169">Implement the IObjectSafety interface on your Address, Call, Stream, and Terminal objects.</span></span> <span data-ttu-id="f79fc-170">Para usar o [mapeador de expedição](dispatch-mapper.md) para consultar interfaces em seus objetos msp, marque seus objetos como seguros para scripts nessas interfaces.</span><span class="sxs-lookup"><span data-stu-id="f79fc-170">To use [Dispatch Mapper](dispatch-mapper.md) to query for interfaces on your MSP objects, mark your objects as safe for scripting on these interfaces.</span></span> <span data-ttu-id="f79fc-171">Para fazer isso, implemente a interface **IObjectSafety** em seu objeto.</span><span class="sxs-lookup"><span data-stu-id="f79fc-171">To do this, implement the **IObjectSafety** interface on your object.</span></span> <span data-ttu-id="f79fc-172">Derivar de **CMSPObjectSafetyImpl** (uma classe auxiliar fornecida em Msputils. h) e adicionar **IOBJECTSAFETY** ao mapa com ATL de sua classe \_ tornará seus objetos seguros para scripts em todas as interfaces que eles expõem.</span><span class="sxs-lookup"><span data-stu-id="f79fc-172">Deriving from **CMSPObjectSafetyImpl** (a helper class provided in Msputils.h) and adding **IObjectSafety** to your class's ATL COM\_MAP will make your objects safe for scripting on all the interfaces they expose.</span></span> <span data-ttu-id="f79fc-173">Lembre-se de que o uso do mapeador de expedição em objetos MSP pode ser implícito.</span><span class="sxs-lookup"><span data-stu-id="f79fc-173">Be aware that using Dispatch Mapper on MSP objects could be implicit.</span></span> <span data-ttu-id="f79fc-174">O endereço MSP e a chamada MSP são agregados por endereços TAPI e objetos de chamada TAPI.</span><span class="sxs-lookup"><span data-stu-id="f79fc-174">MSP Address and MSP Call are aggregated by TAPI Address and TAPI Call objects.</span></span> <span data-ttu-id="f79fc-175">Se o mapeador de expedição for usado nos objetos TAPI para consultar as interfaces expostas pelos objetos MSP agregados, os objetos MSP agregados serão consultados quanto à segurança das interfaces solicitadas.</span><span class="sxs-lookup"><span data-stu-id="f79fc-175">If Dispatch Mapper is used on the TAPI objects to query for the interfaces exposed by the aggregated MSP objects, the aggregated MSP objects will be queried for safety of the requested interfaces.</span></span>

 

 
