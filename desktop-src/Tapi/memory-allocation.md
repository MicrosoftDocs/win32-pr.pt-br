---
description: Os aplicativos devem alocar memória para esses dados; A TAPI e o provedor de serviços fornecem os dados. Se a operação for assíncrona, os dados não estarão disponíveis até que a mensagem de resposta assíncrona indique êxito.
ms.assetid: 61313fe3-74a1-4195-b5af-37463dad02c1
title: Alocação de memória
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f192e34fdc652293c480277631c3839ecd2435fc
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105813053"
---
# <a name="memory-allocation"></a><span data-ttu-id="cf0b0-104">Alocação de memória</span><span class="sxs-lookup"><span data-stu-id="cf0b0-104">Memory Allocation</span></span>

<span data-ttu-id="cf0b0-105">Os aplicativos devem alocar memória para esses dados; A TAPI e o provedor de serviços fornecem os dados.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-105">Applications must allocate memory for this data; TAPI and the service provider provide the data.</span></span> <span data-ttu-id="cf0b0-106">Se a operação for assíncrona, os dados não estarão disponíveis até que a mensagem de resposta assíncrona indique êxito.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-106">If the operation is asynchronous, the data is not available until the asynchronous reply message indicates success.</span></span>

<span data-ttu-id="cf0b0-107">Todas as estruturas de dados usadas para passar dados entre o aplicativo e a TAPI são *achatadas*.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-107">All data structures used to pass data between the application and the TAPI are *flattened*.</span></span> <span data-ttu-id="cf0b0-108">Ou seja, as estruturas de dados não contêm ponteiros para subestruturas que contêm componentes de dados de tamanho variados.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-108">That is, data structures do not contain pointers to substructures that contain variably sized data components.</span></span> <span data-ttu-id="cf0b0-109">Em vez disso, as estruturas de dados usadas para passar quantidades variáveis de dados de volta para o aplicativo devem ter a seguinte metaestrutura:</span><span class="sxs-lookup"><span data-stu-id="cf0b0-109">Instead, data structures used to pass variable amounts of data back to the application must have the following metastructure:</span></span>

``` syntax
  DWORD  dwTotalSize;
  DWORD  dwNeededSize;
  DWORD  dwUsedSize; 
    <fixed size fields> 
  DWORD  dw<VarSizeField1>Size;
  DWORD  dw<VarSizeField1>Offset; 
    <fixed size fields> 
  DWORD  dw<VarSizeField2>Size;
  DWORD  dw<VarSizeField2>Offset; 
    <common extensions> 
    <var sized field1> 
    <var sized field2>
```

<span data-ttu-id="cf0b0-110">O membro **dwTotalSize** é o tamanho, em bytes, alocado para essa estrutura de dados.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-110">The **dwTotalSize** member is the size, in bytes, allocated to this data structure.</span></span> <span data-ttu-id="cf0b0-111">Ele marca o final da estrutura de dados e é definido pelo aplicativo antes de invocar a função que usa essa estrutura de dados.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-111">It marks the end of the data structure and is set by the application before it invokes the function that uses this data structure.</span></span> <span data-ttu-id="cf0b0-112">A função não lê ou grava além desse tamanho.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-112">The function does not read or write beyond this size.</span></span> <span data-ttu-id="cf0b0-113">Um aplicativo deve definir o membro **dwTotalSize** para indicar o número total de bytes alocados para a TAPI retornar o conteúdo da estrutura.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-113">An application must set the **dwTotalSize** member to indicate the total number of bytes allocated for TAPI to return the contents of the structure.</span></span>

<span data-ttu-id="cf0b0-114">A TAPI preenche o membro **dwNeededSize** .</span><span class="sxs-lookup"><span data-stu-id="cf0b0-114">TAPI fills in the **dwNeededSize** member.</span></span> <span data-ttu-id="cf0b0-115">Indica quantos bytes são necessários para retornar todos os dados solicitados.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-115">It indicates how many bytes are required to return all the requested data.</span></span> <span data-ttu-id="cf0b0-116">A existência de campos de tamanho variados geralmente torna impossível para o aplicativo estimar o tamanho da estrutura de dados necessário para alocar.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-116">The existence of variably sized fields often makes it impossible for the application to estimate the data structure size required to allocate.</span></span> <span data-ttu-id="cf0b0-117">Esse campo retorna o número de bytes realmente necessários para os dados.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-117">This field returns the number of bytes actually required for the data.</span></span> <span data-ttu-id="cf0b0-118">Esse número pode ser menor que, igual a, ou maior que **dwTotalSize**, e inclui espaço para o próprio membro **dwTotalSize** .</span><span class="sxs-lookup"><span data-stu-id="cf0b0-118">This number could be smaller than, equal to, or larger than **dwTotalSize**, and it includes space for the **dwTotalSize** member itself.</span></span> <span data-ttu-id="cf0b0-119">Se for maior, a estrutura retornada só será parcialmente preenchida.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-119">If larger, the returned structure is only partially filled.</span></span> <span data-ttu-id="cf0b0-120">Se os campos necessários para o aplicativo estiverem disponíveis na estrutura parcial, nada mais deverá ser feito.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-120">If the fields the application requires are available in the partial structure, nothing else must be done.</span></span> <span data-ttu-id="cf0b0-121">Caso contrário, o aplicativo deve alocar uma estrutura pelo menos o tamanho de **dwNeededSize** e invocar a função novamente.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-121">Otherwise, the application should allocate a structure at least the size of **dwNeededSize** and invoke the function again.</span></span> <span data-ttu-id="cf0b0-122">Normalmente, há espaço suficiente disponível desta vez para retornar todas as informações, embora seja possível que o tamanho tenha aumentado novamente.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-122">Usually, enough space is available this time to return all the information, although it is possible the size could have increased again.</span></span>

<span data-ttu-id="cf0b0-123">A TAPI preenche o membro **dwUsedSize** se ele retornar dados ao aplicativo para indicar o tamanho real, em bytes, da parte da estrutura de dados que contém dados úteis.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-123">TAPI fills the **dwUsedSize** member if it returns data to the application to indicate the actual size, in bytes, of the portion of the data structure that contains useful data.</span></span> <span data-ttu-id="cf0b0-124">Se, por exemplo, uma estrutura que foi alocada for muito pequena e o campo truncado for um campo de tamanho de variavelmente, **dwNeededSize** será maior que **dwTotalSize** e o campo truncado será deixado vazio.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-124">If, for example, a structure that was allocated was too small and the truncated field is a variably sized field, **dwNeededSize** is larger than **dwTotalSize**, and the truncated field is left empty.</span></span> <span data-ttu-id="cf0b0-125">Portanto, o membro **dwUsedSize** poderia ser menor do que **dwTotalSize**.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-125">The **dwUsedSize** member could therefore be smaller than **dwTotalSize**.</span></span> <span data-ttu-id="cf0b0-126">Valores de campo parciais não são retornados.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-126">Partial field values are not returned.</span></span>

<span data-ttu-id="cf0b0-127">Seguir esse cabeçalho é a parte fixa da estrutura de dados.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-127">Following this header is the fixed part of the data structure.</span></span> <span data-ttu-id="cf0b0-128">Ele contém campos regulares e pares de tamanho/deslocamento que descrevem os campos de tamanho real de variavelmente.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-128">It contains regular fields and size/offset pairs that describe the actual variably sized fields.</span></span> <span data-ttu-id="cf0b0-129">O campo de deslocamento contém o deslocamento em bytes do campo tamanho de variavelmente do início do registro.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-129">The offset field contains the offset in bytes of the variably sized field from the beginning of the record.</span></span> <span data-ttu-id="cf0b0-130">O campo tamanho contém o tamanho em bytes do campo tamanho de variavelmente.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-130">The size field contains the size in bytes of the variably sized field.</span></span> <span data-ttu-id="cf0b0-131">Se um campo de tamanho de variavelmente estiver vazio, o campo tamanho será zero e o deslocamento será definido como zero.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-131">If a variably sized field is empty, then the size field is zero and the offset is set to zero.</span></span> <span data-ttu-id="cf0b0-132">Os campos de tamanho de variavelmente que seriam truncados se o tamanho total da estrutura for insuficiente e ficarão vazios.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-132">Variably sized fields that would be truncated if the total structure size is insufficient are left empty.</span></span> <span data-ttu-id="cf0b0-133">Ou seja, seu campo de tamanho é definido como zero e o deslocamento é definido como zero.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-133">That is, their size field is set to zero and the offset is set to zero.</span></span> <span data-ttu-id="cf0b0-134">Os campos de tamanho de variavelmente seguem os campos fixos.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-134">The variably sized fields follow the fixed fields.</span></span>

<span data-ttu-id="cf0b0-135">Se o provedor de serviços precisar preencher um membro de variável, a TAPI inicializará o tamanho correspondente e os membros de deslocamento como zero.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-135">If the service provider must fill a variable member, TAPI initializes the corresponding size and offset members to zero.</span></span> <span data-ttu-id="cf0b0-136">Se o provedor de serviços preencher o membro da variável, ele deverá definir os membros de tamanho e deslocamento correspondentes com os valores apropriados, incluindo **dwUsedSize** e **dwNeededSize** se ele definir membros variáveis.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-136">If the service provider fills in the variable member, it must set the corresponding size and offset members to appropriate values, including **dwUsedSize** and **dwNeededSize** if it sets variable members.</span></span> <span data-ttu-id="cf0b0-137">O provedor de serviços não deve truncar um membro variável para ajustá-lo ao espaço disponível.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-137">The service provider must not truncate a variable member to make it fit into the available space.</span></span>

<span data-ttu-id="cf0b0-138">O provedor de serviços deve iniciar os membros da variável imediatamente após os membros fixos da estrutura e deixar qualquer espaço extra no final da memória alocada para que a TAPI possa usá-la para os membros de comprimento variável.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-138">The service provider must start variable members immediately after the fixed members of the structure, and leave any extra space at the end of the allocated memory so that TAPI can use it for the variable-length members.</span></span> <span data-ttu-id="cf0b0-139">Ele pode posicionar os membros da variável em qualquer ordem, mas os membros devem ser contíguos.</span><span class="sxs-lookup"><span data-stu-id="cf0b0-139">It can place the variable members in any order, but the members must be contiguous.</span></span>

 

 



