---
description: Os requisitos gerais para implementação de terminal conectável estão listados abaixo.
ms.assetid: 7cee19b1-ceea-494a-b576-4deede759905
title: Implementando terminais conectáveis
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 494b2f6bc5ccb214bc7101f570a4db3037fd8cae
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "105757968"
---
# <a name="implementing-pluggable-terminals"></a><span data-ttu-id="0fd33-103">Implementando terminais conectáveis</span><span class="sxs-lookup"><span data-stu-id="0fd33-103">Implementing Pluggable Terminals</span></span>

<span data-ttu-id="0fd33-104">Os requisitos gerais para a implementação de terminal conectável são:</span><span class="sxs-lookup"><span data-stu-id="0fd33-104">The general requirements for pluggable terminal implementation are:</span></span>

-   <span data-ttu-id="0fd33-105">Um código de streaming subjacente de um terminal conectável deve corresponder aos recursos do MSPs desejado.</span><span class="sxs-lookup"><span data-stu-id="0fd33-105">A pluggable terminal's underlying streaming code should match the capabilities of the desired MSPs.</span></span>
-   <span data-ttu-id="0fd33-106">O terminal deve usar filtros do DirectShow para trabalhar com a maioria dos MSPs (isso é assumido daqui em diante).</span><span class="sxs-lookup"><span data-stu-id="0fd33-106">The terminal must use DirectShow filters to work with most MSPs (this is assumed from here on).</span></span>
-   <span data-ttu-id="0fd33-107">Os terminais de áudio devem dar suporte a 8 kHz de PCM linear mono de 16 bits para a maioria dos MSPs.</span><span class="sxs-lookup"><span data-stu-id="0fd33-107">Audio terminals must support 8 kHz 16-bit mono linear PCM for most MSPs.</span></span>
-   <span data-ttu-id="0fd33-108">O terminal deve habilitar o empacotamento livre de threads implementando [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal).</span><span class="sxs-lookup"><span data-stu-id="0fd33-108">The terminal should enable free threaded marshalling by implementing [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal).</span></span> <span data-ttu-id="0fd33-109">O terminal pode fazer isso chamando a API COM [**CoCreateFreeThreadedMarshaler**](/windows/win32/api/combaseapi/nf-combaseapi-cocreatefreethreadedmarshaler) e agregando **IMarshal** ao ponteiro retornado.</span><span class="sxs-lookup"><span data-stu-id="0fd33-109">The terminal can do this by calling the COM API [**CoCreateFreeThreadedMarshaler**](/windows/win32/api/combaseapi/nf-combaseapi-cocreatefreethreadedmarshaler) and aggregating **IMarshal** to the returned pointer.</span></span> <span data-ttu-id="0fd33-110">O destruidor do objeto de terminal deve chamar a [**versão IMarshal->**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release).</span><span class="sxs-lookup"><span data-stu-id="0fd33-110">The terminal object's destructor should call [**IMarshal->Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release).</span></span>
-   <span data-ttu-id="0fd33-111">O terminal deve implementar ou agregar qualquer outra interface específica do terminal que seja apropriada.</span><span class="sxs-lookup"><span data-stu-id="0fd33-111">The terminal should implement or aggregate any additional terminal-specific interfaces that are appropriate.</span></span>
-   <span data-ttu-id="0fd33-112">A implementação do terminal deve ser thread-safe.</span><span class="sxs-lookup"><span data-stu-id="0fd33-112">The terminal implementation must be thread-safe.</span></span>
-   <span data-ttu-id="0fd33-113">A implementação do terminal deve \# incluir Termmgr. h para a definição de [**ITTerminalControl**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol).</span><span class="sxs-lookup"><span data-stu-id="0fd33-113">The terminal implementation must \#include Termmgr.h for the definition of [**ITTerminalControl**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol).</span></span> <span data-ttu-id="0fd33-114">Isso é além das inclusões e bibliotecas usuais que são necessárias para aplicativos TAPI 3 ou TAPI 3 no Windows 2000 SP1.</span><span class="sxs-lookup"><span data-stu-id="0fd33-114">This is in addition to the usual includes and libs that are needed for TAPI 3 or TAPI 3 applications under Windows 2000 SP1.</span></span>

<span data-ttu-id="0fd33-115">Notas de implementação de interface e método:</span><span class="sxs-lookup"><span data-stu-id="0fd33-115">Interface and method implementation notes:</span></span>

<span data-ttu-id="0fd33-116">O terminal deve implementar [**ITTerminal**](/windows/win32/api/tapi3if/nn-tapi3if-itterminal) (interface dual – vtable + [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch)).</span><span class="sxs-lookup"><span data-stu-id="0fd33-116">The terminal must implement [**ITTerminal**](/windows/win32/api/tapi3if/nn-tapi3if-itterminal) (dual interface–vtable + [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch)).</span></span>

[<span data-ttu-id="0fd33-117">**ITTerminal:: obter \_ TerminalClass**</span><span class="sxs-lookup"><span data-stu-id="0fd33-117">**ITTerminal::get\_TerminalClass**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_terminalclass)

<span data-ttu-id="0fd33-118">O terminal deve retornar uma representação **BSTR** de um GUID escolhido que identifica o tipo de terminal.</span><span class="sxs-lookup"><span data-stu-id="0fd33-118">The terminal must return a **BSTR** representation of a GUID you've picked that identifies your type of terminal.</span></span> <span data-ttu-id="0fd33-119">Aloque o **BSTR** via [**SysAllocString**](/windows/win32/api/oleauto/nf-oleauto-sysallocstring).</span><span class="sxs-lookup"><span data-stu-id="0fd33-119">Allocate the **BSTR** via [**SysAllocString**](/windows/win32/api/oleauto/nf-oleauto-sysallocstring).</span></span> <span data-ttu-id="0fd33-120">Para converter de GUID para **BSTR**, chame [**StringFromCLSID**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromclsid), **SysAllocString** e [**CoTaskMemFree**](/windows/win32/api/combaseapi/nf-combaseapi-cotaskmemfree).</span><span class="sxs-lookup"><span data-stu-id="0fd33-120">To convert from GUID to **BSTR**, call [**StringFromCLSID**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromclsid), **SysAllocString**, and [**CoTaskMemFree**](/windows/win32/api/combaseapi/nf-combaseapi-cotaskmemfree).</span></span>

[<span data-ttu-id="0fd33-121">**ITTerminal:: obter \_ terminaltype**</span><span class="sxs-lookup"><span data-stu-id="0fd33-121">**ITTerminal::get\_TerminalType**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_terminaltype)

<span data-ttu-id="0fd33-122">O terminal, em geral, deve retornar TT \_ dinâmico se um aplicativo implementar o terminal.</span><span class="sxs-lookup"><span data-stu-id="0fd33-122">The terminal should generally return TT\_DYNAMIC if an application implements the terminal.</span></span> <span data-ttu-id="0fd33-123">Retornar TT \_ estático também funcionará e o retorno desse valor poderá ser apropriado se o terminal corresponder a um dispositivo de hardware; no entanto, fazer isso pode ser confuso para os usuários, pois um terminal estático não estará presente na enumeração de terminal estática do MSP.</span><span class="sxs-lookup"><span data-stu-id="0fd33-123">Returning TT\_STATIC will also work, and returning this value may be appropriate if the terminal corresponds to a hardware device; however, doing this may be confusing to users because a static terminal will not be present in the MSP's static terminal enumeration.</span></span>

[<span data-ttu-id="0fd33-124">**ITTerminal:: obter \_ estado**</span><span class="sxs-lookup"><span data-stu-id="0fd33-124">**ITTerminal::get\_State**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_state)

<span data-ttu-id="0fd33-125">Se a implementação do terminal não limitar arbitrariamente o número de fluxos aos quais o terminal pode ser conectado simultaneamente, o terminal sempre deverá retornar TS \_ NOTINUSE.</span><span class="sxs-lookup"><span data-stu-id="0fd33-125">If the terminal implementation does not arbitrarily limit the number of streams that the terminal can be concurrently connected to, then the terminal should always return TS\_NOTINUSE.</span></span>

<span data-ttu-id="0fd33-126">Caso contrário, a implementação do terminal limita arbitrariamente o número de fluxos aos quais o terminal pode ser conectado por vez.</span><span class="sxs-lookup"><span data-stu-id="0fd33-126">Otherwise, the terminal implementation arbitrarily limits the number of streams that the terminal can be connected to at a time.</span></span> <span data-ttu-id="0fd33-127">Nesse caso, o terminal deve manter uma contagem de quantos fluxos ele está conectado.</span><span class="sxs-lookup"><span data-stu-id="0fd33-127">In this case, the terminal should keep a count of how many streams it is connected to.</span></span> <span data-ttu-id="0fd33-128">O terminal deve incrementar essa contagem interna em uma chamada [**ITTerminalControl:: ConnectTerminal**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-connectterminal) bem-sucedida e decrementa-la em uma [**ITTerminalControl bem-sucedida::D chamada isconnectterminal**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-disconnectterminal) .</span><span class="sxs-lookup"><span data-stu-id="0fd33-128">The terminal should increment this internal count on a successful [**ITTerminalControl::ConnectTerminal**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-connectterminal) call and decrement it on a successful [**ITTerminalControl::DisconnectTerminal**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-disconnectterminal) call.</span></span> <span data-ttu-id="0fd33-129">No [**\_ estado ITTerminal:: Get**](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_state), ele deve retornar TS \_ INUSE se essa contagem for igual ao número máximo de fluxos em que o terminal pode ser selecionado por vez; caso contrário, ele deverá retornar TS \_ NOTINUSE.</span><span class="sxs-lookup"><span data-stu-id="0fd33-129">In [**ITTerminal::get\_State**](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_state), it should return TS\_INUSE if this count is equal to the maximum number of streams that the terminal can be selected on at a time; otherwise, it should return TS\_NOTINUSE.</span></span> <span data-ttu-id="0fd33-130">Observe que, se o limite for um, a contagem poderá simplesmente ser um valor booliano ou de estado do TERMINAL \_ .</span><span class="sxs-lookup"><span data-stu-id="0fd33-130">Note that if the limit is one, the count can simply be a Boolean or a TERMINAL\_STATE value.</span></span>

[<span data-ttu-id="0fd33-131">**ITTerminal:: obter \_ nome**</span><span class="sxs-lookup"><span data-stu-id="0fd33-131">**ITTerminal::get\_Name**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_name)

<span data-ttu-id="0fd33-132">O terminal deve retornar um nome **BSTR** de sua escolha, alocado por meio de [**SysAllocString**](/windows/win32/api/oleauto/nf-oleauto-sysallocstring).</span><span class="sxs-lookup"><span data-stu-id="0fd33-132">The terminal should return a **BSTR** name of its choice, allocated via [**SysAllocString**](/windows/win32/api/oleauto/nf-oleauto-sysallocstring).</span></span> <span data-ttu-id="0fd33-133">Esse nome deve ser significativo para o usuário e deve ser localizado.</span><span class="sxs-lookup"><span data-stu-id="0fd33-133">This name should be meaningful to the user and should be localized.</span></span>

[<span data-ttu-id="0fd33-134">**ITTerminal:: obter \_ MediaType**</span><span class="sxs-lookup"><span data-stu-id="0fd33-134">**ITTerminal::get\_MediaType**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_mediatype)

<span data-ttu-id="0fd33-135">O terminal deve retornar seu tipo de mídia, seja TAPIMEDIATYPE \_ áudio ou TAPIMEDIATYPE \_ vídeo.</span><span class="sxs-lookup"><span data-stu-id="0fd33-135">The terminal should return its media type, either TAPIMEDIATYPE\_AUDIO or TAPIMEDIATYPE\_VIDEO.</span></span>

[<span data-ttu-id="0fd33-136">**ITTerminal:: obter \_ direção**</span><span class="sxs-lookup"><span data-stu-id="0fd33-136">**ITTerminal::get\_Direction**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_direction)

<span data-ttu-id="0fd33-137">O terminal retorna o \_ valor de enumeração da direção do terminal que indica a direção do terminal.</span><span class="sxs-lookup"><span data-stu-id="0fd33-137">The terminal returns the TERMINAL\_DIRECTION enum value indicating the direction of the terminal.</span></span> <span data-ttu-id="0fd33-138">Se o terminal for bidirecional (por exemplo, uma ponte), ele deverá retornar o TD \_ bidirecional.</span><span class="sxs-lookup"><span data-stu-id="0fd33-138">If the terminal is bidirectional (for example, a bridge), then it must return TD\_BIDIRECTIONAL.</span></span>

<span data-ttu-id="0fd33-139">O terminal deve implementar [**ITTerminalControl**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol) (somente vtable).</span><span class="sxs-lookup"><span data-stu-id="0fd33-139">The terminal must implement [**ITTerminalControl**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol) (vtable only).</span></span>

[<span data-ttu-id="0fd33-140">**ITTerminalControl:: obter \_ AddressHandle**</span><span class="sxs-lookup"><span data-stu-id="0fd33-140">**ITTerminalControl::get\_AddressHandle**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-get_addresshandle)

<span data-ttu-id="0fd33-141">Um terminal fornecido pelo aplicativo sempre deve retornar **NULL** como o identificador de endereço.</span><span class="sxs-lookup"><span data-stu-id="0fd33-141">An application-provided terminal should always return **NULL** as the address handle.</span></span> <span data-ttu-id="0fd33-142">Isso indica para o MSP que esse terminal não foi criado em um objeto de endereço MSP específico.</span><span class="sxs-lookup"><span data-stu-id="0fd33-142">This indicates to the MSP that this terminal was not created on a specific MSP address object.</span></span>

[<span data-ttu-id="0fd33-143">**ITTerminalControl::ConnectTerminal**</span><span class="sxs-lookup"><span data-stu-id="0fd33-143">**ITTerminalControl::ConnectTerminal**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-connectterminal)

<span data-ttu-id="0fd33-144">Nessa chamada, o terminal adicionará seus filtros ao grafo fornecido e os conectará entre si, se aplicável.</span><span class="sxs-lookup"><span data-stu-id="0fd33-144">On this call, the terminal will add its filter(s) to the given graph and connect them to each other, if applicable.</span></span> <span data-ttu-id="0fd33-145">Em seguida, o terminal deve retornar os Pins expostos pelo terminal para a direção do fluxo especificada.</span><span class="sxs-lookup"><span data-stu-id="0fd33-145">Then the terminal should return the pin(s) exposed by the terminal for the stream direction specified.</span></span>

<span data-ttu-id="0fd33-146">Um terminal que não dá suporte à conexão simultânea com vários fluxos definiria uma variável interna para TS \_ INUSE na conclusão bem-sucedida desse método.</span><span class="sxs-lookup"><span data-stu-id="0fd33-146">A terminal that does not support concurrent connection to multiple streams would set an internal variable to TS\_INUSE on successful completion of this method.</span></span>

<span data-ttu-id="0fd33-147">O terminal pode usar o parâmetro *dwTerminalDirection* dessa chamada para determinar a direção do fluxo ao qual ele está sendo conectado.</span><span class="sxs-lookup"><span data-stu-id="0fd33-147">The terminal can use the *dwTerminalDirection* parameter from this call to determine the direction of the stream that it is being connected to.</span></span> <span data-ttu-id="0fd33-148">Isso é necessário para terminais bidirecionais.</span><span class="sxs-lookup"><span data-stu-id="0fd33-148">This is required for bidirectional terminals.</span></span>

> [!Note]  
> <span data-ttu-id="0fd33-149">Normalmente (nas classes base MSP e em todos os MSPs conhecidos), o código de fluxo MSP falhará na conexão se o terminal retornar mais de um PIN de uma única chamada [**ConnectTerminal**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-connectterminal) .</span><span class="sxs-lookup"><span data-stu-id="0fd33-149">Typically (in the MSP base classes and in all known MSPs), the MSP stream code will fail the connection if the terminal returns more than one pin from a single [**ConnectTerminal**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-connectterminal) call.</span></span> <span data-ttu-id="0fd33-150">Isso é bom, porque um terminal que retorna mais de um PIN durante a conexão requer que o MSP tenha conhecimento especial do terminal para fazer uso dos Pins extras com eficiência.</span><span class="sxs-lookup"><span data-stu-id="0fd33-150">This is fine, because a terminal that returns more than one pin during connection requires the MSP to have special knowledge of the terminal to make use of the extra pins effectively.</span></span>

 

[<span data-ttu-id="0fd33-151">**ITTerminalControl::CompleteConnectTerminal**</span><span class="sxs-lookup"><span data-stu-id="0fd33-151">**ITTerminalControl::CompleteConnectTerminal**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-completeconnectterminal)

<span data-ttu-id="0fd33-152">O terminal deve simplesmente retornar S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="0fd33-152">The terminal should just return S\_OK.</span></span> <span data-ttu-id="0fd33-153">O terminal também pode fazer a inicialização após a conexão, se necessário.</span><span class="sxs-lookup"><span data-stu-id="0fd33-153">The terminal may also do post-connection initialization if it needs to.</span></span>

[<span data-ttu-id="0fd33-154">**ITTerminalControl::D isconnectTerminal**</span><span class="sxs-lookup"><span data-stu-id="0fd33-154">**ITTerminalControl::DisconnectTerminal**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-disconnectterminal)

<span data-ttu-id="0fd33-155">O terminal deve fazer tudo o que for necessário para desconectar o terminal do restante do grafo.</span><span class="sxs-lookup"><span data-stu-id="0fd33-155">The terminal should do whatever is needed to disconnect the terminal from the rest of the graph.</span></span> <span data-ttu-id="0fd33-156">Normalmente, isso envolve a remoção de todos os filtros dos terminais do grafo e a definição do estado do terminal como TS \_ NOTINUSE.</span><span class="sxs-lookup"><span data-stu-id="0fd33-156">Typically this involves removing all the terminals' filters from the graph and setting the terminal state to TS\_NOTINUSE.</span></span>

[<span data-ttu-id="0fd33-157">**ITTerminalControl::RunRenderFilter**</span><span class="sxs-lookup"><span data-stu-id="0fd33-157">**ITTerminalControl::RunRenderFilter**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-runrenderfilter)

<span data-ttu-id="0fd33-158">O terminal deve apenas retornar E \_ NOTIMPL.</span><span class="sxs-lookup"><span data-stu-id="0fd33-158">The terminal should just return E\_NOTIMPL.</span></span>

[<span data-ttu-id="0fd33-159">**ITTerminalControl::StopRenderFilter**</span><span class="sxs-lookup"><span data-stu-id="0fd33-159">**ITTerminalControl::StopRenderFilter**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-stoprenderfilter)

<span data-ttu-id="0fd33-160">O terminal deve apenas retornar E \_ NOTIMPL.</span><span class="sxs-lookup"><span data-stu-id="0fd33-160">The terminal should just return E\_NOTIMPL.</span></span>

 

 
