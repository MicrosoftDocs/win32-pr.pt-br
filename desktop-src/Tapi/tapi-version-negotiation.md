---
description: Com o tempo, podem existir versões diferentes para TAPI, aplicativos e provedores de serviços para uma linha ou telefone.
ms.assetid: 36a17ae8-31db-4db9-a401-097d47aa26ad
title: Negociação de versão TAPI
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f41f4ca6f12862d6fc19f982c48b90bdafe2aaa2
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "105779441"
---
# <a name="tapi-version-negotiation"></a><span data-ttu-id="2a833-103">Negociação de versão TAPI</span><span class="sxs-lookup"><span data-stu-id="2a833-103">TAPI Version Negotiation</span></span>

<span data-ttu-id="2a833-104">Com o tempo, podem existir versões diferentes para TAPI, aplicativos e provedores de serviços para uma linha ou telefone.</span><span class="sxs-lookup"><span data-stu-id="2a833-104">Over time, different versions may exist for TAPI, applications, and service providers for a line or phone.</span></span> <span data-ttu-id="2a833-105">Novas versões podem definir novos recursos, novos campos para estruturas de dados e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="2a833-105">New versions may define new features, new fields to data structures, and so on.</span></span> <span data-ttu-id="2a833-106">Portanto, os números de versão indicam como interpretar várias estruturas de dados.</span><span class="sxs-lookup"><span data-stu-id="2a833-106">Version numbers therefore indicate how to interpret various data structures.</span></span>

<span data-ttu-id="2a833-107">Para permitir a interoperabilidade ideal de diferentes versões de aplicativos, versões da própria TAPI e versões de provedores de serviço por diferentes fornecedores, a TAPI fornece um mecanismo de negociação de versão simples e em duas etapas para aplicativos.</span><span class="sxs-lookup"><span data-stu-id="2a833-107">To allow optimal interoperability of different versions of applications, versions of TAPI itself, and versions of service providers by different vendors, TAPI provides a simple, two-step version negotiation mechanism for applications.</span></span> <span data-ttu-id="2a833-108">Duas versões diferentes devem ser acordadas pelo aplicativo, pela TAPI e pelo provedor de serviços para cada dispositivo de linha.</span><span class="sxs-lookup"><span data-stu-id="2a833-108">Two different versions must be agreed on by the application, TAPI, and the service provider for each line device.</span></span> <span data-ttu-id="2a833-109">O primeiro é o número de versão para telefonia básica e suplementar e é conhecido como a versão da API.</span><span class="sxs-lookup"><span data-stu-id="2a833-109">The first is the version number for Basic and Supplementary Telephony and is referred to as the API version.</span></span> <span data-ttu-id="2a833-110">O outro é para extensões específicas do provedor, se houver, e é chamado de versão de extensão.</span><span class="sxs-lookup"><span data-stu-id="2a833-110">The other is for provider-specific extensions, if any, and is referred to as the extension version.</span></span> <span data-ttu-id="2a833-111">O formato das estruturas e dos tipos de dados usados pelos recursos básicos e complementares da TAPI é definido pela versão da API, enquanto a versão da extensão determina o formato das estruturas de dados definidas pelas extensões específicas do fornecedor.</span><span class="sxs-lookup"><span data-stu-id="2a833-111">The format of the data structures and datatypes used by TAPI's basic and supplementary features is defined by the API version, while the extension version determines the format of the data structures defined by the vendor-specific extensions.</span></span>

<span data-ttu-id="2a833-112">A negociação de versão prossegue em duas fases.</span><span class="sxs-lookup"><span data-stu-id="2a833-112">Version negotiation proceeds in two phases.</span></span> <span data-ttu-id="2a833-113">Na primeira fase, o número de versão da API é negociado e o identificador de extensão associado a todas as extensões específicas do fornecedor com suporte no dispositivo é obtido.</span><span class="sxs-lookup"><span data-stu-id="2a833-113">In the first phase, the API version number is negotiated and the extension identifier associated with any vendor-specific extensions supported on the device is obtained.</span></span> <span data-ttu-id="2a833-114">Na segunda fase, a versão da extensão é negociada.</span><span class="sxs-lookup"><span data-stu-id="2a833-114">In the second phase, the extension version is negotiated.</span></span> <span data-ttu-id="2a833-115">Se o aplicativo não usar nenhuma extensão de API, ele ignorará a segunda fase e as extensões não serão ativadas pelo provedor de serviços.</span><span class="sxs-lookup"><span data-stu-id="2a833-115">If the application does not use any API extensions, it skips the second phase and extensions are not activated by the service provider.</span></span> <span data-ttu-id="2a833-116">Se o aplicativo quiser usar extensões, mas as extensões do provedor de serviços (o identificador de extensão) não forem reconhecidas pelo aplicativo, o aplicativo também deverá ignorar a negociação para a versão de extensão.</span><span class="sxs-lookup"><span data-stu-id="2a833-116">If the application does want to use extensions, but the service provider's extensions (the extension identifier) are not recognized by the application, the application should skip the negotiation for extension version as well.</span></span> <span data-ttu-id="2a833-117">Cada fornecedor tem seu próprio conjunto de versões legais (reconhecidas) para cada conjunto de especificações de extensão que distribui.</span><span class="sxs-lookup"><span data-stu-id="2a833-117">Each vendor has its own set of legal (recognized) versions for each set of extension specifications it distributes.</span></span>

<span data-ttu-id="2a833-118">A função [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion) é usada para negociar o número de versão da API a ser usado.</span><span class="sxs-lookup"><span data-stu-id="2a833-118">The [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion) function is used to negotiate the API version number to use.</span></span> <span data-ttu-id="2a833-119">Ele também recupera o identificador de extensão suportado pelo dispositivo de linha, retornando zeros se nenhuma extensão tiver suporte.</span><span class="sxs-lookup"><span data-stu-id="2a833-119">It also retrieves the extension identifier supported by the line device, returning zeros if no extensions are supported.</span></span> <span data-ttu-id="2a833-120">Com essa chamada de função, o aplicativo fornece o intervalo de versão da API com o qual ele é compatível.</span><span class="sxs-lookup"><span data-stu-id="2a833-120">With this function call, the application provides the API version range it is compatible with.</span></span> <span data-ttu-id="2a833-121">A TAPI, por sua vez, negocia com o provedor de serviços da linha para determinar a qual intervalo de versão da API ele dá suporte.</span><span class="sxs-lookup"><span data-stu-id="2a833-121">TAPI in turn negotiates with the line's service provider to determine which API version range it supports.</span></span> <span data-ttu-id="2a833-122">A TAPI seguinte seleciona um número de versão (normalmente, embora não necessariamente, o número de versão mais alto) no intervalo de versões sobrepostas que o aplicativo, a DLL e o provedor de serviços forneceu.</span><span class="sxs-lookup"><span data-stu-id="2a833-122">TAPI next selects a version number (typically, although not necessarily, the highest version number) in the overlapping version range that the application, the DLL, and the service provider have supplied.</span></span> <span data-ttu-id="2a833-123">Esse número é retornado para o aplicativo, junto com o identificador de extensão que define as extensões disponíveis do provedor de serviços da linha.</span><span class="sxs-lookup"><span data-stu-id="2a833-123">This number is returned to the application, along with the extension identifier that defines the extensions available from that line's service provider.</span></span>

<span data-ttu-id="2a833-124">Se o aplicativo quiser usar as extensões definidas pelo identificador de extensão retornado, ele deverá primeiro chamar [**lineNegotiateExtVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateextversion) para negociar a versão de extensão.</span><span class="sxs-lookup"><span data-stu-id="2a833-124">If the application wants to use the extensions defined by the returned extension identifier, it must first call [**lineNegotiateExtVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateextversion) to negotiate the extension version.</span></span> <span data-ttu-id="2a833-125">Em uma fase de negociação semelhante, o aplicativo especifica a versão de API já acordada e o intervalo de versão de extensão com suporte.</span><span class="sxs-lookup"><span data-stu-id="2a833-125">In a similar negotiation phase, the application specifies the already agreed-upon API version and the extension version range it supports.</span></span> <span data-ttu-id="2a833-126">A TAPI passa essas informações para o provedor de serviços para a linha.</span><span class="sxs-lookup"><span data-stu-id="2a833-126">TAPI passes this information to the service provider for the line.</span></span> <span data-ttu-id="2a833-127">O provedor de serviços verifica a versão da API e o intervalo de versão da extensão em relação a sua própria e seleciona o número de versão da extensão apropriado, se houver.</span><span class="sxs-lookup"><span data-stu-id="2a833-127">The service provider checks the API version and the extension version range against its own, and selects the appropriate extension version number, if one exists.</span></span>

<span data-ttu-id="2a833-128">Quando o aplicativo chama [**lineGetDevCaps**](/windows/desktop/api/Tapi/nf-tapi-linegetdevcaps)posteriormente, ele retorna um conjunto de recursos de dispositivo para a linha que corresponde aos resultados da negociação de versão.</span><span class="sxs-lookup"><span data-stu-id="2a833-128">When the application later calls [**lineGetDevCaps**](/windows/desktop/api/Tapi/nf-tapi-linegetdevcaps), it returns a set of device capabilities for the line that correspond to the results of version negotiation.</span></span> <span data-ttu-id="2a833-129">Isso inclui os recursos de dispositivo da linha consistentes com a versão da API e os recursos específicos do dispositivo da linha consistentes com a versão da extensão.</span><span class="sxs-lookup"><span data-stu-id="2a833-129">These include the line's device capabilities consistent with the API version and the line's device-specific capabilities consistent with the extension version.</span></span> <span data-ttu-id="2a833-130">O aplicativo deve especificar ambos os números de versão ao abrir uma linha.</span><span class="sxs-lookup"><span data-stu-id="2a833-130">The application must specify both of these version numbers when it opens a line.</span></span> <span data-ttu-id="2a833-131">Nesse ponto, o aplicativo, a DLL e o provedor de serviços estão comprometidos a usar as versões acordadas.</span><span class="sxs-lookup"><span data-stu-id="2a833-131">At that point, the application, the DLL, and the service provider are committed to using the agreed-upon versions.</span></span> <span data-ttu-id="2a833-132">Se as extensões específicas do dispositivo não forem usadas, a versão da extensão deverá ser especificada como zero.</span><span class="sxs-lookup"><span data-stu-id="2a833-132">If device-specific extensions are not to be used, the extension version should be specified as zero.</span></span>

<span data-ttu-id="2a833-133">Em um ambiente em que vários aplicativos abrem o mesmo dispositivo de linha, o primeiro aplicativo para abrir o dispositivo de linha seleciona as versões de todos os aplicativos futuros que desejam usar a linha (os provedores de serviço não oferecem suporte a várias versões simultaneamente). Da mesma forma, um aplicativo que abre vários dispositivos de linha pode achar mais fácil operar todos os dispositivos de linha sob o mesmo número de versão da API.</span><span class="sxs-lookup"><span data-stu-id="2a833-133">In an environment where multiple applications open the same line device, the first application to open the line device selects the versions for all future applications that want to use the line (service providers do not support multiple versions simultaneously.) Similarly, an application that opens multiple line devices may find it easier to operate all line devices under the same API version number.</span></span>

<span data-ttu-id="2a833-134">Cada função que usa um parâmetro *dwAPIVersion* ou semelhante deve definir esse parâmetro como a versão de API mais alta com suporte do aplicativo ou a versão de API negociada usando a função [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion) ou [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion) em um dispositivo específico.</span><span class="sxs-lookup"><span data-stu-id="2a833-134">Every function that takes a *dwAPIVersion* or similar parameter must set this parameter to either the highest API version supported by the application or the API version negotiated using the [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion) or [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion) function on a particular device.</span></span> <span data-ttu-id="2a833-135">Use a tabela a seguir como guia:</span><span class="sxs-lookup"><span data-stu-id="2a833-135">Use the following table as a guide:</span></span>



| <span data-ttu-id="2a833-136">Função</span><span class="sxs-lookup"><span data-stu-id="2a833-136">Function</span></span>                                                     | <span data-ttu-id="2a833-137">Significado</span><span class="sxs-lookup"><span data-stu-id="2a833-137">Meaning</span></span>                                                                               |
|--------------------------------------------------------------|---------------------------------------------------------------------------------------|
| [<span data-ttu-id="2a833-138">**lineGetAddressCaps**</span><span class="sxs-lookup"><span data-stu-id="2a833-138">**lineGetAddressCaps**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linegetaddresscaps)             | <span data-ttu-id="2a833-139">Use a versão retornada por [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span><span class="sxs-lookup"><span data-stu-id="2a833-139">Use version returned by [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span></span>   |
| [<span data-ttu-id="2a833-140">**lineGetCountry**</span><span class="sxs-lookup"><span data-stu-id="2a833-140">**lineGetCountry**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linegetcountry)                     | <span data-ttu-id="2a833-141">Use a versão mais recente com suporte do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2a833-141">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="2a833-142">**lineGetDevCaps**</span><span class="sxs-lookup"><span data-stu-id="2a833-142">**lineGetDevCaps**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linegetdevcaps)                     | <span data-ttu-id="2a833-143">Use a versão retornada por [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span><span class="sxs-lookup"><span data-stu-id="2a833-143">Use version returned by [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span></span>   |
| [<span data-ttu-id="2a833-144">**lineGetProviderList**</span><span class="sxs-lookup"><span data-stu-id="2a833-144">**lineGetProviderList**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linegetproviderlist)           | <span data-ttu-id="2a833-145">Use a versão mais recente com suporte do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2a833-145">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="2a833-146">**lineGetTranslateCaps**</span><span class="sxs-lookup"><span data-stu-id="2a833-146">**lineGetTranslateCaps**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linegettranslatecaps)         | <span data-ttu-id="2a833-147">Use a versão mais recente com suporte do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2a833-147">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="2a833-148">**lineNegotiateAPIVersion**</span><span class="sxs-lookup"><span data-stu-id="2a833-148">**lineNegotiateAPIVersion**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion)   | <span data-ttu-id="2a833-149">Use a versão mais recente com suporte do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2a833-149">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="2a833-150">**lineNegotiateExtVersion**</span><span class="sxs-lookup"><span data-stu-id="2a833-150">**lineNegotiateExtVersion**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linenegotiateextversion)   | <span data-ttu-id="2a833-151">Use a versão retornada por [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span><span class="sxs-lookup"><span data-stu-id="2a833-151">Use version returned by [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span></span>   |
| [<span data-ttu-id="2a833-152">**lineOpen**</span><span class="sxs-lookup"><span data-stu-id="2a833-152">**lineOpen**</span></span>](/windows/desktop/api/Tapi/nf-tapi-lineopen)                                 | <span data-ttu-id="2a833-153">Use a versão retornada por [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span><span class="sxs-lookup"><span data-stu-id="2a833-153">Use version returned by [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span></span>   |
| [<span data-ttu-id="2a833-154">**lineTranslateAddress**</span><span class="sxs-lookup"><span data-stu-id="2a833-154">**lineTranslateAddress**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linetranslateaddress)         | <span data-ttu-id="2a833-155">Use a versão mais recente com suporte do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2a833-155">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="2a833-156">**lineTranslateDialog**</span><span class="sxs-lookup"><span data-stu-id="2a833-156">**lineTranslateDialog**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linetranslatedialog)           | <span data-ttu-id="2a833-157">Use a versão mais recente com suporte do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2a833-157">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="2a833-158">**phoneGetDevCaps**</span><span class="sxs-lookup"><span data-stu-id="2a833-158">**phoneGetDevCaps**</span></span>](/windows/desktop/api/Tapi/nf-tapi-phonegetdevcaps)                   | <span data-ttu-id="2a833-159">Use a versão retornada por [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion).</span><span class="sxs-lookup"><span data-stu-id="2a833-159">Use version returned by [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion).</span></span> |
| [<span data-ttu-id="2a833-160">**phoneNegotiateAPIVersion**</span><span class="sxs-lookup"><span data-stu-id="2a833-160">**phoneNegotiateAPIVersion**</span></span>](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion) | <span data-ttu-id="2a833-161">Use a versão mais recente com suporte do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2a833-161">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="2a833-162">**phoneNegotiateExtVersion**</span><span class="sxs-lookup"><span data-stu-id="2a833-162">**phoneNegotiateExtVersion**</span></span>](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateextversion) | <span data-ttu-id="2a833-163">Use a versão retornada por [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion).</span><span class="sxs-lookup"><span data-stu-id="2a833-163">Use version returned by [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion).</span></span> |
| [<span data-ttu-id="2a833-164">**phoneOpen**</span><span class="sxs-lookup"><span data-stu-id="2a833-164">**phoneOpen**</span></span>](/windows/desktop/api/Tapi/nf-tapi-phoneopen)                               | <span data-ttu-id="2a833-165">Use a versão retornada por [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion).</span><span class="sxs-lookup"><span data-stu-id="2a833-165">Use version returned by [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion).</span></span> |



 

> [!IMPORTANT]
> <span data-ttu-id="2a833-166">Ao negociar uma versão de API, sempre defina os números de versão alta e baixa para o intervalo de versões para as quais seu aplicativo pode dar suporte.</span><span class="sxs-lookup"><span data-stu-id="2a833-166">When negotiating an API version, always set the high and low version numbers to the range of versions that your application can support.</span></span> <span data-ttu-id="2a833-167">Por exemplo, nunca use 0x00000000 para a versão baixa ou 0xFFFFFFFF para a alta porque esses valores exigem que seu aplicativo dê suporte a todas as versões da TAPI, no passado e no futuro.</span><span class="sxs-lookup"><span data-stu-id="2a833-167">For example, never use 0x00000000 for the low version or 0xFFFFFFFF for the high because these values require that your application support all versions of TAPI, both past and future.</span></span>

 

 

 



