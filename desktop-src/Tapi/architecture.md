---
description: A ilustração a seguir mostra a arquitetura geral de provedores de serviços de telefonia e suas DLLs (bibliotecas de vínculo dinâmico) da interface do usuário associada.
ms.assetid: b5efe57a-19b8-49c5-810f-180633ed50d2
title: Arquitetura (API de telefonia)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 14423dba77af1ded38af4a6f2b896e76d28ca2cd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105792634"
---
# <a name="architecture-telephony-api"></a><span data-ttu-id="cb9eb-103">Arquitetura (API de telefonia)</span><span class="sxs-lookup"><span data-stu-id="cb9eb-103">Architecture (Telephony API)</span></span>

<span data-ttu-id="cb9eb-104">A ilustração a seguir mostra a arquitetura geral de provedores de serviços de telefonia e suas DLLs (bibliotecas de vínculo dinâmico) da interface do usuário associada.</span><span class="sxs-lookup"><span data-stu-id="cb9eb-104">The following illustration shows the general architecture of telephony service providers and their associated user interface dynamic-link libraries (UI DLLs).</span></span>

![TSPs e DLLs de interface do usuário associadas](images/spuidl01.png)

<span data-ttu-id="cb9eb-106">O provedor de serviços consiste em um mínimo de dois componentes.</span><span class="sxs-lookup"><span data-stu-id="cb9eb-106">The service provider consists of a minimum of two components.</span></span> <span data-ttu-id="cb9eb-107">A DLL do provedor de serviços (designada na ilustração como principal. TSP) é executado no contexto do processo TAPISRV e executa todas as tarefas do provedor de serviços que não estão relacionadas aos elementos da interface do usuário associados a um uso específico do aplicativo do dispositivo (muito provavelmente, em conjunto com componentes de nível inferior não mostrados na ilustração).</span><span class="sxs-lookup"><span data-stu-id="cb9eb-107">The service provider DLL (designated in the illustration as MAIN.TSP) executes in the context of the TAPISRV process, and performs all of the tasks of the service provider that are not related to user interface elements associated with a particular application's use of the device (most likely, in conjunction with lower-level components not shown in the illustration).</span></span> <span data-ttu-id="cb9eb-108">Mas, ao contrário das versões anteriores da TAPI em que o código de interface do usuário foi integrado ao provedor de serviços (e executado, devido à arquitetura anterior, dentro do contexto do aplicativo), o provedor de serviços agora deve incluir um componente separado que implementa os elementos da interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="cb9eb-108">But unlike previous versions of TAPI in which the user interface code was integrated into the service provider (and executed, because of the previous architecture, within the context of the application), the service provider must now include a separate component that implements the user interface elements.</span></span>

<span data-ttu-id="cb9eb-109">A DLL de interface do usuário do provedor de serviços deve exportar funções que são chamadas pela TAPI quando o aplicativo chama funções TAPI que geram interface do usuário: [**TUISPI \_ lineConfigDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_lineconfigdialog), [**TUISPI \_ lineConfigDialogEdit**](/windows/win32/api/tspi/nf-tspi-tuispi_lineconfigdialogedit), [**TUISPI \_**](/windows/win32/api/tspi/nf-tspi-tuispi_phoneconfigdialog)phoneConfigDialog, [**TUISPI \_ providerConfig**](/windows/win32/api/tspi/nf-tspi-tuispi_providerconfig), [**TUISPI \_ providerInstall**](/windows/win32/api/tspi/nf-tspi-tuispi_providerinstall)e [**TUISPI \_ providerRemove**](/windows/win32/api/tspi/nf-tspi-tuispi_providerremove).</span><span class="sxs-lookup"><span data-stu-id="cb9eb-109">The service provider UI DLL must export functions that are called by TAPI when the application calls TAPI functions that generate UI: [**TUISPI\_lineConfigDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_lineconfigdialog), [**TUISPI\_lineConfigDialogEdit**](/windows/win32/api/tspi/nf-tspi-tuispi_lineconfigdialogedit), [**TUISPI\_phoneConfigDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_phoneconfigdialog), [**TUISPI\_providerConfig**](/windows/win32/api/tspi/nf-tspi-tuispi_providerconfig), [**TUISPI\_providerInstall**](/windows/win32/api/tspi/nf-tspi-tuispi_providerinstall), and [**TUISPI\_providerRemove**](/windows/win32/api/tspi/nf-tspi-tuispi_providerremove).</span></span> <span data-ttu-id="cb9eb-110">Cada uma dessas funções inclui como um parâmetro um ponteiro para uma função de retorno de chamada na TAPI, do tipo [**TUISPIDLLCALLBACK**](/windows/win32/api/tspi/nc-tspi-tuispidllcallback), que a DLL da interface do usuário pode usar para se comunicar bidirecionalmente (enviar e receber dados) com a DLL do provedor de serviços em execução no processo TAPISRV.</span><span class="sxs-lookup"><span data-stu-id="cb9eb-110">Each of these functions includes as a parameter a pointer to a callback function in TAPI, of type [**TUISPIDLLCALLBACK**](/windows/win32/api/tspi/nc-tspi-tuispidllcallback), which the UI DLL can use to communicate bidirectionally (both send and receive data) with the service provider DLL executing in the TAPISRV process.</span></span> <span data-ttu-id="cb9eb-111">Se o provedor de serviços gerar uma interface do usuário espontaneável, como a caixa de diálogo de **fala/desligamento** Unimodem, em conjunto com qualquer função TSPI para a qual a interface do usuário não é esperada (por exemplo, qualquer função que não tenha um parâmetro *HWND* ), a DLL da interface do usuário deve exportar [**TUISPI \_ providerGenericDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialog) e [**TUISPI \_ providerGenericDialogData**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialogdata).</span><span class="sxs-lookup"><span data-stu-id="cb9eb-111">If the service provider ever generates spontaneous UI, such as the Unimodem **Talk/Hangup** dialog box, in conjunction with any TSPI function for which UI is not expected (for example, any function that does not have an *hwnd* parameter), then the UI DLL must export [**TUISPI\_providerGenericDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialog) and [**TUISPI\_providerGenericDialogData**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialogdata).</span></span>

> [!Note]  
> <span data-ttu-id="cb9eb-112">As funções de geração de interface do usuário do TSPI originais ( [**TSPI \_ lineConfigDialog**](/windows/win32/api/tspi/nf-tspi-tspi_lineconfigdialog), [**TSPI \_ lineConfigDialogEdit**](/windows/win32/api/tspi/nf-tspi-tspi_lineconfigdialogedit), [**TSPI \_ PhoneConfigDialog**](/windows/win32/api/tspi/nf-tspi-tspi_phoneconfigdialog), [**TSPI \_ providerConfig**](/windows/win32/api/tspi/nf-tspi-tspi_providerconfig), [**TSPI \_ providerInstall**](/windows/win32/api/tspi/nf-tspi-tspi_providerinstall)e [**TSPI \_**](/windows/win32/api/tspi/nf-tspi-tspi_providerremove)providerRemove) são obsoletas e nunca são chamadas pela TAPI.</span><span class="sxs-lookup"><span data-stu-id="cb9eb-112">The original TSPI UI-generating functions ( [**TSPI\_lineConfigDialog**](/windows/win32/api/tspi/nf-tspi-tspi_lineconfigdialog), [**TSPI\_lineConfigDialogEdit**](/windows/win32/api/tspi/nf-tspi-tspi_lineconfigdialogedit), [**TSPI\_phoneConfigDialog**](/windows/win32/api/tspi/nf-tspi-tspi_phoneconfigdialog), [**TSPI\_providerConfig**](/windows/win32/api/tspi/nf-tspi-tspi_providerconfig), [**TSPI\_providerInstall**](/windows/win32/api/tspi/nf-tspi-tspi_providerinstall), and [**TSPI\_providerRemove**](/windows/win32/api/tspi/nf-tspi-tspi_providerremove)) are obsolete and never called by TAPI.</span></span> <span data-ttu-id="cb9eb-113">Portanto, eles não precisam ser exportados pela DLL do provedor de serviços.</span><span class="sxs-lookup"><span data-stu-id="cb9eb-113">Therefore, these are not required to be exported by the service provider DLL.</span></span> <span data-ttu-id="cb9eb-114">No entanto, se o provedor de serviços quiser ser listado como um que possa ser adicionado pelo painel de controle de telefonia, um utilitário fornecido com a telefonia do Windows nas versões 1,4 e anteriores, ele deve **Exportar \_ TSPI providerInstall**; se desejar que o botão [**remover**](/windows/win32/api/tapi3if/nn-tapi3if-itcollection2) seja habilitado no painel de controle de telefonia quando for selecionado, ele deverá exportar **TSPI \_ providerRemove**; e se desejar que o botão de **configuração** seja habilitado no painel de controle de telefonia quando for selecionado, ele deverá exportar **TSPI \_ providerConfig**.</span><span class="sxs-lookup"><span data-stu-id="cb9eb-114">However, if the service provider wants to be listed as one that can be added by the Telephony Control Panel, a utility supplied with Windows Telephony in versions 1.4 and earlier, it must export **TSPI\_providerInstall**; if it wants to have the [**Remove**](/windows/win32/api/tapi3if/nn-tapi3if-itcollection2) button enabled in the Telephony Control Panel when it is selected, it must export **TSPI\_providerRemove**; and if it wants the **Setup** button to be enabled in the Telephony Control Panel when it is selected, it must export **TSPI\_providerConfig**.</span></span> <span data-ttu-id="cb9eb-115">O painel de controle de telefonia verifica a presença dessas funções no arquivo TSP do provedor de serviços para ajustar sua interface do usuário para refletir quais operações podem ser executadas.</span><span class="sxs-lookup"><span data-stu-id="cb9eb-115">The Telephony Control Panel checks for the presence of these functions in the service provider TSP file to adjust its user interface to reflect which operations can be performed.</span></span>

 

<span data-ttu-id="cb9eb-116">A DLL do provedor de serviços deve exportar a função [**TSPI \_ providerUIIdentify**](/windows/win32/api/tspi/nf-tspi-tspi_provideruiidentify) que o processo do TAPISRV usa para obter o nome da dll da interface do usuário a ser carregada no processo do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="cb9eb-116">The service provider DLL must export the [**TSPI\_providerUIIdentify**](/windows/win32/api/tspi/nf-tspi-tspi_provideruiidentify) function that TAPISRV process uses to obtain the name of the UI DLL to load in the application process.</span></span> <span data-ttu-id="cb9eb-117">Ele deve exportar a função [**TSPI \_ providerGenericDialogData**](/windows/win32/api/tspi/nf-tspi-tspi_providergenericdialogdata) para receber e responder a solicitações da dll da interface do usuário para que os dados sejam exibidos, e ele deve exportar [**TSPI \_ providerFreeDialogInstance**](/windows/win32/api/tspi/nf-tspi-tspi_providerfreedialoginstance) para o processo TAPISRV para informar ao provedor de serviços quando liberar uma associação estabelecida com a finalidade de gerar uma interface do usuário espontanea em conjunto com uma função que não está definida como apresentação da interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="cb9eb-117">It must export the [**TSPI\_providerGenericDialogData**](/windows/win32/api/tspi/nf-tspi-tspi_providergenericdialogdata) function to receive and respond to requests from the UI DLL for data to display, and it must export [**TSPI\_providerFreeDialogInstance**](/windows/win32/api/tspi/nf-tspi-tspi_providerfreedialoginstance) for TAPISRV process to tell the service provider when to release an association established for the purpose of generating spontaneous UI in conjunction with a function that is not defined as presenting UI to the user.</span></span> <span data-ttu-id="cb9eb-118">A DLL do provedor de serviços pode enviar de forma unidirecional dados para a DLL da interface do usuário usando a nova linha de mensagem TSPI [**\_ SENDDIALOGINSTANCEDATA**](line-senddialoginstancedata.md).</span><span class="sxs-lookup"><span data-stu-id="cb9eb-118">The service provider DLL can unidirectionally send data to the UI DLL by using the new TSPI message [**LINE\_SENDDIALOGINSTANCEDATA**](line-senddialoginstancedata.md).</span></span>

<span data-ttu-id="cb9eb-119">Como os nomes das funções TSPI e TUISPI são intencionalmente definidos para serem diferentes, a DLL do provedor de serviços e a DLL da interface do usuário podem ser o mesmo arquivo DLL, se desejado.</span><span class="sxs-lookup"><span data-stu-id="cb9eb-119">Because the names of the TSPI and TUISPI functions are intentionally defined to be different, the service provider DLL and the UI DLL can be the same DLL file, if desired.</span></span> <span data-ttu-id="cb9eb-120">Com a segmentação adequada, isso não resulta necessariamente em nenhum uso desnecessário da memória no contexto do aplicativo e pode simplificar o processo de instalação para provedores de serviços que podem ser implementados no momento em uma única DLL.</span><span class="sxs-lookup"><span data-stu-id="cb9eb-120">With proper segmentation, this does not necessarily result in any unnecessary usage of memory in the application context, and can simplify the installation process for service providers that can currently be implemented in a single DLL.</span></span> <span data-ttu-id="cb9eb-121">A TAPI chama apenas as funções que são apropriadas para o contexto no qual a DLL está sendo usada.</span><span class="sxs-lookup"><span data-stu-id="cb9eb-121">TAPI calls only the functions that are appropriate for the context in which the DLL is being used.</span></span>

<span data-ttu-id="cb9eb-122">O provedor de serviços de telefonia e a DLL de interface do usuário devem ser projetados com o requisito em mente que as funções de interface do usuário podem ser invocadas de vários processos de aplicativos simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="cb9eb-122">The telephony service provider and the UI DLL must both be designed with the requirement in mind that the UI functions can be invoked from multiple application processes simultaneously.</span></span> <span data-ttu-id="cb9eb-123">Eles também devem considerar que o aplicativo e o serviço TAPI sob os quais o provedor de serviços de telefonia está em execução podem estar em computadores separados em uma LAN.</span><span class="sxs-lookup"><span data-stu-id="cb9eb-123">They must also consider that the application and the TAPI service under which the telephony service provider is executing can be on separate computers on a LAN.</span></span>

 

 
