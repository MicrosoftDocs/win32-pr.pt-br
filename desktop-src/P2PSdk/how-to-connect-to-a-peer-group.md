---
description: Este tópico discute como um aplicativo se conecta a um grupo de pares usando as APIs de agrupamento de pares.
ms.assetid: 56fa28d8-3b3a-4cd5-8448-c8c4ce8d0b2c
title: Como se conectar a um grupo de pares
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d5bb3f41342573742e634a6e7ebce283188f3ffd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105758291"
---
# <a name="how-to-connect-to-a-peer-group"></a><span data-ttu-id="393b4-103">Como se conectar a um grupo de pares</span><span class="sxs-lookup"><span data-stu-id="393b4-103">How to Connect to a Peer Group</span></span>

<span data-ttu-id="393b4-104">Este tópico discute como um aplicativo se conecta a um grupo de pares usando as APIs de agrupamento de pares.</span><span class="sxs-lookup"><span data-stu-id="393b4-104">This topic discusses how an application connects to a peer group using the Peer Grouping APIs.</span></span>

## <a name="joining-a-peer-group"></a><span data-ttu-id="393b4-105">Ingressando em um grupo de pares</span><span class="sxs-lookup"><span data-stu-id="393b4-105">Joining a Peer Group</span></span>

<span data-ttu-id="393b4-106">Para ingressar em um grupo de pares, chame [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin), passando o nome da identidade do par e o convite (e um nome de nuvem PNRP opcional, se o nome da nuvem no convite for ambíguo).</span><span class="sxs-lookup"><span data-stu-id="393b4-106">To join a peer group, call [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin), passing in the identity name of the peer and the invitation (and an optional PNRP cloud name, if the cloud name in the invitation is ambiguous).</span></span>

<span data-ttu-id="393b4-107">Se for bem-sucedido, [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin) retornará um identificador para o grupo de pares.</span><span class="sxs-lookup"><span data-stu-id="393b4-107">If successful, [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin) returns a handle to the peer group.</span></span>

<span data-ttu-id="393b4-108">Se o par tiver ingressado anteriormente no grupo par e, em seguida, fechar o identificador, o grupo par deverá ser reaberto chamando [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) e passando o nome do grupo par.</span><span class="sxs-lookup"><span data-stu-id="393b4-108">If the peer has previously joined the peer group and then closed the handle, the peer group should be reopened by calling [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) and passing in the name of the peer group.</span></span> <span data-ttu-id="393b4-109">Essa chamada retorna um novo identificador de grupo de pares.</span><span class="sxs-lookup"><span data-stu-id="393b4-109">This call returns a new peer group handle.</span></span>

<span data-ttu-id="393b4-110">Depois que o grupo de pares for Unido com êxito, o par poderá se conectar diretamente ao grupo de pares e começar a interagir chamando [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect).</span><span class="sxs-lookup"><span data-stu-id="393b4-110">Once the peer group is successfully joined, the peer may connect directly to the peer group and begin interacting by calling [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect).</span></span> <span data-ttu-id="393b4-111">Após a conexão, o par é considerado "online".</span><span class="sxs-lookup"><span data-stu-id="393b4-111">After connecting, the peer is considered to be "online".</span></span>

<span data-ttu-id="393b4-112">Se um aplicativo não for interagir com o grupo no momento, ele poderá permanecer "offline".</span><span class="sxs-lookup"><span data-stu-id="393b4-112">If an application will not interact with the group at the time, it can remain "offline".</span></span> <span data-ttu-id="393b4-113">Se ele optar por participar diretamente do grupo de pares em uma instância posterior, uma chamada subsequente para [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) o colocará online.</span><span class="sxs-lookup"><span data-stu-id="393b4-113">If it chooses to participate directly in the peer group at a later instance, a subsequent call to [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) will bring it online.</span></span> <span data-ttu-id="393b4-114">Depois que um par tiver ingressado no grupo par, ele deverá se conectar pelo menos uma vez antes de poder publicar registros no grupo par.</span><span class="sxs-lookup"><span data-stu-id="393b4-114">After a peer has joined the peer group, it must connect at least once before it will be able to publish records to the peer group.</span></span>

## <a name="opening-a-peer-group-without-connecting-offline"></a><span data-ttu-id="393b4-115">Abrindo um grupo de pares sem se conectar (offline)</span><span class="sxs-lookup"><span data-stu-id="393b4-115">Opening a Peer Group Without Connecting (Offline)</span></span>

<span data-ttu-id="393b4-116">Muitas vezes, talvez você queira fazer com que um aplicativo se conecte a um grupo de mesmo nível, mas não o participe diretamente, recebendo e publicando atualizações de registro, mas não enviando nem recebendo mensagens de dados.</span><span class="sxs-lookup"><span data-stu-id="393b4-116">Often, you may wish to have an application connect to a peer group but not directly participate it, receiving and publishing record updates but not sending or receiving data messages.</span></span> <span data-ttu-id="393b4-117">Um aplicativo está nesse estado "offline" imediatamente após [**PeerGroupCreate**](/windows/desktop/api/P2P/nf-p2p-peergroupcreate), [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin)ou [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) ter sido chamado.</span><span class="sxs-lookup"><span data-stu-id="393b4-117">An application is in this "offline" state immediately after [**PeerGroupCreate**](/windows/desktop/api/P2P/nf-p2p-peergroupcreate), [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin), or [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) have been called.</span></span>

<span data-ttu-id="393b4-118">Um aplicativo offline pode ficar online a qualquer momento chamando [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect).</span><span class="sxs-lookup"><span data-stu-id="393b4-118">An offline application can go online at any time by calling [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect).</span></span> <span data-ttu-id="393b4-119">Uma vez conectado, um grupo de pares não pode ficar offline até que todos os outros aplicativos associados a essa identidade e o compartilhamento desse grupo tenham conexões fechadas também.</span><span class="sxs-lookup"><span data-stu-id="393b4-119">Once connected, a peer group cannot go offline until all other applications associated with this identity and sharing this group have closed connections to it as well.</span></span>

<span data-ttu-id="393b4-120">Um grupo de pares é um recurso compartilhado, com o mesmo grupo de pares disponível para vários aplicativos.</span><span class="sxs-lookup"><span data-stu-id="393b4-120">A peer group is a shared resource, with the same peer group available to multiple applications.</span></span> <span data-ttu-id="393b4-121">Se mais de um aplicativo para a mesma identidade e usuário do Windows estiver usando o mesmo grupo de pares, eles também compartilharão o mesmo banco de dados e conexões subjacentes (vizinho e direto).</span><span class="sxs-lookup"><span data-stu-id="393b4-121">If more than one application for the same identity and Windows user is using the same peer group, they also share the same underlying database and connections (neighbor and direct).</span></span> <span data-ttu-id="393b4-122">Se qualquer um desses aplicativos chamar [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect), todos os outros aplicativos para esta identidade/usuário que participa do grupo também se conectarão ao grupo.</span><span class="sxs-lookup"><span data-stu-id="393b4-122">If any one of these applications calls [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect), all of the other applications for this identity/user participating in the group also connect to the group.</span></span> <span data-ttu-id="393b4-123">Se um registro for adicionado por um aplicativo enquanto o grupo estiver offline, outros aplicativos também poderão vê-lo.</span><span class="sxs-lookup"><span data-stu-id="393b4-123">If a record is added by one application while the group is offline, other applications are also be able to see it.</span></span> <span data-ttu-id="393b4-124">Como resultado, um aplicativo deve estar pronto para ficar online a qualquer momento.</span><span class="sxs-lookup"><span data-stu-id="393b4-124">As a result, an application must be ready to go online at any time.</span></span>

## <a name="connecting-to-a-peer-group-online"></a><span data-ttu-id="393b4-125">Conectando a um grupo par (online)</span><span class="sxs-lookup"><span data-stu-id="393b4-125">Connecting to a Peer Group (Online)</span></span>

<span data-ttu-id="393b4-126">Para começar a participar de um grupo, chame [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) depois de criar, ingressar ou abrir o grupo.</span><span class="sxs-lookup"><span data-stu-id="393b4-126">To begin participating in a group, call [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) after creating, joining, or opening the group.</span></span> <span data-ttu-id="393b4-127">Nesse estado, as conexões diretas podem ser abertas com outros pares que participam do mesmo grupo chamando [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection).</span><span class="sxs-lookup"><span data-stu-id="393b4-127">In this state, direct connections can be opened with other peers participating in the same group by calling [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection).</span></span>

<span data-ttu-id="393b4-128">Para detectar se uma tentativa de conexão falhou, registre-se para o evento de falha na conexão de evento do grupo de pares \_ \_ \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="393b4-128">To detect if a connection attempt has failed, register for the PEER\_GROUP\_EVENT\_CONNECTION\_FAILED event.</span></span> <span data-ttu-id="393b4-129">Esse evento será gerado se a infraestrutura de agrupamento não puder encontrar outro membro ao qual se conectar, ou se a conexão falhar antes de o banco de dados do grupo ser sincronizado e outra conexão não puder ser estabelecida.</span><span class="sxs-lookup"><span data-stu-id="393b4-129">This event is raised if the grouping infrastructure cannot find another member to connect to, or if the connection fails before the group database is synchronized and another connection cannot be established.</span></span>

<span data-ttu-id="393b4-130">Embora vários aplicativos em execução no mesmo nível e que participam do mesmo grupo com a mesma identidade de mesmo nível possam estar offline, uma chamada para [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) por qualquer um dos aplicativos resulta em todos os aplicativos que se tornam online.</span><span class="sxs-lookup"><span data-stu-id="393b4-130">Although multiple applications executing on the peer and participating in the same group with the same peer identity may be offline, a call to [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) by any one of the applications results in all of the applications becoming online.</span></span>

<span data-ttu-id="393b4-131">Além disso, se um aplicativo no par tiver se conectado ao grupo, todos os outros aplicativos que chamarem [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin) ou [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) também serão conectados imediatamente.</span><span class="sxs-lookup"><span data-stu-id="393b4-131">Also, if one application on the peer has connected to the group, any other applications that call [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin) or [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) are immediately connected as well.</span></span> <span data-ttu-id="393b4-132">Se um aplicativo chamar [**PeerGroupClose**](/windows/desktop/api/P2P/nf-p2p-peergroupclose), o identificador será fechado somente para esse aplicativo.</span><span class="sxs-lookup"><span data-stu-id="393b4-132">If an application calls [**PeerGroupClose**](/windows/desktop/api/P2P/nf-p2p-peergroupclose), the handle is closed for only that application.</span></span> <span data-ttu-id="393b4-133">Assim, uma chamada subsequente para **PeerGroupOpen** pelo aplicativo retorna um novo identificador de grupo, e o aplicativo será colocado online imediatamente se qualquer outro aplicativo que participa do mesmo grupo ainda estiver conectado.</span><span class="sxs-lookup"><span data-stu-id="393b4-133">Thus, a subsequent call to **PeerGroupOpen** by the application returns a new group handle, and the application is brought online immediately if any other applications participating in the same group are still connected.</span></span>

## <a name="sending-and-receiving-data"></a><span data-ttu-id="393b4-134">Enviando e recebendo dados</span><span class="sxs-lookup"><span data-stu-id="393b4-134">Sending and Receiving Data</span></span>

<span data-ttu-id="393b4-135">Para enviar e receber dados entre nós de membro específicos no grupo, as conexões diretas devem ser estabelecidas com os membros com os quais você pretende interagir.</span><span class="sxs-lookup"><span data-stu-id="393b4-135">To send and receive data between specific member nodes in the group, direct connections must be established with those members you intend to interact with.</span></span> <span data-ttu-id="393b4-136">O estabelecimento de uma conexão direta é uma chamada assíncrona para [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection), passando o identificador para um grupo conectado, bem como a identidade do par no grupo ao qual você deseja se conectar.</span><span class="sxs-lookup"><span data-stu-id="393b4-136">Establishing a direct connection is an asynchronous call to [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection), passing in the handle for a connected group as well as the identity of the peer within the group you wish to connect to.</span></span> <span data-ttu-id="393b4-137">Esse método retornará uma ID de conexão.</span><span class="sxs-lookup"><span data-stu-id="393b4-137">This method will return a connection ID.</span></span> <span data-ttu-id="393b4-138">Se a chamada for bem-sucedida, um \_ evento de conexão direta de evento de grupo de pares \_ \_ \_ será gerado no par, validando a ID de conexão.</span><span class="sxs-lookup"><span data-stu-id="393b4-138">If the call is successful, a PEER\_GROUP\_EVENT\_DIRECT\_CONNECTION event is raised on the peer, validating the connection ID.</span></span>

<span data-ttu-id="393b4-139">Para receber conexões diretas de outros pares online, registre-se para o \_ evento de conexão direta de evento de grupo de pares \_ \_ \_ com uma chamada para [**PeerGroupRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent).</span><span class="sxs-lookup"><span data-stu-id="393b4-139">To receive direct connections from other online peers, register for the PEER\_GROUP\_EVENT\_DIRECT\_CONNECTION event with a call to [**PeerGroupRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent).</span></span>

<span data-ttu-id="393b4-140">Depois que uma conexão direta tiver sido estabelecida com êxito, o aplicativo poderá começar a enviar dados com chamadas para [**PeerGroupSendData**](/windows/desktop/api/P2P/nf-p2p-peergroupsenddata), passando a ID de conexão válida.</span><span class="sxs-lookup"><span data-stu-id="393b4-140">Once a direct connection has been successfully established, the application can begin sending data with calls to [**PeerGroupSendData**](/windows/desktop/api/P2P/nf-p2p-peergroupsenddata), passing the valid connection ID.</span></span> <span data-ttu-id="393b4-141">A ordenação de transmissões de dados com várias partes é tratada pelo **PeerGroupSendData**.</span><span class="sxs-lookup"><span data-stu-id="393b4-141">The ordering of multipart data transmissions is handled by **PeerGroupSendData**.</span></span> <span data-ttu-id="393b4-142">No entanto, os aplicativos devem implementar uma pilha de protocolos apropriada para manipular os dados opacos retornados por essa chamada à API.</span><span class="sxs-lookup"><span data-stu-id="393b4-142">However, applications should implement a proper protocol stack for handling the opaque data returned by this API call.</span></span>

<span data-ttu-id="393b4-143">Para receber dados em uma conexão direta, o aplicativo deve se registrar para o \_ evento de entrada de evento do grupo de pares \_ \_ \_ com [**PeerGroupRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent).</span><span class="sxs-lookup"><span data-stu-id="393b4-143">To receive data over a direct connection, the application must register for the PEER\_GROUP\_EVENT\_INCOMING\_DATA event with [**PeerGroupRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent).</span></span> <span data-ttu-id="393b4-144">O manipulador de eventos é responsável por obter e ordenar os dados opacos e passá-los para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="393b4-144">The event handler is responsible for obtaining and ordering the opaque data, and passing it to the application.</span></span> <span data-ttu-id="393b4-145">Esses dados são obtidos no manipulador de eventos chamando [**PeerGroupGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata) com o identificador para os eventos registrados.</span><span class="sxs-lookup"><span data-stu-id="393b4-145">This data is obtained within the event handler by calling [**PeerGroupGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata) with the handle to the registered events.</span></span>

<span data-ttu-id="393b4-146">Uma conexão direta é fechada chamando [**PeerGroupCloseDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupclosedirectconnection) e passando a ID de conexão obtida por uma chamada anterior para [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection) ou recebida nos dados de evento para \_ \_ conexão direta do grupo de eventos de pares \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="393b4-146">A direct connection is closed by calling [**PeerGroupCloseDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupclosedirectconnection) and passing in the connection ID obtained by a previous call to [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection) or received in the event data for PEER\_EVENT\_GROUP\_DIRECT\_CONNECTION.</span></span>

 

 



