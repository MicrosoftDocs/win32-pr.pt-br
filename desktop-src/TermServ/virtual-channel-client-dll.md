---
title: DLL de cliente de canal virtual
description: O cliente de um aplicativo de canais virtuais é uma DLL que é carregada durante a inicialização do Serviços de Área de Trabalho Remota no computador cliente. A DLL deve ser registrada no computador cliente.
ms.assetid: fca0505c-c4a9-4230-aeaa-ff3dfa62f581
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cfd7ffccda8b1da7dfc3920b0a47a12e97840e0a
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/16/2019
ms.locfileid: "104005579"
---
# <a name="virtual-channel-client-dll"></a><span data-ttu-id="1a04e-104">DLL de cliente de canal virtual</span><span class="sxs-lookup"><span data-stu-id="1a04e-104">Virtual Channel Client DLL</span></span>

<span data-ttu-id="1a04e-105">O cliente de um aplicativo de canais virtuais é uma DLL que é carregada durante a inicialização do Serviços de Área de Trabalho Remota no computador cliente.</span><span class="sxs-lookup"><span data-stu-id="1a04e-105">The client of a virtual channels application is a DLL that is loaded during the Remote Desktop Services initialization on the client computer.</span></span> <span data-ttu-id="1a04e-106">A DLL deve ser registrada no computador cliente.</span><span class="sxs-lookup"><span data-stu-id="1a04e-106">The DLL must be registered on the client computer.</span></span> <span data-ttu-id="1a04e-107">Para obter mais informações, consulte [registro de cliente de canal virtual](virtual-channel-client-registration.md).</span><span class="sxs-lookup"><span data-stu-id="1a04e-107">For more information, see [Virtual Channel Client Registration](virtual-channel-client-registration.md).</span></span>

<span data-ttu-id="1a04e-108">A DLL do cliente deve exportar uma função [**VirtualChannelEntry**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelentry) , que serviços de área de trabalho remota chamadas durante a inicialização.</span><span class="sxs-lookup"><span data-stu-id="1a04e-108">The client DLL must export a [**VirtualChannelEntry**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelentry) function, which Remote Desktop Services calls during initialization.</span></span> <span data-ttu-id="1a04e-109">O ponto de entrada **VirtualChannelEntry** recebe um ponteiro para uma estrutura de [**pontos de \_ entrada \_ de canal**](/windows/win32/api/cchannel/ns-cchannel-channel_entry_points) .</span><span class="sxs-lookup"><span data-stu-id="1a04e-109">The **VirtualChannelEntry** entry point receives a pointer to a [**CHANNEL\_ENTRY\_POINTS**](/windows/win32/api/cchannel/ns-cchannel-channel_entry_points) structure.</span></span> <span data-ttu-id="1a04e-110">Essa estrutura contém ponteiros para as funções que a DLL do cliente chama para acessar canais virtuais.</span><span class="sxs-lookup"><span data-stu-id="1a04e-110">This structure contains pointers to the functions that the client DLL calls to access virtual channels.</span></span>



| <span data-ttu-id="1a04e-111">Função</span><span class="sxs-lookup"><span data-stu-id="1a04e-111">Function</span></span>                                                      | <span data-ttu-id="1a04e-112">Descrição</span><span class="sxs-lookup"><span data-stu-id="1a04e-112">Description</span></span>                                                                                                                                                                                                                                                                           |
|---------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="1a04e-113">**VirtualChannelInit**</span><span class="sxs-lookup"><span data-stu-id="1a04e-113">**VirtualChannelInit**</span></span>](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelinit)<br/>   | <span data-ttu-id="1a04e-114">Registra os nomes dos canais virtuais a serem usados pelo cliente e fornece uma função de retorno de chamada [**VirtualChannelInitEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_init_event_fn) por meio da qual o serviços de área de trabalho remota notifica o cliente sobre eventos que afetam a conexão do cliente.</span><span class="sxs-lookup"><span data-stu-id="1a04e-114">Registers the names of the virtual channels to be used by the client and provides a [**VirtualChannelInitEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_init_event_fn) callback function through which Remote Desktop Services notifies the client about events that affect the client connection.</span></span><br/> |
| [<span data-ttu-id="1a04e-115">**VirtualChannelOpen**</span><span class="sxs-lookup"><span data-stu-id="1a04e-115">**VirtualChannelOpen**</span></span>](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelopen)<br/>   | <span data-ttu-id="1a04e-116">Abre a extremidade do cliente de um canal virtual especificado e fornece uma função de retorno de chamada [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) por meio da qual o serviços de área de trabalho remota notifica o cliente sobre eventos que afetam o canal virtual.</span><span class="sxs-lookup"><span data-stu-id="1a04e-116">Opens the client end of a specified virtual channel and provides a [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) callback function through which Remote Desktop Services notifies the client about events that affect the virtual channel.</span></span><br/>                    |
| [<span data-ttu-id="1a04e-117">**VirtualChannelWrite**</span><span class="sxs-lookup"><span data-stu-id="1a04e-117">**VirtualChannelWrite**</span></span>](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelwrite)<br/> | <span data-ttu-id="1a04e-118">Grava dados em um canal virtual.</span><span class="sxs-lookup"><span data-stu-id="1a04e-118">Writes data to a virtual channel.</span></span> <span data-ttu-id="1a04e-119">Serviços de Área de Trabalho Remota envia esses dados para a extremidade do servidor do canal virtual.</span><span class="sxs-lookup"><span data-stu-id="1a04e-119">Remote Desktop Services sends this data to the server end of the virtual channel.</span></span> <span data-ttu-id="1a04e-120">A extremidade do servidor chama a função [**WTSVirtualChannelRead**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsvirtualchannelread) para ler os dados.</span><span class="sxs-lookup"><span data-stu-id="1a04e-120">The server end calls the [**WTSVirtualChannelRead**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsvirtualchannelread) function to read the data.</span></span><br/>                                             |
| [<span data-ttu-id="1a04e-121">**VirtualChannelClose**</span><span class="sxs-lookup"><span data-stu-id="1a04e-121">**VirtualChannelClose**</span></span>](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelclose)<br/> | <span data-ttu-id="1a04e-122">Fecha um canal virtual.</span><span class="sxs-lookup"><span data-stu-id="1a04e-122">Closes a virtual channel.</span></span><br/>                                                                                                                                                                                                                                                  |



 

<span data-ttu-id="1a04e-123">A função [**VirtualChannelEntry**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelentry) de sua DLL deve chamar a função [**VirtualChannelInit**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelinit) para inicializar o acesso aos canais virtuais.</span><span class="sxs-lookup"><span data-stu-id="1a04e-123">Your DLL's [**VirtualChannelEntry**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelentry) function must call the [**VirtualChannelInit**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelinit) function to initialize access to virtual channels.</span></span> <span data-ttu-id="1a04e-124">Ao chamar **VirtualChannelInit**, você deve passar um ponteiro para a função de retorno de chamada [**VirtualChannelInitEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_init_event_fn) .</span><span class="sxs-lookup"><span data-stu-id="1a04e-124">When you call **VirtualChannelInit**, you must pass a pointer to the [**VirtualChannelInitEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_init_event_fn) callback function.</span></span> <span data-ttu-id="1a04e-125">Serviços de Área de Trabalho Remota chama essa função de retorno de chamada quando a inicialização é concluída e novamente quando uma conexão é estabelecida com um servidor Host da Sessão da Área de Trabalho Remota (Host da Sessão RD).</span><span class="sxs-lookup"><span data-stu-id="1a04e-125">Remote Desktop Services calls this callback function when initialization is complete and again when a connection has been established with a Remote Desktop Session Host (RD Session Host) server.</span></span>

<span data-ttu-id="1a04e-126">Depois que a conexão é estabelecida, você pode chamar a função [**VirtualChannelOpen**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelopen) para abrir os canais virtuais registrados pela chamada [**VirtualChannelInit**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelinit) .</span><span class="sxs-lookup"><span data-stu-id="1a04e-126">After the connection is established, you can call the [**VirtualChannelOpen**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelopen) function to open the virtual channels registered by the [**VirtualChannelInit**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelinit) call.</span></span> <span data-ttu-id="1a04e-127">A chamada **VirtualChannelOpen** especifica um ponteiro para sua função de retorno de chamada [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) .</span><span class="sxs-lookup"><span data-stu-id="1a04e-127">The **VirtualChannelOpen** call specifies a pointer to your [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) callback function.</span></span>

<span data-ttu-id="1a04e-128">Depois que a chamada [**VirtualChannelOpen**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelopen) retorna, você pode chamar a função [**VirtualChannelWrite**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelwrite) para gravar no canal virtual.</span><span class="sxs-lookup"><span data-stu-id="1a04e-128">After the [**VirtualChannelOpen**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelopen) call returns, you can call the [**VirtualChannelWrite**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelwrite) function to write to the virtual channel.</span></span> <span data-ttu-id="1a04e-129">A operação de gravação é assíncrona, portanto, você não deve liberar ou reutilizar o buffer passado para **VirtualChannelWrite** até que serviços de área de trabalho remota chame sua função [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) para indicar que a operação de gravação foi concluída.</span><span class="sxs-lookup"><span data-stu-id="1a04e-129">The write operation is asynchronous, so you must not free or reuse the buffer passed to **VirtualChannelWrite** until Remote Desktop Services calls your [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) function to indicate that the write operation has been completed.</span></span> <span data-ttu-id="1a04e-130">Ao chamar **VirtualChannelWrite**, você pode passar uma parte dos dados do usuário que identifica a operação de gravação.</span><span class="sxs-lookup"><span data-stu-id="1a04e-130">When you call **VirtualChannelWrite**, you can pass a piece of user data that identifies the write operation.</span></span> <span data-ttu-id="1a04e-131">Serviços de Área de Trabalho Remota passa esses dados do usuário de volta quando chama **VirtualChannelOpenEvent** para notificá-lo de que a operação foi concluída.</span><span class="sxs-lookup"><span data-stu-id="1a04e-131">Remote Desktop Services passes this user data back when it calls **VirtualChannelOpenEvent** to notify you that the operation has completed.</span></span> <span data-ttu-id="1a04e-132">Na extremidade do servidor do canal virtual, o suplemento do servidor chama a função [**WTSVirtualChannelRead**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsvirtualchannelread) para ler os dados.</span><span class="sxs-lookup"><span data-stu-id="1a04e-132">At the server end of the virtual channel, the server add-in calls the [**WTSVirtualChannelRead**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsvirtualchannelread) function to read the data.</span></span>

<span data-ttu-id="1a04e-133">Serviços de Área de Trabalho Remota também chama sua função [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) quando os dados são gravados no canal virtual pelo módulo do servidor.</span><span class="sxs-lookup"><span data-stu-id="1a04e-133">Remote Desktop Services also calls your [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) function when data is written to the virtual channel by the server module.</span></span> <span data-ttu-id="1a04e-134">O módulo de servidor chama a função [**WTSVirtualChannelWrite**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsvirtualchannelwrite) para gravar dados na extremidade do servidor do canal virtual.</span><span class="sxs-lookup"><span data-stu-id="1a04e-134">The server module calls the [**WTSVirtualChannelWrite**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsvirtualchannelwrite) function to write data to the server end of the virtual channel.</span></span>

<span data-ttu-id="1a04e-135">Os módulos cliente e servidor podem gravar blocos de dados de qualquer tamanho para o canal virtual.</span><span class="sxs-lookup"><span data-stu-id="1a04e-135">The client and server modules can write data blocks of any size to the virtual channel.</span></span> <span data-ttu-id="1a04e-136">No entanto, antes de enviar os dados, Serviços de Área de Trabalho Remota segmenta os dados em partes de bytes de comprimento da parte do canal \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="1a04e-136">Before sending the data, however, Remote Desktop Services segments the data into chunks of CHANNEL\_CHUNK\_LENGTH bytes.</span></span> <span data-ttu-id="1a04e-137">Serviços de Área de Trabalho Remota chama sua função [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) uma vez para cada parte dos dados, em vez de recriar os dados em um bloco do tamanho original.</span><span class="sxs-lookup"><span data-stu-id="1a04e-137">Remote Desktop Services calls your [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) function once for each chunk of data, rather than rebuilding the data into a block of the original size.</span></span> <span data-ttu-id="1a04e-138">Cada chamada para **VirtualChannelOpenEvent** indica o tamanho da parte, o tamanho total gravado pelo servidor e se os dados constituem o início, o meio ou o fim de um bloco gravado pelo servidor.</span><span class="sxs-lookup"><span data-stu-id="1a04e-138">Each call to **VirtualChannelOpenEvent** indicates the size of the chunk, the total size written by the server, and whether the data constitutes the beginning, middle, or end of a block written by the server.</span></span>

<span data-ttu-id="1a04e-139">Você pode chamar a função [**VirtualChannelClose**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelclose) para fechar um canal.</span><span class="sxs-lookup"><span data-stu-id="1a04e-139">You can call the [**VirtualChannelClose**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelclose) function to close a channel.</span></span> <span data-ttu-id="1a04e-140">No entanto, não é necessário chamá-lo porque Serviços de Área de Trabalho Remota fecha todos os canais automaticamente quando o cliente se desconecta do servidor.</span><span class="sxs-lookup"><span data-stu-id="1a04e-140">However, it is not necessary to call it because Remote Desktop Services closes all channels automatically when the client disconnects from the server.</span></span>

 

 





