---
title: Como usar a API de cliente do agente de Conexão de Área de Trabalho Remota
description: A API de cliente do agente de Conexão de Área de Trabalho Remota permite que fornecedores de protocolo de terceiros aproveitem o agente de conexão para agilizar a manipulação de conexões que usam seu protocolo para se conectar a máquinas virtuais ou servidores de Área de Trabalho Remota em um farm.
ms.assetid: 05C2D6CA-C9C5-4783-B196-6A02918046EF
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c931245870cfb72aed54e5aaff24e12d03ddf9e7
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/20/2020
ms.locfileid: "104294410"
---
# <a name="how-to-use-the-remote-desktop-connection-broker-client-api"></a><span data-ttu-id="78ff3-103">Como usar a API de cliente do agente de Conexão de Área de Trabalho Remota</span><span class="sxs-lookup"><span data-stu-id="78ff3-103">How to use the Remote Desktop Connection Broker client API</span></span>

<span data-ttu-id="78ff3-104">A API de cliente do agente de Conexão de Área de Trabalho Remota permite que fornecedores de protocolo de terceiros aproveitem o agente de conexão para agilizar a manipulação de conexões que usam seu protocolo para se conectar a máquinas virtuais ou servidores de Área de Trabalho Remota em um farm.</span><span class="sxs-lookup"><span data-stu-id="78ff3-104">The Remote Desktop Connection Broker client API allows third party protocol vendors to leverage the Connection Broker to expedite the handling of connections that use their protocol to connect to virtual machines or Remote Desktop servers in a farm.</span></span>

## <a name="instructions"></a><span data-ttu-id="78ff3-105">Instruções</span><span class="sxs-lookup"><span data-stu-id="78ff3-105">Instructions</span></span>

### <a name="step-1-obtain-the-iconnectionbrokerclient-interface"></a><span data-ttu-id="78ff3-106">Etapa 1: obter a interface IConnectionBrokerClient</span><span class="sxs-lookup"><span data-stu-id="78ff3-106">Step 1: Obtain the IConnectionBrokerClient interface</span></span>

<span data-ttu-id="78ff3-107">Quando seu aplicativo ou provedor de protocolo for inicializado, execute as etapas a seguir.</span><span class="sxs-lookup"><span data-stu-id="78ff3-107">When your application or protocol provider is initialized, perform the following steps.</span></span>

1.  <span data-ttu-id="78ff3-108">Chame a função [**CBCreateClientInstance**](cbcreateclientinstance.md) para obter a interface [**IConnectionBrokerClient**](iconnectionbrokerclient.md) .</span><span class="sxs-lookup"><span data-stu-id="78ff3-108">Call the [**CBCreateClientInstance**](cbcreateclientinstance.md) function to obtain the [**IConnectionBrokerClient**](iconnectionbrokerclient.md) interface.</span></span>
2.  <span data-ttu-id="78ff3-109">Mantenha a interface [**IConnectionBrokerClient**](iconnectionbrokerclient.md) contanto que você precise dela.</span><span class="sxs-lookup"><span data-stu-id="78ff3-109">Keep the [**IConnectionBrokerClient**](iconnectionbrokerclient.md) interface as long as you need it.</span></span>
3.  <span data-ttu-id="78ff3-110">Quando a interface [**IConnectionBrokerClient**](iconnectionbrokerclient.md) não for mais necessária, chame o método [**Release**](/windows/desktop/api/unknwn/nf-unknwn-iunknown-release) .</span><span class="sxs-lookup"><span data-stu-id="78ff3-110">When the [**IConnectionBrokerClient**](iconnectionbrokerclient.md) interface is no longer needed, call the [**Release**](/windows/desktop/api/unknwn/nf-unknwn-iunknown-release) method.</span></span>

### <a name="step-2-request-the-target-information"></a><span data-ttu-id="78ff3-111">Etapa 2: solicitar as informações de destino</span><span class="sxs-lookup"><span data-stu-id="78ff3-111">Step 2: Request the target information</span></span>

<span data-ttu-id="78ff3-112">Quando o provedor de protocolo receber uma solicitação de conexão de entrada, execute as seguintes etapas para chamar o método [**IConnectionBrokerClient:: GetTargetInfo**](iconnectionbrokerclient-gettargetinfo.md) .</span><span class="sxs-lookup"><span data-stu-id="78ff3-112">When your protocol provider receives an incoming connection request, perform the following steps to call the [**IConnectionBrokerClient::GetTargetInfo**](iconnectionbrokerclient-gettargetinfo.md) method.</span></span> <span data-ttu-id="78ff3-113">Esse método obtém, do agente de conexão, o servidor apropriado para redirecionar a conexão.</span><span class="sxs-lookup"><span data-stu-id="78ff3-113">This method obtains, from the Connection Broker, the appropriate server to redirect the connection to.</span></span>

1.  <span data-ttu-id="78ff3-114">Crie um evento que possa ser sinalizado usando a função [**CreateEvent**](/windows/desktop/api/synchapi/nf-synchapi-createeventa), ou semelhante, a ser usada para o parâmetro *hStatusEvent* .</span><span class="sxs-lookup"><span data-stu-id="78ff3-114">Create an event that can be signaled using the [**CreateEvent**](/windows/desktop/api/synchapi/nf-synchapi-createeventa), or similar function, to use for the *hStatusEvent* parameter.</span></span>
2.  <span data-ttu-id="78ff3-115">Aloque memória para os parâmetros *pTargetInfo* e *pResult* .</span><span class="sxs-lookup"><span data-stu-id="78ff3-115">Allocate memory for the *pTargetInfo* and *pResult* parameters.</span></span> <span data-ttu-id="78ff3-116">Esses blocos de memória devem permanecer no local até que toda a sequência seja concluída.</span><span class="sxs-lookup"><span data-stu-id="78ff3-116">These memory blocks must remain in place until after this entire sequence is complete.</span></span>
3.  <span data-ttu-id="78ff3-117">Preencha uma estrutura [**de \_ \_ informações de conexão CB**](cb-connection-info.md) que contenha todas as informações sobre a conexão de entrada.</span><span class="sxs-lookup"><span data-stu-id="78ff3-117">Fill out a [**CB\_CONNECTION\_INFO**](cb-connection-info.md) structure that contains all of the information about the incoming connection.</span></span>
4.  <span data-ttu-id="78ff3-118">Chame o método [**GetTargetInfo**](iconnectionbrokerclient-gettargetinfo.md) , passando todos os parâmetros necessários.</span><span class="sxs-lookup"><span data-stu-id="78ff3-118">Call the [**GetTargetInfo**](iconnectionbrokerclient-gettargetinfo.md) method, passing all of the required parameters.</span></span> <span data-ttu-id="78ff3-119">Esse é um método assíncrono que retornará uma instância da interface [**IConnectionBrokerRequest**](iconnectionbrokerrequest.md) .</span><span class="sxs-lookup"><span data-stu-id="78ff3-119">This is an asynchronous method that will return an instance of the [**IConnectionBrokerRequest**](iconnectionbrokerrequest.md) interface.</span></span>
5.  <span data-ttu-id="78ff3-120">Aguarde até que o evento *hStatusEvent* se torne definido.</span><span class="sxs-lookup"><span data-stu-id="78ff3-120">Wait for the *hStatusEvent* event to become set.</span></span>
6.  <span data-ttu-id="78ff3-121">Sempre que o evento *hStatusEvent* for definido, chame o método [**IConnectionBrokerRequest:: CheckStatus**](iconnectionbrokerrequest-checkstatus.md) para determinar o status da solicitação.</span><span class="sxs-lookup"><span data-stu-id="78ff3-121">Whenever the *hStatusEvent* event is set, call the [**IConnectionBrokerRequest::CheckStatus**](iconnectionbrokerrequest-checkstatus.md) method to determine the status of the request.</span></span>
7.  <span data-ttu-id="78ff3-122">Quando [**CheckStatus**](iconnectionbrokerrequest-checkstatus.md) retornar **a \_ solicitação de status CB \_ \_ concluída**, os parâmetros *pTargetInfo* e *pResult* conterá suas informações.</span><span class="sxs-lookup"><span data-stu-id="78ff3-122">When [**CheckStatus**](iconnectionbrokerrequest-checkstatus.md) returns **CB\_STATUS\_REQUEST\_COMPLETED**, the *pTargetInfo* and *pResult* parameters will contain their information.</span></span> <span data-ttu-id="78ff3-123">Você pode interromper o loop de espera porque o parâmetro *hStatusEvent* não será mais usado.</span><span class="sxs-lookup"><span data-stu-id="78ff3-123">You can break out of the wait loop because the *hStatusEvent* parameter will no longer be used.</span></span>
8.  <span data-ttu-id="78ff3-124">Use as informações na estrutura [**de \_ \_ informações de destino CB**](cb-target-info.md) representada pelo parâmetro *pTargetInfo* para determinar para onde redirecionar a conexão de entrada.</span><span class="sxs-lookup"><span data-stu-id="78ff3-124">Use the information in the [**CB\_TARGET\_INFO**](cb-target-info.md) structure represented by the *pTargetInfo* parameter to determine where to redirect the incoming connection to.</span></span>
9.  <span data-ttu-id="78ff3-125">Libere a interface [**IConnectionBrokerRequest**](iconnectionbrokerrequest.md) .</span><span class="sxs-lookup"><span data-stu-id="78ff3-125">Release the [**IConnectionBrokerRequest**](iconnectionbrokerrequest.md) interface.</span></span>
10. <span data-ttu-id="78ff3-126">Feche o identificador de evento *hStatusEvent* ou você pode reutilizá-lo para solicitações de conexão subsequentes.</span><span class="sxs-lookup"><span data-stu-id="78ff3-126">Close the *hStatusEvent* event handle, or you can reuse it for subsequent connection requests.</span></span>

 

 