---
description: Este tópico identifica as diretrizes a serem seguidas quando você executar operações do WUA (agente de Windows Update assíncrono).
ms.assetid: 1fb16904-732d-4341-8267-ab8896fc0f7c
title: Diretrizes para operações assíncronas do WUA
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c1a4b2198a235d9a03e3730e5d6dce2cd54c0e1f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105793893"
---
# <a name="guidelines-for-asynchronous-wua-operations"></a><span data-ttu-id="f05e6-103">Diretrizes para operações assíncronas do WUA</span><span class="sxs-lookup"><span data-stu-id="f05e6-103">Guidelines for Asynchronous WUA Operations</span></span>

<span data-ttu-id="f05e6-104">Este tópico identifica as diretrizes a serem seguidas quando você executar operações do WUA (agente de Windows Update assíncrono).</span><span class="sxs-lookup"><span data-stu-id="f05e6-104">This topic identifies guidelines for you to the follow when you perform asynchronous Windows Update Agent (WUA) operations.</span></span>

-   <span data-ttu-id="f05e6-105">As operações assíncronas do WUA não garantem nenhuma velocidade de conclusão específica.</span><span class="sxs-lookup"><span data-stu-id="f05e6-105">The asynchronous WUA operations do not guarantee any particular completion speed.</span></span> <span data-ttu-id="f05e6-106">O tempo de conclusão para uma operação assíncrona do WUA pode variar muito dependendo do hardware do computador, da versão do sistema operacional e da configuração de rede.</span><span class="sxs-lookup"><span data-stu-id="f05e6-106">The completion time for an asynchronous WUA operation can vary widely depending on computer hardware, version of the operating system, and network configuration.</span></span> <span data-ttu-id="f05e6-107">Assim como acontece com outras APIs do Windows que têm dependências de rede e que não contêm um parâmetro de tempo limite ou uma duração de tempo limite documentada, recomendamos que você considere a implementação de seus próprios mecanismos de tempo limite se precisar de tempos de resposta garantidos.</span><span class="sxs-lookup"><span data-stu-id="f05e6-107">As with other Windows APIs that have network dependencies and that do not contain a time-out parameter or a documented time-out duration, we recommend that you consider implementing your own time-out mechanisms if you need guaranteed response times.</span></span> <span data-ttu-id="f05e6-108">Por exemplo, você pode criar um thread de trabalho que chama um método WUA assíncrono e que define um evento ou outro objeto de sincronização quando a operação assíncrona do WUA é concluída; o thread principal pode usar a função [**WaitForSingleObject**](/windows/desktop/api/synchapi/nf-synchapi-waitforsingleobject) ou [**WaitForMultipleObjects**](/windows/desktop/api/synchapi/nf-synchapi-waitformultipleobjects) , que permite que você especifique um valor de tempo limite.</span><span class="sxs-lookup"><span data-stu-id="f05e6-108">For example, you can create a worker thread that calls an asynchronous WUA method and that sets an event or other synchronization object when the asynchronous WUA operation completes; the main thread can then use the [**WaitForSingleObject**](/windows/desktop/api/synchapi/nf-synchapi-waitforsingleobject) or [**WaitForMultipleObjects**](/windows/desktop/api/synchapi/nf-synchapi-waitformultipleobjects) function, which allows you to specify a time-out value.</span></span>
-   <span data-ttu-id="f05e6-109">Ao terminar uma pesquisa, download, instalação ou desinstalação de atualizações, você pode usar [**IUpdateSearcher:: endsearch**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatesearcher-endsearch), [**IUpdateDowloader:: enddownload**](/windows/desktop/api/Wuapi/nn-wuapi-iupdatedownloader), [**IUpdateInstaller:: noinstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-endinstall) e [**IUpdateInstaller:: enduninstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-enduninstall) de qualquer thread.</span><span class="sxs-lookup"><span data-stu-id="f05e6-109">When you end a search, download, installation, or uninstallation of updates, you can use [**IUpdateSearcher::EndSearch**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatesearcher-endsearch), [**IUpdateDowloader::EndDownload**](/windows/desktop/api/Wuapi/nn-wuapi-iupdatedownloader), [**IUpdateInstaller::EndInstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-endinstall) and [**IUpdateInstaller::EndUninstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-enduninstall) from any thread.</span></span>
-   <span data-ttu-id="f05e6-110">Ao iniciar uma pesquisa, download, instalação ou desinstalação de atualizações usando [**IUpdateSearcher:: BeginSearch**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatesearcher-beginsearch), [**IUpdateDownloader:: BeginDownload**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatedownloader-begindownload), [**IUpdateInstaller:: BeginInstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-begininstall)e [**IUpdateInstaller:: BeginUninstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-beginuninstall), certifique-se de manter a permissões de acesso suficiente ao liberar referências a objetos da API do WUA.</span><span class="sxs-lookup"><span data-stu-id="f05e6-110">When you start a search, download, installation, or uninstallation of updates by using [**IUpdateSearcher::BeginSearch**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatesearcher-beginsearch), [**IUpdateDownloader::BeginDownload**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatedownloader-begindownload), [**IUpdateInstaller::BeginInstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-begininstall), and [**IUpdateInstaller::BeginUninstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-beginuninstall), ensure that you maintain sufficient access permisssions when you release references to WUA API objects.</span></span>
    -   <span data-ttu-id="f05e6-111">Verifique se todos os objetos de retorno de chamada usados na operação assíncrona não são referenciados antes de destruí-los.</span><span class="sxs-lookup"><span data-stu-id="f05e6-111">Make sure any callback objects that are used in the asynchronous operation are unreferenced before you destroy them.</span></span> <span data-ttu-id="f05e6-112">Aguarde até que a contagem de referência de um objeto de retorno de chamada retorne ao valor inicial antes de destruí-lo.</span><span class="sxs-lookup"><span data-stu-id="f05e6-112">Wait for the reference count of a callback object to return to the initial value before you destroy it.</span></span>
    -   <span data-ttu-id="f05e6-113">A referência ao objeto de trabalho que é retornado do método **begin** correspondente deve ser controlada por um objeto diferente dos objetos de retorno de chamada.</span><span class="sxs-lookup"><span data-stu-id="f05e6-113">The reference to the job object that is returned from the corresponding **Begin** method should be controlled by an object that differs from the callback objects.</span></span> <span data-ttu-id="f05e6-114">Use um objeto que seja diferente dos objetos de retorno de chamada para evitar referências circulares.</span><span class="sxs-lookup"><span data-stu-id="f05e6-114">Use an object that differs from the callback objects to avoid circular references.</span></span>
    -   <span data-ttu-id="f05e6-115">Se você tentar controlar a referência ao objeto de trabalho usando um objeto de retorno de chamada, deverá chamar o método [**IDownloadJob:: Cleanup**](/windows/desktop/api/Wuapi/nf-wuapi-idownloadjob-cleanup), [**IInstallationJob:: Cleanup**](/windows/desktop/api/Wuapi/nf-wuapi-iinstallationjob-cleanup)ou [**ISearchJob:: Cleanup**](/windows/desktop/api/Wuapi/nf-wuapi-isearchjob-cleanup) fora da função de retorno de chamada para desconectar o objeto de trabalho do objeto de retorno de chamada.</span><span class="sxs-lookup"><span data-stu-id="f05e6-115">If you attempt to control the reference to the job object by using a callback object, you must call the [**IDownloadJob::CleanUp**](/windows/desktop/api/Wuapi/nf-wuapi-idownloadjob-cleanup), [**IInstallationJob::CleanUp**](/windows/desktop/api/Wuapi/nf-wuapi-iinstallationjob-cleanup), or [**ISearchJob::CleanUp**](/windows/desktop/api/Wuapi/nf-wuapi-isearchjob-cleanup) method outside the callback function to disconnect the job object from the callback object.</span></span> <span data-ttu-id="f05e6-116">Você deve fazer isso antes de liberar a referência ao objeto de trabalho que é retornado pelo método **begin** .</span><span class="sxs-lookup"><span data-stu-id="f05e6-116">You must do this before you release the reference to the job object that is returned by the **Begin** method.</span></span>
-   <span data-ttu-id="f05e6-117">Verifique se as operações assíncronas do WUA foram concluídas.</span><span class="sxs-lookup"><span data-stu-id="f05e6-117">Make sure that asynchronous WUA operations are complete.</span></span> <span data-ttu-id="f05e6-118">O Windows Script Host pode encerrar um script quando todos os comandos fora de qualquer função forem concluídos, mesmo que a API do WUA ainda tenha referências ao objeto de retorno de chamada.</span><span class="sxs-lookup"><span data-stu-id="f05e6-118">Windows Script Host can terminate a script when all the commands outside of any function are complete, even if the WUA API still has references to the callback object.</span></span>
    -   <span data-ttu-id="f05e6-119">Use um dos métodos de **limpeza** ou faça com que a função de retorno de chamada defina uma variável global compartilhada após a conclusão.</span><span class="sxs-lookup"><span data-stu-id="f05e6-119">Use one of the **CleanUp** methods or have the callback function set a shared global variable upon completion.</span></span>
    -   <span data-ttu-id="f05e6-120">Nunca chame [**IDownloadJob:: Cleanup**](/windows/desktop/api/Wuapi/nf-wuapi-idownloadjob-cleanup), [**IInstallationJob:: Cleanup**](/windows/desktop/api/Wuapi/nf-wuapi-iinstallationjob-cleanup)ou [**ISearchJob:: Cleanup**](/windows/desktop/api/Wuapi/nf-wuapi-isearchjob-cleanup) em um objeto de trabalho em sua função de retorno de chamada.</span><span class="sxs-lookup"><span data-stu-id="f05e6-120">Never call [**IDownloadJob::CleanUp**](/windows/desktop/api/Wuapi/nf-wuapi-idownloadjob-cleanup), [**IInstallationJob::CleanUp**](/windows/desktop/api/Wuapi/nf-wuapi-iinstallationjob-cleanup), or [**ISearchJob::CleanUp**](/windows/desktop/api/Wuapi/nf-wuapi-isearchjob-cleanup) on a job object in its callback function.</span></span>
    -   <span data-ttu-id="f05e6-121">Para garantir a sequência de limpeza correta em um script em execução no Windows Internet Explorer, chame o método de **limpeza** em todos os objetos de trabalho ao processar Window. onBeforeUnload.</span><span class="sxs-lookup"><span data-stu-id="f05e6-121">To ensure the correct clean-up sequence in a script that is running on Windows Internet Explorer, call the **CleanUp** method on all the job objects when processing window.onbeforeunload.</span></span>
-   <span data-ttu-id="f05e6-122">Não use os tipos de dados definidos pelo usuário (UDT) para operações assíncronas do WUA.</span><span class="sxs-lookup"><span data-stu-id="f05e6-122">Do not use user-defined data types (UDT) for asynchronous WUA operations.</span></span> <span data-ttu-id="f05e6-123">O tipo não é suportado por [**IUpdateSearcher:: BeginSearch**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatesearcher-beginsearch), [**IUpdateDownloader:: BeginDownload**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatedownloader-begindownload), [**IUpdateInstaller:: BeginInstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-begininstall)ou [**IUpdateInstaller:: BeginUninstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-beginuninstall).</span><span class="sxs-lookup"><span data-stu-id="f05e6-123">The type is not supported by [**IUpdateSearcher::BeginSearch**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatesearcher-beginsearch), [**IUpdateDownloader::BeginDownload**](/windows/desktop/api/Wuapi/nf-wuapi-iupdatedownloader-begindownload), [**IUpdateInstaller::BeginInstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-begininstall), or [**IUpdateInstaller::BeginUninstall**](/windows/desktop/api/Wuapi/nf-wuapi-iupdateinstaller-beginuninstall).</span></span>

 

 
