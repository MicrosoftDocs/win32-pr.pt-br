---
description: Ao criar seus próprios assemblies lado a lado, siga as diretrizes para criar assemblies lado a lado e criar qualquer DLL a ser incluída no assembly de acordo com as diretrizes de criação de uma DLL para um assembly lado a lado.
ms.assetid: 0e98bbcd-7e23-4a33-b0fa-1f936d0ef96b
title: Criação de armazenamento de estado para assemblies lado a lado
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: eee388cf680ee3a186a225ca7e3bde8b6eae625d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "103662425"
---
# <a name="authoring-state-storage-for-side-by-side-assemblies"></a><span data-ttu-id="27ccc-103">Criação de armazenamento de estado para assemblies lado a lado</span><span class="sxs-lookup"><span data-stu-id="27ccc-103">Authoring State Storage for Side-by-side Assemblies</span></span>

<span data-ttu-id="27ccc-104">Ao criar seus próprios assemblies lado a lado, siga as [diretrizes para criar assemblies](guidelines-for-creating-side-by-side-assemblies.md) lado a lado e criar qualquer DLL a ser incluída no assembly de acordo com as diretrizes de [criação de uma dll para um assembly lado a lado](authoring-a-dll-for-a-side-by-side-assembly.md).</span><span class="sxs-lookup"><span data-stu-id="27ccc-104">When creating your own side-by-side assemblies, follow the [Guidelines for Creating Side-by-side Assemblies](guidelines-for-creating-side-by-side-assemblies.md) and author any DLL to be included in the assembly according to the guidelines in [Authoring a DLL for a Side-by-Side Assembly](authoring-a-dll-for-a-side-by-side-assembly.md).</span></span>

<span data-ttu-id="27ccc-105">Siga as seguintes diretrizes para o armazenamento do Estado:</span><span class="sxs-lookup"><span data-stu-id="27ccc-105">Adhere to the following guidelines for the storage of the state:</span></span>

-   <span data-ttu-id="27ccc-106">O armazenamento de estado de design para ser compatível com versões posteriores e retroativas.</span><span class="sxs-lookup"><span data-stu-id="27ccc-106">Design state storage to be forward and backward compatible.</span></span> <span data-ttu-id="27ccc-107">Espere que as versões sejam usadas em qualquer ordem: por exemplo, v1, depois v3 e v2.</span><span class="sxs-lookup"><span data-stu-id="27ccc-107">Expect the versions to be used in any order: for example, v1, then v3, then v2.</span></span>
-   <span data-ttu-id="27ccc-108">Inicialize e defina as configurações padrão para o assembly no código do assembly.</span><span class="sxs-lookup"><span data-stu-id="27ccc-108">Initialize and set the default settings for the assembly in the assembly code.</span></span> <span data-ttu-id="27ccc-109">Não salve as configurações de padrões no registro.</span><span class="sxs-lookup"><span data-stu-id="27ccc-109">Do not save the defaults settings in the registry.</span></span>
-   <span data-ttu-id="27ccc-110">As configurações do registro devem ser gravadas em uma base de versão individual para isolar várias versões de assembly que podem ser executadas ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="27ccc-110">Registry settings must be written on an individual-version basis to isolate multiple assembly versions that may be run at the same time.</span></span> <span data-ttu-id="27ccc-111">Projete seu assembly lado a lado para armazenar corretamente e manipular o estado do assembly durante cenários de compartilhamento lado a lado.</span><span class="sxs-lookup"><span data-stu-id="27ccc-111">Design your side-by-side assembly to correctly store and handle the state of the assembly during side-by-side sharing scenarios.</span></span>
-   <span data-ttu-id="27ccc-112">Assemblies normalmente armazenam informações de estado em chaves do registro.</span><span class="sxs-lookup"><span data-stu-id="27ccc-112">Assemblies commonly store state information in registry keys.</span></span> <span data-ttu-id="27ccc-113">Crie um conjunto de arquivos de cabeçalho e funções auxiliares para fornecer uma maneira fácil para as chaves de registro de versão que contêm o estado do assembly.</span><span class="sxs-lookup"><span data-stu-id="27ccc-113">Author a set of header files and helper functions to provide an easy way to version registry keys containing the assembly state.</span></span>
-   <span data-ttu-id="27ccc-114">Todas as informações de estado do assembly salvas no registro devem ser isoladas de outras versões do assembly.</span><span class="sxs-lookup"><span data-stu-id="27ccc-114">Any assembly state information saved in the registry must be isolated from other versions of the assembly.</span></span> <span data-ttu-id="27ccc-115">As configurações de estado armazenadas no registro devem ser salvas em seções de versão individuais do registro.</span><span class="sxs-lookup"><span data-stu-id="27ccc-115">State settings stored in the registry must be saved in individual version sections of the registry.</span></span> <span data-ttu-id="27ccc-116">Isso é necessário nas partes HKLM e HKCU do registro.</span><span class="sxs-lookup"><span data-stu-id="27ccc-116">This is required in both the HKLM and HKCU parts of the registry.</span></span> <span data-ttu-id="27ccc-117">Por exemplo, armazene configurações de estado HKCU para o assembly versão XXXX na seguinte chave do registro:</span><span class="sxs-lookup"><span data-stu-id="27ccc-117">For example, store HKCU state settings for assembly version XXXX under the following registry key:</span></span>

    <span data-ttu-id="27ccc-118">**HKCU** \\ **MyCompany** \\ **MyComponent** \\ **VersionXXXX**</span><span class="sxs-lookup"><span data-stu-id="27ccc-118">**HKCU**\\**MyCompany**\\**MyComponent**\\**VersionXXXX**</span></span>

-   <span data-ttu-id="27ccc-119">Todas as informações de estado armazenadas no registro por assemblies compartilhados devem ser salvas em seções de versão individuais do registro.</span><span class="sxs-lookup"><span data-stu-id="27ccc-119">Any state information stored in the registry by shared assemblies must be saved in individual version sections of the registry.</span></span> <span data-ttu-id="27ccc-120">Por exemplo, uma configuração de estado chamada EnableSuperCoolFeature pode ter um valor de **true** ou **false**.</span><span class="sxs-lookup"><span data-stu-id="27ccc-120">For example, a state setting called EnableSuperCoolFeature might have a value of **TRUE** or **FALSE**.</span></span> <span data-ttu-id="27ccc-121">Armazene o valor de um [*assembly compartilhado lado a lado*](s-sbscs-gly.md) da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="27ccc-121">Store the value for a [*shared side-by-side assembly*](s-sbscs-gly.md) as follows:</span></span>

    <span data-ttu-id="27ccc-122">**HKEY \_ CurrentUser** \\ **software** \\ **MyCompany** \\ **myComponent** \\ **versão 01.01** \\ **EnableSuperCoolFeature = true**</span><span class="sxs-lookup"><span data-stu-id="27ccc-122">**HKEY\_CurrentUser**\\**Software**\\**MyCompany**\\**MyComponent**\\**Version01.01**\\**EnableSuperCoolFeature = TRUE**</span></span>

-   <span data-ttu-id="27ccc-123">Todas as informações de estado armazenadas no registro por assemblies privados devem ser salvas em seções de aplicativo individuais do registro.</span><span class="sxs-lookup"><span data-stu-id="27ccc-123">Any state information stored in the registry by private assemblies must be saved in individual application sections of the registry.</span></span> <span data-ttu-id="27ccc-124">Isso isola as configurações de estado do assembly para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="27ccc-124">This isolates the assembly's state settings to the application.</span></span> <span data-ttu-id="27ccc-125">Você pode usar a função [**GetModuleFileName**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) para configurar uma raiz virtual.</span><span class="sxs-lookup"><span data-stu-id="27ccc-125">You can use the [**GetModuleFileName**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) function to set up a virtual root.</span></span> <span data-ttu-id="27ccc-126">Por exemplo, se a versão do assembly XXYY for um assembly particular de "SomeApplication", uma chamada para **GetModuleFileName** retornará "SomeApplication" e quaisquer configurações de estado privado para o assembly deverão ser gravadas na seguinte chave:</span><span class="sxs-lookup"><span data-stu-id="27ccc-126">For example, if assembly version XXYY is a private assembly of "SomeApplication," a call to **GetModuleFileName** returns "SomeApplication" and any private state settings for the assembly should be written under the following key:</span></span>

    <span data-ttu-id="27ccc-127">**HKCU** \\ **MyCompany** \\ **MyComponent** \\ **VersionXXYY** \\ **SomeApplication**</span><span class="sxs-lookup"><span data-stu-id="27ccc-127">**HKCU**\\**MyCompany**\\**MyComponent**\\**VersionXXYY**\\**SomeApplication**</span></span>

-   <span data-ttu-id="27ccc-128">Faça as configurações de estado compartilhado armazenadas no registro privado para o contexto do assembly que executa o.</span><span class="sxs-lookup"><span data-stu-id="27ccc-128">Make shared state settings stored in the registry private to the assembly context that runs.</span></span> <span data-ttu-id="27ccc-129">Você pode usar a função [**GetModuleFileName**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) para configurar uma raiz virtual.</span><span class="sxs-lookup"><span data-stu-id="27ccc-129">You can use the [**GetModuleFileName**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) function to set up a virtual root.</span></span> <span data-ttu-id="27ccc-130">Isso deve ser feito para as ramificações HKLM e HKCU.</span><span class="sxs-lookup"><span data-stu-id="27ccc-130">This should be done for HKLM and HKCU branches.</span></span>
-   <span data-ttu-id="27ccc-131">O ideal é que você adote um modelo de persistência no qual o aplicativo persiste o estado e não altera o registro.</span><span class="sxs-lookup"><span data-stu-id="27ccc-131">Ideally, you should adopt a persistence model in which the application persists the state and does not alter the registry.</span></span> <span data-ttu-id="27ccc-132">Um aplicativo não deve precisar tocar diretamente nas entradas do registro do componente.</span><span class="sxs-lookup"><span data-stu-id="27ccc-132">An application should not need to directly touch the component's registry entries.</span></span> <span data-ttu-id="27ccc-133">Em vez disso, o assembly deve oferecer funções de API que salvam ou restauram configurações que são compatíveis.</span><span class="sxs-lookup"><span data-stu-id="27ccc-133">Instead, the assembly should offer API functions that save or restore settings that are side-by-side compatible.</span></span>
-   <span data-ttu-id="27ccc-134">Os assemblies podem salvar as configurações de estado em lojas fora do registro para permitir que o assembly interaja com o estado global.</span><span class="sxs-lookup"><span data-stu-id="27ccc-134">Assemblies may save state settings in stores outside the registry to enable the assembly to interact with the global state.</span></span> <span data-ttu-id="27ccc-135">Os assemblies lado a lado podem usar os seguintes repositórios compatíveis:</span><span class="sxs-lookup"><span data-stu-id="27ccc-135">Side-by-side assemblies may use the following side-by-side compatible stores:</span></span>
    -   <span data-ttu-id="27ccc-136">Um repositório protegido (*Pstore*)</span><span class="sxs-lookup"><span data-stu-id="27ccc-136">A protected store (*pstore*)</span></span>
    -   <span data-ttu-id="27ccc-137">Um cache do WinInet</span><span class="sxs-lookup"><span data-stu-id="27ccc-137">A WinInet cache</span></span>
    -   <span data-ttu-id="27ccc-138">Um Microsoft SQL Server</span><span class="sxs-lookup"><span data-stu-id="27ccc-138">A Microsoft SQL Server</span></span>

 

 
