---
description: Usando a interface IKsControl para acessar as propriedades de áudio
ms.assetid: 72bf9164-96c6-4543-b858-19480b032fdb
title: Usando a interface IKsControl para acessar as propriedades de áudio
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a67639a0e51334da80b7bff88293414a58bb204c
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104164081"
---
# <a name="using-the-ikscontrol-interface-to-access-audio-properties"></a><span data-ttu-id="db3de-103">Usando a interface IKsControl para acessar as propriedades de áudio</span><span class="sxs-lookup"><span data-stu-id="db3de-103">Using the IKsControl Interface to Access Audio Properties</span></span>

<span data-ttu-id="db3de-104">Em casos raros, um aplicativo de áudio especializado pode precisar usar a interface [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) para acessar determinados recursos de hardware de um adaptador de áudio que não são expostos pela [API do DEVICETOPOLOGY](devicetopology-api.md) ou pela API do [MMDevice](mmdevice-api.md).</span><span class="sxs-lookup"><span data-stu-id="db3de-104">In rare cases, a specialized audio application might need to use the [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface to access certain hardware capabilities of an audio adapter that are not exposed by the [DeviceTopology API](devicetopology-api.md) or the [MMDevice API](mmdevice-api.md).</span></span> <span data-ttu-id="db3de-105">A interface **IKsControl** torna as propriedades, os eventos e os métodos de dispositivos de streaming de kernel (KS) disponíveis para aplicativos de modo de usuário.</span><span class="sxs-lookup"><span data-stu-id="db3de-105">The **IKsControl** interface makes the properties, events, and methods of kernel-streaming (KS) devices available to user-mode applications.</span></span> <span data-ttu-id="db3de-106">De interesse principal para aplicativos de áudio são propriedades KS.</span><span class="sxs-lookup"><span data-stu-id="db3de-106">Of primary interest to audio applications are KS properties.</span></span> <span data-ttu-id="db3de-107">A interface **IKsControl** pode ser usada em conjunto com a API DeviceTopology e a API MMDevice para acessar as propriedades KS dos adaptadores de áudio.</span><span class="sxs-lookup"><span data-stu-id="db3de-107">The **IKsControl** interface can be used in conjunction with the DeviceTopology API and the MMDevice API to access the KS properties of audio adapters.</span></span>

<span data-ttu-id="db3de-108">A interface [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) é destinada principalmente para uso por fornecedores de hardware que escrevem aplicativos de painel de controle para gerenciar seu hardware de áudio.</span><span class="sxs-lookup"><span data-stu-id="db3de-108">The [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface is intended primarily for use by hardware vendors who write control-panel applications to manage their audio hardware.</span></span> <span data-ttu-id="db3de-109">O **IKsControl** é menos útil para aplicativos de áudio de uso geral que não estão vinculados a dispositivos de hardware específicos.</span><span class="sxs-lookup"><span data-stu-id="db3de-109">**IKsControl** is less useful for general-purpose audio applications that are not tied to particular hardware devices.</span></span> <span data-ttu-id="db3de-110">O motivo é que os fornecedores de hardware geralmente implementam mecanismos proprietários para acessar as propriedades de áudio de seus dispositivos.</span><span class="sxs-lookup"><span data-stu-id="db3de-110">The reason is that hardware vendors frequently implement proprietary mechanisms to access the audio properties of their devices.</span></span> <span data-ttu-id="db3de-111">Ao contrário da API DeviceTopology, que oculta peculiaridades de driver específicas de hardware e fornece uma interface relativamente uniforme para acessar propriedades de áudio, os aplicativos usam o **IKsControl** para se comunicar diretamente com os drivers.</span><span class="sxs-lookup"><span data-stu-id="db3de-111">In contrast to the DeviceTopology API, which hides hardware-specific driver quirks and provides a relatively uniform interface for accessing audio properties, applications use **IKsControl** to communicate directly with drivers.</span></span> <span data-ttu-id="db3de-112">Para obter mais informações sobre o **IKsControl**, consulte a documentação do Windows DDK.</span><span class="sxs-lookup"><span data-stu-id="db3de-112">For more information about **IKsControl**, see the Windows DDK documentation.</span></span>

<span data-ttu-id="db3de-113">Conforme discutido em [topologias de dispositivo](device-topologies.md), uma subunidade na topologia de um dispositivo de adaptador pode dar suporte a uma ou mais das interfaces de controle específicas de função mostradas na coluna à esquerda da tabela a seguir.</span><span class="sxs-lookup"><span data-stu-id="db3de-113">As discussed in [Device Topologies](device-topologies.md), a subunit in the topology of an adapter device might support one or more of the function-specific control interfaces shown in the left column of the following table.</span></span> <span data-ttu-id="db3de-114">Cada entrada na coluna à direita da tabela é a propriedade KS que corresponde à interface de controle à esquerda.</span><span class="sxs-lookup"><span data-stu-id="db3de-114">Each entry in the right column of the table is the KS property that corresponds to the control interface on the left.</span></span> <span data-ttu-id="db3de-115">A interface de controle fornece acesso conveniente à propriedade.</span><span class="sxs-lookup"><span data-stu-id="db3de-115">The control interface provides convenient access to the property.</span></span> <span data-ttu-id="db3de-116">A maioria dos drivers de áudio usa propriedades KS para representar os recursos de processamento específicos da função das subunidades (também chamadas de nós KS) nas topologias de seus adaptadores de áudio.</span><span class="sxs-lookup"><span data-stu-id="db3de-116">Most audio drivers use KS properties to represent the function-specific processing capabilities of the subunits (also referred to as KS nodes) in the topologies of their audio adapters.</span></span> <span data-ttu-id="db3de-117">Para obter mais informações sobre as propriedades KS e os nós KS, consulte a documentação do Windows DDK.</span><span class="sxs-lookup"><span data-stu-id="db3de-117">For more information about KS properties and KS nodes, see the Windows DDK documentation.</span></span>



| <span data-ttu-id="db3de-118">Interface de controle</span><span class="sxs-lookup"><span data-stu-id="db3de-118">Control interface</span></span>                                          | <span data-ttu-id="db3de-119">Propriedade KS</span><span class="sxs-lookup"><span data-stu-id="db3de-119">KS property</span></span>                        |
|------------------------------------------------------------|------------------------------------|
| [<span data-ttu-id="db3de-120">**IAudioAutoGainControl**</span><span class="sxs-lookup"><span data-stu-id="db3de-120">**IAudioAutoGainControl**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudioautogaincontrol)     | <span data-ttu-id="db3de-121">KSPROPERTY de \_ áudio \_ AGC</span><span class="sxs-lookup"><span data-stu-id="db3de-121">KSPROPERTY\_AUDIO\_AGC</span></span>             |
| [<span data-ttu-id="db3de-122">**IAudioBass**</span><span class="sxs-lookup"><span data-stu-id="db3de-122">**IAudioBass**</span></span>](/windows/win32/api/devicetopology/nn-devicetopology-iaudiobass)                           | <span data-ttu-id="db3de-123">\_áudio KSPROPERTY \_ Bass</span><span class="sxs-lookup"><span data-stu-id="db3de-123">KSPROPERTY\_AUDIO\_BASS</span></span>            |
| [<span data-ttu-id="db3de-124">**IAudioChannelConfig**</span><span class="sxs-lookup"><span data-stu-id="db3de-124">**IAudioChannelConfig**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudiochannelconfig)         | <span data-ttu-id="db3de-125">\_configuração do \_ canal de áudio KSPROPERTY \_</span><span class="sxs-lookup"><span data-stu-id="db3de-125">KSPROPERTY\_AUDIO\_CHANNEL\_CONFIG</span></span> |
| [<span data-ttu-id="db3de-126">**IAudioInputSelector**</span><span class="sxs-lookup"><span data-stu-id="db3de-126">**IAudioInputSelector**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudioinputselector)         | <span data-ttu-id="db3de-127">\_origem do \_ MUX de áudio KSPROPERTY \_</span><span class="sxs-lookup"><span data-stu-id="db3de-127">KSPROPERTY\_AUDIO\_MUX\_SOURCE</span></span>     |
| [<span data-ttu-id="db3de-128">**IAudioLoudness**</span><span class="sxs-lookup"><span data-stu-id="db3de-128">**IAudioLoudness**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudioloudness)                   | <span data-ttu-id="db3de-129">\_intensidade de áudio KSPROPERTY \_</span><span class="sxs-lookup"><span data-stu-id="db3de-129">KSPROPERTY\_AUDIO\_LOUDNESS</span></span>        |
| [<span data-ttu-id="db3de-130">**IAudioMidrange**</span><span class="sxs-lookup"><span data-stu-id="db3de-130">**IAudioMidrange**</span></span>](/windows/win32/api/devicetopology/nn-devicetopology-iaudiomidrange)                   | <span data-ttu-id="db3de-131">KSPROPERTY de \_ áudio \_ mid</span><span class="sxs-lookup"><span data-stu-id="db3de-131">KSPROPERTY\_AUDIO\_MID</span></span>             |
| [<span data-ttu-id="db3de-132">**IAudioMute**</span><span class="sxs-lookup"><span data-stu-id="db3de-132">**IAudioMute**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudiomute)                           | <span data-ttu-id="db3de-133">\_áudio KSPROPERTY \_ mudo</span><span class="sxs-lookup"><span data-stu-id="db3de-133">KSPROPERTY\_AUDIO\_MUTE</span></span>            |
| [<span data-ttu-id="db3de-134">**IAudioOutputSelector**</span><span class="sxs-lookup"><span data-stu-id="db3de-134">**IAudioOutputSelector**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudiooutputselector)       | <span data-ttu-id="db3de-135">DEST KSPROPERTY de \_ áudio \_ Demux \_</span><span class="sxs-lookup"><span data-stu-id="db3de-135">KSPROPERTY\_AUDIO\_DEMUX\_DEST</span></span>     |
| [<span data-ttu-id="db3de-136">**IAudioPeakMeter**</span><span class="sxs-lookup"><span data-stu-id="db3de-136">**IAudioPeakMeter**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudiopeakmeter)                 | <span data-ttu-id="db3de-137">KSPROPERTY de \_ áudio \_ PEAKMETER</span><span class="sxs-lookup"><span data-stu-id="db3de-137">KSPROPERTY\_AUDIO\_PEAKMETER</span></span>       |
| [<span data-ttu-id="db3de-138">**IAudioTreble**</span><span class="sxs-lookup"><span data-stu-id="db3de-138">**IAudioTreble**</span></span>](/windows/win32/api/devicetopology/nn-devicetopology-iaudiotreble)                       | <span data-ttu-id="db3de-139">KSPROPERTY de \_ áudio \_ agudo</span><span class="sxs-lookup"><span data-stu-id="db3de-139">KSPROPERTY\_AUDIO\_TREBLE</span></span>          |
| [<span data-ttu-id="db3de-140">**IAudioVolumeLevel**</span><span class="sxs-lookup"><span data-stu-id="db3de-140">**IAudioVolumeLevel**</span></span>](/windows/win32/api/devicetopology/nn-devicetopology-iaudiovolumelevel)             | <span data-ttu-id="db3de-141">KSPROPERTY de \_ áudio \_ VOLUMELEVEL</span><span class="sxs-lookup"><span data-stu-id="db3de-141">KSPROPERTY\_AUDIO\_VOLUMELEVEL</span></span>     |
| [<span data-ttu-id="db3de-142">**IDeviceSpecificProperty**</span><span class="sxs-lookup"><span data-stu-id="db3de-142">**IDeviceSpecificProperty**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-idevicespecificproperty) | <span data-ttu-id="db3de-143">KSPROPERTY \_ de \_ desenvolvimento de áudio \_ específico</span><span class="sxs-lookup"><span data-stu-id="db3de-143">KSPROPERTY\_AUDIO\_DEV\_SPECIFIC</span></span>   |



 

<span data-ttu-id="db3de-144">As topologias de alguns adaptadores de áudio podem conter subunidades que têm propriedades KS que não estão listadas na tabela anterior.</span><span class="sxs-lookup"><span data-stu-id="db3de-144">The topologies of some audio adapters might contain subunits that have KS properties that are not listed in the preceding table.</span></span> <span data-ttu-id="db3de-145">Por exemplo, suponha que uma chamada para o método [**IPart:: GetSubType**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getsubtype) para uma determinada subunidade recupere o valor de GUID KSNODETYPE \_ Tom.</span><span class="sxs-lookup"><span data-stu-id="db3de-145">For example, assume that a call to the [**IPart::GetSubType**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getsubtype) method for a particular subunit retrieves the GUID value KSNODETYPE\_TONE.</span></span> <span data-ttu-id="db3de-146">Esse GUID de subtipo indica que a subunidade dá suporte a uma ou mais das seguintes propriedades KS:</span><span class="sxs-lookup"><span data-stu-id="db3de-146">This subtype GUID indicates that the subunit supports one or more of the following KS properties:</span></span>

-   <span data-ttu-id="db3de-147">\_áudio KSPROPERTY \_ Bass</span><span class="sxs-lookup"><span data-stu-id="db3de-147">KSPROPERTY\_AUDIO\_BASS</span></span>
-   <span data-ttu-id="db3de-148">KSPROPERTY de \_ áudio \_ mid</span><span class="sxs-lookup"><span data-stu-id="db3de-148">KSPROPERTY\_AUDIO\_MID</span></span>
-   <span data-ttu-id="db3de-149">KSPROPERTY de \_ áudio \_ agudo</span><span class="sxs-lookup"><span data-stu-id="db3de-149">KSPROPERTY\_AUDIO\_TREBLE</span></span>
-   <span data-ttu-id="db3de-150">\_aumento de \_ graves de áudio KSPROPERTY \_</span><span class="sxs-lookup"><span data-stu-id="db3de-150">KSPROPERTY\_AUDIO\_BASS\_BOOST</span></span>

<span data-ttu-id="db3de-151">As três primeiras propriedades dessa lista podem ser acessadas por meio das interfaces de controle que aparecem na tabela anterior, mas a \_ propriedade de aumento de graves de áudio KSPROPERTY \_ \_ não tem nenhuma interface de controle correspondente na API DeviceTopology.</span><span class="sxs-lookup"><span data-stu-id="db3de-151">The first three properties in this list can be accessed through the control interfaces that appear in the preceding table, but the KSPROPERTY\_AUDIO\_BASS\_BOOST property has no corresponding control interface in the DeviceTopology API.</span></span> <span data-ttu-id="db3de-152">No entanto, um aplicativo pode usar a interface [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) para acessar essa propriedade, se a subunidade der suporte à propriedade.</span><span class="sxs-lookup"><span data-stu-id="db3de-152">However, an application can use the [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface to access this property, if the subunit supports the property.</span></span>

<span data-ttu-id="db3de-153">As etapas a seguir são necessárias para acessar a \_ \_ propriedade de aumento de graves de áudio KSPROPERTY \_ de uma subunidade do Tom KSNODETYPE de subtipo \_ :</span><span class="sxs-lookup"><span data-stu-id="db3de-153">The following steps are required to access the KSPROPERTY\_AUDIO\_BASS\_BOOST property of a subunit of subtype KSNODETYPE\_TONE:</span></span>

1.  <span data-ttu-id="db3de-154">Chame o método [**IConnector:: GetDeviceIdConnectedTo**](/windows/desktop/api/Devicetopology/nf-devicetopology-iconnector-getdeviceidconnectedto) ou [**IDeviceTopology:: DeviceID**](/windows/desktop/api/Devicetopology/nf-devicetopology-idevicetopology-getdeviceid) para obter a cadeia de caracteres de ID do dispositivo que identifica o dispositivo adaptador.</span><span class="sxs-lookup"><span data-stu-id="db3de-154">Call the [**IConnector::GetDeviceIdConnectedTo**](/windows/desktop/api/Devicetopology/nf-devicetopology-iconnector-getdeviceidconnectedto) or [**IDeviceTopology::GetDeviceId**](/windows/desktop/api/Devicetopology/nf-devicetopology-idevicetopology-getdeviceid) method to obtain the device ID string that identifies the adapter device.</span></span> <span data-ttu-id="db3de-155">Essa cadeia de caracteres é semelhante a uma [cadeia de caracteres de ID de ponto de extremidade](endpoint-id-strings.md), exceto que identifica um dispositivo de adaptador em vez de um dispositivo de ponto de extremidade</span><span class="sxs-lookup"><span data-stu-id="db3de-155">This string is similar to an [endpoint ID string](endpoint-id-strings.md), except that it identifies an adapter device instead of an endpoint device.</span></span> <span data-ttu-id="db3de-156">Para obter mais informações sobre a diferença entre um dispositivo de adaptador e um dispositivo de ponto de extremidade, consulte [dispositivos de ponto de extremidade de áudio](audio-endpoint-devices.md).</span><span class="sxs-lookup"><span data-stu-id="db3de-156">For more information about the difference between an adapter device and an endpoint device, see [Audio Endpoint Devices](audio-endpoint-devices.md).</span></span>
2.  <span data-ttu-id="db3de-157">Obtenha a interface [**IMMDevice**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) do dispositivo de adaptador chamando o método [**IMMDeviceEnumerator:: GetDevice**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdevice) com a cadeia de caracteres de ID do dispositivo.</span><span class="sxs-lookup"><span data-stu-id="db3de-157">Obtain the [**IMMDevice**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) interface of the adapter device by calling the [**IMMDeviceEnumerator::GetDevice**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdevice) method with the device ID string.</span></span> <span data-ttu-id="db3de-158">Essa interface **IMMDevice** é igual à interface descrita na **interface IMMDevice**, mas representa um dispositivo de adaptador em vez de um dispositivo de ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="db3de-158">This **IMMDevice** interface is the same as the interface described in **IMMDevice Interface**, but it represents an adapter device instead of an endpoint device.</span></span>
3.  <span data-ttu-id="db3de-159">Obtenha a interface [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) na subunidade chamando o método [**IMMDevice:: Activate**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdevice-activate) com o parâmetro *IID* definido como **REFIID** IID \_ IKsControl.</span><span class="sxs-lookup"><span data-stu-id="db3de-159">Obtain the [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface on the subunit by calling the [**IMMDevice::Activate**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdevice-activate) method with parameter *iid* set to **REFIID** IID\_IKsControl.</span></span> <span data-ttu-id="db3de-160">Observe que as interfaces suportadas por esse método **Activate** , que é para um dispositivo de adaptador, são diferentes das interfaces suportadas pelo método **Activate** para um dispositivo de ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="db3de-160">Note that the interfaces supported by this **Activate** method, which is for an adapter device, are different from the interfaces supported by the **Activate** method for an endpoint device.</span></span> <span data-ttu-id="db3de-161">Em particular, o método **Activate** para um dispositivo de adaptador dá suporte a **IKsControl**.</span><span class="sxs-lookup"><span data-stu-id="db3de-161">In particular, the **Activate** method for an adapter device supports **IKsControl**.</span></span>
4.  <span data-ttu-id="db3de-162">Chame o método [**IPart:: Getlocalid**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getlocalid) para obter a ID local da subunidade.</span><span class="sxs-lookup"><span data-stu-id="db3de-162">Call the [**IPart::GetLocalId**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getlocalid) method to obtain the local ID of the subunit.</span></span>
5.  <span data-ttu-id="db3de-163">Construa uma solicitação de propriedade KS.</span><span class="sxs-lookup"><span data-stu-id="db3de-163">Construct a KS property request.</span></span> <span data-ttu-id="db3de-164">A ID do nó KS necessária para a solicitação está contida nos 16 bits menos significativos da ID local obtida na etapa anterior.</span><span class="sxs-lookup"><span data-stu-id="db3de-164">The KS node ID required for the request is contained in the 16 least-significant bits of the local ID obtained in the previous step.</span></span>
6.  <span data-ttu-id="db3de-165">Envie a solicitação de propriedade KS para o driver de áudio chamando o método [**IKsControl:: KsProperty**](/windows-hardware/drivers/ddi/ksproxy/nf-ksproxy-ikscontrol-ksproperty) .</span><span class="sxs-lookup"><span data-stu-id="db3de-165">Send the KS property request to the audio driver by calling the [**IKsControl::KsProperty**](/windows-hardware/drivers/ddi/ksproxy/nf-ksproxy-ikscontrol-ksproperty) method.</span></span> <span data-ttu-id="db3de-166">Para obter mais informações sobre esse método, consulte a documentação do Windows DDK.</span><span class="sxs-lookup"><span data-stu-id="db3de-166">For more information about this method, see the Windows DDK documentation.</span></span>

<span data-ttu-id="db3de-167">O exemplo de código a seguir recupera o valor da \_ propriedade de aumento de graves de áudio KSPROPERTY \_ \_ de uma subunidade do Tom KSNODETYPE de subtipo \_ :</span><span class="sxs-lookup"><span data-stu-id="db3de-167">The following code example retrieves the value of the KSPROPERTY\_AUDIO\_BASS\_BOOST property from a subunit of subtype KSNODETYPE\_TONE:</span></span>


```C++
//-----------------------------------------------------------
// This function calls the IKsControl::Property method to get
// the value of the KSPROPERTY_AUDIO_BASS_BOOST property of
// a subunit. Parameter pPart should point to a part that is
// a subunit with a subtype GUID value of KSNODETYPE_TONE.
//-----------------------------------------------------------
#define PARTID_MASK 0x0000ffff
#define EXIT_ON_ERROR(hres)  \
              if (FAILED(hres)) { goto Exit; }
#define SAFE_RELEASE(punk)  \
              if ((punk) != NULL)  \
                { (punk)->Release(); (punk) = NULL; }

const IID IID_IKsControl = __uuidof(IKsControl);

HRESULT GetBassBoost(IMMDeviceEnumerator *pEnumerator,
                     IPart *pPart, BOOL *pbValue)
{
    HRESULT hr;
    IDeviceTopology *pTopology = NULL;
    IMMDevice *pPnpDevice = NULL;
    IKsControl *pKsControl = NULL;
    LPWSTR pwszDeviceId = NULL;

    if (pEnumerator == NULL || pPart == NULL || pbValue == NULL)
    {
        return E_INVALIDARG;
    }

    // Get the topology object for the adapter device that contains
    // the subunit represented by the IPart interface.
    hr = pPart->GetTopologyObject(&pTopology);
    EXIT_ON_ERROR(hr)

    // Get the device ID string that identifies the adapter device.
    hr = pTopology->GetDeviceId(&pwszDeviceId);
    EXIT_ON_ERROR(hr)

    // Get the IMMDevice interface of the adapter device object.
    hr = pEnumerator->GetDevice(pwszDeviceId, &pPnpDevice);
    EXIT_ON_ERROR(hr)

    // Activate an IKsControl interface on the adapter device object.
    hr = pPnpDevice->Activate(IID_IKsControl, CLSCTX_ALL, NULL, (void**)&pKsControl);
    EXIT_ON_ERROR(hr)

    // Get the local ID of the subunit (contains the KS node ID).
    UINT localId = 0;
    hr = pPart->GetLocalId(&localId);
    EXIT_ON_ERROR(hr)

    KSNODEPROPERTY_AUDIO_CHANNEL ksprop;
    ZeroMemory(&ksprop, sizeof(ksprop));
    ksprop.NodeProperty.Property.Set = KSPROPSETID_Audio;
    ksprop.NodeProperty.Property.Id = KSPROPERTY_AUDIO_BASS_BOOST;
    ksprop.NodeProperty.Property.Flags = KSPROPERTY_TYPE_GET | KSPROPERTY_TYPE_TOPOLOGY;
    ksprop.NodeProperty.NodeId = localId & PARTID_MASK;
    ksprop.Channel = 0;

    // Send the property request.to the device driver.
    BOOL bValue = FALSE;
    ULONG valueSize;
    hr = pKsControl->KsProperty(
                         &ksprop.NodeProperty.Property, sizeof(ksprop),
                         &bValue, sizeof(bValue), &valueSize);
    EXIT_ON_ERROR(hr)

    *pbValue = bValue;

Exit:
    SAFE_RELEASE(pTopology)
    SAFE_RELEASE(pPnpDevice)
    SAFE_RELEASE(pKsControl)
    CoTaskMemFree(pwszDeviceId);
    return hr;
}

```



<span data-ttu-id="db3de-168">No exemplo de código anterior, a função GetBassBoost usa os três parâmetros a seguir:</span><span class="sxs-lookup"><span data-stu-id="db3de-168">In the preceding code example, the GetBassBoost function takes the following three parameters:</span></span>

-   <span data-ttu-id="db3de-169">`pEnumerator` aponta para a interface [**IMMDeviceEnumerator**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdeviceenumerator) de um enumerador de ponto de extremidade de áudio.</span><span class="sxs-lookup"><span data-stu-id="db3de-169">`pEnumerator` points to the [**IMMDeviceEnumerator**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdeviceenumerator) interface of an audio endpoint enumerator.</span></span>
-   <span data-ttu-id="db3de-170">`pPart` aponta para a interface [**IPart**](/windows/desktop/api/Devicetopology/nn-devicetopology-ipart) de uma subunidade que tem um subtipo de \_ Tom KSNODETYPE.</span><span class="sxs-lookup"><span data-stu-id="db3de-170">`pPart` points to the [**IPart**](/windows/desktop/api/Devicetopology/nn-devicetopology-ipart) interface of a subunit that has a subtype of KSNODETYPE\_TONE.</span></span>
-   <span data-ttu-id="db3de-171">`pbValue` aponta para uma variável **bool** na qual a função grava o valor da propriedade.</span><span class="sxs-lookup"><span data-stu-id="db3de-171">`pbValue` points to a **BOOL** variable into which the function writes the property value.</span></span>

<span data-ttu-id="db3de-172">Um programa chama GetBassBoost somente depois de chamar [**IPart:: GetSubType**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getsubtype) e determina que o subtipo da subunidade é KSNODETYPE \_ Tom.</span><span class="sxs-lookup"><span data-stu-id="db3de-172">A program calls GetBassBoost only after it calls [**IPart::GetSubType**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getsubtype) and determines that the subtype of the subunit is KSNODETYPE\_TONE.</span></span> <span data-ttu-id="db3de-173">O valor da propriedade será **true** se o aumento de graves estiver habilitado.</span><span class="sxs-lookup"><span data-stu-id="db3de-173">The property value is **TRUE** if bass boost is enabled.</span></span> <span data-ttu-id="db3de-174">Será **false** se o aumento de graves estiver desabilitado.</span><span class="sxs-lookup"><span data-stu-id="db3de-174">It is **FALSE** if bass boost is disabled.</span></span>

<span data-ttu-id="db3de-175">No início da função GetBassBoost, a chamada para o método [**IPart:: Gettopologiaobject**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-gettopologyobject) Obtém a interface [**IDeviceTopology**](/windows/desktop/api/Devicetopology/nn-devicetopology-idevicetopology) do dispositivo de adaptador que contém a \_ subunidade de Tom KSNODETYPE.</span><span class="sxs-lookup"><span data-stu-id="db3de-175">At the beginning of the GetBassBoost function, the call to the [**IPart::GetTopologyObject**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-gettopologyobject) method obtains the [**IDeviceTopology**](/windows/desktop/api/Devicetopology/nn-devicetopology-idevicetopology) interface of the adapter device that contains the KSNODETYPE\_TONE subunit.</span></span> <span data-ttu-id="db3de-176">A chamada do método [**IDeviceTopology:: DeviceID**](/windows/desktop/api/Devicetopology/nf-devicetopology-idevicetopology-getdeviceid) recupera a cadeia de caracteres de ID do dispositivo que identifica o dispositivo adaptador.</span><span class="sxs-lookup"><span data-stu-id="db3de-176">The [**IDeviceTopology::GetDeviceId**](/windows/desktop/api/Devicetopology/nf-devicetopology-idevicetopology-getdeviceid) method call retrieves the device ID string that identifies the adapter device.</span></span> <span data-ttu-id="db3de-177">A chamada do método [**IMMDeviceEnumerator:: GetDevice**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdevice) usa a cadeia de caracteres de ID do dispositivo como um parâmetro de entrada e recupera a interface [**IMMDevice**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) do dispositivo adaptador.</span><span class="sxs-lookup"><span data-stu-id="db3de-177">The [**IMMDeviceEnumerator::GetDevice**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdevice) method call takes the device ID string as an input parameter, and retrieves the [**IMMDevice**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) interface of the adapter device.</span></span> <span data-ttu-id="db3de-178">Em seguida, a chamada de método [**IMMDevice:: Activate**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdevice-activate) recupera a interface [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) da subunidade.</span><span class="sxs-lookup"><span data-stu-id="db3de-178">Next, the [**IMMDevice::Activate**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdevice-activate) method call retrieves the [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface of the subunit.</span></span> <span data-ttu-id="db3de-179">Para obter mais informações sobre a interface **IKsControl** , consulte a documentação do Windows DDK.</span><span class="sxs-lookup"><span data-stu-id="db3de-179">For more information about the **IKsControl** interface, see the Windows DDK documentation.</span></span>

<span data-ttu-id="db3de-180">Em seguida, o exemplo de código anterior cria uma estrutura de [**\_ \_ canal de áudio KSNODEPROPERTY**](/windows-hardware/drivers/ddi/ksmedia/ns-ksmedia-ksnodeproperty_audio_channel) que descreve a propriedade de aumento de graves.</span><span class="sxs-lookup"><span data-stu-id="db3de-180">Next, the preceding code example creates a [**KSNODEPROPERTY\_AUDIO\_CHANNEL**](/windows-hardware/drivers/ddi/ksmedia/ns-ksmedia-ksnodeproperty_audio_channel) structure that describes the bass-boost property.</span></span> <span data-ttu-id="db3de-181">O exemplo de código passa um ponteiro para a estrutura para o método [**IKsControl:: KsProperty**](/windows-hardware/drivers/ddi/ksproxy/nf-ksproxy-ikscontrol-ksproperty) , que usa as informações na estrutura para recuperar o valor da propriedade.</span><span class="sxs-lookup"><span data-stu-id="db3de-181">The code example passes a pointer to the structure to the [**IKsControl::KsProperty**](/windows-hardware/drivers/ddi/ksproxy/nf-ksproxy-ikscontrol-ksproperty) method, which uses the information in the structure to retrieve the property value.</span></span> <span data-ttu-id="db3de-182">Para obter mais informações sobre a estrutura do **\_ \_ canal de áudio KSNODEPROPERTY** e o método **IKsControl:: KsProperty** , consulte a documentação do Windows DDK.</span><span class="sxs-lookup"><span data-stu-id="db3de-182">For more information about the **KSNODEPROPERTY\_AUDIO\_CHANNEL** structure and the **IKsControl::KsProperty** method, see the Windows DDK documentation.</span></span>

<span data-ttu-id="db3de-183">O hardware de áudio normalmente atribui um estado de aumento de graves e separado a cada canal em um fluxo de áudio.</span><span class="sxs-lookup"><span data-stu-id="db3de-183">Audio hardware typically assigns a separate bass-boost state to each channel in an audio stream.</span></span> <span data-ttu-id="db3de-184">Em princípio, o aumento dos graves pode ser habilitado para alguns canais e desabilitado para outros.</span><span class="sxs-lookup"><span data-stu-id="db3de-184">In principle, bass boost can be enabled for some channels and disabled for others.</span></span> <span data-ttu-id="db3de-185">A estrutura do [**\_ \_ canal de áudio KSNODEPROPERTY**](/windows-hardware/drivers/ddi/ksmedia/ns-ksmedia-ksnodeproperty_audio_channel) contém um membro do **canal** que especifica o número do canal.</span><span class="sxs-lookup"><span data-stu-id="db3de-185">The [**KSNODEPROPERTY\_AUDIO\_CHANNEL**](/windows-hardware/drivers/ddi/ksmedia/ns-ksmedia-ksnodeproperty_audio_channel) structure contains a **Channel** member that specifies the channel number.</span></span> <span data-ttu-id="db3de-186">Se um fluxo contiver *N* canais, os canais serão numerados de 0 a *N*– 1.</span><span class="sxs-lookup"><span data-stu-id="db3de-186">If a stream contains *N* channels, the channels are numbered from 0 to *N*— 1.</span></span> <span data-ttu-id="db3de-187">O exemplo de código anterior Obtém o valor da propriedade Bass-Boost somente para o canal 0.</span><span class="sxs-lookup"><span data-stu-id="db3de-187">The preceding code example gets the value of the bass-boost property for channel 0 only.</span></span> <span data-ttu-id="db3de-188">Essa implementação implicitamente supõe que as propriedades de aumento de graves para todos os canais são definidas uniformemente para o mesmo estado.</span><span class="sxs-lookup"><span data-stu-id="db3de-188">This implementation implicitly assumes that the bass-boost properties for all of the channels are set uniformly to the same state.</span></span> <span data-ttu-id="db3de-189">Assim, a leitura da propriedade Bass-Boost para o canal 0 é suficiente para determinar o valor da propriedade Bass-Boost para o fluxo.</span><span class="sxs-lookup"><span data-stu-id="db3de-189">Thus, reading the bass-boost property for channel 0 is sufficient to determine the bass-boost property value for the stream.</span></span> <span data-ttu-id="db3de-190">Para ser consistente com essa suposição, uma função correspondente para definir a propriedade Bass-Boost definiria todos os canais com o mesmo valor da propriedade Bass-Boost.</span><span class="sxs-lookup"><span data-stu-id="db3de-190">To be consistent with this assumption, a corresponding function to set the bass-boost property would set all channels to the same bass-boost property value.</span></span> <span data-ttu-id="db3de-191">Essas são convenções razoáveis, mas nem todos os fornecedores de hardware as seguem necessariamente.</span><span class="sxs-lookup"><span data-stu-id="db3de-191">These are reasonable conventions, but not all hardware vendors necessarily follow them.</span></span> <span data-ttu-id="db3de-192">Por exemplo, um fornecedor pode fornecer um aplicativo de painel de controle que permita o aumento de graves apenas para canais que conduzem os alto-falantes do espectro completo.</span><span class="sxs-lookup"><span data-stu-id="db3de-192">For example, a vendor might supply a control-panel application that enables bass boost only for channels that drive full-range speakers.</span></span> <span data-ttu-id="db3de-193">(Um palestrante de intervalo completo é capaz de reproduzir sons em todo o intervalo de baixo a agudos.) Nesse caso, o valor da propriedade recuperado pelo exemplo de código anterior pode não representar com precisão o estado de aumento de graves do fluxo.</span><span class="sxs-lookup"><span data-stu-id="db3de-193">(A full-range speaker is capable of playing sounds over the full range from bass to treble.) In that case, the property value retrieved by the preceding code example might not accurately represent the bass-boost state of the stream.</span></span>

<span data-ttu-id="db3de-194">Os clientes que usam as interfaces de controle listadas na tabela anterior podem chamar o método [**IPart:: RegisterControlChangeCallback**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-registercontrolchangecallback) para se registrarem para notificações quando o valor de um parâmetro de controle for alterado.</span><span class="sxs-lookup"><span data-stu-id="db3de-194">Clients that use the control interfaces listed in the preceding table can call the [**IPart::RegisterControlChangeCallback**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-registercontrolchangecallback) method to register for notifications when the value of a control parameter changes.</span></span> <span data-ttu-id="db3de-195">Observe que a interface [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) não fornece um meio semelhante para os clientes se registrarem para notificações quando um valor de propriedade for alterado.</span><span class="sxs-lookup"><span data-stu-id="db3de-195">Note that the [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface does not provide a similar means for clients to register for notifications when a property value changes.</span></span> <span data-ttu-id="db3de-196">Se **IKsControl** tiver suportado as notificações de alteração de propriedade, ele poderia informar um aplicativo quando outro aplicativo alterou um valor de propriedade.</span><span class="sxs-lookup"><span data-stu-id="db3de-196">If **IKsControl** did support property-change notifications, it could inform an application when another application changed a property value.</span></span> <span data-ttu-id="db3de-197">No entanto, ao contrário dos controles mais comumente usados que são monitorados por meio de notificações [**IPart**](/windows/desktop/api/Devicetopology/nn-devicetopology-ipart) , as propriedades gerenciadas pelo **IKsControl** são destinadas principalmente para uso por fornecedores de hardware, e essas propriedades provavelmente serão alteradas apenas por aplicativos do painel de controle gravados pelos fornecedores.</span><span class="sxs-lookup"><span data-stu-id="db3de-197">However, in contrast to the more commonly used controls that are monitored through [**IPart**](/windows/desktop/api/Devicetopology/nn-devicetopology-ipart) notifications, the properties managed by **IKsControl** are intended primarily for use by hardware vendors, and those properties are likely to be changed only by control-panel applications written by the vendors.</span></span> <span data-ttu-id="db3de-198">Se um aplicativo precisar detectar alterações de propriedade feitas por outro aplicativo, ele poderá detectar as alterações periodicamente sondando o valor da propriedade por meio de **IKsControl**.</span><span class="sxs-lookup"><span data-stu-id="db3de-198">If an application must detect property changes made by another application, it can detect the changes by periodically polling the property value through **IKsControl**.</span></span>

## <a name="related-topics"></a><span data-ttu-id="db3de-199">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="db3de-199">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="db3de-200">Guia de programação</span><span class="sxs-lookup"><span data-stu-id="db3de-200">Programming Guide</span></span>](programming-guide.md)
</dt> </dl>

 

 
