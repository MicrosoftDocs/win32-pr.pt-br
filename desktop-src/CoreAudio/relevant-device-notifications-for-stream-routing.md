---
description: No Windows 7, as APIs de plataforma de alto nível que usam APIs de áudio de núcleo, como as APIs Media Foundation, DirectSound e Wave, implementam o recurso de roteamento de fluxo manipulando a alternância de fluxo de um dispositivo existente para um novo ponto de extremidade de áudio padrão.
ms.assetid: caf831bb-b8de-467f-bdb4-f9f8991dc7a8
title: Notificações relevantes para roteamento de fluxo
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ef3d253ce2ec5d6e3bef025a33233a9d377ca44b
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104089243"
---
# <a name="relevant-notifications-for-stream-routing"></a><span data-ttu-id="bebb1-103">Notificações relevantes para roteamento de fluxo</span><span class="sxs-lookup"><span data-stu-id="bebb1-103">Relevant Notifications for Stream Routing</span></span>

<span data-ttu-id="bebb1-104">No Windows 7, as APIs de plataforma de alto nível que usam APIs de áudio de núcleo, como as APIs Media Foundation, DirectSound e Wave, implementam o recurso de roteamento de fluxo manipulando a alternância de fluxo de um dispositivo existente para um novo ponto de extremidade de áudio padrão.</span><span class="sxs-lookup"><span data-stu-id="bebb1-104">In Windows 7, high-level platform APIs that use Core Audio APIs, such as Media Foundation, DirectSound, and Wave APIs, implement the stream routing feature by handling stream switching from an existing device to a new default audio endpoint.</span></span> <span data-ttu-id="bebb1-105">Os aplicativos de mídia que usam essas APIs usam o comportamento de roteamento de fluxo sem nenhuma modificação na origem.</span><span class="sxs-lookup"><span data-stu-id="bebb1-105">Media applications that use these APIs use the stream routing behavior without any modifications to the source.</span></span> <span data-ttu-id="bebb1-106">Os clientes Direct WASAPI podem usar as notificações enviadas pelos componentes de áudio principal e implementar o recurso de roteamento de fluxo.</span><span class="sxs-lookup"><span data-stu-id="bebb1-106">Direct WASAPI clients can use the notifications sent by Core Audio components and implement the stream routing feature.</span></span>

<span data-ttu-id="bebb1-107">Para implementar o recurso de roteamento de fluxo, um cliente deve escutar dois tipos de eventos: notificações de alteração de dispositivo e notificações de desconexão de sessão.</span><span class="sxs-lookup"><span data-stu-id="bebb1-107">To implement the stream routing feature, a client must listen for two types of events: device change notifications and session disconnect notifications.</span></span> <span data-ttu-id="bebb1-108">Na implementação fornecida pelas APIs de alto nível, esses eventos são enviados para pontos de extremidade de dispositivo padrão criados chamando [**IMMDeviceEnumerator:: GetDefaultAudioEndpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint).</span><span class="sxs-lookup"><span data-stu-id="bebb1-108">In the implementation provided by the high-level APIs, these events are sent for default device endpoints created by calling [**IMMDeviceEnumerator::GetDefaultAudioEndpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint).</span></span> <span data-ttu-id="bebb1-109">Para obter mais informações, consulte [obtendo o ponto de extremidade do dispositivo para roteamento de fluxo](getting-the-default-device-endpoint-for-stream-routing.md).</span><span class="sxs-lookup"><span data-stu-id="bebb1-109">For more information, see [Getting the Device Endpoint for Stream Routing](getting-the-default-device-endpoint-for-stream-routing.md).</span></span>

<span data-ttu-id="bebb1-110">O componente de áudio principal MMDeviceAPI fornece retornos de chamada de notificação quando dispositivos de áudio são adicionados, removidos ou modificados.</span><span class="sxs-lookup"><span data-stu-id="bebb1-110">The Core Audio component MMDeviceAPI delivers notification callbacks when audio devices are added, removed, or modified.</span></span> <span data-ttu-id="bebb1-111">As alterações de sessão de formato e áudio são relatadas como eventos por meio de WASAPI.</span><span class="sxs-lookup"><span data-stu-id="bebb1-111">The format and audio session changes are reported as events through WASAPI.</span></span>

## <a name="device-change-notifications"></a><span data-ttu-id="bebb1-112">Notificações de alteração do dispositivo</span><span class="sxs-lookup"><span data-stu-id="bebb1-112">Device Change Notifications</span></span>

<span data-ttu-id="bebb1-113">O MMDeviceAPI gera eventos quando os dispositivos de áudio são adicionados, removidos ou modificados.</span><span class="sxs-lookup"><span data-stu-id="bebb1-113">MMDeviceAPI raises events when audio devices are added, removed, or modified.</span></span> <span data-ttu-id="bebb1-114">Se o cliente for fornecer a funcionalidade de roteamento de fluxo, ele deverá implementar a interface [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) e registrar sua implementação com MMDeviceAPI.</span><span class="sxs-lookup"><span data-stu-id="bebb1-114">If the client is to provide stream routing functionality, it must implement the [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) interface and register its implementation with MMDeviceAPI.</span></span>

<span data-ttu-id="bebb1-115">Para obter notificações de alteração do dispositivo, o cliente deve executar as seguintes tarefas:</span><span class="sxs-lookup"><span data-stu-id="bebb1-115">To get device change notifications, the client must perform the following tasks:</span></span>

-   <span data-ttu-id="bebb1-116">Implemente a interface [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) para lidar com notificações de alteração de dispositivo enviadas pelo MMDeviceAPI.</span><span class="sxs-lookup"><span data-stu-id="bebb1-116">Implement the [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) interface to handle device change notifications sent by MMDeviceAPI.</span></span>
-   <span data-ttu-id="bebb1-117">Registre a implementação de [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) com MMDeviceAPI chamando o método [**IMMDeviceEnumerator:: RegisterEndpointNotificationCallback**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-registerendpointnotificationcallback) .</span><span class="sxs-lookup"><span data-stu-id="bebb1-117">Register the [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) implementation with MMDeviceAPI by calling the [**IMMDeviceEnumerator::RegisterEndpointNotificationCallback**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-registerendpointnotificationcallback) method.</span></span>

<span data-ttu-id="bebb1-118">Depois que a implementação do cliente dessas interfaces é registrada, o cliente recebe notificações na forma de retornos de chamada por meio dos métodos dessas interfaces.</span><span class="sxs-lookup"><span data-stu-id="bebb1-118">After the client's implementation of these interfaces is registered, the client receives notifications in the form of callbacks through the methods of these interfaces.</span></span> <span data-ttu-id="bebb1-119">Os métodos [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) são chamados por MMDeviceAPI quando gera eventos de nível de ponto de extremidade (alterações de estado do ponto de extremidade, novas entradas de ponto de extremidade, exclusões de ponto de extremidade, alterações de ponto de extremidade padrão e alterações de propriedade de ponto de extremidade)</span><span class="sxs-lookup"><span data-stu-id="bebb1-119">[**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) methods are called by MMDeviceAPI when it raises endpoint-level events (endpoint state changes, new endpoint arrivals, endpoint deletions, default endpoint changes, and endpoint property changes).</span></span>

<span data-ttu-id="bebb1-120">Se o cliente quiser fornecer roteamento de fluxo para o dispositivo padrão, o cliente deverá implementar o comportamento de alteração do dispositivo quando receber a notificação por meio do retorno de chamada [**IMMNotificationClient:: OnDefaultDeviceChanged**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immnotificationclient-ondefaultdevicechanged) .</span><span class="sxs-lookup"><span data-stu-id="bebb1-120">If the client wants to provide stream routing for the default device, the client must implement the device change behavior when it receives the notification through the [**IMMNotificationClient::OnDefaultDeviceChanged**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immnotificationclient-ondefaultdevicechanged) callback.</span></span>

## <a name="audio-session-change-notifications"></a><span data-ttu-id="bebb1-121">Notificações de alteração de sessão de áudio</span><span class="sxs-lookup"><span data-stu-id="bebb1-121">Audio Session Change Notifications</span></span>

<span data-ttu-id="bebb1-122">Alterações de sessão de áudio e alterações de formato são relatadas como eventos de sessão de áudio por meio de WASAPI.</span><span class="sxs-lookup"><span data-stu-id="bebb1-122">Audio session changes and format changes are reported as audio session events through WASAPI.</span></span> <span data-ttu-id="bebb1-123">Um cliente WASAPI implementa a interface [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) e registra a implementação com WASAPI.</span><span class="sxs-lookup"><span data-stu-id="bebb1-123">A WASAPI client implements the [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) interface and registers the implementation with WASAPI.</span></span>

<span data-ttu-id="bebb1-124">Para obter notificações de alteração de sessão de áudio, o cliente deve executar as seguintes tarefas:</span><span class="sxs-lookup"><span data-stu-id="bebb1-124">To get audio session change notifications, the client must perform the following tasks:</span></span>

-   <span data-ttu-id="bebb1-125">Implemente a interface [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) para lidar com notificações de alteração de formato enviadas pelo WASAPI.</span><span class="sxs-lookup"><span data-stu-id="bebb1-125">Implement the [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) interface to handle format change notifications sent by WASAPI.</span></span>
-   <span data-ttu-id="bebb1-126">Registre a implementação de [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) com WASAPI chamando o método [**IAudioSessionControl:: RegisterAudioSessionNotification**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessioncontrol-registeraudiosessionnotification) .</span><span class="sxs-lookup"><span data-stu-id="bebb1-126">Register the [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) implementation with WASAPI by calling the [**IAudioSessionControl::RegisterAudioSessionNotification**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessioncontrol-registeraudiosessionnotification) method.</span></span>

<span data-ttu-id="bebb1-127">Os métodos [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) são chamados por WASAPI quando ocorrem alterações na sessão de áudio.</span><span class="sxs-lookup"><span data-stu-id="bebb1-127">[**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) methods are called by WASAPI when audio session changes occur.</span></span> <span data-ttu-id="bebb1-128">Esses eventos são gerados quando o nome de exibição da sessão, o caminho do ícone, o volume, o parâmetro de agrupamento ou as alterações de estado.</span><span class="sxs-lookup"><span data-stu-id="bebb1-128">These events are raised when the session's display name, icon path, volume, grouping parameter, or state changes.</span></span>

<span data-ttu-id="bebb1-129">Para implementar o recurso de roteamento de fluxo, o cliente deve aguardar a notificação de desconexão de sessão.</span><span class="sxs-lookup"><span data-stu-id="bebb1-129">To implement the stream routing feature, the client must wait for the session-disconnect notification.</span></span> <span data-ttu-id="bebb1-130">Quando uma sessão de áudio é desconectada ou o formato de um dispositivo é alterado, o WASAPI envia as notificações do cliente na forma de retornos de chamada por meio de [**IAudioSessionEvents:: OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected).</span><span class="sxs-lookup"><span data-stu-id="bebb1-130">When an audio session is disconnected or a device's format is changed, WASAPI sends the client notifications in the form of callbacks through [**IAudioSessionEvents::OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected).</span></span> <span data-ttu-id="bebb1-131">Com a notificação de desconexão, o WASAPI também envia um valor que indica por que a sessão foi desconectada.</span><span class="sxs-lookup"><span data-stu-id="bebb1-131">With the disconnection notification, WASAPI also sends a value that indicates why the session was disconnected.</span></span> <span data-ttu-id="bebb1-132">Isso pode ocorrer por vários motivos, como o dispositivo foi removido, o servidor parou e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="bebb1-132">This can occur for several reasons, such as the device was removed, the server stopped, and so on.</span></span> <span data-ttu-id="bebb1-133">Para obter a lista completa de motivos, consulte a enumeração **AudioSessionDisconnectReason** definida em AudioPolicy. h.</span><span class="sxs-lookup"><span data-stu-id="bebb1-133">For the complete list of reasons, see the **AudioSessionDisconnectReason** enumeration defined in AudioPolicy.h.</span></span> <span data-ttu-id="bebb1-134">Se o dispositivo padrão for alterado, o cliente deverá aguardar as notificações (se elas ainda não tiverem sido recebidas) que acompanham um valor **DisconnectReasonDeviceRemoval** .</span><span class="sxs-lookup"><span data-stu-id="bebb1-134">If the default device changes, the client must wait for the notifications (if they have not already been received) that are accompanied with a **DisconnectReasonDeviceRemoval** value.</span></span> <span data-ttu-id="bebb1-135">Em resposta a tais notificações, o cliente pode reabrir o fluxo no novo dispositivo padrão.</span><span class="sxs-lookup"><span data-stu-id="bebb1-135">In response to such notifications, the client might reopen the stream on the new default device.</span></span>

<span data-ttu-id="bebb1-136">Como todas essas operações são assíncrona, a ordem na qual o aplicativo recebe notificações não foi possível ser prevista.</span><span class="sxs-lookup"><span data-stu-id="bebb1-136">Because all of these operations are asychronous, the order in which the application receives notifications cannnot be predicted.</span></span> <span data-ttu-id="bebb1-137">No entanto, normalmente, o aplicativo recebe o valor de **AudioSessionDisconnect** antes da notificação de alteração de dispositivo padrão.</span><span class="sxs-lookup"><span data-stu-id="bebb1-137">However, typically, the application receives **AudioSessionDisconnect** value before the default device change notification.</span></span>

### <a name="format-change-notifications"></a><span data-ttu-id="bebb1-138">Notificações de alteração de formato</span><span class="sxs-lookup"><span data-stu-id="bebb1-138">Format Change Notifications</span></span>

<span data-ttu-id="bebb1-139">As alterações no formato de áudio ocorrem quando o formato do fluxo é alterado.</span><span class="sxs-lookup"><span data-stu-id="bebb1-139">Audio format changes occur when the format of the stream changes.</span></span> <span data-ttu-id="bebb1-140">Isso pode ocorrer quando o usuário seleciona um novo formato no painel de controle de **som** ou o novo dispositivo padrão dá suporte a um novo formato (por exemplo, HDMI ou algumas interfaces de áudio Professional com um ajuste de taxa de amostra manual).</span><span class="sxs-lookup"><span data-stu-id="bebb1-140">This can occur when the user selects a new format in the **Sound** control panel or the new default device supports a new format (for example, HDMI or certain professional audio interfaces with a manual sample-rate adjustment).</span></span> <span data-ttu-id="bebb1-141">Para notificar o cliente sobre esses tipos de alterações de formato, o WASAPI envia uma notificação de sessão pela implementação registrada de [**IAudioSessionEvents:: OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected) com um motivo de desconexão de **DisconnectReasonFormatChanged**.</span><span class="sxs-lookup"><span data-stu-id="bebb1-141">To notify the client about these types of format changes, WASAPI sends a session notification by the registered implementation of [**IAudioSessionEvents::OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected) with a disconnect reason of **DisconnectReasonFormatChanged**.</span></span> <span data-ttu-id="bebb1-142">O cliente pode manipular a notificação reabrendo o fluxo no novo formato.</span><span class="sxs-lookup"><span data-stu-id="bebb1-142">The client can handle the notification by reopening the stream in the new format.</span></span>

## <a name="related-topics"></a><span data-ttu-id="bebb1-143">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="bebb1-143">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="bebb1-144">Sobre a API do MMDevice</span><span class="sxs-lookup"><span data-stu-id="bebb1-144">About MMDevice API</span></span>](mmdevice-api.md)
</dt> <dt>

[<span data-ttu-id="bebb1-145">Sobre o WASAPI</span><span class="sxs-lookup"><span data-stu-id="bebb1-145">About WASAPI</span></span>](wasapi.md)
</dt> <dt>

[<span data-ttu-id="bebb1-146">Roteamento de fluxo</span><span class="sxs-lookup"><span data-stu-id="bebb1-146">Stream Routing</span></span>](stream-routing.md)
</dt> </dl>

 

 



