---
description: Gravação de loopback
ms.assetid: 71c567f7-fffa-4b75-897a-63ed30c4c9b0
title: Gravação de loopback
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 374da7497096118905f5e4c79bbacda832a42a7b
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103920485"
---
# <a name="loopback-recording"></a><span data-ttu-id="ac23e-103">Gravação de loopback</span><span class="sxs-lookup"><span data-stu-id="ac23e-103">Loopback Recording</span></span>

<span data-ttu-id="ac23e-104">No modo de loopback, um cliente do WASAPI pode capturar o fluxo de áudio que está sendo reproduzido por um dispositivo de ponto de extremidade de renderização.</span><span class="sxs-lookup"><span data-stu-id="ac23e-104">In loopback mode, a client of WASAPI can capture the audio stream that is being played by a rendering endpoint device.</span></span> <span data-ttu-id="ac23e-105">Para abrir um fluxo no modo de loopback, o cliente deve:</span><span class="sxs-lookup"><span data-stu-id="ac23e-105">To open a stream in loopback mode, the client must:</span></span>

-   <span data-ttu-id="ac23e-106">Obtenha uma interface [**IMMDevice**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) para o dispositivo de ponto de extremidade de renderização.</span><span class="sxs-lookup"><span data-stu-id="ac23e-106">Obtain an [**IMMDevice**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) interface for the rendering endpoint device.</span></span>
-   <span data-ttu-id="ac23e-107">Inicializar um fluxo de captura no modo de loopback no dispositivo de ponto de extremidade de renderização.</span><span class="sxs-lookup"><span data-stu-id="ac23e-107">Initialize a capture stream in loopback mode on the rendering endpoint device.</span></span>

<span data-ttu-id="ac23e-108">Depois de seguir essas etapas, o cliente pode chamar o método [**IAudioClient:: GetService**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-getservice) para obter uma interface [**IAudioCaptureClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudiocaptureclient) no dispositivo de ponto de extremidade de renderização.</span><span class="sxs-lookup"><span data-stu-id="ac23e-108">After following these steps, the client can call the [**IAudioClient::GetService**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-getservice) method to obtain an [**IAudioCaptureClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudiocaptureclient) interface on the rendering endpoint device.</span></span>

<span data-ttu-id="ac23e-109">O WASAPI fornece o modo de auto-retorno principalmente para dar suporte a cancelamento de eco acústico (AEC).</span><span class="sxs-lookup"><span data-stu-id="ac23e-109">WASAPI provides loopback mode primarily to support acoustic echo cancellation (AEC).</span></span> <span data-ttu-id="ac23e-110">No entanto, outros tipos de aplicativos de áudio podem encontrar o modo de loopback útil para capturar a combinação do sistema que está sendo reproduzida pelo mecanismo de áudio.</span><span class="sxs-lookup"><span data-stu-id="ac23e-110">However, other types of audio applications might find loopback mode useful for capturing the system mix that is being played by the audio engine.</span></span>

<span data-ttu-id="ac23e-111">No exemplo de código na [captura de um fluxo](capturing-a-stream.md), a função RecordAudioStream pode ser facilmente modificada para configurar um fluxo de captura de modo de loopback.</span><span class="sxs-lookup"><span data-stu-id="ac23e-111">In the code example in [Capturing a Stream](capturing-a-stream.md), the RecordAudioStream function can be easily modified to configure a loopback-mode capture stream.</span></span> <span data-ttu-id="ac23e-112">As modificações necessárias são:</span><span class="sxs-lookup"><span data-stu-id="ac23e-112">The required modifications are:</span></span>

-   <span data-ttu-id="ac23e-113">Na chamada para o método [**IMMDeviceEnumerator:: GetDefaultAudioEndpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint) , altere o primeiro parâmetro (*Dataflow*) de eCapture para eRender.</span><span class="sxs-lookup"><span data-stu-id="ac23e-113">In the call to the [**IMMDeviceEnumerator::GetDefaultAudioEndpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint) method, change the first parameter (*dataFlow*) from eCapture to eRender.</span></span>
-   <span data-ttu-id="ac23e-114">Na chamada para o método [**IAudioClient:: Initialize**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-initialize) , altere o valor do segundo parâmetro (*StreamFlags*) de 0 para AUDCLNT \_ StreamFlags \_ loopback.</span><span class="sxs-lookup"><span data-stu-id="ac23e-114">In the call to the [**IAudioClient::Initialize**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-initialize) method, change the value of the second parameter (*StreamFlags*) from 0 to AUDCLNT\_STREAMFLAGS\_LOOPBACK.</span></span>

<span data-ttu-id="ac23e-115">Em versões do Windows anteriores ao Windows 10 1703, o cliente de captura de modo de pull não recebe nenhum evento quando um fluxo é inicializado com buffer controlado por eventos e é habilitado para loopback.</span><span class="sxs-lookup"><span data-stu-id="ac23e-115">In versions of Windows prior to Windows 10 1703, pull-mode capture client does not receive any events when a stream is initialized with event-driven buffering and is loopback-enabled.</span></span> <span data-ttu-id="ac23e-116">Para contornar isso, inicialize um fluxo de renderização no modo orientado a eventos.</span><span class="sxs-lookup"><span data-stu-id="ac23e-116">To work around this, initialize a render stream in event-driven mode.</span></span> <span data-ttu-id="ac23e-117">Cada vez que o cliente recebe um evento para o fluxo de renderização, ele deve sinalizar o cliente de captura para executar o thread de captura que lê o próximo conjunto de amostras do buffer de ponto de extremidade de captura.</span><span class="sxs-lookup"><span data-stu-id="ac23e-117">Each time the client receives an event for the render stream, it must signal the capture client to run the capture thread that reads the next set of samples from the capture endpoint buffer.</span></span> <span data-ttu-id="ac23e-118">No Windows 10 versões 1703 e superiores, os clientes de loopback orientados por eventos têm suporte e não precisam mais da solução que envolve o fluxo de renderização.</span><span class="sxs-lookup"><span data-stu-id="ac23e-118">In Windows 10 versions 1703 and higher, event-driven loopback clients are supported, and no longer need the workaround involving the render stream.</span></span>  

<span data-ttu-id="ac23e-119">Um cliente pode habilitar o modo de loopback somente para um fluxo de modo compartilhado (AUDCLNT \_ ShareMode \_ compartilhado).</span><span class="sxs-lookup"><span data-stu-id="ac23e-119">A client can enable loopback mode only for a shared-mode stream (AUDCLNT\_SHAREMODE\_SHARED).</span></span> <span data-ttu-id="ac23e-120">Os fluxos de modo exclusivo não podem operar no modo de loopback.</span><span class="sxs-lookup"><span data-stu-id="ac23e-120">Exclusive-mode streams cannot operate in loopback mode.</span></span>

<span data-ttu-id="ac23e-121">A implementação de auto-retorno por WASAPI depende dos recursos do hardware.</span><span class="sxs-lookup"><span data-stu-id="ac23e-121">The implementation of loopback by WASAPI depend on the capabilities of the hardware.</span></span> <span data-ttu-id="ac23e-122">Se o hardware der suporte a um PIN de loopback no ponto de extremidade de renderização, o WASAPI usará o áudio fornecido nesse PIN para o fluxo de loopback.</span><span class="sxs-lookup"><span data-stu-id="ac23e-122">If the hardware supports a loopback pin on the render endpoint, WASAPI uses the audio provided on this pin for the loopback stream.</span></span> <span data-ttu-id="ac23e-123">Quando o hardware não dá suporte a um PIN de loopback, o WASAPI copia o fluxo de saída do mecanismo de áudio para o buffer de captura do aplicativo de loopback, além de copiar os dados de áudio para o PIN de renderização do hardware.</span><span class="sxs-lookup"><span data-stu-id="ac23e-123">When the hardware does not support a loopback pin, WASAPI copies the output stream from the audio engine into the loopback application's capture buffer, in addition to copying the audio data to the hardware's render pin.</span></span>

<span data-ttu-id="ac23e-124">Alguns fornecedores de hardware implementam dispositivos de auto-retorno (em vez de fixar instâncias em dispositivos de processamento) em seus adaptadores de áudio.</span><span class="sxs-lookup"><span data-stu-id="ac23e-124">Some hardware vendors implement loopback devices (as opposed to pin instances on render devices) in their audio adapters.</span></span> <span data-ttu-id="ac23e-125">Embora os dispositivos de loopback de hardware sejam semelhantes em operação ao modo de loopback WASAPI, eles podem ser mais difíceis de usar.</span><span class="sxs-lookup"><span data-stu-id="ac23e-125">Although hardware loopback devices are similar in operation to the WASAPI loopback mode, they can be more difficult to use.</span></span>

<span data-ttu-id="ac23e-126">Os dispositivos de loopback de hardware têm as seguintes desvantagens para aplicativos de áudio:</span><span class="sxs-lookup"><span data-stu-id="ac23e-126">Hardware loopback devices have the following disadvantages for audio applications:</span></span>

-   <span data-ttu-id="ac23e-127">Nem todos os adaptadores de áudio têm dispositivos de loopback.</span><span class="sxs-lookup"><span data-stu-id="ac23e-127">Not all audio adapters have loopback devices.</span></span> <span data-ttu-id="ac23e-128">Assim, os aplicativos que dependem deles não funcionarão em todos os sistemas.</span><span class="sxs-lookup"><span data-stu-id="ac23e-128">Thus, applications that depend on them will not work on all systems.</span></span>
-   <span data-ttu-id="ac23e-129">Antes que um aplicativo possa ser gravado de um dispositivo de loopback, o usuário deve identificar o dispositivo de loopback e habilitá-lo para uso.</span><span class="sxs-lookup"><span data-stu-id="ac23e-129">Before an application can record from a loopback device, the user must identify the loopback device and enable it for use.</span></span>

<span data-ttu-id="ac23e-130">Fornecedores diferentes atribuem nomes diferentes aos seus dispositivos de loopback de hardware.</span><span class="sxs-lookup"><span data-stu-id="ac23e-130">Different vendors assign different names to their hardware loopback devices.</span></span> <span data-ttu-id="ac23e-131">Os seguintes nomes são exemplos:</span><span class="sxs-lookup"><span data-stu-id="ac23e-131">The following names are examples:</span></span>

-   <span data-ttu-id="ac23e-132">Mixagem estéreo</span><span class="sxs-lookup"><span data-stu-id="ac23e-132">Stereo Mix</span></span>
-   <span data-ttu-id="ac23e-133">Mixagem de WaveOut</span><span class="sxs-lookup"><span data-stu-id="ac23e-133">Waveout Mix</span></span>
-   <span data-ttu-id="ac23e-134">Saída mista</span><span class="sxs-lookup"><span data-stu-id="ac23e-134">Mixed Output</span></span>
-   <span data-ttu-id="ac23e-135">O que você ouve</span><span class="sxs-lookup"><span data-stu-id="ac23e-135">What You Hear</span></span>

<span data-ttu-id="ac23e-136">A falta de nomes padronizados pode fazer com que os usuários tenham dificuldade para identificar um dispositivo de loopback em uma lista de nomes de dispositivos.</span><span class="sxs-lookup"><span data-stu-id="ac23e-136">The lack of standardized names might cause users to have difficulty identifying a loopback device in a list of device names.</span></span>

<span data-ttu-id="ac23e-137">Um dispositivo de loopback de hardware é um dispositivo de captura.</span><span class="sxs-lookup"><span data-stu-id="ac23e-137">A hardware loopback device is a capture device.</span></span> <span data-ttu-id="ac23e-138">Portanto, se um adaptador oferecer suporte a um dispositivo de loopback, um aplicativo de áudio poderá gravar do dispositivo da mesma maneira que ele registra de qualquer outro dispositivo de captura.</span><span class="sxs-lookup"><span data-stu-id="ac23e-138">Thus, if an adapter supports a loopback device, an audio application can record from the device in the same way that it records from any other capture device.</span></span>

<span data-ttu-id="ac23e-139">Por exemplo, se você selecionar um dispositivo de loopback de hardware para ser o dispositivo de captura padrão, poderá usar a função RecordAudioStream (sem modificação) no exemplo de código na [captura de um fluxo](capturing-a-stream.md) para capturar o fluxo do dispositivo.</span><span class="sxs-lookup"><span data-stu-id="ac23e-139">For example, if you select a hardware loopback device to be the default capture device, you can use the RecordAudioStream function (without modification) in the code example in [Capturing a Stream](capturing-a-stream.md) to capture the stream from the device.</span></span> <span data-ttu-id="ac23e-140">(Você também pode usar uma API de áudio herdada, como as funções de **waveInXxx** de multimídia do Windows, para capturar o fluxo do dispositivo.)</span><span class="sxs-lookup"><span data-stu-id="ac23e-140">(You can also use a legacy audio API, such as the Windows multimedia **waveInXxx** functions, to capture the stream from the device.)</span></span>

<span data-ttu-id="ac23e-141">Se o adaptador de áudio contiver um dispositivo de loopback de hardware, você poderá usar o painel de controle multimídia do Windows, Mmsys.cpl, para designar o dispositivo como o dispositivo de captura padrão.</span><span class="sxs-lookup"><span data-stu-id="ac23e-141">If your audio adapter contains a hardware loopback device, you can use the Windows multimedia control panel, Mmsys.cpl, to designate the device as the default capture device.</span></span> <span data-ttu-id="ac23e-142">As etapas são as seguintes:</span><span class="sxs-lookup"><span data-stu-id="ac23e-142">The steps are as follows:</span></span>

1.  <span data-ttu-id="ac23e-143">Para executar Mmsys.cpl, abra uma janela de prompt de comando e digite o seguinte comando:</span><span class="sxs-lookup"><span data-stu-id="ac23e-143">To run Mmsys.cpl, open a Command Prompt window and enter the following command:</span></span>

    ```C++
    control mmsys.cpl,,1
    ```

    

    <span data-ttu-id="ac23e-144">Como alternativa, você pode executar Mmsys.cpl clicando com o botão direito do mouse no ícone de alto-falante na área de notificação, que está localizada no lado direito da barra de tarefas e selecionando **dispositivos de gravação**.</span><span class="sxs-lookup"><span data-stu-id="ac23e-144">Alternatively, you can run Mmsys.cpl by right-clicking the speaker icon in the notification area, which is located on the right side of the taskbar, and selecting **Recording Devices**.</span></span>

2.  <span data-ttu-id="ac23e-145">Depois que a janela de Mmsys.cpl for aberta, clique com o botão direito do mouse em qualquer lugar da lista de dispositivos de gravação e verifique se a opção **Mostrar dispositivos desabilitados** está marcada.</span><span class="sxs-lookup"><span data-stu-id="ac23e-145">After the Mmsys.cpl window opens, right-click anywhere in the list of recording devices and verify that the **Show Disabled Devices** option is checked.</span></span> <span data-ttu-id="ac23e-146">(Caso contrário, se o dispositivo de loopback estiver desabilitado, ele não será exibido na lista.)</span><span class="sxs-lookup"><span data-stu-id="ac23e-146">(Otherwise, if the loopback device is disabled, it will not appear in the list.)</span></span>
3.  <span data-ttu-id="ac23e-147">Procure a lista de dispositivos de gravação para localizar o dispositivo de loopback (se existir).</span><span class="sxs-lookup"><span data-stu-id="ac23e-147">Browse the list of recording devices to locate the loopback device (if it exists).</span></span> <span data-ttu-id="ac23e-148">Se o dispositivo de loopback estiver desabilitado, habilite-o clicando com o botão direito do mouse no dispositivo e clicando em **habilitar**.</span><span class="sxs-lookup"><span data-stu-id="ac23e-148">If the loopback device is disabled, enable it by right-clicking the device and clicking **Enable**.</span></span>
4.  <span data-ttu-id="ac23e-149">Por fim, para selecionar o dispositivo de loopback para ser o dispositivo de captura padrão, clique com o botão direito do mouse no dispositivo e clique em **definir como dispositivo padrão**.</span><span class="sxs-lookup"><span data-stu-id="ac23e-149">Finally, to select the loopback device to be the default capture device, right-click the device and click **Set as Default Device**.</span></span>

<span data-ttu-id="ac23e-150">O WASAPI dá suporte à gravação de auto-retorno, independentemente de o hardware de áudio conter um dispositivo de loopback ou se o usuário habilitou o dispositivo.</span><span class="sxs-lookup"><span data-stu-id="ac23e-150">WASAPI supports loopback recording regardless of whether the audio hardware contains a loopback device, or whether the user has enabled the device.</span></span>

<span data-ttu-id="ac23e-151">O Windows Vista fornece DRM (gerenciamento de direitos digitais).</span><span class="sxs-lookup"><span data-stu-id="ac23e-151">Windows Vista provides digital rights management (DRM).</span></span> <span data-ttu-id="ac23e-152">Os provedores de conteúdo dependem do DRM para proteger suas músicas proprietárias ou outros conteúdos de cópias não autorizadas e outros usos inválidos.</span><span class="sxs-lookup"><span data-stu-id="ac23e-152">Content providers rely on DRM to protect their proprietary music or other content from unauthorized copying and other illegal uses.</span></span> <span data-ttu-id="ac23e-153">Da mesma forma, um driver de áudio confiável não permite que um dispositivo de loopback Capture fluxos digitais que contêm conteúdo protegido.</span><span class="sxs-lookup"><span data-stu-id="ac23e-153">Similarly, a trusted audio driver does not permit a loopback device to capture digital streams that contain protected content.</span></span> <span data-ttu-id="ac23e-154">O Windows Vista permite que apenas drivers confiáveis reproduzam conteúdo protegido.</span><span class="sxs-lookup"><span data-stu-id="ac23e-154">Windows Vista allows only trusted drivers to play protected content.</span></span> <span data-ttu-id="ac23e-155">Para obter mais informações sobre drivers confiáveis e DRM, consulte a documentação do Windows DDK.</span><span class="sxs-lookup"><span data-stu-id="ac23e-155">For more information about trusted drivers and DRM, see the Windows DDK documentation.</span></span>

<span data-ttu-id="ac23e-156">O loopback WASAPI contém a combinação de todos os áudios que estão sendo reproduzidos, independentemente da sessão dos serviços de terminal da qual o áudio foi originado.</span><span class="sxs-lookup"><span data-stu-id="ac23e-156">WASAPI loopback contains the mix of all audio being played, regardless of the Terminal Services session the audio originated from.</span></span> <span data-ttu-id="ac23e-157">Por exemplo, você pode executar um cliente de auto-retorno em um serviço em execução na sessão 0 e capturar áudio de todas as sessões de usuário, bem como o áudio que está sendo reproduzido da sessão 0.</span><span class="sxs-lookup"><span data-stu-id="ac23e-157">For example, you can run a loopback client in a service running in session 0 and capture audio from all user sessions, as well as audio being played from session 0.</span></span>

<span data-ttu-id="ac23e-158">Área de Trabalho Remota permite redirecionar o áudio para o cliente.</span><span class="sxs-lookup"><span data-stu-id="ac23e-158">Remote Desktop allows redirecting audio to the client.</span></span> <span data-ttu-id="ac23e-159">Isso é implementado pela criação de novos dispositivos de áudio que aparecem apenas para essa sessão.</span><span class="sxs-lookup"><span data-stu-id="ac23e-159">This is implemented by creating new audio devices that only appear for that session.</span></span>

## <a name="related-topics"></a><span data-ttu-id="ac23e-160">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="ac23e-160">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="ac23e-161">Gerenciamento de fluxo</span><span class="sxs-lookup"><span data-stu-id="ac23e-161">Stream Management</span></span>](stream-management.md)
</dt> </dl>

 

 



