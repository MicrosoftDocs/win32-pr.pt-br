---
description: Recuperando de um erro de Invalid-Device
ms.assetid: 1f5c3458-70ca-45ba-ac33-5c7b9f092320
title: Recuperando de um erro de Invalid-Device
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ca20c32be46367f53a14ce26c39f980e3649b652
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104089507"
---
# <a name="recovering-from-an-invalid-device-error"></a><span data-ttu-id="e64a3-103">Recuperando de um erro de Invalid-Device</span><span class="sxs-lookup"><span data-stu-id="e64a3-103">Recovering from an Invalid-Device Error</span></span>

<span data-ttu-id="e64a3-104">Muitos dos métodos em WASAPI retornam o código de erro AUDCLNT \_ E \_ \_ o dispositivo invalidado se o dispositivo de ponto de extremidade de áudio que o aplicativo cliente está usando se tornar inválido.</span><span class="sxs-lookup"><span data-stu-id="e64a3-104">Many of the methods in WASAPI return error code AUDCLNT\_E\_DEVICE\_INVALIDATED if the audio endpoint device that the client application is using becomes invalid.</span></span> <span data-ttu-id="e64a3-105">Esse código de erro indica que o dispositivo de ponto de extremidade foi desconectado ou que o hardware de áudio ou os recursos de hardware associados foram reconfigurados, desabilitados, removidos ou tornados de outra forma indisponíveis para uso.</span><span class="sxs-lookup"><span data-stu-id="e64a3-105">This error code indicates that the endpoint device has been unplugged, or that the audio hardware or associated hardware resources have been reconfigured, disabled, removed, or otherwise made unavailable for use.</span></span> <span data-ttu-id="e64a3-106">Frequentemente, o aplicativo pode se recuperar desse erro.</span><span class="sxs-lookup"><span data-stu-id="e64a3-106">Frequently, the application can recover from this error.</span></span>

>[!NOTE]
> <span data-ttu-id="e64a3-107">Para obter informações sobre a recuperação de erros de dispositivo inválidos ao usar ISAC (APIs de áudio espacial), consulte [recuperando de um erro de Invalid-Device (som espacial)](recovering-from-an-invalid-device-error-spatial-sound.md)</span><span class="sxs-lookup"><span data-stu-id="e64a3-107">For information on recovering from invalid device errors when using spatial audio APIs (ISAC), see [Recovering from an Invalid-Device Error (Spatial Sound)](recovering-from-an-invalid-device-error-spatial-sound.md)</span></span>

<span data-ttu-id="e64a3-108">A estratégia que um aplicativo deve usar para se recuperar de um \_ \_ \_ erro invalidado do dispositivo AUDCLNT E depende de quais das técnicas a seguir o aplicativo usa para selecionar um dispositivo de ponto de extremidade de áudio:</span><span class="sxs-lookup"><span data-stu-id="e64a3-108">The strategy that an application should use to recover from an AUDCLNT\_E\_DEVICE\_INVALIDATED error depends on which of the following techniques the application uses to select an audio endpoint device:</span></span>

-   <span data-ttu-id="e64a3-109">Sempre selecione o dispositivo de captura ou processamento de áudio padrão.</span><span class="sxs-lookup"><span data-stu-id="e64a3-109">Always select the default audio rendering or capture device.</span></span>
-   <span data-ttu-id="e64a3-110">Selecione um dispositivo de ponto de extremidade de áudio específico.</span><span class="sxs-lookup"><span data-stu-id="e64a3-110">Select a specific audio endpoint device.</span></span>

<span data-ttu-id="e64a3-111">No último caso, o aplicativo seleciona automaticamente um dispositivo específico com base nos requisitos internos ou permite que o usuário selecione explicitamente um dispositivo de uma lista de dispositivos disponíveis.</span><span class="sxs-lookup"><span data-stu-id="e64a3-111">In the latter case, either the application automatically selects a specific device based on internal requirements or it allows the user to explicitly select a device from a list of available devices.</span></span>

<span data-ttu-id="e64a3-112">Um aplicativo que usa o dispositivo padrão pode tentar se recuperar de um \_ \_ \_ erro invalidado do dispositivo AUDCLNT E, da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="e64a3-112">An application that uses the default device can attempt to recover from an AUDCLNT\_E\_DEVICE\_INVALIDATED error as follows:</span></span>

1.  <span data-ttu-id="e64a3-113">Libere a interface [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) e quaisquer outras interfaces WASAPI que ele tenha adquirido no dispositivo.</span><span class="sxs-lookup"><span data-stu-id="e64a3-113">Release the [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) interface and any other WASAPI interfaces that it has acquired on the device.</span></span>
2.  <span data-ttu-id="e64a3-114">Chame o método [**IMMDeviceEnumerator:: GetDefaultAudioEndpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint) para obter o dispositivo de áudio padrão atual.</span><span class="sxs-lookup"><span data-stu-id="e64a3-114">Call the [**IMMDeviceEnumerator::GetDefaultAudioEndpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint) method to get the current default audio device.</span></span>
3.  <span data-ttu-id="e64a3-115">Tentativa de ativar o [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) no dispositivo de áudio padrão.</span><span class="sxs-lookup"><span data-stu-id="e64a3-115">Attempt to activate [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) on the default audio device.</span></span>

<span data-ttu-id="e64a3-116">Seguindo as etapas anteriores, o aplicativo tende a responder adequadamente, independentemente da causa do \_ \_ \_ erro invalidado do dispositivo AUDCLNT E.</span><span class="sxs-lookup"><span data-stu-id="e64a3-116">By following the preceding steps, the application tends to respond appropriately regardless of the cause of the AUDCLNT\_E\_DEVICE\_INVALIDATED error.</span></span> <span data-ttu-id="e64a3-117">Se a reconfiguração do dispositivo padrão tiver causado o erro (por exemplo, se o usuário alterou o formato de fluxo usado pelo dispositivo), essas etapas, se tiverem sucesso, permitirão que o aplicativo continue a usar o mesmo dispositivo.</span><span class="sxs-lookup"><span data-stu-id="e64a3-117">If reconfiguration of the default device caused the error (for example, if the user changed the stream format used by the device), then these steps, if they succeed, enable the application to continue to use the same device.</span></span> <span data-ttu-id="e64a3-118">Se o usuário tiver desabilitado ou removido o dispositivo que o aplicativo estava usando e outro dispositivo estiver disponível para assumir a função do dispositivo padrão, o aplicativo poderá continuar usando o novo dispositivo padrão.</span><span class="sxs-lookup"><span data-stu-id="e64a3-118">If the user disabled or removed the device that the application was using and another device is available to assume the role of default device, then the application can continue by using the new default device.</span></span> <span data-ttu-id="e64a3-119">Em ambos os casos, o aplicativo se adapta automaticamente sem a necessidade de intervenção pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="e64a3-119">In either case, the application adapts automatically without requiring intervention by the user.</span></span>

<span data-ttu-id="e64a3-120">Um aplicativo que seleciona um dispositivo específico pode tentar se recuperar do \_ \_ \_ erro invalidado do dispositivo AUDCLNT E, da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="e64a3-120">An application that selects a specific device can attempt to recover from the AUDCLNT\_E\_DEVICE\_INVALIDATED error as follows:</span></span>

1.  <span data-ttu-id="e64a3-121">Libere a interface [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) e quaisquer outras interfaces WASAPI que ele tenha adquirido no dispositivo.</span><span class="sxs-lookup"><span data-stu-id="e64a3-121">Release the [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) interface and any other WASAPI interfaces that it has acquired on the device.</span></span>
2.  <span data-ttu-id="e64a3-122">Tentativa de ativar uma interface [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) no mesmo dispositivo.</span><span class="sxs-lookup"><span data-stu-id="e64a3-122">Attempt to activate an [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) interface on the same device.</span></span>
3.  <span data-ttu-id="e64a3-123">Se a etapa 2 falhar, o aplicativo poderá, como opção, solicitar que o usuário selecione outro dispositivo.</span><span class="sxs-lookup"><span data-stu-id="e64a3-123">If step 2 fails, then the application can, as an option, prompt the user to select another device.</span></span>

<span data-ttu-id="e64a3-124">A etapa 2 pode ter êxito se o dispositivo que está sendo usado pelo aplicativo tiver sido reconfigurado, mas não estiver desabilitado ou removido.</span><span class="sxs-lookup"><span data-stu-id="e64a3-124">Step 2 can succeed if the device being used by the application was reconfigured but not disabled or removed.</span></span> <span data-ttu-id="e64a3-125">Se for bem-sucedido, a etapa 2 permitirá que o aplicativo continue a usar automaticamente o mesmo dispositivo sem exigir a intervenção do usuário.</span><span class="sxs-lookup"><span data-stu-id="e64a3-125">If successful, step 2 enables the application to automatically continue to use the same device without requiring intervention by the user.</span></span> <span data-ttu-id="e64a3-126">A etapa 3 é apropriada se o aplicativo permitir que o usuário selecione explicitamente outro dispositivo depois que o usuário tiver desabilitado ou removido o dispositivo usado anteriormente.</span><span class="sxs-lookup"><span data-stu-id="e64a3-126">Step 3 is appropriate if the application allows the user to explicitly select another device after the user has disabled or removed the previously used device.</span></span>

<span data-ttu-id="e64a3-127">Um aplicativo pode determinar mais precisamente a causa de um erro de dispositivo inválido ao se registrar para receber uma notificação quando uma sessão perde sua conexão com um dispositivo.</span><span class="sxs-lookup"><span data-stu-id="e64a3-127">An application can determine more precisely the cause of an invalid-device error by registering to receive a notification when a session loses its connection to a device.</span></span> <span data-ttu-id="e64a3-128">Para habilitar essa notificação, o aplicativo implementa uma interface [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) e chama o método [**IAudioSessionControl:: RegisterAudioSessionNotification**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessioncontrol-registeraudiosessionnotification) para registrar a interface.</span><span class="sxs-lookup"><span data-stu-id="e64a3-128">To enable this notification, the application implements an [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) interface and calls the [**IAudioSessionControl::RegisterAudioSessionNotification**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessioncontrol-registeraudiosessionnotification) method to register the interface.</span></span> <span data-ttu-id="e64a3-129">Quando um erro de dispositivo inválido faz com que a sessão seja desconectada, WASAPI chama o método [**IAudioSessionEvents:: OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected) na interface registrada.</span><span class="sxs-lookup"><span data-stu-id="e64a3-129">When an invalid-device error causes the session to be disconnected, WASAPI calls the [**IAudioSessionEvents::OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected) method in the registered interface.</span></span> <span data-ttu-id="e64a3-130">Com esse método, o WASAPI informa o aplicativo do motivo da desconexão.</span><span class="sxs-lookup"><span data-stu-id="e64a3-130">Through this method, WASAPI informs the application of the reason for the disconnection.</span></span> <span data-ttu-id="e64a3-131">No Windows Vista, a chamada **OnSessionDisconnected** identifica os seguintes motivos:</span><span class="sxs-lookup"><span data-stu-id="e64a3-131">In Windows Vista, the **OnSessionDisconnected** call identifies the following reasons:</span></span>

-   <span data-ttu-id="e64a3-132">O usuário removeu o dispositivo de ponto de extremidade de áudio.</span><span class="sxs-lookup"><span data-stu-id="e64a3-132">The user removed the audio endpoint device.</span></span>
-   <span data-ttu-id="e64a3-133">O serviço de áudio do Windows foi desligado.</span><span class="sxs-lookup"><span data-stu-id="e64a3-133">The Windows audio service has shut down.</span></span>
-   <span data-ttu-id="e64a3-134">O formato de fluxo preferencial foi alterado para o dispositivo ao qual a sessão de áudio está conectada.</span><span class="sxs-lookup"><span data-stu-id="e64a3-134">The preferred stream format changed for the device that the audio session is connected to.</span></span>
-   <span data-ttu-id="e64a3-135">O usuário fez logoff na sessão dos serviços de terminal do Windows (WTS) em que a sessão de áudio estava sendo executada.</span><span class="sxs-lookup"><span data-stu-id="e64a3-135">The user logged off the Windows Terminal Services (WTS) session that the audio session was running in.</span></span> <span data-ttu-id="e64a3-136">Para obter mais informações sobre sessões do WTS, consulte a documentação do SDK do Windows.</span><span class="sxs-lookup"><span data-stu-id="e64a3-136">For more information about WTS sessions, see the Windows SDK documentation.</span></span>
-   <span data-ttu-id="e64a3-137">A sessão WTS em que a sessão de áudio estava sendo executada foi desconectada.</span><span class="sxs-lookup"><span data-stu-id="e64a3-137">The WTS session that the audio session was running in was disconnected.</span></span>
-   <span data-ttu-id="e64a3-138">A sessão de áudio (modo compartilhado) foi desconectada para tornar o dispositivo de ponto de extremidade de áudio disponível para uma conexão de modo exclusivo.</span><span class="sxs-lookup"><span data-stu-id="e64a3-138">The (shared-mode) audio session was disconnected to make the audio endpoint device available for an exclusive-mode connection.</span></span>

<span data-ttu-id="e64a3-139">Em resposta ao evento de desconexão, WASAPI fecha todos os fluxos que pertencem à sessão.</span><span class="sxs-lookup"><span data-stu-id="e64a3-139">In response to the disconnection event, WASAPI closes all of the streams that belong to the session.</span></span> <span data-ttu-id="e64a3-140">Se, posteriormente, um aplicativo tentar acessar um fluxo fechado por meio de um método WASAPI, como [**IAudioClient:: GetCurrentPadding**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-getcurrentpadding), o método falhará e retornará o código de erro AUDCLNT \_ E o \_ dispositivo \_ invalidado.</span><span class="sxs-lookup"><span data-stu-id="e64a3-140">If an application subsequently attempts to access a closed stream through a WASAPI method such as [**IAudioClient::GetCurrentPadding**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-getcurrentpadding), then the method fails and returns error code AUDCLNT\_E\_DEVICE\_INVALIDATED.</span></span>

<span data-ttu-id="e64a3-141">Um benefício adicional para receber notificações por meio da interface [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) é que as notificações chegam de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="e64a3-141">An additional benefit to receiving notifications through the [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) interface is that the notifications arrive asynchronously.</span></span> <span data-ttu-id="e64a3-142">Portanto, mesmo quando o fluxo não está em execução, o aplicativo ainda receberá uma notificação oportuna de erros de dispositivo inválido que pode impedir a execução do fluxo.</span><span class="sxs-lookup"><span data-stu-id="e64a3-142">Thus, even when the stream is not running, the application will still receive timely notification of invalid-device errors that can prevent the stream from running.</span></span>

## <a name="related-topics"></a><span data-ttu-id="e64a3-143">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="e64a3-143">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="e64a3-144">Gerenciamento de fluxo</span><span class="sxs-lookup"><span data-stu-id="e64a3-144">Stream Management</span></span>](stream-management.md)
</dt> </dl>

 

 



