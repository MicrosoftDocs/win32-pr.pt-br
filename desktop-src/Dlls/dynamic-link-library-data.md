---
description: Uma biblioteca de Dynamic-Link (DLL) pode conter dados globais ou locais.
ms.assetid: b1f6811e-c413-4124-9ccb-ea59b7a8a7ff
title: Dynamic-Link dados da biblioteca
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 83280d3bfc449061c44f9e8bfd9b47833e7eca19
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "105755127"
---
# <a name="dynamic-link-library-data"></a><span data-ttu-id="ddfa8-103">Dynamic-Link dados da biblioteca</span><span class="sxs-lookup"><span data-stu-id="ddfa8-103">Dynamic-Link Library Data</span></span>

<span data-ttu-id="ddfa8-104">Uma biblioteca de Dynamic-Link (DLL) pode conter dados globais ou locais.</span><span class="sxs-lookup"><span data-stu-id="ddfa8-104">A Dynamic-Link Library (DLL) can contain global data or local data.</span></span>

## <a name="variable-scope"></a><span data-ttu-id="ddfa8-105">{1&gt;Escopo de variáveis&lt;1}</span><span class="sxs-lookup"><span data-stu-id="ddfa8-105">Variable Scope</span></span>

<span data-ttu-id="ddfa8-106">As variáveis declaradas como globais em um arquivo de código-fonte DLL são tratadas como variáveis globais pelo compilador e pelo vinculador, mas cada processo que carrega uma determinada DLL obtém sua própria cópia das variáveis globais dessa DLL.</span><span class="sxs-lookup"><span data-stu-id="ddfa8-106">Variables that are declared as global in a DLL source code file are treated as global variables by the compiler and linker, but each process that loads a given DLL gets its own copy of that DLL's global variables.</span></span> <span data-ttu-id="ddfa8-107">O escopo de variáveis estáticas é limitado ao bloco no qual as variáveis estáticas são declaradas.</span><span class="sxs-lookup"><span data-stu-id="ddfa8-107">The scope of static variables is limited to the block in which the static variables are declared.</span></span> <span data-ttu-id="ddfa8-108">Como resultado, cada processo tem sua própria instância das variáveis global e estática de DLL por padrão.</span><span class="sxs-lookup"><span data-stu-id="ddfa8-108">As a result, each process has its own instance of the DLL global and static variables by default.</span></span>

> [!Note]  
> <span data-ttu-id="ddfa8-109">Suas ferramentas de desenvolvimento podem permitir que você substitua o comportamento padrão.</span><span class="sxs-lookup"><span data-stu-id="ddfa8-109">Your development tools may allow you to override the default behavior.</span></span> <span data-ttu-id="ddfa8-110">Por exemplo, o compilador Visual C++ dá suporte à **\# seção pragma** e o vinculador dá suporte à opção/Section.</span><span class="sxs-lookup"><span data-stu-id="ddfa8-110">For example, the Visual C++ compiler supports **\#pragma section** and the linker supports the /SECTION option.</span></span> <span data-ttu-id="ddfa8-111">Para obter mais informações, consulte a documentação incluída com suas ferramentas de desenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="ddfa8-111">For more information, see the documentation included with your development tools.</span></span>

 

## <a name="dynamic-memory-allocation"></a><span data-ttu-id="ddfa8-112">Alocação de Memória Dinâmica</span><span class="sxs-lookup"><span data-stu-id="ddfa8-112">Dynamic Memory Allocation</span></span>

<span data-ttu-id="ddfa8-113">Quando uma DLL aloca memória usando qualquer uma das funções de alocação de memória ([**GlobalAlloc**](/windows/desktop/api/winbase/nf-winbase-globalalloc), [**LocalAlloc**](/windows/desktop/api/winbase/nf-winbase-localalloc), [**HeapAlloc**](/windows/desktop/api/heapapi/nf-heapapi-heapalloc)e [**VirtualAlloc**](/windows/desktop/api/memoryapi/nf-memoryapi-virtualalloc)), a memória é alocada no espaço de endereço virtual do processo de chamada e é acessível somente para os threads desse processo.</span><span class="sxs-lookup"><span data-stu-id="ddfa8-113">When a DLL allocates memory using any of the memory allocation functions ([**GlobalAlloc**](/windows/desktop/api/winbase/nf-winbase-globalalloc), [**LocalAlloc**](/windows/desktop/api/winbase/nf-winbase-localalloc), [**HeapAlloc**](/windows/desktop/api/heapapi/nf-heapapi-heapalloc), and [**VirtualAlloc**](/windows/desktop/api/memoryapi/nf-memoryapi-virtualalloc)), the memory is allocated in the virtual address space of the calling process and is accessible only to the threads of that process.</span></span>

<span data-ttu-id="ddfa8-114">Uma DLL pode usar o mapeamento de arquivo para alocar memória que pode ser compartilhada entre processos.</span><span class="sxs-lookup"><span data-stu-id="ddfa8-114">A DLL can use file mapping to allocate memory that can be shared among processes.</span></span> <span data-ttu-id="ddfa8-115">Para obter uma discussão geral sobre como usar o mapeamento de arquivo para criar a memória compartilhada nomeada, consulte [mapeamento de arquivo](/windows/desktop/Memory/file-mapping).</span><span class="sxs-lookup"><span data-stu-id="ddfa8-115">For a general discussion of how to use file mapping to create named shared memory, see [File Mapping](/windows/desktop/Memory/file-mapping).</span></span> <span data-ttu-id="ddfa8-116">Para obter um exemplo que usa a função [**DllMain**](dllmain.md) para configurar a memória compartilhada usando o mapeamento de arquivo, consulte [usando a memória compartilhada em uma biblioteca de Dynamic-Link](using-shared-memory-in-a-dynamic-link-library.md).</span><span class="sxs-lookup"><span data-stu-id="ddfa8-116">For an example that uses the [**DllMain**](dllmain.md) function to set up shared memory using file mapping, see [Using Shared Memory in a Dynamic-Link Library](using-shared-memory-in-a-dynamic-link-library.md).</span></span>

## <a name="thread-local-storage"></a><span data-ttu-id="ddfa8-117">Armazenamento local de thread</span><span class="sxs-lookup"><span data-stu-id="ddfa8-117">Thread Local Storage</span></span>

<span data-ttu-id="ddfa8-118">As funções de armazenamento local de thread (TLS) permitem que uma DLL aloque um índice para armazenar e recuperar um valor diferente para cada thread de um processo multi-threaded.</span><span class="sxs-lookup"><span data-stu-id="ddfa8-118">The thread local storage (TLS) functions enable a DLL to allocate an index for storing and retrieving a different value for each thread of a multithreaded process.</span></span> <span data-ttu-id="ddfa8-119">Por exemplo, um aplicativo de planilha pode criar uma nova instância do mesmo thread cada vez que o usuário abrir uma nova planilha.</span><span class="sxs-lookup"><span data-stu-id="ddfa8-119">For example, a spreadsheet application can create a new instance of the same thread each time the user opens a new spreadsheet.</span></span> <span data-ttu-id="ddfa8-120">Uma DLL que fornece as funções para várias operações de planilha pode usar o TLS para salvar informações sobre o estado atual de cada planilha (linha, coluna e assim por diante).</span><span class="sxs-lookup"><span data-stu-id="ddfa8-120">A DLL providing the functions for various spreadsheet operations can use TLS to save information about the current state of each spreadsheet (row, column, and so on).</span></span> <span data-ttu-id="ddfa8-121">Para uma discussão geral sobre o armazenamento local de thread, consulte [armazenamento local de thread](/windows/desktop/ProcThread/thread-local-storage).</span><span class="sxs-lookup"><span data-stu-id="ddfa8-121">For a general discussion of thread local storage, see [Thread Local Storage](/windows/desktop/ProcThread/thread-local-storage).</span></span> <span data-ttu-id="ddfa8-122">Para obter um exemplo que usa a função [**DllMain**](dllmain.md) para configurar o armazenamento local de thread, consulte [usando o armazenamento local de thread em uma biblioteca de Dynamic-Link](using-thread-local-storage-in-a-dynamic-link-library.md).</span><span class="sxs-lookup"><span data-stu-id="ddfa8-122">For an example that uses the [**DllMain**](dllmain.md) function to set up thread local storage, see [Using Thread Local Storage in a Dynamic-Link Library](using-thread-local-storage-in-a-dynamic-link-library.md).</span></span>

<span data-ttu-id="ddfa8-123">**Windows Server 2003 e Windows XP:** O compilador Visual C++ dá suporte a uma sintaxe que permite declarar variáveis locais de thread: **\_ declspec (thread)**.</span><span class="sxs-lookup"><span data-stu-id="ddfa8-123">**Windows Server 2003 and Windows XP:** The Visual C++ compiler supports a syntax that enables you to declare thread-local variables: **\_declspec(thread)**.</span></span> <span data-ttu-id="ddfa8-124">Se você usar essa sintaxe em uma DLL, não será possível carregar a DLL explicitamente usando [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) ou [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) em versões do Windows anteriores ao Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="ddfa8-124">If you use this syntax in a DLL, you will not be able to load the DLL explicitly using [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) on versions of Windows prior to Windows Vista.</span></span> <span data-ttu-id="ddfa8-125">Se sua DLL for carregada explicitamente, você deverá usar as funções de armazenamento local de thread em vez de **\_ declspec (thread)**.</span><span class="sxs-lookup"><span data-stu-id="ddfa8-125">If your DLL will be loaded explicitly, you must use the thread local storage functions instead of **\_declspec(thread)**.</span></span>

 

 
