---
description: Quando o aplicativo chama as funções LoadLibrary ou LoadLibraryEx, o sistema tenta localizar a DLL (para obter detalhes, consulte Dynamic-Link ordem de pesquisa da biblioteca).
ms.assetid: 81e237a9-3c32-46a5-88d3-c978f43dad54
title: Run-Time vinculação dinâmica
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a9e215ac83ecdc0615b8030e2e215857c67fe6e5
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105766920"
---
# <a name="run-time-dynamic-linking"></a><span data-ttu-id="ba9e9-103">Run-Time vinculação dinâmica</span><span class="sxs-lookup"><span data-stu-id="ba9e9-103">Run-Time Dynamic Linking</span></span>

<span data-ttu-id="ba9e9-104">Quando o aplicativo chama as funções [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) ou [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) , o sistema tenta localizar a dll (para obter detalhes, consulte [ordem de pesquisa da biblioteca de vínculo dinâmico](dynamic-link-library-search-order.md)).</span><span class="sxs-lookup"><span data-stu-id="ba9e9-104">When the application calls the [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) functions, the system attempts to locate the DLL (for details, see [Dynamic-Link Library Search Order](dynamic-link-library-search-order.md)).</span></span> <span data-ttu-id="ba9e9-105">Se a pesquisa for bem sucedido, o sistema mapeará o módulo DLL para o espaço de endereço virtual do processo e incrementará a contagem de referência.</span><span class="sxs-lookup"><span data-stu-id="ba9e9-105">If the search succeeds, the system maps the DLL module into the virtual address space of the process and increments the reference count.</span></span> <span data-ttu-id="ba9e9-106">Se a chamada para **LoadLibrary** ou **LOADLIBRARYEX** especificar uma dll cujo código já esteja mapeado no espaço de endereço virtual do processo de chamada, a função simplesmente retornará um identificador para a dll e incrementará a contagem de referência de dll.</span><span class="sxs-lookup"><span data-stu-id="ba9e9-106">If the call to **LoadLibrary** or **LoadLibraryEx** specifies a DLL whose code is already mapped into the virtual address space of the calling process, the function simply returns a handle to the DLL and increments the DLL reference count.</span></span> <span data-ttu-id="ba9e9-107">Observe que duas DLLs que têm o mesmo nome de arquivo base e extensão, mas que são encontradas em diretórios diferentes, não são consideradas a mesma DLL.</span><span class="sxs-lookup"><span data-stu-id="ba9e9-107">Note that two DLLs that have the same base file name and extension but are found in different directories are not considered to be the same DLL.</span></span>

<span data-ttu-id="ba9e9-108">O sistema chama a função de ponto de entrada no contexto do thread que chamou [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) ou [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa).</span><span class="sxs-lookup"><span data-stu-id="ba9e9-108">The system calls the entry-point function in the context of the thread that called [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa).</span></span> <span data-ttu-id="ba9e9-109">A função de ponto de entrada não será chamada se a DLL já tiver sido carregada pelo processo por meio de uma chamada para **LoadLibrary** ou **LoadLibraryEx** sem nenhuma chamada correspondente à função [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) .</span><span class="sxs-lookup"><span data-stu-id="ba9e9-109">The entry-point function is not called if the DLL was already loaded by the process through a call to **LoadLibrary** or **LoadLibraryEx** with no corresponding call to the [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) function.</span></span>

<span data-ttu-id="ba9e9-110">Se o sistema não puder localizar a DLL ou se a função de ponto de entrada retornar FALSE, [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) ou [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) retornará NULL.</span><span class="sxs-lookup"><span data-stu-id="ba9e9-110">If the system cannot find the DLL or if the entry-point function returns FALSE, [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) returns NULL.</span></span> <span data-ttu-id="ba9e9-111">Se **LoadLibrary** ou **LoadLibraryEx** tiver sucesso, ele retornará um identificador para o módulo de dll.</span><span class="sxs-lookup"><span data-stu-id="ba9e9-111">If **LoadLibrary** or **LoadLibraryEx** succeeds, it returns a handle to the DLL module.</span></span> <span data-ttu-id="ba9e9-112">O processo pode usar esse identificador para identificar a DLL em uma chamada para a função [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress), [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary)ou [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread) .</span><span class="sxs-lookup"><span data-stu-id="ba9e9-112">The process can use this handle to identify the DLL in a call to the [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress), [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary), or [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread) function.</span></span>

<span data-ttu-id="ba9e9-113">A função [**GetModuleHandle**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulehandlea) retorna um identificador usado em [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress), [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary)ou [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread).</span><span class="sxs-lookup"><span data-stu-id="ba9e9-113">The [**GetModuleHandle**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulehandlea) function returns a handle used in [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress), [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary), or [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread).</span></span> <span data-ttu-id="ba9e9-114">A função **GetModuleHandle** só terá sucesso se o módulo DLL já estiver mapeado para o espaço de endereço do processo por vinculação de tempo de carregamento ou por uma chamada anterior para [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) ou [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa).</span><span class="sxs-lookup"><span data-stu-id="ba9e9-114">The **GetModuleHandle** function succeeds only if the DLL module is already mapped into the address space of the process by load-time linking or by a previous call to [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa).</span></span> <span data-ttu-id="ba9e9-115">Ao contrário de **LoadLibrary** ou **LoadLibraryEx**, **GetModuleHandle** não incrementa a contagem de referência do módulo.</span><span class="sxs-lookup"><span data-stu-id="ba9e9-115">Unlike **LoadLibrary** or **LoadLibraryEx**, **GetModuleHandle** does not increment the module reference count.</span></span> <span data-ttu-id="ba9e9-116">A função [**GetModuleFileName**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) recupera o caminho completo do módulo associado a um identificador retornado por **GetModuleHandle**, **LoadLibrary** ou **LoadLibraryEx**.</span><span class="sxs-lookup"><span data-stu-id="ba9e9-116">The [**GetModuleFileName**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) function retrieves the full path of the module associated with a handle returned by **GetModuleHandle**, **LoadLibrary**, or **LoadLibraryEx**.</span></span>

<span data-ttu-id="ba9e9-117">O processo pode usar [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress) para obter o endereço de uma função exportada na DLL usando um identificador de módulo de dll retornado por [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) ou [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa), [**GetModuleHandle**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulehandlea).</span><span class="sxs-lookup"><span data-stu-id="ba9e9-117">The process can use [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress) to get the address of an exported function in the DLL using a DLL module handle returned by [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa), [**GetModuleHandle**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulehandlea).</span></span>

<span data-ttu-id="ba9e9-118">Quando o módulo DLL não é mais necessário, o processo pode chamar [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) ou [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread).</span><span class="sxs-lookup"><span data-stu-id="ba9e9-118">When the DLL module is no longer needed, the process can call [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) or [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread).</span></span> <span data-ttu-id="ba9e9-119">Essas funções decrementam a contagem de referência de módulo e desmapeam o código de DLL do espaço de endereço virtual do processo se a contagem de referência for zero.</span><span class="sxs-lookup"><span data-stu-id="ba9e9-119">These functions decrement the module reference count and unmap the DLL code from the virtual address space of the process if the reference count is zero.</span></span>

<span data-ttu-id="ba9e9-120">A vinculação dinâmica em tempo de execução permite que o processo continue em execução mesmo se uma DLL não estiver disponível.</span><span class="sxs-lookup"><span data-stu-id="ba9e9-120">Run-time dynamic linking enables the process to continue running even if a DLL is not available.</span></span> <span data-ttu-id="ba9e9-121">O processo pode, então, usar um método alternativo para atingir seu objetivo.</span><span class="sxs-lookup"><span data-stu-id="ba9e9-121">The process can then use an alternate method to accomplish its objective.</span></span> <span data-ttu-id="ba9e9-122">Por exemplo, se um processo não puder localizar uma DLL, ele poderá tentar usar outra ou poderá notificar o usuário sobre um erro.</span><span class="sxs-lookup"><span data-stu-id="ba9e9-122">For example, if a process is unable to locate one DLL, it can try to use another, or it can notify the user of an error.</span></span> <span data-ttu-id="ba9e9-123">Se o usuário puder fornecer o caminho completo da DLL ausente, o processo poderá usar essas informações para carregar a DLL, mesmo que ela não esteja no caminho de pesquisa normal.</span><span class="sxs-lookup"><span data-stu-id="ba9e9-123">If the user can provide the full path of the missing DLL, the process can use this information to load the DLL even though it is not in the normal search path.</span></span> <span data-ttu-id="ba9e9-124">Essa situação contrasta com a vinculação de tempo de carregamento, na qual o sistema simplesmente encerra o processo se não conseguir encontrar a DLL.</span><span class="sxs-lookup"><span data-stu-id="ba9e9-124">This situation contrasts with load-time linking, in which the system simply terminates the process if it cannot find the DLL.</span></span>

<span data-ttu-id="ba9e9-125">A vinculação dinâmica em tempo de execução pode causar problemas se a DLL usa a função [**DllMain**](dllmain.md) para executar a inicialização para cada thread de um processo, porque o ponto de entrada não é chamado para threads que existiam antes de [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) ou [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) ser chamado.</span><span class="sxs-lookup"><span data-stu-id="ba9e9-125">Run-time dynamic linking can cause problems if the DLL uses the [**DllMain**](dllmain.md) function to perform initialization for each thread of a process, because the entry-point is not called for threads that existed before [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) is called.</span></span> <span data-ttu-id="ba9e9-126">Para obter um exemplo que mostra como lidar com esse problema, consulte [usando o armazenamento local de thread em uma biblioteca de Dynamic-Link](using-thread-local-storage-in-a-dynamic-link-library.md).</span><span class="sxs-lookup"><span data-stu-id="ba9e9-126">For an example showing how to deal with this problem, see [Using Thread Local Storage in a Dynamic-Link Library](using-thread-local-storage-in-a-dynamic-link-library.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="ba9e9-127">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="ba9e9-127">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="ba9e9-128">Usando vinculação dinâmica em tempo de execução</span><span class="sxs-lookup"><span data-stu-id="ba9e9-128">Using Run-time Dynamic Linking</span></span>](using-run-time-dynamic-linking.md)
</dt> </dl>

 

 
