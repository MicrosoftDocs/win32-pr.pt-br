---
description: Normalmente, os serviços são aplicativos de console projetados para execução autônoma sem uma GUI (interface gráfica do usuário).
ms.assetid: 3d6e090a-00b1-47d8-a4fb-620f3db8ba9c
title: Serviços interativos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 57dda3018b4b37e8c5ee56d67cd1db2c56da9b67
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "103829635"
---
# <a name="interactive-services"></a><span data-ttu-id="2c5ee-103">Serviços interativos</span><span class="sxs-lookup"><span data-stu-id="2c5ee-103">Interactive Services</span></span>

<span data-ttu-id="2c5ee-104">Normalmente, os serviços são aplicativos de console projetados para execução autônoma sem uma GUI (interface gráfica do usuário).</span><span class="sxs-lookup"><span data-stu-id="2c5ee-104">Typically, services are console applications that are designed to run unattended without a graphical user interface (GUI).</span></span> <span data-ttu-id="2c5ee-105">No entanto, alguns serviços podem exigir interação ocasional com um usuário.</span><span class="sxs-lookup"><span data-stu-id="2c5ee-105">However, some services may require occasional interaction with a user.</span></span> <span data-ttu-id="2c5ee-106">Esta página discute as melhores maneiras de interagir com o usuário a partir de um serviço.</span><span class="sxs-lookup"><span data-stu-id="2c5ee-106">This page discusses the best ways to interact with the user from a service.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="2c5ee-107">Os serviços não podem interagir diretamente com um usuário a partir do Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="2c5ee-107">Services cannot directly interact with a user as of Windows Vista.</span></span> <span data-ttu-id="2c5ee-108">Portanto, as técnicas mencionadas na seção intitulada usando um serviço interativo não devem ser usadas no novo código.</span><span class="sxs-lookup"><span data-stu-id="2c5ee-108">Therefore, the techniques mentioned in the section titled Using an Interactive Service should not be used in new code.</span></span>

 

## <a name="interacting-with-a-user-from-a-service-indirectly"></a><span data-ttu-id="2c5ee-109">Interagindo indiretamente com um usuário de um serviço</span><span class="sxs-lookup"><span data-stu-id="2c5ee-109">Interacting with a User from a Service Indirectly</span></span>

<span data-ttu-id="2c5ee-110">Você pode usar as seguintes técnicas para interagir com o usuário de um serviço em todas as versões com suporte do Windows:</span><span class="sxs-lookup"><span data-stu-id="2c5ee-110">You can use the following techniques to interact with the user from a service on all supported versions of Windows:</span></span>

-   <span data-ttu-id="2c5ee-111">Exiba uma caixa de diálogo na sessão do usuário usando a função [**WTSSendMessage**](/windows/desktop/api/wtsapi32/nf-wtsapi32-wtssendmessagea) .</span><span class="sxs-lookup"><span data-stu-id="2c5ee-111">Display a dialog box in the user's session using the [**WTSSendMessage**](/windows/desktop/api/wtsapi32/nf-wtsapi32-wtssendmessagea) function.</span></span>
-   <span data-ttu-id="2c5ee-112">Crie um aplicativo de GUI oculto separado e use a função [**CreateProcessAsUser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) para executar o aplicativo no contexto do usuário interativo.</span><span class="sxs-lookup"><span data-stu-id="2c5ee-112">Create a separate hidden GUI application and use the [**CreateProcessAsUser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) function to run the application within the context of the interactive user.</span></span> <span data-ttu-id="2c5ee-113">Projete o aplicativo de GUI para se comunicar com o serviço por meio de algum método de comunicação entre processos (IPC), por exemplo, pipes nomeados.</span><span class="sxs-lookup"><span data-stu-id="2c5ee-113">Design the GUI application to communicate with the service through some method of interprocess communication (IPC), for example, named pipes.</span></span> <span data-ttu-id="2c5ee-114">O serviço se comunica com o aplicativo de GUI para informar quando exibir a GUI.</span><span class="sxs-lookup"><span data-stu-id="2c5ee-114">The service communicates with the GUI application to tell it when to display the GUI.</span></span> <span data-ttu-id="2c5ee-115">O aplicativo comunica os resultados da interação do usuário de volta para o serviço para que o serviço possa executar a ação apropriada.</span><span class="sxs-lookup"><span data-stu-id="2c5ee-115">The application communicates the results of the user interaction back to the service so that the service can take the appropriate action.</span></span> <span data-ttu-id="2c5ee-116">Observe que o IPC pode expor suas interfaces de serviço pela rede, a menos que você use uma ACL (lista de controle de acesso) apropriada.</span><span class="sxs-lookup"><span data-stu-id="2c5ee-116">Note that IPC can expose your service interfaces over the network unless you use an appropriate access control list (ACL).</span></span>

    <span data-ttu-id="2c5ee-117">Se esse serviço for executado em um sistema multiusuário, adicione o aplicativo à chave a seguir para que ele seja executado em cada sessão: **HKEY \_ local \_ Machine \\ software \\ Microsoft \\ Windows \\ CurrentVersion \\ Execute**.</span><span class="sxs-lookup"><span data-stu-id="2c5ee-117">If this service runs on a multiuser system, add the application to the following key so that it is run in each session: **HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run**.</span></span> <span data-ttu-id="2c5ee-118">Se o aplicativo usar pipes nomeados para IPC, o servidor poderá distinguir entre vários processos de usuário, fornecendo a cada pipe um nome exclusivo com base na ID da sessão.</span><span class="sxs-lookup"><span data-stu-id="2c5ee-118">If the application uses named pipes for IPC, the server can distinguish between multiple user processes by giving each pipe a unique name based on the session ID.</span></span>

<span data-ttu-id="2c5ee-119">A técnica a seguir também está disponível para o Windows Server 2003 e o Windows XP:</span><span class="sxs-lookup"><span data-stu-id="2c5ee-119">The following technique is also available for Windows Server 2003 and Windows XP:</span></span>

-   <span data-ttu-id="2c5ee-120">Exiba uma caixa de mensagem chamando a função [**MessageBox**](/windows/win32/api/winuser/nf-winuser-messagebox) com **a \_ \_ notificação de serviço MB**.</span><span class="sxs-lookup"><span data-stu-id="2c5ee-120">Display a message box by calling the [**MessageBox**](/windows/win32/api/winuser/nf-winuser-messagebox) function with **MB\_SERVICE\_NOTIFICATION**.</span></span> <span data-ttu-id="2c5ee-121">Isso é recomendado para exibir mensagens de status simples.</span><span class="sxs-lookup"><span data-stu-id="2c5ee-121">This is recommended for displaying simple status messages.</span></span> <span data-ttu-id="2c5ee-122">Não chame **MessageBox** durante a inicialização do serviço ou da rotina [**HandlerEx**](/windows/desktop/api/WinSvc/nc-winsvc-lphandler_function_ex) , a menos que você chame-o de um thread separado, para que você retorne ao SCM em tempo hábil.</span><span class="sxs-lookup"><span data-stu-id="2c5ee-122">Do not call **MessageBox** during service initialization or from the [**HandlerEx**](/windows/desktop/api/WinSvc/nc-winsvc-lphandler_function_ex) routine, unless you call it from a separate thread, so that you return to the SCM in a timely manner.</span></span>

## <a name="using-an-interactive-service"></a><span data-ttu-id="2c5ee-123">Usando um serviço interativo</span><span class="sxs-lookup"><span data-stu-id="2c5ee-123">Using an Interactive Service</span></span>

<span data-ttu-id="2c5ee-124">Por padrão, os serviços usam uma [estação de janela](/windows/desktop/winstation/window-stations) não interativa e não podem interagir com o usuário.</span><span class="sxs-lookup"><span data-stu-id="2c5ee-124">By default, services use a noninteractive [window station](/windows/desktop/winstation/window-stations) and cannot interact with the user.</span></span> <span data-ttu-id="2c5ee-125">No entanto, um *serviço interativo* pode exibir uma interface do usuário e receber a entrada do usuário.</span><span class="sxs-lookup"><span data-stu-id="2c5ee-125">However, an *interactive service* can display a user interface and receive user input.</span></span>

> [!Caution]  
> <span data-ttu-id="2c5ee-126">Os serviços em execução em um contexto de segurança elevado, como a conta LocalSystem, não devem criar uma janela na área de trabalho interativa porque qualquer outro aplicativo em execução na área de trabalho interativa pode interagir com essa janela.</span><span class="sxs-lookup"><span data-stu-id="2c5ee-126">Services running in an elevated security context, such as the LocalSystem account, should not create a window on the interactive desktop because any other application that is running on the interactive desktop can interact with this window.</span></span> <span data-ttu-id="2c5ee-127">Isso expõe o serviço a qualquer aplicativo executado por um usuário conectado.</span><span class="sxs-lookup"><span data-stu-id="2c5ee-127">This exposes the service to any application that a logged-on user executes.</span></span> <span data-ttu-id="2c5ee-128">Além disso, os serviços que estão em execução como LocalSystem não devem acessar a área de trabalho interativa chamando a função [**OpenWindowStation**](/windows/desktop/api/winuser/nf-winuser-openwindowstationa) ou [**GetThreadDesktop**](/windows/desktop/api/winuser/nf-winuser-getthreaddesktop) .</span><span class="sxs-lookup"><span data-stu-id="2c5ee-128">Also, services that are running as LocalSystem should not access the interactive desktop by calling the [**OpenWindowStation**](/windows/desktop/api/winuser/nf-winuser-openwindowstationa) or [**GetThreadDesktop**](/windows/desktop/api/winuser/nf-winuser-getthreaddesktop) function.</span></span>

 

<span data-ttu-id="2c5ee-129">Para criar um serviço interativo, faça o seguinte ao chamar a função [**CreateService**](/windows/desktop/api/Winsvc/nf-winsvc-createservicea) :</span><span class="sxs-lookup"><span data-stu-id="2c5ee-129">To create an interactive service, do the following when calling the [**CreateService**](/windows/desktop/api/Winsvc/nf-winsvc-createservicea) function:</span></span>

1.  <span data-ttu-id="2c5ee-130">Especifique NULL para o parâmetro *lpServiceStartName* executar o serviço no contexto da [conta LocalSystem](localsystem-account.md).</span><span class="sxs-lookup"><span data-stu-id="2c5ee-130">Specify NULL for the *lpServiceStartName* parameter to run the service in the context of the [LocalSystem account](localsystem-account.md).</span></span>
2.  <span data-ttu-id="2c5ee-131">Especifique o sinalizador de **\_ \_ processo interativo do serviço** .</span><span class="sxs-lookup"><span data-stu-id="2c5ee-131">Specify the **SERVICE\_INTERACTIVE\_PROCESS** flag.</span></span>

<span data-ttu-id="2c5ee-132">Para determinar se um serviço está sendo executado como um serviço interativo, chame a função [**GetProcessWindowStation**](/windows/desktop/api/winuser/nf-winuser-getprocesswindowstation) para recuperar um identificador para a estação de janela e a função [**GetUserObjectInformation**](/windows/desktop/api/winuser/nf-winuser-getuserobjectinformationa) para testar se a estação de janela tem o atributo **wsf \_ visível** .</span><span class="sxs-lookup"><span data-stu-id="2c5ee-132">To determine whether a service is running as an interactive service, call the [**GetProcessWindowStation**](/windows/desktop/api/winuser/nf-winuser-getprocesswindowstation) function to retrieve a handle to the window station, and the [**GetUserObjectInformation**](/windows/desktop/api/winuser/nf-winuser-getuserobjectinformationa) function to test whether the window station has the **WSF\_VISIBLE** attribute.</span></span>

<span data-ttu-id="2c5ee-133">No entanto, observe que a seguinte chave do registro contém um valor, **Nointeractiveservices**, que controla o efeito do \_ processo interativo do serviço \_ :</span><span class="sxs-lookup"><span data-stu-id="2c5ee-133">However, note that the following registry key contains a value, **NoInteractiveServices**, that controls the effect of SERVICE\_INTERACTIVE\_PROCESS:</span></span>

<span data-ttu-id="2c5ee-134">**HKEY \_ local \_ Machine \\ sistema \\ CurrentControlSet \\ Control \\ Windows**</span><span class="sxs-lookup"><span data-stu-id="2c5ee-134">**HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Windows**</span></span>

<span data-ttu-id="2c5ee-135">O valor de **Nointeractiveservices** usa como padrão 1, o que significa que nenhum serviço tem permissão para ser executado interativamente, independentemente de ele ter um **\_ \_ processo de serviço interativo**.</span><span class="sxs-lookup"><span data-stu-id="2c5ee-135">The **NoInteractiveServices** value defaults to 1, which means that no service is allowed to run interactively, regardless of whether it has **SERVICE\_INTERACTIVE\_PROCESS**.</span></span> <span data-ttu-id="2c5ee-136">Quando **Nointeractiveservices** é definido como 0, os serviços com **\_ \_ processo interativo de serviço** têm permissão para serem executados interativamente.</span><span class="sxs-lookup"><span data-stu-id="2c5ee-136">When **NoInteractiveServices** is set to a 0, services with **SERVICE\_INTERACTIVE\_PROCESS** are allowed to run interactively.</span></span>

<span data-ttu-id="2c5ee-137">**Windows 7, Windows server 2008 R2, Windows XP e Windows server 2003:** O valor de **Nointeractiveservices** usa como padrão 0, o que significa que os serviços com **\_ \_ processo interativo de serviço** têm permissão para serem executados interativamente.</span><span class="sxs-lookup"><span data-stu-id="2c5ee-137">**Windows 7, Windows Server 2008 R2, Windows XP and Windows Server 2003:** The **NoInteractiveServices** value defaults to 0, which means that services with **SERVICE\_INTERACTIVE\_PROCESS** are allowed to run interactively.</span></span> <span data-ttu-id="2c5ee-138">Quando **Nointeractiveservices** é definido como um valor diferente de zero, nenhum serviço iniciado depois tem permissão para ser executado interativamente, independentemente de ele ter um **\_ \_ processo de serviço interativo**.</span><span class="sxs-lookup"><span data-stu-id="2c5ee-138">When **NoInteractiveServices** is set to a nonzero value, no service started thereafter is allowed to run interactively, regardless of whether it has **SERVICE\_INTERACTIVE\_PROCESS**.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="2c5ee-139">Todos os serviços são executados na sessão 0 dos serviços de terminal.</span><span class="sxs-lookup"><span data-stu-id="2c5ee-139">All services run in Terminal Services session 0.</span></span> <span data-ttu-id="2c5ee-140">Portanto, se um serviço interativo exibir uma interface do usuário, ele ficará visível somente para o usuário que se conectou à sessão 0.</span><span class="sxs-lookup"><span data-stu-id="2c5ee-140">Therefore, if an interactive service displays a user interface, it is visible only to the user who connected to session 0.</span></span> <span data-ttu-id="2c5ee-141">Como não há nenhuma maneira de garantir que o usuário interativo esteja conectado à sessão 0, não configure um serviço para ser executado como um serviço interativo em serviços de terminal ou em um sistema que dê suporte à troca rápida de usuário (a troca rápida de usuário é implementada usando os serviços de terminal).</span><span class="sxs-lookup"><span data-stu-id="2c5ee-141">Because there is no way to guarantee that the interactive user is connected to session 0, do not configure a service to run as an interactive service under Terminal Services or on a system that supports fast user switching (fast user switching is implemented using Terminal Services).</span></span>

 

 

 
