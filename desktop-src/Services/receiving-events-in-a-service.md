---
description: Um serviço que é um aplicativo de console pode registrar um manipulador de controle de console para receber notificações quando um usuário fizer logoff.
ms.assetid: 86ace8b8-c1cb-4646-bc92-86bd578a82c5
title: Recebendo eventos em um serviço
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b95f7329383ffc8aea08102a2fe8cf8b49e0ef9d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "104506203"
---
# <a name="receiving-events-in-a-service"></a><span data-ttu-id="3edbb-103">Recebendo eventos em um serviço</span><span class="sxs-lookup"><span data-stu-id="3edbb-103">Receiving Events in a Service</span></span>

<span data-ttu-id="3edbb-104">Um serviço que é um aplicativo de console pode registrar um [manipulador de controle de console](/windows/console/console-control-handlers) para receber notificações quando um usuário fizer logoff.</span><span class="sxs-lookup"><span data-stu-id="3edbb-104">A service that is a console application can register a [console control handler](/windows/console/console-control-handlers) to receive notification when a user logs off.</span></span> <span data-ttu-id="3edbb-105">No entanto, não há nenhum evento de console enviado quando um usuário interativo faz logon.</span><span class="sxs-lookup"><span data-stu-id="3edbb-105">However, there is no console event sent when an interactive user logs on.</span></span> <span data-ttu-id="3edbb-106">Para obter informações sobre como receber notificações quando um usuário faz logon, consulte [criando um pacote de notificação do Winlogon](/windows/desktop/SecAuthN/creating-a-winlogon-notification-package).</span><span class="sxs-lookup"><span data-stu-id="3edbb-106">For information on receiving notification when a user logs on, see [Creating a Winlogon Notification Package](/windows/desktop/SecAuthN/creating-a-winlogon-notification-package).</span></span>

<span data-ttu-id="3edbb-107">O sistema transmite eventos de alteração do dispositivo para todos os serviços.</span><span class="sxs-lookup"><span data-stu-id="3edbb-107">The system broadcasts device change events to all services.</span></span> <span data-ttu-id="3edbb-108">Esses eventos podem ser recebidos por um serviço em um procedimento de janela ou em seu manipulador de controle de serviço.</span><span class="sxs-lookup"><span data-stu-id="3edbb-108">These events can be received by a service in a window procedure or in its service control handler.</span></span> <span data-ttu-id="3edbb-109">Para especificar quais eventos seu serviço deve receber, use a função [**RegisterDeviceNotification**](/windows/desktop/api/winuser/nf-winuser-registerdevicenotificationa) .</span><span class="sxs-lookup"><span data-stu-id="3edbb-109">To specify which events your service should receive, use the [**RegisterDeviceNotification**](/windows/desktop/api/winuser/nf-winuser-registerdevicenotificationa) function.</span></span>

<span data-ttu-id="3edbb-110">Certifique-se de manipular Plug and Play eventos de dispositivo o mais rápido possível.</span><span class="sxs-lookup"><span data-stu-id="3edbb-110">Be sure to handle Plug and Play device events as quickly as possible.</span></span> <span data-ttu-id="3edbb-111">Caso contrário, o sistema pode deixar de responder.</span><span class="sxs-lookup"><span data-stu-id="3edbb-111">Otherwise, the system may become unresponsive.</span></span> <span data-ttu-id="3edbb-112">Se o manipulador de eventos for executar uma operação que possa bloquear a execução (como e/s), é melhor iniciar outro thread para executar a operação de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="3edbb-112">If your event handler is to perform an operation that may block execution (such as I/O), it is best to start another thread to perform the operation asynchronously.</span></span>

<span data-ttu-id="3edbb-113">Quando um serviço chama [**RegisterDeviceNotification**](/windows/desktop/api/winuser/nf-winuser-registerdevicenotificationa), o serviço também especifica um identificador de janela ou um identificador de status de serviço.</span><span class="sxs-lookup"><span data-stu-id="3edbb-113">When a service calls [**RegisterDeviceNotification**](/windows/desktop/api/winuser/nf-winuser-registerdevicenotificationa), the service also specifies either a window handle or a service status handle.</span></span> <span data-ttu-id="3edbb-114">Se um serviço especificar um identificador de janela, o procedimento de janela receberá os eventos de notificação.</span><span class="sxs-lookup"><span data-stu-id="3edbb-114">If a service specifies a window handle, the window procedure receives the notification events.</span></span> <span data-ttu-id="3edbb-115">Se um serviço especificar seu identificador de status de serviço, seu manipulador de controle de serviço receberá os eventos de notificação.</span><span class="sxs-lookup"><span data-stu-id="3edbb-115">If a service specifies its service status handle, its service control handler receives the notification events.</span></span> <span data-ttu-id="3edbb-116">Para obter mais informações, consulte [**HandlerEx**](/windows/desktop/api/WinSvc/nc-winsvc-lphandler_function_ex).</span><span class="sxs-lookup"><span data-stu-id="3edbb-116">For more information, see [**HandlerEx**](/windows/desktop/api/WinSvc/nc-winsvc-lphandler_function_ex).</span></span>

<span data-ttu-id="3edbb-117">Os identificadores de notificação de dispositivo retornados por [**RegisterDeviceNotification**](/windows/desktop/api/winuser/nf-winuser-registerdevicenotificationa) devem ser fechados chamando a função [**UnregisterDeviceNotification**](/windows/desktop/api/winuser/nf-winuser-unregisterdevicenotification) quando não forem mais necessários.</span><span class="sxs-lookup"><span data-stu-id="3edbb-117">Device notification handles returned by [**RegisterDeviceNotification**](/windows/desktop/api/winuser/nf-winuser-registerdevicenotificationa) must be closed by calling the [**UnregisterDeviceNotification**](/windows/desktop/api/winuser/nf-winuser-unregisterdevicenotification) function when they are no longer needed.</span></span>

 

 
