---
description: Os gravadores de aplicativo podem fazer alterações de código-fonte secundárias para adicionar operações de registro e arquivo transacionado usando o KTM (kernel Transaction Manager).
ms.assetid: 356c66dc-5ddd-472f-835c-2e2cb019bcfd
title: Trabalhando com transações
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 255e40fb38ca4bfb24acdce717f133dbcf0c76f7
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "103828716"
---
# <a name="working-with-transactions"></a><span data-ttu-id="f33f2-103">Trabalhando com transações</span><span class="sxs-lookup"><span data-stu-id="f33f2-103">Working With Transactions</span></span>

<span data-ttu-id="f33f2-104">Os gravadores de aplicativo podem fazer alterações de código-fonte secundárias para adicionar operações de registro e arquivo transacionado usando o KTM (kernel Transaction Manager).</span><span class="sxs-lookup"><span data-stu-id="f33f2-104">Application writers can make minor source code changes to add transacted file and registry operations using the Kernel Transaction Manager (KTM).</span></span> <span data-ttu-id="f33f2-105">Normalmente, isso envolverá a criação de uma transação e a passagem do identificador para outras funções fornecidas por recursos transacionais, como [NTFS Transacional](/windows/desktop/FileIO/transactional-ntfs-portal) e o registro transacionado.</span><span class="sxs-lookup"><span data-stu-id="f33f2-105">Typically, this will involve creating a transaction and passing the handle to other functions provided by transactional resources such as [Transactional NTFS](/windows/desktop/FileIO/transactional-ntfs-portal) and the Transacted Registry.</span></span>

<span data-ttu-id="f33f2-106">O KTM fornece mecanismos para que seu aplicativo participe de transações, bem como para escrever seu próprio Gerenciador de recursos transacionais.</span><span class="sxs-lookup"><span data-stu-id="f33f2-106">KTM provides mechanisms for your application to participate in transactions as well as to write your own transactional resource manager.</span></span> <span data-ttu-id="f33f2-107">Há funções que permitem criar, gerenciar e trabalhar com quatro classes de objetos kernel: transações, gerenciadores de transações, gerenciadores de recursos e inlistagens.</span><span class="sxs-lookup"><span data-stu-id="f33f2-107">There are functions that allow you to create, manage, and work with four classes of kernel objects: transactions, transaction managers, resource managers, and enlistments.</span></span> <span data-ttu-id="f33f2-108">Se você estiver simplesmente usando transações, só precisará trabalhar com objetos de transação e usar estas funções:</span><span class="sxs-lookup"><span data-stu-id="f33f2-108">If you are simply using transactions, you only need to work with transaction objects and use these functions:</span></span>

-   [<span data-ttu-id="f33f2-109">**CreateTransaction**</span><span class="sxs-lookup"><span data-stu-id="f33f2-109">**CreateTransaction**</span></span>](/windows/desktop/api/KtmW32/nf-ktmw32-createtransaction)
-   [<span data-ttu-id="f33f2-110">**CommitTransaction**</span><span class="sxs-lookup"><span data-stu-id="f33f2-110">**CommitTransaction**</span></span>](/windows/desktop/api/Ktmw32/nf-ktmw32-committransaction)
-   [<span data-ttu-id="f33f2-111">**RollbackTransaction**</span><span class="sxs-lookup"><span data-stu-id="f33f2-111">**RollbackTransaction**</span></span>](/windows/desktop/api/Ktmw32/nf-ktmw32-rollbacktransaction)

<span data-ttu-id="f33f2-112">Nunca presuma que uma transação está ativa.</span><span class="sxs-lookup"><span data-stu-id="f33f2-112">Never assume a transaction is active.</span></span> <span data-ttu-id="f33f2-113">As transações podem ser revertidas por vários motivos e a qualquer momento.</span><span class="sxs-lookup"><span data-stu-id="f33f2-113">Transactions can be rolled back for many reasons and at any time.</span></span>

<span data-ttu-id="f33f2-114">O Windows expõe uma interface baseada em identificadores para recursos do sistema.</span><span class="sxs-lookup"><span data-stu-id="f33f2-114">Windows exposes a handle-based interface to system resources.</span></span> <span data-ttu-id="f33f2-115">Para trabalhar com um objeto do sistema operacional, o aplicativo primeiro solicita um identificador para o objeto e, em seguida, usa esse identificador em chamadas de função subsequentes para acessar ou modificar o objeto.</span><span class="sxs-lookup"><span data-stu-id="f33f2-115">To work with an operating system object, the application first requests a handle to the object, and then uses this handle in subsequent function calls to access or modify the object.</span></span> <span data-ttu-id="f33f2-116">Um identificador geralmente pode ser aberto em modos diferentes; o modo especificado afeta a semântica das chamadas de função subsequentes.</span><span class="sxs-lookup"><span data-stu-id="f33f2-116">A handle can usually be opened in different modes; the mode specified affects the semantics of subsequent function calls.</span></span> <span data-ttu-id="f33f2-117">Por exemplo, um identificador de arquivo que é aberto por uma chamada para [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) com o sinalizador *DwDesiredAccess* definido como **generic \_ Read** não pode ser usado em chamadas que modificam o arquivo.</span><span class="sxs-lookup"><span data-stu-id="f33f2-117">For example, a file handle that is opened by a call to [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) with the *dwDesiredAccess* flag set to **GENERIC\_READ** cannot be used in calls that modify the file.</span></span>

<span data-ttu-id="f33f2-118">Você pode coordenar com [Coordenador de transações distribuídas](/previous-versions/windows/desktop/ms684146(v=vs.85)) recursos de modo de usuário, como SQL ou MSMQ, e com recursos de modo kernel que usam o KTM.</span><span class="sxs-lookup"><span data-stu-id="f33f2-118">You can coordinate with [Distributed Transaction Coordinator](/previous-versions/windows/desktop/ms684146(v=vs.85)) user-mode resources such as SQL or MSMQ, and with kernel-mode resources that use the KTM.</span></span> <span data-ttu-id="f33f2-119">Primeiro, crie uma transação do DTC ou um objeto [**System. Transactions**](/dotnet/api/system.transactions?view=dotnet-plat-ext-3.1) e, em seguida, chame o objeto [**IKernelTransaction**](/previous-versions/windows/desktop/aa344210(v=vs.85)) , do qual você pode obter o identificador de KTM.</span><span class="sxs-lookup"><span data-stu-id="f33f2-119">First, create a DTC transaction, or a [**System.Transactions**](/dotnet/api/system.transactions?view=dotnet-plat-ext-3.1) object, then call the [**IKernelTransaction**](/previous-versions/windows/desktop/aa344210(v=vs.85)) object, from which you can obtain the KTM handle.</span></span> <span data-ttu-id="f33f2-120">O objeto **IKernelTransaction** cria uma transação de KTM que é subordinada à transação do DTC.</span><span class="sxs-lookup"><span data-stu-id="f33f2-120">The **IKernelTransaction** object creates a KTM transaction that is subordinate to the DTC transaction.</span></span> <span data-ttu-id="f33f2-121">Com esse identificador, você pode criar seus objetos transacionados, mas sinalizar o resultado da transação usando DTC ou **System. Transactions**.</span><span class="sxs-lookup"><span data-stu-id="f33f2-121">With this handle, you can create your transacted objects, but signal the outcome of the transaction using DTC or **System.Transactions**.</span></span>

 

 
