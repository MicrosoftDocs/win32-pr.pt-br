---
description: Um provedor de eventos é um objeto COM que fornece ao WMI notificações de eventos intrínsecos e extrínsecos.
ms.assetid: 075bdc65-4ea3-4f91-9823-1d2d0dc13423
ms.tgt_platform: multiple
title: Escrevendo um provedor de eventos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bb118d89f214e9fc651c1c9d93abfcfe43f49fc7
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105812060"
---
# <a name="writing-an-event-provider"></a><span data-ttu-id="2362c-103">Escrevendo um provedor de eventos</span><span class="sxs-lookup"><span data-stu-id="2362c-103">Writing an Event Provider</span></span>

<span data-ttu-id="2362c-104">Um provedor de eventos é um objeto COM que fornece ao WMI notificações de eventos intrínsecos e extrínsecos.</span><span class="sxs-lookup"><span data-stu-id="2362c-104">An event provider is a COM object that supplies WMI with notifications of intrinsic and extrinsic events.</span></span> <span data-ttu-id="2362c-105">Um evento intrínseco relata uma alteração de dados interna ao WMI, enquanto um evento extrínsecos relata um evento definido pelo usuário não descrito por um evento intrínseco.</span><span class="sxs-lookup"><span data-stu-id="2362c-105">An intrinsic event reports an internal data change to WMI, while an extrinsic event reports a user-defined event not described by an intrinsic event.</span></span> <span data-ttu-id="2362c-106">Por exemplo, um evento em resposta a alterações, criação ou exclusão da classe do [**disco \_ lógico do Win32**](/windows/desktop/CIMWin32Prov/win32-logicaldisk) seria classificado como um evento intrínseco.</span><span class="sxs-lookup"><span data-stu-id="2362c-106">For example, an event in response to changes, creation, or deletion of the [**Win32\_LogicalDisk**](/windows/desktop/CIMWin32Prov/win32-logicaldisk) class would classify as an intrinsic event.</span></span> <span data-ttu-id="2362c-107">Um evento que é gerado com base em algo diferente da modificação, criação ou exclusão de um objeto WMI existente é um evento extrínsecos.</span><span class="sxs-lookup"><span data-stu-id="2362c-107">An event that is generated on the basis of something other than the modification, creation, or deletion of an existing WMI object is an extrinsic event.</span></span> <span data-ttu-id="2362c-108">Independentemente da classe com suporte, você pode implementar todos os provedores de eventos da mesma maneira.</span><span class="sxs-lookup"><span data-stu-id="2362c-108">Regardless of the supported class, you can implement all event providers in the same manner.</span></span>

<span data-ttu-id="2362c-109">O procedimento a seguir descreve como implementar um provedor de eventos.</span><span class="sxs-lookup"><span data-stu-id="2362c-109">The following procedure describes how to implement an event provider.</span></span>

<span data-ttu-id="2362c-110">**Para implementar um provedor de eventos**</span><span class="sxs-lookup"><span data-stu-id="2362c-110">**To implement an event provider**</span></span>

1.  <span data-ttu-id="2362c-111">Projete e Registre seu provedor de classes com o WMI.</span><span class="sxs-lookup"><span data-stu-id="2362c-111">Design and register your class provider with WMI.</span></span>

    <span data-ttu-id="2362c-112">Provedores de classe se registram com WMI criando uma instância do [**\_ \_ Win32Provider**](--win32provider.md) e uma classe [**\_ \_ EventProviderRegistration**](--eventproviderregistration.md) .</span><span class="sxs-lookup"><span data-stu-id="2362c-112">Class providers register with WMI by creating a [**\_\_Win32Provider**](--win32provider.md) instance and an [**\_\_EventProviderRegistration**](--eventproviderregistration.md) class.</span></span> <span data-ttu-id="2362c-113">Para obter mais informações, consulte [registrando um provedor de eventos](registering-an-event-provider.md).</span><span class="sxs-lookup"><span data-stu-id="2362c-113">For more information, see [Registering an Event Provider](registering-an-event-provider.md).</span></span>

2.  <span data-ttu-id="2362c-114">Implemente a interface [**IWbemProviderInit**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemproviderinit) para seu provedor.</span><span class="sxs-lookup"><span data-stu-id="2362c-114">Implement the [**IWbemProviderInit**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemproviderinit) interface for your provider.</span></span>

    <span data-ttu-id="2362c-115">A interface [**IWbemProviderInit**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemproviderinit) é usada por um WMI de interface comum para carregar e inicializar todos os provedores.</span><span class="sxs-lookup"><span data-stu-id="2362c-115">The [**IWbemProviderInit**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemproviderinit) interface is a common interface WMI uses to load and initialize all providers.</span></span> <span data-ttu-id="2362c-116">Para obter mais informações, consulte [inicializando um provedor](initializing-a-provider.md).</span><span class="sxs-lookup"><span data-stu-id="2362c-116">For more information, see [Initializing a Provider](initializing-a-provider.md).</span></span>

3.  <span data-ttu-id="2362c-117">Implemente o [**IWbemEventProvider**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovider) como a interface principal para seu provedor.</span><span class="sxs-lookup"><span data-stu-id="2362c-117">Implement the [**IWbemEventProvider**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovider) as the primary interface for your provider.</span></span>

    <span data-ttu-id="2362c-118">A interface [**IWbemEventProvider**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovider) usa o método **ProviderEvents** para fornecer eventos ao WMI.</span><span class="sxs-lookup"><span data-stu-id="2362c-118">The [**IWbemEventProvider**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovider) interface uses the **ProviderEvents** method to supply events to WMI.</span></span> <span data-ttu-id="2362c-119">Para obter mais informações, consulte [implementando a interface primária para um provedor de eventos](implementing-the-primary-interface-for-an-event-provider.md).</span><span class="sxs-lookup"><span data-stu-id="2362c-119">For more information, see [Implementing the Primary Interface for an Event Provider](implementing-the-primary-interface-for-an-event-provider.md).</span></span>

    > [!Note]  
    > <span data-ttu-id="2362c-120">Os provedores de eventos devem usar o modelo multi-threaded "both".</span><span class="sxs-lookup"><span data-stu-id="2362c-120">Event providers must use the multithreading model "Both".</span></span>

     

4.  <span data-ttu-id="2362c-121">Opcionalmente, você também pode implementar a interface [**IWbemEventProviderQuerySink**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventproviderquerysink) para aumentar o desempenho do seu provedor de eventos.</span><span class="sxs-lookup"><span data-stu-id="2362c-121">Optionally, you may also implement the [**IWbemEventProviderQuerySink**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventproviderquerysink) interface to increase the performance of your event provider.</span></span>

    <span data-ttu-id="2362c-122">A interface [**IWbemEventProviderQuerySink**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventproviderquerysink) permite que o provedor Otimize consultas antes de enviar uma resposta para o WMI e é mais útil para um provedor que fornece eventos de vários tipos e que precisa executar o máximo possível de otimizações internas.</span><span class="sxs-lookup"><span data-stu-id="2362c-122">The [**IWbemEventProviderQuerySink**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventproviderquerysink) interface allows the provider to optimize queries before sending a response to WMI, and is most useful for a provider that supplies events of multiple types and that needs to perform as many internal optimizations as possible.</span></span> <span data-ttu-id="2362c-123">Para obter mais informações, consulte [Otimizando um provedor de eventos](optimizing-an-event-provider.md).</span><span class="sxs-lookup"><span data-stu-id="2362c-123">For more information, see [Optimizing an Event Provider](optimizing-an-event-provider.md).</span></span>

5.  <span data-ttu-id="2362c-124">Implemente a interface [**IWbemEventProviderSecurity**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovidersecurity) para limitar os consumidores a determinados identificadores de segurança (SIDs) ou implemente [**IWbemEventSink:: SetSinkSecurity**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventsink-setsinksecurity) para proteger o próprio coletor.</span><span class="sxs-lookup"><span data-stu-id="2362c-124">Implement the [**IWbemEventProviderSecurity**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovidersecurity) interface to limit consumers to certain security identifiers (SIDs) or implement [**IWbemEventSink::SetSinkSecurity**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventsink-setsinksecurity) to secure the sink itself.</span></span> <span data-ttu-id="2362c-125">O provedor também pode definir a **propriedade \_ descritor de segurança** na classe de evento para proteger eventos individuais no código MOF.</span><span class="sxs-lookup"><span data-stu-id="2362c-125">The provider can also set the **SECURITY\_DESCRIPTOR** property in the event class to secure individual events in the MOF code.</span></span> <span data-ttu-id="2362c-126">Para obter mais informações, consulte [SECURING WMI Events](securing-wmi-events.md).</span><span class="sxs-lookup"><span data-stu-id="2362c-126">For more information, see [Securing WMI Events](securing-wmi-events.md).</span></span>
6.  <span data-ttu-id="2362c-127">Adicione qualquer código adicional necessário para seu provedor.</span><span class="sxs-lookup"><span data-stu-id="2362c-127">Add any additional code necessary for your provider.</span></span>

    <span data-ttu-id="2362c-128">Ao projetar seu provedor, você provavelmente precisará chamar as interfaces WMI.</span><span class="sxs-lookup"><span data-stu-id="2362c-128">When designing your provider, you most likely need to call WMI interfaces.</span></span> <span data-ttu-id="2362c-129">Para obter mais informações, consulte [chamando um método](calling-a-method.md).</span><span class="sxs-lookup"><span data-stu-id="2362c-129">For more information, see [Calling a Method](calling-a-method.md).</span></span>

    <span data-ttu-id="2362c-130">Ao recuperar informações de um cliente, talvez seja necessário acessar os níveis de segurança para esse cliente.</span><span class="sxs-lookup"><span data-stu-id="2362c-130">When retrieving information for a client, you may need to access the security levels for that client.</span></span> <span data-ttu-id="2362c-131">Para obter mais informações, consulte [representando um cliente](impersonating-a-client.md).</span><span class="sxs-lookup"><span data-stu-id="2362c-131">For more information, see [Impersonating a Client](impersonating-a-client.md).</span></span>

7.  <span data-ttu-id="2362c-132">Substitua o provedor preexistente pelo seu novo código.</span><span class="sxs-lookup"><span data-stu-id="2362c-132">Replace the preexisting provider with your new code.</span></span>

    <span data-ttu-id="2362c-133">Você não precisará executar esta etapa se não tiver um provedor preexistente para copiar.</span><span class="sxs-lookup"><span data-stu-id="2362c-133">You do not need to perform this step if you do not have a preexisting provider to copy over.</span></span> <span data-ttu-id="2362c-134">Para obter mais informações, consulte [atualizando um provedor](updating-a-provider.md).</span><span class="sxs-lookup"><span data-stu-id="2362c-134">For more information, see [Updating a Provider](updating-a-provider.md).</span></span>

<span data-ttu-id="2362c-135">Um aplicativo cliente pode solicitar um evento registrando-se com o WMI como um consumidor de eventos.</span><span class="sxs-lookup"><span data-stu-id="2362c-135">A client application can request an event by registering itself with WMI as an event consumer.</span></span> <span data-ttu-id="2362c-136">Para obter mais informações, consulte [recebendo um evento WMI](receiving-a-wmi-event.md).</span><span class="sxs-lookup"><span data-stu-id="2362c-136">For more information, see [Receiving a WMI Event](receiving-a-wmi-event.md).</span></span>

 

 
