---
description: Talvez você queira escrever um aplicativo que possa reagir a eventos a qualquer momento.
ms.assetid: 475dca47-b1e5-4362-ab00-9ab9383e92f9
ms.tgt_platform: multiple
title: Recebendo eventos em todos os momentos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5559068e1e108c6f4185c31f8858a9e4169c50c9
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104296595"
---
# <a name="receiving-events-at-all-times"></a><span data-ttu-id="34eb2-103">Recebendo eventos em todos os momentos</span><span class="sxs-lookup"><span data-stu-id="34eb2-103">Receiving Events at All Times</span></span>

<span data-ttu-id="34eb2-104">Talvez você queira escrever um aplicativo que possa reagir a eventos a qualquer momento.</span><span class="sxs-lookup"><span data-stu-id="34eb2-104">You may want to write an application that can react to events at any time.</span></span> <span data-ttu-id="34eb2-105">Por exemplo, um administrador pode querer receber uma mensagem de email quando medidas de desempenho específicas são recusadas em servidores de rede.</span><span class="sxs-lookup"><span data-stu-id="34eb2-105">For example, an administrator may want to receive an email message when specific performance measures decline on network servers.</span></span> <span data-ttu-id="34eb2-106">Nesse caso, seu aplicativo deve ser executado o tempo todo.</span><span class="sxs-lookup"><span data-stu-id="34eb2-106">In this case, your application should run at all times.</span></span> <span data-ttu-id="34eb2-107">No entanto, a execução contínua de um aplicativo não é um uso eficiente dos recursos do sistema.</span><span class="sxs-lookup"><span data-stu-id="34eb2-107">However, running an application continuously is not an efficient use of system resources.</span></span> <span data-ttu-id="34eb2-108">Em vez disso, o WMI permite que você crie um consumidor de evento permanente.</span><span class="sxs-lookup"><span data-stu-id="34eb2-108">Instead, WMI allows you to create a permanent event consumer.</span></span> <span data-ttu-id="34eb2-109">Os consumidores de eventos permanentes devem atender aos requisitos de segurança especiais.</span><span class="sxs-lookup"><span data-stu-id="34eb2-109">Permanent event consumers must meet special security requirements.</span></span> <span data-ttu-id="34eb2-110">Para obter mais informações, consulte [SECURING WMI Events](securing-wmi-events.md).</span><span class="sxs-lookup"><span data-stu-id="34eb2-110">For more information, see [Securing WMI Events](securing-wmi-events.md).</span></span>

<span data-ttu-id="34eb2-111">Um consumidor de evento permanente recebe eventos até que seu registro seja explicitamente cancelado.</span><span class="sxs-lookup"><span data-stu-id="34eb2-111">A permanent event consumer receives events until its registration is explicitly canceled.</span></span>

<span data-ttu-id="34eb2-112">Um consumidor de evento permanente é uma combinação das seguintes classes, filtros e objetos COM do WMI que residem em seu sistema:</span><span class="sxs-lookup"><span data-stu-id="34eb2-112">A permanent event consumer is a combination of the following WMI classes, filters, and COM objects that reside on your system:</span></span>

-   <span data-ttu-id="34eb2-113">Um objeto COM chamado consumidor físico.</span><span class="sxs-lookup"><span data-stu-id="34eb2-113">A COM object called a physical consumer.</span></span> <span data-ttu-id="34eb2-114">O WMI fornece vários consumidores permanentes padrão.</span><span class="sxs-lookup"><span data-stu-id="34eb2-114">WMI supplies several standard permanent consumers.</span></span> <span data-ttu-id="34eb2-115">Por exemplo, o consumidor de evento de script ativo [executa um script quando ocorre um evento](running-a-script-based-on-an-event.md).</span><span class="sxs-lookup"><span data-stu-id="34eb2-115">For example, the Active Script Event consumer [runs a script when an event occurs](running-a-script-based-on-an-event.md).</span></span>
-   <span data-ttu-id="34eb2-116">Uma nova classe de consumidor permanente.</span><span class="sxs-lookup"><span data-stu-id="34eb2-116">A new permanent consumer class.</span></span>
-   <span data-ttu-id="34eb2-117">Uma instância da classe de consumidor permanente chamada de consumidor lógico.</span><span class="sxs-lookup"><span data-stu-id="34eb2-117">An instance of the permanent consumer class called a logical consumer.</span></span>
-   <span data-ttu-id="34eb2-118">Um filtro que contém a consulta de eventos.</span><span class="sxs-lookup"><span data-stu-id="34eb2-118">A filter that contains the query for events.</span></span>
-   <span data-ttu-id="34eb2-119">Uma ligação entre o consumidor e o filtro.</span><span class="sxs-lookup"><span data-stu-id="34eb2-119">A linkage between the consumer and the filter.</span></span>

<span data-ttu-id="34eb2-120">As propriedades de um consumidor de evento lógico especificam as ações a serem executadas quando notificado de um evento, mas não definem as consultas de evento com as quais elas estão associadas.</span><span class="sxs-lookup"><span data-stu-id="34eb2-120">The properties of a logical event consumer specify the actions to perform when notified of an event, but do not define the event queries with which they are associated.</span></span> <span data-ttu-id="34eb2-121">Quando sinalizado, o WMI carrega automaticamente o objeto COM que representa o consumidor de evento permanente na memória ativa.</span><span class="sxs-lookup"><span data-stu-id="34eb2-121">When signaled, WMI automatically loads the COM object that represents the permanent event consumer into active memory.</span></span> <span data-ttu-id="34eb2-122">Normalmente, isso ocorre durante a inicialização ou em resposta a um evento de disparo.</span><span class="sxs-lookup"><span data-stu-id="34eb2-122">Typically, this occurs during startup or in response to a triggering event.</span></span> <span data-ttu-id="34eb2-123">Depois de ser ativado, o consumidor de evento permanente atua como um consumidor de evento normal, mas permanece até ser especificamente descarregado pelo sistema operacional.</span><span class="sxs-lookup"><span data-stu-id="34eb2-123">After being activated, the permanent event consumer acts as a normal event consumer, but remains until specifically unloaded by the operating system.</span></span>

<span data-ttu-id="34eb2-124">Você pode escrever seu próprio consumidor de eventos permanentes ou usar as classes de [consumidor padrão](standard-consumer-classes.md)pré-instaladas do WMI, como [**ActiveScriptEventConsumer**](activescripteventconsumer.md).</span><span class="sxs-lookup"><span data-stu-id="34eb2-124">You can write your own permanent event consumer or use the WMI preinstalled [Standard Consumer Classes](standard-consumer-classes.md), such as [**ActiveScriptEventConsumer**](activescripteventconsumer.md).</span></span> <span data-ttu-id="34eb2-125">Para obter mais informações, consulte [classes de consumidor padrão](standard-consumer-classes.md), [monitorando e respondendo a eventos com consumidores padrão](monitoring-and-responding-to-events-with-standard-consumers.md)e [eventos de monitoramento](monitoring-events.md).</span><span class="sxs-lookup"><span data-stu-id="34eb2-125">For more information, see [Standard Consumer Classes](standard-consumer-classes.md), [Monitoring and Responding to Events with Standard Consumers](monitoring-and-responding-to-events-with-standard-consumers.md), and [Monitoring Events](monitoring-events.md).</span></span>

<span data-ttu-id="34eb2-126">O procedimento a seguir descreve como criar seu próprio consumidor de evento permanente.</span><span class="sxs-lookup"><span data-stu-id="34eb2-126">The following procedure describes how to create your own permanent event consumer.</span></span>

<span data-ttu-id="34eb2-127">**Para criar seu próprio consumidor de evento permanente**</span><span class="sxs-lookup"><span data-stu-id="34eb2-127">**To create your own permanent event consumer**</span></span>

1.  <span data-ttu-id="34eb2-128">Determine que tipo de eventos você deseja receber.</span><span class="sxs-lookup"><span data-stu-id="34eb2-128">Determine what kind of events you want to receive.</span></span>

    <span data-ttu-id="34eb2-129">O WMI dá suporte a eventos intrínsecos e extrínsecos.</span><span class="sxs-lookup"><span data-stu-id="34eb2-129">WMI supports intrinsic and extrinsic events.</span></span> <span data-ttu-id="34eb2-130">Um evento intrínseco é um evento predefinido pelo WMI, enquanto um evento extrínsecos é um evento definido por um provedor de terceiros.</span><span class="sxs-lookup"><span data-stu-id="34eb2-130">An intrinsic event is an event predefined by WMI, whereas an extrinsic event is an event defined by a third party provider.</span></span> <span data-ttu-id="34eb2-131">Para obter mais informações, consulte [determinando o tipo de evento a ser recebido](determining-the-type-of-event-to-receive.md).</span><span class="sxs-lookup"><span data-stu-id="34eb2-131">For more information, see [Determining the Type of Event to Receive](determining-the-type-of-event-to-receive.md).</span></span>

2.  <span data-ttu-id="34eb2-132">[Implemente um consumidor físico](implementing-a-physical-consumer.md).</span><span class="sxs-lookup"><span data-stu-id="34eb2-132">[Implement a physical consumer](implementing-a-physical-consumer.md).</span></span>

    <span data-ttu-id="34eb2-133">A principal diferença entre um aplicativo de gerenciamento e um [*consumidor físico*](gloss-p.md) é que um usuário carrega e descarrega um aplicativo de gerenciamento, enquanto o WMI carrega e descarrega um consumidor físico.</span><span class="sxs-lookup"><span data-stu-id="34eb2-133">The main difference between a management application and a [*physical consumer*](gloss-p.md) is that a user loads and unloads a management application, whereas WMI loads and unloads a physical consumer.</span></span> <span data-ttu-id="34eb2-134">A maior parte de sua codificação deve estar no consumidor físico.</span><span class="sxs-lookup"><span data-stu-id="34eb2-134">Most of your coding should be in the physical consumer.</span></span>

    > [!Note]  
    > <span data-ttu-id="34eb2-135">Esta etapa é primeiro no procedimento para facilitar a explicação.</span><span class="sxs-lookup"><span data-stu-id="34eb2-135">This step is first in the procedure for ease of explanation.</span></span> <span data-ttu-id="34eb2-136">Em termos de codificação, você deve realmente criar o consumidor físico por último.</span><span class="sxs-lookup"><span data-stu-id="34eb2-136">In terms of coding, you should actually create the physical consumer last.</span></span> <span data-ttu-id="34eb2-137">Dessa forma, você pode dispor seus parâmetros e a lógica para seu provedor de eventos permanentes antes de iniciar a codificação demorada.</span><span class="sxs-lookup"><span data-stu-id="34eb2-137">That way you can lay out your parameters and logic for your permanent event provider before you start lengthy coding.</span></span> <span data-ttu-id="34eb2-138">No entanto, não há nenhuma restrição contra a gravação do consumidor físico primeiro.</span><span class="sxs-lookup"><span data-stu-id="34eb2-138">However, there is no restriction against writing the physical consumer first.</span></span>

     

3.  <span data-ttu-id="34eb2-139">[Crie uma nova classe de consumidor descrevendo o consumidor físico](creating-a-new-permanent-event-consumer-class.md).</span><span class="sxs-lookup"><span data-stu-id="34eb2-139">[Create a new consumer class describing the physical consumer](creating-a-new-permanent-event-consumer-class.md).</span></span>

    <span data-ttu-id="34eb2-140">Como qualquer classe, a classe consumidor descreve os parâmetros gerais de um consumidor de evento permanente para o WMI.</span><span class="sxs-lookup"><span data-stu-id="34eb2-140">Like any class, the consumer class describes the general parameters of a permanent event consumer to WMI.</span></span>

4.  <span data-ttu-id="34eb2-141">[Crie uma instância da classe consumidor](creating-a-logical-consumer.md).</span><span class="sxs-lookup"><span data-stu-id="34eb2-141">[Create an instance of the consumer class](creating-a-logical-consumer.md).</span></span>

    <span data-ttu-id="34eb2-142">Como qualquer outra classe WMI, você deve criar uma instância da classe consumidor se quiser implementar a classe.</span><span class="sxs-lookup"><span data-stu-id="34eb2-142">Like any other WMI class, you must create an instance of the consumer class if you want to implement the class.</span></span> <span data-ttu-id="34eb2-143">Uma instância de uma classe consumidor também é conhecida como [*consumidor lógico*](gloss-l.md).</span><span class="sxs-lookup"><span data-stu-id="34eb2-143">An instance of a consumer class is also known as a [*logical consumer*](gloss-l.md).</span></span> <span data-ttu-id="34eb2-144">O consumidor lógico representa o consumidor físico para o WMI.</span><span class="sxs-lookup"><span data-stu-id="34eb2-144">The logical consumer represents the physical consumer to WMI.</span></span>

5.  <span data-ttu-id="34eb2-145">[Crie um filtro de eventos](creating-an-event-filter.md).</span><span class="sxs-lookup"><span data-stu-id="34eb2-145">[Create an event filter](creating-an-event-filter.md).</span></span>

    <span data-ttu-id="34eb2-146">As consultas de evento que ativam os consumidores de eventos permanentes são chamadas de [*filtros de eventos*](gloss-e.md).</span><span class="sxs-lookup"><span data-stu-id="34eb2-146">The event queries that activate permanent event consumers are called [*event filters*](gloss-e.md).</span></span> <span data-ttu-id="34eb2-147">Um único filtro de eventos pode ser associado a vários consumidores de eventos lógicos.</span><span class="sxs-lookup"><span data-stu-id="34eb2-147">A single event filter can be associated with multiple logical event consumers.</span></span> <span data-ttu-id="34eb2-148">Além disso, vários filtros de eventos podem ser associados a um único consumidor de evento lógico.</span><span class="sxs-lookup"><span data-stu-id="34eb2-148">Furthermore, multiple event filters can be associated with a single logical event consumer.</span></span> <span data-ttu-id="34eb2-149">O filtro é uma instância de [**\_ \_ EventFilter**](--eventfilter.md).</span><span class="sxs-lookup"><span data-stu-id="34eb2-149">The filter is an instance of [**\_\_EventFilter**](--eventfilter.md).</span></span>

    <span data-ttu-id="34eb2-150">Um evento de log do NT é gerado quando uma consulta do consumidor de evento permanente falha.</span><span class="sxs-lookup"><span data-stu-id="34eb2-150">An NT Log event is generated when a permanent event consumer's query fails.</span></span> <span data-ttu-id="34eb2-151">A origem do evento é WinMgmt, a ID do evento é 10 e o tipo de evento é Error.</span><span class="sxs-lookup"><span data-stu-id="34eb2-151">The event's source is WinMgmt, the event ID is 10, and the event type is Error.</span></span>

6.  <span data-ttu-id="34eb2-152">[Vincule o filtro de eventos ao consumidor lógico](binding-an-event-filter-with-a-logical-consumer.md).</span><span class="sxs-lookup"><span data-stu-id="34eb2-152">[Link the event filter to the logical consumer](binding-an-event-filter-with-a-logical-consumer.md).</span></span>

    <span data-ttu-id="34eb2-153">Ao vincular o filtro de eventos ao consumidor lógico, você instrui o WMI sobre qual filtro de eventos pertence a qual consumidor lógico.</span><span class="sxs-lookup"><span data-stu-id="34eb2-153">By linking the event filter to the logical consumer, you instruct WMI about which event filter belongs to which logical consumer.</span></span> <span data-ttu-id="34eb2-154">Os consumidores de eventos lógicos e os filtros de eventos são vinculados por uma instância de classe de associação de [**\_ \_ FilterToConsumerBinding**](--filtertoconsumerbinding.md).</span><span class="sxs-lookup"><span data-stu-id="34eb2-154">Logical event consumers and event filters are linked by an association class instance of [**\_\_FilterToConsumerBinding**](--filtertoconsumerbinding.md).</span></span> <span data-ttu-id="34eb2-155">Quando é recebido um evento que corresponde a uma consulta de evento descrita em um filtro de eventos, o WMI localiza o consumidor de evento lógico associado examinando a instância da classe de associação.</span><span class="sxs-lookup"><span data-stu-id="34eb2-155">When an event is received that matches an event query described in an event filter, WMI finds the associated logical event consumer by looking at the association class instance.</span></span> <span data-ttu-id="34eb2-156">Depois que a instância do consumidor de evento lógico estiver localizada, o WMI usará uma instância da classe [**\_ \_ EventConsumerProviderRegistration**](--eventconsumerproviderregistration.md) para localizar e executar o consumidor de evento físico associado a essa instância.</span><span class="sxs-lookup"><span data-stu-id="34eb2-156">After the logical event consumer instance is located, WMI uses an instance of the [**\_\_EventConsumerProviderRegistration**](--eventconsumerproviderregistration.md) class to locate and run the physical event consumer associated with this instance.</span></span>

7.  <span data-ttu-id="34eb2-157">[Escrevendo um provedor de consumidor de eventos](writing-an-event-consumer-provider.md).</span><span class="sxs-lookup"><span data-stu-id="34eb2-157">[Writing an event consumer provider](writing-an-event-consumer-provider.md).</span></span>

    <span data-ttu-id="34eb2-158">O provedor de consumidor de eventos é um objeto COM que localiza o consumidor físico para o WMI.</span><span class="sxs-lookup"><span data-stu-id="34eb2-158">The event consumer provider is a COM object that locates the physical consumer for WMI.</span></span>

 

 



