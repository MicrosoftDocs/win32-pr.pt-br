---
description: Você pode impedir que usuários não autorizados recebam eventos aos quais eles não devem ter acesso.
ms.assetid: 59788643-f57d-458f-91ab-26552218523b
ms.tgt_platform: multiple
title: Fornecendo eventos com segurança
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d2c92ed1de08dde4891365440f559544a0b26de5
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "104170888"
---
# <a name="providing-events-securely"></a><span data-ttu-id="ce7e3-103">Fornecendo eventos com segurança</span><span class="sxs-lookup"><span data-stu-id="ce7e3-103">Providing Events Securely</span></span>

<span data-ttu-id="ce7e3-104">Você pode impedir que usuários não autorizados recebam eventos aos quais eles não devem ter acesso.</span><span class="sxs-lookup"><span data-stu-id="ce7e3-104">You can prevent unauthorized users from receiving events to which they should not have access.</span></span> <span data-ttu-id="ce7e3-105">Seu provedor de eventos pode fornecer instâncias de suas próprias classes de evento, assim como o [provedor de registro do sistema](/previous-versions/windows/desktop/regprov/system-registry-provider) fornece classes como [**RegistryKeyChangeEvent**](/previous-versions/windows/desktop/regprov/registrykeychangeevent).</span><span class="sxs-lookup"><span data-stu-id="ce7e3-105">Your event provider can supply instances of its own event classes, just as the [System Registry Provider](/previous-versions/windows/desktop/regprov/system-registry-provider) supplies classes such as [**RegistryKeyChangeEvent**](/previous-versions/windows/desktop/regprov/registrykeychangeevent).</span></span> <span data-ttu-id="ce7e3-106">Seu provedor de eventos também pode fornecer eventos intrínsecos, como [**\_ \_ InstanceCreationEvent**](--instancecreationevent.md).</span><span class="sxs-lookup"><span data-stu-id="ce7e3-106">Your event provider can also deliver intrinsic events such as [**\_\_InstanceCreationEvent**](--instancecreationevent.md).</span></span> <span data-ttu-id="ce7e3-107">Para obter mais informações, consulte [escrevendo um provedor de eventos](writing-an-event-provider.md).</span><span class="sxs-lookup"><span data-stu-id="ce7e3-107">For more information, see [Writing an Event Provider](writing-an-event-provider.md).</span></span>

<span data-ttu-id="ce7e3-108">Um provedor de eventos pode controlar o acesso a destinatários de eventos das seguintes maneiras:</span><span class="sxs-lookup"><span data-stu-id="ce7e3-108">An event provider can control access to event recipients in the following ways:</span></span>

-   <span data-ttu-id="ce7e3-109">Usando o controle de acesso implementando [**IWbemEventProviderSecurity:: AccessCheck**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovidersecurity) é a maneira mais eficiente.</span><span class="sxs-lookup"><span data-stu-id="ce7e3-109">Using access control by implementing [**IWbemEventProviderSecurity::AccessCheck**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovidersecurity) is the most efficient way.</span></span>

    <span data-ttu-id="ce7e3-110">O provedor determina se o consumidor tem privilégios para receber um evento solicitado.</span><span class="sxs-lookup"><span data-stu-id="ce7e3-110">The provider determines whether the consumer has privileges to receive a requested event.</span></span> <span data-ttu-id="ce7e3-111">Se o consumidor não tem privilégios suficientes para se registrar, o WMI retorna um erro de acesso negado.</span><span class="sxs-lookup"><span data-stu-id="ce7e3-111">If the consumer lacks sufficient privileges to register, WMI returns an access denied error.</span></span> <span data-ttu-id="ce7e3-112">Use esse modo quando o provedor puder tomar a decisão sobre quem pode receber eventos.</span><span class="sxs-lookup"><span data-stu-id="ce7e3-112">Use this mode when the provider can make the decision about who can receive events.</span></span> <span data-ttu-id="ce7e3-113">Por exemplo, um provedor pode fornecer eventos relacionados à segurança e pode exigir que o consumidor tenha privilégios de administrador com o privilégio **SeSecurityPrivilege** habilitado.</span><span class="sxs-lookup"><span data-stu-id="ce7e3-113">For example, a provider may supply security related events and can require that the consumer have administrator privileges with the **SeSecurityPrivilege** privilege enabled.</span></span>

-   <span data-ttu-id="ce7e3-114">Implementar [**IWbemEventSink:: SetSinkSecurity**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventsink-setsinksecurity) no coletor usado para gerar eventos permite a configuração de um descritor de segurança (SD) em um coletor para todos os eventos transmitidos.</span><span class="sxs-lookup"><span data-stu-id="ce7e3-114">Implementing [**IWbemEventSink::SetSinkSecurity**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventsink-setsinksecurity) on the sink used to raise events allows the setting of a security descriptor (SD) on a sink for all the events passing through.</span></span>

    <span data-ttu-id="ce7e3-115">O WMI executa verificações de acesso com base no SD.</span><span class="sxs-lookup"><span data-stu-id="ce7e3-115">WMI performs access checks based on the SD.</span></span> <span data-ttu-id="ce7e3-116">Use esse modo quando o provedor não puder tomar a decisão em relação a quem tem permissão para consumir seus eventos, mas pode decidir em um SD para um coletor específico.</span><span class="sxs-lookup"><span data-stu-id="ce7e3-116">Use this mode when the provider cannot make the decision regarding who is allowed to consume its events, but can decide on an SD for a specific sink.</span></span> <span data-ttu-id="ce7e3-117">Por exemplo, use [**IWbemEventSink:: SetSinkSecurity**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventsink-setsinksecurity) se seu provedor de eventos obtiver vários coletores por chamadas para [**IWbemEventSink:: GetRestrictedSink**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventsink-getrestrictedsink) e você quiser um descritor de segurança para cada coletor.</span><span class="sxs-lookup"><span data-stu-id="ce7e3-117">For example, use [**IWbemEventSink::SetSinkSecurity**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventsink-setsinksecurity) if your event provider obtained several sinks by calls to [**IWbemEventSink::GetRestrictedSink**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventsink-getrestrictedsink) and you want a security descriptor for each sink.</span></span>

-   <span data-ttu-id="ce7e3-118">A definição da propriedade **\_ descritor de segurança** de um evento permite a configuração de um SD para cada evento.</span><span class="sxs-lookup"><span data-stu-id="ce7e3-118">Setting the **SECURITY\_DESCRIPTOR** property of an event allows for the setting of an SD for each event.</span></span>

    <span data-ttu-id="ce7e3-119">Use essa abordagem quando cada evento entregue ao coletor puder ter descritores de segurança diferentes.</span><span class="sxs-lookup"><span data-stu-id="ce7e3-119">Use this approach when each event delivered to the sink can have different security descriptors.</span></span> <span data-ttu-id="ce7e3-120">Para usar essa abordagem, derive qualquer uma das classes de evento extrínsecos definidas pelo seu provedor de [**\_ \_ Event**](--event.md) ou [**\_ \_ ExtrinsicEvent**](--extrinsicevent.md) para que sua classe contenha a propriedade do **\_ descritor de segurança** .</span><span class="sxs-lookup"><span data-stu-id="ce7e3-120">To use this approach, derive any of the extrinsic event classes defined by your provider from [**\_\_Event**](--event.md) or [**\_\_ExtrinsicEvent**](--extrinsicevent.md) so that your class contains the **SECURITY\_DESCRIPTOR** property.</span></span> <span data-ttu-id="ce7e3-121">Por exemplo, seu provedor de eventos pode publicar eventos seguros e normais por meio de um coletor.</span><span class="sxs-lookup"><span data-stu-id="ce7e3-121">For example, your event provider may publish both secure and normal events through a sink.</span></span> <span data-ttu-id="ce7e3-122">Nesse caso, use o descritor de segurança da conta administradores para eventos seguros e um descritor de segurança **nulo** para eventos normais que podem ser recebidos por qualquer pessoa.</span><span class="sxs-lookup"><span data-stu-id="ce7e3-122">In this case, use the Administrators account security descriptor for secure events and a **NULL** security descriptor for normal events that can be received by anyone.</span></span>

## <a name="securing-events-by-decoupled-event-providers"></a><span data-ttu-id="ce7e3-123">Protegendo eventos por provedores de eventos dissociados</span><span class="sxs-lookup"><span data-stu-id="ce7e3-123">Securing Events by Decoupled Event Providers</span></span>

<span data-ttu-id="ce7e3-124">Os provedores de eventos dissociados diferem dos provedores de eventos nondecoupled da maneira como se registram com o WMI.</span><span class="sxs-lookup"><span data-stu-id="ce7e3-124">Decoupled event providers differ from nondecoupled event providers in the way that they register with WMI.</span></span> <span data-ttu-id="ce7e3-125">A chamada para [**IWbemEventProviderSecurity:: AccessCheck**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventprovidersecurity-accesscheck) para eventos de um provedor desacoplado nunca propaga o token de acesso do cliente.</span><span class="sxs-lookup"><span data-stu-id="ce7e3-125">The call to [**IWbemEventProviderSecurity::AccessCheck**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventprovidersecurity-accesscheck) for events from a decoupled provider never propagates the client access token.</span></span> <span data-ttu-id="ce7e3-126">O WMI manipula o controle de acesso da mesma maneira que para provedores de eventos nondecoupled.</span><span class="sxs-lookup"><span data-stu-id="ce7e3-126">WMI handles the access control in the same manner as for nondecoupled event providers.</span></span> <span data-ttu-id="ce7e3-127">Para obter mais informações sobre como gravar um provedor dissociado, consulte [incorporando um provedor em um aplicativo](incorporating-a-provider-in-an-application.md).</span><span class="sxs-lookup"><span data-stu-id="ce7e3-127">For more information about writing a decoupled provider, see [Incorporating a Provider in an Application](incorporating-a-provider-in-an-application.md).</span></span>

<span data-ttu-id="ce7e3-128">Somente os administradores com o privilégio de **\_ gravação total** definido no **controle WMI** do **painel de controle** têm permissão para gerar eventos para um namespace.</span><span class="sxs-lookup"><span data-stu-id="ce7e3-128">Only administrators with the **FULL\_WRITE** privilege set in **WMI Control** of the **Control Panel** are allowed to raise events for a namespace.</span></span> <span data-ttu-id="ce7e3-129">Para obter mais informações, consulte [definindo a segurança do namespace com o controle WMI](setting-namespace-security-with-the-wmi-control.md).</span><span class="sxs-lookup"><span data-stu-id="ce7e3-129">For more information, see [Setting Namespace Security with the WMI Control](setting-namespace-security-with-the-wmi-control.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="ce7e3-130">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="ce7e3-130">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="ce7e3-131">Protegendo eventos WMI</span><span class="sxs-lookup"><span data-stu-id="ce7e3-131">Securing WMI Events</span></span>](securing-wmi-events.md)
</dt> </dl>

 

 
