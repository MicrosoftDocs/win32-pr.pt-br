---
title: Tratamento de exceção (RPC)
description: O RPC usa a mesma abordagem para tratamento de exceções que a API do Windows.
ms.assetid: 7133d3f4-ed84-4cde-bc77-88e73ced9073
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 25de594a648cddb70f26b42e8b0dbf1d6a9dd51d
ms.sourcegitcommit: 8fa6614b715bddf14648cce36d2df22e5232801a
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/10/2020
ms.locfileid: "104454558"
---
# <a name="exception-handling-rpc"></a><span data-ttu-id="4657a-103">Tratamento de exceção (RPC)</span><span class="sxs-lookup"><span data-stu-id="4657a-103">Exception Handling (RPC)</span></span>

<span data-ttu-id="4657a-104">O RPC usa a mesma abordagem para tratamento de exceções que a API do Windows.</span><span class="sxs-lookup"><span data-stu-id="4657a-104">RPC uses the same approach to exception handling as the Windows API.</span></span>

<span data-ttu-id="4657a-105">A estrutura [**RpcTryFinally**](rpctryfinally.md)  /  [**RpcFinally**](/previous-versions/aa375699(v=vs.80))  /  [**RpcEndFinally**](/previous-versions/aa375634(v=vs.80)) é equivalente à instrução **try-finally** do Windows.</span><span class="sxs-lookup"><span data-stu-id="4657a-105">The [**RpcTryFinally**](rpctryfinally.md) / [**RpcFinally**](/previous-versions/aa375699(v=vs.80)) / [**RpcEndFinally**](/previous-versions/aa375634(v=vs.80)) structure is equivalent to the Windows **try-finally** statement.</span></span> <span data-ttu-id="4657a-106">A construção de exceção RPC [**RpcTryExcept**](rpctryexcept.md)  /  [**RpcExcept**](/windows/desktop/api/Rpc/nf-rpc-rpcexcept)  /  [**RpcEndExcept**](/previous-versions/aa375629(v=vs.80)) é equivalente à instrução **try-Except** do Windows.</span><span class="sxs-lookup"><span data-stu-id="4657a-106">The RPC exception construct [**RpcTryExcept**](rpctryexcept.md) / [**RpcExcept**](/windows/desktop/api/Rpc/nf-rpc-rpcexcept) / [**RpcEndExcept**](/previous-versions/aa375629(v=vs.80)) is equivalent to the Windows **try-except** statement.</span></span>

<span data-ttu-id="4657a-107">Quando você usa os manipuladores de exceção RPC, o código-fonte do lado do cliente é portátil.</span><span class="sxs-lookup"><span data-stu-id="4657a-107">When you use the RPC exception handlers, your client-side source code is portable.</span></span> <span data-ttu-id="4657a-108">Os diferentes arquivos de cabeçalho RPC fornecidos para cada plataforma resolvem as macros **RpcTry** e [**RpcExcept**](/windows/desktop/api/Rpc/nf-rpc-rpcexcept) para cada plataforma.</span><span class="sxs-lookup"><span data-stu-id="4657a-108">The different RPC header files provided for each platform resolve the **RpcTry** and [**RpcExcept**](/windows/desktop/api/Rpc/nf-rpc-rpcexcept) macros for each platform.</span></span> <span data-ttu-id="4657a-109">No ambiente do Windows, essas macros são mapeadas diretamente para as instruções **try-finally** e **try-Except** do Windows.</span><span class="sxs-lookup"><span data-stu-id="4657a-109">In the Windows environment, these macros map directly to the Windows **try-finally** and **try-except** statements.</span></span> <span data-ttu-id="4657a-110">Em outros ambientes, essas macros são mapeadas para outras implementações de manipuladores de exceção específicas da plataforma.</span><span class="sxs-lookup"><span data-stu-id="4657a-110">In other environments, these macros map to other platform-specific implementations of exception handlers.</span></span>

<span data-ttu-id="4657a-111">As possíveis exceções geradas por essas estruturas incluem o conjunto de códigos de erro retornados pelas funções RPC com os prefixos RPC \_ S \_ e RPC \_ X e o conjunto de exceções retornado pelo Windows.</span><span class="sxs-lookup"><span data-stu-id="4657a-111">Potential exceptions raised by these structures include the set of error codes returned by the RPC functions with the prefixes RPC\_S\_ and RPC\_X and the set of exceptions returned by Windows.</span></span> <span data-ttu-id="4657a-112">Para obter detalhes, consulte [valores de retorno de RPC](rpc-return-values.md).</span><span class="sxs-lookup"><span data-stu-id="4657a-112">For details, see [RPC Return Values](rpc-return-values.md).</span></span>

<span data-ttu-id="4657a-113">Embora as macros **RpcTry** e [**RpcExcept**](/windows/desktop/api/Rpc/nf-rpc-rpcexcept) forneçam uma maneira independente de plataforma personalizável para lidar com exceções, no Windows Vista e em versões posteriores do Windows, o [**RpcExceptionFilter**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcexceptionfilter) é a maneira recomendada de lidar com exceções.</span><span class="sxs-lookup"><span data-stu-id="4657a-113">While the **RpcTry** and [**RpcExcept**](/windows/desktop/api/Rpc/nf-rpc-rpcexcept) macros provide a customizable platform-agnostic way to handle exceptions, in Windows Vista and later versions of Windows, [**RpcExceptionFilter**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcexceptionfilter) is the recommended way of handling exceptions.</span></span> <span data-ttu-id="4657a-114">Ele não exige que filtros personalizados sejam escritos para capturar muitas das exceções estruturadas mais comuns; no entanto, os filtros de exceção personalizados ainda exigem **RpcExcept**.</span><span class="sxs-lookup"><span data-stu-id="4657a-114">It does not require custom filters to be written to capture many of the most common structured exceptions; however, custom exception filters still require **RpcExcept**.</span></span>

<span data-ttu-id="4657a-115">As exceções que ocorrem no aplicativo do servidor, no stub do servidor e na biblioteca de tempo de execução do servidor (acima da camada de transporte) são propagadas para o cliente.</span><span class="sxs-lookup"><span data-stu-id="4657a-115">Exceptions that occur in the server application, server stub, and server run-time library (above the transport layer) are propagated to the client.</span></span> <span data-ttu-id="4657a-116">Nenhuma exceção é propagada do nível de transporte do servidor.</span><span class="sxs-lookup"><span data-stu-id="4657a-116">No exceptions are propagated from the server-transport level.</span></span> <span data-ttu-id="4657a-117">O método recomendado para uma rotina de servidor retornar erros para o tempo de execução de RPC é gerar uma exceção.</span><span class="sxs-lookup"><span data-stu-id="4657a-117">The recommended method for a server routine to return errors to the RPC run time is to throw an exception.</span></span> <span data-ttu-id="4657a-118">Uma rotina de servidor pode usar qualquer método apropriado para comunicar erros entre rotinas de servidor, mas se encontrar um erro que impeça a execução do procedimento remoto, ele deverá gerar uma exceção após a limpeza e antes de retornar ao tempo de execução de RPC, em vez de retornar um valor para RPC que apenas a rotina de servidor reconhece como erro.</span><span class="sxs-lookup"><span data-stu-id="4657a-118">A server routine can use whatever methods is appropriate for communicating errors between server routines, but if it encounters an error that prevents it from executing the remote procedure, it should raise an exception after cleaning up and before returning to the RPC run time, rather than returning a value to RPC that only the server routine recognizes as an error.</span></span>

<span data-ttu-id="4657a-119">A figura a seguir mostra como as exceções são retornadas do servidor para o cliente.</span><span class="sxs-lookup"><span data-stu-id="4657a-119">The following figure shows how exceptions are returned from the server to the client.</span></span>

![as exceções são retornadas do servidor para o cliente por meio do respectivo tempo de execução RPC de cada componente](images/prog-a20.png)

<span data-ttu-id="4657a-121">Os manipuladores de exceção RPC diferem ligeiramente **das macros** de tratamento de exceção do uso-DCE (Foundation-Distributed software aberto), **por fim**, e **Catch**.</span><span class="sxs-lookup"><span data-stu-id="4657a-121">The RPC exception handlers differ slightly from the Open Software Foundation-Distributed Computing Environment (OSF-DCE) exception-handling macros **TRY**, **FINALLY**, and **CATCH**.</span></span> <span data-ttu-id="4657a-122">Vários fornecedores fornecem arquivos de inclusão que mapeiam as funções RPC uso-DCE para as funções RPC da Microsoft, incluindo **try**, **Catch**, **Catch** \_ **All** e **ENDTRY**.</span><span class="sxs-lookup"><span data-stu-id="4657a-122">Various vendors provide include files that map the OSF-DCE RPC functions to the Microsoft RPC functions, including **TRY**, **CATCH**, **CATCH**\_**ALL**, and **ENDTRY**.</span></span> <span data-ttu-id="4657a-123">Esses arquivos de cabeçalho também mapeiam os \_ códigos de erro RPC s \_ \* para as contrapartes de exceção uso-DCE, RPC \_ S \_ \* e mapeiam os \_ \_ \* códigos de erro RPC x para RPC \_ x \_ \* .</span><span class="sxs-lookup"><span data-stu-id="4657a-123">These header files also map the RPC\_S\_\* error codes onto the OSF-DCE exception counterparts, rpc\_s\_\*, and map RPC\_X\_\* error codes to rpc\_x\_\*.</span></span> <span data-ttu-id="4657a-124">Para portabilidade uso-DCE, use esses arquivos de inclusão.</span><span class="sxs-lookup"><span data-stu-id="4657a-124">For OSF-DCE portability, use these include files.</span></span> <span data-ttu-id="4657a-125">Para obter mais informações sobre os manipuladores de exceção RPC, consulte [**RpcExceptionFilter**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcexceptionfilter), [**RpcExcept**](/windows/desktop/api/Rpc/nf-rpc-rpcexcept), [**RpcFinally**](/previous-versions/aa375699(v=vs.80)).</span><span class="sxs-lookup"><span data-stu-id="4657a-125">For more information about the RPC exception handlers, see [**RpcExceptionFilter**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcexceptionfilter), [**RpcExcept**](/windows/desktop/api/Rpc/nf-rpc-rpcexcept), [**RpcFinally**](/previous-versions/aa375699(v=vs.80)).</span></span> <span data-ttu-id="4657a-126">Para obter mais informações sobre os manipuladores de exceção do Windows, consulte [manipulação de exceção estruturada](/windows/desktop/Debug/structured-exception-handling).</span><span class="sxs-lookup"><span data-stu-id="4657a-126">For more information about the Windows exception handlers, see [Structured Exception Handling](/windows/desktop/Debug/structured-exception-handling).</span></span>

 

 
