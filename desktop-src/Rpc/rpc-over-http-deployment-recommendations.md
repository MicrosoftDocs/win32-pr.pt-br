---
title: Recomendações de implantação de RPC sobre HTTP
description: Esta seção documenta as práticas recomendadas e as configurações de implantação recomendadas para alcançar a segurança e o desempenho máximos ao usar RPC sobre HTTP.
ms.assetid: 83938a7d-77d0-45e8-b0a3-7b32ef768d83
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8871686d1fc8b87bcd6fb7ac4314b1977252f23a
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/16/2019
ms.locfileid: "104005975"
---
# <a name="rpc-over-http-deployment-recommendations"></a><span data-ttu-id="68c86-103">Recomendações de implantação de RPC sobre HTTP</span><span class="sxs-lookup"><span data-stu-id="68c86-103">RPC over HTTP Deployment Recommendations</span></span>

<span data-ttu-id="68c86-104">Esta seção documenta as práticas recomendadas e as configurações de implantação recomendadas para alcançar a segurança e o desempenho máximos ao usar RPC sobre HTTP.</span><span class="sxs-lookup"><span data-stu-id="68c86-104">This section documents best practices and recommended deployment configurations for achieving maximum security and performance when using RPC over HTTP.</span></span> <span data-ttu-id="68c86-105">As várias configurações encontradas aqui se aplicam a diferentes organizações com base em vários requisitos de tamanho, orçamento e segurança.</span><span class="sxs-lookup"><span data-stu-id="68c86-105">The various configurations found herein apply do different organizations based on various size, budget, and security requirements.</span></span> <span data-ttu-id="68c86-106">Cada configuração também fornece considerações de implantação úteis para determinar qual é a melhor para um determinado cenário.</span><span class="sxs-lookup"><span data-stu-id="68c86-106">Each configuration also provides deployment considerations useful in determining which is best for a given scenario.</span></span>

<span data-ttu-id="68c86-107">Para obter informações sobre cenários de RPC sobre HTTP em grande volume, consulte [balanceamento de carga do Microsoft RPC](rpc-load-balancing.md).</span><span class="sxs-lookup"><span data-stu-id="68c86-107">For information regarding high volume RPC over HTTP scenarios, please see [Microsoft RPC Load Balancing](rpc-load-balancing.md).</span></span>

<span data-ttu-id="68c86-108">As seguintes recomendações se aplicam a todas as configurações:</span><span class="sxs-lookup"><span data-stu-id="68c86-108">The following recommendations apply to all configurations:</span></span>

-   <span data-ttu-id="68c86-109">Use versões do Windows que dão suporte a RPC sobre HTTP v2.</span><span class="sxs-lookup"><span data-stu-id="68c86-109">Use versions of Windows that support RPC over HTTP v2.</span></span>
-   <span data-ttu-id="68c86-110">Coloque o IIS no computador que executa o proxy RPC no modo IIS 6,0.</span><span class="sxs-lookup"><span data-stu-id="68c86-110">Put IIS on the machine that runs the RPC Proxy in IIS 6.0 mode.</span></span>
-   <span data-ttu-id="68c86-111">Não permitir acesso anônimo ao diretório virtual do proxy RPC.</span><span class="sxs-lookup"><span data-stu-id="68c86-111">Disallow anonymous access to the RPC Proxy virtual directory.</span></span>
-   <span data-ttu-id="68c86-112">Nunca habilite a chave do registro AllowAnonymous.</span><span class="sxs-lookup"><span data-stu-id="68c86-112">Never enable the AllowAnonymous registry key.</span></span>
-   <span data-ttu-id="68c86-113">Faça com que seus clientes RPC sobre HTTP usem o **CertificateSubjectField** (consulte [**RpcBindingSetAuthInfoEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfoexa) para obter mais informações) para verificar se o proxy RPC ao qual você se CONECTOU é o proxy RPC que você espera.</span><span class="sxs-lookup"><span data-stu-id="68c86-113">Make your RPC over HTTP clients use the **CertificateSubjectField** (see [**RpcBindingSetAuthInfoEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfoexa) for more information) to verify that the RPC Proxy you connected to is the RPC Proxy you expect.</span></span>
-   <span data-ttu-id="68c86-114">Configure a chave do registro **ValidPorts** para conter somente computadores aos quais os clientes RPC sobre http serão conectados.</span><span class="sxs-lookup"><span data-stu-id="68c86-114">Configure the **ValidPorts** registry key to contain only machines to which the RPC over HTTP clients will connect.</span></span>
-   <span data-ttu-id="68c86-115">Não use curingas na chave **ValidPorts** ; Isso pode economizar tempo, mas um computador completamente inesperado também pode se ajustar ao curinga.</span><span class="sxs-lookup"><span data-stu-id="68c86-115">Do not use wildcards in the **ValidPorts** key; doing so can save time, but a completely unexpected machine may fit the wildcard as well.</span></span>
-   <span data-ttu-id="68c86-116">Use SSL em clientes RPC sobre HTTP.</span><span class="sxs-lookup"><span data-stu-id="68c86-116">Use SSL on RPC over HTTP clients.</span></span> <span data-ttu-id="68c86-117">Se as diretrizes estabelecidas nessas seções forem seguidas, o cliente RPC sobre HTTP não poderá se conectar sem usar SSL.</span><span class="sxs-lookup"><span data-stu-id="68c86-117">If the guidelines set forth in these sections are followed, the RPC over HTTP client will not be able to connect without using SSL.</span></span>
-   <span data-ttu-id="68c86-118">Configure o RPC sobre clientes HTTP para usar a criptografia RPC, além de usar SSL.</span><span class="sxs-lookup"><span data-stu-id="68c86-118">Configure RPC over HTTP clients to use RPC Encryption in addition to using SSL.</span></span> <span data-ttu-id="68c86-119">Se o cliente RPC sobre HTTP não puder acessar o KDC, ele só poderá usar Negotiate e NTLM.</span><span class="sxs-lookup"><span data-stu-id="68c86-119">If the RPC over HTTP client cannot reach the KDC, it can use only Negotiate and NTLM.</span></span>
-   <span data-ttu-id="68c86-120">Configure computadores cliente para usar o NTLMv2.</span><span class="sxs-lookup"><span data-stu-id="68c86-120">Configure client machines to use NTLMv2.</span></span> <span data-ttu-id="68c86-121">Defina a chave do registro **LmCompatibilityLevel** como 2 ou superior.</span><span class="sxs-lookup"><span data-stu-id="68c86-121">Set the **LMCompatibilityLevel** registry key to 2 or higher.</span></span> <span data-ttu-id="68c86-122">Consulte **msdn.Microsoft.com** para obter mais informações sobre a chave **LmCompatibilityLevel** .</span><span class="sxs-lookup"><span data-stu-id="68c86-122">See **msdn.microsoft.com** for more information on the **LMCompatibilityLevel** key.</span></span>
-   <span data-ttu-id="68c86-123">Execute um web farm de máquinas de proxy RPC com a configuração descrita acima.</span><span class="sxs-lookup"><span data-stu-id="68c86-123">Run a web farm of RPC Proxy machines with the configuration outlined above.</span></span>
-   <span data-ttu-id="68c86-124">Implante um firewall entre a Internet e o proxy RPC.</span><span class="sxs-lookup"><span data-stu-id="68c86-124">Deploy a firewall between the Internet and the RPC Proxy.</span></span>
-   <span data-ttu-id="68c86-125">Para obter um desempenho ideal, configure o IIS para enviar uma breve resposta para códigos de erro que não são bem-sucedidos.</span><span class="sxs-lookup"><span data-stu-id="68c86-125">For optimal performance, configure IIS to send a short response for non-success error codes.</span></span> <span data-ttu-id="68c86-126">Como o consumidor da resposta do IIS é um processo automatizado, não há necessidade de que as explicações amigáveis do usuário sejam enviadas ao cliente; Eles serão simplesmente ignorados pelo cliente RPC sobre HTTP.</span><span class="sxs-lookup"><span data-stu-id="68c86-126">Because the consumer of the IIS response is an automated process, there is no need for user friendly explanations to be sent to the client; they will simply be ignored by the RPC over HTTP client.</span></span>

<span data-ttu-id="68c86-127">Os objetivos básicos do proxy RPC de uma perspectiva de segurança, desempenho e capacidade de gerenciamento são os seguintes:</span><span class="sxs-lookup"><span data-stu-id="68c86-127">The basic goals of the RPC Proxy from a security, performance and manageability perspective are the following:</span></span>

-   <span data-ttu-id="68c86-128">Forneça um único ponto de entrada para tráfego RPC sobre HTTP na rede do servidor.</span><span class="sxs-lookup"><span data-stu-id="68c86-128">Provide a single point of entry for RPC over HTTP traffic into the server network.</span></span> <span data-ttu-id="68c86-129">Ter um único ponto de entrada para tráfego RPC sobre HTTP em uma rede de servidor tem dois benefícios principais.</span><span class="sxs-lookup"><span data-stu-id="68c86-129">Having a single point of entry for RPC over HTTP traffic into a server network has two main benefits.</span></span> <span data-ttu-id="68c86-130">Primeiro, como o proxy RPC está voltado para a Internet, a maioria das organizações isola essas máquinas em uma rede especial chamada rede de perímetro não confiável, que é separada da rede organizacional normal.</span><span class="sxs-lookup"><span data-stu-id="68c86-130">First, since the RPC Proxy is facing the Internet, most organizations isolate such machines in a special network called an untrusted perimeter network which is separate from the normal organizational network.</span></span> <span data-ttu-id="68c86-131">Os servidores em uma rede de perímetro não confiável são gerenciados com muito cuidado, configurados e monitorados para poder resistir a ataques da Internet.</span><span class="sxs-lookup"><span data-stu-id="68c86-131">Servers in an untrusted perimeter network are very carefully managed, configured and monitored to be able to withstand attacks from the Internet.</span></span> <span data-ttu-id="68c86-132">Quanto menos computadores em uma rede de perímetro não confiável, mais fácil é configurar, gerenciar, monitorar e mantê-los seguros.</span><span class="sxs-lookup"><span data-stu-id="68c86-132">The fewer machines in an untrusted perimeter network, the easier it is to configure, manage, monitor and keep them secure.</span></span> <span data-ttu-id="68c86-133">Em segundo lugar, como um único Web farm com proxies RPC instalados pode atender a qualquer número de servidores RPC sobre HTTP que residem na rede corporativa, faz muito sentido separar o proxy RPC do servidor RPC sobre HTTP e fazer com que o proxy RPC resida em uma rede de perímetro não confiável.</span><span class="sxs-lookup"><span data-stu-id="68c86-133">Second, since a single Web Farm with RPC Proxies installed can service any number of RPC over HTTP Servers residing on the corporate network, it makes a lot of sense to separate the RPC Proxy from the RPC over HTTP Server and have the RPC Proxy reside in an untrusted perimeter network.</span></span> <span data-ttu-id="68c86-134">Se o proxy RPC estava no mesmo computador que o servidor RPC sobre HTTP, as organizações seriam forçadas a colocar todos os seus servidores back-end em uma rede de perímetro não confiável, o que tornaria muito mais difícil manter a rede de perímetro não confiável segura.</span><span class="sxs-lookup"><span data-stu-id="68c86-134">If the RPC Proxy was on the same machine as the RPC over HTTP Server, organizations would be forced to put all of their back end servers into an untrusted perimeter network, which would make it much harder to keep the untrusted perimeter network secure.</span></span> <span data-ttu-id="68c86-135">A separação da função do proxy RPC e do servidor RPC sobre HTTP ajuda as organizações a manter o número de máquinas em uma rede de perímetro não confiável gerenciável e, portanto, mais segura.</span><span class="sxs-lookup"><span data-stu-id="68c86-135">Separating the role of the RPC Proxy and the RPC over HTTP server helps organizations keep the number of machines in an untrusted perimeter network manageable and therefore, more secure.</span></span>
-   <span data-ttu-id="68c86-136">Serve como um fusível de segurança para a rede do servidor.</span><span class="sxs-lookup"><span data-stu-id="68c86-136">Serve as a safety fuse for the server network.</span></span> <span data-ttu-id="68c86-137">O proxy RPC é projetado como um fusível ininteligível para a rede do servidor – se algo der errado no proxy RPC, ele simplesmente irá para a proteção e, portanto, protegerá o verdadeiro servidor RPC sobre HTTP.</span><span class="sxs-lookup"><span data-stu-id="68c86-137">The RPC Proxy is designed as an expendable fuse for the server network – if something goes wrong on the RPC Proxy, it simply goes out and thus protects the real RPC over HTTP server.</span></span> <span data-ttu-id="68c86-138">Se as práticas recomendadas descritas nesta seção tiverem sido seguidas até agora, o tráfego RPC sobre HTTP é criptografado com a criptografia RPC, além do SSL.</span><span class="sxs-lookup"><span data-stu-id="68c86-138">If the outlined best practices outlined in this section have been followed thus far, the RPC over HTTP traffic is encrypted with RPC encryption in addition to SSL.</span></span> <span data-ttu-id="68c86-139">A criptografia de RPC em si é entre o cliente e o servidor, não entre o cliente e o proxy.</span><span class="sxs-lookup"><span data-stu-id="68c86-139">The RPC Encryption itself is between the client and the server, not between the client and the proxy.</span></span> <span data-ttu-id="68c86-140">Isso significa que o proxy não entende e não pode descriptografar o tráfego RPC recebido.</span><span class="sxs-lookup"><span data-stu-id="68c86-140">This means the proxy does not understand and cannot decrypt the RPC traffic it receives.</span></span> <span data-ttu-id="68c86-141">Ele só entende algumas sequências de controle enviadas a ele pelo cliente lidando com o estabelecimento de conexão, controle de fluxo e outros detalhes de túnel.</span><span class="sxs-lookup"><span data-stu-id="68c86-141">It only understands some control sequences sent to it by the client dealing with connection establishment, flow control and other tunneling details.</span></span> <span data-ttu-id="68c86-142">Ele não tem acesso aos dados que o cliente RPC sobre HTTP envia para o servidor.</span><span class="sxs-lookup"><span data-stu-id="68c86-142">It has no access to the data the RPC over HTTP client sends to the server.</span></span> <span data-ttu-id="68c86-143">Além disso, o cliente RPC sobre HTTP deve autenticar de forma independente o proxy RPC e o servidor RPC sobre HTTP.</span><span class="sxs-lookup"><span data-stu-id="68c86-143">Furthermore, the RPC over HTTP client must independently authenticate to both the RPC Proxy and the RPC over HTTP server.</span></span> <span data-ttu-id="68c86-144">Isso proporciona defesa profunda.</span><span class="sxs-lookup"><span data-stu-id="68c86-144">This provides defense in depth.</span></span> <span data-ttu-id="68c86-145">Se o computador proxy RPC for comprometido, devido a algum erro de configuração ou uma violação de segurança de algum tipo, os dados que passam por ele ainda estarão protegidos contra violação.</span><span class="sxs-lookup"><span data-stu-id="68c86-145">If the RPC Proxy machine becomes compromised, due to some configuration error or a security breach of some sort, the data that pass through it are still secure from tampering.</span></span> <span data-ttu-id="68c86-146">Um invasor que obteria o controle do proxy RPC pode, no máximo, interromper o tráfego, mas não lê-lo nem adulterar isso.</span><span class="sxs-lookup"><span data-stu-id="68c86-146">An attacker that would gain control of the RPC Proxy can at most interrupt the traffic, but not read it or tamper with it.</span></span> <span data-ttu-id="68c86-147">É aí que a função de fusível do proxy RPC entra em cena – ela é inútil sem que a segurança do tráfego RPC sobre HTTP seja comprometida.</span><span class="sxs-lookup"><span data-stu-id="68c86-147">This is where the fuse role of the RPC Proxy comes into play – it is expendable without the security of the RPC over HTTP traffic being compromised.</span></span>
-   <span data-ttu-id="68c86-148">Distribua algumas das verificações de acesso e o trabalho de descriptografia entre vários computadores que executam o proxy RPC em um Web farm.</span><span class="sxs-lookup"><span data-stu-id="68c86-148">Distribute some of the access checks and decryption work among multiple machines running RPC Proxy in a Web Farm.</span></span> <span data-ttu-id="68c86-149">Ao funcionar bem em um Web farm, o proxy RPC permite que as organizações descarreguem a descriptografia de SSL e algumas das verificações de acesso, liberando assim mais capacidade no servidor back-end para processamento.</span><span class="sxs-lookup"><span data-stu-id="68c86-149">By functioning well in a Web Farm, the RPC Proxy enables organizations to offload SSL decryption and some of the access checks, thus freeing more capacity on the back end server for processing.</span></span> <span data-ttu-id="68c86-150">O uso de um Web farm de máquinas proxy RPC também permite que uma organização aumente sua capacidade de resistir a ataques de DoS (negação de serviço) aumentando a capacidade em seus servidores front-end.</span><span class="sxs-lookup"><span data-stu-id="68c86-150">Using a Web Farm of RPC Proxy machines also enables an organization to increase its ability to withstand Denial of Service (DoS) attacks by increasing the capacity on its front end servers.</span></span>

<span data-ttu-id="68c86-151">Nas diretrizes definidas até agora, as organizações ainda têm opções.</span><span class="sxs-lookup"><span data-stu-id="68c86-151">Within the guidelines set forth thus far, organizations still have choices.</span></span> <span data-ttu-id="68c86-152">Cada organização tem opções e comprometimentos entre a inconveniência do usuário, a segurança e o custo:</span><span class="sxs-lookup"><span data-stu-id="68c86-152">Each organization has choices and compromises between user inconvenience, security and cost:</span></span>

-   <span data-ttu-id="68c86-153">**Usar autenticação básica ou autenticação integrada do Windows para autenticar no proxy RPC?**</span><span class="sxs-lookup"><span data-stu-id="68c86-153">**Use Basic Authentication or Windows Integrated Authentication to authenticate to the RPC Proxy?**</span></span> <span data-ttu-id="68c86-154">O RPC sobre HTTP atualmente dá suporte apenas a NTLM – ele não dá suporte a Kerberos.</span><span class="sxs-lookup"><span data-stu-id="68c86-154">RPC over HTTP currently supports only NTLM – it doesn't support Kerberos.</span></span> <span data-ttu-id="68c86-155">Além disso, se houver um proxy HTTP ou um firewall entre o cliente RPC sobre HTTP e o proxy RPC que insere o *por meio* do pragma no cabeçalho HTTP, a autenticação NTLM não funcionará.</span><span class="sxs-lookup"><span data-stu-id="68c86-155">Also, if there is an HTTP Proxy or a firewall between the RPC over HTTP client and the RPC Proxy which inserts the *via* pragma in the HTTP header, NTLM authentication will not work.</span></span> <span data-ttu-id="68c86-156">Quando esse não for o caso, as organizações poderão escolher entre a autenticação básica e NTLM.</span><span class="sxs-lookup"><span data-stu-id="68c86-156">When that is not the case, organizations can choose between Basic and NTLM authentication.</span></span> <span data-ttu-id="68c86-157">A vantagem da autenticação básica é que ela é mais rápida e simples e, portanto, oferece menos oportunidades para ataques de negação de serviço.</span><span class="sxs-lookup"><span data-stu-id="68c86-157">The advantage of Basic authentication is that it is faster and simpler, and therefore offers less opportunity for denial of service attacks.</span></span> <span data-ttu-id="68c86-158">Mas o NTLM é mais seguro.</span><span class="sxs-lookup"><span data-stu-id="68c86-158">But NTLM is more secure.</span></span> <span data-ttu-id="68c86-159">Dependendo das prioridades de uma organização, ele pode escolher básico, NTLM ou permitir que seus usuários escolham entre os dois.</span><span class="sxs-lookup"><span data-stu-id="68c86-159">Depending on an organization's priorities, it can choose Basic, NTLM, or allow its users to choose between the two.</span></span> <span data-ttu-id="68c86-160">Se apenas um for escolhido, será melhor desativar o outro do diretório virtual do proxy RPC para reduzir o risco de ataque.</span><span class="sxs-lookup"><span data-stu-id="68c86-160">If only one is chosen, it is best to turn off the other from the RPC Proxy virtual directory to reduce risk of attack.</span></span>
-   <span data-ttu-id="68c86-161">**Usar o mesmo conjunto de credenciais para o proxy RPC e o servidor RPC sobre HTTP, ou usar credenciais diferentes para cada um?**</span><span class="sxs-lookup"><span data-stu-id="68c86-161">**Use the same set of credentials for both the RPC Proxy and the RPC over HTTP Server, or use different credentials for each?**</span></span> <span data-ttu-id="68c86-162">A compensação para essa decisão é entre a conveniência e a segurança do usuário.</span><span class="sxs-lookup"><span data-stu-id="68c86-162">The tradeoff for this decision is between user's convenience and security.</span></span> <span data-ttu-id="68c86-163">Poucos usuários gostam de inserir várias credenciais.</span><span class="sxs-lookup"><span data-stu-id="68c86-163">Few users like to enter multiple credentials.</span></span> <span data-ttu-id="68c86-164">No entanto, se ocorrer uma violação de segurança em uma rede de perímetro não confiável, ter conjuntos de credenciais separados para o proxy RPC e o servidor RPC sobre HTTP fornece proteção adicional.</span><span class="sxs-lookup"><span data-stu-id="68c86-164">However, if a security breach occurs in an untrusted perimeter network, having separate sets of credentials for the RPC Proxy and the RPC over HTTP Server provides additional protection.</span></span> <span data-ttu-id="68c86-165">Observe que, se credenciais separadas forem usadas e um conjunto de credenciais for as credenciais de domínio do usuário, é aconselhável usar as credenciais de domínio do usuário para o servidor RPC sobre HTTP e não para o proxy RPC.</span><span class="sxs-lookup"><span data-stu-id="68c86-165">Note that if separate credentials are used, and one set of credentials is the user's domain credentials, it is advisable to use the user's domain credentials for the RPC over HTTP Server and not for the RPC Proxy.</span></span>

 

 




