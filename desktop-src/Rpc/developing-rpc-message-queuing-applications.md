---
title: Desenvolvendo aplicativos de enfileiramento RPC-Message
description: É necessário ter muito pouco esforço para aproveitar o transporte MSMQ em seu aplicativo RPC.
ms.assetid: 1ea97df8-cdf5-43b8-88aa-9e8fa6ae845a
keywords:
- Chamada de procedimento remoto RPC, tarefas, desenvolvendo aplicativos de enfileiramento de mensagens
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f3e51707c0a6903200e51dd35e50e998430c8eae
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/20/2020
ms.locfileid: "104008054"
---
# <a name="developing-rpc-message-queuing-applications"></a><span data-ttu-id="8d702-104">Desenvolvendo aplicativos de enfileiramento RPC-Message</span><span class="sxs-lookup"><span data-stu-id="8d702-104">Developing RPC-Message Queuing Applications</span></span>

<span data-ttu-id="8d702-105">É necessário ter muito pouco esforço para aproveitar o transporte MSMQ em seu aplicativo RPC.</span><span class="sxs-lookup"><span data-stu-id="8d702-105">Very little effort is necessary to take advantage of the MSMQ transport in your RPC application.</span></span> <span data-ttu-id="8d702-106">Para mensagens síncronas, você só precisa especificar o [**ncadg \_ MQ**](/windows/desktop/Midl/ncadg-mq)(transporte de fila de mensagens) como a sequência de protocolos.</span><span class="sxs-lookup"><span data-stu-id="8d702-106">For synchronous messaging you need only specify the message queue transport ([**ncadg\_mq**](/windows/desktop/Midl/ncadg-mq)) as the protocol sequence.</span></span> <span data-ttu-id="8d702-107">O **protocolo \_ MQ ncadg** dá suporte a todos os recursos de datagrama padrão, exceto chamadas de difusão.</span><span class="sxs-lookup"><span data-stu-id="8d702-107">The **ncadg\_mq** protocol supports all of the standard datagram features except broadcasting calls.</span></span> <span data-ttu-id="8d702-108">Além disso, observe que, no momento, o transporte de fila de mensagens não oferece suporte a pontos de extremidade dinâmicos.</span><span class="sxs-lookup"><span data-stu-id="8d702-108">Also, note that currently the message-queue transport does not support dynamic endpoints.</span></span>

<span data-ttu-id="8d702-109">Ao aplicar o \[ [](/windows/desktop/Midl/message) \] atributo Message a declarações de procedimento remoto no arquivo IDL, você implementa automaticamente o enfileiramento de mensagens em modo assíncrono para essas chamadas.</span><span class="sxs-lookup"><span data-stu-id="8d702-109">By applying the \[[**message**](/windows/desktop/Midl/message)\] attribute to remote procedure declarations in the IDL file, you automatically implement asynchronous-mode message queuing for those calls.</span></span> <span data-ttu-id="8d702-110">Isso possibilita que os aplicativos de cliente e de servidor controlem muitas das propriedades associadas a mensagens e filas de mensagens, incluindo:</span><span class="sxs-lookup"><span data-stu-id="8d702-110">This makes it possible for the client and server applications to control many of the properties associated with messages and message queues, including:</span></span>

-   <span data-ttu-id="8d702-111">Qualidade do serviço</span><span class="sxs-lookup"><span data-stu-id="8d702-111">Quality of service</span></span>
-   <span data-ttu-id="8d702-112">Confirmação de recebimento</span><span class="sxs-lookup"><span data-stu-id="8d702-112">Acknowledgment of receipt</span></span>
-   <span data-ttu-id="8d702-113">Registro no diário</span><span class="sxs-lookup"><span data-stu-id="8d702-113">Journaling</span></span>
-   <span data-ttu-id="8d702-114">Prioridade da chamada</span><span class="sxs-lookup"><span data-stu-id="8d702-114">Call priority</span></span>
-   <span data-ttu-id="8d702-115">Persistência da fila de processo do servidor</span><span class="sxs-lookup"><span data-stu-id="8d702-115">Persistence of Server Process Queue</span></span>

<span data-ttu-id="8d702-116">A qualidade do serviço é o esforço que o transporte fará para fornecer a chamada para o processo do servidor.</span><span class="sxs-lookup"><span data-stu-id="8d702-116">Quality of service is the effort that the transport will make to deliver the call to the server process.</span></span> <span data-ttu-id="8d702-117">Uma entrega expressa será enfileirada na memória, portanto, é bem rápida, mas a chamada será perdida se uma conexão de rede ou computador ficar inativa no horário errado.</span><span class="sxs-lookup"><span data-stu-id="8d702-117">An express delivery will be queued in memory, so it is fairly fast, but the call will be lost if a computer or network connection goes down at the wrong time.</span></span> <span data-ttu-id="8d702-118">Uma entrega recuperável será postada em um arquivo de disco até ser entregue, portanto, a chamada não será perdida, mesmo diante de uma falha do computador.</span><span class="sxs-lookup"><span data-stu-id="8d702-118">A recoverable delivery will be posted to a disk file until it is delivered, so the call will not be lost, even in the face of a computer crash.</span></span> <span data-ttu-id="8d702-119">Isso oferece entrega garantida, mas a um custo no desempenho conforme cada chamada é gravada no disco.</span><span class="sxs-lookup"><span data-stu-id="8d702-119">This gives guaranteed delivery, but at a cost in performance as each call is written to disk.</span></span>

<span data-ttu-id="8d702-120">Você também pode instruir o transporte MSMQ a aguardar a confirmação de que a chamada atingiu a fila de destino (servidor) antes de retornar.</span><span class="sxs-lookup"><span data-stu-id="8d702-120">You can also tell the MSMQ transport to wait for acknowledgment that the call reached the destination (server) queue before returning.</span></span> <span data-ttu-id="8d702-121">A escolha dessa opção bloqueia o cliente até que o servidor reconheça a chamada, caso contrário, o controle retorna ao cliente imediatamente após fazer a chamada.</span><span class="sxs-lookup"><span data-stu-id="8d702-121">Choosing this option blocks the client until the server acknowledges the call, otherwise control returns to the client immediately upon making the call.</span></span>

<span data-ttu-id="8d702-122">Usando o registro no diário, as chamadas podem ser registradas em disco.</span><span class="sxs-lookup"><span data-stu-id="8d702-122">By using journaling, calls can be logged to disk.</span></span> <span data-ttu-id="8d702-123">Se o registro no diário estiver ativado, cada chamada será registrada em disco conforme transmitida para o próximo salto em seu caminho para o processo do servidor.</span><span class="sxs-lookup"><span data-stu-id="8d702-123">If journaling is turned on, each call is logged to disk as it is transmitted to the next hop on its way to the server process.</span></span>

<span data-ttu-id="8d702-124">A prioridade de chamada pode ser usada em conjunto com o atributo de função de \[ [**mensagem**](/windows/desktop/Midl/message) RPC \] para permitir que chamadas com prioridade mais alta tenham precedência sobre chamadas com prioridade mais baixa, mesmo que as chamadas de alta prioridade cheguem mais tarde.</span><span class="sxs-lookup"><span data-stu-id="8d702-124">Call priority can be used in conjunction with the RPC \[[**message**](/windows/desktop/Midl/message)\] function attribute to allow calls with higher priority to take precedence over calls with lower priority, even if the high priority calls arrive later.</span></span> <span data-ttu-id="8d702-125">A prioridade de chamada também funcionará de forma limitada com o RPC síncrono, mas as chamadas RPC síncronas não podem ser empilhadas da mesma maneira que as chamadas assíncronas.</span><span class="sxs-lookup"><span data-stu-id="8d702-125">Call priority will also work in a limited fashion with synchronous RPC, but synchronous RPC calls cannot stack up in the same manner as asynchronous calls.</span></span>

<span data-ttu-id="8d702-126">O processo de cliente controla todas as propriedades acima chamando [**RpcBindingSetOption**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetoption).</span><span class="sxs-lookup"><span data-stu-id="8d702-126">The client process controls all of the above properties by calling [**RpcBindingSetOption**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetoption).</span></span> <span data-ttu-id="8d702-127">Depois de definido, essas propriedades permanecerão em vigor até que sejam alteradas em outra chamada para **RpcBindingSetOption**.</span><span class="sxs-lookup"><span data-stu-id="8d702-127">Once set, these properties remain in effect until they are changed in another call to **RpcBindingSetOption**.</span></span>

<span data-ttu-id="8d702-128">O processo do servidor RPC pode controlar o tempo de vida de sua fila de recebimento.</span><span class="sxs-lookup"><span data-stu-id="8d702-128">The RPC server process can control the lifetime of its receive queue.</span></span> <span data-ttu-id="8d702-129">Por padrão, a fila é excluída quando o processo do servidor é encerrado.</span><span class="sxs-lookup"><span data-stu-id="8d702-129">By default the queue is deleted when the server process exits.</span></span> <span data-ttu-id="8d702-130">No entanto, o processo do servidor pode usar [**RpcServerUseProtseqEpEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqepex) ao configurar seu ponto de extremidade para informar ao transporte para permitir que a fila continue existindo e para aceitar solicitações de chamada mesmo quando o processo do servidor não estiver em execução.</span><span class="sxs-lookup"><span data-stu-id="8d702-130">However, the server process can use [**RpcServerUseProtseqEpEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqepex) when setting up its endpoint to tell the transport to allow the queue to continue to exist and to accept call requests even when the server process is not running.</span></span> <span data-ttu-id="8d702-131">Nesse caso, as chamadas são enfileiradas e executadas posteriormente, quando o processo do servidor volta a ficar online.</span><span class="sxs-lookup"><span data-stu-id="8d702-131">In this case, the calls are queued up and executed later, when the server process comes back online.</span></span>

> [!Note]  
> <span data-ttu-id="8d702-132">Se você estiver usando chamadas de mensagens assíncronas \[ [](/windows/desktop/Midl/message) \] em uma interface, deverá registrar a interface chamando [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif) ou [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex) antes de chamar [**RpcServerUseProtseqEpEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqepex)**(ncadg \_ MQ)**.</span><span class="sxs-lookup"><span data-stu-id="8d702-132">If you are using asynchronous \[[**message**](/windows/desktop/Midl/message)\] calls in an interface, you must register the interface by calling [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif) or [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex) before calling [**RpcServerUseProtseqEpEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqepex)**(ncadg\_mq)**.</span></span> <span data-ttu-id="8d702-133">Depois de ativar a sequência de protocolo, todas as chamadas que já estiverem aguardando na fila para o servidor começarão a ser lidas na fila.</span><span class="sxs-lookup"><span data-stu-id="8d702-133">Once you turn on the protocol sequence, any calls already waiting on the queue for the server will begin to be read off the queue.</span></span> <span data-ttu-id="8d702-134">Se a interface RPC correspondente não tiver sido registrada, as chamadas falharão.</span><span class="sxs-lookup"><span data-stu-id="8d702-134">If the corresponding RPC interface has not been registered, the calls will fail.</span></span> <span data-ttu-id="8d702-135">Essa situação pode ocorrer se você tiver uma configuração de um ponto de extremidade permanente para suas chamadas de procedimento remoto, o servidor tiver sido desligado e os clientes continuarem a enviar chamadas para o servidor.</span><span class="sxs-lookup"><span data-stu-id="8d702-135">This situation can happen if you have a setup a permanent endpoint for your remote procedure calls, the server has been shut down, and clients have continued to send calls to the server.</span></span> <span data-ttu-id="8d702-136">Essas chamadas serão empilhadas na fila, aguardando para serem lidas quando o servidor ficar online novamente.</span><span class="sxs-lookup"><span data-stu-id="8d702-136">These calls will be stacked up in the queue, waiting to be read once the server comes back online.</span></span>

 

<span data-ttu-id="8d702-137">Para obter mais informações, consulte [**RpcBindingSetOption**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetoption), [**RpcServerUseProtseqEpEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqepex)e \[ [**Message**](/windows/desktop/Midl/message) \] , [**ncadg \_ MQ**](/windows/desktop/Midl/ncadg-mq).</span><span class="sxs-lookup"><span data-stu-id="8d702-137">For more information, see [**RpcBindingSetOption**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetoption), [**RpcServerUseProtseqEpEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqepex), and \[[**message**](/windows/desktop/Midl/message)\], [**ncadg\_mq**](/windows/desktop/Midl/ncadg-mq).</span></span>

 

 