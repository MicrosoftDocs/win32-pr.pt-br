---
title: Nomes de entidade
description: Para que um cliente crie uma sessão mutuamente autenticada com um programa de servidor, ele deve fornecer o nome principal esperado do servidor.
ms.assetid: 4d9977f8-0efb-4559-977e-3eba4e277bc0
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 554ffecff6eb019b4712e6b2d9f5c6319db492e7
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/16/2019
ms.locfileid: "104453698"
---
# <a name="principal-names"></a><span data-ttu-id="23b34-103">Nomes de entidade</span><span class="sxs-lookup"><span data-stu-id="23b34-103">Principal Names</span></span>

<span data-ttu-id="23b34-104">Para que um cliente crie uma sessão mutuamente autenticada com um programa de servidor, ele deve fornecer o nome principal esperado do servidor.</span><span class="sxs-lookup"><span data-stu-id="23b34-104">For a client to create a mutually authenticated session with a server program, it must provide the server's expected principal name.</span></span> <span data-ttu-id="23b34-105">Alguns protocolos, como o Kerberos, exigem um nome principal de servidor correto para qualquer sessão autenticada.</span><span class="sxs-lookup"><span data-stu-id="23b34-105">Some protocols, such as Kerberos, require a correct server principal name for any authenticated session.</span></span> <span data-ttu-id="23b34-106">Um principal é uma entidade que o sistema de segurança reconhece.</span><span class="sxs-lookup"><span data-stu-id="23b34-106">A principal is an entity that the security system recognizes.</span></span> <span data-ttu-id="23b34-107">Isso inclui usuários humanos, bem como serviços do sistema.</span><span class="sxs-lookup"><span data-stu-id="23b34-107">This includes human users as well as system services.</span></span> <span data-ttu-id="23b34-108">Todos os nomes de entidade usam um formato semelhante para um determinado SSP (provedor de suporte de segurança).</span><span class="sxs-lookup"><span data-stu-id="23b34-108">All principal names take similar format for a given security support provider (SSP).</span></span> <span data-ttu-id="23b34-109">Um SSP é um módulo de software que executa a validação de segurança.</span><span class="sxs-lookup"><span data-stu-id="23b34-109">An SSP is a software module that performs security validation.</span></span> <span data-ttu-id="23b34-110">Para obter mais informações, consulte [visão geral da arquitetura SSPI](sspi-architectural-overview.md).</span><span class="sxs-lookup"><span data-stu-id="23b34-110">For more information, see [SSPI Architectural Overview](sspi-architectural-overview.md).</span></span> <span data-ttu-id="23b34-111">Para manter a uniformidade, um provedor de segurança geralmente fornece nomes semelhantes aos serviços do sistema como usuários.</span><span class="sxs-lookup"><span data-stu-id="23b34-111">To maintain uniformity, a security provider usually gives system services similar names as users.</span></span> <span data-ttu-id="23b34-112">Em alguns provedores de segurança, os serviços do sistema podem não ter um nome principal.</span><span class="sxs-lookup"><span data-stu-id="23b34-112">Under some security providers, system services may not have a principal name.</span></span>

<span data-ttu-id="23b34-113">O servidor registra seu nome principal para o provedor de segurança usando a função [**RpcServerRegisterAuthInfo**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterauthinfo) .</span><span class="sxs-lookup"><span data-stu-id="23b34-113">The server registers its principal name for the security provider using the [**RpcServerRegisterAuthInfo**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterauthinfo) function.</span></span> <span data-ttu-id="23b34-114">Somente um nome principal de servidor pode ser usado para cada provedor de segurança.</span><span class="sxs-lookup"><span data-stu-id="23b34-114">Only one server principal name can be used for each security provider.</span></span> <span data-ttu-id="23b34-115">Se mais de um nome for registrado, um nome será escolhido e usado aleatoriamente.</span><span class="sxs-lookup"><span data-stu-id="23b34-115">If more than one name is registered, one name is randomly chosen and used.</span></span> <span data-ttu-id="23b34-116">O SSP determina o formato do nome principal.</span><span class="sxs-lookup"><span data-stu-id="23b34-116">The SSP dictates the format of the principal name.</span></span> <span data-ttu-id="23b34-117">Por exemplo, o Kerberos/negociar SSPs para um serviço do sistema é semelhante ao seguinte: nome do computador \_ $ @childdomain.parentdomain1.parentdomain2.COM .</span><span class="sxs-lookup"><span data-stu-id="23b34-117">For example, the Kerberos/Negotiate SSPs for a system service look approximately like the following: machine\_name$@childdomain.parentdomain1.parentdomain2.COM.</span></span>

<span data-ttu-id="23b34-118">O procedimento recomendado para gerar nomes de entidade de segurança é usar APIs documentadas (como a função **DsMakeSpn** ), em vez de compondo juntos o nome da entidade de segurança de cadeias de caracteres.</span><span class="sxs-lookup"><span data-stu-id="23b34-118">The recommended procedure for generating principal names is to use documented APIs (such as the **DsMakeSpn** function), rather than piecing together the principal name from strings.</span></span> <span data-ttu-id="23b34-119">O uso de APIs documentadas aumenta a portabilidade entre diferentes ambientes de implantação e elimina a possibilidade de erros.</span><span class="sxs-lookup"><span data-stu-id="23b34-119">Using documented APIs increases portability between different deployment environments and eliminates the possibility for errors.</span></span>

<span data-ttu-id="23b34-120">Especificar um nome de entidade incorreto pode impedir que o cliente e o servidor estabeleçam uma sessão autenticada.</span><span class="sxs-lookup"><span data-stu-id="23b34-120">Specifying an incorrect principal name may prevent the client and server from establishing an authenticated session.</span></span> <span data-ttu-id="23b34-121">O SSP do SCHANNEL usa os nomes principais em uma das duas formas:</span><span class="sxs-lookup"><span data-stu-id="23b34-121">The SCHANNEL SSP takes principal names in either of two forms:</span></span>

-   <span data-ttu-id="23b34-122">O primeiro formulário do nome principal do SCHANNEL é o formulário [*msstd*](m-glos.md) .</span><span class="sxs-lookup"><span data-stu-id="23b34-122">The first SCHANNEL principal name form is the [*msstd*](m-glos.md) form.</span></span> <span data-ttu-id="23b34-123">Os nomes no formulário msstd geralmente seguem o padrão msstd:servername@serverdomain.com .</span><span class="sxs-lookup"><span data-stu-id="23b34-123">Names in msstd form generally follow the pattern msstd:servername@serverdomain.com.</span></span> <span data-ttu-id="23b34-124">Isso é conhecido como uma propriedade de nome de email.</span><span class="sxs-lookup"><span data-stu-id="23b34-124">This is referred to as an email name property.</span></span> <span data-ttu-id="23b34-125">Se o certificado contiver uma propriedade de nome de email e contiver o sinal de arroba (@), o nome da entidade será msstd: nome de email.</span><span class="sxs-lookup"><span data-stu-id="23b34-125">If the certificate contains an email name property, and it contains the at sign (@), the principal name is msstd:email name.</span></span> <span data-ttu-id="23b34-126">Caso contrário, ele deve conter a propriedade nome comum.</span><span class="sxs-lookup"><span data-stu-id="23b34-126">Otherwise it must contain the common name property.</span></span> <span data-ttu-id="23b34-127">As barras invertidas internas são duplicadas, assim como nas associações de cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="23b34-127">Internal backslashes are doubled, just as in string bindings.</span></span>
-   <span data-ttu-id="23b34-128">O segundo formulário de nome principal de SCHANNEL é o formulário [*fullsic*](f-glos.md) .</span><span class="sxs-lookup"><span data-stu-id="23b34-128">The second SCHANNEL principal name form is the [*fullsic*](f-glos.md) form.</span></span> <span data-ttu-id="23b34-129">Esta é uma série de nomes em conformidade com RFC1779 limitados por colchetes angulares e separados por barras invertidas.</span><span class="sxs-lookup"><span data-stu-id="23b34-129">This is a series of RFC1779-compliant names bounded by angle brackets and separated by backslashes.</span></span> <span data-ttu-id="23b34-130">Normalmente, segue o padrão fullsic: \\ < \\ Authority \\ subauthority \\ . \\ ... Pessoa> ou fullsic: \\ < \\ autoridade de certificação \\ .. \\ .. \\> ServerProgram.</span><span class="sxs-lookup"><span data-stu-id="23b34-130">It typically follows the pattern fullsic:\\<\\Authority\\SubAuthority\\.....\\Person> or fullsic:\\<\\Authority\\SubAuthority\\.....\\ServerProgram>.</span></span>

<span data-ttu-id="23b34-131">Se o nome não corresponder ao certificado, o \_ acesso \_ negado ao erro será retornado.</span><span class="sxs-lookup"><span data-stu-id="23b34-131">If the name does not match the certificate, ERROR\_ACCESS\_DENIED is returned.</span></span> <span data-ttu-id="23b34-132">Se o formato de nome for inválido, o SSP do SCHANNEL retornará o parâmetro de erro de código \_ inválido \_ .</span><span class="sxs-lookup"><span data-stu-id="23b34-132">If the name format is invalid, SCHANNEL SSP returns the code ERROR\_INVALID\_PARAMETER.</span></span>

<span data-ttu-id="23b34-133">Para consultar o nome principal do servidor, os aplicativos podem chamar [**RpcMgmtInqServerPrincName**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcmgmtinqserverprincname).</span><span class="sxs-lookup"><span data-stu-id="23b34-133">To query for the server's principal name, applications can call [**RpcMgmtInqServerPrincName**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcmgmtinqserverprincname).</span></span> <span data-ttu-id="23b34-134">Isso aloca uma cadeia de caracteres terminada em nulo para conter o nome da entidade de segurança.</span><span class="sxs-lookup"><span data-stu-id="23b34-134">This allocates a null-terminated string to hold the principal name.</span></span> <span data-ttu-id="23b34-135">Antes de ser encerrado, seu aplicativo deve invocar [**RpcStringFree**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcstringfree) para liberar a memória ocupada por essa cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="23b34-135">Before it terminates, your application must invoke [**RpcStringFree**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcstringfree) to release the memory this string occupies.</span></span>

<span data-ttu-id="23b34-136">Consultar o nome do servidor dessa maneira não é seguro e deve ser evitado.</span><span class="sxs-lookup"><span data-stu-id="23b34-136">Querying for the server name in this manner is not secure and should be avoided.</span></span> <span data-ttu-id="23b34-137">Para a autenticação de servidor, o programa cliente deve saber a qual servidor ele está se conectando e deve criar o nome principal do servidor do zero.</span><span class="sxs-lookup"><span data-stu-id="23b34-137">For server authentication, the client program should know which server it is connecting to and should create the server principal name from scratch.</span></span>

 

 




