---
title: Gerenciando conjuntos de conexões de rede (associações)
description: A partir do Windows 2000, o tempo de execução do RPC pode manter mais de uma conexão entre o cliente e o servidor.
ms.assetid: 9b9c42e9-8ed5-46a6-b6ec-4093ce0128bb
keywords:
- Gerenciando conjuntos de conexões de rede
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 81e99afe23d90e44d85dc7a2ec9301b45e1f20b1
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/16/2019
ms.locfileid: "104160168"
---
# <a name="managing-network-connection-sets-associations"></a><span data-ttu-id="b5b4d-104">Gerenciando conjuntos de conexões de rede (associações)</span><span class="sxs-lookup"><span data-stu-id="b5b4d-104">Managing Network Connection Sets (Associations)</span></span>

<span data-ttu-id="b5b4d-105">A partir do Windows 2000, o tempo de execução do RPC pode manter mais de uma conexão entre o cliente e o servidor.</span><span class="sxs-lookup"><span data-stu-id="b5b4d-105">Starting with Windows 2000, the RPC run time may maintain more than one connection between the client and the server.</span></span> <span data-ttu-id="b5b4d-106">Isso facilita a operação em transportes que não dão suporte à alteração da identidade do cliente sem restabelecer a conexão, clientes multithread e clientes assíncronos.</span><span class="sxs-lookup"><span data-stu-id="b5b4d-106">This facilitates operation on transports that do not support changing the client identity without reestablishing the connection, multithreaded clients, and asynchronous clients.</span></span> <span data-ttu-id="b5b4d-107">O conjunto de conexões entre um processo de cliente e um ponto de extremidade do servidor é chamado de *Associação* na terminologia do RPC.</span><span class="sxs-lookup"><span data-stu-id="b5b4d-107">The set of connections between a client process and a server endpoint is called an *association* in RPC terminology.</span></span> <span data-ttu-id="b5b4d-108">Entender as associações pode melhorar a implementação do RPC.</span><span class="sxs-lookup"><span data-stu-id="b5b4d-108">Understanding associations can improve the implementation of RPC.</span></span>

<span data-ttu-id="b5b4d-109">Em um cenário de identidade de único thread, de cliente único, o RPC abre uma conexão entre um processo de cliente e um ponto de extremidade do servidor para fazer chamadas RPC.</span><span class="sxs-lookup"><span data-stu-id="b5b4d-109">In a single-thread, single-client identity scenario, RPC opens one connection between a client process and a server endpoint to make RPC calls.</span></span> <span data-ttu-id="b5b4d-110">Quando uma chamada RPC síncrona é feita, o cliente envia a solicitação ao servidor nessa conexão e também recebe a resposta nela.</span><span class="sxs-lookup"><span data-stu-id="b5b4d-110">When a synchronous RPC call is made, the client sends the request to the server on this connection, and receives the reply on it as well.</span></span> <span data-ttu-id="b5b4d-111">Quando o número de threads que fazem chamadas RPC no processo do cliente aumenta, a identidade de segurança do cliente pode ser alterada.</span><span class="sxs-lookup"><span data-stu-id="b5b4d-111">When the number of threads making RPC calls in the client process grows, the security identity of the client can change.</span></span> <span data-ttu-id="b5b4d-112">Quando as chamadas assíncronas/de pipe são misturadas com chamadas síncronas no cliente, a RPC pode precisar de mais de uma conexão de rede.</span><span class="sxs-lookup"><span data-stu-id="b5b4d-112">When asynchronous/pipe calls are mixed with synchronous calls on the client, RPC may need more than one network connection.</span></span> <span data-ttu-id="b5b4d-113">Todas as conexões no conjunto são colocadas em um pool de conexões chamado associação.</span><span class="sxs-lookup"><span data-stu-id="b5b4d-113">All connections in the set are put in a connection pool called an association.</span></span>

<span data-ttu-id="b5b4d-114">Uma chamada de procedimento remoto síncrona usa exclusivamente uma determinada conexão para estar em conformidade com os padrões de RPC.</span><span class="sxs-lookup"><span data-stu-id="b5b4d-114">A synchronous remote procedure call exclusively uses a given connection to conform with RPC standards.</span></span> <span data-ttu-id="b5b4d-115">Uma conexão usada por uma chamada RPC síncrona será considerada ocupada se uma solicitação tiver sido enviada, mas uma resposta não tiver sido recebida.</span><span class="sxs-lookup"><span data-stu-id="b5b4d-115">A connection used by a synchronous RPC call is considered busy if a request has been sent, but a response has not been received.</span></span> <span data-ttu-id="b5b4d-116">Nenhum outro tráfego é permitido nessa conexão até que a resposta seja recebida.</span><span class="sxs-lookup"><span data-stu-id="b5b4d-116">No other traffic is allowed on that connection until the response is received.</span></span> <span data-ttu-id="b5b4d-117">O tempo de execução de RPC tenta multiplexar chamadas de RPC assíncronas e de pipe na mesma conexão.</span><span class="sxs-lookup"><span data-stu-id="b5b4d-117">The RPC run time attempts to multiplex asynchronous and pipe RPC calls on the same connection.</span></span> <span data-ttu-id="b5b4d-118">Chamadas síncronas e assíncronas/de pipe não podem ser misturadas na mesma conexão, o que significa que uma determinada conexão pode ser usada para chamadas RPC síncronas ou para chamadas RPC assíncronas/de pipe.</span><span class="sxs-lookup"><span data-stu-id="b5b4d-118">Synchronous and asynchronous/pipe calls cannot be mixed on the same connection, which means that a given connection can be used for either synchronous RPC calls or for asynchronous/pipe RPC calls.</span></span>

<span data-ttu-id="b5b4d-119">O RPC tenta agressivamente a reutilização de conexões do pool.</span><span class="sxs-lookup"><span data-stu-id="b5b4d-119">RPC aggressively tries to reuse connections from the pool.</span></span> <span data-ttu-id="b5b4d-120">Quando uma nova chamada RPC é feita, o RPC tenta encontrar uma conexão adequada do pool e cria uma nova conexão somente se uma conexão adequada não puder ser encontrada.</span><span class="sxs-lookup"><span data-stu-id="b5b4d-120">When a new RPC call is made, RPC attempts to find a suitable connection from the pool, and creates a new connection only if a suitable connection cannot be found.</span></span> <span data-ttu-id="b5b4d-121">Para que uma conexão seja considerada adequada, ela deve:</span><span class="sxs-lookup"><span data-stu-id="b5b4d-121">For a connection to be considered suitable, it must:</span></span>

-   <span data-ttu-id="b5b4d-122">Ser do tipo apropriado (síncrono ou assíncrono/pipe).</span><span class="sxs-lookup"><span data-stu-id="b5b4d-122">Be of the appropriate type (synchronous, or asynchronous/pipe).</span></span>
-   <span data-ttu-id="b5b4d-123">Seja gratuito.</span><span class="sxs-lookup"><span data-stu-id="b5b4d-123">Be free.</span></span>
-   <span data-ttu-id="b5b4d-124">Ter a mesma identidade de segurança que o identificador de associação no qual a chamada é feita.</span><span class="sxs-lookup"><span data-stu-id="b5b4d-124">Have the same security identity as the binding handle on which the call is made.</span></span> <span data-ttu-id="b5b4d-125">Se o controle de identidade dinâmico for usado, a identidade do identificador de associação será atualizada a partir do token de thread no início da chamada.</span><span class="sxs-lookup"><span data-stu-id="b5b4d-125">If dynamic identity tracking is used, the identity of the binding handle is refreshed from the thread token at the beginning of the call.</span></span> <span data-ttu-id="b5b4d-126">Se o rastreamento de identidade estático for usado, a identidade do cliente carimbada no identificador de associação será usada.</span><span class="sxs-lookup"><span data-stu-id="b5b4d-126">If static identity tracking is used, the client identity stamped on the binding handle is used.</span></span>

<span data-ttu-id="b5b4d-127">Quando a chamada for concluída, quando a resposta for recebida, a conexão será marcada como livre e poderá ser usada para outras chamadas RPC.</span><span class="sxs-lookup"><span data-stu-id="b5b4d-127">When the call is complete, once the response is received, the connection is marked as free and can be used for other RPC calls.</span></span>

<span data-ttu-id="b5b4d-128">A identidade de segurança em uma conexão não pode ser alterada.</span><span class="sxs-lookup"><span data-stu-id="b5b4d-128">The security identity on a connection cannot change.</span></span> <span data-ttu-id="b5b4d-129">Por exemplo, se um grande número de chamadas para o mesmo servidor for feito sob diferentes identidades de segurança, o número de conexões no pool de threads aumentará.</span><span class="sxs-lookup"><span data-stu-id="b5b4d-129">For example, if a large number of calls to the same server are made under different security identities, the number of connections in the thread pool grows.</span></span> <span data-ttu-id="b5b4d-130">A associação em si é de referência-contada e, quando todas as referências forem canceladas, ela parará e fechará todas as conexões.</span><span class="sxs-lookup"><span data-stu-id="b5b4d-130">The association itself is reference-counted, and when all references are gone, it stops and closes all connections.</span></span> <span data-ttu-id="b5b4d-131">Cada identificador de associação e cada manipulador de contexto mantêm uma referência na associação.</span><span class="sxs-lookup"><span data-stu-id="b5b4d-131">Every binding handle and every context handle hold a reference on the association.</span></span> <span data-ttu-id="b5b4d-132">Quando todos são fechados, a associação desaparece.</span><span class="sxs-lookup"><span data-stu-id="b5b4d-132">When all are closed, the association disappears.</span></span> <span data-ttu-id="b5b4d-133">No Windows XP, as associações não necessariamente desaparecem imediatamente; Eles podem permanecer por um curto período (o período de destino é de 20 segundos, mas o tempo de execução RPC pode optar por atrasar a destruição da Associação se nenhum thread estiver disponível para executar a tarefa).</span><span class="sxs-lookup"><span data-stu-id="b5b4d-133">On Windows XP, associations do not necessarily disappear immediately; they may remain for a short period (the target period is 20 seconds, but the RPC run time may choose to delay destroying the association if no threads are available to execute the task).</span></span> <span data-ttu-id="b5b4d-134">Se você não quiser que a associação fique ativa depois que o último identificador de contexto/identificador de associação for fechado, use \_ a \_ opção RPC C opt não \_ \_ persistente para forçar o tempo de execução RPC a fechar imediatamente a conexão.</span><span class="sxs-lookup"><span data-stu-id="b5b4d-134">If you do not want the association to stay alive after the last context handle/binding handle is closed, use the RPC\_C\_OPT\_DONT\_LINGER option to force the RPC Runtime to immediately close the connection.</span></span>

 

 




