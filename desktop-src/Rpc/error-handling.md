---
title: Tratamento de erro (RPC)
description: No RPC síncrono, um cliente faz uma chamada remota que retorna com um código de êxito ou de falha.
ms.assetid: 7dfc9f84-ce3c-49f3-8f72-b212095133fd
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 017892b94438cc73f88cbfe60c03c088bf3ebcc9
ms.sourcegitcommit: 8fa6614b715bddf14648cce36d2df22e5232801a
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/10/2020
ms.locfileid: "104008772"
---
# <a name="error-handling-rpc"></a><span data-ttu-id="69ec5-103">Tratamento de erro (RPC)</span><span class="sxs-lookup"><span data-stu-id="69ec5-103">Error Handling (RPC)</span></span>

<span data-ttu-id="69ec5-104">No RPC síncrono, um cliente faz uma chamada remota que retorna com um código de êxito ou de falha.</span><span class="sxs-lookup"><span data-stu-id="69ec5-104">In synchronous RPC, a client makes a remote call that returns with either a success or failure code.</span></span> <span data-ttu-id="69ec5-105">O RPC assíncrono fornece mais oportunidades para uma chamada falhar e essas falhas são tratadas de forma diferente, dependendo de onde e quando elas ocorrem.</span><span class="sxs-lookup"><span data-stu-id="69ec5-105">Asynchronous RPC provides more opportunities for a call to fail, and these failures are handled differently, depending on where and when they occur.</span></span> <span data-ttu-id="69ec5-106">A tabela a seguir descreve as maneiras em que uma chamada pode falhar e como ela é manipulada.</span><span class="sxs-lookup"><span data-stu-id="69ec5-106">The following table describes the ways in which a call can fail, and how it is handled.</span></span>

## <a name="client-side-cleanup"></a><span data-ttu-id="69ec5-107">Limpeza do lado do cliente</span><span class="sxs-lookup"><span data-stu-id="69ec5-107">Client-side Cleanup</span></span>



| <span data-ttu-id="69ec5-108">Sintoma de falha</span><span class="sxs-lookup"><span data-stu-id="69ec5-108">Failure symptom</span></span>                                                                                                                                  | <span data-ttu-id="69ec5-109">Limpeza</span><span class="sxs-lookup"><span data-stu-id="69ec5-109">Cleanup</span></span>                                                                                                                         |
|--------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="69ec5-110">O cliente captura uma exceção ao chamar o procedimento remoto.</span><span class="sxs-lookup"><span data-stu-id="69ec5-110">Client catches an exception when it calls the remote procedure.</span></span>                                                                                  | <span data-ttu-id="69ec5-111">Não são necessárias chamadas à API RPC.</span><span class="sxs-lookup"><span data-stu-id="69ec5-111">No RPC API calls are necessary.</span></span> <span data-ttu-id="69ec5-112">Todo o estado de RPC foi limpo.</span><span class="sxs-lookup"><span data-stu-id="69ec5-112">All RPC state has been cleaned up.</span></span>                                                              |
| <span data-ttu-id="69ec5-113">O cliente recebe uma notificação de chamada completa, mas quando chama [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall), ele recebe um código de erro.</span><span class="sxs-lookup"><span data-stu-id="69ec5-113">Client receives a call complete notification, but when it calls [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall), it receives an error code.</span></span> | <span data-ttu-id="69ec5-114">Não são necessárias chamadas à API RPC.</span><span class="sxs-lookup"><span data-stu-id="69ec5-114">No RPC API calls are necessary.</span></span> <span data-ttu-id="69ec5-115">Todo o estado de RPC foi limpo.</span><span class="sxs-lookup"><span data-stu-id="69ec5-115">All RPC state has been cleaned up.</span></span>                                                              |
| <span data-ttu-id="69ec5-116">O cliente emite um cancelamento não anulado ou anulado.</span><span class="sxs-lookup"><span data-stu-id="69ec5-116">Client issues non-abortive or abortive cancel.</span></span>                                                                                                   | <span data-ttu-id="69ec5-117">O cliente deve aguardar a notificação e chamar [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall) quando a notificação chegar.</span><span class="sxs-lookup"><span data-stu-id="69ec5-117">Client must wait for notification, and call [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall) when the notification arrives.</span></span> |



 

<span data-ttu-id="69ec5-118">Na limpeza do lado do servidor, um conceito fundamental é o ponto de distribuição.</span><span class="sxs-lookup"><span data-stu-id="69ec5-118">In server side cleanup, a key concept is the hand-off point.</span></span> <span data-ttu-id="69ec5-119">Durante o processamento do lado do servidor de uma chamada assíncrona, um processamento geralmente é executado no thread que recebeu a chamada (também conhecida como *thread Dispatcher*) e, opcionalmente, o thread Dispatcher coloca o estado suficiente em um bloco de memória e sinaliza outro thread (também conhecido como *thread de trabalho*) para continuar o processamento para a chamada.</span><span class="sxs-lookup"><span data-stu-id="69ec5-119">During the server side processing of an asynchronous call, some processing is usually performed on the thread that received the call (also known as the *dispatcher thread*), and then, optionally, the dispatcher thread puts enough state into a memory block and signals another thread (also known as *worker thread*) to continue processing for the call.</span></span> <span data-ttu-id="69ec5-120">O momento em que o thread Dispatcher sinaliza com êxito que o thread de trabalho é chamado de *ponto de entrega*.</span><span class="sxs-lookup"><span data-stu-id="69ec5-120">The moment at which the dispatcher thread successfully signals that the worker thread is called the *hand-off point*.</span></span>

## <a name="server-side-cleanup"></a><span data-ttu-id="69ec5-121">Limpeza do lado do servidor</span><span class="sxs-lookup"><span data-stu-id="69ec5-121">Server Side Cleanup</span></span>



| <span data-ttu-id="69ec5-122">Erro encontrado</span><span class="sxs-lookup"><span data-stu-id="69ec5-122">Error encountered</span></span>      | <span data-ttu-id="69ec5-123">Limpeza</span><span class="sxs-lookup"><span data-stu-id="69ec5-123">Cleanup</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="69ec5-124">Antes do ponto de distribuição.</span><span class="sxs-lookup"><span data-stu-id="69ec5-124">Before hand-off point.</span></span> | <span data-ttu-id="69ec5-125">Exceção de geração.</span><span class="sxs-lookup"><span data-stu-id="69ec5-125">Throw exception.</span></span> <span data-ttu-id="69ec5-126">Nenhuma chamada para [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall) é necessária.</span><span class="sxs-lookup"><span data-stu-id="69ec5-126">No call to [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall) is necessary.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| <span data-ttu-id="69ec5-127">Após o ponto de entrega.</span><span class="sxs-lookup"><span data-stu-id="69ec5-127">After hand-off point.</span></span>  | <span data-ttu-id="69ec5-128">Chame [**RpcAsyncAbortCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasyncabortcall) ou, se o erro não for fatal, e os resultados ainda poderão ser retornados ao cliente, [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall).</span><span class="sxs-lookup"><span data-stu-id="69ec5-128">Call [**RpcAsyncAbortCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasyncabortcall) or, if the error is not fatal and results can still be returned to the client, [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall).</span></span> <span data-ttu-id="69ec5-129">Se a chamada de função **RpcAsyncCompleteCall** falhar, o tempo de execução RPC liberará os parâmetros.</span><span class="sxs-lookup"><span data-stu-id="69ec5-129">If the **RpcAsyncCompleteCall** function call fails, the RPC runtime frees the parameters.</span></span> <span data-ttu-id="69ec5-130">O usuário não deve acessar esses parâmetros.</span><span class="sxs-lookup"><span data-stu-id="69ec5-130">The user must not access those parameters.</span></span> <span data-ttu-id="69ec5-131">O thread do Dispatcher não deve executar nenhum processamento substancial que possa falhar após o ponto de desligamento, porque ele não pode mais anular a chamada com segurança.</span><span class="sxs-lookup"><span data-stu-id="69ec5-131">The dispatcher thread must not perform any substantial processing that may fail after the hand off point, because it no longer can safely abort the call.</span></span> <span data-ttu-id="69ec5-132">Especificamente, ele não deve lançar uma exceção após o ponto de desligamento ou o servidor pode falhar.</span><span class="sxs-lookup"><span data-stu-id="69ec5-132">Specifically, it must not throw an exception after the hand off point, or the server may crash.</span></span> |



 

## <a name="special-error-handling-cases-for-pipes"></a><span data-ttu-id="69ec5-133">Casos de tratamento de erros especiais para pipes</span><span class="sxs-lookup"><span data-stu-id="69ec5-133">Special Error Handling Cases for Pipes</span></span>

<span data-ttu-id="69ec5-134">Há casos especiais para tratamento de erros ao usar pipes.</span><span class="sxs-lookup"><span data-stu-id="69ec5-134">There are special cases for error handling when using pipes.</span></span> <span data-ttu-id="69ec5-135">A lista a seguir explica a origem da falha e como tratar o erro.</span><span class="sxs-lookup"><span data-stu-id="69ec5-135">The following list explains the source of the failure, and how to handle the error.</span></span>



| <span data-ttu-id="69ec5-136">Origem da falha</span><span class="sxs-lookup"><span data-stu-id="69ec5-136">Source of failure</span></span>                                                                                                 | <span data-ttu-id="69ec5-137">Como Tratado</span><span class="sxs-lookup"><span data-stu-id="69ec5-137">How handled</span></span>                                                                                                |
|-------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="69ec5-138">O cliente chama push e a chamada falha.</span><span class="sxs-lookup"><span data-stu-id="69ec5-138">Client calls push and the call fails.</span></span>                                                                             | <span data-ttu-id="69ec5-139">Não são necessárias chamadas à API RPC.</span><span class="sxs-lookup"><span data-stu-id="69ec5-139">No RPC API calls are necessary.</span></span> <span data-ttu-id="69ec5-140">Todo o estado de RPC foi limpo.</span><span class="sxs-lookup"><span data-stu-id="69ec5-140">All RPC state has been cleaned up.</span></span>                                         |
| <span data-ttu-id="69ec5-141">O cliente chama [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall) antes de os pipes [**em**](/windows/desktop/Midl/in) serem descarregados.</span><span class="sxs-lookup"><span data-stu-id="69ec5-141">Client calls [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall) before the [**in**](/windows/desktop/Midl/in) pipes are drained.</span></span> | <span data-ttu-id="69ec5-142">A chamada falha com o código de erro de preenchimento de pipe apropriado.</span><span class="sxs-lookup"><span data-stu-id="69ec5-142">Call fails with the appropriate pipe-filling error code.</span></span>                                                   |
| <span data-ttu-id="69ec5-143">O cliente chama pull e a chamada falha.</span><span class="sxs-lookup"><span data-stu-id="69ec5-143">Client calls pull and the call fails.</span></span>                                                                             | <span data-ttu-id="69ec5-144">Não são necessárias chamadas à API RPC.</span><span class="sxs-lookup"><span data-stu-id="69ec5-144">No RPC API calls are necessary.</span></span> <span data-ttu-id="69ec5-145">Todo o estado de RPC foi limpo.</span><span class="sxs-lookup"><span data-stu-id="69ec5-145">All RPC state has been cleaned up.</span></span>                                         |
| <span data-ttu-id="69ec5-146">O cliente ou o servidor chama Push ou pull na ordem errada.</span><span class="sxs-lookup"><span data-stu-id="69ec5-146">Either client or server calls push or pull in the wrong order.</span></span>                                                    | <span data-ttu-id="69ec5-147">Tempo de execução retorna o status de erro de preenchimento de pipe.</span><span class="sxs-lookup"><span data-stu-id="69ec5-147">Run-time returns pipe-filling error status.</span></span>                                                                |
| <span data-ttu-id="69ec5-148">O servidor chama Push ou pull e a chamada falha.</span><span class="sxs-lookup"><span data-stu-id="69ec5-148">Server calls push or pull and the call fails.</span></span>                                                                     | <span data-ttu-id="69ec5-149">Push retorna um código de falha.</span><span class="sxs-lookup"><span data-stu-id="69ec5-149">Push returns a failure code.</span></span> <span data-ttu-id="69ec5-150">Nenhuma chamada para [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall) é necessária.</span><span class="sxs-lookup"><span data-stu-id="69ec5-150">No call to [**RpcAsyncCompleteCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall) is necessary.</span></span> |
| <span data-ttu-id="69ec5-151">O servidor chama **RpcAsyncCompleteCall** antes que os pipes sejam drenados.</span><span class="sxs-lookup"><span data-stu-id="69ec5-151">Server calls **RpcAsyncCompleteCall** before the pipes have been drained.</span></span>                                         | <span data-ttu-id="69ec5-152">A chamada de pipe retorna um status de erro de preenchimento de pipe.</span><span class="sxs-lookup"><span data-stu-id="69ec5-152">The pipe call returns a pipe filling error status.</span></span>                                                         |
| <span data-ttu-id="69ec5-153">Após a expedição, uma operação de recebimento falhará.</span><span class="sxs-lookup"><span data-stu-id="69ec5-153">After the dispatch, a receive operation fails.</span></span>                                                                    | <span data-ttu-id="69ec5-154">Na próxima vez que o servidor chamar pull para receber dados do pipe, um erro será retornado.</span><span class="sxs-lookup"><span data-stu-id="69ec5-154">The next time the server calls pull to receive pipe data, an error is returned.</span></span>                            |



 

 

 
