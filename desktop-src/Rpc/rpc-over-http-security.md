---
title: Segurança de RPC sobre HTTP
description: O RPC sobre HTTP fornece três tipos de segurança, além da segurança RPC padrão, o que resulta na proteção do tráfego RPC sobre HTTP uma vez por RPC e, em seguida, com proteção dupla pelo mecanismo de encapsulamento fornecido pelo RPC sobre HTTP.
ms.assetid: 3a44c72b-b74c-433a-8826-1f76ca019f40
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 527cf5ff74120c41606d83a248e355a6ea46d9d5
ms.sourcegitcommit: 5b98bf8c68922f8f03c14f793fbe17504900559c
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 02/12/2021
ms.locfileid: "104172437"
---
# <a name="rpc-over-http-security"></a><span data-ttu-id="541af-103">Segurança de RPC sobre HTTP</span><span class="sxs-lookup"><span data-stu-id="541af-103">RPC over HTTP Security</span></span>

<span data-ttu-id="541af-104">O RPC sobre HTTP fornece três tipos de segurança, além da segurança RPC padrão, o que resulta na proteção do tráfego RPC sobre HTTP uma vez por RPC e, em seguida, com proteção dupla pelo mecanismo de encapsulamento fornecido pelo RPC sobre HTTP.</span><span class="sxs-lookup"><span data-stu-id="541af-104">RPC over HTTP provides three types of security in addition to standard RPC security, which results in RPC over HTTP traffic being protected once by RPC, and then doubly protected by the tunneling mechanism provided by RPC over HTTP.</span></span> <span data-ttu-id="541af-105">Para obter uma descrição dos mecanismos de segurança RPC padrão, consulte [segurança](security.md).</span><span class="sxs-lookup"><span data-stu-id="541af-105">For a description of standard RPC security mechanisms, see [Security](security.md).</span></span> <span data-ttu-id="541af-106">O mecanismo de túnel RPC sobre HTTP adiciona à segurança RPC normal da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="541af-106">The RPC over HTTP tunneling mechanism adds to normal RPC security in the following manner:</span></span>

-   <span data-ttu-id="541af-107">Fornece segurança através do IIS (disponível somente para RPC sobre HTTP v2).</span><span class="sxs-lookup"><span data-stu-id="541af-107">Provides security through the IIS (available for RPC over HTTP v2 only).</span></span>
-   <span data-ttu-id="541af-108">Fornece criptografia SSL e verificação de proxy RPC (autenticação mútua).</span><span class="sxs-lookup"><span data-stu-id="541af-108">Provides SSL encryption and RPC Proxy verification (mutual authentication).</span></span> <span data-ttu-id="541af-109">Também disponível somente no RPC por HTTP v2.</span><span class="sxs-lookup"><span data-stu-id="541af-109">Also available in RPC over HTTP v2 only.</span></span>
-   <span data-ttu-id="541af-110">Fornece restrições sobre o nível de proxy RPC que determina quais computadores na rede do servidor têm permissão para receber RPC sobre chamadas HTTP.</span><span class="sxs-lookup"><span data-stu-id="541af-110">Provides restrictions on the RPC Proxy level dictating which machines on the server network are allowed to receive RPC over HTTP calls.</span></span>

<span data-ttu-id="541af-111">Cada um desses três recursos de segurança é descrito mais detalhadamente nas seções a seguir.</span><span class="sxs-lookup"><span data-stu-id="541af-111">Each of these three security features is described in more detail in following sections.</span></span>

## <a name="iis-authentication"></a><span data-ttu-id="541af-112">Autenticação IIS</span><span class="sxs-lookup"><span data-stu-id="541af-112">IIS Authentication</span></span>

<span data-ttu-id="541af-113">O RPC sobre HTTP pode aproveitar o mecanismo de autenticação normal do IIS.</span><span class="sxs-lookup"><span data-stu-id="541af-113">RPC over HTTP can leverage the normal authentication mechanism of IIS.</span></span> <span data-ttu-id="541af-114">O diretório virtual para proxy RPC pode ser configurado usando o nó RPC no site padrão no snap-in IIS MMC:</span><span class="sxs-lookup"><span data-stu-id="541af-114">The virtual directory for RPC Proxy can be configured using the Rpc node under the Default Web Site in the IIS MMC snap-in:</span></span>

![Captura de tela mostrando o nó RPC no site da Web padrão no snap-in do MMC do IIS.](images/rpc-http-1.png)

<span data-ttu-id="541af-116">O IIS pode ser configurado para desabilitar o acesso anônimo e exigir autenticação para o diretório virtual para o proxy RPC.</span><span class="sxs-lookup"><span data-stu-id="541af-116">IIS can be configured to disable anonymous access and require authentication to the virtual directory for the RPC Proxy.</span></span> <span data-ttu-id="541af-117">Para fazer isso, clique com o botão direito do mouse no nó RPC e selecione **Propriedades**.</span><span class="sxs-lookup"><span data-stu-id="541af-117">To do this, right click the Rpc node and select **Properties**.</span></span> <span data-ttu-id="541af-118">Selecione a guia **segurança de diretório** e clique no botão **Editar** no grupo **autenticação e controle de acesso** , conforme ilustrado aqui:</span><span class="sxs-lookup"><span data-stu-id="541af-118">Select the **Directory Security** tab and click the **Edit** button in the **Authentication and Access Control** group, as illustrated here:</span></span>

![Captura de tela mostrando a caixa de diálogo Propriedades RPC.](images/rpc-http-2.png)

<span data-ttu-id="541af-120">Embora você possa usar RPC sobre HTTP mesmo quando o diretório virtual de proxy RPC permite acesso anônimo, a Microsoft recomenda enfaticamente a desabilitação do acesso anônimo a esse diretório virtual por motivos de segurança.</span><span class="sxs-lookup"><span data-stu-id="541af-120">Although you can use RPC over HTTP even when the RPC Proxy virtual directory allows anonymous access, Microsoft strongly recommends disabling anonymous access to that virtual directory for security reasons.</span></span> <span data-ttu-id="541af-121">Em vez disso, para RPC sobre HTTP, habilite a autenticação básica, a autenticação integrada do Windows ou ambas.</span><span class="sxs-lookup"><span data-stu-id="541af-121">Rather, for RPC over HTTP enable Basic Authentication, Windows Integrated Authentication or both.</span></span> <span data-ttu-id="541af-122">Lembre-se de que somente RPC sobre HTTP V2 é capaz de se autenticar no proxy RPC que requer autenticação básica ou integrada ao Windows; RPC sobre HTTP v1 não poderá se conectar se não **permitir acesso anônimo** estiver desabilitado.</span><span class="sxs-lookup"><span data-stu-id="541af-122">Remember that only RPC over HTTP v2 is able to authenticate against RPC Proxy requiring Basic or Windows-integrated authentication; RPC over HTTP v1 will not be able to connect if **Disallow Anonymous Access** is disabled.</span></span> <span data-ttu-id="541af-123">Como o RPC sobre HTTP V2 é a implementação mais segura e robusta, o uso de uma versão do Windows que oferece suporte a ela melhorará a segurança de suas instalações.</span><span class="sxs-lookup"><span data-stu-id="541af-123">Since RPC over HTTP v2 is the more secure and robust implementation, using a version of Windows that supports it will improve the security of your installations.</span></span>

> [!Note]  
> <span data-ttu-id="541af-124">Por padrão, o diretório virtual do proxy RPC está marcado para permitir acesso anônimo.</span><span class="sxs-lookup"><span data-stu-id="541af-124">By default, the RPC proxy virtual directory is marked to allow anonymous access.</span></span> <span data-ttu-id="541af-125">No entanto, o proxy RPC para RPC sobre HTTP v2 rejeita solicitações que não são autenticadas por padrão.</span><span class="sxs-lookup"><span data-stu-id="541af-125">However, the RPC proxy for RPC over HTTP v2 rejects requests that are not authenticated by default.</span></span>

 

## <a name="traffic-encryption"></a><span data-ttu-id="541af-126">Criptografia de tráfego</span><span class="sxs-lookup"><span data-stu-id="541af-126">Traffic Encryption</span></span>

<span data-ttu-id="541af-127">O RPC sobre HTTP pode criptografar o tráfego entre o cliente RPC sobre HTTP e o proxy RPC com SSL.</span><span class="sxs-lookup"><span data-stu-id="541af-127">RPC over HTTP can encrypt traffic between the RPC over HTTP client and the RPC proxy with SSL.</span></span> <span data-ttu-id="541af-128">O tráfego entre o proxy RPC e o servidor RPC sobre HTTP é criptografado usando mecanismos de segurança RPC normais e não usa SSL (mesmo que o SSL entre o cliente e o proxy RPC seja escolhido).</span><span class="sxs-lookup"><span data-stu-id="541af-128">The traffic between the RPC proxy and RPC over HTTP server is encrypted using normal RPC security mechanisms and does not use SSL (even if SSL between the client and the RPC proxy is chosen).</span></span> <span data-ttu-id="541af-129">Isso ocorre porque essa parte do tráfego viaja dentro da rede de uma organização e por trás de um firewall.</span><span class="sxs-lookup"><span data-stu-id="541af-129">This is because that portion of the traffic travels within an organization's network and behind a firewall.</span></span>

<span data-ttu-id="541af-130">O tráfego entre o cliente RPC sobre HTTP e o proxy RPC, que geralmente viaja pela Internet, pode ser criptografado com SSL, além de qual mecanismo de criptografia foi escolhido para RPC.</span><span class="sxs-lookup"><span data-stu-id="541af-130">Traffic between the RPC over HTTP client and the RPC proxy, which generally travels over the Internet, can be encrypted with SSL in addition to which encryption mechanism was chosen for RPC.</span></span> <span data-ttu-id="541af-131">Nesse caso, o tráfego na parte da Internet da rota se torna criptografado duplamente.</span><span class="sxs-lookup"><span data-stu-id="541af-131">In this case, traffic on the Internet portion of the route becomes doubly encrypted.</span></span> <span data-ttu-id="541af-132">A criptografia de tráfego por meio do proxy RPC fornece uma defesa secundária, caso o proxy RPC ou outros computadores na rede de perímetro sejam comprometidos.</span><span class="sxs-lookup"><span data-stu-id="541af-132">Encrypting traffic through the RPC proxy provides a secondary defense, in case the RPC proxy or other machines in the perimeter network are compromised.</span></span> <span data-ttu-id="541af-133">Como o proxy RPC não pode descriptografar a camada de criptografia secundária, o proxy RPC não tem acesso aos dados que estão sendo enviados.</span><span class="sxs-lookup"><span data-stu-id="541af-133">Since the RPC proxy cannot decrypt the secondary encryption layer, the RPC proxy does not have access to the data being sent.</span></span> <span data-ttu-id="541af-134">Confira [recomendações de implantação de RPC sobre http](rpc-over-http-deployment-recommendations.md) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="541af-134">See [RPC over HTTP Deployment Recommendations](rpc-over-http-deployment-recommendations.md) for more information.</span></span> <span data-ttu-id="541af-135">A criptografia SSL está disponível somente com RPC sobre HTTP v2.</span><span class="sxs-lookup"><span data-stu-id="541af-135">SSL encryption is available only with RPC over HTTP v2.</span></span>

## <a name="restricting-rpc-over-http-calls-to-certain-computers"></a><span data-ttu-id="541af-136">Restringindo chamadas RPC sobre HTTP para determinados computadores</span><span class="sxs-lookup"><span data-stu-id="541af-136">Restricting RPC over HTTP Calls to Certain Computers</span></span>

<span data-ttu-id="541af-137">A configuração de segurança do IIS é baseada em intervalos de computadores e portas permitidos.</span><span class="sxs-lookup"><span data-stu-id="541af-137">The IIS security configuration is based on allowed computer and port ranges.</span></span> <span data-ttu-id="541af-138">A capacidade de usar RPC sobre HTTP é controlada por duas entradas do registro no computador que executa o IIS e o proxy RPC.</span><span class="sxs-lookup"><span data-stu-id="541af-138">The capability to use RPC over HTTP is controlled by two registry entries on the computer running IIS and the RPC proxy.</span></span> <span data-ttu-id="541af-139">A primeira entrada é um sinalizador que alterna a funcionalidade do proxy RPC.</span><span class="sxs-lookup"><span data-stu-id="541af-139">The first entry is a flag that toggles RPC proxy functionality.</span></span> <span data-ttu-id="541af-140">A segunda é uma lista opcional de computadores para os quais o proxy pode encaminhar chamadas RPC.</span><span class="sxs-lookup"><span data-stu-id="541af-140">The second is an optional list of computers to which the proxy can forward RPC calls.</span></span>

<span data-ttu-id="541af-141">Por padrão, um cliente que entra em contato com o proxy RPC para túnel RPC sobre chamadas HTTP não pode acessar nenhum processo de servidor RPC, exceto os processos do servidor RPC sobre HTTP em execução no mesmo computador que o proxy RPC.</span><span class="sxs-lookup"><span data-stu-id="541af-141">By default, a client that contacts the RPC proxy to tunnel RPC over HTTP calls cannot access any RPC server processes except the RPC over HTTP server processes running on the same machine as the RPC proxy.</span></span> <span data-ttu-id="541af-142">Se o sinalizador habilitado não for definido ou definido como um valor zero, o IIS desabilitará o proxy RPC.</span><span class="sxs-lookup"><span data-stu-id="541af-142">If the ENABLED flag is not defined or set to a zero value, IIS disables the RPC proxy.</span></span> <span data-ttu-id="541af-143">Se o sinalizador habilitado for definido e definido como um valor diferente de zero, um cliente poderá se conectar ao RPC sobre servidores HTTP no computador que executa o IIS.</span><span class="sxs-lookup"><span data-stu-id="541af-143">If the ENABLED flag is defined and set to a nonzero value, a client can connect to RPC over HTTP servers on the computer running IIS.</span></span> <span data-ttu-id="541af-144">Para permitir que o cliente seja encapsulado em um processo RPC sobre o servidor HTTP em outro computador, você deve adicionar uma entrada de registro à lista de servidores RPC sobre HTTP do computador IIS.</span><span class="sxs-lookup"><span data-stu-id="541af-144">To enable the client to tunnel to an RPC over HTTP server process on another computer, you must add a registry entry to the IIS computer's list of RPC over HTTP servers.</span></span>

<span data-ttu-id="541af-145">Os servidores RPC não podem aceitar chamadas RPC sobre HTTP, a menos que solicitou especificamente que o RPC escutasse no RPC sobre HTTP.</span><span class="sxs-lookup"><span data-stu-id="541af-145">RPC servers cannot accept RPC over HTTP calls unless they specifically requested RPC to listen on RPC over HTTP.</span></span>

<span data-ttu-id="541af-146">O exemplo a seguir demonstra como configurar o registro para permitir que os clientes se conectem a servidores pela Internet:</span><span class="sxs-lookup"><span data-stu-id="541af-146">The following example demonstrates how to configure the registry to allow clients to connect to servers across the Internet:</span></span>

```
HKEY_LOCAL_MACHINE\
   Software\Microsoft\Rpc\RpcProxy\Enabled:REG_DWORD
   Software\Microsoft\Rpc\RpcProxy\ValidPorts:REG_SZ
```

<span data-ttu-id="541af-147">A entrada **ValidPorts** é uma \_ entrada reg sz que contém uma lista de computadores aos quais o proxy RPC do IIS tem permissão para encaminhar chamadas RPC e as portas que ele deve usar para se conectar aos servidores RPC.</span><span class="sxs-lookup"><span data-stu-id="541af-147">The **ValidPorts** entry is a REG\_SZ entry containing a list of computers to which the IIS RPC proxy is allowed to forward RPC calls, and the ports it should use to connect to the RPC servers.</span></span> <span data-ttu-id="541af-148">A \_ entrada reg sz usa o seguinte formato: Rosco: 593; Rosco: 2000-8000; dados \* : 4000-8000.</span><span class="sxs-lookup"><span data-stu-id="541af-148">The REG\_SZ entry takes the following form: Rosco:593;Rosco:2000-8000;Data\*:4000-8000.</span></span>

<span data-ttu-id="541af-149">Neste exemplo, o IIS pode encaminhar chamadas RPC sobre HTTP para o servidor "Rosco" nas portas 593 e 2000 até 8000.</span><span class="sxs-lookup"><span data-stu-id="541af-149">In this example, IIS can forward RPC over HTTP calls to the server "Rosco" on ports 593 and 2000 through 8000.</span></span> <span data-ttu-id="541af-150">Ele também pode enviar chamadas para qualquer servidor cujo nome comece com "dados".</span><span class="sxs-lookup"><span data-stu-id="541af-150">It can also send calls to any server whose name begins with "Data".</span></span> <span data-ttu-id="541af-151">Ele se conectará nas portas 4000 a 8000.</span><span class="sxs-lookup"><span data-stu-id="541af-151">It will connect on ports 4000 through 8000.</span></span> <span data-ttu-id="541af-152">Além disso, antes de encaminhar o tráfego para uma determinada porta no servidor RPC sobre HTTP, o proxy RPC executa uma troca de pacotes especial com o serviço RPC escutando nessa porta para verificar se está disposto a aceitar solicitações por HTTP.</span><span class="sxs-lookup"><span data-stu-id="541af-152">In addition, before forwarding traffic to a given port on the RPC over HTTP server, the RPC proxy performs a special packet exchange with the RPC service listening on that port to verify it is willing to accept requests over HTTP.</span></span>

<span data-ttu-id="541af-153">Para obter um exemplo com base nessas configurações de exemplo, se um serviço RPC escuta na porta 4500 no servidor "data1", mas não chamou uma das funções [ \* *RpcServerUseProtseq \** _](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseq) com _ \* ncacn \_ http \* \*, ele rejeitará a solicitação.</span><span class="sxs-lookup"><span data-stu-id="541af-153">For an example based on these example settings, if an RPC service listens on port 4500 on server "Data1" but has not called one of the [\**RpcServerUseProtseq\** _](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseq) functions with _\*ncacn\_http\*\*, it will reject the request.</span></span> <span data-ttu-id="541af-154">Esse comportamento fornece proteção adicional para servidores que escutam em uma porta aberta devido a um erro de configuração; a menos que o servidor solicitado especificamente a escutar no RPC sobre HTTP, ele não receberá chamadas provenientes de fora do firewall.</span><span class="sxs-lookup"><span data-stu-id="541af-154">This behavior provides additional protection for servers that listen on an opened port due to configuration error; unless the server specifically requested to listen on RPC over HTTP, it will not receive calls originating from outside the firewall.</span></span>

<span data-ttu-id="541af-155">As entradas na chave **ValidPorts** devem ser uma correspondência exata do servidor RPC sobre http solicitado pelo cliente (não diferencia maiúsculas de minúsculas).</span><span class="sxs-lookup"><span data-stu-id="541af-155">Entries in the **ValidPorts** key must be an exact match of the RPC over HTTP server asked for by the client (it is not case-sensitive).</span></span> <span data-ttu-id="541af-156">Para simplificar o processamento, o proxy RPC não executa a canonização do nome fornecido pelo cliente RPC sobre HTTP.</span><span class="sxs-lookup"><span data-stu-id="541af-156">To streamline processing, the RPC proxy does not perform canonicalization of the name provided by the RPC over HTTP client.</span></span> <span data-ttu-id="541af-157">Portanto, se o cliente solicitar rosco.microsoft.com e, em **ValidPorts** , contiver somente Rosco, o proxy RPC não corresponderá aos nomes, mesmo que ambos os nomes possam se referir ao mesmo computador.</span><span class="sxs-lookup"><span data-stu-id="541af-157">Therefore, if the client asks for rosco.microsoft.com, and in **ValidPorts** contain Rosco only, the RPC proxy will not match the names, even though both names may refer to the same machine.</span></span> <span data-ttu-id="541af-158">Além disso, se o endereço IP de Rosco for 66.77.88.99 e o cliente solicitar 66.77.88.99, mas a chave **ValidPorts** contiver apenas Rosco, o proxy RPC recusará a conexão.</span><span class="sxs-lookup"><span data-stu-id="541af-158">Additionally, if the IP address of Rosco is 66.77.88.99, and the client asks for 66.77.88.99 but the **ValidPorts** key contains Rosco only, the RPC proxy will refuse the connection.</span></span> <span data-ttu-id="541af-159">Se um cliente pode solicitar o RPC sobre o servidor HTTP por nome ou por endereço IP, insira ambos na chave **ValidPorts** .</span><span class="sxs-lookup"><span data-stu-id="541af-159">If a client may ask for the RPC over HTTP server by name, or by IP address, insert both in the **ValidPorts** key.</span></span>

> [!Note]  
> <span data-ttu-id="541af-160">Embora o RPC esteja habilitado para IPv6, o proxy RPC não oferece suporte a endereços IPv6 na chave **ValidPorts** .</span><span class="sxs-lookup"><span data-stu-id="541af-160">Although RPC is IPv6 enabled, the RPC proxy does not support IPv6 addresses in the **ValidPorts** key.</span></span> <span data-ttu-id="541af-161">Se o IPv6 for usado para conectar o proxy RPC e o servidor RPC sobre HTTP, somente os nomes DNS poderão ser usados.</span><span class="sxs-lookup"><span data-stu-id="541af-161">If IPv6 is used to connect the RPC proxy and the RPC over HTTP server, only DNS names can be used.</span></span>

 

<span data-ttu-id="541af-162">O IIS lê as entradas de registro **Enabled** e **ValidPorts** na inicialização.</span><span class="sxs-lookup"><span data-stu-id="541af-162">IIS reads the **Enabled** and **ValidPorts** registry entries on startup.</span></span> <span data-ttu-id="541af-163">Além disso, o RPC sobre HTTP lê novamente o conteúdo da chave **ValidPorts** aproximadamente a cada 5 minutos.</span><span class="sxs-lookup"><span data-stu-id="541af-163">In addition, RPC over HTTP rereads the contents of the **ValidPorts** key approximately every 5 minutes.</span></span> <span data-ttu-id="541af-164">Se a entrada **ValidPorts** for alterada, as alterações serão implementadas em 5 minutos.</span><span class="sxs-lookup"><span data-stu-id="541af-164">If the **ValidPorts** entry is changed, the changes are implemented within 5 minutes.</span></span>

<span data-ttu-id="541af-165">**RPC sobre http V1:** O serviço WEB deve ser interrompido e reiniciado usando a Service Manager da Internet para obter novos valores nas entradas do registro a serem implementadas.</span><span class="sxs-lookup"><span data-stu-id="541af-165">**RPC over HTTP v1:** The WEB service must be stopped and restarted using the Internet Service Manager for new values in the registry entries to be implemented.</span></span>

 

 




