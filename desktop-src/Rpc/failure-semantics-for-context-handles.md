---
title: Semântica de falha para identificadores de contexto
description: Este tópico discute a semântica de falha para identificadores de contexto.
ms.assetid: fcf28519-39ad-4823-bc27-f3502e4d540c
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c4528b3f5160b92a4e6f10dbcf877e9fec59f81b
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/16/2019
ms.locfileid: "104005581"
---
# <a name="failure-semantics-for-context-handles"></a><span data-ttu-id="ec9af-103">Semântica de falha para identificadores de contexto</span><span class="sxs-lookup"><span data-stu-id="ec9af-103">Failure Semantics for Context Handles</span></span>

<span data-ttu-id="ec9af-104">Este tópico discute a semântica de falha para identificadores de contexto.</span><span class="sxs-lookup"><span data-stu-id="ec9af-104">This topic discusses failure semantics for context handles.</span></span>

## <a name="failure-semantics-when-closing-the-context-handle-fails"></a><span data-ttu-id="ec9af-105">Falha na semântica ao fechar o identificador de contexto</span><span class="sxs-lookup"><span data-stu-id="ec9af-105">Failure Semantics when Closing the Context Handle Fails</span></span>

<span data-ttu-id="ec9af-106">Imagine que um aplicativo cliente está tentando fechar um identificador de contexto aberto no servidor, sem desligar o processo do cliente.</span><span class="sxs-lookup"><span data-stu-id="ec9af-106">Imagine a client application is attempting to close a context handle it opened on the server, without shutting down the client process.</span></span> <span data-ttu-id="ec9af-107">Além disso, suponha que a chamada para o servidor feche o identificador de contexto falha (por exemplo, o cliente está sem memória).</span><span class="sxs-lookup"><span data-stu-id="ec9af-107">Also, assume the call to the server to close the context handle fails (for example, the client is out of memory).</span></span> <span data-ttu-id="ec9af-108">A maneira apropriada de lidar com essa situação é chamar a função [**RpcSsDestroyClientContext**](/windows/desktop/api/Rpcndr/nf-rpcndr-rpcssdestroyclientcontext) .</span><span class="sxs-lookup"><span data-stu-id="ec9af-108">The proper way to handle this situation is to call the [**RpcSsDestroyClientContext**](/windows/desktop/api/Rpcndr/nf-rpcndr-rpcssdestroyclientcontext) function.</span></span> <span data-ttu-id="ec9af-109">Nesse caso, o cliente limpa seu lado do identificador de contexto e abortively fecha a conexão com o servidor.</span><span class="sxs-lookup"><span data-stu-id="ec9af-109">In such a case the client cleans up its side of the context handle, and abortively closes the connection to the server.</span></span> <span data-ttu-id="ec9af-110">Como a conexão é realmente um pool de conexões (Confira [RPC e a rede](rpc-and-the-network.md)), que é contado por referência com uma referência para cada associação aberta ou identificador de contexto, a destruição do identificador de contexto chamando a função **RpcSsDestroyClientContext** não destrói realmente a conexão.</span><span class="sxs-lookup"><span data-stu-id="ec9af-110">Since the connection is really a connection pool (see [RPC and the Network](rpc-and-the-network.md)), which is reference-counted with one reference for each opened binding or context handle, destroying the context handle by calling the **RpcSsDestroyClientContext** function does not actually destroy the connection.</span></span> <span data-ttu-id="ec9af-111">Em vez disso, reduz a contagem de referência para o pool de conexões.</span><span class="sxs-lookup"><span data-stu-id="ec9af-111">Rather, it decrements the reference count for the connection pool.</span></span> <span data-ttu-id="ec9af-112">Para que as conexões no pool sejam fechadas, o cliente precisa fechar todos os identificadores de associação e identificadores de contexto para esse servidor a partir do processo do cliente.</span><span class="sxs-lookup"><span data-stu-id="ec9af-112">For connections in the pool to be closed, the client needs to close all binding handles and context handles to that server from the client process.</span></span> <span data-ttu-id="ec9af-113">Em seguida, todas as conexões no pool são fechadas e o mecanismo de execução do servidor é iniciado e apagado.</span><span class="sxs-lookup"><span data-stu-id="ec9af-113">Then all connections in the pool are closed, and the server run-down mechanism is initiated and cleans up.</span></span>

## <a name="failure-semantics-during-change-of-state-of-the-context-handle"></a><span data-ttu-id="ec9af-114">Semântica de falha durante a alteração do estado do identificador de contexto</span><span class="sxs-lookup"><span data-stu-id="ec9af-114">Failure Semantics During Change of State of the Context Handle</span></span>

<span data-ttu-id="ec9af-115">As informações contidas nesta seção referem-se ao Windows XP e às plataformas posteriores.</span><span class="sxs-lookup"><span data-stu-id="ec9af-115">The information in this section refers to Windows XP and later platforms.</span></span>

<span data-ttu-id="ec9af-116">Os identificadores de contexto são simplesmente parâmetros para uma função.</span><span class="sxs-lookup"><span data-stu-id="ec9af-116">Context handles are simply parameters to a function.</span></span> <span data-ttu-id="ec9af-117">Todas as alterações no estado de um identificador de contexto ocorrem quando os parâmetros são empacotados ou não são empacotados.</span><span class="sxs-lookup"><span data-stu-id="ec9af-117">All changes in the state of a context handle happen when parameters are marshaled or unmarshaled.</span></span> <span data-ttu-id="ec9af-118">Por exemplo, se um cliente abrir um identificador de contexto (altera-o de **nulo** para não **nulo**), o tempo de execução de RPC não abrirá realmente a parte RPC do identificador até que os argumentos sejam empacotados para envio ao cliente.</span><span class="sxs-lookup"><span data-stu-id="ec9af-118">For example, if a client opens a context handle (changes it from **NULL** to non-**NULL**), the RPC run-time does not actually open the RPC portion of the handle until the arguments are marshaled for sending to the client.</span></span> <span data-ttu-id="ec9af-119">As falhas podem ocorrer durante o interim.</span><span class="sxs-lookup"><span data-stu-id="ec9af-119">Failures can occur during the interim.</span></span> <span data-ttu-id="ec9af-120">Devido a uma grande quantidade de condições de rede ou de poucos recursos possíveis, a transmissão do pacote para o cliente pode falhar.</span><span class="sxs-lookup"><span data-stu-id="ec9af-120">Due to a variety of possible network or low resource conditions, transmission of the packet to the client could fail.</span></span> <span data-ttu-id="ec9af-121">Ou a rotina de servidor pode lançar uma exceção ao tentar alterar um identificador de contexto.</span><span class="sxs-lookup"><span data-stu-id="ec9af-121">Or the server routine may throw an exception while attempting to change a context handle.</span></span> <span data-ttu-id="ec9af-122">Nessas ou em outras situações de falha, o cliente e o servidor podem obter exibições inconsistentes do identificador de contexto.</span><span class="sxs-lookup"><span data-stu-id="ec9af-122">In these or other failure situations, the client and server may get inconsistent views of the context handle.</span></span> <span data-ttu-id="ec9af-123">Esta seção explica a regra para o estado do identificador de contexto e a responsabilidade do código do cliente e do servidor durante várias condições de falha.</span><span class="sxs-lookup"><span data-stu-id="ec9af-123">This section explains the rule for the state of the context handle, and the responsibility of client and server code during various failure conditions.</span></span>

-   <span data-ttu-id="ec9af-124">Um identificador de contexto **nulo** chega, mas a rotina de servidor encontra uma falha e gera uma exceção.</span><span class="sxs-lookup"><span data-stu-id="ec9af-124">A **NULL** context handle arrives, but the server routine encounters a failure and throws an exception.</span></span>

    <span data-ttu-id="ec9af-125">É responsabilidade da rotina do servidor de limpar qualquer estado relacionado ao identificador de contexto que possa ter criado.</span><span class="sxs-lookup"><span data-stu-id="ec9af-125">It is the responsibility of the server routine to clean up any context handle–related state it may have created.</span></span> <span data-ttu-id="ec9af-126">O tempo de execução de RPC limpa seu estado.</span><span class="sxs-lookup"><span data-stu-id="ec9af-126">The RPC run time cleans up its state.</span></span>

-   <span data-ttu-id="ec9af-127">Um identificador de contexto não **nulo** chega, mas a rotina de servidor encontra uma falha e gera uma exceção.</span><span class="sxs-lookup"><span data-stu-id="ec9af-127">A non-**NULL** context handles arrives, but the server routine encounters a failure and throws an exception.</span></span>

    <span data-ttu-id="ec9af-128">Se a rotina de servidor fechou o identificador de contexto, o cliente não saberá, pois a chamada não terá sucesso; o uso adicional do identificador de contexto resultará em um \_ erro de incompatibilidade de contexto de RPC X \_ SS \_ \_ no cliente.</span><span class="sxs-lookup"><span data-stu-id="ec9af-128">If the server routine closed the context handle, the client will not know about it, since the call will not succeed; further use of the context handle will result in an RPC\_X\_SS\_CONTEXT\_MISMATCH error on the client.</span></span> <span data-ttu-id="ec9af-129">Se a rotina de servidor não modificar o identificador de contexto, o cliente ainda poderá usá-lo.</span><span class="sxs-lookup"><span data-stu-id="ec9af-129">If the server routine does not modify the context handle, the client can still use it.</span></span> <span data-ttu-id="ec9af-130">Se a rotina de servidor alterar as informações armazenadas no contexto do servidor, novas chamadas do cliente usarão essas informações.</span><span class="sxs-lookup"><span data-stu-id="ec9af-130">If the server routine changes the information stored in the server context, new calls from the client will use that information.</span></span>

-   <span data-ttu-id="ec9af-131">Um identificador de contexto não **nulo** chega e a rotina de servidor fecha o identificador, mas o marshaling após o marshaling do identificador de contexto falhou ou o processamento após o marshaling falhou.</span><span class="sxs-lookup"><span data-stu-id="ec9af-131">A non-**NULL** context handle arrives, and the server routine closes the handle, but either marshaling after the context handle was marshaled failed, or processing after marshaling failed.</span></span>

    <span data-ttu-id="ec9af-132">O identificador de contexto é fechado e chamadas adicionais por esse cliente usando esse identificador de contexto resultam em um \_ erro de incompatibilidade de contexto de RPC X \_ SS \_ \_ no cliente.</span><span class="sxs-lookup"><span data-stu-id="ec9af-132">The context handle is closed, and further calls by this client using this context handle result in an RPC\_X\_SS\_CONTEXT\_MISMATCH error on the client.</span></span>

-   <span data-ttu-id="ec9af-133">Um identificador de contexto **nulo** chega e o servidor cria seu contexto para esse identificador, mas o marshaling após o marshaling do identificador de contexto falhou ou o processamento após o marshaling falhou.</span><span class="sxs-lookup"><span data-stu-id="ec9af-133">A **NULL** context handle arrives, and the server creates its context for this handle, but either marshaling after the context handle was marshaled failed, or processing after marshaling failed.</span></span>

    <span data-ttu-id="ec9af-134">Nesse caso, o tempo de execução RPC invoca a execução para esse identificador de contexto e limpa o estado RPC para esse identificador de contexto.</span><span class="sxs-lookup"><span data-stu-id="ec9af-134">In this case, the RPC run time invokes the run down for this context handle, and cleans up the RPC state for this context handle.</span></span> <span data-ttu-id="ec9af-135">O identificador de contexto não será criado no lado do cliente.</span><span class="sxs-lookup"><span data-stu-id="ec9af-135">The context handle will not be created on the client side.</span></span>

-   <span data-ttu-id="ec9af-136">Um identificador de contexto não **nulo** chega e o servidor não altera o identificador de contexto ou altera as informações armazenadas no contexto do servidor e o marshaling falha depois que o identificador de contexto é empacotado.</span><span class="sxs-lookup"><span data-stu-id="ec9af-136">A non-**NULL** context handle arrives, and the server either does not change the context handle, or it changes the information stored in the server context, and marshaling fails after the context handle is marshaled.</span></span>

    <span data-ttu-id="ec9af-137">Novas chamadas do cliente usarão o identificador de contexto que o servidor tem.</span><span class="sxs-lookup"><span data-stu-id="ec9af-137">New calls from the client will use the context handle that the server has.</span></span>

-   <span data-ttu-id="ec9af-138">Um identificador de contexto **nulo** chega e o servidor não o define como algo diferente de **NULL**, mas a chamada falha antes que o identificador de contexto seja empacotado.</span><span class="sxs-lookup"><span data-stu-id="ec9af-138">A **NULL** context handle arrives, and the server does not set it to anything other than **NULL**, but the call fails before the context handle is marshaled.</span></span>

    <span data-ttu-id="ec9af-139">Nesse caso, nenhum identificador de contexto é criado no cliente.</span><span class="sxs-lookup"><span data-stu-id="ec9af-139">In this case, no context handle is created on the client.</span></span>

-   <span data-ttu-id="ec9af-140">Um identificador de contexto não **nulo** chega e o servidor o define como **nulo**, mas o marshaling falha antes que o identificador de contexto seja empacotado.</span><span class="sxs-lookup"><span data-stu-id="ec9af-140">A non-**NULL** context handle arrives, and the server sets it to **NULL**, but marshaling fails before the context handle is marshaled.</span></span>

    <span data-ttu-id="ec9af-141">Nesse caso, o identificador de contexto permanece fechado no servidor e o cliente obtém \_ erros de incompatibilidade de contexto de RPC X \_ SS \_ \_ ao tentar usar o identificador de contexto.</span><span class="sxs-lookup"><span data-stu-id="ec9af-141">In this case, the context handle remains closed on the server, and the client gets RPC\_X\_SS\_CONTEXT\_MISMATCH errors when it tries to use the context handle.</span></span>

-   <span data-ttu-id="ec9af-142">Um identificador de contexto **nulo** chega ao servidor e o servidor o define como não **nulo**, mas o marshaling falha antes que o identificador de contexto seja empacotado.</span><span class="sxs-lookup"><span data-stu-id="ec9af-142">A **NULL** context handle arrives on the server, and the server sets it to non-**NULL**, but marshaling fails before the context handle is marshaled.</span></span>

    <span data-ttu-id="ec9af-143">A execução do identificador de contexto é invocada para que o servidor possa ser limpo e nenhum identificador de contexto será criado no cliente.</span><span class="sxs-lookup"><span data-stu-id="ec9af-143">The context handle run down is to be invoked so that the server can clean up, and no context handle will be created on the client.</span></span>

-   <span data-ttu-id="ec9af-144">Um identificador de contexto não **nulo** chega e o servidor não altera o identificador de contexto ou altera as informações armazenadas no contexto do servidor e o marshaling falha antes que o identificador de contexto seja empacotado.</span><span class="sxs-lookup"><span data-stu-id="ec9af-144">A non-**NULL** context handle arrives, and the server either does not change the context handle, or it changes the information stored in the server context, and marshaling fails before the context handle is marshaled.</span></span>

    <span data-ttu-id="ec9af-145">Novas chamadas do cliente usarão o estado no servidor.</span><span class="sxs-lookup"><span data-stu-id="ec9af-145">New calls from the client will use the state on the server.</span></span>

-   <span data-ttu-id="ec9af-146">Um identificador de contexto é declarado como um valor de retorno e a rotina de servidor retorna **NULL** para o identificador de contexto e o marshaling falha antes que o identificador de contexto seja empacotado.</span><span class="sxs-lookup"><span data-stu-id="ec9af-146">A context handle is declared as a return value, and the server routine returns **NULL** for the context handle and marshaling fails before the context handle is marshaled.</span></span>

    <span data-ttu-id="ec9af-147">Nesse caso, nenhum contexto novo é criado no cliente.</span><span class="sxs-lookup"><span data-stu-id="ec9af-147">In this case, no new context is created on the client.</span></span>

-   <span data-ttu-id="ec9af-148">Um identificador de contexto é declarado como um valor de retorno, e a rotina de servidor retorna um não **nulo** para o identificador de contexto e o marshaling falha antes que o identificador de contexto seja empacotado.</span><span class="sxs-lookup"><span data-stu-id="ec9af-148">A context handle is declared as a return value, and the server routine returns non-**NULL** for the context handle and marshaling fails before the context handle is marshaled.</span></span>

    <span data-ttu-id="ec9af-149">O tempo de execução RPC chama a rotina de execução do manipulador de contexto para dar a ela a oportunidade de limpar e nenhum contexto novo é criado no cliente.</span><span class="sxs-lookup"><span data-stu-id="ec9af-149">The RPC run time calls the context handle run-down routine to give it a chance to clean up, and no new context is created on the client.</span></span>

 

 




