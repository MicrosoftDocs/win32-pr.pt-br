---
title: Gerando informações de erro
description: Se um servidor ou aplicativo encontrar um erro fatal ao ser chamado por meio de RPC, ele deverá indicar ao tempo de execução de RPC que encontrou uma falha e, idealmente, adicionar informações sobre a falha para facilitar a solução de problemas.
ms.assetid: 6658c387-94df-4d85-9749-53858f9e0f5f
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1b06a13e932034e6840479443e0b78f4c322c0b3
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/16/2019
ms.locfileid: "105759597"
---
# <a name="generating-error-information"></a><span data-ttu-id="8ce30-103">Gerando informações de erro</span><span class="sxs-lookup"><span data-stu-id="8ce30-103">Generating Error Information</span></span>

<span data-ttu-id="8ce30-104">Se um servidor ou aplicativo encontrar um erro fatal ao ser chamado por meio de RPC, ele deverá indicar ao tempo de execução de RPC que encontrou uma falha e, idealmente, adicionar informações sobre a falha para facilitar a solução de problemas.</span><span class="sxs-lookup"><span data-stu-id="8ce30-104">If a server or application encounters a fatal error while being called through RPC, it should indicate to the RPC run time that it has encountered a failure, and ideally, should add information about the failure to facilitate troubleshooting.</span></span>

## <a name="indicating-fatal-errors-to-the-rpc-run-time"></a><span data-ttu-id="8ce30-105">Indicando erros fatais para o tempo de execução de RPC</span><span class="sxs-lookup"><span data-stu-id="8ce30-105">Indicating Fatal Errors to the RPC Run Time</span></span>

<span data-ttu-id="8ce30-106">Para indicar uma falha ao tempo de execução RPC, chame a função [**RpcRaiseException**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcraiseexception) enquanto estiver no thread RPC em que a exceção foi chamada ou [**RpcAsyncAbortCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasyncabortcall) se estiver processando a chamada de forma assíncrona em outro thread.</span><span class="sxs-lookup"><span data-stu-id="8ce30-106">To indicate a failure to the RPC run time, call the [**RpcRaiseException**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcraiseexception) function while on the RPC thread the exception was called on, or [**RpcAsyncAbortCall**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasyncabortcall) if processing the call asynchronously on another thread.</span></span> <span data-ttu-id="8ce30-107">Retornar um código de erro da rotina de servidor, como a rotina de Gerenciador, não é suficiente – de acordo com a especificação RPC, o valor de retorno da função não tem semântica de erro no servidor, independentemente das configurações de arquivo IDL/ACF.</span><span class="sxs-lookup"><span data-stu-id="8ce30-107">Returning an error code from the server routine, such as the manager routine, is not sufficient—according to the RPC specification, the return value of the function has no error semantics on the server, regardless of the idl/acf file settings.</span></span>

<span data-ttu-id="8ce30-108">Quando ocorrer um erro fatal em seu componente, execute qualquer limpeza considerada necessária e, em seguida, chame a função [**RpcRaiseException**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcraiseexception) com o código de erro.</span><span class="sxs-lookup"><span data-stu-id="8ce30-108">When a fatal error occurs in your component, perform any cleanup deemed necessary and then call the [**RpcRaiseException**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcraiseexception) function with the error code.</span></span> <span data-ttu-id="8ce30-109">A única diferença entre **RpcRaiseException** e retornar um código de erro é quando o **RpcRaiseException** é chamado, os parâmetros de saída não são empacotados.</span><span class="sxs-lookup"><span data-stu-id="8ce30-109">The only difference between **RpcRaiseException** and returning an error code is when the **RpcRaiseException** is called, the out parameters are not marshaled.</span></span> <span data-ttu-id="8ce30-110">Isso geralmente é uma vantagem, pois evitar que parâmetros de saída não inicializados se torne desnecessário.</span><span class="sxs-lookup"><span data-stu-id="8ce30-110">This is usually an advantage, since avoiding uninitialized out parameters becomes unnecessary.</span></span>

## <a name="generating-additional-extended-error-information"></a><span data-ttu-id="8ce30-111">Gerando informações adicionais de erro estendido</span><span class="sxs-lookup"><span data-stu-id="8ce30-111">Generating Additional Extended Error Information</span></span>

<span data-ttu-id="8ce30-112">Assim como o tempo de execução de RPC cria uma cadeia de registros de erro, seu servidor ou aplicativo pode adicionar seus próprios registros à cadeia.</span><span class="sxs-lookup"><span data-stu-id="8ce30-112">Just as the RPC run time builds a chain of error records, your server or application can add its own records to the chain.</span></span> <span data-ttu-id="8ce30-113">Essa abordagem geralmente ajuda no processo de solução de problemas.</span><span class="sxs-lookup"><span data-stu-id="8ce30-113">This approach often helps in the troubleshooting process.</span></span> <span data-ttu-id="8ce30-114">Por exemplo, um servidor pode tentar abrir um determinado arquivo e receber um erro de arquivo não encontrado.</span><span class="sxs-lookup"><span data-stu-id="8ce30-114">For example, a server may attempt to open a given file and receive a file not found error.</span></span> <span data-ttu-id="8ce30-115">Simplesmente retornar o erro 2 não seria útil para determinar qual arquivo está ausente.</span><span class="sxs-lookup"><span data-stu-id="8ce30-115">Simply returning error 2 would not be helpful in determining which file is missing.</span></span>

<span data-ttu-id="8ce30-116">Em vez disso, o servidor poderia chamar a função [**RpcErrorAddRecord**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcerroraddrecord) e fornecer um parâmetro de cadeia de caracteres, ANSI ou Unicode, no registro de erro indicando o caminho completo do arquivo que estava procurando.</span><span class="sxs-lookup"><span data-stu-id="8ce30-116">Instead, your server could call the [**RpcErrorAddRecord**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcerroraddrecord) function and provide a string parameter, either ANSI or Unicode, in the error record indicating the full path of the file it was looking for.</span></span> <span data-ttu-id="8ce30-117">Quando todas essas informações aparecem na tela do usuário em um computador remoto, a solução de problemas torna-se trivial; uma verificação simples de se o arquivo existe pode ser feita, especialmente porque o nome do computador em questão já foi fornecido pelo tempo de execução RPC.</span><span class="sxs-lookup"><span data-stu-id="8ce30-117">When all this information appears on the user screen on a remote computer, troubleshooting becomes trivial; a simple check of whether the file exists can be done, especially since the name of the computer in question is already provided by the RPC run time.</span></span>

<span data-ttu-id="8ce30-118">A chamada de função [**RpcErrorAddRecord**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcerroraddrecord) poderá falhar se memória suficiente não estiver disponível, mesmo que exija apenas alguns bytes de espaço de heap.</span><span class="sxs-lookup"><span data-stu-id="8ce30-118">The [**RpcErrorAddRecord**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcerroraddrecord) function call may fail if enough memory is not available, even though it requires only a few bytes of heap space.</span></span> <span data-ttu-id="8ce30-119">Além disso, os registros adicionados pelo **RpcErrorAddRecord** são acumulados em um determinado thread.</span><span class="sxs-lookup"><span data-stu-id="8ce30-119">Also, records added by **RpcErrorAddRecord** accumulate in a given thread.</span></span> <span data-ttu-id="8ce30-120">O tempo de execução normalmente limpa esses registros antes de chamar a rotina do servidor, mas se as informações de erro estendidas forem usadas fora do RPC, tome cuidado com a limpeza do erro estendido acumulado no thread chamando [**RpcErrorClearInformation**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcerrorclearinformation).</span><span class="sxs-lookup"><span data-stu-id="8ce30-120">The runtime normally cleans those records up before it calls your server routine, but if extended error information is used outside RPC, take care of cleaning up the accumulated extended error in the thread by calling [**RpcErrorClearInformation**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcerrorclearinformation).</span></span>

 

 




