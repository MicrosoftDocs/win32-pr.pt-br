---
title: Escolhendo as opções de QOS de segurança
description: As opções de QOS de segurança são passadas como parte do parâmetro SecurityQOS fornecido para a função RpcBindingSetAuthInfoEx. Use as práticas recomendadas a seguir.
ms.assetid: 43befe3d-079a-4389-a1ff-6bda90935769
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8c286b516438eae78117ef8d73939c3b4bed396d
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/20/2020
ms.locfileid: "105759346"
---
# <a name="choosing-security-qos-options"></a><span data-ttu-id="d7bd3-104">Escolhendo as opções de QOS de segurança</span><span class="sxs-lookup"><span data-stu-id="d7bd3-104">Choosing Security QOS Options</span></span>

<span data-ttu-id="d7bd3-105">As opções de QOS de segurança são passadas como parte do parâmetro *SecurityQOS* fornecido para a função [**RpcBindingSetAuthInfoEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfoexa) .</span><span class="sxs-lookup"><span data-stu-id="d7bd3-105">The security QOS options are passed as part of the *SecurityQOS* parameter given to the [**RpcBindingSetAuthInfoEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfoexa) function.</span></span> <span data-ttu-id="d7bd3-106">Use as práticas recomendadas a seguir.</span><span class="sxs-lookup"><span data-stu-id="d7bd3-106">Use the following best practices.</span></span>

## <a name="use-mutual-authentication"></a><span data-ttu-id="d7bd3-107">Usar autenticação mútua</span><span class="sxs-lookup"><span data-stu-id="d7bd3-107">Use Mutual Authentication</span></span>

<span data-ttu-id="d7bd3-108">A autenticação mútua verdadeira está disponível apenas para determinados provedores de segurança: Negotiate (ao negociar Kerberos), Kerberos e Schannel.</span><span class="sxs-lookup"><span data-stu-id="d7bd3-108">True mutual authentication is available only for certain security providers: Negotiate (when it negotiates Kerberos), Kerberos, and Schannel.</span></span> <span data-ttu-id="d7bd3-109">O NTLM não oferece suporte à autenticação mútua.</span><span class="sxs-lookup"><span data-stu-id="d7bd3-109">NTLM does not support mutual authentication.</span></span> <span data-ttu-id="d7bd3-110">O uso da autenticação mútua exige que um nome de entidade de servidor bem formado seja fornecido.</span><span class="sxs-lookup"><span data-stu-id="d7bd3-110">Using mutual authentication requires that a well formed server principal name be provided.</span></span> <span data-ttu-id="d7bd3-111">Muitos desenvolvedores usam a seguinte prática de segurança com falha: o servidor é chamado para solicitar seu nome principal ([**RpcMgmtInqServerPrincName**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcmgmtinqserverprincname)) e, em seguida, ele solicita indistintamente a autenticação mútua usando esse nome de entidade.</span><span class="sxs-lookup"><span data-stu-id="d7bd3-111">Many developers use the following faulty security practice: The server is called to ask for its principal name ([**RpcMgmtInqServerPrincName**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcmgmtinqserverprincname)), and then they blindly ask for mutual authentication using that principal name.</span></span> <span data-ttu-id="d7bd3-112">Essa abordagem quebra toda a ideia de autenticação mútua; a ideia de autenticação mútua é que apenas determinados servidores são chamados porque são confiáveis para analisar e lidar com seus dados.</span><span class="sxs-lookup"><span data-stu-id="d7bd3-112">This approach breaks the whole idea of mutual authentication; the idea of mutual authentication is that only certain servers are called because they are trusted to parse and handle your data.</span></span> <span data-ttu-id="d7bd3-113">Usando a prática de segurança com falhas que você acabou de descrever, os desenvolvedores fornecem seus dados a qualquer pessoa inteligente o suficiente para retornar seu nome.</span><span class="sxs-lookup"><span data-stu-id="d7bd3-113">Using the faulty security practice just described, developers give their data to anyone smart enough to return their name.</span></span>

<span data-ttu-id="d7bd3-114">Por exemplo, se o software cliente deve chamar apenas um servidor em execução nas contas de Joe, Pete ou Alice, a função [**RpcMgmtInqServerPrincName**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcmgmtinqserverprincname) deve ser chamada e o nome enviado deve ser verificado.</span><span class="sxs-lookup"><span data-stu-id="d7bd3-114">As an example, if the client software should call only a server running under Joe, Pete, or Alice's accounts, the [**RpcMgmtInqServerPrincName**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcmgmtinqserverprincname) function should be called, and the name sent back should be checked.</span></span> <span data-ttu-id="d7bd3-115">Se for Joe, Pete ou Alice, a autenticação mútua deverá ser solicitada usando o nome principal do servidor.</span><span class="sxs-lookup"><span data-stu-id="d7bd3-115">If it is Joe, Pete or Alice, mutual authentication should be requested using their server principal name.</span></span> <span data-ttu-id="d7bd3-116">Isso garante que ambas as metades da conversa vão para a mesma entidade de segurança.</span><span class="sxs-lookup"><span data-stu-id="d7bd3-116">This ensures both halves of the conversation go to the same principal.</span></span>

<span data-ttu-id="d7bd3-117">Se o software cliente deve chamar um serviço em execução apenas na conta de Joe, redija diretamente o nome principal do servidor de Joe e faça a chamada.</span><span class="sxs-lookup"><span data-stu-id="d7bd3-117">If client software should call a service running under Joe's account only, directly compose Joe's server principal name and make the call.</span></span> <span data-ttu-id="d7bd3-118">Se o servidor não for Joe, a chamada simplesmente falhará.</span><span class="sxs-lookup"><span data-stu-id="d7bd3-118">If the server is not Joe, the call will simply fail.</span></span>

<span data-ttu-id="d7bd3-119">Muitas vezes, os serviços são executados como serviços de sistema do Windows, o que significa que eles são executados na conta do computador.</span><span class="sxs-lookup"><span data-stu-id="d7bd3-119">Many times, services run as Windows system services, which means they run under the machine account.</span></span> <span data-ttu-id="d7bd3-120">A autenticação mútua e a criação de um nome principal de servidor ainda são recomendadas.</span><span class="sxs-lookup"><span data-stu-id="d7bd3-120">Mutual authentication and creation of a server principal name is still recommended.</span></span>

## <a name="use-the-lowest-impersonationtype-that-allows-the-call-to-go-through"></a><span data-ttu-id="d7bd3-121">Use o Impersonationtype mais baixo que permite que a chamada passe por</span><span class="sxs-lookup"><span data-stu-id="d7bd3-121">Use the Lowest ImpersonationType that Allows the Call to Go Through</span></span>

<span data-ttu-id="d7bd3-122">Essa prática recomendada é bastante auto-explicativa.</span><span class="sxs-lookup"><span data-stu-id="d7bd3-122">This Best Practice is fairly self explanatory.</span></span> <span data-ttu-id="d7bd3-123">Mesmo que a autenticação mútua seja usada, não conceda ao servidor mais direitos do que o necessário; um servidor legítimo pode ter sido comprometido e, embora os dados enviados entrem em mãos erradas nesses casos, pelo menos o servidor não será capaz de acessar outros dados na rede em seu nome.</span><span class="sxs-lookup"><span data-stu-id="d7bd3-123">Even if mutual authentication is used, do not give the server more rights than necessary; a legitimate server may have been compromised, and even though the data you send falls into the wrong hands in such cases, at least the server will not be able to access other data on the network on your behalf.</span></span> <span data-ttu-id="d7bd3-124">Alguns servidores rejeitarão uma chamada que não tem informações suficientes para determinar e possivelmente representar o chamador.</span><span class="sxs-lookup"><span data-stu-id="d7bd3-124">Some servers will reject a call that does not have sufficient information to determine, and possibly impersonate, the caller.</span></span> <span data-ttu-id="d7bd3-125">Além disso, lembre-se de que algumas sequências de protocolo dão suporte à segurança de nível de transporte ([**ncacn \_ NP**](/windows/desktop/Midl/ncacn-np) e [**Ncalrpc**](/windows/desktop/Midl/ncalrpc)).</span><span class="sxs-lookup"><span data-stu-id="d7bd3-125">Also, be aware that some protocol sequences support transport level security ([**ncacn\_np**](/windows/desktop/Midl/ncacn-np) and [**ncalrpc**](/windows/desktop/Midl/ncalrpc)).</span></span> <span data-ttu-id="d7bd3-126">Nesses casos, o servidor sempre poderá representá-lo se você especificar um nível de representação suficientemente alto por meio do parâmetro *networkoptions* ao criar o identificador de associação.</span><span class="sxs-lookup"><span data-stu-id="d7bd3-126">In such cases, the server can always impersonate you if you specify a sufficiently high impersonation level through the *NetworkOptions* parameter when you create the binding handle.</span></span>

<span data-ttu-id="d7bd3-127">Por fim, alguns provedores de segurança ou transportes podem aumentar de forma transparente um nível mais alto do que o especificado.</span><span class="sxs-lookup"><span data-stu-id="d7bd3-127">Finally, some security providers or transports may transparently bump ImpersonationType to a higher level than that specified.</span></span> <span data-ttu-id="d7bd3-128">Ao desenvolver um programa, certifique-se de tentar fazer chamadas com o Impersonationtype pretendido e verificar se você está obtendo um Impersonationtype maior no servidor.</span><span class="sxs-lookup"><span data-stu-id="d7bd3-128">When developing a program, make sure you try to make calls with the intended ImpersonationType and check whether you are getting higher ImpersonationType on the server.</span></span>

 

 