---
title: Manutenção automática (Agendador de Tarefas)
description: A atividade de manutenção refere-se a um aplicativo ou processo que ajuda a manter a integridade e o desempenho de um computador Windows.
ms.assetid: 1D38341B-15AA-422F-AED1-647FCDE69E2E
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 456383eeb75c3b29bf575357d4b17d5f8a66234b
ms.sourcegitcommit: 857e701bbd35004661bb047e1f24622af9ff1dd7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/19/2020
ms.locfileid: "104366862"
---
# <a name="automatic-maintenance"></a><span data-ttu-id="a290e-103">Manutenção automática</span><span class="sxs-lookup"><span data-stu-id="a290e-103">Automatic maintenance</span></span>

<span data-ttu-id="a290e-104">A atividade de manutenção refere-se a um aplicativo ou processo que ajuda a manter a integridade e o desempenho de um computador Windows.</span><span class="sxs-lookup"><span data-stu-id="a290e-104">Maintenance activity refers to an application or process that helps maintain the health and performance of a Windows PC.</span></span> <span data-ttu-id="a290e-105">A manutenção inclui manter o sistema operacional Windows (SO) e os aplicativos atualizados, verificar a segurança e executar verificações de malware.</span><span class="sxs-lookup"><span data-stu-id="a290e-105">Maintenance includes keeping the Windows operating system (OS) and applications up-to-date, checking security, and running scans for malware.</span></span> <span data-ttu-id="a290e-106">O gerenciamento automático do Windows (WAM) é um conjunto de aprimoramentos para a API Agendador de Tarefas que você pode usar para vincular seus aplicativos ao agendamento de manutenção do Windows.</span><span class="sxs-lookup"><span data-stu-id="a290e-106">Windows Automatic Management (WAM) is a set of enhancements to the Task Scheduler API that you can use to link your applications into the Windows maintenance schedule.</span></span> <span data-ttu-id="a290e-107">Especificamente, o WAM permite que você adicione atividades que exigem agendamento regular, mas que não têm requisitos de tempo exatos.</span><span class="sxs-lookup"><span data-stu-id="a290e-107">Specifically, WAM allows you to add activities that require regular scheduling, but that don't have exact time requirements.</span></span> <span data-ttu-id="a290e-108">Em vez disso, o WAM conta com o sistema operacional para escolher o tempo apropriado para ativar a tarefa ao longo do dia.</span><span class="sxs-lookup"><span data-stu-id="a290e-108">Instead, WAM relies on the operating system to choose the appropriate time to activate the task throughout the day.</span></span> <span data-ttu-id="a290e-109">O sistema escolhe esses horários com base no impacto mínimo sobre o usuário, o desempenho do PC e a eficiência energética.</span><span class="sxs-lookup"><span data-stu-id="a290e-109">The system chooses those times based on minimal impact to the user, PC performance, and energy efficiency.</span></span>

## <a name="how-scheduled-maintenance-works"></a><span data-ttu-id="a290e-110">Como funciona a manutenção agendada</span><span class="sxs-lookup"><span data-stu-id="a290e-110">How scheduled maintenance works</span></span>

<span data-ttu-id="a290e-111">Agendador de Tarefas tarefas de manutenção são tarefas oportunistas que são executadas quando o computador está ocioso e com energia CA.</span><span class="sxs-lookup"><span data-stu-id="a290e-111">Task Scheduler maintenance tasks are opportunistic tasks that run when the machine is idle and on AC power.</span></span> <span data-ttu-id="a290e-112">Um dos principais objetivos das tarefas de manutenção é minimizar o impacto para o PC agendando a manutenção somente quando o PC estiver conectado à energia AC e ocioso (ou seja, quando você não estiver usando ou tiver passado do computador).</span><span class="sxs-lookup"><span data-stu-id="a290e-112">One of the major goals of maintenance tasks is to minimize impact to the PC by scheduling maintenance only when the PC is plugged in to AC power and idle (that is, when you're not using, or have stepped away from, the machine).</span></span> <span data-ttu-id="a290e-113">A ideia da manutenção hoje é que a máquina funcione com o mínimo de interrupções para o usuário.</span><span class="sxs-lookup"><span data-stu-id="a290e-113">The idea of maintenance today is for the machine to do work with the least disruption to the user.</span></span> <span data-ttu-id="a290e-114">Portanto, a hora de manutenção em estilo antigo (falaremos mais sobre isso na seção **&mdash; ativação diária de manutenção automática** mais adiante neste tópico) foi aprimorada para aproveitar esses períodos ociosos.</span><span class="sxs-lookup"><span data-stu-id="a290e-114">Hence the old-style maintenance hour (we talk more about this in the **Automatic maintenance&mdash;daily wakeup** section later in this topic) has been improved in order to take advantage of these idle periods.</span></span> <span data-ttu-id="a290e-115">Embora a hora de manutenção ainda possa ser utilizada, a execução de manutenção oportunista é melhor para a integridade do sistema.</span><span class="sxs-lookup"><span data-stu-id="a290e-115">While the maintenance hour can still be leveraged, running opportunistic maintenance is better for system health.</span></span>

<span data-ttu-id="a290e-116">Sua tarefa poderá ficar sem interatividade se um computador não gastar muito tempo ocioso e em energia CA.</span><span class="sxs-lookup"><span data-stu-id="a290e-116">Your task may be starved if a machine doesn't spend much time both idle and on AC power.</span></span> <span data-ttu-id="a290e-117">Verifique se seu cenário ainda fornecerá valor para o usuário, mesmo se ele estiver atrasado.</span><span class="sxs-lookup"><span data-stu-id="a290e-117">Make sure that your scenario will still provide value to the user, even if it is delayed.</span></span> <span data-ttu-id="a290e-118">Se o usuário estiver usando ativamente o computador, o sistema adiará a manutenção até uma hora posterior.</span><span class="sxs-lookup"><span data-stu-id="a290e-118">If the user is actively using the machine, then the system defers maintenance until a later time.</span></span> <span data-ttu-id="a290e-119">O sistema também suspende qualquer tarefa de manutenção em execução se o usuário retornar ao uso do PC.</span><span class="sxs-lookup"><span data-stu-id="a290e-119">The system also suspends any executing maintenance task if the user returns to using the PC.</span></span>

<span data-ttu-id="a290e-120">O sistema reinicia uma tarefa de manutenção suspensa durante o próximo período ocioso; no entanto, o sistema não suspenderá nenhuma tarefa marcada como crítica.</span><span class="sxs-lookup"><span data-stu-id="a290e-120">The system restarts a suspended maintenance task during the next idle period; however, the system won't suspend any task marked as critical.</span></span> <span data-ttu-id="a290e-121">Em vez disso, o sistema permite que uma tarefa crítica seja concluída, independentemente da ação do usuário.</span><span class="sxs-lookup"><span data-stu-id="a290e-121">Instead, the system allows a critical task to complete, regardless of user action.</span></span>

<span data-ttu-id="a290e-122">Devido à natureza do agendamento, algumas tarefas agendadas podem não ser concluídas: Talvez haja muitos eventos agendados para caber na janela de manutenção de uma hora ou talvez o computador simplesmente não esteja ligado.</span><span class="sxs-lookup"><span data-stu-id="a290e-122">Due to the nature of scheduling, some scheduled tasks may not finish: perhaps there are too many scheduled events to fit into the 1-hour maintenance window, or maybe the computer was simply not turned on.</span></span> <span data-ttu-id="a290e-123">Nesses casos, você pode definir uma tarefa com um prazo final.</span><span class="sxs-lookup"><span data-stu-id="a290e-123">In such cases, you can define a task with a deadline.</span></span> <span data-ttu-id="a290e-124">Um prazo é definido como um período de tempo recorrente no qual o sistema deve executar a tarefa com êxito pelo menos uma vez.</span><span class="sxs-lookup"><span data-stu-id="a290e-124">A deadline is defined as a recurring timeframe in which the system must successfully perform the task at least once.</span></span>

<span data-ttu-id="a290e-125">Se uma tarefa perder um prazo, o Agendador de manutenção continuará tentando executar a tarefa durante a janela de manutenção.</span><span class="sxs-lookup"><span data-stu-id="a290e-125">If a task misses a deadline, then the maintenance scheduler will continue to attempt to execute the task during the maintenance window.</span></span> <span data-ttu-id="a290e-126">Além disso, o Agendador não se limitará ao limite de tempo normal de 1 hora.</span><span class="sxs-lookup"><span data-stu-id="a290e-126">Further, the scheduler will not limit itself to the regular 1-hour time limit.</span></span> <span data-ttu-id="a290e-127">Em vez disso, o Agendador estende a duração da janela de manutenção a fim de concluir a tarefa atrasada.</span><span class="sxs-lookup"><span data-stu-id="a290e-127">Instead, the scheduler extends the duration of the maintenance window in order to complete the delayed task.</span></span>

<span data-ttu-id="a290e-128">Depois que o sistema concluir a tarefa (mesmo com um código de erro de falha), a tentativa será considerada bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="a290e-128">Once the system completes the task (even with a failure error code), the attempt is considered successful.</span></span> <span data-ttu-id="a290e-129">Após uma tentativa bem-sucedida, o Agendador é redefinido para a agenda de manutenção regular e tentará a tarefa durante o próximo período.</span><span class="sxs-lookup"><span data-stu-id="a290e-129">After a successful attempt, the scheduler resets to the regular maintenance schedule, and will attempt the task during the next period.</span></span>

## <a name="automatic-maintenancemdashdaily-wakeup"></a><span data-ttu-id="a290e-130">Ativação diária de manutenção automática &mdash;</span><span class="sxs-lookup"><span data-stu-id="a290e-130">Automatic maintenance&mdash;daily wakeup</span></span>

<span data-ttu-id="a290e-131">No Windows 7, uma tarefa de manutenção é executada exclusivamente durante a *hora de manutenção*, padronizando para 3 AM e configurável por meio de política de grupo.</span><span class="sxs-lookup"><span data-stu-id="a290e-131">On Windows 7, a maintenance task runs exclusively during *maintenance hour*, defaulting to 3 AM, and configurable via Group Policy.</span></span> <span data-ttu-id="a290e-132">A máquina seria ativada em espera, executa tarefas de manutenção e volta para o modo de suspensão.</span><span class="sxs-lookup"><span data-stu-id="a290e-132">The machine would wake up from standby, run maintenance tasks, and go back to sleep.</span></span> <span data-ttu-id="a290e-133">Esta sessão diária foi limitada a uma duração máxima de 1 hora por tentativa.</span><span class="sxs-lookup"><span data-stu-id="a290e-133">This daily session was limited to a maximum duration of 1 hour per attempt.</span></span> <span data-ttu-id="a290e-134">Isso permitiria que o sistema executasse a manutenção diariamente, começando às 3 AM por padrão.</span><span class="sxs-lookup"><span data-stu-id="a290e-134">This would allow the system to perform maintenance daily, starting at 3 AM by default.</span></span> <span data-ttu-id="a290e-135">Observe que o usuário pode reagendar a hora em que a manutenção é disparada Configurando essas configurações.</span><span class="sxs-lookup"><span data-stu-id="a290e-135">Note that the user may re-schedule the time that the maintenance is triggered by configuring these settings.</span></span>

<span data-ttu-id="a290e-136">Com o advento dos laptops e o foco pesado na vida útil da bateria, as máquinas não são mais configuradas para permitir a ativação S3 na maioria das circunstâncias e, geralmente, doze-to-S4 (hibernação) assim que possível, para economizar bateria.</span><span class="sxs-lookup"><span data-stu-id="a290e-136">With the advent of laptops, and the heavy focus on battery life, machines are no longer configured to allow S3 wakeup in most circumstances, and generally Doze-To-S4 (hibernate) as soon as possible, to save battery.</span></span> <span data-ttu-id="a290e-137">Em resposta a essas alterações, Agendador de Tarefas (> Win7) executa tarefas de manutenção sempre que elas estiverem vencidas e o computador estiver ocioso e em corrente alternada.</span><span class="sxs-lookup"><span data-stu-id="a290e-137">In response to these changes, Task Scheduler (> Win7) runs maintenance tasks whenever they are due, and the machine is idle and on AC power.</span></span>

<span data-ttu-id="a290e-138">Essa configuração pode ser definida no painel de controle.</span><span class="sxs-lookup"><span data-stu-id="a290e-138">This setting can be configured in Control Panel.</span></span>

<span data-ttu-id="a290e-139">Abra sistema do **painel**  >  **de controle e**  >  **segurança de segurança e manutenção** manutenção  >  **automática**.</span><span class="sxs-lookup"><span data-stu-id="a290e-139">Open **Control Panel** > **System and Security** > **Security and Maintenance** > **Automatic Maintenance**.</span></span>

<span data-ttu-id="a290e-140">Com base em como seus computadores e suas tarefas estão configurados, o comportamento de ativação diária pode não ocorrer hoje como esperado devido a essa nova configuração.</span><span class="sxs-lookup"><span data-stu-id="a290e-140">So based on how your machines and your tasks are configured, the daily wakeup behavior may not occur today as expected because of this new configuration.</span></span> <span data-ttu-id="a290e-141">Você pode primeiro determinar se o computador é compatível com S3 ou o CS (conectado em espera).</span><span class="sxs-lookup"><span data-stu-id="a290e-141">You can first determine whether your machine is S3 capable or CS (Connected Standby) capable.</span></span>
<span data-ttu-id="a290e-142">Isso pode ser feito abrindo um prompt do Shell de energia com privilégios elevados e executando o comando a seguir.</span><span class="sxs-lookup"><span data-stu-id="a290e-142">This can be done by opening an elevated power shell prompt, and running the following command.</span></span>

```console
powercfg /a
```

<span data-ttu-id="a290e-143">Hora de manutenção, se a máquina estiver configurada corretamente, ainda funciona, mas se não estiver,</span><span class="sxs-lookup"><span data-stu-id="a290e-143">Maintenance hour, if the machine is configured correctly, still works, but if it doesn't,</span></span>
  - <span data-ttu-id="a290e-144">Verifique as configurações do BIOS para obter as configurações de ativação.</span><span class="sxs-lookup"><span data-stu-id="a290e-144">Check your BIOS settings for Wake settings.</span></span> 
  - <span data-ttu-id="a290e-145">Verifique se a opção permitir temporizador de ativação está habilitada nas opções de energia.</span><span class="sxs-lookup"><span data-stu-id="a290e-145">Check whether Allow Wake Timer is enabled in Power Options.</span></span>
    <span data-ttu-id="a290e-146">Vá para **painel de controle**  >  **hardware e sons**  >  **Opções de energia**  >  **Editar configurações do plano**  >  **alterar configurações de energia avançadas** > clique em **suspensão**  >  **permitir temporizador de ativação**.</span><span class="sxs-lookup"><span data-stu-id="a290e-146">Go to **Control Panel** > **Hardware and Sound** > **Power Options** > **Edit Plan Settings** > **Change advanced power settings** > click **Sleep** > **Allow Wake Timer**.</span></span>
  - <span data-ttu-id="a290e-147">Verifique se a tarefa agendada está configurada com o seguinte.</span><span class="sxs-lookup"><span data-stu-id="a290e-147">Check whether your scheduled task is configured with following.</span></span>
      * <span data-ttu-id="a290e-148">MaintenanceSettings: a tarefa deve ser configurada com período, prazo final.</span><span class="sxs-lookup"><span data-stu-id="a290e-148">MaintenanceSettings: Task should be configured with Period, Deadline.</span></span>
      * <span data-ttu-id="a290e-149">Habilitado: a tarefa deve ser habilitada.</span><span class="sxs-lookup"><span data-stu-id="a290e-149">Enabled: Task should be enabled.</span></span>
      * <span data-ttu-id="a290e-150">WakeToRun: a tarefa deve ter permissão para ativar o computador.</span><span class="sxs-lookup"><span data-stu-id="a290e-150">WakeToRun: Task should be allowed to wake the machine.</span></span>
  - <span data-ttu-id="a290e-151">Para o agendamento de ativações do CS, o computador deve ser compatível com AOAC.</span><span class="sxs-lookup"><span data-stu-id="a290e-151">For scheduling wakes from CS, the machine should be AOAC capable.</span></span>
  - <span data-ttu-id="a290e-152">Para o agendamento de ativações em computadores S3,</span><span class="sxs-lookup"><span data-stu-id="a290e-152">For scheduling wakes in S3 machines,</span></span>
      * <span data-ttu-id="a290e-153">Verifique se o computador entrou em S3 em corrente alternada.</span><span class="sxs-lookup"><span data-stu-id="a290e-153">Check whether the machine went into S3 on AC Power.</span></span>
      * <span data-ttu-id="a290e-154">O sistema deve ter a **ativação habilitada** no política de grupo para manutenção.</span><span class="sxs-lookup"><span data-stu-id="a290e-154">The system should have **Wake Enabled** in Group Policy for Maintenance.</span></span>
 
<span data-ttu-id="a290e-155">A espera conectada é o estado do sistema que um sistema compatível com AOAC pode inserir.</span><span class="sxs-lookup"><span data-stu-id="a290e-155">Connected Standby is the system state that an AOAC-compliant system can enter.</span></span>

<span data-ttu-id="a290e-156">Consulte as diferenças entre o modo de espera moderno e S3 no tópico [moderno em espera vs S3](/windows-hardware/design/device-experiences/modern-standby-vs-s3).</span><span class="sxs-lookup"><span data-stu-id="a290e-156">See differences between Modern Standby and S3 in the topic [Modern Standby vs S3](/windows-hardware/design/device-experiences/modern-standby-vs-s3).</span></span>

## <a name="defining-an-automatic-maintenance-task"></a><span data-ttu-id="a290e-157">Definindo uma tarefa de manutenção automática</span><span class="sxs-lookup"><span data-stu-id="a290e-157">Defining an Automatic Maintenance Task</span></span>

<span data-ttu-id="a290e-158">Você pode converter qualquer tarefa de Agendador de Tarefas em uma tarefa de manutenção.</span><span class="sxs-lookup"><span data-stu-id="a290e-158">You can convert any Task Scheduler task to a maintenance task.</span></span> <span data-ttu-id="a290e-159">Para fazer isso, você deve confirmar que seu aplicativo pode ser suspenso.</span><span class="sxs-lookup"><span data-stu-id="a290e-159">To do so, you must confirm that your application can be suspended.</span></span> <span data-ttu-id="a290e-160">Em seguida, você deve estender a definição de tarefa com os novos elementos [**MaintenanceSettings**](taskschedulerschema-maintenancesettings-maintenancesettingstype-element.md) e [**AllowStartOnDemand**](taskschedulerschema-allowstartondemand-settingstype-element.md) .</span><span class="sxs-lookup"><span data-stu-id="a290e-160">Then, you must extend the task definition with the new [**MaintenanceSettings**](taskschedulerschema-maintenancesettings-maintenancesettingstype-element.md) and [**AllowStartOnDemand**](taskschedulerschema-allowstartondemand-settingstype-element.md) elements.</span></span>

<span data-ttu-id="a290e-161">A principal preocupação com a criação de uma tarefa de manutenção é garantir que o sistema possa suspender e reiniciar a tarefa.</span><span class="sxs-lookup"><span data-stu-id="a290e-161">The main concern with creating a maintenance task is ensuring that the system can suspend and restart the task.</span></span> <span data-ttu-id="a290e-162">O sistema provavelmente suspenderá uma tarefa de manutenção várias vezes; Portanto, você precisa garantir que seu aplicativo seja capaz de salvar seu próprio Estado e, em seguida, retomar em um horário arbitrário.</span><span class="sxs-lookup"><span data-stu-id="a290e-162">The system will likely suspend a maintenance task multiple times; therefore, you need to ensure that your application is able to save its own state, and then resume at an arbitrary time.</span></span> <span data-ttu-id="a290e-163">Isso garante que o sistema não execute a mesma parte de sua tarefa repetidamente.</span><span class="sxs-lookup"><span data-stu-id="a290e-163">This ensures that the system does not perform the same part of your task repeatedly.</span></span>

<span data-ttu-id="a290e-164">Depois de garantir que seu aplicativo pode ser suspenso e retomado normalmente, você pode usar os elementos **MaintenanceSettings** e **AllowStartOnDemand** para definir o agendamento.</span><span class="sxs-lookup"><span data-stu-id="a290e-164">Once you have ensured that your application can be suspended and resumed gracefully, you can use the **MaintenanceSettings** and **AllowStartOnDemand** elements to define the schedule.</span></span> <span data-ttu-id="a290e-165">**MaintenanceSettings** é definido de acordo com o período, o prazo e o exclusividade.</span><span class="sxs-lookup"><span data-stu-id="a290e-165">**MaintenanceSettings** is defined according to the period, deadline, and exclusivity.</span></span>

-   <span data-ttu-id="a290e-166">O **período** é obrigatório e define a frequência com que a tarefa deve ocorrer.</span><span class="sxs-lookup"><span data-stu-id="a290e-166">The **period** is mandatory, and defines how often the task should occur.</span></span> <span data-ttu-id="a290e-167">Normalmente, isso é definido em termos de um ciclo de vários dias, como "uma vez a cada 5 dias".</span><span class="sxs-lookup"><span data-stu-id="a290e-167">Usually, this is defined in terms of a multi-day cycle, such as “once every 5 days”.</span></span> <span data-ttu-id="a290e-168">Um período deve ser de pelo menos um dia, o que significa que não é possível agendar uma tarefa para ocorrer várias vezes em um dia.</span><span class="sxs-lookup"><span data-stu-id="a290e-168">A period must be at least one day, meaning that you can't schedule a task to occur multiple times in a day.</span></span>
-   <span data-ttu-id="a290e-169">O **prazo** é opcional e define por quanto tempo o Agendador pode falhar para concluir a tarefa antes de notificar o usuário ou executar a manutenção de emergência.</span><span class="sxs-lookup"><span data-stu-id="a290e-169">The **deadline** is optional, and defines how long the scheduler can fail to complete the task before notifying the user or performing emergency maintenance.</span></span> <span data-ttu-id="a290e-170">O prazo final deve ser maior do que o período, o que significa que o sistema deve ter a oportunidade de tentar a tarefa pelo menos uma vez antes de notificar o usuário.</span><span class="sxs-lookup"><span data-stu-id="a290e-170">The deadline must be longer than the period, meaning that the system must have the opportunity to attempt the task at least once before notifying the user.</span></span>
-   <span data-ttu-id="a290e-171">Além disso, uma tarefa de manutenção pode, opcionalmente, ser definida como *exclusiva*.</span><span class="sxs-lookup"><span data-stu-id="a290e-171">In addition, a maintenance task can optionally be defined as *exclusive*.</span></span> <span data-ttu-id="a290e-172">Uma tarefa exclusiva é executada separadamente de outras tarefas de manutenção.</span><span class="sxs-lookup"><span data-stu-id="a290e-172">An exclusive task runs separate from other maintenance tasks.</span></span> <span data-ttu-id="a290e-173">Normalmente, uma tarefa exclusiva é aquela que usa um grande número de recursos, como uma grande quantidade de tempo de CPU ou acesso exclusivo a um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="a290e-173">Usually, an exclusive task is one that uses a great deal of resources, such as a large amount of CPU time, or exclusive access to a database.</span></span> <span data-ttu-id="a290e-174">O sistema conclui todas as tarefas de manutenção não exclusivas antes de iniciar uma tarefa exclusiva.</span><span class="sxs-lookup"><span data-stu-id="a290e-174">The system completes all non-exclusive maintenance tasks before starting an exclusive task.</span></span> <span data-ttu-id="a290e-175">Portanto, você deve declarar uma tarefa somente como exclusiva quando necessário.</span><span class="sxs-lookup"><span data-stu-id="a290e-175">Therefore, you should declare a task as exclusive only when necessary.</span></span>

<span data-ttu-id="a290e-176">Por outro lado, **AllowStartOnDemand** simplesmente indica que o sistema ou o usuário pode iniciar a tarefa a qualquer momento.</span><span class="sxs-lookup"><span data-stu-id="a290e-176">In contrast, **AllowStartOnDemand** merely indicates that the system or the user can start the task at any time.</span></span> <span data-ttu-id="a290e-177">Isso permite que o sistema inicie a tarefa durante a manutenção regular.</span><span class="sxs-lookup"><span data-stu-id="a290e-177">This allows the system to start the task during regular maintenance.</span></span> <span data-ttu-id="a290e-178">Caso contrário, você precisaria definir um gatilho exclusivo para a tarefa.</span><span class="sxs-lookup"><span data-stu-id="a290e-178">Otherwise, you would have to set a unique trigger for the task.</span></span>
