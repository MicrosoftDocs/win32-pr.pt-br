---
title: Proteção de segurança de tarefa
description: Usar o recurso de proteção de segurança de tarefas permitirá que os proprietários da tarefa executem suas tarefas com os privilégios mínimos necessários.
ms.assetid: ba03add5-aa05-4bef-baec-684ca17363bd
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0ab70679d605a9ad56c6d26116245ae17d41a7a1
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/16/2019
ms.locfileid: "104159832"
---
# <a name="task-security-hardening"></a><span data-ttu-id="1ea22-103">Proteção de segurança de tarefa</span><span class="sxs-lookup"><span data-stu-id="1ea22-103">Task Security Hardening</span></span>

<span data-ttu-id="1ea22-104">Usar o recurso de proteção de segurança de tarefas permitirá que os proprietários da tarefa executem suas tarefas com os privilégios mínimos necessários.</span><span class="sxs-lookup"><span data-stu-id="1ea22-104">Using the tasks security hardening feature will allow task owners to run their tasks with minimum required privileges.</span></span> <span data-ttu-id="1ea22-105">Observe que esse recurso está habilitado por padrão e os proprietários da tarefa podem fazer ajustes adicionais usando o tipo de identificador de segurança do token de processo e a matriz de privilégios necessários da tarefa.</span><span class="sxs-lookup"><span data-stu-id="1ea22-105">Note that this feature is enabled by default and task owners can make further adjustments by using the task process token security identifier type and task required privileges array.</span></span>

## <a name="task-process-token-sid-type-and-task-required-privileges-array"></a><span data-ttu-id="1ea22-106">Tipo de SID do token do processo de tarefa e matriz de privilégios necessários da tarefa</span><span class="sxs-lookup"><span data-stu-id="1ea22-106">Task Process Token SID Type and Task Required Privileges Array</span></span>

<span data-ttu-id="1ea22-107">Especificar **ProcessTokenSidType** no nível de definição de tarefa permite que os proprietários da tarefa solicitem que um processo de tarefa seja executado com o tipo de Sid "nenhum" ou o tipo de Sid "irrestrito".</span><span class="sxs-lookup"><span data-stu-id="1ea22-107">Specifying **ProcessTokenSidType** at the task definition level allows task owners to request a task process to run with the "none" SID type or the "unrestricted" SID type.</span></span> <span data-ttu-id="1ea22-108">Se o campo estiver presente na definição de tarefa, a validação garantirá que a UserId da tarefa contenha o nome ou a cadeia de caracteres SID correspondente para uma das contas de serviço internas do sistema operacional: "serviço de rede" ou "serviço LOCAL".</span><span class="sxs-lookup"><span data-stu-id="1ea22-108">If the field is present in task definition, validation ensures that task UserId contains the name or the corresponding SID string for one of those operating system built-in service accounts: "NETWORK SERVICE" or "LOCAL SERVICE".</span></span>

<span data-ttu-id="1ea22-109">O tipo de SID "None" significa que a tarefa é executada em um processo que não contém um SID de token de processo (nenhuma alteração será feita na lista de grupos de tokens de processo).</span><span class="sxs-lookup"><span data-stu-id="1ea22-109">The SID type "none" means that the task runs in a process that does not contain a process token SID (no changes will be made to the process token groups list).</span></span> <span data-ttu-id="1ea22-110">O SID da conta da entidade de tarefa (LocalService/NetworkService) nesse caso tem acesso completo ao token do processo.</span><span class="sxs-lookup"><span data-stu-id="1ea22-110">The task principal account SID (LocalService/NetworkService) in that case has full access to the process token.</span></span>

<span data-ttu-id="1ea22-111">O tipo de SID "irrestrito" significa que um SID de tarefa será derivado do caminho de tarefa completo e será adicionado à lista de grupos de tokens de processo.</span><span class="sxs-lookup"><span data-stu-id="1ea22-111">The "unrestricted" SID type means that a task SID will be derived from the full task path and will be added to the process token groups list.</span></span> <span data-ttu-id="1ea22-112">Por exemplo, o \\ RACTask do Microsoft \\ Windows \\ RAC \\ que é executado na conta de serviço local, o SID da tarefa é derivado do nome Microsoft-Windows-RAC-RACTask, em que um "-" é substituído por um " \\ ", já que " \\ " é um caractere de nome de usuário inválido.</span><span class="sxs-lookup"><span data-stu-id="1ea22-112">For example, the \\Microsoft\\Windows\\RAC\\RACTask which runs in the Local Service account, the task SID is derived from the name Microsoft-Windows-RAC-RACTask where a "-" is substituted for a "\\" since "\\" is an invalid user name character.</span></span> <span data-ttu-id="1ea22-113">O nome do grupo bem conhecido para o SID da tarefa seria "NT TASK \\ <modified full task path> " (o formato de nome de usuário DomainName \\ ).</span><span class="sxs-lookup"><span data-stu-id="1ea22-113">The well known group name for the task SID would be "NT TASK\\<modified full task path>" (domainname\\username format).</span></span> <span data-ttu-id="1ea22-114">A DACL (lista de controle de acesso discricionário) padrão do token de processo também será modificada para permitir o controle total somente para o SID da tarefa e o SID do sistema local e o controle de leitura para o SID da conta da entidade de tarefa.</span><span class="sxs-lookup"><span data-stu-id="1ea22-114">The process token default discretionary access control list (DACL) will also be modified to allow full control for the task SID and local system SID only and read control to the task principal account SID.</span></span> <span data-ttu-id="1ea22-115">"schtasks.exe/showsid/TN <full task path> " mostrará o SID da tarefa que corresponde à tarefa.</span><span class="sxs-lookup"><span data-stu-id="1ea22-115">"schtasks.exe /showsid /tn <full task path>" will show the task SID that is corresponding to the task.</span></span>

<span data-ttu-id="1ea22-116">Quando uma ação de tarefa não COM é iniciada, o mecanismo de agendamento faz o log na conta da entidade de segurança, obtém o token do processo e consulta a lista de privilégios que o token tem e, em seguida, compara isso com a lista de privilégios especificada em RequiredPrivileges.</span><span class="sxs-lookup"><span data-stu-id="1ea22-116">When a non-COM task action starts up, the scheduling engine logs on the task principal account, gets the process token and queries the list of privileges that the token has and then compares that with the privileges list specified in RequiredPrivileges.</span></span> <span data-ttu-id="1ea22-117">Se um privilégio não for especificado no último, isso será marcado como privilégio de SE \_ \_ removido.</span><span class="sxs-lookup"><span data-stu-id="1ea22-117">If a privilege is not specified in the latter, then that is marked as SE\_PRIVILEGE\_REMOVED.</span></span> <span data-ttu-id="1ea22-118">A ação executável será então iniciada com o identificador de token resultante usando a API CreateProcessAsUser.</span><span class="sxs-lookup"><span data-stu-id="1ea22-118">The executable action will then be started with the resulting token handle by using the CreateProcessAsUser API.</span></span>

<span data-ttu-id="1ea22-119">Quando uma ação de tarefa COM é iniciada, ela deve ser ativada pelo processo de taskhost.exe.</span><span class="sxs-lookup"><span data-stu-id="1ea22-119">When a COM task action starts up, it must be activated by the taskhost.exe process.</span></span> <span data-ttu-id="1ea22-120">O mecanismo de agendamento consulta o bloco de contexto de cada taskhost.exe em execução com a mesma conta que a tarefa inicial.</span><span class="sxs-lookup"><span data-stu-id="1ea22-120">The scheduling engine queries the context block of each running taskhost.exe with the same account as the starting task.</span></span> <span data-ttu-id="1ea22-121">Se ele descobrir que um processo de host foi iniciado com um superconjunto de privilégios necessário para a tarefa inicial, essa tarefa será hospedada nesse processo.</span><span class="sxs-lookup"><span data-stu-id="1ea22-121">If it finds that a host process was started with a superset of privileges that the starting task needs, then that task gets hosted in that process.</span></span> <span data-ttu-id="1ea22-122">Se ele não encontrar esse processo, ele combinará as informações de proteção de todas as tarefas em execução no TaskHosts na conta de entidade de segurança com a máscara RequiredPrivileges especificada e, em seguida, iniciará uma nova instância do taskhost.exe.</span><span class="sxs-lookup"><span data-stu-id="1ea22-122">If it does not find such a process, it combines the hardening info of all the tasks that are running in the taskhosts under the task principal account with the specified RequiredPrivileges mask and then starts up a new instance of taskhost.exe.</span></span>

<span data-ttu-id="1ea22-123">Se RequiredPrivileges não estiver presente na definição de tarefa, os privilégios padrão da conta de entidade de tarefa sem o SeImpersonatePrivilege serão usados para o processo de tarefa.</span><span class="sxs-lookup"><span data-stu-id="1ea22-123">If RequiredPrivileges is not present in the task definition, the default privileges of task principal account without the SeImpersonatePrivilege will be used for task process.</span></span> <span data-ttu-id="1ea22-124">Se **ProcessTokenSidType** não estiver presente na definição de tarefa, "irrestrito" será usado como o padrão.</span><span class="sxs-lookup"><span data-stu-id="1ea22-124">If **ProcessTokenSidType** is not present in the task definition, "unrestricted" is used as the default.</span></span>

## <a name="related-topics"></a><span data-ttu-id="1ea22-125">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="1ea22-125">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="1ea22-126">Informações de registro da tarefa</span><span class="sxs-lookup"><span data-stu-id="1ea22-126">Task Registration Information</span></span>](task-registration-information.md)
</dt> <dt>

[<span data-ttu-id="1ea22-127">Sobre o Agendador de Tarefas</span><span class="sxs-lookup"><span data-stu-id="1ea22-127">About The Task Scheduler</span></span>](about-the-task-scheduler.md)
</dt> <dt>

[<span data-ttu-id="1ea22-128">Contextos de segurança para tarefas</span><span class="sxs-lookup"><span data-stu-id="1ea22-128">Security Contexts for Tasks</span></span>](security-contexts-for-running-tasks.md)
</dt> </dl>

 

 




