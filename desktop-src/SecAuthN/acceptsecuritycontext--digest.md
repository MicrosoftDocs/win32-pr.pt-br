---
description: Habilita o componente de servidor de um aplicativo de transporte para estabelecer um contexto de segurança entre o servidor e um cliente remoto que está usando o Digest.
ms.assetid: 017683e3-b21a-4e97-9232-582ac7dbd5b2
title: Função AcceptSecurityContext (Digest) (SSPI. h)
ms.topic: article
ms.date: 07/25/2019
ms.openlocfilehash: 11ffa801612f14f5b9aaf61e7d48b61377bc9e56
ms.sourcegitcommit: de72a1294df274b0a71dc0fdc42d757e5f6df0f3
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/05/2021
ms.locfileid: "104011974"
---
# <a name="acceptsecuritycontext-digest-function"></a><span data-ttu-id="8c10e-103">Função AcceptSecurityContext (Digest)</span><span class="sxs-lookup"><span data-stu-id="8c10e-103">AcceptSecurityContext (Digest) function</span></span>

<span data-ttu-id="8c10e-104">A função **AcceptSecurityContext (Digest)** permite que o componente de servidor de um aplicativo de transporte estabeleça um [*contexto de segurança*](../secgloss/s-gly.md) entre o servidor e um cliente remoto.</span><span class="sxs-lookup"><span data-stu-id="8c10e-104">The **AcceptSecurityContext (Digest)** function enables the server component of a transport application to establish a [*security context*](../secgloss/s-gly.md) between the server and a remote client.</span></span> <span data-ttu-id="8c10e-105">O cliente remoto usa a função [**InitializeSecurityContext (Digest)**](initializesecuritycontext--digest.md) para iniciar o processo de estabelecimento de um contexto de segurança.</span><span class="sxs-lookup"><span data-stu-id="8c10e-105">The remote client uses the [**InitializeSecurityContext (Digest)**](initializesecuritycontext--digest.md) function to start the process of establishing a security context.</span></span> <span data-ttu-id="8c10e-106">O servidor pode exigir um ou mais tokens de resposta do cliente remoto para concluir o estabelecimento do contexto de segurança.</span><span class="sxs-lookup"><span data-stu-id="8c10e-106">The server can require one or more reply tokens from the remote client to complete establishing the security context.</span></span>

## <a name="syntax"></a><span data-ttu-id="8c10e-107">Sintaxe</span><span class="sxs-lookup"><span data-stu-id="8c10e-107">Syntax</span></span>


```C++
SECURITY_STATUS SEC_Entry AcceptSecurityContext(
  _In_opt_    PCredHandle    phCredential,
  _Inout_opt_ PCtxtHandle    phContext,
  _In_opt_    PSecBufferDesc pInput,
  _In_        ULONG          fContextReq,
  _In_        ULONG          TargetDataRep,
  _Inout_opt_ PCtxtHandle    phNewContext,
  _Inout_opt_ PSecBufferDesc pOutput,
  _Out_       PULONG         pfContextAttr,
  _Out_opt_   PTimeStamp     ptsExpiry
);
```



## <a name="parameters"></a><span data-ttu-id="8c10e-108">Parâmetros</span><span class="sxs-lookup"><span data-stu-id="8c10e-108">Parameters</span></span>

<dl> <dt>

<span data-ttu-id="8c10e-109">*phCredential* \[ em, opcional\]</span><span class="sxs-lookup"><span data-stu-id="8c10e-109">*phCredential* \[in, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="8c10e-110">Um identificador para as credenciais do servidor.</span><span class="sxs-lookup"><span data-stu-id="8c10e-110">A handle to the credentials of the server.</span></span> <span data-ttu-id="8c10e-111">O servidor chama a função [**falha AcquireCredentialsHandle (Digest)**](acquirecredentialshandle--digest.md) com o sinalizador de \_ entrada de credenciais SECPKG \_ ou SECPKG \_ cred \_ both definido para recuperar esse identificador.</span><span class="sxs-lookup"><span data-stu-id="8c10e-111">The server calls the [**AcquireCredentialsHandle (Digest)**](acquirecredentialshandle--digest.md) function with either the SECPKG\_CRED\_INBOUND or SECPKG\_CRED\_BOTH flag set to retrieve this handle.</span></span>

</dd> <dt>

<span data-ttu-id="8c10e-112">*phContext* \[ entrada, saída, opcional\]</span><span class="sxs-lookup"><span data-stu-id="8c10e-112">*phContext* \[in, out, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="8c10e-113">Um ponteiro para uma estrutura [CtxtHandle](sspi-handles.md) .</span><span class="sxs-lookup"><span data-stu-id="8c10e-113">A pointer to a [CtxtHandle](sspi-handles.md) structure.</span></span> <span data-ttu-id="8c10e-114">Na primeira chamada para **AcceptSecurityContext (Digest)**, esse ponteiro é **nulo**.</span><span class="sxs-lookup"><span data-stu-id="8c10e-114">On the first call to **AcceptSecurityContext (Digest)**, this pointer is **NULL**.</span></span> <span data-ttu-id="8c10e-115">Nas chamadas subsequentes, *phContext* é o identificador para o contexto parcialmente formado que foi retornado no parâmetro *phNewContext* pela primeira chamada.</span><span class="sxs-lookup"><span data-stu-id="8c10e-115">On subsequent calls, *phContext* is the handle to the partially formed context that was returned in the *phNewContext* parameter by the first call.</span></span>

</dd> <dt>

<span data-ttu-id="8c10e-116">*pInput* \[ em, opcional\]</span><span class="sxs-lookup"><span data-stu-id="8c10e-116">*pInput* \[in, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="8c10e-117">Um ponteiro para uma estrutura [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) gerada por uma chamada de cliente para [**InitializeSecurityContext (resumo)**](initializesecuritycontext--digest.md) que contém o descritor de buffer de entrada.</span><span class="sxs-lookup"><span data-stu-id="8c10e-117">A pointer to a [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) structure generated by a client call to [**InitializeSecurityContext (Digest)**](initializesecuritycontext--digest.md) that contains the input buffer descriptor.</span></span>

<span data-ttu-id="8c10e-118">A tabela a seguir mostra a configuração de buffer para HTTP Digest.</span><span class="sxs-lookup"><span data-stu-id="8c10e-118">The following table shows the buffer configuration for Digest HTTP.</span></span> <span data-ttu-id="8c10e-119">O primeiro buffer deve ser do tipo **\_ token SECBUFFER** e o REST deve ser do tipo **SECBUFFER \_ pacote \_ params**.</span><span class="sxs-lookup"><span data-stu-id="8c10e-119">The first buffer must be of type **SECBUFFER\_TOKEN**, and the rest must be of type **SECBUFFER\_PKG\_PARAMS**.</span></span> <span data-ttu-id="8c10e-120">SASL requer apenas o buffer zero.</span><span class="sxs-lookup"><span data-stu-id="8c10e-120">SASL requires only buffer zero.</span></span>



| <span data-ttu-id="8c10e-121">Tipo de/buffer de buffer \#</span><span class="sxs-lookup"><span data-stu-id="8c10e-121">Buffer \#/buffer type</span></span>                                                                                                                                                                                                 | <span data-ttu-id="8c10e-122">Significado</span><span class="sxs-lookup"><span data-stu-id="8c10e-122">Meaning</span></span>                                                                                                                                                                  |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span id="0"></span><dl> <span data-ttu-id="8c10e-123"><dt>**0**</dt> <dt> **\_ token SECBUFFER**</dt></span><span class="sxs-lookup"><span data-stu-id="8c10e-123"><dt>**0**</dt> <dt>**SECBUFFER\_TOKEN**</dt></span></span> </dl>                                        | <span data-ttu-id="8c10e-124">Vazio para a primeira chamada e a resposta de desafio recebida do cliente para a segunda chamada.</span><span class="sxs-lookup"><span data-stu-id="8c10e-124">Empty for the first call and the challenge response received from the client for the second call.</span></span><br/>                                                             |
| <span id="1"></span><dl> <span data-ttu-id="8c10e-125"><dt>**1**</dt> <dt> **\_ \_ parâmetros de pacote SECBUFFER**</dt></span><span class="sxs-lookup"><span data-stu-id="8c10e-125"><dt>**1**</dt> <dt>**SECBUFFER\_PKG\_PARAMS**</dt></span></span> </dl>                                  | <span data-ttu-id="8c10e-126">Forma.</span><span class="sxs-lookup"><span data-stu-id="8c10e-126">Method.</span></span> <span data-ttu-id="8c10e-127">Os caracteres são o formato de conexão da linha de solicitação.</span><span class="sxs-lookup"><span data-stu-id="8c10e-127">Characters are wireline format from the request line.</span></span> <span data-ttu-id="8c10e-128">Caracteres de byte único ASCII dos EUA.</span><span class="sxs-lookup"><span data-stu-id="8c10e-128">US ASCII single-byte characters.</span></span><br/>                                                                |
| <span id="2"></span><dl> <span data-ttu-id="8c10e-129"><dt>**2**</dt> <dt> **\_ \_ parâmetros de pacote SECBUFFER**</dt></span><span class="sxs-lookup"><span data-stu-id="8c10e-129"><dt>**2**</dt> <dt>**SECBUFFER\_PKG\_PARAMS**</dt></span></span> </dl>                                  | <span data-ttu-id="8c10e-130">Reservado.</span><span class="sxs-lookup"><span data-stu-id="8c10e-130">Reserved.</span></span><br/>                                                                                                                                                     |
| <span id="3"></span><dl> <span data-ttu-id="8c10e-131"><dt>**3**</dt> <dt> **\_ \_ parâmetros de pacote de SECBUFFER**</dt></span><span class="sxs-lookup"><span data-stu-id="8c10e-131"><dt>**3**</dt> <dt>**SECBUFFER\_PKG\_PARAMS**</dt></span></span> </dl>                                  | <span data-ttu-id="8c10e-132">HEntity.</span><span class="sxs-lookup"><span data-stu-id="8c10e-132">HEntity.</span></span> <span data-ttu-id="8c10e-133">Representação hexadecimal de H (corpo da entidade).</span><span class="sxs-lookup"><span data-stu-id="8c10e-133">Hexadecimal representation of H(entity-body).</span></span> <span data-ttu-id="8c10e-134">Caracteres de byte único ASCII dos EUA.</span><span class="sxs-lookup"><span data-stu-id="8c10e-134">US ASCII single-byte characters.</span></span><br/>                                                                       |
| <span id="4"></span><dl> <span data-ttu-id="8c10e-135"><dt>**4**</dt> <dt> **\_ \_ parâmetros de pacote SECBUFFER**</dt></span><span class="sxs-lookup"><span data-stu-id="8c10e-135"><dt>**4**</dt> <dt>**SECBUFFER\_PKG\_PARAMS**</dt></span></span> </dl>                                  | <span data-ttu-id="8c10e-136">Territórios.</span><span class="sxs-lookup"><span data-stu-id="8c10e-136">Realm.</span></span> <span data-ttu-id="8c10e-137">Cadeia de caracteres de realm para o desafio.</span><span class="sxs-lookup"><span data-stu-id="8c10e-137">Realm string for the challenge.</span></span> <span data-ttu-id="8c10e-138">Cadeia de caracteres Unicode que deve ser representável no ASCII dos EUA.</span><span class="sxs-lookup"><span data-stu-id="8c10e-138">Unicode string that must be representable in US ASCII.</span></span><br/>                                                                 |
| <span id="5"></span><dl> <span data-ttu-id="8c10e-139"><dt>**5**</dt> <dt> **\_ \_ associações de canal SECBUFFER** \| **SECBUFFER \_ ReadOnly**</dt></span><span class="sxs-lookup"><span data-stu-id="8c10e-139"><dt>**5**</dt> <dt>**SECBUFFER\_CHANNEL\_BINDINGS** \| **SECBUFFER\_READONLY**</dt></span></span> </dl> | <span data-ttu-id="8c10e-140">Contém o valor do token de associação de canal.</span><span class="sxs-lookup"><span data-stu-id="8c10e-140">Contains the channel binding token value.</span></span><br/> <span data-ttu-id="8c10e-141">**Windows server 2008, Windows Vista, Windows server 2003 e Windows XP:** Não há suporte para esse valor.</span><span class="sxs-lookup"><span data-stu-id="8c10e-141">**Windows Server 2008, Windows Vista, Windows Server 2003 and Windows XP:** This value is not supported.</span></span><br/> |



 

</dd> <dt>

<span data-ttu-id="8c10e-142">*fContextReq* \[ no\]</span><span class="sxs-lookup"><span data-stu-id="8c10e-142">*fContextReq* \[in\]</span></span>
</dt> <dd>

<span data-ttu-id="8c10e-143">Sinalizadores de bits que especificam os atributos exigidos pelo servidor para estabelecer o contexto.</span><span class="sxs-lookup"><span data-stu-id="8c10e-143">Bit flags that specify the attributes required by the server to establish the context.</span></span> <span data-ttu-id="8c10e-144">Os sinalizadores de bits podem ser combinados usando operações de bit-a-**ou** .</span><span class="sxs-lookup"><span data-stu-id="8c10e-144">Bit flags can be combined by using bitwise-**OR** operations.</span></span> <span data-ttu-id="8c10e-145">Esse parâmetro pode ser um ou mais dos valores a seguir.</span><span class="sxs-lookup"><span data-stu-id="8c10e-145">This parameter can be one or more of the following values.</span></span>



| <span data-ttu-id="8c10e-146">Valor</span><span class="sxs-lookup"><span data-stu-id="8c10e-146">Value</span></span>                                                                                                                                                                                                                                          | <span data-ttu-id="8c10e-147">Significado</span><span class="sxs-lookup"><span data-stu-id="8c10e-147">Meaning</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                     |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span id="ASC_REQ_ALLOCATE_MEMORY"></span><span id="asc_req_allocate_memory"></span><dl> <span data-ttu-id="8c10e-148"><dt>**memória de alocação do ASC \_ req \_ \_**</dt></span><span class="sxs-lookup"><span data-stu-id="8c10e-148"><dt>**ASC\_REQ\_ALLOCATE\_MEMORY**</dt></span></span> </dl>                                                  | <span data-ttu-id="8c10e-149">O Digest aloca buffers de saída para você.</span><span class="sxs-lookup"><span data-stu-id="8c10e-149">Digest allocates output buffers for you.</span></span> <span data-ttu-id="8c10e-150">Quando você terminar de usar os buffers de saída, libere-os chamando a função [**FreeContextBuffer**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) .</span><span class="sxs-lookup"><span data-stu-id="8c10e-150">When you have finished using the output buffers, free them by calling the [**FreeContextBuffer**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) function.</span></span><br/>                                                                                                                                                                                                                                      |
| <span id="ASC_REQ_ALLOW_MISSING_BINDINGS"></span><span id="asc_req_allow_missing_bindings"></span><dl> <span data-ttu-id="8c10e-151"><dt>**o \_ ASC \_ req \_ permite \_ associações ausentes**</dt></span><span class="sxs-lookup"><span data-stu-id="8c10e-151"><dt>**ASC\_REQ\_ALLOW\_MISSING\_BINDINGS**</dt></span></span> </dl>                            | <span data-ttu-id="8c10e-152">Indica que o resumo não requer associações de canal para canais internos e externos.</span><span class="sxs-lookup"><span data-stu-id="8c10e-152">Indicates that Digest does not require channel bindings for both inner and outer channels.</span></span> <span data-ttu-id="8c10e-153">Esse valor é usado para compatibilidade com versões anteriores quando o suporte para associação de canal de ponto de extremidade não é conhecido.</span><span class="sxs-lookup"><span data-stu-id="8c10e-153">This value is used for backward compatibility when support for endpoint channel binding is not known.</span></span><br/> <span data-ttu-id="8c10e-154">Esse valor é mutuamente exclusivo com as **\_ associações de \_ proxy \_ do ASC req**.</span><span class="sxs-lookup"><span data-stu-id="8c10e-154">This value is mutually exclusive with **ASC\_REQ\_PROXY\_BINDINGS**.</span></span><br/> <span data-ttu-id="8c10e-155">**Windows server 2008, Windows Vista, Windows server 2003 e Windows XP:** Não há suporte para esse valor.</span><span class="sxs-lookup"><span data-stu-id="8c10e-155">**Windows Server 2008, Windows Vista, Windows Server 2003 and Windows XP:** This value is not supported.</span></span><br/> <br/> |
| <span id="ASC_REQ_CONFIDENTIALITY"></span><span id="asc_req_confidentiality"></span><dl> <span data-ttu-id="8c10e-156"><dt>**\_confidencialidade de req. asc \_**</dt></span><span class="sxs-lookup"><span data-stu-id="8c10e-156"><dt>**ASC\_REQ\_CONFIDENTIALITY**</dt></span></span> </dl>                                                   | <span data-ttu-id="8c10e-157">Criptografar e descriptografar mensagens.</span><span class="sxs-lookup"><span data-stu-id="8c10e-157">Encrypt and decrypt messages.</span></span> <br/> <span data-ttu-id="8c10e-158">O SSP de resumo dá suporte a este sinalizador somente para SASL.</span><span class="sxs-lookup"><span data-stu-id="8c10e-158">The Digest SSP supports this flag for SASL only.</span></span><br/>                                                                                                                                                                                                                                                                                                                       |
| <span id="ASC_REQ_PROXY_BINDINGS"></span><span id="asc_req_proxy_bindings"></span><dl> <span data-ttu-id="8c10e-159"><dt>**\_associações de \_ proxy de req. asc \_**</dt></span><span class="sxs-lookup"><span data-stu-id="8c10e-159"><dt>**ASC\_REQ\_PROXY\_BINDINGS**</dt></span></span> </dl>                                                     | <span data-ttu-id="8c10e-160">Indica que o resumo requer Associação de canal.</span><span class="sxs-lookup"><span data-stu-id="8c10e-160">Indicates that Digest requires channel binding.</span></span><br/> <span data-ttu-id="8c10e-161">Esse valor é mutuamente exclusivo com o **ASC \_ req \_ permitir \_ \_ associações ausentes**.</span><span class="sxs-lookup"><span data-stu-id="8c10e-161">This value is mutually exclusive with **ASC\_REQ\_ALLOW\_MISSING\_BINDINGS**.</span></span><br/> <span data-ttu-id="8c10e-162">**Windows server 2008, Windows Vista, Windows server 2003 e Windows XP:** Não há suporte para esse valor.</span><span class="sxs-lookup"><span data-stu-id="8c10e-162">**Windows Server 2008, Windows Vista, Windows Server 2003 and Windows XP:** This value is not supported.</span></span><br/> <br/>                                                                                                                                         |
| <span id="ASC_REQ_CONNECTION"></span><span id="asc_req_connection"></span><dl> <span data-ttu-id="8c10e-163"><dt>**\_conexão de req. asc \_**</dt></span><span class="sxs-lookup"><span data-stu-id="8c10e-163"><dt>**ASC\_REQ\_CONNECTION**</dt></span></span> </dl>                                                                  | <span data-ttu-id="8c10e-164">O [*contexto de segurança*](../secgloss/s-gly.md) não tratará mensagens de formatação.</span><span class="sxs-lookup"><span data-stu-id="8c10e-164">The [*security context*](../secgloss/s-gly.md) will not handle formatting messages.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                        |
| <span id="ASC_REQ_EXTENDED_ERROR"></span><span id="asc_req_extended_error"></span><dl> <span data-ttu-id="8c10e-165"><dt>**\_ \_ erro estendido de req. asc \_**</dt></span><span class="sxs-lookup"><span data-stu-id="8c10e-165"><dt>**ASC\_REQ\_EXTENDED\_ERROR**</dt></span></span> </dl>                                                     | <span data-ttu-id="8c10e-166">Quando ocorrerem erros, a parte remota será notificada.</span><span class="sxs-lookup"><span data-stu-id="8c10e-166">When errors occur, the remote party will be notified.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                            |
| <span id="ASC_REQ_HTTP__0x10000000_"></span><span id="asc_req_http__0x10000000_"></span><span id="ASC_REQ_HTTP__0X10000000_"></span><dl> <span data-ttu-id="8c10e-167"><dt>**\_ \_ 0X10000000 (ASC req http)**</dt></span><span class="sxs-lookup"><span data-stu-id="8c10e-167"><dt>**ASC\_REQ\_HTTP (0x10000000)**</dt></span></span> </dl> | <span data-ttu-id="8c10e-168">Use Digest para HTTP.</span><span class="sxs-lookup"><span data-stu-id="8c10e-168">Use Digest for HTTP.</span></span> <span data-ttu-id="8c10e-169">Omita esse sinalizador para usar Digest como um mecanismo SASL.</span><span class="sxs-lookup"><span data-stu-id="8c10e-169">Omit this flag to use Digest as an SASL mechanism.</span></span><br/>                                                                                                                                                                                                                                                                                                                                          |
| <span id="ASC_REQ_INTEGRITY"></span><span id="asc_req_integrity"></span><dl> <span data-ttu-id="8c10e-170"><dt>**\_integridade de req ASC \_**</dt></span><span class="sxs-lookup"><span data-stu-id="8c10e-170"><dt>**ASC\_REQ\_INTEGRITY**</dt></span></span> </dl>                                                                     | <span data-ttu-id="8c10e-171">Assinar mensagens e verificar assinaturas.</span><span class="sxs-lookup"><span data-stu-id="8c10e-171">Sign messages and verify signatures.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                             |
| <span id="ASC_REQ_REPLAY_DETECT"></span><span id="asc_req_replay_detect"></span><dl> <span data-ttu-id="8c10e-172"><dt>**\_detecção de \_ Replay de req do ASC \_**</dt></span><span class="sxs-lookup"><span data-stu-id="8c10e-172"><dt>**ASC\_REQ\_REPLAY\_DETECT**</dt></span></span> </dl>                                                        | <span data-ttu-id="8c10e-173">Detectar pacotes reproduzidos.</span><span class="sxs-lookup"><span data-stu-id="8c10e-173">Detect replayed packets.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                         |
| <span id="ASC_REQ_SEQUENCE_DETECT"></span><span id="asc_req_sequence_detect"></span><dl> <span data-ttu-id="8c10e-174"><dt>**\_detecção de \_ sequência de req do ASC \_**</dt></span><span class="sxs-lookup"><span data-stu-id="8c10e-174"><dt>**ASC\_REQ\_SEQUENCE\_DETECT**</dt></span></span> </dl>                                                  | <span data-ttu-id="8c10e-175">Detecte mensagens recebidas fora de sequência.</span><span class="sxs-lookup"><span data-stu-id="8c10e-175">Detect messages received out of sequence.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                        |



 

<span data-ttu-id="8c10e-176">Para possíveis sinalizadores de atributo e seus significados, consulte [requisitos de contexto](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="8c10e-176">For possible attribute flags and their meanings, see [Context Requirements](context-requirements.md).</span></span> <span data-ttu-id="8c10e-177">Os sinalizadores usados para esse parâmetro são prefixados com o ASC \_ req, por exemplo, o \_ delegado de req ASC \_ .</span><span class="sxs-lookup"><span data-stu-id="8c10e-177">Flags used for this parameter are prefixed with ASC\_REQ, for example, ASC\_REQ\_DELEGATE.</span></span>

<span data-ttu-id="8c10e-178">Os atributos solicitados podem não ter suporte do cliente.</span><span class="sxs-lookup"><span data-stu-id="8c10e-178">The requested attributes may not be supported by the client.</span></span> <span data-ttu-id="8c10e-179">Para obter mais informações, consulte o parâmetro *pfContextAttr* .</span><span class="sxs-lookup"><span data-stu-id="8c10e-179">For more information, see the *pfContextAttr* parameter.</span></span>

</dd> <dt>

<span data-ttu-id="8c10e-180">*TargetDataRep* \[ no\]</span><span class="sxs-lookup"><span data-stu-id="8c10e-180">*TargetDataRep* \[in\]</span></span>
</dt> <dd>

<span data-ttu-id="8c10e-181">A representação de dados, como ordenação de bytes, no destino.</span><span class="sxs-lookup"><span data-stu-id="8c10e-181">The data representation, such as byte ordering, on the target.</span></span> <span data-ttu-id="8c10e-182">Esse parâmetro pode ser segurança \_ nativa \_ DREP ou segurança de \_ rede \_ DREP.</span><span class="sxs-lookup"><span data-stu-id="8c10e-182">This parameter can be either SECURITY\_NATIVE\_DREP or SECURITY\_NETWORK\_DREP.</span></span>

<span data-ttu-id="8c10e-183">Esse parâmetro não é usado com o SSP de resumo.</span><span class="sxs-lookup"><span data-stu-id="8c10e-183">This parameter is not used with Digest SSP.</span></span> <span data-ttu-id="8c10e-184">Ao usar o SSP de resumo, especifique zero para esse parâmetro.</span><span class="sxs-lookup"><span data-stu-id="8c10e-184">When you use Digest SSP, specify zero for this parameter.</span></span>

</dd> <dt>

<span data-ttu-id="8c10e-185">*phNewContext* \[ entrada, saída, opcional\]</span><span class="sxs-lookup"><span data-stu-id="8c10e-185">*phNewContext* \[in, out, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="8c10e-186">Um ponteiro para uma estrutura [CtxtHandle](sspi-handles.md) .</span><span class="sxs-lookup"><span data-stu-id="8c10e-186">A pointer to a [CtxtHandle](sspi-handles.md) structure.</span></span> <span data-ttu-id="8c10e-187">Na primeira chamada para **AcceptSecurityContext (Digest)**, esse ponteiro recebe o novo identificador de contexto.</span><span class="sxs-lookup"><span data-stu-id="8c10e-187">On the first call to **AcceptSecurityContext (Digest)**, this pointer receives the new context handle.</span></span> <span data-ttu-id="8c10e-188">Nas chamadas subsequentes, *phNewContext* pode ser o mesmo que o identificador especificado no parâmetro *phContext* .</span><span class="sxs-lookup"><span data-stu-id="8c10e-188">On subsequent calls, *phNewContext* can be the same as the handle specified in the *phContext* parameter.</span></span>

</dd> <dt>

<span data-ttu-id="8c10e-189">*pOutput* \[ entrada, saída, opcional\]</span><span class="sxs-lookup"><span data-stu-id="8c10e-189">*pOutput* \[in, out, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="8c10e-190">Um ponteiro para uma estrutura [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) que contém o descritor de buffer de saída.</span><span class="sxs-lookup"><span data-stu-id="8c10e-190">A pointer to a [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) structure that contains the output buffer descriptor.</span></span> <span data-ttu-id="8c10e-191">Esse buffer é enviado ao cliente para entrada em chamadas adicionais para [**InitializeSecurityContext (Digest)**](initializesecuritycontext--digest.md).</span><span class="sxs-lookup"><span data-stu-id="8c10e-191">This buffer is sent to the client for input into additional calls to [**InitializeSecurityContext (Digest)**](initializesecuritycontext--digest.md).</span></span> <span data-ttu-id="8c10e-192">Um buffer de saída pode ser gerado mesmo que a função retorne s \_ E \_ OK.</span><span class="sxs-lookup"><span data-stu-id="8c10e-192">An output buffer may be generated even if the function returns SEC\_E\_OK.</span></span> <span data-ttu-id="8c10e-193">Qualquer buffer gerado deve ser enviado de volta para o aplicativo cliente.</span><span class="sxs-lookup"><span data-stu-id="8c10e-193">Any buffer generated must be sent back to the client application.</span></span>

</dd> <dt>

<span data-ttu-id="8c10e-194">*pfContextAttr* \[ fora\]</span><span class="sxs-lookup"><span data-stu-id="8c10e-194">*pfContextAttr* \[out\]</span></span>
</dt> <dd>

<span data-ttu-id="8c10e-195">Um ponteiro para uma variável que recebe um conjunto de sinalizadores de bits que indicam os atributos do contexto estabelecido.</span><span class="sxs-lookup"><span data-stu-id="8c10e-195">A pointer to a variable that receives a set of bit flags that indicate the attributes of the established context.</span></span> <span data-ttu-id="8c10e-196">Para obter uma descrição dos vários atributos, consulte [requisitos de contexto](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="8c10e-196">For a description of the various attributes, see [Context Requirements](context-requirements.md).</span></span> <span data-ttu-id="8c10e-197">Os sinalizadores usados para esse parâmetro são prefixados com ASC \_ RET, por exemplo, o delegado de ASC \_ RET \_ .</span><span class="sxs-lookup"><span data-stu-id="8c10e-197">Flags used for this parameter are prefixed with ASC\_RET, for example, ASC\_RET\_DELEGATE.</span></span>

<span data-ttu-id="8c10e-198">Não verifique os atributos relacionados à segurança até que a chamada de função final seja retornada com êxito.</span><span class="sxs-lookup"><span data-stu-id="8c10e-198">Do not check for security-related attributes until the final function call returns successfully.</span></span> <span data-ttu-id="8c10e-199">Os sinalizadores de atributo não relacionados à segurança, como o \_ \_ sinalizador de memória alocada de ASC RET \_ , podem ser verificados antes do retorno final.</span><span class="sxs-lookup"><span data-stu-id="8c10e-199">Attribute flags not related to security, such as the ASC\_RET\_ALLOCATED\_MEMORY flag, can be checked before the final return.</span></span>

</dd> <dt>

<span data-ttu-id="8c10e-200">*ptsTimeStamp* \[ out, opcional\]</span><span class="sxs-lookup"><span data-stu-id="8c10e-200">*ptsTimeStamp* \[out, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="8c10e-201">Um ponteiro para uma estrutura de [**carimbo de data/**](timestamp.md) hora que recebe o tempo de expiração do contexto.</span><span class="sxs-lookup"><span data-stu-id="8c10e-201">A pointer to a [**TimeStamp**](timestamp.md) structure that receives the expiration time of the context.</span></span> <span data-ttu-id="8c10e-202">É recomendável que o [*pacote de segurança*](../secgloss/s-gly.md) sempre retorne esse valor na hora local.</span><span class="sxs-lookup"><span data-stu-id="8c10e-202">We recommend that the [*security package*](../secgloss/s-gly.md) always return this value in local time.</span></span>

<span data-ttu-id="8c10e-203">Esse parâmetro é definido como um tempo máximo de constante.</span><span class="sxs-lookup"><span data-stu-id="8c10e-203">This parameter is set to a constant maximum time.</span></span> <span data-ttu-id="8c10e-204">Não há tempo de expiração para as credenciais ou s de [*contexto de segurança*](../secgloss/s-gly.md)Digest ou ao usar o SSP de resumo.</span><span class="sxs-lookup"><span data-stu-id="8c10e-204">There is no expiration time for Digest [*security context*](../secgloss/s-gly.md)s or credentials or when using the Digest SSP.</span></span>

> [!Note]  
> <span data-ttu-id="8c10e-205">Até a última chamada do processo de autenticação, o tempo de expiração do contexto pode estar incorreto, pois mais informações serão fornecidas durante os estágios posteriores da negociação.</span><span class="sxs-lookup"><span data-stu-id="8c10e-205">Until the last call of the authentication process, the expiration time for the context can be incorrect because more information will be provided during later stages of the negotiation.</span></span> <span data-ttu-id="8c10e-206">Portanto, *ptsTimeStamp* deve ser **nulo** até a última chamada para a função.</span><span class="sxs-lookup"><span data-stu-id="8c10e-206">Therefore, *ptsTimeStamp* must be **NULL** until the last call to the function.</span></span>

 

</dd> </dl>

## <a name="return-value"></a><span data-ttu-id="8c10e-207">Retornar valor</span><span class="sxs-lookup"><span data-stu-id="8c10e-207">Return value</span></span>

<span data-ttu-id="8c10e-208">Essa função retorna um dos valores a seguir.</span><span class="sxs-lookup"><span data-stu-id="8c10e-208">This function returns one of the following values.</span></span>



<table><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><thead><tr class="header"><th><span data-ttu-id="8c10e-209">Código/valor de retorno</span><span class="sxs-lookup"><span data-stu-id="8c10e-209">Return code/value</span></span></th><th><span data-ttu-id="8c10e-210">Descrição</span><span class="sxs-lookup"><span data-stu-id="8c10e-210">Description</span></span></th></tr></thead><tbody><tr class="odd"><td><dl> <span data-ttu-id="8c10e-211"><dt><strong>SEC_E_INSUFFICIENT_MEMORY</strong></dt> <dt>0x80090300L</dt> </span><span class="sxs-lookup"><span data-stu-id="8c10e-211"><dt><strong>SEC_E_INSUFFICIENT_MEMORY</strong></dt> <dt>0x80090300L</dt> </span></span></dl></td><td><span data-ttu-id="8c10e-212">A função falhou.</span><span class="sxs-lookup"><span data-stu-id="8c10e-212">The function failed.</span></span> <span data-ttu-id="8c10e-213">Não há memória suficiente disponível para concluir a ação solicitada.</span><span class="sxs-lookup"><span data-stu-id="8c10e-213">There is not enough memory available to complete the requested action.</span></span><br/></td></tr><tr class="even"><td><dl> <span data-ttu-id="8c10e-214"><dt><strong>SEC_E_INTERNAL_ERROR</strong></dt> <dt>0x80090304L</dt> </span><span class="sxs-lookup"><span data-stu-id="8c10e-214"><dt><strong>SEC_E_INTERNAL_ERROR</strong></dt> <dt>0x80090304L</dt> </span></span></dl></td><td><span data-ttu-id="8c10e-215">A função falhou.</span><span class="sxs-lookup"><span data-stu-id="8c10e-215">The function failed.</span></span> <span data-ttu-id="8c10e-216">Ocorreu um erro que não foi mapeado para um código de erro SSPI.</span><span class="sxs-lookup"><span data-stu-id="8c10e-216">An error occurred that did not map to an SSPI error code.</span></span><br/></td></tr><tr class="odd"><td><dl> <span data-ttu-id="8c10e-217"><dt><strong>SEC_E_INVALID_HANDLE</strong></dt> <dt>0x80100003L</dt> </span><span class="sxs-lookup"><span data-stu-id="8c10e-217"><dt><strong>SEC_E_INVALID_HANDLE</strong></dt> <dt>0x80100003L</dt> </span></span></dl></td><td><span data-ttu-id="8c10e-218">A função falhou.</span><span class="sxs-lookup"><span data-stu-id="8c10e-218">The function failed.</span></span> <span data-ttu-id="8c10e-219">O identificador passado para a função não é válido.</span><span class="sxs-lookup"><span data-stu-id="8c10e-219">The handle passed to the function is not valid.</span></span><br/></td></tr><tr class="even"><td><dl> <span data-ttu-id="8c10e-220"><dt><strong>SEC_E_INVALID_TOKEN</strong></dt> <dt>0x80090308L</dt> </span><span class="sxs-lookup"><span data-stu-id="8c10e-220"><dt><strong>SEC_E_INVALID_TOKEN</strong></dt> <dt>0x80090308L</dt> </span></span></dl></td><td><span data-ttu-id="8c10e-221">A função falhou.</span><span class="sxs-lookup"><span data-stu-id="8c10e-221">The function failed.</span></span> <span data-ttu-id="8c10e-222">O token passado para a função não é válido.</span><span class="sxs-lookup"><span data-stu-id="8c10e-222">The token passed to the function is not valid.</span></span><br/></td></tr><tr class="odd"><td><dl> <span data-ttu-id="8c10e-223"><dt><strong>SEC_E_LOGON_DENIED</strong></dt> <dt>0x8009030CL</dt> </span><span class="sxs-lookup"><span data-stu-id="8c10e-223"><dt><strong>SEC_E_LOGON_DENIED</strong></dt> <dt>0x8009030CL</dt> </span></span></dl></td><td><span data-ttu-id="8c10e-224">Falha no logon.</span><span class="sxs-lookup"><span data-stu-id="8c10e-224">The logon failed.</span></span><br/></td></tr><tr class="even"><td><dl> <span data-ttu-id="8c10e-225"><dt><strong>SEC_E_NO_AUTHENTICATING_AUTHORITY</strong></dt> <dt>0x80090311L</dt> </span><span class="sxs-lookup"><span data-stu-id="8c10e-225"><dt><strong>SEC_E_NO_AUTHENTICATING_AUTHORITY</strong></dt> <dt>0x80090311L</dt> </span></span></dl></td><td><span data-ttu-id="8c10e-226">A função falhou.</span><span class="sxs-lookup"><span data-stu-id="8c10e-226">The function failed.</span></span> <span data-ttu-id="8c10e-227">Nenhuma autoridade pode ser contatada para autenticação.</span><span class="sxs-lookup"><span data-stu-id="8c10e-227">No authority could be contacted for authentication.</span></span> <span data-ttu-id="8c10e-228">Isso pode ser devido às seguintes condições:</span><span class="sxs-lookup"><span data-stu-id="8c10e-228">This could be due to the following conditions:</span></span><br/><ul><li><span data-ttu-id="8c10e-229">O nome de domínio da parte de autenticação está incorreto.</span><span class="sxs-lookup"><span data-stu-id="8c10e-229">The domain name of the authenticating party is incorrect.</span></span></li><li><span data-ttu-id="8c10e-230">O domínio não está disponível.</span><span class="sxs-lookup"><span data-stu-id="8c10e-230">The domain is unavailable.</span></span></li><li><span data-ttu-id="8c10e-231">Falha na relação de confiança.</span><span class="sxs-lookup"><span data-stu-id="8c10e-231">The trust relationship has failed.</span></span></li></ul></td></tr><tr class="odd"><td><dl> <span data-ttu-id="8c10e-232"><dt><strong>SEC_E_NO_CREDENTIALS</strong></dt> <dt>0x8009030EL</dt> </span><span class="sxs-lookup"><span data-stu-id="8c10e-232"><dt><strong>SEC_E_NO_CREDENTIALS</strong></dt> <dt>0x8009030EL</dt> </span></span></dl></td><td><span data-ttu-id="8c10e-233">A função falhou.</span><span class="sxs-lookup"><span data-stu-id="8c10e-233">The function failed.</span></span> <span data-ttu-id="8c10e-234">O identificador de credenciais especificado no parâmetro <em>phCredential</em> não é válido.</span><span class="sxs-lookup"><span data-stu-id="8c10e-234">The credentials handle specified in the <em>phCredential</em> parameter is not valid.</span></span><br/></td></tr><tr class="even"><td><dl> <span data-ttu-id="8c10e-235"><dt><strong>SEC_E_OK</strong></dt> <dt>0x00000000l</dt> </span><span class="sxs-lookup"><span data-stu-id="8c10e-235"><dt><strong>SEC_E_OK</strong></dt> <dt>0x00000000L</dt> </span></span></dl></td><td><span data-ttu-id="8c10e-236">A função foi bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="8c10e-236">The function succeeded.</span></span> <span data-ttu-id="8c10e-237">O [*contexto de segurança*](../secgloss/s-gly.md) recebido do cliente foi aceito.</span><span class="sxs-lookup"><span data-stu-id="8c10e-237">The [*security context*](../secgloss/s-gly.md) received from the client was accepted.</span></span> <span data-ttu-id="8c10e-238">Se um token de saída foi gerado pela função, ele deve ser enviado para o processo do cliente.</span><span class="sxs-lookup"><span data-stu-id="8c10e-238">If an output token was generated by the function, it must be sent to the client process.</span></span><br/></td></tr><tr class="odd"><td><dl> <span data-ttu-id="8c10e-239"><dt><strong>SEC_E_SECURITY_QOS_FAILED</strong></dt> <dt>0x80090332L</dt> </span><span class="sxs-lookup"><span data-stu-id="8c10e-239"><dt><strong>SEC_E_SECURITY_QOS_FAILED</strong></dt> <dt>0x80090332L</dt> </span></span></dl></td><td><span data-ttu-id="8c10e-240">A função falhou.</span><span class="sxs-lookup"><span data-stu-id="8c10e-240">The function failed.</span></span> <span data-ttu-id="8c10e-241">Um sinalizador de atributo de contexto inválido foi especificado no parâmetro <em>fContextReq</em> .</span><span class="sxs-lookup"><span data-stu-id="8c10e-241">A context attribute flag that is not valid was specified in the <em>fContextReq</em> parameter.</span></span><br/></td></tr><tr class="even"><td><dl> <span data-ttu-id="8c10e-242"><dt><strong>SEC_I_COMPLETE_AND_CONTINUE</strong></dt> <dt>0x00090314L</dt> </span><span class="sxs-lookup"><span data-stu-id="8c10e-242"><dt><strong>SEC_I_COMPLETE_AND_CONTINUE</strong></dt> <dt>0x00090314L</dt> </span></span></dl></td><td><span data-ttu-id="8c10e-243">A função foi bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="8c10e-243">The function succeeded.</span></span> <span data-ttu-id="8c10e-244">O servidor deve chamar [<strong>CompleteAuthToken</strong>] (/Windows/Win32/API/SSPI/NF-SSPI-CompleteAuthToken) e passar o token de saída para o cliente.</span><span class="sxs-lookup"><span data-stu-id="8c10e-244">The server must call [<strong>CompleteAuthToken</strong>](/windows/win32/api/sspi/nf-sspi-completeauthtoken) and pass the output token to the client.</span></span> <span data-ttu-id="8c10e-245">Em seguida, o servidor aguarda um token de retorno do cliente e, em seguida, faz outra chamada para [<strong>AcceptSecurityContext (Digest)</strong>] (AcceptSecurityContext--Digest.MD).</span><span class="sxs-lookup"><span data-stu-id="8c10e-245">The server then waits for a return token from the client and then makes another call to [<strong>AcceptSecurityContext (Digest)</strong>](acceptsecuritycontext--digest.md).</span></span><br/></td></tr><tr class="odd"><td><dl> <span data-ttu-id="8c10e-246"><dt><strong>SEC_I_COMPLETE_NEEDED</strong></dt> <dt>0x00090313L</dt> </span><span class="sxs-lookup"><span data-stu-id="8c10e-246"><dt><strong>SEC_I_COMPLETE_NEEDED</strong></dt> <dt>0x00090313L</dt> </span></span></dl></td><td><span data-ttu-id="8c10e-247">A função foi bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="8c10e-247">The function succeeded.</span></span> <span data-ttu-id="8c10e-248">O servidor deve concluir a compilação da mensagem do cliente e, em seguida, chamar a função [<strong>CompleteAuthToken</strong>] (/Windows/Win32/API/SSPI/NF-SSPI-CompleteAuthToken).</span><span class="sxs-lookup"><span data-stu-id="8c10e-248">The server must finish building the message from the client and then call the [<strong>CompleteAuthToken</strong>](/windows/win32/api/sspi/nf-sspi-completeauthtoken) function.</span></span><br/></td></tr><tr class="even"><td><dl> <span data-ttu-id="8c10e-249"><dt><strong>SEC_I_CONTINUE_NEEDED</strong></dt> <dt>0x00090312L</dt> </span><span class="sxs-lookup"><span data-stu-id="8c10e-249"><dt><strong>SEC_I_CONTINUE_NEEDED</strong></dt> <dt>0x00090312L</dt> </span></span></dl></td><td><span data-ttu-id="8c10e-250">A função foi bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="8c10e-250">The function succeeded.</span></span> <span data-ttu-id="8c10e-251">O servidor deve enviar o token de saída para o cliente e aguardar um token retornado.</span><span class="sxs-lookup"><span data-stu-id="8c10e-251">The server must send the output token to the client and wait for a returned token.</span></span> <span data-ttu-id="8c10e-252">O token retornado deve ser passado em <em>pInput</em> para outra chamada para [<strong>AcceptSecurityContext (Digest)</strong>] (AcceptSecurityContext--Digest.MD).</span><span class="sxs-lookup"><span data-stu-id="8c10e-252">The returned token should be passed in <em>pInput</em> for another call to [<strong>AcceptSecurityContext (Digest)</strong>](acceptsecuritycontext--digest.md).</span></span><br/></td></tr><tr class="odd"><td><dl> <span data-ttu-id="8c10e-253"><dt><strong>STATUS_LOGON_FAILURE</strong></dt> <dt>0xC000006DL</dt> </span><span class="sxs-lookup"><span data-stu-id="8c10e-253"><dt><strong>STATUS_LOGON_FAILURE</strong></dt> <dt>0xC000006DL</dt> </span></span></dl></td><td><span data-ttu-id="8c10e-254">A função falhou.</span><span class="sxs-lookup"><span data-stu-id="8c10e-254">The function failed.</span></span> <span data-ttu-id="8c10e-255">A função [<strong>AcceptSecurityContext (Digest)</strong>] (AcceptSecurityContext--Digest.MD) foi chamada depois que o contexto especificado foi estabelecido.</span><span class="sxs-lookup"><span data-stu-id="8c10e-255">The [<strong>AcceptSecurityContext (Digest)</strong>](acceptsecuritycontext--digest.md) function was called after the specified context was established.</span></span><br/></td></tr><tr class="even"><td><dl> <span data-ttu-id="8c10e-256"><dt><strong>SEC_E_BAD_BINDINGS</strong></dt> <dt>0x80090346L</dt> </span><span class="sxs-lookup"><span data-stu-id="8c10e-256"><dt><strong>SEC_E_BAD_BINDINGS</strong></dt> <dt>0x80090346L</dt> </span></span></dl></td><td><span data-ttu-id="8c10e-257">A função falhou.</span><span class="sxs-lookup"><span data-stu-id="8c10e-257">The function failed.</span></span> <span data-ttu-id="8c10e-258">A política de associação de canal não foi satisfeita.</span><span class="sxs-lookup"><span data-stu-id="8c10e-258">Channel binding policy was not satisfied.</span></span><br/></td></tr></tbody></table>



 

## <a name="remarks"></a><span data-ttu-id="8c10e-259">Comentários</span><span class="sxs-lookup"><span data-stu-id="8c10e-259">Remarks</span></span>

<span data-ttu-id="8c10e-260">A função **AcceptSecurityContext (Digest)** é a contraparte do servidor para a função [**InitializeSecurityContext (Digest)**](initializesecuritycontext--digest.md) .</span><span class="sxs-lookup"><span data-stu-id="8c10e-260">The **AcceptSecurityContext (Digest)** function is the server counterpart to the [**InitializeSecurityContext (Digest)**](initializesecuritycontext--digest.md) function.</span></span>

<span data-ttu-id="8c10e-261">Quando o servidor recebe uma solicitação de um cliente, o servidor usa o parâmetro *fContextReq* para especificar o que é necessário para a sessão.</span><span class="sxs-lookup"><span data-stu-id="8c10e-261">When the server receives a request from a client, the server uses the *fContextReq* parameter to specify what it requires of the session.</span></span> <span data-ttu-id="8c10e-262">Dessa maneira, um servidor pode especificar que os clientes devem ser capazes de usar uma sessão confidencial ou com verificação de [*integridade*](../secgloss/i-gly.md), e pode rejeitar clientes que não podem atender a essa demanda.</span><span class="sxs-lookup"><span data-stu-id="8c10e-262">In this fashion, a server can specify that clients must be capable of using a confidential or [*integrity*](../secgloss/i-gly.md)-checked session, and it can reject clients that cannot meet that demand.</span></span> <span data-ttu-id="8c10e-263">Como alternativa, um servidor pode não exigir nada e tudo o que o cliente pode fornecer ou exigir é retornado no parâmetro *pfContextAttr* .</span><span class="sxs-lookup"><span data-stu-id="8c10e-263">Alternatively, a server can require nothing, and whatever the client can provide or requires is returned in the *pfContextAttr* parameter.</span></span>

<span data-ttu-id="8c10e-264">Para um pacote que dá suporte à autenticação de vários trechos, como a autenticação mútua, a sequência de chamada é a seguinte:</span><span class="sxs-lookup"><span data-stu-id="8c10e-264">For a package that supports multiple-leg authentication, such as mutual authentication, the calling sequence is as follows:</span></span>

1.  <span data-ttu-id="8c10e-265">O cliente transmite um token para o servidor.</span><span class="sxs-lookup"><span data-stu-id="8c10e-265">The client transmits a token to the server.</span></span>
2.  <span data-ttu-id="8c10e-266">O servidor chama **AcceptSecurityContext (Digest)** pela primeira vez, o que gera um token de resposta que é enviado para o cliente.</span><span class="sxs-lookup"><span data-stu-id="8c10e-266">The server calls **AcceptSecurityContext (Digest)** the first time, which generates a reply token that is then sent to the client.</span></span>
3.  <span data-ttu-id="8c10e-267">O cliente recebe o token e o passa para [**InitializeSecurityContext (Digest)**](initializesecuritycontext--digest.md).</span><span class="sxs-lookup"><span data-stu-id="8c10e-267">The client receives the token and passes it to [**InitializeSecurityContext (Digest)**](initializesecuritycontext--digest.md).</span></span> <span data-ttu-id="8c10e-268">Se **InitializeSecurityContext (Digest)** retornar s \_ e \_ OK, a autenticação mútua foi concluída e uma sessão segura pode começar.</span><span class="sxs-lookup"><span data-stu-id="8c10e-268">If **InitializeSecurityContext (Digest)** returns SEC\_E\_OK, mutual authentication has been completed and a secure session can begin.</span></span> <span data-ttu-id="8c10e-269">Se **InitializeSecurityContext (Digest)** retornar um código de erro, a negociação de autenticação mútua terminará.</span><span class="sxs-lookup"><span data-stu-id="8c10e-269">If **InitializeSecurityContext (Digest)** returns an error code, the mutual authentication negotiation ends.</span></span> <span data-ttu-id="8c10e-270">Caso contrário, o token de segurança retornado por **InitializeSecurityContext (Digest)** é enviado ao cliente e as etapas 2 e 3 são repetidas.</span><span class="sxs-lookup"><span data-stu-id="8c10e-270">Otherwise, the security token returned by **InitializeSecurityContext (Digest)** is sent to the client, and steps 2 and 3 are repeated.</span></span>

<span data-ttu-id="8c10e-271">Os parâmetros *fContextReq* e *pfContextAttr* são bitmasks que representam vários atributos de contexto.</span><span class="sxs-lookup"><span data-stu-id="8c10e-271">The *fContextReq* and *pfContextAttr* parameters are bitmasks that represent various context attributes.</span></span> <span data-ttu-id="8c10e-272">Para obter uma descrição dos vários atributos, consulte [requisitos de contexto](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="8c10e-272">For a description of the various attributes, see [Context Requirements](context-requirements.md).</span></span>

> [!Note]  
> <span data-ttu-id="8c10e-273">O parâmetro *pfContextAttr* é válido em qualquer retorno bem-sucedido, mas somente no retorno bem-sucedido final, você deve examinar os sinalizadores referentes aos aspectos de segurança do contexto.</span><span class="sxs-lookup"><span data-stu-id="8c10e-273">The *pfContextAttr* parameter is valid on any successful return, but only on the final successful return should you examine the flags pertaining to security aspects of the context.</span></span> <span data-ttu-id="8c10e-274">Os retornos intermediários podem definir, por exemplo, o \_ \_ sinalizador de memória alocada do ISC RET \_ .</span><span class="sxs-lookup"><span data-stu-id="8c10e-274">Intermediate returns can set, for example, the ISC\_RET\_ALLOCATED\_MEMORY flag.</span></span>

 

<span data-ttu-id="8c10e-275">O chamador é responsável por determinar se os atributos de contexto final são suficientes.</span><span class="sxs-lookup"><span data-stu-id="8c10e-275">The caller is responsible for determining whether the final context attributes are sufficient.</span></span> <span data-ttu-id="8c10e-276">Se, por exemplo, a confidencialidade (criptografia) tiver sido solicitada, mas não puder ser estabelecida, alguns aplicativos poderão optar por desligar a conexão imediatamente.</span><span class="sxs-lookup"><span data-stu-id="8c10e-276">If, for example, confidentiality (encryption) was requested, but could not be established, some applications may choose to shut down the connection immediately.</span></span> <span data-ttu-id="8c10e-277">Se o [*contexto de segurança*](../secgloss/s-gly.md) não puder ser estabelecido, o servidor deverá liberar o contexto parcialmente criado chamando a função [**DeleteSecurityContext**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) .</span><span class="sxs-lookup"><span data-stu-id="8c10e-277">If the [*security context*](../secgloss/s-gly.md) cannot be established, the server must free the partially created context by calling the [**DeleteSecurityContext**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) function.</span></span> <span data-ttu-id="8c10e-278">Para obter informações sobre quando chamar a função **DeleteSecurityContext** , consulte **DeleteSecurityContext**.</span><span class="sxs-lookup"><span data-stu-id="8c10e-278">For information about when to call the **DeleteSecurityContext** function, see **DeleteSecurityContext**.</span></span>

<span data-ttu-id="8c10e-279">Depois que o [*contexto de segurança*](../secgloss/s-gly.md) tiver sido estabelecido, o aplicativo de servidor poderá usar a função [**QuerySecurityContextToken**](/windows/win32/api/sspi/nf-sspi-querysecuritycontexttoken) para recuperar um identificador para a conta de usuário para a qual o certificado de cliente foi mapeado.</span><span class="sxs-lookup"><span data-stu-id="8c10e-279">After the [*security context*](../secgloss/s-gly.md) has been established, the server application can use the [**QuerySecurityContextToken**](/windows/win32/api/sspi/nf-sspi-querysecuritycontexttoken) function to retrieve a handle to the user account to which the client certificate was mapped.</span></span> <span data-ttu-id="8c10e-280">Além disso, o servidor pode usar a função [**ImpersonateSecurityContext**](/windows/win32/api/sspi/nf-sspi-impersonatesecuritycontext) para representar o usuário.</span><span class="sxs-lookup"><span data-stu-id="8c10e-280">Also, the server can use the [**ImpersonateSecurityContext**](/windows/win32/api/sspi/nf-sspi-impersonatesecuritycontext) function to impersonate the user.</span></span>

## <a name="requirements"></a><span data-ttu-id="8c10e-281">Requisitos</span><span class="sxs-lookup"><span data-stu-id="8c10e-281">Requirements</span></span>



| <span data-ttu-id="8c10e-282">Requisito</span><span class="sxs-lookup"><span data-stu-id="8c10e-282">Requirement</span></span> | <span data-ttu-id="8c10e-283">Valor</span><span class="sxs-lookup"><span data-stu-id="8c10e-283">Value</span></span> |
|-------------------------------------|--------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="8c10e-284">Cliente mínimo com suporte</span><span class="sxs-lookup"><span data-stu-id="8c10e-284">Minimum supported client</span></span><br/> | <span data-ttu-id="8c10e-285">\[Somente aplicativos da área de trabalho do Windows XP\]</span><span class="sxs-lookup"><span data-stu-id="8c10e-285">Windows XP \[desktop apps only\]</span></span><br/>                                                            |
| <span data-ttu-id="8c10e-286">Servidor mínimo com suporte</span><span class="sxs-lookup"><span data-stu-id="8c10e-286">Minimum supported server</span></span><br/> | <span data-ttu-id="8c10e-287">\[Somente aplicativos da área de trabalho do Windows Server 2003\]</span><span class="sxs-lookup"><span data-stu-id="8c10e-287">Windows Server 2003 \[desktop apps only\]</span></span><br/>                                                   |
| <span data-ttu-id="8c10e-288">parâmetro</span><span class="sxs-lookup"><span data-stu-id="8c10e-288">Header</span></span><br/>                   | <dl> <span data-ttu-id="8c10e-289"><dt>SSPI. h (incluir Security. h)</dt></span><span class="sxs-lookup"><span data-stu-id="8c10e-289"><dt>Sspi.h (include Security.h)</dt></span></span> </dl> |
| <span data-ttu-id="8c10e-290">Biblioteca</span><span class="sxs-lookup"><span data-stu-id="8c10e-290">Library</span></span><br/>                  | <dl> <span data-ttu-id="8c10e-291"><dt>Secur32. lib</dt></span><span class="sxs-lookup"><span data-stu-id="8c10e-291"><dt>Secur32.lib</dt></span></span> </dl>                 |
| <span data-ttu-id="8c10e-292">DLL</span><span class="sxs-lookup"><span data-stu-id="8c10e-292">DLL</span></span><br/>                      | <dl> <span data-ttu-id="8c10e-293"><dt>Secur32.dll</dt></span><span class="sxs-lookup"><span data-stu-id="8c10e-293"><dt>Secur32.dll</dt></span></span> </dl>                 |



## <a name="see-also"></a><span data-ttu-id="8c10e-294">Confira também</span><span class="sxs-lookup"><span data-stu-id="8c10e-294">See also</span></span>

<dl> <dt>

[<span data-ttu-id="8c10e-295">Funções SSPI</span><span class="sxs-lookup"><span data-stu-id="8c10e-295">SSPI Functions</span></span>](authentication-functions.md#sspi-functions)
</dt> <dt>

[<span data-ttu-id="8c10e-296">**DeleteSecurityContext**</span><span class="sxs-lookup"><span data-stu-id="8c10e-296">**DeleteSecurityContext**</span></span>](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext)
</dt> <dt>

[<span data-ttu-id="8c10e-297">**InitializeSecurityContext (resumo)**</span><span class="sxs-lookup"><span data-stu-id="8c10e-297">**InitializeSecurityContext (Digest)**</span></span>](initializesecuritycontext--digest.md)
</dt> </dl>

 

 
