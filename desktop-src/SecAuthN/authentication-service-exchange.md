---
description: O usuário começa a fazer logon na rede digitando um nome de logon e senha. O cliente Kerberos na estação de trabalho do usuário converte a senha em uma chave de criptografia e salva o resultado em uma variável de programa.
ms.assetid: fcb3b601-9953-474c-9a08-1fa25706f3d7
title: Troca de serviços de autenticação
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c14121ed33ae0ac169c590b03dfb0b395306d11f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "105750508"
---
# <a name="authentication-service-exchange"></a><span data-ttu-id="6f99b-104">Troca de serviços de autenticação</span><span class="sxs-lookup"><span data-stu-id="6f99b-104">Authentication Service Exchange</span></span>

<span data-ttu-id="6f99b-105">O usuário começa a fazer logon na rede digitando um nome de logon e senha.</span><span class="sxs-lookup"><span data-stu-id="6f99b-105">The user begins logging on to the network by typing a logon name and password.</span></span> <span data-ttu-id="6f99b-106">O cliente [*Kerberos*](/windows/desktop/SecGloss/k-gly) na estação de trabalho do usuário converte a senha em uma chave de criptografia e salva o resultado em uma variável de programa.</span><span class="sxs-lookup"><span data-stu-id="6f99b-106">The [*Kerberos*](/windows/desktop/SecGloss/k-gly) client on the user's workstation converts the password to an encryption key and saves the result in a program variable.</span></span>

<span data-ttu-id="6f99b-107">Em seguida, o cliente solicita [*credenciais*](/windows/desktop/SecGloss/c-gly) para o serviço de concessão de TÍQUETE (TGS) do [*centro de distribuição de chaves*](/windows/desktop/SecGloss/k-gly) (KDC) enviando ao serviço de autenticação do KDC uma mensagem do tipo KRB \_ como \_ req (solicitação de serviço de autenticação Kerberos).</span><span class="sxs-lookup"><span data-stu-id="6f99b-107">The client then requests [*credentials*](/windows/desktop/SecGloss/c-gly) for the ticket-granting service (TGS) of the [*Key Distribution Center*](/windows/desktop/SecGloss/k-gly) (KDC) by sending the KDC's authentication service a message of type KRB\_AS\_REQ (Kerberos Authentication Service Request).</span></span> <span data-ttu-id="6f99b-108">A primeira parte dessa mensagem identifica o usuário e o serviço TGS que está sendo solicitado.</span><span class="sxs-lookup"><span data-stu-id="6f99b-108">The first part of this message identifies the user and the TGS service being requested.</span></span> <span data-ttu-id="6f99b-109">A segunda parte desta mensagem contém dados de pré-autenticação destinados a provar que o usuário conhece a senha.</span><span class="sxs-lookup"><span data-stu-id="6f99b-109">The second part of this message contains preauthentication data intended to prove that the user knows the password.</span></span> <span data-ttu-id="6f99b-110">Essa é simplesmente uma mensagem de autenticador que é criptografada com a [*chave mestra*](/windows/desktop/SecGloss/m-gly) derivada da senha de logon do usuário.</span><span class="sxs-lookup"><span data-stu-id="6f99b-110">This is simply an authenticator message that is encrypted with the [*master key*](/windows/desktop/SecGloss/m-gly) derived from the user's logon password.</span></span>

<span data-ttu-id="6f99b-111">Quando o KDC recebe KRB \_ como \_ req, ele pesquisa o usuário em seu banco de dados, obtém a chave mestra do usuário associado, descriptografa os dados de pré-autenticação e avalia o carimbo de data/hora dentro do.</span><span class="sxs-lookup"><span data-stu-id="6f99b-111">When the KDC receives KRB\_AS\_REQ, it looks up the user in its database, gets the associated user's master key, decrypts the preauthentication data, and evaluates the time stamp inside.</span></span> <span data-ttu-id="6f99b-112">Se o carimbo de data/hora for válido, o KDC poderá ter certeza de que os dados de pré-autenticação foram criptografados com a chave mestra do usuário e, portanto, que o cliente é original.</span><span class="sxs-lookup"><span data-stu-id="6f99b-112">If the time stamp is valid, the KDC can be assured that the preauthentication data was encrypted with the user's master key and thus that the client is genuine.</span></span>

<span data-ttu-id="6f99b-113">Depois que o KDC verificar a identidade do usuário, ele cria credenciais que o cliente pode apresentar ao TGS, da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="6f99b-113">After the KDC has verified the user's identity, it creates credentials that the client can present to the TGS, as follows:</span></span>

1.  <span data-ttu-id="6f99b-114">O KDC inventa uma chave de [*sessão*](/windows/desktop/SecGloss/s-gly) de logon e criptografa uma cópia com a chave mestra do usuário.</span><span class="sxs-lookup"><span data-stu-id="6f99b-114">The KDC invents a logon [*session key*](/windows/desktop/SecGloss/s-gly) and encrypts a copy with the user's master key.</span></span>
2.  <span data-ttu-id="6f99b-115">O KDC insere outra cópia da chave de sessão de logon e os dados de autorização do usuário em um tíquete de concessão de tíquete (TGT) e criptografa o TGT com a própria chave mestra do KDC.</span><span class="sxs-lookup"><span data-stu-id="6f99b-115">The KDC embeds another copy of the logon session key and the user's authorization data in a ticket-granting ticket (TGT), and encrypts the TGT with the KDC's own master key.</span></span>
3.  <span data-ttu-id="6f99b-116">O KDC envia essas credenciais de volta ao cliente respondendo com uma mensagem do tipo KRB \_ como \_ Rep (resposta do serviço de autenticação Kerberos).</span><span class="sxs-lookup"><span data-stu-id="6f99b-116">The KDC sends these credentials back to the client by replying with a message of type KRB\_AS\_REP (Kerberos Authentication Service Reply).</span></span>
4.  <span data-ttu-id="6f99b-117">Quando o cliente recebe a resposta, ele usa a chave derivada da senha do usuário para descriptografar a nova chave de sessão de logon.</span><span class="sxs-lookup"><span data-stu-id="6f99b-117">When the client receives the reply, it uses the key derived from the user's password to decrypt the new logon session key.</span></span>
5.  <span data-ttu-id="6f99b-118">O cliente armazena a nova chave em seu cache de tíquetes.</span><span class="sxs-lookup"><span data-stu-id="6f99b-118">The client stores the new key in its ticket cache.</span></span>
6.  <span data-ttu-id="6f99b-119">O cliente extrai o TGT da mensagem e o armazena em seu cache de tíquete também.</span><span class="sxs-lookup"><span data-stu-id="6f99b-119">The client extracts the TGT from the message and stores that in its ticket cache as well.</span></span>

 

 
