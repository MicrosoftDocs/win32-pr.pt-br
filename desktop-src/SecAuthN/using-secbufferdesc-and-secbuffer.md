---
description: A comunicação geralmente envolve quantidades potencialmente grandes de dados ou dados de comprimento desconhecido.
ms.assetid: e7b12b9e-8caa-4dad-b81f-b609ccb92c9f
title: Usando SecBufferDesc e SecBuffer
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3ca7d8155a610263838d2baf2a7d1c8fc96ec874
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "103829448"
---
# <a name="using-secbufferdesc-and-secbuffer"></a><span data-ttu-id="2d442-103">Usando SecBufferDesc e SecBuffer</span><span class="sxs-lookup"><span data-stu-id="2d442-103">Using SecBufferDesc and SecBuffer</span></span>

<span data-ttu-id="2d442-104">A comunicação geralmente envolve quantidades potencialmente grandes de dados ou dados de comprimento desconhecido.</span><span class="sxs-lookup"><span data-stu-id="2d442-104">Communication often involves potentially large amounts of data or data of unknown length.</span></span> <span data-ttu-id="2d442-105">O envio e o recebimento de dados são feitos de maneira semelhante ou idêntica em ambos os casos.</span><span class="sxs-lookup"><span data-stu-id="2d442-105">Sending and receiving data is done in similar or identical fashion in both of these cases.</span></span> <span data-ttu-id="2d442-106">Para lidar com comprimento desconhecido e quantidades potencialmente grandes de dados, a comunicação SSPI é feita usando duas estruturas, [**SecBufferDesc**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) e [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer).</span><span class="sxs-lookup"><span data-stu-id="2d442-106">To deal with unknown length and potentially large amounts of data, SSPI communication is done using two structures, [**SecBufferDesc**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) and [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer).</span></span>

<span data-ttu-id="2d442-107">Uma estrutura [**SecBufferDesc**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) é um contêiner para uma matriz de estruturas [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) .</span><span class="sxs-lookup"><span data-stu-id="2d442-107">A [**SecBufferDesc**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) structure is a container for an array of [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) structures.</span></span> <span data-ttu-id="2d442-108">Uma estrutura **SecBufferDesc** tem os seguintes membros:</span><span class="sxs-lookup"><span data-stu-id="2d442-108">A **SecBufferDesc** structure has the following members:</span></span>

-   <span data-ttu-id="2d442-109">Número de versão</span><span class="sxs-lookup"><span data-stu-id="2d442-109">Version number</span></span>
-   <span data-ttu-id="2d442-110">Número de elementos [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer)</span><span class="sxs-lookup"><span data-stu-id="2d442-110">Number of [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) elements</span></span>
-   <span data-ttu-id="2d442-111">Endereço da matriz de estruturas [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer)</span><span class="sxs-lookup"><span data-stu-id="2d442-111">Address of the array of [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) structures</span></span>

<span data-ttu-id="2d442-112">Uma estrutura [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) contém os três seguintes membros:</span><span class="sxs-lookup"><span data-stu-id="2d442-112">A [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) structure contains the following three members:</span></span>

-   <span data-ttu-id="2d442-113">Número de bytes no buffer</span><span class="sxs-lookup"><span data-stu-id="2d442-113">Number of bytes in the buffer</span></span>
-   <span data-ttu-id="2d442-114">Tipo de informações contidas no item de dados</span><span class="sxs-lookup"><span data-stu-id="2d442-114">Type of information contained in the data item</span></span>
-   <span data-ttu-id="2d442-115">Os bytes em si</span><span class="sxs-lookup"><span data-stu-id="2d442-115">The bytes themselves</span></span>

<span data-ttu-id="2d442-116">Uma mensagem SSPI inteira geralmente consiste em uma matriz de estruturas [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) .</span><span class="sxs-lookup"><span data-stu-id="2d442-116">A whole SSPI message often consists of an array of [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) structures.</span></span>

<span data-ttu-id="2d442-117">Os tipos de dados de buffer a seguir são definidos da seguinte maneira.</span><span class="sxs-lookup"><span data-stu-id="2d442-117">The following buffer data types are defined as follows.</span></span>



| <span data-ttu-id="2d442-118">Tipo de buffer</span><span class="sxs-lookup"><span data-stu-id="2d442-118">Buffer type</span></span>                | <span data-ttu-id="2d442-119">Significado</span><span class="sxs-lookup"><span data-stu-id="2d442-119">Meaning</span></span>                                                                                                                                |
|----------------------------|----------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="2d442-120">SECBUFFER \_ vazio</span><span class="sxs-lookup"><span data-stu-id="2d442-120">SECBUFFER\_EMPTY</span></span>           | <span data-ttu-id="2d442-121">Indefinido, substituído pela função de [*pacote de segurança*](../secgloss/s-gly.md)</span><span class="sxs-lookup"><span data-stu-id="2d442-121">Undefined, replaced by the [*security package*](../secgloss/s-gly.md) function</span></span> |
| <span data-ttu-id="2d442-122">dados do SECBUFFER \_</span><span class="sxs-lookup"><span data-stu-id="2d442-122">SECBUFFER\_DATA</span></span>            | <span data-ttu-id="2d442-123">Dados de pacote</span><span class="sxs-lookup"><span data-stu-id="2d442-123">Packet data</span></span>                                                                                                                            |
| <span data-ttu-id="2d442-124">\_token SECBUFFER</span><span class="sxs-lookup"><span data-stu-id="2d442-124">SECBUFFER\_TOKEN</span></span>           | <span data-ttu-id="2d442-125">Token de segurança</span><span class="sxs-lookup"><span data-stu-id="2d442-125">Security token</span></span>                                                                                                                         |
| <span data-ttu-id="2d442-126">\_parâmetros de pacote SECBUFFER \_</span><span class="sxs-lookup"><span data-stu-id="2d442-126">SECBUFFER\_PKG\_PARAMS</span></span>     | <span data-ttu-id="2d442-127">Parâmetros específicos do pacote</span><span class="sxs-lookup"><span data-stu-id="2d442-127">Package-specific parameters</span></span>                                                                                                            |
| <span data-ttu-id="2d442-128">SECBUFFER \_ ausente</span><span class="sxs-lookup"><span data-stu-id="2d442-128">SECBUFFER\_MISSING</span></span>         | <span data-ttu-id="2d442-129">Indicador de dados ausentes</span><span class="sxs-lookup"><span data-stu-id="2d442-129">Missing data indicator</span></span>                                                                                                                 |
| <span data-ttu-id="2d442-130">SECBUFFER \_ extra</span><span class="sxs-lookup"><span data-stu-id="2d442-130">SECBUFFER\_EXTRA</span></span>           | <span data-ttu-id="2d442-131">Dados extras</span><span class="sxs-lookup"><span data-stu-id="2d442-131">Extra data</span></span>                                                                                                                             |
| <span data-ttu-id="2d442-132">fluxo de SECBUFFER \_</span><span class="sxs-lookup"><span data-stu-id="2d442-132">SECBUFFER\_STREAM</span></span>          | <span data-ttu-id="2d442-133">Dados de fluxo de segurança</span><span class="sxs-lookup"><span data-stu-id="2d442-133">Security stream data</span></span>                                                                                                                   |
| <span data-ttu-id="2d442-134">\_trailer de fluxo de SECBUFFER \_</span><span class="sxs-lookup"><span data-stu-id="2d442-134">SECBUFFER\_STREAM\_TRAILER</span></span> | <span data-ttu-id="2d442-135">Trailer de fluxo de segurança</span><span class="sxs-lookup"><span data-stu-id="2d442-135">Security stream trailer</span></span>                                                                                                                |
| <span data-ttu-id="2d442-136">\_cabeçalho de fluxo de SECBUFFER \_</span><span class="sxs-lookup"><span data-stu-id="2d442-136">SECBUFFER\_STREAM\_HEADER</span></span>  | <span data-ttu-id="2d442-137">Cabeçalho do fluxo de segurança</span><span class="sxs-lookup"><span data-stu-id="2d442-137">Security stream header</span></span>                                                                                                                 |



 

<span data-ttu-id="2d442-138">Os tipos de buffer acima podem ser combinados usando uma operação bit-a-**or** com qualquer um dos tipos de buffer a seguir.</span><span class="sxs-lookup"><span data-stu-id="2d442-138">The buffer types above can be combined using a bitwise-**OR** operation with either of the following buffer types.</span></span>



| <span data-ttu-id="2d442-139">Tipo de buffer</span><span class="sxs-lookup"><span data-stu-id="2d442-139">Buffer type</span></span>         | <span data-ttu-id="2d442-140">Significado</span><span class="sxs-lookup"><span data-stu-id="2d442-140">Meaning</span></span>                                                                          |
|---------------------|----------------------------------------------------------------------------------|
| <span data-ttu-id="2d442-141">SECBUFFER \_ ATTRMASK</span><span class="sxs-lookup"><span data-stu-id="2d442-141">SECBUFFER\_ATTRMASK</span></span> | <span data-ttu-id="2d442-142">Mascarar atributos de segurança separando os sinalizadores de atributo do tipo de buffer.</span><span class="sxs-lookup"><span data-stu-id="2d442-142">Mask security attributes by separating the attribute flags from the buffer type.</span></span> |
| <span data-ttu-id="2d442-143">SECBUFFER \_ ReadOnly</span><span class="sxs-lookup"><span data-stu-id="2d442-143">SECBUFFER\_READONLY</span></span> | <span data-ttu-id="2d442-144">O buffer é somente leitura</span><span class="sxs-lookup"><span data-stu-id="2d442-144">Buffer is read-only</span></span>                                                              |



 

<span data-ttu-id="2d442-145">Antes de cada chamada para uma API SSPI que requer um parâmetro [**SecBufferDesc**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) , um ou mais elementos da matriz [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) são declarados e inicializados.</span><span class="sxs-lookup"><span data-stu-id="2d442-145">Before each call to an SSPI API that requires a [**SecBufferDesc**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) parameter, one or more [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) array elements are declared and initialized.</span></span> <span data-ttu-id="2d442-146">Por exemplo, pode haver dois buffers de segurança: um que contenha dados de mensagem de entrada e o outro para o token de segurança opaco de saída retornado pelo pacote de segurança.</span><span class="sxs-lookup"><span data-stu-id="2d442-146">For example, there can be two security buffers: one that contains input message data and the other for the output opaque security token returned by the security package.</span></span> <span data-ttu-id="2d442-147">A ordem dos buffers de segurança no descritor de buffer de segurança não é importante, mas cada buffer deve ser marcado com o tipo apropriado.</span><span class="sxs-lookup"><span data-stu-id="2d442-147">The order of security buffers in the security buffer descriptor is not important, but each buffer must be tagged with its appropriate type.</span></span> <span data-ttu-id="2d442-148">Uma marca somente leitura pode ser usada com qualquer buffer de entrada que não deve ser modificado pelo [*pacote de segurança*](../secgloss/s-gly.md).</span><span class="sxs-lookup"><span data-stu-id="2d442-148">A read-only tag can be used with any input buffer that must not be modified by the [*security package*](../secgloss/s-gly.md).</span></span>

<span data-ttu-id="2d442-149">O tamanho do buffer de saída que deve conter o token de segurança é importante.</span><span class="sxs-lookup"><span data-stu-id="2d442-149">The size of the output buffer that is expected to contain the security token is important.</span></span> <span data-ttu-id="2d442-150">Um aplicativo pode encontrar o tamanho máximo de token para um pacote de segurança durante a instalação inicial.</span><span class="sxs-lookup"><span data-stu-id="2d442-150">An application can find the maximum token size for a security package during initial setup.</span></span> <span data-ttu-id="2d442-151">A chamada para [**EnumerateSecurityPackages**](/windows/desktop/api/Sspi/nf-sspi-enumeratesecuritypackagesa) retorna uma matriz de ponteiros para informações do pacote de segurança.</span><span class="sxs-lookup"><span data-stu-id="2d442-151">The call to [**EnumerateSecurityPackages**](/windows/desktop/api/Sspi/nf-sspi-enumeratesecuritypackagesa) returns an array of pointers to security package information.</span></span> <span data-ttu-id="2d442-152">A estrutura de informações do pacote de segurança contém o tamanho máximo de token para cada pacote.</span><span class="sxs-lookup"><span data-stu-id="2d442-152">The security package information structure contains the maximum token size for each package.</span></span> <span data-ttu-id="2d442-153">No exemplo, as informações estão no membro **cbMaxToken** da estrutura [**SecPkgInfo**](/windows/desktop/api/Sspi/ns-sspi-secpkginfoa) .</span><span class="sxs-lookup"><span data-stu-id="2d442-153">In the example, the information is in the **cbMaxToken** member of the [**SecPkgInfo**](/windows/desktop/api/Sspi/ns-sspi-secpkginfoa) structure.</span></span> <span data-ttu-id="2d442-154">As mesmas informações podem ser obtidas posteriormente usando [**QuerySecurityPackageInfo**](/windows/desktop/api/Sspi/nf-sspi-querysecuritypackageinfoa).</span><span class="sxs-lookup"><span data-stu-id="2d442-154">The same information can be obtained later using [**QuerySecurityPackageInfo**](/windows/desktop/api/Sspi/nf-sspi-querysecuritypackageinfoa).</span></span>

<span data-ttu-id="2d442-155">O aplicativo Inicializa os ponteiros e tamanhos do buffer na descrição do buffer para indicar onde os dados da mensagem e outras informações podem ser encontrados.</span><span class="sxs-lookup"><span data-stu-id="2d442-155">The application initializes the buffer pointers and sizes in the buffer description to indicate where message data and other information can be found.</span></span>

<span data-ttu-id="2d442-156">Para obter detalhes, consulte o [código de exemplo SecBuffer e SecBufferDesc](secbuffer-and-secbufferdesc-example-code.md).</span><span class="sxs-lookup"><span data-stu-id="2d442-156">For details, see [SecBuffer and SecBufferDesc Example Code](secbuffer-and-secbufferdesc-example-code.md).</span></span>

 

 
