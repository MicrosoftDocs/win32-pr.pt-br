---
description: Os contextos de fluxo lidam com os protocolos seguros orientados a fluxo, como SSL ou PCT.
ms.assetid: 05a6b036-1f7f-473f-9813-a1e1534e0f0d
title: Contextos de fluxo
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 53103dc1269c05e5a2c162133d21e167d8035c2c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103921329"
---
# <a name="stream-contexts"></a><span data-ttu-id="8119f-103">Contextos de fluxo</span><span class="sxs-lookup"><span data-stu-id="8119f-103">Stream Contexts</span></span>

<span data-ttu-id="8119f-104">Os contextos de fluxo lidam com os protocolos seguros orientados a fluxo, como SSL ou PCT.</span><span class="sxs-lookup"><span data-stu-id="8119f-104">Stream contexts handle the secure stream-oriented protocols such as SSL or PCT.</span></span> <span data-ttu-id="8119f-105">No interesse de compartilhar a mesma interface e o gerenciamento de credenciais semelhante, o SSPI fornece suporte para contextos de fluxo.</span><span class="sxs-lookup"><span data-stu-id="8119f-105">In the interest of sharing the same interface and similar credential management, SSPI provides support for stream contexts.</span></span> <span data-ttu-id="8119f-106">O [*protocolo de segurança*](../secgloss/s-gly.md) incorpora o esquema de autenticação do fluxo e os formatos de registro.</span><span class="sxs-lookup"><span data-stu-id="8119f-106">The [*security protocol*](../secgloss/s-gly.md) incorporates both the stream authentication scheme and record formats.</span></span>

<span data-ttu-id="8119f-107">Para fornecer protocolos orientados a fluxo, os [*pacotes de segurança*](../secgloss/s-gly.md) que dão suporte a contextos de fluxo têm as seguintes características de processo:</span><span class="sxs-lookup"><span data-stu-id="8119f-107">To provide stream-oriented protocols, [*security packages*](../secgloss/s-gly.md) that support stream contexts have the following process characteristics:</span></span>

-   <span data-ttu-id="8119f-108">O pacote define o \_ sinalizador de fluxo de sinalizador SECPKG \_ para indicar que ele dá suporte à semântica de fluxo.</span><span class="sxs-lookup"><span data-stu-id="8119f-108">The package sets the SECPKG\_FLAG\_STREAM flag to indicate that it supports stream semantics.</span></span>
-   <span data-ttu-id="8119f-109">Os aplicativos de transporte solicitam semânticas de fluxo Configurando os sinalizadores de fluxo de solicitações de transmissão e de transmissão do ISC \_ \_ \_ \_ nas chamadas para as funções [**InitializeSecurityContext (geral)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) e [**AcceptSecurityContext (geral)**](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) .</span><span class="sxs-lookup"><span data-stu-id="8119f-109">Transport applications requests stream semantics by setting the ISC\_REQ\_STREAM and ASC\_REQ\_STREAM flags in the calls to the [**InitializeSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) and [**AcceptSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) functions.</span></span>
-   <span data-ttu-id="8119f-110">O aplicativo chama a função [**QueryContextAttributes (geral)**](/windows/win32/api/sspi/nf-sspi-querycontextattributesa) com uma estrutura [**SecPkgContext \_ StreamSizes**](/windows/desktop/api/Sspi/ns-sspi-secpkgcontext_streamsizes) para consultar o [*contexto de segurança*](../secgloss/s-gly.md) para o número de buffers a serem fornecidos e os tamanhos a serem reservados para cabeçalhos ou trailers.</span><span class="sxs-lookup"><span data-stu-id="8119f-110">The application calls the [**QueryContextAttributes (General)**](/windows/win32/api/sspi/nf-sspi-querycontextattributesa) function with a [**SecPkgContext\_StreamSizes**](/windows/desktop/api/Sspi/ns-sspi-secpkgcontext_streamsizes) structure to query the [*security context*](../secgloss/s-gly.md) for the number of buffers to provide and the sizes to reserve for headers or trailers.</span></span>
-   <span data-ttu-id="8119f-111">O aplicativo fornece descritores de buffer para sobressalente durante o processamento real dos dados.</span><span class="sxs-lookup"><span data-stu-id="8119f-111">The application provides buffer descriptors to spare during the actual processing of the data.</span></span> <span data-ttu-id="8119f-112">Ao especificar a semântica de fluxo, o chamador indica a disposição para fazer processamento extra para que o [*pacote de segurança*](../secgloss/s-gly.md) possa lidar com o bloqueio das mensagens.</span><span class="sxs-lookup"><span data-stu-id="8119f-112">By specifying stream semantics, the caller indicates willingness to do extra processing so that the [*security package*](../secgloss/s-gly.md) can handle the blocking of the messages.</span></span> <span data-ttu-id="8119f-113">Em essência, para as funções [**MakeSignature**](/windows/desktop/api/Sspi/nf-sspi-makesignature) e [**VerifySignature**](/windows/desktop/api/Sspi/nf-sspi-verifysignature) , o chamador passa em uma lista de buffers.</span><span class="sxs-lookup"><span data-stu-id="8119f-113">In essence, for the [**MakeSignature**](/windows/desktop/api/Sspi/nf-sspi-makesignature) and [**VerifySignature**](/windows/desktop/api/Sspi/nf-sspi-verifysignature) functions, the caller passes in a list of buffers.</span></span> <span data-ttu-id="8119f-114">Quando uma mensagem é recebida de um canal que é orientado por fluxo (como uma porta TCP), o chamador passa em uma lista de buffers da seguinte maneira.</span><span class="sxs-lookup"><span data-stu-id="8119f-114">When a message is received from a channel that is stream-oriented (such as a TCP port), the caller passes in a buffer list as follows.</span></span>

    | <span data-ttu-id="8119f-115">Buffer</span><span class="sxs-lookup"><span data-stu-id="8119f-115">Buffer</span></span> | <span data-ttu-id="8119f-116">Comprimento</span><span class="sxs-lookup"><span data-stu-id="8119f-116">Length</span></span>         | <span data-ttu-id="8119f-117">Tipo de buffer</span><span class="sxs-lookup"><span data-stu-id="8119f-117">Buffer type</span></span>      |
    |--------|----------------|------------------|
    | <span data-ttu-id="8119f-118">1</span><span class="sxs-lookup"><span data-stu-id="8119f-118">1</span></span>      | <span data-ttu-id="8119f-119">Comprimento da mensagem</span><span class="sxs-lookup"><span data-stu-id="8119f-119">Message Length</span></span> | <span data-ttu-id="8119f-120">dados do SECBUFFER \_</span><span class="sxs-lookup"><span data-stu-id="8119f-120">SECBUFFER\_DATA</span></span>  |
    | <span data-ttu-id="8119f-121">2</span><span class="sxs-lookup"><span data-stu-id="8119f-121">2</span></span>      | <span data-ttu-id="8119f-122">0</span><span class="sxs-lookup"><span data-stu-id="8119f-122">0</span></span>              | <span data-ttu-id="8119f-123">SECBUFFER \_ vazio</span><span class="sxs-lookup"><span data-stu-id="8119f-123">SECBUFFER\_EMPTY</span></span> |
    | <span data-ttu-id="8119f-124">3</span><span class="sxs-lookup"><span data-stu-id="8119f-124">3</span></span>      | <span data-ttu-id="8119f-125">0</span><span class="sxs-lookup"><span data-stu-id="8119f-125">0</span></span>              | <span data-ttu-id="8119f-126">SECBUFFER \_ vazio</span><span class="sxs-lookup"><span data-stu-id="8119f-126">SECBUFFER\_EMPTY</span></span> |
    | <span data-ttu-id="8119f-127">4</span><span class="sxs-lookup"><span data-stu-id="8119f-127">4</span></span>      | <span data-ttu-id="8119f-128">0</span><span class="sxs-lookup"><span data-stu-id="8119f-128">0</span></span>              | <span data-ttu-id="8119f-129">SECBUFFER \_ vazio</span><span class="sxs-lookup"><span data-stu-id="8119f-129">SECBUFFER\_EMPTY</span></span> |
    | <span data-ttu-id="8119f-130">5</span><span class="sxs-lookup"><span data-stu-id="8119f-130">5</span></span>      | <span data-ttu-id="8119f-131">0</span><span class="sxs-lookup"><span data-stu-id="8119f-131">0</span></span>              | <span data-ttu-id="8119f-132">SECBUFFER \_ vazio</span><span class="sxs-lookup"><span data-stu-id="8119f-132">SECBUFFER\_EMPTY</span></span> |

    

     

    <span data-ttu-id="8119f-133">O pacote de segurança funciona no [*blob*](../secgloss/b-gly.md).</span><span class="sxs-lookup"><span data-stu-id="8119f-133">The security package then works on the [*BLOB*](../secgloss/b-gly.md).</span></span> <span data-ttu-id="8119f-134">Se a função retornar com êxito, a lista de buffers será parecida com a mostrada a seguir.</span><span class="sxs-lookup"><span data-stu-id="8119f-134">If the function returns successfully, the buffer list looks like the following.</span></span>

    

    | <span data-ttu-id="8119f-135">Buffer</span><span class="sxs-lookup"><span data-stu-id="8119f-135">Buffer</span></span> | <span data-ttu-id="8119f-136">Comprimento</span><span class="sxs-lookup"><span data-stu-id="8119f-136">Length</span></span>         | <span data-ttu-id="8119f-137">Tipo de buffer</span><span class="sxs-lookup"><span data-stu-id="8119f-137">Buffer type</span></span>                |
    |--------|----------------|----------------------------|
    | <span data-ttu-id="8119f-138">1</span><span class="sxs-lookup"><span data-stu-id="8119f-138">1</span></span>      | <span data-ttu-id="8119f-139">Comprimento do cabeçalho</span><span class="sxs-lookup"><span data-stu-id="8119f-139">Header Length</span></span>  | <span data-ttu-id="8119f-140">\_cabeçalho de fluxo de SECBUFFER \_</span><span class="sxs-lookup"><span data-stu-id="8119f-140">SECBUFFER\_STREAM\_HEADER</span></span>  |
    | <span data-ttu-id="8119f-141">2</span><span class="sxs-lookup"><span data-stu-id="8119f-141">2</span></span>      | <span data-ttu-id="8119f-142">Comprimento dos dados</span><span class="sxs-lookup"><span data-stu-id="8119f-142">Data Length</span></span>    | <span data-ttu-id="8119f-143">dados do SECBUFFER \_</span><span class="sxs-lookup"><span data-stu-id="8119f-143">SECBUFFER\_DATA</span></span>            |
    | <span data-ttu-id="8119f-144">3</span><span class="sxs-lookup"><span data-stu-id="8119f-144">3</span></span>      | <span data-ttu-id="8119f-145">Comprimento do trailer</span><span class="sxs-lookup"><span data-stu-id="8119f-145">Trailer Length</span></span> | <span data-ttu-id="8119f-146">\_trailer de fluxo de SECBUFFER \_</span><span class="sxs-lookup"><span data-stu-id="8119f-146">SECBUFFER\_STREAM\_TRAILER</span></span> |
    | <span data-ttu-id="8119f-147">4</span><span class="sxs-lookup"><span data-stu-id="8119f-147">4</span></span>      | <span data-ttu-id="8119f-148">0</span><span class="sxs-lookup"><span data-stu-id="8119f-148">0</span></span>              | <span data-ttu-id="8119f-149">SECBUFFER \_ vazio</span><span class="sxs-lookup"><span data-stu-id="8119f-149">SECBUFFER\_EMPTY</span></span>           |
    | <span data-ttu-id="8119f-150">5</span><span class="sxs-lookup"><span data-stu-id="8119f-150">5</span></span>      | <span data-ttu-id="8119f-151">0</span><span class="sxs-lookup"><span data-stu-id="8119f-151">0</span></span>              | <span data-ttu-id="8119f-152">SECBUFFER \_ vazio</span><span class="sxs-lookup"><span data-stu-id="8119f-152">SECBUFFER\_EMPTY</span></span>           |

    

     

    <span data-ttu-id="8119f-153">O pacote também poderia retornar o buffer \# 4 com o comprimento x e o tipo de buffer SECBUFFER \_ extra indicando que os dados nesse buffer fazem parte do próximo registro e ainda não foram processados.</span><span class="sxs-lookup"><span data-stu-id="8119f-153">The package could have also returned buffer \#4 with length x and buffer type SECBUFFER\_EXTRA indicating that the data in this buffer is part of the next record and has not yet been processed.</span></span> <span data-ttu-id="8119f-154">Por outro lado, se a função Message retornar o \_ código de erro da mensagem s E \_ incompletas \_ , a lista de buffers retornada será parecida com a seguinte.</span><span class="sxs-lookup"><span data-stu-id="8119f-154">Conversely, if the message function returns the SEC\_E\_INCOMPLETE\_MESSAGE error code, the returned buffer list would look like the following.</span></span>

    

    | <span data-ttu-id="8119f-155">Buffer</span><span class="sxs-lookup"><span data-stu-id="8119f-155">Buffer</span></span> | <span data-ttu-id="8119f-156">Comprimento</span><span class="sxs-lookup"><span data-stu-id="8119f-156">Length</span></span> | <span data-ttu-id="8119f-157">Tipo de buffer</span><span class="sxs-lookup"><span data-stu-id="8119f-157">Buffer type</span></span>        |
    |--------|--------|--------------------|
    | <span data-ttu-id="8119f-158">1</span><span class="sxs-lookup"><span data-stu-id="8119f-158">1</span></span>      | <span data-ttu-id="8119f-159">x</span><span class="sxs-lookup"><span data-stu-id="8119f-159">x</span></span>      | <span data-ttu-id="8119f-160">SECBUFFER \_ ausente</span><span class="sxs-lookup"><span data-stu-id="8119f-160">SECBUFFER\_MISSING</span></span> |

    

     

    <span data-ttu-id="8119f-161">Isso indica que mais dados foram necessários para processar o registro.</span><span class="sxs-lookup"><span data-stu-id="8119f-161">This indicates that more data was needed to process the record.</span></span> <span data-ttu-id="8119f-162">Ao contrário da maioria dos erros retornados de uma função de mensagem, esse tipo de buffer não indica que o contexto foi comprometido.</span><span class="sxs-lookup"><span data-stu-id="8119f-162">Unlike most errors returned from a message function, this buffer type does not indicate that the context has been compromised.</span></span> <span data-ttu-id="8119f-163">Em vez disso, ele indica que mais dados são necessários.</span><span class="sxs-lookup"><span data-stu-id="8119f-163">Instead, it indicates that more data is needed.</span></span> <span data-ttu-id="8119f-164">os [*pacotes de segurança*](../secgloss/s-gly.md) não devem atualizar seu [*estado*](../secgloss/s-gly.md) nessa condição.</span><span class="sxs-lookup"><span data-stu-id="8119f-164">[*security packages*](../secgloss/s-gly.md) must not update their [*state*](../secgloss/s-gly.md) in this condition.</span></span>

    <span data-ttu-id="8119f-165">Da mesma forma, no lado do remetente da comunicação, o chamador pode chamar a função [**MakeSignature**](/windows/desktop/api/Sspi/nf-sspi-makesignature) .</span><span class="sxs-lookup"><span data-stu-id="8119f-165">Similarly, on the sender side of the communication, the caller can call the [**MakeSignature**](/windows/desktop/api/Sspi/nf-sspi-makesignature) function.</span></span> <span data-ttu-id="8119f-166">O pacote de segurança pode precisar realocar o buffer ou copiar as coisas.</span><span class="sxs-lookup"><span data-stu-id="8119f-166">The security package may need to reallocate the buffer or copy things around.</span></span> <span data-ttu-id="8119f-167">O chamador pode ser mais eficiente fornecendo uma lista de buffers da seguinte maneira.</span><span class="sxs-lookup"><span data-stu-id="8119f-167">The caller can be more efficient by providing a buffer list as follows.</span></span>

    

    | <span data-ttu-id="8119f-168">Buffer</span><span class="sxs-lookup"><span data-stu-id="8119f-168">Buffer</span></span> | <span data-ttu-id="8119f-169">Comprimento</span><span class="sxs-lookup"><span data-stu-id="8119f-169">Length</span></span>         | <span data-ttu-id="8119f-170">Tipo</span><span class="sxs-lookup"><span data-stu-id="8119f-170">Type</span></span>                       |
    |--------|----------------|----------------------------|
    | <span data-ttu-id="8119f-171">1</span><span class="sxs-lookup"><span data-stu-id="8119f-171">1</span></span>      | <span data-ttu-id="8119f-172">Comprimento do cabeçalho</span><span class="sxs-lookup"><span data-stu-id="8119f-172">Header Length</span></span>  | <span data-ttu-id="8119f-173">\_cabeçalho de fluxo de SECBUFFER \_</span><span class="sxs-lookup"><span data-stu-id="8119f-173">SECBUFFER\_STREAM\_HEADER</span></span>  |
    | <span data-ttu-id="8119f-174">2</span><span class="sxs-lookup"><span data-stu-id="8119f-174">2</span></span>      | <span data-ttu-id="8119f-175">Comprimento dos dados</span><span class="sxs-lookup"><span data-stu-id="8119f-175">Data Length</span></span>    | <span data-ttu-id="8119f-176">dados do SECBUFFER \_</span><span class="sxs-lookup"><span data-stu-id="8119f-176">SECBUFFER\_DATA</span></span>            |
    | <span data-ttu-id="8119f-177">3</span><span class="sxs-lookup"><span data-stu-id="8119f-177">3</span></span>      | <span data-ttu-id="8119f-178">Comprimento do trailer</span><span class="sxs-lookup"><span data-stu-id="8119f-178">Trailer Length</span></span> | <span data-ttu-id="8119f-179">\_trailer de fluxo de SECBUFFER \_</span><span class="sxs-lookup"><span data-stu-id="8119f-179">SECBUFFER\_STREAM\_TRAILER</span></span> |

    

     

    <span data-ttu-id="8119f-180">Isso permite que o chamador use os buffers com mais eficiência.</span><span class="sxs-lookup"><span data-stu-id="8119f-180">This allows the caller to use the buffers more efficiently.</span></span> <span data-ttu-id="8119f-181">Chamando a função [**QueryContextAttributes**](/windows/win32/api/sspi/nf-sspi-querycontextattributesa) para determinar a quantidade de espaço a ser reservada antes de chamar [**MakeSignature**](/windows/desktop/api/Sspi/nf-sspi-makesignature), a operação é mais eficiente para o aplicativo e o pacote de segurança.</span><span class="sxs-lookup"><span data-stu-id="8119f-181">By calling the [**QueryContextAttributes**](/windows/win32/api/sspi/nf-sspi-querycontextattributesa) function to determine the amount of space to reserve before calling [**MakeSignature**](/windows/desktop/api/Sspi/nf-sspi-makesignature), the operation is more efficient for the application and the security package.</span></span>

 

 
