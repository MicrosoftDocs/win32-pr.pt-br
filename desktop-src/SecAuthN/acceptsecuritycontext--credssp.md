---
description: Permite que o componente de servidor de um aplicativo de transporte estabeleça um contexto de segurança entre o servidor e um cliente remoto.
ms.assetid: a53f733e-b646-4431-b021-a2c446308849
title: Função AcceptSecurityContext (CredSSP)
ms.topic: article
ms.date: 07/25/2019
ms.openlocfilehash: 681e03ea15729cc8726d63551e8b7b0a2b39ecac
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "105790427"
---
# <a name="acceptsecuritycontext-credssp-function"></a><span data-ttu-id="8748c-103">Função AcceptSecurityContext (CredSSP)</span><span class="sxs-lookup"><span data-stu-id="8748c-103">AcceptSecurityContext (CredSSP) function</span></span>

<span data-ttu-id="8748c-104">A função **AcceptSecurityContext (CredSSP)** permite que o componente de servidor de um aplicativo de transporte estabeleça um contexto de segurança entre o servidor e um cliente remoto.</span><span class="sxs-lookup"><span data-stu-id="8748c-104">The **AcceptSecurityContext (CredSSP)** function lets the server component of a transport application establish a security context between the server and a remote client.</span></span> <span data-ttu-id="8748c-105">O cliente remoto chama a função [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md) para iniciar o processo de estabelecimento de um contexto de segurança.</span><span class="sxs-lookup"><span data-stu-id="8748c-105">The remote client calls the [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md) function to start the process of establishing a security context.</span></span> <span data-ttu-id="8748c-106">O servidor pode exigir um ou mais tokens de resposta do cliente remoto para concluir o estabelecimento do contexto de segurança.</span><span class="sxs-lookup"><span data-stu-id="8748c-106">The server can require one or more reply tokens from the remote client to complete establishing the security context.</span></span>

## <a name="syntax"></a><span data-ttu-id="8748c-107">Sintaxe</span><span class="sxs-lookup"><span data-stu-id="8748c-107">Syntax</span></span>

```C++
SECURITY_STATUS SEC_ENTRY AcceptSecurityContext(
  _In_opt_    PCredHandle    phCredential,
  _In_opt_    PCtxtHandle    phContext,
  _In_opt_    PSecBufferDesc pInput,
  _In_        unsigned long  fContextReq,
  _In_        unsigned long  TargetDataRep,
  _Inout_opt_ PCtxtHandle    phNewContext,
  _Inout_opt_ PSecBufferDesc pOutput,
  _Out_       unsigned long  *pfContextAttr,
  _Out_opt_   PTimeStamp     ptsExpiry
);
```

## <a name="parameters"></a><span data-ttu-id="8748c-108">Parâmetros</span><span class="sxs-lookup"><span data-stu-id="8748c-108">Parameters</span></span>

<span data-ttu-id="8748c-109">*phCredential* \[ em, opcional\]</span><span class="sxs-lookup"><span data-stu-id="8748c-109">*phCredential* \[in, optional\]</span></span>

<span data-ttu-id="8748c-110">Um identificador para as credenciais do servidor.</span><span class="sxs-lookup"><span data-stu-id="8748c-110">A handle to the server credentials.</span></span> <span data-ttu-id="8748c-111">Para recuperar esse identificador, o servidor chama a função [**falha AcquireCredentialsHandle (CredSSP)**](acquirecredentialshandle--credssp.md) com o sinalizador de \_ entrada SECPKG cred \_ ou SECPKG \_ creds \_ .</span><span class="sxs-lookup"><span data-stu-id="8748c-111">To retrieve this handle, the server calls the [**AcquireCredentialsHandle (CredSSP)**](acquirecredentialshandle--credssp.md) function with either the SECPKG\_CRED\_INBOUND or SECPKG\_CRED\_BOTH flag set.</span></span>

<span data-ttu-id="8748c-112">*phContext* \[ em, opcional\]</span><span class="sxs-lookup"><span data-stu-id="8748c-112">*phContext* \[in, optional\]</span></span>

<span data-ttu-id="8748c-113">Um ponteiro para uma estrutura [CtxtHandle](sspi-handles.md) .</span><span class="sxs-lookup"><span data-stu-id="8748c-113">A pointer to a [CtxtHandle](sspi-handles.md) structure.</span></span> <span data-ttu-id="8748c-114">Na primeira chamada para **AcceptSecurityContext (CredSSP)**, esse ponteiro é **nulo**.</span><span class="sxs-lookup"><span data-stu-id="8748c-114">On the first call to **AcceptSecurityContext (CredSSP)**, this pointer is **NULL**.</span></span> <span data-ttu-id="8748c-115">Nas chamadas subsequentes, *phContext* especifica o contexto parcialmente formado retornado no parâmetro *phNewContext* pela primeira chamada.</span><span class="sxs-lookup"><span data-stu-id="8748c-115">On subsequent calls, *phContext* specifies the partially formed context returned in the *phNewContext* parameter by the first call.</span></span>

<span data-ttu-id="8748c-116">*pInput* \[ em, opcional\]</span><span class="sxs-lookup"><span data-stu-id="8748c-116">*pInput* \[in, optional\]</span></span>

<span data-ttu-id="8748c-117">Um ponteiro para uma estrutura [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) gerada por uma chamada de cliente para [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md).</span><span class="sxs-lookup"><span data-stu-id="8748c-117">A pointer to a [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) structure generated by a client call to [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md).</span></span> <span data-ttu-id="8748c-118">A estrutura contém o descritor de buffer de entrada.</span><span class="sxs-lookup"><span data-stu-id="8748c-118">The structure contains the input buffer descriptor.</span></span>

<span data-ttu-id="8748c-119">O primeiro buffer deve ser do tipo **\_ token SECBUFFER** e conter o token de segurança recebido do cliente.</span><span class="sxs-lookup"><span data-stu-id="8748c-119">The first buffer must be of type **SECBUFFER\_TOKEN** and contain the security token received from the client.</span></span> <span data-ttu-id="8748c-120">O segundo buffer deve ser do tipo **SECBUFFER \_ vazio**.</span><span class="sxs-lookup"><span data-stu-id="8748c-120">The second buffer should be of type **SECBUFFER\_EMPTY**.</span></span>

<span data-ttu-id="8748c-121">*fContextReq* \[ no\]</span><span class="sxs-lookup"><span data-stu-id="8748c-121">*fContextReq* \[in\]</span></span>

<span data-ttu-id="8748c-122">– Sinalizadores de bits que especificam os atributos exigidos pelo servidor para estabelecer o contexto.</span><span class="sxs-lookup"><span data-stu-id="8748c-122">-Bit flags that specify the attributes required by the server to establish the context.</span></span> <span data-ttu-id="8748c-123">Os sinalizadores de bits podem ser combinados usando operações de bit-a-**ou** .</span><span class="sxs-lookup"><span data-stu-id="8748c-123">Bit flags can be combined by using bitwise-**OR** operations.</span></span> <span data-ttu-id="8748c-124">Esse parâmetro pode ser um ou mais dos valores a seguir.</span><span class="sxs-lookup"><span data-stu-id="8748c-124">This parameter can be one or more of the following values.</span></span>

| <span data-ttu-id="8748c-125">Valor</span><span class="sxs-lookup"><span data-stu-id="8748c-125">Value</span></span>                          | <span data-ttu-id="8748c-126">Significado</span><span class="sxs-lookup"><span data-stu-id="8748c-126">Meaning</span></span>                                                                                                                                                                                                        |
|--------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="8748c-127">**memória de alocação do ASC \_ req \_ \_**</span><span class="sxs-lookup"><span data-stu-id="8748c-127">**ASC\_REQ\_ALLOCATE\_MEMORY**</span></span> | <span data-ttu-id="8748c-128">O CredSSP (provedor de suporte à segurança de credencial) alocará buffers de saída.</span><span class="sxs-lookup"><span data-stu-id="8748c-128">Credential Security Support Provider (CredSSP) will allocate output buffers.</span></span> <span data-ttu-id="8748c-129">Quando você terminar de usar os buffers de saída, libere-os chamando a função [**FreeContextBuffer**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) .</span><span class="sxs-lookup"><span data-stu-id="8748c-129">When you have finished using the output buffers, free them by calling the [**FreeContextBuffer**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) function.</span></span> |
| <span data-ttu-id="8748c-130">**\_conexão de req. asc \_**</span><span class="sxs-lookup"><span data-stu-id="8748c-130">**ASC\_REQ\_CONNECTION**</span></span>       | <span data-ttu-id="8748c-131">O contexto de segurança não tratará mensagens de formatação.</span><span class="sxs-lookup"><span data-stu-id="8748c-131">The security context will not handle formatting messages.</span></span>                                                                                                                                                      |
| <span data-ttu-id="8748c-132">**\_delegado de req ASC \_**</span><span class="sxs-lookup"><span data-stu-id="8748c-132">**ASC\_REQ\_DELEGATE**</span></span>         | <span data-ttu-id="8748c-133">O servidor tem permissão para representar o cliente.</span><span class="sxs-lookup"><span data-stu-id="8748c-133">The server is allowed to impersonate the client.</span></span> <span data-ttu-id="8748c-134">Ignore este sinalizador para delegação restrita.</span><span class="sxs-lookup"><span data-stu-id="8748c-134">Ignore this flag for constrained delegation.</span></span>                                                         |
| <span data-ttu-id="8748c-135">**\_ \_ erro estendido de req. asc \_**</span><span class="sxs-lookup"><span data-stu-id="8748c-135">**ASC\_REQ\_EXTENDED\_ERROR**</span></span>  | <span data-ttu-id="8748c-136">Quando ocorrerem erros, a parte remota será notificada.</span><span class="sxs-lookup"><span data-stu-id="8748c-136">When errors occur, the remote party will be notified.</span></span>                                                                                                                                                          |
| <span data-ttu-id="8748c-137">**\_detecção de \_ Replay de req do ASC \_**</span><span class="sxs-lookup"><span data-stu-id="8748c-137">**ASC\_REQ\_REPLAY\_DETECT**</span></span>   | <span data-ttu-id="8748c-138">Detectar pacotes reproduzidos.</span><span class="sxs-lookup"><span data-stu-id="8748c-138">Detect replayed packets.</span></span>                                                                                                                                                                                       |
| <span data-ttu-id="8748c-139">**\_detecção de \_ sequência de req do ASC \_**</span><span class="sxs-lookup"><span data-stu-id="8748c-139">**ASC\_REQ\_SEQUENCE\_DETECT**</span></span> | <span data-ttu-id="8748c-140">Detecte mensagens recebidas fora de sequência.</span><span class="sxs-lookup"><span data-stu-id="8748c-140">Detect messages received out of sequence.</span></span>                                                                                                                                                                      |
| <span data-ttu-id="8748c-141">**\_fluxo de req. asc \_**</span><span class="sxs-lookup"><span data-stu-id="8748c-141">**ASC\_REQ\_STREAM**</span></span>           | <span data-ttu-id="8748c-142">Suporte a uma conexão orientada a fluxo.</span><span class="sxs-lookup"><span data-stu-id="8748c-142">Support a stream-oriented connection.</span></span>                                                                                                                                                                          |

<span data-ttu-id="8748c-143">Para possíveis sinalizadores de atributo e seus significados, consulte [requisitos de contexto](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="8748c-143">For possible attribute flags and their meanings, see [Context Requirements](context-requirements.md).</span></span> <span data-ttu-id="8748c-144">Os sinalizadores usados para esse parâmetro são prefixados com o ASC \_ req, por exemplo, o \_ delegado de req ASC \_ .</span><span class="sxs-lookup"><span data-stu-id="8748c-144">Flags used for this parameter are prefixed with ASC\_REQ, for example, ASC\_REQ\_DELEGATE.</span></span>

<span data-ttu-id="8748c-145">Os atributos solicitados podem não ter suporte do cliente.</span><span class="sxs-lookup"><span data-stu-id="8748c-145">The requested attributes may not be supported by the client.</span></span> <span data-ttu-id="8748c-146">Para obter mais informações, consulte o parâmetro *pfContextAttr* .</span><span class="sxs-lookup"><span data-stu-id="8748c-146">For more information, see the *pfContextAttr* parameter.</span></span>

<span data-ttu-id="8748c-147">*TargetDataRep* \[ no\]</span><span class="sxs-lookup"><span data-stu-id="8748c-147">*TargetDataRep* \[in\]</span></span>

<span data-ttu-id="8748c-148">A representação de dados, como ordenação de bytes, no destino.</span><span class="sxs-lookup"><span data-stu-id="8748c-148">The data representation, such as byte ordering, on the target.</span></span> <span data-ttu-id="8748c-149">Esse parâmetro pode ser **segurança \_ nativa \_ DREP** ou segurança de **\_ rede \_ DREP**.</span><span class="sxs-lookup"><span data-stu-id="8748c-149">This parameter can be either **SECURITY\_NATIVE\_DREP** or **SECURITY\_NETWORK\_DREP**.</span></span>

<span data-ttu-id="8748c-150">*phNewContext* \[ entrada, saída, opcional\]</span><span class="sxs-lookup"><span data-stu-id="8748c-150">*phNewContext* \[in, out, optional\]</span></span>

<span data-ttu-id="8748c-151">Um ponteiro para uma estrutura [CtxtHandle](sspi-handles.md) .</span><span class="sxs-lookup"><span data-stu-id="8748c-151">A pointer to a [CtxtHandle](sspi-handles.md) structure.</span></span> <span data-ttu-id="8748c-152">Na primeira chamada para **AcceptSecurityContext (CredSSP)**, esse ponteiro recebe o novo identificador de contexto.</span><span class="sxs-lookup"><span data-stu-id="8748c-152">On the first call to **AcceptSecurityContext (CredSSP)**, this pointer receives the new context handle.</span></span> <span data-ttu-id="8748c-153">Nas chamadas subsequentes, *phNewContext* pode ser o mesmo que o identificador especificado no parâmetro *phContext* .</span><span class="sxs-lookup"><span data-stu-id="8748c-153">On subsequent calls, *phNewContext* can be the same as the handle specified in the *phContext* parameter.</span></span>

<span data-ttu-id="8748c-154">*pOutput* \[ entrada, saída, opcional\]</span><span class="sxs-lookup"><span data-stu-id="8748c-154">*pOutput* \[in, out, optional\]</span></span>

<span data-ttu-id="8748c-155">Um ponteiro para uma estrutura [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) que contém o descritor de buffer de saída.</span><span class="sxs-lookup"><span data-stu-id="8748c-155">A pointer to a [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) structure that contains the output buffer descriptor.</span></span> <span data-ttu-id="8748c-156">Esse buffer é enviado ao cliente para entrada em chamadas adicionais para [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md).</span><span class="sxs-lookup"><span data-stu-id="8748c-156">This buffer is sent to the client for input into additional calls to [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md).</span></span> <span data-ttu-id="8748c-157">Um buffer de saída pode ser gerado mesmo que a função retorne s \_ E \_ OK.</span><span class="sxs-lookup"><span data-stu-id="8748c-157">An output buffer may be generated even if the function returns SEC\_E\_OK.</span></span> <span data-ttu-id="8748c-158">Qualquer buffer gerado deve ser enviado de volta para o aplicativo cliente.</span><span class="sxs-lookup"><span data-stu-id="8748c-158">Any buffer generated must be sent back to the client application.</span></span>

<span data-ttu-id="8748c-159">Na saída, esse buffer recebe um token para o contexto de segurança.</span><span class="sxs-lookup"><span data-stu-id="8748c-159">On output, this buffer receives a token for the security context.</span></span> <span data-ttu-id="8748c-160">O token deve ser enviado ao cliente.</span><span class="sxs-lookup"><span data-stu-id="8748c-160">The token must be sent to the client.</span></span> <span data-ttu-id="8748c-161">A função também pode retornar um buffer do tipo SECBUFFER \_ extra.</span><span class="sxs-lookup"><span data-stu-id="8748c-161">The function can also return a buffer of type SECBUFFER\_EXTRA.</span></span>

<span data-ttu-id="8748c-162">*pfContextAttr* \[ fora\]</span><span class="sxs-lookup"><span data-stu-id="8748c-162">*pfContextAttr* \[out\]</span></span>

<span data-ttu-id="8748c-163">Um ponteiro para um conjunto de sinalizadores de bit que indicam os atributos do contexto estabelecido.</span><span class="sxs-lookup"><span data-stu-id="8748c-163">A pointer to a set of bit flags that indicate the attributes of the established context.</span></span> <span data-ttu-id="8748c-164">Para obter uma descrição dos vários atributos, consulte [requisitos de contexto](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="8748c-164">For a description of the various attributes, see [Context Requirements](context-requirements.md).</span></span> <span data-ttu-id="8748c-165">Os sinalizadores usados para esse parâmetro são prefixados com ASC \_ RET, por exemplo, o delegado de ASC \_ RET \_ .</span><span class="sxs-lookup"><span data-stu-id="8748c-165">Flags used for this parameter are prefixed with ASC\_RET, for example, ASC\_RET\_DELEGATE.</span></span>

<span data-ttu-id="8748c-166">Não verifique os atributos relacionados à segurança até que a chamada de função final seja retornada com êxito.</span><span class="sxs-lookup"><span data-stu-id="8748c-166">Do not check for security-related attributes until the final function call returns successfully.</span></span> <span data-ttu-id="8748c-167">Os sinalizadores de atributo não relacionados à segurança, como o \_ \_ sinalizador de memória alocada de ASC RET \_ , podem ser verificados antes do retorno final.</span><span class="sxs-lookup"><span data-stu-id="8748c-167">Attribute flags not related to security, such as the ASC\_RET\_ALLOCATED\_MEMORY flag, can be checked before the final return.</span></span>

<span data-ttu-id="8748c-168">*ptsExpiry* \[ out, opcional\]</span><span class="sxs-lookup"><span data-stu-id="8748c-168">*ptsExpiry* \[out, optional\]</span></span>

<span data-ttu-id="8748c-169">Um ponteiro para uma estrutura de [**carimbo de data/**](timestamp.md) hora que recebe o tempo de expiração do contexto.</span><span class="sxs-lookup"><span data-stu-id="8748c-169">A pointer to a [**TimeStamp**](timestamp.md) structure that receives the expiration time of the context.</span></span> <span data-ttu-id="8748c-170">É recomendável que o pacote de segurança sempre retorne esse valor na hora local.</span><span class="sxs-lookup"><span data-stu-id="8748c-170">We recommend that the security package always return this value in local time.</span></span>

> [!Note]  
> <span data-ttu-id="8748c-171">Até a última chamada do processo de autenticação, o tempo de expiração do contexto pode estar incorreto, pois mais informações serão fornecidas durante os estágios posteriores da negociação.</span><span class="sxs-lookup"><span data-stu-id="8748c-171">Until the last call of the authentication process, the expiration time for the context can be incorrect because more information will be provided during later stages of the negotiation.</span></span> <span data-ttu-id="8748c-172">Portanto, *ptsTimeStamp* deve ser **nulo** até a última chamada para a função.</span><span class="sxs-lookup"><span data-stu-id="8748c-172">Therefore, *ptsTimeStamp* must be **NULL** until the last call to the function.</span></span>

## <a name="return-value"></a><span data-ttu-id="8748c-173">Retornar valor</span><span class="sxs-lookup"><span data-stu-id="8748c-173">Return value</span></span>

<span data-ttu-id="8748c-174">Essa função retorna um dos valores a seguir.</span><span class="sxs-lookup"><span data-stu-id="8748c-174">This function returns one of the following values.</span></span>

| <span data-ttu-id="8748c-175">Código/valor de retorno</span><span class="sxs-lookup"><span data-stu-id="8748c-175">Return code/value</span></span>                                   | <span data-ttu-id="8748c-176">Descrição</span><span class="sxs-lookup"><span data-stu-id="8748c-176">Description</span></span>                                                                                                                                                                 |
|-----------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="8748c-177">SEC_E_INCOMPLETE_MESSAGE</span><span class="sxs-lookup"><span data-stu-id="8748c-177">SEC_E_INCOMPLETE_MESSAGE</span></span> <br/> <span data-ttu-id="8748c-178">0x80090318L</span><span class="sxs-lookup"><span data-stu-id="8748c-178">0x80090318L</span></span>          | <span data-ttu-id="8748c-179">A função foi bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="8748c-179">The function succeeded.</span></span> <span data-ttu-id="8748c-180">Os dados no buffer de entrada estão incompletos.</span><span class="sxs-lookup"><span data-stu-id="8748c-180">The data in the input buffer is incomplete.</span></span> <span data-ttu-id="8748c-181">O aplicativo deve ler dados adicionais do cliente e chamar [<strong>AcceptSecurityContext (CredSSP)</strong>](acceptsecuritycontext--credssp.md) novamente.</span><span class="sxs-lookup"><span data-stu-id="8748c-181">The application must read additional data from the client and call [<strong>AcceptSecurityContext (CredSSP)</strong>](acceptsecuritycontext--credssp.md) again.</span></span> |
| <span data-ttu-id="8748c-182">SEC_E_INSUFFICIENT_MEMORY</span><span class="sxs-lookup"><span data-stu-id="8748c-182">SEC_E_INSUFFICIENT_MEMORY</span></span> <br/> <span data-ttu-id="8748c-183">0x80090300L</span><span class="sxs-lookup"><span data-stu-id="8748c-183">0x80090300L</span></span>         | <span data-ttu-id="8748c-184">A função falhou.</span><span class="sxs-lookup"><span data-stu-id="8748c-184">The function failed.</span></span> <span data-ttu-id="8748c-185">Não há memória suficiente disponível para concluir a ação solicitada.</span><span class="sxs-lookup"><span data-stu-id="8748c-185">There is not enough memory available to complete the requested action.</span></span>                                                                                 |
| <span data-ttu-id="8748c-186">SEC_E_INTERNAL_ERROR</span><span class="sxs-lookup"><span data-stu-id="8748c-186">SEC_E_INTERNAL_ERROR</span></span> <br/> <span data-ttu-id="8748c-187">0x80090304L</span><span class="sxs-lookup"><span data-stu-id="8748c-187">0x80090304L</span></span>              | <span data-ttu-id="8748c-188">A função falhou.</span><span class="sxs-lookup"><span data-stu-id="8748c-188">The function failed.</span></span> <span data-ttu-id="8748c-189">Ocorreu um erro que não foi mapeado para um código de erro SSPI.</span><span class="sxs-lookup"><span data-stu-id="8748c-189">An error occurred that did not map to an SSPI error code.</span></span>                                                                                              |
| <span data-ttu-id="8748c-190">SEC_E_INVALID_HANDLE</span><span class="sxs-lookup"><span data-stu-id="8748c-190">SEC_E_INVALID_HANDLE</span></span> <br/> <span data-ttu-id="8748c-191">0x80100003L</span><span class="sxs-lookup"><span data-stu-id="8748c-191">0x80100003L</span></span>              | <span data-ttu-id="8748c-192">A função falhou.</span><span class="sxs-lookup"><span data-stu-id="8748c-192">The function failed.</span></span> <span data-ttu-id="8748c-193">O identificador passado para a função não é válido.</span><span class="sxs-lookup"><span data-stu-id="8748c-193">The handle passed to the function is not valid.</span></span>                                                                                                        |
| <span data-ttu-id="8748c-194">SEC_E_INVALID_TOKEN</span><span class="sxs-lookup"><span data-stu-id="8748c-194">SEC_E_INVALID_TOKEN</span></span> <br/> <span data-ttu-id="8748c-195">0x80090308L</span><span class="sxs-lookup"><span data-stu-id="8748c-195">0x80090308L</span></span>               | <span data-ttu-id="8748c-196">A função falhou.</span><span class="sxs-lookup"><span data-stu-id="8748c-196">The function failed.</span></span> <span data-ttu-id="8748c-197">O token passado para a função não é válido.</span><span class="sxs-lookup"><span data-stu-id="8748c-197">The token passed to the function is not valid.</span></span>                                                                                                         |
| <span data-ttu-id="8748c-198">SEC_E_LOGON_DENIED</span><span class="sxs-lookup"><span data-stu-id="8748c-198">SEC_E_LOGON_DENIED</span></span> <br/> <span data-ttu-id="8748c-199">0x8009030CL</span><span class="sxs-lookup"><span data-stu-id="8748c-199">0x8009030CL</span></span>                | <span data-ttu-id="8748c-200">Falha no logon.</span><span class="sxs-lookup"><span data-stu-id="8748c-200">The logon failed.</span></span>                                                                                                                                                           |
| <span data-ttu-id="8748c-201">SEC_E_NO_AUTHENTICATING_AUTHORITY</span><span class="sxs-lookup"><span data-stu-id="8748c-201">SEC_E_NO_AUTHENTICATING_AUTHORITY</span></span> <br/> <span data-ttu-id="8748c-202">0x80090311L</span><span class="sxs-lookup"><span data-stu-id="8748c-202">0x80090311L</span></span> | <span data-ttu-id="8748c-203">A função falhou.</span><span class="sxs-lookup"><span data-stu-id="8748c-203">The function failed.</span></span> <span data-ttu-id="8748c-204">Nenhuma autoridade pode ser contatada para autenticação.</span><span class="sxs-lookup"><span data-stu-id="8748c-204">No authority could be contacted for authentication.</span></span> <span data-ttu-id="8748c-205">Isso pode ser devido às seguintes condições:</span><span class="sxs-lookup"><span data-stu-id="8748c-205">This could be due to the following conditions:</span></span><br/><ul><li><span data-ttu-id="8748c-206">O nome de domínio da parte de autenticação está incorreto.</span><span class="sxs-lookup"><span data-stu-id="8748c-206">The domain name of the authenticating party is incorrect.</span></span></li><li><span data-ttu-id="8748c-207">O domínio não está disponível.</span><span class="sxs-lookup"><span data-stu-id="8748c-207">The domain is unavailable.</span></span></li><li><span data-ttu-id="8748c-208">Falha na relação de confiança.</span><span class="sxs-lookup"><span data-stu-id="8748c-208">The trust relationship has failed.</span></span> |
| <span data-ttu-id="8748c-209">SEC_E_NO_CREDENTIALS</span><span class="sxs-lookup"><span data-stu-id="8748c-209">SEC_E_NO_CREDENTIALS</span></span> <br/><span data-ttu-id="8748c-210">0x8009030EL</span><span class="sxs-lookup"><span data-stu-id="8748c-210">0x8009030EL</span></span>               | <span data-ttu-id="8748c-211">A função falhou.</span><span class="sxs-lookup"><span data-stu-id="8748c-211">The function failed.</span></span> <span data-ttu-id="8748c-212">O identificador de credenciais especificado no parâmetro *phCredential* não é válido.</span><span class="sxs-lookup"><span data-stu-id="8748c-212">The credentials handle specified in the *phCredential* parameter is not valid.</span></span>                            |
| <span data-ttu-id="8748c-213">SEC_E_OK</span><span class="sxs-lookup"><span data-stu-id="8748c-213">SEC_E_OK</span></span> <br/> <span data-ttu-id="8748c-214">0x00000000l</span><span class="sxs-lookup"><span data-stu-id="8748c-214">0x00000000L</span></span>                          | <span data-ttu-id="8748c-215">A função foi bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="8748c-215">The function succeeded.</span></span> <span data-ttu-id="8748c-216">O contexto de segurança recebido do cliente foi aceito.</span><span class="sxs-lookup"><span data-stu-id="8748c-216">The security context received from the client was accepted.</span></span> <span data-ttu-id="8748c-217">Se a função gerou um token de saída, o token deve ser enviado ao processo do cliente.</span><span class="sxs-lookup"><span data-stu-id="8748c-217">If the function generated an output token, the token must be sent to the client process.</span></span> |
| <span data-ttu-id="8748c-218">SEC_E_UNSUPPORTED_FUNCTION</span><span class="sxs-lookup"><span data-stu-id="8748c-218">SEC_E_UNSUPPORTED_FUNCTION</span></span> <br/> <span data-ttu-id="8748c-219">0x80090302L</span><span class="sxs-lookup"><span data-stu-id="8748c-219">0x80090302L</span></span>        | <span data-ttu-id="8748c-220">A função falhou.</span><span class="sxs-lookup"><span data-stu-id="8748c-220">The function failed.</span></span> <span data-ttu-id="8748c-221">O parâmetro *fContextReq* especificou um sinalizador de atributo de contexto (ASC_REQ_DELEGATE ou ASC_REQ_PROMPT_FOR_CREDS) que não era válido.</span><span class="sxs-lookup"><span data-stu-id="8748c-221">The *fContextReq* parameter specified a context attribute flag (ASC_REQ_DELEGATE or ASC_REQ_PROMPT_FOR_CREDS) that was not valid.</span></span>                       |
| <span data-ttu-id="8748c-222">SEC_I_COMPLETE_AND_CONTINUE</span><span class="sxs-lookup"><span data-stu-id="8748c-222">SEC_I_COMPLETE_AND_CONTINUE</span></span> <br/> <span data-ttu-id="8748c-223">0x00090314L</span><span class="sxs-lookup"><span data-stu-id="8748c-223">0x00090314L</span></span>       | <span data-ttu-id="8748c-224">A função foi bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="8748c-224">The function succeeded.</span></span> <span data-ttu-id="8748c-225">O servidor deve chamar [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) e passar o token de saída para o cliente.</span><span class="sxs-lookup"><span data-stu-id="8748c-225">The server must call [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) and pass the output token to the client.</span></span> <span data-ttu-id="8748c-226">O servidor deve aguardar um token de retorno do cliente antes de fazer outra chamada para [**AcceptSecurityContext (CredSSP)**](acceptsecuritycontext--credssp.md).</span><span class="sxs-lookup"><span data-stu-id="8748c-226">The server must then wait for a return token from the client before making another call to [**AcceptSecurityContext (CredSSP)**](acceptsecuritycontext--credssp.md).</span></span> |
| <span data-ttu-id="8748c-227">SEC_I_COMPLETE_NEEDED</span><span class="sxs-lookup"><span data-stu-id="8748c-227">SEC_I_COMPLETE_NEEDED</span></span> <br/> <span data-ttu-id="8748c-228">0x00090313L</span><span class="sxs-lookup"><span data-stu-id="8748c-228">0x00090313L</span></span>             | <span data-ttu-id="8748c-229">A função foi bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="8748c-229">The function succeeded.</span></span> <span data-ttu-id="8748c-230">O servidor deve concluir a compilação da mensagem do cliente antes de chamar [ **CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken)</span><span class="sxs-lookup"><span data-stu-id="8748c-230">The server must finish building the message from the client before calling [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken)</span></span>                             |
| <span data-ttu-id="8748c-231">SEC_I_CONTINUE_NEEDED</span><span class="sxs-lookup"><span data-stu-id="8748c-231">SEC_I_CONTINUE_NEEDED</span></span> <br/> <span data-ttu-id="8748c-232">0x00090312L</span><span class="sxs-lookup"><span data-stu-id="8748c-232">0x00090312L</span></span>             | <span data-ttu-id="8748c-233">A função foi bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="8748c-233">The function succeeded.</span></span> <span data-ttu-id="8748c-234">O servidor deve enviar o token de saída para o cliente e aguardar um token retornado.</span><span class="sxs-lookup"><span data-stu-id="8748c-234">The server must send the output token to the client and wait for a returned token.</span></span> <span data-ttu-id="8748c-235">O token retornado deve ser passado em *pInput* para outra chamada para [**AcceptSecurityContext (CredSSP)**](acceptsecuritycontext--credssp.md).</span><span class="sxs-lookup"><span data-stu-id="8748c-235">The returned token should be passed in *pInput* for another call to [**AcceptSecurityContext (CredSSP)**](acceptsecuritycontext--credssp.md).</span></span>


## <a name="remarks"></a><span data-ttu-id="8748c-236">Comentários</span><span class="sxs-lookup"><span data-stu-id="8748c-236">Remarks</span></span>

<span data-ttu-id="8748c-237">A função **AcceptSecurityContext (CredSSP)** é a contraparte do servidor para a função [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md) .</span><span class="sxs-lookup"><span data-stu-id="8748c-237">The **AcceptSecurityContext (CredSSP)** function is the server counterpart to the [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md) function.</span></span>

<span data-ttu-id="8748c-238">Quando o servidor recebe uma solicitação de um cliente, ele usa o parâmetro *fContextReq* para especificar o que é necessário para a sessão.</span><span class="sxs-lookup"><span data-stu-id="8748c-238">When the server receives a request from a client, it uses the *fContextReq* parameter to specify what it requires of the session.</span></span> <span data-ttu-id="8748c-239">Dessa maneira, um servidor pode exigir que os clientes sejam capazes de usar uma sessão confidencial ou com verificação de [*integridade*](../secgloss/i-gly.md); Ele pode rejeitar clientes que não atendem a essa demanda.</span><span class="sxs-lookup"><span data-stu-id="8748c-239">In this fashion, a server can require that clients be capable of using a confidential or [*integrity*](../secgloss/i-gly.md)-checked session; it can reject clients that cannot meet that demand.</span></span> <span data-ttu-id="8748c-240">Como alternativa, um servidor pode não exigir nada; o que o cliente requer ou pode fornecer é retornado no parâmetro *pfContextAttr* .</span><span class="sxs-lookup"><span data-stu-id="8748c-240">Alternatively, a server can require nothing; whatever the client requires or can provide is returned in the *pfContextAttr* parameter.</span></span>

<span data-ttu-id="8748c-241">Os parâmetros *fContextReq* e *pfContextAttr* são bitmasks que representam vários atributos de contexto.</span><span class="sxs-lookup"><span data-stu-id="8748c-241">The *fContextReq* and *pfContextAttr* parameters are bitmasks that represent various context attributes.</span></span> <span data-ttu-id="8748c-242">Para obter uma descrição dos vários atributos, consulte [requisitos de contexto](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="8748c-242">For a description of the various attributes, see [Context Requirements](context-requirements.md).</span></span>

> [!Note]  
> <span data-ttu-id="8748c-243">Embora o parâmetro *pfContextAttr* seja válido em qualquer retorno bem-sucedido, você deve examinar os sinalizadores referentes aos aspectos de segurança do contexto somente no retorno bem-sucedido final.</span><span class="sxs-lookup"><span data-stu-id="8748c-243">While the *pfContextAttr* parameter is valid on any successful return, you should examine the flags pertaining to security aspects of the context only on the final successful return.</span></span> <span data-ttu-id="8748c-244">Os retornos intermediários podem definir, por exemplo, o \_ \_ sinalizador de memória alocada do ISC RET \_ .</span><span class="sxs-lookup"><span data-stu-id="8748c-244">Intermediate returns can set, for example, the ISC\_RET\_ALLOCATED\_MEMORY flag.</span></span>

<span data-ttu-id="8748c-245">O chamador é responsável por determinar se os atributos de contexto final são suficientes.</span><span class="sxs-lookup"><span data-stu-id="8748c-245">The caller is responsible for determining whether the final context attributes are sufficient.</span></span> <span data-ttu-id="8748c-246">Por exemplo, se a confidencialidade (criptografia) foi solicitada, mas não pôde ser estabelecida, alguns aplicativos podem optar por desligar a conexão imediatamente.</span><span class="sxs-lookup"><span data-stu-id="8748c-246">For example, if confidentiality (encryption) was requested but could not be established, some applications may choose to shut down the connection immediately.</span></span> <span data-ttu-id="8748c-247">Se o contexto de segurança não puder ser estabelecido, o servidor deverá liberar o contexto parcialmente criado chamando a função [**DeleteSecurityContext**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) .</span><span class="sxs-lookup"><span data-stu-id="8748c-247">If the security context cannot be established, the server must free the partially created context by calling the [**DeleteSecurityContext**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) function.</span></span> <span data-ttu-id="8748c-248">Para obter informações sobre quando chamar a função **DeleteSecurityContext** , consulte **DeleteSecurityContext**.</span><span class="sxs-lookup"><span data-stu-id="8748c-248">For information about when to call the **DeleteSecurityContext** function, see **DeleteSecurityContext**.</span></span>

<span data-ttu-id="8748c-249">Depois que o contexto de segurança tiver sido estabelecido, o aplicativo de servidor poderá usar a função [**QuerySecurityContextToken**](/windows/win32/api/sspi/nf-sspi-querysecuritycontexttoken) para recuperar um identificador para a conta de usuário para a qual o certificado de cliente foi mapeado.</span><span class="sxs-lookup"><span data-stu-id="8748c-249">After the security context has been established, the server application can use the [**QuerySecurityContextToken**](/windows/win32/api/sspi/nf-sspi-querysecuritycontexttoken) function to retrieve a handle to the user account to which the client certificate was mapped.</span></span> <span data-ttu-id="8748c-250">Além disso, o servidor pode usar a função [**ImpersonateSecurityContext**](/windows/win32/api/sspi/nf-sspi-impersonatesecuritycontext) para representar o usuário.</span><span class="sxs-lookup"><span data-stu-id="8748c-250">Also, the server can use the [**ImpersonateSecurityContext**](/windows/win32/api/sspi/nf-sspi-impersonatesecuritycontext) function to impersonate the user.</span></span>

## <a name="requirements"></a><span data-ttu-id="8748c-251">Requisitos</span><span class="sxs-lookup"><span data-stu-id="8748c-251">Requirements</span></span>

| <span data-ttu-id="8748c-252">Requisito</span><span class="sxs-lookup"><span data-stu-id="8748c-252">Requirement</span></span> | <span data-ttu-id="8748c-253">Valor</span><span class="sxs-lookup"><span data-stu-id="8748c-253">Value</span></span> |
|--------------------------|-------------------------------------------|
| <span data-ttu-id="8748c-254">Cliente mínimo com suporte</span><span class="sxs-lookup"><span data-stu-id="8748c-254">Minimum supported client</span></span> | <span data-ttu-id="8748c-255">\[Somente aplicativos da área de trabalho do Windows Vista\]</span><span class="sxs-lookup"><span data-stu-id="8748c-255">Windows�Vista \[desktop apps only\]</span></span>       |
| <span data-ttu-id="8748c-256">Servidor mínimo com suporte</span><span class="sxs-lookup"><span data-stu-id="8748c-256">Minimum supported server</span></span> | <span data-ttu-id="8748c-257">\[Somente aplicativos da área de trabalho do Windows Server 2008\]</span><span class="sxs-lookup"><span data-stu-id="8748c-257">Windows Server�2008 \[desktop apps only\]</span></span> |
| <span data-ttu-id="8748c-258">parâmetro</span><span class="sxs-lookup"><span data-stu-id="8748c-258">Header</span></span>                   | <span data-ttu-id="8748c-259">SSPI. h (incluir Security. h)</span><span class="sxs-lookup"><span data-stu-id="8748c-259">Sspi.h (include Security.h)</span></span>               |
| <span data-ttu-id="8748c-260">Biblioteca</span><span class="sxs-lookup"><span data-stu-id="8748c-260">Library</span></span>                  | <span data-ttu-id="8748c-261">Secur32. lib</span><span class="sxs-lookup"><span data-stu-id="8748c-261">Secur32.lib</span></span>                               |
| <span data-ttu-id="8748c-262">DLL</span><span class="sxs-lookup"><span data-stu-id="8748c-262">DLL</span></span>                      | <span data-ttu-id="8748c-263">Secur32.dll</span><span class="sxs-lookup"><span data-stu-id="8748c-263">Secur32.dll</span></span>                               |

## <a name="see-also"></a><span data-ttu-id="8748c-264">Confira também</span><span class="sxs-lookup"><span data-stu-id="8748c-264">See also</span></span>

- [<span data-ttu-id="8748c-265">Funções SSPI</span><span class="sxs-lookup"><span data-stu-id="8748c-265">SSPI Functions</span></span>](authentication-functions.md#sspi-functions)
- [<span data-ttu-id="8748c-266">**DeleteSecurityContext**</span><span class="sxs-lookup"><span data-stu-id="8748c-266">**DeleteSecurityContext**</span></span>](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext)
- [<span data-ttu-id="8748c-267">**InitializeSecurityContext (CredSSP)**</span><span class="sxs-lookup"><span data-stu-id="8748c-267">**InitializeSecurityContext (CredSSP)**</span></span>](initializesecuritycontext--credssp.md)
