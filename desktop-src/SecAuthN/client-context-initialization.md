---
description: Inicialização do contexto do cliente
ms.assetid: 0c8aad3e-e726-49ce-8fc9-94dbd60cc5cb
title: Inicialização do contexto do cliente
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 615ce5c157371f1ebfec685d6227bd11a1d76531
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104091328"
---
# <a name="client-context-initialization"></a><span data-ttu-id="87e44-103">Inicialização do contexto do cliente</span><span class="sxs-lookup"><span data-stu-id="87e44-103">Client Context Initialization</span></span>

<span data-ttu-id="87e44-104">Para estabelecer uma conexão segura, o cliente adquire um identificador de [*credenciais*](/windows/desktop/SecGloss/c-gly) de saída antes de enviar uma solicitação de autenticação para o servidor.</span><span class="sxs-lookup"><span data-stu-id="87e44-104">To establish a secure connection, the client acquires an outbound [*credentials*](/windows/desktop/SecGloss/c-gly) handle before sending an authentication request to the server.</span></span> <span data-ttu-id="87e44-105">O servidor cria um contexto de segurança para o cliente a partir da solicitação de autenticação.</span><span class="sxs-lookup"><span data-stu-id="87e44-105">The server creates a security context for the client from the authentication request.</span></span> <span data-ttu-id="87e44-106">Há duas funções SSPI do lado do cliente envolvidas na configuração de autenticação:</span><span class="sxs-lookup"><span data-stu-id="87e44-106">There are two client-side SSPI functions involved in authentication setup:</span></span>

-   <span data-ttu-id="87e44-107">[**Falha AcquireCredentialsHandle**](/windows/win32/api/sspi/nf-sspi-acquirecredentialshandlea) Obtém uma referência às [*credenciais*](/windows/desktop/SecGloss/c-gly)de logon obtidas anteriormente.</span><span class="sxs-lookup"><span data-stu-id="87e44-107">[**AcquireCredentialsHandle**](/windows/win32/api/sspi/nf-sspi-acquirecredentialshandlea) obtains a reference to previously obtained logon [*credentials*](/windows/desktop/SecGloss/c-gly).</span></span>
-   <span data-ttu-id="87e44-108">[**InitializeSecurityContext (geral)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) cria os tokens de segurança de solicitação de autenticação inicial.</span><span class="sxs-lookup"><span data-stu-id="87e44-108">[**InitializeSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) creates the initial authentication request security tokens.</span></span>

<span data-ttu-id="87e44-109">O código para esse processo pode ser visto na função **GenClientContext** no [uso de SSPI com um cliente do Windows Sockets](using-sspi-with-a-windows-sockets-client.md).</span><span class="sxs-lookup"><span data-stu-id="87e44-109">Code for this process can be seen in the **GenClientContext** function in [Using SSPI with a Windows Sockets Client](using-sspi-with-a-windows-sockets-client.md).</span></span>

<span data-ttu-id="87e44-110">Se um programa cliente precisar usar credenciais além de suas próprias credenciais de logon, como um nome de usuário diferente, um nome de domínio e uma senha, ele as fornecerá na chamada [**falha AcquireCredentialsHandle**](/windows/win32/api/sspi/nf-sspi-acquirecredentialshandlea) com uma estrutura de [**\_ \_ \_ identidade de autenticação WinNT SEC**](/windows/win32/api/sspi/ns-sspi-sec_winnt_auth_identity_a) especificando as credenciais adicionais.</span><span class="sxs-lookup"><span data-stu-id="87e44-110">If a client program needs to use credentials in addition to its own logon credentials, such as a different user name, domain name, and password, it provides them in the [**AcquireCredentialsHandle**](/windows/win32/api/sspi/nf-sspi-acquirecredentialshandlea) call with a [**SEC\_WINNT\_AUTH\_IDENTITY**](/windows/win32/api/sspi/ns-sspi-sec_winnt_auth_identity_a) structure specifying the additional credentials.</span></span> <span data-ttu-id="87e44-111">Para obter mais informações sobre as funções de credenciais, consulte [Gerenciamento de credenciais](authentication-functions.md).</span><span class="sxs-lookup"><span data-stu-id="87e44-111">For more information on credentials functions, see [Credential Management](authentication-functions.md).</span></span>

> [!Note]  
> <span data-ttu-id="87e44-112">O membro **flags** da estrutura [**de \_ \_ \_ identidade de autenticação do Winnt da SEC**](/windows/win32/api/sspi/ns-sspi-sec_winnt_auth_identity_a) pode ser definido como SEC de identidade de autenticação do \_ WinNT \_ \_ \_ ANSI quando as cadeias de caracteres na estrutura são asci ou OEM.</span><span class="sxs-lookup"><span data-stu-id="87e44-112">The **Flags** member of the [**SEC\_WINNT\_AUTH\_IDENTITY**](/windows/win32/api/sspi/ns-sspi-sec_winnt_auth_identity_a) structure can be set to SEC\_WINNT\_AUTH\_IDENTITY\_ANSI when strings in the structure are ASCI or OEM.</span></span> <span data-ttu-id="87e44-113">As cadeias de caracteres ANSI podem ser usadas com o membro **flags** da estrutura de identidade de autenticação do Winnt da SEC definida como SEC identidade de autenticação do **\_ \_ \_** \_ WinNT \_ \_ \_ Unicode, se elas forem convertidas primeiro em [*Unicode*](/windows/desktop/SecGloss/u-gly) usando a função [**MultiByteToWideChar**](/windows/desktop/api/stringapiset/nf-stringapiset-multibytetowidechar) .</span><span class="sxs-lookup"><span data-stu-id="87e44-113">ANSI strings can be used with the **Flags** member of the **SEC\_WINNT\_AUTH\_IDENTITY** structure set to SEC\_WINNT\_AUTH\_IDENTITY\_UNICODE if they are first converted to [*Unicode*](/windows/desktop/SecGloss/u-gly) by using the [**MultiByteToWideChar**](/windows/desktop/api/stringapiset/nf-stringapiset-multibytetowidechar) function.</span></span>

 

<span data-ttu-id="87e44-114">Para iniciar o primeiro segmento da autenticação, o cliente chama [**InitializeSecurityContext (geral)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) para obter um token de segurança inicial a ser enviado em uma mensagem de solicitação de conexão para o servidor.</span><span class="sxs-lookup"><span data-stu-id="87e44-114">To initiate the first leg of the authentication, the client calls [**InitializeSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) to obtain an initial security token to be sent in a connection request message to the server.</span></span>

<span data-ttu-id="87e44-115">O cliente usa as informações de token de segurança recebidas no descritor de buffer de saída para gerar uma mensagem a ser enviada ao servidor.</span><span class="sxs-lookup"><span data-stu-id="87e44-115">The client uses the security token information received in the output buffer descriptor to generate a message to send to the server.</span></span> <span data-ttu-id="87e44-116">A construção da mensagem, em termos de posicionamento de vários buffers e assim por diante, faz parte do [*protocolo de aplicativo*](/windows/desktop/SecGloss/a-gly) e deve ser compreendida por ambas as partes.</span><span class="sxs-lookup"><span data-stu-id="87e44-116">The construction of the message, in terms of placement of various buffers and so forth, is part of the [*application protocol*](/windows/desktop/SecGloss/a-gly) and must be understood by both parties.</span></span>

<span data-ttu-id="87e44-117">O cliente verifica o status de retorno de [**InitializeSecurityContext (geral)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) para ver se a autenticação será concluída em uma única chamada.</span><span class="sxs-lookup"><span data-stu-id="87e44-117">The client checks the return status from [**InitializeSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) to see if authentication will complete in a single call.</span></span> <span data-ttu-id="87e44-118">Um status de retorno de s \_ I \_ continue \_ necessário indica que o protocolo de segurança requer várias mensagens de autenticação.</span><span class="sxs-lookup"><span data-stu-id="87e44-118">A return status of SEC\_I\_CONTINUE\_NEEDED indicates that the security protocol requires multiple authentication messages.</span></span> <span data-ttu-id="87e44-119">Para obter mais informações sobre funções de contexto, consulte [Gerenciamento de contexto](authentication-functions.md).</span><span class="sxs-lookup"><span data-stu-id="87e44-119">For more information on context functions, see [Context Management](authentication-functions.md).</span></span>

 

 
