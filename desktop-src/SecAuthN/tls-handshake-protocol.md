---
description: O protocolo de handshake de TLS é responsável pela autenticação e troca de chaves necessárias para estabelecer ou retomar as sessões seguras.
ms.assetid: 65fb4db3-e505-457a-9159-dba0b506ea0b
title: Protocolo de handshake TLS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e0c7cfa9e9db54a6035abe147ce00bbde59bcc86
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "105748410"
---
# <a name="tls-handshake-protocol"></a><span data-ttu-id="12dfa-103">Protocolo de handshake TLS</span><span class="sxs-lookup"><span data-stu-id="12dfa-103">TLS Handshake Protocol</span></span>

<span data-ttu-id="12dfa-104">O [*protocolo de handshake de TLS*](../secgloss/t-gly.md) é responsável pela autenticação e troca de chaves necessárias para estabelecer ou retomar as sessões seguras.</span><span class="sxs-lookup"><span data-stu-id="12dfa-104">The [*Transport Layer Security*](../secgloss/t-gly.md) (TLS) Handshake Protocol is responsible for the authentication and key exchange necessary to establish or resume secure sessions.</span></span> <span data-ttu-id="12dfa-105">Ao estabelecer uma [*sessão*](../secgloss/s-gly.md)segura, o protocolo de handshake gerencia o seguinte:</span><span class="sxs-lookup"><span data-stu-id="12dfa-105">When establishing a secure [*session*](../secgloss/s-gly.md), the Handshake Protocol manages the following:</span></span>

-   <span data-ttu-id="12dfa-106">Negociação do conjunto de codificação</span><span class="sxs-lookup"><span data-stu-id="12dfa-106">Cipher suite negotiation</span></span>
-   <span data-ttu-id="12dfa-107">Autenticação do servidor e, opcionalmente, o cliente</span><span class="sxs-lookup"><span data-stu-id="12dfa-107">Authentication of the server and optionally, the client</span></span>
-   <span data-ttu-id="12dfa-108">Troca de informações de chave de sessão.</span><span class="sxs-lookup"><span data-stu-id="12dfa-108">Session key information exchange.</span></span>

## <a name="cipher-suite-negotiation"></a><span data-ttu-id="12dfa-109">Negociação do conjunto de codificação</span><span class="sxs-lookup"><span data-stu-id="12dfa-109">Cipher Suite Negotiation</span></span>

<span data-ttu-id="12dfa-110">O cliente e o servidor fazem contato e escolhem o pacote de codificação que será usado em toda a troca de mensagens.</span><span class="sxs-lookup"><span data-stu-id="12dfa-110">The client and server make contact and choose the cipher suite that will be used throughout their message exchange.</span></span>

## <a name="authentication"></a><span data-ttu-id="12dfa-111">Autenticação</span><span class="sxs-lookup"><span data-stu-id="12dfa-111">Authentication</span></span>

<span data-ttu-id="12dfa-112">No TLS, um servidor comprova sua identidade para o cliente.</span><span class="sxs-lookup"><span data-stu-id="12dfa-112">In TLS, a server proves its identity to the client.</span></span> <span data-ttu-id="12dfa-113">O cliente também pode precisar provar sua identidade para o servidor.</span><span class="sxs-lookup"><span data-stu-id="12dfa-113">The client might also need to prove its identity to the server.</span></span> <span data-ttu-id="12dfa-114">A PKI, o uso de [*pares de chaves pública/privada*](../secgloss/p-gly.md), é a base dessa autenticação.</span><span class="sxs-lookup"><span data-stu-id="12dfa-114">PKI, the use of [*public/private key pairs*](../secgloss/p-gly.md), is the basis of this authentication.</span></span> <span data-ttu-id="12dfa-115">O método exato usado para autenticação é determinado pelo conjunto de codificação negociado.</span><span class="sxs-lookup"><span data-stu-id="12dfa-115">The exact method used for authentication is determined by the cipher suite negotiated.</span></span>

## <a name="key-exchange"></a><span data-ttu-id="12dfa-116">Troca de chaves</span><span class="sxs-lookup"><span data-stu-id="12dfa-116">Key Exchange</span></span>

<span data-ttu-id="12dfa-117">O cliente e o servidor trocam números aleatórios e um número especial chamado de segredo pré-mestre.</span><span class="sxs-lookup"><span data-stu-id="12dfa-117">The client and server exchange random numbers and a special number called the Pre-Master Secret.</span></span> <span data-ttu-id="12dfa-118">Esses números são combinados com dados adicionais, permitindo que o cliente e o servidor criem seu segredo compartilhado, chamado de segredo mestre.</span><span class="sxs-lookup"><span data-stu-id="12dfa-118">These numbers are combined with additional data permitting client and server to create their shared secret, called the Master Secret.</span></span> <span data-ttu-id="12dfa-119">O segredo mestre é usado pelo cliente e pelo servidor para gerar o segredo de gravação de MAC, que é a chave de sessão usada para [*hash*](../secgloss/h-gly.md)e a chave de gravação, que é a [*chave de sessão*](../secgloss/s-gly.md) usada para criptografia.</span><span class="sxs-lookup"><span data-stu-id="12dfa-119">The Master Secret is used by client and server to generate the write MAC secret, which is the session key used for [*hashing*](../secgloss/h-gly.md), and the write key, which is the [*session key*](../secgloss/s-gly.md) used for encryption.</span></span>

## <a name="establishing-a-secure-session-by-using-tls"></a><span data-ttu-id="12dfa-120">Estabelecendo uma sessão segura usando TLS</span><span class="sxs-lookup"><span data-stu-id="12dfa-120">Establishing a Secure Session by Using TLS</span></span>

<span data-ttu-id="12dfa-121">O protocolo de handshake TLS envolve as seguintes etapas:</span><span class="sxs-lookup"><span data-stu-id="12dfa-121">The TLS Handshake Protocol involves the following steps:</span></span>

1.  <span data-ttu-id="12dfa-122">O cliente envia uma mensagem de "saudação do cliente" para o servidor, juntamente com o valor aleatório do cliente e os conjuntos de criptografia com suporte.</span><span class="sxs-lookup"><span data-stu-id="12dfa-122">The client sends a "Client hello" message to the server, along with the client's random value and supported cipher suites.</span></span>
2.  <span data-ttu-id="12dfa-123">O servidor responde enviando uma mensagem de "servidor Hello" para o cliente, juntamente com o valor aleatório do servidor.</span><span class="sxs-lookup"><span data-stu-id="12dfa-123">The server responds by sending a "Server hello" message to the client, along with the server's random value.</span></span>
3.  <span data-ttu-id="12dfa-124">O servidor envia seu certificado ao cliente para autenticação e pode solicitar um certificado do cliente.</span><span class="sxs-lookup"><span data-stu-id="12dfa-124">The server sends its certificate to the client for authentication and may request a certificate from the client.</span></span> <span data-ttu-id="12dfa-125">O servidor envia a mensagem "Olá do servidor".</span><span class="sxs-lookup"><span data-stu-id="12dfa-125">The server sends the "Server hello done" message.</span></span>
4.  <span data-ttu-id="12dfa-126">Se o servidor tiver solicitado um certificado do cliente, o cliente o enviará.</span><span class="sxs-lookup"><span data-stu-id="12dfa-126">If the server has requested a certificate from the client, the client sends it.</span></span>
5.  <span data-ttu-id="12dfa-127">O cliente cria um segredo de pre-mestre aleatório e o criptografa com a [*chave pública*](../secgloss/p-gly.md) do certificado do servidor, enviando o segredo de pré-mestre criptografado para o servidor.</span><span class="sxs-lookup"><span data-stu-id="12dfa-127">The client creates a random Pre-Master Secret and encrypts it with the [*public key*](../secgloss/p-gly.md) from the server's certificate, sending the encrypted Pre-Master Secret to the server.</span></span>
6.  <span data-ttu-id="12dfa-128">O servidor recebe o segredo pré-mestre.</span><span class="sxs-lookup"><span data-stu-id="12dfa-128">The server receives the Pre-Master Secret.</span></span> <span data-ttu-id="12dfa-129">O servidor e o cliente geram o segredo mestre e [*as chaves de sessão*](../secgloss/s-gly.md) com base no segredo de pré-mestre.</span><span class="sxs-lookup"><span data-stu-id="12dfa-129">The server and client each generate the Master Secret and [*session keys*](../secgloss/s-gly.md) based on the Pre-Master Secret.</span></span>
7.  <span data-ttu-id="12dfa-130">O cliente envia a notificação "alterar especificação de codificação" para o servidor para indicar que o cliente começará a usar as novas [*chaves de sessão*](../secgloss/s-gly.md) para [*hash*](../secgloss/h-gly.md) e criptografia de mensagens.</span><span class="sxs-lookup"><span data-stu-id="12dfa-130">The client sends "Change cipher spec" notification to server to indicate that the client will start using the new [*session keys*](../secgloss/s-gly.md) for [*hashing*](../secgloss/h-gly.md) and encrypting messages.</span></span> <span data-ttu-id="12dfa-131">O cliente também envia a mensagem "cliente concluído".</span><span class="sxs-lookup"><span data-stu-id="12dfa-131">Client also sends "Client finished" message.</span></span>
8.  <span data-ttu-id="12dfa-132">O servidor recebe "alterar especificação de codificação" e alterna seu estado de segurança da camada de registro para [*criptografia simétrica*](../secgloss/s-gly.md) usando as [*chaves de sessão*](../secgloss/s-gly.md).</span><span class="sxs-lookup"><span data-stu-id="12dfa-132">Server receives "Change cipher spec" and switches its record layer security state to [*symmetric encryption*](../secgloss/s-gly.md) using the [*session keys*](../secgloss/s-gly.md).</span></span> <span data-ttu-id="12dfa-133">O servidor envia a mensagem "servidor concluído" ao cliente.</span><span class="sxs-lookup"><span data-stu-id="12dfa-133">Server sends "Server finished" message to the client.</span></span>
9.  <span data-ttu-id="12dfa-134">O cliente e o servidor agora podem trocar dados de aplicativo pelo canal protegido que eles estabeleceram.</span><span class="sxs-lookup"><span data-stu-id="12dfa-134">Client and server can now exchange application data over the secured channel they have established.</span></span> <span data-ttu-id="12dfa-135">Todas as mensagens enviadas do cliente para o servidor e do servidor para o cliente são criptografadas usando a chave de sessão.</span><span class="sxs-lookup"><span data-stu-id="12dfa-135">All messages sent from client to server and from server to client are encrypted using session key.</span></span>

## <a name="resuming-a-secure-session-by-using-tls"></a><span data-ttu-id="12dfa-136">Retomando uma sessão segura usando TLS</span><span class="sxs-lookup"><span data-stu-id="12dfa-136">Resuming a Secure Session by Using TLS</span></span>

1.  <span data-ttu-id="12dfa-137">O cliente envia uma mensagem "Olá ao cliente" usando a ID de sessão da sessão a ser retomada.</span><span class="sxs-lookup"><span data-stu-id="12dfa-137">The client sends a "Client hello" message using the Session ID of the session to be resumed.</span></span>
2.  <span data-ttu-id="12dfa-138">O servidor verifica o cache da sessão em busca de uma ID de sessão correspondente.</span><span class="sxs-lookup"><span data-stu-id="12dfa-138">The server checks its session cache for a matching Session ID.</span></span> <span data-ttu-id="12dfa-139">Se uma correspondência for encontrada e o servidor for capaz de retomar a sessão, ele enviará uma mensagem de "servidor Hello" com a ID de sessão.</span><span class="sxs-lookup"><span data-stu-id="12dfa-139">If a match is found, and the server is able to resume the session, it sends a "Server hello" message with the Session ID.</span></span>
    > [!Note]  
    > <span data-ttu-id="12dfa-140">Se uma correspondência de ID de sessão não for encontrada, o servidor gerará uma nova ID de sessão e o cliente TLS e o servidor executarão um handshake completo.</span><span class="sxs-lookup"><span data-stu-id="12dfa-140">If a session ID match is not found, the server generates a new session ID and the TLS client and server perform a full handshake.</span></span>

     

3.  <span data-ttu-id="12dfa-141">O cliente e o servidor devem trocar mensagens "alterar especificação de codificação" e enviar mensagens "cliente concluído" e "servidor concluído".</span><span class="sxs-lookup"><span data-stu-id="12dfa-141">Client and server must exchange "Change cipher spec" messages and send "Client finished" and "Server finished" messages.</span></span>
4.  <span data-ttu-id="12dfa-142">O cliente e o servidor agora podem retomar a troca de dados do aplicativo pelo canal seguro.</span><span class="sxs-lookup"><span data-stu-id="12dfa-142">Client and server can now resume application data exchange over the secure channel.</span></span>

 

 
