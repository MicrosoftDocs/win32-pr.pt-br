---
description: Criptografa uma mensagem para fornecer privacidade.
ms.assetid: 2e09f262-9c3e-4db2-9285-017f5e1810c7
title: Função EncryptMessage (geral) (SSPI. h)
ms.topic: reference
ms.date: 07/25/2019
ms.openlocfilehash: 3c661f5f529700db19683966783c1aa0793e376b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105814601"
---
# <a name="encryptmessage-general-function"></a><span data-ttu-id="0b6f5-103">Função EncryptMessage (geral)</span><span class="sxs-lookup"><span data-stu-id="0b6f5-103">EncryptMessage (General) function</span></span>

<span data-ttu-id="0b6f5-104">A função **EncryptMessage (geral)** criptografa uma mensagem para fornecer [*privacidade*](../secgloss/p-gly.md).</span><span class="sxs-lookup"><span data-stu-id="0b6f5-104">The **EncryptMessage (General)** function encrypts a message to provide [*privacy*](../secgloss/p-gly.md).</span></span> <span data-ttu-id="0b6f5-105">**EncryptMessage (geral)** permite que um aplicativo escolha entre [*algoritmos de criptografia*](../secgloss/c-gly.md) com suporte no mecanismo escolhido.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-105">**EncryptMessage (General)** allows an application to choose among [*cryptographic algorithms*](../secgloss/c-gly.md) supported by the chosen mechanism.</span></span> <span data-ttu-id="0b6f5-106">A função **EncryptMessage (geral)** usa o [*contexto de segurança*](../secgloss/s-gly.md) referenciado pelo identificador de contexto.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-106">The **EncryptMessage (General)** function uses the [*security context*](../secgloss/s-gly.md) referenced by the context handle.</span></span> <span data-ttu-id="0b6f5-107">Alguns pacotes não têm mensagens a serem criptografadas ou descriptografadas, mas fornecem um [*hash*](../secgloss/h-gly.md) de integridade que pode ser verificado.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-107">Some packages do not have messages to be encrypted or decrypted but rather provide an integrity [*hash*](../secgloss/h-gly.md) that can be checked.</span></span>

<span data-ttu-id="0b6f5-108">Ao usar o SSP ( [*provedor de suporte de segurança*](../secgloss/s-gly.md) ) Digest, essa função está disponível apenas como um mecanismo SASL.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-108">When using the Digest [*security support provider*](../secgloss/s-gly.md) (SSP), this function is available as a SASL mechanism only.</span></span>

<span data-ttu-id="0b6f5-109">Ao usar o SSP do Schannel, essa função criptografa mensagens usando uma [*chave de sessão*](../secgloss/s-gly.md) negociada com a parte remota que receberá a mensagem.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-109">When using the Schannel SSP, this function encrypts messages by using a [*session key*](../secgloss/s-gly.md) negotiated with the remote party that will receive the message.</span></span> <span data-ttu-id="0b6f5-110">O algoritmo de criptografia é determinado pelo [conjunto de [*codificação*](../secgloss/c-gly.md)]([*cipher*](../secgloss/c-gly.md)-suites-in-schannel.md) em uso.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-110">The encryption algorithm is determined by the [[*cipher*](../secgloss/c-gly.md) suite]([*cipher*](../secgloss/c-gly.md)-suites-in-schannel.md) in use.</span></span>

> [!Note]  
> <span data-ttu-id="0b6f5-111">**EncryptMessage (geral)** e [**DecryptMessage (geral)**](decryptmessage--general.md) podem ser chamados ao mesmo tempo de dois threads diferentes em um único contexto SSPI ( [*interface de provedor de suporte de segurança*](../secgloss/s-gly.md) ) se um thread estiver Criptografando e o outro estiver descriptografando.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-111">**EncryptMessage (General)** and [**DecryptMessage (General)**](decryptmessage--general.md) can be called at the same time from two different threads in a single [*security support provider interface*](../secgloss/s-gly.md) (SSPI) context if one thread is encrypting and the other is decrypting.</span></span> <span data-ttu-id="0b6f5-112">Se mais de um thread estiver criptografando ou se mais de um thread estiver descriptografando, cada thread deverá obter um contexto exclusivo.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-112">If more than one thread is encrypting, or more than one thread is decrypting, each thread should obtain a unique context.</span></span>

<span data-ttu-id="0b6f5-113">Para obter informações sobre como usar essa função com um SSP específico, consulte os tópicos a seguir.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-113">For information about using this function with a specific SSP, see the following topics.</span></span>

| <span data-ttu-id="0b6f5-114">Tópico</span><span class="sxs-lookup"><span data-stu-id="0b6f5-114">Topic</span></span>                                                            | <span data-ttu-id="0b6f5-115">Descrição</span><span class="sxs-lookup"><span data-stu-id="0b6f5-115">Description</span></span>                                               |
|------------------------------------------------------------------|-----------------------------------------------------------|
| [<span data-ttu-id="0b6f5-116">**EncryptMessage (resumo)**</span><span class="sxs-lookup"><span data-stu-id="0b6f5-116">**EncryptMessage (Digest)**</span></span>](encryptmessage--digest.md)       | <span data-ttu-id="0b6f5-117">Criptografa uma mensagem para fornecer privacidade usando Digest.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-117">Encrypts a message to provide privacy by using Digest.</span></span>    |
| [<span data-ttu-id="0b6f5-118">**EncryptMessage (Kerberos)**</span><span class="sxs-lookup"><span data-stu-id="0b6f5-118">**EncryptMessage (Kerberos)**</span></span>](encryptmessage--kerberos.md)   | <span data-ttu-id="0b6f5-119">Criptografa uma mensagem para fornecer privacidade usando o Kerberos.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-119">Encrypts a message to provide privacy by using Kerberos.</span></span>  |
| [<span data-ttu-id="0b6f5-120">**EncryptMessage (negociar)**</span><span class="sxs-lookup"><span data-stu-id="0b6f5-120">**EncryptMessage (Negotiate)**</span></span>](encryptmessage--negotiate.md) | <span data-ttu-id="0b6f5-121">Criptografa uma mensagem para fornecer privacidade usando Negotiate.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-121">Encrypts a message to provide privacy by using Negotiate.</span></span> |
| [<span data-ttu-id="0b6f5-122">**EncryptMessage (NTLM)**</span><span class="sxs-lookup"><span data-stu-id="0b6f5-122">**EncryptMessage (NTLM)**</span></span>](encryptmessage--ntlm.md)           | <span data-ttu-id="0b6f5-123">Criptografa uma mensagem para fornecer privacidade usando NTLM.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-123">Encrypts a message to provide privacy by using NTLM.</span></span>      |
| [<span data-ttu-id="0b6f5-124">**EncryptMessage (Schannel)**</span><span class="sxs-lookup"><span data-stu-id="0b6f5-124">**EncryptMessage (Schannel)**</span></span>](encryptmessage--schannel.md)   | <span data-ttu-id="0b6f5-125">Criptografa uma mensagem para fornecer privacidade usando Schannel.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-125">Encrypts a message to provide privacy by using Schannel.</span></span>  |

## <a name="syntax"></a><span data-ttu-id="0b6f5-126">Sintaxe</span><span class="sxs-lookup"><span data-stu-id="0b6f5-126">Syntax</span></span>

```C++
SECURITY_STATUS SEC_Entry EncryptMessage(
  _In_    PCtxtHandle    phContext,
  _In_    ULONG          fQOP,
  _Inout_ PSecBufferDesc pMessage,
  _In_    ULONG          MessageSeqNo
);
```
## <a name="parameters"></a><span data-ttu-id="0b6f5-127">Parâmetros</span><span class="sxs-lookup"><span data-stu-id="0b6f5-127">Parameters</span></span>

<span data-ttu-id="0b6f5-128">*phContext* \[ no\]</span><span class="sxs-lookup"><span data-stu-id="0b6f5-128">*phContext* \[in\]</span></span>

<span data-ttu-id="0b6f5-129">Um identificador para o [*contexto de segurança*](../secgloss/s-gly.md) a ser usado para criptografar a mensagem.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-129">A handle to the [*security context*](../secgloss/s-gly.md) to be used to encrypt the message.</span></span>

<span data-ttu-id="0b6f5-130">*fQOP* \[ no\]</span><span class="sxs-lookup"><span data-stu-id="0b6f5-130">*fQOP* \[in\]</span></span>

<span data-ttu-id="0b6f5-131">Sinalizadores específicos do pacote que indicam a qualidade da proteção.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-131">Package-specific flags that indicate the quality of protection.</span></span> <span data-ttu-id="0b6f5-132">Um [*pacote de segurança*](../secgloss/s-gly.md) pode usar esse parâmetro para habilitar a seleção de [*algoritmos criptográficos*](../secgloss/c-gly.md).</span><span class="sxs-lookup"><span data-stu-id="0b6f5-132">A [*security package*](../secgloss/s-gly.md) can use this parameter to enable the selection of [*cryptographic algorithms*](../secgloss/c-gly.md).</span></span>

<span data-ttu-id="0b6f5-133">Ao usar o SSP de resumo, esse parâmetro deve ser definido como zero.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-133">When using the Digest SSP, this parameter must be set to zero.</span></span>

<span data-ttu-id="0b6f5-134">Esse parâmetro pode ser um dos sinalizadores a seguir.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-134">This parameter can be one of the following flags.</span></span>

<table><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><thead><tr class="header"><th><span data-ttu-id="0b6f5-135">Valor</span><span class="sxs-lookup"><span data-stu-id="0b6f5-135">Value</span></span></th><th><span data-ttu-id="0b6f5-136">Significado</span><span class="sxs-lookup"><span data-stu-id="0b6f5-136">Meaning</span></span></th></tr></thead><tbody><tr class="odd"><td><span id="SECQOP_WRAP_NO_ENCRYPT"></span><span id="secqop_wrap_no_encrypt"></span><dl> <span data-ttu-id="0b6f5-137"><dt><strong>SECQOP_WRAP_NO_ENCRYPT</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="0b6f5-137"><dt><strong>SECQOP_WRAP_NO_ENCRYPT</strong></dt> </span></span></dl></td><td><span data-ttu-id="0b6f5-138">Produz um cabeçalho ou um trailer, mas não criptografa a mensagem.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-138">Produce a header or trailer but do not encrypt the message.</span></span><br/><blockquote>[!Note]<br />
<span data-ttu-id="0b6f5-139">KERB_WRAP_NO_ENCRYPT tem o mesmo valor e o mesmo significado.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-139">KERB_WRAP_NO_ENCRYPT has the same value and the same meaning.</span></span></blockquote><br/></td></tr><tr class="even"><td><span id="SECQOP_WRAP_OOB_DATA"></span><span id="secqop_wrap_oob_data"></span><dl> <span data-ttu-id="0b6f5-140"><dt><strong>SECQOP_WRAP_OOB_DATA</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="0b6f5-140"><dt><strong>SECQOP_WRAP_OOB_DATA</strong></dt> </span></span></dl></td><td><span data-ttu-id="0b6f5-141">Envie uma mensagem de alerta Schannel.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-141">Send an Schannel alert message.</span></span> <span data-ttu-id="0b6f5-142">Nesse caso, o parâmetro <em>PMessage</em> deve conter um código de evento SSL/TLS padrão de dois bytes.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-142">In this case, the <em>pMessage</em> parameter must contain a standard two-byte SSL/TLS event code.</span></span> <span data-ttu-id="0b6f5-143">Esse valor tem suporte apenas pelo SSP do Schannel.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-143">This value is supported only by the Schannel SSP.</span></span><br/></td></tr></tbody></table>

<span data-ttu-id="0b6f5-144">*PMessage* \[ entrada, saída\]</span><span class="sxs-lookup"><span data-stu-id="0b6f5-144">*pMessage* \[in, out\]</span></span>

<span data-ttu-id="0b6f5-145">Um ponteiro para uma estrutura [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) .</span><span class="sxs-lookup"><span data-stu-id="0b6f5-145">A pointer to a [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) structure.</span></span> <span data-ttu-id="0b6f5-146">Na entrada, a estrutura faz referência a uma ou mais estruturas [**SecBuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) .</span><span class="sxs-lookup"><span data-stu-id="0b6f5-146">On input, the structure references one or more [**SecBuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) structures.</span></span> <span data-ttu-id="0b6f5-147">Um deles pode ser do tipo dados de SECBUFFER \_ .</span><span class="sxs-lookup"><span data-stu-id="0b6f5-147">One of these can be of type SECBUFFER\_DATA.</span></span> <span data-ttu-id="0b6f5-148">Esse buffer contém a mensagem a ser criptografada.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-148">That buffer contains the message to be encrypted.</span></span> <span data-ttu-id="0b6f5-149">A mensagem é criptografada no local, substituindo o conteúdo original da estrutura.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-149">The message is encrypted in place, overwriting the original contents of the structure.</span></span>

<span data-ttu-id="0b6f5-150">A função não processa buffers com o \_ atributo ReadOnly SECBUFFER.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-150">The function does not process buffers with the SECBUFFER\_READONLY attribute.</span></span>

<span data-ttu-id="0b6f5-151">O comprimento da estrutura de [**SecBuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) que contém a mensagem não deve ser maior que **cbMaximumMessage**, que é obtido da função [**QueryContextAttributes (geral)**](querycontextattributes--general.md) (SECPKG de \_ fluxo de attr \_ \_ ).</span><span class="sxs-lookup"><span data-stu-id="0b6f5-151">The length of the [**SecBuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) structure that contains the message must be no greater than **cbMaximumMessage**, which is obtained from the [**QueryContextAttributes (General)**](querycontextattributes--general.md) (SECPKG\_ATTR\_STREAM\_SIZES) function.</span></span>

<span data-ttu-id="0b6f5-152">Ao usar o SSP de resumo, deve haver um segundo buffer do tipo SECBUFFER \_ Padding ou \_ os dados de buffer de s \_ para manter as informações de [*assinatura*](../secgloss/d-gly.md#_security_digital_signature_gly) .</span><span class="sxs-lookup"><span data-stu-id="0b6f5-152">When using the Digest SSP, there must be a second buffer of type SECBUFFER\_PADDING or SEC\_BUFFER\_DATA to hold [*signature*](../secgloss/d-gly.md#_security_digital_signature_gly) information.</span></span> <span data-ttu-id="0b6f5-153">Para obter o tamanho do buffer de saída, chame a função [**QueryContextAttributes (geral)**](querycontextattributes--general.md) e especifique os \_ tamanhos de attr SECPKG \_ .</span><span class="sxs-lookup"><span data-stu-id="0b6f5-153">To get the size of the output buffer, call the [**QueryContextAttributes (General)**](querycontextattributes--general.md) function and specify SECPKG\_ATTR\_SIZES.</span></span> <span data-ttu-id="0b6f5-154">A função retornará uma estrutura [**de \_ tamanhos de SecPkgContext**](/windows/win32/api/sspi/ns-sspi-secpkgcontext_sizes) .</span><span class="sxs-lookup"><span data-stu-id="0b6f5-154">The function will return a [**SecPkgContext\_Sizes**](/windows/win32/api/sspi/ns-sspi-secpkgcontext_sizes) structure.</span></span> <span data-ttu-id="0b6f5-155">O tamanho do buffer de saída é a soma dos valores nos membros **cbMaxSignature** e **cbBlockSize** .</span><span class="sxs-lookup"><span data-stu-id="0b6f5-155">The size of the output buffer is the sum of the values in the **cbMaxSignature** and **cbBlockSize** members.</span></span>

<span data-ttu-id="0b6f5-156">Os aplicativos que não usam SSL devem fornecer um [**SecBuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) do tipo \_ preenchimento SecBuffer.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-156">Applications that do not use SSL must supply a [**SecBuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) of type SECBUFFER\_PADDING.</span></span>

<span data-ttu-id="0b6f5-157">*MessageSeqNo* \[ no\]</span><span class="sxs-lookup"><span data-stu-id="0b6f5-157">*MessageSeqNo* \[in\]</span></span>

<span data-ttu-id="0b6f5-158">O número de sequência que o aplicativo de transporte atribuiu à mensagem.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-158">The sequence number that the transport application assigned to the message.</span></span> <span data-ttu-id="0b6f5-159">Se o aplicativo de transporte não mantiver números de sequência, esse parâmetro deverá ser zero.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-159">If the transport application does not maintain sequence numbers, this parameter must be zero.</span></span>

<span data-ttu-id="0b6f5-160">Ao usar o SSP de resumo, esse parâmetro deve ser definido como zero.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-160">When using the Digest SSP, this parameter must be set to zero.</span></span> <span data-ttu-id="0b6f5-161">O SSP de resumo gerencia a numeração de sequência internamente.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-161">The Digest SSP manages sequence numbering internally.</span></span>

<span data-ttu-id="0b6f5-162">Ao usar o SSP do Schannel, esse parâmetro deve ser definido como zero.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-162">When using the Schannel SSP, this parameter must be set to zero.</span></span> <span data-ttu-id="0b6f5-163">O SSP do Schannel não usa números de sequência.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-163">The Schannel SSP does not use sequence numbers.</span></span>

</dd> </dl>

## <a name="return-value"></a><span data-ttu-id="0b6f5-164">Retornar valor</span><span class="sxs-lookup"><span data-stu-id="0b6f5-164">Return value</span></span>

<span data-ttu-id="0b6f5-165">Se a função for realizada com sucesso, a função retornará s \_ E \_ OK.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-165">If the function succeeds, the function returns SEC\_E\_OK.</span></span>

<span data-ttu-id="0b6f5-166">Se a função falhar, ela retornará um dos seguintes códigos de erro.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-166">If the function fails, it returns one of the following error codes.</span></span>

| <span data-ttu-id="0b6f5-167">Código de retorno</span><span class="sxs-lookup"><span data-stu-id="0b6f5-167">Return code</span></span>                         | <span data-ttu-id="0b6f5-168">Description</span><span class="sxs-lookup"><span data-stu-id="0b6f5-168">Description</span></span>                                                                                                                                                                 |
|-------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="0b6f5-169">**s \_ E \_ buffer \_ muito \_ pequeno**</span><span class="sxs-lookup"><span data-stu-id="0b6f5-169">**SEC\_E\_BUFFER\_TOO\_SMALL**</span></span>      | <span data-ttu-id="0b6f5-170">O buffer de saída é muito pequeno.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-170">The output buffer is too small.</span></span> <span data-ttu-id="0b6f5-171">Para obter mais informações, consulte Comentários.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-171">For more information, see Remarks.</span></span>                                                                                                          |
| <span data-ttu-id="0b6f5-172">**o \_ contexto s E \_ \_ expirou**</span><span class="sxs-lookup"><span data-stu-id="0b6f5-172">**SEC\_E\_CONTEXT\_EXPIRED**</span></span>        | <span data-ttu-id="0b6f5-173">O aplicativo está fazendo referência a um contexto que já foi fechado.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-173">The application is referencing a context that has already been closed.</span></span> <span data-ttu-id="0b6f5-174">Um aplicativo escrito corretamente não deve receber esse erro.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-174">A properly written application should not receive this error.</span></span>                                        |
| <span data-ttu-id="0b6f5-175">**s \_ E \_ sistema de criptografia \_ \_ inválidos**</span><span class="sxs-lookup"><span data-stu-id="0b6f5-175">**SEC\_E\_CRYPTO\_SYSTEM\_INVALID**</span></span> | <span data-ttu-id="0b6f5-176">Não há suporte para a [*codificação*](../secgloss/c-gly.md) escolhida para o [*contexto de segurança*](../secgloss/s-gly.md) .</span><span class="sxs-lookup"><span data-stu-id="0b6f5-176">The [*cipher*](../secgloss/c-gly.md) chosen for the [*security context*](../secgloss/s-gly.md) is not supported.</span></span>                                                                       |
| <span data-ttu-id="0b6f5-177">**s \_ E \_ memória insuficiente \_**</span><span class="sxs-lookup"><span data-stu-id="0b6f5-177">**SEC\_E\_INSUFFICIENT\_MEMORY**</span></span>    | <span data-ttu-id="0b6f5-178">Não há memória suficiente disponível para concluir a ação solicitada.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-178">There is not enough memory available to complete the requested action.</span></span>                                                                                                      |
| <span data-ttu-id="0b6f5-179">**s \_ E \_ \_ identificador inválido**</span><span class="sxs-lookup"><span data-stu-id="0b6f5-179">**SEC\_E\_INVALID\_HANDLE**</span></span>         | <span data-ttu-id="0b6f5-180">Um identificador de contexto inválido foi especificado no parâmetro *phContext* .</span><span class="sxs-lookup"><span data-stu-id="0b6f5-180">A context handle that is not valid was specified in the *phContext* parameter.</span></span>                                                                                              |
| <span data-ttu-id="0b6f5-181">**s \_ E \_ \_ token inválido**</span><span class="sxs-lookup"><span data-stu-id="0b6f5-181">**SEC\_E\_INVALID\_TOKEN**</span></span>          | <span data-ttu-id="0b6f5-182">Nenhum \_ buffer de tipo de dados SECBUFFER foi encontrado.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-182">No SECBUFFER\_DATA type buffer was found.</span></span>                                                                                                                                   |
| <span data-ttu-id="0b6f5-183">**s \_ E \_ QOP \_ não \_ têm suporte**</span><span class="sxs-lookup"><span data-stu-id="0b6f5-183">**SEC\_E\_QOP\_NOT\_SUPPORTED**</span></span>     | <span data-ttu-id="0b6f5-184">Nenhuma confidencialidade nem [*integridade*](../secgloss/i-gly.md) têm suporte no [*contexto de segurança*](../secgloss/s-gly.md).</span><span class="sxs-lookup"><span data-stu-id="0b6f5-184">Neither confidentiality nor [*integrity*](../secgloss/i-gly.md) are supported by the [*security context*](../secgloss/s-gly.md).</span></span> |

## <a name="remarks"></a><span data-ttu-id="0b6f5-185">Comentários</span><span class="sxs-lookup"><span data-stu-id="0b6f5-185">Remarks</span></span>

<span data-ttu-id="0b6f5-186">A função **EncryptMessage (geral)** criptografa uma mensagem com base na mensagem e na [*chave de sessão*](../secgloss/s-gly.md) de um [*contexto de segurança*](../secgloss/s-gly.md).</span><span class="sxs-lookup"><span data-stu-id="0b6f5-186">The **EncryptMessage (General)** function encrypts a message based on the message and the [*session key*](../secgloss/s-gly.md) from a [*security context*](../secgloss/s-gly.md).</span></span>

<span data-ttu-id="0b6f5-187">Se o aplicativo de transporte criou o [*contexto de segurança*](../secgloss/s-gly.md) para dar suporte à detecção de sequência e o chamador fornecer um número de sequência, a função incluirá essas informações com a mensagem criptografada.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-187">If the transport application created the [*security context*](../secgloss/s-gly.md) to support sequence detection and the caller provides a sequence number, the function includes this information with the encrypted message.</span></span> <span data-ttu-id="0b6f5-188">A inclusão dessas informações protege contra reprodução, inserção e supressão de mensagens.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-188">Including this information protects against replay, insertion, and suppression of messages.</span></span> <span data-ttu-id="0b6f5-189">O [*pacote de segurança*](../secgloss/s-gly.md) incorpora o número de sequência passado do aplicativo de transporte.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-189">The [*security package*](../secgloss/s-gly.md) incorporates the sequence number passed down from the transport application.</span></span>

<span data-ttu-id="0b6f5-190">Ao usar o SSP de resumo, obtenha o tamanho do buffer de saída chamando a função [**QueryContextAttributes (geral)**](querycontextattributes--general.md) e especificando os \_ tamanhos de attr SECPKG \_ .</span><span class="sxs-lookup"><span data-stu-id="0b6f5-190">When you use the Digest SSP, get the size of the output buffer by calling the [**QueryContextAttributes (General)**](querycontextattributes--general.md) function and specifying SECPKG\_ATTR\_SIZES.</span></span> <span data-ttu-id="0b6f5-191">A função retornará uma estrutura [**de \_ tamanhos de SecPkgContext**](/windows/win32/api/sspi/ns-sspi-secpkgcontext_sizes) .</span><span class="sxs-lookup"><span data-stu-id="0b6f5-191">The function will return a [**SecPkgContext\_Sizes**](/windows/win32/api/sspi/ns-sspi-secpkgcontext_sizes) structure.</span></span> <span data-ttu-id="0b6f5-192">O tamanho do buffer de saída é a soma dos valores nos membros **cbMaxSignature** e **cbBlockSize** .</span><span class="sxs-lookup"><span data-stu-id="0b6f5-192">The size of the output buffer is the sum of the values in the **cbMaxSignature** and **cbBlockSize** members.</span></span>

<span data-ttu-id="0b6f5-193">Quando usado com o Schannel SSP, o parâmetro *PMessage* deve conter uma estrutura [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) com os buffers a seguir.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-193">When used with the Schannel SSP, the *pMessage* parameter must contain a [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) structure with the following buffers.</span></span>

> [!Note]  
> <span data-ttu-id="0b6f5-194">Esses buffers devem ser fornecidos na ordem mostrada.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-194">These buffers must be supplied in the order shown.</span></span>

| <span data-ttu-id="0b6f5-195">Tipo de buffer</span><span class="sxs-lookup"><span data-stu-id="0b6f5-195">Buffer type</span></span>                | <span data-ttu-id="0b6f5-196">Description</span><span class="sxs-lookup"><span data-stu-id="0b6f5-196">Description</span></span>                                                                                 |
|----------------------------|---------------------------------------------------------------------------------------------|
| <span data-ttu-id="0b6f5-197">\_cabeçalho de fluxo de SECBUFFER \_</span><span class="sxs-lookup"><span data-stu-id="0b6f5-197">SECBUFFER\_STREAM\_HEADER</span></span>  | <span data-ttu-id="0b6f5-198">Usado internamente.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-198">Used internally.</span></span> <span data-ttu-id="0b6f5-199">Nenhuma inicialização é necessária.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-199">No initialization required.</span></span>                                                |
| <span data-ttu-id="0b6f5-200">dados do SECBUFFER \_</span><span class="sxs-lookup"><span data-stu-id="0b6f5-200">SECBUFFER\_DATA</span></span>            | <span data-ttu-id="0b6f5-201">Contém a mensagem de [*texto sem formatação*](../secgloss/s-gly.md) a ser criptografada.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-201">Contains the [*plaintext*](../secgloss/s-gly.md) message to be encrypted.</span></span> |
| <span data-ttu-id="0b6f5-202">\_trailer de fluxo de SECBUFFER \_</span><span class="sxs-lookup"><span data-stu-id="0b6f5-202">SECBUFFER\_STREAM\_TRAILER</span></span> | <span data-ttu-id="0b6f5-203">Usado internamente.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-203">Used internally.</span></span> <span data-ttu-id="0b6f5-204">Nenhuma inicialização é necessária.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-204">No initialization required.</span></span>                                                |
| <span data-ttu-id="0b6f5-205">SECBUFFER \_ vazio</span><span class="sxs-lookup"><span data-stu-id="0b6f5-205">SECBUFFER\_EMPTY</span></span>           | <span data-ttu-id="0b6f5-206">Usado internamente.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-206">Used internally.</span></span> <span data-ttu-id="0b6f5-207">Nenhuma inicialização é necessária.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-207">No initialization required.</span></span> <span data-ttu-id="0b6f5-208">O tamanho pode ser zero.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-208">Size can be zero.</span></span>                              |

<span data-ttu-id="0b6f5-209">Ao usar o SSP do Schannel, determine o tamanho máximo de cada um dos buffers chamando a função [**QueryContextAttributes (geral)**](querycontextattributes--general.md) e especificando o atributo de \_ tamanhos de fluxo SECPKG attr \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="0b6f5-209">When you use the Schannel SSP, determine the maximum size of each of the buffers by calling the [**QueryContextAttributes (General)**](querycontextattributes--general.md) function and specifying the SECPKG\_ATTR\_STREAM\_SIZES attribute.</span></span> <span data-ttu-id="0b6f5-210">Essa função retorna uma [**estrutura SecPkgContext \_ StreamSizes**](/windows/win32/api/sspi/ns-sspi-secpkgcontext_streamsizes) cujos membros contêm os tamanhos máximos para os buffers de cabeçalho (membro **cbHeader** ), mensagem (membro **CbMaximumMessage** ) e trailer (membro **cbTrailer** ).</span><span class="sxs-lookup"><span data-stu-id="0b6f5-210">This function returns a [**SecPkgContext\_StreamSizes**](/windows/win32/api/sspi/ns-sspi-secpkgcontext_streamsizes) structure whose members contain the maximum sizes for the header (**cbHeader** member), message (**cbMaximumMessage** member) and trailer (**cbTrailer** member) buffers.</span></span>

<span data-ttu-id="0b6f5-211">Para um desempenho ideal, as estruturas *PMessage* devem ser alocadas da memória contígua.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-211">For optimal performance, the *pMessage* structures should be allocated from contiguous memory.</span></span>

<span data-ttu-id="0b6f5-212">**Windows XP/2000:** Essa função também era conhecida como **SealMessage**.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-212">**Windows XP/2000:** This function was also known as **SealMessage**.</span></span> <span data-ttu-id="0b6f5-213">Os aplicativos agora devem usar **EncryptMessage (geral)** apenas.</span><span class="sxs-lookup"><span data-stu-id="0b6f5-213">Applications should now use **EncryptMessage (General)** only.</span></span>

## <a name="requirements"></a><span data-ttu-id="0b6f5-214">Requisitos</span><span class="sxs-lookup"><span data-stu-id="0b6f5-214">Requirements</span></span>

| <span data-ttu-id="0b6f5-215">Requisito</span><span class="sxs-lookup"><span data-stu-id="0b6f5-215">Requirement</span></span> | <span data-ttu-id="0b6f5-216">Valor</span><span class="sxs-lookup"><span data-stu-id="0b6f5-216">Value</span></span> |
|-------------------------------------|--------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="0b6f5-217">Cliente mínimo com suporte</span><span class="sxs-lookup"><span data-stu-id="0b6f5-217">Minimum supported client</span></span> | <span data-ttu-id="0b6f5-218">\[Somente aplicativos da área de trabalho do Windows XP\]</span><span class="sxs-lookup"><span data-stu-id="0b6f5-218">Windows XP \[desktop apps only\]</span></span>                                                            |
| <span data-ttu-id="0b6f5-219">Servidor mínimo com suporte</span><span class="sxs-lookup"><span data-stu-id="0b6f5-219">Minimum supported server</span></span> | <span data-ttu-id="0b6f5-220">\[Somente aplicativos da área de trabalho do Windows Server 2003\]</span><span class="sxs-lookup"><span data-stu-id="0b6f5-220">Windows Server 2003 \[desktop apps only\]</span></span>                                                   |
| <span data-ttu-id="0b6f5-221">parâmetro</span><span class="sxs-lookup"><span data-stu-id="0b6f5-221">Header</span></span>                   | <dl> <span data-ttu-id="0b6f5-222"><dt>SSPI. h (incluir Security. h)</dt></span><span class="sxs-lookup"><span data-stu-id="0b6f5-222"><dt>Sspi.h (include Security.h)</dt></span></span> </dl> |
| <span data-ttu-id="0b6f5-223">Biblioteca</span><span class="sxs-lookup"><span data-stu-id="0b6f5-223">Library</span></span>                  | <dl> <span data-ttu-id="0b6f5-224"><dt>Secur32. lib</dt></span><span class="sxs-lookup"><span data-stu-id="0b6f5-224"><dt>Secur32.lib</dt></span></span> </dl>                 |
| <span data-ttu-id="0b6f5-225">DLL</span><span class="sxs-lookup"><span data-stu-id="0b6f5-225">DLL</span></span>                      | <dl> <span data-ttu-id="0b6f5-226"><dt>Secur32.dll</dt></span><span class="sxs-lookup"><span data-stu-id="0b6f5-226"><dt>Secur32.dll</dt></span></span> </dl>                 |

## <a name="see-also"></a><span data-ttu-id="0b6f5-227">Confira também</span><span class="sxs-lookup"><span data-stu-id="0b6f5-227">See also</span></span>

- [<span data-ttu-id="0b6f5-228">Funções SSPI</span><span class="sxs-lookup"><span data-stu-id="0b6f5-228">SSPI Functions</span></span>](authentication-functions.md#sspi-functions)
- [<span data-ttu-id="0b6f5-229">**AcceptSecurityContext (geral)**</span><span class="sxs-lookup"><span data-stu-id="0b6f5-229">**AcceptSecurityContext (General)**</span></span>](acceptsecuritycontext--general.md)
- [<span data-ttu-id="0b6f5-230">**DecryptMessage (geral)**</span><span class="sxs-lookup"><span data-stu-id="0b6f5-230">**DecryptMessage (General)**</span></span>](decryptmessage--general.md)
- [<span data-ttu-id="0b6f5-231">**InitializeSecurityContext (geral)**</span><span class="sxs-lookup"><span data-stu-id="0b6f5-231">**InitializeSecurityContext (General)**</span></span>](initializesecuritycontext--general.md)
- [<span data-ttu-id="0b6f5-232">**QueryContextAttributes (geral)**</span><span class="sxs-lookup"><span data-stu-id="0b6f5-232">**QueryContextAttributes (General)**</span></span>](querycontextattributes--general.md)
- [<span data-ttu-id="0b6f5-233">**SecBuffer**</span><span class="sxs-lookup"><span data-stu-id="0b6f5-233">**SecBuffer**</span></span>](/windows/win32/api/sspi/ns-sspi-secbuffer)
- [<span data-ttu-id="0b6f5-234">**SecBufferDesc**</span><span class="sxs-lookup"><span data-stu-id="0b6f5-234">**SecBufferDesc**</span></span>](/windows/win32/api/sspi/ns-sspi-secbufferdesc)
