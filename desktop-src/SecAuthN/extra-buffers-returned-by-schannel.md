---
description: O Schannel tem um conjunto bem definido de comportamentos para informações incompletas ou em excesso incluídas nos buffers de entrada para essas funções.
ms.assetid: 5fad1e76-6520-4ff7-b2b0-2cc2061062a1
title: Buffers extras retornados pelo Schannel
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5b0c9ce7a468b1b04389ad19f91785b64fb50e74
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "105752230"
---
# <a name="extra-buffers-returned-by-schannel"></a><span data-ttu-id="96d7e-103">Buffers extras retornados pelo Schannel</span><span class="sxs-lookup"><span data-stu-id="96d7e-103">Extra Buffers Returned by Schannel</span></span>

<span data-ttu-id="96d7e-104">As informações devem ser enviadas entre o cliente e o servidor enquanto um [*contexto de segurança*](/windows/desktop/SecGloss/s-gly) está sendo estabelecido e posteriormente, pois as mensagens seguras são trocadas usando os recursos de criptografia e descriptografia fornecidos pelo Schannel.</span><span class="sxs-lookup"><span data-stu-id="96d7e-104">Information must be sent between the client and server while a [*security context*](/windows/desktop/SecGloss/s-gly) is being established and afterward because secure messages are exchanged by using the encryption and decryption features provided by Schannel.</span></span> <span data-ttu-id="96d7e-105">As funções a seguir são usadas para realizar essas tarefas:</span><span class="sxs-lookup"><span data-stu-id="96d7e-105">The following functions are used to accomplish these tasks:</span></span>

-   [<span data-ttu-id="96d7e-106">**AcceptSecurityContext (geral)**</span><span class="sxs-lookup"><span data-stu-id="96d7e-106">**AcceptSecurityContext (General)**</span></span>](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext)
-   [<span data-ttu-id="96d7e-107">**InitializeSecurityContext (geral)**</span><span class="sxs-lookup"><span data-stu-id="96d7e-107">**InitializeSecurityContext (General)**</span></span>](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta)
-   [<span data-ttu-id="96d7e-108">**DecryptMessage (geral)**</span><span class="sxs-lookup"><span data-stu-id="96d7e-108">**DecryptMessage (General)**</span></span>](/windows/win32/api/sspi/nf-sspi-decryptmessage)

<span data-ttu-id="96d7e-109">O Schannel tem um conjunto bem definido de comportamentos para informações incompletas ou em excesso incluídas nos buffers de entrada para essas funções.</span><span class="sxs-lookup"><span data-stu-id="96d7e-109">Schannel has a well-defined set of behaviors for incomplete or excess information included in the input buffers to these functions.</span></span> <span data-ttu-id="96d7e-110">As informações são trocadas entre o cliente e o servidor da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="96d7e-110">Information is exchanged between the client and server in the following manner:</span></span>

1.  <span data-ttu-id="96d7e-111">A parte local interage com o Schannel chamando uma função SSPI e transmitindo informações.</span><span class="sxs-lookup"><span data-stu-id="96d7e-111">The local party interacts with Schannel by calling an SSPI function and passing in information.</span></span> <span data-ttu-id="96d7e-112">Normalmente, as informações foram recebidas da parte remota.</span><span class="sxs-lookup"><span data-stu-id="96d7e-112">Typically, the information was received from the remote party.</span></span>
2.  <span data-ttu-id="96d7e-113">A função retorna um código de status e buffers de saída que contêm informações.</span><span class="sxs-lookup"><span data-stu-id="96d7e-113">The function returns a status code and output buffers containing information.</span></span>
3.  <span data-ttu-id="96d7e-114">Dependendo do código de status, os buffers de saída são enviados para a parte remota por meio de um mecanismo de comunicação.</span><span class="sxs-lookup"><span data-stu-id="96d7e-114">Depending on the status code, the output buffers are sent to the remote party by means of some communication mechanism.</span></span>
4.  <span data-ttu-id="96d7e-115">A parte remota lê as informações enviadas pela parte local.</span><span class="sxs-lookup"><span data-stu-id="96d7e-115">The remote party reads information sent by the local party.</span></span>
5.  <span data-ttu-id="96d7e-116">O loop se repete, com as partes locais e remotas trocadas.</span><span class="sxs-lookup"><span data-stu-id="96d7e-116">The loop repeats, with the local and remote parties interchanged.</span></span> <span data-ttu-id="96d7e-117">(A parte remota chama uma função SSPI e passa as informações lidas na etapa anterior.)</span><span class="sxs-lookup"><span data-stu-id="96d7e-117">(The remote party calls an SSPI function and passes in the information read in the previous step.)</span></span>

<span data-ttu-id="96d7e-118">Tudo funciona conforme o esperado quando o buffer de entrada para a função SSPI contém exatamente as informações necessárias.</span><span class="sxs-lookup"><span data-stu-id="96d7e-118">Everything works as expected when the input buffer to the SSPI function contains exactly the information needed.</span></span> <span data-ttu-id="96d7e-119">No entanto, devido à natureza orientada a fluxo de alguns protocolos de comunicação, isso pode não ser o caso; um bloco de informações recebido de uma parte remota pode conter menos dados do que o necessário ou mais dados do que podem ser processados pelo Schannel em uma única chamada de função.</span><span class="sxs-lookup"><span data-stu-id="96d7e-119">However, due to the stream-oriented nature of some communications protocols this may not be the case; a block of information received from a remote party may contain less data than is required or more data than can be processed by Schannel in a single function call.</span></span>

<span data-ttu-id="96d7e-120">Se o buffer de entrada contiver poucas informações, as funções retornarão s \_ E a \_ mensagem incompleta \_ .</span><span class="sxs-lookup"><span data-stu-id="96d7e-120">If the input buffer contains too little information, the functions return SEC\_E\_INCOMPLETE\_MESSAGE.</span></span> <span data-ttu-id="96d7e-121">O chamador deve obter dados adicionais da parte remota e chamar a função novamente.</span><span class="sxs-lookup"><span data-stu-id="96d7e-121">The caller must obtain additional data from the remote party and call the function again.</span></span>

<span data-ttu-id="96d7e-122">Quando os buffers de entrada contiverem muitas informações, o Schannel não tratará isso como um erro.</span><span class="sxs-lookup"><span data-stu-id="96d7e-122">When the input buffers contains too much information, Schannel does not treat this as an error.</span></span> <span data-ttu-id="96d7e-123">A função processa a maior parte da entrada possível e retorna o código de status para essa atividade de processamento.</span><span class="sxs-lookup"><span data-stu-id="96d7e-123">The function processes as much of the input as it can, and returns the status code for that processing activity.</span></span> <span data-ttu-id="96d7e-124">Além disso, o Schannel indica a presença de informações não processadas nos buffers de entrada, retornando um buffer de saída do tipo SECBUFFER \_ extra.</span><span class="sxs-lookup"><span data-stu-id="96d7e-124">In addition, Schannel indicates the presence of unprocessed information in the input buffers by returning an output buffer of type SECBUFFER\_EXTRA.</span></span> <span data-ttu-id="96d7e-125">Testar os buffers de saída para esse tipo de buffer é a única maneira de detectar essa situação.</span><span class="sxs-lookup"><span data-stu-id="96d7e-125">Testing the output buffers for this type of buffer is the only way to detect this situation.</span></span> <span data-ttu-id="96d7e-126">O campo **cbBuffer** da estrutura de buffer extra indica quantos bytes de entrada não foram processados.</span><span class="sxs-lookup"><span data-stu-id="96d7e-126">The **cbBuffer** field of the extra buffer structure indicates how many bytes of input were not processed.</span></span>

> [!Note]  
> <span data-ttu-id="96d7e-127">O campo **pvBuffer** do buffer extra não contém uma cópia dos dados em excesso.</span><span class="sxs-lookup"><span data-stu-id="96d7e-127">The **pvBuffer** field of the extra buffer does not contain a copy of the excess data.</span></span>

 

<span data-ttu-id="96d7e-128">Se você receber um buffer extra de uma função SSPI, deverá remover as informações já processadas do buffer de entrada e chamar a função novamente.</span><span class="sxs-lookup"><span data-stu-id="96d7e-128">If you receive an extra buffer from a SSPI function, you must remove the already processed information from the input buffer and call the function again.</span></span> <span data-ttu-id="96d7e-129">O Schannel pode, e muitas vezes, retorna apenas o buffer extra e nada mais nos buffers de saída.</span><span class="sxs-lookup"><span data-stu-id="96d7e-129">Schannel can, and often does, return only the extra buffer and nothing else in the output buffers.</span></span>

 

 
