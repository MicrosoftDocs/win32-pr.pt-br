---
description: Para abrir um arquivo de log para leitura, chame PdhOpenQuery e especifique um caminho para o arquivo de log.
ms.assetid: 1d8f8662-df1f-4f84-8b65-c152f79cc5c6
title: Trabalhando com arquivos de log
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ba2032b90036f8f58c07d8c7e80e7e7ac2b2701c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105758287"
---
# <a name="working-with-log-files"></a><span data-ttu-id="92812-103">Trabalhando com arquivos de log</span><span class="sxs-lookup"><span data-stu-id="92812-103">Working with Log Files</span></span>

<span data-ttu-id="92812-104">Para abrir um arquivo de log para leitura, chame [**PdhOpenQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhopenquerya) e especifique um caminho para o arquivo de log.</span><span class="sxs-lookup"><span data-stu-id="92812-104">To open a log file for reading, call [**PdhOpenQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhopenquerya) and specify a path to the log file.</span></span> <span data-ttu-id="92812-105">Para abrir um arquivo de log para gravação, você deve chamar [**PdhOpenLog**](/windows/desktop/api/Pdh/nf-pdh-pdhopenloga).</span><span class="sxs-lookup"><span data-stu-id="92812-105">To open a log file for writing, you must call [**PdhOpenLog**](/windows/desktop/api/Pdh/nf-pdh-pdhopenloga).</span></span> <span data-ttu-id="92812-106">Para fechar um arquivo de log, chame [**PdhCloseQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhclosequery) ou [**PdhCloseLog**](/windows/desktop/api/Pdh/nf-pdh-pdhcloselog) dependendo da função usada para abrir o arquivo de log.</span><span class="sxs-lookup"><span data-stu-id="92812-106">To close a log file, call either [**PdhCloseQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhclosequery) or [**PdhCloseLog**](/windows/desktop/api/Pdh/nf-pdh-pdhcloselog) depending on which function you used to open the log file.</span></span>

## <a name="reading-from-a-log-file"></a><span data-ttu-id="92812-107">Lendo de um arquivo de log</span><span class="sxs-lookup"><span data-stu-id="92812-107">Reading from a log file</span></span>

<span data-ttu-id="92812-108">Ler dados de desempenho de um arquivo de log é o mesmo que ler dados de uma fonte em tempo real – você abre uma consulta, adiciona contadores à consulta e chama [**PdhCollectQueryData**](/windows/desktop/api/Pdh/nf-pdh-pdhcollectquerydata) para coletar um exemplo do arquivo de log.</span><span class="sxs-lookup"><span data-stu-id="92812-108">Reading performance data from a log file is the same as reading data from a real time source—you open a query, add counters to the query and call [**PdhCollectQueryData**](/windows/desktop/api/Pdh/nf-pdh-pdhcollectquerydata) to collect a sample from the log file.</span></span> <span data-ttu-id="92812-109">**PdhCollectQueryData** retorna a PDH que \_ não \_ mais \_ dados quando você chega ao final do arquivo de log.</span><span class="sxs-lookup"><span data-stu-id="92812-109">**PdhCollectQueryData** returns PDH\_NO\_MORE\_DATA when you reach the end of the log file.</span></span>

<span data-ttu-id="92812-110">Cada exemplo no arquivo de log contém um carimbo de data/hora para quando ele foi originalmente coletado e gravado no arquivo de log.</span><span class="sxs-lookup"><span data-stu-id="92812-110">Each sample in the log file contains a time stamp for when it was originally collected and written to the log file.</span></span> <span data-ttu-id="92812-111">Para recuperar o carimbo de data/hora da primeira e da última amostra no arquivo de log, chame a função [**PdhGetDataSourceTimeRange**](/windows/desktop/api/Pdh/nf-pdh-pdhgetdatasourcetimerangea) .</span><span class="sxs-lookup"><span data-stu-id="92812-111">To retrieve the time stamp for the first and last sample in the log file, call the [**PdhGetDataSourceTimeRange**](/windows/desktop/api/Pdh/nf-pdh-pdhgetdatasourcetimerangea) function.</span></span> <span data-ttu-id="92812-112">Se você quiser limitar os exemplos lidos do log para um intervalo de tempo específico, consulte [definindo um intervalo de tempo para uma consulta](setting-a-time-range-for-a-query.md).</span><span class="sxs-lookup"><span data-stu-id="92812-112">If you want to limit the samples that you read from the log to a specific time range, see [Setting a Time Range for a Query](setting-a-time-range-for-a-query.md).</span></span>

<span data-ttu-id="92812-113">Se você não souber quais objetos e contadores de desempenho existem no arquivo de log, você pode chamar [**PdhEnumObjects**](/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectsa) para determinar a lista de objetos.</span><span class="sxs-lookup"><span data-stu-id="92812-113">If you do not know which performance objects and counters exist in the log file, you can call [**PdhEnumObjects**](/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectsa) to determine the list of objects.</span></span> <span data-ttu-id="92812-114">Dado um objeto, você pode chamar [**PdhEnumObjectItems**](/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectitemsa) ou [**PdhExpandWildCardPath**](/windows/desktop/api/Pdh/nf-pdh-pdhexpandwildcardpatha) para recuperar uma lista das instâncias e dos contadores do objeto contidos no arquivo de log.</span><span class="sxs-lookup"><span data-stu-id="92812-114">Given an object, you can call either [**PdhEnumObjectItems**](/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectitemsa) or [**PdhExpandWildCardPath**](/windows/desktop/api/Pdh/nf-pdh-pdhexpandwildcardpatha) to retrieve a list of the object's instances and counters contained in the log file.</span></span>

<span data-ttu-id="92812-115">Se você chamar [**PdhEnumObjectItems**](/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectitemsa), use a instância e as listas de contadores para criar um caminho para cada combinação possível de instância e contador.</span><span class="sxs-lookup"><span data-stu-id="92812-115">If you call [**PdhEnumObjectItems**](/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectitemsa), use the instance and counter lists to create a path for each possible combination of instance and counter.</span></span> <span data-ttu-id="92812-116">Quando você chamar [**PdhAddCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddcountera) para adicionar o contador à consulta, a função falhará se o arquivo de log não contiver a combinação determinada.</span><span class="sxs-lookup"><span data-stu-id="92812-116">When you call [**PdhAddCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddcountera) to add the counter to the query, the function will fail if the log file does not contain the given combination.</span></span>

<span data-ttu-id="92812-117">Se você usar [**PdhExpandWildCardPath**](/windows/desktop/api/Pdh/nf-pdh-pdhexpandwildcardpatha), poderá criar um caminho que contém um caractere curinga para o nome da instância e o contador, por exemplo, \\ Object ( \* ) \\ \* .</span><span class="sxs-lookup"><span data-stu-id="92812-117">If you use [**PdhExpandWildCardPath**](/windows/desktop/api/Pdh/nf-pdh-pdhexpandwildcardpatha), you can create a path that contains a wildcard for the instance name and counter, for example, \\object(\*)\\\*.</span></span> <span data-ttu-id="92812-118">A função retornará o \_ \_ caminho inválido da PDH se o objeto não contiver uma instância.</span><span class="sxs-lookup"><span data-stu-id="92812-118">The function returns PDH\_INVALID\_PATH if the object does not contain an instance.</span></span> <span data-ttu-id="92812-119">Nesse caso, chame **PdhExpandWildCardPath** usando um curinga somente para Counter, por exemplo, \\ Object \\ \* .</span><span class="sxs-lookup"><span data-stu-id="92812-119">In this case, call **PdhExpandWildCardPath** using a wildcard for counter only, for example, \\object\\\*.</span></span>

<span data-ttu-id="92812-120">Sistemas operacionais mais recentes podem ler arquivos de log que foram gerados em sistemas operacionais mais antigos; no entanto, os arquivos de log criados no Windows Vista e sistemas operacionais posteriores não podem ser lidos em sistemas operacionais anteriores.</span><span class="sxs-lookup"><span data-stu-id="92812-120">Newer operating systems can read log files that were generated on older operating systems; however, log files that were created on Windows Vista and later operating systems cannot be read on earlier operating systems.</span></span>

<span data-ttu-id="92812-121">Para obter um exemplo que lê dados de um arquivo de log, consulte [lendo dados de desempenho de um arquivo de log](reading-performance-data-from-a-log-file.md).</span><span class="sxs-lookup"><span data-stu-id="92812-121">For an example that reads data from a log file, see [Reading Performance Data from a Log File](reading-performance-data-from-a-log-file.md).</span></span>

## <a name="reading-from-multiple-log-files"></a><span data-ttu-id="92812-122">Lendo de vários arquivos de log</span><span class="sxs-lookup"><span data-stu-id="92812-122">Reading from multiple log files</span></span>

<span data-ttu-id="92812-123">Se você precisar criar uma consulta que leia de vários arquivos de log, chame o [**PdhBindInputDataSource**](/windows/desktop/api/Pdh/nf-pdh-pdhbindinputdatasourcea) para associar os arquivos de log ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="92812-123">If you need to create a query that reads from several log files, call the [**PdhBindInputDataSource**](/windows/desktop/api/Pdh/nf-pdh-pdhbindinputdatasourcea) to bind the log files together.</span></span> <span data-ttu-id="92812-124">Em seguida, você precisa usar funções de PDH que terminem em ' H ', por exemplo, [**PdhOpenQueryH**](/windows/desktop/api/Pdh/nf-pdh-pdhopenqueryh).</span><span class="sxs-lookup"><span data-stu-id="92812-124">You then need to use PDH functions that end in 'H', for example, [**PdhOpenQueryH**](/windows/desktop/api/Pdh/nf-pdh-pdhopenqueryh).</span></span>

## <a name="writing-to-a-log-file"></a><span data-ttu-id="92812-125">Gravando em um arquivo de log</span><span class="sxs-lookup"><span data-stu-id="92812-125">Writing to a log file</span></span>

<span data-ttu-id="92812-126">Antes de gravar em um arquivo de log, chame [**PdhOpenQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhopenquerya) para criar uma consulta e especificar a origem dos dados de desempenho, tanto os dados em tempo real quanto um arquivo de log.</span><span class="sxs-lookup"><span data-stu-id="92812-126">Before writing to a log file, call [**PdhOpenQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhopenquerya) to create a query and specify the source of the performance data, either real time data or a log file.</span></span> <span data-ttu-id="92812-127">Em seguida, adicione os contadores que você deseja consultar.</span><span class="sxs-lookup"><span data-stu-id="92812-127">Then, add the counters that you want to query.</span></span>

<span data-ttu-id="92812-128">Para abrir o arquivo de destino, chame [**PdhOpenLog**](/windows/desktop/api/Pdh/nf-pdh-pdhopenloga).</span><span class="sxs-lookup"><span data-stu-id="92812-128">To open the destination file, call [**PdhOpenLog**](/windows/desktop/api/Pdh/nf-pdh-pdhopenloga).</span></span> <span data-ttu-id="92812-129">Especifique a consulta ao abrir o arquivo de log.</span><span class="sxs-lookup"><span data-stu-id="92812-129">Specify the query when you open the log file.</span></span> <span data-ttu-id="92812-130">Para coletar os dados de desempenho e gravá-los no arquivo de log, chame [**PdhUpdateLog**](/windows/desktop/api/Pdh/nf-pdh-pdhupdateloga).</span><span class="sxs-lookup"><span data-stu-id="92812-130">To collect the performance data and write it to the log file, call [**PdhUpdateLog**](/windows/desktop/api/Pdh/nf-pdh-pdhupdateloga).</span></span>

<span data-ttu-id="92812-131">Se os dados do contador estiverem sendo gravados em um arquivo de log delimitado por vírgula (. csv) ou delimitado por tabulação (. tsv) e o caminho contiver uma instância curinga, o caminho será expandido e somente as instâncias existentes no momento em que o caminho for expandido serão incluídas no arquivo de log.</span><span class="sxs-lookup"><span data-stu-id="92812-131">If the counter data is being written to comma-delimited (.csv) or tab-delimited (.tsv) log file and the path contains a wildcard instance, the path is expanded and only those instances that exist at the time the path is expanded are included in the log file.</span></span> <span data-ttu-id="92812-132">No entanto, para arquivos de log binários (. blg) ou SQL, o curinga não é expandido para que o arquivo de log contenha instâncias criadas durante o registro em log.</span><span class="sxs-lookup"><span data-stu-id="92812-132">However, for binary (.blg) or SQL log files, the wildcard is not expanded so that the log file contains instances that are created during logging.</span></span>

<span data-ttu-id="92812-133">Para obter um exemplo que grava dados em um arquivo de log, consulte [gravando dados de desempenho em um arquivo de log](writing-performance-data-to-a-log-file.md).</span><span class="sxs-lookup"><span data-stu-id="92812-133">For an example that writes data to a log file, see [Writing Performance Data to a Log File](writing-performance-data-to-a-log-file.md).</span></span>

## <a name="compressing-a-log-file"></a><span data-ttu-id="92812-134">Compactando um arquivo de log</span><span class="sxs-lookup"><span data-stu-id="92812-134">Compressing a log file</span></span>

<span data-ttu-id="92812-135">Você pode usar a função [**PdhComputeCounterStatistics**](/windows/desktop/api/Pdh/nf-pdh-pdhcomputecounterstatistics) para compactar um arquivo de log.</span><span class="sxs-lookup"><span data-stu-id="92812-135">You can use the [**PdhComputeCounterStatistics**](/windows/desktop/api/Pdh/nf-pdh-pdhcomputecounterstatistics) function to compress a log file.</span></span> <span data-ttu-id="92812-136">Por exemplo, leia dez registros de um arquivo de log, chame **PdhComputeCounterStatistics** para calcular o valor médio e, em seguida, grave o valor médio em um arquivo de log de saída.</span><span class="sxs-lookup"><span data-stu-id="92812-136">For example, read ten records from a log file, call **PdhComputeCounterStatistics** to compute the mean value and then write the mean value to an output log file.</span></span>

<span data-ttu-id="92812-137">O tópico a seguir fornece informações adicionais sobre como usar um arquivo de log.</span><span class="sxs-lookup"><span data-stu-id="92812-137">The following topic provides additional information on using a log file.</span></span>

-   [<span data-ttu-id="92812-138">Obtendo o tamanho de um arquivo de log</span><span class="sxs-lookup"><span data-stu-id="92812-138">Getting the Size of a Log File</span></span>](getting-the-size-of-a-log-file.md)

 

 



