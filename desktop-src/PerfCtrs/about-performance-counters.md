---
description: Os contadores são usados para fornecer informações sobre o desempenho do sistema operacional ou de um aplicativo, serviço ou driver.
ms.assetid: d172a131-61d3-4fc1-8e0c-b07b2bd34f80
title: Sobre contadores de desempenho
ms.topic: article
ms.date: 08/17/2020
ms.openlocfilehash: dec7c71e99ab614ee64e3d1e8c9620f0be78c14a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103828398"
---
# <a name="about-performance-counters"></a><span data-ttu-id="99501-103">Sobre contadores de desempenho</span><span class="sxs-lookup"><span data-stu-id="99501-103">About Performance Counters</span></span>

<span data-ttu-id="99501-104">Os contadores de desempenho do Windows fornecem uma camada de abstração de alto nível com uma interface consistente para coletar vários tipos de dados do sistema, como estatísticas de uso de CPU, memória e disco.</span><span class="sxs-lookup"><span data-stu-id="99501-104">Windows Performance Counters provide a high-level abstraction layer with a consistent interface for collecting various kinds of system data such as CPU, memory, and disk usage statistics.</span></span> <span data-ttu-id="99501-105">Os administradores de sistema usam contadores de desempenho para monitorar problemas de desempenho ou comportamento.</span><span class="sxs-lookup"><span data-stu-id="99501-105">System administrators use performance counters to monitor for performance or behavior problems.</span></span> <span data-ttu-id="99501-106">Os desenvolvedores de software usam contadores de desempenho para inspecionar o uso de recursos de seus componentes.</span><span class="sxs-lookup"><span data-stu-id="99501-106">Software developers use performance counters to inspect the resource usage of their components.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="99501-107">Os contadores de desempenho do Windows são otimizados para descoberta e coleta de dados administrativos/de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="99501-107">Windows Performance Counters are optimized for administrative/diagnostic data discovery and collection.</span></span> <span data-ttu-id="99501-108">Eles não são apropriados para a coleta de dados de alta frequência ou para a criação de perfil de aplicativo, pois não foram projetados para serem coletados mais de uma vez por segundo.</span><span class="sxs-lookup"><span data-stu-id="99501-108">They are not appropriate for high-frequency data collection or for application profiling since they are not designed to be collected more than once per second.</span></span> <span data-ttu-id="99501-109">Para obter acesso de baixa sobrecarga às informações do sistema, você pode preferir APIs mais diretas, como [**auxiliar de status de processo**](../psapi/process-status-helper.md), [**GlobalMemoryStatusEx**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-globalmemorystatusex), [**GetSystemTimes**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getsystemtimes)ou [**GetProcessTimes**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getprocesstimes).</span><span class="sxs-lookup"><span data-stu-id="99501-109">For lower-overhead access to system information, you might prefer more direct APIs such as [**Process Status Helper**](../psapi/process-status-helper.md), [**GlobalMemoryStatusEx**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-globalmemorystatusex), [**GetSystemTimes**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getsystemtimes), or [**GetProcessTimes**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getprocesstimes).</span></span> <span data-ttu-id="99501-110">Para a criação de perfil, você pode coletar logs do ETW com dados de criação de perfil do sistema usando [**tracelog.exe**](/windows-hardware/drivers/devtest/tracelog) com `-critsec` `-dpcisr` as opções,, ou `-eflag` `-ProfileSource` , ou você pode usar a [**criação de perfil de contador de hardware**](/previous-versions/windows/desktop/hcp/hcp-reference).</span><span class="sxs-lookup"><span data-stu-id="99501-110">For profiling, you might collect ETW logs with system profiling data using [**tracelog.exe**](/windows-hardware/drivers/devtest/tracelog) with `-critsec`, `-dpcisr`, `-eflag`, or `-ProfileSource` options, or you might use [**Hardware Counter Profiling**](/previous-versions/windows/desktop/hcp/hcp-reference).</span></span>

> [!NOTE]
> <span data-ttu-id="99501-111">Não confunda contadores de desempenho do Windows com a API [**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) .</span><span class="sxs-lookup"><span data-stu-id="99501-111">Do not confuse Windows Performance Counters with the [**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) API.</span></span> <span data-ttu-id="99501-112">Os contadores de desempenho do Windows fornecem uma abstração de alto nível para muitos tipos de informações do sistema.</span><span class="sxs-lookup"><span data-stu-id="99501-112">Windows Performance Counters provide a high-level abstraction for many kinds of system information.</span></span> <span data-ttu-id="99501-113">A função QueryPerformanceCounter fornece acesso otimizado a um carimbo de data/hora de alta precisão.</span><span class="sxs-lookup"><span data-stu-id="99501-113">The QueryPerformanceCounter function provides optimized access to a high-precision timestamp.</span></span>

## <a name="getting-started"></a><span data-ttu-id="99501-114">Introdução</span><span class="sxs-lookup"><span data-stu-id="99501-114">Getting Started</span></span>

- <span data-ttu-id="99501-115">Use as [Ferramentas do contador de desempenho](performance-counters-tools.md) quando desejar coletar ou exibir os dados de desempenho de um sistema.</span><span class="sxs-lookup"><span data-stu-id="99501-115">Use [Performance Counter Tools](performance-counters-tools.md) when you want to collect or view the performance data from a system.</span></span>
- <span data-ttu-id="99501-116">Use as [APIs de coleta do contador de desempenho](consuming-counter-data.md) quando desejar escrever um script ou um programa que coleta dados de desempenho do sistema local.</span><span class="sxs-lookup"><span data-stu-id="99501-116">Use [Performance Counter Collection APIs](consuming-counter-data.md) when you want to write a script or a program that collects performance data from the local system.</span></span>
- <span data-ttu-id="99501-117">Use as [classes do contador de desempenho do WMI](/windows/desktop/WmiSdk/monitoring-performance-data) quando desejar coletar dados de desempenho de um sistema local ou remoto usando o WMI.</span><span class="sxs-lookup"><span data-stu-id="99501-117">Use [WMI Performance Counter Classes](/windows/desktop/WmiSdk/monitoring-performance-data) when you want to collect performance data from a local or remote system using WMI.</span></span>
- <span data-ttu-id="99501-118">Use as [APIs do provedor de contador de desempenho](providing-counter-data.md) quando desejar publicar dados de desempenho do seu componente de software.</span><span class="sxs-lookup"><span data-stu-id="99501-118">Use [Performance Counter Provider APIs](providing-counter-data.md) when you want to publish performance data from your software component.</span></span>

## <a name="concepts"></a><span data-ttu-id="99501-119">Conceitos</span><span class="sxs-lookup"><span data-stu-id="99501-119">Concepts</span></span>

<span data-ttu-id="99501-120">O sistema do contador de desempenho do Windows é organizado em **consumidores**, **provedores**, **conjuntos** de contracoleções, **contadores**, **instâncias** e **valores de contador**.</span><span class="sxs-lookup"><span data-stu-id="99501-120">The Windows Performance Counter system is organized into **consumers**, **providers**, **countersets**, **counters**, **instances**, and **counter values**.</span></span>

<span data-ttu-id="99501-121">Um **consumidor** é um componente de software que utiliza dados de desempenho.</span><span class="sxs-lookup"><span data-stu-id="99501-121">A **consumer** is a software component that makes use of performance data.</span></span> <span data-ttu-id="99501-122">O Windows inclui várias [ferramentas internas](performance-counters-tools.md) que fazem uso de dados de desempenho.</span><span class="sxs-lookup"><span data-stu-id="99501-122">Windows includes several [built-in tools](performance-counters-tools.md) that make use of performance data.</span></span> <span data-ttu-id="99501-123">Isso inclui o Gerenciador de tarefas, Monitor de Recursos, monitor de desempenho, typeperf.exe, logman.exe e relog.exe.</span><span class="sxs-lookup"><span data-stu-id="99501-123">These include Task Manager, Resource Monitor, Performance Monitor, typeperf.exe, logman.exe, and relog.exe.</span></span> <span data-ttu-id="99501-124">Os desenvolvedores podem gravar scripts e aplicativos que acessam contadores de desempenho por meio de [APIs de contador de desempenho](consuming-counter-data.md).</span><span class="sxs-lookup"><span data-stu-id="99501-124">Developers can write scripts and applications that access performance counters via [performance counter APIs](consuming-counter-data.md).</span></span>

<span data-ttu-id="99501-125">Um **provedor** é um componente de software que [gera e publica dados de desempenho](providing-counter-data.md).</span><span class="sxs-lookup"><span data-stu-id="99501-125">A **provider** is a software component that [generates and publishes performance data](providing-counter-data.md).</span></span> <span data-ttu-id="99501-126">Um provedor publicará dados para um ou mais *conjuntos* de linhas.</span><span class="sxs-lookup"><span data-stu-id="99501-126">A provider will publish data for one or more *countersets*.</span></span> <span data-ttu-id="99501-127">Por exemplo, um sistema de banco de dados pode se registrar como um provedor de dado de desempenho.</span><span class="sxs-lookup"><span data-stu-id="99501-127">For example, a database system might register itself as a performance data provider.</span></span>

- <span data-ttu-id="99501-128">Um **provedor v1** é um componente de software que publica dados de desempenho por meio de uma [dll de desempenho](providing-counter-data-using-a-performance-dll.md) que é executada no processo do consumidor.</span><span class="sxs-lookup"><span data-stu-id="99501-128">A **V1 provider** is a software component that publishes performance data via a [performance DLL](providing-counter-data-using-a-performance-dll.md) that runs in the process of the consumer.</span></span> <span data-ttu-id="99501-129">Um provedor v1 é instalado em um sistema por meio de um `.ini` arquivo.</span><span class="sxs-lookup"><span data-stu-id="99501-129">A V1 provider is installed onto a system via an `.ini` file.</span></span> <span data-ttu-id="99501-130">A arquitetura do provedor v1 foi preterida.</span><span class="sxs-lookup"><span data-stu-id="99501-130">The V1 provider architecture is deprecated.</span></span> <span data-ttu-id="99501-131">Novos provedores devem usar a arquitetura do provedor v2.</span><span class="sxs-lookup"><span data-stu-id="99501-131">New providers should use the V2 provider architecture.</span></span>
- <span data-ttu-id="99501-132">Um **provedor v2** é um componente de software que publica dados de desempenho por meio das [APIs do provedor de contador de desempenho](providing-counter-data-using-version-2-0.md).</span><span class="sxs-lookup"><span data-stu-id="99501-132">A **V2 provider** is a software component that publishes performance data via the [performance counter provider APIs](providing-counter-data-using-version-2-0.md).</span></span> <span data-ttu-id="99501-133">Um provedor V2 é instalado em um sistema por meio de um `.man` arquivo (manifesto XML).</span><span class="sxs-lookup"><span data-stu-id="99501-133">A V2 provider is installed onto a system via a `.man` (XML manifest) file.</span></span>

<span data-ttu-id="99501-134">Um **CounterSet** é um agrupamento de dados de desempenho dentro de um provedor.</span><span class="sxs-lookup"><span data-stu-id="99501-134">A **counterset** is a grouping of performance data within a provider.</span></span> <span data-ttu-id="99501-135">Um CounterSet tem um nome e um ou mais *contadores*.</span><span class="sxs-lookup"><span data-stu-id="99501-135">A counterset has a name and one or more *counters*.</span></span> <span data-ttu-id="99501-136">A coleta de dados de um CounterSet retorna um número de *instâncias*.</span><span class="sxs-lookup"><span data-stu-id="99501-136">Collecting the data from a counterset returns a number of *instances*.</span></span> <span data-ttu-id="99501-137">Em algumas APIs do Windows, os conjuntos de contraissores são chamados de **objetos de desempenho**.</span><span class="sxs-lookup"><span data-stu-id="99501-137">In some Windows APIs, countersets are called **performance objects**.</span></span> <span data-ttu-id="99501-138">Por exemplo, um provedor de dados de desempenho para um sistema de banco de dado pode fornecer um CounterSet para estatísticas por banco de dados.</span><span class="sxs-lookup"><span data-stu-id="99501-138">For example, a performance data provider for a database system might provide a counterset for per-database statistics.</span></span>

<span data-ttu-id="99501-139">Um **contador** é a definição de um único dado de desempenho.</span><span class="sxs-lookup"><span data-stu-id="99501-139">A **counter** is the definition of single piece of performance data.</span></span> <span data-ttu-id="99501-140">Um contador tem um nome e um tipo.</span><span class="sxs-lookup"><span data-stu-id="99501-140">A counter has a name and a type.</span></span> <span data-ttu-id="99501-141">Por exemplo, um CounterSet "estatísticas por banco de dados" pode conter um contador chamado "transações por segundo" com o tipo `PERF_COUNTER_COUNTER` .</span><span class="sxs-lookup"><span data-stu-id="99501-141">For example, a "per-database statistics" counterset might contain a counter named "transactions per second" with type `PERF_COUNTER_COUNTER`.</span></span>

<span data-ttu-id="99501-142">Uma **instância** é uma entidade sobre a qual os dados de desempenho são relatados.</span><span class="sxs-lookup"><span data-stu-id="99501-142">An **instance** is an entity about which performance data is reported.</span></span> <span data-ttu-id="99501-143">Uma instância tem um nome (cadeia de caracteres) e um ou mais *valores de contador*.</span><span class="sxs-lookup"><span data-stu-id="99501-143">An instance has a name (string) and one or more *counter values*.</span></span> <span data-ttu-id="99501-144">Por exemplo, um CounterSet "estatísticas por banco de dados" pode conter uma instância por banco de dados.</span><span class="sxs-lookup"><span data-stu-id="99501-144">For example, a "per-database statistics" counterset might contain one instance per database.</span></span> <span data-ttu-id="99501-145">O nome da instância seria o nome do banco de dados, e cada instância conteria valores de contador para os contadores "transações por segundo", "uso de memória" e "uso do disco".</span><span class="sxs-lookup"><span data-stu-id="99501-145">The instance name would be the database name, and each instance would contain counter values for "transactions per second", "memory usage", and "disk usage" counters.</span></span>

<span data-ttu-id="99501-146">Um **valor de contador** é o valor de uma única parte dos dados do contador de desempenho.</span><span class="sxs-lookup"><span data-stu-id="99501-146">A **counter value** is the value of a single piece of performance counter data.</span></span> <span data-ttu-id="99501-147">Um valor de contador é um inteiro não assinado, de 32 bits ou de 64 bits, dependendo do tipo do contador correspondente.</span><span class="sxs-lookup"><span data-stu-id="99501-147">A counter value is an unsigned integer, either 32-bit or 64-bit depending on the type of the corresponding counter.</span></span> <span data-ttu-id="99501-148">Ao falar sobre uma *instância*, um *valor de contador* pode, às vezes, ser chamado de *contador* ou *valor*.</span><span class="sxs-lookup"><span data-stu-id="99501-148">When talking about an *instance*, a *counter value* might sometimes be called a *counter* or a *value*.</span></span>

> [!TIP]
> <span data-ttu-id="99501-149">Pode ser útil relacionar os termos do contador de desempenho a termos de planilha mais familiares.</span><span class="sxs-lookup"><span data-stu-id="99501-149">It might be helpful to relate performance counter terms to more familiar spreadsheet terms.</span></span> <span data-ttu-id="99501-150">Um **CounterSet** é como uma tabela.</span><span class="sxs-lookup"><span data-stu-id="99501-150">A **counterset** is like a table.</span></span> <span data-ttu-id="99501-151">Um **contador** é como uma coluna.</span><span class="sxs-lookup"><span data-stu-id="99501-151">A **counter** is like a column.</span></span> <span data-ttu-id="99501-152">Uma **instância** é como uma linha.</span><span class="sxs-lookup"><span data-stu-id="99501-152">An **instance** is like a row.</span></span> <span data-ttu-id="99501-153">Um **valor de contador** é como uma célula na tabela.</span><span class="sxs-lookup"><span data-stu-id="99501-153">A **counter value** is like a cell in the table.</span></span>

<span data-ttu-id="99501-154">Os **conjuntos de itens de instância única** sempre contêm dados para exatamente uma instância.</span><span class="sxs-lookup"><span data-stu-id="99501-154">**Single-instance countersets** always contain data for exactly one instance.</span></span> <span data-ttu-id="99501-155">Isso é comum para conjuntos de linhas que relatam estatísticas globais do sistema.</span><span class="sxs-lookup"><span data-stu-id="99501-155">This is common for countersets that report system-global statistics.</span></span> <span data-ttu-id="99501-156">Por exemplo, o Windows tem um contador de instância única interno chamado "memória" que relata o uso de memória global.</span><span class="sxs-lookup"><span data-stu-id="99501-156">For example, Windows has a built-in single-instance counterset named "Memory" that reports on global memory usage.</span></span>

<span data-ttu-id="99501-157">Os **conjuntos de contrainstâncias de várias** instâncias contêm dados para um número variável de instâncias.</span><span class="sxs-lookup"><span data-stu-id="99501-157">**Multi-instance countersets** contain data for a variable number of instances.</span></span> <span data-ttu-id="99501-158">Isso é comum para conjuntos de linhas que relatam sobre entidades no sistema.</span><span class="sxs-lookup"><span data-stu-id="99501-158">This is common for countersets that report about entities within the system.</span></span> <span data-ttu-id="99501-159">Por exemplo, o Windows tem um contador de várias instâncias interno chamado "informações do processador" que relata uma instância para cada CPU instalada.</span><span class="sxs-lookup"><span data-stu-id="99501-159">For example, Windows has a built-in multi-instance counterset named "Processor Information" that reports one instance for each installed CPU.</span></span>

<span data-ttu-id="99501-160">Os consumidores coletarão e registrarão periodicamente os dados do contador de contadores de um provedor.</span><span class="sxs-lookup"><span data-stu-id="99501-160">Consumers will periodically collect and record the data from a provider's counterset.</span></span> <span data-ttu-id="99501-161">Por exemplo, o consumidor pode coletar dados uma vez por segundo ou uma vez por minuto.</span><span class="sxs-lookup"><span data-stu-id="99501-161">For example, the consumer might collect data once per second or once per minute.</span></span> <span data-ttu-id="99501-162">Os dados coletados são chamados de **exemplo**.</span><span class="sxs-lookup"><span data-stu-id="99501-162">The data collected is called a **sample**.</span></span> <span data-ttu-id="99501-163">Um exemplo consiste em carimbos de data/hora junto com os dados para instâncias do CounterSet.</span><span class="sxs-lookup"><span data-stu-id="99501-163">A sample consists of timestamps along with the data for instances of the counterset.</span></span> <span data-ttu-id="99501-164">Os dados de cada instância incluem o nome da instância (cadeia de caracteres) e um conjunto de valores de contadores (inteiros, um valor para cada contador no CounterSet).</span><span class="sxs-lookup"><span data-stu-id="99501-164">The data for each instance includes the instance name (string) and a set of counter values (integers, one value for each counter in the counterset).</span></span>

<span data-ttu-id="99501-165">Nomes de instância normalmente devem ser exclusivos em um exemplo, ou seja, um provedor não deve retornar duas instâncias com o mesmo nome que parte de um único exemplo.</span><span class="sxs-lookup"><span data-stu-id="99501-165">Instance names should normally be unique within a sample, i.e. a provider should not return two instances with the same name as part of a single sample.</span></span> <span data-ttu-id="99501-166">Alguns provedores mais antigos não seguem essa regra, portanto, os [consumidores devem ser capazes de tolerar nomes de instância não exclusivos](handling-duplicate-instance-names.md).</span><span class="sxs-lookup"><span data-stu-id="99501-166">Some older providers do not follow this rule, so [consumers must be able to tolerate non-unique instance names](handling-duplicate-instance-names.md).</span></span> <span data-ttu-id="99501-167">Os nomes de instância não diferenciam maiúsculas de minúsculas, portanto, as instâncias não devem ter nomes que diferem apenas no caso.</span><span class="sxs-lookup"><span data-stu-id="99501-167">Instance names are not case-sensitive, so instances should not have names that differ only in case.</span></span>

> [!NOTE]
> <span data-ttu-id="99501-168">Para fins de compatibilidade com versões anteriores, o CounterSet "processo" retorna nomes de instância não exclusivos com base no nome de arquivo EXE.</span><span class="sxs-lookup"><span data-stu-id="99501-168">For backwards-compatibility reasons, the "Process" counterset returns non-unique instance names based on the EXE filename.</span></span> <span data-ttu-id="99501-169">Isso pode causar resultados confusos, especialmente quando um processo com um nome não exclusivo é iniciado ou desligado, pois isso normalmente resultará em problemas de dados devido à correspondência incorreta de nomes de instância entre exemplos.</span><span class="sxs-lookup"><span data-stu-id="99501-169">This can cause confusing results, especially when a process with a non-unique name starts up or shuts down, as this will typically result in data glitches due to incorrect matching of instance names between samples.</span></span> <span data-ttu-id="99501-170">Os consumidores do CounterSet "processo" devem ser capazes de tolerar esses nomes de instância não exclusiva e os problemas de dados resultantes.</span><span class="sxs-lookup"><span data-stu-id="99501-170">Consumers of of the "Process" counterset must be able to tolerate these non-unique instance names and the resulting data glitches.</span></span>

<span data-ttu-id="99501-171">Os nomes de instância devem ser estáveis entre amostras, ou seja, um provedor deve usar o mesmo nome de instância para a mesma entidade sempre que o CounterSet for coletado.</span><span class="sxs-lookup"><span data-stu-id="99501-171">Instance names must be stable across samples, i.e. a provider should use the same instance name for the same entity each time the counterset is collected.</span></span>

<span data-ttu-id="99501-172">Cada contador tem um tipo.</span><span class="sxs-lookup"><span data-stu-id="99501-172">Each counter has a type.</span></span> <span data-ttu-id="99501-173">O tipo de contador indica o tipo de **valor bruto** do contador (inteiro de 32 bits sem sinal ou um inteiro de 64 bits não assinado).</span><span class="sxs-lookup"><span data-stu-id="99501-173">The counter type indicates the type of the counter's **raw value** (either unsigned 32-bit integer or unsigned 64-bit integer).</span></span> <span data-ttu-id="99501-174">O tipo de contador também indica o que o valor bruto do contador representa, que determina como o valor bruto deve ser processado para gerar estatísticas úteis.</span><span class="sxs-lookup"><span data-stu-id="99501-174">The counter type also indicates what the counter's raw value represents, which determines how the raw value should be processed to generate useful statistics.</span></span>

<span data-ttu-id="99501-175">Embora alguns tipos de contadores sejam simples e tenham um valor bruto que seja diretamente útil, muitos tipos de contadores exigem [processamento adicional](calculating-counter-values.md) para criar um **valor formatado** útil.</span><span class="sxs-lookup"><span data-stu-id="99501-175">While some counter types are simple and have a raw value that is directly useful, many counter types require [additional processing](calculating-counter-values.md) to create a useful **formatted value**.</span></span> <span data-ttu-id="99501-176">Para produzir o valor formatado, alguns tipos de contadores exigem valores brutos de dois exemplos, alguns tipos de contadores exigem carimbos de data/hora e alguns tipos de contadores exigem valores brutos de vários contadores.</span><span class="sxs-lookup"><span data-stu-id="99501-176">To produce the formatted value, some counter types require raw values from two samples, some counter types require timestamps, and some counter types require raw values from multiple counters.</span></span> <span data-ttu-id="99501-177">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="99501-177">For example:</span></span>

- <span data-ttu-id="99501-178">`PERF_COUNTER_LARGE_RAWCOUNT` é um valor bruto de 64 bits que não requer nenhum processamento para ser útil.</span><span class="sxs-lookup"><span data-stu-id="99501-178">`PERF_COUNTER_LARGE_RAWCOUNT` is a 64-bit raw value that requires no processing to be useful.</span></span> <span data-ttu-id="99501-179">É apropriado para valores de ponto no tempo, como "bytes de memória em uso".</span><span class="sxs-lookup"><span data-stu-id="99501-179">It is appropriate for point-in-time values such as "Bytes of memory in use".</span></span>
- <span data-ttu-id="99501-180">`PERF_COUNTER_RAWCOUNT_HEX` é um valor bruto de 32 bits que requer que apenas formatação hexadecimal simples seja útil.</span><span class="sxs-lookup"><span data-stu-id="99501-180">`PERF_COUNTER_RAWCOUNT_HEX` is a 32-bit raw value that requires only simple hexadecimal formatting to be useful.</span></span> <span data-ttu-id="99501-181">Ele é apropriado para o ponto no tempo ou para identificar informações como "Flags" ou "endereço base".</span><span class="sxs-lookup"><span data-stu-id="99501-181">It is appropriate for point-in-time or identifying information such as "Flags" or "Base Address".</span></span>
- <span data-ttu-id="99501-182">`PERF_COUNTER_BULK_COUNT` é um valor bruto de 64 bits que indica uma contagem de eventos e é usado para calcular a taxa na qual os eventos ocorrem.</span><span class="sxs-lookup"><span data-stu-id="99501-182">`PERF_COUNTER_BULK_COUNT` is a 64-bit raw value that indicates a count of events and is used to compute the rate at which the events occur.</span></span> <span data-ttu-id="99501-183">Para ser útil, esse tipo de contador requer dois exemplos separados no tempo.</span><span class="sxs-lookup"><span data-stu-id="99501-183">To be useful, this counter type requires two samples that are separated in time.</span></span> <span data-ttu-id="99501-184">O valor formatado é a taxa de evento, ou seja, o número de vezes que o evento ocorreu por segundo no intervalo entre os dois exemplos.</span><span class="sxs-lookup"><span data-stu-id="99501-184">The formatted value is the event rate, i.e. the number of times the event occurred per second over the interval between the two samples.</span></span> <span data-ttu-id="99501-185">Considerando dois exemplos `s0` e `s1` , o valor formatado (taxa de evento) seria calculado como `(s1.EventCount - s0.EventCount)/(s1.TimestampInSeconds - s0.TimestampInSeconds)` .</span><span class="sxs-lookup"><span data-stu-id="99501-185">Given two samples `s0` and `s1`, the formatted value (event rate) would be computed as `(s1.EventCount - s0.EventCount)/(s1.TimestampInSeconds - s0.TimestampInSeconds)`.</span></span>

<span data-ttu-id="99501-186">Os provedores devem se comportar como se fossem sem estado, ou seja, coletar dados de um CounterSet não deve afetar visivelmente o estado do provedor.</span><span class="sxs-lookup"><span data-stu-id="99501-186">Providers are expected to behave as if they are stateless, i.e. collecting data from a counterset should not visibly affect the state of the provider.</span></span> <span data-ttu-id="99501-187">Por exemplo, um provedor não deve redefinir valores de contador como 0 quando um CounterSet é coletado e não deve usar o carimbo de data/hora de uma coleção anterior para ajustar os valores na coleção atual.</span><span class="sxs-lookup"><span data-stu-id="99501-187">For example, a provider should not reset counter values to 0 when a counterset is collected and it should not use the timestamp of a previous collection to adjust the values in the current collection.</span></span> <span data-ttu-id="99501-188">Em vez disso, ele deve fornecer valores de contador brutos simples com tipos precisos para que o consumidor possa calcular estatísticas úteis com base nos valores brutos e seus carimbos de data/hora.</span><span class="sxs-lookup"><span data-stu-id="99501-188">Instead, it should provide simple raw counter values with accurate types so that the consumer can compute useful statistics based on the raw values and their timestamps.</span></span>

## <a name="performance-api-architecture"></a><span data-ttu-id="99501-189">Arquitetura da API de desempenho</span><span class="sxs-lookup"><span data-stu-id="99501-189">Performance API Architecture</span></span>

![Os aplicativos do contador de desempenho chamam APIs do Windows que chamam provedores para obter dados de desempenho.](images/architecture.png)

<span data-ttu-id="99501-191">Os consumidores do contador de desempenho incluem:</span><span class="sxs-lookup"><span data-stu-id="99501-191">Performance counter consumers include:</span></span>

- <span data-ttu-id="99501-192">[Aplicativos fornecidos pela Microsoft](performance-counters-tools.md) , como o Gerenciador de tarefas, monitor de recursos, monitor de desempenho e typeperf.exe.</span><span class="sxs-lookup"><span data-stu-id="99501-192">[Microsoft-provided applications](performance-counters-tools.md) such as Task Manager, Resource Monitor, Performance Monitor, and typeperf.exe.</span></span>
- <span data-ttu-id="99501-193">As superfícies de API de alto nível fornecidas pela Microsoft que expõem dados do contador de desempenho, como [classes de desempenho WMI](/windows/desktop/WmiSdk/monitoring-performance-data).</span><span class="sxs-lookup"><span data-stu-id="99501-193">Microsoft-provided high-level API surfaces that expose performance counter data such as [WMI Performance Classes](/windows/desktop/WmiSdk/monitoring-performance-data).</span></span>
- <span data-ttu-id="99501-194">Seus próprios aplicativos ou scripts que usam as [APIs de consumidor do contador de desempenho](consuming-counter-data.md).</span><span class="sxs-lookup"><span data-stu-id="99501-194">Your own applications or scripts that use [performance counter consumer APIs](consuming-counter-data.md).</span></span>

<span data-ttu-id="99501-195">A maioria dos consumidores do contador de desempenho usa APIs de [PDH.dll](using-the-pdh-functions-to-consume-counter-data.md) para coletar dados de desempenho.</span><span class="sxs-lookup"><span data-stu-id="99501-195">Most performance counter consumers use APIs from [PDH.dll](using-the-pdh-functions-to-consume-counter-data.md) to collect performance data.</span></span> <span data-ttu-id="99501-196">A PDH gerencia muitos aspectos complexos da coleta de contadores de desempenho, como a análise de consultas, a correspondência de instâncias em vários exemplos e a computação de valores formatados dos dados brutos do contador.</span><span class="sxs-lookup"><span data-stu-id="99501-196">PDH manages many complex aspects of gathering performance counters such as parsing queries, matching up instances across multiple samples, and computing formatted values from the raw counter data.</span></span> <span data-ttu-id="99501-197">A implementação da PDH usa as APIs do registro ao consumir dados de um provedor v1 e usa as APIs de consumidor v2 ao consumir dados de um provedor v2.</span><span class="sxs-lookup"><span data-stu-id="99501-197">The PDH implementation uses the registry APIs when consuming data from a V1 provider and uses the V2 consumer APIs when consuming data from a V2 provider.</span></span>

<span data-ttu-id="99501-198">Alguns consumidores mais antigos do contador de desempenho usam as [APIs do registro](using-the-registry-functions-to-consume-counter-data.md) para coletar dados de desempenho da `HKEY_PERFORMANCE_DATA` chave do registro especial.</span><span class="sxs-lookup"><span data-stu-id="99501-198">Some older performance counter consumers use the [registry APIs](using-the-registry-functions-to-consume-counter-data.md) to collect performance data from the special `HKEY_PERFORMANCE_DATA` registry key.</span></span> <span data-ttu-id="99501-199">Isso não é recomendado para o novo código porque o processamento dos dados do registro é complexo e propenso a erros.</span><span class="sxs-lookup"><span data-stu-id="99501-199">This is not recommended for new code because processing the data from the registry is complex and error-prone.</span></span> <span data-ttu-id="99501-200">A implementação da API do registro diretamente dá suporte à coleta de dados de provedores v1.</span><span class="sxs-lookup"><span data-stu-id="99501-200">The registry API implementation directly supports collecting data from V1 providers.</span></span> <span data-ttu-id="99501-201">Ele é compatível indiretamente com a coleta de dados de provedores v2 por meio de uma camada de conversão que usa as APIs de consumidor v2.</span><span class="sxs-lookup"><span data-stu-id="99501-201">It indirectly supports collecting data from V2 providers through a translation layer that uses the V2 consumer APIs.</span></span>

<span data-ttu-id="99501-202">Alguns consumidores do contador de desempenho usam as [funções de consumidor do PerfLib v2](using-the-perflib-functions-to-consume-counter-data.md) para acessar diretamente os dados de provedores v2.</span><span class="sxs-lookup"><span data-stu-id="99501-202">Some performance counter consumers use the [PerfLib V2 Consumer functions](using-the-perflib-functions-to-consume-counter-data.md) to directly access data from V2 providers.</span></span> <span data-ttu-id="99501-203">Isso é mais complexo do que consumir dados usando as APIs de PDH, mas essa abordagem pode ser útil se as APIs de PDH não puderem ser usadas devido a questões de desempenho ou dependência.</span><span class="sxs-lookup"><span data-stu-id="99501-203">This is more complex than consuming data using the PDH APIs, but this approach can be useful if PDH APIs cannot be used due to performance or dependency concerns.</span></span> <span data-ttu-id="99501-204">A implementação de PerfLib v2 dá suporte diretamente à coleta de dados de provedores v2.</span><span class="sxs-lookup"><span data-stu-id="99501-204">The PerfLib V2 implementation directly supports collecting data from V2 providers.</span></span> <span data-ttu-id="99501-205">Ele não dá suporte à coleta de dados de provedores v1.</span><span class="sxs-lookup"><span data-stu-id="99501-205">It does not support collecting data from V1 providers.</span></span>

> [!NOTE]
> <span data-ttu-id="99501-206">O Windows OneCore não inclui PDH.dll e não inclui suporte para o consumo de dados do contador de desempenho por meio das APIs do registro.</span><span class="sxs-lookup"><span data-stu-id="99501-206">Windows OneCore does not include PDH.dll and does not include support for consuming performance counter data via the registry APIs.</span></span> <span data-ttu-id="99501-207">Os consumidores em execução no OneCore devem usar as funções de consumidor do PerfLib v2.</span><span class="sxs-lookup"><span data-stu-id="99501-207">Consumers running on OneCore must use the PerfLib V2 Consumer functions.</span></span>

<span data-ttu-id="99501-208">Os provedores v1 são implementados como uma DLL de provedor que é carregada no processo do consumidor.</span><span class="sxs-lookup"><span data-stu-id="99501-208">V1 providers are implemented as a provider DLL that is loaded into the consumer process.</span></span> <span data-ttu-id="99501-209">A implementação da API do registro gerencia o carregamento da DLL do provedor, chamando a DLL para coletar dados de desempenho e descarregar a DLL conforme apropriado.</span><span class="sxs-lookup"><span data-stu-id="99501-209">The registry API implementation manages loading the provider DLL, calling into the DLL to collect performance data, and unloading the DLL as appropriate.</span></span> <span data-ttu-id="99501-210">A DLL do provedor é responsável por [coletar dados de desempenho conforme apropriado](communicating-with-your-application.md), por exemplo, usando APIs normais do Windows, RPC, pipes nomeados, memória compartilhada ou outros mecanismos de comunicação entre processos.</span><span class="sxs-lookup"><span data-stu-id="99501-210">The provider DLL is responsible for [collecting performance data as appropriate](communicating-with-your-application.md), e.g. by using normal Windows APIs, RPC, named pipes, shared memory, or other interprocess communication mechanisms.</span></span>

<span data-ttu-id="99501-211">Os provedores v2 são implementados como um programa de modo de usuário (geralmente um serviço do Windows) ou um driver de modo kernel.</span><span class="sxs-lookup"><span data-stu-id="99501-211">V2 providers are implemented as either a user-mode program (often a Windows service) or a kernel-mode driver.</span></span> <span data-ttu-id="99501-212">Normalmente, o código do provedor de dados de desempenho é integrado diretamente a um componente existente (ou seja, o driver ou o serviço está relatando estatísticas sobre si mesmo).</span><span class="sxs-lookup"><span data-stu-id="99501-212">Usually the performance data provider code is integrated directly into an existing component (i.e. the driver or service is reporting statistics about itself).</span></span> <span data-ttu-id="99501-213">A implementação da PerfLib v2 gerencia solicitações e respostas por meio da extensão do kernel PCW.sys, de modo que o provedor geralmente não precisa implementar nenhuma comunicação entre processos para fornecer os dados de desempenho.</span><span class="sxs-lookup"><span data-stu-id="99501-213">The PerfLib V2 implementation manages requests and responses via the PCW.sys kernel extension so the provider usually does not need to implement any interprocess communication to provide the performance data.</span></span>

> [!NOTE]
> <span data-ttu-id="99501-214">Ferramentas e APIs do contador de desempenho do Windows incluem suporte limitado para acessar contadores de desempenho de outros computadores por meio do registro remoto (para provedores v1) e RPC (para provedores v2).</span><span class="sxs-lookup"><span data-stu-id="99501-214">Windows Performance Counter APIs and tools include limited support for accessing performance counters from other machines via Remote Registry (for V1 providers) and RPC (for V2 providers).</span></span> <span data-ttu-id="99501-215">Esse suporte é muitas vezes difícil de usar em termos de controles de autenticação (as ferramentas e as APIs só podem ser autenticadas como o usuário atual), bem como em termos de [configuração do sistema](accessing-remote-counter-data.md) (os pontos de extremidade e serviços necessários são desabilitados por padrão).</span><span class="sxs-lookup"><span data-stu-id="99501-215">This support is often hard to use in terms of authentication controls (the tools and APIs can only authenticate as the current user) as well as in terms of [system configuration](accessing-remote-counter-data.md) (the necessary endpoints and services are disabled by default).</span></span> <span data-ttu-id="99501-216">Em muitos casos, é melhor acessar os contadores de desempenho de sistemas remotos via [WMI](/windows/desktop/WmiSdk/monitoring-performance-data) em vez de por meio do suporte interno a acesso remoto.</span><span class="sxs-lookup"><span data-stu-id="99501-216">In many cases, it is better to access the performance counters of remote systems via [WMI](/windows/desktop/WmiSdk/monitoring-performance-data) rather than via the built-in remote access support.</span></span>

## <a name="developer-audience"></a><span data-ttu-id="99501-217">Público de desenvolvedores</span><span class="sxs-lookup"><span data-stu-id="99501-217">Developer audience</span></span>

<span data-ttu-id="99501-218">Os contadores de desempenho são frequentemente consumidos por administradores para identificar problemas de desempenho ou comportamento anormal dos sistemas, por desenvolvedores para estudar o uso de recursos de componentes de software e por usuários individuais para entender como os programas estão se comportando em seu sistema.</span><span class="sxs-lookup"><span data-stu-id="99501-218">Performance counters are often consumed by administrators to identify performance issues or abnormal behavior of systems, by developers to study resource usage of software components, and by individual users to understand how programs are behaving on their system.</span></span> <span data-ttu-id="99501-219">O uso pode ocorrer por meio de ferramentas de GUI, como o Gerenciador de tarefas ou o monitor de desempenho, ferramentas de linha de comando como typeperf.exe ou logman.exe, por meio de scripts via WMI e PowerShell, ou por meio de APIs C/C++ e .NET.</span><span class="sxs-lookup"><span data-stu-id="99501-219">Usage may occur via GUI tools like Task Manager or Performance Monitor, command-line tools like typeperf.exe or logman.exe, via scripting via WMI and PowerShell, or through C/C++ and .NET APIs.</span></span>

<span data-ttu-id="99501-220">Os provedores de contador de desempenho geralmente são implementados como drivers de modo kernel ou serviços de modo de usuário.</span><span class="sxs-lookup"><span data-stu-id="99501-220">Performance counter providers are usually implemented as kernel-mode drivers or user-mode services.</span></span> <span data-ttu-id="99501-221">Os provedores de contador de desempenho são geralmente escritos em C ou C++.</span><span class="sxs-lookup"><span data-stu-id="99501-221">Performance counter providers are usually written in C or C++.</span></span>

## <a name="run-time-requirements"></a><span data-ttu-id="99501-222">Requisitos de tempo de execução</span><span class="sxs-lookup"><span data-stu-id="99501-222">Run-time requirements</span></span>

<span data-ttu-id="99501-223">Para obter informações sobre os requisitos de tempo de execução para um determinado elemento de programação, consulte a seção requisitos da página de referência para esse elemento.</span><span class="sxs-lookup"><span data-stu-id="99501-223">For information about run-time requirements for a particular programming element, see the Requirements section of the reference page for that element.</span></span>

<span data-ttu-id="99501-224">Para obter o histórico de versão, consulte [novidades](performance-counters-what-s-new.md).</span><span class="sxs-lookup"><span data-stu-id="99501-224">For version history, see [What's New](performance-counters-what-s-new.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="99501-225">Confira também</span><span class="sxs-lookup"><span data-stu-id="99501-225">See also</span></span>

[<span data-ttu-id="99501-226">Utilizando contadores de desempenho</span><span class="sxs-lookup"><span data-stu-id="99501-226">Using Performance Counters</span></span>](using-performance-counters.md)

[<span data-ttu-id="99501-227">Referência de contadores de desempenho</span><span class="sxs-lookup"><span data-stu-id="99501-227">Performance Counters Reference</span></span>](performance-counters-reference.md)
