---
description: A ferramenta CTRPP é um pré-processador que analisa e valida o manifesto de contadores.
ms.assetid: 3939f6a1-0a94-429d-a71e-b37f045fea13
title: CTRPP
ms.topic: reference
ms.date: 08/17/2020
topic_type:
- APIRef
- kbSyntax
api_name:
- CTRPP
api_type:
- NA
api_location: ''
ms.openlocfilehash: dce12de641dda7b07871a4447190772533598748
ms.sourcegitcommit: de72a1294df274b0a71dc0fdc42d757e5f6df0f3
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/05/2021
ms.locfileid: "104298020"
---
# <a name="ctrpp"></a><span data-ttu-id="62aee-103">CTRPP</span><span class="sxs-lookup"><span data-stu-id="62aee-103">CTRPP</span></span>

<span data-ttu-id="62aee-104">A ferramenta CTRPP é um pré-processador que analisa e valida o manifesto para seu provedor v2.</span><span class="sxs-lookup"><span data-stu-id="62aee-104">The CTRPP tool is a pre-processor that parses and validates the manifest for your V2 provider.</span></span> <span data-ttu-id="62aee-105">A ferramenta gera `.rc` recursos com as cadeias de caracteres necessárias aos consumidores do seu provedor e gera um `.h` cabeçalho com o código que você usa para fornecer os dados do contador.</span><span class="sxs-lookup"><span data-stu-id="62aee-105">The tool generates `.rc` resources with the strings needed by consumers of your provider, and it generates a `.h` header with code that you use to provide your counter data.</span></span> <span data-ttu-id="62aee-106">Você deve executar a ferramenta CTRPP durante a compilação do seu provedor.</span><span class="sxs-lookup"><span data-stu-id="62aee-106">You should run the CTRPP tool during the build of your provider.</span></span> <span data-ttu-id="62aee-107">Você deve usar o código gerado como um ponto de partida ao desenvolver seu provedor em vez de tentar gerar esse código por conta própria.</span><span class="sxs-lookup"><span data-stu-id="62aee-107">You should use the generated code as a starting point when developing your provider instead of trying to generate this code yourself.</span></span>

```syntax
ctrpp -o codeFile -rc rcFile [-legacy] [-MemoryRoutines] [-NotificationCallback] [-prefix prefix] [-ch symFile] [-backcompat] inputFile
```

## <a name="arguments"></a><span data-ttu-id="62aee-108">Argumentos</span><span class="sxs-lookup"><span data-stu-id="62aee-108">Arguments</span></span>

|<span data-ttu-id="62aee-109">Opção</span><span class="sxs-lookup"><span data-stu-id="62aee-109">Option</span></span>              |<span data-ttu-id="62aee-110">Descrição</span><span class="sxs-lookup"><span data-stu-id="62aee-110">Description</span></span>
|--------------------|-----------
|<span data-ttu-id="62aee-111">*inputFile*</span><span class="sxs-lookup"><span data-stu-id="62aee-111">*inputFile*</span></span>         |<span data-ttu-id="62aee-112">**Necessário:** Especifica o nome do `.man` arquivo (manifesto XML) que define seus contadores.</span><span class="sxs-lookup"><span data-stu-id="62aee-112">**Required:** Specifies the name of the `.man` (XML manifest) file that defines your counters.</span></span>
|<span data-ttu-id="62aee-113">**-o** *CodeFile*</span><span class="sxs-lookup"><span data-stu-id="62aee-113">**-o** *codeFile*</span></span>   |<span data-ttu-id="62aee-114">**Necessário:** Especifica o nome do `.h` arquivo de código a ser gerado pelo ctrpp.</span><span class="sxs-lookup"><span data-stu-id="62aee-114">**Required:** Specifies the name of the `.h` code file to be generated by CTRPP.</span></span> <span data-ttu-id="62aee-115">Esse arquivo conterá funções auxiliares embutidas em C/C++ que simplificam a inicialização e a desinicialização do seu provedor.</span><span class="sxs-lookup"><span data-stu-id="62aee-115">This file will contain C/C++ inline helper functions that simplify initializing and uninitializing your provider.</span></span>
|<span data-ttu-id="62aee-116">**-RC** *rcFile*</span><span class="sxs-lookup"><span data-stu-id="62aee-116">**-rc** *rcFile*</span></span>    |<span data-ttu-id="62aee-117">**Necessário:** Especifica o nome do `.rc` (arquivo de recurso) a ser gerado pelo ctrpp.</span><span class="sxs-lookup"><span data-stu-id="62aee-117">**Required:** Specifies the name of the `.rc` (resource file) to be generated by CTRPP.</span></span> <span data-ttu-id="62aee-118">Esse arquivo conterá a tabela de cadeias de caracteres do provedor.</span><span class="sxs-lookup"><span data-stu-id="62aee-118">This file will contain the provider's string table.</span></span>
|<span data-ttu-id="62aee-119">**-ch** *symFile*</span><span class="sxs-lookup"><span data-stu-id="62aee-119">**-ch** *symFile*</span></span>   |<span data-ttu-id="62aee-120">Especifica o nome do arquivo de `.h` símbolo opcional a ser gerado pelo ctrpp.</span><span class="sxs-lookup"><span data-stu-id="62aee-120">Specifies the name of the optional `.h` symbol file to be generated by CTRPP.</span></span> <span data-ttu-id="62aee-121">Esse arquivo conterá símbolos C/C++ para os nomes e GUIDs de cada CounterSet no provedor.</span><span class="sxs-lookup"><span data-stu-id="62aee-121">This file will contain C/C++ symbols for the names and GUIDs of each counterset in the provider.</span></span>
|<span data-ttu-id="62aee-122">**-** *prefixo prefixo*</span><span class="sxs-lookup"><span data-stu-id="62aee-122">**-prefix** *prefix*</span></span>|<span data-ttu-id="62aee-123">Especifica o prefixo a ser usado para as variáveis e funções definidas no arquivo de cabeçalho gerado.</span><span class="sxs-lookup"><span data-stu-id="62aee-123">Specifies the prefix to use for the variables and functions defined in the generated header file.</span></span>
|<span data-ttu-id="62aee-124">**-NotificationCallback**</span><span class="sxs-lookup"><span data-stu-id="62aee-124">**-NotificationCallback**</span></span>|<span data-ttu-id="62aee-125">Altera a assinatura padrão da função de [**Metainicialização**](counterinitialize.md) para incluir parâmetros para especificar o nome das funções de retorno de chamada [*ControlCallback*](/windows/desktop/api/Perflib/nc-perflib-perflibrequest), [*AllocateMemory*](/windows/desktop/api/Perflib/nc-perflib-perf_mem_alloc)e [*freememory*](/windows/desktop/api/Perflib/nc-perflib-perf_mem_free) .</span><span class="sxs-lookup"><span data-stu-id="62aee-125">Changes the default signature of the [**CounterInitialize**](counterinitialize.md) function to include parameters for specifying the name of [*ControlCallback*](/windows/desktop/api/Perflib/nc-perflib-perflibrequest), [*AllocateMemory*](/windows/desktop/api/Perflib/nc-perflib-perf_mem_alloc), and [*FreeMemory*](/windows/desktop/api/Perflib/nc-perflib-perf_mem_free) callback functions.</span></span> <span data-ttu-id="62aee-126">Esse argumento tem o mesmo efeito que incluir o `callback` atributo no elemento [**Provider**](/windows/desktop/PerfCtrs/performance-counters-provider--counters--element) .</span><span class="sxs-lookup"><span data-stu-id="62aee-126">This argument has the same effect as including the `callback` attribute in the [**provider**](/windows/desktop/PerfCtrs/performance-counters-provider--counters--element) element.</span></span>
|<span data-ttu-id="62aee-127">**-migrar** *arquivo_de_saída*</span><span class="sxs-lookup"><span data-stu-id="62aee-127">**-migrate** *outputFile*</span></span>|<span data-ttu-id="62aee-128">Em vez de gerar `.h` e `.rc` arquivos, o atualiza o manifesto do arquivo de *entrada* para a versão mais recente e salva-o no arquivo de *saída*.</span><span class="sxs-lookup"><span data-stu-id="62aee-128">Instead of generating `.h` and `.rc` files, upgrades the *inputFile* manifest to the latest version and saves it to *outputFile*.</span></span> <span data-ttu-id="62aee-129">Essa opção não pode ser usada com outras opções.</span><span class="sxs-lookup"><span data-stu-id="62aee-129">This switch cannot be used with other switches.</span></span> <span data-ttu-id="62aee-130">Uso: `CTRPP -migrate NewFile.man OldFile.man`</span><span class="sxs-lookup"><span data-stu-id="62aee-130">Usage: `CTRPP -migrate NewFile.man OldFile.man`</span></span>
|<span data-ttu-id="62aee-131">**-Compatibilidade de leitura**</span><span class="sxs-lookup"><span data-stu-id="62aee-131">**-BackCompat**</span></span>     |<span data-ttu-id="62aee-132">**Preterido:** O suporte para provedores de modo kernel foi adicionado ao Windows 7.</span><span class="sxs-lookup"><span data-stu-id="62aee-132">**Deprecated:** Support for kernel-mode providers was added in Windows 7.</span></span> <span data-ttu-id="62aee-133">Por padrão, o código gerado por CTRPP para provedores de modo kernel será incompatível com versões anteriores do Windows (haverá falha no carregamento do driver devido a APIs ausentes `Pcw***` ).</span><span class="sxs-lookup"><span data-stu-id="62aee-133">By default, the code generated by CTRPP for kernel-mode providers will be incompatible with earlier versions of Windows (driver will fail to load due to missing `Pcw***` APIs).</span></span> <span data-ttu-id="62aee-134">Defina `-BackCompat` para habilitar a compatibilidade com versões anteriores do Windows.</span><span class="sxs-lookup"><span data-stu-id="62aee-134">Set `-BackCompat` to enable compatibility with earlier versions of Windows.</span></span> <span data-ttu-id="62aee-135">O driver carregará dinamicamente as APIs necessárias e o código gerado irá desabilitar o provedor silenciosamente se as APIs não estiverem disponíveis.</span><span class="sxs-lookup"><span data-stu-id="62aee-135">The driver will dynamically load the necessary APIs and the generated code will silently disable the provider if the APIs are not available.</span></span>
|<span data-ttu-id="62aee-136">**-MemoryRoutines**</span><span class="sxs-lookup"><span data-stu-id="62aee-136">**-MemoryRoutines**</span></span> |<span data-ttu-id="62aee-137">**Preterido:** Quando usado com a `-Legacy` opção, inclui modelos para rotinas de memória no código gerado.</span><span class="sxs-lookup"><span data-stu-id="62aee-137">**Deprecated:** When used with the `-Legacy` switch, includes templates for memory routines in the generated code.</span></span> <span data-ttu-id="62aee-138">Caso contrário, esse argumento terá o mesmo efeito que a `-NotificationCallback` opção.</span><span class="sxs-lookup"><span data-stu-id="62aee-138">Otherwise, this argument has the same effect as the `-NotificationCallback` switch.</span></span>
|<span data-ttu-id="62aee-139">**-Herdado**</span><span class="sxs-lookup"><span data-stu-id="62aee-139">**-Legacy**</span></span>         |<span data-ttu-id="62aee-140">**Preterido:** Gera `*.h` `*.c` arquivos,, e `*.rc` `*_r.h` usando os modelos de código do Windows Vista (gera PerfAutoInitialize e PerfAutoCleanup em vez de proinitialize e nocleanup).</span><span class="sxs-lookup"><span data-stu-id="62aee-140">**Deprecated:** Generates `*.h`, `*.c`, `*.rc`, and `*_r.h` files using the Windows Vista code templates (generates PerfAutoInitialize and PerfAutoCleanup instead of CounterInitialize and CounterCleanup).</span></span> <span data-ttu-id="62aee-141">Essa opção pode ser usada com **-MemoryRoutines** e **-NotificationCallback** , mas não pode ser usada com outras opções.</span><span class="sxs-lookup"><span data-stu-id="62aee-141">This switch can be used with **-MemoryRoutines** and **-NotificationCallback** but cannot be used with any other switches.</span></span> <span data-ttu-id="62aee-142">Não use os comutadores **-o** ou **-RC** com essa opção.</span><span class="sxs-lookup"><span data-stu-id="62aee-142">Do not use the **-o** or **-rc** switches with this switch.</span></span> <span data-ttu-id="62aee-143">Os arquivos gerados serão nomeados com base no nome do manifesto e serão gravados no diretório que continha o manifesto.</span><span class="sxs-lookup"><span data-stu-id="62aee-143">The generated files will be named based on the name of the manifest and will be written to the directory that contained the manifest.</span></span> <span data-ttu-id="62aee-144">Uso: `CTRPP -legacy OldFile.man`</span><span class="sxs-lookup"><span data-stu-id="62aee-144">Usage: `CTRPP -legacy OldFile.man`</span></span>

## <a name="remarks"></a><span data-ttu-id="62aee-145">Comentários</span><span class="sxs-lookup"><span data-stu-id="62aee-145">Remarks</span></span>

<span data-ttu-id="62aee-146">A ferramenta CTRPP gera um arquivo de `.h` código, um `.rc` arquivo de recurso e, opcionalmente, gera um `.h` arquivo de símbolo.</span><span class="sxs-lookup"><span data-stu-id="62aee-146">The CTRPP tool generates a `.h` code file, an `.rc` resource file, and optionally generates a `.h` symbol file.</span></span>

### <a name="using-the-generated-resource-file"></a><span data-ttu-id="62aee-147">Usando o arquivo de recursos gerado</span><span class="sxs-lookup"><span data-stu-id="62aee-147">Using the generated resource file</span></span>

<span data-ttu-id="62aee-148">A ferramenta CTRPP gerará um `.rc` arquivo de recurso que contém as cadeias de caracteres localizáveis necessárias aos consumidores dos conjuntos de linhas do provedor.</span><span class="sxs-lookup"><span data-stu-id="62aee-148">The CTRPP tool will generate a `.rc` resource file that contains the localizable strings needed by consumers of the provider's countersets.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="62aee-149">Os recursos desse arquivo devem ser incluídos no seu binário do provedor e o caminho completo para o binário do provedor deve ser registrado durante a instalação do manifesto do provedor.</span><span class="sxs-lookup"><span data-stu-id="62aee-149">The resources from this file must be included into your provider binary and the full path to the provider binary must be registered during the installation of your provider's manifest.</span></span> <span data-ttu-id="62aee-150">Os consumidores que não puderem localizar e carregar os recursos não poderão usar os conjuntos de linhas do provedor.</span><span class="sxs-lookup"><span data-stu-id="62aee-150">Consumers that are unable to locate and load the resources will be unable to use your provider's countersets.</span></span>

<span data-ttu-id="62aee-151">Os recursos de cadeia de caracteres devem ser tratados da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="62aee-151">The string resources should be handled as follows:</span></span>

- <span data-ttu-id="62aee-152">O desenvolvedor edita o arquivo de manifesto do provedor ( `.man` ) para definir o `applicationIdentity` atributo do provedor como o nome de um binário do provedor (. DLL,. SYS ou. EXE) que conterá os recursos de cadeia de caracteres para o provedor e será instalado como parte do componente do provedor.</span><span class="sxs-lookup"><span data-stu-id="62aee-152">The developer edits the provider manifest (`.man`) file to set the `applicationIdentity` attribute of the provider to the name of a provider binary (.DLL, .SYS, or .EXE) that will contain the string resources for the provider and will be installed as part of the provider component.</span></span>
- <span data-ttu-id="62aee-153">A ferramenta CTRPP lê o manifesto do provedor e gera um `.rc` arquivo.</span><span class="sxs-lookup"><span data-stu-id="62aee-153">The CTRPP tool reads the provider manifest and generates an `.rc` file.</span></span>
- <span data-ttu-id="62aee-154">A ferramenta [RC (compilador de recurso)](../menurc/resource-compiler.md) compila os dados do arquivo gerado pelo ctrpp `.rc` para gerar um `.res` arquivo que contém os recursos binários.</span><span class="sxs-lookup"><span data-stu-id="62aee-154">The [RC (resource compiler)](../menurc/resource-compiler.md) tool compiles the data from the CTRPP-generated `.rc` file to generate a `.res` file containing the binary resources.</span></span> <span data-ttu-id="62aee-155">Isso pode ser feito por meio da compilação direta do arquivo gerado pelo CTRPP `.rc` ou pela compilação de outro `.rc` arquivo que inclui o `.rc` arquivo gerado por ctrpp por meio de uma `#include` diretiva.</span><span class="sxs-lookup"><span data-stu-id="62aee-155">This can be done either by directly compiling the CTRPP-generated `.rc` file OR by compiling another `.rc` file that includes the CTRPP-generated `.rc` file via an `#include` directive.</span></span>
- <span data-ttu-id="62aee-156">O vinculador incorpora os dados do arquivo gerado por RC `.res` para o binário do provedor.</span><span class="sxs-lookup"><span data-stu-id="62aee-156">The linker embeds the data from the RC-generated `.res` file into the provider binary.</span></span>
- <span data-ttu-id="62aee-157">Durante a instalação, o binário do provedor é copiado no sistema do usuário e o manifesto do provedor é registrado usando a [ferramenta LodCtr](/windows-server/administration/windows-commands/lodctr).</span><span class="sxs-lookup"><span data-stu-id="62aee-157">During installation, the provider binary is copied onto the user's system and the provider manifest is registered using the [lodctr tool](/windows-server/administration/windows-commands/lodctr).</span></span> <span data-ttu-id="62aee-158">A ferramenta LodCtr converte o `applicationIdentity` atributo do manifesto do provedor em um caminho completo e registra o caminho completo para o binário do provedor no registro.</span><span class="sxs-lookup"><span data-stu-id="62aee-158">The lodctr tool converts the `applicationIdentity` attribute of the provider manifest into a full path and records the full path to the provider binary in the registry.</span></span>
  - <span data-ttu-id="62aee-159">Se o binário do provedor estiver no mesmo diretório que o manifesto, use: `lodctr.exe /m:"C:\full\manifest\path\manifest.man"` .</span><span class="sxs-lookup"><span data-stu-id="62aee-159">If the provider binary is in the same directory as the manifest, use: `lodctr.exe /m:"C:\full\manifest\path\manifest.man"`.</span></span> <span data-ttu-id="62aee-160">Lodctr combinará o caminho de manifesto especificado com o atributo do manifesto `applicationIdentity` para formar o caminho completo.</span><span class="sxs-lookup"><span data-stu-id="62aee-160">lodctr will combine the specified manifest path with the manifest's `applicationIdentity` attribute to form the full path.</span></span>
  - <span data-ttu-id="62aee-161">Caso contrário, use `lodctr.exe /m:"C:\full\manifest\path\manifest.man" "c:\full\binary\path"`.</span><span class="sxs-lookup"><span data-stu-id="62aee-161">Otherwise, use `lodctr.exe /m:"C:\full\manifest\path\manifest.man" "c:\full\binary\path"`.</span></span> <span data-ttu-id="62aee-162">Lodctr combinará o caminho binário especificado com o atributo do manifesto `applicationIdentity` para formar o caminho completo.</span><span class="sxs-lookup"><span data-stu-id="62aee-162">lodctr will combine the specified binary path with the manifest's `applicationIdentity` attribute to form the full path.</span></span>
  - <span data-ttu-id="62aee-163">Para fins de diagnóstico, você pode inspecionar o caminho completo gravado verificando o `ApplicationIdentity` valor da chave do registro `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Perflib\_V2Providers\{<ProviderGuid>}` .</span><span class="sxs-lookup"><span data-stu-id="62aee-163">For diagnostic purposes, you can inspect the recorded full path by checking the `ApplicationIdentity` value of registry key `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Perflib\_V2Providers\{<ProviderGuid>}`.</span></span>
  - <span data-ttu-id="62aee-164">Se o binário estiver usando o MUI para localização, certifique-se de copiar o arquivo MUI junto com o binário.</span><span class="sxs-lookup"><span data-stu-id="62aee-164">If the binary is using MUI for localization, be sure to copy the MUI file along with the binary.</span></span>
- <span data-ttu-id="62aee-165">Durante a coleta do CounterSet, o consumidor usa o caminho completo gravado para o binário do provedor para localizar e carregar as cadeias de caracteres necessárias dos recursos do binário do provedor.</span><span class="sxs-lookup"><span data-stu-id="62aee-165">During counterset collection, the consumer uses the recorded full path to the provider binary to locate and load the necessary strings from the provider binary's resources.</span></span>

### <a name="using-the-generated-code-file-in-a-user-mode-provider"></a><span data-ttu-id="62aee-166">Usando o arquivo de código gerado em um provedor de modo de usuário</span><span class="sxs-lookup"><span data-stu-id="62aee-166">Using the generated code file in a user-mode provider</span></span>

<span data-ttu-id="62aee-167">A ferramenta CTRPP irá gerar um `.h` arquivo de código C/C++.</span><span class="sxs-lookup"><span data-stu-id="62aee-167">The CTRPP tool will generate a `.h` C/C++ code file.</span></span> <span data-ttu-id="62aee-168">Se o atributo do manifesto do provedor `providerType` for definido como `userMode` , o arquivo de código gerado conterá as seguintes definições que são úteis na codificação de um provedor de modo de usuário:</span><span class="sxs-lookup"><span data-stu-id="62aee-168">If the provider manifest's `providerType` attribute is set to `userMode`, the generated code file will contain the following definitions that are helpful in coding a user-mode provider:</span></span>

- <span data-ttu-id="62aee-169">Uma função de inicialização de provedor denominada [ \* **prefix \* preinitialize**](counterinitialize.md).</span><span class="sxs-lookup"><span data-stu-id="62aee-169">An provider initialization function named [\***prefix\*CounterInitialize**](counterinitialize.md).</span></span>
- <span data-ttu-id="62aee-170">Uma função de limpeza do provedor denominada [ \* **prefix \* procleanup**](countercleanup.md).</span><span class="sxs-lookup"><span data-stu-id="62aee-170">A provider cleanup function named [\***prefix\*CounterCleanup**](countercleanup.md).</span></span>
- <span data-ttu-id="62aee-171">Uma variável global \***Provider** _ que armazena o identificador do provedor aberto pela função _ \*_prefix_CounterInitialize\*\*.</span><span class="sxs-lookup"><span data-stu-id="62aee-171">A global ***provider** _ variable that stores the provider handle opened by the _ *_prefix_CounterInitialize** function.</span></span> <span data-ttu-id="62aee-172">O nome da variável é o valor do `symbol` atributo do `provider` elemento no manifesto.</span><span class="sxs-lookup"><span data-stu-id="62aee-172">The variable's name is the value of the `symbol` attribute of the `provider` element in the manifest.</span></span> <span data-ttu-id="62aee-173">Essa variável deve ser usada em chamadas para `PerfCreateInstance` , `PerfDeleteInstance` e outras APIs para controlar os dados do provedor.</span><span class="sxs-lookup"><span data-stu-id="62aee-173">This variable should be used in calls to `PerfCreateInstance`, `PerfDeleteInstance`, and other APIs for controlling your provider's data.</span></span>
- <span data-ttu-id="62aee-174">Para cada CounterSet, uma variável de \*\*GUID global \* CounterSet \*\*\* com o GUID do CounterSet.</span><span class="sxs-lookup"><span data-stu-id="62aee-174">For each counterset, a global \***counterset\*GUID** variable with the counterset GUID.</span></span> <span data-ttu-id="62aee-175">O nome da variável é o valor do `counterSet` atributo do elemento `symbol` mais o sufixo "GUID", por exemplo, `MyCounterSetGUID` .</span><span class="sxs-lookup"><span data-stu-id="62aee-175">The variable's name is the value of the `counterSet` element's `symbol` attribute plus the suffix "GUID", e.g. `MyCounterSetGUID`.</span></span> <span data-ttu-id="62aee-176">Essa variável deve ser usada em chamadas para `PerfCreateInstance` , `PerfDeleteInstance` e outras APIs para controlar os dados do provedor.</span><span class="sxs-lookup"><span data-stu-id="62aee-176">This variable should be used in calls to `PerfCreateInstance`, `PerfDeleteInstance`, and other APIs for controlling your provider's data.</span></span>
- <span data-ttu-id="62aee-177">Para cada contador, uma macro de ***contador*** com o valor do contador `id` .</span><span class="sxs-lookup"><span data-stu-id="62aee-177">For each counter, a ***counter*** macro with the counter's `id` value.</span></span> <span data-ttu-id="62aee-178">O nome da macro é o valor do `counter` atributo do elemento `symbol` .</span><span class="sxs-lookup"><span data-stu-id="62aee-178">The macro's name is the value of the `counter` element's `symbol` attribute.</span></span> <span data-ttu-id="62aee-179">Essa macro deve ser usada em chamadas para `PerfSetCounterRefValue` , `PerfSetULongLongCounterValue` e outras APIs para definir os dados do provedor.</span><span class="sxs-lookup"><span data-stu-id="62aee-179">This macro should be used in calls to `PerfSetCounterRefValue`, `PerfSetULongLongCounterValue`, and other APIs for setting your provider's data.</span></span>

<span data-ttu-id="62aee-180">Nos nomes de função, ***prefix*** refere-se ao valor do `-prefix` parâmetro de linha de comando.</span><span class="sxs-lookup"><span data-stu-id="62aee-180">In the function names, ***prefix*** refers to the value of the `-prefix` command-line parameter.</span></span> <span data-ttu-id="62aee-181">Se o `-prefix` parâmetro não for usado, as funções serão nomeadas `CounterInitialize` e `CounterCleanup` .</span><span class="sxs-lookup"><span data-stu-id="62aee-181">If the `-prefix` parameter is not used the functions will be named `CounterInitialize` and `CounterCleanup`.</span></span>

### <a name="using-the-generated-code-file-in-a-kernel-mode-provider"></a><span data-ttu-id="62aee-182">Usando o arquivo de código gerado em um provedor de modo kernel</span><span class="sxs-lookup"><span data-stu-id="62aee-182">Using the generated code file in a kernel-mode provider</span></span>

<span data-ttu-id="62aee-183">A ferramenta CTRPP irá gerar um `.h` arquivo de código C/C++.</span><span class="sxs-lookup"><span data-stu-id="62aee-183">The CTRPP tool will generate a `.h` C/C++ code file.</span></span> <span data-ttu-id="62aee-184">Se o atributo do manifesto do provedor `providerType` for definido como `kernelMode` , o arquivo de código gerado conterá as seguintes definições que são úteis na codificação de conjuntos de valores de um provedor de modo kernel:</span><span class="sxs-lookup"><span data-stu-id="62aee-184">If the provider manifest's `providerType` attribute is set to `kernelMode`, the generated code file will contain the following definitions that are helpful in coding a kernel-mode provider's countersets:</span></span>

- <span data-ttu-id="62aee-185">Uma função de inicialização CounterSet denominada <b> *prefix* registrar *CounterSet*</b>.</span><span class="sxs-lookup"><span data-stu-id="62aee-185">A counterset initialization function named <b>*prefix* Register *Counterset*</b>.</span></span> <span data-ttu-id="62aee-186">Essa função preenche uma estrutura [RegInfo](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_registration_information) , em seguida, invoca [PcwRegister](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwregister), colocando o identificador de registro do CounterSet resultante na variável ***CounterSet*** global.</span><span class="sxs-lookup"><span data-stu-id="62aee-186">This function fills in a [RegInfo](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_registration_information) structure then invokes [PcwRegister](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwregister), putting the resulting counterset registration handle into the global ***Counterset*** variable.</span></span>
- <span data-ttu-id="62aee-187">Uma função de limpeza do CounterSet denominada <b> *prefix* cancelar registro do *CounterSet*</b>.</span><span class="sxs-lookup"><span data-stu-id="62aee-187">A counterset cleanup function named <b>*prefix* Unregister *Counterset*</b>.</span></span> <span data-ttu-id="62aee-188">Essa função invoca [PcwUnregister](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwunregister) no identificador de registro CounterSet na variável ***CounterSet*** global.</span><span class="sxs-lookup"><span data-stu-id="62aee-188">This function invokes [PcwUnregister](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwunregister) on the counterset registration handle in the global ***Counterset*** variable.</span></span>
- <span data-ttu-id="62aee-189">Uma função de criação de instância denominada <b> *prefix* criar *CounterSet*</b>.</span><span class="sxs-lookup"><span data-stu-id="62aee-189">An instance creation function named <b>*prefix* Create *Counterset*</b>.</span></span> <span data-ttu-id="62aee-190">Essa função preenche uma matriz de estruturas [PcwData](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_data) , em seguida, invoca [PcwCreateInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwcreateinstance) usando o identificador de registro CounterSet na variável ***CounterSet*** global.</span><span class="sxs-lookup"><span data-stu-id="62aee-190">This function fills in an array of [PcwData](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_data) structures then invokes [PcwCreateInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwcreateinstance) using the counterset registration handle in the global ***Counterset*** variable.</span></span>
- <span data-ttu-id="62aee-191">Uma função de limpeza de instância denominada <b> *prefix* fechamento *CounterSet*</b>.</span><span class="sxs-lookup"><span data-stu-id="62aee-191">An instance cleanup function named <b>*prefix* Close *Counterset*</b>.</span></span> <span data-ttu-id="62aee-192">Essa função invoca [PcwCloseInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwcloseinstance).</span><span class="sxs-lookup"><span data-stu-id="62aee-192">This function invokes [PcwCloseInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwcloseinstance).</span></span>
- <span data-ttu-id="62aee-193">Uma função de relatório de instância chamada <b> *prefix* adiciona *CounterSet*</b> a ser usada na função de retorno de chamada CounterSet.</span><span class="sxs-lookup"><span data-stu-id="62aee-193">An instance reporting function named <b>*prefix* Add *Counterset*</b> to be used from the counterset callback function.</span></span> <span data-ttu-id="62aee-194">Essa função preenche uma matriz de estruturas [PcwData](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_data) e, em seguida, invoca [PcwAddInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwaddinstance).</span><span class="sxs-lookup"><span data-stu-id="62aee-194">This function fills in an array of [PcwData](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_data) structures then invokes [PcwAddInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwaddinstance).</span></span>
- <span data-ttu-id="62aee-195">**SDK do Windows 20H1 e posterior:** Uma função de inicialização RegInfo denominada <b> *prefix* InitRegistrationInformation *CounterSet*</b> para uso em cenários avançados.</span><span class="sxs-lookup"><span data-stu-id="62aee-195">**Windows SDK 20H1 and later:** A RegInfo initialization function named <b>*prefix* InitRegistrationInformation *Counterset*</b> for use in advanced scenarios.</span></span> <span data-ttu-id="62aee-196">Essa função preenche uma estrutura [RegInfo](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_registration_information) .</span><span class="sxs-lookup"><span data-stu-id="62aee-196">This function fills in a [RegInfo](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_registration_information) structure.</span></span> <span data-ttu-id="62aee-197">Essa função pode ser usada nos casos em que o <b>*contador* de registro de *prefixo*</b> gerado não atende às suas necessidades, por exemplo, quando você deseja personalizar os valores na estrutura RegInfo ou quando deseja armazenar o identificador retornado em outra variável.</span><span class="sxs-lookup"><span data-stu-id="62aee-197">This function can be used in cases where the generated <b>*prefix* Register *Counterset*</b> does not meet your needs, e.g. when you want to customize the values in the RegInfo structure or when you want to store the returned handle in another variable.</span></span>

<span data-ttu-id="62aee-198">Nos nomes de função, ***prefix*** refere-se ao valor do `-prefix` parâmetro de linha de comando.</span><span class="sxs-lookup"><span data-stu-id="62aee-198">In the function names, ***prefix*** refers to the value of the `-prefix` command-line parameter.</span></span> <span data-ttu-id="62aee-199">Se o `-prefix` parâmetro não for usado, as funções não terão nenhum prefixo.</span><span class="sxs-lookup"><span data-stu-id="62aee-199">If the `-prefix` parameter is not used the functions will have no prefix.</span></span>

> [!NOTE]
> <span data-ttu-id="62aee-200">O <b> *prefixo* gerado adicionar a função *CounterSet*</b> é usado quando você tem um retorno de chamada CounterSet.</span><span class="sxs-lookup"><span data-stu-id="62aee-200">The generated <b>*prefix* Add *Counterset*</b> function is used when you have a counterset callback.</span></span> <span data-ttu-id="62aee-201">O <b> *prefixo* gerado criar *contadores*</b> e as funções <b>*CounterSet* de fechamento de *prefixo*</b> são usados quando você não tem um retorno de chamada CounterSet.</span><span class="sxs-lookup"><span data-stu-id="62aee-201">The generated <b>*prefix* Create *Counterset*</b> and <b>*prefix* Close *Counterset*</b> functions are used when you do not have a counterset callback.</span></span>

### <a name="using-the-generated-symbol-file"></a><span data-ttu-id="62aee-202">Usando o arquivo de símbolo gerado</span><span class="sxs-lookup"><span data-stu-id="62aee-202">Using the generated symbol file</span></span>

<span data-ttu-id="62aee-203">Se o parâmetro **-ch** for especificado na linha de comando, a ferramenta ctrpp irá gerar um `.h` arquivo de símbolo.</span><span class="sxs-lookup"><span data-stu-id="62aee-203">If the **-ch** parameter is specified on the command line, the CTRPP tool will generate a `.h` symbol file.</span></span> <span data-ttu-id="62aee-204">Esse arquivo contém os símbolos C/C++ para os nomes e GUIDs de cada CounterSet no provedor.</span><span class="sxs-lookup"><span data-stu-id="62aee-204">This file contains the C/C++ symbols for the names and GUIDs of each counterset in the provider.</span></span> <span data-ttu-id="62aee-205">Os símbolos podem ser usados ao escrever programas que são embutidos em código para consumir os dados desse CounterSet usando as [funções de consumidor do PerfLib v2](using-the-perflib-functions-to-consume-counter-data.md).</span><span class="sxs-lookup"><span data-stu-id="62aee-205">The symbols can be used when writing programs that are hard-coded to consume the data from this counterset using the [PerfLib V2 Consumer functions](using-the-perflib-functions-to-consume-counter-data.md).</span></span>

## <a name="requirements"></a><span data-ttu-id="62aee-206">Requisitos</span><span class="sxs-lookup"><span data-stu-id="62aee-206">Requirements</span></span>

|                         ||
|-------------------------|----
| <span data-ttu-id="62aee-207">Cliente mínimo com suporte</span><span class="sxs-lookup"><span data-stu-id="62aee-207">Minimum supported client</span></span>| <span data-ttu-id="62aee-208">\[Somente aplicativos da área de trabalho do Windows Vista\]</span><span class="sxs-lookup"><span data-stu-id="62aee-208">Windows Vista \[desktop apps only\]</span></span>
| <span data-ttu-id="62aee-209">Servidor mínimo com suporte</span><span class="sxs-lookup"><span data-stu-id="62aee-209">Minimum supported server</span></span>| <span data-ttu-id="62aee-210">\[Somente aplicativos da área de trabalho do Windows Server 2008\]</span><span class="sxs-lookup"><span data-stu-id="62aee-210">Windows Server 2008 \[desktop apps only\]</span></span>
