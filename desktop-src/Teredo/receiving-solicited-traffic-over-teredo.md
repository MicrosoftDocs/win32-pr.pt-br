---
title: Recebendo tráfego solicitado por Teredo
description: Muitos aplicativos, como o Microsoft Internet Explorer e o Microsoft Outlook, só iniciam conexões com a Internet.
ms.assetid: bff5d65e-050d-4b09-9982-8024612ffa6e
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 035d067afeb9c62795efb5acd0bb28adc3afcb16
ms.sourcegitcommit: 773fa6257ead6c74154ad3cf46d21e49adc900aa
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/09/2020
ms.locfileid: "104499174"
---
# <a name="receiving-solicited-traffic-over-teredo"></a><span data-ttu-id="d3a17-103">Recebendo tráfego solicitado por Teredo</span><span class="sxs-lookup"><span data-stu-id="d3a17-103">Receiving Solicited Traffic Over Teredo</span></span>

<span data-ttu-id="d3a17-104">Muitos aplicativos, como o Microsoft Internet Explorer e o Microsoft Outlook, só iniciam conexões com a Internet.</span><span class="sxs-lookup"><span data-stu-id="d3a17-104">Many applications such as Microsoft Internet Explorer and Microsoft Outlook only initiate connections to the Internet.</span></span> <span data-ttu-id="d3a17-105">Para esses aplicativos, o [Teredo](about-teredo.md) pode fornecer conectividade direta sobre o IPv6 na ausência de outras interfaces IPv6.</span><span class="sxs-lookup"><span data-stu-id="d3a17-105">For these applications, [Teredo](about-teredo.md) can provide seamless connectivity over IPv6 in the absence of other IPv6 interfaces.</span></span> <span data-ttu-id="d3a17-106">Além disso, o tráfego solicitado pode ser recebido pela interface teredo nas plataformas anteriores do Microsoft Windows XP com Service Pack 2 (SP2) e Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="d3a17-106">Additionally, solicited traffic can be received over the Teredo Interface on the earlier Microsoft Windows XP with Service Pack 2 (SP2) and Windows Server 2003 platforms.</span></span>

<span data-ttu-id="d3a17-107">A documentação a seguir explica como esses aplicativos obtêm conectividade e as circunstâncias sob as quais o Teredo é usado.</span><span class="sxs-lookup"><span data-stu-id="d3a17-107">The following documentation explains how these applications achieve connectivity, and the circumstances under which Teredo is used.</span></span>

## <a name="obtaining-a-destination-address"></a><span data-ttu-id="d3a17-108">Obtendo um endereço de destino</span><span class="sxs-lookup"><span data-stu-id="d3a17-108">Obtaining a Destination Address</span></span>

<span data-ttu-id="d3a17-109">Um aplicativo tenta obter o endereço de destino usando vários métodos, como DNS (sistema de nomes de domínio) ou PNRP (Peer Name Resolution Protocol).</span><span class="sxs-lookup"><span data-stu-id="d3a17-109">An application attempts to obtain the destination address using various methods such as Domain Name System (DNS) or Peer Name Resolution Protocol (PNRP).</span></span> <span data-ttu-id="d3a17-110">É possível que o aplicativo obtenha vários endereços IP IPv4 e IPv6 usando esses métodos.</span><span class="sxs-lookup"><span data-stu-id="d3a17-110">It is possible for the application to obtain multiple IPv4 and IPv6 IP addresses using these methods.</span></span> <span data-ttu-id="d3a17-111">As APIs típicas usadas para obter endereços IP incluem a API do Windows XP [**gethostbyname**](/windows/desktop/api/wsipv6ok/nf-wsipv6ok-gethostbyname) e a nova API do Windows Vista [**Getaddrinfo**](/windows/desktop/api/ws2tcpip/nf-ws2tcpip-getaddrinfo).</span><span class="sxs-lookup"><span data-stu-id="d3a17-111">The typical APIs used to obtain IP addresses include the Windows XP API [**GetHostByName**](/windows/desktop/api/wsipv6ok/nf-wsipv6ok-gethostbyname) and the new Windows Vista API [**GetAddrInfo**](/windows/desktop/api/ws2tcpip/nf-ws2tcpip-getaddrinfo).</span></span> <span data-ttu-id="d3a17-112">Por exemplo, usar a API GetAddrInfo com o *parâmetro \_ Family da família ia* definido \_ como AF INET6 como a dica addrinfo/Protocol permite ao usuário consultar servidores DNS para endereços IPv6 especificamente.</span><span class="sxs-lookup"><span data-stu-id="d3a17-112">For example, using the GetAddrInfo API with the *ai\_family* parameter set to AF\_INET6 as the addrinfo/protocol hint allows the user to query DNS servers for IPv6 addresses specifically.</span></span> <span data-ttu-id="d3a17-113">A API [**DnsQuery**](/windows/desktop/api/windns/nf-windns-dnsquery_a) com o tipo DNS \_ Type \_ aaaa também pode ser usada para consultar os servidores DNS para registros AAAA.</span><span class="sxs-lookup"><span data-stu-id="d3a17-113">The [**DnsQuery**](/windows/desktop/api/windns/nf-windns-dnsquery_a) API with the type DNS\_TYPE\_AAAA can also be used to query the DNS servers for AAAA records.</span></span>

## <a name="establishing-a-connection"></a><span data-ttu-id="d3a17-114">Estabelecer uma conexão</span><span class="sxs-lookup"><span data-stu-id="d3a17-114">Establishing a Connection</span></span>

<span data-ttu-id="d3a17-115">Uma conexão estabelecida com o Teredo é descrita como ' direta ' porque ela é tratada como qualquer outra conexão IPv6.</span><span class="sxs-lookup"><span data-stu-id="d3a17-115">A connection established with Teredo is described as 'seamless' because it is handled like any other IPv6 connection.</span></span> <span data-ttu-id="d3a17-116">A programação de um aplicativo não exige uma consideração especial para ser capaz de utilizar a interface teredo.</span><span class="sxs-lookup"><span data-stu-id="d3a17-116">The programming of an application does not require special consideration to be capable of utilizing the Teredo interface.</span></span> <span data-ttu-id="d3a17-117">Quando uma conexão é estabelecida entre as interfaces Teredo, um roteador de retransmissão, típico de 6to4 e outras interfaces nativas, não é necessário.</span><span class="sxs-lookup"><span data-stu-id="d3a17-117">When a connection is established between Teredo interfaces, a relay router, typical of 6to4 and other native interfaces, is not required.</span></span> <span data-ttu-id="d3a17-118">No entanto, o Teredo foi projetado como uma tecnologia de transição de último recurso para conectividade IPv6.</span><span class="sxs-lookup"><span data-stu-id="d3a17-118">However, Teredo is designed as a last resort transition technology for IPv6 connectivity.</span></span>

> [!Note]  
> <span data-ttu-id="d3a17-119">O Teredo não será utilizado se o nome de host fornecido resolver somente para endereços IPv4.</span><span class="sxs-lookup"><span data-stu-id="d3a17-119">Teredo is not utilized if the supplied hostname resolves to IPv4 addresses only.</span></span>

 

<span data-ttu-id="d3a17-120">Quando um aplicativo tenta se conectar a um destino usando endereços IPv6, ocorrerá o seguinte:</span><span class="sxs-lookup"><span data-stu-id="d3a17-120">When an application attempts to connect to a destination using IPv6 addresses, the following will occur:</span></span>

-   <span data-ttu-id="d3a17-121">O aplicativo obtém uma lista de endereços IPv6 chamando a API [**GetAdaptersAddresses**](/windows/desktop/api/iphlpapi/nf-iphlpapi-getadaptersaddresses) .</span><span class="sxs-lookup"><span data-stu-id="d3a17-121">The application obtains a list of IPv6 addresses by calling the [**GetAdaptersAddresses**](/windows/desktop/api/iphlpapi/nf-iphlpapi-getadaptersaddresses) API.</span></span> <span data-ttu-id="d3a17-122">A pilha do Windows Vista retorna uma lista de todas as interfaces com base na ordem de classificação especificada no [RFC 3484](https://www.irt.org/rfc/rfc3484.htm).</span><span class="sxs-lookup"><span data-stu-id="d3a17-122">The Windows Vista stack returns a list of all interfaces based on the sorting order specified in [RFC 3484](https://www.irt.org/rfc/rfc3484.htm).</span></span> <span data-ttu-id="d3a17-123">Como resultado, as interfaces IPv6 IPv6 e 6to4 serão listadas antes da interface teredo.</span><span class="sxs-lookup"><span data-stu-id="d3a17-123">As a result, IPv6 and 6to4 IPv6 interfaces will be listed before Teredo interface.</span></span> <span data-ttu-id="d3a17-124">No entanto, quando a conectividade IPv6 ou 6to4 nativa não estiver disponível, o Teredo será a única interface compatível com IPv6 listada.</span><span class="sxs-lookup"><span data-stu-id="d3a17-124">However, when native IPv6 or 6to4 connectivity is not available, Teredo will be the only IPv6 capable interface listed.</span></span>

    <span data-ttu-id="d3a17-125">É importante lembrar-se de que um aplicativo pode usar qualquer interface fornecida pela pilha do Windows Vista, no entanto, a ordenação da lista de interface retornada resultará na tentativa do Teredo pela última vez.</span><span class="sxs-lookup"><span data-stu-id="d3a17-125">It is important to remember that an application can use any interface provided by the Windows Vista stack, however the ordering of the interface list returned will most often result in Teredo being attempted last.</span></span>

-   <span data-ttu-id="d3a17-126">Antes que o Windows Vista tente uma conexão pela interface teredo, o sistema operacional garante que o endereço IPv6 tenha estabilizado.</span><span class="sxs-lookup"><span data-stu-id="d3a17-126">Before Windows Vista attempts a connection over the Teredo interface, the operating system ensures that the IPv6 address has stabilized.</span></span> <span data-ttu-id="d3a17-127">Isso é feito automaticamente para conexões de saída e não é uma consideração crucial para um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d3a17-127">This is done automatically for outgoing connections and is not a crucial consideration for an application.</span></span> <span data-ttu-id="d3a17-128">Caso o aplicativo seja necessário para garantir a estabilidade do endereço, a API [**NotifyStableUnicastIpAddressTable**](/windows/desktop/api/netioapi/nf-netioapi-notifystableunicastipaddresstable) pode ser chamada para garantir que o endereço Teredo seja estável.</span><span class="sxs-lookup"><span data-stu-id="d3a17-128">In the event the application is required to guarantee address stability, the [**NotifyStableUnicastIpAddressTable**](/windows/desktop/api/netioapi/nf-netioapi-notifystableunicastipaddresstable) API can be called to ensure that the Teredo address is stable.</span></span>

-   <span data-ttu-id="d3a17-129">Uma interface teredo tentará se conectar a outra interface teredo no destino.</span><span class="sxs-lookup"><span data-stu-id="d3a17-129">A Teredo interface will attempt to connect to another Teredo interface at the destination.</span></span> <span data-ttu-id="d3a17-130">Se uma interface teredo não estiver presente, uma conexão será estabelecida com um endereço de destino nativo ou 6to4 por meio de uma retransmissão específica do host.</span><span class="sxs-lookup"><span data-stu-id="d3a17-130">If a Teredo interface is not present, a connection is established with a native or 6to4 destination address through a host-specific relay.</span></span>

<span data-ttu-id="d3a17-131">Também é possível que os aplicativos que iniciam conexões com a Internet recebam tráfego não solicitado.</span><span class="sxs-lookup"><span data-stu-id="d3a17-131">It is also possible for applications that initiate connections to the Internet to receive unsolicited traffic.</span></span> <span data-ttu-id="d3a17-132">Para obter mais detalhes, consulte [recebendo tráfego não solicitado por Teredo](receiving-unsolicited-traffic-over-teredo.md).</span><span class="sxs-lookup"><span data-stu-id="d3a17-132">For more details see [Receiving Unsolicited Traffic Over Teredo](receiving-unsolicited-traffic-over-teredo.md).</span></span>

## <a name="using-the-wsaconnectbyname-api"></a><span data-ttu-id="d3a17-133">Usando a API WSAConnectByName</span><span class="sxs-lookup"><span data-stu-id="d3a17-133">Using the WSAConnectByName API</span></span>

<span data-ttu-id="d3a17-134">Ao chamar a API WSAConnectByName, é possível que um aplicativo se conecte a um nome de destino em vez de especificar o endereço IP exato.</span><span class="sxs-lookup"><span data-stu-id="d3a17-134">By calling the WSAConnectByName API, it is possible for an application to connect to a destination name instead of specifying the exact IP address.</span></span> <span data-ttu-id="d3a17-135">A pilha do Windows Vista prefere IPv6 sobre IPv4 e, como resultado, todas as tentativas de conexão serão feitas em endereços IPv6 primeiro.</span><span class="sxs-lookup"><span data-stu-id="d3a17-135">The Windows Vista stack prefers IPv6 over IPv4, and as a result any connection attempts will be made to IPv6 addresses first.</span></span>

<span data-ttu-id="d3a17-136">Chamar a API WSAConnectByName classificará todos os endereços IP de destino obtidos na seguinte ordem:</span><span class="sxs-lookup"><span data-stu-id="d3a17-136">Calling the WSAConnectByName API will sort all destination IP addresses obtained in the following order:</span></span>

-   <span data-ttu-id="d3a17-137">Endereço IPv6 nativo</span><span class="sxs-lookup"><span data-stu-id="d3a17-137">Native IPv6 address</span></span>
-   <span data-ttu-id="d3a17-138">Endereço IP 6to4</span><span class="sxs-lookup"><span data-stu-id="d3a17-138">6to4 IP address</span></span>
-   <span data-ttu-id="d3a17-139">Endereço IPv4</span><span class="sxs-lookup"><span data-stu-id="d3a17-139">IPv4 address</span></span>
-   <span data-ttu-id="d3a17-140">Endereço Teredo</span><span class="sxs-lookup"><span data-stu-id="d3a17-140">Teredo address</span></span>

<span data-ttu-id="d3a17-141">Depois que os endereços de destino são classificados internamente, uma conexão com o destino é tentada com base na melhor rota disponível no host local para o endereço de destino.</span><span class="sxs-lookup"><span data-stu-id="d3a17-141">After the destination addresses are sorted internally, a connection to the destination is attempted based on the best route available on the local host for the destination address.</span></span> <span data-ttu-id="d3a17-142">Conforme indicado pela ordem dos endereços classificados, se o nome de destino for resolvido para um endereço IPv4 e Teredo, o endereço IPv4 será usado para estabelecer a conexão.</span><span class="sxs-lookup"><span data-stu-id="d3a17-142">As indicated by the order of the sorted addresses, if the destination name resolves to a IPv4 and Teredo address, the IPv4 address will be used to establish the connection.</span></span>

<span data-ttu-id="d3a17-143">A API do WSAConnectByName funciona internamente para encontrar a melhor correspondência entre os endereços.</span><span class="sxs-lookup"><span data-stu-id="d3a17-143">The WSAConnectByName API works internally to find the best match between addresses.</span></span> <span data-ttu-id="d3a17-144">Essa tentativa é baseada nas rotas disponíveis no host local e nos endereços de destino.</span><span class="sxs-lookup"><span data-stu-id="d3a17-144">This attempt is based on the routes available on the local host and the destination addresses.</span></span>

<span data-ttu-id="d3a17-145">Devido à ausência atual de retransmissões Teredo na Internet, é improvável que as conexões com endereços IPv6 nativos tenham sucesso na interface teredo.</span><span class="sxs-lookup"><span data-stu-id="d3a17-145">Due to current absence of Teredo relays on the Internet, connections to native IPv6 addresses are unlikely to succeed over the Teredo interface.</span></span> <span data-ttu-id="d3a17-146">Se WSAConnectByName for chamado, o Windows Vista não emitirá consultas AAAA quando o Teredo for a única interface compatível com IPv6 disponível.</span><span class="sxs-lookup"><span data-stu-id="d3a17-146">If WSAConnectByName is called, Windows Vista will not issue AAAA queries when Teredo is the only IPv6 capable interface available.</span></span> <span data-ttu-id="d3a17-147">Isso garante que os endereços IPv6 nativos não sejam obtidos como destino e que as conexões sejam tentadas por IPv4, o que tem a maior chance de sucesso.</span><span class="sxs-lookup"><span data-stu-id="d3a17-147">This ensures that native IPv6 addresses are not obtained as a destination and that connections are attempted over IPv4, which has the highest chance of success.</span></span> <span data-ttu-id="d3a17-148">Para obter endereços IPv6 quando Teredo é a única interface compatível com IPv6, um aplicativo deve usar explicitamente a API do DnsQuery para registros AAAA.</span><span class="sxs-lookup"><span data-stu-id="d3a17-148">In order to obtain IPv6 addresses when Teredo is the only IPv6 capable interface, an application must explicitly use the DnsQuery API for AAAA records.</span></span>

 

 