---
description: Um manipulador de exceção baseado em quadros permite que você lide com a possibilidade de que uma exceção ocorra em uma determinada sequência de código. Um manipulador de exceção baseado em quadros consiste nos seguintes elementos.
ms.assetid: 07aac772-f917-48b7-91a9-3b5d4cb43600
title: Manipulação de exceção baseada em quadros
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 12b268b5d02de83bca22a1d3311905b05be1f748
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104457071"
---
# <a name="frame-based-exception-handling"></a><span data-ttu-id="36509-104">Manipulação de exceção baseada em quadros</span><span class="sxs-lookup"><span data-stu-id="36509-104">Frame-based Exception Handling</span></span>

<span data-ttu-id="36509-105">Um *manipulador de exceção baseado em quadros* permite que você lide com a possibilidade de que uma exceção ocorra em uma determinada sequência de código.</span><span class="sxs-lookup"><span data-stu-id="36509-105">A *frame-based exception handler* allows you to deal with the possibility that an exception may occur in a certain sequence of code.</span></span> <span data-ttu-id="36509-106">Um manipulador de exceção baseado em quadros consiste nos seguintes elementos.</span><span class="sxs-lookup"><span data-stu-id="36509-106">A frame-based exception handler consists of the following elements.</span></span>

-   <span data-ttu-id="36509-107">Um corpo de código protegido</span><span class="sxs-lookup"><span data-stu-id="36509-107">A guarded body of code</span></span>
-   <span data-ttu-id="36509-108">Uma expressão de filtro</span><span class="sxs-lookup"><span data-stu-id="36509-108">A filter expression</span></span>
-   <span data-ttu-id="36509-109">Um bloco de manipulador de exceção</span><span class="sxs-lookup"><span data-stu-id="36509-109">An exception-handler block</span></span>

<span data-ttu-id="36509-110">Os manipuladores de exceção baseados em quadros são declarados na sintaxe específica do idioma.</span><span class="sxs-lookup"><span data-stu-id="36509-110">Frame-based exception handlers are declared in language-specific syntax.</span></span> <span data-ttu-id="36509-111">Por exemplo, no compilador de otimização do Microsoft C/C++, eles são implementados usando **\_ \_ try** e **\_ \_ Except**.</span><span class="sxs-lookup"><span data-stu-id="36509-111">For example, in the Microsoft C/C++ Optimizing Compiler, they are implemented using **\_\_try** and **\_\_except**.</span></span> <span data-ttu-id="36509-112">Para obter mais informações, consulte [sintaxe do manipulador](handler-syntax.md).</span><span class="sxs-lookup"><span data-stu-id="36509-112">For more information, see [Handler Syntax](handler-syntax.md).</span></span>

<span data-ttu-id="36509-113">O *corpo de código protegido* é um conjunto de uma ou mais instruções para as quais a expressão de filtro e o bloco de manipulador de exceção fornecem proteção de manipulação de exceção.</span><span class="sxs-lookup"><span data-stu-id="36509-113">The *guarded body of code* is a set of one or more statements for which the filter expression and the exception-handler block provide exception-handling protection.</span></span> <span data-ttu-id="36509-114">O corpo protegido pode ser um bloco de código, um conjunto de blocos aninhados ou um procedimento ou uma função inteira.</span><span class="sxs-lookup"><span data-stu-id="36509-114">The guarded body can be a block of code, a set of nested blocks, or an entire procedure or function.</span></span> <span data-ttu-id="36509-115">Usando o compilador de otimização do Microsoft C/C++, um corpo protegido é incluído entre chaves ( {} ) após a palavra-chave **\_ \_ try** .</span><span class="sxs-lookup"><span data-stu-id="36509-115">Using the Microsoft C/C++ Optimizing Compiler, a guarded body is enclosed by braces ({}) following the **\_\_try** keyword.</span></span>

<span data-ttu-id="36509-116">A *expressão de filtro* de um manipulador de exceção com base em quadros é uma expressão que é avaliada pelo sistema quando ocorre uma exceção dentro do corpo protegido.</span><span class="sxs-lookup"><span data-stu-id="36509-116">The *filter expression* of a frame-based exception handler is an expression that is evaluated by the system when an exception occurs within the guarded body.</span></span> <span data-ttu-id="36509-117">Essa avaliação resulta em uma das seguintes ações pelo sistema.</span><span class="sxs-lookup"><span data-stu-id="36509-117">This evaluation results in one of the following actions by the system.</span></span>

-   <span data-ttu-id="36509-118">O sistema interrompe sua pesquisa por um manipulador de exceção, restaura o estado da máquina e continua a execução do thread no ponto em que a exceção ocorreu.</span><span class="sxs-lookup"><span data-stu-id="36509-118">The system stops its search for an exception handler, restores the machine state, and continues thread execution at the point at which the exception occurred.</span></span>
-   <span data-ttu-id="36509-119">O sistema continua sua pesquisa por um manipulador de exceção.</span><span class="sxs-lookup"><span data-stu-id="36509-119">The system continues its search for an exception handler.</span></span>
-   <span data-ttu-id="36509-120">O sistema transfere o controle para o manipulador de exceção e a execução do thread continua sequencialmente no registro de ativação no qual o manipulador de exceção é encontrado.</span><span class="sxs-lookup"><span data-stu-id="36509-120">The system transfers control to the exception handler, and thread execution continues sequentially in the stack frame in which the exception handler is found.</span></span> <span data-ttu-id="36509-121">Se o manipulador não estiver no registro de ativação no qual a exceção ocorreu, o sistema desenrolará a pilha, deixando o registro de ativação atual e quaisquer outros quadros de pilha até que ele volte ao quadro de pilha do manipulador de exceções.</span><span class="sxs-lookup"><span data-stu-id="36509-121">If the handler is not in the stack frame in which the exception occurred, the system unwinds the stack, leaving the current stack frame and any other stack frames until it is back to the exception handler's stack frame.</span></span> <span data-ttu-id="36509-122">Antes de um manipulador de exceção ser executado, os manipuladores de terminação são executados para qualquer corpo de código protegido que foi encerrado como resultado da transferência de controle para o manipulador de exceção.</span><span class="sxs-lookup"><span data-stu-id="36509-122">Before an exception handler is executed, termination handlers are executed for any guarded bodies of code that terminated as a result of the transfer of control to the exception handler.</span></span> <span data-ttu-id="36509-123">Para obter mais informações sobre manipuladores de terminação, consulte [tratamento de terminação](termination-handling.md).</span><span class="sxs-lookup"><span data-stu-id="36509-123">For more information about termination handlers, refer to [Termination Handling](termination-handling.md).</span></span>

<span data-ttu-id="36509-124">A expressão de filtro pode ser uma expressão simples ou pode invocar uma *função de filtro* que tenta manipular a exceção.</span><span class="sxs-lookup"><span data-stu-id="36509-124">The filter expression can be a simple expression, or it can invoke a *filter function* that attempts to handle the exception.</span></span> <span data-ttu-id="36509-125">Você pode chamar as funções [**GetExceptionCode**](getexceptioncode.md) e [**GetExceptionInformation**](getexceptioninformation.md) de dentro de uma expressão de filtro para obter informações sobre a exceção que está sendo filtrada.</span><span class="sxs-lookup"><span data-stu-id="36509-125">You can call the [**GetExceptionCode**](getexceptioncode.md) and [**GetExceptionInformation**](getexceptioninformation.md) functions from within a filter expression to get information about the exception being filtered.</span></span> <span data-ttu-id="36509-126">**GetExceptionCode** retorna um código que identifica o tipo de exceção e **GetExceptionInformation** retorna um ponteiro para uma estrutura [**de \_ ponteiros de exceção**](/windows/desktop/api/WinNT/ns-winnt-exception_pointers) que contém ponteiros para estruturas de [**\_ registro**](/windows/desktop/api/WinNT/ns-winnt-exception_record) de [**contexto**](/windows/desktop/api/WinNT/ns-winnt-arm64_nt_context) e de exceção.</span><span class="sxs-lookup"><span data-stu-id="36509-126">**GetExceptionCode** returns a code that identifies the type of exception, and **GetExceptionInformation** returns a pointer to an [**EXCEPTION\_POINTERS**](/windows/desktop/api/WinNT/ns-winnt-exception_pointers) structure that contains pointers to [**CONTEXT**](/windows/desktop/api/WinNT/ns-winnt-arm64_nt_context) and [**EXCEPTION\_RECORD**](/windows/desktop/api/WinNT/ns-winnt-exception_record) structures.</span></span>

<span data-ttu-id="36509-127">Essas funções não podem ser chamadas de dentro de uma função de filtro, mas seus valores de retorno podem ser passados como parâmetros para uma função de filtro.</span><span class="sxs-lookup"><span data-stu-id="36509-127">These functions cannot be called from within a filter function, but their return values can be passed as parameters to a filter function.</span></span> <span data-ttu-id="36509-128">[**GetExceptionCode**](getexceptioncode.md) pode ser usado dentro do bloco de manipulador de exceção, mas [**GetExceptionInformation**](getexceptioninformation.md) não pode porque as informações para as quais ele aponta estão normalmente na pilha e são destruídas quando o controle é transferido para um manipulador de exceção.</span><span class="sxs-lookup"><span data-stu-id="36509-128">[**GetExceptionCode**](getexceptioncode.md) can be used within the exception-handler block, but [**GetExceptionInformation**](getexceptioninformation.md) cannot because the information it points to is typically on the stack and is destroyed when control is transferred to an exception handler.</span></span> <span data-ttu-id="36509-129">No entanto, um aplicativo pode copiar as informações para o armazenamento seguro para torná-lo disponível para o manipulador de exceção.</span><span class="sxs-lookup"><span data-stu-id="36509-129">However, an application can copy the information to safe storage to make it available to the exception handler.</span></span>

<span data-ttu-id="36509-130">A vantagem de uma função de filtro é que ela pode manipular uma exceção e retornar um valor que faz com que o sistema continue a execução a partir do ponto em que a exceção ocorreu.</span><span class="sxs-lookup"><span data-stu-id="36509-130">The advantage of a filter function is that it can handle an exception and return a value that causes the system to continue execution from the point at which the exception occurred.</span></span> <span data-ttu-id="36509-131">Com um bloco de manipulador de exceção, por outro lado, a execução continua sequencialmente do manipulador de exceção em vez do ponto da exceção.</span><span class="sxs-lookup"><span data-stu-id="36509-131">With an exception-handler block, in contrast, execution continues sequentially from the exception handler rather than from the point of the exception.</span></span>

<span data-ttu-id="36509-132">Manipular uma exceção pode ser tão simples quanto observar um erro e definir um sinalizador que será examinado posteriormente, imprimindo uma mensagem de aviso ou de erro ou tomando alguma outra ação limitada.</span><span class="sxs-lookup"><span data-stu-id="36509-132">Handling an exception may be as simple as noting an error and setting a flag that will be examined later, printing a warning or error message, or taking some other limited action.</span></span> <span data-ttu-id="36509-133">Se a execução puder ser continuada, também poderá ser necessário alterar o estado da máquina modificando o registro de contexto.</span><span class="sxs-lookup"><span data-stu-id="36509-133">If execution can be continued, it may also be necessary to change the machine state by modifying the context record.</span></span> <span data-ttu-id="36509-134">Para obter um exemplo de uma função de filtro que manipula uma exceção de falha de página, consulte [usando as funções de memória virtual](../memory/using-the-memory-management-functions.md).</span><span class="sxs-lookup"><span data-stu-id="36509-134">For an example of a filter function that handles a page fault exception, see [Using the Virtual Memory Functions](../memory/using-the-memory-management-functions.md).</span></span>

<span data-ttu-id="36509-135">A função [**UnhandledExceptionFilter**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-unhandledexceptionfilter) pode ser usada como uma função de filtro em uma expressão de filtro.</span><span class="sxs-lookup"><span data-stu-id="36509-135">The [**UnhandledExceptionFilter**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-unhandledexceptionfilter) function can be used as a filter function in a filter expression.</span></span> <span data-ttu-id="36509-136">Ele retorna \_ \_ o manipulador de execução de exceção, a menos que o processo esteja sendo depurado; nesse caso, ele retorna uma exceção de \_ continuação da \_ pesquisa.</span><span class="sxs-lookup"><span data-stu-id="36509-136">It returns EXCEPTION\_EXECUTE\_HANDLER unless the process is being debugged, in which case it returns EXCEPTION\_CONTINUE\_SEARCH.</span></span>

 

 
