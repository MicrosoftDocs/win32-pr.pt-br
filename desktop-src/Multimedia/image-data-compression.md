---
title: Compactação de Image-Data
description: Compactação de Image-Data
ms.assetid: 689cf403-cbb5-4ccb-a05b-0caa617430ed
keywords:
- VCM (Gerenciador de compactação de vídeo), compactação de dados de imagem
- VCM (Gerenciador de compactação de vídeo), compactação de dados de imagem
- Função ICCompress
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8b8f59a163a9b5a74d2d2fe984417069985fa86a
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/19/2020
ms.locfileid: "104365896"
---
# <a name="image-data-compression"></a><span data-ttu-id="ed068-106">Compactação de Image-Data</span><span class="sxs-lookup"><span data-stu-id="ed068-106">Image-Data Compression</span></span>

<span data-ttu-id="ed068-107">Seu aplicativo pode usar uma série de funções e macros [**ICCompress**](/windows/desktop/api/Vfw/nf-vfw-iccompress) para compactar dados.</span><span class="sxs-lookup"><span data-stu-id="ed068-107">Your application can use a series of [**ICCompress**](/windows/desktop/api/Vfw/nf-vfw-iccompress) functions and macros to compress data.</span></span> <span data-ttu-id="ed068-108">As funções e macros podem ajudá-lo a executar as seguintes tarefas:</span><span class="sxs-lookup"><span data-stu-id="ed068-108">The functions and macros can help you perform the following tasks:</span></span>

-   <span data-ttu-id="ed068-109">Determine o formato de compactação a ser usado para um formato de entrada especificado.</span><span class="sxs-lookup"><span data-stu-id="ed068-109">Determine the compression format to use for a specified input format.</span></span>
-   <span data-ttu-id="ed068-110">Prepare o compressor.</span><span class="sxs-lookup"><span data-stu-id="ed068-110">Prepare the compressor.</span></span>
-   <span data-ttu-id="ed068-111">Compacte os dados.</span><span class="sxs-lookup"><span data-stu-id="ed068-111">Compress the data.</span></span>
-   <span data-ttu-id="ed068-112">Encerrar compactação.</span><span class="sxs-lookup"><span data-stu-id="ed068-112">End compression.</span></span>

<span data-ttu-id="ed068-113">Seu aplicativo pode aumentar o controle sobre o processo de compactação usando as funções e macros [**ICCompress**](/windows/desktop/api/Vfw/nf-vfw-iccompress) .</span><span class="sxs-lookup"><span data-stu-id="ed068-113">Your application can increase control over the compression process by using the [**ICCompress**](/windows/desktop/api/Vfw/nf-vfw-iccompress) functions and macros.</span></span> <span data-ttu-id="ed068-114">Esse grupo de funções e macros manipula quadros individuais, em vez da sequência como um todo.</span><span class="sxs-lookup"><span data-stu-id="ed068-114">This group of functions and macros handles individual frames, rather than the sequence as a whole.</span></span> <span data-ttu-id="ed068-115">Por exemplo, seu aplicativo pode identificar os quadros a serem compactados como quadros-chave usando a função **ICCompress** .</span><span class="sxs-lookup"><span data-stu-id="ed068-115">For example, your application can identify the frames to compress as key frames by using the **ICCompress** function.</span></span>

<span data-ttu-id="ed068-116">Um compressor recebe dados em um formato, compacta os dados e retorna uma versão compactada dos dados usando um formato especificado.</span><span class="sxs-lookup"><span data-stu-id="ed068-116">A compressor receives data in one format, compresses the data, and returns a compressed version of the data using a specified format.</span></span> <span data-ttu-id="ed068-117">O formato de entrada típico especifica DIBs usando a estrutura [**BITMAPINFO**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfo) .</span><span class="sxs-lookup"><span data-stu-id="ed068-117">The typical input format specifies DIBs using the [**BITMAPINFO**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfo) structure.</span></span> <span data-ttu-id="ed068-118">O formato de saída típico especifica DIBs comprimido, também usando a estrutura **BITMAPINFO** .</span><span class="sxs-lookup"><span data-stu-id="ed068-118">The typical output format specifies compressed DIBs, also using the **BITMAPINFO** structure.</span></span>

> [!Note]  
> <span data-ttu-id="ed068-119">Para minimizar a degradação da imagem e do áudio durante a reprodução, evite compactar um arquivo AVI mais de uma vez.</span><span class="sxs-lookup"><span data-stu-id="ed068-119">To minimize image and audio degradation during playback, avoid compressing an AVI file more than once.</span></span> <span data-ttu-id="ed068-120">Combine pedaços de vídeo não compactados em seu sistema de edição e, em seguida, compacte o produto final.</span><span class="sxs-lookup"><span data-stu-id="ed068-120">Combine uncompressed pieces of video in your editing system and then compress the final product.</span></span>

 

## <a name="compressor-and-compression-format-selection"></a><span data-ttu-id="ed068-121">Seleção de formato de compactador e compactação</span><span class="sxs-lookup"><span data-stu-id="ed068-121">Compressor and Compression Format Selection</span></span>

<span data-ttu-id="ed068-122">Se você quiser compactar dados e seu aplicativo exigir um formato de saída específico, envie a mensagem de [**\_ \_ consulta de compactação ICM**](icm-compress-query.md) (ou use a macro [**ICCompressQuery**](/windows/desktop/api/Vfw/nf-vfw-iccompressquery) ) para consultar o compressor para determinar se ele dá suporte aos formatos de entrada e saída.</span><span class="sxs-lookup"><span data-stu-id="ed068-122">If you want to compress data and your application requires a specific output format, send the [**ICM\_COMPRESS\_QUERY**](icm-compress-query.md) message (or use the [**ICCompressQuery**](/windows/desktop/api/Vfw/nf-vfw-iccompressquery) macro) to query the compressor to determine if it supports the input and output formats.</span></span>

<span data-ttu-id="ed068-123">Se o formato de saída não for importante para seu aplicativo, você só precisa encontrar um compressor que possa manipular o formato de entrada.</span><span class="sxs-lookup"><span data-stu-id="ed068-123">If the output format is not important to your application, you need only find a compressor that can handle the input format.</span></span> <span data-ttu-id="ed068-124">Para determinar se um compressor pode manipular o formato de entrada, você pode enviar a **\_ \_ consulta de compactação ICM**, especificando **NULL** para o parâmetro *lParam* .</span><span class="sxs-lookup"><span data-stu-id="ed068-124">To determine if a compressor can handle the input format, you can send **ICM\_COMPRESS\_QUERY**, specifying **NULL** for the *lParam* parameter.</span></span> <span data-ttu-id="ed068-125">Essa mensagem não retorna o formato de saída para seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ed068-125">This message does not return the output format to your application.</span></span> <span data-ttu-id="ed068-126">Seu aplicativo pode determinar o tamanho do buffer necessário para os dados que especificam o formato de compactação enviando a mensagem [**ICM \_ Compact \_ Get \_ Format**](icm-compress-get-format.md) (ou use a macro [**ICCompressGetFormatSize**](/windows/desktop/api/Vfw/nf-vfw-iccompressgetformatsize) ).</span><span class="sxs-lookup"><span data-stu-id="ed068-126">Your application can determine the buffer size needed for the data specifying the compression format by sending the [**ICM\_COMPRESS\_GET\_FORMAT**](icm-compress-get-format.md) message (or use the [**ICCompressGetFormatSize**](/windows/desktop/api/Vfw/nf-vfw-iccompressgetformatsize) macro).</span></span> <span data-ttu-id="ed068-127">Você também pode recuperar os dados de formato enviando o \_ \_ formato de Get compactar ICM \_ (ou a macro [**ICCompressGetFormat**](/windows/desktop/api/Vfw/nf-vfw-iccompressgetformat) ).</span><span class="sxs-lookup"><span data-stu-id="ed068-127">You can also retrieve the format data by sending ICM\_COMPRESS\_GET\_FORMAT (or the [**ICCompressGetFormat**](/windows/desktop/api/Vfw/nf-vfw-iccompressgetformat) macro).</span></span>

<span data-ttu-id="ed068-128">Se você quiser determinar o buffer maior que o compressor poderia exigir para compactação, envie a mensagem [**ICM \_ Compact \_ Get \_ size**](icm-compress-get-size.md) (ou use a macro [**ICCompressGetSize**](/windows/desktop/api/Vfw/nf-vfw-iccompressgetsize) ).</span><span class="sxs-lookup"><span data-stu-id="ed068-128">If you want to determine the largest buffer that the compressor could require for compression, send the [**ICM\_COMPRESS\_GET\_SIZE**](icm-compress-get-size.md) message (or use the [**ICCompressGetSize**](/windows/desktop/api/Vfw/nf-vfw-iccompressgetsize) macro).</span></span> <span data-ttu-id="ed068-129">Você pode usar o número de bytes retornados pela função [**ICSendMessage**](/windows/desktop/api/Vfw/nf-vfw-icsendmessage) para alocar um buffer para as compactações de imagem subsequentes.</span><span class="sxs-lookup"><span data-stu-id="ed068-129">You can use the number of bytes returned by the [**ICSendMessage**](/windows/desktop/api/Vfw/nf-vfw-icsendmessage) function to allocate a buffer for subsequent image compressions.</span></span>

## <a name="compressor-initialization"></a><span data-ttu-id="ed068-130">Inicialização de compactador</span><span class="sxs-lookup"><span data-stu-id="ed068-130">Compressor Initialization</span></span>

<span data-ttu-id="ed068-131">Depois que o aplicativo selecionar um compressor que possa lidar com os formatos de entrada e saída de que precisa, você poderá inicializar o compactador usando a mensagem de [**\_ \_ início de compactação ICM**](icm-compress-begin.md) (ou use a macro [**ICCompressBegin**](/windows/desktop/api/Vfw/nf-vfw-iccompressbegin) ).</span><span class="sxs-lookup"><span data-stu-id="ed068-131">After your application selects a compressor that can handle the input and output formats it needs, you can initialize the compressor by using the [**ICM\_COMPRESS\_BEGIN**](icm-compress-begin.md) message (or use the [**ICCompressBegin**](/windows/desktop/api/Vfw/nf-vfw-iccompressbegin) macro).</span></span> <span data-ttu-id="ed068-132">Essa mensagem requer o identificador de compressor e os formatos de entrada e saída.</span><span class="sxs-lookup"><span data-stu-id="ed068-132">This message requires the compressor handle and the input and output formats.</span></span>

## <a name="data-compression"></a><span data-ttu-id="ed068-133">Data Compression</span><span class="sxs-lookup"><span data-stu-id="ed068-133">Data Compression</span></span>

<span data-ttu-id="ed068-134">Você pode usar a função [**ICCompress**](/windows/desktop/api/Vfw/nf-vfw-iccompress) para compactar um quadro.</span><span class="sxs-lookup"><span data-stu-id="ed068-134">You can use the [**ICCompress**](/windows/desktop/api/Vfw/nf-vfw-iccompress) function to compress a frame.</span></span> <span data-ttu-id="ed068-135">Seu aplicativo deve usar essa função repetidamente até que todos os quadros em uma sequência sejam compactados.</span><span class="sxs-lookup"><span data-stu-id="ed068-135">Your application must use this function repeatedly until all the frames in a sequence are compressed.</span></span> <span data-ttu-id="ed068-136">Seu aplicativo também deve acompanhar e incrementar o número de cada quadro compactado com **ICCompress**.</span><span class="sxs-lookup"><span data-stu-id="ed068-136">Your application must also track and increment the number of each frame compressed with **ICCompress**.</span></span> <span data-ttu-id="ed068-137">O compressor usa esse valor para verificar se os quadros são enviados fora de ordem durante a compactação temporal rápida (armazenando diferenças entre quadros sucessivos).</span><span class="sxs-lookup"><span data-stu-id="ed068-137">The compressor uses this value to check if frames are sent out of order during fast temporal compression (storing differences between successive frames).</span></span> <span data-ttu-id="ed068-138">Se o seu aplicativo recompactar um quadro, ele deverá usar o mesmo número de quadro que quando o quadro foi compactado pela primeira vez.</span><span class="sxs-lookup"><span data-stu-id="ed068-138">If your application recompresses a frame, it should use the same frame number as when the frame was first compressed.</span></span> <span data-ttu-id="ed068-139">Se seu aplicativo compacta uma imagem de quadro ainda, ele pode especificar um número de quadro igual a zero.</span><span class="sxs-lookup"><span data-stu-id="ed068-139">If your application compresses a still-frame image, it can specify a frame number of zero.</span></span>

<span data-ttu-id="ed068-140">Seu aplicativo pode usar o sinalizador **ICCOMPRESS \_ KEYFRAME** para tornar o quadro compactado por [**ICCOMPRESS**](/windows/desktop/api/Vfw/nf-vfw-iccompress) um quadro-chave.</span><span class="sxs-lookup"><span data-stu-id="ed068-140">Your application can use the **ICCOMPRESS\_KEYFRAME** flag to make the frame compressed by [**ICCompress**](/windows/desktop/api/Vfw/nf-vfw-iccompress) a key frame.</span></span>

<span data-ttu-id="ed068-141">Quando VCM retorna o controle ao seu aplicativo depois de compactar um quadro, o VCM armazena os dados compactados nas estruturas referenciadas pelos parâmetros *lpbiOutput* e *lpData* .</span><span class="sxs-lookup"><span data-stu-id="ed068-141">When VCM returns control to your application after compressing a frame, VCM stores the compressed data in the structures referenced by the *lpbiOutput* and *lpData* parameters.</span></span> <span data-ttu-id="ed068-142">Se seu aplicativo precisar mover os dados compactados, ele poderá encontrar seu tamanho no membro *biSizeImage* da estrutura [**BITMAPINFO**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfo) especificada em *lpbiOutput*.</span><span class="sxs-lookup"><span data-stu-id="ed068-142">If your application needs to move the compressed data, it can find its size in the *biSizeImage* member of the [**BITMAPINFO**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfo) structure specified in *lpbiOutput*.</span></span>

> [!Note]  
> <span data-ttu-id="ed068-143">Seu aplicativo deve alocar as estruturas e os buffers que armazenam os dados descompactados e compactados.</span><span class="sxs-lookup"><span data-stu-id="ed068-143">Your application must allocate the structures and buffers that store the uncompressed and compressed data.</span></span> <span data-ttu-id="ed068-144">Se o compressor oferecer suporte à compactação temporal, o aplicativo também deverá alocar uma estrutura e um buffer para manter o formato e os dados do quadro de informações anterior.</span><span class="sxs-lookup"><span data-stu-id="ed068-144">If the compressor supports temporal compression, your application must also allocate a structure and buffer to hold the format and data for the previous frame of information.</span></span>

 

## <a name="ending-compression"></a><span data-ttu-id="ed068-145">Finalizando compactação</span><span class="sxs-lookup"><span data-stu-id="ed068-145">Ending Compression</span></span>

<span data-ttu-id="ed068-146">Depois que o aplicativo tiver compactado os dados, ele poderá usar a macro [**ICCompressEnd**](/windows/desktop/api/Vfw/nf-vfw-iccompressend) para notificar o compressor de que ele foi concluído.</span><span class="sxs-lookup"><span data-stu-id="ed068-146">After your application has compressed the data, it can use the [**ICCompressEnd**](/windows/desktop/api/Vfw/nf-vfw-iccompressend) macro to notify the compressor that it has finished.</span></span> <span data-ttu-id="ed068-147">Se você quiser reiniciar a compactação depois de usar essa função, seu aplicativo deverá reinicializar o compactador enviando a mensagem de [**início do ICM \_ compactar \_**](icm-compress-begin.md) (ou usar a macro [**ICCompressBegin**](/windows/desktop/api/Vfw/nf-vfw-iccompressbegin) ).</span><span class="sxs-lookup"><span data-stu-id="ed068-147">If you want to restart compression after using this function, your application must reinitialize the compressor by sending the [**ICM\_COMPRESS\_BEGIN**](icm-compress-begin.md) message (or use the [**ICCompressBegin**](/windows/desktop/api/Vfw/nf-vfw-iccompressbegin) macro).</span></span>

 

 