---
title: Instâncias de driver
description: Instâncias de driver
ms.assetid: 93dba9e8-bfb3-4714-9466-cf5c78babcf2
keywords:
- drivers instaláveis, instâncias
- drivers instaláveis, várias instâncias
- várias instâncias de driver
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 37148dcb12fbfa2984d4e55424102b5985165d9d
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/16/2019
ms.locfileid: "103635598"
---
# <a name="driver-instances"></a><span data-ttu-id="ee7b5-106">Instâncias de driver</span><span class="sxs-lookup"><span data-stu-id="ee7b5-106">Driver Instances</span></span>

<span data-ttu-id="ee7b5-107">O Windows permite várias instâncias de um driver instalável.</span><span class="sxs-lookup"><span data-stu-id="ee7b5-107">Windows allows for multiples instances of an installable driver.</span></span> <span data-ttu-id="ee7b5-108">O sistema cria uma instância do driver cada vez que o driver é aberto e destrói a instância quando o driver é fechado.</span><span class="sxs-lookup"><span data-stu-id="ee7b5-108">The system creates an instance of the driver each time the driver is opened and destroys the instance when the driver is closed.</span></span> <span data-ttu-id="ee7b5-109">As instâncias de driver são especialmente úteis para drivers instaláveis que dão suporte a vários dispositivos ou que são abertos por vários aplicativos ou pelo mesmo aplicativo várias vezes.</span><span class="sxs-lookup"><span data-stu-id="ee7b5-109">Driver instances are especially useful for installable drivers that support multiple devices or that are opened by multiple applications or by the same application multiple times.</span></span>

<span data-ttu-id="ee7b5-110">Para ajudar o driver a acompanhar as instâncias, o sistema envia um identificador de instância de driver com cada mensagem de driver após a criação da instância.</span><span class="sxs-lookup"><span data-stu-id="ee7b5-110">To help the driver keep track of the instances, the system sends a driver instance handle with each driver message after the instance has been created.</span></span> <span data-ttu-id="ee7b5-111">Como esse identificador identifica exclusivamente a instância, os drivers instaláveis geralmente associam o identificador à memória e a outros recursos alocados especificamente para a instância.</span><span class="sxs-lookup"><span data-stu-id="ee7b5-111">Because this handle uniquely identifies the instance, installable drivers often associate the handle with memory and other resources that they have specifically allocated for the instance.</span></span>

<span data-ttu-id="ee7b5-112">Quando a primeira instância é aberta, o sistema envia as mensagens de [**\_ carregamento**](drv-load.md)do DRV, do [**drv \_ Enable**](drv-enable.md)e do [**drv \_**](drv-open.md) para o driver nessa ordem.</span><span class="sxs-lookup"><span data-stu-id="ee7b5-112">When the first instance is opened, the system sends the [**DRV\_LOAD**](drv-load.md), [**DRV\_ENABLE**](drv-enable.md), and [**DRV\_OPEN**](drv-open.md) messages to the driver in that order.</span></span> <span data-ttu-id="ee7b5-113">As mensagens de carregamento de DRV \_ e drv \_ permitem notificar o driver de que ele está na memória e está habilitado para operação.</span><span class="sxs-lookup"><span data-stu-id="ee7b5-113">The DRV\_LOAD and DRV\_ENABLE messages notify the driver that it is now in memory and is enabled for operation.</span></span> <span data-ttu-id="ee7b5-114">A \_ mensagem drv Open identifica o identificador de instância e pode incluir informações de configuração para a instância.</span><span class="sxs-lookup"><span data-stu-id="ee7b5-114">The DRV\_OPEN message identifies the instance handle and may include configuration information for the instance.</span></span> <span data-ttu-id="ee7b5-115">Em cada abertura subsequente de uma instância do mesmo Driver, o sistema envia somente uma mensagem DRV \_ Open.</span><span class="sxs-lookup"><span data-stu-id="ee7b5-115">On each subsequent opening of an instance of the same driver, the system sends only a DRV\_OPEN message.</span></span>

<span data-ttu-id="ee7b5-116">Ao processar uma mensagem de carregamento de DRV \_ , um driver normalmente lê as definições de configuração do registro, configura o driver e qualquer hardware associado e aloca memória para uso por todas as instâncias do driver.</span><span class="sxs-lookup"><span data-stu-id="ee7b5-116">When processing a DRV\_LOAD message, a driver typically reads configuration settings from the registry, configures the driver and any associated hardware, and allocates memory for use by all instances of the driver.</span></span> <span data-ttu-id="ee7b5-117">Se um driver não puder concluir a configuração ou alocar memória, ele retornará zero para instruir o sistema a remover imediatamente o driver da memória e impedir que todas as mensagens subsequentes sejam enviadas.</span><span class="sxs-lookup"><span data-stu-id="ee7b5-117">If a driver cannot complete the configuration or allocate memory, it returns zero to direct the system to immediately remove the driver from memory and prevent any subsequent messages from being sent.</span></span> <span data-ttu-id="ee7b5-118">Ao processar a \_ mensagem de habilitação de DRV, o driver prepara o hardware para receber e processar solicitações de e/s (entrada e saída).</span><span class="sxs-lookup"><span data-stu-id="ee7b5-118">When processing the DRV\_ENABLE message, the driver prepares the hardware to receive and process input and output (I/O) requests.</span></span> <span data-ttu-id="ee7b5-119">A preparação pode incluir a instalação de manipuladores de interrupção.</span><span class="sxs-lookup"><span data-stu-id="ee7b5-119">The preparation may include installing interrupt handlers.</span></span>

<span data-ttu-id="ee7b5-120">Ao processar a mensagem de abertura do DRV \_ , o driver aloca memória ou recursos exigidos pela instância específica do driver e retorna um valor diferente de zero.</span><span class="sxs-lookup"><span data-stu-id="ee7b5-120">When processing the DRV\_OPEN message, the driver allocates memory or resources required by the given instance of the driver and then returns a nonzero value.</span></span> <span data-ttu-id="ee7b5-121">O sistema usa esse valor diferente de zero como o *identificador de driver* em mensagens de driver subsequentes para a instância.</span><span class="sxs-lookup"><span data-stu-id="ee7b5-121">The system uses this nonzero value as the *driver identifier* in subsequent driver messages for the instance.</span></span> <span data-ttu-id="ee7b5-122">O driver pode usar esse identificador para qualquer finalidade.</span><span class="sxs-lookup"><span data-stu-id="ee7b5-122">The driver can use this identifier for any purpose.</span></span> <span data-ttu-id="ee7b5-123">Por exemplo, alguns drivers usam um identificador de memória para o identificador para obter acesso rápido à memória que contém informações sobre a instância especificada.</span><span class="sxs-lookup"><span data-stu-id="ee7b5-123">For example, some drivers use a memory handle for the identifier to gain quick access to memory containing information about the given instance.</span></span>

<span data-ttu-id="ee7b5-124">Muitos drivers instaláveis processam o segundo parâmetro da \_ mensagem drv Open, dando ao sistema e aos aplicativos o meio de enviar informações adicionais ao driver ao abrir uma instância.</span><span class="sxs-lookup"><span data-stu-id="ee7b5-124">Many installable drivers process the second parameter of the DRV\_OPEN message, giving the system and applications the means to send additional information to the driver when opening an instance.</span></span> <span data-ttu-id="ee7b5-125">O parâmetro pode ser um único valor ou um endereço de uma estrutura que contém um conjunto de valores.</span><span class="sxs-lookup"><span data-stu-id="ee7b5-125">The parameter can be a single value or an address of a structure containing a set of values.</span></span> <span data-ttu-id="ee7b5-126">Ao processar \_ o DRV Open, o driver verifica o parâmetro para determinar se ele é um valor e usa os valores especificados, se houver, para concluir a criação da instância.</span><span class="sxs-lookup"><span data-stu-id="ee7b5-126">When processing DRV\_OPEN, the driver checks the parameter to determine whether it is a value and uses the given values, if any, to complete the creation of the instance.</span></span>

<span data-ttu-id="ee7b5-127">O sistema envia uma mensagem de [**\_ fechamento drv**](drv-close.md) cada vez que uma instância é fechada.</span><span class="sxs-lookup"><span data-stu-id="ee7b5-127">The system sends a [**DRV\_CLOSE**](drv-close.md) message each time an instance is closed.</span></span> <span data-ttu-id="ee7b5-128">O identificador de instância enviado com a mensagem identifica qual instância deve ser fechada.</span><span class="sxs-lookup"><span data-stu-id="ee7b5-128">The instance handle sent with the message identifies which instance to close.</span></span> <span data-ttu-id="ee7b5-129">Quando a última instância restante é fechada, o sistema envia as \_ mensagens de fechamento DRV, [**drv \_ Disable**](drv-disable.md)e [**drv \_ Free**](drv-free.md) nessa ordem.</span><span class="sxs-lookup"><span data-stu-id="ee7b5-129">When the last remaining instance is closed, the system sends the DRV\_CLOSE, [**DRV\_DISABLE**](drv-disable.md), and [**DRV\_FREE**](drv-free.md) messages in that order.</span></span> <span data-ttu-id="ee7b5-130">A \_ mensagem de fechamento drv direciona o driver para fechar a instância e as mensagens de \_ desativação drv Disable e drv \_ Free notificam o driver de que ele está desabilitado e será imediatamente liberado da memória.</span><span class="sxs-lookup"><span data-stu-id="ee7b5-130">The DRV\_CLOSE message directs the driver to close the instance, and the DRV\_DISABLE and DRV\_FREE messages notify the driver that it is now disabled and will be immediately freed from memory.</span></span>

<span data-ttu-id="ee7b5-131">Ao processar a \_ mensagem de fechamento DRV, o driver normalmente libera memória ou recursos alocados para a instância.</span><span class="sxs-lookup"><span data-stu-id="ee7b5-131">When processing the DRV\_CLOSE message, the driver typically frees any memory or resources allocated for the instance.</span></span> <span data-ttu-id="ee7b5-132">Ao processar a \_ mensagem de desabilitação de DRV, o driver coloca qualquer hardware em um estado inativo, o que pode incluir a remoção de manipuladores de interrupção.</span><span class="sxs-lookup"><span data-stu-id="ee7b5-132">When processing the DRV\_DISABLE message, the driver places any hardware in an inactive state, which may include the removal of interrupt handlers.</span></span> <span data-ttu-id="ee7b5-133">Ao processar a \_ mensagem drv Free, o driver libera a memória ou os recursos que ainda estão alocados.</span><span class="sxs-lookup"><span data-stu-id="ee7b5-133">When processing the DRV\_FREE message, the driver frees any memory or resources that are still allocated.</span></span>

<span data-ttu-id="ee7b5-134">Os drivers instaláveis não são necessários para dar suporte a várias instâncias.</span><span class="sxs-lookup"><span data-stu-id="ee7b5-134">Installable drivers are not required to support multiple instances.</span></span> <span data-ttu-id="ee7b5-135">Um driver pode impedir que qualquer instância seja criada retornando zero para a mensagem de [**\_ abertura de drv**](drv-open.md) .</span><span class="sxs-lookup"><span data-stu-id="ee7b5-135">A driver can prevent any instance from being created by returning zero for the [**DRV\_OPEN**](drv-open.md) message.</span></span>

 

 




