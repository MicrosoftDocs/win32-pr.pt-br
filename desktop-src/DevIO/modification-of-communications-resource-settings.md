---
description: Quando a função CreateFile abre um identificador para um recurso de comunicações serial, o sistema inicializa e configura o recurso de acordo com os valores configurados na última vez em que o recurso foi aberto.
ms.assetid: a39881d8-32af-4846-a2d3-508f1945b666
title: Modificação das configurações de recursos de comunicação
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8658029470fae9ee2d70ffb1459312c3c4d80ecf
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104010190"
---
# <a name="modification-of-communications-resource-settings"></a><span data-ttu-id="8cf62-103">Modificação das configurações de recursos de comunicação</span><span class="sxs-lookup"><span data-stu-id="8cf62-103">Modification of Communications Resource Settings</span></span>

<span data-ttu-id="8cf62-104">Quando a função [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) abre um identificador para um recurso de comunicações serial, o sistema inicializa e configura o recurso de acordo com os valores configurados na última vez em que o recurso foi aberto.</span><span class="sxs-lookup"><span data-stu-id="8cf62-104">When the [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) function opens a handle to a serial communications resource, the system initializes and configures the resource according to the values set up the last time the resource was opened.</span></span> <span data-ttu-id="8cf62-105">Preservar as configurações anteriores permite que o usuário retenha as configurações especificadas por meio de um comando de **modo** quando o dispositivo é reaberto.</span><span class="sxs-lookup"><span data-stu-id="8cf62-105">Preserving the previous settings enables the user to retain the settings specified through a **mode** command when the device is reopened.</span></span> <span data-ttu-id="8cf62-106">Os valores herdados da operação de abertura anterior incluem as definições de configuração do bloco de controle de dispositivo (uma estrutura [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) ) e os valores de tempo limite usados em operações de e/s.</span><span class="sxs-lookup"><span data-stu-id="8cf62-106">The values inherited from the previous open operation include the configuration settings of the device control block (a [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) structure) and the time-out values used in I/O operations.</span></span> <span data-ttu-id="8cf62-107">Se o dispositivo nunca tiver sido aberto, ele será configurado com os padrões do sistema.</span><span class="sxs-lookup"><span data-stu-id="8cf62-107">If the device has never been opened, it is configured with the system defaults.</span></span>

<span data-ttu-id="8cf62-108">Para determinar a configuração inicial de um recurso de comunicações serial, um processo chama a função [**GetCommState**](/windows/desktop/api/Winbase/nf-winbase-getcommstate) , que preenche uma estrutura [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) de porta serial com as definições de configuração atuais.</span><span class="sxs-lookup"><span data-stu-id="8cf62-108">To determine the initial configuration of a serial communications resource, a process calls the [**GetCommState**](/windows/desktop/api/Winbase/nf-winbase-getcommstate) function, which fills in a serial port [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) structure with the current configuration settings.</span></span> <span data-ttu-id="8cf62-109">Para modificar essa configuração, um processo especifica uma estrutura **DCB** em uma chamada para a função [**SetCommState**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) .</span><span class="sxs-lookup"><span data-stu-id="8cf62-109">To modify this configuration, a process specifies a **DCB** structure in a call to the [**SetCommState**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) function.</span></span>

<span data-ttu-id="8cf62-110">Os membros da estrutura [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) especificam as definições de configuração, como a taxa de transmissão, o número de bits de dados por byte e o número de bits de parada por byte.</span><span class="sxs-lookup"><span data-stu-id="8cf62-110">Members of the [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) structure specify the configuration settings such as the baud rate, the number of data bits per byte, and the number of stop bits per byte.</span></span> <span data-ttu-id="8cf62-111">Outros membros do **DCB** especificam caracteres especiais e habilitam a verificação de paridade e o controle de fluxo.</span><span class="sxs-lookup"><span data-stu-id="8cf62-111">Other **DCB** members specify special characters and enable parity checking and flow control.</span></span> <span data-ttu-id="8cf62-112">Quando um processo precisa modificar apenas algumas dessas definições de configuração, ele deve primeiro chamar [**GetCommState**](/windows/desktop/api/Winbase/nf-winbase-getcommstate) para preencher uma estrutura **DCB** com a configuração atual.</span><span class="sxs-lookup"><span data-stu-id="8cf62-112">When a process needs to modify only a few of these configuration settings, it should first call [**GetCommState**](/windows/desktop/api/Winbase/nf-winbase-getcommstate) to fill in a **DCB** structure with the current configuration.</span></span> <span data-ttu-id="8cf62-113">Em seguida, o processo pode ajustar os valores importantes na estrutura **DCB** e reconfigurar o dispositivo chamando [**SetCommState**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) e especificando a estrutura **DCB** modificada.</span><span class="sxs-lookup"><span data-stu-id="8cf62-113">Then the process can adjust the important values in the **DCB** structure and reconfigure the device by calling [**SetCommState**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) and specifying the modified **DCB** structure.</span></span> <span data-ttu-id="8cf62-114">Esse procedimento garante que os membros não modificados da estrutura **DCB** contenham valores apropriados.</span><span class="sxs-lookup"><span data-stu-id="8cf62-114">This procedure ensures that the unmodified members of the **DCB** structure contain appropriate values.</span></span> <span data-ttu-id="8cf62-115">Por exemplo, um erro comum é configurar um dispositivo com uma estrutura **DCB** na qual o membro **XonChar** da estrutura seja igual ao membro **XoffChar** .</span><span class="sxs-lookup"><span data-stu-id="8cf62-115">For example, a common error is to configure a device with a **DCB** structure in which the structure's **XonChar** member is equal to the **XoffChar** member.</span></span>

<span data-ttu-id="8cf62-116">A função [**BuildCommDCB**](/windows/desktop/api/Winbase/nf-winbase-buildcommdcba) fornece outra maneira de modificar uma estrutura [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) .</span><span class="sxs-lookup"><span data-stu-id="8cf62-116">The [**BuildCommDCB**](/windows/desktop/api/Winbase/nf-winbase-buildcommdcba) function provides another way to modify a [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) structure.</span></span> <span data-ttu-id="8cf62-117">**BuildCommDCB** usa uma cadeia de caracteres com a mesma forma que os argumentos de linha de comando do comando **Mode** para especificar a taxa de transmissão, o esquema de paridade, o número de bits de parada e o número de bits de dados.</span><span class="sxs-lookup"><span data-stu-id="8cf62-117">**BuildCommDCB** uses a string with the same form as the command-line arguments of the **mode** command to specify the baud rate, parity scheme, number of stop bits, and number of data bits.</span></span> <span data-ttu-id="8cf62-118">Os membros restantes de [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) não são alterados por essa função, exceto que os membros apropriados são definidos para desabilitar o controle de fluxo de hardware e XON/XOFF.</span><span class="sxs-lookup"><span data-stu-id="8cf62-118">The remaining members of [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) are not changed by this function, except that the appropriate members are set to disable XON/XOFF and hardware flow control.</span></span> <span data-ttu-id="8cf62-119">**BuildCommDCB** modifica apenas uma estrutura **DCB** ; Ele não reconfigura o dispositivo.</span><span class="sxs-lookup"><span data-stu-id="8cf62-119">**BuildCommDCB** only modifies a **DCB** structure; it does not reconfigure the device.</span></span>

<span data-ttu-id="8cf62-120">Um processo pode reconfigurar um recurso de comunicação usando a função [**GetCommProperties**](/windows/desktop/api/Winbase/nf-winbase-getcommproperties) para obter informações de um driver de dispositivo sobre as definições de configuração que ele suporta.</span><span class="sxs-lookup"><span data-stu-id="8cf62-120">A process can reconfigure a communications resource by using the [**GetCommProperties**](/windows/desktop/api/Winbase/nf-winbase-getcommproperties) function to get information from a device driver about the configuration settings that it supports.</span></span> <span data-ttu-id="8cf62-121">O processo pode usar essas informações para evitar a especificação de uma configuração sem suporte.</span><span class="sxs-lookup"><span data-stu-id="8cf62-121">The process can use this information to avoid specifying a configuration that is not supported.</span></span>

<span data-ttu-id="8cf62-122">A função [**SetCommState**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) reconfigura o recurso de comunicação, mas não afeta os buffers de entrada e saída internos do driver especificado.</span><span class="sxs-lookup"><span data-stu-id="8cf62-122">The [**SetCommState**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) function reconfigures the communications resource, but it does not affect the internal output and input buffers of the specified driver.</span></span> <span data-ttu-id="8cf62-123">Os buffers não são liberados e as operações de leitura e gravação pendentes não são encerradas prematuramente.</span><span class="sxs-lookup"><span data-stu-id="8cf62-123">The buffers are not flushed, and pending read and write operations are not terminated prematurely.</span></span>

<span data-ttu-id="8cf62-124">Um processo reinicializa um recurso de comunicação usando a função [**SetupComm**](/windows/desktop/api/Winbase/nf-winbase-setupcomm) , que executa as seguintes tarefas:</span><span class="sxs-lookup"><span data-stu-id="8cf62-124">A process reinitializes a communications resource by using the [**SetupComm**](/windows/desktop/api/Winbase/nf-winbase-setupcomm) function, which performs the following tasks:</span></span>

-   <span data-ttu-id="8cf62-125">Encerra as operações de leitura e gravação pendentes, mesmo que elas não tenham sido concluídas.</span><span class="sxs-lookup"><span data-stu-id="8cf62-125">Terminates pending read and write operations, even if they have not been completed.</span></span>
-   <span data-ttu-id="8cf62-126">Descarta caracteres não lidos e libera os buffers de entrada e saída internos do driver associado ao recurso especificado.</span><span class="sxs-lookup"><span data-stu-id="8cf62-126">Discards unread characters and frees the internal output and input buffers of the driver associated with the specified resource.</span></span>
-   <span data-ttu-id="8cf62-127">Realoca os buffers de entrada e saída internos.</span><span class="sxs-lookup"><span data-stu-id="8cf62-127">Reallocates the internal output and input buffers.</span></span>

<span data-ttu-id="8cf62-128">Um processo não é necessário para chamar [**SetupComm**](/windows/desktop/api/Winbase/nf-winbase-setupcomm).</span><span class="sxs-lookup"><span data-stu-id="8cf62-128">A process is not required to call [**SetupComm**](/windows/desktop/api/Winbase/nf-winbase-setupcomm).</span></span> <span data-ttu-id="8cf62-129">Caso contrário, o driver do recurso Inicializa o dispositivo com as configurações padrão na primeira vez que o identificador de recursos de comunicação é usado.</span><span class="sxs-lookup"><span data-stu-id="8cf62-129">If it does not, the resource's driver initializes the device with the default settings the first time that the communications resource handle is used.</span></span>

 

 
