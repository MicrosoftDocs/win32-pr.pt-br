---
title: O Multipath I/O agora dá suporte a blocos de solicitação de armazenamento estendidos
description: O Multipath I/O agora dá suporte a blocos de solicitação de armazenamento estendidos
ms.assetid: 5373D9ED-34AF-4D66-8888-49F1EBF768F4
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f558f8088b5066b51447c5f2ea23edd5154d5c10
ms.sourcegitcommit: 46376be61d3fa308f9b1a06d7e2fa122a39755af
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/10/2020
ms.locfileid: "104294567"
---
# <a name="multipath-io-now-supports-extended-storage-request-blocks"></a><span data-ttu-id="8a8a5-103">O Multipath I/O agora dá suporte a blocos de solicitação de armazenamento estendidos</span><span class="sxs-lookup"><span data-stu-id="8a8a5-103">Multipath I/O now supports extended storage request blocks</span></span>

## <a name="platforms"></a><span data-ttu-id="8a8a5-104">Plataformas</span><span class="sxs-lookup"><span data-stu-id="8a8a5-104">Platforms</span></span>

<span data-ttu-id="8a8a5-105">**Servidores** – Windows Server 2012</span><span class="sxs-lookup"><span data-stu-id="8a8a5-105">**Servers** – Windows Server 2012</span></span> 

## <a name="description"></a><span data-ttu-id="8a8a5-106">Descrição</span><span class="sxs-lookup"><span data-stu-id="8a8a5-106">Description</span></span>

<span data-ttu-id="8a8a5-107">No Windows Server 2012, uma nova estrutura, o bloco de solicitação de armazenamento \_ \_ (SRB estendido) substitui o \_ bloco de solicitação SCSI \_ (SRB herdado) na pilha de armazenamento principal.</span><span class="sxs-lookup"><span data-stu-id="8a8a5-107">In Windows Server 2012, a new structure, the STORAGE\_REQUEST\_BLOCK (extended SRB) replaces the SCSI\_REQUEST\_BLOCK (legacy SRB) in the core storage stack.</span></span> <span data-ttu-id="8a8a5-108">O SRBs estendido Replica a funcionalidade do SRBs herdado, mas também é extensível e escalonável.</span><span class="sxs-lookup"><span data-stu-id="8a8a5-108">Extended SRBs replicate the functionality of the legacy SRBs, but are also extensible and scalable.</span></span>

<span data-ttu-id="8a8a5-109">O Multipath I/O (MPIO) dá suporte a SRBs estendidos e permite que DSMs (módulos específicos de dispositivo) especifiquem suporte SRB estendido também.</span><span class="sxs-lookup"><span data-stu-id="8a8a5-109">Multipath I/O (MPIO) supports extended SRBs and allows Device Specific Modules (DSMs) to specify extended SRB support as well.</span></span> <span data-ttu-id="8a8a5-110">No entanto, para que uma pilha de armazenamento do dispositivo de vários caminhos use SRBs estendidos, **todos os componentes na pilha devem oferecer suporte a SRBs estendida, incluindo o DSM**.</span><span class="sxs-lookup"><span data-stu-id="8a8a5-110">However, in order for a multipath device’s storage stack to use extended SRBs, **all components in the stack must support extended SRBs, including the DSM**.</span></span> <span data-ttu-id="8a8a5-111">Observe que o DSM in-box da Microsoft, o MSDSm, oferece suporte ao SRBs estendido.</span><span class="sxs-lookup"><span data-stu-id="8a8a5-111">Note that the Microsoft in-box DSM, MSDSM, does support extended SRBs.</span></span>

<span data-ttu-id="8a8a5-112">A \_ estrutura ex de passagem SCSI \_ \_ não faz parte da estrutura estendida de passagem do MPIO, uma vez que a passagem SCSI estendida pode ser de um tamanho variável, dependendo do CDB (depurador de linha de comando).</span><span class="sxs-lookup"><span data-stu-id="8a8a5-112">The SCSI\_PASS\_THROUGH\_EX structure is not part of the extended MPIO pass through structure since the extended SCSI pass through can be of a variable size, depending on the command line debugger (CDB).</span></span> <span data-ttu-id="8a8a5-113">Em vez disso, a passagem MPIO estendida tem um campo que descreve o deslocamento do início da estrutura de passagem do MPIO estendida para a estrutura de passagem do SCSI \_ \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="8a8a5-113">Instead, the extended MPIO pass through has a field that describes the offset from the beginning of the extended MPIO pass through structure to the SCSI\_PASS\_THROUGH\_EX structure.</span></span> <span data-ttu-id="8a8a5-114">O chamador deve certificar-se de alocar um buffer do tamanho apropriado e definir o deslocamento do SCSI de passagem corretamente.</span><span class="sxs-lookup"><span data-stu-id="8a8a5-114">The caller must make sure they allocate a buffer of the appropriate size and set the SCSI pass through offset correctly.</span></span> <span data-ttu-id="8a8a5-115">Desde que o chamador siga as regras de passagem SCSI estendida, não deve haver nenhum trabalho extra para usar a passagem do MPIO estendida.</span><span class="sxs-lookup"><span data-stu-id="8a8a5-115">As long as the caller follows the rules for extended SCSI pass-throughs, then there should not be any extra work for them to use the extended MPIO pass through.</span></span>

> [!Note]  
> <span data-ttu-id="8a8a5-116">Se o DSM não oferecer suporte a SRBs estendida, o MPIO falhará ao estender solicitações de passagem do MPIO que têm o sinalizador de IOCTL do MPIO \_ \_ envolvendo o sinalizador de \_ \_ DSM definido.</span><span class="sxs-lookup"><span data-stu-id="8a8a5-116">If the DSM does not support extended SRBs, MPIO will fail extended MPIO pass through requests that have the MPIO\_IOCTL\_FLAG\_INVOLVE\_DSM flag set.</span></span>

 

## <a name="manifestation"></a><span data-ttu-id="8a8a5-117">Manifestação</span><span class="sxs-lookup"><span data-stu-id="8a8a5-117">Manifestation</span></span>

<span data-ttu-id="8a8a5-118">Se qualquer parte da pilha de armazenamento do dispositivo, incluindo o DSM, não oferecer suporte a SRBs estendida, a pilha de armazenamento será revertida para usar o SRBs herdado.</span><span class="sxs-lookup"><span data-stu-id="8a8a5-118">If any part of the device’s storage stack, including DSM, does not support extended SRBs, the storage stack will revert to using legacy SRBs.</span></span>

## <a name="solution"></a><span data-ttu-id="8a8a5-119">Solução</span><span class="sxs-lookup"><span data-stu-id="8a8a5-119">Solution</span></span>

<span data-ttu-id="8a8a5-120">Há apenas dois requisitos de MPIO para um DSM dar suporte a \_ blocos de solicitação de armazenamento \_ :</span><span class="sxs-lookup"><span data-stu-id="8a8a5-120">There are only two MPIO requirements for a DSM to support STORAGE\_REQUEST\_BLOCKS:</span></span>

-   <span data-ttu-id="8a8a5-121">O DSM deve relatar seu tipo como DsmType6</span><span class="sxs-lookup"><span data-stu-id="8a8a5-121">The DSM must report its type as DsmType6</span></span>
-   <span data-ttu-id="8a8a5-122">O DSM deve fornecer a \_ \_ \_ função com suporte de tipo de endereço do DSM</span><span class="sxs-lookup"><span data-stu-id="8a8a5-122">The DSM must provide the DSM\_ADDRESS\_TYPE\_SUPPORTED function</span></span>

<span data-ttu-id="8a8a5-123">Se o DSM não relatar DsmType6 ou se reportar DsmType6, mas não fornecer a função de tipo de endereço de DSM \_ \_ \_ com suporte, o MPIO assumirá que o DSM não oferece suporte a SRBs estendidos.</span><span class="sxs-lookup"><span data-stu-id="8a8a5-123">If the DSM does not report DsmType6 or if it reports DsmType6 but does not provide the DSM\_ADDRESS\_TYPE\_SUPPORTED function, MPIO will assume the DSM does not support extended SRBs.</span></span>

<span data-ttu-id="8a8a5-124">A \_ \_ \_ função com suporte de tipo de endereço do DSM aceita dois parâmetros, um dos quais é um tipo de endereço.</span><span class="sxs-lookup"><span data-stu-id="8a8a5-124">The DSM\_ADDRESS\_TYPE\_SUPPORTED function accepts two parameters, one of which is an address type.</span></span> <span data-ttu-id="8a8a5-125">Esse tipo de endereço deve ser um dos valores de tipo de endereço de armazenamento \_ \_ \_ \* definidos em SRB. h.</span><span class="sxs-lookup"><span data-stu-id="8a8a5-125">This address type must be one of the STORAGE\_ADDRESS\_TYPE\_\* values defined in srb.h.</span></span> <span data-ttu-id="8a8a5-126">O DSM deve retornar TRUE se ele der suporte ao tipo de endereço fornecido e FALSE se não.</span><span class="sxs-lookup"><span data-stu-id="8a8a5-126">The DSM must return TRUE if it supports the given address type and FALSE if it does not.</span></span> <span data-ttu-id="8a8a5-127">A definição de "suporte" é, em última análise, o DSM.</span><span class="sxs-lookup"><span data-stu-id="8a8a5-127">The definition of “support” is ultimately up to the DSM.</span></span> <span data-ttu-id="8a8a5-128">O MPIO usa essa função para garantir que o DSM não se comporte se for entregue um SRB estendido com uma \_ estrutura de endereço arma do tipo fornecido.</span><span class="sxs-lookup"><span data-stu-id="8a8a5-128">MPIO uses this function to ensure that the DSM will not misbehave if it is handed an extended SRB with a STOR\_ADDRESS structure of the given type.</span></span> <span data-ttu-id="8a8a5-129">Dessa forma, o MPIO geralmente chama essa função quando um dispositivo de vários caminhos está sendo enumerado, mas a função pode ser chamada a qualquer momento.</span><span class="sxs-lookup"><span data-stu-id="8a8a5-129">As such, MPIO generally calls this function when a multipath device is being enumerated, but the function could be called at any time.</span></span>

<span data-ttu-id="8a8a5-130">Se um DSM nunca tocar em um endereço arma de SRB estendido \_ , ele poderá retornar true para qualquer valor de tipo de endereço de armazenamento válido \_ \_ \_ \* .</span><span class="sxs-lookup"><span data-stu-id="8a8a5-130">If a DSM never touches an extended SRB’s STOR\_ADDRESS, then it can return TRUE for any valid STORAGE\_ADDRESS\_TYPE\_\* value.</span></span> <span data-ttu-id="8a8a5-131">Examine o DSM de exemplo no WDK.</span><span class="sxs-lookup"><span data-stu-id="8a8a5-131">Review the sample DSM in the WDK.</span></span>

<span data-ttu-id="8a8a5-132">**Outras observações importantes**</span><span class="sxs-lookup"><span data-stu-id="8a8a5-132">**Other important notes**</span></span>

-   <span data-ttu-id="8a8a5-133">DSMs que dão suporte ao SRBs estendido devem ser capazes de lidar com \_ \_ estruturas de bloco de solicitação SCSI e estruturas de bloco de solicitação de armazenamento \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="8a8a5-133">DSMs that support extended SRBs must be able to handle both SCSI\_REQUEST\_BLOCK structures and STORAGE\_REQUEST\_BLOCK structures.</span></span> <span data-ttu-id="8a8a5-134">Só porque um DSM relata que dá suporte a SRBs estendida não significa que ele receberá exclusivamente SRBs estendido.</span><span class="sxs-lookup"><span data-stu-id="8a8a5-134">Just because a DSM reports that it supports extended SRBs does not mean that it will exclusively receive extended SRBs.</span></span> <span data-ttu-id="8a8a5-135">Ele ainda pode receber qualquer número de SRBs herdadas, além de SRBs estendidos, e, portanto, deve ser capaz de lidar com ambos.</span><span class="sxs-lookup"><span data-stu-id="8a8a5-135">It may still receive any number of legacy SRBs in addition to extended SRBs, and therefore must be able to handle both.</span></span>
-   <span data-ttu-id="8a8a5-136">Fornecemos um arquivo de cabeçalho no WDK chamado srbhelper. h que contém funções embutidas para ajudar drivers que devem lidar com SRBs estendidos e herdados.</span><span class="sxs-lookup"><span data-stu-id="8a8a5-136">We have provided a header file in the WDK called srbhelper.h that contains inline functions to help drivers that must handle both extended and legacy SRBs.</span></span> <span data-ttu-id="8a8a5-137">Nosso DSM de exemplo usa esse cabeçalho para que você possa usá-lo como um exemplo de como usar essas funções.</span><span class="sxs-lookup"><span data-stu-id="8a8a5-137">Our sample DSM uses this header so you can use it as an example of how to use these functions.</span></span>
-   <span data-ttu-id="8a8a5-138">Um DSM que não dá suporte a SRBs estendida nunca terá que lidar com SRBs estendidos.</span><span class="sxs-lookup"><span data-stu-id="8a8a5-138">A DSM that does not support extended SRBs will never have to handle extended SRBs.</span></span>
-   <span data-ttu-id="8a8a5-139">É possível que um MPIO faça com que a pilha de armazenamento retorne no SRBs herdado no caso de o DSM não oferecer suporte a um determinado \_ tipo de endereço de armazenamento \_ \_ \* (mas, de outra forma, dá suporte a SRBs estendido).</span><span class="sxs-lookup"><span data-stu-id="8a8a5-139">It’s possible that a MPIO will cause the storage stack to fall back on legacy SRBs in the event that the DSM does not support a given STORAGE\_ADDRESS\_TYPE\_\* (but otherwise supports extended SRBs).</span></span>
-   <span data-ttu-id="8a8a5-140">"BTL8" é o único \_ tipo de endereço \_ de armazenamento \_ \* definido atualmente para o Windows Server 2012.</span><span class="sxs-lookup"><span data-stu-id="8a8a5-140">“BTL8” is the only STORAGE\_ADDRESS\_TYPE\_\*currently defined for Windows Server 2012.</span></span>

 

 




