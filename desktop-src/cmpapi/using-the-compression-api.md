---
description: Muitos aplicativos precisam usar compactação e descompactação de dados sem perdas. A API de compactação simplifica isso expondo algoritmos de compactação do Windows por meio de uma API pública.
ms.assetid: D603A7DE-D4A1-4515-9702-B03C81504661
title: Usando a API de compactação
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 01eff163f4ea1ccf03e1cd4ac9cb16a26afeb265
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104089503"
---
# <a name="using-the-compression-api"></a><span data-ttu-id="a3de6-104">Usando a API de compactação</span><span class="sxs-lookup"><span data-stu-id="a3de6-104">Using the Compression API</span></span>

<span data-ttu-id="a3de6-105">Muitos aplicativos precisam usar compactação e descompactação de dados sem perdas.</span><span class="sxs-lookup"><span data-stu-id="a3de6-105">Many applications need to use lossless data compression and decompression.</span></span> <span data-ttu-id="a3de6-106">A API de compactação simplifica isso expondo algoritmos de compactação do Windows por meio de uma API pública.</span><span class="sxs-lookup"><span data-stu-id="a3de6-106">The Compression API simplifies this by exposing Windows compression algorithms through a public API.</span></span> <span data-ttu-id="a3de6-107">Cada algoritmo de compactação tem um conjunto de propriedades que controla seu comportamento.</span><span class="sxs-lookup"><span data-stu-id="a3de6-107">Each compression algorithm has a set of properties that controls its behavior.</span></span> <span data-ttu-id="a3de6-108">A API de compactação expõe uma interface que permite ao desenvolvedor definir ou consultar os valores dessas propriedades.</span><span class="sxs-lookup"><span data-stu-id="a3de6-108">The Compression API exposes an interface that enables the developer to set or query the values of these properties.</span></span> <span data-ttu-id="a3de6-109">Todas as propriedades dos algoritmos de compactação com suporte têm valores padrão que representam valores comumente usados dessas propriedades.</span><span class="sxs-lookup"><span data-stu-id="a3de6-109">All properties for the supported compression algorithms have default values representing commonly used values of these properties.</span></span> <span data-ttu-id="a3de6-110">Se uma propriedade for necessária para compactação e descompactação, os valores padrão serão idênticos, garantindo que valores idênticos sejam usados para compactação e descompactação.</span><span class="sxs-lookup"><span data-stu-id="a3de6-110">If a property is required for both compression and decompression, the default values will be identical, ensuring identical values are used for compression and decompression.</span></span>

## <a name="selecting-the-compression-algorithm"></a><span data-ttu-id="a3de6-111">Selecionando o algoritmo de compactação</span><span class="sxs-lookup"><span data-stu-id="a3de6-111">Selecting the compression algorithm</span></span>

<span data-ttu-id="a3de6-112">Depois que um desenvolvedor decidir que um aplicativo precisa compactar ou descompactar dados, a próxima etapa será escolher um algoritmo de compactação.</span><span class="sxs-lookup"><span data-stu-id="a3de6-112">After a developer decides that an application needs to compress or decompress data, the next step is to choose a compression algorithm.</span></span> <span data-ttu-id="a3de6-113">Isso pode depender de testes para encontrar a melhor combinação de velocidade, taxa de compactação e requisito de memória para um aplicativo específico.</span><span class="sxs-lookup"><span data-stu-id="a3de6-113">This may depend upon tests to find the best performing combination of speed, compression ratio, and memory requirement for a particular application.</span></span> <span data-ttu-id="a3de6-114">A lista a seguir fornece uma comparação relativa dos algoritmos de compactação com suporte no momento pela API de compactação.</span><span class="sxs-lookup"><span data-stu-id="a3de6-114">The following list gives a relative comparison of the compression algorithms currently supported by the Compression API.</span></span> <span data-ttu-id="a3de6-115">Nem todas as opções estão disponíveis para todos os algoritmos de compactação, e a comparação é aproximada porque o desempenho pode depender dos dados de entrada.</span><span class="sxs-lookup"><span data-stu-id="a3de6-115">Not every option is available for every compression algorithm, and the comparison is approximate because performance can depend on the input data.</span></span>

<span data-ttu-id="a3de6-116">XPRESS (**algoritmo de compactação \_ \_ Xpress**)</span><span class="sxs-lookup"><span data-stu-id="a3de6-116">XPRESS (**COMPRESS\_ALGORITHM\_XPRESS**)</span></span>

-   <span data-ttu-id="a3de6-117">Muito rápido com requisitos de recursos baixos</span><span class="sxs-lookup"><span data-stu-id="a3de6-117">Very fast with low resource requirements</span></span>
-   <span data-ttu-id="a3de6-118">Taxa de compactação média</span><span class="sxs-lookup"><span data-stu-id="a3de6-118">Medium compression ratio</span></span>
-   <span data-ttu-id="a3de6-119">Altas velocidades de compactação e descompactação</span><span class="sxs-lookup"><span data-stu-id="a3de6-119">High compression and decompression speeds</span></span>
-   <span data-ttu-id="a3de6-120">Requisito de memória insuficiente</span><span class="sxs-lookup"><span data-stu-id="a3de6-120">Low memory requirement</span></span>
-   <span data-ttu-id="a3de6-121">Dá suporte à opção de **\_ nível de classe de informações \_ \_ de compactação** disponível na enumeração de [**\_ \_ classe Compact Information**](/windows/desktop/api/compressapi/ne-compressapi-compress_information_class) .</span><span class="sxs-lookup"><span data-stu-id="a3de6-121">Supports the **COMPRESS\_INFORMATION\_CLASS\_LEVEL** option available in the [**COMPRESS\_INFORMATION\_CLASS**](/windows/desktop/api/compressapi/ne-compressapi-compress_information_class) enumeration.</span></span> <span data-ttu-id="a3de6-122">O valor padrão é **(DWORD) 0**.</span><span class="sxs-lookup"><span data-stu-id="a3de6-122">The default value is **(DWORD)0**.</span></span> <span data-ttu-id="a3de6-123">Para alguns dados, o valor **(DWORD) 1** pode melhorar a taxa de compactação com uma velocidade de compactação ligeiramente mais lenta.</span><span class="sxs-lookup"><span data-stu-id="a3de6-123">For some data, the value **(DWORD)1** can improve the compression ratio with a slightly slower compression speed.</span></span>

<span data-ttu-id="a3de6-124">XPRESS com codificação Huffman (**compactar \_ algoritmo \_ Xpress \_ Huff**)</span><span class="sxs-lookup"><span data-stu-id="a3de6-124">XPRESS with Huffman encoding (**COMPRESS\_ALGORITHM\_XPRESS\_HUFF**)</span></span>

-   <span data-ttu-id="a3de6-125">A taxa de compactação é maior do que o **algoritmo de compactação \_ \_ Xpress**</span><span class="sxs-lookup"><span data-stu-id="a3de6-125">Compression ratio is higher than **COMPRESS\_ALGORITHM\_XPRESS**</span></span>
-   <span data-ttu-id="a3de6-126">Taxa de compactação média</span><span class="sxs-lookup"><span data-stu-id="a3de6-126">Medium compression ratio</span></span>
-   <span data-ttu-id="a3de6-127">Média para alta compactação e velocidades de descompactação</span><span class="sxs-lookup"><span data-stu-id="a3de6-127">Medium to high compression and decompression speeds</span></span>
-   <span data-ttu-id="a3de6-128">Requisito de memória insuficiente</span><span class="sxs-lookup"><span data-stu-id="a3de6-128">Low memory requirement</span></span>
-   <span data-ttu-id="a3de6-129">Dá suporte à opção de **\_ nível de classe de informações \_ \_ de compactação** na enumeração de [**\_ \_ classe Compact Information**](/windows/desktop/api/compressapi/ne-compressapi-compress_information_class) .</span><span class="sxs-lookup"><span data-stu-id="a3de6-129">Supports the **COMPRESS\_INFORMATION\_CLASS\_LEVEL** option in the [**COMPRESS\_INFORMATION\_CLASS**](/windows/desktop/api/compressapi/ne-compressapi-compress_information_class) enumeration.</span></span> <span data-ttu-id="a3de6-130">O valor padrão é **(DWORD) 0**.</span><span class="sxs-lookup"><span data-stu-id="a3de6-130">The default value is **(DWORD)0**.</span></span> <span data-ttu-id="a3de6-131">Para alguns dados, o valor **(DWORD) 1** pode melhorar a taxa de compactação com uma velocidade de compactação ligeiramente mais lenta.</span><span class="sxs-lookup"><span data-stu-id="a3de6-131">For some data, the value **(DWORD)1** can improve the compression ratio with a slightly slower compression speed.</span></span>

<span data-ttu-id="a3de6-132">MSZIP (**compactar \_ algoritmo \_ MSZIP**)</span><span class="sxs-lookup"><span data-stu-id="a3de6-132">MSZIP (**COMPRESS\_ALGORITHM\_MSZIP**)</span></span>

-   <span data-ttu-id="a3de6-133">Usa mais recursos do que o **algoritmo de compactação \_ \_ Xpress \_ Huff**</span><span class="sxs-lookup"><span data-stu-id="a3de6-133">Uses more resources than **COMPRESS\_ALGORITHM\_XPRESS\_HUFF**</span></span>
-   <span data-ttu-id="a3de6-134">Gera um bloco compactado semelhante ao RFC 1951.</span><span class="sxs-lookup"><span data-stu-id="a3de6-134">Generates a compressed block similar to RFC 1951.</span></span>
-   <span data-ttu-id="a3de6-135">Taxa de compactação média a alta</span><span class="sxs-lookup"><span data-stu-id="a3de6-135">Medium to high compression ratio</span></span>
-   <span data-ttu-id="a3de6-136">Velocidade de compactação média e alta velocidade de descompactação</span><span class="sxs-lookup"><span data-stu-id="a3de6-136">Medium compression speed and high decompression speed</span></span>
-   <span data-ttu-id="a3de6-137">Requisito de memória média</span><span class="sxs-lookup"><span data-stu-id="a3de6-137">Medium memory requirement</span></span>

<span data-ttu-id="a3de6-138">LZMS (**compactar \_ algoritmo \_ LZMS**)</span><span class="sxs-lookup"><span data-stu-id="a3de6-138">LZMS (**COMPRESS\_ALGORITHM\_LZMS**)</span></span>

-   <span data-ttu-id="a3de6-139">Bom algoritmo se o tamanho dos dados a serem compactados for mais de 2 MB.</span><span class="sxs-lookup"><span data-stu-id="a3de6-139">Good algorithm if the size of the data to be compressed is over 2MB.</span></span>
-   <span data-ttu-id="a3de6-140">Alta taxa de compactação</span><span class="sxs-lookup"><span data-stu-id="a3de6-140">High compression ratio</span></span>
-   <span data-ttu-id="a3de6-141">Baixa velocidade de compactação e alta velocidade de descompactação</span><span class="sxs-lookup"><span data-stu-id="a3de6-141">Low compression speed and high decompression speed</span></span>
-   <span data-ttu-id="a3de6-142">Requisito de memória média a alta</span><span class="sxs-lookup"><span data-stu-id="a3de6-142">Medium to high memory requirement</span></span>
-   <span data-ttu-id="a3de6-143">Dá suporte à opção de **tamanho de bloco de classe de informações de compactação \_ \_ \_ \_** na enumeração de [**\_ \_ classe Compact Information**](/windows/desktop/api/compressapi/ne-compressapi-compress_information_class) .</span><span class="sxs-lookup"><span data-stu-id="a3de6-143">Supports the **COMPRESS\_INFORMATION\_CLASS\_BLOCK\_SIZE** option in the [**COMPRESS\_INFORMATION\_CLASS**](/windows/desktop/api/compressapi/ne-compressapi-compress_information_class) enumeration.</span></span> <span data-ttu-id="a3de6-144">Um tamanho mínimo de 1 MB é sugerido para obter uma melhor taxa de compactação.</span><span class="sxs-lookup"><span data-stu-id="a3de6-144">A minimum size of 1 MB is suggested to get a better compression ratio.</span></span>

## <a name="deciding-which-compression-api-mode-to-use"></a><span data-ttu-id="a3de6-145">Decidindo qual modo de API de compactação usar</span><span class="sxs-lookup"><span data-stu-id="a3de6-145">Deciding which Compression API mode to use</span></span>

<span data-ttu-id="a3de6-146">Depois que um desenvolvedor seleciona o algoritmo de compactação, a próxima decisão é qual dos dois modos da API de compactação usar: modo de buffer ou modo de bloqueio.</span><span class="sxs-lookup"><span data-stu-id="a3de6-146">After a developer selects the compression algorithm, the next decision is which of the two modes of the Compression API to use: buffer mode or block mode.</span></span> <span data-ttu-id="a3de6-147">O modo de buffer foi desenvolvido para facilitar o uso e é recomendado para a maioria dos casos.</span><span class="sxs-lookup"><span data-stu-id="a3de6-147">Buffer mode was developed for ease of use and is recommended for most cases.</span></span>

<span data-ttu-id="a3de6-148">O modo de buffer divide automaticamente o buffer de entrada em blocos de um tamanho que é apropriado para o algoritmo de compactação selecionado.</span><span class="sxs-lookup"><span data-stu-id="a3de6-148">Buffer mode automatically splits up the input buffer into blocks of a size that is appropriate for the selected compression algorithm.</span></span> <span data-ttu-id="a3de6-149">O modo de buffer formata e armazena automaticamente o tamanho do buffer descompactado no buffer compactado.</span><span class="sxs-lookup"><span data-stu-id="a3de6-149">The buffer mode automatically formats and stores the uncompressed buffer size in the compressed buffer.</span></span> <span data-ttu-id="a3de6-150">O tamanho do buffer compactado não é salvo automaticamente e o aplicativo precisa salvá-lo para descompactação.</span><span class="sxs-lookup"><span data-stu-id="a3de6-150">The size of the compressed buffer is not automatically saved, and the application needs to save this for decompression.</span></span> <span data-ttu-id="a3de6-151">Não inclua o sinalizador **compactar \_ RAW** no parâmetro *Algorithm* ao chamar [**createcompactár**](/windows/desktop/api/compressapi/nf-compressapi-createcompressor) e [**CreateDecompressor**](/windows/desktop/api/compressapi/nf-compressapi-createdecompressor) para usar o modo de buffer.</span><span class="sxs-lookup"><span data-stu-id="a3de6-151">Do not include the **COMPRESS\_RAW** flag in the *Algorithm* parameter when you call [**CreateCompressor**](/windows/desktop/api/compressapi/nf-compressapi-createcompressor) and [**CreateDecompressor**](/windows/desktop/api/compressapi/nf-compressapi-createdecompressor) to use buffer mode.</span></span> <span data-ttu-id="a3de6-152">Para obter um exemplo de código de um aplicativo de modo de buffer, consulte a seção [usando a API de compactação no modo de buffer](using-the-compression-api-in-buffer-mode.md) .</span><span class="sxs-lookup"><span data-stu-id="a3de6-152">For a code example of a buffer mode application, see the [Using the Compression API in buffer mode](using-the-compression-api-in-buffer-mode.md) section.</span></span>

<span data-ttu-id="a3de6-153">O modo de bloqueio permite que o desenvolvedor controle o tamanho do bloco, mas requer que mais trabalho seja feito pelo aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a3de6-153">Block mode enables the developer to control the block size, but requires more work be done by the application.</span></span> <span data-ttu-id="a3de6-154">Ao usar o modo de bloco, o aplicativo precisa dividir os dados de entrada em pedaços adequadamente ao compactar e, em seguida, colocar as peças de volta ao serem descompactadas.</span><span class="sxs-lookup"><span data-stu-id="a3de6-154">When using block mode, the application has to break the input data into appropriately sized pieces when compressing and then put the pieces back together when decompressing.</span></span> <span data-ttu-id="a3de6-155">O modo de bloqueio falhará se o tamanho do buffer de entrada for maior que o tamanho do bloco interno do algoritmo de compactação.</span><span class="sxs-lookup"><span data-stu-id="a3de6-155">The block mode fails if the size of the input buffer is greater than the internal block size of the compression algorithm.</span></span> <span data-ttu-id="a3de6-156">O tamanho do bloco interno é 32 KB para MSZIP e 1GB para os algoritmos de compactação do XPRESS.</span><span class="sxs-lookup"><span data-stu-id="a3de6-156">The internal block size is 32KB for the MSZIP and 1GB for the XPRESS compression algorithms.</span></span> <span data-ttu-id="a3de6-157">O tamanho do bloco interno para LZMS é configurável até 64 GB com um aumento correspondente no uso de memória.</span><span class="sxs-lookup"><span data-stu-id="a3de6-157">The internal block size for LZMS is configurable up to 64GB with a corresponding increase in memory use.</span></span> <span data-ttu-id="a3de6-158">O tamanho do buffer compactado não é salvo automaticamente e o aplicativo também precisa salvá-lo para descompactação.</span><span class="sxs-lookup"><span data-stu-id="a3de6-158">The size of the compressed buffer is not automatically saved, and the application also needs to save this for decompression.</span></span> <span data-ttu-id="a3de6-159">O valor do parâmetro *UncompressedBufferSize* de [**descompactação**](/windows/desktop/api/compressapi/nf-compressapi-decompress) deve ser exatamente igual ao tamanho original dos dados descompactados e não apenas ao tamanho do buffer de saída.</span><span class="sxs-lookup"><span data-stu-id="a3de6-159">The value of *UncompressedBufferSize* parameter of [**Decompress**](/windows/desktop/api/compressapi/nf-compressapi-decompress) must be exactly equal to the original size of the uncompressed data and not just the size of the output buffer.</span></span> <span data-ttu-id="a3de6-160">Isso significa que o aplicativo deve salvar o tamanho original exato dos dados descompactados, bem como os dados compactados e o tamanho compactado, ao usar o modo de bloqueio.</span><span class="sxs-lookup"><span data-stu-id="a3de6-160">This means your application should save the exact original size of the uncompressed data, as well as the compressed data and compressed size, when using block mode.</span></span> <span data-ttu-id="a3de6-161">Inclua o sinalizador de **compactação \_ bruta** no parâmetro de *algoritmo* ao chamar o [**createcompacter**](/windows/desktop/api/compressapi/nf-compressapi-createcompressor) e o [**CreateDecompressor**](/windows/desktop/api/compressapi/nf-compressapi-createdecompressor) para usar o modo de bloqueio.</span><span class="sxs-lookup"><span data-stu-id="a3de6-161">Include the **COMPRESS\_RAW** flag in the *Algorithm* parameter when you call both [**CreateCompressor**](/windows/desktop/api/compressapi/nf-compressapi-createcompressor) and [**CreateDecompressor**](/windows/desktop/api/compressapi/nf-compressapi-createdecompressor) to use block mode.</span></span> <span data-ttu-id="a3de6-162">Para obter um exemplo de código de um aplicativo de modo de bloco, consulte a seção [usando a API de compactação no modo de bloco](using-the-compression-api-in-block-mode.md) .</span><span class="sxs-lookup"><span data-stu-id="a3de6-162">For a code example of a block mode application, see the [Using the Compression API in block mode](using-the-compression-api-in-block-mode.md) section.</span></span>

## <a name="custom-memory-allocation"></a><span data-ttu-id="a3de6-163">Alocação de memória personalizada</span><span class="sxs-lookup"><span data-stu-id="a3de6-163">Custom memory allocation</span></span>

<span data-ttu-id="a3de6-164">Os aplicativos de modo de bloco e de buffer têm a opção de especificar uma rotina de alocação de memória personalizada quando chamam [**Createcompactár**](/windows/desktop/api/compressapi/nf-compressapi-createcompressor) e [**CreateDecompressor**](/windows/desktop/api/compressapi/nf-compressapi-createdecompressor).</span><span class="sxs-lookup"><span data-stu-id="a3de6-164">Buffer and block mode applications have the option to specify a custom memory allocation routine when they call [**CreateCompressor**](/windows/desktop/api/compressapi/nf-compressapi-createcompressor) and [**CreateDecompressor**](/windows/desktop/api/compressapi/nf-compressapi-createdecompressor).</span></span> <span data-ttu-id="a3de6-165">O parâmetro *AllocationRoutines* especifica a estrutura de [**\_ \_ rotinas de alocação de compactação**](/windows/desktop/api/compressapi/ns-compressapi-compress_allocation_routines) que contém a rotina de alocação de memória.</span><span class="sxs-lookup"><span data-stu-id="a3de6-165">The *AllocationRoutines* parameter specifies the [**COMPRESS\_ALLOCATION\_ROUTINES**](/windows/desktop/api/compressapi/ns-compressapi-compress_allocation_routines) structure that contains the memory allocation routine.</span></span> <span data-ttu-id="a3de6-166">Em seguida, o aplicativo pode definir o tamanho do bloco para o compressor usando [**SetCompressorInformation**](/windows/desktop/api/compressapi/nf-compressapi-setcompressorinformation).</span><span class="sxs-lookup"><span data-stu-id="a3de6-166">The application can then set the block size for the compressor using [**SetCompressorInformation**](/windows/desktop/api/compressapi/nf-compressapi-setcompressorinformation).</span></span> <span data-ttu-id="a3de6-167">Consulte a seção [usando a API de compactação em modo de bloco](using-the-compression-api-in-block-mode.md) para obter um exemplo de uma rotina de alocação personalizada simples.</span><span class="sxs-lookup"><span data-stu-id="a3de6-167">See the [Using the Compression API in block mode](using-the-compression-api-in-block-mode.md) section for an example of a simple customized allocation routine.</span></span>

 

 



