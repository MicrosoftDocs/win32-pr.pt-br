---
description: Esta seção fornece uma visão geral do modelo de threading de manipulação direta, como as mensagens de janela são processadas pela manipulação direta e como o estado de um visor é alterado como entrada é mapeado para os movimentos de saída.
ms.assetid: 0818E34E-990E-4C36-9954-EF87EB226AF6
title: Processando a entrada com DirectManipulation
ms.topic: article
ms.date: 02/03/2020
ms.openlocfilehash: 284a0a1866a2082e2c34c65de347b0dcdfab3a64
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/06/2021
ms.locfileid: "105773928"
---
# <a name="processing-input-with-directmanipulation"></a><span data-ttu-id="98af4-103">Processando a entrada com DirectManipulation</span><span class="sxs-lookup"><span data-stu-id="98af4-103">Processing input with DirectManipulation</span></span>

<span data-ttu-id="98af4-104">Esta seção fornece uma visão geral do modelo de threading de [manipulação direta](direct-manipulation-portal.md) , como as mensagens de janela são processadas pela manipulação direta e como o estado de um visor é alterado como entrada é mapeado para os movimentos de saída.</span><span class="sxs-lookup"><span data-stu-id="98af4-104">This section provides an overview of the [Direct Manipulation](direct-manipulation-portal.md) threading model, how window messages are processed by Direct Manipulation, and how the state of a viewport changes as input is mapped to output motions.</span></span>

- [<span data-ttu-id="98af4-105">Fluxo de entrada</span><span class="sxs-lookup"><span data-stu-id="98af4-105">Input flow</span></span>](#input-flow)
- [<span data-ttu-id="98af4-106">Comentários</span><span class="sxs-lookup"><span data-stu-id="98af4-106">Remarks</span></span>](#remarks)

<span data-ttu-id="98af4-107">A [manipulação direta](direct-manipulation-portal.md) usa dois threads para coordenar operações assíncronas:</span><span class="sxs-lookup"><span data-stu-id="98af4-107">[Direct Manipulation](direct-manipulation-portal.md) uses two threads to coordinate asynchronous operations:</span></span>

<span data-ttu-id="98af4-108">*Thread de interface do usuário* -o thread que possui o **HWND** associado à entrada.</span><span class="sxs-lookup"><span data-stu-id="98af4-108">*UI thread* - the thread that owns the **HWND** associated with input.</span></span> <span data-ttu-id="98af4-109">Esse thread possui inicialização de [manipulação direta](direct-manipulation-portal.md).</span><span class="sxs-lookup"><span data-stu-id="98af4-109">This thread owns initialization of [Direct Manipulation](direct-manipulation-portal.md).</span></span> <span data-ttu-id="98af4-110">O processamento de entrada do mouse e do teclado também ocorre no thread da interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="98af4-110">Mouse and keyboard input processing also happens on the UI thread.</span></span>

<span data-ttu-id="98af4-111">*Delegue thread* -o thread criado e de propriedade da [manipulação direta](direct-manipulation-portal.md).</span><span class="sxs-lookup"><span data-stu-id="98af4-111">*Delegate thread* - the thread created and owned by [Direct Manipulation](direct-manipulation-portal.md).</span></span> <span data-ttu-id="98af4-112">O processamento de entrada por toque ocorre no thread delegado.</span><span class="sxs-lookup"><span data-stu-id="98af4-112">Touch input processing happens on the delegate thread.</span></span>

## <a name="input-flow"></a><span data-ttu-id="98af4-113">Fluxo de entrada</span><span class="sxs-lookup"><span data-stu-id="98af4-113">Input flow</span></span>

<span data-ttu-id="98af4-114">Em uma configuração típica em que o teste de clique é feito no thread da interface do usuário, as mensagens de janela são processadas pela [manipulação direta](direct-manipulation-portal.md) na seguinte ordem:</span><span class="sxs-lookup"><span data-stu-id="98af4-114">In a typical configuration where hit testing is done on the UI thread, window messages are processed by [Direct Manipulation](direct-manipulation-portal.md) in the following order:</span></span>

![diagrama que mostra a ordem na qual as mensagens são processadas.](images/inputprocessing.png)

<span data-ttu-id="98af4-116">Para um visor em repouso:</span><span class="sxs-lookup"><span data-stu-id="98af4-116">For a viewport at rest:</span></span>

1. <span data-ttu-id="98af4-117">Uma série de mensagens do Windows alcança o thread delegado.</span><span class="sxs-lookup"><span data-stu-id="98af4-117">A series of window messages reach the delegate thread.</span></span>
2. <span data-ttu-id="98af4-118">As mensagens de [WM_POINTERDOWN](../inputmsg/wm-pointerdown.md) e [DM_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) são enviadas pelo thread delegado para o thread de teste de clique independente (IHT).</span><span class="sxs-lookup"><span data-stu-id="98af4-118">[WM_POINTERDOWN](../inputmsg/wm-pointerdown.md) and [DM_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) messages are sent by the delegate thread to the Independent Hit Test (IHT) thread.</span></span>
3. <span data-ttu-id="98af4-119">Se [**setcontact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) for chamado a partir do thread IHT, as mensagens poderão ser enviadas ao thread da interface do usuário pelo thread delegado, dependendo do valor [**do \_ \_ tipo DIRECTMANIPULATION HITTEST**](/windows/win32/api/directmanipulation/ne-directmanipulation-directmanipulation_hittest_type) quando [**RegisterHitTestTarget**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-registerhittesttarget) for chamado.</span><span class="sxs-lookup"><span data-stu-id="98af4-119">If [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) is called from the IHT thread, messages might get sent to the UI thread by the delegate thread, depending on the value of [**DIRECTMANIPULATION\_HITTEST\_TYPE**](/windows/win32/api/directmanipulation/ne-directmanipulation-directmanipulation_hittest_type) when [**RegisterHitTestTarget**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-registerhittesttarget) was called.</span></span>
4. <span data-ttu-id="98af4-120">Se [**setcontact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) não for chamado a partir do thread IHT, as mensagens serão sempre enviadas pelo thread delegado para o thread da interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="98af4-120">If [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) is not called from the IHT thread, messages are always sent by the delegate thread to the UI thread.</span></span>
5. <span data-ttu-id="98af4-121">O cliente pode chamar [**setcontact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) do thread da interface do usuário para permitir que a [manipulação direta](direct-manipulation-portal.md) detecte uma manipulação.</span><span class="sxs-lookup"><span data-stu-id="98af4-121">The client can call [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) from the UI thread to let [Direct Manipulation](direct-manipulation-portal.md) detect a manipulation.</span></span>
6. <span data-ttu-id="98af4-122">Se uma manipulação for detectada, a [manipulação direta](direct-manipulation-portal.md) enviará uma mensagem do [WM/_POINTERCAPTURECHANGED](../inputmsg/wm-pointercapturechanged.md) para notificar o cliente de que a entrada está sendo tratada pela manipulação direta.</span><span class="sxs-lookup"><span data-stu-id="98af4-122">If a manipulation is detected, [Direct Manipulation](direct-manipulation-portal.md) sends a [WM/_POINTERCAPTURECHANGED](../inputmsg/wm-pointercapturechanged.md) message to notify the client that the input is being handled by Direct Manipulation.</span></span> <span data-ttu-id="98af4-123">O status do visor é definido como **em execução** e a transformação saída será atualizada.</span><span class="sxs-lookup"><span data-stu-id="98af4-123">The viewport status is set to **RUNNING** and the output transform will be updated.</span></span>
7. <span data-ttu-id="98af4-124">Se uma interação diferente de uma manipulação for detectada, a [manipulação direta](direct-manipulation-portal.md) enviará as mensagens restantes para o thread da interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="98af4-124">If an interaction other than a manipulation is detected, [Direct Manipulation](direct-manipulation-portal.md) sends remaining messages to the UI thread.</span></span>

<span data-ttu-id="98af4-125">Para um visor em movimento (com um status de em execução ou inércia), a mensagem de janela alcança o thread delegado primeiro, em que a [manipulação direta](direct-manipulation-portal.md) faz testes em todas as viewports em execução.</span><span class="sxs-lookup"><span data-stu-id="98af4-125">For a viewport in motion (with a status of RUNNING or INERTIA), the window message reaches the delegate thread first, where [Direct Manipulation](direct-manipulation-portal.md) hit tests against all running viewports.</span></span> <span data-ttu-id="98af4-126">A manipulação direta atribui automaticamente o contato para as viewports apropriadas identificadas pelo teste de clique.</span><span class="sxs-lookup"><span data-stu-id="98af4-126">Direct Manipulation automatically assigns the contact to the appropriate viewports identified by hit testing.</span></span> <span data-ttu-id="98af4-127">O status do visor está em execução e a transformação saída será atualizada.</span><span class="sxs-lookup"><span data-stu-id="98af4-127">The viewport status is RUNNING and the output transform will be updated.</span></span>

<span data-ttu-id="98af4-128">Em alguns casos, um thread de interface do usuário do aplicativo pode estar muito lento para responder a testes de clique.</span><span class="sxs-lookup"><span data-stu-id="98af4-128">In some cases, an application UI thread may be too slow to respond to hit testing.</span></span> <span data-ttu-id="98af4-129">Um thread de teste de clique pode ser usado ([**RegisterHitTestTarget**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-registerhittesttarget)) para permitir que o cliente mova o [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) e as mensagens de [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) para um thread específico para permitir o teste de clique.</span><span class="sxs-lookup"><span data-stu-id="98af4-129">A hit test thread may be used ([**RegisterHitTestTarget**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-registerhittesttarget)) to allow the client to move [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) and [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) messages to a specific thread to allow for hit testing.</span></span>

## <a name="remarks"></a><span data-ttu-id="98af4-130">Comentários</span><span class="sxs-lookup"><span data-stu-id="98af4-130">Remarks</span></span>

<span data-ttu-id="98af4-131">Normalmente, a [manipulação direta](direct-manipulation-portal.md) envia somente mensagens do [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) e [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) ao thread da interface do usuário, recolocando mensagens posteriores enquanto aguarda uma resposta do cliente.</span><span class="sxs-lookup"><span data-stu-id="98af4-131">Typically, [Direct Manipulation](direct-manipulation-portal.md) sends only [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) and [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) messages to the UI thread, withholding later messages while waiting for a response from the client.</span></span> <span data-ttu-id="98af4-132">Se o cliente chamar [**setcontact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact), as únicas mensagens que o thread da interface do usuário recebe quando uma manipulação é detectada são o [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) e o [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md)e a [mensagem do WM/_POINTERCAPTURECHANGED](../inputmsg/wm-pointercapturechanged.md).</span><span class="sxs-lookup"><span data-stu-id="98af4-132">If the client calls [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact), the only messages the UI thread receives when a manipulation is detected are [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) and [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md), and [WM/_POINTERCAPTURECHANGED message](../inputmsg/wm-pointercapturechanged.md).</span></span>

<span data-ttu-id="98af4-133">O cliente pode não chamar [**setcontact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) ao processar mensagens do [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) e [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) .</span><span class="sxs-lookup"><span data-stu-id="98af4-133">The client might not call [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) when processing [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) and [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) messages.</span></span> <span data-ttu-id="98af4-134">Nesse caso, a [manipulação direta](direct-manipulation-portal.md) envia todas as mensagens para o thread da interface do usuário sem analisar as mensagens para ver se há uma manipulação.</span><span class="sxs-lookup"><span data-stu-id="98af4-134">In this case, [Direct Manipulation](direct-manipulation-portal.md) sends all messages to the UI thread without analyzing the messages to see if there is a manipulation.</span></span> <span data-ttu-id="98af4-135">Em seguida, o cliente pode escolher qualquer ponto para chamar **setcontact** e fazer com que a manipulação direta comece a detectar manipulações e envie mensagens de [mensagem do WM/_POINTERCAPTURECHANGED](../inputmsg/wm-pointercapturechanged.md) quando uma for detectada.</span><span class="sxs-lookup"><span data-stu-id="98af4-135">The client can then choose any point to call **SetContact** and have Direct Manipulation start detecting manipulations, and send [WM/_POINTERCAPTURECHANGED message](../inputmsg/wm-pointercapturechanged.md) messages when one is detected.</span></span>

<span data-ttu-id="98af4-136">**Windows 10 e posterior:** Você pode decidir quais manipulações deseja manipular chamando [**DeferContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationdefercontactservice-defercontact) antes de chamar [**setcontact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) em uma mensagem do [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) ou [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) .</span><span class="sxs-lookup"><span data-stu-id="98af4-136">**Windows 10 and later:** You can decide which manipulations you want to handle by calling [**DeferContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationdefercontactservice-defercontact) before calling [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) on a [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) or [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) message.</span></span> <span data-ttu-id="98af4-137">**DeferContact** garante que todas as mensagens subsequentes sejam enviadas ao thread da interface do usuário pelo período de tempo especificado.</span><span class="sxs-lookup"><span data-stu-id="98af4-137">**DeferContact** ensures all subsequent messages are sent to the UI thread for the specified period of time.</span></span>
