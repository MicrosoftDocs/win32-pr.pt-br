---
description: Cada processo tem um heap padrão fornecido pelo sistema. Os aplicativos que fazem alocações frequentes do heap podem melhorar o desempenho usando heaps particulares.
ms.assetid: cfb683fa-4f46-48b5-9a28-f4625a9cb8cd
title: Funções de heap
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d0e591c1e349ed6806cbebe00a178a99e63bb412
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103828260"
---
# <a name="heap-functions"></a><span data-ttu-id="f278f-104">Funções de heap</span><span class="sxs-lookup"><span data-stu-id="f278f-104">Heap Functions</span></span>

<span data-ttu-id="f278f-105">Cada processo tem um heap padrão fornecido pelo sistema.</span><span class="sxs-lookup"><span data-stu-id="f278f-105">Each process has a default heap provided by the system.</span></span> <span data-ttu-id="f278f-106">Os aplicativos que fazem alocações frequentes do heap podem melhorar o desempenho usando heaps particulares.</span><span class="sxs-lookup"><span data-stu-id="f278f-106">Applications that make frequent allocations from the heap can improve performance by using private heaps.</span></span>

<span data-ttu-id="f278f-107">Um heap privado é um bloco de uma ou mais páginas no espaço de endereço do processo de chamada.</span><span class="sxs-lookup"><span data-stu-id="f278f-107">A private heap is a block of one or more pages in the address space of the calling process.</span></span> <span data-ttu-id="f278f-108">Depois de criar o heap privado, o processo usa funções como [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) e [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree) para gerenciar a memória nesse heap.</span><span class="sxs-lookup"><span data-stu-id="f278f-108">After creating the private heap, the process uses functions such as [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) and [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree) to manage the memory in that heap.</span></span>

<span data-ttu-id="f278f-109">As funções de heap também podem ser usadas para gerenciar a memória no heap padrão do processo, usando o identificador retornado pela função [**GetProcessHeap**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) .</span><span class="sxs-lookup"><span data-stu-id="f278f-109">The heap functions can also be used to manage memory in the process's default heap, using the handle returned by the [**GetProcessHeap**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) function.</span></span> <span data-ttu-id="f278f-110">Os novos aplicativos devem usar as funções de heap em vez das [funções globais e locais](global-and-local-functions.md) para essa finalidade.</span><span class="sxs-lookup"><span data-stu-id="f278f-110">New applications should use the heap functions instead of the [global and local functions](global-and-local-functions.md) for this purpose.</span></span>

<span data-ttu-id="f278f-111">Não há nenhuma diferença entre a memória alocada de um heap privado e alocada usando as outras funções de alocação de memória.</span><span class="sxs-lookup"><span data-stu-id="f278f-111">There is no difference between memory allocated from a private heap and that allocated by using the other memory allocation functions.</span></span> <span data-ttu-id="f278f-112">Para obter uma lista completa de funções, consulte a tabela em [funções de gerenciamento de memória](memory-management-functions.md).</span><span class="sxs-lookup"><span data-stu-id="f278f-112">For a complete list of functions, see the table in [Memory Management Functions](memory-management-functions.md).</span></span>

> [!Note]  
> <span data-ttu-id="f278f-113">Um thread deve chamar funções de heap somente para o heap padrão do processo e heaps privados que o thread cria e gerencia, usando identificadores retornados pela função [**GetProcessHeap**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) ou [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) .</span><span class="sxs-lookup"><span data-stu-id="f278f-113">A thread should call heap functions only for the process's default heap and private heaps that the thread creates and manages, using handles returned by the [**GetProcessHeap**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) or [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) function.</span></span>

 

<span data-ttu-id="f278f-114">A função [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) cria um objeto heap privado do qual o processo de chamada pode alocar blocos de memória usando a função [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) .</span><span class="sxs-lookup"><span data-stu-id="f278f-114">The [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) function creates a private heap object from which the calling process can allocate memory blocks by using the [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) function.</span></span> <span data-ttu-id="f278f-115">**HeapCreate** especifica um tamanho inicial e um tamanho máximo para o heap.</span><span class="sxs-lookup"><span data-stu-id="f278f-115">**HeapCreate** specifies both an initial size and a maximum size for the heap.</span></span> <span data-ttu-id="f278f-116">O tamanho inicial determina o número de páginas confirmadas de leitura/gravação inicialmente alocadas para o heap.</span><span class="sxs-lookup"><span data-stu-id="f278f-116">The initial size determines the number of committed, read/write pages initially allocated for the heap.</span></span> <span data-ttu-id="f278f-117">O tamanho máximo determina o número total de páginas reservadas.</span><span class="sxs-lookup"><span data-stu-id="f278f-117">The maximum size determines the total number of reserved pages.</span></span> <span data-ttu-id="f278f-118">Essas páginas criam um bloco contíguo no espaço de endereço virtual de um processo no qual o heap pode crescer.</span><span class="sxs-lookup"><span data-stu-id="f278f-118">These pages create a contiguous block in the virtual address space of a process into which the heap can grow.</span></span> <span data-ttu-id="f278f-119">Páginas adicionais serão confirmadas automaticamente desse espaço reservado se as solicitações por **HeapAlloc** excederem o tamanho atual das páginas confirmadas, supondo que o armazenamento físico para ela esteja disponível.</span><span class="sxs-lookup"><span data-stu-id="f278f-119">Additional pages are automatically committed from this reserved space if requests by **HeapAlloc** exceed the current size of committed pages, assuming that the physical storage for it is available.</span></span> <span data-ttu-id="f278f-120">Depois que as páginas são confirmadas, elas não são confirmadas até que o processo seja encerrado ou até que o heap seja destruído chamando a função [**HeapDestroy**](/windows/desktop/api/HeapApi/nf-heapapi-heapdestroy) .</span><span class="sxs-lookup"><span data-stu-id="f278f-120">Once the pages are committed, they are not decommitted until the process is terminated or until the heap is destroyed by calling the [**HeapDestroy**](/windows/desktop/api/HeapApi/nf-heapapi-heapdestroy) function.</span></span>

<span data-ttu-id="f278f-121">A memória de um objeto heap privado é acessível somente para o processo que o criou.</span><span class="sxs-lookup"><span data-stu-id="f278f-121">The memory of a private heap object is accessible only to the process that created it.</span></span> <span data-ttu-id="f278f-122">Se uma DLL (biblioteca de vínculo dinâmico) criar um heap privado, ele fará isso no espaço de endereço do processo que chamou a DLL.</span><span class="sxs-lookup"><span data-stu-id="f278f-122">If a dynamic-link library (DLL) creates a private heap, it does so in the address space of the process that called the DLL.</span></span> <span data-ttu-id="f278f-123">Ele só pode ser acessado por esse processo.</span><span class="sxs-lookup"><span data-stu-id="f278f-123">It is accessible only to that process.</span></span>

<span data-ttu-id="f278f-124">A função [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) aloca um número especificado de bytes de um heap privado e retorna um ponteiro para o bloco alocado.</span><span class="sxs-lookup"><span data-stu-id="f278f-124">The [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) function allocates a specified number of bytes from a private heap and returns a pointer to the allocated block.</span></span> <span data-ttu-id="f278f-125">Esse ponteiro pode ser usado nas funções [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree), [**HeapReAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heaprealloc), [**heapsize**](/windows/desktop/api/HeapApi/nf-heapapi-heapsize)e [**HeapValidate**](/windows/desktop/api/HeapApi/nf-heapapi-heapvalidate) .</span><span class="sxs-lookup"><span data-stu-id="f278f-125">This pointer can be used in the [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree), [**HeapReAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heaprealloc), [**HeapSize**](/windows/desktop/api/HeapApi/nf-heapapi-heapsize), and [**HeapValidate**](/windows/desktop/api/HeapApi/nf-heapapi-heapvalidate) functions.</span></span>

<span data-ttu-id="f278f-126">A memória alocada por [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) não é móvel.</span><span class="sxs-lookup"><span data-stu-id="f278f-126">Memory allocated by [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) is not movable.</span></span> <span data-ttu-id="f278f-127">O endereço retornado por **HeapAlloc** é válido até que o bloco de memória seja liberado ou realocado; o bloco de memória não precisa ser bloqueado.</span><span class="sxs-lookup"><span data-stu-id="f278f-127">The address returned by **HeapAlloc** is valid until the memory block is freed or reallocated; the memory block does not need to be locked.</span></span>

<span data-ttu-id="f278f-128">Como o sistema não pode compactar um heap privado, ele pode se tornar fragmentado.</span><span class="sxs-lookup"><span data-stu-id="f278f-128">Because the system cannot compact a private heap, it can become fragmented.</span></span> <span data-ttu-id="f278f-129">Os aplicativos que alocam grandes quantidades de memória em vários tamanhos de alocação podem usar o [heap de baixa fragmentação](low-fragmentation-heap.md) para reduzir a fragmentação de heap.</span><span class="sxs-lookup"><span data-stu-id="f278f-129">Applications that allocate large amounts of memory in various allocation sizes can use the [low-fragmentation heap](low-fragmentation-heap.md) to reduce heap fragmentation.</span></span>

<span data-ttu-id="f278f-130">Um possível uso para as funções de heap é criar um heap privado quando um processo é iniciado, especificando um tamanho inicial suficiente para atender aos requisitos de memória do processo.</span><span class="sxs-lookup"><span data-stu-id="f278f-130">A possible use for the heap functions is to create a private heap when a process starts up, specifying an initial size sufficient to satisfy the memory requirements of the process.</span></span> <span data-ttu-id="f278f-131">Se a chamada para a função [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) falhar, o processo poderá encerrar ou notificar o usuário sobre a falta de memória; no entanto, se tiver sucesso, o processo será garantido de ter a memória de que precisa.</span><span class="sxs-lookup"><span data-stu-id="f278f-131">If the call to the [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) function fails, the process can terminate or notify the user of the memory shortage; if it succeeds, however, the process is assured of having the memory it needs.</span></span>

<span data-ttu-id="f278f-132">A memória solicitada por [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) pode ou não ser contígua.</span><span class="sxs-lookup"><span data-stu-id="f278f-132">Memory requested by [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) may or may not be contiguous.</span></span> <span data-ttu-id="f278f-133">A memória alocada em um heap por [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) é contígua.</span><span class="sxs-lookup"><span data-stu-id="f278f-133">Memory allocated within a heap by [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) is contiguous.</span></span> <span data-ttu-id="f278f-134">Você não deve gravar na memória ou lê-la em um heap, exceto pelo que foi alocado por **HeapAlloc**, nem deve assumir qualquer relação entre duas áreas de memória alocadas por **HeapAlloc**.</span><span class="sxs-lookup"><span data-stu-id="f278f-134">You should not write to or read from memory in a heap except that allocated by **HeapAlloc**, nor should you assume any relationship between two areas of memory allocated by **HeapAlloc**.</span></span>

<span data-ttu-id="f278f-135">Você não deve se referir a nenhuma forma de memória que foi liberada por [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree).</span><span class="sxs-lookup"><span data-stu-id="f278f-135">You should not refer in any way to memory that has been freed by [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree).</span></span> <span data-ttu-id="f278f-136">Depois que a memória é liberada, todas as informações que podem estar em si não são feitas para sempre.</span><span class="sxs-lookup"><span data-stu-id="f278f-136">After the memory is freed, any information that may have been in it is gone forever.</span></span> <span data-ttu-id="f278f-137">Se você precisar de informações, não Libere memória que contenha as informações.</span><span class="sxs-lookup"><span data-stu-id="f278f-137">If you require information, do not free memory containing the information.</span></span> <span data-ttu-id="f278f-138">As chamadas de função que retornam informações sobre a memória (como [**heapsize**](/windows/desktop/api/HeapApi/nf-heapapi-heapsize)) não podem ser usadas com memória liberada, pois podem retornar dados falsos.</span><span class="sxs-lookup"><span data-stu-id="f278f-138">Function calls that return information about memory (such as [**HeapSize**](/windows/desktop/api/HeapApi/nf-heapapi-heapsize)) may not be used with freed memory, as they may return bogus data.</span></span>

<span data-ttu-id="f278f-139">A função [**HeapDestroy**](/windows/desktop/api/HeapApi/nf-heapapi-heapdestroy) destrói um objeto heap privado.</span><span class="sxs-lookup"><span data-stu-id="f278f-139">The [**HeapDestroy**](/windows/desktop/api/HeapApi/nf-heapapi-heapdestroy) function destroys a private heap object.</span></span> <span data-ttu-id="f278f-140">Ele desconfirma e libera Todas as páginas do objeto heap e invalida o identificador para o heap.</span><span class="sxs-lookup"><span data-stu-id="f278f-140">It decommits and releases all the pages of the heap object, and it invalidates the handle to the heap.</span></span>

## <a name="related-topics"></a><span data-ttu-id="f278f-141">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="f278f-141">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="f278f-142">Comparando métodos de alocação de memória</span><span class="sxs-lookup"><span data-stu-id="f278f-142">Comparing Memory Allocation Methods</span></span>](comparing-memory-allocation-methods.md)
</dt> </dl>

 

 



