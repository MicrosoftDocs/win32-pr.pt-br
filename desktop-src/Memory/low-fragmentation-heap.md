---
description: A fragmentação de heap é um estado no qual a memória disponível é quebrada em blocos pequenos e não contíguos.
ms.assetid: d10abf82-423c-4942-b05e-55de3a5c4219
title: Heap de baixa fragmentação
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8ad14a97fa6d95b663f63b21f0982332ba0de01e
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105792503"
---
# <a name="low-fragmentation-heap"></a><span data-ttu-id="ff4cf-103">Heap de baixa fragmentação</span><span class="sxs-lookup"><span data-stu-id="ff4cf-103">Low-fragmentation Heap</span></span>

<span data-ttu-id="ff4cf-104">\[As informações neste tópico se aplicam ao Windows Server 2003 e ao Windows XP.</span><span class="sxs-lookup"><span data-stu-id="ff4cf-104">\[The information in this topic applies to Windows Server 2003 and Windows XP.</span></span> <span data-ttu-id="ff4cf-105">A partir do Windows Vista, o sistema usa o LFH (heap de baixa fragmentação) conforme necessário para solicitações de alocação de memória de serviço.</span><span class="sxs-lookup"><span data-stu-id="ff4cf-105">Starting with Windows Vista, the system uses the low-fragmentation heap (LFH) as needed to service memory allocation requests.</span></span> <span data-ttu-id="ff4cf-106">Os aplicativos não precisam habilitar o LFH para seus heaps.\]</span><span class="sxs-lookup"><span data-stu-id="ff4cf-106">Applications do not need to enable the LFH for their heaps.\]</span></span>

<span data-ttu-id="ff4cf-107">A fragmentação de heap é um estado no qual a memória disponível é quebrada em blocos pequenos e não contíguos.</span><span class="sxs-lookup"><span data-stu-id="ff4cf-107">Heap fragmentation is a state in which available memory is broken into small, noncontiguous blocks.</span></span> <span data-ttu-id="ff4cf-108">Quando um heap é fragmentado, a alocação de memória pode falhar mesmo quando a memória total disponível no heap é suficiente para atender a uma solicitação, porque nenhum bloco de memória é grande o suficiente.</span><span class="sxs-lookup"><span data-stu-id="ff4cf-108">When a heap is fragmented, memory allocation can fail even when the total available memory in the heap is enough to satisfy a request, because no single block of memory is large enough.</span></span> <span data-ttu-id="ff4cf-109">O heap de baixa fragmentação (LFH) ajuda a reduzir a fragmentação do heap.</span><span class="sxs-lookup"><span data-stu-id="ff4cf-109">The low-fragmentation heap (LFH) helps to reduce heap fragmentation.</span></span>

<span data-ttu-id="ff4cf-110">O LFH não é um heap separado.</span><span class="sxs-lookup"><span data-stu-id="ff4cf-110">The LFH is not a separate heap.</span></span> <span data-ttu-id="ff4cf-111">Em vez disso, é uma política que os aplicativos podem habilitar para seus heaps.</span><span class="sxs-lookup"><span data-stu-id="ff4cf-111">Instead, it is a policy that applications can enable for their heaps.</span></span> <span data-ttu-id="ff4cf-112">Quando o LFH está habilitado, o sistema aloca memória em determinados tamanhos predeterminados.</span><span class="sxs-lookup"><span data-stu-id="ff4cf-112">When the LFH is enabled, the system allocates memory in certain predetermined sizes.</span></span> <span data-ttu-id="ff4cf-113">Quando um aplicativo solicita uma alocação de memória de um heap que tem o LFH habilitado, o sistema aloca o menor bloco de memória que é grande o suficiente para conter o tamanho solicitado.</span><span class="sxs-lookup"><span data-stu-id="ff4cf-113">When an application requests a memory allocation from a heap that has the LFH enabled, the system allocates the smallest block of memory that is large enough to contain the requested size.</span></span> <span data-ttu-id="ff4cf-114">O sistema não usa o LFH para alocações com mais de 16 KB, independentemente de o LFH estar ou não habilitado.</span><span class="sxs-lookup"><span data-stu-id="ff4cf-114">The system does not use the LFH for allocations larger than 16 KB, whether or not the LFH is enabled.</span></span>

<span data-ttu-id="ff4cf-115">Um aplicativo deve habilitar o LFH somente para o heap padrão do processo de chamada ou para [heaps particulares](heap-functions.md) que o aplicativo criou.</span><span class="sxs-lookup"><span data-stu-id="ff4cf-115">An application should enable the LFH only for the default heap of the calling process or for [private heaps](heap-functions.md) that the application has created.</span></span> <span data-ttu-id="ff4cf-116">Para habilitar o LFH para um heap, use a função [**GetProcessHeap**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) para obter um identificador para o heap padrão do processo de chamada ou use o identificador para um heap privado criado pela função [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) .</span><span class="sxs-lookup"><span data-stu-id="ff4cf-116">To enable the LFH for a heap, use the [**GetProcessHeap**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) function to obtain a handle to the default heap of the calling process, or use the handle to a private heap created by the [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) function.</span></span> <span data-ttu-id="ff4cf-117">Em seguida, chame a função [**HeapSetInformation**](/windows/desktop/api/HeapApi/nf-heapapi-heapsetinformation) com a alça.</span><span class="sxs-lookup"><span data-stu-id="ff4cf-117">Then call the [**HeapSetInformation**](/windows/desktop/api/HeapApi/nf-heapapi-heapsetinformation) function with the handle.</span></span>

<span data-ttu-id="ff4cf-118">O LFH não pode ser habilitado para heaps criados com **heap \_ sem \_ serialização** ou para heaps criados com um tamanho fixo.</span><span class="sxs-lookup"><span data-stu-id="ff4cf-118">The LFH cannot be enabled for heaps created with **HEAP\_NO\_SERIALIZE** or for heaps created with a fixed size.</span></span> <span data-ttu-id="ff4cf-119">O LFH também não poderá ser habilitado se você estiver usando as ferramentas de depuração de heap em [ferramentas de depuração para Windows](/windows-hardware/drivers/debugger/) ou [Microsoft Application Verifier](https://www.microsoft.com/downloads/details.aspx?FamilyID=c4a25ab9-649d-4a1b-b4a7-c9d8b095df18&displaylang=en).</span><span class="sxs-lookup"><span data-stu-id="ff4cf-119">The LFH also cannot be enabled if you are using the heap debugging tools in [Debugging Tools for Windows](/windows-hardware/drivers/debugger/) or [Microsoft Application Verifier](https://www.microsoft.com/downloads/details.aspx?FamilyID=c4a25ab9-649d-4a1b-b4a7-c9d8b095df18&displaylang=en).</span></span>

<span data-ttu-id="ff4cf-120">Depois que o LFH tiver sido habilitado para um heap, ele não poderá ser desabilitado.</span><span class="sxs-lookup"><span data-stu-id="ff4cf-120">After the LFH has been enabled for a heap, it cannot be disabled.</span></span>

<span data-ttu-id="ff4cf-121">Aplicativos que se beneficiam mais do LFH são aplicativos multissegmentados que alocam memória com frequência e usam uma variedade de tamanhos de alocação abaixo de 16 KB.</span><span class="sxs-lookup"><span data-stu-id="ff4cf-121">Applications that benefit most from the LFH are multithreaded applications that allocate memory frequently and use a variety of allocation sizes under 16 KB.</span></span> <span data-ttu-id="ff4cf-122">No entanto, nem todos os aplicativos se beneficiam do LFH.</span><span class="sxs-lookup"><span data-stu-id="ff4cf-122">However, not all applications benefit from the LFH.</span></span> <span data-ttu-id="ff4cf-123">Para avaliar os efeitos de habilitar o LFH em seu aplicativo, use dados de criação de perfil de desempenho.</span><span class="sxs-lookup"><span data-stu-id="ff4cf-123">To assess the effects of enabling the LFH in your application, use performance profiling data.</span></span>

 

 
