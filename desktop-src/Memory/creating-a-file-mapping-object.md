---
description: A primeira etapa no mapeamento de um arquivo é abrir o arquivo chamando a função CreateFile.
ms.assetid: e00d8742-b717-419c-902c-9a286d75d8aa
title: Criando um objeto de mapeamento de arquivo
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b502c484dd0466b47a87f4db205d1da5499bf5ef
ms.sourcegitcommit: c3f669dc1d52278432bf75ad9fddba3257d26aa2
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 06/04/2021
ms.locfileid: "111432498"
---
# <a name="creating-a-file-mapping-object"></a><span data-ttu-id="8af5b-103">Criando um objeto de mapeamento de arquivo</span><span class="sxs-lookup"><span data-stu-id="8af5b-103">Creating a File Mapping Object</span></span>

<span data-ttu-id="8af5b-104">A primeira etapa no mapeamento de um arquivo é abrir o arquivo chamando a [**função CreateFile.**](/windows/win32/api/fileapi/nf-fileapi-createfilea)</span><span class="sxs-lookup"><span data-stu-id="8af5b-104">The first step in mapping a file is to open the file by calling the [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea) function.</span></span> <span data-ttu-id="8af5b-105">Para garantir que outros processos não podem gravar na parte do arquivo mapeado, você deve abrir o arquivo com acesso exclusivo.</span><span class="sxs-lookup"><span data-stu-id="8af5b-105">To ensure that other processes cannot write to the portion of the file that is mapped, you should open the file with exclusive access.</span></span> <span data-ttu-id="8af5b-106">Além disso, o identificador de arquivo deve permanecer aberto até que o processo não precise mais do objeto de mapeamento de arquivo.</span><span class="sxs-lookup"><span data-stu-id="8af5b-106">In addition, the file handle should remain open until the process no longer needs the file mapping object.</span></span> <span data-ttu-id="8af5b-107">Uma maneira fácil de obter acesso exclusivo é especificar zero no *parâmetro fdwShareMode* de **CreateFile.**</span><span class="sxs-lookup"><span data-stu-id="8af5b-107">An easy way to obtain exclusive access is to specify zero in the *fdwShareMode* parameter of **CreateFile**.</span></span> <span data-ttu-id="8af5b-108">O identificador retornado **por CreateFile** é usado pela [**função CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) para criar um objeto de mapeamento de arquivo.</span><span class="sxs-lookup"><span data-stu-id="8af5b-108">The handle returned by **CreateFile** is used by the [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) function to create a file mapping object.</span></span>

<span data-ttu-id="8af5b-109">A [**função CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) retorna um identificador para o objeto de mapeamento de arquivo.</span><span class="sxs-lookup"><span data-stu-id="8af5b-109">The [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) function returns a handle to the file mapping object.</span></span> <span data-ttu-id="8af5b-110">Esse handle será usado ao criar [uma exibição de arquivo](creating-a-file-view.md) para que você possa acessar a memória compartilhada.</span><span class="sxs-lookup"><span data-stu-id="8af5b-110">This handle will be used when [creating a file view](creating-a-file-view.md) so that you can access the shared memory.</span></span> <span data-ttu-id="8af5b-111">Quando você chama **CreateFileMapping**, especifica um nome de objeto, o número de bytes a serem mapeados do arquivo e a permissão de leitura/gravação para a memória mapeada.</span><span class="sxs-lookup"><span data-stu-id="8af5b-111">When you call **CreateFileMapping**, you specify an object name, the number of bytes to be mapped from the file, and the read/write permission for the mapped memory.</span></span> <span data-ttu-id="8af5b-112">O primeiro processo que chama **CreateFileMapping** cria o objeto de mapeamento de arquivo.</span><span class="sxs-lookup"><span data-stu-id="8af5b-112">The first process that calls **CreateFileMapping** creates the file mapping object.</span></span> <span data-ttu-id="8af5b-113">Os processos **que chamam CreateFileMapping** para um objeto existente recebem um identificador para o objeto existente.</span><span class="sxs-lookup"><span data-stu-id="8af5b-113">Processes calling **CreateFileMapping** for an existing object receive a handle to the existing object.</span></span> <span data-ttu-id="8af5b-114">Você pode saber se uma chamada bem-sucedida para **CreateFileMapping** criou ou abriu o objeto de mapeamento de arquivo chamando a [**função GetLastError.**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror)</span><span class="sxs-lookup"><span data-stu-id="8af5b-114">You can tell whether or not a successful call to **CreateFileMapping** created or opened the file mapping object by calling the [**GetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror) function.</span></span> <span data-ttu-id="8af5b-115">**GetLastError** retorna **NO \_ ERROR** para o processo de criação e **ERROR ALREADY EXISTS \_ \_ para** processos subsequentes.</span><span class="sxs-lookup"><span data-stu-id="8af5b-115">**GetLastError** returns **NO\_ERROR** to the creating process and **ERROR\_ALREADY\_EXISTS** to subsequent processes.</span></span>

<span data-ttu-id="8af5b-116">A [**função CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) falhará se os sinalizadores de acesso entrarem em conflito com aqueles especificados quando a [**função CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea) abriu o arquivo.</span><span class="sxs-lookup"><span data-stu-id="8af5b-116">The [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) function fails if the access flags conflict with those specified when the [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea) function opened the file.</span></span> <span data-ttu-id="8af5b-117">Por exemplo, para ler e gravar no arquivo:</span><span class="sxs-lookup"><span data-stu-id="8af5b-117">For example, to read and write to the file:</span></span>

-   <span data-ttu-id="8af5b-118">**Especifique \_ os valores** **GENERIC READ e GENERIC \_ WRITE** no *parâmetro fdwAccess* de [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea).</span><span class="sxs-lookup"><span data-stu-id="8af5b-118">Specify the **GENERIC\_READ** and **GENERIC\_WRITE** values in the *fdwAccess* parameter of [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea).</span></span>
-   <span data-ttu-id="8af5b-119">**Especifique o valor PAGE \_ READWRITE** no *parâmetro fdwProtect* de [**CreateFileMapping.**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga)</span><span class="sxs-lookup"><span data-stu-id="8af5b-119">Specify the **PAGE\_READWRITE** value in the *fdwProtect* parameter of [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga).</span></span>

<span data-ttu-id="8af5b-120">A criação de um objeto de mapeamento de arquivo não confirma a memória física, ele só a reserva.</span><span class="sxs-lookup"><span data-stu-id="8af5b-120">Creating a file mapping object does not commit physical memory, it only reserves it.</span></span>

## <a name="file-mapping-size"></a><span data-ttu-id="8af5b-121">Tamanho do mapeamento de arquivo</span><span class="sxs-lookup"><span data-stu-id="8af5b-121">File Mapping Size</span></span>

<span data-ttu-id="8af5b-122">O tamanho do objeto de mapeamento de arquivo é independente do tamanho do arquivo que está sendo mapeado.</span><span class="sxs-lookup"><span data-stu-id="8af5b-122">The size of the file mapping object is independent of the size of the file being mapped.</span></span> <span data-ttu-id="8af5b-123">No entanto, se o objeto de mapeamento de arquivo for maior que o arquivo, o sistema expandirá o arquivo antes que [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) retorne.</span><span class="sxs-lookup"><span data-stu-id="8af5b-123">However, if the file mapping object is larger than the file, the system expands the file before [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) returns.</span></span> <span data-ttu-id="8af5b-124">Se o objeto de mapeamento de arquivo for menor que o arquivo, o sistema mapeará apenas o número especificado de bytes do arquivo.</span><span class="sxs-lookup"><span data-stu-id="8af5b-124">If the file mapping object is smaller than the file, the system maps only the specified number of bytes from the file.</span></span>

<span data-ttu-id="8af5b-125">Os *parâmetros dwMaximumSizeHigh* e *dwMaximumSizeLow* de [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) permitem que você especifique o número de bytes a serem mapeados do arquivo:</span><span class="sxs-lookup"><span data-stu-id="8af5b-125">The *dwMaximumSizeHigh* and *dwMaximumSizeLow* parameters of [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) allow you to specify the number of bytes to be mapped from the file:</span></span>

-   <span data-ttu-id="8af5b-126">Quando você não quiser que o tamanho do arquivo seja altere (por exemplo, ao mapear arquivos somente leitura), chame [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) e especifique zero para *dwMaximumSizeHigh* e *dwMaximumSizeLow*.</span><span class="sxs-lookup"><span data-stu-id="8af5b-126">When you do not want the size of the file to change (for example, when mapping read-only files), call [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) and specify zero for both *dwMaximumSizeHigh* and *dwMaximumSizeLow*.</span></span> <span data-ttu-id="8af5b-127">Isso cria um objeto de mapeamento de arquivo que tem exatamente o mesmo tamanho que o arquivo.</span><span class="sxs-lookup"><span data-stu-id="8af5b-127">Doing this creates a file mapping object that is exactly the same size as the file.</span></span> <span data-ttu-id="8af5b-128">Caso contrário, você deve calcular ou estimar o tamanho do arquivo concluído porque os objetos de mapeamento de arquivo são estáticos em tamanho; uma vez criado, seu tamanho não pode ser aumentado ou reduzido.</span><span class="sxs-lookup"><span data-stu-id="8af5b-128">Otherwise, you must calculate or estimate the size of the finished file because file mapping objects are static in size; once created, their size cannot be increased or decreased.</span></span> <span data-ttu-id="8af5b-129">Uma tentativa de mapear um arquivo com um comprimento de zero dessa maneira falha com um código de erro **DE ARQUIVO DE ERRO \_ \_ INVÁLIDO.**</span><span class="sxs-lookup"><span data-stu-id="8af5b-129">An attempt to map a file with a length of zero in this manner fails with an error code of **ERROR\_FILE\_INVALID**.</span></span> <span data-ttu-id="8af5b-130">Os programas devem testar arquivos com um comprimento de zero e rejeitar esses arquivos.</span><span class="sxs-lookup"><span data-stu-id="8af5b-130">Programs should test for files with a length of zero and reject such files.</span></span>

-   <span data-ttu-id="8af5b-131">O tamanho de um objeto de mapeamento de arquivo que é apoiado por um arquivo nomeado é limitado pelo espaço em disco.</span><span class="sxs-lookup"><span data-stu-id="8af5b-131">The size of a file mapping object that is backed by a named file is limited by disk space.</span></span> <span data-ttu-id="8af5b-132">O tamanho de uma exibição de arquivo é limitado ao maior bloco contíguo disponível de memória virtual não reservada.</span><span class="sxs-lookup"><span data-stu-id="8af5b-132">The size of a file view is limited to the largest available contiguous block of unreserved virtual memory.</span></span> <span data-ttu-id="8af5b-133">Isso é, no máximo, 2 GB menos a memória virtual já reservada pelo processo.</span><span class="sxs-lookup"><span data-stu-id="8af5b-133">This is at most 2 GB minus the virtual memory already reserved by the process.</span></span>

<span data-ttu-id="8af5b-134">O tamanho do objeto de mapeamento de arquivo selecionado controla a distância até o arquivo que você pode "ver" com o mapeamento de memória.</span><span class="sxs-lookup"><span data-stu-id="8af5b-134">The size of the file mapping object that you select controls how far into the file you can "see" with memory mapping.</span></span> <span data-ttu-id="8af5b-135">Se você criar um objeto de mapeamento de arquivo com 500 Kb de tamanho, terá acesso somente aos primeiros 500 Kb do arquivo, independentemente do tamanho do arquivo.</span><span class="sxs-lookup"><span data-stu-id="8af5b-135">If you create a file mapping object that is 500 Kb in size, you have access only to the first 500 Kb of the file, regardless of the size of the file.</span></span> <span data-ttu-id="8af5b-136">Como não custa nenhum recurso do sistema criar um objeto de mapeamento de arquivo maior, crie um objeto de mapeamento de arquivo que seja o tamanho do arquivo (de conjunto os parâmetros *dwMaximumSizeHigh* e *dwMaximumSizeLow* [**de CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) como zero), mesmo que você não espere exibir todo o arquivo.</span><span class="sxs-lookup"><span data-stu-id="8af5b-136">Since it does not cost you any system resources to create a larger file mapping object, create a file mapping object that is the size of the file (set the *dwMaximumSizeHigh* and *dwMaximumSizeLow* parameters of [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) both to zero) even if you do not expect to view the entire file.</span></span> <span data-ttu-id="8af5b-137">O custo nos recursos do sistema vem ao criar as exibições e acessá-las.</span><span class="sxs-lookup"><span data-stu-id="8af5b-137">The cost in system resources comes in creating the views and accessing them.</span></span>

<span data-ttu-id="8af5b-138">Você pode exibir uma parte do arquivo que não é iniciada no início do arquivo.</span><span class="sxs-lookup"><span data-stu-id="8af5b-138">You can view a portion of the file that does not start at the beginning of the file.</span></span> <span data-ttu-id="8af5b-139">Para obter mais informações, consulte [Criando uma exibição dentro de um arquivo](creating-a-view-within-a-file.md).</span><span class="sxs-lookup"><span data-stu-id="8af5b-139">For more information, see [Creating a View Within a File](creating-a-view-within-a-file.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="8af5b-140">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="8af5b-140">Related topics</span></span>

<dl> <span data-ttu-id="8af5b-141"><dt>
[Criando uma exibição de](creating-a-file-view.md)
</dt> <dt> 
[arquivo criando uma exibição dentro de um arquivo](creating-a-view-within-a-file.md)
</dt> </span><span class="sxs-lookup"><span data-stu-id="8af5b-141"><dt>
[Creating a File View](creating-a-file-view.md)
</dt> <dt>
[Creating a View Within a File](creating-a-view-within-a-file.md)
</dt> </span></span></dl>


 
