---
description: O mapeamento de arquivo pode ser usado para compartilhar um arquivo ou memória entre dois ou mais processos. Para compartilhar um arquivo ou uma memória, todos os processos devem usar o nome ou o identificador do mesmo objeto de mapeamento de arquivo.
ms.assetid: 942cb50d-df07-444f-bba5-58194556ae66
title: Compartilhando arquivos e memória
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 98d402eba3f87f1f799593ae0d6b23fba06124a8
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103647206"
---
# <a name="sharing-files-and-memory"></a><span data-ttu-id="c5382-104">Compartilhando arquivos e memória</span><span class="sxs-lookup"><span data-stu-id="c5382-104">Sharing Files and Memory</span></span>

<span data-ttu-id="c5382-105">O mapeamento de arquivo pode ser usado para compartilhar um arquivo ou memória entre dois ou mais processos.</span><span class="sxs-lookup"><span data-stu-id="c5382-105">File mapping can be used to share a file or memory between two or more processes.</span></span> <span data-ttu-id="c5382-106">Para compartilhar um arquivo ou uma memória, todos os processos devem usar o nome ou o identificador do mesmo objeto de mapeamento de arquivo.</span><span class="sxs-lookup"><span data-stu-id="c5382-106">To share a file or memory, all of the processes must use the name or the handle of the same file mapping object.</span></span>

<span data-ttu-id="c5382-107">Para compartilhar um arquivo, o primeiro processo cria ou abre um arquivo usando a função [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea) .</span><span class="sxs-lookup"><span data-stu-id="c5382-107">To share a file, the first process creates or opens a file by using the [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea) function.</span></span> <span data-ttu-id="c5382-108">Em seguida, ele cria um objeto de mapeamento de arquivo usando a função [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) , especificando o identificador de arquivo e um nome para o objeto de mapeamento de arquivo.</span><span class="sxs-lookup"><span data-stu-id="c5382-108">Next, it creates a file mapping object by using the [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) function, specifying the file handle and a name for the file mapping object.</span></span> <span data-ttu-id="c5382-109">Os nomes dos objetos evento, semáforo, mutex, temporizador de espera, trabalho e mapeamento de arquivo compartilham o mesmo namespace.</span><span class="sxs-lookup"><span data-stu-id="c5382-109">The names of event, semaphore, mutex, waitable timer, job, and file mapping objects share the same namespace.</span></span> <span data-ttu-id="c5382-110">Portanto, as funções **CreateFileMapping** e [**OpenFileMapping**](/windows/desktop/api/WinBase/nf-winbase-openfilemappinga) falharão se especificarem um nome que está sendo usado por um objeto de outro tipo.</span><span class="sxs-lookup"><span data-stu-id="c5382-110">Therefore, the **CreateFileMapping** and [**OpenFileMapping**](/windows/desktop/api/WinBase/nf-winbase-openfilemappinga) functions fail if they specify a name that is in use by an object of another type.</span></span>

<span data-ttu-id="c5382-111">Para compartilhar memória que não está associada a um arquivo, um processo deve usar a função [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) e especificar um \_ valor de identificador inválido \_ como o parâmetro *hFile* em vez de um identificador de arquivo existente.</span><span class="sxs-lookup"><span data-stu-id="c5382-111">To share memory that is not associated with a file, a process must use the [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) function and specify INVALID\_HANDLE\_VALUE as the *hFile* parameter instead of an existing file handle.</span></span> <span data-ttu-id="c5382-112">O objeto de mapeamento de arquivo correspondente acessa a memória apoiada pelo arquivo de paginação do sistema.</span><span class="sxs-lookup"><span data-stu-id="c5382-112">The corresponding file mapping object accesses memory backed by the system paging file.</span></span> <span data-ttu-id="c5382-113">Você deve especificar um tamanho maior que zero quando especificar um *hFile* de valor de \_ identificador inválido \_ em uma chamada para **CreateFileMapping**.</span><span class="sxs-lookup"><span data-stu-id="c5382-113">You must specify a size greater than zero when you specify an *hFile* of INVALID\_HANDLE\_VALUE in a call to **CreateFileMapping**.</span></span>

<span data-ttu-id="c5382-114">A maneira mais fácil de outros processos obter um identificador do objeto de mapeamento de arquivo criado pelo primeiro processo é usar a função [**OpenFileMapping**](/windows/desktop/api/WinBase/nf-winbase-openfilemappinga) e especificar o nome do objeto.</span><span class="sxs-lookup"><span data-stu-id="c5382-114">The easiest way for other processes to obtain a handle of the file mapping object created by the first process is to use the [**OpenFileMapping**](/windows/desktop/api/WinBase/nf-winbase-openfilemappinga) function and specify the object's name.</span></span> <span data-ttu-id="c5382-115">Isso é conhecido como *memória compartilhada nomeada*.</span><span class="sxs-lookup"><span data-stu-id="c5382-115">This is referred to as *named shared memory*.</span></span> <span data-ttu-id="c5382-116">Se o objeto de mapeamento de arquivo não tiver um nome, o processo deverá obter um identificador para ele por meio de herança ou duplicação.</span><span class="sxs-lookup"><span data-stu-id="c5382-116">If the file mapping object does not have a name, the process must obtain a handle to it through inheritance or duplication.</span></span> <span data-ttu-id="c5382-117">Para obter mais informações sobre a herança e a duplicação, consulte [herança](../procthread/inheritance.md).</span><span class="sxs-lookup"><span data-stu-id="c5382-117">For more information on inheritance and duplication, see [Inheritance](../procthread/inheritance.md).</span></span>

<span data-ttu-id="c5382-118">Os processos que compartilham arquivos ou memória devem criar exibições de arquivo usando a função [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) ou [**MapViewOfFileEx**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffileex) .</span><span class="sxs-lookup"><span data-stu-id="c5382-118">Processes that share files or memory must create file views by using the [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) or [**MapViewOfFileEx**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffileex) function.</span></span> <span data-ttu-id="c5382-119">Eles devem coordenar o acesso usando semáforos, mutexes, eventos ou alguma outra técnica de exclusão mútua.</span><span class="sxs-lookup"><span data-stu-id="c5382-119">They must coordinate their access using semaphores, mutexes, events, or some other mutual exclusion technique.</span></span> <span data-ttu-id="c5382-120">Para obter mais informações, consulte [sincronização](../sync/synchronization.md).</span><span class="sxs-lookup"><span data-stu-id="c5382-120">For more information, see [Synchronization](../sync/synchronization.md).</span></span>

<span data-ttu-id="c5382-121">Um objeto de mapeamento de arquivo compartilhado não será destruído até que todos os processos que o usam fechem seus identificadores para ele usando a função [**CloseHandle**](/windows/win32/api/handleapi/nf-handleapi-closehandle) .</span><span class="sxs-lookup"><span data-stu-id="c5382-121">A shared file mapping object will not be destroyed until all processes that use it close their handles to it by using the [**CloseHandle**](/windows/win32/api/handleapi/nf-handleapi-closehandle) function.</span></span>

<span data-ttu-id="c5382-122">Para obter informações sobre segurança de objeto de mapeamento de arquivo, consulte [segurança de mapeamento de arquivo e direitos de acesso](file-mapping-security-and-access-rights.md).</span><span class="sxs-lookup"><span data-stu-id="c5382-122">For information about file mapping object security, see [File Mapping Security and Access Rights](file-mapping-security-and-access-rights.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="c5382-123">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="c5382-123">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="c5382-124">Criando a memória compartilhada nomeada</span><span class="sxs-lookup"><span data-stu-id="c5382-124">Creating Named Shared Memory</span></span>](creating-named-shared-memory.md)
</dt> </dl>

 

 
