---
description: A DEP (prevenção de execução de dados) é um recurso de proteção de memória no nível do sistema que é criado no sistema operacional, começando com o Windows XP e o Windows Server 2003.
ms.assetid: 75cd83a5-4b77-4ca9-b595-e32d0dd609d0
title: Prevenção de Execução de Dados
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8bc53febb383ef2789c2798b091960c2d20856d0
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105780621"
---
# <a name="data-execution-prevention"></a><span data-ttu-id="c592c-103">Prevenção de Execução de Dados</span><span class="sxs-lookup"><span data-stu-id="c592c-103">Data Execution Prevention</span></span>

<span data-ttu-id="c592c-104">A DEP (prevenção de execução de dados) é um recurso de proteção de memória no nível do sistema que é criado no sistema operacional, começando com o Windows XP e o Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="c592c-104">Data Execution Prevention (DEP) is a system-level memory protection feature that is built into the operating system starting with Windows XP and Windows Server 2003.</span></span> <span data-ttu-id="c592c-105">O DEP permite que o sistema marque uma ou mais páginas de memória como não executáveis.</span><span class="sxs-lookup"><span data-stu-id="c592c-105">DEP enables the system to mark one or more pages of memory as non-executable.</span></span> <span data-ttu-id="c592c-106">Marcar regiões de memória como não executáveis significa que o código não pode ser executado dessa região de memória, o que dificulta a exploração de estouros de buffer.</span><span class="sxs-lookup"><span data-stu-id="c592c-106">Marking memory regions as non-executable means that code cannot be run from that region of memory, which makes it harder for the exploitation of buffer overruns.</span></span>

<span data-ttu-id="c592c-107">A DEP impede que o código seja executado a partir de páginas de dados como heap, pilhas e pools de memória padrão.</span><span class="sxs-lookup"><span data-stu-id="c592c-107">DEP prevents code from being run from data pages such as the default heap, stacks, and memory pools.</span></span> <span data-ttu-id="c592c-108">Se um aplicativo tentar executar o código de uma página de dados protegida, ocorrerá uma exceção de violação de acesso à memória e, se a exceção não for tratada, o processo de chamada será encerrado.</span><span class="sxs-lookup"><span data-stu-id="c592c-108">If an application attempts to run code from a data page that is protected, a memory access violation exception occurs, and if the exception is not handled, the calling process is terminated.</span></span>

<span data-ttu-id="c592c-109">A DEP não se destina a ser uma defesa abrangente contra todas as explorações; Ela se destina a ser outra ferramenta que você pode usar para proteger seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c592c-109">DEP is not intended to be a comprehensive defense against all exploits; it is intended to be another tool that you can use to secure your application.</span></span>

## <a name="how-data-execution-prevention-works"></a><span data-ttu-id="c592c-110">Como funciona a prevenção de execução de dados</span><span class="sxs-lookup"><span data-stu-id="c592c-110">How Data Execution Prevention Works</span></span>

<span data-ttu-id="c592c-111">Se um aplicativo tentar executar o código de uma página protegida, o aplicativo receberá uma exceção com o status **código \_ status \_ violação de acesso**.</span><span class="sxs-lookup"><span data-stu-id="c592c-111">If an application attempts to run code from a protected page, the application receives an exception with the status code **STATUS\_ACCESS\_VIOLATION**.</span></span> <span data-ttu-id="c592c-112">Se seu aplicativo deve executar o código de uma página de memória, ele deve alocar e definir os atributos de [proteção de memória](memory-protection.md) virtual apropriados.</span><span class="sxs-lookup"><span data-stu-id="c592c-112">If your application must run code from a memory page, it must allocate and set the proper virtual [memory protection](memory-protection.md) attributes.</span></span> <span data-ttu-id="c592c-113">A memória alocada deve ser marcada como **Page \_ Execute**, **Page \_ Execute \_ Read**, **Page \_ Execute \_ ReadWrite** ou **Page \_ Execute \_ WRITECOPY** ao alocar memória.</span><span class="sxs-lookup"><span data-stu-id="c592c-113">The allocated memory must be marked **PAGE\_EXECUTE**, **PAGE\_EXECUTE\_READ**, **PAGE\_EXECUTE\_READWRITE**, or **PAGE\_EXECUTE\_WRITECOPY** when allocating memory.</span></span> <span data-ttu-id="c592c-114">As alocações de heap feitas chamando as funções **malloc** e [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) são não executáveis.</span><span class="sxs-lookup"><span data-stu-id="c592c-114">Heap allocations made by calling the **malloc** and [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) functions are non-executable.</span></span>

<span data-ttu-id="c592c-115">Os aplicativos não podem executar o código do heap de processo padrão ou da pilha.</span><span class="sxs-lookup"><span data-stu-id="c592c-115">Applications cannot run code from the default process heap or the stack.</span></span>

<span data-ttu-id="c592c-116">O DEP é configurado na inicialização do sistema de acordo com a configuração de política de proteção de página sem execução nos dados de configuração da inicialização.</span><span class="sxs-lookup"><span data-stu-id="c592c-116">DEP is configured at system boot according to the no-execute page protection policy setting in the boot configuration data.</span></span> <span data-ttu-id="c592c-117">Um aplicativo pode obter a configuração de política atual chamando a função [**GetSystemDEPPolicy**](/windows/desktop/api/WinBase/nf-winbase-getsystemdeppolicy) .</span><span class="sxs-lookup"><span data-stu-id="c592c-117">An application can get the current policy setting by calling the [**GetSystemDEPPolicy**](/windows/desktop/api/WinBase/nf-winbase-getsystemdeppolicy) function.</span></span> <span data-ttu-id="c592c-118">Dependendo da configuração de política, um aplicativo pode alterar a configuração de DEP para o processo atual chamando a função [**SetProcessDEPPolicy**](/windows/desktop/api/WinBase/nf-winbase-setprocessdeppolicy) .</span><span class="sxs-lookup"><span data-stu-id="c592c-118">Depending on the policy setting, an application can change the DEP setting for the current process by calling the [**SetProcessDEPPolicy**](/windows/desktop/api/WinBase/nf-winbase-setprocessdeppolicy) function.</span></span>

## <a name="programming-considerations"></a><span data-ttu-id="c592c-119">Considerações sobre programação</span><span class="sxs-lookup"><span data-stu-id="c592c-119">Programming Considerations</span></span>

<span data-ttu-id="c592c-120">Um aplicativo pode usar a função do [**VirtualAlloc**](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc) para alocar memória executável com as opções de proteção de memória apropriadas.</span><span class="sxs-lookup"><span data-stu-id="c592c-120">An application can use the [**VirtualAlloc**](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc) function to allocate executable memory with the appropriate memory protection options.</span></span> <span data-ttu-id="c592c-121">É recomendável que um conjunto de aplicativos, no mínimo, a opção de proteção de memória de **\_ execução de página** .</span><span class="sxs-lookup"><span data-stu-id="c592c-121">It is suggested that an application set, at a minimum, the **PAGE\_EXECUTE** memory protection option.</span></span> <span data-ttu-id="c592c-122">Depois que o código executável é gerado, é recomendável que o aplicativo defina as proteções de memória para não permitir acesso de gravação à memória alocada.</span><span class="sxs-lookup"><span data-stu-id="c592c-122">After the executable code is generated, it is recommended that the application set memory protections to disallow write access to the allocated memory.</span></span> <span data-ttu-id="c592c-123">Os aplicativos podem não permitir o acesso de gravação à memória alocada usando a função [**usar VirtualProtect**](/windows/win32/api/memoryapi/nf-memoryapi-virtualprotect) .</span><span class="sxs-lookup"><span data-stu-id="c592c-123">Applications can disallow write access to allocated memory by using the [**VirtualProtect**](/windows/win32/api/memoryapi/nf-memoryapi-virtualprotect) function.</span></span> <span data-ttu-id="c592c-124">A despermissão de acesso de gravação garante a proteção máxima para regiões executáveis do espaço de endereço do processo.</span><span class="sxs-lookup"><span data-stu-id="c592c-124">Disallowing write access ensures maximum protection for executable regions of process address space.</span></span> <span data-ttu-id="c592c-125">Você deve tentar criar aplicativos que usam o menor espaço de endereço executável possível, o que minimiza a quantidade de memória exposta à exploração de memória.</span><span class="sxs-lookup"><span data-stu-id="c592c-125">You should attempt to create applications that use the smallest executable address space possible, which minimizes the amount of memory that is exposed to memory exploitation.</span></span>

<span data-ttu-id="c592c-126">Você também deve tentar controlar o layout da memória virtual do seu aplicativo e criar regiões executáveis.</span><span class="sxs-lookup"><span data-stu-id="c592c-126">You should also attempt to control the layout of your application's virtual memory and create executable regions.</span></span> <span data-ttu-id="c592c-127">Essas regiões executáveis devem estar localizadas em um espaço de memória menor do que as regiões não executáveis.</span><span class="sxs-lookup"><span data-stu-id="c592c-127">These executable regions should be located in a lower memory space than non-executable regions.</span></span> <span data-ttu-id="c592c-128">Ao localizar regiões executáveis abaixo de regiões não executáveis, você pode ajudar a evitar que um estouro de buffer flua para a área executável da memória.</span><span class="sxs-lookup"><span data-stu-id="c592c-128">By locating executable regions below non-executable regions, you can help prevent a buffer overflow from overflowing into the executable area of memory.</span></span>

## <a name="application-compatibility"></a><span data-ttu-id="c592c-129">Compatibilidade de aplicativos</span><span class="sxs-lookup"><span data-stu-id="c592c-129">Application Compatibility</span></span>

<span data-ttu-id="c592c-130">Algumas funcionalidades de aplicativos são incompatíveis com o DEP.</span><span class="sxs-lookup"><span data-stu-id="c592c-130">Some application functionality is incompatible with DEP.</span></span> <span data-ttu-id="c592c-131">Os aplicativos que executam geração de código dinâmico (como geração de código just-in-time) e não marcam explicitamente o código gerado com permissão de execução podem ter problemas de compatibilidade em computadores que usam o DEP.</span><span class="sxs-lookup"><span data-stu-id="c592c-131">Applications that perform dynamic code generation (such as Just-In-Time code generation) and do not explicitly mark generated code with execute permission may have compatibility issues on computers that are using DEP.</span></span> <span data-ttu-id="c592c-132">Os aplicativos escritos no Active Template Library (ATL) versão 7,1 e anteriores podem tentar executar código em páginas marcadas como não executáveis, o que dispara uma falha de NX e encerra o aplicativo; para obter mais informações, consulte [**SetProcessDEPPolicy**](/windows/desktop/api/WinBase/nf-winbase-setprocessdeppolicy).</span><span class="sxs-lookup"><span data-stu-id="c592c-132">Applications written to the Active Template Library (ATL) version 7.1 and earlier can attempt to execute code on pages marked as non-executable, which triggers an NX fault and terminates the application; for more information, see [**SetProcessDEPPolicy**](/windows/desktop/api/WinBase/nf-winbase-setprocessdeppolicy).</span></span> <span data-ttu-id="c592c-133">A maioria dos aplicativos que executa ações incompatíveis com o DEP deve ser atualizada para funcionar corretamente.</span><span class="sxs-lookup"><span data-stu-id="c592c-133">Most applications that perform actions incompatible with DEP must be updated to function properly.</span></span>

<span data-ttu-id="c592c-134">Um pequeno número de arquivos e bibliotecas executáveis pode conter código executável na seção de dados de um arquivo de imagem.</span><span class="sxs-lookup"><span data-stu-id="c592c-134">A small number of executable files and libraries may contain executable code in the data section of an image file.</span></span> <span data-ttu-id="c592c-135">Em alguns casos, os aplicativos podem posicionar pequenos segmentos de código (comumente chamados de conversões) nas seções de dados.</span><span class="sxs-lookup"><span data-stu-id="c592c-135">In some cases, applications may place small segments of code (commonly referred to as thunks) in the data sections.</span></span> <span data-ttu-id="c592c-136">No entanto, a DEP marca as seções do arquivo de imagem que é carregado na memória como não executável, a menos que a seção tenha o atributo executável aplicado.</span><span class="sxs-lookup"><span data-stu-id="c592c-136">However, DEP marks sections of the image file that is loaded in memory as non-executable unless the section has the executable attribute applied.</span></span>

<span data-ttu-id="c592c-137">Portanto, o código executável nas seções de dados deve ser migrado para uma seção de código ou a seção de dados que contém o código executável deve ser explicitamente marcada como executável.</span><span class="sxs-lookup"><span data-stu-id="c592c-137">Therefore, executable code in data sections should be migrated to a code section, or the data section that contains the executable code should be explicitly marked as executable.</span></span> <span data-ttu-id="c592c-138">O atributo executável, **Image \_ SCN \_ mem \_ Execute**, deve ser adicionado ao campo **características** do cabeçalho da seção correspondente para as seções que contêm código executável.</span><span class="sxs-lookup"><span data-stu-id="c592c-138">The executable attribute, **IMAGE\_SCN\_MEM\_EXECUTE**, should be added to the **Characteristics** field of the corresponding section header for sections that contain executable code.</span></span> <span data-ttu-id="c592c-139">Para obter mais informações sobre como adicionar atributos a uma seção, consulte a documentação incluída com o vinculador.</span><span class="sxs-lookup"><span data-stu-id="c592c-139">For more information about adding attributes to a section, see the documentation included with your linker.</span></span>

## <a name="related-topics"></a><span data-ttu-id="c592c-140">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="c592c-140">Related topics</span></span>

<dl> <dt>

<span data-ttu-id="c592c-141">[Prevenção de execução de dados (TechNet)](/previous-versions/windows/it-pro/windows-xp/bb457155(v=technet.10))</span><span class="sxs-lookup"><span data-stu-id="c592c-141">[Data Execution Prevention (TechNet)](/previous-versions/windows/it-pro/windows-xp/bb457155(v=technet.10))</span></span>
</dt> <dt>

[<span data-ttu-id="c592c-142">Como configurar a proteção de memória</span><span class="sxs-lookup"><span data-stu-id="c592c-142">How to Configure Memory Protection</span></span>](https://www.microsoft.com/technet/security/prodtech/windowsxp/depcnfxp.mspx)
</dt> <dt>

[<span data-ttu-id="c592c-143">Artigo 875352 da base de conhecimento</span><span class="sxs-lookup"><span data-stu-id="c592c-143">KB Article 875352</span></span>](https://support.microsoft.com/kb/875352)
</dt> </dl>

 

 
