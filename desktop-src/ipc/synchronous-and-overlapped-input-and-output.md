---
description: E/s de pipe síncrono e I/O de pipe assíncrono. As funções ReadFile, WriteFile, TransactNamedPipe e ConnectNamedPipe podem executar operações de entrada e saída em um pipe de forma síncrona ou assíncrona.
ms.assetid: 5ab9bb7f-1f99-4041-bba8-2863f34dbcaf
title: E/s de pipe síncrono e sobreposto
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3becfb19dfe5fa49d4121246a576fb3200226b1a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "105788843"
---
# <a name="synchronous-and-overlapped-pipe-io"></a><span data-ttu-id="cf4a5-104">E/s de pipe síncrono e sobreposto</span><span class="sxs-lookup"><span data-stu-id="cf4a5-104">Synchronous and Overlapped Pipe I/O</span></span>

<span data-ttu-id="cf4a5-105">As funções [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), [**TransactNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-transactnamedpipe)e [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) podem executar operações de entrada e saída em um pipe de forma síncrona ou assíncrona.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-105">The [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), [**TransactNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-transactnamedpipe), and [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) functions can perform input and output operations on a pipe either synchronously or asynchronously.</span></span> <span data-ttu-id="cf4a5-106">Quando uma função é executada de forma síncrona, ela não retorna até que a operação que ele está executando seja concluída.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-106">When a function runs synchronously, it does not return until the operation it is performing is completed.</span></span> <span data-ttu-id="cf4a5-107">Isso significa que a execução do thread de chamada pode ser bloqueada por um período indefinido enquanto aguarda uma operação demorada ser concluída.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-107">This means that the execution of the calling thread can be blocked for an indefinite period while it waits for a time-consuming operation to be completed.</span></span> <span data-ttu-id="cf4a5-108">Quando uma função é executada de forma assíncrona, ela retorna imediatamente, mesmo que a operação não tenha sido concluída.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-108">When a function runs asynchronously, it returns immediately, even if the operation has not been completed.</span></span> <span data-ttu-id="cf4a5-109">Isso permite que uma operação demorada seja executada em segundo plano enquanto o thread de chamada está livre para executar outras tarefas.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-109">This enables a time-consuming operation to be executed in the background while the calling thread is free to perform other tasks.</span></span>

<span data-ttu-id="cf4a5-110">O uso de e/s assíncrona permite que um servidor de pipe use um loop que executa as seguintes etapas:</span><span class="sxs-lookup"><span data-stu-id="cf4a5-110">Using asynchronous I/O enables a pipe server to use a loop that performs the following steps:</span></span>

1.  <span data-ttu-id="cf4a5-111">Especifique vários objetos de evento em uma chamada para a função Wait e aguarde até que um dos objetos seja definido para o estado sinalizado.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-111">Specify multiple event objects in a call to the wait function, and wait for one of the objects to be set to the signaled state.</span></span>
2.  <span data-ttu-id="cf4a5-112">Use o valor de retorno da função de espera para determinar qual operação sobreposta foi concluída.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-112">Use the wait function's return value to determine which overlapped operation has finished.</span></span>
3.  <span data-ttu-id="cf4a5-113">Execute as tarefas necessárias para limpar a operação concluída e iniciar a próxima operação para esse identificador de pipe.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-113">Perform the tasks necessary to clean up the completed operation and initiate the next operation for that pipe handle.</span></span> <span data-ttu-id="cf4a5-114">Isso pode envolver o início de outra operação sobreposta para o mesmo identificador de pipe.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-114">This can involve starting another overlapped operation for the same pipe handle.</span></span>

<span data-ttu-id="cf4a5-115">As operações sobrepostas possibilitam que um pipe Leia e grave dados simultaneamente e que um único thread execute operações de e/s simultâneas em vários identificadores de pipe.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-115">Overlapped operations make it possible for one pipe to read and write data simultaneously and for a single thread to perform simultaneous I/O operations on multiple pipe handles.</span></span> <span data-ttu-id="cf4a5-116">Isso permite que um servidor de pipe de thread único manipule comunicações com vários clientes de pipe com eficiência.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-116">This enables a single-threaded pipe server to handle communications with multiple pipe clients efficiently.</span></span> <span data-ttu-id="cf4a5-117">Para obter um exemplo, consulte [servidor de pipe nomeado usando e/s sobreposta](named-pipe-server-using-overlapped-i-o.md).</span><span class="sxs-lookup"><span data-stu-id="cf4a5-117">For an example, see [Named Pipe Server Using Overlapped I/O](named-pipe-server-using-overlapped-i-o.md).</span></span>

<span data-ttu-id="cf4a5-118">Para que um servidor de pipe Use operações síncronas para se comunicar com mais de um cliente, ele deve criar um thread separado para cada cliente de pipe para que um ou mais threads possam ser executados enquanto outros threads estiverem aguardando.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-118">For a pipe server to use synchronous operations to communicate with more than one client, it must create a separate thread for each pipe client so that one or more threads can run while other threads are waiting.</span></span> <span data-ttu-id="cf4a5-119">Para obter um exemplo de um servidor de pipe multi-threaded que usa operações síncronas, consulte [servidor de pipe multi-threaded](multithreaded-pipe-server.md).</span><span class="sxs-lookup"><span data-stu-id="cf4a5-119">For an example of a multithreaded pipe server that uses synchronous operations, see [Multithreaded Pipe Server](multithreaded-pipe-server.md).</span></span>

## <a name="enabling-asynchronous-operation"></a><span data-ttu-id="cf4a5-120">Habilitando operação assíncrona</span><span class="sxs-lookup"><span data-stu-id="cf4a5-120">Enabling Asynchronous Operation</span></span>

<span data-ttu-id="cf4a5-121">As funções [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), [**TransactNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-transactnamedpipe)e [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) podem ser executadas de forma assíncrona somente se você habilitar o modo Sobreposto para o identificador de pipe especificado e especificar um ponteiro válido para uma estrutura [**sobreposta**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) .</span><span class="sxs-lookup"><span data-stu-id="cf4a5-121">The [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), [**TransactNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-transactnamedpipe), and [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) functions can be performed asynchronously only if you enable overlapped mode for the specified pipe handle and specify a valid pointer to an [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure.</span></span> <span data-ttu-id="cf4a5-122">Se o ponteiro **sobreposto** for **nulo**, o valor de retorno da função poderá indicar incorretamente que a operação foi concluída.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-122">If the **OVERLAPPED** pointer is **NULL**, the function return value can incorrectly indicate that the operation has been completed.</span></span> <span data-ttu-id="cf4a5-123">Portanto, é altamente recomendável que, se você criar um identificador com o sinalizador de arquivo \_ \_ sobreposto e desejar um comportamento assíncrono, sempre deverá especificar uma estrutura **sobreposta** válida.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-123">Therefore, it is strongly recommended that if you create a handle with FILE\_FLAG\_OVERLAPPED and want asynchronous behavior, you should always specify a valid **OVERLAPPED** structure.</span></span>

<span data-ttu-id="cf4a5-124">O membro **hEvent** da estrutura [**Overlapped**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) especificada deve conter um identificador para um objeto de evento de redefinição manual.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-124">The **hEvent** member of the specified [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure must contain a handle to a manual-reset event object.</span></span> <span data-ttu-id="cf4a5-125">Esse é um objeto de sincronização criado pela função [**CreateEvent**](/windows/desktop/api/synchapi/nf-synchapi-createeventa) .</span><span class="sxs-lookup"><span data-stu-id="cf4a5-125">This is a synchronization object created by the [**CreateEvent**](/windows/desktop/api/synchapi/nf-synchapi-createeventa) function.</span></span> <span data-ttu-id="cf4a5-126">O thread que inicia a operação sobreposta usa o objeto de evento para determinar quando a operação foi concluída.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-126">The thread that initiates the overlapped operation uses the event object to determine when the operation has finished.</span></span> <span data-ttu-id="cf4a5-127">Você não deve usar o identificador de pipe para sincronização ao executar operações simultâneas no mesmo identificador porque não há nenhuma maneira de saber qual a conclusão da operação fez com que o identificador de pipe fosse sinalizado.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-127">You should not use the pipe handle for synchronization when performing simultaneous operations on the same handle because there is no way of knowing which operation's completion caused the pipe handle to be signaled.</span></span> <span data-ttu-id="cf4a5-128">A única técnica confiável para executar operações simultâneas no mesmo identificador de pipe é usar uma estrutura **sobreposta** separada com seu próprio objeto de evento para cada operação.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-128">The only reliable technique for performing simultaneous operations on the same pipe handle is to use a separate **OVERLAPPED** structure with its own event object for each operation.</span></span> <span data-ttu-id="cf4a5-129">Para obter mais informações sobre objetos de evento, consulte [sincronização](/windows/desktop/Sync/synchronization).</span><span class="sxs-lookup"><span data-stu-id="cf4a5-129">For more information about event objects, see [Synchronization](/windows/desktop/Sync/synchronization).</span></span>

<span data-ttu-id="cf4a5-130">Além disso, você pode ser notificado quando uma operação sobreposta for concluída usando as funções [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) ou [**GetQueuedCompletionStatusEx**](/windows/desktop/FileIO/getqueuedcompletionstatusex-func) .</span><span class="sxs-lookup"><span data-stu-id="cf4a5-130">Also, you can be notified when an overlapped operation completes by using the [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) or [**GetQueuedCompletionStatusEx**](/windows/desktop/FileIO/getqueuedcompletionstatusex-func) functions.</span></span> <span data-ttu-id="cf4a5-131">Nesse caso, você não precisa atribuir o evento de redefinição manual na estrutura [**sobreposta**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) e a conclusão ocorre em relação ao identificador de pipe da mesma maneira que uma operação de leitura ou gravação assíncrona.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-131">In this case, you do not need to assign the manual-reset event in the [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure, and the completion happens against the pipe handle in the same way as an asynchronous read or write operation.</span></span> <span data-ttu-id="cf4a5-132">Para obter mais informações, consulte [portas de conclusão de e/s](/windows/desktop/FileIO/i-o-completion-ports).</span><span class="sxs-lookup"><span data-stu-id="cf4a5-132">For more information, see [I/O Completion Ports](/windows/desktop/FileIO/i-o-completion-ports).</span></span>

<span data-ttu-id="cf4a5-133">Quando as operações [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), [**TransactNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-transactnamedpipe)e [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) são executadas de forma assíncrona, uma das seguintes situações ocorrerá:</span><span class="sxs-lookup"><span data-stu-id="cf4a5-133">When [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), [**TransactNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-transactnamedpipe), and [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) operations are performed asynchronously, one of the following occurs:</span></span>

-   <span data-ttu-id="cf4a5-134">Se a operação for concluída quando a função retornar, o valor de retorno indicará o êxito ou a falha da operação.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-134">If the operation is complete when the function returns, the return value indicates the success or failure of the operation.</span></span> <span data-ttu-id="cf4a5-135">Se ocorrer um erro, o valor de retorno será zero e a função [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) retornará algo diferente de \_ e/s de erro \_ pendente.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-135">If an error occurs, the return value is zero and the [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) function returns something other than ERROR\_IO\_PENDING.</span></span>
-   <span data-ttu-id="cf4a5-136">Se a operação não tiver sido concluída quando a função retornar, o valor de retorno será zero e [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) retornará a \_ e/s de erro \_ pendente.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-136">If the operation has not finished when the function returns, the return value is zero and [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) returns ERROR\_IO\_PENDING.</span></span> <span data-ttu-id="cf4a5-137">Nesse caso, o thread de chamada deve aguardar até que a operação seja concluída.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-137">In this case, the calling thread must wait until the operation has finished.</span></span> <span data-ttu-id="cf4a5-138">O thread de chamada deve chamar a função [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) para determinar os resultados.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-138">The calling thread must then call the [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) function to determine the results.</span></span>

## <a name="using-completion-routines"></a><span data-ttu-id="cf4a5-139">Usando rotinas de conclusão</span><span class="sxs-lookup"><span data-stu-id="cf4a5-139">Using Completion Routines</span></span>

<span data-ttu-id="cf4a5-140">As funções [**ReadFileEx**](/windows/desktop/api/fileapi/nf-fileapi-readfileex) e [**WriteFileEx**](/windows/desktop/api/fileapi/nf-fileapi-writefileex) fornecem outra forma de e/s sobreposta.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-140">The [**ReadFileEx**](/windows/desktop/api/fileapi/nf-fileapi-readfileex) and [**WriteFileEx**](/windows/desktop/api/fileapi/nf-fileapi-writefileex) functions provide another form of overlapped I/O.</span></span> <span data-ttu-id="cf4a5-141">Ao contrário das funções [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) e [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) sobrepostas, que usam um objeto de evento para sinalizar a conclusão, as funções estendidas especificam uma *rotina de conclusão*.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-141">Unlike the overlapped [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) and [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) functions, which use an event object to signal completion, the extended functions specify a *completion routine*.</span></span> <span data-ttu-id="cf4a5-142">Uma rotina de conclusão é uma função que é enfileirada para execução quando a operação de leitura ou gravação é concluída.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-142">A completion routine is a function that is queued for execution when the read or write operation is finished.</span></span> <span data-ttu-id="cf4a5-143">A rotina de conclusão não é executada até que o thread que chamou **ReadFileEx** e **WriteFileEx** inicie uma *operação de espera alertável* chamando uma das [funções de espera alertáveis](/windows/desktop/Sync/wait-functions) com o parâmetro *fAlertable* definido como **true**.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-143">The completion routine is not executed until the thread that called **ReadFileEx** and **WriteFileEx** starts an *alertable wait operation* by calling one of the [alertable wait functions](/windows/desktop/Sync/wait-functions) with the *fAlertable* parameter set to **TRUE**.</span></span> <span data-ttu-id="cf4a5-144">Em uma operação de espera alertável, as funções também retornam quando uma rotina de conclusão de **ReadFileEx** ou **WriteFileEx** é enfileirada para execução.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-144">In an alertable wait operation, the functions also return when a **ReadFileEx** or **WriteFileEx** completion routine is queued for execution.</span></span> <span data-ttu-id="cf4a5-145">Um servidor de pipe pode usar as funções estendidas para executar uma sequência de operações de leitura e gravação para cada cliente que se conecta a ele.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-145">A pipe server can use the extended functions to perform a sequence of read and write operations for each client that connects to it.</span></span> <span data-ttu-id="cf4a5-146">Cada operação de leitura ou gravação na sequência especifica uma rotina de conclusão e cada rotina de conclusão inicia a próxima etapa na sequência.</span><span class="sxs-lookup"><span data-stu-id="cf4a5-146">Each read or write operation in the sequence specifies a completion routine, and each completion routine initiates the next step in the sequence.</span></span> <span data-ttu-id="cf4a5-147">Para obter um exemplo, consulte [servidor de pipe nomeado usando rotinas de conclusão](named-pipe-server-using-completion-routines.md).</span><span class="sxs-lookup"><span data-stu-id="cf4a5-147">For an example, see [Named Pipe Server Using Completion Routines](named-pipe-server-using-completion-routines.md).</span></span>

 

 
