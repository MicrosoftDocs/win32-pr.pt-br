---
description: As operações de pipe, incluindo clientes e servidores de pipe, podem chamar uma das várias funções — além de CallNamedPipe – para ler e gravar em um pipe nomeado.
ms.assetid: ae06455e-33bc-433d-be8f-aeb8eeb99b1d
title: Operações de pipe nomeado
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 703189a129fc44b956ab65c2f70bbf88bfd22700
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104089866"
---
# <a name="named-pipe-operations"></a><span data-ttu-id="acc13-103">Operações de pipe nomeado</span><span class="sxs-lookup"><span data-stu-id="acc13-103">Named Pipe Operations</span></span>

<span data-ttu-id="acc13-104">Na primeira vez que o servidor de pipe chama a função [**CreateNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea) , ele usa o parâmetro *nMaxInstances* para especificar o número máximo de instâncias do pipe que podem existir simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="acc13-104">The first time the pipe server calls the [**CreateNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea) function, it uses the *nMaxInstances* parameter to specify the maximum number of instances of the pipe that can exist simultaneously.</span></span> <span data-ttu-id="acc13-105">O servidor pode chamar **CreateNamedPipe** repetidamente para criar instâncias adicionais do pipe, desde que ele não exceda o número máximo de instâncias.</span><span class="sxs-lookup"><span data-stu-id="acc13-105">The server can call **CreateNamedPipe** repeatedly to create additional instances of the pipe, as long as it does not exceed the maximum number of instances.</span></span> <span data-ttu-id="acc13-106">Se a função for realizada com sucesso, cada chamada retornará um identificador para a extremidade do servidor de uma instância de pipe nomeado.</span><span class="sxs-lookup"><span data-stu-id="acc13-106">If the function succeeds, each call returns a handle to the server end of a named pipe instance.</span></span>

<span data-ttu-id="acc13-107">Assim que o servidor de pipe cria uma instância de pipe, um cliente de pipe pode se conectar a ela chamando a função [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) ou [**CallNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-callnamedpipea) .</span><span class="sxs-lookup"><span data-stu-id="acc13-107">As soon as the pipe server creates a pipe instance, a pipe client can connect to it by calling the [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) or [**CallNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-callnamedpipea) function.</span></span> <span data-ttu-id="acc13-108">Se uma instância de pipe estiver disponível, **CreateFile** retornará um identificador para a extremidade do cliente da instância do pipe.</span><span class="sxs-lookup"><span data-stu-id="acc13-108">If a pipe instance is available, **CreateFile** returns a handle to the client end of the pipe instance.</span></span> <span data-ttu-id="acc13-109">Se nenhuma instância do pipe estiver disponível, um cliente de pipe poderá usar a função [**WaitNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-waitnamedpipea) para aguardar até que um pipe fique disponível.</span><span class="sxs-lookup"><span data-stu-id="acc13-109">If no instances of the pipe are available, a pipe client can use the [**WaitNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-waitnamedpipea) function to wait until a pipe becomes available.</span></span>

<span data-ttu-id="acc13-110">Um servidor de pipe pode determinar quando um cliente de pipe está conectado a uma instância de pipe chamando a função [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) .</span><span class="sxs-lookup"><span data-stu-id="acc13-110">A pipe server can determine when a pipe client is connected to a pipe instance by calling the [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) function.</span></span> <span data-ttu-id="acc13-111">Se o identificador de pipe estiver no modo de espera de bloqueio, **ConnectNamedPipe** não retornará até que um cliente esteja conectado.</span><span class="sxs-lookup"><span data-stu-id="acc13-111">If the pipe handle is in blocking-wait mode, **ConnectNamedPipe** does not return until a client is connected.</span></span>

<span data-ttu-id="acc13-112">Clientes e servidores de pipe podem chamar uma das várias funções — além de [**CallNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-callnamedpipea) — para ler e gravar em um pipe nomeado.</span><span class="sxs-lookup"><span data-stu-id="acc13-112">Pipe clients and servers can call one of several functions — in addition to [**CallNamedPipe**](/windows/desktop/api/Winbase/nf-winbase-callnamedpipea) — to read from and write to a named pipe.</span></span> <span data-ttu-id="acc13-113">O comportamento dessas funções depende do tipo de pipe e dos modos em vigor para o identificador de pipe especificado, da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="acc13-113">The behavior of these functions depends on the type of pipe and the modes in effect for the specified pipe handle, as follows:</span></span>

-   <span data-ttu-id="acc13-114">As funções [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) e [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) podem ser usadas com pipes de tipo byte ou de mensagem.</span><span class="sxs-lookup"><span data-stu-id="acc13-114">The [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) and [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) functions can be used with either byte-type or message-type pipes.</span></span>
-   <span data-ttu-id="acc13-115">As funções [**ReadFileEx**](/windows/desktop/api/fileapi/nf-fileapi-readfileex) e [**WriteFileEx**](/windows/desktop/api/fileapi/nf-fileapi-writefileex) podem ser usadas com pipes de tipo de byte ou de mensagem se o identificador de pipe foi aberto para operações sobrepostas.</span><span class="sxs-lookup"><span data-stu-id="acc13-115">The [**ReadFileEx**](/windows/desktop/api/fileapi/nf-fileapi-readfileex) and [**WriteFileEx**](/windows/desktop/api/fileapi/nf-fileapi-writefileex) functions can be used with either byte-type or message-type pipes if the pipe handle was opened for overlapped operations.</span></span>
-   <span data-ttu-id="acc13-116">A função [**PeekNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-peeknamedpipe) pode ser usada para ler sem remover o conteúdo de um pipe de tipo de byte ou um pipe de tipo de mensagem.</span><span class="sxs-lookup"><span data-stu-id="acc13-116">The [**PeekNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-peeknamedpipe) function can be used to read without removing the contents of either a byte-type pipe or a message-type pipe.</span></span> <span data-ttu-id="acc13-117">**PeekNamedPipe** também pode retornar informações adicionais sobre a instância de pipe.</span><span class="sxs-lookup"><span data-stu-id="acc13-117">**PeekNamedPipe** can also return additional information about the pipe instance.</span></span>
-   <span data-ttu-id="acc13-118">A função [**TransactNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-transactnamedpipe) pode ser usada com pipes duplex do tipo de mensagem se o identificador de pipe para o processo de chamada estiver definido como modo de leitura de mensagem.</span><span class="sxs-lookup"><span data-stu-id="acc13-118">The [**TransactNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-transactnamedpipe) function can be used with message-type duplex pipes if the pipe handle to the calling process is set to message-read mode.</span></span> <span data-ttu-id="acc13-119">A função grava uma mensagem de solicitação e lê uma mensagem de resposta em uma única operação, aprimorando o desempenho da rede.</span><span class="sxs-lookup"><span data-stu-id="acc13-119">The function writes a request message and reads a reply message in a single operation, enhancing network performance.</span></span>

<span data-ttu-id="acc13-120">O servidor de pipe não deve executar uma operação de leitura de bloqueio até que o cliente do pipe seja iniciado.</span><span class="sxs-lookup"><span data-stu-id="acc13-120">The pipe server should not perform a blocking read operation until the pipe client has started.</span></span> <span data-ttu-id="acc13-121">Caso contrário, pode ocorrer uma condição de corrida.</span><span class="sxs-lookup"><span data-stu-id="acc13-121">Otherwise, a race condition can occur.</span></span> <span data-ttu-id="acc13-122">Isso normalmente ocorre quando o código de inicialização, como o da biblioteca de tempo de execução do C, precisa bloquear e examinar identificadores herdados.</span><span class="sxs-lookup"><span data-stu-id="acc13-122">This typically occurs when initialization code, such as that of the C run-time library, needs to lock and examine inherited handles.</span></span>

<span data-ttu-id="acc13-123">Quando um cliente e um servidor terminarem de usar uma instância de pipe, o servidor deverá primeiro chamar a função [**FlushFileBuffers**](/windows/desktop/api/fileapi/nf-fileapi-flushfilebuffers) para garantir que todos os bytes ou mensagens gravados no pipe sejam lidos pelo cliente.</span><span class="sxs-lookup"><span data-stu-id="acc13-123">When a client and server finish using a pipe instance, the server should first call the [**FlushFileBuffers**](/windows/desktop/api/fileapi/nf-fileapi-flushfilebuffers) function, to ensure that all bytes or messages written to the pipe are read by the client.</span></span> <span data-ttu-id="acc13-124">**FlushFileBuffers** não retorna até que o cliente Leia todos os dados do pipe.</span><span class="sxs-lookup"><span data-stu-id="acc13-124">**FlushFileBuffers** does not return until the client has read all data from the pipe.</span></span> <span data-ttu-id="acc13-125">Em seguida, o servidor chama a função [**DisconnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-disconnectnamedpipe) para fechar a conexão com o cliente do pipe.</span><span class="sxs-lookup"><span data-stu-id="acc13-125">The server then calls the [**DisconnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-disconnectnamedpipe) function to close the connection to the pipe client.</span></span> <span data-ttu-id="acc13-126">Essa função torna o identificador do cliente inválido, se ele ainda não tiver sido fechado.</span><span class="sxs-lookup"><span data-stu-id="acc13-126">This function makes the client's handle invalid, if it has not already been closed.</span></span> <span data-ttu-id="acc13-127">Todos os dados não lidos no pipe são descartados.</span><span class="sxs-lookup"><span data-stu-id="acc13-127">Any unread data in the pipe is discarded.</span></span> <span data-ttu-id="acc13-128">Depois que o cliente é desconectado, o servidor chama a função [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle) para fechar seu identificador para a instância de pipe.</span><span class="sxs-lookup"><span data-stu-id="acc13-128">After the client is disconnected, the server calls the [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle) function to close its handle to the pipe instance.</span></span> <span data-ttu-id="acc13-129">Como alternativa, o servidor pode usar [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) para permitir que um novo cliente se conecte a essa instância do pipe.</span><span class="sxs-lookup"><span data-stu-id="acc13-129">Alternatively, the server can use [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) to enable a new client to connect to this instance of the pipe.</span></span>

<span data-ttu-id="acc13-130">Um processo pode recuperar informações sobre um pipe nomeado chamando a função [**GetNamedPipeInfo**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-getnamedpipeinfo) , que retorna o tipo do pipe, o tamanho dos buffers de entrada e saída e o número máximo de instâncias de pipe que podem ser criadas.</span><span class="sxs-lookup"><span data-stu-id="acc13-130">A process can retrieve information about a named pipe by calling the [**GetNamedPipeInfo**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-getnamedpipeinfo) function, which returns the type of the pipe, the size of the input and output buffers, and the maximum number of pipe instances that can be created.</span></span> <span data-ttu-id="acc13-131">A função [**GetNamedPipeHandleState**](/windows/desktop/api/Winbase/nf-winbase-getnamedpipehandlestatea) relata os modos de leitura e de espera de um identificador de pipe, o número atual de instâncias de pipe e informações adicionais para pipes que se comunicam através de uma rede.</span><span class="sxs-lookup"><span data-stu-id="acc13-131">The [**GetNamedPipeHandleState**](/windows/desktop/api/Winbase/nf-winbase-getnamedpipehandlestatea) function reports on the read and wait modes of a pipe handle, the current number of pipe instances, and additional information for pipes that communicate over a network.</span></span> <span data-ttu-id="acc13-132">A função [**SetNamedPipeHandleState**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-setnamedpipehandlestate) define o modo de leitura e os modos de espera de um identificador de pipe.</span><span class="sxs-lookup"><span data-stu-id="acc13-132">The [**SetNamedPipeHandleState**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-setnamedpipehandlestate) function sets the read mode and wait modes of a pipe handle.</span></span> <span data-ttu-id="acc13-133">Para clientes de pipe que se comunicam com um servidor remoto, a função também controla o número máximo de bytes a serem coletados ou o tempo máximo de espera antes de transmitir uma mensagem (supondo que o identificador do cliente não foi aberto com o modo write-through habilitado).</span><span class="sxs-lookup"><span data-stu-id="acc13-133">For pipe clients communicating with a remote server, the function also controls the maximum number of bytes to collect or the maximum time to wait before transmitting a message (assuming the client's handle was not opened with write-through mode enabled).</span></span>

 

 
