---
description: A CNG fornece um modelo de armazenamento de chave privada que permite adaptar às demandas atuais e futuras da criação de aplicativos que usam recursos de criptografia, como criptografia de chave privada ou pública, bem como as demandas do armazenamento de material da chave.
ms.assetid: 95e5750f-fdc5-41f3-a4ce-9593a7081e95
title: Armazenamento e recuperação de chave
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5abfd6319353440c580d53990075a71613a1eba9
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "104297200"
---
# <a name="key-storage-and-retrieval"></a><span data-ttu-id="39a19-103">Armazenamento e recuperação de chave</span><span class="sxs-lookup"><span data-stu-id="39a19-103">Key Storage and Retrieval</span></span>

-   [<span data-ttu-id="39a19-104">Arquitetura de armazenamento de chaves</span><span class="sxs-lookup"><span data-stu-id="39a19-104">Key Storage Architecture</span></span>](#key-storage-architecture)
-   [<span data-ttu-id="39a19-105">Tipos de Chave</span><span class="sxs-lookup"><span data-stu-id="39a19-105">Key Types</span></span>](#key-types)
-   [<span data-ttu-id="39a19-106">Algoritmos com suporte</span><span class="sxs-lookup"><span data-stu-id="39a19-106">Supported Algorithms</span></span>](#supported-algorithms)
-   [<span data-ttu-id="39a19-107">Diretórios-chave e arquivos</span><span class="sxs-lookup"><span data-stu-id="39a19-107">Key Directories and Files</span></span>](#key-directories-and-files)

## <a name="key-storage-architecture"></a><span data-ttu-id="39a19-108">Arquitetura de armazenamento de chaves</span><span class="sxs-lookup"><span data-stu-id="39a19-108">Key Storage Architecture</span></span>

<span data-ttu-id="39a19-109">A CNG fornece um modelo de armazenamento de chave privada que permite adaptar às demandas atuais e futuras da criação de aplicativos que usam recursos de criptografia, como criptografia de chave privada ou pública, bem como as demandas do armazenamento de material da chave.</span><span class="sxs-lookup"><span data-stu-id="39a19-109">CNG provides a model for private key storage that allows adapting to the current and future demands of creating applications that use cryptography features such as public or private key encryption, as well as the demands of the storage of key material.</span></span> <span data-ttu-id="39a19-110">O roteador de armazenamento de chaves é a rotina central nesse modelo e é implementado em Ncrypt.dll.</span><span class="sxs-lookup"><span data-stu-id="39a19-110">The key storage router is the central routine in this model and is implemented in Ncrypt.dll.</span></span> <span data-ttu-id="39a19-111">Um aplicativo acessa os KSPs (provedores de armazenamento de chaves) no sistema por meio do roteador de armazenamento de chaves, que oculta os detalhes, como o isolamento de chave, do aplicativo e do próprio provedor de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="39a19-111">An application accesses the key storage providers (KSPs) on the system through the key storage router, which conceals details, such as key isolation, from both the application and the storage provider itself.</span></span> <span data-ttu-id="39a19-112">A ilustração a seguir mostra o design e a função da arquitetura de isolamento de chave CNG.</span><span class="sxs-lookup"><span data-stu-id="39a19-112">The following illustration shows the design and function of the CNG key isolation architecture.</span></span>

![provedor de armazenamento de chaves CNG](images/cng-key-storage-provider.png)

<span data-ttu-id="39a19-114">Para atender aos requisitos de protocolo CC, as chaves de vida longa devem ser isoladas para que nunca estejam presentes no processo do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="39a19-114">To comply with common criteria (CC) requirements, the long-lived keys must be isolated so that they are never present in the application process.</span></span> <span data-ttu-id="39a19-115">Atualmente, a CNG dá suporte ao armazenamento de chaves privadas assimétricas usando o KSP de software da Microsoft que está incluído no Windows Server 2008 e no Windows Vista e instalado por padrão.</span><span class="sxs-lookup"><span data-stu-id="39a19-115">CNG currently supports the storage of asymmetric private keys by using the Microsoft software KSP that is included with Windows Server 2008 and Windows Vista and installed by default.</span></span>

<span data-ttu-id="39a19-116">O isolamento de chave é habilitado por padrão no Windows Server 2008 e no Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="39a19-116">Key isolation is enabled by default in Windows Server 2008 and Windows Vista.</span></span> <span data-ttu-id="39a19-117">O recurso de isolamento de chave não está disponível em plataformas antes delas.</span><span class="sxs-lookup"><span data-stu-id="39a19-117">The key isolation feature is not available on platforms prior to these.</span></span> <span data-ttu-id="39a19-118">Além disso, KSPs de terceiros não são carregados no serviço de isolamento de chaves (processo LSA).</span><span class="sxs-lookup"><span data-stu-id="39a19-118">Also, third party KSPs are not loaded in the key isolation service (LSA process).</span></span> <span data-ttu-id="39a19-119">Somente o KSP da Microsoft é carregado no serviço de isolamento de chave.</span><span class="sxs-lookup"><span data-stu-id="39a19-119">Only the Microsoft KSP is loaded in the key isolation service.</span></span>

<span data-ttu-id="39a19-120">O processo LSA é usado como o processo de isolamento de chave para maximizar o desempenho.</span><span class="sxs-lookup"><span data-stu-id="39a19-120">The LSA process is used as the key isolation process to maximize performance.</span></span> <span data-ttu-id="39a19-121">Todo o acesso a chaves privadas passa pelo roteador de armazenamento de chaves, que expõe um conjunto abrangente de funções para gerenciar e usar chaves privadas.</span><span class="sxs-lookup"><span data-stu-id="39a19-121">All access to private keys goes through the key storage router, which exposes a comprehensive set of functions for managing and using private keys.</span></span>

<span data-ttu-id="39a19-122">A CNG armazena a parte pública da chave armazenada separadamente da parte privada.</span><span class="sxs-lookup"><span data-stu-id="39a19-122">CNG stores the public portion of the stored key separately from the private portion.</span></span> <span data-ttu-id="39a19-123">A parte pública de um par de chaves também é mantida no serviço de isolamento de chave e é acessada usando o LRPC (chamada de procedimento remoto) local.</span><span class="sxs-lookup"><span data-stu-id="39a19-123">The public portion of a key pair is also maintained in the key isolation service and is accessed by using local remote procedure call (LRPC).</span></span> <span data-ttu-id="39a19-124">O roteador de armazenamento de chaves usa o LRPC ao chamar o processo de isolamento de chave.</span><span class="sxs-lookup"><span data-stu-id="39a19-124">The key storage router uses LRPC when calling into the key isolation process.</span></span> <span data-ttu-id="39a19-125">Todo o acesso a chaves privadas passa pelo roteador de chave privada e é auditado pela CNG.</span><span class="sxs-lookup"><span data-stu-id="39a19-125">All access to private keys goes through the private key router and is audited by CNG.</span></span>

<span data-ttu-id="39a19-126">Conforme descrito acima, é possível oferecer suporte a uma grande variedade de dispositivos de armazenamento de hardware.</span><span class="sxs-lookup"><span data-stu-id="39a19-126">As described above, a wide range of hardware storage devices can be supported.</span></span> <span data-ttu-id="39a19-127">Em cada caso, a interface para todos esses dispositivos de armazenamento é idêntica.</span><span class="sxs-lookup"><span data-stu-id="39a19-127">In each case, the interface to all of these storage devices is identical.</span></span> <span data-ttu-id="39a19-128">Ele inclui funções para executar várias operações de chave privada, bem como funções que pertencem ao armazenamento e gerenciamento de chaves.</span><span class="sxs-lookup"><span data-stu-id="39a19-128">It includes functions to perform various private key operations as well as functions that pertain to key storage and management.</span></span>

<span data-ttu-id="39a19-129">A CNG fornece um conjunto de APIs que são usadas para criar, armazenar e recuperar chaves criptográficas.</span><span class="sxs-lookup"><span data-stu-id="39a19-129">CNG provides a set of APIs that are used to create, store, and retrieve cryptographic keys.</span></span> <span data-ttu-id="39a19-130">Para obter uma lista dessas APIs, consulte [funções de armazenamento de chave CNG](cng-key-storage-functions.md).</span><span class="sxs-lookup"><span data-stu-id="39a19-130">For a list of these APIs, see [CNG Key Storage Functions](cng-key-storage-functions.md).</span></span>

## <a name="key-types"></a><span data-ttu-id="39a19-131">Tipos de Chave</span><span class="sxs-lookup"><span data-stu-id="39a19-131">Key Types</span></span>

<span data-ttu-id="39a19-132">A CNG dá suporte aos seguintes tipos de chave:</span><span class="sxs-lookup"><span data-stu-id="39a19-132">CNG supports the following key types:</span></span>

-   <span data-ttu-id="39a19-133">Diffie-Hellman chaves públicas e privadas.</span><span class="sxs-lookup"><span data-stu-id="39a19-133">Diffie-Hellman public and private keys.</span></span>
-   <span data-ttu-id="39a19-134">Algoritmo de assinatura digital (DSA, FIPS 186-2) chaves públicas e privadas.</span><span class="sxs-lookup"><span data-stu-id="39a19-134">Digital Signature Algorithm (DSA, FIPS 186-2) public and private keys.</span></span>
-   <span data-ttu-id="39a19-135">\#Chaves públicas e privadas RSA (PKCS 1).</span><span class="sxs-lookup"><span data-stu-id="39a19-135">RSA (PKCS \#1) public and private keys.</span></span>
-   <span data-ttu-id="39a19-136">Várias chaves públicas e privadas herdadas (CryptoAPI).</span><span class="sxs-lookup"><span data-stu-id="39a19-136">Several legacy (CryptoAPI) public and private keys.</span></span>
-   <span data-ttu-id="39a19-137">Chaves públicas e privadas da criptografia de curva elíptica.</span><span class="sxs-lookup"><span data-stu-id="39a19-137">Elliptic Curve Cryptography public and private keys.</span></span>

## <a name="supported-algorithms"></a><span data-ttu-id="39a19-138">Algoritmos com suporte</span><span class="sxs-lookup"><span data-stu-id="39a19-138">Supported Algorithms</span></span>

<span data-ttu-id="39a19-139">A CNG dá suporte aos seguintes algoritmos de chave.</span><span class="sxs-lookup"><span data-stu-id="39a19-139">CNG supports the following key algorithms.</span></span>

| <span data-ttu-id="39a19-140">Algoritmo</span><span class="sxs-lookup"><span data-stu-id="39a19-140">Algorithm</span></span> | <span data-ttu-id="39a19-141">Comprimento de chave/hash (bits)</span><span class="sxs-lookup"><span data-stu-id="39a19-141">Key/hash length (bits)</span></span>             |
|-----------|------------------------------------|
| <span data-ttu-id="39a19-142">RSA</span><span class="sxs-lookup"><span data-stu-id="39a19-142">RSA</span></span>       | <span data-ttu-id="39a19-143">512 a 16384, em incrementos de bits 64</span><span class="sxs-lookup"><span data-stu-id="39a19-143">512 to 16384, in 64 bit increments</span></span> |
| <span data-ttu-id="39a19-144">FEITA</span><span class="sxs-lookup"><span data-stu-id="39a19-144">DH</span></span>        | <span data-ttu-id="39a19-145">512 a 16384, em incrementos de bits 64</span><span class="sxs-lookup"><span data-stu-id="39a19-145">512 to 16384, in 64 bit increments</span></span> |
| <span data-ttu-id="39a19-146">DSA</span><span class="sxs-lookup"><span data-stu-id="39a19-146">DSA</span></span>       | <span data-ttu-id="39a19-147">512 a 1024, em incrementos de bits 64</span><span class="sxs-lookup"><span data-stu-id="39a19-147">512 to 1024, in 64 bit increments</span></span>  |
| <span data-ttu-id="39a19-148">ECDSA</span><span class="sxs-lookup"><span data-stu-id="39a19-148">ECDSA</span></span>     | <span data-ttu-id="39a19-149">P-256, P-384, P-521 (curvas NIST)</span><span class="sxs-lookup"><span data-stu-id="39a19-149">P-256, P-384, P-521 (NIST Curves)</span></span>  |
| <span data-ttu-id="39a19-150">ECDH</span><span class="sxs-lookup"><span data-stu-id="39a19-150">ECDH</span></span>      | <span data-ttu-id="39a19-151">P-256, P-384, P-521 (curvas NIST)</span><span class="sxs-lookup"><span data-stu-id="39a19-151">P-256, P-384, P-521 (NIST Curves)</span></span>  |
| <span data-ttu-id="39a19-152">MD2</span><span class="sxs-lookup"><span data-stu-id="39a19-152">MD2</span></span>       | <span data-ttu-id="39a19-153">128</span><span class="sxs-lookup"><span data-stu-id="39a19-153">128</span></span>                                |
| <span data-ttu-id="39a19-154">MD4</span><span class="sxs-lookup"><span data-stu-id="39a19-154">MD4</span></span>       | <span data-ttu-id="39a19-155">128</span><span class="sxs-lookup"><span data-stu-id="39a19-155">128</span></span>                                |
| <span data-ttu-id="39a19-156">MD5</span><span class="sxs-lookup"><span data-stu-id="39a19-156">MD5</span></span>       | <span data-ttu-id="39a19-157">128</span><span class="sxs-lookup"><span data-stu-id="39a19-157">128</span></span>                                |
| <span data-ttu-id="39a19-158">SHA-1</span><span class="sxs-lookup"><span data-stu-id="39a19-158">SHA-1</span></span>     | <span data-ttu-id="39a19-159">160</span><span class="sxs-lookup"><span data-stu-id="39a19-159">160</span></span>                                |
| <span data-ttu-id="39a19-160">SHA-256</span><span class="sxs-lookup"><span data-stu-id="39a19-160">SHA-256</span></span>   | <span data-ttu-id="39a19-161">256</span><span class="sxs-lookup"><span data-stu-id="39a19-161">256</span></span>                                |
| <span data-ttu-id="39a19-162">SHA-384</span><span class="sxs-lookup"><span data-stu-id="39a19-162">SHA-384</span></span>   | <span data-ttu-id="39a19-163">384</span><span class="sxs-lookup"><span data-stu-id="39a19-163">384</span></span>                                |
| <span data-ttu-id="39a19-164">SHA-512</span><span class="sxs-lookup"><span data-stu-id="39a19-164">SHA-512</span></span>   | <span data-ttu-id="39a19-165">512</span><span class="sxs-lookup"><span data-stu-id="39a19-165">512</span></span>                                |



 

## <a name="key-directories-and-files"></a><span data-ttu-id="39a19-166">Diretórios-chave e arquivos</span><span class="sxs-lookup"><span data-stu-id="39a19-166">Key Directories and Files</span></span>

<span data-ttu-id="39a19-167">Os CSPs do CryptoAPI herdados da Microsoft armazenam chaves privadas nos diretórios a seguir.</span><span class="sxs-lookup"><span data-stu-id="39a19-167">The Microsoft legacy CryptoAPI CSPs store private keys in the following directories.</span></span>

| <span data-ttu-id="39a19-168">Tipo de chave</span><span class="sxs-lookup"><span data-stu-id="39a19-168">Key type</span></span>                | <span data-ttu-id="39a19-169">Diretórios</span><span class="sxs-lookup"><span data-stu-id="39a19-169">Directories</span></span>                                                                                                                                                 |
|-------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="39a19-170">Usuário privado</span><span class="sxs-lookup"><span data-stu-id="39a19-170">User private</span></span>            | <span data-ttu-id="39a19-171">% APPDATA% \\ Sid de usuário do Microsoft \\ crypto \\ RSA \\ </span><span class="sxs-lookup"><span data-stu-id="39a19-171">%APPDATA%\\Microsoft\\Crypto\\RSA\\*User SID*</span></span>\\<br/><span data-ttu-id="39a19-172">% APPDATA% \\ Sid de usuário do Microsoft \\ crypto \\ DSS \\ </span><span class="sxs-lookup"><span data-stu-id="39a19-172">%APPDATA%\\Microsoft\\Crypto\\DSS\\*User SID*</span></span>\\<br/>                                                   |
| <span data-ttu-id="39a19-173">Particular do sistema local</span><span class="sxs-lookup"><span data-stu-id="39a19-173">Local system private</span></span>    | <span data-ttu-id="39a19-174">% ALLUSERSPROFILE% de \\ dados de aplicativos \\ Microsoft \\ crypto \\ RSA \\ S-1-5-18</span><span class="sxs-lookup"><span data-stu-id="39a19-174">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\RSA\\S-1-5-18</span></span>\\<br/><span data-ttu-id="39a19-175">% ALLUSERSPROFILE% de \\ dados \\ de aplicativos Microsoft \\ crypto \\ DSS \\ S-1-5-18</span><span class="sxs-lookup"><span data-stu-id="39a19-175">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\DSS\\S-1-5-18</span></span>\\<br/>   |
| <span data-ttu-id="39a19-176">Serviço local particular</span><span class="sxs-lookup"><span data-stu-id="39a19-176">Local service private</span></span>   | <span data-ttu-id="39a19-177">% ALLUSERSPROFILE% de \\ dados de aplicativos \\ Microsoft \\ crypto \\ RSA \\ S-1-5-19</span><span class="sxs-lookup"><span data-stu-id="39a19-177">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\RSA\\S-1-5-19</span></span>\\<br/><span data-ttu-id="39a19-178">% ALLUSERSPROFILE% de \\ dados \\ de aplicativos Microsoft \\ crypto \\ DSS \\ S-1-5-19</span><span class="sxs-lookup"><span data-stu-id="39a19-178">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\DSS\\S-1-5-19</span></span>\\<br/>   |
| <span data-ttu-id="39a19-179">Serviço de rede particular</span><span class="sxs-lookup"><span data-stu-id="39a19-179">Network service private</span></span> | <span data-ttu-id="39a19-180">% ALLUSERSPROFILE% de \\ dados de aplicativos \\ Microsoft \\ crypto \\ RSA \\ S-1-5-20</span><span class="sxs-lookup"><span data-stu-id="39a19-180">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\RSA\\S-1-5-20</span></span>\\<br/><span data-ttu-id="39a19-181">% ALLUSERSPROFILE% de \\ dados \\ de aplicativos Microsoft \\ crypto \\ DSS \\ S-1-5-20</span><span class="sxs-lookup"><span data-stu-id="39a19-181">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\DSS\\S-1-5-20</span></span>\\<br/>   |
| <span data-ttu-id="39a19-182">Privado compartilhado</span><span class="sxs-lookup"><span data-stu-id="39a19-182">Shared private</span></span>          | <span data-ttu-id="39a19-183">% ALLUSERSPROFILE% de \\ dados de aplicativos \\ Microsoft \\ crypto \\ RSA \\ MachineKeys</span><span class="sxs-lookup"><span data-stu-id="39a19-183">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\RSA\\MachineKeys</span></span><br/><span data-ttu-id="39a19-184">% ALLUSERSPROFILE% de \\ dados de aplicativos \\ Microsoft \\ crypto \\ DSS \\ MachineKeys</span><span class="sxs-lookup"><span data-stu-id="39a19-184">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\DSS\\MachineKeys</span></span><br/> |



 

<span data-ttu-id="39a19-185">A CNG armazena chaves privadas nos diretórios a seguir.</span><span class="sxs-lookup"><span data-stu-id="39a19-185">CNG stores private keys in the following directories.</span></span>

| <span data-ttu-id="39a19-186">Tipo de chave</span><span class="sxs-lookup"><span data-stu-id="39a19-186">Key type</span></span>                | <span data-ttu-id="39a19-187">Diretório</span><span class="sxs-lookup"><span data-stu-id="39a19-187">Directory</span></span>                                                          |
|-------------------------|--------------------------------------------------------------------|
| <span data-ttu-id="39a19-188">Usuário privado</span><span class="sxs-lookup"><span data-stu-id="39a19-188">User private</span></span>            | <span data-ttu-id="39a19-189">% APPDATA% \\ \\ chaves de criptografia da Microsoft \\</span><span class="sxs-lookup"><span data-stu-id="39a19-189">%APPDATA%\\Microsoft\\Crypto\\Keys</span></span>                                 |
| <span data-ttu-id="39a19-190">Particular do sistema local</span><span class="sxs-lookup"><span data-stu-id="39a19-190">Local system private</span></span>    | <span data-ttu-id="39a19-191">% ALLUSERSPROFILE% de \\ dados de aplicativos \\ Microsoft \\ crypto \\ SystemKeys</span><span class="sxs-lookup"><span data-stu-id="39a19-191">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\SystemKeys</span></span> |
| <span data-ttu-id="39a19-192">Serviço local particular</span><span class="sxs-lookup"><span data-stu-id="39a19-192">Local service private</span></span>   | <span data-ttu-id="39a19-193">% WINDIR% \\ Improfiles \\ LocalService</span><span class="sxs-lookup"><span data-stu-id="39a19-193">%WINDIR%\\ServiceProfiles\\LocalService</span></span>                            |
| <span data-ttu-id="39a19-194">Serviço de rede particular</span><span class="sxs-lookup"><span data-stu-id="39a19-194">Network service private</span></span> | <span data-ttu-id="39a19-195">% WINDIR% \\ UserProfiles \\ NetworkService</span><span class="sxs-lookup"><span data-stu-id="39a19-195">%WINDIR%\\ServiceProfiles\\NetworkService</span></span>                          |
| <span data-ttu-id="39a19-196">Privado compartilhado</span><span class="sxs-lookup"><span data-stu-id="39a19-196">Shared private</span></span>          | <span data-ttu-id="39a19-197">% ALLUSERSPROFILE% de \\ dados de aplicativo chaves de criptografia da \\ Microsoft \\ \\</span><span class="sxs-lookup"><span data-stu-id="39a19-197">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\Keys</span></span>       |



 

<span data-ttu-id="39a19-198">A seguir estão algumas das diferenças entre os contêineres de chave CryptoAPI e CNG.</span><span class="sxs-lookup"><span data-stu-id="39a19-198">The following are some of the differences between the CryptoAPI and CNG key containers.</span></span>

-   <span data-ttu-id="39a19-199">A CNG usa nomes de arquivo diferentes para arquivos de chave do que arquivos de chave que são criados pelo Rsaenh.dll e Dssenh.dll CSPs herdados.</span><span class="sxs-lookup"><span data-stu-id="39a19-199">CNG uses different file names for key files than key files that are created by the Rsaenh.dll and Dssenh.dll legacy CSPs.</span></span> <span data-ttu-id="39a19-200">Os arquivos de chave herdados também têm a extensão. Key, mas os arquivos de chave CNG não têm a extensão. Key.</span><span class="sxs-lookup"><span data-stu-id="39a19-200">The legacy key files also have the .key extension, but CNG key files do not have the .key extension.</span></span>
-   <span data-ttu-id="39a19-201">A CNG dá suporte total a nomes de contêiner de chave Unicode; A CNG usa um hash do nome do contêiner Unicode, enquanto o CryptoAPI usa um hash do nome do contêiner ANSI.</span><span class="sxs-lookup"><span data-stu-id="39a19-201">CNG fully supports Unicode key container names; CNG uses a hash of the Unicode container name, whereas CryptoAPI uses a hash of the ANSI container name.</span></span>
-   <span data-ttu-id="39a19-202">A CNG é mais flexível em relação aos pares de chaves RSA.</span><span class="sxs-lookup"><span data-stu-id="39a19-202">CNG is more flexible with regard to RSA key pairs.</span></span> <span data-ttu-id="39a19-203">Por exemplo, a CNG dá suporte a expoentes públicos maiores que 32 bits de comprimento e oferece suporte a chaves nas quais p e q são tamanhos diferentes.</span><span class="sxs-lookup"><span data-stu-id="39a19-203">For example, CNG supports public exponents larger than 32-bits in length, and it supports keys in which p and q are different lengths.</span></span>
-   <span data-ttu-id="39a19-204">No CryptoAPI, o arquivo de contêiner de chave é armazenado em um diretório cujo nome é o equivalente textual do SID do usuário.</span><span class="sxs-lookup"><span data-stu-id="39a19-204">In CryptoAPI, the key container file is stored in a directory whose name is the textual equivalent of the user's SID.</span></span> <span data-ttu-id="39a19-205">Esse não é mais o caso na CNG, o que elimina a dificuldade de mover usuários de um domínio para outro sem perder todas as suas chaves privadas.</span><span class="sxs-lookup"><span data-stu-id="39a19-205">This is no longer the case in CNG, which removes the difficulty of moving users from one domain to another without losing all of their private keys.</span></span>
-   <span data-ttu-id="39a19-206">O KSP de CNG e os nomes de chave são limitados a caracteres Unicode de **\_ caminho máximo** .</span><span class="sxs-lookup"><span data-stu-id="39a19-206">The CNG KSP and key names are limited to **MAX\_PATH** Unicode characters.</span></span> <span data-ttu-id="39a19-207">O CSP e os nomes de chave do CryptoAPI são limitados aos caracteres ANSI **máximos do \_ caminho** .</span><span class="sxs-lookup"><span data-stu-id="39a19-207">The CryptoAPI CSP and key names are limited to **MAX\_PATH** ANSI characters.</span></span>
-   <span data-ttu-id="39a19-208">A CNG oferece a capacidade de propriedades de chave definidas pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="39a19-208">CNG offers the capability of user-defined key properties.</span></span> <span data-ttu-id="39a19-209">Os usuários podem criar e associar Propriedades personalizadas a chaves e tê-las armazenadas com chaves persistentes.</span><span class="sxs-lookup"><span data-stu-id="39a19-209">Users can create and associate custom properties with keys, and have them stored with persisted keys.</span></span>

<span data-ttu-id="39a19-210">Ao persistir uma chave, a CNG pode criar dois arquivos.</span><span class="sxs-lookup"><span data-stu-id="39a19-210">When persisting a key, CNG can create two files.</span></span> <span data-ttu-id="39a19-211">O primeiro arquivo contém a chave privada no novo formato CNG e é sempre criado.</span><span class="sxs-lookup"><span data-stu-id="39a19-211">The first file contains the private key in the new CNG format and is always created.</span></span> <span data-ttu-id="39a19-212">Esse arquivo não pode ser usado pelos CSPs do CryptoAPI herdados.</span><span class="sxs-lookup"><span data-stu-id="39a19-212">This file is not usable by the legacy CryptoAPI CSPs.</span></span> <span data-ttu-id="39a19-213">O segundo arquivo contém a mesma chave privada no contêiner de chave CryptoAPI herdada.</span><span class="sxs-lookup"><span data-stu-id="39a19-213">The second file contains the same private key in the legacy CryptoAPI key container.</span></span> <span data-ttu-id="39a19-214">O segundo arquivo está em conformidade com o formato e o local usados pelo Rsaenh.dll.</span><span class="sxs-lookup"><span data-stu-id="39a19-214">The second file conforms to the format and location used by Rsaenh.dll.</span></span> <span data-ttu-id="39a19-215">A criação do segundo arquivo só ocorrerá se o sinalizador **NCRYPT \_ Write \_ Key \_ para o \_ \_ repositório \_ herdado** for especificado quando a função [**NCryptFinalizeKey**](/windows/desktop/api/Ncrypt/nf-ncrypt-ncryptfinalizekey) for chamada para finalizar uma chave RSA.</span><span class="sxs-lookup"><span data-stu-id="39a19-215">Creation of the second file only occurs if the **NCRYPT\_WRITE\_KEY\_TO\_LEGACY\_STORE\_FLAG** flag is specified when the [**NCryptFinalizeKey**](/windows/desktop/api/Ncrypt/nf-ncrypt-ncryptfinalizekey) function is called to finalize an RSA key.</span></span> <span data-ttu-id="39a19-216">Não há suporte para esse recurso em chaves DSA e DH.</span><span class="sxs-lookup"><span data-stu-id="39a19-216">This feature is not supported for DSA and DH keys.</span></span>

<span data-ttu-id="39a19-217">Quando um aplicativo tenta abrir uma chave persistente existente, a CNG tenta primeiro abrir o arquivo CNG nativo.</span><span class="sxs-lookup"><span data-stu-id="39a19-217">When an application attempts to open an existing persisted key, CNG first attempts to open the native CNG file.</span></span> <span data-ttu-id="39a19-218">Se esse arquivo não existir, a CNG tentará localizar uma chave correspondente no contêiner de chave CryptoAPI herdado.</span><span class="sxs-lookup"><span data-stu-id="39a19-218">If this file does not exist, then CNG attempts to locate a matching key in the legacy CryptoAPI key container.</span></span>

<span data-ttu-id="39a19-219">Quando você move ou copia chaves de CryptoAPI de um computador de origem para um computador de destino com Ferramenta de Migração do Usuário Windows (USMT), a CNG falhará ao acessar as chaves no computador de destino.</span><span class="sxs-lookup"><span data-stu-id="39a19-219">When you move or copy CryptoAPI keys from a source machine to a target machine with Windows User State Migration Tool (USMT), CNG will fail to access the keys on the target machine.</span></span> <span data-ttu-id="39a19-220">Para acessar essas chaves migradas, você deve usar o CryptoAPI.</span><span class="sxs-lookup"><span data-stu-id="39a19-220">To access such migrated keys, you must use the CryptoAPI.</span></span>

 

 




