---
description: A API CNG implementa um modelo de provedor extensível que permite carregar um provedor especificando o algoritmo criptográfico necessário em vez de um provedor específico.
ms.assetid: a88a089b-4afe-4201-96f7-97f19bce18a1
title: Programação CNG típica
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1119da63ca1ea0613444b150914c06664f36c121
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103647189"
---
# <a name="typical-cng-programming"></a><span data-ttu-id="3a4d1-103">Programação CNG típica</span><span class="sxs-lookup"><span data-stu-id="3a4d1-103">Typical CNG Programming</span></span>

<span data-ttu-id="3a4d1-104">A API CNG implementa um modelo de provedor extensível que permite carregar um provedor especificando o algoritmo criptográfico necessário em vez de um provedor específico.</span><span class="sxs-lookup"><span data-stu-id="3a4d1-104">The CNG API implements an extensible provider model that lets you load a provider by specifying the required cryptographic algorithm rather than a particular provider.</span></span> <span data-ttu-id="3a4d1-105">A vantagem é que um provedor de algoritmo pode ser substituído ou atualizado e você não precisará alterar seu código de qualquer forma para usar o novo provedor.</span><span class="sxs-lookup"><span data-stu-id="3a4d1-105">The advantage is that an algorithm provider can be replaced or upgraded and you will not have to change your code in any way to use the new provider.</span></span> <span data-ttu-id="3a4d1-106">Além disso, se algum algoritmo for determinado como não seguro no futuro, uma versão mais segura desse algoritmo poderá ser instalada sem afetar seu código.</span><span class="sxs-lookup"><span data-stu-id="3a4d1-106">Also, if some algorithm is determined to be unsafe in the future, a more secure version of that algorithm can be installed without affecting your code.</span></span> <span data-ttu-id="3a4d1-107">A maioria das APIs CNG requer um provedor ou um objeto criado por um provedor.</span><span class="sxs-lookup"><span data-stu-id="3a4d1-107">Most of the CNG APIs require a provider or an object created by a provider.</span></span>

<span data-ttu-id="3a4d1-108">As etapas típicas envolvidas no uso da API CNG para operações primitivas de criptografia são as seguintes:</span><span class="sxs-lookup"><span data-stu-id="3a4d1-108">The typical steps involved in using the CNG API for cryptographic primitive operations are as follows:</span></span>

1.  <span data-ttu-id="3a4d1-109">Abrindo o provedor de algoritmos</span><span class="sxs-lookup"><span data-stu-id="3a4d1-109">Opening the Algorithm Provider</span></span>
2.  <span data-ttu-id="3a4d1-110">Obtendo ou definindo propriedades de algoritmo</span><span class="sxs-lookup"><span data-stu-id="3a4d1-110">Getting or Setting Algorithm Properties</span></span>
3.  <span data-ttu-id="3a4d1-111">Criando ou importando uma chave</span><span class="sxs-lookup"><span data-stu-id="3a4d1-111">Creating or Importing a Key</span></span>
4.  <span data-ttu-id="3a4d1-112">Executando operações criptográficas</span><span class="sxs-lookup"><span data-stu-id="3a4d1-112">Performing Cryptographic Operations</span></span>
5.  <span data-ttu-id="3a4d1-113">Fechando o provedor de algoritmos</span><span class="sxs-lookup"><span data-stu-id="3a4d1-113">Closing the Algorithm Provider</span></span>

<span data-ttu-id="3a4d1-114">Para obter mais informações, consulte exemplos de programação.</span><span class="sxs-lookup"><span data-stu-id="3a4d1-114">For more information, see Programming Examples.</span></span>

## <a name="opening-the-algorithm-provider"></a><span data-ttu-id="3a4d1-115">Abrindo o provedor de algoritmos</span><span class="sxs-lookup"><span data-stu-id="3a4d1-115">Opening the Algorithm Provider</span></span>

<span data-ttu-id="3a4d1-116">A função [**BCryptOpenAlgorithmProvider**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptopenalgorithmprovider) fornece um identificador de provedor de algoritmo que é usado em APIs CNG subsequentes, como [**BCryptCreateHash**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptcreatehash) ou [**BCryptGenerateKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratekeypair).</span><span class="sxs-lookup"><span data-stu-id="3a4d1-116">The [**BCryptOpenAlgorithmProvider**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptopenalgorithmprovider) function provides you with an algorithm provider handle that is used in subsequent CNG APIs, such as [**BCryptCreateHash**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptcreatehash) or [**BCryptGenerateKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratekeypair).</span></span>

## <a name="getting-or-setting-algorithm-properties"></a><span data-ttu-id="3a4d1-117">Obtendo ou definindo propriedades de algoritmo</span><span class="sxs-lookup"><span data-stu-id="3a4d1-117">Getting or Setting Algorithm Properties</span></span>

<span data-ttu-id="3a4d1-118">Você pode usar o identificador do provedor de algoritmos para obter detalhes de implementação para o algoritmo, como o tamanho da chave ou o modo atual de operação.</span><span class="sxs-lookup"><span data-stu-id="3a4d1-118">You can use the algorithm provider handle to get implementation details for the algorithm, such as the key size or the current mode of operation.</span></span> <span data-ttu-id="3a4d1-119">Use a função [**BCryptGetProperty**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgetproperty) para obter propriedades específicas.</span><span class="sxs-lookup"><span data-stu-id="3a4d1-119">You use the [**BCryptGetProperty**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgetproperty) function to obtain specific properties.</span></span>

<span data-ttu-id="3a4d1-120">Você também pode modificar as propriedades do algoritmo.</span><span class="sxs-lookup"><span data-stu-id="3a4d1-120">You can also modify the properties of the algorithm.</span></span> <span data-ttu-id="3a4d1-121">Por exemplo, se você quiser usar o encadeamento de codificação de bloco ECB com AES, defina a **propriedade \_ \_ modo de encadeamento BCRYPT** de um algoritmo AES para **o \_ modo de cadeia BCrypt \_ \_ ECB**; a propriedade é atribuída a todas as chaves AES criadas usando esse identificador de algoritmo, sem a necessidade de configurar cada chave AES.</span><span class="sxs-lookup"><span data-stu-id="3a4d1-121">For example, If you want to use ECB block cipher chaining with AES, you set the **BCRYPT\_CHAINING\_MODE** property of an AES algorithm to **BCRYPT\_CHAIN\_MODE\_ECB**; the property is assigned to all AES keys created using this algorithm handle, without the need to configure each and every AES key.</span></span> <span data-ttu-id="3a4d1-122">Use a função [**BCryptSetProperty**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptsetproperty) para modificar essas propriedades.</span><span class="sxs-lookup"><span data-stu-id="3a4d1-122">You use the [**BCryptSetProperty**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptsetproperty) function to modify these properties.</span></span>

## <a name="creating-or-importing-a-key"></a><span data-ttu-id="3a4d1-123">Criando ou importando uma chave</span><span class="sxs-lookup"><span data-stu-id="3a4d1-123">Creating or Importing a Key</span></span>

<span data-ttu-id="3a4d1-124">Dependendo do tipo de algoritmo usado, talvez seja necessário criar ou carregar uma chave.</span><span class="sxs-lookup"><span data-stu-id="3a4d1-124">Depending on the type of algorithm you use, you may need to create or load a key.</span></span> <span data-ttu-id="3a4d1-125">Por exemplo, a função [**BCryptEncrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptencrypt) usa um identificador de chave para o primeiro parâmetro.</span><span class="sxs-lookup"><span data-stu-id="3a4d1-125">For example, the [**BCryptEncrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptencrypt) function takes a key handle for the first parameter.</span></span> <span data-ttu-id="3a4d1-126">Se você quiser que essa função criptografe dados com um algoritmo de criptografia simétrica como AES, primeiro você deve obter uma chave.</span><span class="sxs-lookup"><span data-stu-id="3a4d1-126">If you want that function to encrypt data with a symmetric encryption algorithm such as AES, you must first obtain a key.</span></span> <span data-ttu-id="3a4d1-127">A forma como você obtém a chave depende do tipo de algoritmo que está sendo usado e da origem da chave.</span><span class="sxs-lookup"><span data-stu-id="3a4d1-127">How you obtain the key depends on the type of algorithm being used and the source of the key.</span></span>

<span data-ttu-id="3a4d1-128">Você pode criar chaves efêmeras com as funções [**BCryptGenerateSymmetricKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratesymmetrickey) e [**BCryptGenerateKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratekeypair) .</span><span class="sxs-lookup"><span data-stu-id="3a4d1-128">You can create ephemeral keys with the [**BCryptGenerateSymmetricKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratesymmetrickey) and [**BCryptGenerateKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratekeypair) functions.</span></span> <span data-ttu-id="3a4d1-129">Você também pode importar chaves efêmeras de um BLOB de memória com as funções [**BCryptImportKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkey) e [**BCryptImportKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkeypair) .</span><span class="sxs-lookup"><span data-stu-id="3a4d1-129">You can also import ephemeral keys from a memory BLOB with the [**BCryptImportKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkey) and [**BCryptImportKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkeypair) functions.</span></span>

<span data-ttu-id="3a4d1-130">Para chaves persistentes, você usa as funções de armazenamento de chaves para carregar um provedor de armazenamento de chaves e, em seguida, criar ou carregar as chaves.</span><span class="sxs-lookup"><span data-stu-id="3a4d1-130">For persisted keys, you use the key storage functions to load a key storage provider, and then create or load the keys.</span></span> <span data-ttu-id="3a4d1-131">Você também pode usar essas funções para criar ou carregar chaves efêmeras passando **NULL** para qualquer nome de contêiner.</span><span class="sxs-lookup"><span data-stu-id="3a4d1-131">You can also use these functions to create or load ephemeral keys by passing **NULL** for any container names.</span></span> <span data-ttu-id="3a4d1-132">Para obter mais informações sobre as funções de armazenamento de chaves, consulte [funções de armazenamento de chave CNG](cng-key-storage-functions.md).</span><span class="sxs-lookup"><span data-stu-id="3a4d1-132">For more information about the key storage functions, see [CNG Key Storage Functions](cng-key-storage-functions.md).</span></span>

## <a name="performing-cryptographic-operations"></a><span data-ttu-id="3a4d1-133">Executando operações criptográficas</span><span class="sxs-lookup"><span data-stu-id="3a4d1-133">Performing Cryptographic Operations</span></span>

<span data-ttu-id="3a4d1-134">Agora você está pronto para executar a operação criptográfica, como criptografar ou descriptografar dados usando as funções [**BCryptEncrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptencrypt) ou [**BCryptDecrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptdecrypt) , respectivamente.</span><span class="sxs-lookup"><span data-stu-id="3a4d1-134">You are now ready to perform the cryptographic operation, such as encrypting or decrypting data by using the [**BCryptEncrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptencrypt) or [**BCryptDecrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptdecrypt) functions, respectively.</span></span>

## <a name="closing-the-algorithm-provider"></a><span data-ttu-id="3a4d1-135">Fechando o provedor de algoritmos</span><span class="sxs-lookup"><span data-stu-id="3a4d1-135">Closing the Algorithm Provider</span></span>

<span data-ttu-id="3a4d1-136">Quando o provedor não for mais necessário, você deve passar o identificador para a função [**BCryptCloseAlgorithmProvider**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptclosealgorithmprovider) para fechar o provedor.</span><span class="sxs-lookup"><span data-stu-id="3a4d1-136">When the provider is no longer needed, you must pass the handle to the [**BCryptCloseAlgorithmProvider**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptclosealgorithmprovider) function to close the provider.</span></span> <span data-ttu-id="3a4d1-137">Isso faz com que o provedor libere todos os recursos que foram alocados para essa instância do provedor de algoritmo.</span><span class="sxs-lookup"><span data-stu-id="3a4d1-137">This causes the provider to release any resources that have been allocated for that algorithm provider instance.</span></span> <span data-ttu-id="3a4d1-138">Depois que um identificador de provedor é fechado, ele não pode ser reutilizado.</span><span class="sxs-lookup"><span data-stu-id="3a4d1-138">After a provider handle is closed, it cannot be reused.</span></span>

<span data-ttu-id="3a4d1-139">O carregamento de um provedor pode ser um processo relativamente demorado.</span><span class="sxs-lookup"><span data-stu-id="3a4d1-139">Loading a provider can be a relatively time-intensive process.</span></span> <span data-ttu-id="3a4d1-140">Portanto, você deve armazenar em cache quaisquer identificadores de provedor que serão referenciados várias vezes durante o tempo de vida do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="3a4d1-140">You should therefore cache any provider handles that you will reference multiple times during the lifetime of your application.</span></span>

## <a name="programming-examples"></a><span data-ttu-id="3a4d1-141">Exemplos de programação</span><span class="sxs-lookup"><span data-stu-id="3a4d1-141">Programming Examples</span></span>

<span data-ttu-id="3a4d1-142">Os exemplos a seguir descrevem como executar operações criptográficas específicas usando a CNG.</span><span class="sxs-lookup"><span data-stu-id="3a4d1-142">The following examples describe how to perform specific cryptographic operations using CNG.</span></span>

-   [<span data-ttu-id="3a4d1-143">Criando um hash com CNG</span><span class="sxs-lookup"><span data-stu-id="3a4d1-143">Creating a Hash with CNG</span></span>](creating-a-hash-with-cng.md)
-   [<span data-ttu-id="3a4d1-144">Assinando dados com CNG</span><span class="sxs-lookup"><span data-stu-id="3a4d1-144">Signing Data with CNG</span></span>](signing-data-with-cng.md)
-   [<span data-ttu-id="3a4d1-145">Criptografando dados com CNG</span><span class="sxs-lookup"><span data-stu-id="3a4d1-145">Encrypting Data with CNG</span></span>](encrypting-data-with-cng.md)

 

 



