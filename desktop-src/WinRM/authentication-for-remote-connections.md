---
title: Autenticação para conexões remotas
description: Gerenciamento Remoto do Windows mantém a segurança para a comunicação entre computadores dando suporte a vários métodos padrão de autenticação e criptografia de mensagens.
ms.assetid: 97a13b07-ae7a-4d2f-8841-77a22c91b204
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
topic_type:
- kbArticle
api_name: ''
api_type: ''
api_location: ''
ms.openlocfilehash: 0e9aa125f2ccf5d8c224eee645a6dba1ec2fd96e
ms.sourcegitcommit: 25c6d442ab55cbf0e065398a006b1d409349fffd
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/27/2020
ms.locfileid: "104007251"
---
# <a name="authentication-for-remote-connections"></a><span data-ttu-id="9b22f-103">Autenticação para conexões remotas</span><span class="sxs-lookup"><span data-stu-id="9b22f-103">Authentication for Remote Connections</span></span>

<span data-ttu-id="9b22f-104">Gerenciamento Remoto do Windows mantém a segurança para a comunicação entre computadores dando suporte a vários métodos padrão de autenticação e criptografia de mensagens.</span><span class="sxs-lookup"><span data-stu-id="9b22f-104">Windows Remote Management maintains security for communication between computers by supporting several standard methods of authentication and message encryption.</span></span>

## <a name="default-group-access"></a><span data-ttu-id="9b22f-105">Acesso de grupo padrão</span><span class="sxs-lookup"><span data-stu-id="9b22f-105">Default Group Access</span></span>

<span data-ttu-id="9b22f-106">Durante a instalação, o WinRM cria o grupo local **WinRMRemoteWMIUsers \_ \_**.</span><span class="sxs-lookup"><span data-stu-id="9b22f-106">During setup, WinRM creates the local group **WinRMRemoteWMIUsers\_\_**.</span></span> <span data-ttu-id="9b22f-107">Em seguida, o WinRM restringe o acesso remoto a qualquer usuário que não seja membro do grupo de administração local ou do grupo **WinRMRemoteWMIUsers \_ \_** .</span><span class="sxs-lookup"><span data-stu-id="9b22f-107">WinRM then restricts remote access to any user that is not a member of either the local administration group or the **WinRMRemoteWMIUsers\_\_** group.</span></span> <span data-ttu-id="9b22f-108">Você pode adicionar um usuário local, um usuário de domínio ou um grupo de domínio a **WinRMRemoteWMIUsers \_ \_** digitando **net local WinRMRemoteWMIUsers \_ \_ /Add <domain> \\ <username>** no prompt de comando.</span><span class="sxs-lookup"><span data-stu-id="9b22f-108">You can add a local user, domain user, or domain group to **WinRMRemoteWMIUsers\_\_** by typing **net localgroup WinRMRemoteWMIUsers\_\_ /add <domain>\\<username>** at the command prompt.</span></span> <span data-ttu-id="9b22f-109">Opcionalmente, você pode usar o Política de Grupo para adicionar um usuário ao grupo.</span><span class="sxs-lookup"><span data-stu-id="9b22f-109">Optionally, you can use the Group Policy to add a user to the group.</span></span>

## <a name="default-authentication-settings"></a><span data-ttu-id="9b22f-110">Configurações de autenticação padrão</span><span class="sxs-lookup"><span data-stu-id="9b22f-110">Default Authentication Settings</span></span>

<span data-ttu-id="9b22f-111">As credenciais padrão, o nome de usuário e a senha são as credenciais para a conta de usuário conectada que executa o script.</span><span class="sxs-lookup"><span data-stu-id="9b22f-111">The default credentials, user name, and password, are the credentials for the logged-on user account that runs the script.</span></span>

<span data-ttu-id="9b22f-112">**Para alterar para outra conta em um computador remoto**</span><span class="sxs-lookup"><span data-stu-id="9b22f-112">**To change to another account on a remote computer**</span></span>

1.  <span data-ttu-id="9b22f-113">Especifique as credenciais em um objeto [**ConnectionOptions**](connectionoptions.md) ou [**IWSManConnectionOptions**](/windows/desktop/api/WSManDisp/nn-wsmandisp-iwsmanconnectionoptions) e forneça isso à chamada [**CreateSession**](wsman-createsession.md) .</span><span class="sxs-lookup"><span data-stu-id="9b22f-113">Specify the credentials in a [**ConnectionOptions**](connectionoptions.md) or [**IWSManConnectionOptions**](/windows/desktop/api/WSManDisp/nn-wsmandisp-iwsmanconnectionoptions) object and supply that to the [**CreateSession**](wsman-createsession.md) call.</span></span>
2.  <span data-ttu-id="9b22f-114">Defina o **WSManFlagCredUserNamePassword** no parâmetro *flags* na chamada [**CreateSession**](wsman-createsession.md) .</span><span class="sxs-lookup"><span data-stu-id="9b22f-114">Set the **WSManFlagCredUserNamePassword** in the *flags* parameter in the [**CreateSession**](wsman-createsession.md) call.</span></span>

<span data-ttu-id="9b22f-115">A lista a seguir contém uma lista do que ocorre quando um script ou aplicativo é executado sob as credenciais padrão:</span><span class="sxs-lookup"><span data-stu-id="9b22f-115">The following list contains a list of what occurs when a script or application runs under the default credentials:</span></span>

-   <span data-ttu-id="9b22f-116">[*Kerberos*](windows-remote-management-glossary.md) é o método padrão de autenticação quando o cliente está em um domínio e a cadeia de caracteres de destino remoto não é uma das seguintes opções: localhost, 127.0.0.1 ou \[ :: 1 \] .</span><span class="sxs-lookup"><span data-stu-id="9b22f-116">[*Kerberos*](windows-remote-management-glossary.md) is the default method of authentication when the client is in a domain and the remote destination string is not one of the following: localhost, 127.0.0.1, or \[::1\].</span></span>
-   <span data-ttu-id="9b22f-117">[*Negotiate*](windows-remote-management-glossary.md) é o método padrão quando o cliente não está em um domínio, mas a cadeia de caracteres de destino remoto é uma das seguintes: localhost, 127.0.0.1 ou \[ :: 1 \] .</span><span class="sxs-lookup"><span data-stu-id="9b22f-117">[*Negotiate*](windows-remote-management-glossary.md) is the default method when the client is not in a domain, but the remote destination string is one of the following: localhost, 127.0.0.1, or \[::1\].</span></span>

<span data-ttu-id="9b22f-118">Se você fornecer credenciais explícitas com um objeto [**ConnectionOptions**](connectionoptions.md) , Negotiate será o método padrão.</span><span class="sxs-lookup"><span data-stu-id="9b22f-118">If you supply explicit credentials with a [**ConnectionOptions**](connectionoptions.md) object, Negotiate is the default method.</span></span> <span data-ttu-id="9b22f-119">A autenticação de negociação determina se o método de autenticação em andamento é Kerberos ou NTLM, dependendo se os computadores estão em um domínio ou grupo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="9b22f-119">Negotiate authentication determines whether the ongoing authentication method is Kerberos or NTLM, depending on whether the computers are in a domain or workgroup.</span></span> <span data-ttu-id="9b22f-120">Se estiver se conectando a um computador de destino remoto usando uma conta local, a conta deverá ser prefixada com o nome do computador.</span><span class="sxs-lookup"><span data-stu-id="9b22f-120">If connecting to a remote target computer using a local account, then the account should be prefixed with the computer name.</span></span> <span data-ttu-id="9b22f-121">Por exemplo, \\ myusername.</span><span class="sxs-lookup"><span data-stu-id="9b22f-121">For example, myComputer\\myUsername.</span></span>

<span data-ttu-id="9b22f-122">Se você especificar Negotiate, Digest ou autenticação básica e falhar em fornecer um objeto [**ConnectionOptions**](connectionoptions.md) , receberá um erro indicando que as credenciais explícitas são necessárias.</span><span class="sxs-lookup"><span data-stu-id="9b22f-122">If you specify Negotiate, Digest, or Basic authentication and fail to supply a [**ConnectionOptions**](connectionoptions.md) object, then you will receive an error indicating that explicit credentials are required.</span></span> <span data-ttu-id="9b22f-123">Se o HTTPS não for o transporte, o computador remoto de destino deverá ser configurado na lista de computadores host confiáveis.</span><span class="sxs-lookup"><span data-stu-id="9b22f-123">If HTTPS is not the transport, then the target remote computer must be configured in the list of trusted host computers.</span></span>

<span data-ttu-id="9b22f-124">Para obter mais informações sobre os tipos de autenticação que estão habilitados nas definições de configuração padrão, consulte [instalação e configuração para gerenciamento remoto do Windows](installation-and-configuration-for-windows-remote-management.md).</span><span class="sxs-lookup"><span data-stu-id="9b22f-124">For more information about the authentication types that are enabled in the default configuration settings, see [Installation and Configuration for Windows Remote Management](installation-and-configuration-for-windows-remote-management.md).</span></span>

## <a name="basic-authentication"></a><span data-ttu-id="9b22f-125">Autenticação Básica</span><span class="sxs-lookup"><span data-stu-id="9b22f-125">Basic Authentication</span></span>

<span data-ttu-id="9b22f-126">Para estabelecer explicitamente a autenticação [*básica*](windows-remote-management-glossary.md) na chamada para [**WSMan. CreateSession**](wsman-createsession.md), defina os sinalizadores **WSManFlagUseBasic** e **WSManFlagCredUserNamePassword** no parâmetro *flags* .</span><span class="sxs-lookup"><span data-stu-id="9b22f-126">To explicitly establish [*Basic*](windows-remote-management-glossary.md) authentication in the call to [**WSMan.CreateSession**](wsman-createsession.md), set the **WSManFlagUseBasic** and **WSManFlagCredUserNamePassword** flags in the *flags* parameter.</span></span> <span data-ttu-id="9b22f-127">A autenticação básica é desabilitada nas definições de configuração padrão para o cliente WinRM e o servidor WinRM.</span><span class="sxs-lookup"><span data-stu-id="9b22f-127">Basic authentication is disabled in the default configuration settings for both the WinRM client and the WinRM server.</span></span>

## <a name="digest-authentication"></a><span data-ttu-id="9b22f-128">Autenticação Digest</span><span class="sxs-lookup"><span data-stu-id="9b22f-128">Digest Authentication</span></span>

<span data-ttu-id="9b22f-129">Para estabelecer explicitamente a autenticação [*Digest*](windows-remote-management-glossary.md) na chamada para [**WSMan. CreateSession**](wsman-createsession.md), defina o sinalizador **WSManFlagUseDigest** no parâmetro *flags* .</span><span class="sxs-lookup"><span data-stu-id="9b22f-129">To explicitly establish [*Digest*](windows-remote-management-glossary.md) authentication in the call to [**WSMan.CreateSession**](wsman-createsession.md), set the **WSManFlagUseDigest** flag in the *flags* parameter.</span></span> <span data-ttu-id="9b22f-130">Não há suporte para Digest.</span><span class="sxs-lookup"><span data-stu-id="9b22f-130">Digest is not supported.</span></span> <span data-ttu-id="9b22f-131">Ele não pode ser configurado para o componente do servidor WinRM.</span><span class="sxs-lookup"><span data-stu-id="9b22f-131">It cannot be configured, for the WinRM server component.</span></span>

## <a name="negotiate-authentication"></a><span data-ttu-id="9b22f-132">Negociar autenticação</span><span class="sxs-lookup"><span data-stu-id="9b22f-132">Negotiate Authentication</span></span>

<span data-ttu-id="9b22f-133">Para estabelecer explicitamente a autenticação de [*negociação*](windows-remote-management-glossary.md) , também conhecida como autenticação integrada do Windows, na chamada para [**WSMan. CreateSession**](wsman-createsession.md), defina o sinalizador **WSManFlagUseNegotiate** no parâmetro *flags* .</span><span class="sxs-lookup"><span data-stu-id="9b22f-133">To explicitly establish [*Negotiate*](windows-remote-management-glossary.md) authentication, also known as Windows Integrated Authentication, in the call to [**WSMan.CreateSession**](wsman-createsession.md), set the **WSManFlagUseNegotiate** flag in the *flags* parameter.</span></span>

<span data-ttu-id="9b22f-134">O [UAC (controle de conta de usuário)](https://support.microsoft.com/help/922708/how-to-use-user-account-control-uac-in-windows-vista) afeta o acesso ao serviço WinRM.</span><span class="sxs-lookup"><span data-stu-id="9b22f-134">[User Account Control (UAC)](https://support.microsoft.com/help/922708/how-to-use-user-account-control-uac-in-windows-vista) affects access to the WinRM service.</span></span> <span data-ttu-id="9b22f-135">Quando a autenticação de negociação é usada em um grupo de trabalho, somente a conta de administrador interno pode acessar o serviço.</span><span class="sxs-lookup"><span data-stu-id="9b22f-135">When Negotiate authentication is used in a workgroup, only the built-in Administrator account can access the service.</span></span> <span data-ttu-id="9b22f-136">Para permitir que todas as contas no grupo administradores acessem o serviço, defina o seguinte valor de registro:</span><span class="sxs-lookup"><span data-stu-id="9b22f-136">To allow all accounts in the Administrators group to access the service, set the following registry value:</span></span>

<span data-ttu-id="9b22f-137">**HKEY \_ \_Computador local** \\ **software** \\ **Microsoft** \\ **Windows** \\ **CurrentVersion** \\ **Policies** \\ **System** \\ **LocalAccountTokenFilterPolicy** = 1</span><span class="sxs-lookup"><span data-stu-id="9b22f-137">**HKEY\_LOCAL\_MACHINE**\\**SOFTWARE**\\**Microsoft**\\**Windows**\\**CurrentVersion**\\**Policies**\\**System**\\**LocalAccountTokenFilterPolicy** = 1</span></span>

## <a name="kerberos-authentication"></a><span data-ttu-id="9b22f-138">Autenticação Kerberos</span><span class="sxs-lookup"><span data-stu-id="9b22f-138">Kerberos Authentication</span></span>

<span data-ttu-id="9b22f-139">Para estabelecer explicitamente a autenticação [*Kerberos*](windows-remote-management-glossary.md) na chamada para [**WSMan. CreateSession**](wsman-createsession.md), defina o sinalizador **WSManFlagUseKerberos** no parâmetro *flags* .</span><span class="sxs-lookup"><span data-stu-id="9b22f-139">To explicitly establish [*Kerberos*](windows-remote-management-glossary.md) authentication in the call to [**WSMan.CreateSession**](wsman-createsession.md), set the **WSManFlagUseKerberos** flag in the *flags* parameter.</span></span> <span data-ttu-id="9b22f-140">Os computadores cliente e servidor devem ser ingressados em um domínio.</span><span class="sxs-lookup"><span data-stu-id="9b22f-140">Both the client and the server computers must be joined to a domain.</span></span> <span data-ttu-id="9b22f-141">Se você usar o Kerberos como o método de autenticação, não poderá usar um endereço IP na chamada para [**WSMan. CreateSession**](wsman-createsession.md) ou [**IWSMan:: CreateSession**](/windows/desktop/api/WSManDisp/nf-wsmandisp-iwsman-createsession).</span><span class="sxs-lookup"><span data-stu-id="9b22f-141">If you use Kerberos as the authentication method, you cannot use an IP address in the call to [**WSMan.CreateSession**](wsman-createsession.md) or [**IWSMan::CreateSession**](/windows/desktop/api/WSManDisp/nf-wsmandisp-iwsman-createsession).</span></span>

## <a name="client-certificate-based-authentication"></a><span data-ttu-id="9b22f-142">Autenticação baseada em certificado do cliente</span><span class="sxs-lookup"><span data-stu-id="9b22f-142">Client Certificate-based Authentication</span></span>

<span data-ttu-id="9b22f-143">Para estabelecer a autenticação baseada em certificado de cliente na chamada para [**WSMan. CreateSession**](wsman-createsession.md), defina o sinalizador **WSManFlagUseClientCertificate** no parâmetro *flags* .</span><span class="sxs-lookup"><span data-stu-id="9b22f-143">To establish client certificate-based authentication in the call to [**WSMan.CreateSession**](wsman-createsession.md), set the **WSManFlagUseClientCertificate** flag in the *flags* parameter.</span></span>

<span data-ttu-id="9b22f-144">Primeiro, você deve habilitar a autenticação de certificado no cliente e no serviço usando a ferramenta de linha de comando WinRM.</span><span class="sxs-lookup"><span data-stu-id="9b22f-144">You must first enable certificate authentication on both the client and service by using the Winrm command line tool.</span></span> <span data-ttu-id="9b22f-145">Para obter mais informações, consulte [habilitando opções de autenticação](#enabling-or-disabling-authentication-options).</span><span class="sxs-lookup"><span data-stu-id="9b22f-145">For more information, see [Enabling Authentication Options](#enabling-or-disabling-authentication-options).</span></span> <span data-ttu-id="9b22f-146">Você também deve criar uma entrada na tabela CertMapping no computador do servidor WinRM.</span><span class="sxs-lookup"><span data-stu-id="9b22f-146">You must also create an entry in the CertMapping table on the WinRM server computer.</span></span> <span data-ttu-id="9b22f-147">Isso estabelece um mapeamento entre um ou mais certificados e uma conta local.</span><span class="sxs-lookup"><span data-stu-id="9b22f-147">This establishes a mapping between one or more certificates and a local account.</span></span> <span data-ttu-id="9b22f-148">Depois que o certificado tiver sido usado para autenticação e autorização, a conta local correspondente será usada para operações executadas pelo serviço WinRM.</span><span class="sxs-lookup"><span data-stu-id="9b22f-148">After the certificate has been used for authentication and authorization, the corresponding local account is used for operations performed by the WinRM service.</span></span>

<span data-ttu-id="9b22f-149">O mapeamento pode ser criado para um URI de recurso específico.</span><span class="sxs-lookup"><span data-stu-id="9b22f-149">The mapping can be created for a specific resource URI.</span></span> <span data-ttu-id="9b22f-150">Para saber mais, incluindo como criar uma entrada de tabela CertMapping, digite **winrm help CertMapping** no prompt de comando.</span><span class="sxs-lookup"><span data-stu-id="9b22f-150">To learn more, including how to create a CertMapping table entry, type **winrm help certmapping** at the command prompt.</span></span>

> [!Note]  
> <span data-ttu-id="9b22f-151">O certificado de tamanho máximo utilizável pelo WinRM neste contexto é 16 KB.</span><span class="sxs-lookup"><span data-stu-id="9b22f-151">The maximum size certificate usable by WinRM in this context is 16KB.</span></span>

 

## <a name="enabling-or-disabling-authentication-options"></a><span data-ttu-id="9b22f-152">Habilitando ou desabilitando opções de autenticação</span><span class="sxs-lookup"><span data-stu-id="9b22f-152">Enabling or Disabling Authentication Options</span></span>

<span data-ttu-id="9b22f-153">A opção de autenticação padrão na instalação do sistema é Kerberos.</span><span class="sxs-lookup"><span data-stu-id="9b22f-153">The default authentication option at system installation is Kerberos.</span></span> <span data-ttu-id="9b22f-154">Para obter mais informações, consulte [instalação e configuração para gerenciamento remoto do Windows](installation-and-configuration-for-windows-remote-management.md).</span><span class="sxs-lookup"><span data-stu-id="9b22f-154">For more information, see [Installation and Configuration for Windows Remote Management](installation-and-configuration-for-windows-remote-management.md).</span></span>

<span data-ttu-id="9b22f-155">Se o seu script ou aplicativo exigir um método de autenticação específico que não esteja habilitado, você deverá alterar a configuração para habilitar esse tipo de autenticação.</span><span class="sxs-lookup"><span data-stu-id="9b22f-155">If your script or application requires a specific authentication method that is not enabled, you must change the configuration to enable this type of authentication.</span></span> <span data-ttu-id="9b22f-156">Essa alteração pode ser feita usando a ferramenta de linha de comando **WinRM** ou por meio de política de grupo para o **objeto gerenciamento remoto do Windows política de grupo**.</span><span class="sxs-lookup"><span data-stu-id="9b22f-156">This change can be made using the **Winrm** command-line tool or through Group Policy for the **Windows Remote Management Group Policy Object**.</span></span> <span data-ttu-id="9b22f-157">Você também pode optar por desabilitar determinados métodos de autenticação.</span><span class="sxs-lookup"><span data-stu-id="9b22f-157">You may also choose to disable certain methods of authentication.</span></span>

<span data-ttu-id="9b22f-158">**Para habilitar ou desabilitar a autenticação com a ferramenta WinRM**</span><span class="sxs-lookup"><span data-stu-id="9b22f-158">**To enable or disable authentication with the Winrm tool**</span></span>

1.  <span data-ttu-id="9b22f-159">Para definir a configuração para o cliente WinRM, use o comando **WinRM Set** e especifique o cliente.</span><span class="sxs-lookup"><span data-stu-id="9b22f-159">To set the configuration for the WinRM client, use the **Winrm Set** command and specify the client.</span></span> <span data-ttu-id="9b22f-160">Por exemplo, o comando a seguir desabilita a autenticação Digest para o cliente.</span><span class="sxs-lookup"><span data-stu-id="9b22f-160">For example, the following command disables digest authentication for the client.</span></span>

    <span data-ttu-id="9b22f-161">**WinRM Set WinRM/config/Client/auth @ {Digest = "false"}**</span><span class="sxs-lookup"><span data-stu-id="9b22f-161">**winrm set winrm/config/client/auth @{Digest="false"}**</span></span>

2.  <span data-ttu-id="9b22f-162">Para definir a configuração do servidor WinRM, use o comando **WinRM Set** e especifique o serviço.</span><span class="sxs-lookup"><span data-stu-id="9b22f-162">To set the configuration for the WinRM server, use the **Winrm Set** command and specify the service.</span></span> <span data-ttu-id="9b22f-163">Por exemplo, o comando a seguir habilita a autenticação Kerberos para o serviço.</span><span class="sxs-lookup"><span data-stu-id="9b22f-163">For example, the following command enables Kerberos authentication for the service.</span></span>

    <span data-ttu-id="9b22f-164">**WinRM Set WinRM/config/Service/auth @ {Kerberos = "true"}**</span><span class="sxs-lookup"><span data-stu-id="9b22f-164">**winrm set winrm/config/service/auth @{Kerberos="true"}**</span></span>

## <a name="related-topics"></a><span data-ttu-id="9b22f-165">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="9b22f-165">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="9b22f-166">Sobre Gerenciamento Remoto do Windows</span><span class="sxs-lookup"><span data-stu-id="9b22f-166">About Windows Remote Management</span></span>](about-windows-remote-management.md)
</dt> <dt>

[<span data-ttu-id="9b22f-167">**WSMan. CreateSession**</span><span class="sxs-lookup"><span data-stu-id="9b22f-167">**WSMan.CreateSession**</span></span>](wsman-createsession.md)
</dt> <dt>

[<span data-ttu-id="9b22f-168">Usando Gerenciamento Remoto do Windows</span><span class="sxs-lookup"><span data-stu-id="9b22f-168">Using Windows Remote Management</span></span>](using-windows-remote-management.md)
</dt> </dl>

 

 




