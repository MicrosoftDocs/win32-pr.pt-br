---
title: Suporte a vários saltos no WinRM
description: O Gerenciamento Remoto do Windows (WinRM) dá suporte à delegação de credenciais de usuário em vários computadores remotos.
ms.assetid: 0e6c8966-bb05-4dfb-b154-300fa76e8d9c
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f22c3d66e8605e932fe15b812f92d51350da2d69
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104456896"
---
# <a name="multi-hop-support-in-winrm"></a><span data-ttu-id="5b0f8-103">Suporte a vários saltos no WinRM</span><span class="sxs-lookup"><span data-stu-id="5b0f8-103">Multi-Hop Support in WinRM</span></span>

<span data-ttu-id="5b0f8-104">O Gerenciamento Remoto do Windows (WinRM) dá suporte à delegação de credenciais de usuário em vários computadores remotos.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-104">Windows Remote Management (WinRM) supports the delegation of user credentials across multiple remote computers.</span></span> <span data-ttu-id="5b0f8-105">A funcionalidade de suporte de vários saltos agora pode usar o Credential Security Service Provider (CredSSP) para autenticação.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-105">The multi-hop support functionality can now use Credential Security Service Provider (CredSSP) for authentication.</span></span> <span data-ttu-id="5b0f8-106">O CredSSP permite que um aplicativo delegue as credenciais do usuário do computador cliente para o servidor de destino.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-106">CredSSP enables an application to delegate the user's credentials from the client computer to the target server.</span></span>

<span data-ttu-id="5b0f8-107">A autenticação CredSSP destina-se a ambientes em que a delegação de Kerberos não pode ser usada.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-107">CredSSP authentication is intended for environments where Kerberos delegation cannot be used.</span></span> <span data-ttu-id="5b0f8-108">O suporte para CredSSP foi adicionado para permitir que um usuário se conecte a um servidor remoto e tenha a capacidade de acessar um computador de segundo salto, como um compartilhamento de arquivos.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-108">Support for CredSSP was added to allow a user to connect to a remote server and have the ability to access a second-hop machine, such as a file share.</span></span>

<span data-ttu-id="5b0f8-109">Para obter mais informações sobre CredSSP, consulte [KB 951608](https://support.microsoft.com/kb/951608).</span><span class="sxs-lookup"><span data-stu-id="5b0f8-109">For more information about CredSSP, see [KB 951608](https://support.microsoft.com/kb/951608).</span></span>

> [!Note]  
> <span data-ttu-id="5b0f8-110">Os clientes e servidores WinRM oferecerão suporte à autenticação CredSSP somente com credenciais explícitas.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-110">WinRM clients and servers will support CredSSP authentication only with explicit credentials.</span></span>

 

## <a name="multi-hop-support-configuration-setup-and-details"></a><span data-ttu-id="5b0f8-111">Instalação e detalhes da configuração de suporte de salto múltiplo</span><span class="sxs-lookup"><span data-stu-id="5b0f8-111">Multi-Hop Support Configuration Setup and Details</span></span>

<span data-ttu-id="5b0f8-112">Há vários mecanismos para definir as configurações do WinRM.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-112">There are multiple mechanisms for configuring WinRM settings.</span></span> <span data-ttu-id="5b0f8-113">No procedimento a seguir, o utilitário **WinRM** e o editor de política de grupo (**gpedit. msc**) são usados.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-113">In the following procedure, the **winrm** utility and Group Policy editor (**GPEdit.msc**) are used.</span></span> <span data-ttu-id="5b0f8-114">O CredSSP também pode ser habilitado para o WinRM usando o Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-114">CredSSP can also be enabled for WinRM by using Windows PowerShell.</span></span> <span data-ttu-id="5b0f8-115">Consulte os cmdlets [Enable-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Enable-WSManCredSSP?view=powershell-5.1&preserve-view=true), [Get-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Get-WSManCredSSP?view=powershell-5.1&preserve-view=true)e [Disable-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Disable-WSManCredSSP?view=powershell-5.1&preserve-view=true) do Windows PowerShell para obter informações de configuração detalhadas e exemplos de uso.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-115">See the [Enable-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Enable-WSManCredSSP?view=powershell-5.1&preserve-view=true), [Get-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Get-WSManCredSSP?view=powershell-5.1&preserve-view=true), and [Disable-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Disable-WSManCredSSP?view=powershell-5.1&preserve-view=true) Windows PowerShell cmdlets for detailed configuration information and usage examples.</span></span>

<span data-ttu-id="5b0f8-116">A delegação de CredSSP deve ser habilitada nas configurações do cliente e nas configurações do serviço no computador remoto.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-116">CredSSP delegation must be enabled in the client settings and in the service settings on the remote computer.</span></span> <span data-ttu-id="5b0f8-117">Além disso, o uso de CredSSP requer a configuração de um [*ouvinte*](windows-remote-management-glossary.md) http ou HTTPS no servidor.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-117">In addition, using CredSSP requires setting up an HTTP or HTTPS [*listener*](windows-remote-management-glossary.md) on the server.</span></span>

<span data-ttu-id="5b0f8-118">**Para configurar o suporte a vários saltos usando a autenticação CredSSP para WinRM**</span><span class="sxs-lookup"><span data-stu-id="5b0f8-118">**To configure multi-hop support using CredSSP authentication for WinRM**</span></span>

1.  <span data-ttu-id="5b0f8-119">O CredSSP deve ser habilitado nas definições de configuração do cliente.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-119">CredSSP must be enabled in the client configuration settings.</span></span> <span data-ttu-id="5b0f8-120">Esse sinalizador pode ser habilitado manualmente ou por meio de uma configuração de Política de Grupo.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-120">This flag can be enabled manually or through a Group Policy setting.</span></span> <span data-ttu-id="5b0f8-121">A configuração padrão é **False**.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-121">The default setting is **False**.</span></span> <span data-ttu-id="5b0f8-122">A política **permitir a autenticação CredSSP** está localizada no seguinte caminho: configuração do computador \\ modelo \\ administrativo componentes \\ do Windows gerenciamento remoto do Windows (WinRM) \\ WinRM Client.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-122">The **Allow CredSSP authentication** policy is located at the following path: Computer Configuration\\Administrative template\\Windows Components\\Windows Remote Management (WinRM)\\WinRM Client.</span></span>

    <span data-ttu-id="5b0f8-123">O comando a seguir demonstra como usar o utilitário WinRM para habilitar o CredSSP no cliente WinRM:</span><span class="sxs-lookup"><span data-stu-id="5b0f8-123">The following command demonstrates how to use the winrm utility to enable CredSSP on the WinRM client:</span></span>

    <span data-ttu-id="5b0f8-124">**WinRM Set WinRM/config/Client/auth @ {CredSSP = "true"}**</span><span class="sxs-lookup"><span data-stu-id="5b0f8-124">**winrm set winrm/config/client/auth @{CredSSP="true"}**</span></span>

2.  <span data-ttu-id="5b0f8-125">O CredSSP deve ser habilitado nas definições de configuração do serviço WinRM.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-125">CredSSP must be enabled in the WinRM service configuration settings.</span></span> <span data-ttu-id="5b0f8-126">Esse sinalizador pode ser habilitado manualmente ou por meio de uma configuração de Política de Grupo.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-126">This flag can be enabled manually or through a Group Policy setting.</span></span> <span data-ttu-id="5b0f8-127">A configuração padrão é **False**.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-127">The default setting is **False**.</span></span> <span data-ttu-id="5b0f8-128">A política **permitir a autenticação CredSSP** está localizada no seguinte caminho: configuração do computador \\ modelo \\ administrativo componentes \\ do Windows gerenciamento remoto do Windows (WinRM) \\ WinRM Service.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-128">The **Allow CredSSP authentication** policy is located at the following path: Computer Configuration\\Administrative template\\Windows Components\\Windows Remote Management (WinRM)\\WinRM Service.</span></span>

    <span data-ttu-id="5b0f8-129">O comando a seguir demonstra como usar o utilitário WinRM para habilitar o CredSSP no serviço WinRM:</span><span class="sxs-lookup"><span data-stu-id="5b0f8-129">The following command demonstrates how to use the winrm utility to enable CredSSP on the WinRM service:</span></span>

    <span data-ttu-id="5b0f8-130">**WinRM Set WinRM/config/Service/auth @ {CredSSP = "true"}**</span><span class="sxs-lookup"><span data-stu-id="5b0f8-130">**winrm set winrm/config/service/auth @{CredSSP="true"}**</span></span>

3.  <span data-ttu-id="5b0f8-131">A configuração de política permitir a delegação de credenciais atualizadas (**AllowFreshCredentials**) deve ser habilitada no cliente WinRM e um SPN (nome da entidade de serviço) com o prefixo WSMan deve ser adicionado à política.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-131">The Allow Delegating Fresh Credentials (**AllowFreshCredentials**) policy setting must be enabled on the WinRM client, and a Service Principal Name (SPN) with the WSMAN prefix must be added to the policy.</span></span> <span data-ttu-id="5b0f8-132">O SPN representa o computador de destino ao qual as credenciais do usuário podem ser delegadas.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-132">The SPN represents the target computer to which the user credentials can be delegated.</span></span> <span data-ttu-id="5b0f8-133">O SPN pode ser definido como um ou mais computadores.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-133">The SPN can be set to one or more computers.</span></span> <span data-ttu-id="5b0f8-134">A tabela a seguir contém exemplos de formatos válidos para SPNs.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-134">The following table contains examples of valid formats for SPNs.</span></span>

    

    | <span data-ttu-id="5b0f8-135">SPN</span><span class="sxs-lookup"><span data-stu-id="5b0f8-135">SPN</span></span>                                       | <span data-ttu-id="5b0f8-136">Descrição</span><span class="sxs-lookup"><span data-stu-id="5b0f8-136">Description</span></span>                                                                         |
    |-------------------------------------------|-------------------------------------------------------------------------------------|
    | <span data-ttu-id="5b0f8-137">WSMAN/MyComputer. mydomain. com</span><span class="sxs-lookup"><span data-stu-id="5b0f8-137">WSMAN/myComputer.myDomain.com</span></span><br/>  | <span data-ttu-id="5b0f8-138">Servidor WinRM em execução em myComputer.myDomain.com.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-138">WinRM server running on myComputer.myDomain.com.</span></span><br/>                         |
    | <span data-ttu-id="5b0f8-139">WSMAN/ \* . mydomain.com</span><span class="sxs-lookup"><span data-stu-id="5b0f8-139">WSMAN/\*.myDomain.com</span></span><br/>          | <span data-ttu-id="5b0f8-140">Todos os servidores WinRM em execução no myDomain.com.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-140">All WinRM servers running in myDomain.com.</span></span><br/>                               |
    | <span data-ttu-id="5b0f8-141">WSMAN/ \* . fabrikam.mydomain.com</span><span class="sxs-lookup"><span data-stu-id="5b0f8-141">WSMAN/\*.fabrikam.myDomain.com</span></span><br/> | <span data-ttu-id="5b0f8-142">Todos os servidores WinRM em execução no em todos os computadores em. fabrikam.myDomain.com.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-142">All WinRM servers running in on all computers in .fabrikam.myDomain.com.</span></span><br/> |

    

     

    <span data-ttu-id="5b0f8-143">Para obter mais informações sobre como definir políticas de grupo, consulte [instalação e configuração para gerenciamento remoto do Windows](installation-and-configuration-for-windows-remote-management.md).</span><span class="sxs-lookup"><span data-stu-id="5b0f8-143">For more information about setting Group Policies, see [Installation and Configuration for Windows Remote Management](installation-and-configuration-for-windows-remote-management.md).</span></span>

    <span data-ttu-id="5b0f8-144">Para obter mais informações sobre a política **AllowFreshCredentials** , consulte a descrição da política fornecida pelo editor de política de grupo e [KB 951608](https://support.microsoft.com/kb/951608).</span><span class="sxs-lookup"><span data-stu-id="5b0f8-144">For more information about the **AllowFreshCredentials** policy, see the policy description provided by the Group Policy editor and [KB 951608](https://support.microsoft.com/kb/951608).</span></span> <span data-ttu-id="5b0f8-145">A política **AllowFreshCredentials** está localizada no seguinte caminho: configuração do computador \\ modelos administrativos \\ delegação de credenciais do sistema \\ .</span><span class="sxs-lookup"><span data-stu-id="5b0f8-145">The **AllowFreshCredentials** policy is located at the following path: Computer Configuration\\Administrative Templates\\System\\Credentials Delegation.</span></span>

4.  <span data-ttu-id="5b0f8-146">Um [*ouvinte*](windows-remote-management-glossary.md) HTTPS ou http deve ser configurado no servidor.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-146">An HTTPS or HTTP [*listener*](windows-remote-management-glossary.md) must be configured on the server.</span></span> <span data-ttu-id="5b0f8-147">A impressão digital do certificado usada para configurar o *ouvinte* HTTPS também é usada para definir a configuração CertificateThumbprint nas configurações do serviço WinRM.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-147">The certificate thumbprint used for configuring the HTTPS *listener* is also used to configure the CertificateThumbprint setting under the WinRM service settings.</span></span>

    <span data-ttu-id="5b0f8-148">O comando a seguir demonstra como usar o utilitário WinRM para configurar um [*ouvinte*](windows-remote-management-glossary.md)https:</span><span class="sxs-lookup"><span data-stu-id="5b0f8-148">The following command demonstrates how to use the winrm utility to configure an HTTPS [*listener*](windows-remote-management-glossary.md):</span></span>

    <span data-ttu-id="5b0f8-149">**winrm quickconfig-Transport: https**</span><span class="sxs-lookup"><span data-stu-id="5b0f8-149">**winrm quickconfig -transport:https**</span></span>

<span data-ttu-id="5b0f8-150">Se a autenticação Kerberos entre o cliente e o servidor não for possível, o usuário deverá configurar uma das seguintes configurações para suporte a vários saltos:</span><span class="sxs-lookup"><span data-stu-id="5b0f8-150">If Kerberos authentication between the client and server is not possible, the user must configure one of the following settings for multi-hop support:</span></span>

-   <span data-ttu-id="5b0f8-151">Para maior segurança, o usuário deve adicionar o atributo **CertificateThumbprint** à configuração do serviço WinRM.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-151">For better security, the user should add the **CertificateThumbprint** attribute to the WinRM service setting.</span></span> <span data-ttu-id="5b0f8-152">Se o serviço WinRM estiver configurado com um atributo **CertificateThumbprint** , o serviço tentará localizar o certificado correspondente no repositório do computador local e usará esse certificado para a autenticação CredSSP.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-152">If the WinRM service is configured with a **CertificateThumbprint** attribute, the service attempts to locate the corresponding certificate in the Local Machine store and uses this certificate for the CredSSP authentication.</span></span> <span data-ttu-id="5b0f8-153">Se o serviço WinRM usar um certificado do repositório do computador local para autenticar o servidor, a conta de serviço de rede deverá ter permissão de acesso à chave privada do certificado.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-153">If the WinRM service uses a certificate from the Local Machine store to authenticate the server, the Network Service account must be allowed access to the private key of the certificate.</span></span>

    > [!Note]  
    > <span data-ttu-id="5b0f8-154">Se a configuração do serviço não estiver configurada, o servidor WinRM usará um certificado autoassinado que é criado na memória para criptografar as mensagens enviadas ao cliente.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-154">If the service setting is not configured, the WinRM server uses a self-signed certificate that is created in memory to encrypt messages sent to the client.</span></span> <span data-ttu-id="5b0f8-155">No entanto, esse certificado não é usado para autenticação.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-155">However, this certificate is not used for authentication.</span></span>

     

-   <span data-ttu-id="5b0f8-156">Se nenhuma autenticação Kerberos nem impressão digital de certificado estiver disponível, o usuário poderá habilitar a autenticação NTLM.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-156">If neither Kerberos authentication nor certificate thumbprints are available, the user can enable NTLM authentication.</span></span> <span data-ttu-id="5b0f8-157">Se a autenticação NTLM for usada, a política permitir novas credenciais com **AllowFreshCredentialsWhenNTLMOnly**(autenticação de servidor somente NTML) deverá ser habilitada e um SPN com o prefixo WSMan deverá ser adicionado à política.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-157">If NTLM authentication is used, the Allow Fresh Credentials with NTLM-only Server Authentication (**AllowFreshCredentialsWhenNTLMOnly**) policy must be enabled, and an SPN with the WSMAN prefix must be added to the policy.</span></span> <span data-ttu-id="5b0f8-158">Essa configuração é menos segura do que a autenticação Kerberos e as impressões digitais do certificado, pois as credenciais são enviadas a um servidor não autenticado.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-158">This setting is less secure than both Kerberos authentication and certificate thumbprints, because credentials are sent to an unauthenticated server.</span></span>

    <span data-ttu-id="5b0f8-159">Para obter mais informações sobre a política **AllowFreshCredentialsWhenNTLMOnly** , consulte a descrição da política fornecida pelo editor de política de grupo e [KB 951608](https://support.microsoft.com/kb/951608).</span><span class="sxs-lookup"><span data-stu-id="5b0f8-159">For more information about the **AllowFreshCredentialsWhenNTLMOnly** policy, see the policy description provided by the Group Policy editor and [KB 951608](https://support.microsoft.com/kb/951608).</span></span> <span data-ttu-id="5b0f8-160">A política **AllowFreshCredentialsWhenNTLMOnly** está localizada no seguinte caminho: configuração do computador \\ modelos administrativos \\ delegação de credenciais do sistema \\ .</span><span class="sxs-lookup"><span data-stu-id="5b0f8-160">The **AllowFreshCredentialsWhenNTLMOnly** policy is located at the following path: Computer Configuration\\Administrative Templates\\System\\Credentials Delegation.</span></span>

## <a name="using-credssp-authentication-with-explicit-credentials"></a><span data-ttu-id="5b0f8-161">Usando a autenticação CredSSP com credenciais explícitas</span><span class="sxs-lookup"><span data-stu-id="5b0f8-161">Using CredSSP Authentication with Explicit Credentials</span></span>

<span data-ttu-id="5b0f8-162">Um usuário pode especificar credenciais explícitas em HTTP e HTTPS.</span><span class="sxs-lookup"><span data-stu-id="5b0f8-162">A user can specify explicit credentials over both HTTP and HTTPS.</span></span> <span data-ttu-id="5b0f8-163">O comando a seguir demonstra como usar o utilitário WinRM para executar uma operação remota usando a autenticação CredSSP com credenciais explícitas por HTTPS:</span><span class="sxs-lookup"><span data-stu-id="5b0f8-163">The following command demonstrates how to use the winrm utility to perform a remote operation using CredSSP authentication with explicit credentials over HTTPS:</span></span>

<span data-ttu-id="5b0f8-164">**OPERAÇÃO do WinRM-remota: https://myMachine -autenticação: CredSSP-username: myusername-senha: mypassword**</span><span class="sxs-lookup"><span data-stu-id="5b0f8-164">**winrm OPERATION -remote:https://myMachine -authentication:CredSSP -username:myUsername -password:myPassword**</span></span>

 

