---
title: Servidores proxy e WinRM
description: Gerenciamento Remoto do Windows (WinRM) usa HTTP e HTTPS para enviar mensagens entre os computadores cliente e servidor. Em geral, o cliente WinRM envia mensagens diretamente ao servidor WinRM. Os clientes WinRM também podem ser configurados para usar um servidor proxy.
ms.assetid: f8137b3a-7704-4b21-a923-6e2692e18d90
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e07bbfebb4c8f0eb9e77a8942d54677b55c60006
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/20/2020
ms.locfileid: "103641124"
---
# <a name="proxy-servers-and-winrm"></a><span data-ttu-id="3f0bf-105">Servidores proxy e WinRM</span><span class="sxs-lookup"><span data-stu-id="3f0bf-105">Proxy Servers and WinRM</span></span>

<span data-ttu-id="3f0bf-106">Gerenciamento Remoto do Windows (WinRM) usa HTTP e HTTPS para enviar mensagens entre os computadores cliente e servidor.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-106">Windows Remote Management (WinRM) uses HTTP and HTTPS to send messages between the client and server computers.</span></span> <span data-ttu-id="3f0bf-107">Em geral, o cliente WinRM envia mensagens diretamente ao servidor WinRM.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-107">In general, the WinRM client sends messages directly to the WinRM server.</span></span> <span data-ttu-id="3f0bf-108">Os clientes WinRM também podem ser configurados para usar um servidor proxy.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-108">WinRM clients can be also configured to use a proxy server.</span></span>

<span data-ttu-id="3f0bf-109">Para obter mais informações, consulte as seções a seguir:</span><span class="sxs-lookup"><span data-stu-id="3f0bf-109">For more information, see the following sections:</span></span>

-   [<span data-ttu-id="3f0bf-110">Configurando um servidor proxy para o WinRM 2,0</span><span class="sxs-lookup"><span data-stu-id="3f0bf-110">Configuring a Proxy Server for WinRM 2.0</span></span>](#configuring-a-proxy-server-for-winrm-20)
    -   [<span data-ttu-id="3f0bf-111">Conexões de proxy baseadas em HTTPS</span><span class="sxs-lookup"><span data-stu-id="3f0bf-111">HTTPS-Based Proxy Connections</span></span>](#https-based-proxy-connections)
    -   [<span data-ttu-id="3f0bf-112">Conexões de proxy baseadas em HTTP</span><span class="sxs-lookup"><span data-stu-id="3f0bf-112">HTTP-Based Proxy Connections</span></span>](#http-based-proxy-connections)
-   [<span data-ttu-id="3f0bf-113">Configurando um servidor proxy para o WinRM 1,1 e anterior</span><span class="sxs-lookup"><span data-stu-id="3f0bf-113">Configuring a Proxy Server for WinRM 1.1 and Earlier</span></span>](#configuring-a-proxy-server-for-winrm-11-and-earlier)

## <a name="configuring-a-proxy-server-for-winrm-20"></a><span data-ttu-id="3f0bf-114">Configurando um servidor proxy para o WinRM 2,0</span><span class="sxs-lookup"><span data-stu-id="3f0bf-114">Configuring a Proxy Server for WinRM 2.0</span></span>

<span data-ttu-id="3f0bf-115">O WinRM 2,0 oferece suporte a uma ampla gama de configurações de proxy.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-115">WinRM 2.0 supports a wide range of proxy configurations.</span></span> <span data-ttu-id="3f0bf-116">Por exemplo, o WinRM dá suporte a proxies para transportes HTTP e HTTPS e para servidores proxy autenticados e não autenticados.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-116">For example, WinRM supports proxies for HTTP and HTTPS transports and for authenticated and unauthenticated proxy servers.</span></span>

### <a name="https-based-proxy-connections"></a><span data-ttu-id="3f0bf-117">HTTPS-Based conexões de proxy</span><span class="sxs-lookup"><span data-stu-id="3f0bf-117">HTTPS-Based Proxy Connections</span></span>

<span data-ttu-id="3f0bf-118">Para maior afinidade baseada em conexão e segurança, o HTTPS deve ser usado como o mecanismo de transporte.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-118">For better security and connection-based affinity, HTTPS should be used as the transport mechanism.</span></span>

<span data-ttu-id="3f0bf-119">Se o servidor proxy exigir autenticação, os clientes e servidores WinRM deverão usar HTTPS.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-119">If the proxy server requires authentication, the WinRM clients and servers must use HTTPS.</span></span>

> [!Note]  
> <span data-ttu-id="3f0bf-120">A autenticação para o servidor proxy é independente da autenticação para o servidor de destino.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-120">Authentication to the proxy server is independent from the authentication to the destination server.</span></span>

 

### <a name="http-based-proxy-connections"></a><span data-ttu-id="3f0bf-121">HTTP-Based conexões de proxy</span><span class="sxs-lookup"><span data-stu-id="3f0bf-121">HTTP-Based Proxy Connections</span></span>

<span data-ttu-id="3f0bf-122">Se nenhuma autenticação de servidor proxy for necessária, HTTP ou HTTPs poderá ser usado para transporte.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-122">If no proxy server authentication is required, either HTTP or HTTPs can be used for transport.</span></span> <span data-ttu-id="3f0bf-123">No entanto, as conexões baseadas em HTTP de um cliente WinRM para um servidor WinRM por meio de um servidor proxy podem ser problemáticas.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-123">However, HTTP-based connections from a WinRM client to a WinRM server through a proxy server can be problematic.</span></span>

<span data-ttu-id="3f0bf-124">Os seguintes problemas podem ser encontrados ao usar conexões baseadas em HTTP:</span><span class="sxs-lookup"><span data-stu-id="3f0bf-124">The following issues might be encountered when using HTTP-based connections:</span></span>

-   <span data-ttu-id="3f0bf-125">O servidor proxy não oferece suporte à autenticação baseada em conexão, o que pode fazer com que a autenticação no servidor de destino falhe com um erro de acesso negado.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-125">The proxy server does not support connection-based authentication, which can cause the authentication against the destination server to fail with an access denied error.</span></span>
-   <span data-ttu-id="3f0bf-126">Mais de um conjunto de credenciais é necessário para se conectar ao servidor de destino e ao servidor proxy.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-126">More than one set of credentials is needed to connect to the destination server and to the proxy server.</span></span>
-   <span data-ttu-id="3f0bf-127">Os servidores proxy baseados em HTTP podem não oferecer suporte à capacidade de manter as conexões baseadas em servidor e baseadas no cliente associadas.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-127">HTTP-based proxy servers might not support the ability to maintain the associated client-based and server-based connections.</span></span> <span data-ttu-id="3f0bf-128">Se o proxy não vincular fortemente um cliente a um servidor e manter a conexão TCP/IP, os clientes não autenticados poderão obter acesso aos dados.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-128">If the proxy does not strongly link a client to a server and maintain the TCP/IP connection, unauthenticated clients might gain access to data.</span></span> <span data-ttu-id="3f0bf-129">Além disso, a falta de afinidade de conexão pode fazer com que a autenticação falhe no servidor.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-129">Also, the lack of connection affinity might cause the authentication to fail against the server.</span></span>

<span data-ttu-id="3f0bf-130">Se HTTP deve ser usado como transporte, o servidor proxy deve dar suporte à configuração a seguir para obter uma resposta melhor do WinRM e evitar falhas de acesso negado para clientes WinRM:</span><span class="sxs-lookup"><span data-stu-id="3f0bf-130">If HTTP must be used as the transport, the proxy server should support the following configuration to achieve a better WinRM response and to prevent access denied failures for WinRM clients:</span></span>

-   <span data-ttu-id="3f0bf-131">Suporte para HTTP/1.1.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-131">Support for HTTP/1.1.</span></span> <span data-ttu-id="3f0bf-132">O HTTP/1.1 é mais estrito no mapeamento da afinidade de conexão entre o cliente e o servidor.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-132">HTTP/1.1 is more stringent in mapping connection affinity between client and server.</span></span>
-   <span data-ttu-id="3f0bf-133">Autenticação baseada em conexão para autenticação Negotiate, Kerberos e CredSSP.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-133">Connection-based authentication for Negotiate, Kerberos, and CredSSP authentication.</span></span>

    <span data-ttu-id="3f0bf-134">A autenticação de uma solicitação requer várias viagens de ida e volta entre o cliente e o servidor.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-134">Authentication of a request requires multiple round-trips between the client and server.</span></span> <span data-ttu-id="3f0bf-135">A maior parte da negociação para autenticação é concluída depois que o servidor de autenticação (WinRM) envia uma resposta ao cliente que não é uma resposta 401 (não autorizado).</span><span class="sxs-lookup"><span data-stu-id="3f0bf-135">Most negotiation for authentication is complete after the authenticating (WinRM) server sends a response to the client that is not a 401 response (Unauthorized).</span></span> <span data-ttu-id="3f0bf-136">Se o servidor WinRM retornar uma resposta ao cliente que não seja uma resposta 401, o proxy não deverá fechar a conexão.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-136">If the WinRM server returns a response to the client that is not a 401 response, the proxy should not close the connection.</span></span>

    <span data-ttu-id="3f0bf-137">Vários pares de solicitação/resposta podem ser enviados entre o cliente e o servidor antes que os dados reais do pacote sejam enviados.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-137">Multiple request/response pairs can be sent between client and server before the actual packet data is sent.</span></span> <span data-ttu-id="3f0bf-138">O WinRM 2,0 usa os esquemas de autenticação Negotiate e Kerberos com criptografia, o que pode adicionar viagens de ida e volta extras.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-138">WinRM 2.0 uses the Negotiate and Kerberos authentication schemes with encryption, which can add extra round-trips.</span></span> <span data-ttu-id="3f0bf-139">Os dados não podem ser enviados para o servidor até que a autenticação seja concluída.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-139">Data cannot be sent to the server until the authentication is complete.</span></span>

    <span data-ttu-id="3f0bf-140">O servidor WinRM retorna uma resposta de nível 200 que indica que a autenticação foi concluída.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-140">The WinRM server returns a 200-level response that indicates that the authentication is complete.</span></span> <span data-ttu-id="3f0bf-141">Os servidores proxy baseados em HTTP podem encerrar a afinidade de autenticação baseada em conexão e fechar a conexão TCP/IP depois de receber a resposta de nível 200 do servidor WinRM.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-141">HTTP-based proxy servers might end the connection-based authentication affinity and close the TCP/IP connection after receiving the 200-level response from the WinRM server.</span></span> <span data-ttu-id="3f0bf-142">A viagem de ida e volta do cliente para o servidor não inclui o pacote de solicitação original.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-142">The final round-trip from client to server does not include the original request packet.</span></span> <span data-ttu-id="3f0bf-143">Se o servidor proxy fechar a conexão, o servidor tentará autenticar novamente o cliente e a solicitação do cliente nunca poderá ser enviada ao servidor.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-143">If the proxy server closes the connection, the server will attempt to re-authenticate the client and the client request might never be sent to the server.</span></span> <span data-ttu-id="3f0bf-144">Se a afinidade baseada em conexão não for mantida, a autenticação no servidor de destino poderá falhar com um erro de acesso negado.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-144">If the connection-based affinity is not maintained, authentication against the destination server can fail with an access denied error.</span></span>

-   <span data-ttu-id="3f0bf-145">Persistência de conexão.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-145">Connection persistence.</span></span> <span data-ttu-id="3f0bf-146">A conexão TCP/IP do cliente com o proxy deve continuar a mapear para a mesma conexão TCP/IP do proxy para o servidor.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-146">The client TCP/IP connection to the proxy should continue to map to the same TCP/IP connection from the proxy to the server.</span></span> <span data-ttu-id="3f0bf-147">Manter essa conexão ajuda a atingir um nível mais alto de desempenho.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-147">Maintaining this connection helps to achieve a higher level of performance.</span></span> <span data-ttu-id="3f0bf-148">Se a conexão não for mantida, cada solicitação deverá ser autenticada novamente, o que pode afetar o desempenho.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-148">If the connection is not maintained, every request must be re-authenticated, which might affect performance.</span></span>

### <a name="encryption-and-winrm-20"></a><span data-ttu-id="3f0bf-149">Criptografia e WinRM 2,0</span><span class="sxs-lookup"><span data-stu-id="3f0bf-149">Encryption and WinRM 2.0</span></span>

<span data-ttu-id="3f0bf-150">O WinRM 2,0 dá suporte à criptografia via HTTP usando os esquemas de autenticação Negotiate, Kerberos e CredSSP.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-150">WinRM 2.0 supports encryption over HTTP by using the Negotiate, Kerberos, and CredSSP authentication schemes.</span></span> <span data-ttu-id="3f0bf-151">Se um servidor WinRM oferecer suporte a HTTP e for acessado por meio de um proxy, o servidor WinRM deverá impor a criptografia e não permitir o tráfego de rede não criptografado.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-151">If a WinRM server supports HTTP and is accessed through a proxy, the WinRM server must enforce encryption and not allow unencrypted network traffic.</span></span>

<span data-ttu-id="3f0bf-152">Sob nenhuma circunstância, as solicitações HTTP não criptografadas são enviadas por meio de servidores proxy.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-152">Under no circumstances should unencrypted HTTP requests be sent through proxy servers.</span></span> <span data-ttu-id="3f0bf-153">Quando os dados devem passar por um servidor proxy antes de serem enviados ao servidor de destino, os seguintes problemas de segurança são muito importantes:</span><span class="sxs-lookup"><span data-stu-id="3f0bf-153">When data must pass through a proxy server before being sent to the destination server, the following security issues are very important:</span></span>

-   <span data-ttu-id="3f0bf-154">É possível que um servidor proxy mal-intencionado possa examinar cada par de solicitação/resposta, incluindo as credenciais.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-154">It is possible that a malicious proxy server could examine every request/response pair, including credentials.</span></span>
-   <span data-ttu-id="3f0bf-155">Se as conexões TCP/IP não forem fortemente mapeadas entre o cliente WinRM e o servidor proxy e entre o servidor proxy e o servidor de destino, um cliente não autorizado poderá se conectar ao servidor de destino usando a mesma conexão autenticada do servidor proxy para o servidor de destino.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-155">If the TCP/IP connections are not strongly mapped between both the WinRM client and the proxy server and between the proxy server and the destination server, an unauthorized client could connect to the destination server by using the same authenticated connection from the proxy server to the destination server.</span></span> <span data-ttu-id="3f0bf-156">O servidor de destino pode permitir o acesso de cliente não autenticado aos dados.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-156">The destination server might allow the unauthenticated client access to data.</span></span> <span data-ttu-id="3f0bf-157">Se a criptografia for imposta, o servidor de destino enviará uma mensagem de acesso negado ao cliente não autenticado.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-157">If encryption is enforced, the destination server sends an access denied message to the unauthenticated client.</span></span>

<span data-ttu-id="3f0bf-158">O uso da criptografia atenua esses possíveis problemas de segurança.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-158">Using encryption would mitigate these potential security issues.</span></span>

## <a name="configuring-a-proxy-server-for-winrm-11-and-earlier"></a><span data-ttu-id="3f0bf-159">Configurando um servidor proxy para o WinRM 1,1 e anterior</span><span class="sxs-lookup"><span data-stu-id="3f0bf-159">Configuring a Proxy Server for WinRM 1.1 and Earlier</span></span>

<span data-ttu-id="3f0bf-160">Se um proxy for necessário para acessar o servidor WinRM, o cliente WinRM dependerá da configuração de proxy do WinHTTP (serviços HTTP do Windows).</span><span class="sxs-lookup"><span data-stu-id="3f0bf-160">If a proxy is required to reach the WinRM server, the WinRM client relies on the Windows HTTP services (WinHTTP) proxy configuration.</span></span> <span data-ttu-id="3f0bf-161">Por padrão, o WinHTTP não está configurado para usar um servidor proxy.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-161">By default, WinHTTP is not configured to use a proxy server.</span></span> <span data-ttu-id="3f0bf-162">A configuração de proxy WinHTTP pode ser alterada usando os utilitários de linha de comando [ProxyCfg.exe](/previous-versions/windows/desktop/ms761351(v=vs.85)) ou [netsh](/previous-versions/windows/it-pro/windows-server-2003/cc785383(v=ws.10)) .</span><span class="sxs-lookup"><span data-stu-id="3f0bf-162">WinHTTP proxy configuration can be changed by using the [ProxyCfg.exe](/previous-versions/windows/desktop/ms761351(v=vs.85)) or [netsh](/previous-versions/windows/it-pro/windows-server-2003/cc785383(v=ws.10)) command-line utilities.</span></span>

<span data-ttu-id="3f0bf-163">**WinRM 1,1 e anterior:** O WinRM não usa as configurações de proxy do Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="3f0bf-163">**WinRM 1.1 and Earlier:** WinRM does not use the Internet Explorer proxy settings.</span></span>

 

 