---
description: No COM+, cada objeto COM é criado com um contexto associado.
ms.assetid: e5602af2-5852-4c34-a792-6742e90b7d41
title: Ativação de contexto
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a652615d6c1288887085c857817e32e3a3b4081c
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104089371"
---
# <a name="context-activation"></a><span data-ttu-id="25e9d-103">Ativação de contexto</span><span class="sxs-lookup"><span data-stu-id="25e9d-103">Context Activation</span></span>

<span data-ttu-id="25e9d-104">No COM+, cada objeto COM é criado com um contexto associado.</span><span class="sxs-lookup"><span data-stu-id="25e9d-104">In COM+, every COM object is created with an associated context.</span></span> <span data-ttu-id="25e9d-105">Isso significa que um novo contexto deve ser criado e inicializado ou um contexto existente apropriado é usado.</span><span class="sxs-lookup"><span data-stu-id="25e9d-105">This means that either a new context must be created and initialized or an appropriate existing context is used.</span></span> <span data-ttu-id="25e9d-106">Esse processo é conhecido como *ativação*.</span><span class="sxs-lookup"><span data-stu-id="25e9d-106">This process is known as *activation*.</span></span> <span data-ttu-id="25e9d-107">No COM+, um objeto é ativado em seu próprio contexto ou no seu criador (um objeto que solicitou que o objeto fosse ativado — por exemplo, chamando [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance)).</span><span class="sxs-lookup"><span data-stu-id="25e9d-107">In COM+, an object is activated either in its own context or in that of its creator (an object that has requested that the object be activated—for example, by calling [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance)).</span></span>

<span data-ttu-id="25e9d-108">Em algumas circunstâncias, como com o [pool de objetos](com--object-pooling.md), um objeto é ativado sem ser criado do zero.</span><span class="sxs-lookup"><span data-stu-id="25e9d-108">In some circumstances, such as with [object pooling](com--object-pooling.md), an object is activated without being created from scratch.</span></span> <span data-ttu-id="25e9d-109">Nesse caso, uma instância em execução é ativada dentro de um contexto.</span><span class="sxs-lookup"><span data-stu-id="25e9d-109">In this case, a running instance is activated within a context.</span></span> <span data-ttu-id="25e9d-110">Ao longo de seu tempo de vida, ele pode ser ativado repetidamente em diferentes contextos.</span><span class="sxs-lookup"><span data-stu-id="25e9d-110">Over its lifetime, it may be repeatedly activated in different contexts.</span></span>

<span data-ttu-id="25e9d-111">O mecanismo básico é o mesmo em ambos os casos — um objeto é associado a um contexto e esse contexto é inicializado corretamente para representar as necessidades de tempo de execução do objeto.</span><span class="sxs-lookup"><span data-stu-id="25e9d-111">The basic mechanism is the same in either case—an object is associated with a context and that context is properly initialized to represent the run-time needs of the object.</span></span>

## <a name="flowing-of-context-properties"></a><span data-ttu-id="25e9d-112">Fluxo de propriedades de contexto</span><span class="sxs-lookup"><span data-stu-id="25e9d-112">Flowing of Context Properties</span></span>

<span data-ttu-id="25e9d-113">Quando um objeto está sendo ativado em resposta a uma solicitação de criação de outro objeto, o COM+ precisa se mediar entre eles para ativar corretamente o objeto downstream.</span><span class="sxs-lookup"><span data-stu-id="25e9d-113">When an object is being activated in response to a creation request from another object, COM+ needs to mediate between them to properly activate the downstream object.</span></span> <span data-ttu-id="25e9d-114">O COM+ precisa comparar o contexto do chamador com a configuração do componente chamado e, em seguida, decidir onde ativar o componente downstream e como inicializar suas propriedades de contexto.</span><span class="sxs-lookup"><span data-stu-id="25e9d-114">COM+ has to compare the context of the caller with the configuration of the called component and then decide where to activate the downstream component and how to initialize its context properties.</span></span>

<span data-ttu-id="25e9d-115">Para descobrir a configuração do componente, o COM+ o pesquisa no banco de dados de registro de classe COM+, que é otimizado para pesquisas extremamente rápidas em tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="25e9d-115">To discover the component's configuration, COM+ looks it up in the COM+ class registration database, which is optimized for extremely fast run-time lookups.</span></span> <span data-ttu-id="25e9d-116">(Isso é determinado pela maneira como você configurou um componente ao instalá-lo em um aplicativo COM+.) Em seguida, a configuração do componente é examinada em relação ao estado das propriedades de contexto do chamador.</span><span class="sxs-lookup"><span data-stu-id="25e9d-116">(This is determined by how you configured a component when installing it into a COM+ application.) The component's configuration is then examined against the state of the caller's context properties.</span></span>

<span data-ttu-id="25e9d-117">Em alguns casos, a configuração é consistente com o contexto do chamador e o componente pode ser ativado dentro do contexto do chamador.</span><span class="sxs-lookup"><span data-stu-id="25e9d-117">In some cases, the configuration is consistent with the context of the caller and the component can be activated within the caller's context.</span></span> <span data-ttu-id="25e9d-118">Isso só poderá ocorrer se o contexto do chamador satisfizer todos os requisitos de tempo de execução do novo objeto.</span><span class="sxs-lookup"><span data-stu-id="25e9d-118">This can happen only if the caller's context satisfies all the run-time requirements of the new object.</span></span>

<span data-ttu-id="25e9d-119">Quando o componente downstream não pode ser ativado dentro do contexto do chamador, ele é ativado em seu próprio contexto em um apartamento apropriado.</span><span class="sxs-lookup"><span data-stu-id="25e9d-119">When the downstream component cannot be activated within the caller's context, it is activated in its own context in an appropriate apartment.</span></span> <span data-ttu-id="25e9d-120">Quando isso ocorre, determinadas propriedades de contexto podem fluir do chamador para o receptor.</span><span class="sxs-lookup"><span data-stu-id="25e9d-120">When this occurs, certain context properties may flow from caller to callee.</span></span> <span data-ttu-id="25e9d-121">Por exemplo, se o chamador estiver associado a uma transação e o receptor der suporte a transações, o novo objeto obtém seu próprio contexto (para votar na transação, ele precisa ter seu próprio sinalizador consistente) e herda a ID da transação e a ID da atividade do chamador (que residem na mesma transação e no mesmo domínio de sincronização).</span><span class="sxs-lookup"><span data-stu-id="25e9d-121">For example, if the caller is associated with a transaction and the callee supports transactions, the new object gets its own context (to vote in the transaction, it needs to have its own consistent flag) and inherits the caller's transaction ID and activity ID (which reside within the same transaction and synchronization domain).</span></span>

## <a name="ignored-context-properties"></a><span data-ttu-id="25e9d-122">Propriedades de contexto ignoradas</span><span class="sxs-lookup"><span data-stu-id="25e9d-122">Ignored Context Properties</span></span>

<span data-ttu-id="25e9d-123">Dependendo de como um componente é configurado, algumas propriedades de contexto podem não desempenhar nenhuma função para determinar se ele está ativado no contexto do criador ou em seu próprio contexto.</span><span class="sxs-lookup"><span data-stu-id="25e9d-123">Depending on how a component is configured, some context properties may play no role in determining whether it is activated in the creator's context or its own context.</span></span> <span data-ttu-id="25e9d-124">Por exemplo, as configurações de transações desabilitadas e de sincronização desabilitadas, indicando a presença de uma transação ou de um domínio de sincronização, não desempenharão nenhuma função, seja na ativação do componente.</span><span class="sxs-lookup"><span data-stu-id="25e9d-124">For example, the Transactions Disabled and Synchronization Disabled settings, indicating the presence of a transaction or a synchronization domain, will play no role whatsoever in the component's activation.</span></span> <span data-ttu-id="25e9d-125">Essas propriedades são basicamente ignoradas quando o contexto é transmitido.</span><span class="sxs-lookup"><span data-stu-id="25e9d-125">These properties are fundamentally ignored when context is flowed.</span></span> <span data-ttu-id="25e9d-126">Ou, se um componente usar apenas a verificação de acesso no nível de processo, sua propriedade de contexto de segurança será ignorada — a configuração de segurança do componente nunca desempenhará uma função em sua ativação.</span><span class="sxs-lookup"><span data-stu-id="25e9d-126">Or if a component uses only process-level access checking, its security context property is ignored—the component's security configuration will never play a role in its activation.</span></span>

## <a name="forcing-activation-in-the-callers-context"></a><span data-ttu-id="25e9d-127">Forçando a ativação no contexto do chamador</span><span class="sxs-lookup"><span data-stu-id="25e9d-127">Forcing Activation in the Caller's Context</span></span>

<span data-ttu-id="25e9d-128">Em algumas circunstâncias, talvez você queira que um objeto seja ativado somente no contexto do chamador, ou seja, nunca é ativado em seu próprio contexto.</span><span class="sxs-lookup"><span data-stu-id="25e9d-128">In some circumstances, you might want an object to be activated only in its caller's context—that is, never activated in its own context.</span></span> <span data-ttu-id="25e9d-129">Por exemplo, talvez você queira controlar o comportamento do objeto quando ele é chamado em um limite de contexto.</span><span class="sxs-lookup"><span data-stu-id="25e9d-129">For example, you might want to control the object's behavior when it's called across a context boundary.</span></span>

<span data-ttu-id="25e9d-130">Você pode garantir que um objeto não possa ser ativado em seu próprio contexto, selecionando a opção de **contexto deve ser ativado em chamadores** na guia **ativação** da página **Propriedades** do componente, usando a ferramenta administrativa serviços de componentes.</span><span class="sxs-lookup"><span data-stu-id="25e9d-130">You can ensure that an object cannot be activated in its own context by selecting the **Must be activated in callers context** option on the **Activation** tab of the component **Properties** page, using the Component Services administrative tool.</span></span> <span data-ttu-id="25e9d-131">(Consulte [impondo a ativação no contexto do chamador](enforcing-activation-in-the-caller-s-context.md) para obter instruções passo a passo.) Quando você seleciona essa opção, se o objeto não puder ser ativado no contexto do chamador, [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) falhará, retornando co \_ E \_ tentar \_ \_ criar \_ fora do contexto do \_ cliente \_ .</span><span class="sxs-lookup"><span data-stu-id="25e9d-131">(See [Enforcing Activation in the Caller's Context](enforcing-activation-in-the-caller-s-context.md) for step-by-step instructions.) When you select this option, if the object cannot be activated in the caller's context, [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) fails, returning CO\_E\_ATTEMPT\_TO\_CREATE\_OUTSIDE\_CLIENT\_CONTEXT.</span></span>

## <a name="default-context"></a><span data-ttu-id="25e9d-132">Contexto padrão</span><span class="sxs-lookup"><span data-stu-id="25e9d-132">Default Context</span></span>

<span data-ttu-id="25e9d-133">Há contextos padrão para dar suporte a componentes não configurados, ou seja, componentes COM não instalados em aplicativos COM+ e não registrados no banco de dados de registro de classe COM+.</span><span class="sxs-lookup"><span data-stu-id="25e9d-133">Default contexts exist to support unconfigured components—that is, COM components not installed in COM+ applications and not registered in the COM+ class registration database.</span></span> <span data-ttu-id="25e9d-134">Se os componentes não configurados tiverem um modelo de Threading compatível, eles serão ativados no contexto do chamador.</span><span class="sxs-lookup"><span data-stu-id="25e9d-134">If unconfigured components have a compatible threading model, they are activated in the caller's context.</span></span> <span data-ttu-id="25e9d-135">Caso contrário, eles serão ativados em um contexto padrão no apartamento apropriado.</span><span class="sxs-lookup"><span data-stu-id="25e9d-135">Otherwise, they are activated in a default context in the appropriate apartment.</span></span> <span data-ttu-id="25e9d-136">Cada apartamento tem um contexto padrão para dar suporte a objetos COM que não usam serviços COM+.</span><span class="sxs-lookup"><span data-stu-id="25e9d-136">Each apartment has a default context to support COM objects that do not use COM+ services.</span></span>

## <a name="hooking-activation"></a><span data-ttu-id="25e9d-137">Conectando a ativação</span><span class="sxs-lookup"><span data-stu-id="25e9d-137">Hooking Activation</span></span>

<span data-ttu-id="25e9d-138">Ao implementar [**controledeobjetoi:: Activate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-activate) e [**controledeobjetoi::D eactivate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-deactivate), você pode conectar a ativação e desativação em conjunto para executar a inicialização especial no novo contexto.</span><span class="sxs-lookup"><span data-stu-id="25e9d-138">By implementing [**IObjectControl::Activate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-activate) and [**IObjectControl::Deactivate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-deactivate), you can hook activation and deactivation together to perform special initialization in the new context.</span></span> <span data-ttu-id="25e9d-139">Esses métodos são chamados pelo COM+ em determinados pontos do ciclo de vida de um objeto, quando o objeto é configurado para usar a ativação JIT ou o pool de objetos.</span><span class="sxs-lookup"><span data-stu-id="25e9d-139">These methods are called by COM+ at certain points in an object's lifecycle, when the object is configured to use JIT-activation or object pooling.</span></span> <span data-ttu-id="25e9d-140">Consulte [ativação Just-in-time com+](com--just-in-time-activation.md) e [pool de objetos com+](com--object-pooling.md) para obter mais detalhes.</span><span class="sxs-lookup"><span data-stu-id="25e9d-140">See [COM+ Just-in-Time Activation](com--just-in-time-activation.md) and [COM+ Object Pooling](com--object-pooling.md) for more detail.</span></span>

## <a name="related-topics"></a><span data-ttu-id="25e9d-141">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="25e9d-141">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="25e9d-142">Interceptação de chamadas de contexto cruzado</span><span class="sxs-lookup"><span data-stu-id="25e9d-142">Interception of Cross-Context Calls</span></span>](interception-of-cross-context-calls.md)
</dt> </dl>

 

 
