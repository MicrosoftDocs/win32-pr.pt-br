---
description: Falhas de Client-Side persistentes
ms.assetid: f991db71-8319-414d-8a25-2d02bc7c8b51
title: Falhas de Client-Side persistentes
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 25d303e712257d62e4ae42497cb4463e782cfbb8
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104370444"
---
# <a name="persistent-client-side-failures"></a><span data-ttu-id="0add0-103">Falhas de Client-Side persistentes</span><span class="sxs-lookup"><span data-stu-id="0add0-103">Persistent Client-Side Failures</span></span>

<span data-ttu-id="0add0-104">Em alguns casos, o [enfileiramento de mensagens](/previous-versions/windows/desktop/legacy/ms711472(v=vs.85)) pode mover uma mensagem para a fila de destino.</span><span class="sxs-lookup"><span data-stu-id="0add0-104">In some cases, [Message Queuing](/previous-versions/windows/desktop/legacy/ms711472(v=vs.85)) can move a message to the destination queue.</span></span> <span data-ttu-id="0add0-105">Por exemplo, se os controles de acesso à fila não permitirem que a mensagem seja movida do cliente para o servidor, a mensagem incorreta será movida para a fila de mensagens mortas do lado do cliente.</span><span class="sxs-lookup"><span data-stu-id="0add0-105">For example, if the queue access controls do not permit the message to be moved from client to server, the offending message is moved to the client-side dead letter queue.</span></span> <span data-ttu-id="0add0-106">Quando isso ocorre, o serviço de componentes em fila do COM+ permite que uma classe de exceção seja associada a um componente.</span><span class="sxs-lookup"><span data-stu-id="0add0-106">When this occurs, the COM+ queued components service allows an exception class to be associated with a component.</span></span> <span data-ttu-id="0add0-107">Para associar a classe de exceção ao componente, use a guia **avançado** na página Propriedades do componente da ferramenta de administração de serviços de componentes.</span><span class="sxs-lookup"><span data-stu-id="0add0-107">To associate the exception class with the component, use the **Advanced** tab in the component properties page of the Component Services administration tool.</span></span> <span data-ttu-id="0add0-108">Você também pode associar a classe de exceção programaticamente, usando o atributo de componente de catálogo ExceptionClass das funções administrativas do COM+.</span><span class="sxs-lookup"><span data-stu-id="0add0-108">You can also associate the exception class programmatically, by using the ExceptionClass catalog component attribute of the COM+ Administrative functions.</span></span>

<span data-ttu-id="0add0-109">A classe de exceção é definida como o ProgID ou o CLSID de um componente que implementa [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol).</span><span class="sxs-lookup"><span data-stu-id="0add0-109">The exception class is defined as either the ProgID or the CLSID of a component implementing [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol).</span></span> <span data-ttu-id="0add0-110">O serviço de componentes em fila tem um monitor de fila de mensagens mortas que verifica a fila de mensagens mortas de transação.</span><span class="sxs-lookup"><span data-stu-id="0add0-110">The queued components service has a dead letter queue monitor that scans the Xact dead letter queue.</span></span> <span data-ttu-id="0add0-111">Se houver uma mensagem na fila, o monitor da fila de mensagens mortas criará uma instância do manipulador de exceção associado ao componente de destino e chamará [**IPlaybackControl:: FinalClientRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry), indicando que houve um erro irrecuperável no lado do cliente.</span><span class="sxs-lookup"><span data-stu-id="0add0-111">If there is a message on the queue, the dead letter queue monitor instantiates the exception handler associated with the target component and calls [**IPlaybackControl::FinalClientRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry), indicating that there has been a client-side, unrecoverable error.</span></span>

<span data-ttu-id="0add0-112">Além de [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol), o manipulador de exceção deve implementar o mesmo conjunto de interfaces que o componente de servidor para o qual está tratando exceções.</span><span class="sxs-lookup"><span data-stu-id="0add0-112">In addition to [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol), the exception handler should implement the same set of interfaces as the server component for which it is handling exceptions.</span></span> <span data-ttu-id="0add0-113">Quando [**IPlaybackControl:: FinalClientRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry) é chamado, o tempo de execução dos componentes em fila reproduz a mensagem com falha para o manipulador de exceção.</span><span class="sxs-lookup"><span data-stu-id="0add0-113">When [**IPlaybackControl::FinalClientRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry) is called, the queued components run-time plays back the failing message to the exception handler.</span></span> <span data-ttu-id="0add0-114">Isso permite que o manipulador de exceção implemente um comportamento alternativo para mensagens que não podem ser movidas para o servidor — por exemplo, gerando uma transação de compensação.</span><span class="sxs-lookup"><span data-stu-id="0add0-114">This allows the exception handler to implement an alternative behavior for messages that cannot be moved to the server—for example, by generating a compensating transaction.</span></span>

<span data-ttu-id="0add0-115">Se o manipulador de exceção concluir todas as chamadas de método reproduzidas, a mensagem será removida da fila de mensagens mortas de transação e será ignorada.</span><span class="sxs-lookup"><span data-stu-id="0add0-115">If the exception handler completes all the method calls played back, the message is removed from the Xact dead letter queue and is dismissed.</span></span> <span data-ttu-id="0add0-116">No entanto, se o manipulador de exceção abortar a mensagem retornando um status de falha de uma das chamadas de método, a mensagem será retornada para a fila de mensagens mortas de transação.</span><span class="sxs-lookup"><span data-stu-id="0add0-116">If, however, the exception handler aborts the message by returning a failure status from one of the method calls, the message is returned to the Xact dead letter queue.</span></span> <span data-ttu-id="0add0-117">A sequência de eventos a seguir mostra como as exceções do lado do cliente são tratadas:</span><span class="sxs-lookup"><span data-stu-id="0add0-117">The following sequence of events shows how client-side exceptions are handled:</span></span>

1.  <span data-ttu-id="0add0-118">O serviço de enfileiramento de mensagens não entrega uma mensagem ao servidor e coloca a mensagem na fila de mensagens mortas da transação.</span><span class="sxs-lookup"><span data-stu-id="0add0-118">Message Queuing fails to deliver a message to the server and puts the message onto the Xact dead letter queue.</span></span>
2.  <span data-ttu-id="0add0-119">O ouvinte da fila de mensagens mortas (DLQL) localiza uma mensagem na fila de mensagens mortas do transação.</span><span class="sxs-lookup"><span data-stu-id="0add0-119">The dead letter queue listener (DLQL) finds a message on the Xact dead letter queue.</span></span>
3.  <span data-ttu-id="0add0-120">O DLQL recupera o CLSID do componente de destino da mensagem e verifica se há uma classe de exceção.</span><span class="sxs-lookup"><span data-stu-id="0add0-120">The DLQL retrieves the target component CLSID from the message and checks for an exception class.</span></span>
4.  <span data-ttu-id="0add0-121">O DLQL instancia a classe de exceção.</span><span class="sxs-lookup"><span data-stu-id="0add0-121">The DLQL instantiates the exception class.</span></span>
5.  <span data-ttu-id="0add0-122">O DLQL consulta [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol) para a classe de exceção.</span><span class="sxs-lookup"><span data-stu-id="0add0-122">The DLQL queries for [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol) for the exception class.</span></span>
6.  <span data-ttu-id="0add0-123">O DLQL chama o método [**IPlaybackControl:: FinalClientRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry) na classe de exceção.</span><span class="sxs-lookup"><span data-stu-id="0add0-123">The DLQL calls the [**IPlaybackControl::FinalClientRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry) method in the exception class.</span></span>
7.  <span data-ttu-id="0add0-124">O DLQL reproduz todas as chamadas de propriedade e método da mensagem para a classe de exceção.</span><span class="sxs-lookup"><span data-stu-id="0add0-124">The DLQL plays back all property and method calls from the message to the exception class.</span></span>
8.  <span data-ttu-id="0add0-125">O DLQL excluirá a mensagem se o manipulador de exceção concluir a transação com êxito.</span><span class="sxs-lookup"><span data-stu-id="0add0-125">The DLQL deletes the message if the exception handler completes the transaction successfully.</span></span> <span data-ttu-id="0add0-126">O manipulador de exceção pode emitir [**IObjectContext:: SetAbort**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setabort)e a mensagem permanecerá na fila de mensagens mortas.</span><span class="sxs-lookup"><span data-stu-id="0add0-126">The exception handler may issue [**IObjectContext::SetAbort**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setabort), and the message will remain on the dead letter queue.</span></span>

<span data-ttu-id="0add0-127">Se qualquer uma das etapas anteriores falhar, a mensagem será deixada na fila de mensagens mortas da transação.</span><span class="sxs-lookup"><span data-stu-id="0add0-127">If any of the preceding steps fail, the message is left on the Xact dead letter queue.</span></span>

<span data-ttu-id="0add0-128">Quando iniciado, o DLQL lê cada mensagem na fila de mensagens mortas transacionais de enfileiramento de mensagem e instancia a classe de exceção para cada mensagem de componentes na fila.</span><span class="sxs-lookup"><span data-stu-id="0add0-128">When started, the DLQL reads each message on the Message Queuing transactional dead letter queue and instantiates the exception class for each queued components message.</span></span> <span data-ttu-id="0add0-129">Depois de uma passagem pela fila, ela aguarda novas mensagens.</span><span class="sxs-lookup"><span data-stu-id="0add0-129">After one pass through the queue, it waits for new messages.</span></span> <span data-ttu-id="0add0-130">Em seguida, ele processa cada nova mensagem de fila de mensagens mortas à medida que chega.</span><span class="sxs-lookup"><span data-stu-id="0add0-130">It then processes each new dead letter queue message as it arrives.</span></span>

<span data-ttu-id="0add0-131">Se você precisar intervir no processo descrito aqui ou se precisar mover uma mensagem suspeita para fora de sua fila de repouso final, use o utilitário de movimentação de mensagem.</span><span class="sxs-lookup"><span data-stu-id="0add0-131">If you need to intervene in the process described here or if you need to move a poison message out of its final resting queue, use the message mover utility.</span></span> <span data-ttu-id="0add0-132">Para obter mais informações sobre o utilitário de movimentação de mensagens, consulte [tratamento de erros](handling-errors-in-queued-components.md).</span><span class="sxs-lookup"><span data-stu-id="0add0-132">For more information on the message mover utility, see [Handling Errors](handling-errors-in-queued-components.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="0add0-133">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="0add0-133">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="0add0-134">Erros do lado do cliente</span><span class="sxs-lookup"><span data-stu-id="0add0-134">Client-Side Errors</span></span>](client-side-errors.md)
</dt> <dt>

[<span data-ttu-id="0add0-135">Erros do lado do servidor</span><span class="sxs-lookup"><span data-stu-id="0add0-135">Server-Side Errors</span></span>](server-side-errors.md)
</dt> </dl>

 

 



