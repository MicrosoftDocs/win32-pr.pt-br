---
description: Este tópico identifica várias estratégias de tratamento de erros para ter em mente ao desenvolver componentes para COM+.
ms.assetid: 1ae5875b-8085-44f2-9071-c2a5d7543ac1
title: Estratégias para lidar com erros no COM+
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 91ca64546683fa45ac8df3bcb47534d8de482798
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105781316"
---
# <a name="strategies-for-handling-errors-in-com"></a><span data-ttu-id="2fb6e-103">Estratégias para lidar com erros no COM+</span><span class="sxs-lookup"><span data-stu-id="2fb6e-103">Strategies for Handling Errors in COM+</span></span>

<span data-ttu-id="2fb6e-104">Este tópico identifica várias estratégias de tratamento de erros para ter em mente ao desenvolver componentes para COM+.</span><span class="sxs-lookup"><span data-stu-id="2fb6e-104">This topic identifies several error-handling strategies to keep in mind as you develop components for COM+.</span></span>

-   <span data-ttu-id="2fb6e-105">**Retornar um valor HRESULT para todos os métodos em todas as interfaces de componente.**</span><span class="sxs-lookup"><span data-stu-id="2fb6e-105">**Return an HRESULT value for all methods in all component interfaces.**</span></span>  <span data-ttu-id="2fb6e-106">O COM+ usa valores **HRESULT** para relatar erros na realização de chamadas de função ou chamadas de método de interface.</span><span class="sxs-lookup"><span data-stu-id="2fb6e-106">COM+ uses **HRESULT** values to report on any errors in making function calls or interface method calls.</span></span> <span data-ttu-id="2fb6e-107">Um **HRESULT** indica se um método teve êxito ou falhou e identifica o recurso associado ao erro, como RPC, Win32 ou ITF para erros específicos da interface.</span><span class="sxs-lookup"><span data-stu-id="2fb6e-107">An **HRESULT** indicates whether a method succeeded or failed and identifies the facility associated with the error, such as RPC, WIN32, or ITF for interface-specific errors.</span></span> <span data-ttu-id="2fb6e-108">Além disso, as APIs do sistema fornecem uma pesquisa de um **HRESULT** para uma cadeia de caracteres que descreve a condição de erro.</span><span class="sxs-lookup"><span data-stu-id="2fb6e-108">Also, system APIs provide a lookup from an **HRESULT** to a string that describes the error condition.</span></span> <span data-ttu-id="2fb6e-109">Usar métodos que retornam valores **HRESULT** é fundamental para componentes bem escritos e é essencial para o processo de depuração.</span><span class="sxs-lookup"><span data-stu-id="2fb6e-109">Using methods that return **HRESULT** values are fundamental to well-written components and are essential to the debugging process.</span></span> <span data-ttu-id="2fb6e-110">O Microsoft Visual Basic define automaticamente cada método com um **HRESULT** como um retorno.</span><span class="sxs-lookup"><span data-stu-id="2fb6e-110">Microsoft Visual Basic automatically defines each method with an **HRESULT** as a return.</span></span> <span data-ttu-id="2fb6e-111">No Microsoft Visual C++, você deve retornar explicitamente um **HRESULT**.</span><span class="sxs-lookup"><span data-stu-id="2fb6e-111">In Microsoft Visual C++, you must explicitly return an **HRESULT**.</span></span> <span data-ttu-id="2fb6e-112">Para obter informações adicionais sobre HRESULTs, consulte [estrutura de códigos de erro com](/windows/desktop/com/structure-of-com-error-codes).</span><span class="sxs-lookup"><span data-stu-id="2fb6e-112">For additional information on HRESULTs, see [Structure of COM Error Codes](/windows/desktop/com/structure-of-com-error-codes).</span></span>
-   <span data-ttu-id="2fb6e-113">**Inicie o objeto da coleção ErrorInfo por qualquer que seja o que a ferramenta de desenvolvimento fornece.**</span><span class="sxs-lookup"><span data-stu-id="2fb6e-113">**Initiate the ErrorInfo collection object by whatever means your development tool provides.**</span></span> <span data-ttu-id="2fb6e-114">Os objetos de coleção [**errorInfo**](errorinfo.md) geralmente são chamados de exceções com porque permitem que um objeto passe (ou lance) informações de erro avançadas para seu chamador, mesmo entre limites de apartamento.</span><span class="sxs-lookup"><span data-stu-id="2fb6e-114">[**ErrorInfo**](errorinfo.md) collection objects are often called COM exceptions because they allow an object to pass (or throw) rich error information to its caller, even across apartment boundaries.</span></span> <span data-ttu-id="2fb6e-115">O valor desse objeto de erro genérico é que ele complementa um HRESULT, estendendo o tipo de informações de erro que você pode retornar a um chamador.</span><span class="sxs-lookup"><span data-stu-id="2fb6e-115">The value of this generic error object is that it supplements an HRESULT, extending the type of error information that you can return to a caller.</span></span> <span data-ttu-id="2fb6e-116">Cada objeto da coleção **errorInfo** retorna uma descrição contextual, a origem do erro e o identificador da interface do método que originou o erro.</span><span class="sxs-lookup"><span data-stu-id="2fb6e-116">Each **ErrorInfo** collection object returns a contextual description, the source of the error, and the interface identifier of the method that originated the error.</span></span> <span data-ttu-id="2fb6e-117">Você também pode incluir ponteiros para uma entrada em um arquivo de ajuda.</span><span class="sxs-lookup"><span data-stu-id="2fb6e-117">You can also include pointers to an entry in a help file.</span></span> <span data-ttu-id="2fb6e-118">A automação fornece três interfaces para gerenciar o objeto de erro.</span><span class="sxs-lookup"><span data-stu-id="2fb6e-118">Automation provides three interfaces to manage the error object.</span></span> <span data-ttu-id="2fb6e-119">Seu componente deve implementar a interface de automação **ISupportErrorInfo** para anunciar seu suporte para a coleção **errorInfo** .</span><span class="sxs-lookup"><span data-stu-id="2fb6e-119">Your component must implement the **ISupportErrorInfo** Automation interface to advertise its support for the **ErrorInfo** collection.</span></span> <span data-ttu-id="2fb6e-120">Quando ocorre um erro, o componente usa a interface de automação **ICreateErrorInfo** para inicializar um objeto de erro.</span><span class="sxs-lookup"><span data-stu-id="2fb6e-120">When an error occurs, the component uses the **ICreateErrorInfo** Automation interface to initialize an error object.</span></span> <span data-ttu-id="2fb6e-121">Depois que o chamador inspeciona o HRESULT e descobre que a chamada do método falhou, ele consulta o objeto para ver se ele dá suporte à coleção **errorInfo** .</span><span class="sxs-lookup"><span data-stu-id="2fb6e-121">After the caller inspects the HRESULT and finds that the method call failed, it queries the object to see whether it supports the **ErrorInfo** collection.</span></span> <span data-ttu-id="2fb6e-122">Se tiver, o chamador usará a interface de automação **IErrorInfo** para recuperar as informações de erro.</span><span class="sxs-lookup"><span data-stu-id="2fb6e-122">If it does, the caller uses the **IErrorInfo** Automation interface to retrieve the error information.</span></span> <span data-ttu-id="2fb6e-123">Visual Basic programadores têm acesso fácil ao objeto de coleção **errorInfo** , que é exposto por meio do objeto Err.</span><span class="sxs-lookup"><span data-stu-id="2fb6e-123">Visual Basic programmers have easy access to the **ErrorInfo** collection object, which is exposed through the Err object.</span></span> <span data-ttu-id="2fb6e-124">Você pode gerar erros com a função de aumento de Err e capturar erros com a instrução **On Error** .</span><span class="sxs-lookup"><span data-stu-id="2fb6e-124">You can raise errors with the Err Raise function and catch errors with the **On Error** statement.</span></span> <span data-ttu-id="2fb6e-125">A camada de tempo de execução Visual Basic cuida do mapeamento para você.</span><span class="sxs-lookup"><span data-stu-id="2fb6e-125">The Visual Basic run-time layer takes care of the mapping for you.</span></span> <span data-ttu-id="2fb6e-126">Se você estiver usando o suporte ao compilador COM do Visual C++, você poderá usar a \_ \_ classe Error de elevação com \_ para relatar um erro e a \_ classe de \_ erro com para recuperar informações de erro.</span><span class="sxs-lookup"><span data-stu-id="2fb6e-126">If you are using the Visual C++ COM compiler support, you can use the \_com\_raise\_error class to report an error and the \_com\_error class to retrieve error information.</span></span> <span data-ttu-id="2fb6e-127">O COM+ não propagará as exceções C++ tradicionais como informações de **IErrorInfo** estendidas.</span><span class="sxs-lookup"><span data-stu-id="2fb6e-127">COM+ will not propagate traditional C++ exceptions as extended **IErrorInfo** information.</span></span> <span data-ttu-id="2fb6e-128">Para obter informações adicionais sobre o objeto da coleção **errorInfo** , consulte "tratamento de erros" no guia de automação.</span><span class="sxs-lookup"><span data-stu-id="2fb6e-128">For additional information on the **ErrorInfo** collection object, see "Error Handling" in the Automation guide.</span></span>
    > [!Note]  
    > <span data-ttu-id="2fb6e-129">COM requer que todos os objetos de coleção [**errorInfo**](errorinfo.md) sejam empacotados por valor, implicando que os componentes que implementam a interface de automação **IErrorInfo** também devem implementar e dar suporte à interface [**IMarshal**](/windows/desktop/api/objidl/nn-objidl-imarshal) .</span><span class="sxs-lookup"><span data-stu-id="2fb6e-129">COM requires that all [**ErrorInfo**](errorinfo.md) collection objects marshal by value, implying that components that implement the **IErrorInfo** Automation interface must also implement and support the [**IMarshal**](/windows/desktop/api/objidl/nn-objidl-imarshal) interface.</span></span> <span data-ttu-id="2fb6e-130">A implementação da interface **IMarshal** deve dar suporte a marshaling por valor para o componente.</span><span class="sxs-lookup"><span data-stu-id="2fb6e-130">The **IMarshal** interface implementation must support marshal by value for the component.</span></span>

     

-   <span data-ttu-id="2fb6e-131">**Use transações para gerenciar falhas de recursos compartilhados.**</span><span class="sxs-lookup"><span data-stu-id="2fb6e-131">**Use transactions to manage shared resource failures.**</span></span> <span data-ttu-id="2fb6e-132">As transações automáticas podem reduzir significativamente a quantidade de código de tratamento de erros que você deve escrever ao usar gerenciadores de recursos gerenciados por Estado.</span><span class="sxs-lookup"><span data-stu-id="2fb6e-132">Automatic transactions can significantly reduce the amount of error-handling code you must write when using state-managed resource managers.</span></span> <span data-ttu-id="2fb6e-133">No entanto, as transações não eliminam a necessidade de tratamento de erros completamente.</span><span class="sxs-lookup"><span data-stu-id="2fb6e-133">However, transactions do not eliminate the need for error handling altogether.</span></span> <span data-ttu-id="2fb6e-134">Você ainda precisa retornar códigos de erro de seus métodos de interface e verificar esses códigos de erro no chamador para evitar o trabalho desnecessário para uma transação destinada.</span><span class="sxs-lookup"><span data-stu-id="2fb6e-134">You still need to return error codes from your interface methods and check those error codes within the caller to avoid doing unnecessary work for a doomed transaction.</span></span> <span data-ttu-id="2fb6e-135">Para obter informações adicionais sobre como combinar o tratamento de erros com o processamento de transações, consulte [acelerando as transações notificando o objeto raiz](speeding-transactions-by-notifying-the-root-object.md).</span><span class="sxs-lookup"><span data-stu-id="2fb6e-135">For additional information about combining error handling with transaction processing, see [Speeding Transactions by Notifying the Root Object](speeding-transactions-by-notifying-the-root-object.md).</span></span>
-   <span data-ttu-id="2fb6e-136">**Gerar erros explicitamente.**</span><span class="sxs-lookup"><span data-stu-id="2fb6e-136">**Raise errors explicitly.**</span></span> <span data-ttu-id="2fb6e-137">Evite permitir que informações de erro deixem um objeto, a menos que o objeto gere explicitamente o erro.</span><span class="sxs-lookup"><span data-stu-id="2fb6e-137">Avoid letting error information leave an object unless the object explicitly raises the error.</span></span> <span data-ttu-id="2fb6e-138">Pegue todos os erros gerados pela ferramenta e manipule-os no código do componente.</span><span class="sxs-lookup"><span data-stu-id="2fb6e-138">Catch all tool-generated errors and handle them in your component code.</span></span> <span data-ttu-id="2fb6e-139">Na pior das hipóteses, inclua um manipulador padrão para relatar erros inesperados de maneira consistente.</span><span class="sxs-lookup"><span data-stu-id="2fb6e-139">At the very least, include a standard handler to report unexpected errors in a consistent manner.</span></span>
-   <span data-ttu-id="2fb6e-140">**Use o \_ intervalo ITF de erros para relatar erros específicos da interface.**</span><span class="sxs-lookup"><span data-stu-id="2fb6e-140">**Use the FACILITY\_ITF range of errors to report interface-specific errors.**</span></span> <span data-ttu-id="2fb6e-141">Os erros específicos da interface devem estar no \_ intervalo de erros ITF, entre 0x0200 e 0xFFFF.</span><span class="sxs-lookup"><span data-stu-id="2fb6e-141">Interface-specific errors should be in the FACILITY\_ITF range of errors, between 0x0200 and 0xFFFF.</span></span> <span data-ttu-id="2fb6e-142">Você pode definir um código de erro personalizado em Visual Basic como um deslocamento de vbObjectError.</span><span class="sxs-lookup"><span data-stu-id="2fb6e-142">You can define a custom error code in Visual Basic as an offset from vbObjectError.</span></span> <span data-ttu-id="2fb6e-143">Use a \_ macro Make HRESULT em C++ para introduzir um código de erro específico da interface, conforme mostrado no exemplo a seguir:</span><span class="sxs-lookup"><span data-stu-id="2fb6e-143">Use the MAKE\_HRESULT macro in C++ to introduce an interface-specific error code, as shown in the following example:</span></span>

    ``` syntax
    const HRESULT ERROR_NUMBER = MAKE_HRESULT (SEVERITY_ERROR, FACILITY_ITF, 10);
    ```

## <a name="related-topics"></a><span data-ttu-id="2fb6e-144">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="2fb6e-144">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="2fb6e-145">Política de FailFast e isolamento de falhas</span><span class="sxs-lookup"><span data-stu-id="2fb6e-145">Fault Isolation and Failfast Policy</span></span>](fault-isolation-and-failfast-policy.md)
</dt> <dt>

[<span data-ttu-id="2fb6e-146">Localizando a origem de um erro</span><span class="sxs-lookup"><span data-stu-id="2fb6e-146">Finding the Source of an Error</span></span>](finding-the-source-of-an-error.md)
</dt> <dt>

[<span data-ttu-id="2fb6e-147">Como o COM+ modifica valores de retorno</span><span class="sxs-lookup"><span data-stu-id="2fb6e-147">How COM+ Modifies Return Values</span></span>](how-com--modifies-return-values.md)
</dt> <dt>

[<span data-ttu-id="2fb6e-148">Interpretando códigos de erro</span><span class="sxs-lookup"><span data-stu-id="2fb6e-148">Interpreting Error Codes</span></span>](interpreting-error-codes.md)
</dt> <dt>

[<span data-ttu-id="2fb6e-149">Solução de problemas</span><span class="sxs-lookup"><span data-stu-id="2fb6e-149">Troubleshooting</span></span>](troubleshooting.md)
</dt> </dl>

 

 
