---
description: Em algumas circunstâncias, um aplicativo de servidor precisa apresentar uma identidade de clientes aos recursos que ele acessa nos clientes, geralmente para fazer com que as verificações de acesso ou a autenticação sejam executadas em relação à identidade dos clientes.
ms.assetid: fd75eb54-eefe-411f-a7aa-0bc8628f8778
title: Representação e delegação de cliente
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7557dcde4cadf559dd8e116cf4e7bece4221aaae
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105780907"
---
# <a name="client-impersonation-and-delegation"></a><span data-ttu-id="488df-103">Representação e delegação de cliente</span><span class="sxs-lookup"><span data-stu-id="488df-103">Client Impersonation and Delegation</span></span>

<span data-ttu-id="488df-104">Em algumas circunstâncias, um aplicativo de servidor precisa apresentar a identidade de um cliente aos recursos que ele acessa em nome do cliente, geralmente para fazer com que as verificações de acesso ou a autenticação sejam executadas em relação à identidade do cliente.</span><span class="sxs-lookup"><span data-stu-id="488df-104">In some circumstances, a server application needs to present a client's identity to resources it accesses on the client's behalf, usually to cause access checks or authentication to be performed against the client's identity.</span></span> <span data-ttu-id="488df-105">Até certo ponto, o servidor pode agir sob a identidade do cliente — uma ação conhecida como representando o cliente.</span><span class="sxs-lookup"><span data-stu-id="488df-105">To a certain extent, the server can act under the client's identity—an action referred to as impersonating the client.</span></span>

<span data-ttu-id="488df-106">*Representação* é a capacidade de execução de um thread em um contexto de segurança diferente daquele do processo que possui o thread.</span><span class="sxs-lookup"><span data-stu-id="488df-106">*Impersonation* is the ability of a thread to execute in a security context different from that of the process owning the thread.</span></span> <span data-ttu-id="488df-107">O thread do servidor usa um token de acesso que representa as credenciais do cliente e, com isso, ele pode acessar recursos que o cliente pode acessar.</span><span class="sxs-lookup"><span data-stu-id="488df-107">The server thread uses an access token representing the client's credentials, and with this, it can access resources that the client can access.</span></span>

<span data-ttu-id="488df-108">O uso da representação garante que o servidor possa fazer exatamente o que o cliente pode fazer.</span><span class="sxs-lookup"><span data-stu-id="488df-108">Using impersonation ensures that the server can do precisely what the client can do.</span></span> <span data-ttu-id="488df-109">O acesso aos recursos pode ser restrito ou expandido, dependendo do que o cliente tem permissão para fazer.</span><span class="sxs-lookup"><span data-stu-id="488df-109">Access to resources may be either restricted or expanded, depending on what the client has permission to do.</span></span>

<span data-ttu-id="488df-110">Você pode optar por fazer com que um servidor represente um cliente ao se conectar a um banco de dados para que o banco de dados possa autenticar e autorizar o cliente para si mesmo.</span><span class="sxs-lookup"><span data-stu-id="488df-110">You might choose to have a server impersonate a client when connecting to a database so that the database can authenticate and authorize the client for itself.</span></span> <span data-ttu-id="488df-111">Ou, se seu aplicativo acessar arquivos que são protegidos com um descritor de segurança e para permitir que o cliente obtenha acesso autorizado a informações nesses arquivos, o aplicativo poderá representar o cliente antes de acessar os arquivos.</span><span class="sxs-lookup"><span data-stu-id="488df-111">Or, if your application accesses files that are protected with a security descriptor and to enable the client to obtain authorized access to information in these files, the application can impersonate the client before accessing the files.</span></span>

## <a name="how-to-implement-impersonation"></a><span data-ttu-id="488df-112">Como implementar a representação</span><span class="sxs-lookup"><span data-stu-id="488df-112">How to Implement Impersonation</span></span>

<span data-ttu-id="488df-113">A representação requer a participação tanto pelo cliente quanto pelo servidor (e, em alguns casos, por administradores do sistema).</span><span class="sxs-lookup"><span data-stu-id="488df-113">Impersonation requires participation by both client and server (and, in some cases, system administrators).</span></span> <span data-ttu-id="488df-114">O cliente deve indicar sua disposição para permitir que o servidor use sua identidade, e o servidor deve assumir a identidade do cliente de forma programática.</span><span class="sxs-lookup"><span data-stu-id="488df-114">The client must indicate its willingness to let the server use its identity, and the server must explicitly assume the client's identity programmatically.</span></span> <span data-ttu-id="488df-115">Para obter detalhes, confira os tópicos [requisitos do lado do cliente para representação](client-side-requirements-for-impersonation.md) e [requisitos do lado do servidor para representação](server-side-requirements-for-impersonation.md).</span><span class="sxs-lookup"><span data-stu-id="488df-115">For details, see the topics [Client-Side Requirements for Impersonation](client-side-requirements-for-impersonation.md) and [Server-Side Requirements for Impersonation](server-side-requirements-for-impersonation.md).</span></span>

## <a name="administrative-requirements-for-delegate-level-impersonation"></a><span data-ttu-id="488df-116">Requisitos administrativos para representação de Delegate-Level</span><span class="sxs-lookup"><span data-stu-id="488df-116">Administrative Requirements for Delegate-Level Impersonation</span></span>

<span data-ttu-id="488df-117">Para usar efetivamente a forma mais poderosa de representação, *delegação*, que é a representação de clientes na rede, as contas de usuário do cliente e do servidor devem ser configuradas corretamente no serviço de Active Directory para dar suporte a ela (além do cliente que concede a autoridade para fazer a representação em nível de delegado), da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="488df-117">To effectively use the most powerful form of impersonation, *delegation*, which is the impersonation of clients over the network, the client and server user accounts must be properly configured in the Active Directory Service to support it (in addition to the client granting authority to do delegate-level impersonation), as follows:</span></span>

-   <span data-ttu-id="488df-118">A identidade do servidor deve ser marcada como "confiável para delegação" no serviço de Active Directory.</span><span class="sxs-lookup"><span data-stu-id="488df-118">The server identity must be marked as "Trusted for delegation" in the Active Directory Service.</span></span>
-   <span data-ttu-id="488df-119">A identidade do cliente não deve ser marcada como "a conta é confidencial e não pode ser delegada" no serviço de Active Directory.</span><span class="sxs-lookup"><span data-stu-id="488df-119">The client identity must not be marked as "Account is sensitive and cannot be delegated" in the Active Directory Service.</span></span>

<span data-ttu-id="488df-120">Esses recursos de configuração dão ao administrador de domínio um alto grau de controle sobre a delegação, o que é desejável, considerando a quantidade de confiança (e, portanto, o risco de segurança) envolvida.</span><span class="sxs-lookup"><span data-stu-id="488df-120">These configuration features give the domain administrator a high degree of control over delegation, which is desirable, given how much trust (and hence security risk) is involved.</span></span> <span data-ttu-id="488df-121">Para obter mais detalhes sobre a delegação, consulte [delegação e representação](/windows/desktop/com/delegation-and-impersonation).</span><span class="sxs-lookup"><span data-stu-id="488df-121">For more detail about delegation, see [Delegation and Impersonation](/windows/desktop/com/delegation-and-impersonation).</span></span>

## <a name="cloaking"></a><span data-ttu-id="488df-122">Encobrimento</span><span class="sxs-lookup"><span data-stu-id="488df-122">Cloaking</span></span>

<span data-ttu-id="488df-123">Junto com a autoridade que um cliente concede um servidor por meio do nível de representação, a capacidade de encobrimento do servidor determina em grande parte como o comportamento da representação se comportará.</span><span class="sxs-lookup"><span data-stu-id="488df-123">Along with the authority a client grants a server through the impersonation level, the server's cloaking capability largely determines how impersonation will behave.</span></span> <span data-ttu-id="488df-124">O encobrimento afeta qual identidade é realmente apresentada pelo servidor quando faz chamadas em nome do cliente — seu próprio ou o do cliente.</span><span class="sxs-lookup"><span data-stu-id="488df-124">Cloaking affects what identity is actually presented by the server when it makes calls on the client's behalf—its own or the client's.</span></span> <span data-ttu-id="488df-125">Para obter detalhes, consulte [encobrindo](cloaking.md).</span><span class="sxs-lookup"><span data-stu-id="488df-125">For details, see [Cloaking](cloaking.md).</span></span>

## <a name="performance-implications"></a><span data-ttu-id="488df-126">Implicações de desempenho</span><span class="sxs-lookup"><span data-stu-id="488df-126">Performance Implications</span></span>

<span data-ttu-id="488df-127">A representação pode afetar significativamente o desempenho e o dimensionamento.</span><span class="sxs-lookup"><span data-stu-id="488df-127">Impersonation can significantly affect performance and scaling.</span></span> <span data-ttu-id="488df-128">Geralmente, é mais caro representar um cliente em uma chamada do que fazer a chamada diretamente.</span><span class="sxs-lookup"><span data-stu-id="488df-128">It is generally more expensive to impersonate a client on a call than to make the call directly.</span></span> <span data-ttu-id="488df-129">A seguir estão alguns dos problemas a serem considerados:</span><span class="sxs-lookup"><span data-stu-id="488df-129">Following are some of the issues to consider:</span></span>

-   <span data-ttu-id="488df-130">A sobrecarga computacional de passar a identidade em padrões complicados, especialmente se o encobrimento dinâmico estiver habilitado.</span><span class="sxs-lookup"><span data-stu-id="488df-130">The computational overhead of passing around identity in complicated patterns, particularly if dynamic cloaking is enabled.</span></span>
-   <span data-ttu-id="488df-131">A complexidade geral de impor a verificação de segurança redundante em vários lugares, em vez de apenas de forma centralizada na camada intermediária.</span><span class="sxs-lookup"><span data-stu-id="488df-131">The general complexity of enforcing redundant security checking in numerous places, instead of just centrally in the middle tier.</span></span>
-   <span data-ttu-id="488df-132">Recursos como conexões de banco de dados, quando aberto representando um cliente, não podem ser reutilizados em vários clientes — um obstáculo muito grande para dimensionar bem.</span><span class="sxs-lookup"><span data-stu-id="488df-132">Resources such as database connections, when opened impersonating a client, cannot be reused across multiple clients—a very large roadblock to scaling well.</span></span>

<span data-ttu-id="488df-133">Às vezes, a única solução eficaz para um problema é usar a representação, mas essa decisão deve ser cuidadosamente avaliada.</span><span class="sxs-lookup"><span data-stu-id="488df-133">Sometimes the only effective solution to a problem is to use impersonation, but this decision should be carefully weighed.</span></span> <span data-ttu-id="488df-134">Para obter uma discussão adicional sobre esses problemas, consulte [segurança de aplicativos de várias camadas](multi-tier-application-security.md).</span><span class="sxs-lookup"><span data-stu-id="488df-134">For a further discussion of these issues, see [Multi-Tier Application Security](multi-tier-application-security.md).</span></span>

## <a name="queued-components"></a><span data-ttu-id="488df-135">Componentes na fila</span><span class="sxs-lookup"><span data-stu-id="488df-135">Queued Components</span></span>

<span data-ttu-id="488df-136">Os [componentes na fila](com--queued-components.md) não oferecem suporte à representação.</span><span class="sxs-lookup"><span data-stu-id="488df-136">[Queued components](com--queued-components.md) do not support impersonation.</span></span> <span data-ttu-id="488df-137">Quando um cliente faz uma chamada para um objeto enfileirado, a chamada é realmente feita ao gravador, que o empacota como parte de uma mensagem para o servidor.</span><span class="sxs-lookup"><span data-stu-id="488df-137">When a client makes a call to a queued object, the call is actually made to the recorder, which packages it as part of a message to the server.</span></span> <span data-ttu-id="488df-138">Em seguida, o ouvinte lê a mensagem da fila e a passa para o Player, que invoca o componente de servidor real e faz a mesma chamada de método.</span><span class="sxs-lookup"><span data-stu-id="488df-138">The listener then reads the message from the queue and passes it to the player, which invokes the actual server component and makes the same method call.</span></span> <span data-ttu-id="488df-139">Assim, quando o servidor recebe a chamada, o token do cliente original não está disponível por meio da representação.</span><span class="sxs-lookup"><span data-stu-id="488df-139">As such, when the server receives the call, the original client token is unavailable via impersonation.</span></span> <span data-ttu-id="488df-140">A segurança baseada em função ainda se aplica, no entanto, e a segurança programática usando a interface [**ISecurityCallContext**](/windows/desktop/api/ComSvcs/nn-comsvcs-isecuritycallcontext) funcionará.</span><span class="sxs-lookup"><span data-stu-id="488df-140">Role-based security still applies, however, and programmatic security using the [**ISecurityCallContext**](/windows/desktop/api/ComSvcs/nn-comsvcs-isecuritycallcontext) interface will work.</span></span> <span data-ttu-id="488df-141">Para obter detalhes, consulte [segurança de componentes na fila](queued-components-security.md).</span><span class="sxs-lookup"><span data-stu-id="488df-141">For details, see [Queued Components Security](queued-components-security.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="488df-142">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="488df-142">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="488df-143">Autenticação de cliente</span><span class="sxs-lookup"><span data-stu-id="488df-143">Client Authentication</span></span>](client-authentication.md)
</dt> <dt>

[<span data-ttu-id="488df-144">Segurança de aplicativos de biblioteca</span><span class="sxs-lookup"><span data-stu-id="488df-144">Library Application Security</span></span>](library-application-security.md)
</dt> <dt>

[<span data-ttu-id="488df-145">Segurança de aplicativos de várias camadas</span><span class="sxs-lookup"><span data-stu-id="488df-145">Multi-Tier Application Security</span></span>](multi-tier-application-security.md)
</dt> <dt>

[<span data-ttu-id="488df-146">Segurança de componente programática</span><span class="sxs-lookup"><span data-stu-id="488df-146">Programmatic Component Security</span></span>](programmatic-component-security.md)
</dt> <dt>

[<span data-ttu-id="488df-147">Administração de segurança baseada em funções</span><span class="sxs-lookup"><span data-stu-id="488df-147">Role-Based Security Administration</span></span>](role-based-security-administration.md)
</dt> <dt>

[<span data-ttu-id="488df-148">Usando a política de restrição de software no COM+</span><span class="sxs-lookup"><span data-stu-id="488df-148">Using the Software Restriction Policy in COM+</span></span>](using-the-software-restriction-policy-in-com-.md)
</dt> </dl>

 

 
