---
description: Os objetos pooling devem atender a certos requisitos para permitir que uma única instância de objeto seja usada por vários clientes.
ms.assetid: 2cd4211e-be12-4197-8b43-5cb9f2321016
title: Requisitos para objetos pooling
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 78d6834210f180ad8b514b51b6926b5cd30714fd
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103920335"
---
# <a name="requirements-for-poolable-objects"></a><span data-ttu-id="05fec-103">Requisitos para objetos pooling</span><span class="sxs-lookup"><span data-stu-id="05fec-103">Requirements for Poolable Objects</span></span>

<span data-ttu-id="05fec-104">Os objetos pooling devem atender a certos requisitos para permitir que uma única instância de objeto seja usada por vários clientes.</span><span class="sxs-lookup"><span data-stu-id="05fec-104">Poolable objects must meet certain requirements to enable a single object instance to be used by multiple clients.</span></span>

## <a name="stateless"></a><span data-ttu-id="05fec-105">Sem estado</span><span class="sxs-lookup"><span data-stu-id="05fec-105">Stateless</span></span>

<span data-ttu-id="05fec-106">Para manter a segurança, a consistência e o isolamento, os objetos pooling não devem conter estado específico do cliente do cliente para o cliente.</span><span class="sxs-lookup"><span data-stu-id="05fec-106">To maintain security, consistency, and isolation, poolable objects should hold no client-specific state from client to client.</span></span> <span data-ttu-id="05fec-107">Você pode gerenciar qualquer estado por cliente usando o [**controledeobjetoi**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol), executando a inicialização específica de contexto com [**Controledeobjetoi:: ativar**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-activate) e limpando qualquer estado do cliente com [**controledeobjetoi::D eactivate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-deactivate).</span><span class="sxs-lookup"><span data-stu-id="05fec-107">You can manage any per-client state by using [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol), performing context-specific initialization with [**IObjectControl::Activate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-activate) and cleaning up any client state with [**IObjectControl::Deactivate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-deactivate).</span></span> <span data-ttu-id="05fec-108">Para obter mais detalhes, consulte [controlando o tempo de vida e o estado do objeto](controlling-object-lifetime-and-state.md).</span><span class="sxs-lookup"><span data-stu-id="05fec-108">For more detail, see [Controlling Object Lifetime and State](controlling-object-lifetime-and-state.md).</span></span>

## <a name="no-thread-affinity"></a><span data-ttu-id="05fec-109">Sem afinidade de thread</span><span class="sxs-lookup"><span data-stu-id="05fec-109">No Thread Affinity</span></span>

<span data-ttu-id="05fec-110">Objetos com poolable não podem ser associados a um thread específico; caso contrário, o desempenho poderia ser potencialmente desastroso.</span><span class="sxs-lookup"><span data-stu-id="05fec-110">Poolable objects cannot be bound to a particular thread; otherwise, performance could be potentially disastrous.</span></span> <span data-ttu-id="05fec-111">Por esse motivo, os objetos pooling não podem ser marcados para execução no modelo de apartamento; Eles devem ser executados no apartamento multithread ou no apartamento neutro.</span><span class="sxs-lookup"><span data-stu-id="05fec-111">For this reason, poolable objects cannot be marked to run in the apartment model; they must run in the multithreaded apartment or the neutral apartment.</span></span> <span data-ttu-id="05fec-112">Além disso, objetos pooling não devem usar o armazenamento local de thread nem devem agregar o marshaler de thread livre.</span><span class="sxs-lookup"><span data-stu-id="05fec-112">In addition, poolable objects should not use thread local storage nor should they aggregate the free-threaded marshaler.</span></span> <span data-ttu-id="05fec-113">Para obter mais detalhes sobre Threading em COM+, consulte [modelos de Threading com+](com--threading-models.md).</span><span class="sxs-lookup"><span data-stu-id="05fec-113">For more detail about threading in COM+, see [COM+ Threading Models](com--threading-models.md).</span></span>

> [!Note]  
> <span data-ttu-id="05fec-114">O Microsoft Visual Basic 6,0 e os ambientes de desenvolvimento anteriores podem criar somente componentes de modelo de apartamento.</span><span class="sxs-lookup"><span data-stu-id="05fec-114">The Microsoft Visual Basic 6.0 and earlier development environments can create only apartment model components.</span></span> <span data-ttu-id="05fec-115">No entanto, no Visual Basic .NET, os componentes podem ser agrupados.</span><span class="sxs-lookup"><span data-stu-id="05fec-115">However, in Visual Basic .NET, components can be pooled.</span></span>

 

## <a name="aggregatable"></a><span data-ttu-id="05fec-116">Agregável</span><span class="sxs-lookup"><span data-stu-id="05fec-116">Aggregatable</span></span>

<span data-ttu-id="05fec-117">Os objetos pooling devem dar suporte à agregação, ou seja, eles devem dar suporte à criação invocando [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) com um argumento *pUnkOuter* não nulo.</span><span class="sxs-lookup"><span data-stu-id="05fec-117">Poolable objects must support aggregation—that is, they must support being created by invoking [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) with a non-NULL *pUnkOuter* argument.</span></span> <span data-ttu-id="05fec-118">Quando o COM+ ativa um objeto em pool, ele cria uma agregação para gerenciar o tempo de vida do objeto em pool e chamar métodos em [**controledeobjetoi**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol).</span><span class="sxs-lookup"><span data-stu-id="05fec-118">When COM+ activates a pooled object, it creates an aggregate to manage the lifetime of the pooled object and to call methods on [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol).</span></span> <span data-ttu-id="05fec-119">Para obter detalhes sobre como escrever objetos agregáveis, consulte [agregação](/windows/desktop/com/aggregation).</span><span class="sxs-lookup"><span data-stu-id="05fec-119">For details on writing aggregatable objects, see [Aggregation](/windows/desktop/com/aggregation).</span></span>

## <a name="transactional-components"></a><span data-ttu-id="05fec-120">Componentes transacionais</span><span class="sxs-lookup"><span data-stu-id="05fec-120">Transactional Components</span></span>

<span data-ttu-id="05fec-121">Objetos com pooláveis que participam de transações devem inscrever manualmente os recursos gerenciados.</span><span class="sxs-lookup"><span data-stu-id="05fec-121">Poolable objects that participate in transactions must manually enlist managed resources.</span></span> <span data-ttu-id="05fec-122">Enquanto ele estiver em pool, se o seu objeto mantiver um recurso gerenciado, como uma conexão de banco de dados, não haverá nenhuma maneira para o Gerenciador de recursos se inscrever automaticamente em uma transação quando o objeto for ativado no contexto especificado.</span><span class="sxs-lookup"><span data-stu-id="05fec-122">While it is pooled, if your object holds a managed resource such as a database connection, there will be no way for the resource manager to automatically enlist in a transaction when the object is activated in given context.</span></span> <span data-ttu-id="05fec-123">Portanto, o próprio objeto deve lidar com a lógica de detecção da transação, desativando a inscrição automática do Resource Manager e manualmente listando os recursos que ela contém.</span><span class="sxs-lookup"><span data-stu-id="05fec-123">Therefore, the object itself must handle the logic of detecting the transaction, turning off the resource manager's auto-enlistment and manually enlisting any resources that it holds.</span></span> <span data-ttu-id="05fec-124">Além disso, um objeto em pool transacional deve refletir o estado atual de seus recursos nos valores de parâmetro de [**controledeobjetoi:: CanBePooled**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled).</span><span class="sxs-lookup"><span data-stu-id="05fec-124">In addition, a transactional pooled object should reflect the current state of its resources in the parameter values of [**IObjectControl::CanBePooled**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled).</span></span> <span data-ttu-id="05fec-125">Para obter mais detalhes, consulte [pooling de objetos transacionais](pooling-transactional-objects.md).</span><span class="sxs-lookup"><span data-stu-id="05fec-125">For more detail, see [Pooling Transactional Objects](pooling-transactional-objects.md).</span></span>

## <a name="implement-iobjectcontrol-to-manage-the-object-lifetime"></a><span data-ttu-id="05fec-126">Implementar Controledeobjetoi para gerenciar o tempo de vida do objeto</span><span class="sxs-lookup"><span data-stu-id="05fec-126">Implement IObjectControl to Manage the Object Lifetime</span></span>

<span data-ttu-id="05fec-127">Os objetos pooling devem implementar [**controledeobjetoi**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol), embora não seja estritamente necessário.</span><span class="sxs-lookup"><span data-stu-id="05fec-127">Poolable objects should implement [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol), although it is not strictly necessary to do so.</span></span> <span data-ttu-id="05fec-128">No entanto, os componentes transacionais que são agrupados devem implementar **controledeobjetoi**.</span><span class="sxs-lookup"><span data-stu-id="05fec-128">Transactional components that are pooled, however, must implement **IObjectControl**.</span></span> <span data-ttu-id="05fec-129">Esses componentes devem monitorar o estado dos recursos que eles contêm e indicar quando eles não podem ser reutilizados; Quando [**controledeobjetoi:: CanBePooled**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled) retorna false, ele destruição uma transação.</span><span class="sxs-lookup"><span data-stu-id="05fec-129">These components should monitor the state of the resources they hold and indicate when they can't be reused; when [**IObjectControl::CanBePooled**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled) returns false, it will doom a transaction.</span></span> <span data-ttu-id="05fec-130">Para obter mais detalhes, consulte [controlando o tempo de vida e o estado do objeto](controlling-object-lifetime-and-state.md).</span><span class="sxs-lookup"><span data-stu-id="05fec-130">For more detail, see [Controlling Object Lifetime and State](controlling-object-lifetime-and-state.md).</span></span>

## <a name="language-restrictions"></a><span data-ttu-id="05fec-131">Restrições de idioma</span><span class="sxs-lookup"><span data-stu-id="05fec-131">Language Restrictions</span></span>

<span data-ttu-id="05fec-132">Os componentes desenvolvidos usando o Microsoft Visual Basic 6,0 e versões anteriores não podem ser agrupados porque esses componentes serão segmentados no modelo de apartamento.</span><span class="sxs-lookup"><span data-stu-id="05fec-132">Components developed using Microsoft Visual Basic 6.0 and earlier cannot be pooled because these components will be apartment-model threaded.</span></span> <span data-ttu-id="05fec-133">No entanto, no Visual Basic .NET, os componentes podem ser agrupados.</span><span class="sxs-lookup"><span data-stu-id="05fec-133">However, in Visual Basic .NET, components can be pooled.</span></span>

## <a name="legacy-components"></a><span data-ttu-id="05fec-134">Componentes herdados</span><span class="sxs-lookup"><span data-stu-id="05fec-134">Legacy Components</span></span>

<span data-ttu-id="05fec-135">Desde que eles não sejam transacionais e estejam em conformidade com os requisitos anteriores apropriados, os componentes podem ser agrupados mesmo que não tenham sido especificamente escritos com o recurso de Pooling em mente.</span><span class="sxs-lookup"><span data-stu-id="05fec-135">As long as they are non-transactional and conform to the appropriate preceding requirements, components can be pooled even if they were not specifically written with pooling capability in mind.</span></span> <span data-ttu-id="05fec-136">Não é necessário implementar [**controledeobjetoi**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol); um componente que não faz isso simplesmente não participará do gerenciamento de seu tempo de vida.</span><span class="sxs-lookup"><span data-stu-id="05fec-136">It is not necessary to implement [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol); a component that does not do so simply won't participate in managing its lifetime.</span></span> <span data-ttu-id="05fec-137">Se [**controledeobjetoi:: CanBePooled**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled) não for implementado, o objeto continuará a ser reutilizado até que o pool atinja o tamanho máximo.</span><span class="sxs-lookup"><span data-stu-id="05fec-137">If [**IObjectControl::CanBePooled**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled) is not implemented, the object will continue to be reused until the pool attains maximum size.</span></span>

## <a name="related-topics"></a><span data-ttu-id="05fec-138">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="05fec-138">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="05fec-139">Cadeias de caracteres do construtor do objeto COM+</span><span class="sxs-lookup"><span data-stu-id="05fec-139">COM+ Object Constructor Strings</span></span>](com--object-constructor-strings.md)
</dt> <dt>

[<span data-ttu-id="05fec-140">Controlando o tempo de vida e o estado do objeto</span><span class="sxs-lookup"><span data-stu-id="05fec-140">Controlling Object Lifetime and State</span></span>](controlling-object-lifetime-and-state.md)
</dt> <dt>

[<span data-ttu-id="05fec-141">Como o pool de objetos funciona</span><span class="sxs-lookup"><span data-stu-id="05fec-141">How Object Pooling Works</span></span>](how-object-pooling-works.md)
</dt> <dt>

[<span data-ttu-id="05fec-142">Melhorando o desempenho com o pooling de objetos</span><span class="sxs-lookup"><span data-stu-id="05fec-142">Improving Performance with Object Pooling</span></span>](improving-performance-with-object-pooling.md)
</dt> <dt>

[<span data-ttu-id="05fec-143">Pooling de objetos transacionais</span><span class="sxs-lookup"><span data-stu-id="05fec-143">Pooling Transactional Objects</span></span>](pooling-transactional-objects.md)
</dt> </dl>

 

 
