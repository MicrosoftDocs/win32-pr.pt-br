---
description: Erros de Server-Side
ms.assetid: ce8ddb52-237c-4d46-a088-9f592afadcd2
title: Erros de Server-Side
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f7946b8197553874b8da22d35f8fab5b83f14862
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105791059"
---
# <a name="server-side-errors"></a><span data-ttu-id="a020d-103">Erros de Server-Side</span><span class="sxs-lookup"><span data-stu-id="a020d-103">Server-Side Errors</span></span>

<span data-ttu-id="a020d-104">O ouvinte e o Player trabalham juntos para lidar com mensagens suspeitas.</span><span class="sxs-lookup"><span data-stu-id="a020d-104">The listener and player work together to deal with poison messages.</span></span> <span data-ttu-id="a020d-105">Se uma transação que está sendo reproduzida falhar, o [enfileiramento de mensagens](/previous-versions/windows/desktop/legacy/ms711472(v=vs.85)) moverá a mensagem de entrada de volta para a fila de entrada.</span><span class="sxs-lookup"><span data-stu-id="a020d-105">If a transaction that is being played back fails, [Message Queuing](/previous-versions/windows/desktop/legacy/ms711472(v=vs.85)) moves the input message back to the input queue.</span></span> <span data-ttu-id="a020d-106">O Player anulará a transação se receber um HRESULT com falha do componente de servidor ou se ele detectar uma exceção.</span><span class="sxs-lookup"><span data-stu-id="a020d-106">The player aborts the transaction if it receives a failed HRESULT from the server component or if it catches an exception.</span></span> <span data-ttu-id="a020d-107">Se o problema persistir, o ouvinte poderá fazer um loop continuamente no seguinte padrão:</span><span class="sxs-lookup"><span data-stu-id="a020d-107">If the problem persists, the listener could loop continuously in the following pattern:</span></span>

-   <span data-ttu-id="a020d-108">Remover a mensagem da fila</span><span class="sxs-lookup"><span data-stu-id="a020d-108">Dequeues the message</span></span>
-   <span data-ttu-id="a020d-109">Instancia o objeto</span><span class="sxs-lookup"><span data-stu-id="a020d-109">Instantiates the object</span></span>
-   <span data-ttu-id="a020d-110">Sofre uma reversão</span><span class="sxs-lookup"><span data-stu-id="a020d-110">Suffers a rollback</span></span>
-   <span data-ttu-id="a020d-111">Coloca a mensagem de volta na parte superior da fila</span><span class="sxs-lookup"><span data-stu-id="a020d-111">Puts the message back on the top of the queue</span></span>

<span data-ttu-id="a020d-112">O serviço de componentes na fila trata dessa falha usando uma série de filas de repetição específicas do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a020d-112">The queued components service handles this failure by using a series of application-specific retry queues.</span></span> <span data-ttu-id="a020d-113">Criado quando o componente é instalado, há sete filas para cada aplicativo, da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="a020d-113">Created when the component is installed, there are seven queues for each application, as follows:</span></span>

1.  <span data-ttu-id="a020d-114">A fila de entrada normal.</span><span class="sxs-lookup"><span data-stu-id="a020d-114">The normal input queue.</span></span> <span data-ttu-id="a020d-115">O nome dessa fila é o nome do aplicativo COM+.</span><span class="sxs-lookup"><span data-stu-id="a020d-115">The name of this queue is the COM+ application name.</span></span> <span data-ttu-id="a020d-116">Esta é uma fila pública do enfileiramento de mensagens.</span><span class="sxs-lookup"><span data-stu-id="a020d-116">This is a Message Queuing public queue.</span></span>

2.  <span data-ttu-id="a020d-117">A primeira fila de repetição.</span><span class="sxs-lookup"><span data-stu-id="a020d-117">The first retry queue.</span></span> <span data-ttu-id="a020d-118">As mensagens serão movidas aqui se a transação falhar repetidamente ao processar mensagens da fila de entrada normal.</span><span class="sxs-lookup"><span data-stu-id="a020d-118">Messages are moved here if the transaction repeatedly fails when processing messages from the normal input queue.</span></span> <span data-ttu-id="a020d-119">As mensagens nessa fila são processadas após um minuto.</span><span class="sxs-lookup"><span data-stu-id="a020d-119">Messages on this queue are processed after one minute.</span></span> <span data-ttu-id="a020d-120">Uma mensagem pode ser repetida três vezes nessa fila antes de ser movida para trás da segunda fila de repetição.</span><span class="sxs-lookup"><span data-stu-id="a020d-120">A message can be retried three times on this queue before being moved to the back of the second retry queue.</span></span> <span data-ttu-id="a020d-121">Essa fila é denominada *ApplicationName* \_ 0.</span><span class="sxs-lookup"><span data-stu-id="a020d-121">This queue is named *ApplicationName*\_0.</span></span> <span data-ttu-id="a020d-122">Essa fila é uma fila de enfileiramento de mensagens particular.</span><span class="sxs-lookup"><span data-stu-id="a020d-122">This queue is a private Message Queuing queue.</span></span>

3.  <span data-ttu-id="a020d-123">A segunda fila de repetição.</span><span class="sxs-lookup"><span data-stu-id="a020d-123">The second retry queue.</span></span> <span data-ttu-id="a020d-124">As mensagens serão movidas aqui se a transação falhar repetidamente ao processar mensagens da primeira fila de repetição.</span><span class="sxs-lookup"><span data-stu-id="a020d-124">Messages are moved here if the transaction repeatedly fails when processing messages from the first retry queue.</span></span> <span data-ttu-id="a020d-125">As mensagens nessa fila são processadas após dois minutos.</span><span class="sxs-lookup"><span data-stu-id="a020d-125">Messages on this queue are processed after two minutes.</span></span> <span data-ttu-id="a020d-126">Uma mensagem pode ser repetida três vezes nessa fila antes de ser movida para trás da terceira fila de repetição.</span><span class="sxs-lookup"><span data-stu-id="a020d-126">A message can be retried three times on this queue before being moved to the back of the third retry queue.</span></span> <span data-ttu-id="a020d-127">Essa fila é denominada *ApplicationName* \_ 1.</span><span class="sxs-lookup"><span data-stu-id="a020d-127">This queue is named *ApplicationName*\_1.</span></span> <span data-ttu-id="a020d-128">Essa fila é uma fila de enfileiramento de mensagens particular.</span><span class="sxs-lookup"><span data-stu-id="a020d-128">This queue is a private Message Queuing queue.</span></span>

4.  <span data-ttu-id="a020d-129">A terceira fila de repetição.</span><span class="sxs-lookup"><span data-stu-id="a020d-129">The third retry queue.</span></span> <span data-ttu-id="a020d-130">As mensagens serão movidas aqui se a transação falhar repetidamente ao processar mensagens da segunda fila de repetição.</span><span class="sxs-lookup"><span data-stu-id="a020d-130">Messages are moved here if the transaction repeatedly fails when processing messages from the second retry queue.</span></span> <span data-ttu-id="a020d-131">As mensagens nessa fila são processadas após quatro minutos.</span><span class="sxs-lookup"><span data-stu-id="a020d-131">Messages on this queue are processed after four minutes.</span></span> <span data-ttu-id="a020d-132">Uma mensagem pode ser repetida três vezes nessa fila antes de ser movida para trás da quarta fila de repetição.</span><span class="sxs-lookup"><span data-stu-id="a020d-132">A message can be retried three times on this queue before being moved to the back of the fourth retry queue.</span></span> <span data-ttu-id="a020d-133">Essa fila é denominada *ApplicationName* \_ 2.</span><span class="sxs-lookup"><span data-stu-id="a020d-133">This queue is named *ApplicationName*\_2.</span></span> <span data-ttu-id="a020d-134">Essa fila é uma fila de enfileiramento de mensagens particular.</span><span class="sxs-lookup"><span data-stu-id="a020d-134">This queue is a private Message Queuing queue.</span></span>

5.  <span data-ttu-id="a020d-135">A quarta fila de repetição.</span><span class="sxs-lookup"><span data-stu-id="a020d-135">The fourth retry queue.</span></span> <span data-ttu-id="a020d-136">As mensagens serão movidas aqui se a transação falhar repetidamente ao processar mensagens da terceira fila de repetição.</span><span class="sxs-lookup"><span data-stu-id="a020d-136">Messages are moved here if the transaction repeatedly fails when processing messages from the third retry queue.</span></span> <span data-ttu-id="a020d-137">As mensagens nessa fila são processadas após oito minutos.</span><span class="sxs-lookup"><span data-stu-id="a020d-137">Messages on this queue are processed after eight minutes.</span></span> <span data-ttu-id="a020d-138">Uma mensagem pode ser repetida três vezes nessa fila antes de ser movida para a quinta fila de repetição.</span><span class="sxs-lookup"><span data-stu-id="a020d-138">A message can be retried three times on this queue before being moved to the fifth retry queue.</span></span> <span data-ttu-id="a020d-139">Essa fila é denominada *ApplicationName* \_ 3.</span><span class="sxs-lookup"><span data-stu-id="a020d-139">This queue is named *ApplicationName*\_3.</span></span> <span data-ttu-id="a020d-140">Essa fila é uma fila de enfileiramento de mensagens particular.</span><span class="sxs-lookup"><span data-stu-id="a020d-140">This queue is a private Message Queuing queue.</span></span>

6.  <span data-ttu-id="a020d-141">A quinta fila de repetição.</span><span class="sxs-lookup"><span data-stu-id="a020d-141">The fifth retry queue.</span></span> <span data-ttu-id="a020d-142">As mensagens serão movidas aqui se a transação falhar repetidamente ao processar mensagens da quarta fila de repetição.</span><span class="sxs-lookup"><span data-stu-id="a020d-142">Messages are moved here if the transaction repeatedly fails when processing messages from the fourth retry queue.</span></span> <span data-ttu-id="a020d-143">As mensagens nessa fila são processadas após dezesseis minutos.</span><span class="sxs-lookup"><span data-stu-id="a020d-143">Messages on this queue are processed after sixteen minutes.</span></span> <span data-ttu-id="a020d-144">Uma mensagem pode ser repetida três vezes nessa fila antes de ser movida para a fila de repouso final.</span><span class="sxs-lookup"><span data-stu-id="a020d-144">A message can be retried three times on this queue before being moved to the final resting queue.</span></span> <span data-ttu-id="a020d-145">Essa fila é denominada *ApplicationName* \_ 4.</span><span class="sxs-lookup"><span data-stu-id="a020d-145">This queue is named *ApplicationName*\_4.</span></span> <span data-ttu-id="a020d-146">Esta é uma fila de enfileiramento de mensagens particular.</span><span class="sxs-lookup"><span data-stu-id="a020d-146">This is a private Message Queuing queue.</span></span>

7.  <span data-ttu-id="a020d-147">Uma fila de repouso final específica do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a020d-147">An application-specific final resting queue.</span></span> <span data-ttu-id="a020d-148">As mensagens serão movidas aqui se a transação for anulada repetidamente quando for tentada na quinta fila de repetição.</span><span class="sxs-lookup"><span data-stu-id="a020d-148">Messages are moved here if the transaction repeatedly aborts when attempted on the fifth retry queue.</span></span> <span data-ttu-id="a020d-149">Essa fila é denominada *ApplicationName* \_ DeadQueue.</span><span class="sxs-lookup"><span data-stu-id="a020d-149">This queue is named *ApplicationName*\_DeadQueue.</span></span> <span data-ttu-id="a020d-150">Esta é uma fila de enfileiramento de mensagens particular.</span><span class="sxs-lookup"><span data-stu-id="a020d-150">This is a private Message Queuing queue.</span></span> <span data-ttu-id="a020d-151">A fila de repouso final não é atendida por um ouvinte de fila.</span><span class="sxs-lookup"><span data-stu-id="a020d-151">The final resting queue is not serviced by a queue listener.</span></span> <span data-ttu-id="a020d-152">As mensagens permanecem aqui até serem movidas manualmente (talvez pelo utilitário enfileiramento de mensagens dos componentes enfileirados) ou são limpas pelo Gerenciador de filas de mensagens.</span><span class="sxs-lookup"><span data-stu-id="a020d-152">Messages stay here until they are manually moved (perhaps by the queued components message mover utility) or are purged by Message Queuing Explorer.</span></span>

<span data-ttu-id="a020d-153">Mensagens que não são reproduzidas porque estão claras de que todas as tentativas de repetição falham podem ser movidas diretamente para a fila de repouso final específica do aplicativo sem serem avançadas por todos os níveis de repetição.</span><span class="sxs-lookup"><span data-stu-id="a020d-153">Messages that are not playable because it is clear that every retry attempt will fail can be moved directly to the application-specific final resting queue without being advanced through all the retry levels.</span></span>

<span data-ttu-id="a020d-154">O jogador emite um evento COM+ para notificar as partes interessadas de que as mensagens não podem ser reproduzidas.</span><span class="sxs-lookup"><span data-stu-id="a020d-154">The player issues a COM+ event to notify interested parties that messages cannot be played.</span></span> <span data-ttu-id="a020d-155">Os eventos COM+ são emitidos nas seguintes situações:</span><span class="sxs-lookup"><span data-stu-id="a020d-155">COM+ events are issued in the following situations:</span></span>

-   <span data-ttu-id="a020d-156">Quando uma transação é anulada</span><span class="sxs-lookup"><span data-stu-id="a020d-156">When a transaction aborts</span></span>
-   <span data-ttu-id="a020d-157">Quando uma mensagem é movida de uma fila para outra</span><span class="sxs-lookup"><span data-stu-id="a020d-157">When a message is moved from one queue to another</span></span>
-   <span data-ttu-id="a020d-158">Quando uma mensagem é depositada na fila de repouso final</span><span class="sxs-lookup"><span data-stu-id="a020d-158">When a message is deposited onto the final resting queue</span></span>

<span data-ttu-id="a020d-159">As mensagens podem ser modificadas antes de passar de uma fila para outra.</span><span class="sxs-lookup"><span data-stu-id="a020d-159">Messages can be modified before moving from one queue to another.</span></span> <span data-ttu-id="a020d-160">O mecanismo de segurança de componentes na fila COM+ permite que uma mensagem seja movida para as filas de repetição e, em seguida, reinserida na fila de entrada inicial do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a020d-160">The COM+ queued components security mechanism allows a message to be moved to retry queues and then reinserted into the application's initial input queue.</span></span> <span data-ttu-id="a020d-161">Para obter mais informações sobre segurança de componentes na fila, consulte [segurança de componentes na fila](queued-components-security.md).</span><span class="sxs-lookup"><span data-stu-id="a020d-161">For more information on queued components security, see [Queued Components Security](queued-components-security.md).</span></span>

<span data-ttu-id="a020d-162">As filas de repetição são criadas junto com a fila do aplicativo principal quando o aplicativo é marcado como enfileirado pela ferramenta de administração dos serviços de componentes ou usando as funções do SDK administrativo do COM+.</span><span class="sxs-lookup"><span data-stu-id="a020d-162">Retry queues are created along with the main application queue when the application is either marked as queued by the Component Services administration tool or by using the COM+ Administrative SDK functions.</span></span> <span data-ttu-id="a020d-163">O serviço de componentes na fila permite flexibilidade no mecanismo de repetição, permitindo que as filas de repetição sejam excluídas.</span><span class="sxs-lookup"><span data-stu-id="a020d-163">The queued components service allows for flexibility in the retry mechanism by allowing retry queues to be deleted.</span></span> <span data-ttu-id="a020d-164">Por exemplo, se todas as filas de repetição forem excluídas, uma mensagem que é anulada persistentemente será movida diretamente da fila de aplicativos para a fila de repouso final específica do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a020d-164">For example, if all the retry queues are deleted, a message that persistently aborts will be moved directly from the application queue to the application-specific final resting queue.</span></span> <span data-ttu-id="a020d-165">Ao remover uma ou mais das filas de repetição, o número e o comprimento das repetições podem ser reduzidos.</span><span class="sxs-lookup"><span data-stu-id="a020d-165">By removing one or more of the retry queues, the number and length of the retries can be reduced.</span></span> <span data-ttu-id="a020d-166">Se as filas forem removidas da sequência de repetição, o tempo das filas restantes corresponderá à posição na sequência de filas de repetição.</span><span class="sxs-lookup"><span data-stu-id="a020d-166">If queues are removed from the retry sequence, the timing of the remaining queues correspond to the position in the sequence of retry queues.</span></span> <span data-ttu-id="a020d-167">Por exemplo, se você remover a fila de repetição *ApplicationName* \_ 1, *ApplicationName* \_ 2 e *ApplicationName* \_ 3, as mensagens no *ApplicationName* \_ 4 seriam processadas como se a fila fosse a segunda fila de repetição.</span><span class="sxs-lookup"><span data-stu-id="a020d-167">For example, if you remove retry queue *ApplicationName*\_1, *ApplicationName*\_2, and *ApplicationName*\_3, the messages on *ApplicationName*\_4 would be processed as if the queue was the second retry queue.</span></span>

<span data-ttu-id="a020d-168">O mecanismo de repetição é projetado para concluir uma mensagem, se possível.</span><span class="sxs-lookup"><span data-stu-id="a020d-168">The retry mechanism is designed to complete a message if at all possible.</span></span> <span data-ttu-id="a020d-169">Em alguns casos, pode não ser possível que a mensagem tenha sucesso.</span><span class="sxs-lookup"><span data-stu-id="a020d-169">In some cases, it may not be possible for the message to succeed.</span></span> <span data-ttu-id="a020d-170">Por exemplo, um cliente pode estar tentando retirar dinheiro de uma conta que tenha fundos insuficientes.</span><span class="sxs-lookup"><span data-stu-id="a020d-170">For example, a client may be attempting to withdraw money from an account that has insufficient funds.</span></span> <span data-ttu-id="a020d-171">Nessas circunstâncias, você pode manipular o erro de várias maneiras, incluindo o seguinte:</span><span class="sxs-lookup"><span data-stu-id="a020d-171">In these circumstances, you can handle the error in a number of ways, including the following:</span></span>

-   <span data-ttu-id="a020d-172">Gerar um diagnóstico e emitir um aviso</span><span class="sxs-lookup"><span data-stu-id="a020d-172">Generate a diagnostic and issue a warning</span></span>
-   <span data-ttu-id="a020d-173">Criar uma transação de compensação</span><span class="sxs-lookup"><span data-stu-id="a020d-173">Create a compensating transaction</span></span>
-   <span data-ttu-id="a020d-174">Ignorar o problema e ignorar a mensagem</span><span class="sxs-lookup"><span data-stu-id="a020d-174">Ignore the problem and dismiss the message</span></span>

<span data-ttu-id="a020d-175">Como falhas persistentes do lado do cliente, o serviço de componentes em fila permite que uma classe de exceção seja associada a um componente.</span><span class="sxs-lookup"><span data-stu-id="a020d-175">Like client-side persistent failures, the queued components service allows an exception class to be associated with a component.</span></span> <span data-ttu-id="a020d-176">A classe de exceção é associada ao componente usando a guia **avançado** na página Propriedades do componente da ferramenta de administração de serviços de componentes ou usando as funções administrativas do com+.</span><span class="sxs-lookup"><span data-stu-id="a020d-176">The exception class is associated with the component by using the **Advanced** tab in the component properties page of Component Services administration tool or by using the COM+ Administrative functions.</span></span> <span data-ttu-id="a020d-177">A classe de exceção permite que o desenvolvedor tenha controle depois que uma mensagem for repetida e antes que essa mensagem seja movida para a fila de repouso final específica do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a020d-177">The exception class allows the developer to have control after a message has been retried and before that message is moved to the application-specific final resting queue.</span></span> <span data-ttu-id="a020d-178">Para obter mais informações sobre a classe de exceção, consulte [falhas persistentes de Client-Side](persistent-client-side-failures.md).</span><span class="sxs-lookup"><span data-stu-id="a020d-178">For more information on the exception class, see [Persistent Client-Side Failures](persistent-client-side-failures.md).</span></span>

<span data-ttu-id="a020d-179">A seguir está a sequência de eventos para a manipulação de exceção do lado do servidor:</span><span class="sxs-lookup"><span data-stu-id="a020d-179">The following is the sequence of events for server-side exception handling:</span></span>

1.  <span data-ttu-id="a020d-180">A mensagem é movida pelas filas de repetição específicas do aplicativo disponíveis.</span><span class="sxs-lookup"><span data-stu-id="a020d-180">The message is moved through the available application-specific retry queues.</span></span>
2.  <span data-ttu-id="a020d-181">A repetição final da última fila de repetição falha.</span><span class="sxs-lookup"><span data-stu-id="a020d-181">The final retry on the last retry queue fails.</span></span>
3.  <span data-ttu-id="a020d-182">O tempo de execução do serviço de componentes na fila recupera o componente de destino da mensagem e verifica se há uma classe de exceção.</span><span class="sxs-lookup"><span data-stu-id="a020d-182">The queued components service run-time retrieves the target component from the message and checks for an exception class.</span></span>
4.  <span data-ttu-id="a020d-183">O tempo de execução instancia a classe de exceção.</span><span class="sxs-lookup"><span data-stu-id="a020d-183">The run-time instantiates the exception class.</span></span>
5.  <span data-ttu-id="a020d-184">As consultas de tempo de execução [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol) na classe de exceção.</span><span class="sxs-lookup"><span data-stu-id="a020d-184">The run-time queries [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol) on the exception class.</span></span>
6.  <span data-ttu-id="a020d-185">O tempo de execução chama [**IPlaybackControl:: FinalServerRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalserverretry) na classe de exceção.</span><span class="sxs-lookup"><span data-stu-id="a020d-185">The run-time calls [**IPlaybackControl::FinalServerRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalserverretry) in the exception class.</span></span>
7.  <span data-ttu-id="a020d-186">O tempo de execução reproduz todas as chamadas de propriedade e método da mensagem para a classe de exceção.</span><span class="sxs-lookup"><span data-stu-id="a020d-186">The run-time plays back all property and method calls from the message to the exception class.</span></span>
8.  <span data-ttu-id="a020d-187">Se as etapas 4 a 6 não tiverem sucesso, o tempo de execução moverá a mensagem para a fila de repouso final específica do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a020d-187">If steps 4 through 6 do not succeed, the run-time moves the message onto the application-specific final resting queue.</span></span>

<span data-ttu-id="a020d-188">Se você precisar intervir no processo descrito acima ou precisar mover uma mensagem suspeita para fora de sua fila de repouso final, use o utilitário de movimentação de mensagem.</span><span class="sxs-lookup"><span data-stu-id="a020d-188">If you need to intervene in the process described above or you need to move a poison message out of its final resting queue, use the message mover utility.</span></span> <span data-ttu-id="a020d-189">Para obter mais informações sobre o utilitário de movimentação de mensagens, consulte [tratamento de erros](handling-errors-in-queued-components.md).</span><span class="sxs-lookup"><span data-stu-id="a020d-189">For more information on the message mover utility, see [Handling Errors](handling-errors-in-queued-components.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="a020d-190">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="a020d-190">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="a020d-191">Erros do lado do cliente</span><span class="sxs-lookup"><span data-stu-id="a020d-191">Client-Side Errors</span></span>](client-side-errors.md)
</dt> <dt>

[<span data-ttu-id="a020d-192">Falhas de Client-Side persistentes</span><span class="sxs-lookup"><span data-stu-id="a020d-192">Persistent Client-Side Failures</span></span>](persistent-client-side-failures.md)
</dt> </dl>

 

 



