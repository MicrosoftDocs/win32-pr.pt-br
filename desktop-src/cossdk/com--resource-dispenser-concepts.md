---
description: Os componentes de aplicativo usam o dispensador de recursos COM+ para acessar e gerenciar informações de estado não duráveis, como conexões entre componentes e um Gerenciador de recursos específico.
ms.assetid: 252c7180-61b1-485d-883d-36bf77357a29
title: Conceitos do dispensador de recursos COM+
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8f0fcf281d6d7b8ed0e087b6d77e4d686e28e1fa
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103646291"
---
# <a name="com-resource-dispenser-concepts"></a><span data-ttu-id="13d52-103">Conceitos do dispensador de recursos COM+</span><span class="sxs-lookup"><span data-stu-id="13d52-103">COM+ Resource Dispenser Concepts</span></span>

<span data-ttu-id="13d52-104">Os componentes de aplicativo usam o dispensador de recursos COM+ para acessar e gerenciar informações de estado não duráveis, como conexões entre componentes e um Gerenciador de recursos específico.</span><span class="sxs-lookup"><span data-stu-id="13d52-104">Application components use the COM+ resource dispenser to access and manage shared, nondurable state information, such as connections between components and a given resource manager.</span></span> <span data-ttu-id="13d52-105">Em tempo de execução, pools dinâmicos de recursos, como conexões de banco de dados, conexões de rede, conexões a filas, threads, objetos e blocos de memória, são disponibilizados para o dispensador de recurso.</span><span class="sxs-lookup"><span data-stu-id="13d52-105">At runtime, dynamic pools of resources, such as database connections, network connections, connections to queues, threads, objects, and memory blocks, are made available to the resource dispenser.</span></span> <span data-ttu-id="13d52-106">O processo do aplicativo alcança alto desempenho usando um número mínimo de recursos usados com frequência.</span><span class="sxs-lookup"><span data-stu-id="13d52-106">The application process achieves high performance by using a minimum number of frequently used resources.</span></span> <span data-ttu-id="13d52-107">O dispensador de recursos também pode automatizar transações e reclamações.</span><span class="sxs-lookup"><span data-stu-id="13d52-107">The resource dispenser can also automate transactions and reclamation.</span></span> <span data-ttu-id="13d52-108">(Consulte [recuperação automática de recursos](automatic-resource-reclamation.md) para obter mais informações sobre esse recurso.)</span><span class="sxs-lookup"><span data-stu-id="13d52-108">(See [Automatic Resource Reclamation](automatic-resource-reclamation.md) for more information about this feature.)</span></span>

> [!Note]  
> <span data-ttu-id="13d52-109">Um *recurso* é qualquer coisa que um dispensador de recurso cria.</span><span class="sxs-lookup"><span data-stu-id="13d52-109">A *resource* is anything a resource dispenser creates.</span></span> <span data-ttu-id="13d52-110">Por exemplo, uma conexão com um Gerenciador de recursos é um recurso comum.</span><span class="sxs-lookup"><span data-stu-id="13d52-110">For example, a connection to a resource manager is a common resource.</span></span> <span data-ttu-id="13d52-111">Os recursos residem na memória do dispensador de recursos e nunca são copiados para o Gerenciador do dispensador.</span><span class="sxs-lookup"><span data-stu-id="13d52-111">Resources reside in the resource dispenser's memory and are never copied to the dispenser manager.</span></span> <span data-ttu-id="13d52-112">Um recurso é conhecido apenas por um identificador opaco (**Resid**) e pode ou não ser capaz de executar transações.</span><span class="sxs-lookup"><span data-stu-id="13d52-112">A resource is known only by an opaque handle (**RESID**) and may or may not be capable of performing transactions.</span></span> <span data-ttu-id="13d52-113">Embora os recursos gerenciados possam muitas vezes ser conexões com um componente que gerencia um estado durável, as próprias conexões não são duráveis.</span><span class="sxs-lookup"><span data-stu-id="13d52-113">Although the resources managed might often be connections to a component managing a durable state, the connections themselves are not durable.</span></span> <span data-ttu-id="13d52-114">Um dispensador de recursos geralmente usa um Gerenciador de recursos relacionado para manter o estado durável.</span><span class="sxs-lookup"><span data-stu-id="13d52-114">A resource dispenser often uses a related resource manager to retain the durable state.</span></span>

 

<span data-ttu-id="13d52-115">Em termos de arquitetura, o sistema do dispensador de recursos COM+ consiste em dispensadores de recursos e um Gerenciador de dispensadores.</span><span class="sxs-lookup"><span data-stu-id="13d52-115">Architecturally, the COM+ resource dispenser system consists of resource dispensers and a dispenser manager.</span></span> <span data-ttu-id="13d52-116">Os dispensadores de recursos são componentes fornecidos pelo usuário que fornecem aplicativos com interfaces simples para recursos compartilhados.</span><span class="sxs-lookup"><span data-stu-id="13d52-116">Resource dispensers are user-supplied components that provide applications with simple interfaces to shared resources.</span></span> <span data-ttu-id="13d52-117">O Gerenciador do dispensador é um componente fornecido pelo COM+ que coordena as atividades de vários dispensadores de recursos.</span><span class="sxs-lookup"><span data-stu-id="13d52-117">The dispenser manager is a component provided by COM+ that coordinates the activities of the various resource dispensers.</span></span>

<span data-ttu-id="13d52-118">Um dispensador de recurso é um componente DLL (biblioteca de vínculo dinâmico) que fornece pelo menos duas interfaces.</span><span class="sxs-lookup"><span data-stu-id="13d52-118">A resource dispenser is a dynamic-link library (DLL) component that provides at least two interfaces.</span></span> <span data-ttu-id="13d52-119">A primeira, [**IDispenserDriver**](/windows/desktop/api/ComSvcs/nn-comsvcs-idispenserdriver), fornece ao Gerenciador de dispensadores informações básicas sobre como criar, destruir e inscrever os recursos que ele gerencia.</span><span class="sxs-lookup"><span data-stu-id="13d52-119">The first, [**IDispenserDriver**](/windows/desktop/api/ComSvcs/nn-comsvcs-idispenserdriver), provides the dispenser manager with basic information on how to create, destroy, and enlist the resources it manages.</span></span> <span data-ttu-id="13d52-120">O segundo é exposto aos aplicativos e pode ser uma interface COM ou um conjunto de interfaces ou pode ser uma API (interface de programação de aplicativo) para a qual um componente está vinculado por meio de uma biblioteca de importação.</span><span class="sxs-lookup"><span data-stu-id="13d52-120">The second is exposed to the applications and can be a COM interface or set of interfaces or can be an application programming interface (API) to which a component is linked via an import library.</span></span> <span data-ttu-id="13d52-121">Um aplicativo pode chamar qualquer dispensador de recursos que, por sua vez, pode oferecer qualquer API para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="13d52-121">An application can call any resource dispenser, which in turn may offer any API to the application.</span></span> <span data-ttu-id="13d52-122">Se o dispensador de recursos for um componente de automação, ele poderá ser acessado do Microsoft Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="13d52-122">If the resource dispenser is an Automation component, it can be accessed from Microsoft Visual Basic.</span></span> <span data-ttu-id="13d52-123">Um dispensador de recurso é instanciado quando um componente de aplicativo faz referência a ele.</span><span class="sxs-lookup"><span data-stu-id="13d52-123">A resource dispenser is instantiated when an application component refers to it.</span></span>

<span data-ttu-id="13d52-124">O Gerenciador do dispensador fornecido pelo COM+ controla os dispensadores de recursos e as coordenadas entre eles.</span><span class="sxs-lookup"><span data-stu-id="13d52-124">The dispenser manager provided by COM+ tracks resource dispensers and coordinates among them.</span></span> <span data-ttu-id="13d52-125">Ele implementa duas interfaces: [**IDispenserManager**](/windows/desktop/api/ComSvcs/nn-comsvcs-idispensermanager) e [**IHolder**](/windows/desktop/api/ComSvcs/nn-comsvcs-iholder).</span><span class="sxs-lookup"><span data-stu-id="13d52-125">It implements two interfaces: [**IDispenserManager**](/windows/desktop/api/ComSvcs/nn-comsvcs-idispensermanager) and [**IHolder**](/windows/desktop/api/ComSvcs/nn-comsvcs-iholder).</span></span> <span data-ttu-id="13d52-126">os dispensadores de recursos se registram usando a interface **IDispenserManager** .</span><span class="sxs-lookup"><span data-stu-id="13d52-126">resource dispensers register themselves using the **IDispenserManager** interface.</span></span> <span data-ttu-id="13d52-127">Em seguida, o Gerenciador do dispensador dá a eles um ponteiro para um **IHolder** que eles usam para notificar o gerente do dispensador sobre suas atividades.</span><span class="sxs-lookup"><span data-stu-id="13d52-127">The dispenser manager then gives them a pointer to an **IHolder** that they use to notify the dispenser manager of their activities.</span></span>

<span data-ttu-id="13d52-128">Um dispensador de recursos transacionais deve se inscrever em uma transação Coordenador de Transações Distribuídas (DTC).</span><span class="sxs-lookup"><span data-stu-id="13d52-128">A transactional resource dispenser must enlist in a Distributed Transaction Coordinator (DTC) transaction.</span></span> <span data-ttu-id="13d52-129">Isso implica o uso de um Gerenciador de recursos interno ou externo (para o dispensador de recursos) que é compatível com transações OLE.</span><span class="sxs-lookup"><span data-stu-id="13d52-129">This implies use of either an internal or an external (to the resource dispenser) resource manager that is OLE transactions-compliant.</span></span>

> [!Note]  
> <span data-ttu-id="13d52-130">O modelo de programação COM+ inclui *Transações declarativas*, que ajudam a proteger o trabalho executado por um objeto de aplicativo durante seu tempo de vida.</span><span class="sxs-lookup"><span data-stu-id="13d52-130">The COM+ programming model includes *declarative transactions*, which help protect the work performed by an application object during its lifetime.</span></span> <span data-ttu-id="13d52-131">Quando um objeto de aplicativo usa um dispensador de recursos COM+, o trabalho que ele executa é transacional automaticamente; ou seja, o componente não precisa declarar explicitamente as transações.</span><span class="sxs-lookup"><span data-stu-id="13d52-131">When an application object uses a COM+ resource dispenser, the work it performs is automatically transactional; that is, the component doesn't have to explicitly declare transactions.</span></span> <span data-ttu-id="13d52-132">Essas transações são definidas na especificação de transações OLE, implementadas pelo DTC e iniciadas em nome do objeto de aplicativo por COM+.</span><span class="sxs-lookup"><span data-stu-id="13d52-132">These transactions are defined in the OLE Transactions specification, implemented by the DTC, and initiated on behalf of the application object by COM+.</span></span> <span data-ttu-id="13d52-133">Consulte o guia de desenvolvimento do DTC para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="13d52-133">See the DTC Development Guide for more information.</span></span>

 

<span data-ttu-id="13d52-134">Os recursos não precisam ser transacionais.</span><span class="sxs-lookup"><span data-stu-id="13d52-134">Resources need not be transactional.</span></span> <span data-ttu-id="13d52-135">Um dispensador de recursos que agrupa recursos não transacionais ainda pode alcançar alto desempenho, permitindo que os objetos de aplicativo acessem um pool compartilhado desses recursos.</span><span class="sxs-lookup"><span data-stu-id="13d52-135">A resource dispenser that pools non-transactional resources can still achieve high performance by allowing application objects to access a shared pool of these resources.</span></span> <span data-ttu-id="13d52-136">Esse tipo de dispensador de recurso retorna S \_ false do método [**IDispenserDriver:: EnlistResource**](/windows/desktop/api/ComSvcs/nf-comsvcs-idispenserdriver-enlistresource) , o que significa que o dispensador de recurso não inscreveu o recurso porque o recurso não é transacional.</span><span class="sxs-lookup"><span data-stu-id="13d52-136">This type of resource dispenser returns S\_FALSE from the [**IDispenserDriver::EnlistResource**](/windows/desktop/api/ComSvcs/nf-comsvcs-idispenserdriver-enlistresource) method, which means that the resource dispenser did not enlist the resource because the resource is not transactional.</span></span>

<span data-ttu-id="13d52-137">O dispensador de recursos também pode funcionar independentemente do COM+, fornecendo apenas recursos de pool de recursos.</span><span class="sxs-lookup"><span data-stu-id="13d52-137">The resource dispenser can also function independently of COM+, providing only resource pooling capabilities.</span></span> <span data-ttu-id="13d52-138">Por exemplo, se um dispensador de recursos expõe uma API (como ODBC), o dispensador de recursos pode ser uma DLL que é acessada pelo aplicativo por meio de uma biblioteca de importação (ou usando as funções [**LoadLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-loadlibrarya) e [**GetProcAddress**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getprocaddress) ).</span><span class="sxs-lookup"><span data-stu-id="13d52-138">For example, if a resource dispenser exposes an API (such as ODBC), the resource dispenser might be a DLL that is accessed by the application through an import library (or using the [**LoadLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-loadlibrarya) and [**GetProcAddress**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getprocaddress) functions).</span></span> <span data-ttu-id="13d52-139">Um dispensador de recurso também pode ser um componente COM que um aplicativo acessa chamando [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance).</span><span class="sxs-lookup"><span data-stu-id="13d52-139">A resource dispenser might also be a COM component that an application accesses by calling [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance).</span></span> <span data-ttu-id="13d52-140">Sem o COM+, um método [**EnlistResource**](/windows/desktop/api/ComSvcs/nf-comsvcs-idispenserdriver-enlistresource) do dispensador de recursos nunca pode ser chamado porque o Gerenciador do dispensador não tem conhecimento da transação do componente atual.</span><span class="sxs-lookup"><span data-stu-id="13d52-140">Without COM+, a resource dispenser's [**EnlistResource**](/windows/desktop/api/ComSvcs/nf-comsvcs-idispenserdriver-enlistresource) method can never be called because the dispenser manager has no knowledge of the current component transaction.</span></span>

<span data-ttu-id="13d52-141">Na inicialização, uma DLL de dispensador de recurso deve se registrar com o Gerenciador do dispensador.</span><span class="sxs-lookup"><span data-stu-id="13d52-141">On startup, a resource dispenser DLL must register itself with the dispenser manager.</span></span> <span data-ttu-id="13d52-142">O Gerenciador do dispensador é o executivo de controle que gerencia o carregamento e o descarregamento de dispensadores de recursos, fornece o contexto COM+ e controla o Gerenciador de estatísticas de inventário.</span><span class="sxs-lookup"><span data-stu-id="13d52-142">The dispenser manager is the controlling executive that manages the loading and unloading of resource dispensers, provides the COM+ context, and controls the inventory statistics manager.</span></span> <span data-ttu-id="13d52-143">(Para obter mais informações, consulte [Gerenciador do dispensador do com+](com--dispenser-manager.md).) O dispensador de recurso primeiro chama a função [**GetDispenserManager**](/windows/desktop/api/MtxDM/nf-mtxdm-getdispensermanager) e, em seguida, chama o método [**IDispenserManager:: RegisterDispenser**](/windows/desktop/api/ComSvcs/nf-comsvcs-idispensermanager-registerdispenser) , passando o ponteiro [**IDispenserDriver**](/windows/desktop/api/ComSvcs/nn-comsvcs-idispenserdriver) que o dispensador de recurso implementa.</span><span class="sxs-lookup"><span data-stu-id="13d52-143">(For more information, see [COM+ Dispenser Manager](com--dispenser-manager.md).) The resource dispenser first calls the [**GetDispenserManager**](/windows/desktop/api/MtxDM/nf-mtxdm-getdispensermanager) function and then calls the [**IDispenserManager::RegisterDispenser**](/windows/desktop/api/ComSvcs/nf-comsvcs-idispensermanager-registerdispenser) method, passing the [**IDispenserDriver**](/windows/desktop/api/ComSvcs/nn-comsvcs-idispenserdriver) pointer that the resource dispenser implements.</span></span> <span data-ttu-id="13d52-144">Essa chamada retorna uma referência a [**IHolder**](/windows/desktop/api/ComSvcs/nn-comsvcs-iholder).</span><span class="sxs-lookup"><span data-stu-id="13d52-144">This call returns a reference to [**IHolder**](/windows/desktop/api/ComSvcs/nn-comsvcs-iholder).</span></span>

<span data-ttu-id="13d52-145">Para desligar, um dispensador de recurso chama [**IHolder:: Close**](/windows/desktop/api/ComSvcs/nf-comsvcs-iholder-close).</span><span class="sxs-lookup"><span data-stu-id="13d52-145">To shut down, a resource dispenser calls [**IHolder::Close**](/windows/desktop/api/ComSvcs/nf-comsvcs-iholder-close).</span></span> <span data-ttu-id="13d52-146">Para garantir um desligamento limpo do pacote, um dispensador de recursos deve ser capaz de lidar com a situação em que as chamadas continuam a chegar de objetos comerciais depois que o COM+ pediu para o desligamento do dispensador.</span><span class="sxs-lookup"><span data-stu-id="13d52-146">To ensure a clean package shutdown, a resource dispenser must be able to handle the situation when calls continue to arrive from business objects after COM+ has asked the dispenser to shut down.</span></span>

<span data-ttu-id="13d52-147">Os tópicos a seguir nesta seção fornecem informações mais detalhadas sobre o serviço do dispensador de recursos COM+:</span><span class="sxs-lookup"><span data-stu-id="13d52-147">The following topics in this section provide more detailed information about the COM+ resource dispenser service:</span></span>

-   [<span data-ttu-id="13d52-148">Gerenciador do dispensador COM+</span><span class="sxs-lookup"><span data-stu-id="13d52-148">COM+ Dispenser Manager</span></span>](com--dispenser-manager.md)
-   [<span data-ttu-id="13d52-149">Tipos de thread do dispensador de recursos COM+</span><span class="sxs-lookup"><span data-stu-id="13d52-149">COM+ Resource Dispenser Thread Types</span></span>](com--resource-dispenser-thread-types.md)
-   [<span data-ttu-id="13d52-150">Estados de recursos em pool disponíveis para o dispensador de recursos COM+</span><span class="sxs-lookup"><span data-stu-id="13d52-150">Pooled Resource States Available to COM+ Resource Dispenser</span></span>](pooled-resource-states-available-to-com--resource-dispenser.md)
-   [<span data-ttu-id="13d52-151">Inlistando um recurso em uma transação</span><span class="sxs-lookup"><span data-stu-id="13d52-151">Enlisting a Resource in a Transaction</span></span>](enlisting-a-resource-in-a-transaction.md)
-   [<span data-ttu-id="13d52-152">Processo de alocação de recursos do dispensador de recursos</span><span class="sxs-lookup"><span data-stu-id="13d52-152">Resource Dispenser Resource Allocation Process</span></span>](resource-dispenser-resource-allocation-process.md)
-   [<span data-ttu-id="13d52-153">Controlando recursos não alocados</span><span class="sxs-lookup"><span data-stu-id="13d52-153">Tracking Non-Allocated Resources</span></span>](tracking-non-allocated-resources.md)
-   [<span data-ttu-id="13d52-154">Recuperação automática de recursos</span><span class="sxs-lookup"><span data-stu-id="13d52-154">Automatic Resource Reclamation</span></span>](automatic-resource-reclamation.md)
-   [<span data-ttu-id="13d52-155">Tipos usados em interfaces de dispensador de recursos COM+</span><span class="sxs-lookup"><span data-stu-id="13d52-155">Types Used in COM+ Resource Dispenser Interfaces</span></span>](types-used-in-com--resource-dispenser-interfaces.md)
-   [<span data-ttu-id="13d52-156">Interfaces do dispensador de recursos COM+</span><span class="sxs-lookup"><span data-stu-id="13d52-156">COM+ Resource Dispenser Interfaces</span></span>](com--resource-dispenser-interfaces.md)

## <a name="related-topics"></a><span data-ttu-id="13d52-157">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="13d52-157">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="13d52-158">Tarefas do dispensador de recursos COM+</span><span class="sxs-lookup"><span data-stu-id="13d52-158">COM+ Resource Dispenser Tasks</span></span>](com--resource-dispenser-tasks.md)
</dt> </dl>

 

 
