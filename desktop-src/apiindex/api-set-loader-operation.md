---
description: Descreve como o Windows 10 usa conjuntos de API em operações de carregador.
title: Operação de carregador de conjunto de API
ms.topic: article
ms.date: 10/14/2020
ms.openlocfilehash: 701409c0d8dac2c275add06d2502c8764d502aba
ms.sourcegitcommit: bf526e267d3991892733bdd229c66d5365cf244a
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 02/05/2021
ms.locfileid: "105793761"
---
# <a name="api-set-loader-operation"></a><span data-ttu-id="5323b-103">Operação de carregador de conjunto de API</span><span class="sxs-lookup"><span data-stu-id="5323b-103">API set loader operation</span></span>

<span data-ttu-id="5323b-104">Os [conjuntos de API](windows-apisets.md) dependem do suporte do so no carregador de biblioteca para introduzir efetivamente um redirecionamento de namespace de módulo para o processo de associação de biblioteca.</span><span class="sxs-lookup"><span data-stu-id="5323b-104">[API sets](windows-apisets.md) rely on OS support in the library loader to effectively introduce a module namespace redirection into the library binding process.</span></span> <span data-ttu-id="5323b-105">O [nome do contrato do conjunto de API](windows-apisets.md#api-set-contract-names) é usado pelo carregador de biblioteca para executar um redirecionamento de tempo de execução da referência a um binário de host de destino que hospeda a implementação apropriada do conjunto de API.</span><span class="sxs-lookup"><span data-stu-id="5323b-105">The [API set contract name](windows-apisets.md#api-set-contract-names) is used by library loader to perform a runtime redirection of the reference to a target host binary that houses the appropriate implementation of the API set.</span></span>

<span data-ttu-id="5323b-106">Quando o carregador encontra uma dependência em um conjunto de API em tempo de execução, o carregador consulta os dados de configuração na imagem para identificar o binário de host para um conjunto de API.</span><span class="sxs-lookup"><span data-stu-id="5323b-106">When the loader encounters a dependency on an API set at run time, the loader consults configuration data in the image to identify the host binary for an API set.</span></span> <span data-ttu-id="5323b-107">Esses dados de configuração são chamados de **esquema de conjunto de API**.</span><span class="sxs-lookup"><span data-stu-id="5323b-107">This configuration data is called the **API set schema**.</span></span> <span data-ttu-id="5323b-108">O esquema é montado como uma propriedade do sistema operacional, e o mapeamento entre conjuntos de API e binários pode diferir dependendo de quais binários são incluídos em um determinado dispositivo.</span><span class="sxs-lookup"><span data-stu-id="5323b-108">The schema is assembled as a property of the OS, and the mapping between API sets and binaries may differ depending on which binaries are included in a given device.</span></span> <span data-ttu-id="5323b-109">O esquema permite que uma função importada em um único binário seja roteada corretamente em diferentes dispositivos, mesmo que os nomes de módulo do host binário tenham sido renomeados ou completamente refatorado em diferentes dispositivos Windows.</span><span class="sxs-lookup"><span data-stu-id="5323b-109">The schema enables an imported function in a single binary to be routed correctly on different devices, even if the module names of the binary host have been renamed or completely refactored on different Windows devices.</span></span>

<span data-ttu-id="5323b-110">O Windows 10 dá suporte a duas técnicas padrão para consumir e usar a interface com conjuntos de API: **encaminhamento direto** e **encaminhamento reverso**.</span><span class="sxs-lookup"><span data-stu-id="5323b-110">Windows 10 supports two standard techniques to consume and interface with API sets: **direct forwarding** and **reverse forwarding**.</span></span>

### <a name="direct-forwarding"></a><span data-ttu-id="5323b-111">Encaminhamento direto</span><span class="sxs-lookup"><span data-stu-id="5323b-111">Direct forwarding</span></span>

<span data-ttu-id="5323b-112">Nessa configuração, o código de consumo importa um nome de módulo de conjunto de API diretamente.</span><span class="sxs-lookup"><span data-stu-id="5323b-112">In this configuration, the consuming code imports an API set module name directly.</span></span> <span data-ttu-id="5323b-113">Essa importação é resolvida em uma única operação e é o método mais eficiente com a menor sobrecarga.</span><span class="sxs-lookup"><span data-stu-id="5323b-113">This import is resolved in a single operation, and is the most efficient method with the least overhead.</span></span> <span data-ttu-id="5323b-114">Conceitualmente, essa resolução pode apontar para diferentes binários em dispositivos Windows 10 diferentes, como é mostrado no exemplo a seguir:</span><span class="sxs-lookup"><span data-stu-id="5323b-114">Conceptually, this resolution may point to different binaries on different Windows 10 devices, as is shown in the following example:</span></span>

<span data-ttu-id="5323b-115">Conjunto de API importado: **api-feature1-l1-1-0.dll**</span><span class="sxs-lookup"><span data-stu-id="5323b-115">Imported API set: **api-feature1-l1-1-0.dll**</span></span>
-  <span data-ttu-id="5323b-116">PC com Windows > **feature1.dll**</span><span class="sxs-lookup"><span data-stu-id="5323b-116">Windows PC -> **feature1.dll**</span></span>
-  <span data-ttu-id="5323b-117">> de HoloLens- **feature1_holo.dll**</span><span class="sxs-lookup"><span data-stu-id="5323b-117">HoloLens -> **feature1_holo.dll**</span></span>
-  <span data-ttu-id="5323b-118">> IoT **feature1_iot.dll**</span><span class="sxs-lookup"><span data-stu-id="5323b-118">IoT -> **feature1_iot.dll**</span></span>

<span data-ttu-id="5323b-119">Como os mapeamentos são mantidos em um repositório de dados de esquema personalizado, isso significa que um nome de conjunto de API que termina com **. dll** não se refere diretamente a um arquivo no disco.</span><span class="sxs-lookup"><span data-stu-id="5323b-119">Because the mappings are kept in a custom schema data repository, it means that an API set name that ends with **.dll** does not directly refer to a file on disk.</span></span> <span data-ttu-id="5323b-120">A parte **. dll** do nome do conjunto de API é apenas uma convenção exigida pelo carregador.</span><span class="sxs-lookup"><span data-stu-id="5323b-120">The **.dll** part of the API set name is only a convention required by the loader.</span></span> <span data-ttu-id="5323b-121">O nome do conjunto de APIs é mais parecido com um alias ou um nome virtual para um arquivo DLL físico.</span><span class="sxs-lookup"><span data-stu-id="5323b-121">The API set name is more like an alias or a virtual name for a physical DLL file.</span></span> <span data-ttu-id="5323b-122">Isso torna o nome portátil em todo o intervalo de dispositivos com Windows 10.</span><span class="sxs-lookup"><span data-stu-id="5323b-122">This makes the name portable across the entire range of Windows 10 devices.</span></span>

### <a name="reverse-forwarding"></a><span data-ttu-id="5323b-123">Encaminhamento reverso</span><span class="sxs-lookup"><span data-stu-id="5323b-123">Reverse forwarding</span></span>

<span data-ttu-id="5323b-124">Embora os nomes de conjunto de API forneçam um namespace estável para módulos entre dispositivos, nem sempre é prático converter cada binário nesse novo sistema.</span><span class="sxs-lookup"><span data-stu-id="5323b-124">While API set names provide a stable namespace for modules across devices, it is not always practical to convert every binary to this new system.</span></span> <span data-ttu-id="5323b-125">Por exemplo, um aplicativo pode estar em uso comum por muitos anos e a recompilação dos binários do aplicativo pode não ser viável.</span><span class="sxs-lookup"><span data-stu-id="5323b-125">For example, an application may have been in common use for many years, and recompiling the application's binaries may not be feasible.</span></span> <span data-ttu-id="5323b-126">Além disso, alguns aplicativos podem precisar continuar executando em sistemas criados antes que determinados conjuntos de API sejam introduzidos.</span><span class="sxs-lookup"><span data-stu-id="5323b-126">Additionally, some applications may need to continue to run on systems built before specific API sets were introduced.</span></span>

<span data-ttu-id="5323b-127">Para acomodar esse nível de compatibilidade, um sistema de *encaminhadores* é fornecido em todos os dispositivos Windows 10 que abrangem um subconjunto da superfície da API do Win32.</span><span class="sxs-lookup"><span data-stu-id="5323b-127">To accommodate this level of compatibility, a system of *forwarders* are provided on all Windows 10 devices that cover a subset of the Win32 API surface.</span></span> <span data-ttu-id="5323b-128">Esses encaminhadores usam os nomes de módulo que foram introduzidos em computadores Windows e aproveitam o sistema de configuração de API para fornecer compatibilidade em todos os dispositivos Windows 10.</span><span class="sxs-lookup"><span data-stu-id="5323b-128">These forwarders use the module names that were introduced on Windows PCs, and leverage the API Set system to provide compatibility across all Windows 10 devices.</span></span>

<span data-ttu-id="5323b-129">A operação do carregador se comporta desta forma:</span><span class="sxs-lookup"><span data-stu-id="5323b-129">The loader operation behaves like this:</span></span>

1.  <span data-ttu-id="5323b-130">Em um dispositivo que não seja um computador Windows, o carregador recebe uma dependência de nome de módulo de computador Windows herdada que não está presente no dispositivo.</span><span class="sxs-lookup"><span data-stu-id="5323b-130">On a device other than a Windows PC, the loader is presented a legacy Windows PC module name dependency that is not present on the device.</span></span>
2.  <span data-ttu-id="5323b-131">O carregador localiza um encaminhador de conjunto de API para este módulo e o carrega na memória.</span><span class="sxs-lookup"><span data-stu-id="5323b-131">The loader locates an API set forwarder for this module and loads it into memory.</span></span>
3.  <span data-ttu-id="5323b-132">O encaminhador tem um mapeamento para a API definida para a função fornecida que está sendo chamada.</span><span class="sxs-lookup"><span data-stu-id="5323b-132">The forwarder has a mapping for the API set for the given function being called.</span></span>
4.  <span data-ttu-id="5323b-133">O carregador localiza o binário de host apropriado para o dispositivo especificado.</span><span class="sxs-lookup"><span data-stu-id="5323b-133">The loader finds the proper host binary for the given device.</span></span>

<span data-ttu-id="5323b-134">Conceitualmente, o mapeamento é semelhante a:</span><span class="sxs-lookup"><span data-stu-id="5323b-134">Conceptually, the mapping looks like:</span></span>

<span data-ttu-id="5323b-135">DLL importada: **feature1.dll**</span><span class="sxs-lookup"><span data-stu-id="5323b-135">Imported DLL: **feature1.dll**</span></span>
- <span data-ttu-id="5323b-136">PC com Windows > **feature1.dll**</span><span class="sxs-lookup"><span data-stu-id="5323b-136">Windows PC -> **feature1.dll**</span></span>
- <span data-ttu-id="5323b-137">HoloLens-> **feature1.dll** encaminhador-> **api-feature1-l1-1-0.dll**  ->  **feature1_holo.dll**</span><span class="sxs-lookup"><span data-stu-id="5323b-137">HoloLens -> **feature1.dll** forwarder -> **api-feature1-l1-1-0.dll** -> **feature1_holo.dll**</span></span>
- <span data-ttu-id="5323b-138">IOT-> **feature1.dll** encaminhador > **api-feature1-l1-1-0.dll**  ->  **feature1_iot.dll**</span><span class="sxs-lookup"><span data-stu-id="5323b-138">IoT -> **feature1.dll** forwarder -> **api-feature1-l1-1-0.dll** -> **feature1_iot.dll**</span></span>

<span data-ttu-id="5323b-139">O resultado final é funcionalmente o mesmo que o [encaminhamento direto](#direct-forwarding), mas o realiza de forma a maximizar a compatibilidade de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="5323b-139">The end result is functionally the same as [direct forwarding](#direct-forwarding), but it accomplishes it in a way that maximizes application compatibility.</span></span>

> [!NOTE]
> <span data-ttu-id="5323b-140">O encaminhamento reverso fornece cobertura apenas para um subconjunto da superfície da API do Win32.</span><span class="sxs-lookup"><span data-stu-id="5323b-140">Reverse forwarding provides coverage only for a subset of the Win32 API surface.</span></span> <span data-ttu-id="5323b-141">Ele não permite que aplicativos direcionados a versões da área de trabalho do Windows 10 sejam executados em todos os dispositivos Windows 10.</span><span class="sxs-lookup"><span data-stu-id="5323b-141">It does not allow applications that target desktop versions of Windows 10 to run on all Windows 10 devices.</span></span>
