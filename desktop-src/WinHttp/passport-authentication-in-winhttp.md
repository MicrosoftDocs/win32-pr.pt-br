---
description: O Microsoft Windows HTTP Services (WinHTTP) dá suporte total ao uso no lado do cliente do protocolo de autenticação Microsoft Passport. Este tópico fornece uma visão geral das transações envolvidas na autenticação do Passport e como tratá-las.
ms.assetid: 395d7aef-4da0-4664-8328-7d31ce58fedd
title: Autenticação do Passport no WinHTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7b8fc00217c7c14fbd4635fab68398d2056c1ea5
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104457240"
---
# <a name="passport-authentication-in-winhttp"></a><span data-ttu-id="f5545-104">Autenticação do Passport no WinHTTP</span><span class="sxs-lookup"><span data-stu-id="f5545-104">Passport Authentication in WinHTTP</span></span>

<span data-ttu-id="f5545-105">O Microsoft Windows HTTP Services (WinHTTP) dá suporte total ao uso no lado do cliente do protocolo de autenticação Microsoft Passport.</span><span class="sxs-lookup"><span data-stu-id="f5545-105">Microsoft Windows HTTP Services (WinHTTP) fully support the client side use of the Microsoft Passport authentication protocol.</span></span> <span data-ttu-id="f5545-106">Este tópico fornece uma visão geral das transações envolvidas na autenticação do Passport e como tratá-las.</span><span class="sxs-lookup"><span data-stu-id="f5545-106">This topic provides an overview of the transactions involved in Passport authentication and how to handle them.</span></span>

> [!Note]  
> <span data-ttu-id="f5545-107">No WinHTTP 5,1, a autenticação do Passport está desabilitada por padrão.</span><span class="sxs-lookup"><span data-stu-id="f5545-107">In WinHTTP 5.1, Passport authentication is disabled by default.</span></span>

 

## <a name="passport-14"></a><span data-ttu-id="f5545-108">Passport 1,4</span><span class="sxs-lookup"><span data-stu-id="f5545-108">Passport 1.4</span></span>

<span data-ttu-id="f5545-109">O Passport é um componente fundamental dos serviços de blocos de construção de Microsoft .NET.</span><span class="sxs-lookup"><span data-stu-id="f5545-109">Passport is a core component of the Microsoft .NET building block services.</span></span> <span data-ttu-id="f5545-110">Ele permite que as empresas desenvolvam e ofereçam serviços Web distribuídos em uma ampla variedade de aplicativos e permite que seus membros usem um nome de entrada e senha em todos os sites participantes.</span><span class="sxs-lookup"><span data-stu-id="f5545-110">It enables businesses to develop and offer distributed Web services across a wide range of applications and enables its members to use one sign-in name and password at all participating Web sites.</span></span>

<span data-ttu-id="f5545-111">O WinHTTP fornece suporte de plataforma para o Microsoft Passport 1,4 implementando o protocolo do lado do cliente para a autenticação do Passport 1,4.</span><span class="sxs-lookup"><span data-stu-id="f5545-111">WinHTTP provides platform support for Microsoft Passport 1.4 by implementing the client-side protocol for Passport 1.4 authentication.</span></span> <span data-ttu-id="f5545-112">Ele libera os aplicativos dos detalhes da interação com a infraestrutura do Passport e os nomes de usuário e senhas armazenados no Windows XP.</span><span class="sxs-lookup"><span data-stu-id="f5545-112">It frees applications from the details of interacting with the Passport infrastructure and the Stored User Names and Passwords in Windows XP.</span></span> <span data-ttu-id="f5545-113">Essa abstração torna o uso do Passport não diferente da perspectiva de um desenvolvedor do que usar esquemas de autenticação tradicionais, como Basic ou Digest.</span><span class="sxs-lookup"><span data-stu-id="f5545-113">This abstraction makes using Passport no different from a developer's perspective than using traditional authentication schemes like Basic or Digest.</span></span>

<span data-ttu-id="f5545-114">**Windows XP:** A chave de registro **HKCU \\ software \\ Microsoft \\ Windows \\ CurrentVersion \\ Internet Settings \\ Passport \\ NumRegistrationRuns** identifica o número de vezes que o assistente de autenticação do Passport é exibido quando a autenticação do Passport é necessária.</span><span class="sxs-lookup"><span data-stu-id="f5545-114">**Windows XP:** The **HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\Passport\\NumRegistrationRuns** registry key identifies the number of times the Passport Authentication Wizard is displayed when PassPort authentication is required.</span></span> <span data-ttu-id="f5545-115">Se o valor dessa chave for definido como um número maior que 5, o assistente não será exibido.</span><span class="sxs-lookup"><span data-stu-id="f5545-115">If the value for this key is set to a number greater than 5, the wizard is not displayed.</span></span>

<span data-ttu-id="f5545-116">As seções a seguir descrevem as transações envolvidas na autenticação do Passport a partir do ponto de vista de um aplicativo cliente.</span><span class="sxs-lookup"><span data-stu-id="f5545-116">The following sections describe the transactions involved in Passport authentication from the point of view of a client application.</span></span> <span data-ttu-id="f5545-117">Para o desenvolvimento do Passport no lado do servidor, consulte Visão geral da documentação do SDK do Passport.</span><span class="sxs-lookup"><span data-stu-id="f5545-117">For server-side Passport development, see the Passport SDK Documentation Overview.</span></span>

-   [<span data-ttu-id="f5545-118">Solicitação inicial</span><span class="sxs-lookup"><span data-stu-id="f5545-118">Initial Request</span></span>](#initial-request)
-   [<span data-ttu-id="f5545-119">Servidor de logon do Passport</span><span class="sxs-lookup"><span data-stu-id="f5545-119">Passport Login Server</span></span>](#passport-login-server)
-   [<span data-ttu-id="f5545-120">Solicitação autenticada</span><span class="sxs-lookup"><span data-stu-id="f5545-120">Authenticated Request</span></span>](#authenticated-request)

### <a name="initial-request"></a><span data-ttu-id="f5545-121">Solicitação inicial</span><span class="sxs-lookup"><span data-stu-id="f5545-121">Initial Request</span></span>

<span data-ttu-id="f5545-122">Quando um cliente solicita um recurso em um servidor que requer autenticação do Passport, o servidor verifica a solicitação da presença de [*tíquetes*](glossary.md).</span><span class="sxs-lookup"><span data-stu-id="f5545-122">When a client requests a resource on a server that requires Passport authentication, the server checks the request for the presence of [*tickets*](glossary.md).</span></span> <span data-ttu-id="f5545-123">Se um *tíquete* válido for enviado com a solicitação, o servidor responderá com o recurso solicitado.</span><span class="sxs-lookup"><span data-stu-id="f5545-123">If a valid *ticket* is sent with the request, the server responds with the requested resource.</span></span> <span data-ttu-id="f5545-124">Se o *tíquete* não existir no cliente, o servidor responderá com um código de status 302.</span><span class="sxs-lookup"><span data-stu-id="f5545-124">If the *ticket* does not exist on the client, the server responds with a 302 status code.</span></span> <span data-ttu-id="f5545-125">A resposta inclui o cabeçalho de desafio "WWW-Authenticate: Passport 1.4".</span><span class="sxs-lookup"><span data-stu-id="f5545-125">The response includes the challenge header, "WWW-Authenticate: Passport1.4".</span></span> <span data-ttu-id="f5545-126">Os clientes que não estão usando o Passport podem seguir o redirecionamento para o servidor de logon do Passport.</span><span class="sxs-lookup"><span data-stu-id="f5545-126">Clients that are not using Passport can follow the redirection to the Passport login server.</span></span> <span data-ttu-id="f5545-127">Clientes mais avançados normalmente entram em contato com o Passport Nexus para determinar o local do servidor de logon do Passport.</span><span class="sxs-lookup"><span data-stu-id="f5545-127">More advanced clients typically contact the Passport nexus to determine the location of the Passport login server.</span></span>

> [!Note]  
> <span data-ttu-id="f5545-128">Central para a Microsoft Passport rede é o Passport *Nexus*, que facilita a sincronização de sites de participantes do Passport para garantir que cada site tenha os detalhes mais recentes sobre a configuração de rede e outros problemas.</span><span class="sxs-lookup"><span data-stu-id="f5545-128">Central to the Microsoft Passport network is the Passport *Nexus*, which facilitates synchronization of Passport participant sites to assure that each site has the latest details on network configuration and other issues.</span></span> <span data-ttu-id="f5545-129">Cada componente do Passport (Gerenciador do Passport, servidores de logon, servidores de atualização e assim por diante) se comunica periodicamente com o Nexus para recuperar as informações necessárias para localizar e se comunicar corretamente com os outros componentes na rede do Passport.</span><span class="sxs-lookup"><span data-stu-id="f5545-129">Each Passport component (Passport Manager, Login servers, Update servers, and so on) periodically communicates with the Nexus to retrieve the information it needs to locate, and properly communicate with, the other components in the Passport network.</span></span> <span data-ttu-id="f5545-130">Essas informações são recuperadas como um documento XML chamado documento de configuração de componente ou CCD.</span><span class="sxs-lookup"><span data-stu-id="f5545-130">This information is retrieved as an XML document called a Component Configuration Document, or CCD.</span></span>

 

<span data-ttu-id="f5545-131">A imagem a seguir mostra a solicitação inicial para uma afiliada do Passport.</span><span class="sxs-lookup"><span data-stu-id="f5545-131">The following image shows the initial request to a Passport affiliate.</span></span>

![imagem mostra a solicitação inicial para uma afiliada do Passport.](images/art-passport1.png)

### <a name="passport-login-server"></a><span data-ttu-id="f5545-133">Servidor de logon do Passport</span><span class="sxs-lookup"><span data-stu-id="f5545-133">Passport Login Server</span></span>

<span data-ttu-id="f5545-134">Um servidor de logon do Passport trata todas as solicitações de [*tíquetes*](glossary.md) para qualquer recurso em uma *autoridade de domínio* do Passport.</span><span class="sxs-lookup"><span data-stu-id="f5545-134">A Passport login server handles all requests for [*tickets*](glossary.md) for any resource in a Passport *domain authority*.</span></span> <span data-ttu-id="f5545-135">Antes que uma solicitação possa ser autenticada usando o Passport, o aplicativo cliente deve entrar em contato com o servidor de logon para obter os *tíquetes* apropriados.</span><span class="sxs-lookup"><span data-stu-id="f5545-135">Before a request can be authenticated using Passport, the client application must contact the login server to obtain the appropriate *tickets*.</span></span>

<span data-ttu-id="f5545-136">Quando um cliente solicita [*tíquetes*](glossary.md) de um servidor de logon do Passport, o servidor de logon normalmente responde com um código de status 401 para indicar que as credenciais do usuário devem ser fornecidas.</span><span class="sxs-lookup"><span data-stu-id="f5545-136">When a client requests [*tickets*](glossary.md) from a Passport login server, the login server typically responds with a 401 status code to indicate that user credentials must be provided.</span></span> <span data-ttu-id="f5545-137">Quando essas credenciais são fornecidas, o servidor de logon responde com os *tíquetes* necessários para acessar o recurso especificado no servidor que contém o recurso solicitado originalmente.</span><span class="sxs-lookup"><span data-stu-id="f5545-137">When these credentials are provided, the login server responds with the *tickets* required to access the specified resource on the server that contains the originally requested resource.</span></span> <span data-ttu-id="f5545-138">O servidor de logon também pode redirecionar o cliente para outro servidor que possa fornecer o recurso solicitado.</span><span class="sxs-lookup"><span data-stu-id="f5545-138">The login server can also redirect the client to another server that can provide the requested resource.</span></span>

![imagem mostra uma solicitação de tíquete de cliente para um servidor de logon do Passport.](images/art-passport2.png)

### <a name="authenticated-request"></a><span data-ttu-id="f5545-140">Solicitação autenticada</span><span class="sxs-lookup"><span data-stu-id="f5545-140">Authenticated Request</span></span>

<span data-ttu-id="f5545-141">Quando o cliente tem os [*tíquetes*](glossary.md) que correspondem a um determinado servidor, esses *tíquetes* são incluídos em todas as solicitações para esse servidor.</span><span class="sxs-lookup"><span data-stu-id="f5545-141">When the client has the [*tickets*](glossary.md) that correspond to a given server, those *tickets* are included with all requests to that server.</span></span> <span data-ttu-id="f5545-142">Se os *tíquetes* não tiverem sido modificados desde que foram recuperados do servidor de logon do Passport e os *tíquetes* forem válidos para o servidor de recursos, o servidor de recursos enviará uma resposta que inclui o recurso solicitado e os cookies que indicam que o usuário é autenticado para solicitações futuras.</span><span class="sxs-lookup"><span data-stu-id="f5545-142">If the *tickets* have not been modified since they were retrieved from the Passport login server, and the *tickets* are valid for the resource server, the resource server sends a response that includes both the requested resource and cookies that indicate that the user is authenticated for future requests.</span></span>

<span data-ttu-id="f5545-143">Os cookies adicionais na resposta destinam-se a acelerar o processo de autenticação.</span><span class="sxs-lookup"><span data-stu-id="f5545-143">The additional cookies in the response are intended to speed the authentication process.</span></span> <span data-ttu-id="f5545-144">Todas as solicitações adicionais na mesma sessão para recursos em servidores na mesma autoridade de domínio do Passport incluem esses cookies adicionais.</span><span class="sxs-lookup"><span data-stu-id="f5545-144">Additional requests in the same session for resources on servers in the same Passport Domain Authority all include these additional cookies.</span></span> <span data-ttu-id="f5545-145">As credenciais não precisam ser enviadas ao servidor de logon novamente até que os cookies expirem.</span><span class="sxs-lookup"><span data-stu-id="f5545-145">Credentials do not need to be sent to the login server again until the cookies expire.</span></span>

![imagem mostra uma solicitação autenticada para o servidor de logon do Passport.](images/art-passport3.png)

## <a name="using-passport-in-winhttp"></a><span data-ttu-id="f5545-147">Usando o Passport no WinHTTP</span><span class="sxs-lookup"><span data-stu-id="f5545-147">Using Passport in WinHTTP</span></span>

<span data-ttu-id="f5545-148">A autenticação do Passport no WinHTTP é muito semelhante a outros esquemas de autenticação.</span><span class="sxs-lookup"><span data-stu-id="f5545-148">Passport authentication in WinHTTP is very similar to other authentication schemes.</span></span> <span data-ttu-id="f5545-149">Consulte [autenticação no WinHTTP](authentication-in-winhttp.md) para obter uma visão geral da autenticação no WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="f5545-149">See [Authentication in WinHTTP](authentication-in-winhttp.md) for an overview of authentication in WinHTTP.</span></span>

<span data-ttu-id="f5545-150">No WinHTTP 5,1, a autenticação do Passport é desabilitada por padrão e deve ser explicitamente habilitada com [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) antes do uso.</span><span class="sxs-lookup"><span data-stu-id="f5545-150">In WinHTTP 5.1, Passport authentication is disabled by default and must be explicitly enabled with [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) before use.</span></span>

<span data-ttu-id="f5545-151">O WinHTTP lida com muitos dos detalhes da transação internamente para autenticação do Passport.</span><span class="sxs-lookup"><span data-stu-id="f5545-151">WinHTTP handles many of the transaction details internally for Passport authentication.</span></span> <span data-ttu-id="f5545-152">Durante a solicitação inicial, o servidor responde com um código de status 302 quando a autenticação é necessária.</span><span class="sxs-lookup"><span data-stu-id="f5545-152">During the initial request, the server responds with a 302 status code when authentication is necessary.</span></span> <span data-ttu-id="f5545-153">O código de status 302 indica, na verdade, um redirecionamento e faz parte do protocolo do Passport para compatibilidade com versões anteriores.</span><span class="sxs-lookup"><span data-stu-id="f5545-153">The 302 status code actually indicates a redirection and is part of the Passport protocol for backwards compatibility.</span></span> <span data-ttu-id="f5545-154">O WinHTTP oculta o código de status 302 e entra em contato com o Passport Nexus e, em seguida, o servidor de logon.</span><span class="sxs-lookup"><span data-stu-id="f5545-154">WinHTTP hides the 302 status code and contacts the Passport nexus, and then the login server.</span></span> <span data-ttu-id="f5545-155">O aplicativo WinHTTP é notificado sobre o código de status 401 enviado pelo servidor de logon para solicitar credenciais de usuário.</span><span class="sxs-lookup"><span data-stu-id="f5545-155">The WinHTTP application is notified of the 401 status code sent by the login server to request user credentials.</span></span> <span data-ttu-id="f5545-156">Para o aplicativo, no entanto, ele aparece como se o status 401 for originado do servidor do qual o recurso foi solicitado.</span><span class="sxs-lookup"><span data-stu-id="f5545-156">To the application, however, it appears as if the 401 status originates from the server from which the resource was requested.</span></span> <span data-ttu-id="f5545-157">Dessa forma, o aplicativo WinHTTP não está ciente de interações com outros servidores e pode manipular a autenticação do Passport com o mesmo código que lida com outros esquemas de autenticação.</span><span class="sxs-lookup"><span data-stu-id="f5545-157">In this way, the WinHTTP application is unaware of interactions with other servers, and it can handle Passport authentication with the same code that handles other authentication schemes.</span></span>

<span data-ttu-id="f5545-158">Normalmente, um aplicativo WinHTTP responde a um código de status 401 fornecendo credenciais de autenticação.</span><span class="sxs-lookup"><span data-stu-id="f5545-158">Typically, a WinHTTP application responds to a 401 status code by supplying authentication credentials.</span></span> <span data-ttu-id="f5545-159">Quando as credenciais são fornecidas com [**WinHttpSetCredentials**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials) ou [**SetCredentials**](iwinhttprequest-setcredentials.md) para autenticação do Passport, as credenciais são realmente enviadas para o servidor de logon, não para o servidor indicado na solicitação.</span><span class="sxs-lookup"><span data-stu-id="f5545-159">When credentials are supplied with [**WinHttpSetCredentials**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials) or [**SetCredentials**](iwinhttprequest-setcredentials.md) for passport authentication, the credentials are actually being sent to the login server, not to the server indicated in the request.</span></span>

<span data-ttu-id="f5545-160">No entanto, ao responder a um código de status 407, um aplicativo WinHTTP deve usar [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) para fornecer credenciais de proxy, em vez de [**WinHttpSetCredentials**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials).</span><span class="sxs-lookup"><span data-stu-id="f5545-160">However, when responding to a 407 status code, a WinHTTP application must use [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) to provide proxy credentials, rather than [**WinHttpSetCredentials**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetcredentials).</span></span> <span data-ttu-id="f5545-161">Como o **WinHttpSetOption** é uma maneira menos segura de fornecer credenciais, normalmente ele deve ser evitado.</span><span class="sxs-lookup"><span data-stu-id="f5545-161">Because **WinHttpSetOption** is a less secure way to supply credentials, it should normally be avoided.</span></span>

<span data-ttu-id="f5545-162">Depois de recuperados, os [*tíquetes*](glossary.md) são gerenciados internamente e enviados automaticamente aos servidores aplicáveis em futuras solicitações.</span><span class="sxs-lookup"><span data-stu-id="f5545-162">Once retrieved, [*tickets*](glossary.md) are managed internally and are automatically sent to applicable servers in future requests.</span></span>

> [!Note]  
> <span data-ttu-id="f5545-163">O WinHTTP permite que você desabilite o redirecionamento automático chamando a função [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) para a [**opção WinHTTP desabilitar sinalizador de \_ \_ \_ recurso**](option-flags.md) e especificar um valor de [**WinHTTP \_ desabilitar \_ redirecionamentos**](option-flags.md).</span><span class="sxs-lookup"><span data-stu-id="f5545-163">WinHTTP enables you to disable automatic redirection by calling the [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) function for the [**WINHTTP\_OPTION\_DISABLE\_FEATURE**](option-flags.md) flag and specifying a value of [**WINHTTP\_DISABLE\_REDIRECTS**](option-flags.md).</span></span> <span data-ttu-id="f5545-164">Desabilitar o redirecionamento não interfere no redirecionamento que o WinHTTP manipula internamente para transações do Passport.</span><span class="sxs-lookup"><span data-stu-id="f5545-164">Disabling redirection does not interfere with the redirection that WinHTTP handles internally for Passport transactions.</span></span>

 

<span data-ttu-id="f5545-165">O WinHTTP pode concluir com êxito a autenticação do Passport, mesmo que um aplicativo desabilite o redirecionamento automático.</span><span class="sxs-lookup"><span data-stu-id="f5545-165">WinHTTP can successfully complete the Passport authentication even if an application disables auto redirection.</span></span> <span data-ttu-id="f5545-166">No entanto, após a conclusão da autenticação do Passport, um redirecionamento implícito deve ocorrer na URL do servidor de logon do Passport de volta para a URL original.</span><span class="sxs-lookup"><span data-stu-id="f5545-166">However, after the Passport authentication is complete, an implicit redirect must occur from the Passport login server URL back to the original URL.</span></span> <span data-ttu-id="f5545-167">Esse redirecionamento não é disparado por uma resposta HTTP 302, mas é implícito no protocolo do Passport.</span><span class="sxs-lookup"><span data-stu-id="f5545-167">This redirect is not triggered by a 302 HTTP response, but is implicit in the Passport protocol.</span></span>

<span data-ttu-id="f5545-168">O WinHTTP manipula esse redirecionamento implícito especialmente.</span><span class="sxs-lookup"><span data-stu-id="f5545-168">WinHTTP handles this implicit redirect specially.</span></span> <span data-ttu-id="f5545-169">Se um aplicativo tiver desabilitado o redirecionamento automático, o WinHTTP exigirá que o aplicativo conceda "permissão" de WinHTTP para redirecionar automaticamente neste caso especial.</span><span class="sxs-lookup"><span data-stu-id="f5545-169">If an application has disabled automatic redirection, WinHTTP requires that the application give WinHTTP "permission" to redirect automatically in this special case.</span></span>

<span data-ttu-id="f5545-170">Para fazer com que o WinHTTP Redirecione para a URL original após a autenticação, o aplicativo deve registrar uma função de retorno de chamada usando [**WinHttpSetStatusCallback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback).</span><span class="sxs-lookup"><span data-stu-id="f5545-170">In order to have WinHTTP redirect back to the original URL after authentication, the application must register a callback function using [**WinHttpSetStatusCallback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback).</span></span> <span data-ttu-id="f5545-171">O WinHTTP pode notificar o aplicativo com um \_ retorno de chamada de redirecionamento de status de retorno de chamada WinHTTP \_ \_ , que permite ao aplicativo cancelar o redirecionamento.</span><span class="sxs-lookup"><span data-stu-id="f5545-171">WinHTTP can then notify the application with a WINHTTP\_CALLBACK\_STATUS\_REDIRECT callback, which allows the application to cancel the redirect.</span></span> <span data-ttu-id="f5545-172">Um aplicativo não precisa fornecer nenhuma funcionalidade na função de retorno de chamada; o registro do retorno de chamada é suficiente para habilitar o WinHTTP a seguir este redirecionamento de caso especial.</span><span class="sxs-lookup"><span data-stu-id="f5545-172">An application does not need to provide any functionality in the callback function; registration of the callback is sufficient to enable WinHTTP to follow this special-case redirect.</span></span>

<span data-ttu-id="f5545-173">A \_ mensagem de falha de logon WinHTTP de erro \_ \_ será gerada se uma função de retorno de chamada não for definida pelo aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f5545-173">The ERROR\_WINHTTP\_LOGIN\_FAILURE message is generated if a callback function is not set by the application.</span></span>

### <a name="passport-cobranding"></a><span data-ttu-id="f5545-174">Comarcação do Passport</span><span class="sxs-lookup"><span data-stu-id="f5545-174">Passport Cobranding</span></span>

<span data-ttu-id="f5545-175">Ao contrário dos esquemas de autenticação tradicionais com suporte do WinHTTP, o Passport pode ser amplamente [*comarcado*](glossary.md).</span><span class="sxs-lookup"><span data-stu-id="f5545-175">Unlike traditional authentication schemes supported by WinHTTP, Passport can be extensively [*cobranded*](glossary.md).</span></span> <span data-ttu-id="f5545-176">Após receber um código de status 401 que indica um desafio, um aplicativo pode recuperar o texto e o gráfico de *comarcação* .</span><span class="sxs-lookup"><span data-stu-id="f5545-176">Upon receiving a 401 status code that indicates a challenge, an application can retrieve the *cobranding* graphic and text.</span></span> <span data-ttu-id="f5545-177">Recupere uma URL para o gráfico de *comarcação* chamando [**WinHttpQueryOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryoption) com a \_ opção WinHTTP \_ sinalizador de URL de \_ comarcação do Passport \_ .</span><span class="sxs-lookup"><span data-stu-id="f5545-177">Retrieve a URL for the *cobranding* graphic by calling [**WinHttpQueryOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryoption) with the WINHTTP\_OPTION\_PASSPORT\_COBRANDING\_URL flag.</span></span> <span data-ttu-id="f5545-178">Recupere o texto da *comarcação* chamando [**WinHttpQueryOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryoption) com a \_ opção WinHTTP \_ sinalizador de texto de \_ comarcação do Passport \_ .</span><span class="sxs-lookup"><span data-stu-id="f5545-178">Retrieve the *cobranding* text by calling [**WinHttpQueryOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryoption) with the WINHTTP\_OPTION\_PASSPORT\_COBRANDING\_TEXT flag.</span></span> <span data-ttu-id="f5545-179">Esses itens podem ser usados para personalizar uma caixa de diálogo de coleta de credenciais.</span><span class="sxs-lookup"><span data-stu-id="f5545-179">These items can be used to customize a credential-gathering dialog.</span></span>

### <a name="stored-user-names-and-passwords"></a><span data-ttu-id="f5545-180">Nomes de usuário e senhas armazenados</span><span class="sxs-lookup"><span data-stu-id="f5545-180">Stored User Names and Passwords</span></span>

<span data-ttu-id="f5545-181">O Windows XP introduziu o conceito de nomes de usuário e senhas armazenados.</span><span class="sxs-lookup"><span data-stu-id="f5545-181">Windows XP introduced the concept of Stored User Names and Passwords.</span></span> <span data-ttu-id="f5545-182">Se as credenciais do Passport de um usuário forem salvas por meio do **Assistente de registro do Passport** ou da caixa de **diálogo credencial** padrão, ela será salva nos nomes de usuário e senhas armazenados.</span><span class="sxs-lookup"><span data-stu-id="f5545-182">If a user's Passport credentials are saved through the **Passport Registration Wizard** or the standard **Credential Dialog**, it is saved in the Stored User Names and Passwords.</span></span> <span data-ttu-id="f5545-183">Ao usar o WinHTTP no Windows XP ou posterior, o WinHTTP usará automaticamente as credenciais nos nomes de usuário e senhas armazenados se as credenciais não estiverem definidas explicitamente.</span><span class="sxs-lookup"><span data-stu-id="f5545-183">When using WinHTTP on Windows XP or later, WinHTTP automatically uses the credentials in the Stored User Names and Passwords if credentials are not explicitly set.</span></span> <span data-ttu-id="f5545-184">Isso é semelhante ao suporte de credenciais de logon padrão para NTLM/Kerberos.</span><span class="sxs-lookup"><span data-stu-id="f5545-184">This is similar to the support of default logon credentials for NTLM/Kerberos.</span></span> <span data-ttu-id="f5545-185">No entanto, o uso de credenciais padrão do Passport não está sujeito às configurações de política de logon automático.</span><span class="sxs-lookup"><span data-stu-id="f5545-185">However, use of default Passport credentials is not subject to the automatic logon policy settings.</span></span>

### <a name="disabling-passport-authentication"></a><span data-ttu-id="f5545-186">Desabilitando a autenticação do Passport</span><span class="sxs-lookup"><span data-stu-id="f5545-186">Disabling Passport Authentication</span></span>

<span data-ttu-id="f5545-187">Alguns aplicativos podem exigir a capacidade de desabilitar a autenticação do Passport.</span><span class="sxs-lookup"><span data-stu-id="f5545-187">Some applications might require the ability to disable Passport authentication.</span></span> <span data-ttu-id="f5545-188">Por exemplo, quando uma afiliada do Passport responde com o código de status 302 inicial, pode ser preferível seguir o redirecionamento indicado e renderizar a página de autenticação HTML do Passport em vez de permitir que o WinHTTP manipule a autenticação internamente.</span><span class="sxs-lookup"><span data-stu-id="f5545-188">For example, when a Passport affiliate responds with the initial 302 status code, it might be preferable to follow the indicated redirection and render the HTML Passport authentication page rather than allowing WinHTTP to handle the authentication internally.</span></span> <span data-ttu-id="f5545-189">A autenticação do Passport está desabilitada no WinHTTP chamando a função [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) com a \_ opção WinHTTP configure a \_ \_ \_ opção Passport auth e passando o valor WinHTTP \_ Disable \_ Passport \_ auth.</span><span class="sxs-lookup"><span data-stu-id="f5545-189">Passport authentication is disabled in WinHTTP by calling the [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) function with the WINHTTP\_OPTION\_CONFIGURE\_PASSPORT\_AUTH option and passing the value WINHTTP\_DISABLE\_PASSPORT\_AUTH.</span></span> <span data-ttu-id="f5545-190">Depois, ele pode ser reabilitado novamente com o WINHTTP \_ Enable \_ Passport \_ auth.</span><span class="sxs-lookup"><span data-stu-id="f5545-190">It can later be re-enabled with WINHTTP\_ENABLE\_PASSPORT\_AUTH.</span></span>

<span data-ttu-id="f5545-191">A autenticação do Passport não pode ser desabilitada ao usar o objeto [**WinHttpRequest**](winhttprequest.md) .</span><span class="sxs-lookup"><span data-stu-id="f5545-191">Passport authentication cannot be disabled when using the [**WinHttpRequest**](winhttprequest.md) object.</span></span>

<span data-ttu-id="f5545-192">Conforme observado anteriormente nesta seção, a autenticação do Passport é desabilitada por padrão no WinHTTP 5,1 e deve ser explicitamente habilitada com [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) antes do uso.</span><span class="sxs-lookup"><span data-stu-id="f5545-192">As noted earlier in this section, Passport authentication is disabled by default in WinHTTP 5.1, and must be explicitly enabled with [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) before use.</span></span>

## <a name="passport-configuration-overrides-used-for-testing"></a><span data-ttu-id="f5545-193">Substituições de configuração do Passport usadas para teste</span><span class="sxs-lookup"><span data-stu-id="f5545-193">Passport Configuration Overrides Used for Testing</span></span>

<span data-ttu-id="f5545-194">O WinHTTP conta com as informações de configuração que ele baixa do servidor do Passport Nexus para dar suporte à autenticação do Passport 1,4.</span><span class="sxs-lookup"><span data-stu-id="f5545-194">WinHTTP relies on the configuration information it downloads from the passport nexus server to support Passport 1.4 authentication.</span></span> <span data-ttu-id="f5545-195">Por padrão, esse servidor seguro (SSL) é nexus.passport.com, e o recurso de configuração é rdr/pprdr. asp, que é conhecido como a configuração do Passport "ao vivo".</span><span class="sxs-lookup"><span data-stu-id="f5545-195">By default this secure (SSL) server is nexus.passport.com, and the configuration resource is rdr/pprdr.asp, which is known as the "live" passport configuration.</span></span> <span data-ttu-id="f5545-196">O formato das informações é um cabeçalho HTTP personalizado "PassportURLs", seguido por pares de atributo-valor delimitados por vírgula.</span><span class="sxs-lookup"><span data-stu-id="f5545-196">The format of the information is a custom HTTP header "PassportURLs", followed by comma delimited attribute-value pairs.</span></span>

<span data-ttu-id="f5545-197">Por exemplo, " https://nexus.passport.com/rdr/pprdr.asp " retorna as seguintes informações de configuração:</span><span class="sxs-lookup"><span data-stu-id="f5545-197">For example, "https://nexus.passport.com/rdr/pprdr.asp" returns the following configuration information:</span></span>

``` syntax
PassportURLs: DARealm=Passport.net,
DALogin=login.passport.com/login2.asp,
DAReg=https://register.passport.com/defaultwiz.asp,
Properties=https://memberservices.passport.com/ppsecure/MSRV_EditProfile.asp,
Privacy=https://www.passport.com/consumer/privacypolicy.asp,
GeneralRedir=https://nexusrdr.passport.com/redir.asp,
Help=https://memberservices.passport.com/UI/MSRV_UI_Help.asp,
ConfigVersion=2
\r\n
```

<span data-ttu-id="f5545-198">As partes relevantes para o WinHTTP são DARealm, DALogin e ConfigVersion.</span><span class="sxs-lookup"><span data-stu-id="f5545-198">The parts that are relevant to WinHTTP are DARealm, DALogin, and ConfigVersion.</span></span> <span data-ttu-id="f5545-199">Por motivos de desempenho, eles são armazenados em cache durante o tempo de vida de uma sessão do WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="f5545-199">For performance reasons, they are cached for the lifetime of a WinHTTP session.</span></span> <span data-ttu-id="f5545-200">Esses três valores podem ser substituídos por aplicativos que são necessários para trabalhar com outra infraestrutura do Passport diferente da configuração de produção "ao vivo" alterando as configurações de registro apropriadas em</span><span class="sxs-lookup"><span data-stu-id="f5545-200">These three values can be overridden by applications that are required to work with another passport infrastructure other than the "live" production setup by changing the appropriate registry settings under</span></span>

```
HKEY_LOCAL_MACHINE
   SOFTWARE
      Microsoft
         Windows
            CurrentVersion
               Internet Settings
                  WinHttp
                     Passport Test
```

``` syntax
LoginServerRealm (REG_SZ)    For example: abc.net
LoginServerUrl (REG_SZ)      For example: https://private-login.passport.com/login2.asp
ConfigVersion (REG_DWORD)    For example: 10
```

<span data-ttu-id="f5545-201">Se LoginServerUrl estiver presente no registro, o WinHTTP não entrará em contato com o servidor Nexus para outros valores de configuração.</span><span class="sxs-lookup"><span data-stu-id="f5545-201">If LoginServerUrl is present in the registry, WinHTTP does not contact the nexus server for other configuration values.</span></span> <span data-ttu-id="f5545-202">Nesse caso, LoginServerRealm e ConfigVersion também devem ser definidos por meio do registro para corrigir os valores.</span><span class="sxs-lookup"><span data-stu-id="f5545-202">In this case, LoginServerRealm and ConfigVersion should also be set through the registry to correct values.</span></span>

<span data-ttu-id="f5545-203">Um aplicativo pode, para fins de teste, ser necessário para baixar a configuração do Passport de um servidor de Nexus privado.</span><span class="sxs-lookup"><span data-stu-id="f5545-203">An application may, for testing purposes, be required to download passport configuration from a private nexus server.</span></span> <span data-ttu-id="f5545-204">Isso pode ser feito substituindo dois valores de registro em</span><span class="sxs-lookup"><span data-stu-id="f5545-204">This can be done by overriding two registry values under</span></span>

```
HKEY_LOCAL_MACHINE
   SOFTWARE
      Microsoft
         Windows
            CurrentVersion
               Internet Settings
                  WinHttp
                     Passport Test
```

``` syntax
NexusHost (REG_SZ)    e.g. private-nexus.passport.com
NexusObj(REG_SZ)      e.g. config/passport.asp
```

## <a name="related-topics"></a><span data-ttu-id="f5545-205">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="f5545-205">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="f5545-206">Autenticação no WinHTTP</span><span class="sxs-lookup"><span data-stu-id="f5545-206">Authentication in WinHTTP</span></span>](authentication-in-winhttp.md)
</dt> </dl>

 

 



