---
description: Tratamento de cookies no WinHTTP
ms.assetid: ef0f0847-05f6-4477-8e48-e0bea66314ab
title: Tratamento de cookies no WinHTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8e3b596225dc3c741ab9ed0139a63e343e7afb3d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "105782512"
---
# <a name="cookie-handling-in-winhttp"></a><span data-ttu-id="9f4f7-103">Tratamento de cookies no WinHTTP</span><span class="sxs-lookup"><span data-stu-id="9f4f7-103">Cookie Handling in WinHTTP</span></span>

<span data-ttu-id="9f4f7-104">Os dados da sessão HTTP são passados entre o cliente e o servidor no cabeçalho do cookie da solicitação ou da resposta.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-104">HTTP session data is passed between the client and server in the cookie header of the request or the response.</span></span> <span data-ttu-id="9f4f7-105">O servidor envia cookies para o cliente no cabeçalho Set-cookie da resposta e a API do WinHTTP reenvia o cookie do servidor para o servidor no cabeçalho do cookie da solicitação.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-105">The server sends cookies to the client in the Set-cookie header of the response and the WinHTTP API resends the server cookie to the server in the cookie header of the request.</span></span> <span data-ttu-id="9f4f7-106">As especificações de tratamento de cookies, descritas no RFC 2109 (mecanismo de gerenciamento de estado HTTP), são implementadas por padrão no WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-106">The cookie handling specifications, described in rfc 2109 (HTTP State Management Mechanism), are implemented by default in WinHTTP.</span></span> <span data-ttu-id="9f4f7-107">As especificações de tratamento de cookie recentes, descritas em RFC 2964, não são suportadas pelo WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-107">Recent cookie handling specifications, described in rfc 2964, are not supported by WinHTTP.</span></span>

<span data-ttu-id="9f4f7-108">O WinHTTP Obtém o cookie do cabeçalho Set-Cookie de servidores e o armazena em um cache por sessão.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-108">WinHTTP obtains the cookie from the servers Set-Cookie header and stores it in a cache on a per-session basis.</span></span> <span data-ttu-id="9f4f7-109">Esse cookie é reenviado em solicitações subsequentes na mesma sessão do WinHTTP em que o destino corresponde à origem do cookie.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-109">This cookie is resent on subsequent requests in the same WinHTTP session where the target matches the source of the cookie.</span></span> <span data-ttu-id="9f4f7-110">A API do WinHTTP regenera o cabeçalho de cookie de solicitação para cada segmento na solicitação.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-110">The WinHTTP API regenerates the request cookie header for each leg in the request.</span></span>

<span data-ttu-id="9f4f7-111">A lista a seguir descreve várias opções que os aplicativos cliente WinHTTP podem usar para lidar com cookies:</span><span class="sxs-lookup"><span data-stu-id="9f4f7-111">The follow list describes several options that WinHTTP client applications can use to handle cookies:</span></span>

-   <span data-ttu-id="9f4f7-112">Tratamento automático de cookies-o WinHTTP manipula automaticamente os cookies e o aplicativo cliente não executa nenhuma manipulação de cookie personalizada.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-112">Automatic Cookie Handling - WinHTTP automatically handles cookies and the client application performs no custom cookie handling.</span></span>
-   <span data-ttu-id="9f4f7-113">Desabilitar o tratamento automático de cookies-o tratamento automático de cookies na API do WinHTTP está desabilitado e nenhum cookie é enviado.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-113">Disable Automatic Cookie Handling - Automatic cookie handling in the WinHTTP API is disabled and no cookies are sent.</span></span>
-   <span data-ttu-id="9f4f7-114">Especificar manualmente todos os cookies – o tratamento automático de cookies está desabilitado e o aplicativo cliente adiciona ou remove todos os cabeçalhos de cookie de cada solicitação na sessão.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-114">Manually specify all Cookies – Automatic cookie handling is disabled and the client application adds or removes all cookie headers for each request in the session.</span></span>
-   <span data-ttu-id="9f4f7-115">Manipulação manual e automática de cookies – Combine manipulação automática e manual de cookies.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-115">Manual and Automatic Cookie Handling - Combine automatic and manual cookie handling.</span></span>

## <a name="disabling-automatic-cookie-handling"></a><span data-ttu-id="9f4f7-116">Desabilitando a manipulação automática de cookies</span><span class="sxs-lookup"><span data-stu-id="9f4f7-116">Disabling Automatic Cookie Handling</span></span>

<span data-ttu-id="9f4f7-117">Para desabilitar a manipulação de cookies, o aplicativo cliente WinHTTP chama a função [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) com o parâmetro *dwOption* definido como \_ opção WinHTTP \_ Disable \_ Feature e o parâmetro *lpBuffer* definido como WinHTTP \_ Disable \_ cookies.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-117">To disable cookie handling, the WinHTTP client application calls the [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) function with the *dwOption* parameter set to WINHTTP\_OPTION\_DISABLE\_FEATURE, and the *lpBuffer* parameter set to WINHTTP\_DISABLE\_COOKIES.</span></span> <span data-ttu-id="9f4f7-118">O parâmetro *hInternet* pode ser um identificador de sessão ou um identificador de solicitação.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-118">The *hInternet* parameter can be either a session handle or a request handle.</span></span> <span data-ttu-id="9f4f7-119">Quando o tratamento de cookies é desabilitado em um identificador de solicitação que enviou uma solicitação anterior, o cliente deve remover manualmente os cabeçalhos de cookie de solicitação existentes com a função [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) antes de enviar a próxima solicitação.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-119">When cookie handling is disabled on a request handle that has sent a previous request, the client should manually remove existing request cookie headers with the [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) function before sending the next request.</span></span> <span data-ttu-id="9f4f7-120">Para obter mais informações, consulte [removendo cabeçalhos de cookie](#removing-cookie-headers).</span><span class="sxs-lookup"><span data-stu-id="9f4f7-120">For more information, see [Removing Cookie Headers](#removing-cookie-headers).</span></span>

<span data-ttu-id="9f4f7-121">**Observação**  O aplicativo cliente deve definir todos os cookies na sessão após o modo automático ter sido desabilitado.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-121">**Note**  The client application must set all cookies on the session after automatic mode has been disabled.</span></span>

## <a name="manually-specifying-all-cookies"></a><span data-ttu-id="9f4f7-122">Especificando manualmente todos os cookies</span><span class="sxs-lookup"><span data-stu-id="9f4f7-122">Manually Specifying All Cookies</span></span>

<span data-ttu-id="9f4f7-123">Quando o tratamento automático de cookies está desabilitado, o aplicativo cliente WinHTTP tem a opção de especificar manualmente todos os cookies.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-123">When automatic cookie handling is disabled, the WinHTTP client application has the option to manually specify all cookies.</span></span> <span data-ttu-id="9f4f7-124">Para definir manualmente o cookie, o aplicativo chama [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) especificando o cabeçalho do cookie no parâmetro *pwszHeaders* .</span><span class="sxs-lookup"><span data-stu-id="9f4f7-124">To manually set the cookie, the application calls [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) specifying the cookie header in the *pwszHeaders* parameter.</span></span> <span data-ttu-id="9f4f7-125">O aplicativo cliente deve limpar todos os cabeçalhos de cookie antes de reenviar a solicitação.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-125">The client application should clear all cookie headers before resending the request.</span></span>

<span data-ttu-id="9f4f7-126">O aplicativo cliente também deve alterar o cabeçalho do cookie quando a solicitação for redirecionada.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-126">The client application should also change the cookie header when the request has been redirected.</span></span> <span data-ttu-id="9f4f7-127">Para alterar o cookie em solicitações redirecionadas, o cliente especifica uma função de retorno de chamada com [**WinHttpSetStatusCallback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback) que responde ao caso de retorno de chamada de redirecionamento.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-127">To change the cookie on redirected requests, the client specifies a callback function with [**WinHttpSetStatusCallback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback) that responds to the redirect callback case.</span></span> <span data-ttu-id="9f4f7-128">O manipulador de retorno de chamada deve limpar o cookie enviado anteriormente na solicitação chamando [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders).</span><span class="sxs-lookup"><span data-stu-id="9f4f7-128">The callback handler should clear the cookie previously sent on the request by calling [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders).</span></span> <span data-ttu-id="9f4f7-129">Para obter mais informações sobre como remover cabeçalhos de cookie, consulte [removendo cabeçalhos de cookie](#removing-cookie-headers).</span><span class="sxs-lookup"><span data-stu-id="9f4f7-129">For more information about removing cookie headers, see [Removing Cookie Headers](#removing-cookie-headers).</span></span>

## <a name="manual-and-automatic-cookie-handling"></a><span data-ttu-id="9f4f7-130">Manipulação manual e automática de cookies</span><span class="sxs-lookup"><span data-stu-id="9f4f7-130">Manual and Automatic Cookie Handling</span></span>

<span data-ttu-id="9f4f7-131">Os aplicativos cliente WinHTTP podem combinar o mecanismo de tratamento automático de cookies do WinHTTP com manipulação manual de cookies.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-131">WinHTTP client applications can combine the WinHTTP automatic cookie handling mechanism with manual cookie handling.</span></span> <span data-ttu-id="9f4f7-132">O aplicativo adiciona cookies personalizados ao cabeçalho de cookie gerado automaticamente antes de enviar a solicitação com a função [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) .</span><span class="sxs-lookup"><span data-stu-id="9f4f7-132">The application adds custom cookies to the automatically generated cookie header before sending the request with the [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) function.</span></span> <span data-ttu-id="9f4f7-133">O cookie personalizado deve ser o primeiro cabeçalho de cookie na solicitação para que a API do WinHTTP armazene corretamente o cookie em cache.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-133">The custom cookie should be the first cookie header in the request for the WinHTTP API to properly cache the cookie.</span></span> <span data-ttu-id="9f4f7-134">O aplicativo cliente também deve remover cookies enviados em solicitações anteriores antes de reenviar uma solicitação no mesmo identificador de solicitação.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-134">The client application should also remove cookies sent on previous requests before resending a request on the same request handle.</span></span> <span data-ttu-id="9f4f7-135">Para obter mais informações, consulte Removendo cabeçalhos de cookie.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-135">For more information, see Removing Cookie Headers.</span></span>

<span data-ttu-id="9f4f7-136">Os cookies adicionados a uma solicitação antes que a chamada a [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) sejam incluídas em todas as solicitações de WinHTTP enviadas em nome das próximas chamadas de **WinHttpSendRequest** e [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) .</span><span class="sxs-lookup"><span data-stu-id="9f4f7-136">Cookies added to a request before the call to [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) are included in all WinHTTP requests sent on behalf of the next **WinHttpSendRequest** and [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) calls.</span></span> <span data-ttu-id="9f4f7-137">O aplicativo cliente pode precisar limpar o cabeçalho do cookie quando a solicitação for redirecionada.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-137">The client application may need to clear the cookie header when the request has been redirected.</span></span> <span data-ttu-id="9f4f7-138">Para limpar o cookie em solicitações redirecionadas, o cliente especifica uma função de retorno de chamada com [**WinHttpSetStatusCallback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback) que responde ao caso de retorno de chamada de redirecionamento.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-138">To clear the cookie on redirected requests, the client specifies a callback function with [**WinHttpSetStatusCallback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback) that responds to the redirect callback case.</span></span> <span data-ttu-id="9f4f7-139">O manipulador de retorno de chamada deve limpar o cookie que foi enviado anteriormente na solicitação chamando [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders).</span><span class="sxs-lookup"><span data-stu-id="9f4f7-139">The callback handler should clear the cookie that was previously sent on the request by calling [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders).</span></span> <span data-ttu-id="9f4f7-140">A função de retorno de chamada não pode definir novos cookies personalizados no retorno de chamada de redirecionamento.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-140">The callback function may not set new custom cookies on the redirect callback.</span></span> <span data-ttu-id="9f4f7-141">O cliente deve aguardar a conclusão do **WinHttpReceiveResponse** antes de adicionar novos cookies para a próxima chamada **WinHttpSendRequest** .</span><span class="sxs-lookup"><span data-stu-id="9f4f7-141">The client must wait for **WinHttpReceiveResponse** to complete before adding new cookies for the next **WinHttpSendRequest** call.</span></span>

## <a name="removing-cookie-headers"></a><span data-ttu-id="9f4f7-142">Removendo cabeçalhos de cookie</span><span class="sxs-lookup"><span data-stu-id="9f4f7-142">Removing Cookie Headers</span></span>

<span data-ttu-id="9f4f7-143">O aplicativo cliente WinHTTP pode precisar limpar o cookie de solicitação existente antes de reenviar uma solicitação para impedir que cookies enviados em solicitações anteriores sejam enviados novamente na solicitação atual; para obter mais informações, consulte a observação a seguir.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-143">The WinHTTP client application may need to clear the existing request cookie before resending a request to prevent cookies that were sent on previous requests from being sent again on the current request; for more information, see the following Note.</span></span> <span data-ttu-id="9f4f7-144">Além disso, lembre-se de que os cookies não precisam ser limpos antes que a primeira solicitação seja enviada no identificador de solicitação.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-144">Also be aware that Cookies do not have to be cleared before the first request is sent on the request handle.</span></span> <span data-ttu-id="9f4f7-145">O cliente pode limpar os cookies existentes chamando [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) com um cabeçalho de cookie vazio no parâmetro *pwszHeaders* e o \_ sinalizador de substituição do sinalizador WinHTTP ADDREQ \_ \_ definido no parâmetro *dwModifier* .</span><span class="sxs-lookup"><span data-stu-id="9f4f7-145">The client can clear existing cookies by calling [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) with an empty cookie header in the *pwszHeaders* parameter and the WINHTTP\_ADDREQ\_FLAG\_REPLACE flag set in the *dwModifier* parameter.</span></span> <span data-ttu-id="9f4f7-146">O exemplo de código a seguir mostra como limpar o cabeçalho do cookie na solicitação.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-146">The following code example shows how to clear the cookie header on the request.</span></span>

``` syntax
WinHttpAddRequestHeaders( hRequest, 
                          L"Cookie:", 
                          -1, 
                          WINHTTP_ADDREQ_FLAG_REPLACE);
```

<span data-ttu-id="9f4f7-147">A API do WinHTTP tem comportamentos de manipulação de cookies diferentes para versões do sistema operacional anteriores ao Windows XP com Service Pack 2 (SP2) e Windows Server 2003 com Service Pack 1 (SP1).</span><span class="sxs-lookup"><span data-stu-id="9f4f7-147">The WinHTTP API has different cookie handling behaviors for versions of the operating system earlier than Windows XP with Service Pack 2 (SP2) and Windows Server 2003 with Service Pack 1 (SP1).</span></span>

<span data-ttu-id="9f4f7-148">\* \* Windows XP com SP2 e posterior e Windows Server 2003 com SP1 e posterior: \* \*</span><span class="sxs-lookup"><span data-stu-id="9f4f7-148">\*\*Windows XP with SP2 and later and Windows Server 2003 with SP1 and later:  \*\*</span></span>

<span data-ttu-id="9f4f7-149">A API do WinHTTP limpa todos os cookies enviados em solicitações anteriores para o identificador de solicitação.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-149">The WinHTTP API clears all cookies sent on previous requests for the request handle.</span></span> <span data-ttu-id="9f4f7-150">O cliente pode adicionar manualmente novos cabeçalhos de cookie antes de cada chamada para WinHttpSendRequest.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-150">The client can manually add new cookie headers before each call to WinHttpSendRequest.</span></span> <span data-ttu-id="9f4f7-151">Se a funcionalidade de manipulação automática de cookies da API do WinHTTP não tiver sido desabilitada, a API do WinHTTP acrescentará o novo cabeçalho de cookie (ou adicionará um novo cabeçalho de cookie se o aplicativo cliente não tiver adicionado um manualmente) com o cookie do servidor.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-151">If the automatic cookie handling functionality of the WinHTTP API has not been disabled, the WinHTTP API will append the new cookie header (or add a new cookie header if the client application did not add one manually) with the cookie from the server.</span></span>

<span data-ttu-id="9f4f7-152">\* \* Windows XP com SP2 e Windows Server 2003 com SP1: \* \*</span><span class="sxs-lookup"><span data-stu-id="9f4f7-152">\*\*Windows XP with SP2 and Windows Server 2003 with SP1:  \*\*</span></span>

<span data-ttu-id="9f4f7-153">A API do WinHTTP não limpa o cabeçalho de cookie de solicitação após a conclusão do [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) .</span><span class="sxs-lookup"><span data-stu-id="9f4f7-153">The WinHTTP API does not clear the request cookie header after [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) completes.</span></span> <span data-ttu-id="9f4f7-154">Os cookies enviados em solicitações anteriores serão reenviados em chamadas subsequentes para [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest).</span><span class="sxs-lookup"><span data-stu-id="9f4f7-154">Cookies sent in previous requests will be resent in subsequent calls to [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest).</span></span> <span data-ttu-id="9f4f7-155">O aplicativo cliente WinHTTP deve limpar os cabeçalhos de cookies existentes antes de reenviar uma solicitação no identificador de solicitação.</span><span class="sxs-lookup"><span data-stu-id="9f4f7-155">The WinHTTP client application should clear existing cookies headers before resending a request on the request handle.</span></span>

 

 



