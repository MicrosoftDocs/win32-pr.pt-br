---
description: Considere os seguintes problemas importantes ao usar o recurso de AutoProxy do WinHTTP.
ms.assetid: 9bae89b7-8f54-42ec-a240-998c97e26d25
title: Problemas de AutoProxy no WinHTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 22c6edbf56ec1ffc4dfac930a5d4858429cc6447
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "104171102"
---
# <a name="autoproxy-issues-in-winhttp"></a><span data-ttu-id="88839-103">Problemas de AutoProxy no WinHTTP</span><span class="sxs-lookup"><span data-stu-id="88839-103">AutoProxy Issues in WinHTTP</span></span>

<span data-ttu-id="88839-104">Considere os seguintes problemas importantes ao usar o recurso de AutoProxy do WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="88839-104">Consider the following important issues when using the WinHTTP autoproxy feature.</span></span>

## <a name="only-one-proxy-server-is-currently-supported"></a><span data-ttu-id="88839-105">Atualmente há suporte para apenas um servidor proxy</span><span class="sxs-lookup"><span data-stu-id="88839-105">Only One Proxy Server is Currently Supported</span></span>

<span data-ttu-id="88839-106">Atualmente, o WinHTTP não dá suporte a configurações de proxy que especificam mais de um servidor proxy.</span><span class="sxs-lookup"><span data-stu-id="88839-106">WinHTTP does not currently support proxy configurations that specify more than one proxy server.</span></span> <span data-ttu-id="88839-107">Se [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) retornar uma estrutura de [**\_ \_ informações de proxy WinHTTP**](/windows/win32/api/winhttp/ns-winhttp-winhttp_proxy_info) que contém uma lista de servidores proxy, que o aplicativo então define no identificador de solicitação usando a opção de **\_ \_ proxy de opção WinHTTP** , o WinHTTP usará apenas o primeiro servidor proxy na lista.</span><span class="sxs-lookup"><span data-stu-id="88839-107">If [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) returns a [**WINHTTP\_PROXY\_INFO**](/windows/win32/api/winhttp/ns-winhttp-winhttp_proxy_info) structure that contains a list of proxy servers, which the application then sets on the request handle using the **WINHTTP\_OPTION\_PROXY** option, WinHTTP uses only the first proxy server in the list.</span></span> <span data-ttu-id="88839-108">Se esse servidor proxy não estiver acessível, o WinHTTP não fará failover para nenhum dos outros servidores proxy na lista.</span><span class="sxs-lookup"><span data-stu-id="88839-108">If that proxy server is not accessible, WinHTTP does not failover to any of the other proxy servers in the list.</span></span> <span data-ttu-id="88839-109">Cabe ao aplicativo lidar com esse caso definindo a opção de **\_ \_ proxy de opção WinHTTP** novamente com o próximo servidor proxy na lista e reenviando a solicitação.</span><span class="sxs-lookup"><span data-stu-id="88839-109">It is up to the application to handle this case by setting the **WINHTTP\_OPTION\_PROXY** option again with the next proxy server in the list, and resending the request.</span></span>

## <a name="security-risk-mitigation"></a><span data-ttu-id="88839-110">Mitigação de riscos de segurança</span><span class="sxs-lookup"><span data-stu-id="88839-110">Security Risk Mitigation</span></span>

<span data-ttu-id="88839-111">O processamento do arquivo de configuração automática do proxy requer a execução do código de script baixado.</span><span class="sxs-lookup"><span data-stu-id="88839-111">Processing the proxy auto-configuration file requires executing downloaded script code.</span></span> <span data-ttu-id="88839-112">Algumas questões de segurança a considerar: se o servidor no qual o arquivo PAC reside foi comprometido, é possível que o código do script PAC seja mal-intencionado.</span><span class="sxs-lookup"><span data-stu-id="88839-112">Some security concerns to consider: If the server on which the PAC file resides has been compromised, it is possible the PAC script code is malicious.</span></span> <span data-ttu-id="88839-113">Portanto, o WinHTTP usa as seguintes precauções para proteger o cliente:</span><span class="sxs-lookup"><span data-stu-id="88839-113">Therefore, WinHTTP uses the following precautions to protect the client:</span></span>

1.  <span data-ttu-id="88839-114">O código do script é impedido de instanciar quaisquer objetos ActiveX.</span><span class="sxs-lookup"><span data-stu-id="88839-114">The script code is prevented from instantiating any ActiveX objects.</span></span> <span data-ttu-id="88839-115">Isso bloqueia uma grande quantidade de funcionalidades potencialmente perigosas, como a capacidade de acessar arquivos e executar e/s de rede.</span><span class="sxs-lookup"><span data-stu-id="88839-115">This blocks a lot of potentially dangerous functionality, such as the ability to access files and to perform network I/O.</span></span>
2.  <span data-ttu-id="88839-116">\* \* Windows Server 2003: \* \* o [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) Delega todo o processamento de WPAD a um serviço externo fora do processo, o serviço de descoberta automática de proxy da Web do WinHTTP, que é executado na conta de usuário interna do serviço local de baixo privilégio.</span><span class="sxs-lookup"><span data-stu-id="88839-116">\*\*Windows Server 2003:  \*\*[**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) delegates the entire WPAD processing to an external out-of-process service, the WinHTTP Web Proxy Auto-Discovery service, which runs under the low-privileged Local Service built-in user account.</span></span>

3.  <span data-ttu-id="88839-117">**Windows XP com SP2 e Windows Server 2003:** Um script de PAC não tem permissão para ser executado por mais de 60 segundos, após o qual a execução do script é encerrada.</span><span class="sxs-lookup"><span data-stu-id="88839-117">**Windows XP with SP2 and Windows Server 2003:** A PAC script is not permitted to execute for longer than 60 seconds, after which script execution is terminated.</span></span>

4.  <span data-ttu-id="88839-118">**Windows XP com SP2 e Windows Server 2003:** O WinHTTP rejeita arquivos PAC maiores que 1 MB.</span><span class="sxs-lookup"><span data-stu-id="88839-118">**Windows XP with SP2 and Windows Server 2003:** WinHTTP rejects PAC files larger than 1MB.</span></span> <span data-ttu-id="88839-119">Normalmente, um arquivo PAC típico não tem mais do que alguns quilobytes de tamanho.</span><span class="sxs-lookup"><span data-stu-id="88839-119">A typical PAC file is usually no more than a few kilobytes in size.</span></span>

<span data-ttu-id="88839-120">Lembre-se de que o processamento do código do script PAC requer o uso de COM, porque o WinHTTP usa o componente do Microsoft JScript para executar o script.</span><span class="sxs-lookup"><span data-stu-id="88839-120">Be aware that processing the PAC script code requires the use of COM, because WinHTTP uses Microsoft JScript component to execute the script.</span></span> <span data-ttu-id="88839-121">Se o WinHTTP não puder delegar o processamento do protocolo WPAD a um serviço de descoberta de proxy da Web externo, fora do processo, o [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) carregará o tempo de execução com dentro do processo do aplicativo durante a chamada.</span><span class="sxs-lookup"><span data-stu-id="88839-121">If WinHTTP cannot delegate WPAD protocol processing to an external, out-of-process Web Proxy Auto-Discovery service, [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) loads the COM runtime within the application process for the duration of the call.</span></span> <span data-ttu-id="88839-122">Se o aplicativo em si já estiver usando COM, isso não deve ser uma preocupação.</span><span class="sxs-lookup"><span data-stu-id="88839-122">If the application itself is already using COM, this should not be a concern.</span></span>

## <a name="performance-considerations"></a><span data-ttu-id="88839-123">Considerações sobre desempenho</span><span class="sxs-lookup"><span data-stu-id="88839-123">Performance Considerations</span></span>

<span data-ttu-id="88839-124">O processo de detecção automática pode ser lento, possivelmente desde vários segundos.</span><span class="sxs-lookup"><span data-stu-id="88839-124">The auto-detection process can be slow, possibly as long as several seconds.</span></span> <span data-ttu-id="88839-125">As funções [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) e [WinHttpDetectAutoProxyConfigUrl](/windows/desktop/api/Winhttp/nf-winhttp-winhttpdetectautoproxyconfigurl) estão bloqueando, funções síncronas.</span><span class="sxs-lookup"><span data-stu-id="88839-125">The [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) and [WinHttpDetectAutoProxyConfigUrl](/windows/desktop/api/Winhttp/nf-winhttp-winhttpdetectautoproxyconfigurl) functions are blocking, synchronous functions.</span></span> <span data-ttu-id="88839-126">Pode ser que um mecanismo de detecção automática específico (como DHCP) seja muito mais lento do que o outro (como DNS).</span><span class="sxs-lookup"><span data-stu-id="88839-126">It could be that one particular auto-detection mechanism (such as DHCP) is much slower than the other (such as DNS).</span></span> <span data-ttu-id="88839-127">Se o tipo de detecção **automática de WinHTTP for \_ \_ \_ \_ DHCP** e **WinHTTP \_ tipo de detecção automática \_ \_ \_ de DNS \_** , os sinalizadores de autoria serão especificados, o WinHTTP usará o DHCP primeiro, de acordo com a especificação WPAD.</span><span class="sxs-lookup"><span data-stu-id="88839-127">If both the **WINHTTP\_AUTO\_DETECT\_TYPE\_DHCP** and **WINHTTP\_AUTO\_DETECT\_TYPE\_DNS\_A** auto-detection flags are specified, WinHTTP uses DHCP first, in accordance with the WPAD specification.</span></span> <span data-ttu-id="88839-128">Se nenhuma URL de PAC for descoberta emitindo uma solicitação DHCP, o WinHTTP tentará localizar o arquivo PAC em um endereço DNS conhecido.</span><span class="sxs-lookup"><span data-stu-id="88839-128">If no PAC URL is discovered by issuing a DHCP request, then WinHTTP tries to locate the PAC file at a well-known DNS address.</span></span>

<span data-ttu-id="88839-129">[**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) usa o parâmetro de identificador de sessão do WinHTTP para armazenar em cache o arquivo PAC e os resultados da detecção automática.</span><span class="sxs-lookup"><span data-stu-id="88839-129">[**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) uses the WinHTTP Session handle parameter for caching the PAC file and the results of auto-detection.</span></span> <span data-ttu-id="88839-130">É melhor usar o mesmo identificador de sessão para várias chamadas **WinHttpGetProxyForUrl** , se possível, para evitar a detecção repetida de URL de PAC e o download de arquivos.</span><span class="sxs-lookup"><span data-stu-id="88839-130">It is best to use the same session handle for multiple **WinHttpGetProxyForUrl** calls if possible to avoid repeated PAC URL detection and file downloading.</span></span> <span data-ttu-id="88839-131">O arquivo PAC é armazenado em cache somente na memória e é Descartado quando o aplicativo fecha o identificador de sessão.</span><span class="sxs-lookup"><span data-stu-id="88839-131">The PAC file is cached in-memory only, and is discarded when the application closes the session handle.</span></span>

<span data-ttu-id="88839-132">Devido ao impacto no desempenho do AutoProxy, é recomendável que somente aplicativos cliente ou serviços de desktop usem o recurso; os aplicativos baseados em servidor devem contar com o administrador do servidor usando o utilitário "ProxyCfg.exe".</span><span class="sxs-lookup"><span data-stu-id="88839-132">Because of the performance impact of autoproxy, it is recommended that only desktop client applications or services use the feature; server-based applications should rely on the server administrator using the "ProxyCfg.exe" utility.</span></span>

 

 



