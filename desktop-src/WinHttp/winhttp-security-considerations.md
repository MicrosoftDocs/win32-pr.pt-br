---
description: 'As seguintes considerações de segurança se aplicam a aplicativos que usam WinHTTP: certificados de servidor são verificados apenas uma vez por sessão.'
ms.assetid: 287e85ed-a324-4785-872a-26e4ab37986d
title: Considerações de segurança de WinHTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: dc06725ba03631eb4d5e5c29f8cfa0aae69b5022
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104461124"
---
# <a name="winhttp-security-considerations"></a><span data-ttu-id="f97af-103">Considerações de segurança de WinHTTP</span><span class="sxs-lookup"><span data-stu-id="f97af-103">WinHTTP Security Considerations</span></span>

<span data-ttu-id="f97af-104">As seguintes considerações de segurança se aplicam a aplicativos que usam o WinHTTP:</span><span class="sxs-lookup"><span data-stu-id="f97af-104">The following security considerations apply to applications that use WinHTTP:</span></span>

-   <span data-ttu-id="f97af-105">**Os certificados de servidor são verificados apenas uma vez por sessão.**</span><span class="sxs-lookup"><span data-stu-id="f97af-105">**Server certificates are only verified once per session.**</span></span> <span data-ttu-id="f97af-106">Depois que um certificado tiver sido verificado, ele permanecerá válido durante a sessão atual.</span><span class="sxs-lookup"><span data-stu-id="f97af-106">After a certificate has been verified, it remains valid for the duration of the current session.</span></span> <span data-ttu-id="f97af-107">Desde que a impressão digital do certificado corresponda, o que indica que o certificado não foi alterado, o certificado continuará sendo validado novamente.</span><span class="sxs-lookup"><span data-stu-id="f97af-107">As long as the certificate fingerprint matches, which indicates that the certificate has not changed, the certificate continues to be re-validated.</span></span> <span data-ttu-id="f97af-108">Como resultado, qualquer alteração nos critérios de validação, por meio dos sinalizadores protocolo, verificação de revogação ou certificado-erro-ignorar, não entrará em vigor depois que o certificado for verificado.</span><span class="sxs-lookup"><span data-stu-id="f97af-108">As a result, any change in the validation criteria, through the protocol, revocation-check, or certificate-error-ignore flags, does not take effect once the certificate is verified.</span></span> <span data-ttu-id="f97af-109">Para forçar essa alteração a entrar em vigor imediatamente, a sessão atual deve ser finalizada e uma nova iniciada.</span><span class="sxs-lookup"><span data-stu-id="f97af-109">To force such a change to take effect immediately, the current session must be ended and a new one started.</span></span> <span data-ttu-id="f97af-110">Da mesma forma, a expiração de um certificado durante o curso de uma sessão só poderá ser detectada se o próprio aplicativo verificar periodicamente o servidor de certificado para recuperar os dados de expiração.</span><span class="sxs-lookup"><span data-stu-id="f97af-110">Similarly, expiration of a certificate during the course of a session can only be detected if the application itself checks the certificate server periodically to retrieve expiration data.</span></span>
-   <span data-ttu-id="f97af-111">**O proxy automático envolve o download e a execução de scripts.**</span><span class="sxs-lookup"><span data-stu-id="f97af-111">**Auto-proxy involves downloading and executing scripts.**</span></span> <span data-ttu-id="f97af-112">O suporte automático à descoberta de proxy envolve a detecção por meio de DHCP ou DNS, o download e a execução de scripts de proxy, como scripts java.</span><span class="sxs-lookup"><span data-stu-id="f97af-112">The automatic proxy discovery support involves detecting through DHCP or DNS, downloading, and executing proxy scripts such as Java scripts.</span></span> <span data-ttu-id="f97af-113">Para obter um nível mais alto de segurança, um aplicativo deve evitar a passagem do sinalizador de execução de um ponto de **\_ AutoProxy \_ \_ do WinHTTP** , para que a descoberta de proxy automático seja iniciada fora do processo.</span><span class="sxs-lookup"><span data-stu-id="f97af-113">To achieve a higher degree of security, an application must avoid passing the **WINHTTP\_AUTOPROXY\_RUN\_INPROCESS** flag, so that the auto-proxy discovery is initiated out-of-process.</span></span> <span data-ttu-id="f97af-114">Mesmo assim, o WinHTTP tenta, por padrão, executar um script de proxy automático em processo se o script não for executado corretamente fora do processo.</span><span class="sxs-lookup"><span data-stu-id="f97af-114">Even then, WinHTTP tries by default to run an auto-proxy script in-process if the script fails to run properly out-of-process.</span></span> <span data-ttu-id="f97af-115">Se você acreditar que esse comportamento de fallback representa um risco inaceitável, desabilite o comportamento de fallback com o sinalizador de **\_ \_ \_ \_ somente execução de outprocesso do WinHTTP AutoProxy** .</span><span class="sxs-lookup"><span data-stu-id="f97af-115">If you believe that this fallback behavior poses an unacceptable risk, disable the fallback behavior with the **WINHTTP\_AUTOPROXY\_RUN\_OUTPROCESS\_ONLY** flag.</span></span>
-   <span data-ttu-id="f97af-116">**As \_ funções de retorno de chamada de status do WinHTTP \_ devem retornar imediatamente.**</span><span class="sxs-lookup"><span data-stu-id="f97af-116">**WINHTTP\_STATUS\_CALLBACK functions must return promptly.**</span></span> <span data-ttu-id="f97af-117">Quando você escreve uma dessas funções de retorno de chamada, tenha cuidado para ela não ser bloqueada.</span><span class="sxs-lookup"><span data-stu-id="f97af-117">When you write one of these callback functions, be careful that it does not block.</span></span> <span data-ttu-id="f97af-118">Por exemplo, nem o retorno de chamada nem qualquer função que ele chama deve exibir uma caixa de diálogo de usuário ou aguardar um evento.</span><span class="sxs-lookup"><span data-stu-id="f97af-118">For example, neither the callback nor any function it calls should display a user dialog or wait for an event.</span></span> <span data-ttu-id="f97af-119">Se uma função de [*\_ retorno de \_ chamada de status do WinHTTP*](/windows/win32/api/winhttp/nc-winhttp-winhttp_status_callback) bloquear, ela afetará o agendamento interno do WinHTTP e fará com que outras solicitações no mesmo processo sejam negadas ao serviço.</span><span class="sxs-lookup"><span data-stu-id="f97af-119">If a [*WINHTTP\_STATUS\_CALLBACK*](/windows/win32/api/winhttp/nc-winhttp-winhttp_status_callback) function does block, it affects WinHTTP's internal scheduling and causes other requests within the same process to be denied service.</span></span>
-   <span data-ttu-id="f97af-120">**As \_ funções de retorno de chamada de status do WinHTTP \_ devem ser reentrante.**</span><span class="sxs-lookup"><span data-stu-id="f97af-120">**WINHTTP\_STATUS\_CALLBACK functions must be reentrant.**</span></span> <span data-ttu-id="f97af-121">Ao escrever um retorno de chamada, evite variáveis estáticas ou outras construções que não são seguras sob a reentrada e evite chamar outras funções que não são reentrante.</span><span class="sxs-lookup"><span data-stu-id="f97af-121">When writing a callback, avoid static variables or other constructs that are unsafe under reentrance, and avoid calling other functions that are not reentrant.</span></span>
-   <span data-ttu-id="f97af-122">**Se a operação assíncrona for possível, passe NULLs para parâmetros de saída.**</span><span class="sxs-lookup"><span data-stu-id="f97af-122">**If asynchronous operation is possible, pass NULLs for OUT parameters.**</span></span> <span data-ttu-id="f97af-123">Se você tiver habilitado a operação assíncrona registrando uma função de retorno de chamada, sempre passe valores **nulos** para esses parâmetros de saída como *lpdwDataAvailable* para [**WinHttpQueryDataAvailable**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpquerydataavailable), *lpdwBytesRead* para [**WinHttpReadData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreaddata)ou *lpdwBytesWritten* para [**WinHttpWriteData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpwritedata).</span><span class="sxs-lookup"><span data-stu-id="f97af-123">If you have enabled asynchronous operation by registering a callback function, always pass **NULL** values for such OUT parameters as *lpdwDataAvailable* for [**WinHttpQueryDataAvailable**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpquerydataavailable), *lpdwBytesRead* for [**WinHttpReadData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreaddata), or *lpdwBytesWritten* for [**WinHttpWriteData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpwritedata).</span></span> <span data-ttu-id="f97af-124">Em algumas circunstâncias, o thread de chamada é encerrado antes da conclusão da operação e, se os parâmetros de saída não forem **nulos**, a função poderá acabar gravando na memória que já foi liberada.</span><span class="sxs-lookup"><span data-stu-id="f97af-124">Under some circumstances, the calling thread is terminated before the operation completes, and if the OUT parameters are not **NULL**, the function can end up writing to memory that has already been freed.</span></span>
-   <span data-ttu-id="f97af-125">**A autenticação do Passport não é à prova de infalível.**</span><span class="sxs-lookup"><span data-stu-id="f97af-125">**Passport authentication is not foolproof.**</span></span> <span data-ttu-id="f97af-126">Qualquer esquema de autenticação baseado em cookie é vulnerável a ataques.</span><span class="sxs-lookup"><span data-stu-id="f97af-126">Any cookie-based authentication scheme is vulnerable to attack.</span></span> <span data-ttu-id="f97af-127">O Passport versão 1,4 é baseado em cookies e, portanto, sujeito às vulnerabilidades associadas a qualquer cookie ou esquema de autenticação baseado em formulário.</span><span class="sxs-lookup"><span data-stu-id="f97af-127">Passport version 1.4 is cookie based, and therefore subject to the vulnerabilities that are associated with any cookie or form-based authentication scheme.</span></span> <span data-ttu-id="f97af-128">O suporte do Passport está desabilitado por padrão no WinHTTP; Ele pode ser habilitado usando [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span><span class="sxs-lookup"><span data-stu-id="f97af-128">Passport support is disabled by default in WinHTTP; it can be enabled using [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span></span>
-   <span data-ttu-id="f97af-129">**A autenticação básica só deve ser usada em uma conexão segura.**</span><span class="sxs-lookup"><span data-stu-id="f97af-129">**Basic authentication should only be used over a secure connection.**</span></span> <span data-ttu-id="f97af-130">A autenticação básica, que envia o nome de usuário e a senha em texto não criptografado (consulte [RFC 2617](https://www.ietf.org/rfc/rfc2617.txt)), deve ser usada somente em conexões SSL ou TLS Encrypted.</span><span class="sxs-lookup"><span data-stu-id="f97af-130">Basic authentication, which sends the user name and password in clear text (see [RFC 2617](https://www.ietf.org/rfc/rfc2617.txt)), should be used only over encrypted SSL or TLS connections.</span></span>
-   <span data-ttu-id="f97af-131">**Definir a política de logon automático como "baixo" pode representar um risco.**</span><span class="sxs-lookup"><span data-stu-id="f97af-131">**Setting Auto-Logon Policy to "low" can pose a risk.**</span></span> <span data-ttu-id="f97af-132">Quando a política de logon automático é definida como baixa, a credencial de logon de um usuário pode ser usada para autenticar em qualquer site.</span><span class="sxs-lookup"><span data-stu-id="f97af-132">When the Auto-Logon Policy is set to low, a user's logon credential can be used to authenticate against any site.</span></span> <span data-ttu-id="f97af-133">No entanto, não é uma boa prática de segurança se autenticar em sites nos quais você não confia.</span><span class="sxs-lookup"><span data-stu-id="f97af-133">However, it is not good security practice to authenticate against sites you do not trust.</span></span>
-   <span data-ttu-id="f97af-134">**As conexões SSL 2,0 não são usadas, a menos que sejam explicitamente habilitadas.**</span><span class="sxs-lookup"><span data-stu-id="f97af-134">**SSL 2.0 connections are not used unless explicitly enabled.**</span></span> <span data-ttu-id="f97af-135">Os protocolos de segurança TLS 1,0 e SSL 3,0 são considerados mais seguros do que o SSL 2,0.</span><span class="sxs-lookup"><span data-stu-id="f97af-135">The TLS 1.0 and SSL 3.0 security protocols are considered more secure than SSL 2.0.</span></span> <span data-ttu-id="f97af-136">Por padrão, o WinHTTP solicita TLS 1,0 ou SSL 3,0 ao negociar uma conexão SSL, não SSL 2,0.</span><span class="sxs-lookup"><span data-stu-id="f97af-136">By default, WinHTTP requests TLS 1.0 or SSL 3.0 when negotiating an SSL connection, not SSL 2.0.</span></span> <span data-ttu-id="f97af-137">O suporte a SSL 2,0 no WinHTTP só pode ser habilitado chamando [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span><span class="sxs-lookup"><span data-stu-id="f97af-137">SSL 2.0 support in WinHTTP can only be enabled by calling [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span></span>
-   <span data-ttu-id="f97af-138">**Certificado-a verificação de revogação deve ser solicitada explicitamente.**</span><span class="sxs-lookup"><span data-stu-id="f97af-138">**Certificate-revocation checking must be explicitly requested.**</span></span> <span data-ttu-id="f97af-139">Por padrão, ao executar a autenticação de certificado, o WinHTTP não verifica se o certificado do servidor foi revogado.</span><span class="sxs-lookup"><span data-stu-id="f97af-139">By default, when performing certificate authentication, WinHTTP does not check whether the server's certificate has been revoked.</span></span> <span data-ttu-id="f97af-140">A verificação de revogação de certificado pode ser habilitada usando [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span><span class="sxs-lookup"><span data-stu-id="f97af-140">Certificate-revocation checking can be enabled using [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span></span>
-   <span data-ttu-id="f97af-141">**Os aplicativos devem garantir que uma sessão seja mapeada para uma única identidade.**</span><span class="sxs-lookup"><span data-stu-id="f97af-141">**Applications must ensure that a session maps to a single identity.**</span></span> <span data-ttu-id="f97af-142">Uma sessão do WinHTTP deve ser mapeada para apenas uma identidade; ou seja, uma sessão do WinHTTP é usada para gerenciar a atividade da Internet de um único usuário autenticado ou um grupo de usuários anônimos.</span><span class="sxs-lookup"><span data-stu-id="f97af-142">A WinHTTP session should map to one and only one identity; that is, a WinHTTP session is used to manage the Internet activity of a single authenticated user, or a group of anonymous users.</span></span> <span data-ttu-id="f97af-143">No entanto, como o WinHTTP não impõe esse mapeamento automaticamente, seu aplicativo deve executar etapas para garantir que apenas uma única identidade esteja envolvida.</span><span class="sxs-lookup"><span data-stu-id="f97af-143">However, because WinHTTP does not enforce this mapping automatically, your application must take steps to ensure that only a single identity is involved.</span></span>
-   <span data-ttu-id="f97af-144">**As operações em um identificador de solicitação WinHTTP devem ser sincronizadas.**</span><span class="sxs-lookup"><span data-stu-id="f97af-144">**Operations on a WinHTTP request handle should be synchronized.**</span></span> <span data-ttu-id="f97af-145">Por exemplo, um aplicativo deve evitar fechar um identificador de solicitação em um thread enquanto outro thread está enviando ou recebendo uma solicitação.</span><span class="sxs-lookup"><span data-stu-id="f97af-145">For example, an application should avoid closing a request handle on one thread while another thread is sending or receiving a request.</span></span> <span data-ttu-id="f97af-146">Para encerrar uma solicitação assíncrona, feche o identificador de solicitação durante uma notificação de retorno de chamada.</span><span class="sxs-lookup"><span data-stu-id="f97af-146">To terminate an asynchronous request, close the request handle during a callback notification.</span></span> <span data-ttu-id="f97af-147">Para encerrar uma solicitação síncrona, feche o identificador quando a chamada WinHTTP anterior retornar.</span><span class="sxs-lookup"><span data-stu-id="f97af-147">To terminate a synchronous request, close the handle when the previous WinHTTP call returns.</span></span>
-   <span data-ttu-id="f97af-148">**Os arquivos de rastreamento contêm informações confidenciais.**</span><span class="sxs-lookup"><span data-stu-id="f97af-148">**Trace files contain sensitive information.**</span></span> <span data-ttu-id="f97af-149">Os arquivos de rastreamento são protegidos usando listas de Access-Control (ACLs) para que normalmente possa ser acessado apenas pelo administrador local ou pela conta de usuário que o criou. Evite comprometer arquivos de rastreamento por qualquer acesso não autorizado.</span><span class="sxs-lookup"><span data-stu-id="f97af-149">Trace files are protected using Access-Control Lists (ACLs) so that one can normally be accessed only by the local administrator or by the user account that created it.Avoid compromising trace files by any unauthorized access.</span></span>
-   <span data-ttu-id="f97af-150">**Evite passar dados confidenciais por meio** de [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span><span class="sxs-lookup"><span data-stu-id="f97af-150">**Avoid passing sensitive data through** [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span></span> <span data-ttu-id="f97af-151">Não forneça um nome de usuário, senha ou outras credenciais a **WinHttpSetOption** porque você não tem controle sobre o esquema de autenticação que é usado, e os dados confidenciais podem ser enviados inesperadamente em texto não criptografado.</span><span class="sxs-lookup"><span data-stu-id="f97af-151">Do not supply a user name, password or any other credentials to **WinHttpSetOption** because you have no control over the authentication scheme that is used, and the sensitive data could unexpectedly be sent in clear text.</span></span> <span data-ttu-id="f97af-152">Use [**WinHttpQueryAuthSchemes**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryauthschemes) e **WinHttpSetCredentials** em vez de **WinHttpSetOption** para definir credenciais.</span><span class="sxs-lookup"><span data-stu-id="f97af-152">Use [**WinHttpQueryAuthSchemes**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryauthschemes) and **WinHttpSetCredentials** instead of **WinHttpSetOption** for setting credentials.</span></span>
-   <span data-ttu-id="f97af-153">**O redirecionamento automático pode representar um risco de segurança.**</span><span class="sxs-lookup"><span data-stu-id="f97af-153">**Automatic redirection can pose a security risk.**</span></span> <span data-ttu-id="f97af-154">Por padrão, o redirecionamento (uma mensagem 302) é seguido automaticamente até mesmo para uma POSTAgem.</span><span class="sxs-lookup"><span data-stu-id="f97af-154">By default, redirection (a 302 message) is followed automatically even for a POST.</span></span> <span data-ttu-id="f97af-155">Para evitar a possibilidade de redirecionamentos falsos, os aplicativos devem desabilitar o redirecionamento automático ou monitorar a redireção em retornos de chamada ao postar informações confidenciais.</span><span class="sxs-lookup"><span data-stu-id="f97af-155">To avoid the possibility of spurious redirects, applications should disable auto-redirect or monitor re-direction in callbacks when posting sensitive information.</span></span>
-   <span data-ttu-id="f97af-156">**Os cabeçalhos definidos pelo usuário são transferidos entre redirecionamentos inalterados.**</span><span class="sxs-lookup"><span data-stu-id="f97af-156">**User-defined headers are transferred across redirects unchanged.**</span></span> <span data-ttu-id="f97af-157">Os cabeçalhos definidos pelo usuário, como os cookies adicionados com **WinHTTPAddRequestHeaders**, são transferidos entre redirecionamentos sem modificação, enquanto os cabeçalhos gerados pelo WinHTTP são atualizados automaticamente.</span><span class="sxs-lookup"><span data-stu-id="f97af-157">User-defined headers, such as cookies added with **WinHTTPAddRequestHeaders**, are transferred across redirects without modification, while headers generated by WinHTTP are automatically updated.</span></span> <span data-ttu-id="f97af-158">Se a transferência de um cabeçalho definido pelo usuário entre redirecionamentos representar um risco de segurança, use o retorno de chamada de [*\_ status \_ do WinHTTP*](/windows/win32/api/winhttp/nc-winhttp-winhttp_status_callback) com a conclusão de **\_ \_ \_ redirecionamento de status de retorno de chamada de WinHTTP** para modificar o cabeçalho em questão sempre que ocorrer um redirecionamento.</span><span class="sxs-lookup"><span data-stu-id="f97af-158">If transferring a user-defined header across redirects poses a security risk, use the [*WINHTTP\_STATUS\_CALLBACK*](/windows/win32/api/winhttp/nc-winhttp-winhttp_status_callback) callback with the **WINHTTP\_CALLBACK\_STATUS\_REDIRECT** completion to modify the header in question whenever a redirect occurs.</span></span>
-   <span data-ttu-id="f97af-159">**O WinHTTP não é reentrante no modo síncrono.**</span><span class="sxs-lookup"><span data-stu-id="f97af-159">**WinHTTP is not reentrant in synchronous mode.**</span></span> <span data-ttu-id="f97af-160">Como o WinHTTP não é reentrante no modo síncrono, não agende as chamadas de procedimento assíncrono (APC) que podem chamar o WinHTTP em um thread de aplicativo executado dentro de uma função WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="f97af-160">Because WinHTTP is not reentrant in synchronous mode, do not schedule asynchronous procedure calls (APC) that can call into WinHTTP on an application thread that executes inside a WinHTTP function.</span></span> <span data-ttu-id="f97af-161">No modo síncrono, o WinHTTP executa uma "espera de alerta" e, se o thread em espera for substituídas para executar uma APC e depois inserir novamente o WinHTTP novamente, o estado interno do WinHTTP poderá ser corrompido.</span><span class="sxs-lookup"><span data-stu-id="f97af-161">While in synchronous mode, WinHTTP performs an "alertable wait," and if the waiting thread is pre-empted to execute an APC and then later re-enters WinHTTP again, WinHTTP's internal state can be corrupted.</span></span>

 

 
