---
description: 'As seguintes considerações de segurança se aplicam a aplicativos que usam WinHTTP: certificados de servidor são verificados apenas uma vez por sessão.'
ms.assetid: 287e85ed-a324-4785-872a-26e4ab37986d
title: Considerações de segurança de WinHTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b80d813fa5b50cb9c880598d3187c697412d1dab1d7fdd80b4507d17d03eff6a
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/11/2021
ms.locfileid: "119955686"
---
# <a name="winhttp-security-considerations"></a>Considerações de segurança de WinHTTP

As seguintes considerações de segurança se aplicam a aplicativos que usam o WinHTTP:

-   **Os certificados de servidor são verificados apenas uma vez por sessão.** Depois que um certificado tiver sido verificado, ele permanecerá válido durante a sessão atual. Desde que a impressão digital do certificado corresponda, o que indica que o certificado não foi alterado, o certificado continuará sendo validado novamente. Como resultado, qualquer alteração nos critérios de validação, por meio dos sinalizadores protocolo, verificação de revogação ou certificado-erro-ignorar, não entrará em vigor depois que o certificado for verificado. Para forçar essa alteração a entrar em vigor imediatamente, a sessão atual deve ser finalizada e uma nova iniciada. Da mesma forma, a expiração de um certificado durante o curso de uma sessão só poderá ser detectada se o próprio aplicativo verificar periodicamente o servidor de certificado para recuperar os dados de expiração.
-   **O proxy automático envolve o download e a execução de scripts.** O suporte automático à descoberta de proxy envolve a detecção por meio de DHCP ou DNS, o download e a execução de scripts de proxy, como scripts java. Para obter um nível mais alto de segurança, um aplicativo deve evitar a passagem do sinalizador de execução de um ponto de **\_ AutoProxy \_ \_ do WinHTTP** , para que a descoberta de proxy automático seja iniciada fora do processo. Mesmo assim, o WinHTTP tenta, por padrão, executar um script de proxy automático em processo se o script não for executado corretamente fora do processo. Se você acreditar que esse comportamento de fallback representa um risco inaceitável, desabilite o comportamento de fallback com o sinalizador de **\_ \_ \_ \_ somente execução de outprocesso do WinHTTP AutoProxy** .
-   **As \_ funções de retorno de chamada de status do WinHTTP \_ devem retornar imediatamente.** Quando você escreve uma dessas funções de retorno de chamada, tenha cuidado para ela não ser bloqueada. Por exemplo, nem o retorno de chamada nem qualquer função que ele chama deve exibir uma caixa de diálogo de usuário ou aguardar um evento. Se uma função de [*\_ retorno de \_ chamada de status do WinHTTP*](/windows/win32/api/winhttp/nc-winhttp-winhttp_status_callback) bloquear, ela afetará o agendamento interno do WinHTTP e fará com que outras solicitações no mesmo processo sejam negadas ao serviço.
-   **As \_ funções de retorno de chamada de status do WinHTTP \_ devem ser reentrante.** Ao escrever um retorno de chamada, evite variáveis estáticas ou outras construções que não são seguras sob a reentrada e evite chamar outras funções que não são reentrante.
-   **Se a operação assíncrona for possível, passe NULLs para parâmetros de saída.** Se você tiver habilitado a operação assíncrona registrando uma função de retorno de chamada, sempre passe valores **nulos** para esses parâmetros de saída como *lpdwDataAvailable* para [**WinHttpQueryDataAvailable**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpquerydataavailable), *lpdwBytesRead* para [**WinHttpReadData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreaddata)ou *lpdwBytesWritten* para [**WinHttpWriteData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpwritedata). Em algumas circunstâncias, o thread de chamada é encerrado antes da conclusão da operação e, se os parâmetros de saída não forem **nulos**, a função poderá acabar gravando na memória que já foi liberada.
-   **A autenticação do Passport não é à prova de infalível.** Qualquer esquema de autenticação baseado em cookie é vulnerável a ataques. O Passport versão 1,4 é baseado em cookies e, portanto, sujeito às vulnerabilidades associadas a qualquer cookie ou esquema de autenticação baseado em formulário. O suporte do Passport está desabilitado por padrão no WinHTTP; Ele pode ser habilitado usando [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).
-   **A autenticação básica só deve ser usada em uma conexão segura.** A autenticação básica, que envia o nome de usuário e a senha em texto não criptografado (consulte [RFC 2617](https://www.ietf.org/rfc/rfc2617.txt)), deve ser usada somente em conexões SSL ou TLS Encrypted.
-   **Definir a política de logon automático como "baixo" pode representar um risco.** Quando a política de logon automático é definida como baixa, a credencial de logon de um usuário pode ser usada para autenticar em qualquer site. No entanto, não é uma boa prática de segurança se autenticar em sites nos quais você não confia.
-   **As conexões SSL 2,0 não são usadas, a menos que sejam explicitamente habilitadas.** Os protocolos de segurança TLS 1,0 e SSL 3,0 são considerados mais seguros do que o SSL 2,0. Por padrão, o WinHTTP solicita TLS 1,0 ou SSL 3,0 ao negociar uma conexão SSL, não SSL 2,0. O suporte a SSL 2,0 no WinHTTP só pode ser habilitado chamando [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).
-   **Certificado-a verificação de revogação deve ser solicitada explicitamente.** Por padrão, ao executar a autenticação de certificado, o WinHTTP não verifica se o certificado do servidor foi revogado. A verificação de revogação de certificado pode ser habilitada usando [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).
-   **Os aplicativos devem garantir que uma sessão seja mapeada para uma única identidade.** Uma sessão do WinHTTP deve ser mapeada para apenas uma identidade; ou seja, uma sessão do WinHTTP é usada para gerenciar a atividade da Internet de um único usuário autenticado ou um grupo de usuários anônimos. No entanto, como o WinHTTP não impõe esse mapeamento automaticamente, seu aplicativo deve executar etapas para garantir que apenas uma única identidade esteja envolvida.
-   **As operações em um identificador de solicitação WinHTTP devem ser sincronizadas.** Por exemplo, um aplicativo deve evitar fechar um identificador de solicitação em um thread enquanto outro thread está enviando ou recebendo uma solicitação. Para encerrar uma solicitação assíncrona, feche o identificador de solicitação durante uma notificação de retorno de chamada. Para encerrar uma solicitação síncrona, feche o identificador quando a chamada WinHTTP anterior retornar.
-   **Os arquivos de rastreamento contêm informações confidenciais.** Os arquivos de rastreamento são protegidos usando listas de Access-Control (ACLs) para que normalmente possa ser acessado apenas pelo administrador local ou pela conta de usuário que o criou. Evite comprometer arquivos de rastreamento por qualquer acesso não autorizado.
-   **Evite passar dados confidenciais por meio** de [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption). Não forneça um nome de usuário, senha ou outras credenciais a **WinHttpSetOption** porque você não tem controle sobre o esquema de autenticação que é usado, e os dados confidenciais podem ser enviados inesperadamente em texto não criptografado. Use [**WinHttpQueryAuthSchemes**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryauthschemes) e **WinHttpSetCredentials** em vez de **WinHttpSetOption** para definir credenciais.
-   **O redirecionamento automático pode representar um risco de segurança.** Por padrão, o redirecionamento (uma mensagem 302) é seguido automaticamente até mesmo para uma POSTAgem. Para evitar a possibilidade de redirecionamentos falsos, os aplicativos devem desabilitar o redirecionamento automático ou monitorar a redireção em retornos de chamada ao postar informações confidenciais.
-   **Os cabeçalhos definidos pelo usuário são transferidos entre redirecionamentos inalterados.** Os cabeçalhos definidos pelo usuário, como os cookies adicionados com **WinHTTPAddRequestHeaders**, são transferidos entre redirecionamentos sem modificação, enquanto os cabeçalhos gerados pelo WinHTTP são atualizados automaticamente. Se a transferência de um cabeçalho definido pelo usuário entre redirecionamentos representar um risco de segurança, use o retorno de chamada de [*\_ status \_ do WinHTTP*](/windows/win32/api/winhttp/nc-winhttp-winhttp_status_callback) com a conclusão de **\_ \_ \_ redirecionamento de status de retorno de chamada de WinHTTP** para modificar o cabeçalho em questão sempre que ocorrer um redirecionamento.
-   **O WinHTTP não é reentrante no modo síncrono.** Como o WinHTTP não é reentrante no modo síncrono, não agende as chamadas de procedimento assíncrono (APC) que podem chamar o WinHTTP em um thread de aplicativo executado dentro de uma função WinHTTP. No modo síncrono, o WinHTTP executa uma "espera de alerta" e, se o thread em espera for substituídas para executar uma APC e depois inserir novamente o WinHTTP novamente, o estado interno do WinHTTP poderá ser corrompido.

 

 
