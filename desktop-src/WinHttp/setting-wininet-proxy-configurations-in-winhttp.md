---
description: Os aplicativos que porta do WinINet para o WinHTTP talvez precisem usar as mesmas configurações de AutoProxy que podem ser recuperadas sob o WinINet ou Internet Explorer (IE).
ms.assetid: c3e867d8-9d67-4e6a-8551-1fa846e089ed
title: Definindo as configurações de proxy do WinINet no WinHTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 91306f6591e0aab0f96fa010ee2a83d3f32c8fb4
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "103922779"
---
# <a name="setting-wininet-proxy-configurations-in-winhttp"></a><span data-ttu-id="2fa86-103">Definindo as configurações de proxy do WinINet no WinHTTP</span><span class="sxs-lookup"><span data-stu-id="2fa86-103">Setting WinINet Proxy Configurations in WinHTTP</span></span>

## <a name="setting-automatic-proxy-on-winhttp-51"></a><span data-ttu-id="2fa86-104">Definindo o proxy automático no WinHTTP 5,1</span><span class="sxs-lookup"><span data-stu-id="2fa86-104">Setting Automatic Proxy on WinHTTP 5.1</span></span>

<span data-ttu-id="2fa86-105">Os aplicativos que porta do WinINet para o WinHTTP talvez precisem usar as mesmas configurações de AutoProxy que podem ser recuperadas sob o WinINet ou Internet Explorer (IE).</span><span class="sxs-lookup"><span data-stu-id="2fa86-105">Applications that port from WinINet to WinHTTP may need to use the same autoproxy settings that they can retrieve under WinINet or Internet Explorer (IE).</span></span> <span data-ttu-id="2fa86-106">A API do WinHTTP versão 5,1 pode recuperar e usar essas configurações de proxy.</span><span class="sxs-lookup"><span data-stu-id="2fa86-106">The WinHTTP version 5.1 API can retrieve and use these proxy settings.</span></span> <span data-ttu-id="2fa86-107">Em geral, o WinHTTP especifica os servidores proxy e proxy bypass em uma base por sessão quando a sessão é criada.</span><span class="sxs-lookup"><span data-stu-id="2fa86-107">In general, WinHTTP specifies the proxy and proxy bypass servers on a per-session basis when the session is created.</span></span> <span data-ttu-id="2fa86-108">Essas configurações podem ser substituídas por solicitação.</span><span class="sxs-lookup"><span data-stu-id="2fa86-108">These settings can be overridden on a per-request basis.</span></span>

<span data-ttu-id="2fa86-109">Para usar a mesma configuração de proxy que o WinINet ou o IE, o cliente WinHTTP deve definir as configurações de proxy para a sessão.</span><span class="sxs-lookup"><span data-stu-id="2fa86-109">To use the same proxy configuration as WinINet or IE, the WinHTTP client should set proxy settings for the session.</span></span> <span data-ttu-id="2fa86-110">Além disso, se o IE ou o WinINet estiverem configurados para usar a descoberta automática de proxy da Web (WPAD), o cliente WinHTTP que usa essas configurações deve definir as configurações de proxy por solicitação.</span><span class="sxs-lookup"><span data-stu-id="2fa86-110">In addition, if IE or WinINet are configured to use Web Proxy Auto-Discovery (WPAD), the WinHTTP client that uses those settings must set proxy settings on a per-request basis.</span></span> <span data-ttu-id="2fa86-111">As seções a seguir descrevem como especificar as configurações de proxy para uma sessão e uma solicitação:</span><span class="sxs-lookup"><span data-stu-id="2fa86-111">The following sections describe how to specify the proxy settings for a session and a request:</span></span>

-   [<span data-ttu-id="2fa86-112">Definindo a configuração de proxy em uma sessão</span><span class="sxs-lookup"><span data-stu-id="2fa86-112">Setting the Proxy Configuration on a Session</span></span>](#setting-the-proxy-configuration-on-a-session)
-   [<span data-ttu-id="2fa86-113">Definindo a configuração de proxy em uma única solicitação</span><span class="sxs-lookup"><span data-stu-id="2fa86-113">Setting the Proxy Configuration on a Single Request</span></span>](#setting-the-proxy-configuration-on-a-single-request)

## <a name="setting-the-proxy-configuration-on-a-session"></a><span data-ttu-id="2fa86-114">Definindo a configuração de proxy em uma sessão</span><span class="sxs-lookup"><span data-stu-id="2fa86-114">Setting the Proxy Configuration on a Session</span></span>

## <a name="the-application-is-running-on-a-user-account"></a><span data-ttu-id="2fa86-115">O aplicativo está sendo executado em uma conta de usuário</span><span class="sxs-lookup"><span data-stu-id="2fa86-115">The Application is Running on a User Account</span></span>

<span data-ttu-id="2fa86-116">Antes de uma sessão ser criada, o aplicativo chama [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) para obter as configurações de proxy do IE.</span><span class="sxs-lookup"><span data-stu-id="2fa86-116">Before a session is created, the application calls [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) to get the IE proxy settings.</span></span> <span data-ttu-id="2fa86-117">O aplicativo deve estar sendo executado como uma conta de usuário para obter essas configurações.</span><span class="sxs-lookup"><span data-stu-id="2fa86-117">The application must be running as a user account to obtain these settings.</span></span> <span data-ttu-id="2fa86-118">O parâmetro *pProxyConfig* é um ponteiro para uma estrutura de [**\_ \_ \_ \_ \_ configuração de proxy do usuário atual do WinHTTP**](/windows/win32/api/winhttp/ns-winhttp-winhttp_current_user_ie_proxy_config) que contém os servidores de nome do proxy (*lpszProxy*) e bypass do proxy (*lpszProxyBypass*).</span><span class="sxs-lookup"><span data-stu-id="2fa86-118">The *pProxyConfig* parameter is a pointer to a [**WINHTTP\_CURRENT\_USER\_IE\_PROXY\_CONFIG**](/windows/win32/api/winhttp/ns-winhttp-winhttp_current_user_ie_proxy_config) structure that contains the proxy name (*lpszProxy*) and proxy bypass (*lpszProxyBypass*) servers.</span></span> <span data-ttu-id="2fa86-119">O nome do proxy e os valores de bypass do proxy da estrutura de **\_ \_ \_ \_ \_ configuração de proxy do usuário atual do WinHTTP** são usados para inicializar a sessão do WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="2fa86-119">The proxy name and proxy bypass values of the **WINHTTP\_CURRENT\_USER\_IE\_PROXY\_CONFIG** structure are then used to initialize the WinHTTP session.</span></span> <span data-ttu-id="2fa86-120">A sessão é inicializada chamando [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen) com os parâmetros *pwszProxyName* e *pwszProxyBypass* obtidos dos membros **lpszProxy** e **lpszProxyBypass** da estrutura de **configuração de \_ proxy de \_ IE do usuário \_ \_ \_ atual do WinHTTP** .</span><span class="sxs-lookup"><span data-stu-id="2fa86-120">The session is initialized by calling [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen) with the *pwszProxyName* and *pwszProxyBypass* parameters obtained from the **lpszProxy** and **lpszProxyBypass** members of the **WINHTTP\_CURRENT\_USER\_IE\_PROXY\_CONFIG** structure.</span></span>

## <a name="the-application-is-running-as-a-service"></a><span data-ttu-id="2fa86-121">O aplicativo está sendo executado como um serviço</span><span class="sxs-lookup"><span data-stu-id="2fa86-121">The Application is Running as a Service</span></span>

<span data-ttu-id="2fa86-122">O aplicativo deve garantir que as configurações do registro para um usuário individual sejam carregadas no registro antes de chamar [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser).</span><span class="sxs-lookup"><span data-stu-id="2fa86-122">The application must ensure that the registry settings for an individual user are loaded into the registry before calling [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser).</span></span> <span data-ttu-id="2fa86-123">Se essas configurações não forem carregadas no registro, o **WinHttpGetIEProxyConfigForCurrentUser** não poderá obter as configurações de proxy.</span><span class="sxs-lookup"><span data-stu-id="2fa86-123">If these settings are not loaded into the registry, **WinHttpGetIEProxyConfigForCurrentUser** cannot obtain the proxy settings.</span></span> <span data-ttu-id="2fa86-124">As configurações do registro para um usuário individual podem ser carregadas no registro chamando a função **LoadUserProfile** .</span><span class="sxs-lookup"><span data-stu-id="2fa86-124">Registry settings for an individual user can be loaded into the registry by calling the **LoadUserProfile** function.</span></span> <span data-ttu-id="2fa86-125">Se o carregamento das configurações do registro do usuário não for uma opção, o aplicativo poderá chamar [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen) com o **\_ \_ \_ \_ proxy padrão do tipo de acesso WinHTTP** especificado no parâmetro *dwAcessType* .</span><span class="sxs-lookup"><span data-stu-id="2fa86-125">If loading the user's registry settings is not an option, the application can call [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen) with the **WINHTTP\_ACCESS\_TYPE\_DEFAULT\_PROXY** specified in the *dwAcessType* parameter.</span></span> <span data-ttu-id="2fa86-126">Especificar o proxy padrão na chamada para **WinHttpOpen** informa à API do WinHTTP para recuperar o conjunto de configuração de proxy usando o utilitário WinHTTP [**proxycfg.exe**](proxycfg-exe--a-proxy-configuration-tool.md) .</span><span class="sxs-lookup"><span data-stu-id="2fa86-126">Specifying the default proxy in the call to **WinHttpOpen** tells the WinHTTP API to retrieve the proxy configuration set by using the WinHTTP [**proxycfg.exe**](proxycfg-exe--a-proxy-configuration-tool.md) utility.</span></span> <span data-ttu-id="2fa86-127">Depois que as configurações do registro de um usuário individual tiverem sido carregadas, o aplicativo seguirá as etapas descritas sob [o aplicativo que está sendo executado em uma conta de usuário](#the-application-is-running-on-a-user-account) para definir o nome do proxy e os servidores de bypass de proxy.</span><span class="sxs-lookup"><span data-stu-id="2fa86-127">After the registry settings for an individual user have been loaded, the application follows the steps outlined under [The application is running on a user account](#the-application-is-running-on-a-user-account) to set the proxy name and proxy bypass servers.</span></span>

## <a name="setting-the-proxy-configuration-on-a-single-request"></a><span data-ttu-id="2fa86-128">Definindo a configuração de proxy em uma única solicitação</span><span class="sxs-lookup"><span data-stu-id="2fa86-128">Setting the Proxy Configuration on a Single Request</span></span>

<span data-ttu-id="2fa86-129">Antes de a sessão ser criada, o aplicativo chama [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) para determinar se o WinInet e o IE estão configurados para usar o WPAD.</span><span class="sxs-lookup"><span data-stu-id="2fa86-129">Before the session is created, the application calls [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) to determine if WinINet and IE are configured to use WPAD.</span></span> <span data-ttu-id="2fa86-130">**WinHttpGetIEProxyConfigForCurrentUser** retorna a estrutura de [**\_ \_ \_ \_ \_ configuração do proxy IE do usuário atual do WinHTTP**](/windows/win32/api/winhttp/ns-winhttp-winhttp_current_user_ie_proxy_config) que contém o membro **fAutoDetect** .</span><span class="sxs-lookup"><span data-stu-id="2fa86-130">**WinHttpGetIEProxyConfigForCurrentUser** returns the [**WINHTTP\_CURRENT\_USER\_IE\_PROXY\_CONFIG**](/windows/win32/api/winhttp/ns-winhttp-winhttp_current_user_ie_proxy_config) structure that contains the **fAutoDetect** member.</span></span> <span data-ttu-id="2fa86-131">Um valor de **true** para esse membro indica que WPAD é usado e o membro **LPSZAUTOCONFIGURL** contém a URL WPAD.</span><span class="sxs-lookup"><span data-stu-id="2fa86-131">A value of **TRUE** for this member indicates that WPAD is used, and the **lpszAutoConfigUrl** member contains the WPAD URL.</span></span>

## <a name="automatic-proxy-configuration-is-used"></a><span data-ttu-id="2fa86-132">A configuração automática de proxy é usada</span><span class="sxs-lookup"><span data-stu-id="2fa86-132">Automatic Proxy Configuration Is Used</span></span>

<span data-ttu-id="2fa86-133">Se o WPAD for usado, o aplicativo chamará [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) para recuperar o proxy para a solicitação.</span><span class="sxs-lookup"><span data-stu-id="2fa86-133">If WPAD is used, the application calls [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) to retrieve the proxy for the request.</span></span> <span data-ttu-id="2fa86-134">O parâmetro *lpwszUrl* contém a URL para a qual a solicitação está sendo enviada, e o parâmetro *pAutoProxyOptions* contém um ponteiro para a estrutura [**( \_ \_ Opções de proxy de WinHTTP**](/windows/win32/api/winhttp/ns-winhttp-winhttp_autoproxy_options)) que contém as opções de AutoProxy.</span><span class="sxs-lookup"><span data-stu-id="2fa86-134">The *lpwszUrl* parameter contains the URL that the request is being sent to, and the *pAutoProxyOptions* parameter contains a pointer to the structure ([**WINHTTP\_AUTOPROXY\_OPTIONS**](/windows/win32/api/winhttp/ns-winhttp-winhttp_autoproxy_options)) that contains the autoproxy options.</span></span> <span data-ttu-id="2fa86-135">O aplicativo Inicializa a estrutura de **\_ \_ Opções de AutoProxy do WinHTTP** com as configurações retornadas da estrutura de configuração de [**proxy de IE do \_ \_ usuário \_ \_ \_ atual do WinHTTP**](/windows/win32/api/winhttp/ns-winhttp-winhttp_current_user_ie_proxy_config) na chamada para [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser).</span><span class="sxs-lookup"><span data-stu-id="2fa86-135">The application initializes the **WINHTTP\_AUTOPROXY\_OPTIONS** structure with the settings returned from the [**WINHTTP\_CURRENT\_USER\_IE\_PROXY\_CONFIG**](/windows/win32/api/winhttp/ns-winhttp-winhttp_current_user_ie_proxy_config) structure in the call to [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser).</span></span> <span data-ttu-id="2fa86-136">O sinalizador de **URL de \_ \_ configuração \_ de AutoProxy do WinHTTP** é especificado no membro **dwFlags** da estrutura de **\_ \_ Opções de AUTOproxy do WinHTTP** e o membro **lpszAutoconfigUrl** contém a URL de configuração automática do proxy da estrutura da configuração de **\_ \_ \_ \_ \_ proxy do usuário atual do WinHTTP** .</span><span class="sxs-lookup"><span data-stu-id="2fa86-136">The **WINHTTP\_AUTOPROXY\_CONFIG\_URL** flag is specified in the **dwFlags** member of the **WINHTTP\_AUTOPROXY\_OPTIONS** structure, and the **lpszAutoconfigUrl** member contains the proxy auto-configuration URL from the **WINHTTP\_CURRENT\_USER\_IE\_PROXY\_CONFIG** structure.</span></span> <span data-ttu-id="2fa86-137">A função **WinHttpGetProxyForUrl** retorna o nome do proxy e a lista de bypass de proxy nos membros **lpszProxy** e **lpszProxyBypass** da estrutura de [**\_ \_ informações de proxy WinHTTP**](/windows/win32/api/winhttp/ns-winhttp-winhttp_proxy_info) .</span><span class="sxs-lookup"><span data-stu-id="2fa86-137">The **WinHttpGetProxyForUrl** function returns the proxy name and the proxy bypass list in the **lpszProxy** and **lpszProxyBypass** members of the [**WINHTTP\_PROXY\_INFO**](/windows/win32/api/winhttp/ns-winhttp-winhttp_proxy_info) structure.</span></span>

<span data-ttu-id="2fa86-138">Depois que o proxy para a solicitação for obtido de [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl), o aplicativo criará a solicitação com [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest).</span><span class="sxs-lookup"><span data-stu-id="2fa86-138">After the proxy for the request is obtained from [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl), the application creates the request with [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest).</span></span> <span data-ttu-id="2fa86-139">Em seguida, [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) é chamado para definir o proxy para a solicitação especificando o identificador de solicitação no parâmetro *hInternet* .</span><span class="sxs-lookup"><span data-stu-id="2fa86-139">Then [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) is called to set the proxy for the request by specifying the request handle in the *hInternet* parameter.</span></span> <span data-ttu-id="2fa86-140">O parâmetro *dwOption* na chamada a **WinHttpSetOption** deve ser definido como **\_ \_ proxy de opção WinHTTP** e o parâmetro *lpBuffer* é um ponteiro para uma estrutura de [**\_ \_ informações de proxy WinHTTP**](/windows/win32/api/winhttp/ns-winhttp-winhttp_proxy_info) que contém o proxy e o bypass de proxy a serem usados para a solicitação.</span><span class="sxs-lookup"><span data-stu-id="2fa86-140">The *dwOption* parameter in the call to **WinHttpSetOption** should be set to **WINHTTP\_OPTION\_PROXY** and the *lpBuffer* parameter is a pointer to a [**WINHTTP\_PROXY\_INFO**](/windows/win32/api/winhttp/ns-winhttp-winhttp_proxy_info) structure that contains the proxy and proxy bypass to be used for the request.</span></span>

## <a name="automatic-proxy-configuration-is-not-used"></a><span data-ttu-id="2fa86-141">A configuração automática de proxy não é usada</span><span class="sxs-lookup"><span data-stu-id="2fa86-141">Automatic Proxy Configuration Is Not Used</span></span>

<span data-ttu-id="2fa86-142">Se a chamada para [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) indicar que o AutoProxy não é usado, o aplicativo poderá simplesmente criar a solicitação com [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest).</span><span class="sxs-lookup"><span data-stu-id="2fa86-142">If the call to [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) indicates that autoproxy is not used, the application can simply create the request with [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest).</span></span> <span data-ttu-id="2fa86-143">A configuração de proxy é a mesma para toda a sessão e as alterações por solicitação não são necessárias.</span><span class="sxs-lookup"><span data-stu-id="2fa86-143">The proxy configuration is the same for the entire session, and per-request changes are not needed.</span></span>

 

 



