---
description: esta seção discute Windows mensagens e filas de mensagens.
ms.assetid: 21a4d40b-52da-49e4-a374-afc4927e96e8
title: Sobre mensagens e filas de mensagens
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b237b13447abf6a1db2edc698e84755d44b6b3859714ad11af1184c6121ae7be
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/11/2021
ms.locfileid: "118200852"
---
# <a name="about-messages-and-message-queues"></a>Sobre mensagens e filas de mensagens

ao contrário dos aplicativos baseados em ms-dos, os aplicativos baseados em Windows são controlados por evento. Eles não fazem chamadas de função explícitas (como chamadas de biblioteca de tempo de execução C) para obter entrada. Em vez disso, eles esperam que o sistema passe a entrada para eles.

O sistema passa todas as entradas de um aplicativo para as várias janelas no aplicativo. Cada janela tem uma função, chamada de procedimento de janela, que o sistema chama sempre que tem entrada para a janela. O procedimento de janela processa a entrada e retorna o controle para o sistema. Para obter mais informações sobre procedimentos de janela, consulte [procedimentos de janela](window-procedures.md).

Se uma janela de nível superior parar de responder às mensagens por mais de vários segundos, o sistema considerará que a janela não está respondendo. Nesse caso, o sistema oculta a janela e a substitui por uma janela fantasma que tem a mesma ordem Z, local, tamanho e atributos visuais. Isso permite que o usuário o mova, redimensione ou até mesmo feche o aplicativo. No entanto, essas são as únicas ações disponíveis porque o aplicativo não está realmente respondendo. Quando estiver no modo de depurador, o sistema não gerará uma janela fantasma.

Esta seção aborda os seguintes tópicos:

-   [Windows Mensagens](#windows-messages)
-   [Tipos de mensagem](#message-types)
    -   [Mensagens definidas pelo sistema](#system-defined-messages)
    -   [Mensagens definidas pelo aplicativo](#application-defined-messages)
-   [Roteamento de mensagens](#message-routing)
    -   [Mensagens em fila](#queued-messages)
    -   [Mensagens não enfileiradas](#nonqueued-messages)
-   [Manipulação de mensagens](#message-handling)
    -   [Loop de mensagem](#message-loop)
    -   [Procedimento de janela](#window-procedure)
-   [Filtragem de Mensagem](#message-filtering)
-   [Postando e enviando mensagens](#posting-and-sending-messages)
    -   [Postando mensagens](#posting-messages)
    -   [Enviando mensagens](#sending-messages)
-   [Deadlocks de mensagem](#message-deadlocks)
-   [Transmitindo mensagens](#broadcasting-messages)
-   [Mensagens de consulta](#query-messages)

## <a name="windows-messages"></a>Windows Mensagens

O sistema passa a entrada para um procedimento de janela na forma de uma *mensagem*. As mensagens são geradas pelo sistema e pelos aplicativos. O sistema gera uma mensagem em cada evento de entrada — por exemplo, quando o usuário digita, move o mouse ou clica em um controle como uma barra de rolagem. O sistema também gera mensagens em resposta a alterações no sistema trazidas por um aplicativo, como quando um aplicativo altera o pool de recursos de fonte do sistema ou redimensiona uma de suas janelas. Um aplicativo pode gerar mensagens para direcionar suas próprias janelas para executar tarefas ou para se comunicar com o Windows em outros aplicativos.

O sistema envia uma mensagem para um procedimento de janela com um conjunto de quatro parâmetros: um identificador de janela, um identificador de mensagem e dois valores chamados de *parâmetros de mensagem*. O *identificador de janela* identifica a janela para a qual a mensagem é destinada. O sistema o utiliza para determinar qual procedimento de janela deve receber a mensagem.

Um *identificador de mensagem* é uma constante nomeada que identifica a finalidade de uma mensagem. Quando um procedimento de janela recebe uma mensagem, ele usa um identificador de mensagem para determinar como processar a mensagem. Por exemplo, o identificador de mensagem do [**WM \_ Paint**](/windows/desktop/gdi/wm-paint) informa ao procedimento de janela que a área do cliente da janela foi alterada e deve ser redesenhada.

Os parâmetros de mensagem especificam dados ou o local dos dados usados por um procedimento de janela ao processar uma mensagem. O significado e o valor dos parâmetros da mensagem dependem da mensagem. Um parâmetro de mensagem pode conter um inteiro, sinalizadores de bits empacotados, um ponteiro para uma estrutura que contém dados adicionais e assim por diante. Quando uma mensagem não usa parâmetros de mensagem, elas normalmente são definidas como **NULL**. Um procedimento de janela deve verificar o identificador da mensagem para determinar como interpretar os parâmetros da mensagem.

## <a name="message-types"></a>Tipos de mensagem

Esta seção descreve os dois tipos de mensagens:

-   [Mensagens definidas pelo sistema](#system-defined-messages)
-   [Mensagens definidas pelo aplicativo](#application-defined-messages)

### <a name="system-defined-messages"></a>System-Defined mensagens

O sistema envia ou posta uma *mensagem definida pelo sistema* quando se comunica com um aplicativo. Ele usa essas mensagens para controlar as operações de aplicativos e fornecer entradas e outras informações para que os aplicativos sejam processados. Um aplicativo também pode enviar ou postar mensagens definidas pelo sistema. Os aplicativos geralmente usam essas mensagens para controlar a operação de janelas de controle criadas usando classes de janela preregistradas.

Cada mensagem definida pelo sistema tem um identificador de mensagem exclusivo e uma constante simbólica correspondente (definida nos arquivos de cabeçalho Software Development Kit (SDK)) que indica a finalidade da mensagem. Por exemplo, a constante de [**\_ pintura do WM**](/windows/desktop/gdi/wm-paint) solicita que uma janela Pinte seu conteúdo.

As constantes simbólicas especificam a categoria à qual as mensagens definidas pelo sistema pertencem. O prefixo da constante identifica o tipo de janela que pode interpretar e processar a mensagem. A seguir estão os prefixos e suas categorias de mensagens relacionadas.



| Prefixo                               | Categoria da mensagem             | Documentação                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|--------------------------------------|------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **ABM** e **ABN**                  | Barra de ferramentas do aplicativo de desktop  | [Mensagens e notificações do Shell](/windows/desktop/shell/control-panel-applications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **ACM** e **ACN**                  | Controle de animação            | [Mensagens de controle de animação](/windows/desktop/Controls/bumper-animation-control-reference-messages) e [notificações de controle de animação](/windows/desktop/Controls/bumper-animation-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **BCM**, **BCN**, **BM** e **bilhão** | Controle de botão               | [Mensagens de controle](/windows/desktop/Controls/bumper-button-control-reference-messages) de botão e [notificações de controle de botão](/windows/desktop/Controls/bumper-button-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **CB** e **CBN**                   | Controle ComboBox             | [Mensagens de controle](/windows/desktop/Controls/bumper-combobox-control-reference-messages) de ComboBox e [notificações de controle de ComboBox](/windows/desktop/Controls/bumper-combobox-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **CBEM** e **CBEN**                | Controle ComboBoxEx           | [Mensagens ComboBoxEx](/windows/desktop/Controls/bumper-comboboxex-control-reference-messages) e [notificações de ComboBoxEx](/windows/desktop/Controls/bumper-comboboxex-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **CCM**                              | Controle geral              | [Mensagens de controle](/windows/desktop/Controls/bumper-general-control-reference-messages)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **CDM**                              | Caixa de diálogo comum            | [Mensagens comuns da caixa de diálogo](/windows/desktop/dlgbox/common-dialog-box-messages)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **DFM**                              | Menu de contexto padrão         | [Mensagens e notificações do Shell](/windows/desktop/shell/control-panel-applications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **DL**                               | Caixa de listagem de arrastar                | [Arrastar notificações da caixa de listagem](/previous-versions//ff485914(v=vs.85))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **DM**                               | Controle de botão de ação padrão  | [Mensagens da caixa de diálogo](/windows/desktop/dlgbox/dialog-box-messages)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **DTM** e **DTN**                  | Controle de seletor de data e hora | [Mensagens do seletor de data e hora](/windows/desktop/Controls/bumper-date-and-time-picker-control-reference-messages) e [notificações de seletor de data e hora](/windows/desktop/Controls/bumper-date-and-time-picker-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **Em** e **en**                    | Controle de edição                 | [Editar mensagens de controle](/windows/desktop/Controls/bumper-edit-control-reference-messages), [Editar notificações de controle](/windows/desktop/Controls/bumper-edit-control-reference-notifications), mensagens de [edição avançadas](/windows/desktop/Controls/bumper-rich-edit-control-reference-messages)e [notificações de edição avançadas](/windows/desktop/Controls/bumper-rich-edit-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **HDM** e **HDN**                  | Controle de cabeçalho               | [Mensagens de controle de cabeçalho](/windows/desktop/Controls/bumper-header-control-reference-messages) e [notificações de controle de cabeçalho](/windows/desktop/Controls/bumper-header-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **HKM**                              | Controle de teclas de acesso              | [Mensagens de controle de tecla quente](/windows/desktop/Controls/bumper-hot-key-control-reference-messages)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **IPM** e **IPN**                  | Controle de endereço IP           | [Mensagens de endereço IP](/windows/desktop/Controls/bumper-ip-address-control-reference-messages) e [notificações de endereço IP](/windows/desktop/Controls/bumper-ip-address-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **Lb** e **lbn**                   | Controle de caixa de listagem             | [Mensagens da caixa de listagem](/windows/desktop/Controls/bumper-list-box-control-reference-messages) e [notificações da caixa de listagem](/windows/desktop/Controls/bumper-list-box-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **LM**                               | Controle SysLink              | [Mensagens de controle de SysLink](/windows/desktop/Controls/bumper-syslink-control-reference-messages)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **LVM** e **LVN**                  | Controle de exibição de lista            | [Mensagens de exibição de lista](/windows/desktop/Controls/bumper-list-view-control-reference-messages) e [notificações de exibição de lista](/windows/desktop/Controls/bumper-list-view-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **MCM** e **MCN**                  | Controle de calendário mensal       | [Mensagens do calendário mensal](/windows/desktop/Controls/bumper-month-calendar-control-reference-messages) e [notificações de calendário mensal](/windows/desktop/Controls/bumper-month-calendar-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **PBM**                              | Barra de progresso                 | [Mensagens da barra de progresso](/windows/desktop/Controls/bumper-progress-bar-control-reference-messages)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **PGM** e **PGN**                  | Controle de pager                | [Mensagens de controle de pager](/windows/desktop/Controls/bumper-pager-control-reference-messages) e [notificações de controle de pager](/windows/desktop/Controls/bumper-pager-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **PSM** e **PSN**                  | Folha de propriedades               | [Mensagens da folha de propriedades](/windows/desktop/Controls/bumper-property-sheets-reference-messages) e [notificações da folha de propriedades](/windows/desktop/Controls/bumper-property-sheets-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **RB** e **RBN**                   | Controle rebar                | [Mensagens de controle rebar](/windows/desktop/Controls/bumper-rebar-control-reference-messages) e [notificações de controle rebar](/windows/desktop/Controls/bumper-rebar-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **SB** e **SBN**                   | Janela de barra de status            | [Mensagens da barra de status](/windows/desktop/Controls/bumper-status-bars-reference-messages) e [notificações da barra de status](/windows/desktop/Controls/bumper-status-bars-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **SBM**                              | Controle da barra de rolagem           | [Mensagens da barra de rolagem](/windows/desktop/Controls/bumper-scroll-bars-reference-messages)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **SMC**                              | Menu do Shell                   | [Mensagens e notificações do Shell](/windows/desktop/shell/control-panel-applications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **STM** e **STN**                  | Controle estático               | [Mensagens de controle estático](/windows/desktop/Controls/bumper-static-control-reference-messages) e [notificações de controle estático](/windows/desktop/Controls/bumper-static-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **TB** e **tbn**                   | Barra de ferramentas                      | [Mensagens de controle](/windows/desktop/Controls/bumper-toolbar-control-reference-messages) da barra de ferramentas e [notificações de controle Toolbar](/windows/desktop/Controls/bumper-toolbar-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **Tbm** e **TRBN**                 | Controle TrackBar             | [Mensagens de controle de TrackBar](/windows/desktop/Controls/bumper-trackbar-control-reference-messages) e [notificações de controle de TrackBar](/windows/desktop/Controls/bumper-trackbar-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **TCM** e **TCN**                  | Controle guia                  | [Mensagens de controle de guia](/windows/desktop/Controls/bumper-tab-control-reference-messages) e [notificações de controle de guia](/windows/desktop/Controls/bumper-tab-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **TDM** e **TDN**                  | Caixa de diálogo tarefa                  | [Mensagens de diálogo de tarefa](/windows/desktop/Controls/bumper-task-dialogs-reference-messages) e [notificações da caixa de diálogo](/windows/desktop/Controls/bumper-task-dialogs-reference-notifications) de tarefa                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **TTM** e **TTN**                  | Controle ToolTip              | [Mensagens de controle ToolTip](/windows/desktop/Controls/bumper-tooltip-control-reference-messages) e [notificações de controle de dica de ferramenta](/windows/desktop/Controls/bumper-tooltip-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **TVM** e **TVN**                  | Controle de exibição de árvore            | [Mensagens de exibição de árvore](/windows/desktop/Controls/bumper-tree-view-control-reference-messages) e [notificações de exibição de árvore](/windows/desktop/Controls/bumper-tree-view-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **UDM** e **UDN**                  | Controle de cima para baixo              | [Mensagens](/windows/desktop/Controls/bumper-up-down-control-reference-messages) e [notificações de cima](/windows/desktop/Controls/bumper-up-down-control-reference-notifications) para baixo                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **WM**                               | Geral                      | <dl> <dt>[mensagens da área de transferência](/windows/desktop/dataxchg/clipboard-messages)</dt> <dt>[notificações de área](/windows/desktop/dataxchg/clipboard-notifications)</dt> de transferência caixa de <dt>[diálogo comum](/windows/desktop/dlgbox/common-dialog-box-notifications)</dt> notificações de <dt>[Cursor](/windows/desktop/menurc/cursor-notifications)</dt> mensagens de cópia de <dt>[mensagem](/windows/desktop/dataxchg/wm-copydata)</dt> <dt>[Gerenciador de Janelas da Área de Trabalho mensagens](/windows/desktop/dwm/dwm-messages)</dt> caixa de diálogo mensagens de gerenciamento de <dt>[dispositivos](/windows/desktop/DevIO/device-management-messages)</dt> <dt>[notificações](/windows/desktop/dlgbox/dialog-box-notifications)</dt> <dt>[troca dinâmica de dados mensagens](/windows/desktop/dataxchg/dynamic-data-exchange-messages)</dt> <dt>[troca dinâmica de dados notificações](/windows/desktop/dataxchg/dynamic-data-exchange-notifications)</dt> <dt>[Hook notificações](hook-notifications.md)</dt> <dt>[teclado acelerador de mensagens](/windows/desktop/menurc/keyboard-accelerator-messages)</dt> <dt>[notificações](/windows/desktop/Controls/bumper-scroll-bars-reference-notifications)</dt> <dt>[de entrada](/windows/desktop/inputdev/raw-input-notifications)</dt> <dt>[de teclado](/windows/desktop/menurc/keyboard-accelerator-notifications)</dt> <dt>[mensagens de entradas](/windows/desktop/inputdev/keyboard-input-messages)</dt> <dt>[de teclado notificações](/windows/desktop/inputdev/keyboard-input-notifications)</dt> de entrada de <dt>[tela notificações de](/windows/desktop/menurc/menu-notifications)</dt> <dt>[Timer](timer-notifications.md)</dt> <dt>[de entrada de](/windows/desktop/inputdev/mouse-input-notifications)</dt> <dt>[mensagens](window-messages.md)</dt> <dt>[](window-notifications.md)</dt> de <dt>[Interface](multiple-document-interface-messages.md)</dt> </dl> |



 

as mensagens de janela geral abrangem uma ampla gama de informações e solicitações, incluindo mensagens de entrada de mouse e teclado, entrada de menu e caixa de diálogo, criação e gerenciamento de janelas e troca dinâmica de dados (DDE).

### <a name="application-defined-messages"></a>Application-Defined mensagens

Um aplicativo pode criar mensagens a serem usadas por seu próprio Windows ou para se comunicar com o Windows em outros processos. Se um aplicativo cria suas próprias mensagens, o procedimento de janela que as recebe deve interpretar as mensagens e fornecer o processamento apropriado.

Os valores de identificador de mensagem são usados da seguinte maneira:

-   O sistema reserva valores de identificador de mensagem no intervalo de 0x0000 por meio de 0x03FF (o valor do [**\_ usuário do WM**](wm-user.md)  – 1) para mensagens definidas pelo sistema. Os aplicativos não podem usar esses valores para mensagens privadas.
-   Os valores no intervalo 0x0400 (o valor do [**\_ usuário do WM**](wm-user.md)) por meio de 0x7FFF estão disponíveis para identificadores de mensagem para classes de janela privada.
-   Se seu aplicativo estiver marcado como versão 4,0, você poderá usar valores de identificador de mensagem no intervalo 0x8000 [**( \_ aplicativo do WM**](wm-app.md)) por meio de 0xBFFF para mensagens privadas.
-   O sistema retorna um identificador de mensagem no intervalo de 0xC000 a 0xFFFF quando um aplicativo chama a função [**RegisterWindowMessage**](/windows/win32/api/winuser/nf-winuser-registerwindowmessagea) para registrar uma mensagem. O identificador de mensagem retornado por essa função tem a garantia de ser exclusivo em todo o sistema. O uso dessa função evita conflitos que podem surgir se outros aplicativos usarem o mesmo identificador de mensagem para finalidades diferentes.

## <a name="message-routing"></a>Roteamento de mensagem

O sistema usa dois métodos para rotear mensagens para um procedimento de janela: postar mensagens em uma fila de primeiro a entrar, primeiro a sair chamada de *fila de mensagens*, um objeto de memória definido pelo sistema que armazena temporariamente mensagens e enviando mensagens diretamente a um procedimento de janela.

As mensagens que são postadas em uma fila de mensagens são chamadas de *mensagem em fila*. Esses são principalmente o resultado da entrada do usuário inserida por meio do mouse ou do teclado, como o [**WM \_ MOUSEMOVE**](/windows/desktop/inputdev/wm-mousemove), o [**WM \_ LBUTTONDOWN**](/windows/desktop/inputdev/wm-lbuttondown), o [**WM \_ KEYDOWN**](/windows/desktop/inputdev/wm-keydown)e as mensagens do [**WM \_ Char**](/windows/desktop/inputdev/wm-char) . Outras mensagens em fila incluem as mensagens timer, Paint e sair: o [**\_ temporizador do WM**](wm-timer.md), o [**WM \_ Paint**](/windows/desktop/gdi/wm-paint)e o [**WM \_ Quit**](wm-quit.md). A maioria das outras mensagens, que são enviadas diretamente a um procedimento de janela, são chamadas de *mensagens não enfileiradas*.

-   [Mensagens em fila](#queued-messages)
-   [Mensagens não enfileiradas](#nonqueued-messages)

### <a name="queued-messages"></a>Mensagens em fila

O sistema pode exibir qualquer número de janelas de cada vez. Para rotear a entrada do mouse e do teclado para a janela apropriada, o sistema usa filas de mensagens.

O sistema mantém uma única fila de mensagens do sistema e uma fila de mensagens específica do thread para cada thread de GUI. Para evitar a sobrecarga de criar uma fila de mensagens para threads não-GUI, todos os threads são criados inicialmente sem uma fila de mensagens. O sistema cria uma fila de mensagens específica do thread somente quando o thread faz sua primeira chamada para uma das funções de usuário específicas; nenhuma chamada de função de GUI resulta na criação de uma fila de mensagens.

Sempre que o usuário move o mouse, clica nos botões do mouse ou tipos no teclado, o driver do dispositivo para o mouse ou o teclado converte a entrada em mensagens e os coloca na fila de mensagens do sistema. O sistema remove as mensagens, uma de cada vez, da fila de mensagens do sistema, examina-as para determinar a janela de destino e, em seguida, as publica na fila de mensagens do thread que criou a janela de destino. A fila de mensagens de um thread recebe todas as mensagens do mouse e do teclado para as janelas criadas pelo thread. O thread remove mensagens de sua fila e direciona o sistema para enviá-las para o procedimento de janela apropriado para processamento.

Com exceção da mensagem [**WM \_ PAINT,**](/windows/desktop/gdi/wm-paint) da mensagem [**TIMER \_ WM**](wm-timer.md) e da mensagem [**WM \_ QUIT,**](wm-quit.md) o sistema sempre posta mensagens no final de uma fila de mensagens. Isso garante que uma janela receba suas mensagens de entrada na sequência FIFO (primeiro a entrar, primeiro a sair) adequada. No entanto, a mensagem **WM \_ PAINT,** a mensagem **WM \_ TIMER** e a mensagem **WM \_ QUIT** são mantidas na fila e encaminhadas para o procedimento de janela somente quando a fila não contém nenhuma outra mensagem. Além disso, várias **mensagens WM \_ PAINT** para a mesma janela são combinadas em uma única mensagem **WM \_ PAINT,** consolidando todas as partes inválidas da área do cliente em uma única área. Combinar mensagens **WM \_ PAINT** reduz o número de vezes que uma janela deve redesenhar o conteúdo de sua área de cliente.

O sistema posta uma mensagem na fila de mensagens de um thread preenchendo uma [**estrutura MSG**](/windows/win32/api/winuser/ns-winuser-msg) e copiando-a para a fila de mensagens. As informações no **MSG** incluem: o identificador da janela para a qual a mensagem se destina, o identificador da mensagem, os dois parâmetros de mensagem, a hora em que a mensagem foi postada e a posição do cursor do mouse. Um thread pode postar uma mensagem em sua própria fila de mensagens ou na fila de outro thread usando a [**função PostMessage**](/windows/win32/api/winuser/nf-winuser-postmessagea) ou [**PostThreadMessage.**](/windows/win32/api/winuser/nf-winuser-postthreadmessagea)

Um aplicativo pode remover uma mensagem de sua fila usando a [**função GetMessage.**](/windows/win32/api/winuser/nf-winuser-getmessage) Para examinar uma mensagem sem removê-la da fila, um aplicativo pode usar a [**função PeekMessage.**](/windows/win32/api/winuser/nf-winuser-peekmessagea) Essa função preenche o [**MSG**](/windows/win32/api/winuser/ns-winuser-msg) com informações sobre a mensagem.

Depois de remover uma mensagem de sua fila, um aplicativo pode usar a [**função DispatchMessage**](/windows/win32/api/winuser/nf-winuser-dispatchmessage) para direcionar o sistema a enviar a mensagem para um procedimento de janela para processamento. **DispatchMessage** leva um ponteiro para [**o MSG**](/windows/win32/api/winuser/ns-winuser-msg) que foi preenchido por uma chamada anterior para a [**função GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) ou [**PeekMessage.**](/windows/win32/api/winuser/nf-winuser-peekmessagea) **DispatchMessage** passa o identificador de janela, o identificador de mensagem e os dois parâmetros de mensagem para o procedimento de janela, mas não passa o tempo em que a mensagem foi postada ou a posição do cursor do mouse. Um aplicativo pode recuperar essas informações chamando as funções [**GetMessageTime**](/windows/win32/api/winuser/nf-winuser-getmessagetime) e [**GetMessagePos**](/windows/win32/api/winuser/nf-winuser-getmessagepos) ao processar uma mensagem.

Um thread pode usar a [**função WaitMessage**](/windows/win32/api/winuser/nf-winuser-waitmessage) para gerar controle para outros threads quando ele não tem mensagens em sua fila de mensagens. A função suspende o thread e não retorna até que uma nova mensagem seja colocada na fila de mensagens do thread.

Você pode chamar a [**função SetMessageExtraInfo**](/windows/win32/api/winuser/nf-winuser-setmessageextrainfo) para associar um valor à fila de mensagens do thread atual. Em seguida, chame a [**função GetMessageExtraInfo**](/windows/win32/api/winuser/nf-winuser-getmessageextrainfo) para obter o valor associado à última mensagem recuperada pela [**função GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) ou [**PeekMessage.**](/windows/win32/api/winuser/nf-winuser-peekmessagea)

### <a name="nonqueued-messages"></a>Mensagens não em sequência

Mensagens não enfiladas são enviadas imediatamente para o procedimento de janela de destino, ignorando a fila de mensagens do sistema e a fila de mensagens de thread. O sistema normalmente envia mensagens não sequenciadas para notificar uma janela de eventos que a afetam. Por exemplo, quando o usuário ativa uma nova janela de aplicativo, o sistema envia à janela uma série de mensagens, incluindo [**WM \_ ACTIVATE,**](/windows/desktop/inputdev/wm-activate) [**WM \_ SETFOCUS**](/windows/desktop/inputdev/wm-setfocus)e [**WM \_ SETCURSOR**](/windows/desktop/menurc/wm-setcursor). Essas mensagens notificam a janela de que ela foi ativada, que a entrada do teclado está sendo direcionada para a janela e que o cursor do mouse foi movido dentro das bordas da janela. Mensagens não na sequência também podem resultar quando um aplicativo chama determinadas funções do sistema. Por exemplo, o sistema envia a [**mensagem WM \_ WINDOWPOSCHANGED**](wm-windowposchanged.md) depois que um aplicativo usa a [**função SetWindowPos**](/windows/win32/api/winuser/nf-winuser-setwindowpos) para mover uma janela.

Algumas funções que enviam mensagens não sequenciadas são [**BroadcastSystemMessage**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessage), [**BroadcastSystemMessageEx,**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessageexa) [**SendMessage,**](/windows/win32/api/winuser/nf-winuser-sendmessage) [**SendMessageTimeout**](/windows/win32/api/winuser/nf-winuser-sendmessagetimeouta)e [**SendNotifyMessage**](/windows/win32/api/winuser/nf-winuser-sendnotifymessagea).

## <a name="message-handling"></a>Tratamento de mensagens

Um aplicativo deve remover e processar mensagens postadas nas filas de mensagens de seus threads. Um aplicativo de thread único geralmente usa um *loop* de mensagem em sua [**função WinMain**](/windows/win32/api/winbase/nf-winbase-winmain) para remover e enviar mensagens para os procedimentos de janela apropriados para processamento. Aplicativos com vários threads podem incluir um loop de mensagem em cada thread que cria uma janela. As seções a seguir descrevem como um loop de mensagem funciona e explicam a função de um procedimento de janela:

-   [Loop de mensagem](#message-loop)
-   [Procedimento de janela](#window-procedure)

### <a name="message-loop"></a>Loop de mensagem

Um loop de mensagem simples consiste em uma chamada de função para cada uma dessas três funções: [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage), [**TranslateMessage**](/windows/win32/api/winuser/nf-winuser-translatemessage)e [**DispatchMessage**](/windows/win32/api/winuser/nf-winuser-dispatchmessage). Observe que, se houver um erro, **GetMessage** retornará -1, portanto, a necessidade do teste especial.


```
MSG msg;
BOOL bRet;

while( (bRet = GetMessage( &msg, NULL, 0, 0 )) != 0)
{ 
    if (bRet == -1)
    {
        // handle the error and possibly exit
    }
    else
    {
        TranslateMessage(&msg); 
        DispatchMessage(&msg); 
    }
}
```



A [**função GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) recupera uma mensagem da fila e a copia para uma estrutura do tipo [**MSG**](/windows/win32/api/winuser/ns-winuser-msg). Ele retorna um valor que não é zero, a menos que ele encontra a mensagem [**WM \_ QUIT;**](wm-quit.md) nesse caso, ela retorna **FALSE** e encerra o loop. Em um aplicativo de thread único, encerrar o loop de mensagem geralmente é a primeira etapa para fechar o aplicativo. Um aplicativo pode encerrar seu próprio loop usando a [**função PostQuitMessage,**](/windows/win32/api/winuser/nf-winuser-postquitmessage) normalmente em resposta à mensagem [**WM \_ DESTROY**](wm-destroy.md) no procedimento de janela da janela principal do aplicativo.

Se você especificar um alça de janela como o segundo parâmetro [**de GetMessage,**](/windows/win32/api/winuser/nf-winuser-getmessage)somente as mensagens da janela especificada serão recuperadas da fila. **GetMessage** também pode filtrar mensagens na fila, recuperando apenas as mensagens que estão dentro de um intervalo especificado. Para obter mais informações sobre como filtrar mensagens, consulte [Filtragem de mensagens](#message-filtering).

O loop de mensagem de um thread deve incluir [**TranslateMessage**](/windows/win32/api/winuser/nf-winuser-translatemessage) se o thread deve receber entrada de caractere do teclado. O sistema gera mensagens de chave virtual ([**WM \_ KEYDOWN**](/windows/desktop/inputdev/wm-keydown) e [**WM \_ KEYUP**](/windows/desktop/inputdev/wm-keyup)) sempre que o usuário pressiona uma tecla. Uma mensagem de chave virtual contém um código de chave virtual que identifica qual chave foi pressionada, mas não seu valor de caractere. Para recuperar esse valor, o loop de mensagem deve conter **TranslateMessage**, que converte a mensagem de chave virtual em uma mensagem de caractere ([**WM \_ CHAR**](/windows/desktop/inputdev/wm-char)) e a coloca de volta na fila de mensagens do aplicativo. A mensagem de caractere pode ser removida após uma iteração subsequente do loop de mensagem e enviada para um procedimento de janela.

A [**função DispatchMessage**](/windows/win32/api/winuser/nf-winuser-dispatchmessage) envia uma mensagem para o procedimento de janela associado ao alça de janela especificado na [**estrutura do MSG.**](/windows/win32/api/winuser/ns-winuser-msg) Se o alça de janela for **HWND \_ TOPMOST,** **o DispatchMessage** enviará a mensagem para os procedimentos de janela de todas as janelas de nível superior no sistema. Se o alça de janela for **NULL,** **DispatchMessage** não faz nada com a mensagem.

O thread principal de um aplicativo inicia o loop de mensagem depois de inicializar o aplicativo e criar pelo menos uma janela. Depois que ele é iniciado, o loop de mensagem continua a recuperar mensagens da fila de mensagens do thread e expedi-las para as janelas apropriadas. O loop de mensagem termina quando a [**função GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) remove a [**mensagem WM \_ QUIT**](wm-quit.md) da fila de mensagens.

Apenas um loop de mensagem é necessário para uma fila de mensagens, mesmo que um aplicativo contenha muitas janelas. [**DispatchMessage**](/windows/win32/api/winuser/nf-winuser-dispatchmessage) sempre envia a mensagem para a janela adequada; isso porque cada mensagem na fila é uma estrutura [**MSG**](/windows/win32/api/winuser/ns-winuser-msg) que contém o handle da janela à qual a mensagem pertence.

Você pode modificar um loop de mensagem de várias maneiras. Por exemplo, você pode recuperar mensagens da fila sem desacioná-las para uma janela. Isso é útil para aplicativos que postam mensagens que não especificam uma janela. Você também pode direcionar [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) para pesquisar mensagens específicas, deixando outras mensagens na fila. Isso será útil se você tiver que ignorar temporariamente a ordem FIFO normal da fila de mensagens.

Um aplicativo que usa teclas de acelerador deve ser capaz de converter mensagens de teclado em mensagens de comando. Para fazer isso, o loop de mensagem do aplicativo deve incluir uma chamada para a [**função TranslateAccelerator.**](/windows/desktop/api/winuser/nf-winuser-translateacceleratora) Para obter mais informações sobre teclas de acelerador, consulte [Aceleradores de teclado](/windows/desktop/menurc/keyboard-accelerators).

Se um thread usar uma caixa de diálogo sem modo, o loop de mensagem deverá incluir a função [**IsDialogMessage**](/windows/desktop/api/winuser/nf-winuser-isdialogmessagea) para que a caixa de diálogo possa receber a entrada do teclado.

### <a name="window-procedure"></a>Procedimento de janela

Um procedimento de janela é uma função que recebe e processa todas as mensagens enviadas à janela. Cada classe de janela tem um procedimento de janela e cada janela criada com essa classe usa esse mesmo procedimento de janela para responder às mensagens.

O sistema envia uma mensagem para um procedimento de janela passando os dados da mensagem como argumentos para o procedimento. Em seguida, o procedimento de janela executa uma ação apropriada para a mensagem; ele verifica o identificador da mensagem e, durante o processamento da mensagem, usa as informações especificadas pelos parâmetros da mensagem.

Um procedimento de janela geralmente não ignora uma mensagem. Se ele não processar uma mensagem, deverá enviar a mensagem de volta para o sistema para processamento padrão. O procedimento de janela faz isso chamando a [**função DefWindowProc,**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) que executa uma ação padrão e retorna um resultado da mensagem. O procedimento de janela deve retornar esse valor como seu próprio resultado de mensagem. A maioria dos procedimentos de janela processa apenas algumas mensagens e passa as outras para o sistema chamando **DefWindowProc**.

Como um procedimento de janela é compartilhado por todas as janelas que pertencem à mesma classe, ele pode processar mensagens para várias janelas diferentes. Para identificar a janela específica afetada pela mensagem, um procedimento de janela pode examinar o identificador de janela passado com uma mensagem. Para obter mais informações sobre procedimentos de janela, consulte [Procedimentos de janela.](window-procedures.md)

## <a name="message-filtering"></a>Filtragem de Mensagem

Um aplicativo pode escolher mensagens específicas para recuperar da fila de mensagens (ignorando outras mensagens) usando a função [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) ou [**PeekMessage**](/windows/win32/api/winuser/nf-winuser-peekmessagea) para especificar um filtro de mensagem. O filtro é um intervalo de identificadores de mensagem (especificado por um primeiro e último identificador), um identificador de janela ou ambos. **GetMessage** e **PeekMessage** usam um filtro de mensagem para selecionar quais mensagens recuperar da fila. A filtragem de mensagens será útil se um aplicativo deve pesquisar na fila de mensagens mensagens que chegaram posteriormente na fila. Também será útil se um aplicativo deve processar mensagens de entrada (hardware) antes de processar mensagens postadas.

As **constantes WM \_ KEYFIRST** e **WM \_ KEYLAST** podem ser usadas como valores de filtro para recuperar todas as mensagens de teclado; as constantes **WM \_ MOUSEFIRST** e **WM \_ MOUSELAST** podem ser usadas para recuperar todas as mensagens do mouse.

Qualquer aplicativo que filtra as mensagens deve garantir que uma mensagem que satisfaza o filtro de mensagem possa ser postada. Por exemplo, se um aplicativo filtrar uma mensagem [**WM \_ CHAR**](/windows/desktop/inputdev/wm-char) em uma janela que não recebe a entrada do teclado, a [**função GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) não retornará. Isso efetivamente "trava" o aplicativo.

## <a name="posting-and-sending-messages"></a>Postagem e envio de mensagens

Qualquer aplicativo pode postar e enviar mensagens. Assim como o sistema, um aplicativo posta uma mensagem copiando-a para uma fila de mensagens e envia uma mensagem passando os dados da mensagem como argumentos para um procedimento de janela. Para postar mensagens, um aplicativo usa a [**função PostMessage.**](/windows/win32/api/winuser/nf-winuser-postmessagea) Um aplicativo pode enviar uma mensagem chamando a função [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage), [**BroadcastSystemMessage**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessage), [**SendMessageCallback**](/windows/win32/api/winuser/nf-winuser-sendmessagecallbacka), [**SendMessageTimeout**](/windows/win32/api/winuser/nf-winuser-sendmessagetimeouta), [**SendNotifyMessage**](/windows/win32/api/winuser/nf-winuser-sendnotifymessagea)ou [**SendDlgItemMessage.**](/windows/desktop/api/winuser/nf-winuser-senddlgitemmessagea)

### <a name="posting-messages"></a>Postagem de mensagens

Um aplicativo normalmente posta uma mensagem para notificar uma janela específica para executar uma tarefa. [**O PostMessage**](/windows/win32/api/winuser/nf-winuser-postmessagea) cria uma [**estrutura MSG**](/windows/win32/api/winuser/ns-winuser-msg) para a mensagem e copia a mensagem para a fila de mensagens. O loop de mensagem do aplicativo eventualmente recupera a mensagem e a envia para o procedimento de janela apropriado.

Um aplicativo pode postar uma mensagem sem especificar uma janela. Se o aplicativo fornece um **alça de** janela NULL ao chamar [**PostMessage**](/windows/win32/api/winuser/nf-winuser-postmessagea), a mensagem é postada na fila associada ao thread atual. Como nenhum alça de janela é especificado, o aplicativo deve processar a mensagem no loop de mensagem. Essa é uma maneira de criar uma mensagem que se aplica a todo o aplicativo, em vez de a uma janela específica.

Ocasionalmente, talvez você queira postar uma mensagem em todas as janelas de nível superior no sistema. Um aplicativo pode postar uma mensagem em todas as janelas de nível superior chamando [**PostMessage**](/windows/win32/api/winuser/nf-winuser-postmessagea) e especificando **HWND \_ TOPMOST** no *parâmetro hwnd.*

Um erro de programação comum é assumir que a [**função PostMessage**](/windows/win32/api/winuser/nf-winuser-postmessagea) sempre posta uma mensagem. Isso não é verdadeiro quando a fila de mensagens está cheia. Um aplicativo deve verificar o valor de retorno da **função PostMessage** para determinar se a mensagem foi postada e, se não tiver sido, poste-a.

### <a name="sending-messages"></a>enviando mensagens

Um aplicativo normalmente envia uma mensagem para notificar um procedimento de janela para executar uma tarefa imediatamente. A [**função SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage) envia a mensagem para o procedimento de janela correspondente à janela determinada. A função aguarda até que o procedimento de janela conclua o processamento e, em seguida, retorna o resultado da mensagem. As janelas pai e filho geralmente se comunicam enviando mensagens entre si. Por exemplo, uma janela pai que tem um controle de edição como sua janela filho pode definir o texto do controle enviando uma mensagem para ela. O controle pode notificar a janela pai das alterações no texto que são executadas pelo usuário enviando mensagens de volta para o pai.

A [**função SendMessageCallback**](/windows/win32/api/winuser/nf-winuser-sendmessagecallbacka) também envia uma mensagem para o procedimento de janela correspondente à janela determinada. No entanto, essa função retorna imediatamente. Depois que o procedimento de janela processa a mensagem, o sistema chama a função de retorno de chamada especificada. Para obter mais informações sobre a função de retorno de chamada, consulte [**a função SendAsyncProc.**](/windows/win32/api/winuser/nc-winuser-sendasyncproc)

Ocasionalmente, talvez você queira enviar uma mensagem para todas as janelas de nível superior no sistema. Por exemplo, se o aplicativo alterar a hora do sistema, ele deverá notificar todas as janelas de nível superior sobre a alteração enviando uma mensagem [**WM \_ TIMECHANGE.**](../sysinfo/wm-timechange.md) Um aplicativo pode enviar uma mensagem para todas as janelas de nível superior chamando [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage) e especificando **HWND \_ TOPMOST** no *parâmetro hwnd.* Você também pode transmitir uma mensagem para todos os aplicativos chamando a função [**BroadcastSystemMessage**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessage) e especificando **APLICATIVOS BSM \_** no *parâmetro lpdwRecipients.*

Usando a [**função InSendMessage**](/windows/win32/api/winuser/nf-winuser-insendmessage) ou [**InSendMessageEx,**](/windows/win32/api/winuser/nf-winuser-insendmessageex) um procedimento de janela pode determinar se está processando uma mensagem enviada por outro thread. Essa funcionalidade é útil quando o processamento de mensagens depende da origem da mensagem.

## <a name="message-deadlocks"></a>Deadlocks de mensagem

Um thread que chama a [**função SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage) para enviar uma mensagem para outro thread não pode continuar em execução até que o procedimento de janela que recebe a mensagem retorne. Se o thread de recebimento gerar controle durante o processamento da mensagem, o thread de envio não poderá continuar em execução, pois ele está aguardando **o retorno de SendMessage.** Se o thread de recebimento estiver anexado à mesma fila que o remetente, isso poderá causar um deadlock do aplicativo. (Observe que os ganchos de diário anexam threads à mesma fila.)

Observe que o thread de recebimento não precisa gerar controle explicitamente; chamar qualquer uma das funções a seguir pode fazer com que um thread produza controle implicitamente.

-   [**Dialogbox**](/windows/desktop/api/winuser/nf-winuser-dialogboxa)
-   [**Dialogboxindirect**](/windows/desktop/api/winuser/nf-winuser-dialogboxindirecta)
-   [**Dialogboxindirectparam**](/windows/desktop/api/winuser/nf-winuser-dialogboxindirectparama)
-   [**Dialogboxparam**](/windows/desktop/api/winuser/nf-winuser-dialogboxparama)
-   [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage)
-   [**Messagebox**](/windows/desktop/api/winuser/nf-winuser-messagebox)
-   [**PeekMessage**](/windows/win32/api/winuser/nf-winuser-peekmessagea)
-   [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage)

Para evitar possíveis deadlocks em seu aplicativo, considere usar as funções [**SendNotifyMessage**](/windows/win32/api/winuser/nf-winuser-sendnotifymessagea) ou [**SendMessageTimeout.**](/windows/win32/api/winuser/nf-winuser-sendmessagetimeouta) Caso contrário, um procedimento de janela poderá determinar se uma mensagem recebida foi enviada por outro thread chamando a [**função InSendMessage**](/windows/win32/api/winuser/nf-winuser-insendmessage) ou [**InSendMessageEx.**](/windows/win32/api/winuser/nf-winuser-insendmessageex) Antes de chamar qualquer uma das funções na lista anterior durante o processamento de uma mensagem, o procedimento de janela deve primeiro chamar **InSendMessage** ou **InSendMessageEx**. Se essa função retornar **TRUE,** o procedimento de janela deverá chamar a [**função ReplyMessage**](/windows/win32/api/winuser/nf-winuser-replymessage) antes de qualquer função que faz com que o thread produza controle.

## <a name="broadcasting-messages"></a>Difusão de mensagens

Cada mensagem consiste em um identificador de mensagem e dois parâmetros, *wParam* e *lParam.* O identificador de mensagem é um valor exclusivo que especifica a finalidade da mensagem. Os parâmetros fornecem informações adicionais específicas da mensagem, mas o *parâmetro wParam* geralmente é um valor de tipo que fornece mais informações sobre a mensagem.

Uma *difusão de* mensagem é simplesmente o envio de uma mensagem para vários destinatários no sistema. Para transmitir uma mensagem de um aplicativo, use a [**função BroadcastSystemMessage,**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessage) especificando os destinatários da mensagem. Em vez de especificar destinatários individuais, você deve especificar um ou mais tipos de destinatários. Esses tipos são aplicativos, drivers instanciáveis, drivers de rede e drivers de dispositivo no nível do sistema. O sistema envia mensagens de difusão para todos os membros de cada tipo especificado.

O sistema normalmente transmite mensagens em resposta a alterações que ocorrem em drivers de dispositivo no nível do sistema ou componentes relacionados. O driver ou componente relacionado transmite a mensagem para aplicativos e outros componentes para notificá-los sobre a alteração. Por exemplo, o componente responsável pelas unidades de disco transmite uma mensagem sempre que o driver de dispositivo para a unidade de disquete detecta uma alteração de mídia, como quando o usuário insere um disco na unidade.

O sistema transmite mensagens aos destinatários nesta ordem: drivers de dispositivo no nível do sistema, drivers de rede, drivers instaláveis e aplicativos. Isso significa que os drivers de dispositivo no nível do sistema, se escolhidos como destinatários, sempre obterão a primeira oportunidade de responder a uma mensagem. Dentro de um determinado tipo de destinatário, nenhum driver tem a garantia de receber uma determinada mensagem antes de qualquer outro driver. Isso significa que uma mensagem destinada a um driver específico deve ter um identificador de mensagem globalmente exclusivo para que nenhum outro driver o processe incorretamente.

Você também pode transmitir mensagens para todas as janelas de nível superior especificando **HWND \_ BROADCAST** na função [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage), [**SendMessageCallback,**](/windows/win32/api/winuser/nf-winuser-sendmessagecallbacka) [**SendMessageTimeout**](/windows/win32/api/winuser/nf-winuser-sendmessagetimeouta)ou [**SendNotifyMessage.**](/windows/win32/api/winuser/nf-winuser-sendnotifymessagea)

Os aplicativos recebem mensagens por meio do procedimento de janela de suas janelas de nível superior. As mensagens não são enviadas para janelas filho. Os serviços podem receber mensagens por meio de um procedimento de janela ou seus manipuladores de controle de serviço.

> [!Note]  
> Os drivers de dispositivo no nível do sistema usam uma função relacionada no nível do sistema para transmitir mensagens do sistema.

 

## <a name="query-messages"></a>Mensagens de consulta

Você pode criar suas próprias mensagens personalizadas e usá-las para coordenar atividades entre seus aplicativos e outros componentes no sistema. Isso será especialmente útil se você tiver criado seus próprios drivers instalados ou drivers de dispositivo no nível do sistema. Suas mensagens personalizadas podem carregar informações de e para o driver e os aplicativos que usam o driver.

Para sondar destinatários em busca de permissão para executar uma determinada ação, use uma *mensagem de consulta*. Você pode gerar suas próprias mensagens de consulta definindo o valor **\_ de CONSULTA BSF** no parâmetro *dwFlags* ao chamar [**BroadcastSystemMessage**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessage). Cada destinatário da mensagem de consulta deve retornar **TRUE** para que a função envie a mensagem para o próximo destinatário. Se qualquer destinatário retornar **BROADCAST \_ QUERY \_ DENY**, a difusão terminará imediatamente e a função retornará um zero.

 

 
