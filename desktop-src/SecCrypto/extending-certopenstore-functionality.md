---
description: O repositório de certificados é fundamental para todas as operações de gerenciamento de certificados.
ms.assetid: e5c7c882-cbfc-4343-952c-b13c67326756
title: Estendendo a funcionalidade CertOpenStore
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4cce198578cc482ba0488bd97ae0f1d7f923511b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "104553116"
---
# <a name="extending-certopenstore-functionality"></a><span data-ttu-id="687fa-103">Estendendo a funcionalidade CertOpenStore</span><span class="sxs-lookup"><span data-stu-id="687fa-103">Extending CertOpenStore Functionality</span></span>

<span data-ttu-id="687fa-104">O [*repositório de certificados*](../secgloss/c-gly.md) é fundamental para todas as operações de gerenciamento de certificados.</span><span class="sxs-lookup"><span data-stu-id="687fa-104">The [*certificate store*](../secgloss/c-gly.md) is central to all certificate management operations.</span></span> <span data-ttu-id="687fa-105">A funcionalidade da função [**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) pode ser estendida por meio do uso de uma função de provedor de repositório de certificados instalável (ou registrada).</span><span class="sxs-lookup"><span data-stu-id="687fa-105">The functionality of the [**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) function can be extended through the use of an installable (or registered) certificate-store-provider function.</span></span> <span data-ttu-id="687fa-106">Para obter uma visão geral de como instalar ou registrar funções para usar com o CryptoAPI, consulte [visão geral de OID](oid-overview.md).</span><span class="sxs-lookup"><span data-stu-id="687fa-106">For an overview of how to install or register functions for use with the CryptoAPI, see [OID Overview](oid-overview.md).</span></span>

> [!Note]  
> <span data-ttu-id="687fa-107">Os repositórios de certificados personalizados não são migrados automaticamente ao executar implantações automatizadas.</span><span class="sxs-lookup"><span data-stu-id="687fa-107">Custom certificate stores are not automatically migrated when performing automated deployments.</span></span> <span data-ttu-id="687fa-108">Para migrar repositórios de certificados personalizados, você deve criar um manifesto para migrar os repositórios personalizados e usar o Ferramenta de Migração do Usuário Windows (USMT).</span><span class="sxs-lookup"><span data-stu-id="687fa-108">To migrate custom certificate stores, you must create a manifest for migrating the custom stores and use the Windows User State Migration Tool (USMT).</span></span> <span data-ttu-id="687fa-109">A USMT está disponível para download no centro de download da Microsoft em <https://www.microsoft.com/download/details.aspx?id=10837> .</span><span class="sxs-lookup"><span data-stu-id="687fa-109">The USMT is available for download from the Microsoft Download Center at <https://www.microsoft.com/download/details.aspx?id=10837>.</span></span>

 

<span data-ttu-id="687fa-110">[**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) abre um armazenamento vazio na memória e chama a função do provedor de repositório (se estiver registrado ou instalado) usando o OID ( [*identificador de objeto*](../secgloss/o-gly.md) ) que foi passado no parâmetro *lpszStoreProvider* .</span><span class="sxs-lookup"><span data-stu-id="687fa-110">[**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) opens an empty store in memory and calls the store provider function (if it is registered or installed) by using the [*object identifier*](../secgloss/o-gly.md) (OID) that was passed in the *lpszStoreProvider* parameter.</span></span> <span data-ttu-id="687fa-111">Para obter uma lista dos tipos de provedor predefinidos que são fornecidos com o CryptoAPI, consulte **CertOpenStore**.</span><span class="sxs-lookup"><span data-stu-id="687fa-111">For a list of the predefined provider types that are supplied with the CryptoAPI, see **CertOpenStore**.</span></span>

<span data-ttu-id="687fa-112">A função de provedor Store copia seus certificados e listas de certificados [*revogados*](../secgloss/c-gly.md) (CRLs) para o repositório na memória especificado pelo identificador *HCERTSTORE* passado para ele.</span><span class="sxs-lookup"><span data-stu-id="687fa-112">The store provider function copies its certificates and [*certificate revocation lists*](../secgloss/c-gly.md) (CRLs) to the in-memory store specified by the *hCertStore* handle passed to it.</span></span> <span data-ttu-id="687fa-113">A nova função de provedor de armazenamento pode usar qualquer uma das funções de repositório de certificados CryptoAPI, como [**CertAddCertificateContextToStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certaddcertificatecontexttostore) ou [**CertAddSerializedElementToStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certaddserializedelementtostore), para adicionar seus certificados e CRLs ao armazenamento na memória.</span><span class="sxs-lookup"><span data-stu-id="687fa-113">The new store provider function can use any of the CryptoAPI certificate store functions, such as, [**CertAddCertificateContextToStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certaddcertificatecontexttostore) or [**CertAddSerializedElementToStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certaddserializedelementtostore), to add its certificates and CRLs to the in-memory store.</span></span> <span data-ttu-id="687fa-114">Além disso, a função Store-Provider, opcionalmente, retorna valores para todos os membros de dados da estrutura de [**\_ \_ \_ informações Prov do repositório de certificados**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) .</span><span class="sxs-lookup"><span data-stu-id="687fa-114">In addition, the store-provider function optionally returns values for all of the data members of the [**CERT\_STORE\_PROV\_INFO**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) structure.</span></span> <span data-ttu-id="687fa-115">A função só precisa atualizar essa estrutura se ela oferecer suporte a funções de retorno de chamada adicionais.</span><span class="sxs-lookup"><span data-stu-id="687fa-115">The function only needs to update this structure if it supports additional callback functions.</span></span> <span data-ttu-id="687fa-116">Por exemplo, se o repositório fosse um repositório somente leitura, o suporte de outras funções de retorno de chamada provavelmente não seria necessário.</span><span class="sxs-lookup"><span data-stu-id="687fa-116">For example, if the store was to be a read-only store, the support of other callback functions probably would not be needed.</span></span> <span data-ttu-id="687fa-117">Para obter detalhes e protótipos das funções de retorno de chamada possíveis, consulte [funções de retorno de chamada do provedor de repositório de certificados](cryptography-functions.md).</span><span class="sxs-lookup"><span data-stu-id="687fa-117">For details and prototypes of the possible callback functions, see [Certificate Store Provider Callback Functions](cryptography-functions.md).</span></span>

<span data-ttu-id="687fa-118">O repositório TrustedPeople por usuário é restrito a repositórios físicos predefinidos.</span><span class="sxs-lookup"><span data-stu-id="687fa-118">The per user TrustedPeople store is restricted to predefined physical stores.</span></span> <span data-ttu-id="687fa-119">Você não pode estender o repositório TrustedPeople por usuário.</span><span class="sxs-lookup"><span data-stu-id="687fa-119">You cannot extend the per user TrustedPeople store.</span></span> <span data-ttu-id="687fa-120">No entanto, você pode estender o repositório TrustedPeople do computador local.</span><span class="sxs-lookup"><span data-stu-id="687fa-120">However, you can extend the local machine TrustedPeople store.</span></span>

<span data-ttu-id="687fa-121">**Windows XP e Windows Server 2003:** O repositório TrustedPeople por usuário não está restrito a repositórios físicos predefinidos.</span><span class="sxs-lookup"><span data-stu-id="687fa-121">**Windows XP and Windows Server 2003:** The per user TrustedPeople store is not restricted to predefined physical stores.</span></span>

<span data-ttu-id="687fa-122">Um dos membros de dados da estrutura [**de \_ \_ \_ informações Prov do repositório de certificados**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) é a matriz *rgpvStoreProvFunc* .</span><span class="sxs-lookup"><span data-stu-id="687fa-122">One of the data members of the [**CERT\_STORE\_PROV\_INFO**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) structure is the *rgpvStoreProvFunc* array.</span></span> <span data-ttu-id="687fa-123">Se a função do provedor de armazenamento precisar dar suporte a uma ou mais das funções de retorno de chamada, ela deverá fornecer ponteiros para essa matriz.</span><span class="sxs-lookup"><span data-stu-id="687fa-123">If the store provider function needs to support one or more of the callback functions, it must provide pointers for this array.</span></span> <span data-ttu-id="687fa-124">Esses ponteiros devem apontar para as funções de retorno de chamada que devem ser usadas para outras atividades do repositório de certificados (como fechar a loja).</span><span class="sxs-lookup"><span data-stu-id="687fa-124">These pointers must point to the callback functions that are to be used for other certificate-store activities (such as closing the store).</span></span> <span data-ttu-id="687fa-125">A ilustração a seguir mostra o fluxo desse processo.</span><span class="sxs-lookup"><span data-stu-id="687fa-125">The following illustration shows the flow of this process.</span></span>

![funcionalidade de CertOpenStore](images/openstor.png)

<span data-ttu-id="687fa-127">Conforme mostrado na ilustração a seguir, após a abertura do armazenamento, outras funções de CryptoAPI (como [**CertCloseStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certclosestore)) usam a matriz de ponteiros para acessar as funções de retorno de chamada que executam a tarefa desejada.</span><span class="sxs-lookup"><span data-stu-id="687fa-127">As shown in the following illustration, after the store has been opened, other CryptoAPI functions (such as [**CertCloseStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certclosestore)) use the array of pointers to access the callback functions that perform the intended task.</span></span> <span data-ttu-id="687fa-128">A definição da estrutura [**de \_ \_ \_ informações Prov do repositório de certificados**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) e os protótipos das funções de retorno de chamada padrão fornecidas com a CryptoAPI são mostradas nas funções de retorno de chamada do provedor de repositório de [certificados](cryptography-functions.md).</span><span class="sxs-lookup"><span data-stu-id="687fa-128">The definition of the [**CERT\_STORE\_PROV\_INFO**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) structure and the prototypes of the default callback functions that are supplied with the CryptoAPI are shown in [Certificate Store Provider Callback Functions](cryptography-functions.md).</span></span>

![funcionalidade de CertCloseStore](images/closstor.png)

<span data-ttu-id="687fa-130">As APIs de armazenamento permitem que um provedor de loja Mantenha os certificados, as CRLs e as [*listas de certificados confiáveis*](../secgloss/c-gly.md) (CTLs) fora do cache da loja (por exemplo, um banco de dados externo de certificados, como o fornecido pelo banco de dados do Microsoft Certificate Server).</span><span class="sxs-lookup"><span data-stu-id="687fa-130">The store APIs allow a store provider to maintain the certificates, CRLs, and [*certificate trust lists*](../secgloss/c-gly.md) (CTLs) outside the cache of the store (for example, an external database of certificates, such as provided by the Microsoft Certificate Server Database).</span></span>

<span data-ttu-id="687fa-131">O [**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) envia por meio do parâmetro *pszStoreProvider* para a função de provedor instalável [**CertDllOpenStoreProv**](/windows/win32/api/Wincrypt/nc-wincrypt-pfn_cert_dll_open_store_prov_func) apropriada.</span><span class="sxs-lookup"><span data-stu-id="687fa-131">[**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) dispatches through the *pszStoreProvider* parameter to the appropriate [**CertDllOpenStoreProv**](/windows/win32/api/Wincrypt/nc-wincrypt-pfn_cert_dll_open_store_prov_func) installable provider function.</span></span> <span data-ttu-id="687fa-132">O provedor retorna informações no parâmetro *pStoreProvInfo* que aponta para uma estrutura [**de \_ \_ \_ informações Prov do repositório de certificados**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) .</span><span class="sxs-lookup"><span data-stu-id="687fa-132">The provider returns information in the *pStoreProvInfo* parameter that points to a [**CERT\_STORE\_PROV\_INFO**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) structure.</span></span> <span data-ttu-id="687fa-133">A estrutura de **\_ \_ \_ informações Prov do repositório de certificados** contém um membro **dwStoreProvFlags** .</span><span class="sxs-lookup"><span data-stu-id="687fa-133">The **CERT\_STORE\_PROV\_INFO** structure contains a **dwStoreProvFlags** member.</span></span> <span data-ttu-id="687fa-134">O \_ sinalizador de sinalizador externo de repositório de certificados \_ Prov \_ \_ foi adicionado para permitir que o provedor indique que os certificados, as CRLs e as CTLs são externas ao cache do armazenamento.</span><span class="sxs-lookup"><span data-stu-id="687fa-134">The CERT\_STORE\_PROV\_EXTERNAL\_FLAG flag was added to allow the provider to indicate that the certificates, CRLs, and CTLs are external to the cache of the store.</span></span>

<span data-ttu-id="687fa-135">[**CertDllOpenStoreProv**](/windows/win32/api/Wincrypt/nc-wincrypt-pfn_cert_dll_open_store_prov_func) retorna uma matriz de funções de retorno de chamada.</span><span class="sxs-lookup"><span data-stu-id="687fa-135">[**CertDllOpenStoreProv**](/windows/win32/api/Wincrypt/nc-wincrypt-pfn_cert_dll_open_store_prov_func) returns an array of callback functions.</span></span> <span data-ttu-id="687fa-136">Um provedor pode implementar as seguintes funções de retorno de chamada:</span><span class="sxs-lookup"><span data-stu-id="687fa-136">A provider can implement the following callback functions:</span></span>

-   <span data-ttu-id="687fa-137">repositório de certificados \_ \_ Prov \_ fechar \_ Func</span><span class="sxs-lookup"><span data-stu-id="687fa-137">CERT\_STORE\_PROV\_CLOSE\_FUNC</span></span>
-   <span data-ttu-id="687fa-138">repositório de certificados \_ \_ Prov \_ Read \_ CERT \_ Func</span><span class="sxs-lookup"><span data-stu-id="687fa-138">CERT\_STORE\_PROV\_READ\_CERT\_FUNC</span></span>
-   <span data-ttu-id="687fa-139">função \_ de \_ \_ certificado de gravação Prov do repositório \_ \_ de certificados</span><span class="sxs-lookup"><span data-stu-id="687fa-139">CERT\_STORE\_PROV\_WRITE\_CERT\_FUNC</span></span>
-   <span data-ttu-id="687fa-140">repositório de certificados \_ \_ Prov \_ excluir \_ certificado \_ Func</span><span class="sxs-lookup"><span data-stu-id="687fa-140">CERT\_STORE\_PROV\_DELETE\_CERT\_FUNC</span></span>
-   <span data-ttu-id="687fa-141">\_propriedade de \_ certificado do Prov \_ set CERT \_ \_ Store \_</span><span class="sxs-lookup"><span data-stu-id="687fa-141">CERT\_STORE\_PROV\_SET\_CERT\_PROPERTY\_FUNC</span></span>
-   <span data-ttu-id="687fa-142">repositório de certificados \_ \_ Prov \_ Read \_ CRL \_ Func</span><span class="sxs-lookup"><span data-stu-id="687fa-142">CERT\_STORE\_PROV\_READ\_CRL\_FUNC</span></span>
-   <span data-ttu-id="687fa-143">função \_ de \_ \_ CRL de gravação Prov \_ do repositório CERT \_</span><span class="sxs-lookup"><span data-stu-id="687fa-143">CERT\_STORE\_PROV\_WRITE\_CRL\_FUNC</span></span>
-   <span data-ttu-id="687fa-144">repositório de certificados \_ \_ Prov \_ excluir \_ CRL \_ Func</span><span class="sxs-lookup"><span data-stu-id="687fa-144">CERT\_STORE\_PROV\_DELETE\_CRL\_FUNC</span></span>
-   <span data-ttu-id="687fa-145">repositório de certificados \_ \_ Prov \_ set \_ CRL \_ Property \_ Func</span><span class="sxs-lookup"><span data-stu-id="687fa-145">CERT\_STORE\_PROV\_SET\_CRL\_PROPERTY\_FUNC</span></span>
-   <span data-ttu-id="687fa-146">repositório de certificados \_ \_ Prov \_ Read \_ CTL \_ Func</span><span class="sxs-lookup"><span data-stu-id="687fa-146">CERT\_STORE\_PROV\_READ\_CTL\_FUNC</span></span>
-   <span data-ttu-id="687fa-147">repositório de certificados \_ \_ Prov de gravação de \_ \_ CTL \_ Func</span><span class="sxs-lookup"><span data-stu-id="687fa-147">CERT\_STORE\_PROV\_WRITE\_CTL\_FUNC</span></span>
-   <span data-ttu-id="687fa-148">repositório de certificados \_ \_ Prov \_ excluir \_ CTL \_ Func</span><span class="sxs-lookup"><span data-stu-id="687fa-148">CERT\_STORE\_PROV\_DELETE\_CTL\_FUNC</span></span>
-   <span data-ttu-id="687fa-149">repositório de certificados \_ \_ Prov \_ set \_ CTL \_ Property \_ Func</span><span class="sxs-lookup"><span data-stu-id="687fa-149">CERT\_STORE\_PROV\_SET\_CTL\_PROPERTY\_FUNC</span></span>

<span data-ttu-id="687fa-150">Em chamadas para as \_ funções de retorno de chamada de cert, Write \_ CRL e Write \_ CTL quando o sinalizador do repositório de certificados \_ \_ Prov \_ Write \_ Add \_ é definido, os 16 bits superiores do parâmetro *dwFlags* contêm o valor *dwAddDisposition* .</span><span class="sxs-lookup"><span data-stu-id="687fa-150">On calls to the WRITE\_CERT, WRITE\_CRL, and WRITE\_CTL callback functions when the CERT\_STORE\_PROV\_WRITE\_ADD\_FLAG is set, the upper 16 bits of the *dwFlags* parameter contains the *dwAddDisposition* value.</span></span> <span data-ttu-id="687fa-151">Para dar suporte a repositórios externos, um provedor pode implementar as seguintes funções de retorno de chamada:</span><span class="sxs-lookup"><span data-stu-id="687fa-151">To support external stores, a provider can implement the following callback functions:</span></span>

-   <span data-ttu-id="687fa-152">repositório de certificados \_ \_ Prov \_ localizar \_ certificado \_ Func</span><span class="sxs-lookup"><span data-stu-id="687fa-152">CERT\_STORE\_PROV\_FIND\_CERT\_FUNC</span></span>
-   <span data-ttu-id="687fa-153">repositório de certificados \_ \_ Prov \_ gratuito \_ localizar \_ certificado \_ Func</span><span class="sxs-lookup"><span data-stu-id="687fa-153">CERT\_STORE\_PROV\_FREE\_FIND\_CERT\_FUNC</span></span>
-   <span data-ttu-id="687fa-154">repositório de certificados \_ \_ Prov \_ obter \_ propriedade de certificado \_ \_ Func</span><span class="sxs-lookup"><span data-stu-id="687fa-154">CERT\_STORE\_PROV\_GET\_CERT\_PROPERTY\_FUNC</span></span>
-   <span data-ttu-id="687fa-155">repositório de certificados \_ \_ Prov \_ localizar \_ CRL \_ Func</span><span class="sxs-lookup"><span data-stu-id="687fa-155">CERT\_STORE\_PROV\_FIND\_CRL\_FUNC</span></span>
-   <span data-ttu-id="687fa-156">repositório de certificados \_ \_ Prov \_ gratuito \_ localizar \_ CRL \_ Func</span><span class="sxs-lookup"><span data-stu-id="687fa-156">CERT\_STORE\_PROV\_FREE\_FIND\_CRL\_FUNC</span></span>
-   <span data-ttu-id="687fa-157">\_repositório CERT \_ Prov \_ obter \_ propriedade de CRL \_ \_ Func</span><span class="sxs-lookup"><span data-stu-id="687fa-157">CERT\_STORE\_PROV\_GET\_CRL\_PROPERTY\_FUNC</span></span>
-   <span data-ttu-id="687fa-158">repositório de certificados \_ \_ Prov \_ localizar \_ CTL \_ Func</span><span class="sxs-lookup"><span data-stu-id="687fa-158">CERT\_STORE\_PROV\_FIND\_CTL\_FUNC</span></span>
-   <span data-ttu-id="687fa-159">repositório de certificados \_ \_ Prov \_ gratuito \_ localizar \_ CTL \_ Func</span><span class="sxs-lookup"><span data-stu-id="687fa-159">CERT\_STORE\_PROV\_FREE\_FIND\_CTL\_FUNC</span></span>
-   <span data-ttu-id="687fa-160">\_repositório CERT \_ Prov \_ obter \_ \_ Propriedade CTL \_ Func</span><span class="sxs-lookup"><span data-stu-id="687fa-160">CERT\_STORE\_PROV\_GET\_CTL\_PROPERTY\_FUNC</span></span>

<span data-ttu-id="687fa-161">As funções de retorno de chamada de certificado têm as seguintes assinaturas:</span><span class="sxs-lookup"><span data-stu-id="687fa-161">The certificate callback functions have the following signatures:</span></span>

``` syntax
typedef struct _CERT_STORE_PROV_FIND_INFO {
    DWORD               cbSize;
    DWORD               dwMsgAndCertEncodingType;
    DWORD               dwFindFlags;
    DWORD               dwFindType;
    const void          *pvFindPara;
} CERT_STORE_PROV_FIND_INFO, *PCERT_STORE_PROV_FIND_INFO;
typedef const CERT_STORE_PROV_FIND_INFO CCERT_STORE_PROV_FIND_INFO,
    *PCCERT_STORE_PROV_FIND_INFO;

typedef BOOL (WINAPI *PFN_CERT_STORE_PROV_FIND_CERT)(
        IN HCERTSTOREPROV hStoreProv,
        IN PCCERT_STORE_PROV_FIND_INFO pFindInfo,
        IN PCCERT_CONTEXT pPrevCertContext,
        IN DWORD dwFlags,
        IN OUT void **ppvStoreProvFindInfo,
        OUT PCCERT_CONTEXT *ppProvCertContext
        );

typedef BOOL (WINAPI *PFN_CERT_STORE_PROV_FREE_FIND_CERT)(
        IN HCERTSTOREPROV hStoreProv,
        IN PCCERT_CONTEXT pCertContext,
        IN void *pvStoreProvFindInfo,
        IN DWORD dwFlags
        );

typedef BOOL (WINAPI *PFN_CERT_STORE_PROV_GET_CERT_PROPERTY)(
        IN HCERTSTOREPROV hStoreProv,
        IN PCCERT_CONTEXT pCertContext,
        IN DWORD dwPropId,
        IN DWORD dwFlags,
        OUT void *pvData,
        IN OUT DWORD *pcbData
        );
```

<span data-ttu-id="687fa-162">As assinaturas para as funções de retorno de chamada de CRL e CTL são idênticas às anteriores com o ponteiro para o [**\_ contexto de certificado**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) substituído por um ponteiro para um contexto de [**CRL \_**](/windows/win32/api/Wincrypt/ns-wincrypt-crl_context) ou um [**\_ contexto de CTL**](/windows/win32/api/Wincrypt/ns-wincrypt-ctl_context).</span><span class="sxs-lookup"><span data-stu-id="687fa-162">The signatures for the CRL and CTL callback functions are identical to the above with the pointer to the [**CERT\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) replaced with a pointer to a [**CRL\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-crl_context) or [**CTL\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-ctl_context).</span></span>

<span data-ttu-id="687fa-163">O \_ retorno de chamada de certificado Find é chamado quando as APIs de armazenamento enumeram, localizam ou adicionam certificados.</span><span class="sxs-lookup"><span data-stu-id="687fa-163">The FIND\_CERT callback is called when the store APIs enumerate, find, or add certificates.</span></span> <span data-ttu-id="687fa-164">*pPrevCertContext* e *ppvStoreProvFindInfo* são definidos como **NULL** para iniciar uma nova localização.</span><span class="sxs-lookup"><span data-stu-id="687fa-164">*pPrevCertContext* and *ppvStoreProvFindInfo* are set to **NULL** to initiate a new FIND.</span></span> <span data-ttu-id="687fa-165">O *ppvStoreProvFindInfo* retornado é passado de volta na próxima localização em que a hora em que ele pode ser liberado pelo provedor.</span><span class="sxs-lookup"><span data-stu-id="687fa-165">The returned *ppvStoreProvFindInfo* is passed back on the next find at which time it may be freed by the provider.</span></span> <span data-ttu-id="687fa-166">O provedor pode definir todas, algumas ou nenhuma das propriedades do certificado.</span><span class="sxs-lookup"><span data-stu-id="687fa-166">The provider may set all, some, or none of the certificate properties.</span></span> <span data-ttu-id="687fa-167">O provedor tem a opção de adiar até que o \_ retorno de chamada da propriedade Get CERT \_ seja chamado.</span><span class="sxs-lookup"><span data-stu-id="687fa-167">The provider has the option to defer until the GET\_CERT\_PROPERTY callback is called.</span></span> <span data-ttu-id="687fa-168">É recomendável que os provedores definam o máximo de propriedades possível para permitir a cópia para outro repositório.</span><span class="sxs-lookup"><span data-stu-id="687fa-168">It is recommended for providers to set as many properties as possible to allow copying to another store.</span></span>

<span data-ttu-id="687fa-169">Os tipos de localização de certificado a seguir têm suporte no [**CertFindCertificateInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindcertificateinstore):</span><span class="sxs-lookup"><span data-stu-id="687fa-169">The following certificate find types are supported in [**CertFindCertificateInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindcertificateinstore):</span></span>

-   <span data-ttu-id="687fa-170">\_localizar \_ qualquer certificado</span><span class="sxs-lookup"><span data-stu-id="687fa-170">CERT\_FIND\_ANY</span></span>
-   <span data-ttu-id="687fa-171">CERTIFICADO \_ de \_ encontrar \_ hash SHA1</span><span class="sxs-lookup"><span data-stu-id="687fa-171">CERT\_FIND\_SHA1\_HASH</span></span>
-   <span data-ttu-id="687fa-172">Certificado \_ MD5 de localização de certificados \_ \_</span><span class="sxs-lookup"><span data-stu-id="687fa-172">CERT\_FIND\_MD5\_HASH</span></span>
-   <span data-ttu-id="687fa-173">\_propriedade de localização de certificado \_</span><span class="sxs-lookup"><span data-stu-id="687fa-173">CERT\_FIND\_PROPERTY</span></span>
-   <span data-ttu-id="687fa-174">\_ \_ chave pública de localização de certificado \_</span><span class="sxs-lookup"><span data-stu-id="687fa-174">CERT\_FIND\_PUBLIC\_KEY</span></span>
-   <span data-ttu-id="687fa-175">\_nome da \_ entidade de localização do certificado \_</span><span class="sxs-lookup"><span data-stu-id="687fa-175">CERT\_FIND\_SUBJECT\_NAME</span></span>
-   <span data-ttu-id="687fa-176">\_atributo de localização da \_ entidade de certificado \_</span><span class="sxs-lookup"><span data-stu-id="687fa-176">CERT\_FIND\_SUBJECT\_ATTR</span></span>
-   <span data-ttu-id="687fa-177">\_nome do \_ emissor da localização do certificado \_</span><span class="sxs-lookup"><span data-stu-id="687fa-177">CERT\_FIND\_ISSUER\_NAME</span></span>
-   <span data-ttu-id="687fa-178">\_attr do \_ emissor de localização de certificado \_</span><span class="sxs-lookup"><span data-stu-id="687fa-178">CERT\_FIND\_ISSUER\_ATTR</span></span>
-   <span data-ttu-id="687fa-179">CERTIFICADO \_ de localização da \_ entidade \_ Str \_ A</span><span class="sxs-lookup"><span data-stu-id="687fa-179">CERT\_FIND\_SUBJECT\_STR\_A</span></span>
-   <span data-ttu-id="687fa-180">CERTIFICADO de \_ localização da \_ entidade \_ Str \_ W</span><span class="sxs-lookup"><span data-stu-id="687fa-180">CERT\_FIND\_SUBJECT\_STR\_W</span></span>
-   <span data-ttu-id="687fa-181">\_o certificado encontrou \_ o emissor \_ \_ A</span><span class="sxs-lookup"><span data-stu-id="687fa-181">CERT\_FIND\_ISSUER\_STR\_A</span></span>
-   <span data-ttu-id="687fa-182">Seq do emissor de localização de certificado \_ \_ \_ \_ W</span><span class="sxs-lookup"><span data-stu-id="687fa-182">CERT\_FIND\_ISSUER\_STR\_W</span></span>
-   <span data-ttu-id="687fa-183">\_especificação de \_ chave de localização de certificado \_</span><span class="sxs-lookup"><span data-stu-id="687fa-183">CERT\_FIND\_KEY\_SPEC</span></span>
-   <span data-ttu-id="687fa-184">CERTIFICADO \_ localizar \_ uso de enhkey \_</span><span class="sxs-lookup"><span data-stu-id="687fa-184">CERT\_FIND\_ENHKEY\_USAGE</span></span>

<span data-ttu-id="687fa-185">O \_ retorno de chamada de certificado Find é chamado para cada um dos tipos de localização acima.</span><span class="sxs-lookup"><span data-stu-id="687fa-185">The FIND\_CERT callback is called for each of the above find types.</span></span> <span data-ttu-id="687fa-186">Os parâmetros passados para [**CertFindCertificateInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindcertificateinstore) são copiados diretamente para o \_ repositório de certificados \_ Prov \_ localizar a estrutura de \_ informações antes que o retorno de chamada de certificado de localização \_ seja chamado.</span><span class="sxs-lookup"><span data-stu-id="687fa-186">The parameters passed to [**CertFindCertificateInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindcertificateinstore) are copied directly to the CERT\_STORE\_PROV\_FIND\_INFO structure before the FIND\_CERT callback is called.</span></span> <span data-ttu-id="687fa-187">Para obter detalhes sobre os valores de campo para os diferentes tipos de localização do \_ repositório CERT \_ Prov \_ , encontre a estrutura de \_ informações, consulte **CertFindCertificateInStore**.</span><span class="sxs-lookup"><span data-stu-id="687fa-187">For details about the field values for the different find types of the CERT\_STORE\_PROV\_FIND\_INFO structure, see **CertFindCertificateInStore**.</span></span>

<span data-ttu-id="687fa-188">Os tipos de localização de certificado a seguir dão suporte às APIs [**CertGetSubjectCertificateFromStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetsubjectcertificatefromstore) e [**CertGetIssuerCertificateFromStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetissuercertificatefromstore) e ajudam a determinar se o certificado já existe no repositório antes de adicionar:</span><span class="sxs-lookup"><span data-stu-id="687fa-188">The following certificate find types support the [**CertGetSubjectCertificateFromStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetsubjectcertificatefromstore) and [**CertGetIssuerCertificateFromStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetissuercertificatefromstore) APIs and help determine whether the certificate already exists in the store before adding:</span></span>

-   <span data-ttu-id="687fa-189">certificado \_ da \_ entidade Localizar certificado \_</span><span class="sxs-lookup"><span data-stu-id="687fa-189">CERT\_FIND\_SUBJECT\_CERT</span></span>
-   <span data-ttu-id="687fa-190">\_ \_ emissor \_ de localização de certificado de</span><span class="sxs-lookup"><span data-stu-id="687fa-190">CERT\_FIND\_ISSUER\_OF</span></span>
-   <span data-ttu-id="687fa-191">Localização de certificado \_ \_ existente</span><span class="sxs-lookup"><span data-stu-id="687fa-191">CERT\_FIND\_EXISTING</span></span>

<span data-ttu-id="687fa-192">Para certificado \_ do \_ requerente de localização \_ , o parâmetro *pvFindPara* aponta para uma estrutura de [**\_ informações de certificado**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_info) que contém o emissor e o SerialNumber do assunto.</span><span class="sxs-lookup"><span data-stu-id="687fa-192">For CERT\_FIND\_SUBJECT\_CERT, the *pvFindPara* parameter points to a [**CERT\_INFO**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_info) structure that contains the Issuer and SerialNumber of the subject.</span></span> <span data-ttu-id="687fa-193">Para \_ \_ o emissor de localização \_ de certificado de, *pvFindPara* aponta para uma estrutura de [**\_ contexto de certificado**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) do assunto.</span><span class="sxs-lookup"><span data-stu-id="687fa-193">For CERT\_FIND\_ISSUER\_OF, *pvFindPara* points to a [**CERT\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) structure, of the subject.</span></span> <span data-ttu-id="687fa-194">Para \_ Localizar certificado \_ existente, *pvFindPara* aponta para um **\_ contexto CERT** do certificado para verificar sua existência no repositório.</span><span class="sxs-lookup"><span data-stu-id="687fa-194">For CERT\_FIND\_EXISTING, *pvFindPara* points to a **CERT\_CONTEXT** of the certificate to check for its existence in the store.</span></span>

<span data-ttu-id="687fa-195">O \_ retorno de chamada de certificado de localização gratuita \_ é chamado quando o certificado retornado pelo retorno de chamada de certificado de localização \_ não foi liberado por estar sendo usado em um próximo certificado de localização posterior \_ , tendo sua [*contagem de referência*](../secgloss/r-gly.md) diminuída para zero ou sendo liberada por uma chamada para [**CertCloseStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certclosestore).</span><span class="sxs-lookup"><span data-stu-id="687fa-195">The FREE\_FIND\_CERT callback is called when the certificate returned by the FIND\_CERT callback was not released by being used in a subsequent next FIND\_CERT, thus having its [*reference count*](../secgloss/r-gly.md) decremented to zero, or by being released by a call to [**CertCloseStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certclosestore).</span></span> <span data-ttu-id="687fa-196">Antes que o retorno de chamada de fechamento seja chamado, todos os certificados retornados pelo retorno de chamada de certificado de localização \_ devem ser liberados para o provedor ao serem passados para uma chamada para o retorno de chamada de \_ certificado Find ou uma chamada para o retorno de chamada de \_ certificado Find gratuito \_ .</span><span class="sxs-lookup"><span data-stu-id="687fa-196">Before the CLOSE callback is called, all certificates returned by the FIND\_CERT callback should be released to the provider by being passed to a call to the FIND\_CERT callback or a call to the FREE\_FIND\_CERT callback.</span></span> <span data-ttu-id="687fa-197">O mesmo se aplica aos retornos de chamada CRL e CTL.</span><span class="sxs-lookup"><span data-stu-id="687fa-197">The same applies to the CRL and CTL callbacks.</span></span>

<span data-ttu-id="687fa-198">O \_ retorno de chamada obter propriedade de certificado \_ é chamado por [**CertGetCertificateContextProperty**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetcertificatecontextproperty) se não for possível encontrar a propriedade especificada para o parâmetro *pCertContext* .</span><span class="sxs-lookup"><span data-stu-id="687fa-198">The GET\_CERT\_PROPERTY callback is called by [**CertGetCertificateContextProperty**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetcertificatecontextproperty) if it cannot find the specified property for the *pCertContext* parameter.</span></span> <span data-ttu-id="687fa-199">O mesmo é verdadeiro para obter \_ a \_ propriedade de CRL e obter a \_ \_ Propriedade CTL.</span><span class="sxs-lookup"><span data-stu-id="687fa-199">The same is true for GET\_CRL\_PROPERTY and GET\_CTL\_PROPERTY.</span></span>

<span data-ttu-id="687fa-200">O \_ retorno de chamada Find CRL é chamado quando as APIs de armazenamento enumeram ou obtêm CRLs e antes da adição de uma CRL.</span><span class="sxs-lookup"><span data-stu-id="687fa-200">The FIND\_CRL callback is called when the store APIs enumerate or get CRLs and before adding a CRL.</span></span> <span data-ttu-id="687fa-201">Os seguintes tipos de localização de CRL serão definidos:</span><span class="sxs-lookup"><span data-stu-id="687fa-201">The following CRL find types will be defined:</span></span>

<span data-ttu-id="687fa-202">Para a \_ localização da CRL \_ emitida \_ por, *pvFindPara* é um ponteiro para um [**\_ contexto de certificado**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) do emissor da CRL.</span><span class="sxs-lookup"><span data-stu-id="687fa-202">For CRL\_FIND\_ISSUED\_BY, *pvFindPara* is a pointer to a [**CERT\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) of the CRL issuer.</span></span> <span data-ttu-id="687fa-203">Para \_ Localizar CRL \_ existente, *pvFindPara* é um ponteiro para um [**\_ contexto de CRL**](/windows/win32/api/Wincrypt/ns-wincrypt-crl_context) da CRL para determinar se ele já existe no repositório.</span><span class="sxs-lookup"><span data-stu-id="687fa-203">For CRL\_FIND\_EXISTING, *pvFindPara* is a pointer to a [**CRL\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-crl_context) of the CRL to determine whether it already exists in the store.</span></span>

<span data-ttu-id="687fa-204">O \_ retorno de chamada Find CTL é chamado quando as APIs de armazenamento enumeram ou localizam CTLs.</span><span class="sxs-lookup"><span data-stu-id="687fa-204">The FIND\_CTL callback is called when the store APIs enumerate or find CTLs.</span></span> <span data-ttu-id="687fa-205">Os tipos de localização de lista de certificados confiáveis a seguir têm suporte no [**CertFindCTLInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindctlinstore):</span><span class="sxs-lookup"><span data-stu-id="687fa-205">The following CTL find types are supported in [**CertFindCTLInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindctlinstore):</span></span>

-   <span data-ttu-id="687fa-206">CTL \_ localizar \_ qualquer</span><span class="sxs-lookup"><span data-stu-id="687fa-206">CTL\_FIND\_ANY</span></span>
-   <span data-ttu-id="687fa-207">CTL \_ localizar \_ \_ hash SHA1</span><span class="sxs-lookup"><span data-stu-id="687fa-207">CTL\_FIND\_SHA1\_HASH</span></span>
-   <span data-ttu-id="687fa-208">CTL \_ encontrar \_ \_ hash MD5</span><span class="sxs-lookup"><span data-stu-id="687fa-208">CTL\_FIND\_MD5\_HASH</span></span>
-   <span data-ttu-id="687fa-209">uso da lista de certificados confiáveis \_ \_</span><span class="sxs-lookup"><span data-stu-id="687fa-209">CTL\_FIND\_USAGE</span></span>
-   <span data-ttu-id="687fa-210">localização da lista de certificados confiáveis \_ \_</span><span class="sxs-lookup"><span data-stu-id="687fa-210">CTL\_FIND\_SUBJECT</span></span>
-   <span data-ttu-id="687fa-211">CTL \_ localizar \_ existente</span><span class="sxs-lookup"><span data-stu-id="687fa-211">CTL\_FIND\_EXISTING</span></span>

<span data-ttu-id="687fa-212">O \_ retorno de chamada Find CTL é chamado para cada um dos tipos de localização acima.</span><span class="sxs-lookup"><span data-stu-id="687fa-212">The FIND\_CTL callback is called for each of the above find types.</span></span> <span data-ttu-id="687fa-213">Os parâmetros passados para [**CertFindCTLInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindctlinstore) são copiados diretamente para o \_ repositório de certificados \_ Prov \_ localizar a estrutura de \_ informações antes de o \_ retorno de chamada Find CTL ser chamado.</span><span class="sxs-lookup"><span data-stu-id="687fa-213">The parameters passed to [**CertFindCTLInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindctlinstore) are copied directly to the CERT\_STORE\_PROV\_FIND\_INFO structure before the FIND\_CTL callback is called.</span></span> <span data-ttu-id="687fa-214">Para obter detalhes sobre os valores de campo para os diferentes tipos de localização do \_ repositório CERT \_ Prov \_ , encontre a estrutura de \_ informações, consulte **CertFindCTLInStore**.</span><span class="sxs-lookup"><span data-stu-id="687fa-214">For details about the field values for the different find types of the CERT\_STORE\_PROV\_FIND\_INFO structure, see **CertFindCTLInStore**.</span></span>

<span data-ttu-id="687fa-215">A CTL \_ localizar \_ tipo de localização de CTL existente ajuda a determinar se a CTL já existe no armazenamento antes de fazer uma CTL adicionar.</span><span class="sxs-lookup"><span data-stu-id="687fa-215">The CTL\_FIND\_EXISTING CTL find type helps determine whether the CTL already exists in the store before doing a CTL add.</span></span>

<span data-ttu-id="687fa-216">Para CTL \_ Find \_ existing, *pvFindPara* é um ponteiro para a estrutura de [**\_ contexto de CTL**](/windows/win32/api/Wincrypt/ns-wincrypt-ctl_context) da CTL para determinar se ele já existe no repositório.</span><span class="sxs-lookup"><span data-stu-id="687fa-216">For CTL\_FIND\_EXISTING, *pvFindPara* is a pointer to the [**CTL\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-ctl_context) structure of the CTL to determine whether it already exists in the store.</span></span>

 

 
