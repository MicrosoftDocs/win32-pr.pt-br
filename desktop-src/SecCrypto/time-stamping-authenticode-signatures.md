---
description: O carimbo de data/hora de Authenticode baseia-se nas \# contraassinaturas PKCS 9 padrão. As ferramentas de assinatura da Microsoft permitem que os desenvolvedores afixam carimbos de data/hora ao mesmo tempo que fixam as assinaturas Authenticode.
ms.assetid: d0bd3e2f-1eee-4f71-9467-974994f720d5
title: Carimbo de data/hora das assinaturas Authenticode
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3631d402da56d4078cecce65075c92dff0ec7e1c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "104169686"
---
# <a name="time-stamping-authenticode-signatures"></a><span data-ttu-id="f7326-104">Carimbo de data/hora das assinaturas Authenticode</span><span class="sxs-lookup"><span data-stu-id="f7326-104">Time Stamping Authenticode Signatures</span></span>

<span data-ttu-id="f7326-105">As assinaturas do Authenticode da Microsoft fornecem garantias de autorização e criação para dados binários.</span><span class="sxs-lookup"><span data-stu-id="f7326-105">Microsoft Authenticode signatures provide authorship and integrity guarantees for binary data.</span></span> <span data-ttu-id="f7326-106">O carimbo de data/hora de Authenticode baseia-se nas \# contraassinaturas PKCS 9 padrão.</span><span class="sxs-lookup"><span data-stu-id="f7326-106">Authenticode time stamping is based on standard PKCS \#9 countersignatures.</span></span> <span data-ttu-id="f7326-107">As ferramentas de assinatura da Microsoft permitem que os desenvolvedores afixam carimbos de data/hora ao mesmo tempo que fixam as assinaturas Authenticode.</span><span class="sxs-lookup"><span data-stu-id="f7326-107">Signing tools from Microsoft allow developers to affix time stamps at the same time as they affix Authenticode signatures.</span></span> <span data-ttu-id="f7326-108">O carimbo de data/hora permite que as assinaturas Authenticode sejam verificadas mesmo depois que os certificados usados para a assinatura expirarem.</span><span class="sxs-lookup"><span data-stu-id="f7326-108">Time stamping allows Authenticode signatures to be verifiable even after the certificates used for signature have expired.</span></span>

## <a name="a-brief-introduction-to-authenticode"></a><span data-ttu-id="f7326-109">Uma breve introdução ao Authenticode</span><span class="sxs-lookup"><span data-stu-id="f7326-109">A Brief Introduction to Authenticode</span></span>

<span data-ttu-id="f7326-110">O [*Authenticode*](../secgloss/a-gly.md) aplica a tecnologia de assinatura digital para garantir a autoria e a integridade de dados binários, como software instalável.</span><span class="sxs-lookup"><span data-stu-id="f7326-110">[*Authenticode*](../secgloss/a-gly.md) applies digital signature technology to guarantee the authorship and integrity of binary data such as installable software.</span></span> <span data-ttu-id="f7326-111">Um navegador da Web do cliente ou outros componentes do sistema podem usar as assinaturas Authenticode para verificar a integridade dos dados quando o software é baixado ou instalado.</span><span class="sxs-lookup"><span data-stu-id="f7326-111">A client web browser, or other system components, can use the Authenticode signatures to verify the integrity of the data when the software is downloaded or installed.</span></span> <span data-ttu-id="f7326-112">As assinaturas Authenticode podem ser usadas com muitos formatos de software, incluindo. cab,. exe,. ocx e. dll.</span><span class="sxs-lookup"><span data-stu-id="f7326-112">Authenticode signatures can be used with many software formats, including .cab, .exe, .ocx, and .dll.</span></span>

<span data-ttu-id="f7326-113">A Microsoft mantém uma lista de CAS ( [*autoridades de certificação*](/security/trusted-root/participants-list) ) públicas.</span><span class="sxs-lookup"><span data-stu-id="f7326-113">Microsoft maintains a list of public [*certification authorities*](/security/trusted-root/participants-list) (CAs).</span></span> <span data-ttu-id="f7326-114">Os emissores de certificados Authenticode atualmente incluem [SSL.com](https://www.ssl.com/), [DigiCert](https://www.digicert.com/), [Sectigo (Comodo)](https://www.sectigo.com/)e [GlobalSign](https://www.globalsign.com/).</span><span class="sxs-lookup"><span data-stu-id="f7326-114">Issuers of Authenticode certificates currently include [SSL.com](https://www.ssl.com/), [Digicert](https://www.digicert.com/), [Sectigo(Comodo)](https://www.sectigo.com/), and [GlobalSign](https://www.globalsign.com/).</span></span>

## <a name="about-cryptographic-time-stamping"></a><span data-ttu-id="f7326-115">Sobre o carimbo de data/hora criptográfico</span><span class="sxs-lookup"><span data-stu-id="f7326-115">About Cryptographic Time Stamping</span></span>

<span data-ttu-id="f7326-116">No passado, uma variedade de métodos de carimbo de hora criptográfico foi proposta.</span><span class="sxs-lookup"><span data-stu-id="f7326-116">In the past, a variety of cryptographic time stamping methods have been proposed.</span></span> <span data-ttu-id="f7326-117">Consulte, por exemplo, Haber e Stornetta "como Time-Stamp um documento digital" no *diário de Cryptology* (1991) e Benaloh e de Mare "acumuladores unidirecionais: uma alternativa descentralizada para assinaturas digitais" em notas de *palestra Springer-Verlag em Computer Science* Vol. 765 (EUROCRYPT ' 93).</span><span class="sxs-lookup"><span data-stu-id="f7326-117">See, for example, Haber and Stornetta "How to Time-Stamp a Digital Document" in the *Journal of Cryptology* (1991) and Benaloh and de Mare "One-Way Accumulators: A Decentralized Alternative to Digital Signatures" in *Springer-Verlag Lecture Notes in Computer Science* vol. 765 (EUROCRYPT '93).</span></span> <span data-ttu-id="f7326-118">Um resumo estendido deste artigo está disponível no [Microsoft Research](https://research.microsoft.com/research/pubs/view.aspx?id=233&type=Publication&0sr=a).</span><span class="sxs-lookup"><span data-stu-id="f7326-118">An extended abstract of this article is available from [Microsoft Research](https://research.microsoft.com/research/pubs/view.aspx?id=233&type=Publication&0sr=a).</span></span> <span data-ttu-id="f7326-119">(Esses recursos podem não estar disponíveis em alguns idiomas e países ou regiões.) Como o tempo é um físico, em vez de uma quantidade matemática, esses métodos geralmente se preocupam com como vincular objetos para que a ordem de criação possa ser determinada ou como agrupar objetos com eficiência que podem ser descritos como tendo sido criados simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="f7326-119">(These resources may not be available in some languages and countries or regions.) Because time is a physical, rather than a mathematical, quantity, these methods generally concern how to link objects so that their order of creation can be determined or how to efficiently group objects that can all be described as having been created concurrently.</span></span>

<span data-ttu-id="f7326-120">Os sistemas que tentam autenticar o tempo como uma quantidade sempre exigem alguma forma de confiança.</span><span class="sxs-lookup"><span data-stu-id="f7326-120">Systems that purport to authenticate time as a quantity always require some form of trust.</span></span> <span data-ttu-id="f7326-121">Em uma configuração fortemente antagônico, protocolos complexos podem ser usados para garantir algum grau de sincronia.</span><span class="sxs-lookup"><span data-stu-id="f7326-121">In a strongly adversarial setting, complex protocols can be used to ensure some degree of synchrony.</span></span> <span data-ttu-id="f7326-122">No entanto, esses protocolos exigem uma ampla interação entre as partes afetadas.</span><span class="sxs-lookup"><span data-stu-id="f7326-122">However, these protocols require extensive interaction between affected parties.</span></span> <span data-ttu-id="f7326-123">Na prática, se uma só precisar de certificação de tempo de uma fonte confiável, a origem poderá simplesmente agir como uma notary fornecendo uma instrução assinada (certificação) de que o objeto foi apresentado para assinatura no horário indicado.</span><span class="sxs-lookup"><span data-stu-id="f7326-123">In practice, if one only needs certification of time from a trusted source, the source can simply act as a notary by providing a signed statement (certification) that the object was presented for signature at the indicated time.</span></span>

<span data-ttu-id="f7326-124">O método de metaassinatura do carimbo de data/hora implementado abaixo permite que as assinaturas sejam verificadas mesmo após o certificado de autenticação ter expirado ou ter sido revogado.</span><span class="sxs-lookup"><span data-stu-id="f7326-124">The countersignature method of time stamping implemented below allows for signatures to be verified even after the signing certificate has expired or been revoked.</span></span> <span data-ttu-id="f7326-125">O carimbo de data/hora permite que o verificador saiba de forma confiável o tempo que a assinatura foi afixada e, portanto, confie na assinatura se ela era válida naquele momento.</span><span class="sxs-lookup"><span data-stu-id="f7326-125">The time stamp allows the verifier to reliably know the time that the signature was affixed and thereby trust the signature if it was valid at that time.</span></span> <span data-ttu-id="f7326-126">A hora Stamper deve ter uma fonte de tempo confiável e protegida.</span><span class="sxs-lookup"><span data-stu-id="f7326-126">The time stamper should have a reliable and protected time source.</span></span>

## <a name="pkcs-7-signed-documents-and-countersignatures"></a><span data-ttu-id="f7326-127">\#Documentos assinados PKCS 7 e referendas</span><span class="sxs-lookup"><span data-stu-id="f7326-127">PKCS \#7 Signed Documents and Countersignatures</span></span>

<span data-ttu-id="f7326-128">\#O PKCS 7 é um formato padrão para dados criptográficos, incluindo dados assinados, certificados e [*listas de certificados revogados*](../secgloss/c-gly.md) (CRLs).</span><span class="sxs-lookup"><span data-stu-id="f7326-128">PKCS \#7 is a standard format for cryptographic data, including signed data, certificates, and [*certificate revocation lists*](../secgloss/c-gly.md) (CRLs).</span></span> <span data-ttu-id="f7326-129">O tipo PKCS \# 7 específico de interesse no contexto de carimbo de data/hora são dados assinados, correspondendo ao \# tipo de conteúdo [**SignedData**](signeddata.md) definido PKCS 7.</span><span class="sxs-lookup"><span data-stu-id="f7326-129">The particular PKCS \#7 type of interest in the context of time stamping is signed data, corresponding to the PKCS \#7 defined [**SignedData**](signeddata.md) content type.</span></span>

<span data-ttu-id="f7326-130">O \# pacote PKCS 7 consiste em [**SignedData**](signeddata.md) que identifica o conteúdo real e determinadas informações sobre ele e os blocos de assinatura SignerInfo.</span><span class="sxs-lookup"><span data-stu-id="f7326-130">The PKCS \#7 package consists of [**SignedData**](signeddata.md) that identifies the actual content and certain information about it and SignerInfo signature blocks.</span></span> <span data-ttu-id="f7326-131">Um SignerInfo pode conter uma referenda, o que recursivamente é outro SignerInfo.</span><span class="sxs-lookup"><span data-stu-id="f7326-131">A SignerInfo may itself contain a countersignature, which recursively is another SignerInfo.</span></span> <span data-ttu-id="f7326-132">Em princípio, uma sequência dessas referendas pode estar presente.</span><span class="sxs-lookup"><span data-stu-id="f7326-132">In principle, a sequence of such countersignatures may be present.</span></span> <span data-ttu-id="f7326-133">A referenda é um atributo não autenticado em relação à assinatura no SignerInfo; ou seja, ele pode ser afixado subsequentemente à assinatura original.</span><span class="sxs-lookup"><span data-stu-id="f7326-133">The countersignature is an unauthenticated attribute with respect to the signature in the SignerInfo; that is, it may be affixed subsequent to the original signature.</span></span> <span data-ttu-id="f7326-134">No formulário de estrutura de tópicos:</span><span class="sxs-lookup"><span data-stu-id="f7326-134">In outline form:</span></span>

<span data-ttu-id="f7326-135">[**SignedData**](signeddata.md) (PKCS \# 7)</span><span class="sxs-lookup"><span data-stu-id="f7326-135">[**SignedData**](signeddata.md) (PKCS \#7)</span></span>

-   <span data-ttu-id="f7326-136">Versão (do PKCS \# 7, geralmente versão 1)</span><span class="sxs-lookup"><span data-stu-id="f7326-136">Version (of PKCS \#7, generally version 1)</span></span>
-   <span data-ttu-id="f7326-137">DigestAlgorithms (coleção de todos os algoritmos usados por SignerInfo blocos de assinatura para processamento otimizado)</span><span class="sxs-lookup"><span data-stu-id="f7326-137">DigestAlgorithms (collection of all algorithms used by SignerInfo signature blocks, for optimized processing)</span></span>
-   <span data-ttu-id="f7326-138">ContentInfo (contentType é igual a [**SignedData**](signeddata.md), mais conteúdo ou referência a conteúdo)</span><span class="sxs-lookup"><span data-stu-id="f7326-138">ContentInfo (contentType equals [**SignedData**](signeddata.md), plus content or reference to content)</span></span>
-   <span data-ttu-id="f7326-139">Certificados OPCIONais (coleção de todos os certificados usados)</span><span class="sxs-lookup"><span data-stu-id="f7326-139">OPTIONAL Certificates (collection of all certificates used)</span></span>
-   <span data-ttu-id="f7326-140">CRLs OPCIONais (coleção de todas as CRLs)</span><span class="sxs-lookup"><span data-stu-id="f7326-140">OPTIONAL CRLs (collection of all CRLs)</span></span>
-   <span data-ttu-id="f7326-141">Blocos de assinatura SignerInfo (a assinatura real, composta de um ou mais blocos de assinatura SignerInfo)</span><span class="sxs-lookup"><span data-stu-id="f7326-141">SignerInfo signature blocks (the actual signature, composed of one or more SignerInfo signature blocks)</span></span>

<span data-ttu-id="f7326-142">SignerInfo (o bloco de assinatura)</span><span class="sxs-lookup"><span data-stu-id="f7326-142">SignerInfo (the signature block)</span></span>

-   <span data-ttu-id="f7326-143">Versão (do PKCS \# 7, geralmente versão 1)</span><span class="sxs-lookup"><span data-stu-id="f7326-143">Version (of PKCS \#7, generally version 1)</span></span>
-   <span data-ttu-id="f7326-144">Certificado (emissor e número de série para identificar exclusivamente o certificado do signatário em [**SignedData**](signeddata.md))</span><span class="sxs-lookup"><span data-stu-id="f7326-144">Certificate (issuer and serial number to uniquely identify of signer's certificate in [**SignedData**](signeddata.md))</span></span>
-   <span data-ttu-id="f7326-145">DigestAlgorithm mais o DigestEncryptionAlgorithm mais o resumo (hash), além do EncryptedDigest (assinatura real)</span><span class="sxs-lookup"><span data-stu-id="f7326-145">DigestAlgorithm plus the DigestEncryptionAlgorithm plus the Digest (hash), plus the EncryptedDigest (actual signature)</span></span>
-   <span data-ttu-id="f7326-146">AuthenticatedAttributes opcional (por exemplo, assinado por este signatário)</span><span class="sxs-lookup"><span data-stu-id="f7326-146">OPTIONAL AuthenticatedAttributes (for example, signed by this signer)</span></span>
-   <span data-ttu-id="f7326-147">UnauthenticatedAttributes opcional (por exemplo, não assinado por este signatário)</span><span class="sxs-lookup"><span data-stu-id="f7326-147">OPTIONAL UnauthenticatedAttributes (for example, not signed by this signer)</span></span>

<span data-ttu-id="f7326-148">Um exemplo de um atributo autenticado é o tempo de assinatura (OID 1.2.840.113549.1.9.5) porque faz parte do que o serviço de carimbo de data/hora assina.</span><span class="sxs-lookup"><span data-stu-id="f7326-148">An example of an authenticated attribute is the signing time (OID 1.2.840.113549.1.9.5) because it is part of what the time stamp service signs.</span></span> <span data-ttu-id="f7326-149">Um exemplo de um atributo não autenticado é a referenda (OID 1.2.840.113549.1.9.6), pois ele pode ser fixado após a assinatura.</span><span class="sxs-lookup"><span data-stu-id="f7326-149">An example of an unauthenticated attribute is the countersignature (OID 1.2.840.113549.1.9.6) because it can be affixed after signing.</span></span> <span data-ttu-id="f7326-150">Nesse caso, o próprio SignerInfo contém um SignerInfo (a referenda).</span><span class="sxs-lookup"><span data-stu-id="f7326-150">In this case, the SignerInfo itself contains a SignerInfo (the Countersignature).</span></span>

> [!Note]  
> <span data-ttu-id="f7326-151">O objeto que está assinado na referenda é a assinatura original (ou seja, o EncryptedDigest do SignerInfo original).</span><span class="sxs-lookup"><span data-stu-id="f7326-151">The object that is signed in the countersignature is the original signature (that is, the EncryptedDigest of the original SignerInfo).</span></span>

 

## <a name="signtool-and-the-authenticode-process"></a><span data-ttu-id="f7326-152">SignTool e o processo de Authenticode</span><span class="sxs-lookup"><span data-stu-id="f7326-152">SignTool and the Authenticode Process</span></span>

<span data-ttu-id="f7326-153">[SignTool](signtool.md) está disponível para assinatura Authenticode e dados binários de carimbo de data/hora.</span><span class="sxs-lookup"><span data-stu-id="f7326-153">[SignTool](signtool.md) is available for Authenticode signing and time stamping binary data.</span></span> <span data-ttu-id="f7326-154">A ferramenta é instalada na \\ pasta bin do caminho de instalação do SDK (Software Development Kit) do Microsoft Windows.</span><span class="sxs-lookup"><span data-stu-id="f7326-154">The tool is installed in the \\Bin folder of the Microsoft Windows Software Development Kit (SDK) installation path.</span></span>

<span data-ttu-id="f7326-155">Os dados binários de assinatura e carimbo de data/hora são relativamente simples usando [SignTool](signtool.md).</span><span class="sxs-lookup"><span data-stu-id="f7326-155">Signing and time stamping binary data is relatively straightforward using [SignTool](signtool.md).</span></span> <span data-ttu-id="f7326-156">O Publicador deve obter um certificado de assinatura de código de uma AC de assinatura de código comercial.</span><span class="sxs-lookup"><span data-stu-id="f7326-156">The publisher must get a code signing certificate from a commercial code signing CA.</span></span> <span data-ttu-id="f7326-157">Para sua conveniência, a Microsoft publica e atualiza uma lista de CAs públicas, incluindo aquelas que emitem certificados Authenticode.</span><span class="sxs-lookup"><span data-stu-id="f7326-157">For convenience, Microsoft publishes and updates a list of public CAs, including those that issue Authenticode certificates.</span></span> <span data-ttu-id="f7326-158">Quando estiver pronto para publicar, os arquivos de objeto serão assinados e marcados com o tempo usando parâmetros de linha de comando apropriados com a ferramenta SignTool.</span><span class="sxs-lookup"><span data-stu-id="f7326-158">When ready to publish, the object files are signed and time stamped using appropriate command line parameters with the SignTool tool.</span></span> <span data-ttu-id="f7326-159">O resultado de qualquer operação de SignTool é sempre um \# formato PKCS 7 [**SignedData**](signeddata.md).</span><span class="sxs-lookup"><span data-stu-id="f7326-159">The result of any SignTool operation is always a PKCS \#7 format [**SignedData**](signeddata.md).</span></span>

<span data-ttu-id="f7326-160">O SignTool aceita como entrada dados binários brutos para serem assinados e marcados com carimbo de data/hora ou dados binários assinados anteriormente para serem carimbados.</span><span class="sxs-lookup"><span data-stu-id="f7326-160">SignTool accepts as input either raw binary data to be signed and time stamped, or previously signed binary data to be time stamped.</span></span> <span data-ttu-id="f7326-161">Os dados que foram assinados anteriormente podem ser carimbados com o uso do comando de **carimbo de data/** hora de SignTool.</span><span class="sxs-lookup"><span data-stu-id="f7326-161">Data that has previously been signed can be time stamped by using the **signtool timestamp** command.</span></span>



| <span data-ttu-id="f7326-162">Argumento</span><span class="sxs-lookup"><span data-stu-id="f7326-162">Argument</span></span>             | <span data-ttu-id="f7326-163">Descrição</span><span class="sxs-lookup"><span data-stu-id="f7326-163">Description</span></span>                                                                                                                                                                                                    |
|----------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="f7326-164">**/T** *HTTPAddress*</span><span class="sxs-lookup"><span data-stu-id="f7326-164">**/t** *HTTPAddress*</span></span> | <span data-ttu-id="f7326-165">Indica que o arquivo deve ser carimbado com o tempo.</span><span class="sxs-lookup"><span data-stu-id="f7326-165">Indicates that the file is to be time stamped.</span></span> <span data-ttu-id="f7326-166">Uma URL que especifica um endereço de um servidor de carimbo de data/hora deve ser fornecida.</span><span class="sxs-lookup"><span data-stu-id="f7326-166">A URL that specifies an address of a time stamping server must be provided.</span></span> <span data-ttu-id="f7326-167">**/t** pode ser usado com os comandos de **saída de SignTool** e de **carimbo de data/hora de SignTool** .</span><span class="sxs-lookup"><span data-stu-id="f7326-167">**/t** can be used with both **signtool sign** and **signtool timestamp** commands.</span></span> |



 

<span data-ttu-id="f7326-168">Para obter mais informações sobre as ferramentas que podem ser úteis nesse contexto, consulte [ferramentas de criptografia](cryptography-tools.md) e [SignTool](signtool.md).</span><span class="sxs-lookup"><span data-stu-id="f7326-168">For more information about tools that may be useful in this context, see [Cryptography Tools](cryptography-tools.md) and [SignTool](signtool.md).</span></span>

## <a name="implementation-details-and-wire-format"></a><span data-ttu-id="f7326-169">Detalhes da implementação e formato de conexão</span><span class="sxs-lookup"><span data-stu-id="f7326-169">Implementation Details and Wire Format</span></span>

<span data-ttu-id="f7326-170">O [SignTool](signtool.md) conta com a implementação Authenticode do Windows para criar e assinaturas de carimbo de data/hora.</span><span class="sxs-lookup"><span data-stu-id="f7326-170">[SignTool](signtool.md) relies on the Windows Authenticode implementation to create and time stamp signatures.</span></span> <span data-ttu-id="f7326-171">O [*Authenticode*](../secgloss/a-gly.md) opera em arquivos binários, por exemplo,. cab,. exe,. dll ou. ocx.</span><span class="sxs-lookup"><span data-stu-id="f7326-171">[*Authenticode*](../secgloss/a-gly.md) operates on binary files, for example .cab, .exe, .dll, or .ocx.</span></span> <span data-ttu-id="f7326-172">O Authenticode primeiro cria a assinatura, produzindo \# um [**SignedData**](signeddata.md)PKCS 7.</span><span class="sxs-lookup"><span data-stu-id="f7326-172">Authenticode first creates the signature, producing a PKCS \#7 [**SignedData**](signeddata.md).</span></span> <span data-ttu-id="f7326-173">É essa **SignedData** que deve ser assinada por você, conforme descrito no PKCS \# 9.</span><span class="sxs-lookup"><span data-stu-id="f7326-173">It is this **SignedData** that must be countersigned, as described in PKCS \#9.</span></span>

<span data-ttu-id="f7326-174">O processo de referendas ocorre em quatro etapas:</span><span class="sxs-lookup"><span data-stu-id="f7326-174">The countersignature process takes place in four steps:</span></span>

1.  <span data-ttu-id="f7326-175">Copie a assinatura (ou seja, a encryptedDigest) da SignerInfo do \# [**SignedData**](signeddata.md)PKCS 7.</span><span class="sxs-lookup"><span data-stu-id="f7326-175">Copy the signature (that is, the encryptedDigest) from the SignerInfo of the PKCS \#7 [**SignedData**](signeddata.md).</span></span>
2.  <span data-ttu-id="f7326-176">Construa uma solicitação de carimbo de data/hora cujo conteúdo é a assinatura original.</span><span class="sxs-lookup"><span data-stu-id="f7326-176">Construct a time stamp request whose content is the original signature.</span></span> <span data-ttu-id="f7326-177">Envie-o para a [*notação de sintaxe abstrata*](../secgloss/a-gly.md) do servidor de carimbo de data/hora (ASN. 1) codificada como um TimeStampRequest.</span><span class="sxs-lookup"><span data-stu-id="f7326-177">Send this to the time stamp server [*Abstract Syntax Notation One*](../secgloss/a-gly.md) (ASN.1) encoded as a TimeStampRequest.</span></span>
3.  <span data-ttu-id="f7326-178">Receba um carimbo de data/hora, formatado como um segundo \# [**SignedData**](signeddata.md)PKCS 7, retornado do servidor de carimbo de data/hora.</span><span class="sxs-lookup"><span data-stu-id="f7326-178">Receive a time stamp, formatted as a second PKCS \#7 [**SignedData**](signeddata.md), returned from the time stamp server.</span></span>
4.  <span data-ttu-id="f7326-179">Copie o SignerInfo do carimbo de data/hora diretamente para o \# [**SignedData**](signeddata.md)PKCS 7 original, como uma \# metaassinatura PKCS 9 (ou seja, um atributo não autenticado no SignerInfo do original).</span><span class="sxs-lookup"><span data-stu-id="f7326-179">Copy the SignerInfo from the time stamp directly into the original PKCS \#7 [**SignedData**](signeddata.md), as a PKCS \#9 countersignature (that is, an unauthenticated attribute in the SignerInfo of the original).</span></span>

## <a name="time-stamp-request"></a><span data-ttu-id="f7326-180">Solicitação de carimbo de data/hora</span><span class="sxs-lookup"><span data-stu-id="f7326-180">Time Stamp Request</span></span>

<span data-ttu-id="f7326-181">A solicitação de carimbo de data/hora é enviada em uma mensagem de POSTAgem HTTP 1,1.</span><span class="sxs-lookup"><span data-stu-id="f7326-181">The time stamp request is sent within an HTTP 1.1 POST message.</span></span> <span data-ttu-id="f7326-182">No cabeçalho HTTP, a diretiva CacheControl é definida como no-cache e a diretiva Content-Type é definida como application/octet-stream.</span><span class="sxs-lookup"><span data-stu-id="f7326-182">In the HTTP header, the CacheControl directive is set to no-cache, and the Content-Type directive is set to application/octet-stream.</span></span> <span data-ttu-id="f7326-183">O corpo da mensagem HTTP é uma codificação Base64 de codificação [*Distinguished Encoding Rules*](../secgloss/d-gly.md) (der) da solicitação de carimbo de data/hora.</span><span class="sxs-lookup"><span data-stu-id="f7326-183">The body of the HTTP message is a base64 encoding of [*Distinguished Encoding Rules*](../secgloss/d-gly.md) (DER) encoding of the time stamp request.</span></span>

<span data-ttu-id="f7326-184">Embora não esteja sendo usado no momento, a diretiva Content-Length também deve ser usada na construção da mensagem HTTP, pois ajuda o servidor de carimbo de data/hora localizar onde a solicitação está dentro do HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="f7326-184">Although not currently used, the Content-Length directive should also be used in constructing the HTTP message because it helps the time stamp server locate where the request is within the HTTP POST.</span></span>

<span data-ttu-id="f7326-185">Outros cabeçalhos HTTP também podem estar presentes e devem ser ignorados se não forem compreendidos pelo solicitante ou pelo servidor de carimbo de data/hora.</span><span class="sxs-lookup"><span data-stu-id="f7326-185">Other HTTP headers may also be present and should be ignored if they are not understood by the requestor or time stamp server.</span></span>

<span data-ttu-id="f7326-186">A solicitação de carimbo de data/hora é uma mensagem codificada pelo ASN. 1.</span><span class="sxs-lookup"><span data-stu-id="f7326-186">The time stamp request is an ASN.1 encoded message.</span></span> <span data-ttu-id="f7326-187">O formato da solicitação é o seguinte.</span><span class="sxs-lookup"><span data-stu-id="f7326-187">The format of the request is as follows.</span></span>

``` syntax
TimeStampRequest ::= SEQUENCE {
   countersignatureType OBJECT IDENTIFIER,
   attributes Attributes OPTIONAL, 
   content  ContentInfo
}
```

<span data-ttu-id="f7326-188">O referenda é o identificador de [*objeto*](../secgloss/o-gly.md) (OID) que identifica isso como uma referenda de carimbo de data/hora e deve ser o OID 1.3.6.1.4.1.311.3.2.1 exato.</span><span class="sxs-lookup"><span data-stu-id="f7326-188">The countersignatureType is the [*object identifier*](../secgloss/o-gly.md) (OID) that identifies this as a time stamp countersignature and should be the exact OID 1.3.6.1.4.1.311.3.2.1.</span></span>

<span data-ttu-id="f7326-189">Nenhum atributo está incluído atualmente na solicitação de carimbo de data/hora.</span><span class="sxs-lookup"><span data-stu-id="f7326-189">No attributes are currently included in the time stamp request.</span></span>

<span data-ttu-id="f7326-190">O conteúdo é um ContentInfo, conforme definido pelo PKCS \# 7.</span><span class="sxs-lookup"><span data-stu-id="f7326-190">The content is a ContentInfo as defined by PKCS \#7.</span></span> <span data-ttu-id="f7326-191">O conteúdo são os dados a serem assinados.</span><span class="sxs-lookup"><span data-stu-id="f7326-191">The content is the data to be signed.</span></span> <span data-ttu-id="f7326-192">Para o carimbo de data/hora de assinatura, o ContentType deve ser dado, e o conteúdo deve ser o encryptedDigest (assinatura) do SignerInfo do \# conteúdo PKCS 7 a ser carimbado.</span><span class="sxs-lookup"><span data-stu-id="f7326-192">For signature time stamping, the ContentType should be Data, and the content should be the encryptedDigest (signature) from the SignerInfo of the PKCS \#7 content to be time stamped.</span></span>

## <a name="time-stamp-response"></a><span data-ttu-id="f7326-193">Resposta de carimbo de data/hora</span><span class="sxs-lookup"><span data-stu-id="f7326-193">Time Stamp Response</span></span>

<span data-ttu-id="f7326-194">A resposta de carimbo de data/hora também é enviada em uma mensagem HTTP 1,1.</span><span class="sxs-lookup"><span data-stu-id="f7326-194">The time stamp response is also sent within an HTTP 1.1 message.</span></span> <span data-ttu-id="f7326-195">No cabeçalho HTTP, a diretiva Content-Type também é definida como application/octet-stream.</span><span class="sxs-lookup"><span data-stu-id="f7326-195">In the HTTP header, the Content-Type directive is also set to application/octet-stream.</span></span> <span data-ttu-id="f7326-196">O corpo da mensagem HTTP é uma codificação Base64 da codificação DER da resposta de carimbo de data/hora.</span><span class="sxs-lookup"><span data-stu-id="f7326-196">The body of the HTTP message is a base64 encoding of DER encoding of the time stamp response.</span></span>

<span data-ttu-id="f7326-197">A resposta de carimbo de data/hora é uma \# mensagem assinada PKCS 7 assinada pela hora Stamper.</span><span class="sxs-lookup"><span data-stu-id="f7326-197">The time stamp response is a PKCS \#7 signed message signed by the time stamper.</span></span> <span data-ttu-id="f7326-198">O ContentInfo da mensagem PKCS \# 7 é idêntico ao ContentInfo recebido no carimbo de data/hora.</span><span class="sxs-lookup"><span data-stu-id="f7326-198">The ContentInfo of the PKCS \#7 message is identical to the ContentInfo received in the time stamp.</span></span> <span data-ttu-id="f7326-199">O \# conteúdo PKCS 7 contém o atributo autenticado de tempo de assinatura (definido em PKCS \# 99, OID 1.2.840.113549.9.5).</span><span class="sxs-lookup"><span data-stu-id="f7326-199">The PKCS \#7 content contains the signing time authenticated attribute (defined in PKCS \#99, OID 1.2.840.113549.9.5).</span></span>

<span data-ttu-id="f7326-200">Depois que o Authenticode recebe o carimbo de data/hora do servidor, o Authenticode incorpora o carimbo de data/hora ao \# [**SignedData**](signeddata.md) PKCS 7 original como uma referenda.</span><span class="sxs-lookup"><span data-stu-id="f7326-200">After Authenticode receives the time stamp from the server, Authenticode incorporates the time stamp into the original PKCS \#7 [**SignedData**](signeddata.md) as a countersignature.</span></span> <span data-ttu-id="f7326-201">Para fazer isso, o ContentInfo do \# **SignedData** PKCS 7 retornado é Descartado e o SignerInfo do carimbo de data/hora retornado é copiado como uma referenda no SIGNERINFO do \# **SignedData** PKCS 7 original.</span><span class="sxs-lookup"><span data-stu-id="f7326-201">To accomplish this, the ContentInfo of the returned PKCS \#7 **SignedData** is discarded, and the SignerInfo of the returned time stamp is copied as a countersignature into the SignerInfo of the original PKCS \#7 **SignedData**.</span></span> <span data-ttu-id="f7326-202">A cadeia de certificados da hora Stamper também é copiada em certificados no SignedData PKCS \# 7  original como um atributo não autenticado do assinante original.</span><span class="sxs-lookup"><span data-stu-id="f7326-202">The certificate chain of the time stamper is also copied into Certificates in the original PKCS \#7 **SignedData** as an unauthenticated attribute of the original signer.</span></span>

<span data-ttu-id="f7326-203">Para obter mais informações sobre PKCS e outros assuntos de segurança, consulte a [biblioteca de conteúdo do site da RSA](https://www.rsa.com/content_library.aspx).</span><span class="sxs-lookup"><span data-stu-id="f7326-203">For more information about PKCS and other security subjects, see the [content library of the RSA website](https://www.rsa.com/content_library.aspx).</span></span>

 

 
