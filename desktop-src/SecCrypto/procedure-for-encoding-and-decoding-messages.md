---
description: Detalha o procedimento para codificar uma mensagem geral.
ms.assetid: 554cab0d-cfa2-46a7-80d9-f41430eb4b47
title: Procedimento para codificar e decodificar mensagens
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 49da09c2318fffd3d1c92d6012055172709609a7
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105761393"
---
# <a name="procedure-for-encoding-and-decoding-messages"></a><span data-ttu-id="3985a-103">Procedimento para codificar e decodificar mensagens</span><span class="sxs-lookup"><span data-stu-id="3985a-103">Procedure for Encoding and Decoding Messages</span></span>

<span data-ttu-id="3985a-104">O procedimento para codificar uma mensagem geral é o seguinte.</span><span class="sxs-lookup"><span data-stu-id="3985a-104">The procedure for encoding a general message is as follows.</span></span>

<span data-ttu-id="3985a-105">**Para codificar uma mensagem**</span><span class="sxs-lookup"><span data-stu-id="3985a-105">**To encode a message**</span></span>

1.  <span data-ttu-id="3985a-106">Inicialize as estruturas de dados apropriadas para o tipo de dados desejado.</span><span class="sxs-lookup"><span data-stu-id="3985a-106">Initialize the appropriate data structures for the desired data type.</span></span>
2.  <span data-ttu-id="3985a-107">Chame [**CryptMsgOpenToEncode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentoencode), passando os argumentos necessários.</span><span class="sxs-lookup"><span data-stu-id="3985a-107">Call [**CryptMsgOpenToEncode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentoencode), passing the necessary arguments.</span></span> <span data-ttu-id="3985a-108">Ao chamar **CryptMsgOpenToEncode**, se os dados a serem fornecidos ao [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) já tiverem sido codificados por mensagem, passe o identificador de objeto apropriado em *pszInnerContentObjID* (por exemplo, "1.2.840.113549.1.7.2" para szOID \_ RSA \_ signedData).</span><span class="sxs-lookup"><span data-stu-id="3985a-108">When calling **CryptMsgOpenToEncode**, if the data that is to be provided to [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) has already been message-encoded, pass the appropriate object identifier in *pszInnerContentObjID* (for example, "1.2.840.113549.1.7.2" for szOID\_RSA\_signedData).</span></span> <span data-ttu-id="3985a-109">Se *pszInnerContentObjID* for **NULL**, presume-se que o tipo de [*conteúdo interno*](../secgloss/i-gly.md) não tenha sido codificado anteriormente e que seja processado adequadamente.</span><span class="sxs-lookup"><span data-stu-id="3985a-109">If *pszInnerContentObjID* is **NULL**, the [*inner content*](../secgloss/i-gly.md) type is assumed not to have been previously encoded and is processed appropriately.</span></span>
3.  <span data-ttu-id="3985a-110">Chame [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) quantas vezes forem necessárias para concluir a mensagem.</span><span class="sxs-lookup"><span data-stu-id="3985a-110">Call [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) as many times as necessary to complete the message.</span></span> <span data-ttu-id="3985a-111">Na última chamada, defina o parâmetro *fFinal* como **true**.</span><span class="sxs-lookup"><span data-stu-id="3985a-111">On the last call, set the *fFinal* parameter to **TRUE**.</span></span> <span data-ttu-id="3985a-112">(Para obter detalhes, consulte **CryptMsgUpdate**).</span><span class="sxs-lookup"><span data-stu-id="3985a-112">(For details, see **CryptMsgUpdate**).</span></span>
4.  <span data-ttu-id="3985a-113">Chame [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam) para obter um ponteiro para os parâmetros desejados, como o conteúdo.</span><span class="sxs-lookup"><span data-stu-id="3985a-113">Call [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam) to get a pointer to the desired parameters, such as the content.</span></span> <span data-ttu-id="3985a-114">Para codificar dados gerais simples, use \_ o parâmetro de conteúdo CMSG \_ para o *dwParamtype*.</span><span class="sxs-lookup"><span data-stu-id="3985a-114">For encoding simple, general data, use CMSG\_CONTENT\_PARAM for the *dwParamtype*.</span></span>
5.  <span data-ttu-id="3985a-115">Feche a mensagem chamando [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose).</span><span class="sxs-lookup"><span data-stu-id="3985a-115">Close the message by calling [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose).</span></span>

<span data-ttu-id="3985a-116">Esse procedimento resulta em uma mensagem codificada de um tipo especificado nas chamadas de função.</span><span class="sxs-lookup"><span data-stu-id="3985a-116">This procedure results in an encoded message of a type specified in the function calls.</span></span>

<span data-ttu-id="3985a-117">O procedimento para decodificar uma mensagem geral é o seguinte.</span><span class="sxs-lookup"><span data-stu-id="3985a-117">The procedure for decoding a general message is as follows.</span></span>

<span data-ttu-id="3985a-118">**Para decodificar uma mensagem**</span><span class="sxs-lookup"><span data-stu-id="3985a-118">**To decode a message**</span></span>

1.  <span data-ttu-id="3985a-119">Determine o comprimento necessário para que o buffer Mantenha os dados codificados usando [**CryptMsgCalculateEncodedLength**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcalculateencodedlength).</span><span class="sxs-lookup"><span data-stu-id="3985a-119">Determine the length needed for the buffer to hold the encoded data using [**CryptMsgCalculateEncodedLength**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcalculateencodedlength).</span></span>
2.  <span data-ttu-id="3985a-120">Chame [**CryptMsgOpenToDecode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentodecode), passando os argumentos necessários.</span><span class="sxs-lookup"><span data-stu-id="3985a-120">Call [**CryptMsgOpenToDecode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentodecode), passing the necessary arguments.</span></span> <span data-ttu-id="3985a-121">Para manter a compatibilidade com o Internet Explorer versão 3,0, o parâmetro *dwMsgType* é fornecido.</span><span class="sxs-lookup"><span data-stu-id="3985a-121">To maintain compatibility with Internet Explorer version 3.0, the *dwMsgType* parameter is provided.</span></span> <span data-ttu-id="3985a-122">Os dados assinados criados no Internet Explorer 3,0 não contêm informações de cabeçalho.</span><span class="sxs-lookup"><span data-stu-id="3985a-122">Signed data created in Internet Explorer 3.0 does not contain header information.</span></span> <span data-ttu-id="3985a-123">Portanto, se essa mensagem for extraída de assinaturas de arquivo, o tipo de mensagem deverá ser passado para a função.</span><span class="sxs-lookup"><span data-stu-id="3985a-123">Therefore, if such a message is extracted from file signatures, the message type must be passed into the function.</span></span> <span data-ttu-id="3985a-124">Se zero for passado para o parâmetro *dwMsgType* , a função lerá o tipo de mensagem do cabeçalho na mensagem.</span><span class="sxs-lookup"><span data-stu-id="3985a-124">If zero is passed into the *dwMsgType* parameter, the function will read the message type from the header on the message.</span></span> <span data-ttu-id="3985a-125">Se o cabeçalho estiver ausente, a chamada de função falhará.</span><span class="sxs-lookup"><span data-stu-id="3985a-125">If the header is missing, the function call will fail.</span></span> <span data-ttu-id="3985a-126">Se for bem-sucedido, será retornado um identificador para a mensagem aberta.</span><span class="sxs-lookup"><span data-stu-id="3985a-126">If successful, a handle to the opened message is returned.</span></span>
3.  <span data-ttu-id="3985a-127">Chame [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) uma vez.</span><span class="sxs-lookup"><span data-stu-id="3985a-127">Call [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) once.</span></span> <span data-ttu-id="3985a-128">Isso faz com que as ações apropriadas sejam executadas na mensagem, dependendo do tipo de mensagem.</span><span class="sxs-lookup"><span data-stu-id="3985a-128">This causes the appropriate actions to be taken on the message, depending on the message type.</span></span>
4.  <span data-ttu-id="3985a-129">Para o processamento adicional da mensagem, como a descriptografia adicional ou a verificação de assinatura, chame [**CryptMsgControl**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcontrol), passando a ação desejada em *dwCtrlType*.</span><span class="sxs-lookup"><span data-stu-id="3985a-129">For additional processing of the message, such as additional decryption or signature verification, call [**CryptMsgControl**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcontrol), passing the desired action in *dwCtrlType*.</span></span>
5.  <span data-ttu-id="3985a-130">Chame [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam) para obter um ponteiro para os parâmetros desejados, como o conteúdo.</span><span class="sxs-lookup"><span data-stu-id="3985a-130">Call [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam) to get a pointer to the desired parameters, such as the content.</span></span> <span data-ttu-id="3985a-131">Para decodificar dados gerais simples, use \_ o parâmetro de conteúdo CMSG \_ para o parâmetro *dwParamtype* .</span><span class="sxs-lookup"><span data-stu-id="3985a-131">To decode simple general data, use CMSG\_CONTENT\_PARAM for the *dwParamtype* parameter.</span></span>
6.  <span data-ttu-id="3985a-132">Chame [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose) para fechar a mensagem.</span><span class="sxs-lookup"><span data-stu-id="3985a-132">Call [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose) to close the message.</span></span>

<span data-ttu-id="3985a-133">Para obter um exemplo que implementa essas etapas, consulte [exemplo C programa: codificação e decodificação de dados](example-c-program-encoding-and-decoding-data.md).</span><span class="sxs-lookup"><span data-stu-id="3985a-133">For an example that implements these steps, see [Example C Program: Encoding and Decoding Data](example-c-program-encoding-and-decoding-data.md).</span></span> <span data-ttu-id="3985a-134">Para obter procedimentos e um exemplo demonstrando o processo de codificação, decodificação e verificação da assinatura de uma mensagem assinada, consulte [exemplo C programa: assinatura, codificação, decodificação e verificação de uma mensagem](example-c-program-signing-encoding-decoding-and-verifying-a-message.md).</span><span class="sxs-lookup"><span data-stu-id="3985a-134">For procedures and an example demonstrating the process of encoding, decoding, and verifying the signature of a signed message, see [Example C Program: Signing, Encoding, Decoding, and Verifying a Message](example-c-program-signing-encoding-decoding-and-verifying-a-message.md).</span></span>

 

 
