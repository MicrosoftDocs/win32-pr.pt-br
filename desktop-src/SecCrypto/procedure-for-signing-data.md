---
description: Mostra a relação entre os parâmetros de função que apontam para estruturas ou matrizes e seus dados inicializados.
ms.assetid: 89caf4d3-727f-472b-9a09-e81b4ff4d127
title: Procedimento para assinar dados
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ba289928ab39c690e1c44bdbf65c77c18b7edab3
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "105792673"
---
# <a name="procedure-for-signing-data"></a><span data-ttu-id="a5522-103">Procedimento para assinar dados</span><span class="sxs-lookup"><span data-stu-id="a5522-103">Procedure for Signing Data</span></span>

<span data-ttu-id="a5522-104">Uma única função, [**CryptSignMessage**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptsignmessage), executa todas as tarefas listadas em [criando uma mensagem assinada](creating-a-signed-message.md).</span><span class="sxs-lookup"><span data-stu-id="a5522-104">A single function, [**CryptSignMessage**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptsignmessage), performs all of the tasks listed in [Creating a Signed Message](creating-a-signed-message.md).</span></span> <span data-ttu-id="a5522-105">No entanto, a inicialização de estruturas e outros dados ainda é necessária.</span><span class="sxs-lookup"><span data-stu-id="a5522-105">However, initialization of structures and other data is still necessary.</span></span> <span data-ttu-id="a5522-106">A ilustração a seguir mostra a relação entre os parâmetros de função que apontam para estruturas ou matrizes e seus dados inicializados.</span><span class="sxs-lookup"><span data-stu-id="a5522-106">The following illustration shows the relationship between those function parameters that point to structures or arrays and their initialized data.</span></span> <span data-ttu-id="a5522-107">A ilustração mostra apenas os parâmetros de função e membros de estrutura que são derivados de outras estruturas ou funções.</span><span class="sxs-lookup"><span data-stu-id="a5522-107">The illustration shows only the function parameters and structure members that are derived from other structures or functions.</span></span> <span data-ttu-id="a5522-108">O restante dos parâmetros são inicializações simples.</span><span class="sxs-lookup"><span data-stu-id="a5522-108">The rest of the parameters are straightforward initializations.</span></span>

![mapa de inicialização para uma chamada para CryptSignMessage](images/crypsign.png)

<span data-ttu-id="a5522-110">**Para assinar dados usando o CryptSignMessage**</span><span class="sxs-lookup"><span data-stu-id="a5522-110">**To sign data using CryptSignMessage**</span></span>

1.  <span data-ttu-id="a5522-111">Obtenha um ponteiro para os dados que serão assinados.</span><span class="sxs-lookup"><span data-stu-id="a5522-111">Get a pointer to the data that is to be signed.</span></span>
2.  <span data-ttu-id="a5522-112">Atribua o ponteiro aos dados para indexar zero de uma matriz de "dados a serem assinados".</span><span class="sxs-lookup"><span data-stu-id="a5522-112">Assign the pointer to the data to index zero of a "data to be signed" array.</span></span>
3.  <span data-ttu-id="a5522-113">Obtenha um identificador para o provedor criptográfico.</span><span class="sxs-lookup"><span data-stu-id="a5522-113">Get a handle to the cryptographic provider.</span></span>
4.  <span data-ttu-id="a5522-114">Abra um [*repositório de certificados*](../secgloss/c-gly.md) que contenha o certificado do signatário.</span><span class="sxs-lookup"><span data-stu-id="a5522-114">Open a [*certificate store*](../secgloss/c-gly.md) that contains the signer's certificate.</span></span>
5.  <span data-ttu-id="a5522-115">Obtenha um endereço para o certificado do Assinante.</span><span class="sxs-lookup"><span data-stu-id="a5522-115">Get an address to the signer's certificate.</span></span>
6.  <span data-ttu-id="a5522-116">Atribua o endereço do certificado ao índice zero da matriz *MsgCert* .</span><span class="sxs-lookup"><span data-stu-id="a5522-116">Assign the address of the certificate to the zero index of the *MsgCert* array.</span></span>
7.  <span data-ttu-id="a5522-117">Atribua os endereços de quaisquer outros certificados a serem incluídos com a mensagem para a matriz *MsgCert* .</span><span class="sxs-lookup"><span data-stu-id="a5522-117">Assign the addresses of any other certificates to be included with the message to the *MsgCert* array.</span></span>
8.  <span data-ttu-id="a5522-118">Inicialize a estrutura do [**\_ \_ identificador do algoritmo cript**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_algorithm_identifier) , inicializando o membro **pszObjId** para o algoritmo de hash desejado e os outros membros, conforme apropriado.</span><span class="sxs-lookup"><span data-stu-id="a5522-118">Initialize the [**CRYPT\_ALGORITHM\_IDENTIFIER**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_algorithm_identifier) structure, initializing the **pszObjId** member to the desired hash algorithm and the other members as appropriate.</span></span>
9.  <span data-ttu-id="a5522-119">Inicialize a estrutura de [**\_ \_ mensagens \_ de sinal cript**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_sign_message_para) , inicializando o membro **pSigningCert** para o endereço do certificado do signatário, o membro da matriz **MsgCert** para o endereço dos certificados do signatário e outros, o membro **HashAlgorithm** para o endereço da estrutura [**do \_ \_ identificador do algoritmo cript**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_algorithm_identifier) e os outros membros, conforme apropriado.</span><span class="sxs-lookup"><span data-stu-id="a5522-119">Initialize the [**CRYPT\_SIGN\_MESSAGE\_PARA**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_sign_message_para) structure, initializing the **pSigningCert** member to the address of the signer's certificate, the **MsgCert** array member to the address of the signer's and other's certificates, the **HashAlgorithm** member to the address of the [**CRYPT\_ALGORITHM\_IDENTIFIER**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_algorithm_identifier) structure, and the other members as appropriate.</span></span>
10. <span data-ttu-id="a5522-120">Chame a função [**CryptSignMessage**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptsignmessage) , passando a estrutura para [**\_ \_ mensagem \_ de sinal cript**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_sign_message_para) para o parâmetro *pSignPara* , o endereço da matriz "dados a serem assinados" para o parâmetro *rgpbToBeSigned* , um endereço para o parâmetro de saída *pbSignedBlob* e valores para os outros parâmetros, conforme apropriado.</span><span class="sxs-lookup"><span data-stu-id="a5522-120">Call the [**CryptSignMessage**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptsignmessage) function, passing the [**CRYPT\_SIGN\_MESSAGE\_PARA**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_sign_message_para) structure for the *pSignPara* parameter, the address of the "data to be signed" array for the *rgpbToBeSigned* parameter, an address for the *pbSignedBlob* output parameter, and values for the other parameters as appropriate.</span></span>

 

 
