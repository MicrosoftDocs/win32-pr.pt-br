---
description: Descreve as tarefas necessárias para codificar uma mensagem com hash.
ms.assetid: c1a65452-c634-4cc6-9afe-d6bf11d999d1
title: Codificando e decodificando uma mensagem com hash
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d91d165634c1ae00a59f2c77b1fc5a36b53dbd96
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "105766827"
---
# <a name="encoding-and-decoding-a-hashed-message"></a><span data-ttu-id="552bc-103">Codificando e decodificando uma mensagem com hash</span><span class="sxs-lookup"><span data-stu-id="552bc-103">Encoding and Decoding a Hashed Message</span></span>

<span data-ttu-id="552bc-104">Os dados com hash consistem em conteúdo de qualquer tipo e [*hash*](../secgloss/h-gly.md) do conteúdo.</span><span class="sxs-lookup"><span data-stu-id="552bc-104">Hashed data consists of content of any type and a [*hash*](../secgloss/h-gly.md) of the content.</span></span> <span data-ttu-id="552bc-105">Ele pode ser usado quando for necessário apenas confirmar que o conteúdo da mensagem não foi modificado desde que o hash foi criado.</span><span class="sxs-lookup"><span data-stu-id="552bc-105">It can be used when it is only necessary to confirm that the message content has not been modified since the hash was created.</span></span>

<span data-ttu-id="552bc-106">Ao criar uma mensagem com hash, pode haver vários algoritmos de hash e vários hashes.</span><span class="sxs-lookup"><span data-stu-id="552bc-106">When creating a hashed message, there can be multiple hash algorithms and multiple hashes.</span></span> <span data-ttu-id="552bc-107">A ilustração a seguir ilustra as tarefas necessárias para codificar uma mensagem com hash.</span><span class="sxs-lookup"><span data-stu-id="552bc-107">The following illustration depicts the tasks required to encode a hashed message.</span></span> <span data-ttu-id="552bc-108">O procedimento é descrito no texto que segue a ilustração.</span><span class="sxs-lookup"><span data-stu-id="552bc-108">The procedure is described in the text that follows the illustration.</span></span>

![Criando uma mensagem com hash](images/hashmsg.png)

<span data-ttu-id="552bc-110">**Para criar uma mensagem com hash**</span><span class="sxs-lookup"><span data-stu-id="552bc-110">**To create a hashed message**</span></span>

1.  <span data-ttu-id="552bc-111">Obtenha um ponteiro para os dados a serem codificados em hash.</span><span class="sxs-lookup"><span data-stu-id="552bc-111">Get a pointer to the data to be hashed.</span></span>
2.  <span data-ttu-id="552bc-112">Selecione o algoritmo de hash a ser usado.</span><span class="sxs-lookup"><span data-stu-id="552bc-112">Select the hash algorithm to be used.</span></span>
3.  <span data-ttu-id="552bc-113">Coloque os dados por meio de uma função de hash usando o algoritmo de hash.</span><span class="sxs-lookup"><span data-stu-id="552bc-113">Put the data through a hashing function using the hash algorithm.</span></span>
4.  <span data-ttu-id="552bc-114">Inclua os dados originais para serem codificados em hash, os algoritmos de hash e os hashes na mensagem codificada.</span><span class="sxs-lookup"><span data-stu-id="552bc-114">Include the original data to be hashed, the hashing algorithms, and the hashes in the encoded message.</span></span>

<span data-ttu-id="552bc-115">Para usar funções de mensagens de nível baixo para realizar as tarefas que acabaram de ser descritas, use o procedimento a seguir.</span><span class="sxs-lookup"><span data-stu-id="552bc-115">To use low-level message functions to accomplish the tasks just outlined, use the following procedure.</span></span>

<span data-ttu-id="552bc-116">**Para aplicar o hash e codificar uma mensagem usando funções de mensagens de nível baixo**</span><span class="sxs-lookup"><span data-stu-id="552bc-116">**To hash and encode a message using low-level message functions**</span></span>

1.  <span data-ttu-id="552bc-117">Crie ou recupere o conteúdo a ser transformado em hash.</span><span class="sxs-lookup"><span data-stu-id="552bc-117">Create or retrieve the content to be hashed.</span></span>
2.  <span data-ttu-id="552bc-118">Obter um provedor criptográfico.</span><span class="sxs-lookup"><span data-stu-id="552bc-118">Get a cryptographic provider.</span></span>
3.  <span data-ttu-id="552bc-119">Inicialize a estrutura de [**informações de codificação com hash de CMSG \_ \_ \_**](/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_hashed_encode_info) .</span><span class="sxs-lookup"><span data-stu-id="552bc-119">Initialize the [**CMSG\_HASHED\_ENCODE\_INFO**](/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_hashed_encode_info) structure.</span></span>
4.  <span data-ttu-id="552bc-120">Chame [**CryptMsgCalculateEncodedLength**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcalculateencodedlength) para obter o tamanho do blob de mensagens codificadas.</span><span class="sxs-lookup"><span data-stu-id="552bc-120">Call [**CryptMsgCalculateEncodedLength**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcalculateencodedlength) to get the size of the encoded message BLOB.</span></span> <span data-ttu-id="552bc-121">Aloque memória para ele.</span><span class="sxs-lookup"><span data-stu-id="552bc-121">Allocate memory for it.</span></span>
5.  <span data-ttu-id="552bc-122">Chame [**CryptMsgOpenToEncode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentoencode), passando CMSG \_ com hash para o parâmetro *dwMsgType* e um ponteiro para [**CMSG \_ \_ \_ informações de codificação com hash**](/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_hashed_encode_info) para o parâmetro *pvMsgEncodeInfo* .</span><span class="sxs-lookup"><span data-stu-id="552bc-122">Call [**CryptMsgOpenToEncode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentoencode), passing in CMSG\_HASHED for the *dwMsgType* parameter and a pointer to [**CMSG\_HASHED\_ENCODE\_INFO**](/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_hashed_encode_info) for the *pvMsgEncodeInfo* parameter.</span></span> <span data-ttu-id="552bc-123">Como resultado dessa chamada, você obtém um identificador para a mensagem aberta.</span><span class="sxs-lookup"><span data-stu-id="552bc-123">As a result of this call, you get a handle to the opened message.</span></span>
6.  <span data-ttu-id="552bc-124">Chame [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate), passando o identificador recuperado na etapa 5 e um ponteiro para os dados que serão codificados em hash e codificado.</span><span class="sxs-lookup"><span data-stu-id="552bc-124">Call [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate), passing in the handle retrieved in step 5 and a pointer to the data that is to be hashed and encoded.</span></span> <span data-ttu-id="552bc-125">Essa função pode ser chamada quantas vezes forem necessárias para concluir o processo de codificação.</span><span class="sxs-lookup"><span data-stu-id="552bc-125">This function can be called as many times as necessary to complete the encoding process.</span></span>
7.  <span data-ttu-id="552bc-126">Chame [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam), passando o identificador recuperado na etapa 5 e os tipos de parâmetro apropriados para acessar os dados desejados e codificados.</span><span class="sxs-lookup"><span data-stu-id="552bc-126">Call [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam), passing in the handle retrieved in step 5 and the appropriate parameter types to access the desired, encoded data.</span></span> <span data-ttu-id="552bc-127">Por exemplo, passe \_ o parâmetro de conteúdo CMSG \_ para obter um ponteiro para toda a mensagem [*PKCS \# 7*](../secgloss/p-gly.md) .</span><span class="sxs-lookup"><span data-stu-id="552bc-127">For example, pass in CMSG\_CONTENT\_PARAM to get a pointer to the entire [*PKCS \#7*](../secgloss/p-gly.md) message.</span></span>

    <span data-ttu-id="552bc-128">Se o resultado dessa codificação for ser usado como os [*dados internos*](../secgloss/i-gly.md) de outra mensagem codificada, como uma mensagem envelopada, o \_ parâmetro CMSG Bare \_ Content \_ deverá ser passado.</span><span class="sxs-lookup"><span data-stu-id="552bc-128">If the result of this encoding is to be used as the [*inner data*](../secgloss/i-gly.md) for another encoded message, such as an enveloped message, CMSG\_BARE\_CONTENT\_PARAM must be passed.</span></span> <span data-ttu-id="552bc-129">Para ver um exemplo que mostra isso, consulte [código alternativo para codificar uma mensagem envelopada](alternate-code-for-encoding-an-enveloped-message.md).</span><span class="sxs-lookup"><span data-stu-id="552bc-129">For an example showing this, see [Alternate Code for Encoding an Enveloped Message](alternate-code-for-encoding-an-enveloped-message.md).</span></span>

8.  <span data-ttu-id="552bc-130">Feche a mensagem chamando [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose).</span><span class="sxs-lookup"><span data-stu-id="552bc-130">Close the message by calling [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose).</span></span>

<span data-ttu-id="552bc-131">O resultado desse procedimento é uma mensagem codificada que contém os dados originais, os algoritmos de hash e o [*hash*](../secgloss/h-gly.md) desses dados.</span><span class="sxs-lookup"><span data-stu-id="552bc-131">The result of this procedure is an encoded message that contains the original data, the hashing algorithms, and the [*hash*](../secgloss/h-gly.md) of that data.</span></span> <span data-ttu-id="552bc-132">Um ponteiro para o [*blob*](../secgloss/b-gly.md) de mensagens codificadas é obtido na etapa 7.</span><span class="sxs-lookup"><span data-stu-id="552bc-132">A pointer to the encoded message [*BLOB*](../secgloss/b-gly.md) is obtained in step 7.</span></span>

<span data-ttu-id="552bc-133">Os dois procedimentos a seguir decodificam e, em seguida, verificam os dados com hash.</span><span class="sxs-lookup"><span data-stu-id="552bc-133">The following two procedures decode and then verify hashed data.</span></span>

<span data-ttu-id="552bc-134">**Para decodificar dados com hash**</span><span class="sxs-lookup"><span data-stu-id="552bc-134">**To decode hashed data**</span></span>

1.  <span data-ttu-id="552bc-135">Obtenha um ponteiro para o BLOB codificado.</span><span class="sxs-lookup"><span data-stu-id="552bc-135">Get a pointer to the encoded BLOB.</span></span>
2.  <span data-ttu-id="552bc-136">Chame [**CryptMsgOpenToDecode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentodecode), passando os argumentos necessários.</span><span class="sxs-lookup"><span data-stu-id="552bc-136">Call [**CryptMsgOpenToDecode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentodecode), passing the necessary arguments.</span></span>
3.  <span data-ttu-id="552bc-137">Chame [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) uma vez, passando o identificador recuperado na etapa 2 e um ponteiro para os dados que serão decodificados.</span><span class="sxs-lookup"><span data-stu-id="552bc-137">Call [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) once, passing in the handle retrieved in step 2 and a pointer to the data that is to be decoded.</span></span> <span data-ttu-id="552bc-138">Isso faz com que as ações apropriadas sejam executadas na mensagem, dependendo do tipo de mensagem.</span><span class="sxs-lookup"><span data-stu-id="552bc-138">This causes the appropriate actions to be taken on the message, depending on the message type.</span></span>
4.  <span data-ttu-id="552bc-139">Chame [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam), passando o identificador recuperado na etapa 2 e os tipos de parâmetro apropriados para acessar os dados decodificados desejados.</span><span class="sxs-lookup"><span data-stu-id="552bc-139">Call [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam), passing in the handle retrieved in step 2, and the appropriate parameter types to access the desired, decoded data.</span></span> <span data-ttu-id="552bc-140">Por exemplo, passe \_ o parâmetro de conteúdo CMSG \_ para obter um ponteiro para o conteúdo decodificado.</span><span class="sxs-lookup"><span data-stu-id="552bc-140">For example, pass in CMSG\_CONTENT\_PARAM to get a pointer to the decoded content.</span></span>

<span data-ttu-id="552bc-141">**Para verificar o hash**</span><span class="sxs-lookup"><span data-stu-id="552bc-141">**To verify the hash**</span></span>

1.  <span data-ttu-id="552bc-142">Chame [**CryptMsgControl**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcontrol), passando CMSG \_ Ctrl \_ Verify \_ hash para verificar os hashes.</span><span class="sxs-lookup"><span data-stu-id="552bc-142">Call [**CryptMsgControl**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcontrol), passing in CMSG\_CTRL\_VERIFY\_HASH to verify the hashes.</span></span>
2.  <span data-ttu-id="552bc-143">Chame [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose) para fechar a mensagem.</span><span class="sxs-lookup"><span data-stu-id="552bc-143">Call [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose) to close the message.</span></span>

<span data-ttu-id="552bc-144">Para um programa de exemplo, consulte [exemplo C programa: codificando e decodificando uma mensagem com hash](example-c-program-encoding-and-decoding-a-hashed-message.md).</span><span class="sxs-lookup"><span data-stu-id="552bc-144">For an example program, see [Example C Program: Encoding and Decoding a Hashed Message](example-c-program-encoding-and-decoding-a-hashed-message.md).</span></span>

 

 
