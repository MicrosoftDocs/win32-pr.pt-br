---
title: Usando informações de versão
description: Este tópico discute como usar as funções de informações de versão.
ms.assetid: 447b57c9-9e94-4a28-897e-f7b87d9cb25a
keywords:
- recursos, informações de versão
- informações de versão
- informações do arquivo de instalação
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1a8785275f5aac69218989250d1c0f83e0a1ff9f
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/19/2020
ms.locfileid: "103640638"
---
# <a name="using-version-information"></a><span data-ttu-id="ce420-106">Usando informações de versão</span><span class="sxs-lookup"><span data-stu-id="ce420-106">Using Version Information</span></span>

<span data-ttu-id="ce420-107">Um programa de instalação normalmente tem os seguintes objetivos:</span><span class="sxs-lookup"><span data-stu-id="ce420-107">An installation program typically has the following goals:</span></span>

-   <span data-ttu-id="ce420-108">Para posicionar arquivos no local correto.</span><span class="sxs-lookup"><span data-stu-id="ce420-108">To place files in the correct location.</span></span>
-   <span data-ttu-id="ce420-109">Para notificar o usuário se o programa de instalação está substituindo um arquivo existente por uma versão que seja significativamente diferente — por exemplo, substituindo um arquivo em idioma alemão por um arquivo em inglês ou substituindo um arquivo mais recente por um arquivo mais antigo.</span><span class="sxs-lookup"><span data-stu-id="ce420-109">To notify the user if the installation program is replacing an existing file with a version that is significantly different—for example, replacing a German-language file with an English-language file, or replacing a newer file with an older file.</span></span>

<span data-ttu-id="ce420-110">Ao escrever o programa de instalação, você deve ter as seguintes informações para cada arquivo:</span><span class="sxs-lookup"><span data-stu-id="ce420-110">When writing the installation program, you must have the following information for each file:</span></span>

-   <span data-ttu-id="ce420-111">O nome e o local do arquivo (chamado de arquivo de origem).</span><span class="sxs-lookup"><span data-stu-id="ce420-111">The name and location of the file (referred to as the source file).</span></span>
-   <span data-ttu-id="ce420-112">O nome do arquivo equivalente no disco rígido do usuário (chamado de arquivo de destino).</span><span class="sxs-lookup"><span data-stu-id="ce420-112">The name of the equivalent file on the user's hard disk (referred to as the destination file).</span></span> <span data-ttu-id="ce420-113">Esse nome é geralmente o mesmo que o nome de arquivo no disco de instalação.</span><span class="sxs-lookup"><span data-stu-id="ce420-113">This name is usually the same as the filename on the installation disk.</span></span>
-   <span data-ttu-id="ce420-114">O status de compartilhamento do arquivo — ou seja, se o arquivo é privado para o aplicativo que está sendo instalado ou pode ser compartilhado por vários aplicativos.</span><span class="sxs-lookup"><span data-stu-id="ce420-114">The sharing status of the file—that is, whether the file is private to the application being installed or could be shared by multiple applications.</span></span>

<span data-ttu-id="ce420-115">O programa de instalação pode usar a função [**VerFindFile**](/windows/desktop/api/Winver/nf-winver-verfindfilea) para determinar onde o arquivo deve ser copiado no disco.</span><span class="sxs-lookup"><span data-stu-id="ce420-115">The installation program can use the [**VerFindFile**](/windows/desktop/api/Winver/nf-winver-verfindfilea) function to determine where the file should be copied on the disk.</span></span> <span data-ttu-id="ce420-116">Essa função também pode ser usada para especificar se o arquivo é privado para o aplicativo ou pode ser compartilhado.</span><span class="sxs-lookup"><span data-stu-id="ce420-116">This function can also be used to specify whether the file is private to the application or can be shared.</span></span> <span data-ttu-id="ce420-117">Se ocorrer um problema ao localizar o arquivo, **VerFindFile** retornará um valor de erro.</span><span class="sxs-lookup"><span data-stu-id="ce420-117">If a problem occurs in finding the file, **VerFindFile** returns an error value.</span></span> <span data-ttu-id="ce420-118">Por exemplo, se o sistema estiver usando o arquivo de destino, **VerFindFile** retornará **VFF \_ FILEINUSE**.</span><span class="sxs-lookup"><span data-stu-id="ce420-118">For example, if the system is using the destination file, **VerFindFile** returns **VFF\_FILEINUSE**.</span></span> <span data-ttu-id="ce420-119">O programa de instalação deve notificar o usuário sobre o problema e responder à decisão do usuário para continuar ou para encerrar a instalação.</span><span class="sxs-lookup"><span data-stu-id="ce420-119">The installation program must notify the user of the problem and respond to the user's decision to continue or to end the installation.</span></span>

<span data-ttu-id="ce420-120">A função [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) copia o arquivo de origem para um arquivo temporário no diretório especificado por [**VerFindFile**](/windows/desktop/api/Winver/nf-winver-verfindfilea).</span><span class="sxs-lookup"><span data-stu-id="ce420-120">The [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) function copies the source file to a temporary file in the directory specified by [**VerFindFile**](/windows/desktop/api/Winver/nf-winver-verfindfilea).</span></span> <span data-ttu-id="ce420-121">Se necessário, **VerInstallFile** expande o arquivo usando as funções na biblioteca de descompactação de dados.</span><span class="sxs-lookup"><span data-stu-id="ce420-121">If necessary, **VerInstallFile** expands the file by using the functions in the data decompression library.</span></span>

<span data-ttu-id="ce420-122">[**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) compara as informações de versão do arquivo temporário para o do arquivo de destino.</span><span class="sxs-lookup"><span data-stu-id="ce420-122">[**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) compares the version information of the temporary file to that of the destination file.</span></span> <span data-ttu-id="ce420-123">Se os dois forem diferentes, **VerInstallFile** retornará um ou mais valores de erro.</span><span class="sxs-lookup"><span data-stu-id="ce420-123">If the two differ, **VerInstallFile** returns one or more error values.</span></span> <span data-ttu-id="ce420-124">Por exemplo, ele retornará **VIF \_ SRCOLD** se o arquivo temporário for mais antigo que o arquivo de destino e **VIF \_ DIFFLANG** se os arquivos tiverem identificadores de idioma ou valores de página de código diferentes.</span><span class="sxs-lookup"><span data-stu-id="ce420-124">For example, it returns **VIF\_SRCOLD** if the temporary file is older than the destination file and **VIF\_DIFFLANG** if the files have different language identifiers or code-page values.</span></span> <span data-ttu-id="ce420-125">O programa de instalação deve notificar o usuário sobre o problema e responder à decisão do usuário para continuar ou para encerrar a instalação.</span><span class="sxs-lookup"><span data-stu-id="ce420-125">The installation program must notify the user of the problem and respond to the user's decision to continue or to end the installation.</span></span>

<span data-ttu-id="ce420-126">Alguns erros de [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) são recuperáveis.</span><span class="sxs-lookup"><span data-stu-id="ce420-126">Some [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) errors are recoverable.</span></span> <span data-ttu-id="ce420-127">Ou seja, o programa de instalação pode chamar **VerInstallFile** novamente, especificando a opção **VIFF \_ forceinstall** , para instalar o arquivo, independentemente do conflito de versão.</span><span class="sxs-lookup"><span data-stu-id="ce420-127">That is, the installation program can call **VerInstallFile** again, specifying the **VIFF\_FORCEINSTALL** option, to install the file regardless of the version conflict.</span></span> <span data-ttu-id="ce420-128">Se **VerInstallFile** retornar **VIF \_ tempfile** e o usuário optar por não forçar a instalação, o programa de instalação deverá excluir o arquivo temporário.</span><span class="sxs-lookup"><span data-stu-id="ce420-128">If **VerInstallFile** returns **VIF\_TEMPFILE** and the user chooses not to force the installation, the installation program should delete the temporary file.</span></span>

<span data-ttu-id="ce420-129">[**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) pode encontrar um erro não recuperável ao tentar forçar a instalação, mesmo que o erro não existisse anteriormente.</span><span class="sxs-lookup"><span data-stu-id="ce420-129">[**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) could encounter a nonrecoverable error when attempting to force installation, even though the error did not exist previously.</span></span> <span data-ttu-id="ce420-130">Por exemplo, o arquivo pode ser bloqueado por outro usuário antes de o programa de instalação tentar forçar a instalação.</span><span class="sxs-lookup"><span data-stu-id="ce420-130">For example, the file could be locked by another user before the installation program attempted to force installation.</span></span> <span data-ttu-id="ce420-131">Se um programa de instalação tentar forçar a instalação após um erro não recuperável, **VerInstallFile** falhará.</span><span class="sxs-lookup"><span data-stu-id="ce420-131">If an installation program attempts to force installation after a non-recoverable error, **VerInstallFile** fails.</span></span> <span data-ttu-id="ce420-132">O programa de instalação deve conter rotinas para se recuperar desse tipo de erro.</span><span class="sxs-lookup"><span data-stu-id="ce420-132">The installation program must contain routines to recover from this type of error.</span></span>

<span data-ttu-id="ce420-133">A solução recomendada é exibir uma caixa de diálogo com os botões **instalar**, **ignorar** e **instalar tudo**.</span><span class="sxs-lookup"><span data-stu-id="ce420-133">The recommended solution is to display a dialog box with the buttons **Install**, **Skip**, and **Install All**.</span></span> <span data-ttu-id="ce420-134">(Outra solução é uma caixa de diálogo com os botões **Sim**, **Sim para todos**, **ignorar** e **Cancelar**.) O botão **instalar tudo** deve impedir que o programa de instalação solicite ao usuário erros semelhantes, incluindo a opção **VIFF \_ forceinstall** em todos os usos subsequentes de [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea).</span><span class="sxs-lookup"><span data-stu-id="ce420-134">(Another solution is a dialog box with the buttons **Yes**, **Yes to All**, **Skip**, and **Cancel**.) The **Install All** button should prevent the installation program from prompting the user about similar errors by including the **VIFF\_FORCEINSTALL** option in all subsequent uses of [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea).</span></span> <span data-ttu-id="ce420-135">Para erros não recuperáveis, os botões **instalar** e **instalar tudo** devem ser desabilitados.</span><span class="sxs-lookup"><span data-stu-id="ce420-135">For nonrecoverable errors, the **Install** and **Install All** buttons should be disabled.</span></span>

<span data-ttu-id="ce420-136">Para exibir uma mensagem de erro útil para o usuário, o programa de instalação geralmente deve recuperar informações dos recursos de versão dos arquivos conflitantes.</span><span class="sxs-lookup"><span data-stu-id="ce420-136">To display a useful error message to the user, the installation program usually must retrieve information from the version resources of the conflicting files.</span></span> <span data-ttu-id="ce420-137">Há quatro funções que o programa de instalação pode usar para essa finalidade:</span><span class="sxs-lookup"><span data-stu-id="ce420-137">There are four functions the installation program can use for this purpose:</span></span>

-   [<span data-ttu-id="ce420-138">**Falha em GetFileVersionInfoSize**</span><span class="sxs-lookup"><span data-stu-id="ce420-138">**GetFileVersionInfoSize**</span></span>](/windows/desktop/api/Winver/nf-winver-getfileversioninfosizea)
-   [<span data-ttu-id="ce420-139">**GetFileVersionInfo**</span><span class="sxs-lookup"><span data-stu-id="ce420-139">**GetFileVersionInfo**</span></span>](/windows/desktop/api/Winver/nf-winver-getfileversioninfoa)
-   [<span data-ttu-id="ce420-140">**VerQueryValue**</span><span class="sxs-lookup"><span data-stu-id="ce420-140">**VerQueryValue**</span></span>](/windows/desktop/api/Winver/nf-winver-verqueryvaluea)
-   [<span data-ttu-id="ce420-141">**VerLanguageName**</span><span class="sxs-lookup"><span data-stu-id="ce420-141">**VerLanguageName**</span></span>](/windows/desktop/api/Winver/nf-winver-verlanguagenamea)

<span data-ttu-id="ce420-142">[**Falha em GetFileVersionInfoSize**](/windows/desktop/api/Winver/nf-winver-getfileversioninfosizea) retorna o tamanho das informações de versão.</span><span class="sxs-lookup"><span data-stu-id="ce420-142">[**GetFileVersionInfoSize**](/windows/desktop/api/Winver/nf-winver-getfileversioninfosizea) returns the size of the version information.</span></span> <span data-ttu-id="ce420-143">[**GetFileVersionInfo**](/windows/desktop/api/Winver/nf-winver-getfileversioninfoa) usa informações recuperadas por **falha em GetFileVersionInfoSize** para recuperar uma estrutura que contém as informações de versão.</span><span class="sxs-lookup"><span data-stu-id="ce420-143">[**GetFileVersionInfo**](/windows/desktop/api/Winver/nf-winver-getfileversioninfoa) uses information retrieved by **GetFileVersionInfoSize** to retrieve a structure that contains the version information.</span></span> <span data-ttu-id="ce420-144">[**VerQueryValue**](/windows/desktop/api/Winver/nf-winver-verqueryvaluea) recupera um membro específico dessa estrutura.</span><span class="sxs-lookup"><span data-stu-id="ce420-144">[**VerQueryValue**](/windows/desktop/api/Winver/nf-winver-verqueryvaluea) retrieves a specific member from that structure.</span></span>

<span data-ttu-id="ce420-145">Por exemplo, se [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) retornar o **erro \_ VIF DiffType** , o programa de instalação deverá usar as funções [**falha em GetFileVersionInfoSize**](/windows/desktop/api/Winver/nf-winver-getfileversioninfosizea), [**GetFileVersionInfo**](/windows/desktop/api/Winver/nf-winver-getfileversioninfoa)e [**VerQueryValue**](/windows/desktop/api/Winver/nf-winver-verqueryvaluea) nos arquivos temporários e de destino para obter o tipo geral de cada arquivo.</span><span class="sxs-lookup"><span data-stu-id="ce420-145">For example, if [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) returns the **VIF\_DIFFTYPE** error, the installation program should use the [**GetFileVersionInfoSize**](/windows/desktop/api/Winver/nf-winver-getfileversioninfosizea), [**GetFileVersionInfo**](/windows/desktop/api/Winver/nf-winver-getfileversioninfoa), and [**VerQueryValue**](/windows/desktop/api/Winver/nf-winver-verqueryvaluea) functions on the temporary and destination files to obtain the general type of each file.</span></span> <span data-ttu-id="ce420-146">Se os idiomas dos arquivos entrarem em conflito, o programa de instalação também deverá usar o [**VerLanguageName**](/windows/desktop/api/Winver/nf-winver-verlanguagenamea) para converter o identificador de idioma binário em uma representação de texto do idioma.</span><span class="sxs-lookup"><span data-stu-id="ce420-146">If the languages of the files conflict, the installation program should also use [**VerLanguageName**](/windows/desktop/api/Winver/nf-winver-verlanguagenamea) to translate the binary language identifier into a text representation of the language.</span></span> <span data-ttu-id="ce420-147">(Por exemplo, 0x040C é traduzido para a cadeia de caracteres "francês.")</span><span class="sxs-lookup"><span data-stu-id="ce420-147">(For example, 0x040C translates to the string "French.")</span></span>

<span data-ttu-id="ce420-148">Se [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) retornar um erro de arquivo, como **VIF \_ ACCESSVIOLATION**, o programa de instalação deverá usar a função [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) para recuperar o valor de erro mais recente.</span><span class="sxs-lookup"><span data-stu-id="ce420-148">If [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) returns a file error, such as **VIF\_ACCESSVIOLATION**, the installation program should use the [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) function to retrieve the most recent error value.</span></span> <span data-ttu-id="ce420-149">O programa deve converter esse valor em uma mensagem informativa para exibir para o usuário.</span><span class="sxs-lookup"><span data-stu-id="ce420-149">The program should translate this value into an informative message to display to the user.</span></span> <span data-ttu-id="ce420-150">O programa não deve produzir controle entre as chamadas para **VerInstallFile** e **GetLastError**.</span><span class="sxs-lookup"><span data-stu-id="ce420-150">The program must not yield control between the calls to **VerInstallFile** and **GetLastError**.</span></span>

 

 