---
description: 'O encerramento de um thread tem os seguintes resultados: todos os recursos pertencentes ao thread, como Windows e ganchos, são liberados. O código de saída do thread está definido. O objeto de thread é sinalizado. Se o thread for o único thread ativo no processo, o processo será encerrado. Para obter mais informações, consulte finalizando um processo.'
ms.assetid: 633e5d0c-e9d8-4f9a-9411-17cbe9e2e6e4
title: Finalizando um thread
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ada421356666316072aabff8281787cc140ad114
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105759606"
---
# <a name="terminating-a-thread"></a><span data-ttu-id="41ffb-104">Finalizando um thread</span><span class="sxs-lookup"><span data-stu-id="41ffb-104">Terminating a Thread</span></span>

<span data-ttu-id="41ffb-105">O encerramento de um thread tem os seguintes resultados:</span><span class="sxs-lookup"><span data-stu-id="41ffb-105">Terminating a thread has the following results:</span></span>

-   <span data-ttu-id="41ffb-106">Todos os recursos pertencentes ao thread, como Windows e ganchos, são liberados.</span><span class="sxs-lookup"><span data-stu-id="41ffb-106">Any resources owned by the thread, such as windows and hooks, are freed.</span></span>
-   <span data-ttu-id="41ffb-107">O código de saída do thread está definido.</span><span class="sxs-lookup"><span data-stu-id="41ffb-107">The thread exit code is set.</span></span>
-   <span data-ttu-id="41ffb-108">O objeto de thread é sinalizado.</span><span class="sxs-lookup"><span data-stu-id="41ffb-108">The thread object is signaled.</span></span>
-   <span data-ttu-id="41ffb-109">Se o thread for o único thread ativo no processo, o processo será encerrado.</span><span class="sxs-lookup"><span data-stu-id="41ffb-109">If the thread is the only active thread in the process, the process is terminated.</span></span> <span data-ttu-id="41ffb-110">Para obter mais informações, consulte [finalizando um processo](terminating-a-process.md).</span><span class="sxs-lookup"><span data-stu-id="41ffb-110">For more information, see [Terminating a Process](terminating-a-process.md).</span></span>

<span data-ttu-id="41ffb-111">A função [**GetExitCodeThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getexitcodethread) retorna o status de encerramento de um thread.</span><span class="sxs-lookup"><span data-stu-id="41ffb-111">The [**GetExitCodeThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getexitcodethread) function returns the termination status of a thread.</span></span> <span data-ttu-id="41ffb-112">Enquanto um thread estiver em execução, seu status de encerramento ainda estará \_ ativo.</span><span class="sxs-lookup"><span data-stu-id="41ffb-112">While a thread is executing, its termination status is STILL\_ACTIVE.</span></span> <span data-ttu-id="41ffb-113">Quando um thread é encerrado, seu status de encerramento é alterado de ainda \_ ativo para o código de saída do thread.</span><span class="sxs-lookup"><span data-stu-id="41ffb-113">When a thread terminates, its termination status changes from STILL\_ACTIVE to the exit code of the thread.</span></span>

<span data-ttu-id="41ffb-114">Quando um thread é encerrado, o estado do objeto de thread muda para sinalizado, liberando quaisquer outros threads que estavam aguardando o encerramento do thread.</span><span class="sxs-lookup"><span data-stu-id="41ffb-114">When a thread terminates, the state of the thread object changes to signaled, releasing any other threads that had been waiting for the thread to terminate.</span></span> <span data-ttu-id="41ffb-115">Para obter mais informações sobre sincronização, consulte [sincronizando a execução de vários threads](synchronizing-execution-of-multiple-threads.md).</span><span class="sxs-lookup"><span data-stu-id="41ffb-115">For more about synchronization, see [Synchronizing Execution of Multiple Threads](synchronizing-execution-of-multiple-threads.md).</span></span>

<span data-ttu-id="41ffb-116">Quando um thread é encerrado, seu objeto de thread não é liberado até que todos os identificadores abertos para o thread sejam fechados.</span><span class="sxs-lookup"><span data-stu-id="41ffb-116">When a thread terminates, its thread object is not freed until all open handles to the thread are closed.</span></span>

## <a name="how-threads-are-terminated"></a><span data-ttu-id="41ffb-117">Como os threads são encerrados</span><span class="sxs-lookup"><span data-stu-id="41ffb-117">How Threads are Terminated</span></span>

<span data-ttu-id="41ffb-118">Um thread é executado até que ocorra um dos seguintes eventos:</span><span class="sxs-lookup"><span data-stu-id="41ffb-118">A thread executes until one of the following events occurs:</span></span>

-   <span data-ttu-id="41ffb-119">O thread chama a função [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread) .</span><span class="sxs-lookup"><span data-stu-id="41ffb-119">The thread calls the [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread) function.</span></span>
-   <span data-ttu-id="41ffb-120">Qualquer thread do processo chama a função [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) .</span><span class="sxs-lookup"><span data-stu-id="41ffb-120">Any thread of the process calls the [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) function.</span></span>
-   <span data-ttu-id="41ffb-121">A função thread retorna.</span><span class="sxs-lookup"><span data-stu-id="41ffb-121">The thread function returns.</span></span>
-   <span data-ttu-id="41ffb-122">Qualquer thread chama a função [**TerminateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminatethread) com um identificador para o thread.</span><span class="sxs-lookup"><span data-stu-id="41ffb-122">Any thread calls the [**TerminateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminatethread) function with a handle to the thread.</span></span>
-   <span data-ttu-id="41ffb-123">Qualquer thread chama a função [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess) com um identificador para o processo.</span><span class="sxs-lookup"><span data-stu-id="41ffb-123">Any thread calls the [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess) function with a handle to the process.</span></span>

<span data-ttu-id="41ffb-124">O código de saída de um thread é o valor especificado na chamada para [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread), [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess), [**TerminateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminatethread)ou [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess)ou o valor retornado pela função thread.</span><span class="sxs-lookup"><span data-stu-id="41ffb-124">The exit code for a thread is either the value specified in the call to [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread), [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess), [**TerminateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminatethread), or [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess), or the value returned by the thread function.</span></span>

<span data-ttu-id="41ffb-125">Se um thread for encerrado por [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread), o sistema chamará a função de ponto de entrada de cada DLL anexada com um valor indicando que o thread está desanexando da dll (a menos que você chame a função [**DisableThreadLibraryCalls**](/windows/win32/api/libloaderapi/nf-libloaderapi-disablethreadlibrarycalls) ).</span><span class="sxs-lookup"><span data-stu-id="41ffb-125">If a thread is terminated by [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread), the system calls the entry-point function of each attached DLL with a value indicating that the thread is detaching from the DLL (unless you call the [**DisableThreadLibraryCalls**](/windows/win32/api/libloaderapi/nf-libloaderapi-disablethreadlibrarycalls) function).</span></span> <span data-ttu-id="41ffb-126">Se um thread for encerrado por [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess), as funções de ponto de entrada de DLL serão invocadas uma vez, para indicar que o processo está sendo desanexado.</span><span class="sxs-lookup"><span data-stu-id="41ffb-126">If a thread is terminated by [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess), the DLL entry-point functions are invoked once, to indicate that the process is detaching.</span></span> <span data-ttu-id="41ffb-127">As DLLs não são notificadas quando um thread é encerrado por [**TerminateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminatethread) ou [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess).</span><span class="sxs-lookup"><span data-stu-id="41ffb-127">DLLs are not notified when a thread is terminated by [**TerminateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminatethread) or [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess).</span></span> <span data-ttu-id="41ffb-128">Para obter mais informações sobre DLLs, consulte [bibliotecas de vínculo dinâmico](../dlls/dynamic-link-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="41ffb-128">For more information about DLLs, see [Dynamic-Link Libraries](../dlls/dynamic-link-libraries.md).</span></span>

<span data-ttu-id="41ffb-129">As funções [**TerminateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminatethread) e [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess) devem ser usadas apenas em circunstâncias extremas, já que elas não permitem que os threads sejam limpos, não notifique as DLLs anexadas e não libere a pilha inicial.</span><span class="sxs-lookup"><span data-stu-id="41ffb-129">The [**TerminateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminatethread) and [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess) functions should be used only in extreme circumstances, since they do not allow threads to clean up, do not notify attached DLLs, and do not free the initial stack.</span></span> <span data-ttu-id="41ffb-130">Além disso, os identificadores para objetos pertencentes ao thread não são fechados até que o processo seja encerrado.</span><span class="sxs-lookup"><span data-stu-id="41ffb-130">In addition, handles to objects owned by the thread are not closed until the process terminates.</span></span> <span data-ttu-id="41ffb-131">As etapas a seguir fornecem uma solução melhor:</span><span class="sxs-lookup"><span data-stu-id="41ffb-131">The following steps provide a better solution:</span></span>

-   <span data-ttu-id="41ffb-132">Crie um objeto de evento usando a função [**CreateEvent**](/windows/win32/api/synchapi/nf-synchapi-createeventa) .</span><span class="sxs-lookup"><span data-stu-id="41ffb-132">Create an event object using the [**CreateEvent**](/windows/win32/api/synchapi/nf-synchapi-createeventa) function.</span></span>
-   <span data-ttu-id="41ffb-133">Crie os threads.</span><span class="sxs-lookup"><span data-stu-id="41ffb-133">Create the threads.</span></span>
-   <span data-ttu-id="41ffb-134">Cada thread monitora o estado do evento chamando a função [**WaitForSingleObject**](/windows/win32/api/synchapi/nf-synchapi-waitforsingleobject) .</span><span class="sxs-lookup"><span data-stu-id="41ffb-134">Each thread monitors the event state by calling the [**WaitForSingleObject**](/windows/win32/api/synchapi/nf-synchapi-waitforsingleobject) function.</span></span> <span data-ttu-id="41ffb-135">Use um intervalo de tempo limite de espera igual a zero.</span><span class="sxs-lookup"><span data-stu-id="41ffb-135">Use a wait time-out interval of zero.</span></span>
-   <span data-ttu-id="41ffb-136">Cada thread encerra sua própria execução quando o evento é definido como o estado sinalizado ([**WaitForSingleObject**](/windows/win32/api/synchapi/nf-synchapi-waitforsingleobject) retorna o objeto de espera \_ \_ 0).</span><span class="sxs-lookup"><span data-stu-id="41ffb-136">Each thread terminates its own execution when the event is set to the signaled state ([**WaitForSingleObject**](/windows/win32/api/synchapi/nf-synchapi-waitforsingleobject) returns WAIT\_OBJECT\_0).</span></span>

 

 
