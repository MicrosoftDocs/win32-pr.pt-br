---
description: Um processo filho pode herdar várias propriedades e recursos de seu processo pai.
ms.assetid: c530e723-2d40-4022-a259-dfc650604e44
title: Herança (processos e threads)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4713fe398360b510fab3c66f5cf74dc07b642dac
ms.sourcegitcommit: 3d718d8f69d3f86eaecf94c5705d761c5a9ef4a1
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/20/2020
ms.locfileid: "105759610"
---
# <a name="inheritance"></a><span data-ttu-id="f5ac7-103">Herança</span><span class="sxs-lookup"><span data-stu-id="f5ac7-103">Inheritance</span></span>

<span data-ttu-id="f5ac7-104">Um processo filho pode herdar várias propriedades e recursos de seu processo pai.</span><span class="sxs-lookup"><span data-stu-id="f5ac7-104">A child process can inherit several properties and resources from its parent process.</span></span> <span data-ttu-id="f5ac7-105">Você também pode impedir que um processo filho herde Propriedades de seu processo pai.</span><span class="sxs-lookup"><span data-stu-id="f5ac7-105">You can also prevent a child process from inheriting properties from its parent process.</span></span> <span data-ttu-id="f5ac7-106">O seguinte pode ser herdado:</span><span class="sxs-lookup"><span data-stu-id="f5ac7-106">The following can be inherited:</span></span>

-   <span data-ttu-id="f5ac7-107">Identificadores abertos retornados pela função [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) .</span><span class="sxs-lookup"><span data-stu-id="f5ac7-107">Open handles returned by the [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) function.</span></span> <span data-ttu-id="f5ac7-108">Isso inclui identificadores para arquivos, buffers de entrada do console, buffers de tela do console, pipes nomeados, dispositivos de comunicação serial e processadores de memória.</span><span class="sxs-lookup"><span data-stu-id="f5ac7-108">This includes handles to files, console input buffers, console screen buffers, named pipes, serial communication devices, and mailslots.</span></span>
-   <span data-ttu-id="f5ac7-109">Abra identificadores para processar, thread, mutex, evento, semáforo, pipe nomeado, pipe anônimo e objetos de mapeamento de arquivo.</span><span class="sxs-lookup"><span data-stu-id="f5ac7-109">Open handles to process, thread, mutex, event, semaphore, named-pipe, anonymous-pipe, and file-mapping objects.</span></span> <span data-ttu-id="f5ac7-110">Elas são retornadas pelas funções [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa), [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread), [**CreateMutex**](/windows/desktop/api/synchapi/nf-synchapi-createmutexa), [**CreateEvent**](/windows/desktop/api/synchapi/nf-synchapi-createeventa), [**createsemáforo**](/windows/desktop/api/winbase/nf-winbase-createsemaphorea), [**CreateNamedPipe**](/windows/desktop/api/winbase/nf-winbase-createnamedpipea), [**CreatePipe**](/windows/desktop/api/namedpipeapi/nf-namedpipeapi-createpipe)e [**CreateFileMapping**](/windows/desktop/api/winbase/nf-winbase-createfilemappinga) , respectivamente.</span><span class="sxs-lookup"><span data-stu-id="f5ac7-110">These are returned by the [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa), [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread), [**CreateMutex**](/windows/desktop/api/synchapi/nf-synchapi-createmutexa), [**CreateEvent**](/windows/desktop/api/synchapi/nf-synchapi-createeventa), [**CreateSemaphore**](/windows/desktop/api/winbase/nf-winbase-createsemaphorea), [**CreateNamedPipe**](/windows/desktop/api/winbase/nf-winbase-createnamedpipea), [**CreatePipe**](/windows/desktop/api/namedpipeapi/nf-namedpipeapi-createpipe), and [**CreateFileMapping**](/windows/desktop/api/winbase/nf-winbase-createfilemappinga) functions, respectively.</span></span>
-   <span data-ttu-id="f5ac7-111">Variáveis de ambiente.</span><span class="sxs-lookup"><span data-stu-id="f5ac7-111">Environment variables.</span></span>
-   <span data-ttu-id="f5ac7-112">O diretório atual.</span><span class="sxs-lookup"><span data-stu-id="f5ac7-112">The current directory.</span></span>
-   <span data-ttu-id="f5ac7-113">O console, a menos que o processo seja desanexado ou um novo console seja criado.</span><span class="sxs-lookup"><span data-stu-id="f5ac7-113">The console, unless the process is detached or a new console is created.</span></span> <span data-ttu-id="f5ac7-114">Um processo de console filho também pode herdar os identificadores padrão do pai, bem como o acesso ao buffer de entrada e ao buffer de tela ativo.</span><span class="sxs-lookup"><span data-stu-id="f5ac7-114">A child console process can also inherit the parent's standard handles, as well as access to the input buffer and the active screen buffer.</span></span>
-   <span data-ttu-id="f5ac7-115">O modo de erro, conforme definido pela função [**SetError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-seterrormode) .</span><span class="sxs-lookup"><span data-stu-id="f5ac7-115">The error mode, as set by the [**SetErrorMode**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-seterrormode) function.</span></span>
-   <span data-ttu-id="f5ac7-116">A máscara de afinidade do processador.</span><span class="sxs-lookup"><span data-stu-id="f5ac7-116">The processor affinity mask.</span></span>
-   <span data-ttu-id="f5ac7-117">A associação a um trabalho.</span><span class="sxs-lookup"><span data-stu-id="f5ac7-117">The association with a job.</span></span>

<span data-ttu-id="f5ac7-118">O processo filho não herda o seguinte:</span><span class="sxs-lookup"><span data-stu-id="f5ac7-118">The child process does not inherit the following:</span></span>

-   <span data-ttu-id="f5ac7-119">Classe de prioridade.</span><span class="sxs-lookup"><span data-stu-id="f5ac7-119">Priority class.</span></span>
-   <span data-ttu-id="f5ac7-120">Identificadores retornados por [**LocalAlloc**](/windows/desktop/api/winbase/nf-winbase-localalloc), [**GlobalAlloc**](/windows/desktop/api/winbase/nf-winbase-globalalloc), [**HeapCreate**](/windows/desktop/api/heapapi/nf-heapapi-heapcreate)e [**HeapAlloc**](/windows/desktop/api/heapapi/nf-heapapi-heapalloc).</span><span class="sxs-lookup"><span data-stu-id="f5ac7-120">Handles returned by [**LocalAlloc**](/windows/desktop/api/winbase/nf-winbase-localalloc), [**GlobalAlloc**](/windows/desktop/api/winbase/nf-winbase-globalalloc), [**HeapCreate**](/windows/desktop/api/heapapi/nf-heapapi-heapcreate), and [**HeapAlloc**](/windows/desktop/api/heapapi/nf-heapapi-heapalloc).</span></span>
-   <span data-ttu-id="f5ac7-121">Pseudo-alças, como nos identificadores retornados pela função [**GetCurrentProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getcurrentprocess) ou [**GetCurrentThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getcurrentthread) .</span><span class="sxs-lookup"><span data-stu-id="f5ac7-121">Pseudo handles, as in the handles returned by the [**GetCurrentProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getcurrentprocess) or [**GetCurrentThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getcurrentthread) function.</span></span> <span data-ttu-id="f5ac7-122">Esses identificadores são válidos somente para o processo de chamada.</span><span class="sxs-lookup"><span data-stu-id="f5ac7-122">These handles are valid only for the calling process.</span></span>
-   <span data-ttu-id="f5ac7-123">Identificadores de módulo DLL retornados pela função [**LoadLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-loadlibrarya) .</span><span class="sxs-lookup"><span data-stu-id="f5ac7-123">DLL module handles returned by the [**LoadLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-loadlibrarya) function.</span></span>
-   <span data-ttu-id="f5ac7-124">As alças GDI ou USER, como **HBITMAP** ou **HMENU**.</span><span class="sxs-lookup"><span data-stu-id="f5ac7-124">GDI or USER handles, such as **HBITMAP** or **HMENU**.</span></span>

## <a name="inheriting-handles"></a><span data-ttu-id="f5ac7-125">Herdando identificadores</span><span class="sxs-lookup"><span data-stu-id="f5ac7-125">Inheriting Handles</span></span>

<span data-ttu-id="f5ac7-126">Um processo filho pode herdar alguns de seus identificadores pai, mas não herdar outros.</span><span class="sxs-lookup"><span data-stu-id="f5ac7-126">A child process can inherit some of its parent's handles, but not inherit others.</span></span> <span data-ttu-id="f5ac7-127">Para fazer com que um identificador seja herdado, você deve fazer duas coisas:</span><span class="sxs-lookup"><span data-stu-id="f5ac7-127">To cause a handle to be inherited, you must do two things:</span></span>

-   <span data-ttu-id="f5ac7-128">Especifique que o identificador deve ser herdado quando você criar, abrir ou duplicar o identificador.</span><span class="sxs-lookup"><span data-stu-id="f5ac7-128">Specify that the handle is to be inherited when you create, open, or duplicate the handle.</span></span> <span data-ttu-id="f5ac7-129">Normalmente, as funções de criação usam o membro **bInheritHandle** de uma estrutura de [**\_ atributos de segurança**](/previous-versions/windows/desktop/legacy/aa379560(v=vs.85)) para essa finalidade.</span><span class="sxs-lookup"><span data-stu-id="f5ac7-129">Creation functions typically use the **bInheritHandle** member of a [**SECURITY\_ATTRIBUTES**](/previous-versions/windows/desktop/legacy/aa379560(v=vs.85)) structure for this purpose.</span></span> <span data-ttu-id="f5ac7-130">[**DuplicateHandle**](/windows/desktop/api/handleapi/nf-handleapi-duplicatehandle) usa o parâmetro *bInheritHandles* .</span><span class="sxs-lookup"><span data-stu-id="f5ac7-130">[**DuplicateHandle**](/windows/desktop/api/handleapi/nf-handleapi-duplicatehandle) uses the *bInheritHandles* parameter.</span></span>
-   <span data-ttu-id="f5ac7-131">Especifique que os identificadores herdáveis devem ser herdados definindo o parâmetro *bInheritHandles* como true ao chamar a função [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) .</span><span class="sxs-lookup"><span data-stu-id="f5ac7-131">Specify that inheritable handles are to be inherited by setting the *bInheritHandles* parameter to TRUE when calling the [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) function.</span></span> <span data-ttu-id="f5ac7-132">Além disso, para herdar a entrada padrão, a saída padrão e os identificadores de erro padrão, o membro **dwFlags** da estrutura [**STARTUPINFO**](/windows/win32/api/processthreadsapi/ns-processthreadsapi-startupinfoa) deve incluir STARTF \_ USESTDHANDLES.</span><span class="sxs-lookup"><span data-stu-id="f5ac7-132">Additionally, to inherit the standard input, standard output, and standard error handles, the **dwFlags** member of the [**STARTUPINFO**](/windows/win32/api/processthreadsapi/ns-processthreadsapi-startupinfoa) structure must include STARTF\_USESTDHANDLES.</span></span>

<span data-ttu-id="f5ac7-133">Para especificar uma lista de identificadores que devem ser herdados por um processo filho específico, chame a função [**UpdateProcThreadAttribute**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-updateprocthreadattribute) com o sinalizador *PROC_THREAD_ATTRIBUTE_HANDLE_LIST* .</span><span class="sxs-lookup"><span data-stu-id="f5ac7-133">To specify a list of the handles that should be inherited by a specific child process, call the [**UpdateProcThreadAttribute**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-updateprocthreadattribute) function with the *PROC_THREAD_ATTRIBUTE_HANDLE_LIST* flag.</span></span>

<span data-ttu-id="f5ac7-134">Um identificador herdado se refere ao mesmo objeto no processo filho como faz no processo pai.</span><span class="sxs-lookup"><span data-stu-id="f5ac7-134">An inherited handle refers to the same object in the child process as it does in the parent process.</span></span> <span data-ttu-id="f5ac7-135">Ele também tem o mesmo valor e privilégios de acesso.</span><span class="sxs-lookup"><span data-stu-id="f5ac7-135">It also has the same value and access privileges.</span></span> <span data-ttu-id="f5ac7-136">Portanto, quando um processo altera o estado do objeto, a alteração afeta ambos os processos.</span><span class="sxs-lookup"><span data-stu-id="f5ac7-136">Therefore, when one process changes the state of the object, the change affects both processes.</span></span> <span data-ttu-id="f5ac7-137">Para usar um identificador, o processo filho deve recuperar o valor do identificador e "saber" o objeto ao qual se refere.</span><span class="sxs-lookup"><span data-stu-id="f5ac7-137">To use a handle, the child process must retrieve the handle value and "know" the object to which it refers.</span></span> <span data-ttu-id="f5ac7-138">Normalmente, o processo pai comunica essas informações ao processo filho por meio de sua linha de comando, bloco de ambiente ou alguma forma de [comunicação entre processos](/windows/desktop/ipc/interprocess-communications).</span><span class="sxs-lookup"><span data-stu-id="f5ac7-138">Usually, the parent process communicates this information to the child process through its command line, environment block, or some form of [interprocess communication](/windows/desktop/ipc/interprocess-communications).</span></span>

<span data-ttu-id="f5ac7-139">Use a função [**SetHandleInformation**](/windows/win32/api/handleapi/nf-handleapi-sethandleinformation) para controlar se um identificador existente é herdável ou não.</span><span class="sxs-lookup"><span data-stu-id="f5ac7-139">Use the [**SetHandleInformation**](/windows/win32/api/handleapi/nf-handleapi-sethandleinformation) function to control if an existing handle is inheritable or not.</span></span>

## <a name="inheriting-environment-variables"></a><span data-ttu-id="f5ac7-140">Herdando variáveis de ambiente</span><span class="sxs-lookup"><span data-stu-id="f5ac7-140">Inheriting Environment Variables</span></span>

<span data-ttu-id="f5ac7-141">Um processo filho herda as variáveis de ambiente de seu processo pai por padrão.</span><span class="sxs-lookup"><span data-stu-id="f5ac7-141">A child process inherits the environment variables of its parent process by default.</span></span> <span data-ttu-id="f5ac7-142">No entanto, [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) permite que o processo pai especifique um bloco diferente de variáveis de ambiente.</span><span class="sxs-lookup"><span data-stu-id="f5ac7-142">However, [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) enables the parent process to specify a different block of environment variables.</span></span> <span data-ttu-id="f5ac7-143">Para obter mais informações, consulte [variáveis de ambiente](environment-variables.md).</span><span class="sxs-lookup"><span data-stu-id="f5ac7-143">For more information, see [Environment Variables](environment-variables.md).</span></span>

## <a name="inheriting-the-current-directory"></a><span data-ttu-id="f5ac7-144">Herdando o diretório atual</span><span class="sxs-lookup"><span data-stu-id="f5ac7-144">Inheriting the Current Directory</span></span>

<span data-ttu-id="f5ac7-145">A função [**GetCurrentDirectory**](/windows/desktop/api/winbase/nf-winbase-getcurrentdirectory) recupera o diretório atual do processo de chamada.</span><span class="sxs-lookup"><span data-stu-id="f5ac7-145">The [**GetCurrentDirectory**](/windows/desktop/api/winbase/nf-winbase-getcurrentdirectory) function retrieves the current directory of the calling process.</span></span> <span data-ttu-id="f5ac7-146">Um processo filho herda o diretório atual de seu processo pai por padrão.</span><span class="sxs-lookup"><span data-stu-id="f5ac7-146">A child process inherits the current directory of its parent process by default.</span></span> <span data-ttu-id="f5ac7-147">No entanto, [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) permite que o processo pai especifique um diretório atual diferente para o processo filho.</span><span class="sxs-lookup"><span data-stu-id="f5ac7-147">However, [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) enables the parent process to specify a different current directory for the child process.</span></span> <span data-ttu-id="f5ac7-148">Para alterar o diretório atual do processo de chamada, use a função [**SetCurrentDirectory**](/windows/desktop/api/winbase/nf-winbase-setcurrentdirectory) .</span><span class="sxs-lookup"><span data-stu-id="f5ac7-148">To change the current directory of the calling process, use the [**SetCurrentDirectory**](/windows/desktop/api/winbase/nf-winbase-setcurrentdirectory) function.</span></span>
