---
description: Cada novo thread ou fibra recebe seu próprio espaço de pilha que consiste em memória reservada e inicialmente confirmada.
ms.assetid: abb2d5c1-040b-4c36-aae5-3517b6a8c540
title: Tamanho da pilha de threads
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f4204e0bffa13fb43b6ea9520b60c0505372bad6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "103921904"
---
# <a name="thread-stack-size"></a><span data-ttu-id="4796d-103">Tamanho da pilha de threads</span><span class="sxs-lookup"><span data-stu-id="4796d-103">Thread Stack Size</span></span>

<span data-ttu-id="4796d-104">Cada novo thread ou fibra recebe seu próprio espaço de pilha que consiste em memória reservada e inicialmente confirmada.</span><span class="sxs-lookup"><span data-stu-id="4796d-104">Each new thread or fiber receives its own stack space consisting of both reserved and initially committed memory.</span></span> <span data-ttu-id="4796d-105">O tamanho da memória reservada representa a alocação de pilha total na memória virtual.</span><span class="sxs-lookup"><span data-stu-id="4796d-105">The reserved memory size represents the total stack allocation in virtual memory.</span></span> <span data-ttu-id="4796d-106">Como tal, o tamanho reservado é limitado ao intervalo de endereços virtuais.</span><span class="sxs-lookup"><span data-stu-id="4796d-106">As such, the reserved size is limited to the virtual address range.</span></span> <span data-ttu-id="4796d-107">As páginas inicialmente confirmadas não utilizam memória física até que sejam referenciadas; no entanto, eles removem páginas do limite de confirmação total do sistema, que é o tamanho do arquivo de paginação mais o tamanho da memória física.</span><span class="sxs-lookup"><span data-stu-id="4796d-107">The initially committed pages do not utilize physical memory until they are referenced; however, they do remove pages from the system total commit limit, which is the size of the page file plus the size of the physical memory.</span></span> <span data-ttu-id="4796d-108">O sistema confirma páginas adicionais da memória da pilha reservada conforme necessário, até que a pilha atinja o tamanho reservado menos uma página (que é usada como uma página de proteção para evitar o estouro de pilha) ou o sistema está tão baixo na memória que a operação falha.</span><span class="sxs-lookup"><span data-stu-id="4796d-108">The system commits additional pages from the reserved stack memory as they are needed, until either the stack reaches the reserved size minus one page (which is used as a guard page to prevent stack overflow) or the system is so low on memory that the operation fails.</span></span>

<span data-ttu-id="4796d-109">É melhor escolher o tamanho de uma pilha menor possível e confirmar a pilha necessária para que o thread ou a fibra sejam executados de forma confiável.</span><span class="sxs-lookup"><span data-stu-id="4796d-109">It is best to choose as small a stack size as possible and commit the stack that is needed for the thread or fiber to run reliably.</span></span> <span data-ttu-id="4796d-110">Todas as páginas reservadas para a pilha não podem ser usadas para nenhuma outra finalidade.</span><span class="sxs-lookup"><span data-stu-id="4796d-110">Every page that is reserved for the stack cannot be used for any other purpose.</span></span>

<span data-ttu-id="4796d-111">Uma pilha é liberada quando seu thread é encerrado.</span><span class="sxs-lookup"><span data-stu-id="4796d-111">A stack is freed when its thread exits.</span></span> <span data-ttu-id="4796d-112">Ele não será liberado se o thread for encerrado por outro thread.</span><span class="sxs-lookup"><span data-stu-id="4796d-112">It is not freed if the thread is terminated by another thread.</span></span>

<span data-ttu-id="4796d-113">O tamanho padrão da memória da pilha reservada e inicialmente confirmada é especificado no cabeçalho do arquivo executável.</span><span class="sxs-lookup"><span data-stu-id="4796d-113">The default size for the reserved and initially committed stack memory is specified in the executable file header.</span></span> <span data-ttu-id="4796d-114">A criação de thread ou fibra falhará se não houver memória suficiente para reservar ou confirmar o número de bytes solicitados.</span><span class="sxs-lookup"><span data-stu-id="4796d-114">Thread or fiber creation fails if there is not enough memory to reserve or commit the number of bytes requested.</span></span> <span data-ttu-id="4796d-115">O tamanho de reserva de pilha padrão usado pelo vinculador é 1 MB.</span><span class="sxs-lookup"><span data-stu-id="4796d-115">The default stack reservation size used by the linker is 1 MB.</span></span> <span data-ttu-id="4796d-116">Para especificar um tamanho de reserva de pilha padrão diferente para todos os threads e fibras, use a instrução STACKSIZE no arquivo de definição de módulo (. def).</span><span class="sxs-lookup"><span data-stu-id="4796d-116">To specify a different default stack reservation size for all threads and fibers, use the STACKSIZE statement in the module definition (.def) file.</span></span> <span data-ttu-id="4796d-117">O sistema operacional arredonda o tamanho especificado para o múltiplo mais próximo da granularidade de alocação do sistema (normalmente 64 KB).</span><span class="sxs-lookup"><span data-stu-id="4796d-117">The operating system rounds up the specified size to the nearest multiple of the system's allocation granularity (typically 64 KB).</span></span> <span data-ttu-id="4796d-118">Para recuperar a granularidade de alocação do sistema atual, use a função [**GetSystemInfo**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsysteminfo) .</span><span class="sxs-lookup"><span data-stu-id="4796d-118">To retrieve the allocation granularity of the current system, use the [**GetSystemInfo**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsysteminfo) function.</span></span>

<span data-ttu-id="4796d-119">Para alterar o espaço de pilha confirmada inicialmente, use o parâmetro *dwStackSize* da função [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread), [**CreateRemoteThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread)ou [**CreateFiber**](/windows/desktop/api/WinBase/nf-winbase-createfiber) .</span><span class="sxs-lookup"><span data-stu-id="4796d-119">To change the initially committed stack space, use the *dwStackSize* parameter of the [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread), [**CreateRemoteThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread), or [**CreateFiber**](/windows/desktop/api/WinBase/nf-winbase-createfiber) function.</span></span> <span data-ttu-id="4796d-120">Esse valor é arredondado para a página mais próxima.</span><span class="sxs-lookup"><span data-stu-id="4796d-120">This value is rounded up to the nearest page.</span></span> <span data-ttu-id="4796d-121">Em geral, o tamanho da reserva é o tamanho de reserva padrão especificado no cabeçalho do executável.</span><span class="sxs-lookup"><span data-stu-id="4796d-121">Generally, the reserve size is the default reserve size specified in the executable header.</span></span> <span data-ttu-id="4796d-122">No entanto, se o tamanho inicialmente confirmado especificado por *dwStackSize* for maior ou igual ao tamanho de reserva padrão, o tamanho da reserva será esse novo tamanho de confirmação arredondado para o múltiplo mais próximo de 1 MB.</span><span class="sxs-lookup"><span data-stu-id="4796d-122">However, if the initially committed size specified by *dwStackSize* is larger than or equal to the default reserve size, the reserve size is this new commit size rounded up to the nearest multiple of 1 MB.</span></span>

<span data-ttu-id="4796d-123">Para alterar o tamanho da pilha reservada, defina o parâmetro *dwCreationFlags* de [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread) ou [**CreateRemoteThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread) como Stack \_ Size \_ param como \_ \_ uma \_ reserva e use o parâmetro *dwStackSize* .</span><span class="sxs-lookup"><span data-stu-id="4796d-123">To change the reserved stack size, set the *dwCreationFlags* parameter of [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread) or [**CreateRemoteThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread) to STACK\_SIZE\_PARAM\_IS\_A\_RESERVATION and use the *dwStackSize* parameter.</span></span> <span data-ttu-id="4796d-124">Nesse caso, o tamanho inicialmente confirmado é o tamanho padrão especificado no cabeçalho do executável.</span><span class="sxs-lookup"><span data-stu-id="4796d-124">In this case, the initially committed size is the default size specified in the executable header.</span></span> <span data-ttu-id="4796d-125">Para fibras, use o parâmetro *dwStackReserveSize* de [**CreateFiberEx**](/windows/desktop/api/WinBase/nf-winbase-createfiberex).</span><span class="sxs-lookup"><span data-stu-id="4796d-125">For fibers, use the *dwStackReserveSize* parameter of [**CreateFiberEx**](/windows/desktop/api/WinBase/nf-winbase-createfiberex).</span></span> <span data-ttu-id="4796d-126">O tamanho confirmado é especificado no parâmetro *dwStackCommitSize* .</span><span class="sxs-lookup"><span data-stu-id="4796d-126">The committed size is specified in the *dwStackCommitSize* parameter.</span></span>

<span data-ttu-id="4796d-127">A função [**SetThreadStackGuarantee**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setthreadstackguarantee) define o tamanho mínimo da pilha associada ao thread de chamada ou à fibra que estará disponível durante qualquer exceção de estouro de pilha.</span><span class="sxs-lookup"><span data-stu-id="4796d-127">The [**SetThreadStackGuarantee**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setthreadstackguarantee) function sets the minimum size of the stack associated with the calling thread or fiber that will be available during any stack overflow exceptions.</span></span>

 

 
