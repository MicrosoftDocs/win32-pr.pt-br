---
description: Um aplicativo pode usar trabalhos aninhados para gerenciar subconjuntos de processos. Os trabalhos aninhados também habilitam um aplicativo que usa trabalhos para hospedar outros aplicativos que também usam trabalhos.
ms.assetid: FA22493B-CD29-49A7-BDAC-349FA96B8C9E
title: Trabalhos aninhados
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: abf105c70ec8e83b395fcce56c6274d4838358bc
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104558628"
---
# <a name="nested-jobs"></a><span data-ttu-id="8a4ff-104">Trabalhos aninhados</span><span class="sxs-lookup"><span data-stu-id="8a4ff-104">Nested Jobs</span></span>

<span data-ttu-id="8a4ff-105">Um aplicativo pode usar trabalhos aninhados para gerenciar subconjuntos de processos.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-105">An application can use nested jobs to manage subsets of processes.</span></span> <span data-ttu-id="8a4ff-106">Os trabalhos aninhados também habilitam um aplicativo que usa trabalhos para hospedar outros aplicativos que também usam trabalhos.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-106">Nested jobs also enable an application that uses jobs to host other applications that also use jobs.</span></span>

<span data-ttu-id="8a4ff-107">**Windows 7, Windows server 2008 R2, Windows XP com SP3, Windows server 2008, Windows Vista e Windows Server 2003:** Um processo pode ser associado a apenas um único trabalho.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-107">**Windows 7, Windows Server 2008 R2, Windows XP with SP3, Windows Server 2008, Windows Vista and Windows Server 2003:** A process can be associated with only a single job.</span></span> <span data-ttu-id="8a4ff-108">Os trabalhos aninhados foram introduzidos no Windows 8 e no Windows Server 2012.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-108">Nested jobs were introduced in Windows 8 and Windows Server 2012.</span></span>

<span data-ttu-id="8a4ff-109">Este tópico fornece uma visão geral do comportamento de aninhamento de trabalho e de trabalhos aninhados:</span><span class="sxs-lookup"><span data-stu-id="8a4ff-109">This topic provides an overview of job nesting and behavior of nested jobs:</span></span>

-   [<span data-ttu-id="8a4ff-110">Hierarquias de trabalho aninhadas</span><span class="sxs-lookup"><span data-stu-id="8a4ff-110">Nested Job Hierarchies</span></span>](#nested-job-hierarchies)
-   [<span data-ttu-id="8a4ff-111">Criando uma hierarquia de trabalho aninhada</span><span class="sxs-lookup"><span data-stu-id="8a4ff-111">Creating a Nested Job Hierarchy</span></span>](#creating-a-nested-job-hierarchy)
-   [<span data-ttu-id="8a4ff-112">Limites de trabalho e notificações para trabalhos aninhados</span><span class="sxs-lookup"><span data-stu-id="8a4ff-112">Job Limits and Notifications for Nested Jobs</span></span>](#job-limits-and-notifications-for-nested-jobs)
-   [<span data-ttu-id="8a4ff-113">Contabilidade de recursos para trabalhos aninhados</span><span class="sxs-lookup"><span data-stu-id="8a4ff-113">Resource Accounting for Nested Jobs</span></span>](#resource-accounting-for-nested-jobs)
-   [<span data-ttu-id="8a4ff-114">Término de trabalhos aninhados</span><span class="sxs-lookup"><span data-stu-id="8a4ff-114">Termination of Nested Jobs</span></span>](#termination-of-nested-jobs)

<span data-ttu-id="8a4ff-115">Para obter informações gerais sobre trabalhos e objetos de trabalho, consulte [objetos de trabalho](job-objects.md).</span><span class="sxs-lookup"><span data-stu-id="8a4ff-115">For general information about jobs and job objects, see [Job Objects](job-objects.md).</span></span>

## <a name="nested-job-hierarchies"></a><span data-ttu-id="8a4ff-116">Hierarquias de trabalho aninhadas</span><span class="sxs-lookup"><span data-stu-id="8a4ff-116">Nested Job Hierarchies</span></span>

<span data-ttu-id="8a4ff-117">Os trabalhos aninhados têm uma relação pai-filho na qual cada trabalho filho contém um subconjunto dos processos em seu trabalho pai.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-117">Nested jobs have a parent-child relationship in which each child job contains a subset of the processes in its parent job.</span></span> <span data-ttu-id="8a4ff-118">Se um processo que já está em um trabalho for adicionado a outro trabalho, os trabalhos serão aninhados por padrão se o sistema puder formar uma hierarquia de trabalhos válida e nenhum dos limites de interface do usuário definirá os restrições ([**SetInformationJobObject**](/windows/win32/api/jobapi2/nf-jobapi2-setinformationjobobject) com **JobObjectBasicUIRestrictions**).</span><span class="sxs-lookup"><span data-stu-id="8a4ff-118">If a process that is already in a job is added to another job, the jobs are nested by default if the system can form a valid job hierarchy and neither job sets UI limits ([**SetInformationJobObject**](/windows/win32/api/jobapi2/nf-jobapi2-setinformationjobobject) with **JobObjectBasicUIRestrictions**).</span></span>

<span data-ttu-id="8a4ff-119">A Figura 1 mostra uma hierarquia de trabalhos que contém uma árvore de processos rotulados como P0 até P7.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-119">Figure 1 shows a job hierarchy that contains a tree of processes labeled P0 through P7.</span></span> <span data-ttu-id="8a4ff-120">O trabalho 1 é o *trabalho pai* do trabalho 2 e do trabalho 4, e é um *ancestral* do trabalho 3.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-120">Job 1 is the *parent job* of Job 2 and Job 4, and it is an *ancestor* of Job 3.</span></span> <span data-ttu-id="8a4ff-121">O trabalho 2 é o *pai imediato* do trabalho 3; O trabalho 3 é o *filho imediato* do trabalho 2.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-121">Job 2 is the *immediate parent* of Job 3; Job 3 is the *immediate child* of Job 2.</span></span> <span data-ttu-id="8a4ff-122">Os trabalhos 1, 2 e 3 formam uma *cadeia de trabalhos* em que os trabalhos 1 e 2 são a cadeia de trabalhos *pai* 3.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-122">Jobs 1, 2, and 3 form a *job chain* in which Jobs 1 and 2 are the *parent job chain* of Job 3.</span></span> <span data-ttu-id="8a4ff-123">O trabalho final em uma cadeia de trabalhos é o *trabalho imediato* dos processos nesse trabalho.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-123">The end job in a job chain is the *immediate job* of the processes in that job.</span></span> <span data-ttu-id="8a4ff-124">Na Figura 1, o trabalho 3 é o trabalho imediato de Processes P2, P3 e P4.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-124">In Figure 1, Job 3 is the immediate job of processes P2, P3, and P4.</span></span>

![Figura 1.](images/nested-jobs-a.png)

<span data-ttu-id="8a4ff-127">Os trabalhos aninhados também podem ser usados para gerenciar grupos de processos de pares.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-127">Nested jobs can also be used to manage groups of peer processes.</span></span> <span data-ttu-id="8a4ff-128">Na hierarquia de trabalhos mostrada na Figura 2, o trabalho 1 é o trabalho pai do trabalho 2.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-128">In the job hierarchy shown in Figure 2, Job 1 is the parent job of Job 2.</span></span> <span data-ttu-id="8a4ff-129">Observe que uma hierarquia de trabalho pode conter apenas parte de uma árvore de processo.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-129">Note that a job hierarchy might contain only part of a process tree.</span></span> <span data-ttu-id="8a4ff-130">Na Figura 2, P0 não está na hierarquia, mas seus processos filho P1 a P5 são.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-130">In Figure 2, P0 is not in the hierarchy, but its child processes P1 through P5 are.</span></span>

![Figura 2.](images/nested-jobs-b.png)

## <a name="creating-a-nested-job-hierarchy"></a><span data-ttu-id="8a4ff-133">Criando uma hierarquia de trabalho aninhada</span><span class="sxs-lookup"><span data-stu-id="8a4ff-133">Creating a Nested Job Hierarchy</span></span>

<span data-ttu-id="8a4ff-134">Os processos em uma hierarquia de trabalho são explicitamente associados a um objeto de trabalho usando a função [**AssignProcessToJobObject**](/windows/win32/api/jobapi2/nf-jobapi2-assignprocesstojobobject) ou implicitamente associados durante a criação do processo, o mesmo que para trabalhos autônomos.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-134">Processes in a job hierarchy are either explicitly associated with a job object using the [**AssignProcessToJobObject**](/windows/win32/api/jobapi2/nf-jobapi2-assignprocesstojobobject) function or implicitly associated during process creation, same as for standalone jobs.</span></span> <span data-ttu-id="8a4ff-135">A ordem na qual os trabalhos são criados e os processos são atribuídos determina se uma hierarquia pode ser criada.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-135">The order in which jobs are created and processes are assigned determines whether a hierarchy can be created.</span></span>

<span data-ttu-id="8a4ff-136">Para criar uma hierarquia de trabalho usando Associação explícita, todos os objetos de trabalho devem ser criados usando [**CreateJobObject**](/windows/desktop/api/WinBase/nf-winbase-createjobobjecta), então, [**AssignProcessToJobObject**](/windows/win32/api/jobapi2/nf-jobapi2-assignprocesstojobobject) deve ser chamado várias vezes para cada processo para associar o processo a cada trabalho ao qual deve pertencer.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-136">To build a job hierarchy using explicit association, all job objects must be created using [**CreateJobObject**](/windows/desktop/api/WinBase/nf-winbase-createjobobjecta), then [**AssignProcessToJobObject**](/windows/win32/api/jobapi2/nf-jobapi2-assignprocesstojobobject) must be called multiple times for each process to associate the process with each job it should belong to.</span></span> <span data-ttu-id="8a4ff-137">Para garantir que a hierarquia de trabalhos seja válida, primeiro atribua todos os processos ao trabalho na raiz da hierarquia, em seguida, atribua um subconjunto de processos ao objeto de trabalho filho imediato e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-137">To ensure that the job hierarchy is valid, first assign all processes to the job at the root of the hierarchy, then assign a subset of processes to the immediate child job object, and so on.</span></span> <span data-ttu-id="8a4ff-138">Se os processos forem atribuídos aos trabalhos nesta ordem, um trabalho filho sempre terá um subconjunto de processos em seu trabalho pai enquanto a hierarquia estiver sendo criada, o que é necessário para o aninhamento.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-138">If processes are assigned to jobs in this order, a child job will always have a subset of processes in its parent job while the hierarchy is being created, which is required for nesting.</span></span> <span data-ttu-id="8a4ff-139">Se os processos forem atribuídos a trabalhos em ordem aleatória, em algum momento um trabalho filho terá processos que não estão em seu trabalho pai.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-139">If processes are assigned to jobs in random order, at some point a child job will have processes that are not in its parent job.</span></span> <span data-ttu-id="8a4ff-140">Isso não é permitido pelo aninhamento e causará falha de **AssignProcessToJobObject** .</span><span class="sxs-lookup"><span data-stu-id="8a4ff-140">This is not allowed by nesting and it will cause **AssignProcessToJobObject** to fail.</span></span>

<span data-ttu-id="8a4ff-141">Quando os processos são implicitamente associados a um trabalho durante a criação do processo, um processo filho é associado a cada trabalho na cadeia de trabalhos de seu processo pai.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-141">When processes are implicitly associated with a job during process creation, a child process is associated with every job in the job chain of its parent process.</span></span> <span data-ttu-id="8a4ff-142">Se o objeto de trabalho imediato permitir Breakaway, o processo filho desaparecerá do objeto de trabalho imediato e de cada trabalho na cadeia de trabalhos pai, movendo a hierarquia até atingir um trabalho que não permita Breakaway.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-142">If the immediate job object allows breakaway, the child process breaks away from the immediate job object and from each job in the parent job chain, moving up the hierarchy until it reaches a job that does not permit breakaway.</span></span> <span data-ttu-id="8a4ff-143">Se o objeto de trabalho imediato não permitir Breakaway, o processo filho não se interromperá mesmo se os trabalhos em sua cadeia de trabalhos pai permitirem.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-143">If the immediate job object does not allow breakaway, the child process does not break away even if jobs in its parent job chain allow it.</span></span>

## <a name="job-limits-and-notifications-for-nested-jobs"></a><span data-ttu-id="8a4ff-144">Limites de trabalho e notificações para trabalhos aninhados</span><span class="sxs-lookup"><span data-stu-id="8a4ff-144">Job Limits and Notifications for Nested Jobs</span></span>

<span data-ttu-id="8a4ff-145">Para determinados limites de recursos, o limite definido para trabalhos em uma cadeia de trabalhos pai determinam o *limite efetivo* que é imposto para um trabalho filho.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-145">For certain resource limits, the limit set for jobs in a parent job chain determine the *effective limit* that is enforced for a child job.</span></span> <span data-ttu-id="8a4ff-146">O limite efetivo para o trabalho filho pode ser mais restritivo do que o limite de seu pai, mas não pode ser menos restritivo.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-146">The effective limit for child job can be more restrictive than the limit of its parent, but it cannot be less restrictive.</span></span> <span data-ttu-id="8a4ff-147">Por exemplo, se a classe de prioridade de um trabalho filho estiver acima da \_ \_ classe de prioridade normal \_ e a classe de prioridade do trabalho pai for a classe de prioridade normal \_ \_ , o limite efetivo para processos no trabalho filho será a \_ classe de prioridade normal \_ .</span><span class="sxs-lookup"><span data-stu-id="8a4ff-147">For example, if a child job's priority class is ABOVE\_NORMAL\_PRIORITY\_CLASS and its parent job's priority class is NORMAL\_PRIORITY\_CLASS, the effective limit for processes in the child job is NORMAL\_PRIORITY\_CLASS.</span></span> <span data-ttu-id="8a4ff-148">No entanto, se a classe de prioridade do trabalho filho estiver abaixo da \_ \_ classe de prioridade normal \_ , o limite efetivo para processos no trabalho filho estará abaixo da \_ classe de prioridade normal \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="8a4ff-148">However, if the child job's priority class is BELOW\_NORMAL\_PRIORITY\_CLASS, the effective limit for processes in the child job is BELOW\_NORMAL\_PRIORITY\_CLASS.</span></span> <span data-ttu-id="8a4ff-149">Os limites efetivos são impostos para classe de prioridade, afinidade, encargo de confirmação, limite de tempo de execução por processo, limite de classe de agendamento e mínimo e máximo de conjunto de trabalho.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-149">Effective limits are enforced for priority class, affinity, commit charge, per-process execution time limit, scheduling class limit, and working set minimum and maximum.</span></span> <span data-ttu-id="8a4ff-150">Para obter mais informações sobre limites de recursos específicos, consulte [ **SetInformationJobObject.**](/windows/win32/api/jobapi2/nf-jobapi2-setinformationjobobject)</span><span class="sxs-lookup"><span data-stu-id="8a4ff-150">For more information about specific resource limits, see [**SetInformationJobObject.**](/windows/win32/api/jobapi2/nf-jobapi2-setinformationjobobject)</span></span>

<span data-ttu-id="8a4ff-151">Quando determinados eventos ocorrem, como nova criação de processo ou violação de limite de recursos, uma mensagem é enviada para a porta de conclusão de e/s associada a um trabalho.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-151">When certain events occur, such as new process creation or resource limit violation, a message is sent to the I/O completion port associated with a job.</span></span> <span data-ttu-id="8a4ff-152">Um trabalho também pode se registrar para receber notificações quando determinados limites forem excedidos.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-152">A job can also register to receive notifications when certain limits are exceeded.</span></span> <span data-ttu-id="8a4ff-153">Para um trabalho não aninhado, a mensagem é enviada para a porta de conclusão de e/s associada ao trabalho.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-153">For a non-nested job, the message is sent to the I/O completion port associated with the job.</span></span> <span data-ttu-id="8a4ff-154">Para um trabalho aninhado, a mensagem é enviada a cada porta de conclusão de e/s associada a qualquer trabalho na cadeia de trabalhos pai do trabalho que disparou a mensagem.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-154">For a nested job, the message is sent to every I/O completion port associated with any job in the parent job chain of the job that triggered the message.</span></span> <span data-ttu-id="8a4ff-155">Um trabalho filho não precisa ter uma porta de conclusão de e/s associada para as mensagens que ele dispara para serem enviadas para as portas de conclusão de e/s de trabalhos pai acima na cadeia de trabalhos.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-155">A child job does not need to have an associated I/O completion port for messages it triggers to be sent to the I/O completion ports of parent jobs higher in the job chain.</span></span> <span data-ttu-id="8a4ff-156">Para obter mais informações sobre mensagens específicas, consulte [**JOBOBJECT \_ associar a \_ \_ porta de conclusão**](/windows/desktop/api/WinNT/ns-winnt-jobobject_associate_completion_port).</span><span class="sxs-lookup"><span data-stu-id="8a4ff-156">For more information about specific messages, see [**JOBOBJECT\_ASSOCIATE\_COMPLETION\_PORT**](/windows/desktop/api/WinNT/ns-winnt-jobobject_associate_completion_port).</span></span>

## <a name="resource-accounting-for-nested-jobs"></a><span data-ttu-id="8a4ff-157">Contabilidade de recursos para trabalhos aninhados</span><span class="sxs-lookup"><span data-stu-id="8a4ff-157">Resource Accounting for Nested Jobs</span></span>

<span data-ttu-id="8a4ff-158">As informações de contabilização de recursos para um trabalho aninhado descrevem o uso de todos os processos associados a esse trabalho, incluindo processos em trabalhos filho.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-158">Resource accounting information for a nested job describes the usage of every process associated with that job, including processes in child jobs.</span></span> <span data-ttu-id="8a4ff-159">Cada trabalho em uma cadeia de trabalhos, portanto, representa os recursos agregados usados por seus próprios processos e os processos de cada trabalho filho abaixo dele na cadeia de trabalhos.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-159">Each job in a job chain therefore represents the aggregated resources used by its own processes and the processes of every child job below it in the job chain.</span></span>

## <a name="termination-of-nested-jobs"></a><span data-ttu-id="8a4ff-160">Término de trabalhos aninhados</span><span class="sxs-lookup"><span data-stu-id="8a4ff-160">Termination of Nested Jobs</span></span>

<span data-ttu-id="8a4ff-161">Quando um trabalho em uma hierarquia de trabalhos é encerrado, o sistema encerra os processos nesse trabalho e todos os seus trabalhos filho, começando com o trabalho filho na parte inferior da hierarquia.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-161">When a job in a job hierarchy is terminated, the system terminates processes in that job and all of its child jobs, starting with the child job at the bottom of the hierarchy.</span></span> <span data-ttu-id="8a4ff-162">Os recursos pendentes usados por cada processo encerrado são cobrados no trabalho pai.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-162">Outstanding resources used by each terminated process are charged to the parent job.</span></span>

<span data-ttu-id="8a4ff-163">O identificador de trabalho deve ter o \_ objeto de trabalho \_ encerrar acesso direito, o mesmo que para trabalhos autônomos.</span><span class="sxs-lookup"><span data-stu-id="8a4ff-163">The job handle must have the JOB\_OBJECT\_TERMINATE access right, same as for standalone jobs.</span></span>

 

 
