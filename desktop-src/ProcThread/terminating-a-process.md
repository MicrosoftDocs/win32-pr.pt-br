---
description: 'O encerramento de um processo tem os seguintes resultados: quaisquer threads restantes no processo são marcados para encerramento. Todos os recursos alocados pelo processo são liberados. Todos os objetos kernel são fechados. O código do processo é removido da memória. O código de saída do processo é definido. O objeto de processo é sinalizado.'
ms.assetid: af24d157-2719-4052-8029-1eb8010047cc
title: Finalizando um processo
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2010f1d4332a575c8ee94cf1b0f196e00ba7fb9f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105778529"
---
# <a name="terminating-a-process"></a><span data-ttu-id="6dec9-103">Finalizando um processo</span><span class="sxs-lookup"><span data-stu-id="6dec9-103">Terminating a Process</span></span>

<span data-ttu-id="6dec9-104">O encerramento de um processo tem os seguintes resultados:</span><span class="sxs-lookup"><span data-stu-id="6dec9-104">Terminating a process has the following results:</span></span>

-   <span data-ttu-id="6dec9-105">Todos os threads restantes no processo são marcados para encerramento.</span><span class="sxs-lookup"><span data-stu-id="6dec9-105">Any remaining threads in the process are marked for termination.</span></span>
-   <span data-ttu-id="6dec9-106">Todos os recursos alocados pelo processo são liberados.</span><span class="sxs-lookup"><span data-stu-id="6dec9-106">Any resources allocated by the process are freed.</span></span>
-   <span data-ttu-id="6dec9-107">Todos os objetos kernel são fechados.</span><span class="sxs-lookup"><span data-stu-id="6dec9-107">All kernel objects are closed.</span></span>
-   <span data-ttu-id="6dec9-108">O código do processo é removido da memória.</span><span class="sxs-lookup"><span data-stu-id="6dec9-108">The process code is removed from memory.</span></span>
-   <span data-ttu-id="6dec9-109">O código de saída do processo é definido.</span><span class="sxs-lookup"><span data-stu-id="6dec9-109">The process exit code is set.</span></span>
-   <span data-ttu-id="6dec9-110">O objeto de processo é sinalizado.</span><span class="sxs-lookup"><span data-stu-id="6dec9-110">The process object is signaled.</span></span>

<span data-ttu-id="6dec9-111">Embora os identificadores abertos para objetos kernel sejam fechados automaticamente quando um processo é encerrado, os próprios objetos existem até que todos os identificadores abertos sejam fechados.</span><span class="sxs-lookup"><span data-stu-id="6dec9-111">While open handles to kernel objects are closed automatically when a process terminates, the objects themselves exist until all open handles to them are closed.</span></span> <span data-ttu-id="6dec9-112">Portanto, um objeto permanecerá válido depois que um processo que o estiver usando será encerrado se outro processo tiver um identificador aberto para ele.</span><span class="sxs-lookup"><span data-stu-id="6dec9-112">Therefore, an object will remain valid after a process that is using it terminates if another process has an open handle to it.</span></span>

<span data-ttu-id="6dec9-113">A função [**GetExitCodeProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getexitcodeprocess) retorna o status de encerramento de um processo.</span><span class="sxs-lookup"><span data-stu-id="6dec9-113">The [**GetExitCodeProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getexitcodeprocess) function returns the termination status of a process.</span></span> <span data-ttu-id="6dec9-114">Enquanto um processo está em execução, seu status de encerramento ainda está \_ ativo.</span><span class="sxs-lookup"><span data-stu-id="6dec9-114">While a process is executing, its termination status is STILL\_ACTIVE.</span></span> <span data-ttu-id="6dec9-115">Quando um processo é encerrado, seu status de encerramento é alterado de ainda \_ ativo para o código de saída do processo.</span><span class="sxs-lookup"><span data-stu-id="6dec9-115">When a process terminates, its termination status changes from STILL\_ACTIVE to the exit code of the process.</span></span>

<span data-ttu-id="6dec9-116">Quando um processo é encerrado, o estado do objeto de processo torna-se sinalizado, liberando todos os threads que estavam aguardando a finalização do processo.</span><span class="sxs-lookup"><span data-stu-id="6dec9-116">When a process terminates, the state of the process object becomes signaled, releasing any threads that had been waiting for the process to terminate.</span></span> <span data-ttu-id="6dec9-117">Para obter mais informações sobre sincronização, consulte [sincronizando a execução de vários threads](synchronizing-execution-of-multiple-threads.md).</span><span class="sxs-lookup"><span data-stu-id="6dec9-117">For more about synchronization, see [Synchronizing Execution of Multiple Threads](synchronizing-execution-of-multiple-threads.md).</span></span>

<span data-ttu-id="6dec9-118">Quando o sistema está encerrando um processo, ele não encerra nenhum processo filho criado pelo processo.</span><span class="sxs-lookup"><span data-stu-id="6dec9-118">When the system is terminating a process, it does not terminate any child processes that the process has created.</span></span> <span data-ttu-id="6dec9-119">O encerramento de um processo não gera notificações para os procedimentos de gancho do qu \_ CBT.</span><span class="sxs-lookup"><span data-stu-id="6dec9-119">Terminating a process does not generate notifications for WH\_CBT hook procedures.</span></span>

<span data-ttu-id="6dec9-120">Use a função [**SetProcessShutdownParameters**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setprocessshutdownparameters) para especificar determinados aspectos da terminação de processo no desligamento do sistema, como quando um processo deve ser encerrado em relação aos outros processos no sistema.</span><span class="sxs-lookup"><span data-stu-id="6dec9-120">Use the [**SetProcessShutdownParameters**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setprocessshutdownparameters) function to specify certain aspects of the process termination at system shutdown, such as when a process should terminate relative to the other processes in the system.</span></span>

## <a name="how-processes-are-terminated"></a><span data-ttu-id="6dec9-121">Como os processos são encerrados</span><span class="sxs-lookup"><span data-stu-id="6dec9-121">How Processes are Terminated</span></span>

<span data-ttu-id="6dec9-122">Um processo é executado até que um dos seguintes eventos ocorra:</span><span class="sxs-lookup"><span data-stu-id="6dec9-122">A process executes until one of the following events occurs:</span></span>

-   <span data-ttu-id="6dec9-123">Qualquer thread do processo chama a função [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) .</span><span class="sxs-lookup"><span data-stu-id="6dec9-123">Any thread of the process calls the [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) function.</span></span> <span data-ttu-id="6dec9-124">Observe que alguma implementação da chamada CRT (biblioteca de tempo de execução) do C **ExitProcess** se o thread principal do processo retornar.</span><span class="sxs-lookup"><span data-stu-id="6dec9-124">Note that some implementation of the C run-time library (CRT) call **ExitProcess** if the primary thread of the process returns.</span></span>
-   <span data-ttu-id="6dec9-125">O último thread do processo é encerrado.</span><span class="sxs-lookup"><span data-stu-id="6dec9-125">The last thread of the process terminates.</span></span>
-   <span data-ttu-id="6dec9-126">Qualquer thread chama a função [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess) com um identificador para o processo.</span><span class="sxs-lookup"><span data-stu-id="6dec9-126">Any thread calls the [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess) function with a handle to the process.</span></span>
-   <span data-ttu-id="6dec9-127">Para processos de console, o [manipulador de controle de console](/windows/console/console-control-handlers) padrão chama [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) quando o console recebe um sinal CTRL + C ou Ctrl + Break.</span><span class="sxs-lookup"><span data-stu-id="6dec9-127">For console processes, the default [console control handler](/windows/console/console-control-handlers) calls [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) when the console receives a CTRL+C or CTRL+BREAK signal.</span></span>
-   <span data-ttu-id="6dec9-128">O usuário desliga o sistema ou faz logoff.</span><span class="sxs-lookup"><span data-stu-id="6dec9-128">The user shuts down the system or logs off.</span></span>

<span data-ttu-id="6dec9-129">Não encerre um processo, a menos que seus threads estejam em Estados conhecidos.</span><span class="sxs-lookup"><span data-stu-id="6dec9-129">Do not terminate a process unless its threads are in known states.</span></span> <span data-ttu-id="6dec9-130">Se um thread estiver aguardando um objeto de kernel, ele não será encerrado até que a espera seja concluída.</span><span class="sxs-lookup"><span data-stu-id="6dec9-130">If a thread is waiting on a kernel object, it will not be terminated until the wait has completed.</span></span> <span data-ttu-id="6dec9-131">Isso pode fazer com que o aplicativo pare de responder.</span><span class="sxs-lookup"><span data-stu-id="6dec9-131">This can cause the application to stop responding.</span></span>

<span data-ttu-id="6dec9-132">O thread principal pode evitar o encerramento de outros threads, direcionando-os para chamar [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread) antes de fazer com que o processo seja encerrado (para obter mais informações, consulte [encerrando um thread](terminating-a-thread.md)).</span><span class="sxs-lookup"><span data-stu-id="6dec9-132">The primary thread can avoid terminating other threads by directing them to call [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread) before causing the process to terminate (for more information, see [Terminating a Thread](terminating-a-thread.md)).</span></span> <span data-ttu-id="6dec9-133">O thread principal ainda pode chamar [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) posteriormente para garantir que todos os threads sejam encerrados.</span><span class="sxs-lookup"><span data-stu-id="6dec9-133">The primary thread can still call [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) afterwards to ensure that all threads are terminated.</span></span>

<span data-ttu-id="6dec9-134">O código de saída de um processo é o valor especificado na chamada para [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) ou [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess), ou o valor retornado pela função main ou [**WinMain**](/windows/win32/api/winbase/nf-winbase-winmain) do processo.</span><span class="sxs-lookup"><span data-stu-id="6dec9-134">The exit code for a process is either the value specified in the call to [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) or [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess), or the value returned by the main or [**WinMain**](/windows/win32/api/winbase/nf-winbase-winmain) function of the process.</span></span> <span data-ttu-id="6dec9-135">Se um processo for encerrado devido a uma exceção fatal, o código de saída será o valor da exceção que causou o encerramento.</span><span class="sxs-lookup"><span data-stu-id="6dec9-135">If a process is terminated due to a fatal exception, the exit code is the value of the exception that caused the termination.</span></span> <span data-ttu-id="6dec9-136">Além disso, esse valor é usado como o código de saída para todos os threads que estavam em execução quando a exceção ocorreu.</span><span class="sxs-lookup"><span data-stu-id="6dec9-136">In addition, this value is used as the exit code for all the threads that were executing when the exception occurred.</span></span>

<span data-ttu-id="6dec9-137">Se um processo for encerrado pelo [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess), o sistema chamará a função de ponto de entrada de cada DLL anexada com um valor indicando que o processo está sendo desanexado da dll.</span><span class="sxs-lookup"><span data-stu-id="6dec9-137">If a process is terminated by [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess), the system calls the entry-point function of each attached DLL with a value indicating that the process is detaching from the DLL.</span></span> <span data-ttu-id="6dec9-138">As DLLs não são notificadas quando um processo é encerrado pelo [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess).</span><span class="sxs-lookup"><span data-stu-id="6dec9-138">DLLs are not notified when a process is terminated by [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess).</span></span> <span data-ttu-id="6dec9-139">Para obter mais informações sobre DLLs, consulte [bibliotecas de vínculo dinâmico](../dlls/dynamic-link-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="6dec9-139">For more information about DLLs, see [Dynamic-Link Libraries](../dlls/dynamic-link-libraries.md).</span></span>

<span data-ttu-id="6dec9-140">Se um processo for encerrado pelo [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess), todos os threads do processo serão encerrados imediatamente sem a chance de executar código adicional.</span><span class="sxs-lookup"><span data-stu-id="6dec9-140">If a process is terminated by [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess), all threads of the process are terminated immediately with no chance to run additional code.</span></span> <span data-ttu-id="6dec9-141">Isso significa que o thread não executa código em blocos de manipulador de terminação.</span><span class="sxs-lookup"><span data-stu-id="6dec9-141">This means that the thread does not execute code in termination handler blocks.</span></span> <span data-ttu-id="6dec9-142">Além disso, nenhuma dll anexada é notificada de que o processo está desanexando.</span><span class="sxs-lookup"><span data-stu-id="6dec9-142">In addition, no attached DLLs are notified that the process is detaching.</span></span> <span data-ttu-id="6dec9-143">Se você precisar fazer com que um processo encerre outro processo, as etapas a seguir fornecerão uma solução melhor:</span><span class="sxs-lookup"><span data-stu-id="6dec9-143">If you need to have one process terminate another process, the following steps provide a better solution:</span></span>

-   <span data-ttu-id="6dec9-144">Os dois processos chamam a função [**RegisterWindowMessage**](/windows/win32/api/winuser/nf-winuser-registerwindowmessagea) para criar uma mensagem privada.</span><span class="sxs-lookup"><span data-stu-id="6dec9-144">Have both processes call the [**RegisterWindowMessage**](/windows/win32/api/winuser/nf-winuser-registerwindowmessagea) function to create a private message.</span></span>
-   <span data-ttu-id="6dec9-145">Um processo pode encerrar o outro processo transmitindo uma mensagem privada usando a função [**BroadcastSystemMessage**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessage) da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="6dec9-145">One process can terminate the other process by broadcasting a private message using the [**BroadcastSystemMessage**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessage) function as follows:</span></span>

    ``` syntax
     DWORD dwRecipients = BSM_APPLICATIONS;
        UINT uMessage = PM_MYMSG;
        WPARAM wParam = 0;
        LPARAM lParam = 0;

        BroadcastSystemMessage( 
            BSF_IGNORECURRENTTASK, // do not send message to this process
            &dwRecipients,         // broadcast only to applications
            uMessage,              // registered private message
            wParam,                // message-specific value
            lParam );              // message-specific value
    ```

-   <span data-ttu-id="6dec9-146">O processo que recebe a mensagem particular chama [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) para encerrar sua execução.</span><span class="sxs-lookup"><span data-stu-id="6dec9-146">The process receiving the private message calls [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) to terminate its execution.</span></span>

<span data-ttu-id="6dec9-147">A execução das funções [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess), [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread), [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread), [**CreateRemoteThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread)e [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) é serializada dentro de um espaço de endereço.</span><span class="sxs-lookup"><span data-stu-id="6dec9-147">The execution of the [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess), [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread), [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread), [**CreateRemoteThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread), and [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) functions is serialized within an address space.</span></span> <span data-ttu-id="6dec9-148">As restrições a seguir se aplicam:</span><span class="sxs-lookup"><span data-stu-id="6dec9-148">The following restrictions apply:</span></span>

-   <span data-ttu-id="6dec9-149">Durante a inicialização do processo e rotinas de inicialização de DLL, novos threads podem ser criados, mas eles não começam a ser executados até que a inicialização de DLL seja concluída para o processo.</span><span class="sxs-lookup"><span data-stu-id="6dec9-149">During process startup and DLL initialization routines, new threads can be created, but they do not begin execution until DLL initialization is finished for the process.</span></span>
-   <span data-ttu-id="6dec9-150">Somente um thread de cada vez pode estar em uma rotina de inicialização ou desanexação de DLL.</span><span class="sxs-lookup"><span data-stu-id="6dec9-150">Only one thread at a time can be in a DLL initialization or detach routine.</span></span>
-   <span data-ttu-id="6dec9-151">A função [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) não retorna até que não haja threads em suas rotinas de inicialização ou desanexação de dll.</span><span class="sxs-lookup"><span data-stu-id="6dec9-151">The [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) function does not return until there are no threads are in their DLL initialization or detach routines.</span></span>

 

 
