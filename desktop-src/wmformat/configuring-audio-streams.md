---
title: Configurando fluxos de áudio
description: Configurando fluxos de áudio
ms.assetid: 6ddd9bc1-3fde-4098-afce-fdda461ced62
keywords:
- fluxos, configurando fluxos de áudio
- codecs, configurando fluxos de áudio
- fluxos de áudio, configurando
- codecs, formatos
- fluxos, interface IWMCodecInfo
- IWMCodecInfo, fluxos de áudio
- fluxos, sincronização A/V
- fluxos de áudio, sincronização A/V
- Sincronização de A/V
- fluxos, sincronizando A/V
- fluxos de áudio, sincronizando A/V
- fluxos, formatos de áudio de baixo atraso
- fluxos de áudio, formatos de áudio de baixo atraso
- codecs, formatos de áudio de baixo atraso
- fluxos, taxa de bits variável (VBR)
- fluxos de áudio, taxa de bits variável (VBR)
- codecs, taxa de bits variável (VBR)
- taxa de bits variável (VBR), configurando
- VBR (taxa de bits variável), configurando
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3ad3931ec41e73c125417d39cdd177dc16056e9e
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/20/2020
ms.locfileid: "105814435"
---
# <a name="configuring-audio-streams"></a><span data-ttu-id="3438a-122">Configurando fluxos de áudio</span><span class="sxs-lookup"><span data-stu-id="3438a-122">Configuring Audio Streams</span></span>

<span data-ttu-id="3438a-123">Fluxos de áudio geralmente são os mais simples de configurar.</span><span class="sxs-lookup"><span data-stu-id="3438a-123">Audio streams are generally the most straightforward to configure.</span></span> <span data-ttu-id="3438a-124">Obtenha uma configuração de fluxo do codec usando os métodos de [**IWMCodecInfo**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmcodecinfo) , conforme descrito em [obtendo informações de configuração de fluxo de codecs](getting-stream-configuration-information-from-codecs.md).</span><span class="sxs-lookup"><span data-stu-id="3438a-124">Get a stream configuration from the codec using the methods of [**IWMCodecInfo**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmcodecinfo) as described in [Getting Stream Configuration Information from Codecs](getting-stream-configuration-information-from-codecs.md).</span></span> <span data-ttu-id="3438a-125">Na maioria das circunstâncias, você não deve alterar as configurações das recuperadas.</span><span class="sxs-lookup"><span data-stu-id="3438a-125">Under most circumstances, you should not alter the settings from those retrieved.</span></span>

<span data-ttu-id="3438a-126">O formato de codec que você seleciona entre os enumerados depende do uso pretendido dos arquivos ASF feitos com o perfil.</span><span class="sxs-lookup"><span data-stu-id="3438a-126">The codec format that you select from those enumerated depends upon the intended use of the ASF files made with the profile.</span></span> <span data-ttu-id="3438a-127">A descrição do formato do codec recuperado por [**IWMCodecInfo2:: GetCodecFormatDesc**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmcodecinfo2-getcodecformatdesc) resume as características do formato.</span><span class="sxs-lookup"><span data-stu-id="3438a-127">The codec format description retrieved by [**IWMCodecInfo2::GetCodecFormatDesc**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmcodecinfo2-getcodecformatdesc) summarizes the characteristics of the format.</span></span> <span data-ttu-id="3438a-128">Se seu aplicativo não exibir as descrições para escolher entre elas, você poderá chamar **QueryInterface** na interface [**IWMStreamConfig**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmstreamconfig) do formato de codec para obter a interface [**IWMMediaProps**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmmediaprops) .</span><span class="sxs-lookup"><span data-stu-id="3438a-128">If your application does not display the descriptions to choose between them, you can call **QueryInterface** on the [**IWMStreamConfig**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmstreamconfig) interface of the codec format to get the [**IWMMediaProps**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmmediaprops) interface.</span></span> <span data-ttu-id="3438a-129">Em seguida, você pode recuperar a estrutura do [**\_ \_ tipo de mídia do WM**](/previous-versions/windows/desktop/api/wmsdkidl/ns-wmsdkidl-wm_media_type) chamando [**IWMMediaProps:: GetMediaType**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-getmediatype).</span><span class="sxs-lookup"><span data-stu-id="3438a-129">Then you can retrieve the [**WM\_MEDIA\_TYPE**](/previous-versions/windows/desktop/api/wmsdkidl/ns-wmsdkidl-wm_media_type) structure by calling [**IWMMediaProps::GetMediaType**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-getmediatype).</span></span> <span data-ttu-id="3438a-130">Ao examinar a estrutura do **\_ \_ tipo de mídia do WM** e a estrutura [**WAVEFORMATEX**](/previous-versions/windows/desktop/legacy/dd757720(v=vs.85)) que aponta, você pode determinar as configurações do formato do codec e compará-las aos seus requisitos.</span><span class="sxs-lookup"><span data-stu-id="3438a-130">By examining the **WM\_MEDIA\_TYPE** structure and the [**WAVEFORMATEX**](/previous-versions/windows/desktop/legacy/dd757720(v=vs.85)) structure it points to, you can determine the settings of the codec format and compare them to your requirements.</span></span>

## <a name="getting-audio-formats-for-av-synchronization"></a><span data-ttu-id="3438a-131">Obtendo formatos de áudio para sincronização A/V</span><span class="sxs-lookup"><span data-stu-id="3438a-131">Getting Audio Formats for A/V Synchronization</span></span>

<span data-ttu-id="3438a-132">O codec de áudio do Windows Media e o Windows Media Audio Professional suportam formatos para arquivos somente de áudio e para arquivos de áudio/vídeo.</span><span class="sxs-lookup"><span data-stu-id="3438a-132">The Windows Media Audio codec and Windows Media Audio Professional codec both support formats for audio-only files and for audio/video files.</span></span> <span data-ttu-id="3438a-133">Os formatos somente de áudio são otimizados para arquivos que contêm apenas dados de áudio, enquanto os formatos de áudio/vídeo são otimizados para áudio que está em um arquivo com um fluxo de vídeo.</span><span class="sxs-lookup"><span data-stu-id="3438a-133">The audio-only formats are optimized for files containing only audio data, while the audio/video formats are optimized for audio that is in a file with a video stream.</span></span> <span data-ttu-id="3438a-134">Ao enumerar formatos de codec para esses codecs, os formatos de áudio/vídeo vêm após os formatos de somente áudio.</span><span class="sxs-lookup"><span data-stu-id="3438a-134">When enumerating codec formats for these codecs, the audio/video formats come after the audio-only formats.</span></span> <span data-ttu-id="3438a-135">Todas as descrições de formato de áudio/vídeo contêm a cadeia de caracteres "(A/V)".</span><span class="sxs-lookup"><span data-stu-id="3438a-135">The audio/video format descriptions all contain the string "(A/V)".</span></span> <span data-ttu-id="3438a-136">Você pode identificar os formatos criados para sincronização de áudio/vídeo programaticamente verificando o número de pacotes por segundo.</span><span class="sxs-lookup"><span data-stu-id="3438a-136">You can identify the formats designed for audio/video synchronization programmatically by checking the number of packets per second.</span></span> <span data-ttu-id="3438a-137">Os formatos de sincronização têm 5 ou mais pacotes por segundo se a taxa de bits for maior ou igual a 32.000 bits por segundo.</span><span class="sxs-lookup"><span data-stu-id="3438a-137">Formats for synchronization have 5 or more packets per second if the bit rate is greater than or equal to 32,000 bits per second.</span></span> <span data-ttu-id="3438a-138">Formatos com taxas de bits inferiores a 32.000 bits por segundo podem ser usados com vídeo sincronizado se usarem 3 ou mais pacotes por segundo.</span><span class="sxs-lookup"><span data-stu-id="3438a-138">Formats with bit rates less than 32,000 bits per second can be used with synchronized video if they use 3 or more packets per second.</span></span> <span data-ttu-id="3438a-139">O exemplo de código no tópico [para localizar formatos de áudio](to-find-audio-formats.md) contém o código necessário para fazer essa verificação:</span><span class="sxs-lookup"><span data-stu-id="3438a-139">The code example in the [To Find Audio Formats](to-find-audio-formats.md) topic contains the code required to make this check:</span></span>


```C++
if((pWave->nAvgBytesPerSec / pWave->nBlockAlign) >= 
       ((pWave->nAvgBytesPerSec >= 4000) ? 5.0 : 3.0))
{
    // Set this stream configuration as the new best match.
}
```



## <a name="getting-low-delay-audio-formats"></a><span data-ttu-id="3438a-140">Obtendo Low-Delay formatos de áudio</span><span class="sxs-lookup"><span data-stu-id="3438a-140">Getting Low-Delay Audio Formats</span></span>

<span data-ttu-id="3438a-141">O codec do Windows Media 9,1 e o codec do Windows Media Audio 9,1 Professional oferecem suporte a formatos de atraso baixo.</span><span class="sxs-lookup"><span data-stu-id="3438a-141">The Windows Media 9.1 codec and the Windows Media Audio 9.1 Professional codec both support low-delay formats.</span></span> <span data-ttu-id="3438a-142">Esses formatos têm uma janela de buffer menor do que outros formatos de áudio.</span><span class="sxs-lookup"><span data-stu-id="3438a-142">These formats have a smaller buffer window than other audio formats.</span></span> <span data-ttu-id="3438a-143">O áudio de baixo atraso destina-se a melhorar o desempenho em cenários em que os arquivos ou fluxos serão alternados com frequência; por exemplo, um aplicativo que lista um número de músicas para streaming na interface do usuário e permite que os usuários alternem arbitrariamente entre elas.</span><span class="sxs-lookup"><span data-stu-id="3438a-143">Low-delay audio is intended to improve performance in scenarios where files or streams will be switched frequently; for example, an application that lists a number of songs for streaming in the user interface and allows users to arbitrarily switch between them.</span></span>

<span data-ttu-id="3438a-144">Os formatos de atraso baixo estão disponíveis somente no modo CBR (One-Pass ou Two-pass).</span><span class="sxs-lookup"><span data-stu-id="3438a-144">Low-delay formats are available only in CBR mode (one-pass or two-pass).</span></span> <span data-ttu-id="3438a-145">Todas as descrições de formato de atraso baixo contêm a cadeia de caracteres "atraso baixo".</span><span class="sxs-lookup"><span data-stu-id="3438a-145">The low-delay format descriptions all contain the string "Low Delay".</span></span> <span data-ttu-id="3438a-146">Você pode identificar os formatos programaticamente verificando o valor de taxa de bits do formato.</span><span class="sxs-lookup"><span data-stu-id="3438a-146">You can identify the formats programmatically by checking the bit-rate value of the format.</span></span> <span data-ttu-id="3438a-147">Os formatos de atraso baixo são taxas de bits atribuídas que são 1 quilobits menores que as taxas de bits do formato normal equivalente.</span><span class="sxs-lookup"><span data-stu-id="3438a-147">The low-delay formats are assigned bit rates that are 1 kilobit less than the bit rates of the equivalent normal format.</span></span> <span data-ttu-id="3438a-148">Por exemplo, o codec do Windows Media Audio 9,1 dá suporte a um formato CBR de passagem única com uma taxa de bits de 192 kbps.</span><span class="sxs-lookup"><span data-stu-id="3438a-148">For example, the Windows Media Audio 9.1 codec supports a single-pass CBR format with a bit rate of 192 kbps.</span></span> <span data-ttu-id="3438a-149">O formato de baixa demora equivalente tem uma taxa de bits de 191 kbps.</span><span class="sxs-lookup"><span data-stu-id="3438a-149">The equivalent low-delay format has a bit rate of 191 kbps.</span></span> <span data-ttu-id="3438a-150">Além disso, com exceção do formato mono de 5 kbps com suporte do codec de áudio 9,1 do Windows Media, os formatos de atraso baixo são os únicos formatos que têm um valor de taxa de bits ímpar.</span><span class="sxs-lookup"><span data-stu-id="3438a-150">In addition, with the exception of the 5 kbps mono format supported by the Windows Media Audio 9.1 codec, the low-delay formats are the only formats that have an odd bit-rate value.</span></span>

## <a name="configuring-variable-bit-rate-audio"></a><span data-ttu-id="3438a-151">Configurando áudio de taxa de bits variável</span><span class="sxs-lookup"><span data-stu-id="3438a-151">Configuring Variable Bit Rate Audio</span></span>

<span data-ttu-id="3438a-152">Quando você precisa de um formato de taxa de bits variável (VBR) para um dos codecs de áudio do Windows Media, você pode obtê-lo definindo as configurações de enumeração no método [**IWMCodecInfo3:: SetCodecEnumerationSetting**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmcodecinfo3-setcodecenumerationsetting) .</span><span class="sxs-lookup"><span data-stu-id="3438a-152">When you need a variable bit rate (VBR) format for one of the Windows Media audio codecs, you can get it by setting the enumeration settings in the [**IWMCodecInfo3::SetCodecEnumerationSetting**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmcodecinfo3-setcodecenumerationsetting) method.</span></span> <span data-ttu-id="3438a-153">Defina g \_ wszVBREnabled como true e defina g \_ wszNumPasses como 1 para VBR com base em qualidade ou 2 para VBR de duas passagens (restrita ou irrestrita).</span><span class="sxs-lookup"><span data-stu-id="3438a-153">Set g\_wszVBREnabled to True, and set g\_wszNumPasses to 1 for quality-based VBR or 2 for two-pass VBR (constrained or unconstrained).</span></span> <span data-ttu-id="3438a-154">Se você estiver usando uma taxa de bits de passagem dupla restrita, deverá definir manualmente a janela de buffer e a taxa de bit máxima para o fluxo usando os métodos de [**IWMPropertyVault**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmpropertyvault) , conforme descrito em [Configurando fluxos de VBR](configuring-vbr-streams.md).</span><span class="sxs-lookup"><span data-stu-id="3438a-154">If you are using constrained two-pass VBR, you must manually set the maximum bit rate and buffer window for the stream using the methods of [**IWMPropertyVault**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmpropertyvault) as described in [Configuring VBR Streams](configuring-vbr-streams.md).</span></span>

<span data-ttu-id="3438a-155">Em perfis de VBR com base em qualidade, o membro **nAvgBytesPerSec** da estrutura **WAVEFORMATEX** contém o nível de qualidade (de 1 a 100) no byte de ordem inferior e os três bytes de ordem superior são definidos como 0x7fffff.</span><span class="sxs-lookup"><span data-stu-id="3438a-155">In quality-based VBR profiles, the **nAvgBytesPerSec** member of the **WAVEFORMATEX** structure contains the quality level (1 through 100) in the low-order byte and the three high-order bytes are set to 0x7fffff.</span></span> <span data-ttu-id="3438a-156">Não tente modificar a configuração de qualidade modificando esse valor manualmente; Você deve usar o formato conforme ele é recuperado do codec.</span><span class="sxs-lookup"><span data-stu-id="3438a-156">Do not attempt to modify the quality setting by modifying this value manually; you must use the format as it is retrieved from the codec.</span></span> <span data-ttu-id="3438a-157">Para usar um valor de qualidade diferente, você deve enumerar formatos até encontrar um que atenda às suas necessidades.</span><span class="sxs-lookup"><span data-stu-id="3438a-157">To use a different quality value, you must enumerate formats until you find one that meets your needs.</span></span> <span data-ttu-id="3438a-158">Além disso, o **nAvgBytesPerSec** não será preservado no arquivo ASF; Quando você obtém a estrutura **WAVEFORMATEX** para um arquivo que foi aberto com o objeto leitor, **nAvgBytesPerSec** contém um valor aproximado que representa o número médio de bytes por segundo.</span><span class="sxs-lookup"><span data-stu-id="3438a-158">Also, **nAvgBytesPerSec** will not be preserved in the ASF file; when you obtain the **WAVEFORMATEX** structure for a file that has been opened with the reader object, **nAvgBytesPerSec** contains an approximate value representing the average number of bytes per second.</span></span>

> [!Note]  
> <span data-ttu-id="3438a-159">Ao configurar fluxos de áudio, você nunca deve ter um valor de janela de buffer de áudio maior que o valor de fluxos de vídeo no arquivo.</span><span class="sxs-lookup"><span data-stu-id="3438a-159">When configuring audio streams, you should never have an audio buffer window value that is greater than the value for any video streams in the file.</span></span> <span data-ttu-id="3438a-160">Normalmente, isso não é um problema, pois os valores de janela do buffer de áudio devem variar entre 1,5 e 3 segundos e os valores de vídeo devem variar entre 3 e 5 segundos.</span><span class="sxs-lookup"><span data-stu-id="3438a-160">Normally this is not an issue, as audio buffer window values should range between 1.5 and 3 seconds and video values should range between 3 and 5 seconds.</span></span> <span data-ttu-id="3438a-161">Se uma janela de buffer de áudio for maior que uma janela de buffer de vídeo, o arquivo será reproduzido com os fluxos um pouco fora de sincronização.</span><span class="sxs-lookup"><span data-stu-id="3438a-161">If an audio buffer window is greater than a video buffer window, the file will play back with the streams slightly out of synchronization.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="3438a-162">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="3438a-162">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="3438a-163">**Configuração comum a todos os fluxos**</span><span class="sxs-lookup"><span data-stu-id="3438a-163">**Configuration Common to All Streams**</span></span>](configuration-common-to-all-streams.md)
</dt> <dt>

[<span data-ttu-id="3438a-164">**Configurando fluxos**</span><span class="sxs-lookup"><span data-stu-id="3438a-164">**Configuring Streams**</span></span>](configuring-streams.md)
</dt> <dt>

[<span data-ttu-id="3438a-165">**Para localizar formatos de áudio**</span><span class="sxs-lookup"><span data-stu-id="3438a-165">**To Find Audio Formats**</span></span>](to-find-audio-formats.md)
</dt> </dl>

 

 