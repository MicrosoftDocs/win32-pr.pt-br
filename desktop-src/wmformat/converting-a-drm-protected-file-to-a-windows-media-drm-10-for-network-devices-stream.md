---
title: Convertendo um arquivo de DRM-Protected em um fluxo do Windows Media DRM 10 para dispositivos de rede
description: Convertendo um arquivo de DRM-Protected em um fluxo do Windows Media DRM 10 para dispositivos de rede
ms.assetid: 11aa0cfd-6d87-4ec4-82d8-db2507402911
keywords:
- SDK do Windows Media Format, convertendo arquivos protegidos por DRM
- SDK do Windows Media Format, arquivos protegidos por DRM
- ASF (Advanced Systems Format), convertendo arquivos protegidos por DRM
- ASF (formato de sistemas avançados), convertendo arquivos protegidos por DRM
- ASF (Advanced Systems Format), arquivos protegidos por DRM
- ASF (formato de sistemas avançados), arquivos protegidos por DRM
- DRM (gerenciamento de direitos digitais), convertendo arquivos protegidos por DRM
- DRM (gerenciamento de direitos digitais), convertendo arquivos protegidos por DRM
- DRM (gerenciamento de direitos digitais), arquivos protegidos por DRM
- DRM (gerenciamento de direitos digitais), arquivos protegidos por DRM
- SDK do Windows Media Format, Windows Media DRM 10 para dispositivos de rede
- SDK do Windows Media Format, DRM 10 para dispositivos de rede
- ASF (Advanced Systems Format), Windows Media DRM 10 para dispositivos de rede
- ASF (formato de sistemas avançados), Windows Media DRM 10 para dispositivos de rede
- Formato de sistema avançado (ASF), DRM 10 para dispositivos de rede
- Formato ASF 10 para dispositivos de rede
- DRM (gerenciamento de direitos digitais), Windows Media DRM 10 para dispositivos de rede
- DRM (gerenciamento de direitos digitais), Windows Media DRM 10 para dispositivos de rede
- DRM (gerenciamento de direitos digitais), DRM 10 para dispositivos de rede
- DRM (gerenciamento de direitos digitais), DRM 10 para dispositivos de rede
- Windows Media DRM 10 para dispositivos de rede, convertendo arquivos protegidos por DRM
- DRM 10 para dispositivos de rede, convertendo arquivos protegidos por DRM
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 644c1b4f7ede688434fbb1dde11b7051c6f644a5
ms.sourcegitcommit: 48d1c892045445bcbd0f22bafa2fd3861ffaa6e7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 02/19/2020
ms.locfileid: "103640171"
---
# <a name="converting-a-drm-protected-file-to-a-windows-media-drm-10-for-network-devices-stream"></a><span data-ttu-id="4a601-125">Convertendo um arquivo de DRM-Protected em um fluxo do Windows Media DRM 10 para dispositivos de rede</span><span class="sxs-lookup"><span data-stu-id="4a601-125">Converting a DRM-Protected File to a Windows Media DRM 10 for Network Devices Stream</span></span>

<span data-ttu-id="4a601-126">Depois que um dispositivo é registrado e validado, você pode começar a processar mensagens de solicitação de licença dele.</span><span class="sxs-lookup"><span data-stu-id="4a601-126">After a device is registered and validated, you can begin processing license request messages from it.</span></span> <span data-ttu-id="4a601-127">As mensagens de solicitação de licença são enviadas pelos dispositivos quando a ação do aplicativo é necessária.</span><span class="sxs-lookup"><span data-stu-id="4a601-127">License request messages are sent by devices when action from the application is needed.</span></span> <span data-ttu-id="4a601-128">A única ação com suporte no momento é "Play", que é uma solicitação de dados seguros para reprodução.</span><span class="sxs-lookup"><span data-stu-id="4a601-128">The only action currently supported is "Play", which is a request for secure data for playback.</span></span>

<span data-ttu-id="4a601-129">Ao receber uma mensagem de solicitação de licença, você deve executar as seguintes etapas:</span><span class="sxs-lookup"><span data-stu-id="4a601-129">When you receive a license request message, you should perform the following steps:</span></span>

1.  <span data-ttu-id="4a601-130">Analise a mensagem de solicitação de licença chamando o método [**IWMDRMMessageParser::P arselicenserequestmsg**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmmessageparser-parselicenserequestmsg) .</span><span class="sxs-lookup"><span data-stu-id="4a601-130">Parse the license request message by calling the [**IWMDRMMessageParser::ParseLicenseRequestMsg**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmmessageparser-parselicenserequestmsg) method.</span></span>
2.  <span data-ttu-id="4a601-131">Obtenha a interface [**IWMRegisteredDevice**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmregistereddevice) para o dispositivo chamando o método [**IWMDeviceRegistration:: GetRegisteredDeviceByID**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdeviceregistration-getregistereddevicebyid) , passando o certificado e o número de série obtidos na etapa 1.</span><span class="sxs-lookup"><span data-stu-id="4a601-131">Get the [**IWMRegisteredDevice**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmregistereddevice) interface for the device by calling the [**IWMDeviceRegistration::GetRegisteredDeviceByID**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdeviceregistration-getregistereddevicebyid) method, passing in the certificate and serial number obtained in step 1.</span></span>
3.  <span data-ttu-id="4a601-132">Verifique se o dispositivo está pronto para receber dados seguros:</span><span class="sxs-lookup"><span data-stu-id="4a601-132">Verify that the device is ready to receive secure data:</span></span>
    -   <span data-ttu-id="4a601-133">Chame [**IWMRegisteredDevice:: IsApproved**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isapproved) para verificar se o dispositivo foi aprovado.</span><span class="sxs-lookup"><span data-stu-id="4a601-133">Call [**IWMRegisteredDevice::IsApproved**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isapproved) to verify that the device has been approved.</span></span> <span data-ttu-id="4a601-134">A aprovação deve sempre ser baseada na preferência do usuário.</span><span class="sxs-lookup"><span data-stu-id="4a601-134">Approval should always be based on user preference.</span></span>
    -   <span data-ttu-id="4a601-135">Chame [**IWMRegisteredDevice:: IsValid**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isvalid) para verificar se o dispositivo foi validado nas últimas 48 horas.</span><span class="sxs-lookup"><span data-stu-id="4a601-135">Call [**IWMRegisteredDevice::IsValid**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isvalid) to verify that the device has been validated within the last 48 hours.</span></span> <span data-ttu-id="4a601-136">Se o dispositivo não for válido, você precisará executar a detecção de proximidade.</span><span class="sxs-lookup"><span data-stu-id="4a601-136">If the device is not valid, you need to perform proximity detection.</span></span> <span data-ttu-id="4a601-137">Para obter mais informações, consulte [executando a detecção de proximidade](performing-proximity-detection.md).</span><span class="sxs-lookup"><span data-stu-id="4a601-137">For more information, see [Performing Proximity Detection](performing-proximity-detection.md).</span></span>
    -   <span data-ttu-id="4a601-138">Chame [**IWMRegisteredDevice:: Isopend**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isopened) para verificar se o dispositivo foi aberto.</span><span class="sxs-lookup"><span data-stu-id="4a601-138">Call [**IWMRegisteredDevice::IsOpened**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isopened) to verify that the device has been opened.</span></span> <span data-ttu-id="4a601-139">Se o dispositivo não estiver aberto, você poderá abri-lo chamando [**IWMRegisteredDevice:: Open**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-open).</span><span class="sxs-lookup"><span data-stu-id="4a601-139">If the device is not open, you can open it by calling [**IWMRegisteredDevice::Open**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-open).</span></span> <span data-ttu-id="4a601-140">Você só pode ter 10 dispositivos abertos no computador por vez.</span><span class="sxs-lookup"><span data-stu-id="4a601-140">You can only have 10 devices open on the computer at a time.</span></span> <span data-ttu-id="4a601-141">É possível que você precise fechar outro dispositivo antes de poder abrir aquele para o qual você está processando a solicitação.</span><span class="sxs-lookup"><span data-stu-id="4a601-141">It is possible that you may need to close another device before you can open the one for which you are processing the request.</span></span> <span data-ttu-id="4a601-142">Para fechar um dispositivo, chame o método [**IWMRegisteredDevice:: Close**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-close) .</span><span class="sxs-lookup"><span data-stu-id="4a601-142">To close a device, call the [**IWMRegisteredDevice::Close**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-close) method.</span></span>
4.  <span data-ttu-id="4a601-143">Crie uma instância do objeto de transcriptografador DRM chamando a função [**WMCreateDRMTranscryptor**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-wmcreatedrmtranscryptor) .</span><span class="sxs-lookup"><span data-stu-id="4a601-143">Create an instance of the DRM transcryptor object by calling the [**WMCreateDRMTranscryptor**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-wmcreatedrmtranscryptor) function.</span></span>
5.  <span data-ttu-id="4a601-144">Chame o método [**IWMDRMTranscryptor:: Initialize**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-initialize) para inicializar o transcriptr.</span><span class="sxs-lookup"><span data-stu-id="4a601-144">Call the [**IWMDRMTranscryptor::Initialize**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-initialize) method to initialize the transcryptor.</span></span> <span data-ttu-id="4a601-145">Esse método usa um ponteiro para a implementação da interface [**IWMStatusCallback**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmstatuscallback) , que ele usa para entregar mensagens de status.</span><span class="sxs-lookup"><span data-stu-id="4a601-145">This method takes a pointer to your implementation of the [**IWMStatusCallback**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmstatuscallback) interface, which it uses to deliver status messages.</span></span> <span data-ttu-id="4a601-146">Esse método também retorna uma mensagem de solicitação de licença que deve ser enviada para o dispositivo antes de continuar.</span><span class="sxs-lookup"><span data-stu-id="4a601-146">This method also returns a license request message that must be sent to the device before continuing.</span></span>
6.  <span data-ttu-id="4a601-147">Quando o método [**IWMStatusCallback:: OnStatus**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmstatuscallback-onstatus) do seu aplicativo receber a \_ mensagem de status de inicialização do transcriptr do WMT \_ , chame o método [**IWMDRMTranscryptor:: Seek**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-seek) para buscar a posição inicial apropriada no arquivo.</span><span class="sxs-lookup"><span data-stu-id="4a601-147">When your application's [**IWMStatusCallback::OnStatus**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmstatuscallback-onstatus) method receives the WMT\_TRANSCRYPTOR\_INIT status message, call the [**IWMDRMTranscryptor::Seek**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-seek) method to seek to the appropriate start position in the file.</span></span> <span data-ttu-id="4a601-148">Para iniciar no início do arquivo, você deve chamar **Seek** com o tempo 0.</span><span class="sxs-lookup"><span data-stu-id="4a601-148">To start at the beginning of the file, you must call **Seek** with time 0.</span></span>
7.  <span data-ttu-id="4a601-149">O transcriptografador envia uma mensagem de descriptografia WMT \_ \_ quando está pronto para entregar dados do arquivo no novo horário de apresentação.</span><span class="sxs-lookup"><span data-stu-id="4a601-149">The transcryptor sends a WMT\_TRANSCRYPTOR\_SEEKED message when it is ready to deliver data from the file at the new presentation time.</span></span> <span data-ttu-id="4a601-150">Faça chamadas repetidas para o método [**IWMDRMTranscryptor:: Read**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-read) para obter partes convertidas de dados de mídia.</span><span class="sxs-lookup"><span data-stu-id="4a601-150">Make repeated calls to the [**IWMDRMTranscryptor::Read**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-read) method to get converted chunks of media data.</span></span> <span data-ttu-id="4a601-151">Cada chamada é assíncrona e não é concluída até que uma mensagem de leitura do transWMTn \_ \_ seja recebida.</span><span class="sxs-lookup"><span data-stu-id="4a601-151">Each call is asynchronous and is not complete until a WMT\_TRANSCRYPTOR\_READ message is received.</span></span> <span data-ttu-id="4a601-152">Ao receber a mensagem, você pode enviar os dados para o dispositivo receptor.</span><span class="sxs-lookup"><span data-stu-id="4a601-152">When you receive the message, you can send the data to the receiving device.</span></span>
8.  <span data-ttu-id="4a601-153">Quando você recebe uma mensagem de leitura do transWMTer \_ \_ com o parâmetro *HR* definido como \_ EOF do \_ transcriptr NS S \_ , todo o arquivo foi lido.</span><span class="sxs-lookup"><span data-stu-id="4a601-153">When you receive a WMT\_TRANSCRYPTOR\_READ message with the *hr* parameter set to NS\_S\_TRANSCRYPTOR\_EOF, the entire file has been read.</span></span> <span data-ttu-id="4a601-154">Neste ponto, chame o método [**IWMDRMTranscryptor:: Close**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-close) para fechar o arquivo e liberar recursos.</span><span class="sxs-lookup"><span data-stu-id="4a601-154">At this point, call the [**IWMDRMTranscryptor::Close**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-close) method to close the file and free resources.</span></span>
9.  <span data-ttu-id="4a601-155">Quando a mensagem de descriptografia de WMT \_ \_ fechada é recebida, você pode liberar a interface [**IWMDRMTranscryptor**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmdrmtranscryptor) .</span><span class="sxs-lookup"><span data-stu-id="4a601-155">When the WMT\_TRANSCRYPTOR\_CLOSED message is received, you can release the [**IWMDRMTranscryptor**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmdrmtranscryptor) interface.</span></span>

> [!Note]  
> <span data-ttu-id="4a601-156">O DRM não é compatível com a versão baseada em x64 deste SDK.</span><span class="sxs-lookup"><span data-stu-id="4a601-156">DRM is not supported by the x64-based version of this SDK.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="4a601-157">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="4a601-157">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="4a601-158">**Usando o protocolo Windows Media DRM 10 para dispositivos de rede**</span><span class="sxs-lookup"><span data-stu-id="4a601-158">**Using the Windows Media DRM 10 for Network Devices Protocol**</span></span>](using-the-windows-media-drm-10-for-network-devices-protocol.md)
</dt> </dl>

 

 




