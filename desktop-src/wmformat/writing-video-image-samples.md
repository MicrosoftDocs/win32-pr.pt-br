---
title: Escrevendo amostras de imagens de vídeo
description: Escrevendo amostras de imagens de vídeo
ms.assetid: 1d375186-230a-4a18-a995-b331c72a76e7
keywords:
- ASF (Advanced Systems Format), escrevendo amostras de imagens de vídeo
- ASF (formato de sistemas avançados), escrevendo amostras de imagens de vídeo
- imagens de vídeo, como escrever amostras
- fluxos, escrevendo amostras de imagens de vídeo
- codecs, escrevendo amostras de imagens de vídeo
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0fbac644d7938477ba3d2e8b21ebb6e631a47708
ms.sourcegitcommit: 48d1c892045445bcbd0f22bafa2fd3861ffaa6e7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 02/19/2020
ms.locfileid: "104293764"
---
# <a name="writing-video-image-samples"></a><span data-ttu-id="8d830-108">Escrevendo amostras de imagens de vídeo</span><span class="sxs-lookup"><span data-stu-id="8d830-108">Writing Video Image Samples</span></span>

<span data-ttu-id="8d830-109">Um fluxo de imagem de vídeo é um vídeo que contém uma série de imagens ainda.</span><span class="sxs-lookup"><span data-stu-id="8d830-109">A Video Image stream is a video that contains a series of still images.</span></span> <span data-ttu-id="8d830-110">As imagens podem ser movidas dentro do quadro e cada imagem pode misturar para a próxima.</span><span class="sxs-lookup"><span data-stu-id="8d830-110">The images can move within the frame, and each image can blend into the next.</span></span> <span data-ttu-id="8d830-111">Os fluxos de imagem de vídeo são codificados usando o codec do Windows Media Video 9 Image v2.</span><span class="sxs-lookup"><span data-stu-id="8d830-111">Video Image streams are encoded using the Windows Media Video 9 Image v2 codec.</span></span> <span data-ttu-id="8d830-112">O vídeo de saída é semelhante ao criado pelo codec do Windows Media Video 9.</span><span class="sxs-lookup"><span data-stu-id="8d830-112">The output video is similar to that created by the Windows Media Video 9 codec.</span></span>

<span data-ttu-id="8d830-113">Para criar um perfil que contenha um fluxo de imagem de vídeo, comece enumerando os codecs de vídeo, conforme descrito em [obtendo informações de configuração de fluxo de codecs](getting-stream-configuration-information-from-codecs.md).</span><span class="sxs-lookup"><span data-stu-id="8d830-113">To create a profile that contains a Video Image stream, start by enumerating the video codecs as described in [Getting Stream Configuration Information from Codecs](getting-stream-configuration-information-from-codecs.md).</span></span> <span data-ttu-id="8d830-114">Procure o codec que dá suporte ao \_ subtipo WMMEDIASUBTYPE WVP2.</span><span class="sxs-lookup"><span data-stu-id="8d830-114">Search for the codec that supports the WMMEDIASUBTYPE\_WVP2 subtype.</span></span>

<span data-ttu-id="8d830-115">Depois de definir o perfil no objeto do gravador, chame [**IWMWriter:: GetInputProps**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmwriter-getinputprops) para obter as propriedades de mídia para o fluxo de entrada da imagem de vídeo.</span><span class="sxs-lookup"><span data-stu-id="8d830-115">After you set the profile on the writer object, call [**IWMWriter::GetInputProps**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmwriter-getinputprops) to get the media properties for the Video Image input stream.</span></span> <span data-ttu-id="8d830-116">Obtenha o tipo de mídia do objeto de propriedades de mídia chamando [**IWMMediaProps:: GetMediaType**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-getmediatype)e altere o subtipo para WMMEDIASUBTYPE \_ VIDEOIMAGE.</span><span class="sxs-lookup"><span data-stu-id="8d830-116">Get the media type from the media properties object, by calling [**IWMMediaProps::GetMediaType**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-getmediatype), and change the subtype to WMMEDIASUBTYPE\_VIDEOIMAGE.</span></span> <span data-ttu-id="8d830-117">Você deve definir a largura e a altura do vídeo para as dimensões máximas necessárias para abranger as imagens que serão adicionadas ao fluxo.</span><span class="sxs-lookup"><span data-stu-id="8d830-117">You should set the video width and height to the maximum dimensions needed to encompass the images you will add to the stream.</span></span> <span data-ttu-id="8d830-118">Em seguida, chame [**IWMMediaProps:: SetMediaType**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-setmediatype) com o tipo de entrada modificado.</span><span class="sxs-lookup"><span data-stu-id="8d830-118">Then call [**IWMMediaProps::SetMediaType**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-setmediatype) with the modified input type.</span></span> <span data-ttu-id="8d830-119">Agora você está pronto para começar a enviar amostras para o objeto gravador.</span><span class="sxs-lookup"><span data-stu-id="8d830-119">Now you are ready to begin sending samples to the writer object.</span></span>

<span data-ttu-id="8d830-120">Cada exemplo deve começar com uma estrutura **WMT \_ VIDEOIMAGE \_ SAMPLE2** .</span><span class="sxs-lookup"><span data-stu-id="8d830-120">Each sample must begin with a **WMT\_VIDEOIMAGE\_SAMPLE2** structure.</span></span> <span data-ttu-id="8d830-121">Além disso, os exemplos podem conter imagens de bitmap.</span><span class="sxs-lookup"><span data-stu-id="8d830-121">Additionally, samples may contain bitmap images.</span></span> <span data-ttu-id="8d830-122">Uma imagem é anexada apenas a um exemplo do primeiro quadro no qual ela aparece.</span><span class="sxs-lookup"><span data-stu-id="8d830-122">An image is only attached to a sample for the first frame in which it appears.</span></span> <span data-ttu-id="8d830-123">Todos os quadros adicionais que usam essa imagem precisam apenas de informações na estrutura.</span><span class="sxs-lookup"><span data-stu-id="8d830-123">All additional frames using that image need only information in the structure.</span></span> <span data-ttu-id="8d830-124">Os bitmaps de entrada devem ser formatados como RGB, 24 bits por pixel.</span><span class="sxs-lookup"><span data-stu-id="8d830-124">Input bitmaps must be formatted as RGB, 24 bits per pixel.</span></span>

<span data-ttu-id="8d830-125">Os arquivos de bitmap armazenam os dados da imagem para que os dados de cada linha da imagem demorem um número de bytes divisível por quatro.</span><span class="sxs-lookup"><span data-stu-id="8d830-125">Bitmap files store the image data so that the data for each row of the image takes a number of bytes divisible by four.</span></span> <span data-ttu-id="8d830-126">(Isso é chamado de Stride do bitmap.) Isso força o início de cada linha de vídeo a um limite **DWORD** , o que torna a cópia mais eficiente.</span><span class="sxs-lookup"><span data-stu-id="8d830-126">(This is called the stride of the bitmap.) This forces the beginning of every row of video to a **DWORD** boundary, which makes copying more efficient.</span></span> <span data-ttu-id="8d830-127">Se as linhas de imagem não forem divisíveis igualmente por quatro, a linha será preenchida para o próximo múltiplo mais alto de quatro bytes.</span><span class="sxs-lookup"><span data-stu-id="8d830-127">If the image rows are not evenly divisible by four, the row is padded to the next highest multiple of four bytes.</span></span> <span data-ttu-id="8d830-128">Ao anexar dados de imagem, você deve remover qualquer preenchimento que exista no final dos dados para cada linha.</span><span class="sxs-lookup"><span data-stu-id="8d830-128">When you attach image data, you must remove any padding that exists at the end of the data for each row.</span></span>

<span data-ttu-id="8d830-129">O codec Windows Media Video 9 Image v2 mantém até duas imagens na memória por vez.</span><span class="sxs-lookup"><span data-stu-id="8d830-129">The Windows Media Video 9 Image v2 codec maintains up to two images in memory at a time.</span></span> <span data-ttu-id="8d830-130">Essas imagens são chamadas de imagem anterior e imagem atual.</span><span class="sxs-lookup"><span data-stu-id="8d830-130">These images are called the previous image and the current image.</span></span> <span data-ttu-id="8d830-131">Cada imagem tem um conjunto de membros na estrutura **WMT \_ VIDEOIMAGE \_ SAMPLE2** , que determinam como a imagem é apresentada no quadro.</span><span class="sxs-lookup"><span data-stu-id="8d830-131">Each image has a set of members in the **WMT\_VIDEOIMAGE\_SAMPLE2** structure, which dictate how the image is presented in the frame.</span></span> <span data-ttu-id="8d830-132">Você pode adicionar uma imagem definindo o membro dwControlFlags de **WMT \_ VIDEOIMAGE \_ SAMPLE2** no quadro de \_ entrada de exemplo WMT VIDEOIMAGE \_ \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="8d830-132">You can add an image by setting the dwControlFlags member of **WMT\_VIDEOIMAGE\_SAMPLE2** to WMT\_VIDEOIMAGE\_SAMPLE\_INPUT\_FRAME.</span></span> <span data-ttu-id="8d830-133">Quando você passa um quadro de entrada para o codec, essa imagem torna-se a imagem atual.</span><span class="sxs-lookup"><span data-stu-id="8d830-133">When you pass an input frame to the codec, that image becomes the current image.</span></span> <span data-ttu-id="8d830-134">A imagem que era a imagem atual no exemplo anterior geralmente se torna a imagem anterior e a imagem que foi a imagem anterior no exemplo anterior é descartada.</span><span class="sxs-lookup"><span data-stu-id="8d830-134">The image that was the current image in the previous sample usually becomes the previous image, and the image that was the previous image in the previous sample is discarded.</span></span> <span data-ttu-id="8d830-135">Você pode configurar o codec para manter a imagem anterior antiga definindo o membro **bKeepPrevImage** como **true**.</span><span class="sxs-lookup"><span data-stu-id="8d830-135">You can configure the codec to retain the old previous image by setting the **bKeepPrevImage** member to **TRUE**.</span></span> <span data-ttu-id="8d830-136">Nesse caso, a imagem que foi a imagem atual no exemplo anterior é descartada.</span><span class="sxs-lookup"><span data-stu-id="8d830-136">In that case, the image that was the current image in the previous sample is discarded.</span></span>

<span data-ttu-id="8d830-137">A composição básica de um quadro de imagem de vídeo é determinada por dois fatores para cada imagem: região de interesse e coeficiente de mistura.</span><span class="sxs-lookup"><span data-stu-id="8d830-137">The basic composition of a Video Image frame is determined by two factors for each image: region of interest and blend coefficient.</span></span> <span data-ttu-id="8d830-138">A região de interesse de uma imagem é definida por um ponto de origem, largura e altura.</span><span class="sxs-lookup"><span data-stu-id="8d830-138">The region of interest for an image is defined by an origin point, width, and height.</span></span> <span data-ttu-id="8d830-139">A parte de uma imagem descrita pela região de interesse preenche o quadro de saída.</span><span class="sxs-lookup"><span data-stu-id="8d830-139">The part of an image described by the region of interest fills the output frame.</span></span> <span data-ttu-id="8d830-140">Se a região de interesse for um tamanho diferente do quadro de saída, o codec o redimensionará.</span><span class="sxs-lookup"><span data-stu-id="8d830-140">If the region of interest is a different size than the output frame, the codec resizes it.</span></span> <span data-ttu-id="8d830-141">O coeficiente de mistura da imagem determina a mistura das duas imagens.</span><span class="sxs-lookup"><span data-stu-id="8d830-141">The blend coefficient of the image determines the blending of the two images.</span></span> <span data-ttu-id="8d830-142">Os coeficientes de Blend para as imagens atuais e anteriores devem totalizar 1,0.</span><span class="sxs-lookup"><span data-stu-id="8d830-142">The blend coefficients for the current and previous images must total 1.0.</span></span> <span data-ttu-id="8d830-143">Por exemplo, se **fCurrBlendCoef** for definido como 0,5 e **fPrevBlendCoef** for definido como 0,5, o quadro de saída será composto de uma combinação igual das regiões de interesse de ambas as imagens.</span><span class="sxs-lookup"><span data-stu-id="8d830-143">For example, if **fCurrBlendCoef** is set to 0.5 and **fPrevBlendCoef** is set to 0.5, then the output frame is composed of an equal blend of the regions of interest from both images.</span></span>

<span data-ttu-id="8d830-144">Ao manipular a região de interesse de uma imagem, você pode criar efeitos panorâmicos e de zoom.</span><span class="sxs-lookup"><span data-stu-id="8d830-144">By manipulating the region of interest for an image, you can create pan and zoom effects.</span></span> <span data-ttu-id="8d830-145">Os coeficientes de Blend permitem que você entre gradualmente (dissolver) entre imagens.</span><span class="sxs-lookup"><span data-stu-id="8d830-145">The blend coefficients enable you to cross-fade (dissolve) between images.</span></span> <span data-ttu-id="8d830-146">Além desses efeitos, você pode usar uma das transições predefinidas para criar quadros mais complexos.</span><span class="sxs-lookup"><span data-stu-id="8d830-146">In addition to these effects, you can use one of the predefined transitions to create more complex frames.</span></span> <span data-ttu-id="8d830-147">As transições disponíveis são descritas na seção [transições de imagem de vídeo](video-image-transitions.md) desta documentação.</span><span class="sxs-lookup"><span data-stu-id="8d830-147">The available transitions are described in the [Video Image Transitions](video-image-transitions.md) section of this documentation.</span></span> <span data-ttu-id="8d830-148">Ao usar uma transição, você deve configurar cada quadro.</span><span class="sxs-lookup"><span data-stu-id="8d830-148">When using a transition, you must configure each frame.</span></span> <span data-ttu-id="8d830-149">A maneira mais fácil de fazer isso é criar uma função que altere de forma incremental os membros da estrutura **WMT \_ VIDEOIMAGE \_ SAMPLE2** para um efeito completo.</span><span class="sxs-lookup"><span data-stu-id="8d830-149">The easiest way to do this is to create a function that incrementally changes members of the **WMT\_VIDEOIMAGE\_SAMPLE2** structure for a complete effect.</span></span>

<span data-ttu-id="8d830-150">Para obter mais informações sobre os valores a serem definidos para as deformações, consulte [**WMT \_ VIDEOIMAGE \_ SAMPLE2**](/previous-versions/windows/desktop/api/Wmsdkidl/ns-wmsdkidl-wmt_videoimage_sample2).</span><span class="sxs-lookup"><span data-stu-id="8d830-150">For more information about the values to set for deformations, see [**WMT\_VIDEOIMAGE\_SAMPLE2**](/previous-versions/windows/desktop/api/Wmsdkidl/ns-wmsdkidl-wmt_videoimage_sample2).</span></span>

<span data-ttu-id="8d830-151">**Observação** Se desejar incluir áudio em um arquivo com um fluxo de imagem de vídeo, você deverá usar a entrada de áudio não compactada.</span><span class="sxs-lookup"><span data-stu-id="8d830-151">**Note** If you want to include audio in a file with a Video Image stream, you must use uncompressed audio input.</span></span> <span data-ttu-id="8d830-152">Para combinar um fluxo de imagem de vídeo com um fluxo de áudio compactado existente, você deve descompactar o áudio e passar os exemplos em não compactado.</span><span class="sxs-lookup"><span data-stu-id="8d830-152">To combine a Video Image stream with an existing compressed audio stream, you must decompress the audio and pass the samples in uncompressed.</span></span> <span data-ttu-id="8d830-153">Se você passar amostras compactadas para o gravador ao gravar um fluxo de imagem de vídeo, ocorrerá um erro, resultando em amostras sendo descartadas do vídeo.</span><span class="sxs-lookup"><span data-stu-id="8d830-153">If you pass compressed samples to the writer when writing a Video Image stream, an error will occur, resulting in samples being dropped from the video.</span></span>

<span data-ttu-id="8d830-154">Além disso, arquivos de imagem de vídeo compactados sem fluxos de áudio podem conter vários quadros de vídeo muito pequenos e altamente compactados em um único pacote ASF, o que pode resultar em uma experiência de reprodução ruim em versões anteriores do Windows Media Player.</span><span class="sxs-lookup"><span data-stu-id="8d830-154">Also, compressed Video Image files with no audio streams can contain several very small, highly compressed video frames in a single ASF packet, which can result in a poor playback experience on previous versions of Windows Media Player.</span></span> <span data-ttu-id="8d830-155">Para evitar esse problema, a melhor solução é inserir um fluxo de áudio silencioso no arquivo, embora isso também aumente o tamanho do arquivo.</span><span class="sxs-lookup"><span data-stu-id="8d830-155">To avoid this problem, the best solution is to insert a silent audio stream into the file, although this will also increase the file size.</span></span>

## <a name="related-topics"></a><span data-ttu-id="8d830-156">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="8d830-156">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="8d830-157">**Imagem de vídeo**</span><span class="sxs-lookup"><span data-stu-id="8d830-157">**Video Image**</span></span>](video-image.md)
</dt> <dt>

[<span data-ttu-id="8d830-158">**Gravando arquivos ASF**</span><span class="sxs-lookup"><span data-stu-id="8d830-158">**Writing ASF Files**</span></span>](writing-asf-files.md)
</dt> </dl>

 

 




