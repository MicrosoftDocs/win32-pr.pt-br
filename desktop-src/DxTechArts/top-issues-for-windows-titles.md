---
title: Principais problemas de títulos do Windows
description: Este artigo destaca muitos dos problemas comuns que vimos nos jogos de PC da geração atual.
ms.assetid: 89b83473-1aa9-9a2d-8778-15cfb91cdea4
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 547c977f7d8e4895ef73ba229a9012854a7c6d27
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/20/2020
ms.locfileid: "105759000"
---
# <a name="top-issues-for-windows-titles"></a><span data-ttu-id="0ed3c-103">Principais problemas de títulos do Windows</span><span class="sxs-lookup"><span data-stu-id="0ed3c-103">Top Issues for Windows Titles</span></span>

<span data-ttu-id="0ed3c-104">O grupo de relações do desenvolvedor de tecnologias de jogos e gráficos do Microsoft Windows executa a análise de desempenho para muitos jogos do Windows por ano.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-104">The Microsoft Windows Gaming and Graphics Technologies Developer Relations group performs performance analysis for many Windows games each year.</span></span> <span data-ttu-id="0ed3c-105">Durante essas sessões, obtemos experiência prática para se juntar aos comentários e consultas do desenvolvedor que recebemos diariamente.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-105">During these sessions, we get hands-on experience to tie into the developer feedback and queries we receive daily.</span></span> <span data-ttu-id="0ed3c-106">Ocasionalmente, ajudamos a rastrear uma falha misteriosa ou outro problema em um título, que nos dá mais informações sobre problemas que os desenvolvedores estão encontrando.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-106">Occasionally we help track down a mysterious crash or other problem in a title, which gives us further insight into problems that developers are encountering.</span></span>

<span data-ttu-id="0ed3c-107">Este artigo destaca muitos dos problemas comuns que vimos nos jogos de PC da geração atual.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-107">This article highlights many of the common issues we've seen in current-generation PC games.</span></span>

-   [<span data-ttu-id="0ed3c-108">Desempenho limitado à CPU</span><span class="sxs-lookup"><span data-stu-id="0ed3c-108">CPU-Limited Performance</span></span>](#cpu-limited-performance)
-   [<span data-ttu-id="0ed3c-109">Gerenciamento de lote insatisfatório</span><span class="sxs-lookup"><span data-stu-id="0ed3c-109">Poor Batch Management</span></span>](#poor-batch-management)
-   [<span data-ttu-id="0ed3c-110">Cópia de memória excessiva</span><span class="sxs-lookup"><span data-stu-id="0ed3c-110">Excessive Memory Copying</span></span>](#excessive-memory-copying)
-   [<span data-ttu-id="0ed3c-111">Uso excessivo do envio de desenho dinâmico</span><span class="sxs-lookup"><span data-stu-id="0ed3c-111">Excessive Use of Dynamic Draw Submission</span></span>](#excessive-use-of-dynamic-draw-submission)
-   [<span data-ttu-id="0ed3c-112">Alta sobrecarga no processamento de arquivos</span><span class="sxs-lookup"><span data-stu-id="0ed3c-112">High Overhead in File Processing</span></span>](#high-overhead-in-file-processing)
-   [<span data-ttu-id="0ed3c-113">Instalação lenta e frustrante</span><span class="sxs-lookup"><span data-stu-id="0ed3c-113">Slow and Frustrating Installation</span></span>](#slow-and-frustrating-installation)
-   [<span data-ttu-id="0ed3c-114">Falta de consideração da memória física</span><span class="sxs-lookup"><span data-stu-id="0ed3c-114">Lack of Consideration of Physical Memory</span></span>](#lack-of-consideration-of-physical-memory)
-   [<span data-ttu-id="0ed3c-115">Excesso de confiança na conversão de taxa de amostragem de Real-Time áudio</span><span class="sxs-lookup"><span data-stu-id="0ed3c-115">Over-Reliance on Real-Time Audio Sample Rate Conversion</span></span>](#over-reliance-on-real-time-audio-sample-rate-conversion)
-   [<span data-ttu-id="0ed3c-116">Fragmentação da memória virtual</span><span class="sxs-lookup"><span data-stu-id="0ed3c-116">Fragmention of Virtual Memory</span></span>](#fragmention-of-virtual-memory)
-   [<span data-ttu-id="0ed3c-117">Manipulação da palavra de controle de Floating-Point</span><span class="sxs-lookup"><span data-stu-id="0ed3c-117">Manipulation of the Floating-Point Control Word</span></span>](#manipulation-of-the-floating-point-control-word)
-   [<span data-ttu-id="0ed3c-118">Instalação opcional do tempo de execução do DirectX</span><span class="sxs-lookup"><span data-stu-id="0ed3c-118">Optional Installation of the DirectX Runtime</span></span>](#optional-installation-of-the-directx-runtime)
-   [<span data-ttu-id="0ed3c-119">Uso excessivo da sincronização de threads</span><span class="sxs-lookup"><span data-stu-id="0ed3c-119">Excessive Use of Thread Synchronization</span></span>](#excessive-use-of-thread-synchronization)
-   [<span data-ttu-id="0ed3c-120">Uso de RDTSC</span><span class="sxs-lookup"><span data-stu-id="0ed3c-120">Use of RDTSC</span></span>](#use-of-rdtsc)

## <a name="cpu-limited-performance"></a><span data-ttu-id="0ed3c-121">Desempenho de CPU-Limited</span><span class="sxs-lookup"><span data-stu-id="0ed3c-121">CPU-Limited Performance</span></span>

<span data-ttu-id="0ed3c-122">A grande maioria dos jogos é limitada pelo desempenho da CPU em sistemas com GPUs (unidades de processamento gráfico) de alto desempenho.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-122">The vast majority of games are limited by CPU performance on systems with high-performance graphics processing units (GPUs).</span></span> <span data-ttu-id="0ed3c-123">Isso às vezes é devido ao uso insatisfatório de envio em lote para envio de empates, mas, mais geralmente, isso se deve a outros sistemas de jogos consumindo uma grande parte dos ciclos de CPU disponíveis.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-123">This is sometimes due to poor use of batching for draw submissions, but more typically, this is due to other game systems consuming a large portion of the available CPU cycles.</span></span> <span data-ttu-id="0ed3c-124">Nos poucos casos em que vimos a GPU como a limitação, a causa é uma taxa de preenchimento muito alta ou a demanda do sombreador de pixel, em configurações de alta resolução ou baixo desempenho do sombreador de vértice por uma placa de vídeo.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-124">In the few cases in which we have seen the GPU as the limitation, the cause is very high fill rates or pixel shader demand, in high-resolution settings, or low vertex-shader performance by a video card.</span></span>

<span data-ttu-id="0ed3c-125">Como a maioria dos títulos é limitada por CPU, o maior desempenho vence da otimização de sistemas de jogos com uso intensivo de CPU.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-125">Because most titles are CPU-limited, the biggest performance wins come from optimizing CPU-intensive game systems.</span></span> <span data-ttu-id="0ed3c-126">Normalmente, os sistemas de ia ou de física e a lógica de detecção de colisão associada são os principais consumidores de ciclos de CPU que se comportam com aplicativos Microsoft Direct3D.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-126">Typically, the AI or physics systems and the associated collision-detection logic are the primary consumers of CPU cycles in well-behaving Microsoft Direct3D applications.</span></span> <span data-ttu-id="0ed3c-127">Qualquer trabalho para melhorar esses sistemas pode melhorar o desempenho geral do jogo.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-127">Any work to improve these systems can improve the overall performance of the game.</span></span>

## <a name="poor-batch-management"></a><span data-ttu-id="0ed3c-128">Gerenciamento de lote insatisfatório</span><span class="sxs-lookup"><span data-stu-id="0ed3c-128">Poor Batch Management</span></span>

<span data-ttu-id="0ed3c-129">Atingir um bom paralelismo com a GPU exige que os lotes de desenho contenham geometria suficiente – e os sombreadores tenham a complexidade certa — para manter a placa de vídeo ocupada, sem usar tantos lotes que o buffer de comando é inundado.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-129">Achieving good parallelism with the GPU requires that draw batches contain enough geometry — and the shaders have the right complexity — to keep the video card busy, while not using so many batches that the command buffer is flooded.</span></span> <span data-ttu-id="0ed3c-130">Em hardware de geração atual, recomendamos aproximadamente 300 ou menos envios de lote de empates por quadro (menos em CPUs de desempenho inferior) para impedir que o processamento do driver do buffer de comando se torne um afunilamento de desempenho.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-130">On current-generation hardware, we recommend approximately 300 or fewer draw-batch submissions per frame (fewer on lower-performance CPUs) to prevent the driver's processing of the command-buffer from becoming a performance bottleneck.</span></span> <span data-ttu-id="0ed3c-131">Algumas outras chamadas de estado de API e combinações de driver podem resultar em um alto processamento de CPU (driver de compilação de sombreadores, por exemplo), portanto, é altamente recomendável analisar a rotina de desempenho.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-131">Some other API state calls and driver combinations can result in costly CPU processing (driver compiling of shaders, for example), so we highly recommend routine performance analysis.</span></span>

## <a name="excessive-memory-copying"></a><span data-ttu-id="0ed3c-132">Cópia de memória excessiva</span><span class="sxs-lookup"><span data-stu-id="0ed3c-132">Excessive Memory Copying</span></span>

<span data-ttu-id="0ed3c-133">Durante o desenvolvimento da maioria dos títulos de PC, os desenvolvedores usam estruturas de dados e cadeias de caracteres convenientes para o gerenciamento de conteúdo.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-133">During the development of most PC titles, developers use convenient data structures and strings for content management.</span></span> <span data-ttu-id="0ed3c-134">O trabalho de CPU necessário para comparação de cadeias de caracteres, cópia e outras manipulações geralmente tem uma sobrecarga mensurável, especialmente ao levar em conta as ocorrências de desempenho associadas ao subsistema de cache e memória.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-134">The CPU work required for string comparison, copying, and other manipulations often has a measurable overhead, particularly when taking into account the performance hits associated with the cache and memory subsystem.</span></span> <span data-ttu-id="0ed3c-135">Os planos devem ser feitos ao desenvolver esses sistemas para remover ou minimizar a dependência no processamento de cadeias de caracteres quando o produto entrar nas fases de teste e versão principais.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-135">Plans should be made when developing these systems for removing or minimizing the reliance on string processing once the product enters into the primary testing and release phases.</span></span>

## <a name="excessive-use-of-dynamic-draw-submission"></a><span data-ttu-id="0ed3c-136">Uso excessivo do envio de desenho dinâmico</span><span class="sxs-lookup"><span data-stu-id="0ed3c-136">Excessive Use of Dynamic Draw Submission</span></span>

<span data-ttu-id="0ed3c-137">O hardware de vídeo moderno funciona bem ao lidar com dados estáticos.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-137">Modern video hardware performs well when dealing with static data.</span></span> <span data-ttu-id="0ed3c-138">Os adaptadores high-end geralmente têm uma quantidade muito grande de memória de vídeo, mas essa memória não pode ser efetivamente utilizada por dados dinâmicos.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-138">High-end adapters often have a very large amount of video memory, but this memory cannot be effectively utilized by dynamic data.</span></span>

<span data-ttu-id="0ed3c-139">Embora padrões de uso razoavelmente eficientes de buffers de vértice dinâmicos/buffers de índice possam ser implementados para conteúdo dinâmico, muitos títulos estão contratando esse idioma para o que é conteúdo estático de outra forma.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-139">While reasonably efficient usage patterns of dynamic vertex buffers/index buffers can be implemented for dynamic content, many titles overuse this idiom for what is otherwise static content.</span></span> <span data-ttu-id="0ed3c-140">Geralmente vemos isso com árvores de particionamento de espaço binário (BSP) e sistemas baseados em portal que armazenam geometria em uma estrutura de dados que não mapeia para o hardware e que devem ser processados em buffers para cada quadro.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-140">We most often see this with binary space partitioning (BSP) trees and portal-based systems that store geometry in a data structure that does not map to the hardware and must be processed into buffers for every frame.</span></span> <span data-ttu-id="0ed3c-141">Colocar o máximo de conteúdo em recursos estáticos como possível pode reduzir significativamente a sobrecarga de largura de banda da transferência de dados para a placa de vídeo, fazer melhor uso do VRAM integrado e reduzir a sobrecarga de CPU/cache envolvida no processamento desse conteúdo.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-141">Putting as much content into static resources as possible can greatly reduce the bandwidth overhead of transferring data to the video card, make better use of on-board VRAM, and reduce the CPU/cache overhead involved in processing this content.</span></span>

## <a name="high-overhead-in-file-processing"></a><span data-ttu-id="0ed3c-142">Alta sobrecarga no processamento de arquivos</span><span class="sxs-lookup"><span data-stu-id="0ed3c-142">High Overhead in File Processing</span></span>

<span data-ttu-id="0ed3c-143">Jogos de PC têm uma reputação de longos tempos de carregamento, em particular em comparação com os títulos de console com requisitos estritos de tempo de carregamento.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-143">PC games have gotten a reputation for long loading times, particular when compared with console titles with strict loading-time requirements.</span></span> <span data-ttu-id="0ed3c-144">Nossa análise da forma que muitos títulos usam o subsistema de arquivos revela alguns problemas comuns.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-144">Our analysis of the way that many titles make use of the file subsystem reveals some common issues.</span></span>

<span data-ttu-id="0ed3c-145">A sobrecarga de abrir um arquivo geralmente é muito maior do que os desenvolvedores esperam.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-145">The overhead of opening a file is usually much higher than developers expect.</span></span> <span data-ttu-id="0ed3c-146">Com os verificadores de vírus sob demanda em uso generalizado, e a funcionalidade adicional do NTFS, a abertura de um arquivo é uma operação bastante cara.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-146">With on-demand virus scanners in widespread use, and the additional functionality of NTFS, opening a file is a fairly expensive operation.</span></span> <span data-ttu-id="0ed3c-147">Abrir vários arquivos ao mesmo tempo ou abrir e fechar o mesmo arquivo repetidamente é, portanto, um método insatisfatório de lidar com o gerenciamento de arquivos.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-147">Opening many files at once or opening and closing the same file repeatedly is therefore a poor method of dealing with file management.</span></span> <span data-ttu-id="0ed3c-148">Alguns jogos tentaram reduzir esse custo de desempenho testando a existência de um arquivo antes de abri-lo.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-148">Some games have attempted to mitigate this performance cost by testing for the existence of a file before opening it.</span></span> <span data-ttu-id="0ed3c-149">A realidade é que o teste para a existência de um arquivo em NTFS requer a abertura do arquivo, portanto, o teste antes de abrir os resultados é o custo duas vezes.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-149">The reality is that testing for the existence of a file on NTFS requires opening the file, so testing before opening results in paying the cost twice.</span></span>

<span data-ttu-id="0ed3c-150">Os jogos que permitem modificações de complemento ou mods, ou que ainda incluem scaffolding de desenvolvimento para verificar se há arquivos de dados de substituição, podem ter atrasos significativos no carregamento do jogo devido à verificação desses arquivos, mesmo quando esses arquivos não estão presentes.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-150">Games that allow add-on modifications, or mods, or that still include development scaffolding to check for override data files, can have significant delays in loading the game because of checking for these files, even when those files are not present.</span></span> <span data-ttu-id="0ed3c-151">Recomendamos que os jogos verifiquem apenas esses arquivos quando executados com uma opção especial de linha de comando ou outro indicador de modo, para que somente os usuários que usam essa funcionalidade realmente paguem o custo de desempenho dessas verificações (geralmente extensas).</span><span class="sxs-lookup"><span data-stu-id="0ed3c-151">We recommend that games only check for these files when run with a special command-line switch, or other mode indicator, so that only those users who make use of this functionality actually pay the performance cost of these (often extensive) checks.</span></span>

<span data-ttu-id="0ed3c-152">O desempenho adicional pode ser obtido no sistema de arquivos pelo seguinte:</span><span class="sxs-lookup"><span data-stu-id="0ed3c-152">Additional performance can be obtained from the file system by the following:</span></span>

-   <span data-ttu-id="0ed3c-153">Uso apropriado do sinalizador de arquivo de dicas do sistema de arquivos \_ \_ \_ e \_ \_ verificação SEQUENCIAl de sinalizador de arquivo \_</span><span class="sxs-lookup"><span data-stu-id="0ed3c-153">Appropriate use of the file system hints FILE\_FLAG\_RANDOM\_ACCESS and FILE\_FLAG\_SEQUENTIAL\_SCAN</span></span>
-   <span data-ttu-id="0ed3c-154">Dimensionando buffers para evitar uma grande quantidade de chamadas para as APIs de leitura/gravação do sistema operacional</span><span class="sxs-lookup"><span data-stu-id="0ed3c-154">Sizing buffers to avoid a large quantity of calls to the read/write APIs of the OS</span></span>
-   <span data-ttu-id="0ed3c-155">Acessando arquivos de forma assíncrona</span><span class="sxs-lookup"><span data-stu-id="0ed3c-155">Accessing files asynchronously</span></span>
-   <span data-ttu-id="0ed3c-156">Carregando threads em segundo plano</span><span class="sxs-lookup"><span data-stu-id="0ed3c-156">Loading threads in the background</span></span>

<span data-ttu-id="0ed3c-157">Também é altamente recomendável converter dados offline (no momento da compilação ou da instalação) em vez de depender da conversão quando o jogo é executado pela primeira vez, pois isso impõe um imposto de desempenho significativo para cada usuário.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-157">We also strongly recommend converting data offline (at build or installation time) rather than relying on conversion when the game is first run, as doing so imposes a significant performance tax for every user.</span></span>

## <a name="slow-and-frustrating-installation"></a><span data-ttu-id="0ed3c-158">Instalação lenta e frustrante</span><span class="sxs-lookup"><span data-stu-id="0ed3c-158">Slow and Frustrating Installation</span></span>

<span data-ttu-id="0ed3c-159">Outro problema comum que vimos é o tempo de instalação muito longo necessário para muitos jogos de PC modernos.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-159">Another common issue we've seen is very long installation times required for many modern PC games.</span></span> <span data-ttu-id="0ed3c-160">Os instaladores solicitam ao usuário muitas vezes, às vezes simplesmente para dizer ao usuário, por exemplo, "você não precisa do DirectX instalado".</span><span class="sxs-lookup"><span data-stu-id="0ed3c-160">The installers prompt the user many times, sometimes simply to tell the user, for example, "You do not need DirectX installed."</span></span> <span data-ttu-id="0ed3c-161">Em geral, esses instaladores incorretos exigem que o usuário selecione **Avançar** ou **OK** muitas vezes antes de a instalação do jogo realmente começar.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-161">Generally, these offending installers require the user to select **Next** or **OK** many times before installation of the game actually begins.</span></span> <span data-ttu-id="0ed3c-162">Depois de começar, vimos que alguns títulos levam uma hora ou mais antes que o usuário obtenha a oportunidade de jogar o jogo.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-162">Once it does begin, we've seen some titles take an hour or more before the user gets the opportunity to play the game.</span></span> <span data-ttu-id="0ed3c-163">Parecemos fortemente que a primeira hora da experiência de jogo não deve ser a instalação.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-163">We feel strongly that the first hour of game play experience should not be the installation.</span></span>

<span data-ttu-id="0ed3c-164">Recomendamos várias abordagens para lidar com a instalação.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-164">We recommend a number of approaches for dealing with installation.</span></span> <span data-ttu-id="0ed3c-165">Primeiro, mantenha os prompts simples e mínimos.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-165">First, keep the prompts simple and to a minimum.</span></span> <span data-ttu-id="0ed3c-166">Segundo, projete seus dados de jogos de modo que alguns ou todos os arquivos de dados possam ser usados diretamente do disco de distribuição sempre que possível – unidades de DVD modernas têm largura de banda muito alta.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-166">Second, architect your game data such that some or all the data files can be used directly from the distribution disk where possible — modern DVD drives have very high bandwidth.</span></span> <span data-ttu-id="0ed3c-167">Em terceiro lugar, considere a implementação da instalação sob demanda em seus títulos para reduzir ou eliminar o processo de instalação e permitir que os usuários entrem no jogo o mais rápido possível.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-167">Third, consider implementing install-on-demand in your titles to reduce or eliminate the installation process and allow users to get into the game as quickly as possible.</span></span> <span data-ttu-id="0ed3c-168">(Para obter mais informações sobre a instalação sob demanda, consulte [install-sob demanda para jogos](/windows/desktop/DxTechArts/install-on-demand-for-games).)</span><span class="sxs-lookup"><span data-stu-id="0ed3c-168">(For more information about installing on demand, see [Install-on-Demand for Games](/windows/desktop/DxTechArts/install-on-demand-for-games).)</span></span>

<span data-ttu-id="0ed3c-169">Para obter mais recomendações sobre a instalação do jogo, consulte [simplificando a instalação do jogo](/windows/desktop/DxTechArts/simplifying-game-installation).</span><span class="sxs-lookup"><span data-stu-id="0ed3c-169">For more recommendations about game installation, see [Simplifying Game Installation](/windows/desktop/DxTechArts/simplifying-game-installation).</span></span>

## <a name="lack-of-consideration-of-physical-memory"></a><span data-ttu-id="0ed3c-170">Falta de consideração da memória física</span><span class="sxs-lookup"><span data-stu-id="0ed3c-170">Lack of Consideration of Physical Memory</span></span>

<span data-ttu-id="0ed3c-171">Devido à grande variabilidade do hardware de PC no mercado, os títulos normalmente fazem uso de testes de configuração ad hoc para selecionar as configurações padrão para o nível de detalhes gráficos.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-171">Because of the wide variability of PC hardware in the market, titles typically make use of ad hoc configuration tests to select default settings for the level of graphical detail.</span></span> <span data-ttu-id="0ed3c-172">Alguns dos títulos que vimos estão usando o tamanho da memória de vídeo nesses testes, mas falham em correlacioná-lo com o tamanho da memória física.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-172">Some of the titles we've seen are using video memory size in these tests, but failing to correlate this with physical memory size.</span></span> <span data-ttu-id="0ed3c-173">Para lidar com situações de dispositivo perdido, a maior parte da memória de vídeo (o VRAM local no cartão e a abertura de memória AGP não local) deve ser apoiada pela memória física, seja pelo uso de recursos gerenciados ou estruturas de dados personalizadas.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-173">In order to handle lost-device situations, the majority of the video memory (both local VRAM on the card and the non-local AGP memory aperture) must be backed by physical memory, either through the use of managed resources or custom data structures.</span></span> <span data-ttu-id="0ed3c-174">Algumas placas de vídeo de ponta têm tamanhos de VRAM que consomem o tamanho das memórias de CPU de low-end.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-174">Some high-end video cards have VRAM sizes rivaling the size of low-end CPU memories.</span></span> <span data-ttu-id="0ed3c-175">Em situações em que o sistema tem memória física limitada em comparação com a placa de vídeo, a maior parte desse VRAM não pode ser efetivamente utilizada e as configurações de detalhes mais baixos devem ser configuradas.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-175">In situations where the system has limited physical memory compared to the video card, most of that VRAM cannot be effectively utilized, and lower detail settings should be configured.</span></span>

## <a name="over-reliance-on-real-time-audio-sample-rate-conversion"></a><span data-ttu-id="0ed3c-176">Conversão de taxa de amostragem de Over-Reliance em Real-Time áudio</span><span class="sxs-lookup"><span data-stu-id="0ed3c-176">Over-Reliance on Real-Time Audio Sample Rate Conversion</span></span>

<span data-ttu-id="0ed3c-177">Outra fonte comum de gravação de ciclo de CPU que vimos ocorre quando o sistema de áudio é necessário para converter a taxa de reprodução durante a combinação no buffer de hardware.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-177">Another common source of CPU cycle burn we've seen occurs when the audio system is required to convert the playback rate during mix into the hardware buffer.</span></span> <span data-ttu-id="0ed3c-178">Com drivers de Windows Driver Model (WDM), o formato de buffer de hardware não está sob o controle de aplicativo direto, porque ele é um recurso de nível de kernel; em vez disso, o formato é selecionado com base no formato de qualidade mais alta de todas as fontes e nos recursos do hardware.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-178">With Windows Driver Model (WDM) drivers, the hardware buffer format is not under direct application control, because it is a kernel-level resource; instead, the format is selected based on the highest-quality format of all sources and the capabilities of the hardware.</span></span> <span data-ttu-id="0ed3c-179">Por padrão, o Windows XP usa uma conversão de taxa de exemplo de alta qualidade para esse processo e, se a maioria dos exemplos de áudio exigir uma conversão de taxa, uma parte significativa dos ciclos de CPU será consumida.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-179">By default, Windows XP uses a high-quality sample rate conversion for this process, and if the majority of the audio samples require a rate conversion, a significant portion of the CPU cycles will be consumed.</span></span>

<span data-ttu-id="0ed3c-180">É recomendável criar todos os buffers do DirectSound com a mesma taxa de amostragem.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-180">We recommend creating all of your DirectSound buffers with the same sample rate.</span></span> <span data-ttu-id="0ed3c-181">Se você fizer qualquer uso das funções do Microsoft Win32 **WaveOut** , deverá usar uma taxa de amostra consistente com elas também.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-181">If you make any use of Microsoft Win32 **waveOut** functions, you should use a consistent sample rate with these, too.</span></span> <span data-ttu-id="0ed3c-182">Com os drivers WDM, os buffers serão todos misturados pelo kernel e, se você usar uma taxa de amostragem mais alta em alguns deles, as taxas de exemplo de todos os demais serão convertidas para correspondência.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-182">With WDM drivers, the buffers will all be mixed by the kernel, and if you use a higher sampling rate on some of them, the sample rates of all of the rest will be converted to match.</span></span> <span data-ttu-id="0ed3c-183">Observe que isso implica usar a mesma taxa de reprodução para todos os seus exemplos de áudio, incluindo quaisquer buffers de descompactação de áudio de streaming.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-183">Note that this implies using the same playback rate for all your audio samples, including any streaming audio decompression buffers.</span></span> <span data-ttu-id="0ed3c-184">A definição da taxa de buffer primária não tem nenhum efeito, a menos que você esteja direcionando para o Windows 98 ou o Windows Millennium Edition.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-184">Setting the primary buffer rate has no effect unless you are targeting either Windows 98 or Windows Millennium Edition.</span></span>

> [!Note]  
> <span data-ttu-id="0ed3c-185">No Windows Vista e versões posteriores do sistema operacional, o DirectSound e o **WaveOut** usam a [API de sessão de áudio do Windows (WASAPI)](/windows/desktop/CoreAudio/wasapi) para todas as saídas de áudio.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-185">On Windows Vista and later versions of the operating system, DirectSound and **waveOut** use the [Windows Audio Session API (WASAPI)](/windows/desktop/CoreAudio/wasapi) for all audio output.</span></span>

 

## <a name="fragmention-of-virtual-memory"></a><span data-ttu-id="0ed3c-186">Fragmentação da memória virtual</span><span class="sxs-lookup"><span data-stu-id="0ed3c-186">Fragmention of Virtual Memory</span></span>

<span data-ttu-id="0ed3c-187">Vimos vários problemas recentes relacionados ao limite de 32 bits no espaço de memória do processo.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-187">We've seen a number of recent issues related to the 32-bit limit on process memory space.</span></span> <span data-ttu-id="0ed3c-188">Embora 2 GB de espaço de endereço virtual para processos de modo de usuário tenham sido mais do que o mais adequado historicamente, o maior uso de arquivos mapeados de memória grandes, alocadores de memória personalizados e tamanho de VRAM crescente (que deve ser mapeado no espaço de processo) começou a causar situações em que as alocações de espaço de memória virtual estão falhando.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-188">While 2 GB of virtual address space for user-mode processes has been more than adequate historically, the increased use of large memory-mapped files, custom memory allocators, and increasing VRAM size (which must be mapped into process space) has started to cause situations where allocations of virtual memory space are failing.</span></span> <span data-ttu-id="0ed3c-189">Algumas DLLs que não são da Microsoft estão usando locais de início fixo no meio do espaço de endereço virtual, que está causando a fragmentação que resulta em alocações com falha.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-189">Some non-Microsoft DLLs are using fixed-start locations in the middle of the virtual address space, which is causing fragmentation that results in failed allocations.</span></span>

<span data-ttu-id="0ed3c-190">Esses problemas geralmente aparecem quando o jogo usa um esquema de alocação de memória personalizado que tenta alocar um grande bloco contínuo de espaço de memória virtual.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-190">These problems most often appear when the game makes use of a custom memory allocation scheme that attempts to allocate a large continuous chunk of virtual memory space.</span></span> <span data-ttu-id="0ed3c-191">Nossa recomendação é escrever alocadores de forma que eles solicitem mais partes de tamanho razoável do espaço de endereço virtual, conforme necessário.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-191">Our recommendation is to write allocators such that they request more reasonably sized portions of the virtual address space as needed.</span></span> <span data-ttu-id="0ed3c-192">Por exemplo, solicitando 64 ou 256 MB por vez, mas não 1 GB.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-192">For example, requesting 64 or 256 MB at a time, but not 1 GB.</span></span> <span data-ttu-id="0ed3c-193">No entanto, deve-se ter cuidado para não causar mais fragmentação.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-193">However, care should be taken to not cause further fragmentation.</span></span> <span data-ttu-id="0ed3c-194">O advento dos sistemas operacionais de 64 bits e do hardware ajudará muito nesses problemas no futuro, mas deve ser necessário tomar cuidado com os sistemas de 32 bits de geração atual.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-194">The advent of 64-bit operating systems and hardware will greatly help these issues in the future, but care must be taken on current-generation 32-bit systems.</span></span>

## <a name="manipulation-of-the-floating-point-control-word"></a><span data-ttu-id="0ed3c-195">Manipulação da palavra de controle de Floating-Point</span><span class="sxs-lookup"><span data-stu-id="0ed3c-195">Manipulation of the Floating-Point Control Word</span></span>

<span data-ttu-id="0ed3c-196">Como um auxílio de depuração, alguns desenvolvedores estão habilitando exceções na FPU (unidade de ponto flutuante) por meio de manipulações da palavra de controle de ponto flutuante.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-196">As a debugging aid, some developers have been enabling exceptions on the floating-point unit (FPU) via manipulations of the floating-point control word.</span></span> <span data-ttu-id="0ed3c-197">Isso é altamente problemático e provavelmente causará falha no processo.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-197">Doing this is highly problematic and will likely cause the process to crash.</span></span> <span data-ttu-id="0ed3c-198">Assim como a Convenção de chamada requer que o registro EBX seja preservado, a maioria do sistema supõe que o FPU está em um estado padrão, fornecerá resultados razoáveis e não gerará exceções.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-198">Just like the calling convention requires that the ebx register be preserved, the majority of the system assumes that the FPU is in a default state, will give reasonable results, and won't generate exceptions.</span></span> <span data-ttu-id="0ed3c-199">Os drivers e outros componentes do sistema geralmente computam resultados com base na suposição de que os valores de erro padrão serão exibidos nos registros para condições ruins, mas se as exceções estiverem habilitadas, elas ficarão sem tratamento e resultarão em falhas.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-199">Drivers and other system components will often compute results based on the assumption that standard error values will appear in the registers for bad conditions, but if exceptions are enabled, these will go unhandled and result in crashes.</span></span>

<span data-ttu-id="0ed3c-200">O Direct3D definirá a unidade de ponto flutuante para precisão única, de arredondamento para mais próxima como parte da inicialização para o thread de chamada, a menos que o \_ sinalizador de preservação de FPU D3DCREATE \_ seja usado, nesse caso, a palavra de controle de ponto flutuante é intocada.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-200">Direct3D will set the floating-point unit to single-precision, round-to-nearest as part of initialization for the calling thread, unless the D3DCREATE\_FPU\_PRESERVE flag is used, in which case, the floating-point control word is untouched.</span></span> <span data-ttu-id="0ed3c-201">Como a palavra de controle é uma configuração por thread, garantir que todos os threads de seu aplicativo estejam definidos para o modo de precisão única pode otimizar o desempenho.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-201">Since the control word is a per-thread setting, ensuring that all of your application threads are set to single-precision mode may optimize performance.</span></span> <span data-ttu-id="0ed3c-202">Lembre-se de que a chamada de [**\_ control87**](https://msdn.microsoft.com/library/e9b52ceh(v=VS.71).aspx) não é válida para a codificação nativa de x64, que usa a SSE exclusivamente, e é extremamente cara na arquitetura baseada em PowerPC da CPU do Xbox 360.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-202">Remember that calling [**\_control87**](https://msdn.microsoft.com/library/e9b52ceh(v=VS.71).aspx) is not valid for x64-native coding, which uses SSE exclusively instead, and it is extremely expensive on the PowerPC-based architecture of the Xbox 360 CPU.</span></span>

> [!Note]  
> <span data-ttu-id="0ed3c-203">Se você modificar a palavra de controle, use [**\_ controlfp \_ s**](https://msdn.microsoft.com/library/c9676k6h(v=VS.80).aspx) e esteja ciente de que, para plataformas x64, não será possível alterar a precisão de ponto flutuante por meio da palavra de controle.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-203">If you modify the control word, use [**\_controlfp\_s**](https://msdn.microsoft.com/library/c9676k6h(v=VS.80).aspx) and be aware that for x64 platforms you can't change the floating-point precision via the control word.</span></span>

 

<span data-ttu-id="0ed3c-204">Em todas as bibliotecas em que precisamos ter diferentes regras de arredondamento ou outro comportamento — como lidar com sombreadores de vértice de software ou compilação — salvamos e restauramos a palavra de controle.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-204">In any libraries where we need to have different rounding rules or other behavior — such as dealing with software vertex shaders or compilation — we save and restore the control word.</span></span> <span data-ttu-id="0ed3c-205">Se um jogo precisar usar exceções FPU ou de arredondamento não padrão, ele deverá salvar e restaurar a palavra de controle de ponto flutuante, e você deverá ter certeza de que ele não chama nenhum código externo que não tenha sido comprovado para estar seguro desses problemas, incluindo as APIs do sistema.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-205">If a game needs to make use of non-standard rounding or FPU exceptions, it should save and restore the floating-point control word, and you should be sure that it does not call any external code that has not been proven to be safe from these problems, including system APIs.</span></span>

## <a name="optional-installation-of-the-directx-runtime"></a><span data-ttu-id="0ed3c-206">Instalação opcional do tempo de execução do DirectX</span><span class="sxs-lookup"><span data-stu-id="0ed3c-206">Optional Installation of the DirectX Runtime</span></span>

<span data-ttu-id="0ed3c-207">Vários jogos perguntam ao usuário se o DirectX deve ser instalado.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-207">A number of games ask the user whether to install DirectX.</span></span> <span data-ttu-id="0ed3c-208">Isso pode causar problemas se o usuário assumir que o sistema tem os pacotes redistribuíveis do DirectX mais recentes instalados e ignorar a instalação e, posteriormente, a instalação continuará com êxito.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-208">This can cause problems if the user assumes that the system has the latest DirectX redistributable installed and skips installation, and subsequently, the installation continues successfully.</span></span> <span data-ttu-id="0ed3c-209">Se o jogo exigir uma versão específica do D3DX ou outras funcionalidades atualizadas que não foram instaladas, o jogo não funcionará e o usuário ficará muito frustrado.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-209">If the game requires a specific version of D3DX, or other updated functionality that was not installed, then the game won't work, and the user will get very frustrated.</span></span>

<span data-ttu-id="0ed3c-210">É altamente recomendável que o instalador do jogo instale silenciosamente o DirectX redistribuível no qual o jogo foi criado.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-210">It is strongly recommended that the game's installer silently install the DirectX redistributable that the game was built against.</span></span> <span data-ttu-id="0ed3c-211">O processo de instalação do DirectX foi projetado de forma que ele verifique se algo precisa ser atualizado e retorna rapidamente se não estiver.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-211">The DirectX installation process is designed so that it verifies whether anything needs to be updated and quickly returns if it doesn't.</span></span> <span data-ttu-id="0ed3c-212">Portanto, não é necessário solicitar ao usuário a instalação do DirectX.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-212">So, there is no need to ask the user about installing DirectX.</span></span>

<span data-ttu-id="0ed3c-213">Uma instalação silenciosa do DirectX pode ser feita executando este comando do seu pacote de instalação: **dxsetup.exe/Silent**</span><span class="sxs-lookup"><span data-stu-id="0ed3c-213">A silent installation of DirectX can be done by running this command from your installation package: **dxsetup.exe /silent**</span></span>

<span data-ttu-id="0ed3c-214">Além disso, o tamanho real da pasta redistribuível pode ser configurado para incluir somente os arquivos de gabinete (. cab) que são realmente necessários para as plataformas de destino e o uso do jogo.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-214">Furthermore, the actual size of the redistributable folder can be configured to include only those cabinet files (.cab) that are actually needed for the game's target platforms and usage.</span></span>

> [!Note]  
> <span data-ttu-id="0ed3c-215">Antes de usar o **DxSetup**, leia [não para a instalação direta](https://walbourn.github.io/).</span><span class="sxs-lookup"><span data-stu-id="0ed3c-215">Before you use **dxsetup**, read [Not So Direct Setup](https://walbourn.github.io/).</span></span>

 

## <a name="excessive-use-of-thread-synchronization"></a><span data-ttu-id="0ed3c-216">Uso excessivo da sincronização de threads</span><span class="sxs-lookup"><span data-stu-id="0ed3c-216">Excessive Use of Thread Synchronization</span></span>

<span data-ttu-id="0ed3c-217">Ao fazer o perfil de jogos, os principais pontos de extremidade geralmente são considerados relacionados à inserção e à saída de seções críticas.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-217">When profiling games, the top hotspots are often found to be related to entering and leaving critical sections.</span></span> <span data-ttu-id="0ed3c-218">Com a prevalência de CPUs com vários núcleos, o uso de multithreading em jogos aumentou drasticamente e muitas implementações dependem do uso intensivo de sincronização de threads.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-218">With the prevalence of multi-core CPUs, the use of multithreading in games has increased dramatically, and many implementations rely on heavy use of thread synchronization.</span></span> <span data-ttu-id="0ed3c-219">O tempo de CPU para tomar uma seção crítica, mesmo sem contenção, é bastante significativo, e todas as outras formas de sincronização de threads são ainda mais caras.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-219">The CPU time to take a critical section even without any contention is quite significant, and all other forms of thread synchronization are even more expensive.</span></span> <span data-ttu-id="0ed3c-220">Portanto, é preciso tomar cuidado para minimizar o uso desses primitivos.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-220">So, care must be taken to minimize the use of these primitives.</span></span>

<span data-ttu-id="0ed3c-221">Uma fonte comum de sincronização excessiva em jogos é o uso de [ \_ multithread D3DCREATE](/windows/desktop/direct3d9/d3dcreate).</span><span class="sxs-lookup"><span data-stu-id="0ed3c-221">A common source of excessive synchronization in games is the use of [D3DCREATE\_MULTITHREADED](/windows/desktop/direct3d9/d3dcreate).</span></span> <span data-ttu-id="0ed3c-222">Esse sinalizador, ao tornar o Direct3D thread-safe para renderização de vários threads, usa uma abordagem muito conservadora, resultando em alta sobrecarga de sincronização.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-222">This flag, while making Direct3D thread-safe for rendering from multiple threads, takes a very conservative approach, resulting in high synchronization overhead.</span></span> <span data-ttu-id="0ed3c-223">Os jogos devem evitar esse sinalizador.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-223">Games should avoid this flag.</span></span> <span data-ttu-id="0ed3c-224">Em vez disso, projete o mecanismo de forma que toda a comunicação com o Direct3D seja de um único thread e qualquer comunicação entre os threads seja tratada diretamente.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-224">Instead, architect the engine so that all communication with Direct3D is from a single thread and any communication between threads is handled directly.</span></span> <span data-ttu-id="0ed3c-225">Para obter mais informações sobre como criar jogos multi-threaded, consulte o artigo [codificação para vários núcleos no Xbox 360 e no Microsoft Windows](/windows/desktop/DxTechArts/coding-for-multiple-cores).</span><span class="sxs-lookup"><span data-stu-id="0ed3c-225">For more information about designing multi-threaded games, see the article [Coding For Multiple Cores on Xbox 360 and Microsoft Windows](/windows/desktop/DxTechArts/coding-for-multiple-cores).</span></span>

## <a name="use-of-rdtsc"></a><span data-ttu-id="0ed3c-226">Uso de RDTSC</span><span class="sxs-lookup"><span data-stu-id="0ed3c-226">Use of RDTSC</span></span>

<span data-ttu-id="0ed3c-227">O uso do **RDTSC** de instruções x86 não é recomendado.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-227">Use of the x86 instruction **RDTSC** is not recommended.</span></span> <span data-ttu-id="0ed3c-228">O **RDTSC** falha ao calcular corretamente o tempo em alguns esquemas de gerenciamento de energia que alteram a frequência da CPU dinamicamente e em muitas CPUs de vários núcleos para as quais o contador de ciclo não é sincronizado entre os núcleos.</span><span class="sxs-lookup"><span data-stu-id="0ed3c-228">**RDTSC** fails to correctly compute timing on some power management schemes that change the CPU frequency dynamically and on many multi-core CPUs for which the cycle counter is not synchronized between cores.</span></span> <span data-ttu-id="0ed3c-229">Em vez disso, os jogos devem usar a API [**QueryPerformanceCounter**](/windows/desktop/api/profileapi/nf-profileapi-queryperformancecounter) .</span><span class="sxs-lookup"><span data-stu-id="0ed3c-229">Games should instead use the [**QueryPerformanceCounter**](/windows/desktop/api/profileapi/nf-profileapi-queryperformancecounter) API.</span></span> <span data-ttu-id="0ed3c-230">Para obter mais informações sobre problemas com o **RDTSC** e sobre como implementar o tempo de alta resolução com o **QueryPerformanceCounter**, consulte o artigo [tempo de jogo e processadores de vários núcleos](/windows/desktop/DxTechArts/game-timing-and-multicore-processors).</span><span class="sxs-lookup"><span data-stu-id="0ed3c-230">For more information about issues with **RDTSC** and implementing high-resolution timing with **QueryPerformanceCounter**, see the article [Game Timing and Multicore Processors](/windows/desktop/DxTechArts/game-timing-and-multicore-processors).</span></span>

 

 