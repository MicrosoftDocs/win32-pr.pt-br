---
title: Controle de conta de usuário para desenvolvedores de jogos
description: Este artigo descreve as diretrizes e as práticas recomendadas para que os desenvolvedores de jogos trabalhem com eficiência com o recurso de segurança UAC (controle de conta de usuário) introduzido no Windows Vista.
ms.assetid: dbac1c07-73dd-f2bc-3c5c-d6160368a88f
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 57d5533a3fbdd349cc25dfde501a234bbd7b05b1
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/20/2020
ms.locfileid: "104366322"
---
# <a name="user-account-control-for-game-developers"></a><span data-ttu-id="b488e-103">Controle de conta de usuário para desenvolvedores de jogos</span><span class="sxs-lookup"><span data-stu-id="b488e-103">User Account Control for Game Developers</span></span>

<span data-ttu-id="b488e-104">Este artigo descreve as diretrizes e as práticas recomendadas para que os desenvolvedores de jogos trabalhem com eficiência com o recurso de segurança UAC (controle de conta de usuário) introduzido no Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="b488e-104">This article describes the guidelines and best practices for game developers to work effectively with the User Account Control (UAC) security feature introduced in Windows Vista.</span></span>

-   [<span data-ttu-id="b488e-105">Visão geral do controle de conta de usuário</span><span class="sxs-lookup"><span data-stu-id="b488e-105">Overview of User Account Control</span></span>](#overview-of-user-account-control)
-   [<span data-ttu-id="b488e-106">Contas de usuário no Windows Vista</span><span class="sxs-lookup"><span data-stu-id="b488e-106">User Accounts in Windows Vista</span></span>](#user-accounts-in-windows-vista)
-   [<span data-ttu-id="b488e-107">Acesso a arquivos como usuário padrão</span><span class="sxs-lookup"><span data-stu-id="b488e-107">File Access as a Standard User</span></span>](#file-access-as-a-standard-user)
-   [<span data-ttu-id="b488e-108">Acesso de registro como usuário padrão</span><span class="sxs-lookup"><span data-stu-id="b488e-108">Registry Access as a Standard User</span></span>](#registry-access-as-a-standard-user)
-   [<span data-ttu-id="b488e-109">Elevação de privilégio</span><span class="sxs-lookup"><span data-stu-id="b488e-109">Privilege Elevation</span></span>](#privilege-elevation)
-   [<span data-ttu-id="b488e-110">Implicações do UAC com CreateProcess ()</span><span class="sxs-lookup"><span data-stu-id="b488e-110">UAC Implications with CreateProcess()</span></span>](#uac-implications-with-createprocess)
-   [<span data-ttu-id="b488e-111">Definindo o nível de execução no manifesto do aplicativo</span><span class="sxs-lookup"><span data-stu-id="b488e-111">Setting the Execution Level in the Application Manifest</span></span>](#setting-the-execution-level-in-the-application-manifest)
-   [<span data-ttu-id="b488e-112">Inserindo um manifesto no Visual Studio</span><span class="sxs-lookup"><span data-stu-id="b488e-112">Embedding a Manifest in Visual Studio</span></span>](#embedding-a-manifest-in-visual-studio)
-   [<span data-ttu-id="b488e-113">Compatibilidade com o UAC com jogos mais antigos</span><span class="sxs-lookup"><span data-stu-id="b488e-113">UAC Compatibility with Older Games</span></span>](#uac-compatibility-with-older-games)
-   [<span data-ttu-id="b488e-114">Cenários herdados e manifestos</span><span class="sxs-lookup"><span data-stu-id="b488e-114">Legacy Scenarios and Manifests</span></span>](#legacy-scenarios-and-manifests)
-   [<span data-ttu-id="b488e-115">Conclusão</span><span class="sxs-lookup"><span data-stu-id="b488e-115">Conclusion</span></span>](#conclusion)
-   [<span data-ttu-id="b488e-116">Leitura adicional</span><span class="sxs-lookup"><span data-stu-id="b488e-116">Further Reading</span></span>](#further-reading)

## <a name="overview-of-user-account-control"></a><span data-ttu-id="b488e-117">Visão geral do controle de conta de usuário</span><span class="sxs-lookup"><span data-stu-id="b488e-117">Overview of User Account Control</span></span>

<span data-ttu-id="b488e-118">O UAC (controle de conta de usuário), introduzido no Windows Vista, é um recurso de segurança criado para ajudar a impedir que invasores mal-intencionados usem pontos fracos ou bugs encontrados em aplicativos amplamente usados para alterar o sistema operacional ou outros programas instalados.</span><span class="sxs-lookup"><span data-stu-id="b488e-118">User Account Control (UAC), introduced in Windows Vista, is a security feature that is designed to help prevent malicious attackers from using weaknesses or bugs found in widely-used applications to alter the operating system or other installed programs.</span></span> <span data-ttu-id="b488e-119">Isso é feito pela execução da grande maioria dos programas e processos como usuário padrão (também conhecido como usuário limitado, usuário restrito ou Least-Privileged usuário), mesmo que a conta do usuário atual tenha credenciais administrativas.</span><span class="sxs-lookup"><span data-stu-id="b488e-119">This is accomplished by running the vast majority of programs and processes as a Standard User (also known as a Limited User, Restricted User, or Least-Privileged User) even if the current user's account has administrative credentials.</span></span> <span data-ttu-id="b488e-120">Um processo com privilégios de usuário padrão tem muitas restrições inerentes que o impedem de fazer alterações em todo o sistema.</span><span class="sxs-lookup"><span data-stu-id="b488e-120">A process with standard user privileges has many inherent restrictions that prevent it from making system-wide changes.</span></span>

<span data-ttu-id="b488e-121">O UAC também é responsável pela elevação de privilégios de um processo pelo uso de um esquema de autenticação baseado em caixa de diálogo, iniciado na execução de determinados processos designados como exigindo privilégios administrativos.</span><span class="sxs-lookup"><span data-stu-id="b488e-121">UAC is also responsible for privilege elevation of a process by use of a dialog-based, authentication scheme initiated upon execution of certain processes that are designated as requiring administrative privileges.</span></span> <span data-ttu-id="b488e-122">A elevação de privilégio permite que os administradores executem a maioria de seus aplicativos em um nível de privilégio seguro (o mesmo que qualquer outro usuário padrão), mas também permite processos e operações que exigem privilégios administrativos.</span><span class="sxs-lookup"><span data-stu-id="b488e-122">Privilege elevation allows administrators to run the majority of their applications at a safe privilege level (the same as any other standard user), but also allow processes and operations that require administrative privileges.</span></span> <span data-ttu-id="b488e-123">O UAC dá suporte à autenticação no ressalto para que um administrador possa conceder privilégios elevados a um programa enquanto um usuário padrão estiver conectado ao sistema no momento.</span><span class="sxs-lookup"><span data-stu-id="b488e-123">UAC supports over-the-shoulder authentication so that an administrator can grant elevated privileges to a program while a standard user is currently logged onto the system.</span></span>

<span data-ttu-id="b488e-124">O recurso UAC é habilitado por padrão.</span><span class="sxs-lookup"><span data-stu-id="b488e-124">The UAC feature is enabled by default.</span></span> <span data-ttu-id="b488e-125">Embora seja possível que um administrador desabilite todo o sistema do UAC, isso tem várias ramificações negativas.</span><span class="sxs-lookup"><span data-stu-id="b488e-125">While it is possible for an administrator to disable UAC system-wide, doing so has a number of negative ramifications.</span></span> <span data-ttu-id="b488e-126">Primeiro, isso enfraquece a segurança de todas as contas administrativas, pois todos os processos seriam executados com credenciais administrativas, mesmo quando a maioria dos aplicativos não os exige realmente.</span><span class="sxs-lookup"><span data-stu-id="b488e-126">First, this weakens the security of all administrative accounts, as all processes would be run with administrative credentials, even when most applications do not actually require them.</span></span> <span data-ttu-id="b488e-127">Com o UAC desabilitado, um aplicativo de usuário padrão que expõe uma vulnerabilidade explorável na segurança pode potencialmente ser usado para roubar informações particulares, instalar rootkits ou spyware, destruir a integridade do sistema ou hospedar ataques zumbis em outros sistemas.</span><span class="sxs-lookup"><span data-stu-id="b488e-127">With UAC disabled, a standard user application that exposes an exploitable vulnerability in security can potentially be used to steal private information, install rootkits or spyware, destroy the system integrity, or host zombie attacks on other systems.</span></span> <span data-ttu-id="b488e-128">Enquanto com o UAC habilitado, a execução da maioria do software como usuário padrão limita bastante o dano potencial desse bug.</span><span class="sxs-lookup"><span data-stu-id="b488e-128">Whereas with UAC enabled, running the majority of software as a standard user greatly limits the potential damage from such a bug.</span></span> <span data-ttu-id="b488e-129">Em segundo lugar, desativar o UAC desabilita muitas das soluções alternativas para a compatibilidade de aplicativos que permitem que os usuários padrão verdadeiros executem com êxito uma ampla gama de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="b488e-129">Secondly, turning off UAC disables many of the workarounds for application compatibility that allow true standard users to successfully run a broad range of applications.</span></span> <span data-ttu-id="b488e-130">Desabilitar o UAC nunca deve ser recomendado como solução alternativa de compatibilidade.</span><span class="sxs-lookup"><span data-stu-id="b488e-130">Disabling UAC should never be recommended as a compatibility workaround.</span></span>

<span data-ttu-id="b488e-131">É importante observar que os aplicativos devem se esforçar para usar somente direitos de usuário padrão, se possível.</span><span class="sxs-lookup"><span data-stu-id="b488e-131">It is important to note that applications should strive to only use standard user rights if at all possible.</span></span> <span data-ttu-id="b488e-132">Embora os administradores possam facilmente elevar os privilégios de um processo, a elevação ainda exige a interação do usuário e a confirmação sempre que um aplicativo é executado, o que exige credenciais administrativas.</span><span class="sxs-lookup"><span data-stu-id="b488e-132">While administrators can easily elevate the privileges of a process, the elevation still requires user interaction and acknowledgement every time that an application is run that requires administrative credentials.</span></span> <span data-ttu-id="b488e-133">Essa elevação também deve ser feita no momento em que o programa é iniciado, portanto, exigir credenciais administrativas mesmo para uma única operação requer a exposição do sistema a um risco maior para todo o tempo de execução do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b488e-133">This elevation must also be done at the time that the program starts, so requiring administrative credentials   even for a single operation   requires exposing the system to greater risk for the entire running time of the application.</span></span> <span data-ttu-id="b488e-134">Os usuários padrão sem qualquer capacidade de elevar seus privilégios também são comuns em configurações de negócios e de família.</span><span class="sxs-lookup"><span data-stu-id="b488e-134">Standard users without any ability to elevate their privileges are also common in family and business settings.</span></span> <span data-ttu-id="b488e-135">"Executar como administrador" não é uma boa solução alternativa para a compatibilidade, expõe o usuário e o sistema a um risco maior de segurança e cria frustração para os usuários em muitas situações.</span><span class="sxs-lookup"><span data-stu-id="b488e-135">"Run As Administrator" is not a good workaround for compatibility, exposes the user and the system to greater security risk, and creates frustration for users in many situations.</span></span>

> [!Note]  
> <span data-ttu-id="b488e-136">O recurso de controle de conta de usuário introduzido no Windows Vista também está presente no Windows 7.</span><span class="sxs-lookup"><span data-stu-id="b488e-136">The User Account Control feature introduced in Windows Vista is also present in Windows 7.</span></span> <span data-ttu-id="b488e-137">Embora a experiência do usuário que trabalha com os vários recursos do sistema tenha sido aprimorada em relação ao controle de conta de usuário, o impacto nos aplicativos é basicamente o mesmo.</span><span class="sxs-lookup"><span data-stu-id="b488e-137">While the user experience working with the various system features has been improved with respect to User Account Control, the impact on applications is basically the same.</span></span> <span data-ttu-id="b488e-138">Todas as recomendações do Windows Vista neste artigo também se aplicam ao Windows 7.</span><span class="sxs-lookup"><span data-stu-id="b488e-138">All of the Windows Vista recommendations in this article apply to Windows 7 as well.</span></span> <span data-ttu-id="b488e-139">Para obter detalhes sobre as alterações da interface do usuário do UAC para o Windows 7, consulte [User interface-caixa de diálogo controle de conta de usuário](../win7appqual/user-interface---user-account-control-dialog-updates.md).</span><span class="sxs-lookup"><span data-stu-id="b488e-139">For details on the UAC UI changes for Windows 7, see [User Interface - User Account Control Dialog Updates](../win7appqual/user-interface---user-account-control-dialog-updates.md).</span></span>

 

## <a name="user-accounts-in-windows-vista"></a><span data-ttu-id="b488e-140">Contas de usuário no Windows Vista</span><span class="sxs-lookup"><span data-stu-id="b488e-140">User Accounts in Windows Vista</span></span>

<span data-ttu-id="b488e-141">O Windows Vista categoriza cada usuário em dois tipos de conta de usuário: administradores e usuários padrão.</span><span class="sxs-lookup"><span data-stu-id="b488e-141">Windows Vista categorizes every user into two user account types: administrators and standard users.</span></span>

<span data-ttu-id="b488e-142">Uma conta de usuário padrão é semelhante a uma conta de usuário limitado no Windows XP.</span><span class="sxs-lookup"><span data-stu-id="b488e-142">A standard user account is similar to a limited-user account in Windows XP.</span></span> <span data-ttu-id="b488e-143">Assim como no Windows XP, um usuário padrão não pode gravar na pasta arquivos de programas, não pode gravar \_ na \_ parte do computador local hKey do registro e não pode executar tarefas que alteram o sistema, como a instalação de um driver no modo kernel ou o acesso a espaços de processo no nível do sistema.</span><span class="sxs-lookup"><span data-stu-id="b488e-143">Like in Windows XP, a standard user cannot write to the Program Files folder, cannot write to the HKEY\_LOCAL\_MACHINE portion of the registry, and cannot perform tasks that alter the system, such as installing a kernel-mode driver or accessing system-level process spaces.</span></span>

<span data-ttu-id="b488e-144">A conta de administrador mudou significativamente desde que o Windows XP foi lançado.</span><span class="sxs-lookup"><span data-stu-id="b488e-144">The Administrator account has significantly changed since Windows XP was released.</span></span> <span data-ttu-id="b488e-145">Anteriormente, todos os processos iniciados por um membro do grupo Administradores receberam privilégios administrativos.</span><span class="sxs-lookup"><span data-stu-id="b488e-145">Previously, all processes launched by a member of the Administrators group were given administrative privileges.</span></span> <span data-ttu-id="b488e-146">Com o UAC habilitado, todos os processos são executados com privilégios de usuário padrão, a menos que seja especificamente elevado por um administrador.</span><span class="sxs-lookup"><span data-stu-id="b488e-146">With UAC enabled, all processes execute with standard user privileges, unless specifically elevated by an administrator.</span></span> <span data-ttu-id="b488e-147">Essa diferença torna as contas no grupo Administradores mais seguras, reduzindo o risco de segurança apresentado por possíveis bugs na maioria dos programas.</span><span class="sxs-lookup"><span data-stu-id="b488e-147">This difference makes accounts in the Administrators group more secure by reducing the security risk posed by potential bugs in most programs.</span></span>

<span data-ttu-id="b488e-148">É importante que todos os aplicativos, especialmente jogos, operem com eficiência e responsabilidade quando executados como um processo de usuário padrão.</span><span class="sxs-lookup"><span data-stu-id="b488e-148">It is important that all applications, especially games, operate effectively and responsibly when run as a standard user process.</span></span> <span data-ttu-id="b488e-149">Todas as operações que exigem privilégios administrativos devem ser feitas no momento da instalação ou por programas auxiliares que solicitam credenciais administrativas explicitamente.</span><span class="sxs-lookup"><span data-stu-id="b488e-149">All operations that require administrative privileges should be done either at installation time or by auxiliary programs that explicitly request administrative credentials.</span></span> <span data-ttu-id="b488e-150">Embora a elevação de privilégios seja bastante trivial para um membro do grupo Administradores, os usuários padrão devem adiar para alguém com credenciais administrativas para inserir fisicamente sua senha para elevar privilégios.</span><span class="sxs-lookup"><span data-stu-id="b488e-150">While privilege elevation is fairly trivial for a member of the Administrators group, standard users must defer to someone with administrative credentials to physically enter their password to elevate privileges.</span></span> <span data-ttu-id="b488e-151">Como as contas protegidas pelos controles dos pais devem ser usuários padrão, essa será uma situação muito comum para os jogadores que estão usando o Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="b488e-151">Since accounts protected by parental controls must be standard users, this will be a very common situation for gamers who are using Windows Vista.</span></span>

<span data-ttu-id="b488e-152">Se o seu jogo já estiver trabalhando no Windows XP com contas de usuário limitado, a mudança para o controle de conta de usuário no Windows Vista deve ser muito fácil.</span><span class="sxs-lookup"><span data-stu-id="b488e-152">If your game is already working on Windows XP with limited-user accounts, then the move to User Account Control on Windows Vista should be very easy.</span></span> <span data-ttu-id="b488e-153">A maioria desses aplicativos funcionará no estado em que se encontra, embora a adição de um manifesto de aplicativo seja altamente recomendada.</span><span class="sxs-lookup"><span data-stu-id="b488e-153">The majority of such applications will work as-is, although adding an application manifest is highly recommended.</span></span> <span data-ttu-id="b488e-154">(Os manifestos são descritos posteriormente neste tópico em [definindo o nível de execução no manifesto do aplicativo](#setting-the-execution-level-in-the-application-manifest).)</span><span class="sxs-lookup"><span data-stu-id="b488e-154">(Manifests are described later in this topic in [Setting the Execution Level in the Application Manifest](#setting-the-execution-level-in-the-application-manifest).)</span></span>

## <a name="file-access-as-a-standard-user"></a><span data-ttu-id="b488e-155">Acesso a arquivos como usuário padrão</span><span class="sxs-lookup"><span data-stu-id="b488e-155">File Access as a Standard User</span></span>

<span data-ttu-id="b488e-156">O aspecto do seu jogo mais afetado pelas restrições de usuário padrão é a organização do sistema de arquivos e a acessibilidade.</span><span class="sxs-lookup"><span data-stu-id="b488e-156">The aspect of your game most affected by standard user restrictions is file system organization and accessibility.</span></span> <span data-ttu-id="b488e-157">Você nunca deve assumir que o jogo pode gravar arquivos na pasta onde o jogo está instalado.</span><span class="sxs-lookup"><span data-stu-id="b488e-157">You should never assume that your game can write files to the folder where your game is installed.</span></span> <span data-ttu-id="b488e-158">No Windows Vista, por exemplo, os privilégios de um usuário devem ser elevados pelo sistema operacional antes que um aplicativo possa gravar na pasta arquivos de programas.</span><span class="sxs-lookup"><span data-stu-id="b488e-158">In Windows Vista for instance, a user s privileges must be elevated by the operating system before an application can write to the Program Files folder.</span></span> <span data-ttu-id="b488e-159">Para evitar isso, você deve categorizar os arquivos de dados do jogo por escopo e acessibilidade e usar a função [**SHGetFolderPath**](/windows/win32/api/shlobj_core/nf-shlobj_core-shgetfolderpatha) , juntamente com as constantes de CSIDL fornecidas pelo shell do Windows, para gerar os caminhos de arquivo apropriados.</span><span class="sxs-lookup"><span data-stu-id="b488e-159">To avoid this, you should categorize your game s data files by scope and accessibility, and use the [**SHGetFolderPath**](/windows/win32/api/shlobj_core/nf-shlobj_core-shgetfolderpatha) function, along with the CSIDL constants provided by the Windows shell, to generate the appropriate file paths.</span></span> <span data-ttu-id="b488e-160">As constantes de CSIDl correspondem a pastas conhecidas no sistema de arquivos que o sistema operacional usa e promove para particionar arquivos globais e específicos do usuário.</span><span class="sxs-lookup"><span data-stu-id="b488e-160">The CSIDL constants correspond to known folders in the file system that the operating system uses and promotes to partition global and user-specific files.</span></span>

<span data-ttu-id="b488e-161">A tentativa de criar ou gravar um arquivo ou diretório em uma pasta que não conceda permissão de gravação ao processo falhará no Windows Vista se o aplicativo não tiver privilégios administrativos.</span><span class="sxs-lookup"><span data-stu-id="b488e-161">Attempting to create or write a file or directory under a folder which does not grant write permission to the process will fail under Windows Vista if the application does not have administrative privileges.</span></span> <span data-ttu-id="b488e-162">Se o seu executável de jogo de 32 bits estiver em execução no modo herdado, porque ele não declarou um nível de execução solicitado, suas operações de gravação terão sucesso, mas estarão sujeitas à virtualização, conforme descrito na seção "compatibilidade do UAC com jogos mais antigos", posteriormente neste artigo.</span><span class="sxs-lookup"><span data-stu-id="b488e-162">If your 32-bit game executable is running in legacy mode, because it did not declare a requested execution level, its write operations will succeed, but they will be subjected to virtualization as described in the section "UAC Compatibility with Older Games" later in this article.</span></span>

<span data-ttu-id="b488e-163">**Tabela 1. Pastas conhecidas**</span><span class="sxs-lookup"><span data-stu-id="b488e-163">**Table 1. Known Folders**</span></span>



| <span data-ttu-id="b488e-164">Nome CSIDl</span><span class="sxs-lookup"><span data-stu-id="b488e-164">CSIDL Name</span></span>             | <span data-ttu-id="b488e-165">Caminho típico (Windows Vista)</span><span class="sxs-lookup"><span data-stu-id="b488e-165">Typical Path (Windows Vista)</span></span>                                                   | <span data-ttu-id="b488e-166">Direitos de usuário padrão</span><span class="sxs-lookup"><span data-stu-id="b488e-166">Standard User Rights</span></span> | <span data-ttu-id="b488e-167">Direitos de administrador</span><span class="sxs-lookup"><span data-stu-id="b488e-167">Administrator Rights</span></span> | <span data-ttu-id="b488e-168">Escopo de acesso</span><span class="sxs-lookup"><span data-stu-id="b488e-168">Access Scope</span></span> | <span data-ttu-id="b488e-169">Descrição</span><span class="sxs-lookup"><span data-stu-id="b488e-169">Description</span></span>                                                                                                                      | <span data-ttu-id="b488e-170">Exemplos</span><span class="sxs-lookup"><span data-stu-id="b488e-170">Examples</span></span>                                                          |
|------------------------|--------------------------------------------------------------------------------|----------------------|----------------------|--------------|----------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------|
| <span data-ttu-id="b488e-171">pessoa CSIDl \_ pessoal</span><span class="sxs-lookup"><span data-stu-id="b488e-171">CSIDL\_PERSONAL</span></span>        | <span data-ttu-id="b488e-172">C: \\ usuários \\ nome de usuário \\ documentos</span><span class="sxs-lookup"><span data-stu-id="b488e-172">C:\\Users\\user name\\Documents</span></span>                                                | <span data-ttu-id="b488e-173">Leitura/Gravação</span><span class="sxs-lookup"><span data-stu-id="b488e-173">Read/Write</span></span>           | <span data-ttu-id="b488e-174">Leitura/Gravação</span><span class="sxs-lookup"><span data-stu-id="b488e-174">Read/Write</span></span>           | <span data-ttu-id="b488e-175">Per-User</span><span class="sxs-lookup"><span data-stu-id="b488e-175">Per-User</span></span>     | <span data-ttu-id="b488e-176">Arquivos de jogos específicos do usuário que são lidos e modificados e podem ser manipulados fora do contexto do jogo.</span><span class="sxs-lookup"><span data-stu-id="b488e-176">User-specific game files that are read and modified and can be manipulated outside of the game context.</span></span>                          | <span data-ttu-id="b488e-177">Capturas de tela.</span><span class="sxs-lookup"><span data-stu-id="b488e-177">Screen shots.</span></span> <span data-ttu-id="b488e-178">Arquivos de jogos salvos com uma associação de extensão de arquivo.</span><span class="sxs-lookup"><span data-stu-id="b488e-178">Saved game files with a file extension association.</span></span> |
| <span data-ttu-id="b488e-179">\_AppData local CSIDL \_</span><span class="sxs-lookup"><span data-stu-id="b488e-179">CSIDL\_LOCAL\_APPDATA</span></span>  | <span data-ttu-id="b488e-180">C: \\ Users \\ User name \\ AppData \\ local</span><span class="sxs-lookup"><span data-stu-id="b488e-180">C:\\Users\\user name\\AppData\\Local</span></span>                                           | <span data-ttu-id="b488e-181">Leitura/Gravação</span><span class="sxs-lookup"><span data-stu-id="b488e-181">Read/Write</span></span>           | <span data-ttu-id="b488e-182">Leitura/Gravação</span><span class="sxs-lookup"><span data-stu-id="b488e-182">Read/Write</span></span>           | <span data-ttu-id="b488e-183">Per-User</span><span class="sxs-lookup"><span data-stu-id="b488e-183">Per-User</span></span>     | <span data-ttu-id="b488e-184">Arquivos de jogos específicos do usuário que são lidos e modificados e são usados somente dentro do contexto do jogo.</span><span class="sxs-lookup"><span data-stu-id="b488e-184">User-specific game files that are read and modified and are of use only within the game context.</span></span>                                 | <span data-ttu-id="b488e-185">Arquivos de cache do jogo.</span><span class="sxs-lookup"><span data-stu-id="b488e-185">Game cache files.</span></span> <span data-ttu-id="b488e-186">Configurações do Player.</span><span class="sxs-lookup"><span data-stu-id="b488e-186">Player configurations.</span></span>                          |
| <span data-ttu-id="b488e-187">AppData comuns de CSIDl \_ \_</span><span class="sxs-lookup"><span data-stu-id="b488e-187">CSIDL\_COMMON\_APPDATA</span></span> | <span data-ttu-id="b488e-188">C: \\ ProgramData</span><span class="sxs-lookup"><span data-stu-id="b488e-188">C:\\ProgramData</span></span>                                                                | <span data-ttu-id="b488e-189">Ler/gravar se proprietário</span><span class="sxs-lookup"><span data-stu-id="b488e-189">Read/Write if owner</span></span>  | <span data-ttu-id="b488e-190">Leitura/Gravação</span><span class="sxs-lookup"><span data-stu-id="b488e-190">Read/Write</span></span>           | <span data-ttu-id="b488e-191">Todos os Usuários</span><span class="sxs-lookup"><span data-stu-id="b488e-191">All Users</span></span>    | <span data-ttu-id="b488e-192">Arquivos de jogos que podem ser criados por um usuário e lidos por todos os usuários.</span><span class="sxs-lookup"><span data-stu-id="b488e-192">Game files that can be created by a user and read by all users.</span></span> <span data-ttu-id="b488e-193">O acesso de gravação é concedido somente ao criador do arquivo (proprietário).</span><span class="sxs-lookup"><span data-stu-id="b488e-193">Write access is granted only to the creator of the file (owner).</span></span> | <span data-ttu-id="b488e-194">Perfis de Usuário</span><span class="sxs-lookup"><span data-stu-id="b488e-194">User Profiles</span></span>                                                     |
| <span data-ttu-id="b488e-195">arquivos de \_ programa CSIDL \_</span><span class="sxs-lookup"><span data-stu-id="b488e-195">CSIDL\_PROGRAM\_FILES</span></span>  | <span data-ttu-id="b488e-196">C: \\ arquivos de programas</span><span class="sxs-lookup"><span data-stu-id="b488e-196">C:\\Program Files</span></span><br/> <span data-ttu-id="b488e-197">ou</span><span class="sxs-lookup"><span data-stu-id="b488e-197">or</span></span><br/> <span data-ttu-id="b488e-198">C: \\ arquivos de programas (x86)</span><span class="sxs-lookup"><span data-stu-id="b488e-198">C:\\Program Files (x86)</span></span> <br/> | <span data-ttu-id="b488e-199">Somente leitura</span><span class="sxs-lookup"><span data-stu-id="b488e-199">Read only</span></span>            | <span data-ttu-id="b488e-200">Leitura/Gravação</span><span class="sxs-lookup"><span data-stu-id="b488e-200">Read/Write</span></span>           | <span data-ttu-id="b488e-201">Todos os Usuários</span><span class="sxs-lookup"><span data-stu-id="b488e-201">All Users</span></span>    | <span data-ttu-id="b488e-202">Arquivos de jogos estáticos gravados pelo instalador do jogo s que são lidos por todos os usuários.</span><span class="sxs-lookup"><span data-stu-id="b488e-202">Static game files written by the game s installer that are read by all users.</span></span>                                                    | <span data-ttu-id="b488e-203">Ativos de jogos, como materiais e malhas.</span><span class="sxs-lookup"><span data-stu-id="b488e-203">Game assets, such as materials and meshes.</span></span>                        |



 

<span data-ttu-id="b488e-204">Seu jogo normalmente será instalado em uma pasta sob a pasta representada pela \_ constante arquivos de programas CSIDL \_ .</span><span class="sxs-lookup"><span data-stu-id="b488e-204">Your game will typically be installed in a folder under the folder represented by the CSIDL\_PROGRAM\_FILES constant.</span></span> <span data-ttu-id="b488e-205">No entanto, esse nem sempre é o caso.</span><span class="sxs-lookup"><span data-stu-id="b488e-205">However, this is not always the case.</span></span> <span data-ttu-id="b488e-206">Em vez disso, você deve usar um caminho relativo do seu arquivo executável ao gerar cadeias de caracteres de caminho para arquivos ou diretórios localizados em sua pasta de instalação.</span><span class="sxs-lookup"><span data-stu-id="b488e-206">You should instead use a relative path from your executable file when generating path strings to files or directories located under your installation folder.</span></span>

<span data-ttu-id="b488e-207">Você também deve evitar suposições embutidas em código sobre os caminhos de pasta conhecidos.</span><span class="sxs-lookup"><span data-stu-id="b488e-207">You should also refrain from hard-coded assumptions about the known folder paths.</span></span> <span data-ttu-id="b488e-208">Por exemplo, no Windows XP Professional 64-bit Edition e no Windows Vista x64, o caminho dos arquivos de programas é C: \\ Program Files (x86) for 32-bit Programs e C: \\ Program Files for 64-bit Programs.</span><span class="sxs-lookup"><span data-stu-id="b488e-208">For example, on Windows XP Professional 64-bit Edition and Windows Vista x64, the program files path is C:\\Program Files (x86) for 32-bit programs and C:\\Program Files for 64-bit programs.</span></span> <span data-ttu-id="b488e-209">Esses caminhos conhecidos são alterados do Windows XP, e os usuários podem reconfigurar o local de muitas dessas pastas e até mesmo localizá-las em unidades diferentes.</span><span class="sxs-lookup"><span data-stu-id="b488e-209">These known paths are changed from Windows XP, and users can reconfigure the location of many of these folders and even locate them on different drives.</span></span> <span data-ttu-id="b488e-210">Portanto, sempre use as constantes de CSIDl para evitar confusão e problemas potenciais.</span><span class="sxs-lookup"><span data-stu-id="b488e-210">So, always use the CSIDL constants to avoid confusion and potential problems.</span></span> <span data-ttu-id="b488e-211">Instalação do Windows compreende esses locais de pastas conhecidos e moverá os dados ao atualizar o sistema operacional do Windows XP; por outro lado, o uso de locais não padrão ou caminhos embutidos em código pode falhar bem após uma atualização do sistema operacional.</span><span class="sxs-lookup"><span data-stu-id="b488e-211">Windows Setup understands these known folder locations and will move the data when upgrading the operating system from Windows XP; in contrast, use of non-standard locations or hard-coded paths may well fail after an OS upgrade.</span></span>

<span data-ttu-id="b488e-212">A atenção deve ser dada às diferenças sutis de usabilidade entre as pastas específicas do usuário especificadas por CSIDl \_ pessoal e CSIDL \_ local \_ AppData.</span><span class="sxs-lookup"><span data-stu-id="b488e-212">Attention should be given to the subtle usability differences between the user-specific folders specified by CSIDL\_PERSONAL and CSIDL\_LOCAL\_APPDATA.</span></span> <span data-ttu-id="b488e-213">A prática recomendada para selecionar a constante de CSIDl a ser usada para gravar um arquivo é usar a CSIDl \_ pessoal se o usuário for pretendo interagir com o arquivo, como clicar duas vezes nele para abri-lo em uma ferramenta ou aplicativo e usar \_ AppData local CSid \_ para outros arquivos.</span><span class="sxs-lookup"><span data-stu-id="b488e-213">The recommended practice for selecting the CSIDL constant to use for writing a file is to use CSIDL\_PERSONAL if the user is expected to interact with the file, such as double-clicking on it to open it in a tool or application, and to use CSIDL\_LOCAL\_APPDATA for other files.</span></span> <span data-ttu-id="b488e-214">Ambas as pastas podem ser aproveitadas pelo seu aplicativo para armazenar e organizar arquivos de dados específicos do usuário, pois não há nenhuma diferença no seu escopo de acesso ou nível de privilégio.</span><span class="sxs-lookup"><span data-stu-id="b488e-214">Both folders can be leveraged by your application to store and organize user-specific data files, as there is no difference in their access scope or privilege level.</span></span> <span data-ttu-id="b488e-215">Deve-se ter cuidado para criar nomes de caminho que sejam exclusivos o suficiente para não colidir com outros aplicativos, mas curto o suficiente para manter o número de caracteres no caminho completo menor que o valor de \_ caminho máximo, 260.</span><span class="sxs-lookup"><span data-stu-id="b488e-215">Care should be taken to create path names that are unique enough to not collide with other applications, but short enough to keep the number of characters in the full path fewer than the value of MAX\_PATH, 260.</span></span>

<span data-ttu-id="b488e-216">O código a seguir fornece um exemplo de como gravar um arquivo em uma pasta conhecida:</span><span class="sxs-lookup"><span data-stu-id="b488e-216">The following code provides an example of how to write a file to a known folder:</span></span>

``` syntax
#include <windows.h>
#include <shlobj.h>
#include <shlwapi.h>
        ...
        ...
        ...
        TCHAR strPath[MAX_PATH];
        if( SUCCEEDED(
        SHGetFolderPath( NULL, CSIDL_PERSONAL, NULL, SHGFP_TYPE_CURRENT, strPath ) ) )
        {
        PathAppend( strPath, TEXT( "Company Name\\Title" ) );

        if( !PathFileExists( strPath ) )
        {
        if( ERROR_SUCCESS != SHCreateDirectoryEx( NULL, strPath, NULL ) )
        return E_FAIL;
        }

        PathAppend( strPath, TEXT( "gamefile.txt" ) );

        // strPath is now something like:
        // C:\Users\<current user>\Documents\Company Name\Title\gamefile.txt
        // Open the file for writing
        HANDLE hFile = CreateFile(strPath, GENERIC_WRITE, NULL, NULL, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL);

        if( INVALID_HANDLE_VALUE != hFile )
        {
        // TODO: Write to file
        CloseHandle(hFile);
        }
        }
```

## <a name="registry-access-as-a-standard-user"></a><span data-ttu-id="b488e-217">Acesso de registro como usuário padrão</span><span class="sxs-lookup"><span data-stu-id="b488e-217">Registry Access as a Standard User</span></span>

<span data-ttu-id="b488e-218">O acesso ao registro por um usuário padrão é restrito de maneira semelhante ao sistema de arquivos.</span><span class="sxs-lookup"><span data-stu-id="b488e-218">Registry access by a standard user is restricted in a similar fashion as the file system.</span></span> <span data-ttu-id="b488e-219">Um usuário padrão tem permissão de acesso de leitura para todas as chaves no registro; no entanto, o acesso de gravação só é concedido à \_ subárvore de HKEY Current \_ User (HKCU), que é mapeada internamente para a subchave específica do usuário hKey \_ Users \\ ID de segurança (SID) do usuário atual.</span><span class="sxs-lookup"><span data-stu-id="b488e-219">A standard user is permitted read access to all keys in the registry; however, write access is only granted to the HKEY\_CURRENT\_USER (HKCU) subtree, which is mapped internally to the user-specific subkey HKEY\_USERS\\Security ID (SID) of current user.</span></span> <span data-ttu-id="b488e-220">Um aplicativo que precisa gravar em qualquer local do registro diferente de HKEY \_ Current \_ User requer privilégios administrativos.</span><span class="sxs-lookup"><span data-stu-id="b488e-220">An application that needs to write to any registry location other than HKEY\_CURRENT\_USER requires administrative privileges.</span></span>

<span data-ttu-id="b488e-221">Se o aplicativo de 32 bits não contiver um nível de execução solicitado em seu manifesto, todas as gravações em HKEY \_ local \_ Machine \\ software serão virtualizadas, enquanto as gravações em outros locais fora do hKey \_ Current \_ User falharão.</span><span class="sxs-lookup"><span data-stu-id="b488e-221">If the 32-bit application does not contain a requested execution level in its manifest, then all writes to HKEY\_LOCAL\_MACHINE\\Software will be virtualized, while writes to other locations outside of HKEY\_CURRENT\_USER will fail.</span></span>

<span data-ttu-id="b488e-222">O armazenamento de dados persistentes no registro, como a configuração de um usuário, não é recomendado.</span><span class="sxs-lookup"><span data-stu-id="b488e-222">Storing persistent data in the registry, like a user's configuration, is not recommended.</span></span> <span data-ttu-id="b488e-223">O método preferencial para armazenar dados persistentes do jogo é gravar os dados no sistema de arquivos chamando [**SHGetFolderPath**](/windows/win32/api/shlobj_core/nf-shlobj_core-shgetfolderpatha) e obter o valor de uma constante CSIDL, descrita na seção anterior.</span><span class="sxs-lookup"><span data-stu-id="b488e-223">The preferred method of storing persistent data from your game is to write the data to the file system by calling [**SHGetFolderPath**](/windows/win32/api/shlobj_core/nf-shlobj_core-shgetfolderpatha) and to get the value of a CSIDL constant, described in the previous section.</span></span>

## <a name="privilege-elevation"></a><span data-ttu-id="b488e-224">Elevação de privilégio</span><span class="sxs-lookup"><span data-stu-id="b488e-224">Privilege Elevation</span></span>

<span data-ttu-id="b488e-225">No Windows Vista, qualquer aplicativo que exija privilégios administrativos deve declarar uma solicitação de um nível de execução administrativo em seu manifesto (descrito na próxima seção, [definindo o nível de execução no manifesto do aplicativo](#setting-the-execution-level-in-the-application-manifest)).</span><span class="sxs-lookup"><span data-stu-id="b488e-225">In Windows Vista, any application that requires administrative privileges must declare a request for an administrative execution level in its manifest (described in the next section, [Setting the Execution Level in the Application Manifest](#setting-the-execution-level-in-the-application-manifest)).</span></span>

<span data-ttu-id="b488e-226">A elevação, como é conhecida, é o procedimento controlado pelo UAC para promover um processo a um processo administrativo.</span><span class="sxs-lookup"><span data-stu-id="b488e-226">Elevation, as it is known, is the procedure driven by UAC to promote a process to an administrative process.</span></span> <span data-ttu-id="b488e-227">Os privilégios de um processo só podem ser elevados no momento da criação.</span><span class="sxs-lookup"><span data-stu-id="b488e-227">The privileges of a process can only be elevated at creation time.</span></span> <span data-ttu-id="b488e-228">Depois de criado, um processo nunca será promovido a um nível de privilégio mais alto.</span><span class="sxs-lookup"><span data-stu-id="b488e-228">Once created, a process will never be promoted to a higher privilege level.</span></span> <span data-ttu-id="b488e-229">Por esse motivo.</span><span class="sxs-lookup"><span data-stu-id="b488e-229">For this reason.</span></span> <span data-ttu-id="b488e-230">as operações que exigem credenciais administrativas devem ser isoladas para instaladores separados e outros programas auxiliares.</span><span class="sxs-lookup"><span data-stu-id="b488e-230">operations that require administrative credentials should be isolated to separate installers and other auxiliary programs.</span></span>

<span data-ttu-id="b488e-231">Após a execução de um programa, o UAC inspeciona o nível de execução solicitado no manifesto e, se forem necessários privilégios elevados, solicitará ao usuário atual uma das duas caixas de diálogo padrão: uma para um usuário padrão e outra para um administrador.</span><span class="sxs-lookup"><span data-stu-id="b488e-231">Upon execution of a program, UAC inspects the requested execution level in the manifest, and if elevated privileges are required, prompts the current user with one of two standard dialog boxes: one for a standard user and one for an administrator.</span></span>

<span data-ttu-id="b488e-232">Se o usuário atual for um usuário padrão, o UAC solicitará ao usuário as credenciais de um administrador antes de permitir que o programa seja executado.</span><span class="sxs-lookup"><span data-stu-id="b488e-232">If the current user is a standard user, UAC prompts the user for the credentials of an administrator before allowing the program to run.</span></span>

<span data-ttu-id="b488e-233">**Figura 1. Solicitar que um usuário padrão insira credenciais para uma conta administrativa**</span><span class="sxs-lookup"><span data-stu-id="b488e-233">**Figure 1. Prompt for a Standard User to enter credentials for an administrative account**</span></span>

![solicitar que um usuário padrão insira credenciais para uma conta administrativa](images/uac-prompt-elevation.jpg)

<span data-ttu-id="b488e-235">Se o usuário atual for um administrador, o UAC solicitará permissão ao usuário antes de permitir que o programa seja executado.</span><span class="sxs-lookup"><span data-stu-id="b488e-235">If the current user is an administrator, UAC prompts the user for permission before allowing the program to run.</span></span>

<span data-ttu-id="b488e-236">**Figura 2. Solicitar que um administrador autorize alterações no computador**</span><span class="sxs-lookup"><span data-stu-id="b488e-236">**Figure 2. Prompt for an Administrator to authorize changes to the computer**</span></span>

![solicitar que um administrador autorize alterações no computador](images/uac-prompt-authorization.jpg)

<span data-ttu-id="b488e-238">O aplicativo só receberá privilégios administrativos se um usuário padrão fornecer as credenciais administrativas apropriadas ou um usuário administrativo fornecer a confirmação; qualquer outra coisa fará com que o aplicativo seja encerrado.</span><span class="sxs-lookup"><span data-stu-id="b488e-238">The application will only be granted administrative privileges if a standard user provides the proper administrative credentials or an administrative user provides acknowledgement; anything else will cause the application to terminate.</span></span>

<span data-ttu-id="b488e-239">É importante observar que um processo com privilégios elevados é executado como o usuário administrativo que inseriu as credenciais no prompt do UAC, e não como o usuário padrão que está conectado no momento.</span><span class="sxs-lookup"><span data-stu-id="b488e-239">It is important to note that a process with elevated privileges runs as the administrative user who entered credentials in the UAC prompt rather than as the standard user who is currently logged in.</span></span> <span data-ttu-id="b488e-240">Isso é semelhante ao **runas** no Windows XP o processo elevado Obtém a pasta do administrador e as chaves do registro ao acessar dados por usuário, e todos os programas que o processo elevado inicia também herdam os locais de conta de usuário e direitos administrativos.</span><span class="sxs-lookup"><span data-stu-id="b488e-240">This is similar to **RunAs** in Windows XP   the elevated process gets the administrator's folder and registry keys when accessing per-user data, and all programs that the elevated process launches also inherit both the administrative rights and user account locations.</span></span> <span data-ttu-id="b488e-241">Para os administradores que são solicitados a confirmar (**continuar** ou **Cancelar**), esses locais corresponderão aos locais do usuário no momento.</span><span class="sxs-lookup"><span data-stu-id="b488e-241">For administrators who are prompted for acknowledgement (**Continue** or **Cancel**), these locations will match the currently user's locations.</span></span> <span data-ttu-id="b488e-242">Em geral, no entanto, processos que exigem elevação não devem operar em dados por usuário.</span><span class="sxs-lookup"><span data-stu-id="b488e-242">In general, however, processes that require elevation should not operate on per-user data.</span></span> <span data-ttu-id="b488e-243">Observe que isso pode afetar substancialmente como o instalador deve funcionar!</span><span class="sxs-lookup"><span data-stu-id="b488e-243">Note that this can substantially affect how your installer must operate!</span></span> <span data-ttu-id="b488e-244">Se o instalador, em execução como administrador, gravar em HKCU ou em um perfil de usuário, talvez esteja muito bem gravando no local errado.</span><span class="sxs-lookup"><span data-stu-id="b488e-244">If the installer, running as an administrator, writes to HKCU or to a user's profile, it may very well be writing to the wrong location.</span></span> <span data-ttu-id="b488e-245">Considere a criação desses valores por usuário na primeira execução do jogo.</span><span class="sxs-lookup"><span data-stu-id="b488e-245">Consider creating these per-user values upon the first run of the game.</span></span>

## <a name="uac-implications-with-createprocess"></a><span data-ttu-id="b488e-246">Implicações do UAC com CreateProcess ()</span><span class="sxs-lookup"><span data-stu-id="b488e-246">UAC Implications with CreateProcess()</span></span>

<span data-ttu-id="b488e-247">O mecanismo de elevação do UAC não será invocado de uma chamada para a função do Win32 [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa)() para iniciar um executável que é configurado para exigir um nível de execução mais alto do que o processo atual.</span><span class="sxs-lookup"><span data-stu-id="b488e-247">The UAC elevation mechanism will not be invoked from a call to the Win32 [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa)() function to start an executable which is configured to require a higher execution level than the current process.</span></span> <span data-ttu-id="b488e-248">Como resultado, a chamada para **CreateProcess**() falhará com [**GetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror)() retornando elevação de erro \_ \_ necessária.</span><span class="sxs-lookup"><span data-stu-id="b488e-248">As a result, the call to **CreateProcess**() will fail with [**GetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror)() returning ERROR\_ELEVATION\_REQUIRED.</span></span> <span data-ttu-id="b488e-249">**CreateProcess**() só terá sucesso quando o nível de execução do receptor for igual ou menor que o do chamador.</span><span class="sxs-lookup"><span data-stu-id="b488e-249">**CreateProcess**() will only succeed when the execution level of the callee is equal-to or less-than that of the caller.</span></span> <span data-ttu-id="b488e-250">Um processo não elevado que deve gerar processos elevados deve fazer isso usando a função [**ShellExecute**](/windows/win32/api/shellapi/nf-shellapi-shellexecutea)(), que fará com que o mecanismo de elevação do UAC seja disparado por meio do Shell.</span><span class="sxs-lookup"><span data-stu-id="b488e-250">A non-elevated process that must spawn elevated processes should do so using the [**ShellExecute**](/windows/win32/api/shellapi/nf-shellapi-shellexecutea)() function, which will cause the UAC elevation mechanism to be triggered by means of the shell.</span></span>

## <a name="setting-the-execution-level-in-the-application-manifest"></a><span data-ttu-id="b488e-251">Definindo o nível de execução no manifesto do aplicativo</span><span class="sxs-lookup"><span data-stu-id="b488e-251">Setting the Execution Level in the Application Manifest</span></span>

<span data-ttu-id="b488e-252">Você declara o nível de execução solicitado de seu jogo adicionando uma extensão ao manifesto do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b488e-252">You declare the requested execution level of your game by adding an extension to the application s manifest.</span></span> <span data-ttu-id="b488e-253">O código XML a seguir mostra a configuração mínima necessária para definir o nível de execução para um aplicativo:</span><span class="sxs-lookup"><span data-stu-id="b488e-253">The following XML code shows the minimal configuration required to set the execution level for an application:</span></span>

``` syntax
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0">
    <ms_asmv2:trustInfo xmlns:ms_asmv2="urn:schemas-microsoft-com:asm.v2">
        <ms_asmv2:security>
            <ms_asmv2:requestedPrivileges>
                <ms_asmv2:requestedExecutionLevel level="asInvoker" uiAccess="false" />
            </ms_asmv2:requestedPrivileges>
        </ms_asmv2:security>
    </ms_asmv2:trustInfo>
</assembly>
```

<span data-ttu-id="b488e-254">No código anterior, o sistema operacional é informado de que o jogo requer apenas privilégios de usuário padrão pela seguinte marca:</span><span class="sxs-lookup"><span data-stu-id="b488e-254">In the preceding code, the operating system is informed that the game only requires standard user privileges by the following tag:</span></span>

``` syntax
<ms_asmv2:requestedExecutionLevel level="asInvoker" uiAccess="false" />
```

<span data-ttu-id="b488e-255">Ao definir explicitamente requestedExecutionLevel como "asInvoker", este exemplo declara que o sistema operacional se comportará corretamente sem privilégios administrativos.</span><span class="sxs-lookup"><span data-stu-id="b488e-255">By explicitly setting requestedExecutionLevel to "asInvoker", this example asserts to the operating system that the game will behave properly without administrative privileges.</span></span> <span data-ttu-id="b488e-256">Como resultado, o UAC desabilita a virtualização e executa o jogo com os mesmos privilégios que o chamador, que normalmente é de privilégios de usuário padrão, uma vez que o Windows Explorer é executado como usuário padrão.</span><span class="sxs-lookup"><span data-stu-id="b488e-256">As a result, UAC disables virtualization and runs the game with the same privileges as the invoker   which is typically standard user privileges, since Windows Explorer runs as standard user.</span></span>

<span data-ttu-id="b488e-257">O sistema operacional pode ser informado de que um jogo requer elevação para privilégios administrativos, substituindo "asInvoker" por "requireAdministrator", para criar a seguinte marca:</span><span class="sxs-lookup"><span data-stu-id="b488e-257">The operating system can be informed a game requires elevation to administrative privileges by replacing "asInvoker" with "requireAdministrator", to create the following tag:</span></span>

``` syntax
<ms_asmv2:requestedExecutionLevel level="requireAdministrator" uiAccess="false" />
```

<span data-ttu-id="b488e-258">Com essa configuração, o sistema operacional solicita ao usuário atual uma das caixas de diálogo de elevação padrão do UAC toda vez que o jogo é executado.</span><span class="sxs-lookup"><span data-stu-id="b488e-258">With this configuration, the operating system prompts the current user with one of the standard UAC elevation dialogs every time that the game is executed.</span></span> <span data-ttu-id="b488e-259">É altamente recomendável que nenhum jogo exija privilégios de administrador para ser executado, pois não apenas essa caixa de diálogo se tornará apenas irritante, mas também fará com que o jogo seja incompatível com controles dos pais.</span><span class="sxs-lookup"><span data-stu-id="b488e-259">It is highly recommended that no game require administrator privileges to run, because not only will this dialog quickly become annoying, but it also makes the game incompatible with parental controls.</span></span> <span data-ttu-id="b488e-260">Pense muito cuidadosamente antes de adicionar esse requisito a qualquer executável.</span><span class="sxs-lookup"><span data-stu-id="b488e-260">Think very carefully before adding this requirement to any executable.</span></span>

<span data-ttu-id="b488e-261">Um equívoco comum é que a adição de um manifesto que define requestedExecutionLevel como "requireAdministrator" ignora a necessidade de um prompt de elevação.</span><span class="sxs-lookup"><span data-stu-id="b488e-261">A common misconception is that adding a manifest that sets requestedExecutionLevel to "requireAdministrator" bypasses the need for an elevation prompt.</span></span> <span data-ttu-id="b488e-262">Isso não é verdade.</span><span class="sxs-lookup"><span data-stu-id="b488e-262">This is not true.</span></span> <span data-ttu-id="b488e-263">Ele simplesmente impede que o sistema operacional Adivinhe se seu aplicativo de instalação ou atualização precisa de privilégios administrativos.</span><span class="sxs-lookup"><span data-stu-id="b488e-263">It simply prevents the operating system from guessing whether your setup or update application needs administrative privileges.</span></span> <span data-ttu-id="b488e-264">O usuário ainda será solicitado a autorizar a elevação.</span><span class="sxs-lookup"><span data-stu-id="b488e-264">The user is still prompted to authorize elevation.</span></span>

<span data-ttu-id="b488e-265">O Windows verifica a assinatura de qualquer aplicativo marcado para elevação antes de exibir o prompt do UAC.</span><span class="sxs-lookup"><span data-stu-id="b488e-265">Windows checks the signature of any application that is marked for elevation before it displays the UAC prompt.</span></span> <span data-ttu-id="b488e-266">Um executável grande que é marcado para elevação leva mais tempo para ser verificado do que um pequeno executável e mais longo do que um executável marcado como "asInvoker".</span><span class="sxs-lookup"><span data-stu-id="b488e-266">A large executable that is marked for elevation takes longer to check than a small executable and longer than an executable that is marked as "asInvoker".</span></span> <span data-ttu-id="b488e-267">Os executáveis de instalação que são de extração automática devem, portanto, ser marcados como "asInvoker" e qualquer parte que precise ser marcada como "requireAdministrator" deve ser colocada em um executável auxiliar separado.</span><span class="sxs-lookup"><span data-stu-id="b488e-267">Setup executables that are self-extracting should, therefore, be marked as "asInvoker", and any portion that needs to be marked as "requireAdministrator" should be placed in a separate helper executable.</span></span>

<span data-ttu-id="b488e-268">O atributo uiAccess, mostrado nos exemplos anteriores, deve ser sempre FALSE para jogos.</span><span class="sxs-lookup"><span data-stu-id="b488e-268">The uiAccess attribute, shown in the preceding examples, should always be FALSE for games.</span></span> <span data-ttu-id="b488e-269">Esse atributo especifica se os clientes de automação da interface do usuário têm acesso à interface do usuário do sistema protegido e têm implicações de segurança especiais se estiverem definidos como TRUE.</span><span class="sxs-lookup"><span data-stu-id="b488e-269">This attribute specifies whether UI automation clients have access to the protected system UI, and it has special security implications if set to TRUE.</span></span>

## <a name="embedding-a-manifest-in-visual-studio"></a><span data-ttu-id="b488e-270">Inserindo um manifesto no Visual Studio</span><span class="sxs-lookup"><span data-stu-id="b488e-270">Embedding a Manifest in Visual Studio</span></span>

<span data-ttu-id="b488e-271">O suporte ao manifesto foi adicionado primeiro ao Visual Studio a partir do VS2005.</span><span class="sxs-lookup"><span data-stu-id="b488e-271">Manifest support was first added to Visual Studio beginning in VS2005.</span></span> <span data-ttu-id="b488e-272">Por padrão, um executável criado no Visual Studio 2005 (ou mais recente) terá um manifesto gerado automaticamente inserido como parte do processo de compilação.</span><span class="sxs-lookup"><span data-stu-id="b488e-272">By default, an executable built in Visual Studio 2005 (or newer) will have an auto-generated manifest embedded in it as part of the build process.</span></span> <span data-ttu-id="b488e-273">O conteúdo do manifesto gerado automaticamente depende de determinadas configurações de projeto que você especifica na caixa de diálogo Propriedades do projeto.</span><span class="sxs-lookup"><span data-stu-id="b488e-273">The contents of the auto-generated manifest are dependent on certain project configurations that you specify in the project properties dialog.</span></span>

<span data-ttu-id="b488e-274">O manifesto gerado automaticamente pelo Visual Studio 2005 não conterá um <trustInfo> bloco, pois não há como configurar o nível de execução do UAC nas propriedades do projeto.</span><span class="sxs-lookup"><span data-stu-id="b488e-274">The manifest that is auto-generated by Visual Studio 2005 will not contain a <trustInfo> block as there is no way to configure the UAC execution level in the project properties.</span></span> <span data-ttu-id="b488e-275">A maneira preferida de adicionar essas informações é permitir que o VS2005 Mescle um manifesto definido pelo usuário que contenha o <trustInfo> bloco com o manifesto gerado automaticamente.</span><span class="sxs-lookup"><span data-stu-id="b488e-275">The preferred way to add this information is to let VS2005 merge a user-defined manifest containing the <trustInfo> block with the auto-generated manifest.</span></span> <span data-ttu-id="b488e-276">Isso é tão simples quanto adicionar um \* arquivo. manifest à sua solução que contém o XML listado na seção anterior.</span><span class="sxs-lookup"><span data-stu-id="b488e-276">This is as simple as adding a \*.manifest file to your solution that contains the XML listed in the previous section.</span></span> <span data-ttu-id="b488e-277">Quando o Visual Studio encontra um arquivo. manifest em sua solução, ele invocará automaticamente a ferramenta de manifesto (mt.exe) para mesclar os arquivos. manifest com o gerado automaticamente.</span><span class="sxs-lookup"><span data-stu-id="b488e-277">When Visual Studio encounters a .manifest file in your solution, it will automatically invoke the Manifest Tool (mt.exe) to merge the .manifest files with the auto-generated one.</span></span>

> [!Note]  
> <span data-ttu-id="b488e-278">Há um bug na ferramenta de manifesto (mt.exe) fornecido pelo Visual Studio 2005 que resulta em um manifesto mesclado e incorporado que pode causar problemas quando o executável é executado no Windows XP antes do SP3.</span><span class="sxs-lookup"><span data-stu-id="b488e-278">There is a bug in the Manifest Tool (mt.exe) provided by Visual Studio 2005 that results in a merged and embedded manifest which can cause problems when the executable is run on Windows XP prior to SP3.</span></span> <span data-ttu-id="b488e-279">O bug é um resultado de como a ferramenta redefine o namespace padrão na declaração do <trustInfo> bloco.</span><span class="sxs-lookup"><span data-stu-id="b488e-279">The bug is a result of how the tool redefines the default namespace upon declaration of the <trustInfo> block.</span></span> <span data-ttu-id="b488e-280">Felizmente, é fácil ignorar o problema inteiramente declarando explicitamente um namespace diferente no <trustInfo> bloco e escopondo os nós filho para o novo namespace.</span><span class="sxs-lookup"><span data-stu-id="b488e-280">Fortunately, it is easy to bypass the issue entirely by explicitly declaring a different namespace in the <trustInfo> block and by scoping the child nodes to the new namespace.</span></span> <span data-ttu-id="b488e-281">O XML fornecido na seção anterior demonstra essa correção.</span><span class="sxs-lookup"><span data-stu-id="b488e-281">The XML provided in the previous section demonstrates this fix.</span></span>

 

<span data-ttu-id="b488e-282">Uma limitação no uso da ferramenta de mt.exe incluída no Visual Studio 2005 é que ela gerará um aviso ao processar o <trustInfo> bloco, pois a ferramenta não contém um esquema atualizado para validar o XML.</span><span class="sxs-lookup"><span data-stu-id="b488e-282">A caveat in using the mt.exe tool included in Visual Studio 2005 is that it will generate a warning when processing the <trustInfo> block as the tool does not contain an updated schema to validate the XML against.</span></span> <span data-ttu-id="b488e-283">Para corrigir esse aviso, é recomendável substituir todos os arquivos de mt.exe no diretório de instalação do Visual Studio 2005 (há várias instâncias) com os mt.exe fornecidos na SDK do Windows mais recente.</span><span class="sxs-lookup"><span data-stu-id="b488e-283">To remedy this warning, it is recommended that you replace all mt.exe files under the Visual Studio 2005 install directory (there are multiple instances) with the mt.exe provided in the latest Windows SDK.</span></span>

<span data-ttu-id="b488e-284">A partir do Visual Studio 2008, agora você pode especificar um nível de execução do aplicativo de dentro da caixa de diálogo de propriedades do projeto (Figura 3) ou usando o sinalizador do vinculador/MANIFESTUAC.</span><span class="sxs-lookup"><span data-stu-id="b488e-284">Beginning in Visual Studio 2008, you can now specify an application's execution level from within the project properties dialog (Figure 3), or by using the /MANIFESTUAC linker flag.</span></span> <span data-ttu-id="b488e-285">Definir essas opções fará com que o Visual Studio 2008 gere automaticamente e insira um manifesto com o <trustInfo> bloco apropriado no executável.</span><span class="sxs-lookup"><span data-stu-id="b488e-285">Setting these options will cause Visual Studio 2008 to auto-generate and embed a manifest with the appropriate <trustInfo> block into the executable.</span></span>

<span data-ttu-id="b488e-286">**Figura 3. Definindo o nível de execução no Visual Studio 2008**</span><span class="sxs-lookup"><span data-stu-id="b488e-286">**Figure 3. Setting the execution level in Visual Studio 2008**</span></span>

![definindo o nível de execução no Visual Studio 2008](images/setting-execution-level-in-vs2008.jpg)

<span data-ttu-id="b488e-288">A inserção de um manifesto em versões mais antigas do Visual Studio sem suporte a manifesto ainda é possível, mas requer mais trabalho do desenvolvedor.</span><span class="sxs-lookup"><span data-stu-id="b488e-288">Embedding a manifest in older versions of Visual Studio without manifest support is still possible, but does require more work from the developer.</span></span> <span data-ttu-id="b488e-289">Para obter um exemplo de como fazer isso, examine o projeto do Visual Studio 2003 incluído em qualquer amostra no SDK do DirectX antes da versão de 2008 de março.</span><span class="sxs-lookup"><span data-stu-id="b488e-289">For an example on how to do this, please examine the Visual Studio 2003 project included in any sample in the DirectX SDK prior to the March 2008 release.</span></span>

## <a name="uac-compatibility-with-older-games"></a><span data-ttu-id="b488e-290">Compatibilidade com o UAC com jogos mais antigos</span><span class="sxs-lookup"><span data-stu-id="b488e-290">UAC Compatibility with Older Games</span></span>

<span data-ttu-id="b488e-291">Se seu jogo parece estar salvando e carregando um arquivo com êxito no diretório arquivos de programas, mas sem evidências do arquivo de íon do Windows Vista, qualquer aplicativo de 32 bits que não contenha um nível de execução solicitado em seu manifesto é considerado um aplicativo herdado.</span><span class="sxs-lookup"><span data-stu-id="b488e-291">If your game appears to be saving and loading a file successfully to the Program Files directory, yet no evidence of the file iOn Windows Vista, any 32-bit application that does not contain a requested execution level in its manifest is considered a legacy application.</span></span> <span data-ttu-id="b488e-292">Antes do Windows Vista, a maioria dos aplicativos eram normalmente executados por usuários com privilégios administrativos.</span><span class="sxs-lookup"><span data-stu-id="b488e-292">Prior to Windows Vista, most applications were typically run by users with administrative privileges.</span></span> <span data-ttu-id="b488e-293">Como resultado, esses aplicativos podiam ler e gravar livremente arquivos do sistema e chaves do registro, e muitos desenvolvedores não fizeram as alterações necessárias para funcionar corretamente em contas de usuário limitadas no Windows XP.</span><span class="sxs-lookup"><span data-stu-id="b488e-293">As a result, these applications could freely read and write system files and registry keys, and many developers did not make the changes needed to work properly on Limited User Accounts on Windows XP.</span></span> <span data-ttu-id="b488e-294">No entanto, no Windows Vista, esses mesmos aplicativos falhariam devido a privilégios de acesso insuficientes no novo modelo de segurança, o que impõe a execução de usuário padrão para aplicativos herdados.</span><span class="sxs-lookup"><span data-stu-id="b488e-294">However on Windows Vista, these same applications would now fail due to insufficient access privileges under the new security model, which enforces standard user execution for legacy applications.</span></span> <span data-ttu-id="b488e-295">Para reduzir o impacto disso, a virtualização também foi adicionada ao Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="b488e-295">To mitigate the impact of this, virtualization was also added to Windows Vista.</span></span> <span data-ttu-id="b488e-296">A virtualização impedirá que milhares de aplicativos herdados funcionem bem no Windows Vista sem exigir que esses aplicativos tenham privilégios elevados o tempo todo apenas para serem bem-sucedidos em algumas operações secundárias.</span><span class="sxs-lookup"><span data-stu-id="b488e-296">Virtualization will keep thousands of legacy applications working well on Windows Vista without requiring those applications to have elevated privileges at all times simply to succeed at a few minor operations.</span></span> <span data-ttu-id="b488e-297">s encontrados, é provável que seu jogo esteja sendo executado no modo herdado e esteja sujeito à virtualização.</span><span class="sxs-lookup"><span data-stu-id="b488e-297">s found, chances are your game is running in legacy mode and was subjected to virtualization.</span></span>

<span data-ttu-id="b488e-298">A virtualização afeta o sistema de arquivos e o registro redirecionando gravações sensíveis ao sistema (e operações de registro ou arquivo subsequentes) para um local por usuário dentro do perfil do usuário atual.</span><span class="sxs-lookup"><span data-stu-id="b488e-298">Virtualization affects the file system and registry by redirecting system-sensitive writes (and subsequent file or registry operations) to a per-user location within the current user's profile.</span></span> <span data-ttu-id="b488e-299">Por exemplo, se um aplicativo tentar gravar no seguinte arquivo:</span><span class="sxs-lookup"><span data-stu-id="b488e-299">For example, if an application attempts to write to the following file:</span></span>

<dl> <span data-ttu-id="b488e-300">C: \\ arquivos de programas \\ nome da empresa \\ título \\config.ini</span><span class="sxs-lookup"><span data-stu-id="b488e-300">C:\\Program Files\\Company Name\\Title\\config.ini</span></span>  
</dl>

<span data-ttu-id="b488e-301">a gravação é redirecionada automaticamente para:</span><span class="sxs-lookup"><span data-stu-id="b488e-301">the write is automatically redirected to:</span></span>

<dl> <span data-ttu-id="b488e-302">C: \\ Users \\ User name \\ AppData \\ local \\ VirtualStore \\ Program files \\ nome da empresa \\ title \\config.ini</span><span class="sxs-lookup"><span data-stu-id="b488e-302">C:\\Users\\user name\\AppData\\Local\\VirtualStore\\Program Files\\Company Name\\Title\\config.ini</span></span>  
</dl>

<span data-ttu-id="b488e-303">Da mesma forma, se um aplicativo tentar gravar um valor de registro como o seguinte:</span><span class="sxs-lookup"><span data-stu-id="b488e-303">Likewise, if an application attempts to write a registry value like the following:</span></span>

<dl> <span data-ttu-id="b488e-304">HKEY \_ local \_ Machine \\ software \\ empresa nome \\ título</span><span class="sxs-lookup"><span data-stu-id="b488e-304">HKEY\_LOCAL\_MACHINE\\Software\\Company Name\\Title</span></span>  
</dl>

<span data-ttu-id="b488e-305">Ele será redirecionado em vez de:</span><span class="sxs-lookup"><span data-stu-id="b488e-305">it will be redirected instead to:</span></span>

<dl> <span data-ttu-id="b488e-306">HKEY \_ Current \_ user \\ software \\ classes \\ VirtualStore \\ Machine \\ software \\ empresa name \\ title</span><span class="sxs-lookup"><span data-stu-id="b488e-306">HKEY\_CURRENT\_USER\\Software\\Classes\\VirtualStore\\MACHINE\\Software\\Company Name\\Title</span></span>  
</dl>

<span data-ttu-id="b488e-307">Arquivos e chaves do registro afetados pela virtualização só são acessados por operações de arquivo e registro de aplicativos virtualizados que estão sendo executados como o usuário atual.</span><span class="sxs-lookup"><span data-stu-id="b488e-307">Files and registry keys affected by virtualization are only be accessed by file and registry operations from virtualized applications that are running as the current user.</span></span>

<span data-ttu-id="b488e-308">No entanto, há muitas restrições à virtualização.</span><span class="sxs-lookup"><span data-stu-id="b488e-308">However, there are many restrictions to virtualization.</span></span> <span data-ttu-id="b488e-309">Um é que os aplicativos de 64 bits nunca são executados no modo herdado para operações de compatibilidade sujeitas à virtualização em aplicativos de 32 bits falharão no 64 bit.</span><span class="sxs-lookup"><span data-stu-id="b488e-309">One is that 64-bit applications are never run in legacy mode for compatibility   operations subjected to virtualization in 32-bit applications will just fail in 64-bit.</span></span> <span data-ttu-id="b488e-310">Além disso, se um aplicativo herdado executado como um usuário padrão tentar gravar qualquer tipo de arquivo executável em um local que exija credenciais administrativas, a virtualização não ocorrerá e ocorrerá uma falha na gravação.</span><span class="sxs-lookup"><span data-stu-id="b488e-310">Also if a legacy application running as a standard user tries to write any type of executable file to a location that requires administrative credentials, then virtualization will not occur and the write will fail.</span></span>

<span data-ttu-id="b488e-311">**Figura 4. Processo de virtualização**</span><span class="sxs-lookup"><span data-stu-id="b488e-311">**Figure 4. Virtualization Process**</span></span>

![processo de virtualização](images/uac-virtualization-process.jpg)

<span data-ttu-id="b488e-313">Quando um aplicativo herdado tenta uma operação de leitura em locais sensíveis ao sistema no sistema de arquivos ou no registro, os locais virtuais são pesquisados primeiro.</span><span class="sxs-lookup"><span data-stu-id="b488e-313">When a legacy application attempts a read operation on system-sensitive locations in the file system or registry, the virtual locations are searched first.</span></span> <span data-ttu-id="b488e-314">Se o arquivo ou a chave do registro não for encontrado, o sistema operacional acessará os locais do sistema padrão.</span><span class="sxs-lookup"><span data-stu-id="b488e-314">If the file or registry key is not found, then the operating system accesses the default system locations.</span></span>

<span data-ttu-id="b488e-315">A virtualização será removida das versões subsequentes do Windows para que seja importante não confiar nesse recurso.</span><span class="sxs-lookup"><span data-stu-id="b488e-315">Virtualization will be removed from subsequent versions of Windows so it important not to rely on this feature.</span></span> <span data-ttu-id="b488e-316">Em vez disso, você deve configurar explicitamente o manifesto do aplicativo para privilégios administrativos ou de usuário padrão, pois isso desabilitará a virtualização.</span><span class="sxs-lookup"><span data-stu-id="b488e-316">Instead, you should explicitly configure your application manifest for either standard user or administrative privileges, as this will disable virtualization.</span></span> <span data-ttu-id="b488e-317">A virtualização também não é óbvia para os usuários finais, portanto, embora a virtualização possa permitir que seu aplicativo seja executado, ele pode gerar chamadas de suporte e dificultar o problema com esses clientes.</span><span class="sxs-lookup"><span data-stu-id="b488e-317">Virtualization is also not obvious to end users, so even though virtualization may allow your application to run, it can generate support calls and make it difficult to trouble-shoot for these customers.</span></span>

<span data-ttu-id="b488e-318">Observe que, se o UAC estiver desabilitado, a virtualização também será desabilitada.</span><span class="sxs-lookup"><span data-stu-id="b488e-318">Note that if UAC is disabled, then virtualization is also disabled.</span></span> <span data-ttu-id="b488e-319">Se a virtualização estiver desabilitada, as contas de usuário padrão se comportarão exatamente como contas de usuário limitadas no Windows XP e os aplicativos herdados poderão não funcionar corretamente para usuários padrão que, de outra forma, teriam êxito devido à virtualização.</span><span class="sxs-lookup"><span data-stu-id="b488e-319">If virtualization is disabled, standard user accounts behave exactly like limited user accounts in Windows XP, and legacy applications may not function correctly for standard users that would otherwise have succeeded due to virtualization.</span></span>

## <a name="legacy-scenarios-and-manifests"></a><span data-ttu-id="b488e-320">Cenários herdados e manifestos</span><span class="sxs-lookup"><span data-stu-id="b488e-320">Legacy Scenarios and Manifests</span></span>

<span data-ttu-id="b488e-321">Para a maioria dos cenários de uso, basta marcar o. exe com os elementos de manifesto do UAC corretos e garantir que o aplicativo funcione corretamente, pois um usuário padrão é suficiente para uma excelente compatibilidade com o UAC.</span><span class="sxs-lookup"><span data-stu-id="b488e-321">For the majority of usage scenarios, simply marking the .exe with the correct UAC manifest elements and ensuring the application works correctly as a Standard User is sufficient for excellent UAC compatibility.</span></span> <span data-ttu-id="b488e-322">A maioria dos jogos estão executando o Windows Vista ou o Windows 7 com o controle de conta de usuário habilitado.</span><span class="sxs-lookup"><span data-stu-id="b488e-322">Most gamers are running Windows Vista or Windows 7 with User Account Control enabled.</span></span> <span data-ttu-id="b488e-323">Para o Windows XP e os usuários no Windows Vista ou no Windows7 com o recurso de controle de conta de usuário desabilitado, eles normalmente são executados usando contas de administrador.</span><span class="sxs-lookup"><span data-stu-id="b488e-323">For Windows XP and users on Windows Vista or Windows7 with the User Account Control feature disabled, they typically run using administrator accounts.</span></span> <span data-ttu-id="b488e-324">Embora esse seja um modo de operação menos seguro, geralmente não haverá nenhum problema de compatibilidade adicional, embora indicado acima, desabilitar o UAC desabilita a virtualização também.</span><span class="sxs-lookup"><span data-stu-id="b488e-324">While this is a less secure mode of operation, it will generally not run into any additional compatibility issues although as noted above, disabling UAC disables virtualization as well.</span></span>

<span data-ttu-id="b488e-325">Há um caso especial que vale a pena observar quando o programa é marcado como "requireAdministrator" no manifesto do UAC.</span><span class="sxs-lookup"><span data-stu-id="b488e-325">There is a special case worth noting when the program is marked as "requireAdministrator" in the UAC manifest.</span></span> <span data-ttu-id="b488e-326">No Windows XP e no Windows Vista ou no Windows 7 com o controle de conta de usuário desabilitado, os elementos do manifesto do UAC são ignorados pelo sistema.</span><span class="sxs-lookup"><span data-stu-id="b488e-326">On Windows XP and on Windows Vista or Windows 7 with User Account Control disabled, the UAC manifest elements are ignored by the system.</span></span> <span data-ttu-id="b488e-327">Nessa situação, os usuários com contas de administrador sempre executarão todos os programas com direitos totais de administrador e, portanto, esses programas funcionarão conforme o esperado.</span><span class="sxs-lookup"><span data-stu-id="b488e-327">In this situation, users with administrator accounts will always run all programs with full administrator rights, and thus these programs will function as expected.</span></span> <span data-ttu-id="b488e-328">Os usuários restritos do Windows XP e os usuários padrão em execução no Windows Vista ou no Windows 7, no entanto, sempre executarão esses programas com direitos restritos e todas as operações de nível de administrador falharão.</span><span class="sxs-lookup"><span data-stu-id="b488e-328">Windows XP Restricted Users and Standard Users running on Windows Vista or Windows 7, however, will always run these programs with restricted rights and all administrator-level operations will fail.</span></span> <span data-ttu-id="b488e-329">Portanto, é recomendável que os programas marcados como "requiretAdministrator" Chamem [**IsUserAnAdmin**](/windows/win32/api/shlobj_core/nf-shlobj_core-isuseranadmin) na inicialização e exibam uma mensagem de erro fatal se ele retornar false.</span><span class="sxs-lookup"><span data-stu-id="b488e-329">It is therefore recommended that programs marked as "requiretAdministrator" call [**IsUserAnAdmin**](/windows/win32/api/shlobj_core/nf-shlobj_core-isuseranadmin) on startup, and display a fatal error message if it returns FALSE.</span></span> <span data-ttu-id="b488e-330">Para o cenário principal acima, isso sempre terá sucesso, mas fornece uma experiência de usuário melhor e uma mensagem de erro clara para essa situação rara.</span><span class="sxs-lookup"><span data-stu-id="b488e-330">For the majority scenario above, this will always succeed, but provides a better user experience and a clear error message for this rare situation.</span></span>

## <a name="conclusion"></a><span data-ttu-id="b488e-331">Conclusão</span><span class="sxs-lookup"><span data-stu-id="b488e-331">Conclusion</span></span>

<span data-ttu-id="b488e-332">Como um desenvolvedor de jogos destinado ao ambiente de vários usuários do Windows, é imperativo que você projete seu jogo para operar com eficiência e responsabilidade.</span><span class="sxs-lookup"><span data-stu-id="b488e-332">As a game developer targeting the Windows multi-user environment, it is imperative that you design your game to operate effectively and responsibly.</span></span> <span data-ttu-id="b488e-333">O arquivo executável principal do seu jogo não deve depender de privilégios administrativos.</span><span class="sxs-lookup"><span data-stu-id="b488e-333">Your game's main executable file should not be dependent on administrative privileges.</span></span> <span data-ttu-id="b488e-334">Isso não apenas impede a aparência de prompts para elevação sempre que o jogo é executado, o que pode afetar negativamente a experiência geral do usuário, mas também permite que seu jogo Aproveite outros recursos que exigem execução com privilégios de usuário padrão, como controles dos pais.</span><span class="sxs-lookup"><span data-stu-id="b488e-334">This not only prevents the appearance of prompts for elevation every time that your game is run   which can negatively impact the overall user experience   but it also enables your game to take advantage of other features that require execution with standard user privileges, such as Parental Controls.</span></span>

<span data-ttu-id="b488e-335">Os aplicativos projetados corretamente para operar como com as credenciais de um usuário padrão (ou usuário limitado) em versões anteriores do Windows não serão afetados pelo UAC que serão executados sem elevação.</span><span class="sxs-lookup"><span data-stu-id="b488e-335">Applications that are properly designed to operate as with the credentials of a standard user (or limited user) under previous versions of Windows will not be impacted by UAC   they will run without elevation.</span></span> <span data-ttu-id="b488e-336">No entanto, eles devem incluir um manifesto com o nível de execução solicitado definido como "asInvoker" para estar em conformidade com os padrões de aplicativo para o vista.</span><span class="sxs-lookup"><span data-stu-id="b488e-336">However, they should include a manifest with their requested execution level set to "asInvoker" to conform to application standards for Vista.</span></span>

## <a name="further-reading"></a><span data-ttu-id="b488e-337">Leitura Adicional</span><span class="sxs-lookup"><span data-stu-id="b488e-337">Further Reading</span></span>

<span data-ttu-id="b488e-338">Para obter ajuda com a criação de aplicativos para o Windows Vista que são compatíveis com o controle de conta de usuário, baixe os seguintes white paper: [requisitos de desenvolvimento de aplicativos do Windows Vista para compatibilidade de controle de conta de usuário](/previous-versions/dotnet/articles/bb530410(v=msdn.10)).</span><span class="sxs-lookup"><span data-stu-id="b488e-338">For assistance with designing applications for Windows Vista that are compliant with User Account Control, download the following white paper: [Windows Vista Application Development Requirements for User Account Control Compatibility](/previous-versions/dotnet/articles/bb530410(v=msdn.10)).</span></span>

<span data-ttu-id="b488e-339">Este white paper fornece etapas detalhadas sobre o processo de design, juntamente com exemplos de código, requisitos e práticas recomendadas.</span><span class="sxs-lookup"><span data-stu-id="b488e-339">This white paper provides detailed steps about the design process, along with code samples, requirements, and best practices.</span></span> <span data-ttu-id="b488e-340">Este documento também detalha as atualizações técnicas e as alterações na experiência do usuário no Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="b488e-340">This paper also details the technical updates and changes to the user experience in Windows Vista.</span></span>

<span data-ttu-id="b488e-341">Para obter mais informações sobre o controle de conta de usuário, visite [Windows Vista: controle de conta de usuário](https://www.microsoft.com/technet/windowsvista/security/uac.mspx) no [Microsoft TechNet](https://www.microsoft.com/technet/).</span><span class="sxs-lookup"><span data-stu-id="b488e-341">For more information about User Account Control, visit [Windows Vista: User Account Control](https://www.microsoft.com/technet/windowsvista/security/uac.mspx) on [Microsoft TechNet](https://www.microsoft.com/technet/).</span></span>

<span data-ttu-id="b488e-342">Outro recurso útil é o artigo [ensinar seus aplicativos a brincar perfeitamente com o controle de conta de usuário do Windows Vista](/archive/msdn-magazine/2007/january/teach-your-apps-to-work-with-windows-vista-user-account-control), da [msdn Magazine](/archive/msdn-magazine/msdn-magazine-issues), de janeiro de 2007.</span><span class="sxs-lookup"><span data-stu-id="b488e-342">Another useful resource is the article [Teach Your Apps To Play Nicely with Windows Vista User Account Control](/archive/msdn-magazine/2007/january/teach-your-apps-to-work-with-windows-vista-user-account-control), from [MSDN Magazine](/archive/msdn-magazine/msdn-magazine-issues), January 2007.</span></span> <span data-ttu-id="b488e-343">Este artigo aborda problemas gerais de compatibilidade de aplicativos, bem como as vantagens e problemas de usar pacotes de Windows Installer no Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="b488e-343">This article discusses general issues of application compatibility, as well as the advantages and issues of using Windows Installer packages on Windows Vista.</span></span>

<span data-ttu-id="b488e-344">Para obter mais informações sobre o bug e a correção para mt.exe, a ferramenta usada pelo Visual Studio 2005 para mesclar e inserir automaticamente um manifesto em um executável, consulte [explorando manifestos parte 2: namespaces padrão e manifestos do UAC no Windows Vista](https://techcommunity.microsoft.com/t5/Windows-Blog-Archive/bg-p/Windows-Blog-Archive/2006/09/08/exploring-manifests-part-2-default-namespaces-and-uac-manifests-in-windows-vista/) no blog de Chris Jackson no [msdn](/archive/blogs/).</span><span class="sxs-lookup"><span data-stu-id="b488e-344">For more information about the bug and the fix for mt.exe, the tool used by Visual Studio 2005 to automatically merge and embed a manifest into an executable, see [Exploring Manifests Part 2: Default Namespaces and UAC Manifests in Windows Vista](https://techcommunity.microsoft.com/t5/Windows-Blog-Archive/bg-p/Windows-Blog-Archive/2006/09/08/exploring-manifests-part-2-default-namespaces-and-uac-manifests-in-windows-vista/) on Chris Jackson's blog on [MSDN](/archive/blogs/).</span></span>

 

