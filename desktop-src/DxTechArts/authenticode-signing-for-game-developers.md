---
title: Assinatura Authenticode para desenvolvedores de jogos
description: Este artigo discute como começar a autenticar seu jogo e como integrar a autenticação em um processo de compilação diário.
ms.assetid: 0b3138ea-e4ea-57fb-756b-62fdc20cf813
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8f304e6cc8e185264699709987f62dfdca17bf8b
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/20/2020
ms.locfileid: "105754684"
---
# <a name="authenticode-signing-for-game-developers"></a><span data-ttu-id="2b86d-103">Assinatura Authenticode para desenvolvedores de jogos</span><span class="sxs-lookup"><span data-stu-id="2b86d-103">Authenticode Signing for Game Developers</span></span>

<span data-ttu-id="2b86d-104">A autenticação de dados é cada vez mais importante para desenvolvedores de jogos.</span><span class="sxs-lookup"><span data-stu-id="2b86d-104">Data authentication is increasingly important for game developers.</span></span> <span data-ttu-id="2b86d-105">O Windows Vista e o Windows 7 têm uma série de recursos, como controles dos pais, que exigem que os jogos sejam assinados corretamente para garantir que nenhum deles tenha adulterado os dados.</span><span class="sxs-lookup"><span data-stu-id="2b86d-105">Windows Vista and Windows 7 have a number of features, such as parental controls, that require games to be properly signed to ensure that no one has tampered with the data.</span></span> <span data-ttu-id="2b86d-106">O Microsoft Authenticode permite que os usuários finais e o sistema operacional verifiquem se o código do programa provém do proprietário e se ele não foi alterado ou acidentalmente corrompido.</span><span class="sxs-lookup"><span data-stu-id="2b86d-106">Microsoft Authenticode enables end users and the operating system to verify that program code comes from the rightful owner and that it hasn't been maliciously altered or accidentally corrupted.</span></span> <span data-ttu-id="2b86d-107">Este artigo discute como começar a autenticar seu jogo e como integrar a autenticação em um processo de compilação diário.</span><span class="sxs-lookup"><span data-stu-id="2b86d-107">This article discusses how to get started with authenticating your game and how to integrate authentication into a daily build process.</span></span>

-   [<span data-ttu-id="2b86d-108">Tela de fundo</span><span class="sxs-lookup"><span data-stu-id="2b86d-108">Background</span></span>](#background)
-   [<span data-ttu-id="2b86d-109">Introdução</span><span class="sxs-lookup"><span data-stu-id="2b86d-109">Getting Started</span></span>](#getting-started)
-   [<span data-ttu-id="2b86d-110">Usando uma autoridade de certificação confiável</span><span class="sxs-lookup"><span data-stu-id="2b86d-110">Using a Trusted Certificate Authority</span></span>](#using-a-trusted-certificate-authority)
-   [<span data-ttu-id="2b86d-111">Exemplo usando um certificado de teste</span><span class="sxs-lookup"><span data-stu-id="2b86d-111">Example Using a Test Certificate</span></span>](#example-using-a-test-certificate)
-   [<span data-ttu-id="2b86d-112">Integrando a assinatura de código no sistema de compilação diário</span><span class="sxs-lookup"><span data-stu-id="2b86d-112">Integrating Code Signing into the Daily Build System</span></span>](#integrating-code-signing-into-the-daily-build-system)
-   [<span data-ttu-id="2b86d-113">Revogação</span><span class="sxs-lookup"><span data-stu-id="2b86d-113">Revocation</span></span>](#revocation)
-   [<span data-ttu-id="2b86d-114">Drivers de assinatura de código</span><span class="sxs-lookup"><span data-stu-id="2b86d-114">Code-Signing Drivers</span></span>](#code-signing-drivers)
-   [<span data-ttu-id="2b86d-115">Resumo</span><span class="sxs-lookup"><span data-stu-id="2b86d-115">Summary</span></span>](#summary)
-   [<span data-ttu-id="2b86d-116">Mais informações</span><span class="sxs-lookup"><span data-stu-id="2b86d-116">More information</span></span>](#more-information)

> [!Note]  
> <span data-ttu-id="2b86d-117">A partir de 1º de janeiro de 2016, o Windows 7 e versões posteriores não confiam mais em nenhum certificado de assinatura de código SHA-1 com uma data de expiração de 1º de janeiro de 2016 ou posterior.</span><span class="sxs-lookup"><span data-stu-id="2b86d-117">As of January 1, 2016, Windows 7 and later no longer trust any SHA-1 code signing certificate with an expiration date of January 1, 2016 or later.</span></span> <span data-ttu-id="2b86d-118">Consulte [imposição do Windows de assinatura de código Authenticode e carimbo de data/hora](https://social.technet.microsoft.com/wiki/contents/articles/32288.windows-enforcement-of-sha1-certificates.aspx) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="2b86d-118">See [Windows Enforcement of Authenticode Code Signing and Timestamping](https://social.technet.microsoft.com/wiki/contents/articles/32288.windows-enforcement-of-sha1-certificates.aspx) for more information.</span></span>

 

## <a name="background"></a><span data-ttu-id="2b86d-119">Tela de fundo</span><span class="sxs-lookup"><span data-stu-id="2b86d-119">Background</span></span>

<span data-ttu-id="2b86d-120">Os certificados digitais são usados para estabelecer a identidade do autor.</span><span class="sxs-lookup"><span data-stu-id="2b86d-120">Digital certificates are used to establish the identity of the author.</span></span> <span data-ttu-id="2b86d-121">Os certificados digitais são emitidos por terceiros confiáveis conhecidos como uma autoridade de certificação (CA), como VeriSign ou Thawte.</span><span class="sxs-lookup"><span data-stu-id="2b86d-121">Digital certificates are issued by a trusted third party known as a Certificate Authority (CA) such as VeriSign or Thawte.</span></span> <span data-ttu-id="2b86d-122">A autoridade de certificação é responsável por verificar se o proprietário não está reivindicando uma identidade falsa.</span><span class="sxs-lookup"><span data-stu-id="2b86d-122">The CA is responsible for verifying that owner is not claiming a false identify.</span></span> <span data-ttu-id="2b86d-123">Depois de aplicar a uma CA para um certificado, os desenvolvedores comerciais podem esperar uma resposta ao seu aplicativo em menos de duas semanas.</span><span class="sxs-lookup"><span data-stu-id="2b86d-123">After applying to a CA for a certificate, commercial developers can expect a response to their application in less than two weeks.</span></span>

<span data-ttu-id="2b86d-124">Depois que a AC decidir que você atende aos seus critérios de política, ele gera um certificado de assinatura de código que está em conformidade com X. 509, o formato de certificado padrão da indústria criado pela International Telecommunications Union, com extensões da versão 3.</span><span class="sxs-lookup"><span data-stu-id="2b86d-124">After the CA decides that you meet its policy criteria, it generates a code-signing certificate that conforms to X.509, the industry-standard certificate format created by the International Telecommunications Union, with Version 3 extensions.</span></span> <span data-ttu-id="2b86d-125">Esse certificado identifica você e contém sua chave pública.</span><span class="sxs-lookup"><span data-stu-id="2b86d-125">This certificate identifies you and contains your public key.</span></span> <span data-ttu-id="2b86d-126">Ele é armazenado pela autoridade de certificação para referência e uma cópia é fornecida eletronicamente.</span><span class="sxs-lookup"><span data-stu-id="2b86d-126">It is stored by the CA for reference, and a copy is given to you electronically.</span></span> <span data-ttu-id="2b86d-127">Ao mesmo tempo, você também cria uma chave privada, que você deve manter segura e que você não deve compartilhar com ninguém, até mesmo a autoridade de certificação.</span><span class="sxs-lookup"><span data-stu-id="2b86d-127">At the same time, you also create a private, key which you must keep safe and which you must not share with anyone, even the CA.</span></span>

<span data-ttu-id="2b86d-128">Depois de ter uma chave pública e privada, você pode começar a distribuir o software assinado.</span><span class="sxs-lookup"><span data-stu-id="2b86d-128">After you have a public and private key, you can then begin distributing signed software.</span></span> <span data-ttu-id="2b86d-129">A Microsoft fornece ferramentas para fazer isso na SDK do Windows.</span><span class="sxs-lookup"><span data-stu-id="2b86d-129">Microsoft provides tools to do this in the Windows SDK.</span></span> <span data-ttu-id="2b86d-130">As ferramentas utilizam um hash unidirecional, produzem um resumo de comprimento fixo e geram uma assinatura criptografada com uma chave privada.</span><span class="sxs-lookup"><span data-stu-id="2b86d-130">The tools utilize a one-way hash, produce a fixed-length digest, and generate an encrypted signature with a private key.</span></span> <span data-ttu-id="2b86d-131">Em seguida, eles combinam essa assinatura criptografada com o certificado e as credenciais em uma estrutura conhecida como um bloco de assinatura e a inserimos no formato de arquivo do executável.</span><span class="sxs-lookup"><span data-stu-id="2b86d-131">They then combine that encrypted signature with your certificate and credentials into a structure known as a signature block and embed it into the file format of the executable.</span></span> <span data-ttu-id="2b86d-132">Qualquer tipo de arquivo binário executável pode ser assinado, incluindo DLLs, arquivos executáveis e arquivos de gabinete.</span><span class="sxs-lookup"><span data-stu-id="2b86d-132">Any type of executable binary file can be signed, including DLLs, executable files, and cabinet files.</span></span>

<span data-ttu-id="2b86d-133">A assinatura pode ser verificada de várias maneiras.</span><span class="sxs-lookup"><span data-stu-id="2b86d-133">The signature can be verified in multiple ways.</span></span> <span data-ttu-id="2b86d-134">Os programas podem chamar a função CertVerifyCertificateChainPolicy e SignTool (signtool.exe) podem ser usados para verificar uma assinatura do prompt de linha de comando.</span><span class="sxs-lookup"><span data-stu-id="2b86d-134">Programs can call the CertVerifyCertificateChainPolicy function, and SignTool (signtool.exe) can be used to verify a signature from the command-line prompt.</span></span> <span data-ttu-id="2b86d-135">O Windows Explorer também tem uma guia assinaturas digitais em Propriedades de arquivo que exibe cada certificado de um arquivo binário assinado.</span><span class="sxs-lookup"><span data-stu-id="2b86d-135">Windows Explorer also has a Digital Signatures tab in File Properties that displays each certificate of a signed binary file.</span></span> <span data-ttu-id="2b86d-136">(A guia assinaturas digitais só aparece em Propriedades de arquivo para arquivos assinados.) Além disso, um aplicativo pode ser autoverificado pelo uso de [**CertVerifyCertificateChainPolicy**](/windows/desktop/api/wincrypt/nf-wincrypt-certverifycertificatechainpolicy).</span><span class="sxs-lookup"><span data-stu-id="2b86d-136">(The Digital Signatures tab only appears in File Properties for signed files.) Also, an application can be self-verifying by use of [**CertVerifyCertificateChainPolicy**](/windows/desktop/api/wincrypt/nf-wincrypt-certverifycertificatechainpolicy).</span></span>

<span data-ttu-id="2b86d-137">A assinatura Authenticode não é útil apenas para a autenticação de dados pelos usuários finais, mas também é necessária para aplicar patches de contas de usuário limitadas e controles dos pais no Windows Vista e no Windows 7.</span><span class="sxs-lookup"><span data-stu-id="2b86d-137">Authenticode signing is not only useful for data authentication by end users, but is also needed for patching of Limited User Accounts and by parental controls in Windows Vista and Windows 7.</span></span> <span data-ttu-id="2b86d-138">Além disso, as tecnologias futuras em sistemas operacionais Windows também podem exigir que o código seja assinado, portanto, é altamente recomendável que todos os desenvolvedores profissionais e amadores adquiram um certificado de assinatura de código de uma CA.</span><span class="sxs-lookup"><span data-stu-id="2b86d-138">In addition, future technologies in Windows operating systems may also require that code is signed, so it is strongly advised that all professional and amateur developers acquire a code-signing certificate from a CA.</span></span> <span data-ttu-id="2b86d-139">Mais informações sobre como isso é feito podem ser encontradas posteriormente neste artigo em [usando uma autoridade de certificação confiável](#using-a-trusted-certificate-authority).</span><span class="sxs-lookup"><span data-stu-id="2b86d-139">More information on how this is done can be found later in this article in [Using a Trusted Certificate Authority](#using-a-trusted-certificate-authority).</span></span>

<span data-ttu-id="2b86d-140">O código de jogo, os patches e os instaladores podem aproveitar ainda mais a assinatura do Authenicode verificando se os arquivos são autênticos no código.</span><span class="sxs-lookup"><span data-stu-id="2b86d-140">Game code, patchers, and installers can further leverage Authenicode signing by verifying files are authentic in code.</span></span> <span data-ttu-id="2b86d-141">Isso pode ser usado para a segurança de rede geral e antienganar.</span><span class="sxs-lookup"><span data-stu-id="2b86d-141">This can be used for anti-cheat and general network security.</span></span> <span data-ttu-id="2b86d-142">Um exemplo de código para verificar se um arquivo está assinado pode ser encontrado aqui: [exemplo C programa: verificando a assinatura de um arquivo PE e um](/windows/desktop/SecCrypto/example-c-program--verifying-the-signature-of-a-pe-file)código de exemplo para verificar a propriedade de um certificado de assinatura em um arquivo assinado pode ser encontrado aqui: [como obter informações de executáveis com Authenticode assinados](https://support.microsoft.com/kb/323809).</span><span class="sxs-lookup"><span data-stu-id="2b86d-142">Example code for checking if a file is signed can be found here: [Example C Program: Verifying the Signature of a PE File](/windows/desktop/SecCrypto/example-c-program--verifying-the-signature-of-a-pe-file), and example code for checking ownership of a signing certificate on a signed file can be found here: [How To Get Information from Authenticode Signed Executables](https://support.microsoft.com/kb/323809).</span></span>

## <a name="getting-started"></a><span data-ttu-id="2b86d-143">Introdução</span><span class="sxs-lookup"><span data-stu-id="2b86d-143">Getting Started</span></span>

<span data-ttu-id="2b86d-144">Para começar, a Microsoft fornece ferramentas com o Visual Studio 2005 e o Visual Studio 2008, e na [SDK do Windows](https://msdn.microsoft.com/windowsserver/bb980924.aspx), para ajudar a executar e verificar o processo de assinatura de código.</span><span class="sxs-lookup"><span data-stu-id="2b86d-144">To get started, Microsoft provides tools with Visual Studio 2005 and Visual Studio 2008, and in the [Windows SDK](https://msdn.microsoft.com/windowsserver/bb980924.aspx), to help perform and verify the code-signing process.</span></span> <span data-ttu-id="2b86d-145">Depois de instalar o Visual Studio ou o SDK do Windows, as ferramentas descritas neste artigo técnico estão localizadas em um subdiretório da instalação, que pode incluir um ou mais dos seguintes:</span><span class="sxs-lookup"><span data-stu-id="2b86d-145">After installing Visual Studio or the Windows SDK, the tools described in this technical article are located in a subdirectory of the installation, which may include one or more of the following:</span></span>

-   <span data-ttu-id="2b86d-146">% SystemDrive% \\ arquivos de programas \\ Microsoft Visual Studio o \\ compartimento 8 SDK \\ v 2.0 \\</span><span class="sxs-lookup"><span data-stu-id="2b86d-146">%SystemDrive%\\Program Files\\Microsoft Visual Studio 8\\SDK\\v2.0\\Bin</span></span>
-   <span data-ttu-id="2b86d-147">% SystemDrive% \\ arquivos de programas \\ Microsoft Visual Studio \\ compartimento de 8 vc \\ PlatformSDK \\</span><span class="sxs-lookup"><span data-stu-id="2b86d-147">%SystemDrive%\\Program Files\\Microsoft Visual Studio 8\\VC\\PlatformSDK\\Bin</span></span>
-   <span data-ttu-id="2b86d-148">% SystemDrive% \\ arquivos de programas \\ Microsoft Visual Studio 9,0 \\ SmartDevices \\ SDK \\ SDKTools</span><span class="sxs-lookup"><span data-stu-id="2b86d-148">%SystemDrive%\\Program Files\\Microsoft Visual Studio 9.0\\SmartDevices\\SDK\\SDKTools</span></span>\\
-   <span data-ttu-id="2b86d-149">% SystemDrive% \\ arquivos de programas \\ Microsoft SDKs \\ Windows \\ v 6.0 a \\ bin</span><span class="sxs-lookup"><span data-stu-id="2b86d-149">%SystemDrive%\\Program Files\\Microsoft SDKs\\Windows\\v6.0A\\bin</span></span>\\

<span data-ttu-id="2b86d-150">As seguintes ferramentas são as mais úteis para o código de assinatura:</span><span class="sxs-lookup"><span data-stu-id="2b86d-150">The following tools are the most useful for signing code:</span></span>

<dl> <dt>

<span data-ttu-id="2b86d-151"><span id="Certificate_Creation_Tool__MakeCert.exe_"></span><span id="certificate_creation_tool__makecert.exe_"></span><span id="CERTIFICATE_CREATION_TOOL__MAKECERT.EXE_"></span>Ferramenta de criação de certificado (MakeCert.exe)</span><span class="sxs-lookup"><span data-stu-id="2b86d-151"><span id="Certificate_Creation_Tool__MakeCert.exe_"></span><span id="certificate_creation_tool__makecert.exe_"></span><span id="CERTIFICATE_CREATION_TOOL__MAKECERT.EXE_"></span>Certificate Creation Tool (MakeCert.exe)</span></span>
</dt> <dd>

<span data-ttu-id="2b86d-152">Gera um certificado X. 509 de teste, como um arquivo. cer, que contém sua chave pública e uma chave privada, como um arquivo. pvk.</span><span class="sxs-lookup"><span data-stu-id="2b86d-152">Generates a test X.509 certificate, as a .cer file, that contains your public key and a private key, as a .pvk file.</span></span> <span data-ttu-id="2b86d-153">Esse certificado é apenas para fins de teste interno e não pode ser usado publicamente.</span><span class="sxs-lookup"><span data-stu-id="2b86d-153">This certificate is only for internal testing purposes and can't be used publicly.</span></span>

</dd> <dt>

<span data-ttu-id="2b86d-154"><span id="pvk2pfx.exe"></span><span id="PVK2PFX.EXE"></span>pvk2pfx.exe</span><span class="sxs-lookup"><span data-stu-id="2b86d-154"><span id="pvk2pfx.exe"></span><span id="PVK2PFX.EXE"></span>pvk2pfx.exe</span></span>
</dt> <dd>

<span data-ttu-id="2b86d-155">Cria um arquivo de troca de informações pessoais (. pfx) a partir de um par de arquivos. cer e. pvk.</span><span class="sxs-lookup"><span data-stu-id="2b86d-155">Creates a Personal Information Exchange (.pfx) file from a pair of .cer and .pvk files.</span></span> <span data-ttu-id="2b86d-156">O arquivo. pfx contém sua chave pública e privada.</span><span class="sxs-lookup"><span data-stu-id="2b86d-156">The .pfx file contains both your public and private key.</span></span>

</dd> <dt>

<span data-ttu-id="2b86d-157"><span id="SignTool__SignTool.exe_"></span><span id="signtool__signtool.exe_"></span><span id="SIGNTOOL__SIGNTOOL.EXE_"></span>SignTool (SignTool.exe)</span><span class="sxs-lookup"><span data-stu-id="2b86d-157"><span id="SignTool__SignTool.exe_"></span><span id="signtool__signtool.exe_"></span><span id="SIGNTOOL__SIGNTOOL.EXE_"></span>SignTool (SignTool.exe)</span></span>
</dt> <dd>

<span data-ttu-id="2b86d-158">Assina o arquivo usando o arquivo. pfx.</span><span class="sxs-lookup"><span data-stu-id="2b86d-158">Signs file by using the .pfx file.</span></span> <span data-ttu-id="2b86d-159">O SignTool dá suporte à assinatura de arquivos DLL, arquivos executáveis, arquivos Windows Installer (. msi) e arquivos de gabinete (. cab).</span><span class="sxs-lookup"><span data-stu-id="2b86d-159">SignTool supports the signing of DLL files, executable files, Windows Installer (.msi) files, and cabinet (.cab) files.</span></span>

</dd> </dl>

> [!Note]  
> <span data-ttu-id="2b86d-160">Ao ler outras documentações, você pode encontrar referências ao SignCode (SignCode.exe), mas essa ferramenta foi preterida e não tem mais suporte. em vez disso, use SignTool.</span><span class="sxs-lookup"><span data-stu-id="2b86d-160">While reading other documentation, you might find references to SignCode (SignCode.exe), but this tool is deprecated and is no longer supported—use SignTool instead.</span></span>

 

## <a name="using-a-trusted-certificate-authority"></a><span data-ttu-id="2b86d-161">Usando uma autoridade de certificação confiável</span><span class="sxs-lookup"><span data-stu-id="2b86d-161">Using a Trusted Certificate Authority</span></span>

<span data-ttu-id="2b86d-162">Para obter um certificado confiável, você deve aplicar a uma AC (autoridade de certificação), como VeriSign ou Thawte.</span><span class="sxs-lookup"><span data-stu-id="2b86d-162">To obtain a trusted certificate, you must apply to a Certificate Authority (CA), such as VeriSign or Thawte.</span></span> <span data-ttu-id="2b86d-163">A Microsoft não recomenda nenhuma AC sobre outra, mas se você quiser integrar-se ao serviço Relatório de Erros do Windows (WER), considere usar a VeriSign para emitir o certificado, pois o acesso ao banco de dados WER requer uma conta WinQual que exija uma ID da VeriSign.</span><span class="sxs-lookup"><span data-stu-id="2b86d-163">Microsoft doesn't recommend any CA over another, but if you want to integrate into the Windows Error Reporting (WER) service, you should consider using VeriSign to issue the certificate, because accessing the WER database requires a WinQual account which requires a VeriSign ID.</span></span> <span data-ttu-id="2b86d-164">Para obter uma lista completa de autoridades de certificação de terceiros confiáveis, consulte [membros do programa de certificado raiz da Microsoft](/previous-versions/ms995347(v=msdn.10)).</span><span class="sxs-lookup"><span data-stu-id="2b86d-164">For a complete list of trusted third-party certificate authorities, see [Microsoft Root Certificate Program Members](/previous-versions/ms995347(v=msdn.10)).</span></span> <span data-ttu-id="2b86d-165">Para obter mais informações sobre como registrar com o WER, consulte "[introdução ao relatório de erros do Windows](https://msdn.microsoft.com/)" na [zona do ISV](https://msdn.microsoft.com/).</span><span class="sxs-lookup"><span data-stu-id="2b86d-165">For more information about registering with WER, see "[Introducing Windows Error Reporting](https://msdn.microsoft.com/)" in [ISV Zone](https://msdn.microsoft.com/).</span></span>

<span data-ttu-id="2b86d-166">Depois de receber o certificado da autoridade de certificação, você pode assinar seu programa usando SignTool e liberar seu programa para o público.</span><span class="sxs-lookup"><span data-stu-id="2b86d-166">After you receive your certificate from the CA, you can sign your program by using SignTool and release your program to the public.</span></span> <span data-ttu-id="2b86d-167">No entanto, você deve ter cuidado para proteger sua chave privada, que está contida em seus arquivos. pfx e. pvk.</span><span class="sxs-lookup"><span data-stu-id="2b86d-167">However, you must be careful to protect your private key, which is contained in your .pfx and .pvk files.</span></span> <span data-ttu-id="2b86d-168">Lembre-se de manter esses arquivos em um local seguro.</span><span class="sxs-lookup"><span data-stu-id="2b86d-168">Be sure to keep these files in a secure location.</span></span>

## <a name="example-using-a-test-certificate"></a><span data-ttu-id="2b86d-169">Exemplo usando um certificado de teste</span><span class="sxs-lookup"><span data-stu-id="2b86d-169">Example Using a Test Certificate</span></span>

<span data-ttu-id="2b86d-170">As etapas a seguir demonstram a criação de um certificado de assinatura de código para fins de teste, seguidos pela assinatura de um programa de exemplo de Direct3D (chamado BasicHLSL.exe) com esse certificado de teste.</span><span class="sxs-lookup"><span data-stu-id="2b86d-170">The following steps demonstrate the creation of a code-signing certificate for testing purposes, followed by the signing of a Direct3D sample program (called BasicHLSL.exe) with this test certificate.</span></span> <span data-ttu-id="2b86d-171">Este procedimento cria arquivos. cer e. pvk — suas chaves pública e privada, respectivamente, que não podem ser usadas para certificação pública.</span><span class="sxs-lookup"><span data-stu-id="2b86d-171">This procedure creates .cer and .pvk files—your public and private keys, respectively — which cannot be used for public certification.</span></span>

<span data-ttu-id="2b86d-172">Neste exemplo, um carimbo de data/hora também é adicionado à assinatura.</span><span class="sxs-lookup"><span data-stu-id="2b86d-172">In this example, a time stamp is also added to the signature.</span></span> <span data-ttu-id="2b86d-173">Um carimbo de data/hora impede que a assinatura se torne inválida quando o certificado expira.</span><span class="sxs-lookup"><span data-stu-id="2b86d-173">A time stamp prevents the signature from becoming invalid when the certificate expires.</span></span> <span data-ttu-id="2b86d-174">O código assinado, mas falta um carimbo de data/hora, não será validado depois que o certificado expirar.</span><span class="sxs-lookup"><span data-stu-id="2b86d-174">Code that is signed but lacking a time stamp will not validate after the certificate expires.</span></span> <span data-ttu-id="2b86d-175">Portanto, todo o código lançado publicamente deve ter um carimbo de data/hora.</span><span class="sxs-lookup"><span data-stu-id="2b86d-175">Therefore, all publicly released code should have a time stamp.</span></span>

<span data-ttu-id="2b86d-176">**Para criar um certificado e assinar um programa**</span><span class="sxs-lookup"><span data-stu-id="2b86d-176">**To create a certificate and sign a program**</span></span>

1.  <span data-ttu-id="2b86d-177">Crie um certificado de teste e uma chave privada usando a ferramenta de criação de certificado (MakeCert.exe).</span><span class="sxs-lookup"><span data-stu-id="2b86d-177">Create a test certificate and private key by using the Certificate Creation Tool (MakeCert.exe).</span></span>

    <span data-ttu-id="2b86d-178">O exemplo de linha de comando a seguir especifica MyPrivateKey como o nome de arquivo para o arquivo de chave privada (. pvk), mypublickey como o nome de arquivo para o arquivo de certificado (. cer) e MySoftwareCompany como o nome do certificado.</span><span class="sxs-lookup"><span data-stu-id="2b86d-178">The following command-line example specifies MyPrivateKey as the file name for the private key (.pvk) file, MyPublicKey as the file name for the certificate (.cer) file, and MySoftwareCompany as the name of the certificate.</span></span> <span data-ttu-id="2b86d-179">Ele também torna o certificado autoassinado, para que ele não tenha uma autoridade raiz não confiável.</span><span class="sxs-lookup"><span data-stu-id="2b86d-179">It also makes the certificate self-signed, so that it does not have an untrusted root authority.</span></span>

    ```
    MakeCert /n CN=MySoftwareCompany /r /h 0 /eku "1.3.6.1.5.5.7.3.3,1.3.6.1.4.1.311.10.3.13" /e 12-31-2020 /sv MyPrivateKey.pvk MyPublicKey.cer
    ```

    

2.  <span data-ttu-id="2b86d-180">Crie um arquivo de troca de informações pessoais (. pfx) do arquivo de chave privada (. pvk) e do arquivo de certificado (. cer) usando pvk2pfx.exe.</span><span class="sxs-lookup"><span data-stu-id="2b86d-180">Create a Personal Information Exchange (.pfx) file from your private key (.pvk) file and certificate (.cer) file by using pvk2pfx.exe.</span></span>

    <span data-ttu-id="2b86d-181">O arquivo. pfx combina suas chaves pública e privada em um único arquivo.</span><span class="sxs-lookup"><span data-stu-id="2b86d-181">The .pfx file combines your public and private keys into a single file.</span></span> <span data-ttu-id="2b86d-182">O exemplo de linha de comando a seguir usa os arquivos. pvk e. cer da etapa anterior para criar o arquivo. pfx chamado MyPFX com a senha sua \_ senha:</span><span class="sxs-lookup"><span data-stu-id="2b86d-182">The following command-line example uses the .pvk and .cer files from the previous step to create the .pfx file named MyPFX with the password your\_password:</span></span>

    ```
    pvk2pfx.exe -pvk MyPrivateKey.pvk -spc MyPublicKey.cer -pfx MyPFX.pfx -po your_password
    ```

    

3.  <span data-ttu-id="2b86d-183">Assine seu programa com seu arquivo de troca de informações pessoais (. pfx) usando SignTool.</span><span class="sxs-lookup"><span data-stu-id="2b86d-183">Sign your program with your Personal Information Exchange (.pfx) file by using SignTool.</span></span>

    <span data-ttu-id="2b86d-184">Você pode especificar várias opções na linha de comando.</span><span class="sxs-lookup"><span data-stu-id="2b86d-184">You can specify several options on the command line.</span></span> <span data-ttu-id="2b86d-185">O exemplo de linha de comando a seguir usa o arquivo. pfx da etapa anterior, fornece sua \_ senha como a senha, especifica BasicHLSL como o arquivo a ser assinado e recupera um carimbo de data/hora de um servidor especificado:</span><span class="sxs-lookup"><span data-stu-id="2b86d-185">The following command-line example uses the .pfx file from the previous step, gives your\_password as the password, specifies BasicHLSL as the file to be signed, and retrieves a time stamp from a specified server:</span></span>

    ```
    signtool.exe sign /fd SHA256 /f MyPFX.pfx /p your_password /v /t URL_to_time_stamp_service BasicHLSL.exe
    ```

    

    > [!Note]  
    > <span data-ttu-id="2b86d-186">A URL para o serviço de carimbo de data/hora é fornecida pela autoridade de certificação e é opcional para teste.</span><span class="sxs-lookup"><span data-stu-id="2b86d-186">The URL to the time stamp service is provided by the CA, and is optional for testing.</span></span> <span data-ttu-id="2b86d-187">É importante que a assinatura de produção inclua uma autoridade de carimbo de data/hora válida, ou a assinatura não será validada quando o certificado expirar.</span><span class="sxs-lookup"><span data-stu-id="2b86d-187">It is important for production signing to include a valid time stamp authority, or the signature will fail to validate when the certificate expires.</span></span>

     

4.  <span data-ttu-id="2b86d-188">Verifique se o programa está assinado usando SignTool.</span><span class="sxs-lookup"><span data-stu-id="2b86d-188">Verify that the program is signed by using SignTool.</span></span>

    <span data-ttu-id="2b86d-189">O exemplo de linha de comando a seguir especifica que o SignTool deve tentar verificar a assinatura em BasicHLSL.exe usando todos os métodos disponíveis enquanto fornece a saída detalhada:</span><span class="sxs-lookup"><span data-stu-id="2b86d-189">The following command-line example specifies that SignTool should attempt to verify the signature on BasicHLSL.exe by using all available methods while providing verbose output:</span></span>

    ```
    signtool.exe verify /a /v BasicHLSL.exe
    ```

    

    <span data-ttu-id="2b86d-190">Neste exemplo, SignTool deve indicar que o certificado está anexado, enquanto também está informando que não é confiável, pois não é emitido por uma autoridade de certificação.</span><span class="sxs-lookup"><span data-stu-id="2b86d-190">In this example, SignTool should indicate that the certificate is attached, while also stating that it is not trusted, since it is not issued by a CA.</span></span>

5.  <span data-ttu-id="2b86d-191">Confie no certificado de teste.</span><span class="sxs-lookup"><span data-stu-id="2b86d-191">Trust the test certificate.</span></span>

    <span data-ttu-id="2b86d-192">Para certificados de teste, você precisa confiar no certificado.</span><span class="sxs-lookup"><span data-stu-id="2b86d-192">For test certificates you need to trust the certificate.</span></span> <span data-ttu-id="2b86d-193">Essa etapa deve ser ignorada para certificados fornecidos por uma CA, uma vez que eles serão confiáveis por padrão.</span><span class="sxs-lookup"><span data-stu-id="2b86d-193">This step should be skipped for certificates provided by a CA since those will trusted by default.</span></span>

    <span data-ttu-id="2b86d-194">Somente nos computadores em que você deseja confiar no certificado de teste, execute o seguinte:</span><span class="sxs-lookup"><span data-stu-id="2b86d-194">On only the computers where you want to trust the test certificate, run the following:</span></span>

    ```
    certmgr.msc
    ```

    

    <span data-ttu-id="2b86d-195">Em seguida, clique com o botão direito do mouse em autoridades de certificação raiz confiáveis e escolha todas as tarefas \| importar.</span><span class="sxs-lookup"><span data-stu-id="2b86d-195">Then right click on Trusted Root Certification Authorities and choose All Tasks \| Import.</span></span> <span data-ttu-id="2b86d-196">Em seguida, navegue até o arquivo. pfx que você criou e siga as etapas do assistente, colocando o certificado nas autoridades de certificação raiz confiáveis.</span><span class="sxs-lookup"><span data-stu-id="2b86d-196">Then browse to the .pfx file you created and follow the wizard steps, placing the certificate in the Trusted Root Certification Authorities.</span></span>

    <span data-ttu-id="2b86d-197">Quando o assistente for concluído, você poderá iniciar o teste com o certificado confiável nesse computador.</span><span class="sxs-lookup"><span data-stu-id="2b86d-197">When the wizard completes, you can start testing with the trusted certificate on that computer.</span></span>

## <a name="integrating-code-signing-into-the-daily-build-system"></a><span data-ttu-id="2b86d-198">Integrando a assinatura de código no sistema de compilação diário</span><span class="sxs-lookup"><span data-stu-id="2b86d-198">Integrating Code Signing into the Daily Build System</span></span>

<span data-ttu-id="2b86d-199">Para integrar o código de assinatura a um projeto do, você pode criar um arquivo em lotes ou script para executar as ferramentas de linha de comando.</span><span class="sxs-lookup"><span data-stu-id="2b86d-199">To integrate code signing into a project, you can create a batch file or script to run the command line tools.</span></span> <span data-ttu-id="2b86d-200">Depois que o projeto for criado, execute SignTool com as configurações apropriadas (conforme mostrado na etapa 3 do nosso exemplo).</span><span class="sxs-lookup"><span data-stu-id="2b86d-200">After the project is built, run SignTool with the proper settings (as shown in step 3 of our example).</span></span>

<span data-ttu-id="2b86d-201">Seja especialmente cauteloso em seu processo de compilação para garantir que o acesso aos arquivos. pfx e. pvk seja restrito ao mínimo de computadores e usuários possível.</span><span class="sxs-lookup"><span data-stu-id="2b86d-201">Be especially cautious in your build process to insure that access to the .pfx and .pvk files is restricted to as few computers and users as possible.</span></span> <span data-ttu-id="2b86d-202">Como prática recomendada, os desenvolvedores só devem assinar o código usando o certificado de teste até que estejam prontos para serem entregues.</span><span class="sxs-lookup"><span data-stu-id="2b86d-202">As a best practice, developers should only sign code by using the test certificate until they are ready to ship.</span></span> <span data-ttu-id="2b86d-203">Novamente, a chave privada (. pvk) deve ser mantida em um local seguro, como um espaço seguro ou bloqueado, e idealmente em um dispositivo criptográfico, como um cartão inteligente.</span><span class="sxs-lookup"><span data-stu-id="2b86d-203">Again, the private key (.pvk) should be kept in a secured location, like a safe or locked room, and ideally on a cryptographic device, like a smart card.</span></span>

<span data-ttu-id="2b86d-204">Outra camada de proteção é fornecida usando o Microsoft Authenticode para assinar o pacote de Windows Installer (MSI) em si.</span><span class="sxs-lookup"><span data-stu-id="2b86d-204">Another layer of protection is provided by using Microsoft Authenticode to sign the Windows Installer (MSI) package itself.</span></span> <span data-ttu-id="2b86d-205">Isso ajuda a proteger o pacote MSI contra violações e danos acidentais.</span><span class="sxs-lookup"><span data-stu-id="2b86d-205">This helps protect the MSI package against tampering and accidental corruption.</span></span> <span data-ttu-id="2b86d-206">Consulte a documentação da ferramenta de criação do MSI para obter mais informações sobre como assinar pacotes com Authenticode.</span><span class="sxs-lookup"><span data-stu-id="2b86d-206">Refer to the documentation for your MSI creation tool for more information about how to sign packages with Authenticode.</span></span>

## <a name="revocation"></a><span data-ttu-id="2b86d-207">Revogação</span><span class="sxs-lookup"><span data-stu-id="2b86d-207">Revocation</span></span>

<span data-ttu-id="2b86d-208">Caso a segurança da chave privada seja comprometida ou algum evento relacionado à segurança renderize um Code-Signing certificado inválido, o desenvolvedor deve revogar o certificado.</span><span class="sxs-lookup"><span data-stu-id="2b86d-208">In the event that the security of the private key is compromised or some security-related event renders a Code-Signing certificate invalid, the developer must revoke the certificate.</span></span> <span data-ttu-id="2b86d-209">Não fazer isso enfraqueceria a integridade do desenvolvedor e a eficácia do código de assinatura.</span><span class="sxs-lookup"><span data-stu-id="2b86d-209">Not doing so would weaken the integrity of the developer and the effectiveness of signing code.</span></span> <span data-ttu-id="2b86d-210">Uma CA também pode emitir uma revogação com um horário específico; o código assinado com um carimbo de data/hora antes do tempo de revogação ainda será considerado válido, mas o código com um carimbo de data/hora subsequente será inválido.</span><span class="sxs-lookup"><span data-stu-id="2b86d-210">A CA can also issue a revocation with specific time; code signed with a time stamp prior to the revocation time will still be considered valid, but code with a subsequent time stamp will be invalid.</span></span> <span data-ttu-id="2b86d-211">A revogação de certificado afeta o código em todos os aplicativos assinados com o certificado revogado.</span><span class="sxs-lookup"><span data-stu-id="2b86d-211">Certificate revocation affects code in any applications that is signed with the revoked certificate.</span></span>

## <a name="code-signing-drivers"></a><span data-ttu-id="2b86d-212">Drivers de Code-Signing</span><span class="sxs-lookup"><span data-stu-id="2b86d-212">Code-Signing Drivers</span></span>

<span data-ttu-id="2b86d-213">Os drivers podem e devem ser assinados por Authenticode.</span><span class="sxs-lookup"><span data-stu-id="2b86d-213">Drivers can and should be Authenticode-signed.</span></span> <span data-ttu-id="2b86d-214">Os drivers do modo kernel têm requisitos adicionais: as edições de 64 bits do Windows Vista e do Windows 7 impedirão a instalação de todos os drivers do modo kernel não assinados, e todas as versões do Windows apresentarão um prompt de aviso quando um usuário tentar instalar um driver não assinado.</span><span class="sxs-lookup"><span data-stu-id="2b86d-214">Kernel-mode drivers have additional requirements: 64-bit editions of Windows Vista and Windows 7 will prevent installation of all unsigned kernel-mode drivers, and all versions of Windows will present a warning prompt when a user attempts to install an unsigned driver.</span></span> <span data-ttu-id="2b86d-215">Além disso, os administradores podem definir Política de Grupo para impedir que drivers não assinados sejam instalados no Microsoft Windows Server 2003, no Windows XP Professional x64 Edition e nas edições de 32 bits do Windows Vista e do Windows 7.</span><span class="sxs-lookup"><span data-stu-id="2b86d-215">In addition, administrators can set Group Policy to prevent unsigned drivers from being installed on Microsoft Windows Server 2003, Windows XP Professional x64 Edition, and 32-bit editions of Windows Vista and Windows 7.</span></span>

<span data-ttu-id="2b86d-216">Muitos tipos de drivers podem ser assinados com uma assinatura confiável da Microsoft — como parte do programa de certificação do Windows do WHQL ( [Windows Hardware Quality Labs](https://www.microsoft.com/whdc/whql/) ) ou do [programa de assinatura não classificada](https://www.microsoft.com/whdc/winlogo/drvsign/dqs.mspx) (anteriormente denominado assinatura de confiabilidade do driver) — que permite que o sistema confie totalmente nesses drivers e instale-os mesmo sem credenciais administrativas.</span><span class="sxs-lookup"><span data-stu-id="2b86d-216">Many types of drivers can be signed with a Microsoft-trusted signature — as part of the Windows Certification Program of [Windows Hardware Quality Labs](https://www.microsoft.com/whdc/whql/) (WHQL) or the [Unclassified Signature Program](https://www.microsoft.com/whdc/winlogo/drvsign/dqs.mspx) (formerly named Driver Reliability Signature) — which allows the system to fully trust these drivers and install them even without administrative credentials.</span></span>

<span data-ttu-id="2b86d-217">No mínimo, os drivers devem ser assinados por Authenticode, pois os drivers que não são assinados ou auto-assinados (ou seja, assinados com um certificado de teste) não serão instalados em muitas plataformas baseadas no Windows.</span><span class="sxs-lookup"><span data-stu-id="2b86d-217">At a minimum, drivers should be Authenticode-signed, because drivers that are unsigned or self-signed (that is, signed with a test certificate) will fail to install on many Windows-based platforms.</span></span> <span data-ttu-id="2b86d-218">Para obter mais informações sobre drivers de assinatura e código e recursos relacionados, consulte [requisitos de assinatura de driver para Windows](https://www.microsoft.com/whdc/winlogo/drvsign/drvsign.mspx) no [Windows hardware Developer Central](https://www.microsoft.com/whdc/).</span><span class="sxs-lookup"><span data-stu-id="2b86d-218">For more information about signing drivers and code and related feature, see [Driver Signing Requirements for Windows](https://www.microsoft.com/whdc/winlogo/drvsign/drvsign.mspx) on [Windows Hardware Developer Central](https://www.microsoft.com/whdc/).</span></span>

## <a name="summary"></a><span data-ttu-id="2b86d-219">Resumo</span><span class="sxs-lookup"><span data-stu-id="2b86d-219">Summary</span></span>

<span data-ttu-id="2b86d-220">Usar o Microsoft Authenticode é um processo simples.</span><span class="sxs-lookup"><span data-stu-id="2b86d-220">Using Microsoft Authenticode is a straightforward process.</span></span> <span data-ttu-id="2b86d-221">Depois de obter uma CER e criar uma chave privada, é uma simples questão de usar as ferramentas fornecidas pela Microsoft.</span><span class="sxs-lookup"><span data-stu-id="2b86d-221">Once you have obtained a CER and created a private key, it is a simple matter of using the tools provided by Microsoft.</span></span> <span data-ttu-id="2b86d-222">Você pode habilitar recursos importantes no Windows Vista e no Windows 7, como controles dos pais, e informar aos clientes que seu produto vem diretamente do seu proprietário.</span><span class="sxs-lookup"><span data-stu-id="2b86d-222">You can then enable important features in Windows Vista and Windows 7, such as parental controls, and let customers know that your product comes directly from its rightful owner.</span></span>

## <a name="more-information"></a><span data-ttu-id="2b86d-223">Mais informações</span><span class="sxs-lookup"><span data-stu-id="2b86d-223">More information</span></span>

<span data-ttu-id="2b86d-224">Para obter mais informações sobre ferramentas e processos relacionados ao código de assinatura, consulte os links a seguir:</span><span class="sxs-lookup"><span data-stu-id="2b86d-224">More information about tools and processes related to signing code, see the following links:</span></span>

-   [<span data-ttu-id="2b86d-225">Ferramentas de criptografia</span><span class="sxs-lookup"><span data-stu-id="2b86d-225">Cryptography Tools</span></span>](/windows/desktop/SecCrypto/cryptography-tools)
-   [<span data-ttu-id="2b86d-226">Referência de ferramentas de API de criptografia</span><span class="sxs-lookup"><span data-stu-id="2b86d-226">Crypto API Tools Reference</span></span>](/windows/desktop/SecCrypto/cryptoapi-tools-reference)
-   <span data-ttu-id="2b86d-227">[Visão geral e turtorials Authenticode](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms537360(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="2b86d-227">[Authenticode Overview and Turtorials](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms537360(v=vs.85))</span></span>
-   [<span data-ttu-id="2b86d-228">Certificados digitais</span><span class="sxs-lookup"><span data-stu-id="2b86d-228">Digital Certificates</span></span>](/windows/desktop/SecCrypto/digital-certificates)
-   [<span data-ttu-id="2b86d-229">Implantando Authenticode</span><span class="sxs-lookup"><span data-stu-id="2b86d-229">Deploying Authenticode</span></span>](https://www.microsoft.com/technet/security/topics/cryptographyetc/authenticodets.mspx)
-   [<span data-ttu-id="2b86d-230">Como criar certificados temporários para uso durante o desenvolvimento</span><span class="sxs-lookup"><span data-stu-id="2b86d-230">How To: Create Temporary Certificates for Use During Development</span></span>](/dotnet/framework/wcf/feature-details/how-to-create-temporary-certificates-for-use-during-development)

 

 