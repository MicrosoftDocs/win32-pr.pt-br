---
description: O objeto de dados é central para todas as transferências de dados do Shell.
ms.assetid: c63d339e-ac62-4da1-b5ce-22d45a6a3413
title: Objeto de dados do Shell
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 812e5c18f5a2120fbf22682c6e768dc005128630
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104164309"
---
# <a name="shell-data-object"></a><span data-ttu-id="c48b9-103">Objeto de dados do Shell</span><span class="sxs-lookup"><span data-stu-id="c48b9-103">Shell Data Object</span></span>

<span data-ttu-id="c48b9-104">O objeto de dados é central para todas as transferências de dados do Shell.</span><span class="sxs-lookup"><span data-stu-id="c48b9-104">The data object is central to all Shell data transfers.</span></span> <span data-ttu-id="c48b9-105">É basicamente um contêiner para manter os dados transferidos.</span><span class="sxs-lookup"><span data-stu-id="c48b9-105">It is primarily a container to hold the transferred data.</span></span> <span data-ttu-id="c48b9-106">No entanto, o destino também pode se comunicar com o objeto de dados para facilitar alguns tipos especializados de transferência de dados do Shell, como movimentações otimizadas.</span><span class="sxs-lookup"><span data-stu-id="c48b9-106">However, the target can also communicate with the data object to facilitate some specialized types of Shell data transfer such as optimized moves.</span></span> <span data-ttu-id="c48b9-107">Este tópico fornece uma discussão geral sobre como os objetos de dados do Shell funcionam, como eles são construídos por uma fonte e como eles são tratados por um destino.</span><span class="sxs-lookup"><span data-stu-id="c48b9-107">This topic provides a general discussion of how Shell data objects work, how they are constructed by a source, and how they are handled by a target.</span></span> <span data-ttu-id="c48b9-108">Para obter uma discussão detalhada sobre como usar objetos de dados para transferir diferentes tipos de dados do Shell, consulte [manipulando cenários de transferência de dados do Shell](datascenarios.md).</span><span class="sxs-lookup"><span data-stu-id="c48b9-108">For a detailed discussion of how to use data objects to transfer different types of Shell data, see [Handling Shell Data Transfer Scenarios](datascenarios.md).</span></span>

-   [<span data-ttu-id="c48b9-109">Como os objetos de dados funcionam</span><span class="sxs-lookup"><span data-stu-id="c48b9-109">How Data Objects Work</span></span>](#how-data-objects-work)
    -   [<span data-ttu-id="c48b9-110">Formatos da área de transferência</span><span class="sxs-lookup"><span data-stu-id="c48b9-110">Clipboard Formats</span></span>](#clipboard-formats)
    -   [<span data-ttu-id="c48b9-111">Estrutura FORMATETC</span><span class="sxs-lookup"><span data-stu-id="c48b9-111">FORMATETC Structure</span></span>](#formatetc-structure)
    -   [<span data-ttu-id="c48b9-112">Estrutura STGMEDIUM</span><span class="sxs-lookup"><span data-stu-id="c48b9-112">STGMEDIUM structure</span></span>](#stgmedium-structure)
-   [<span data-ttu-id="c48b9-113">Como uma fonte cria um objeto de dados</span><span class="sxs-lookup"><span data-stu-id="c48b9-113">How a Source Creates a Data Object</span></span>](#how-a-source-creates-a-data-object)
    -   [<span data-ttu-id="c48b9-114">Como adicionar um objeto de memória global a um objeto de dados</span><span class="sxs-lookup"><span data-stu-id="c48b9-114">How to Add a Global Memory Object to a Data Object</span></span>](#how-to-add-a-global-memory-object-to-a-data-object)
    -   [<span data-ttu-id="c48b9-115">Implementando IDataObject</span><span class="sxs-lookup"><span data-stu-id="c48b9-115">Implementing IDataObject</span></span>](#implementing-idataobject)
    -   [<span data-ttu-id="c48b9-116">Implementando IDropSource</span><span class="sxs-lookup"><span data-stu-id="c48b9-116">Implementing IDropSource</span></span>](#implementing-idropsource)
-   [<span data-ttu-id="c48b9-117">Como um destino manipula um objeto de dados</span><span class="sxs-lookup"><span data-stu-id="c48b9-117">How a Target Handles a Data Object</span></span>](#how-a-target-handles-a-data-object)
    -   [<span data-ttu-id="c48b9-118">Extraindo dados do Shell de um objeto de dados</span><span class="sxs-lookup"><span data-stu-id="c48b9-118">Extracting Shell Data from a Data Object</span></span>](#extracting-shell-data-from-a-data-object)
    -   [<span data-ttu-id="c48b9-119">Implementando IDropTarget</span><span class="sxs-lookup"><span data-stu-id="c48b9-119">Implementing IDropTarget</span></span>](#implementing-idroptarget)
-   [<span data-ttu-id="c48b9-120">Usando o objeto auxiliar do tipo "arrastar e soltar"</span><span class="sxs-lookup"><span data-stu-id="c48b9-120">Using the Drag-and-Drop Helper Object</span></span>](#using-the-drag-and-drop-helper-object)
    -   [<span data-ttu-id="c48b9-121">Usando a interface IDragSourceHelper</span><span class="sxs-lookup"><span data-stu-id="c48b9-121">Using the IDragSourceHelper Interface</span></span>](#using-the-idragsourcehelper-interface)
    -   [<span data-ttu-id="c48b9-122">Usando a interface IDropTargetHelper</span><span class="sxs-lookup"><span data-stu-id="c48b9-122">Using the IDropTargetHelper Interface</span></span>](#using-the-idroptargethelper-interface)

## <a name="how-data-objects-work"></a><span data-ttu-id="c48b9-123">Como os objetos de dados funcionam</span><span class="sxs-lookup"><span data-stu-id="c48b9-123">How Data Objects Work</span></span>

<span data-ttu-id="c48b9-124">Os objetos de dados são objetos Component Object Model (COM), criados pela fonte de dados para transferir dados para um destino.</span><span class="sxs-lookup"><span data-stu-id="c48b9-124">Data objects are Component Object Model (COM) objects, created by the data source to transfer data to a target.</span></span> <span data-ttu-id="c48b9-125">Normalmente, eles carregam mais de um item de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-125">They typically carry more than one item of data.</span></span> <span data-ttu-id="c48b9-126">Há dois motivos para essa prática:</span><span class="sxs-lookup"><span data-stu-id="c48b9-126">There are two reasons for this practice:</span></span>

-   <span data-ttu-id="c48b9-127">Embora quase todos os tipos de dados possam ser transferidos com um objeto de dados, a origem normalmente não sabe que tipo de dados o destino pode aceitar.</span><span class="sxs-lookup"><span data-stu-id="c48b9-127">While almost any type of data can be transferred with a data object, the source typically does not know what kind of data the target can accept.</span></span> <span data-ttu-id="c48b9-128">Por exemplo, os dados podem ser uma parte de um documento de texto formatado.</span><span class="sxs-lookup"><span data-stu-id="c48b9-128">For instance, the data might be a portion of a formatted text document.</span></span> <span data-ttu-id="c48b9-129">Embora o destino possa lidar com informações de formatação complexas, ele também poderá aceitar apenas texto ANSI.</span><span class="sxs-lookup"><span data-stu-id="c48b9-129">While the target might be able to handle complex formatting information, it might also be able to accept only ANSI text.</span></span> <span data-ttu-id="c48b9-130">Por esse motivo, os objetos de dados geralmente incluem os mesmos dados em vários formatos diferentes.</span><span class="sxs-lookup"><span data-stu-id="c48b9-130">For this reason, data objects often include the same data in several different formats.</span></span> <span data-ttu-id="c48b9-131">O destino pode então extrair os dados em um formato que ele possa manipular.</span><span class="sxs-lookup"><span data-stu-id="c48b9-131">The target can then extract the data in a format that it can handle.</span></span>
-   <span data-ttu-id="c48b9-132">Os objetos de dados também podem conter itens de dados auxiliares que não são versões de dados de origem.</span><span class="sxs-lookup"><span data-stu-id="c48b9-132">Data objects can also contain auxiliary data items that are not versions of source data.</span></span> <span data-ttu-id="c48b9-133">Esse tipo de item de dados geralmente fornece informações adicionais sobre a operação de transferência de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-133">This type of data item typically provides additional information about the data transfer operation.</span></span> <span data-ttu-id="c48b9-134">Por exemplo, o Shell usa itens de dados auxiliares para indicar se um arquivo deve ser copiado ou movido.</span><span class="sxs-lookup"><span data-stu-id="c48b9-134">For instance, the Shell uses auxiliary data items to indicate whether a file is to be copied or moved.</span></span>

### <a name="clipboard-formats"></a><span data-ttu-id="c48b9-135">Formatos da área de transferência</span><span class="sxs-lookup"><span data-stu-id="c48b9-135">Clipboard Formats</span></span>

<span data-ttu-id="c48b9-136">Cada item de dados em um objeto de dados tem um formato associado, geralmente chamado de *formato de área de transferência*.</span><span class="sxs-lookup"><span data-stu-id="c48b9-136">Each item of data in a data object has an associated format, usually called a *clipboard format*.</span></span> <span data-ttu-id="c48b9-137">Há vários formatos de área de transferência padrão, declarados em winuser. h, que correspondem aos tipos de dados usados com frequência.</span><span class="sxs-lookup"><span data-stu-id="c48b9-137">There are a number of standard clipboard formats, declared in Winuser.h, that correspond to commonly used types of data.</span></span> <span data-ttu-id="c48b9-138">Os formatos da área de transferência são inteiros, mas eles são normalmente referenciados por seu nome equivalente, que tem o formato CF \_ *xxx*.</span><span class="sxs-lookup"><span data-stu-id="c48b9-138">Clipboard formats are integers, but they are normally referred to by their equivalent name, which has the form CF\_*XXX*.</span></span> <span data-ttu-id="c48b9-139">Por exemplo, o formato da área de transferência para texto ANSI é o texto de CF \_ .</span><span class="sxs-lookup"><span data-stu-id="c48b9-139">For instance, the clipboard format for ANSI text is CF\_TEXT.</span></span>

<span data-ttu-id="c48b9-140">Os aplicativos podem estender o intervalo de formatos de área de transferência disponíveis definindo formatos privados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-140">Applications can extend the range of available clipboard formats by defining private formats.</span></span> <span data-ttu-id="c48b9-141">Para definir um formato particular, um aplicativo chama [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) com uma cadeia de caracteres que identifica o formato.</span><span class="sxs-lookup"><span data-stu-id="c48b9-141">To define a private format, an application calls [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) with a string that identifies the format.</span></span> <span data-ttu-id="c48b9-142">O inteiro sem sinal que a função retorna é um valor de formato válido que pode ser usado exatamente como um formato de área de transferência padrão.</span><span class="sxs-lookup"><span data-stu-id="c48b9-142">The unsigned integer that the function returns is a valid format value that can be used just like a standard clipboard format.</span></span> <span data-ttu-id="c48b9-143">No entanto, a origem e o destino devem registrar o formato para usá-lo.</span><span class="sxs-lookup"><span data-stu-id="c48b9-143">However, both source and target must register the format in order to use it.</span></span> <span data-ttu-id="c48b9-144">Com uma exceção —[CF \_ HDROP](clipboard.md)— os formatos de área de transferência usados para transferir dados do shell são definidos como formatos privados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-144">With one exception—[CF\_HDROP](clipboard.md)—the clipboard formats used to transfer Shell data are defined as private formats.</span></span> <span data-ttu-id="c48b9-145">Eles devem ser registrados pela origem e pelo destino antes que possam ser usados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-145">They must be registered by the source and target before they can be used.</span></span> <span data-ttu-id="c48b9-146">Para obter uma descrição dos formatos de área de transferência do Shell disponíveis, consulte formatos da área de transferência do Shell.</span><span class="sxs-lookup"><span data-stu-id="c48b9-146">For a description of the available Shell clipboard formats, see Shell Clipboard Formats.</span></span>

<span data-ttu-id="c48b9-147">Embora existam algumas exceções, os objetos de dados normalmente contêm apenas um item de dados para cada formato de área de transferência com suporte.</span><span class="sxs-lookup"><span data-stu-id="c48b9-147">Although there are some exceptions, data objects normally contain only one item of data for each clipboard format they support.</span></span> <span data-ttu-id="c48b9-148">Essa correlação de um para um entre o formato e os dados permite que o valor de formato seja usado como um identificador para o item de dados associado.</span><span class="sxs-lookup"><span data-stu-id="c48b9-148">This one-to-one correlation between format and data allows the format value to be used as an identifier for the associated data item.</span></span> <span data-ttu-id="c48b9-149">Na verdade, ao discutir o conteúdo de um objeto de dados, um item de dados específico é normalmente chamado de "formato" e é referenciado por seu nome de formato.</span><span class="sxs-lookup"><span data-stu-id="c48b9-149">In fact, when discussing the contents of a data object, a particular item of data is typically called a "format" and is referred to by its format name.</span></span> <span data-ttu-id="c48b9-150">Por exemplo, frases como "extrair o formato de \_ texto do CF..." normalmente são usados ao discutir o item de dados de texto ANSI de um objeto de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-150">For example, phrases such as "Extract the CF\_TEXT format..." are typically used when discussing a data object's ANSI text data item.</span></span>

<span data-ttu-id="c48b9-151">Quando o destino de soltura recebe o ponteiro para o objeto de dados, o destino de soltura enumera os formatos disponíveis para determinar quais tipos de dados estão disponíveis.</span><span class="sxs-lookup"><span data-stu-id="c48b9-151">When the drop target receives the pointer to the data object, the drop target enumerates the available formats to determine what types of data are available.</span></span> <span data-ttu-id="c48b9-152">Em seguida, ele solicita um ou mais dos formatos disponíveis e extrai os dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-152">It then requests one or more of the available formats and extracts the data.</span></span> <span data-ttu-id="c48b9-153">A maneira específica de o destino extrair dados do Shell de um objeto de dados varia de acordo com o formato; Isso é discutido em detalhes em [como um destino trata um objeto de dados](#how-a-target-handles-a-data-object).</span><span class="sxs-lookup"><span data-stu-id="c48b9-153">The specific way that the target extracts Shell data from a data object varies with the format; this is discussed in detail in [How a Target Handles a Data Object](#how-a-target-handles-a-data-object).</span></span>

<span data-ttu-id="c48b9-154">Com transferências de dados de área de transferência simples, os dados são colocados em um objeto de memória global.</span><span class="sxs-lookup"><span data-stu-id="c48b9-154">With simple clipboard data transfers, the data is placed in a global memory object.</span></span> <span data-ttu-id="c48b9-155">O endereço desse objeto é colocado na área de transferência, juntamente com seu formato.</span><span class="sxs-lookup"><span data-stu-id="c48b9-155">The address of that object is placed on the Clipboard, along with its format.</span></span> <span data-ttu-id="c48b9-156">O formato da área de transferência informa ao destino que tipo de dados ele encontrará no endereço associado.</span><span class="sxs-lookup"><span data-stu-id="c48b9-156">The clipboard format tells the target what kind of data it will find at the associated address.</span></span> <span data-ttu-id="c48b9-157">Embora as transferências de área de transferência simples sejam fáceis de implementar:</span><span class="sxs-lookup"><span data-stu-id="c48b9-157">While simple clipboard transfers are easy to implement:</span></span>

-   <span data-ttu-id="c48b9-158">Os objetos de dados fornecem uma maneira muito mais flexível de transferir dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-158">Data objects provide a much more flexible way to transfer data.</span></span>
-   <span data-ttu-id="c48b9-159">Os objetos de dados são mais adequados para transferir grandes quantidades de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-159">Data objects are better suited for transferring large amounts of data.</span></span>
-   <span data-ttu-id="c48b9-160">Os objetos de dados devem ser usados para transferir dados com uma operação de arrastar e soltar.</span><span class="sxs-lookup"><span data-stu-id="c48b9-160">Data objects must be used to transfer data with a drag-and-drop operation.</span></span>

<span data-ttu-id="c48b9-161">Por esses motivos, todas as transferências de dados do Shell usam objetos de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-161">For these reasons, all Shell data transfers use data objects.</span></span> <span data-ttu-id="c48b9-162">Com objetos de dados, os formatos da área de transferência não são usados diretamente.</span><span class="sxs-lookup"><span data-stu-id="c48b9-162">With data objects, clipboard formats are not used directly.</span></span> <span data-ttu-id="c48b9-163">Em vez disso, os itens de dados são identificados com uma generalização do formato da área de transferência, uma estrutura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) .</span><span class="sxs-lookup"><span data-stu-id="c48b9-163">Instead, data items are identified with a generalization of the clipboard format, a [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure.</span></span>

### <a name="formatetc-structure"></a><span data-ttu-id="c48b9-164">Estrutura FORMATETC</span><span class="sxs-lookup"><span data-stu-id="c48b9-164">FORMATETC Structure</span></span>

<span data-ttu-id="c48b9-165">A estrutura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) é uma versão estendida de um formato de área de transferência.</span><span class="sxs-lookup"><span data-stu-id="c48b9-165">The [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure is an extended version of a clipboard format.</span></span> <span data-ttu-id="c48b9-166">Conforme usado para transferências de dados do Shell, a estrutura **FORMATETC** tem as seguintes características:</span><span class="sxs-lookup"><span data-stu-id="c48b9-166">As used for Shell data transfers, the **FORMATETC** structure has the following characteristics:</span></span>

-   <span data-ttu-id="c48b9-167">Um item de dados ainda é identificado por seu formato de área de transferência, no membro **cfFormat** .</span><span class="sxs-lookup"><span data-stu-id="c48b9-167">A data item is still identified by its clipboard format, in the **cfFormat** member.</span></span>
-   <span data-ttu-id="c48b9-168">A transferência de dados não está limitada a objetos de memória global.</span><span class="sxs-lookup"><span data-stu-id="c48b9-168">Data transfer is not limited to global memory objects.</span></span> <span data-ttu-id="c48b9-169">O membro **TYMED** é usado para indicar o mecanismo de transferência de dados contido na estrutura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) associada.</span><span class="sxs-lookup"><span data-stu-id="c48b9-169">The **tymed** member is used to indicate the data transfer mechanism contained in the associated [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span> <span data-ttu-id="c48b9-170">Ele é definido como um dos valores de [**TYMED \_ xxx**](/windows/win32/api/objidl/ne-objidl-tymed) .</span><span class="sxs-lookup"><span data-stu-id="c48b9-170">It is set to one of the [**TYMED\_XXX**](/windows/win32/api/objidl/ne-objidl-tymed) values.</span></span>
-   <span data-ttu-id="c48b9-171">O Shell usa o membro **Lindex** com seu [formato \_ FileContent CFSTR](clipboard.md) para permitir que um objeto de dados contenha mais de um item de dados por formato.</span><span class="sxs-lookup"><span data-stu-id="c48b9-171">The Shell uses the **lIndex** member with its [CFSTR\_FILECONTENTS](clipboard.md) format to allow a data object to contain more than one data item per format.</span></span> <span data-ttu-id="c48b9-172">Para obter uma discussão sobre como usar esse formato, consulte a seção *usando o \_ formato CFSTR filecontents para extrair dados de um arquivo* de [manipulação de cenários de transferência de dados de shell](datascenarios.md).</span><span class="sxs-lookup"><span data-stu-id="c48b9-172">For a discussion of how to use this format, see the *Using the CFSTR\_FILECONTENTS Format to Extract Data from a File* section of [Handling Shell Data Transfer Scenarios](datascenarios.md).</span></span>
-   <span data-ttu-id="c48b9-173">O membro **dwAspect** normalmente é definido como DVASPECT \_ Content.</span><span class="sxs-lookup"><span data-stu-id="c48b9-173">The **dwAspect** member is typically set to DVASPECT\_CONTENT.</span></span> <span data-ttu-id="c48b9-174">No entanto, há três valores definidos em shlobj. h que podem ser usados para transferência de dados do Shell.</span><span class="sxs-lookup"><span data-stu-id="c48b9-174">However, there are three values defined in Shlobj.h that can be used for Shell data transfer.</span></span> 

    |                     |                                                                                                   |
    |---------------------|---------------------------------------------------------------------------------------------------|
    | <span data-ttu-id="c48b9-175">\_cópia DVASPECT</span><span class="sxs-lookup"><span data-stu-id="c48b9-175">DVASPECT\_COPY</span></span>      | <span data-ttu-id="c48b9-176">Usado para indicar que o formato representa uma cópia dos dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-176">Used to indicate that the format represents a copy of the data.</span></span>                                   |
    | <span data-ttu-id="c48b9-177">LINK do DVASPECT \_</span><span class="sxs-lookup"><span data-stu-id="c48b9-177">DVASPECT\_LINK</span></span>      | <span data-ttu-id="c48b9-178">Usado para indicar que o formato representa um atalho para os dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-178">Used to indicate that the format represents a shortcut to the data.</span></span>                               |
    | <span data-ttu-id="c48b9-179">nome \_ curto do DVASPECT</span><span class="sxs-lookup"><span data-stu-id="c48b9-179">DVASPECT\_SHORTNAME</span></span> | <span data-ttu-id="c48b9-180">Usado com o \_ formato CF HDROP para solicitar um caminho de arquivo com os nomes reduzidos para o formato 8,3.</span><span class="sxs-lookup"><span data-stu-id="c48b9-180">Used with the CF\_HDROP format to request a file path with the names shortened to the 8.3 format.</span></span> |

    

     

-   <span data-ttu-id="c48b9-181">O membro **ptd** não é usado para transferências de dados do Shell e normalmente é definido como **nulo**.</span><span class="sxs-lookup"><span data-stu-id="c48b9-181">The **ptd** member is not used for Shell data transfers and is normally set to **NULL**.</span></span>

### <a name="stgmedium-structure"></a><span data-ttu-id="c48b9-182">Estrutura STGMEDIUM</span><span class="sxs-lookup"><span data-stu-id="c48b9-182">STGMEDIUM structure</span></span>

<span data-ttu-id="c48b9-183">A estrutura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) fornece acesso aos dados que estão sendo transferidos.</span><span class="sxs-lookup"><span data-stu-id="c48b9-183">The [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure provides access to the data being transferred.</span></span> <span data-ttu-id="c48b9-184">Três mecanismos de transferência de dados têm suporte para dados do Shell:</span><span class="sxs-lookup"><span data-stu-id="c48b9-184">Three data transfer mechanisms are supported for Shell data:</span></span>

-   <span data-ttu-id="c48b9-185">Um objeto de memória global.</span><span class="sxs-lookup"><span data-stu-id="c48b9-185">A global memory object.</span></span>
-   <span data-ttu-id="c48b9-186">Uma interface [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) .</span><span class="sxs-lookup"><span data-stu-id="c48b9-186">An [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) interface.</span></span>
-   <span data-ttu-id="c48b9-187">Uma interface [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) .</span><span class="sxs-lookup"><span data-stu-id="c48b9-187">An [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) interface.</span></span>

<span data-ttu-id="c48b9-188">O membro **TYMED** da estrutura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) é um valor de [**TYMED \_ xxx**](/windows/win32/api/objidl/ne-objidl-tymed) que identifica o mecanismo de transferência de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-188">The **tymed** member of the [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure is a [**TYMED\_XXX**](/windows/win32/api/objidl/ne-objidl-tymed) value that identifies the data transfer mechanism.</span></span> <span data-ttu-id="c48b9-189">O segundo membro é um ponteiro que é usado pelo destino para extrair os dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-189">The second member is a pointer that is used by the target to extract the data.</span></span> <span data-ttu-id="c48b9-190">O ponteiro pode ser de uma variedade de tipos, dependendo do valor de **TYMED** .</span><span class="sxs-lookup"><span data-stu-id="c48b9-190">The pointer can be one of a variety of types, depending on the **tymed** value.</span></span> <span data-ttu-id="c48b9-191">Os três valores de **TYMED** que são usados para transferências de dados do shell são resumidos na tabela a seguir, juntamente com seu nome de membro **STGMEDIUM** correspondente.</span><span class="sxs-lookup"><span data-stu-id="c48b9-191">The three **tymed** values that are used for Shell data transfers are summarized in the following table, along with their corresponding **STGMEDIUM** member name.</span></span>



| <span data-ttu-id="c48b9-192">Valor de tymed</span><span class="sxs-lookup"><span data-stu-id="c48b9-192">tymed Value</span></span>     | <span data-ttu-id="c48b9-193">Nome do membro</span><span class="sxs-lookup"><span data-stu-id="c48b9-193">Member name</span></span> | <span data-ttu-id="c48b9-194">Descrição</span><span class="sxs-lookup"><span data-stu-id="c48b9-194">Description</span></span>                                                                                                                                                                                                                                                                                                       |
|-----------------|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="c48b9-195">TYMED \_ HGLOBAL</span><span class="sxs-lookup"><span data-stu-id="c48b9-195">TYMED\_HGLOBAL</span></span>  | <span data-ttu-id="c48b9-196">**hGlobal**</span><span class="sxs-lookup"><span data-stu-id="c48b9-196">**hGlobal**</span></span> | <span data-ttu-id="c48b9-197">Um ponteiro para um objeto de memória global.</span><span class="sxs-lookup"><span data-stu-id="c48b9-197">A pointer to a global memory object.</span></span> <span data-ttu-id="c48b9-198">Esse tipo de ponteiro normalmente é usado para transferir pequenas quantidades de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-198">This pointer type is typically used for transferring small amounts of data.</span></span> <span data-ttu-id="c48b9-199">Por exemplo, o Shell usa objetos de memória global para transferir cadeias de caracteres de texto curto, como nomes de arquivo ou URLs.</span><span class="sxs-lookup"><span data-stu-id="c48b9-199">For instance, the Shell uses global memory objects to transfer short text strings such as file names or URLs.</span></span>                                                                                    |
| <span data-ttu-id="c48b9-200">\_IStream tymed</span><span class="sxs-lookup"><span data-stu-id="c48b9-200">TYMED\_ISTREAM</span></span>  | <span data-ttu-id="c48b9-201">**pstm**</span><span class="sxs-lookup"><span data-stu-id="c48b9-201">**pstm**</span></span>    | <span data-ttu-id="c48b9-202">Um ponteiro para uma interface [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) .</span><span class="sxs-lookup"><span data-stu-id="c48b9-202">A pointer to an [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) interface.</span></span> <span data-ttu-id="c48b9-203">Esse tipo de ponteiro é preferencial para a maioria das transferências de dados de shell porque requer relativamente pouca memória em comparação com TYMED \_ HGLOBAL.</span><span class="sxs-lookup"><span data-stu-id="c48b9-203">This pointer type is preferred for most Shell data transfers because it requires relatively little memory compared to TYMED\_HGLOBAL.</span></span> <span data-ttu-id="c48b9-204">Além disso, o \_ mecanismo de transferência de dados TYMED IStream não exige que a origem armazene seus dados de forma específica.</span><span class="sxs-lookup"><span data-stu-id="c48b9-204">Also, the TYMED\_ISTREAM data transfer mechanism does not require the source to store its data in any particular way.</span></span> |
| <span data-ttu-id="c48b9-205">\_ISTORAGE tymed</span><span class="sxs-lookup"><span data-stu-id="c48b9-205">TYMED\_ISTORAGE</span></span> | <span data-ttu-id="c48b9-206">**pstg**</span><span class="sxs-lookup"><span data-stu-id="c48b9-206">**pstg**</span></span>    | <span data-ttu-id="c48b9-207">Um ponteiro para uma interface [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) .</span><span class="sxs-lookup"><span data-stu-id="c48b9-207">A pointer to an [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) interface.</span></span> <span data-ttu-id="c48b9-208">O destino chama os métodos de interface para extrair os dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-208">The target calls the interface methods to extract the data.</span></span> <span data-ttu-id="c48b9-209">Como TYMED \_ IStream, esse tipo de ponteiro requer relativamente pouca memória.</span><span class="sxs-lookup"><span data-stu-id="c48b9-209">Like TYMED\_ISTREAM, this pointer type requires relatively little memory.</span></span> <span data-ttu-id="c48b9-210">No entanto, como TYMED \_ ISTORAGE é menos flexível do que TYMED \_ IStream, ele não é o mais usado.</span><span class="sxs-lookup"><span data-stu-id="c48b9-210">However, because TYMED\_ISTORAGE is less flexible than TYMED\_ISTREAM, it is not as commonly used.</span></span>                  |



 

## <a name="how-a-source-creates-a-data-object"></a><span data-ttu-id="c48b9-211">Como uma fonte cria um objeto de dados</span><span class="sxs-lookup"><span data-stu-id="c48b9-211">How a Source Creates a Data Object</span></span>

<span data-ttu-id="c48b9-212">Quando um usuário inicia uma transferência de dados do Shell, a origem é responsável por criar um objeto de dados e carregá-lo com os dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-212">When a user initiates a Shell data transfer, the source is responsible for creating a data object and loading it with data.</span></span> <span data-ttu-id="c48b9-213">O procedimento a seguir resume o processo:</span><span class="sxs-lookup"><span data-stu-id="c48b9-213">The following procedure summarizes the process:</span></span>

1.  <span data-ttu-id="c48b9-214">Chame [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) para obter um valor de formato de área de transferência válido para cada formato de shell que será incluído no objeto de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-214">Call [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) to obtain a valid clipboard format value for each Shell format that will be included in the data object.</span></span> <span data-ttu-id="c48b9-215">Lembre-se de que o [CF \_ HDROP](clipboard.md) já é um formato de área de transferência válido e não precisa ser registrado.</span><span class="sxs-lookup"><span data-stu-id="c48b9-215">Remember that [CF\_HDROP](clipboard.md) is already a valid clipboard format and does not need to be registered.</span></span>
2.  <span data-ttu-id="c48b9-216">Para cada formato a ser transferido, coloque os dados associados em um objeto de memória global ou crie um objeto que forneça acesso a esses dados por meio de uma interface [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) ou [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) .</span><span class="sxs-lookup"><span data-stu-id="c48b9-216">For each format to be transferred, either put the associated data into a global memory object or create an object that provides access to that data through an [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) or [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) interface.</span></span> <span data-ttu-id="c48b9-217">As interfaces **IStream** e **IStorage** são criadas usando técnicas com padrão.</span><span class="sxs-lookup"><span data-stu-id="c48b9-217">The **IStream** and **IStorage** interfaces are created using standard COM techniques.</span></span> <span data-ttu-id="c48b9-218">Para obter uma discussão sobre como lidar com objetos de memória global, consulte [como adicionar um objeto de memória global a um objeto de dados](#how-to-add-a-global-memory-object-to-a-data-object).</span><span class="sxs-lookup"><span data-stu-id="c48b9-218">For a discussion of how to handle global memory objects, see [How to Add a Global Memory Object to a Data Object](#how-to-add-a-global-memory-object-to-a-data-object).</span></span>
3.  <span data-ttu-id="c48b9-219">Crie estruturas [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) e [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) para cada formato.</span><span class="sxs-lookup"><span data-stu-id="c48b9-219">Create [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) and [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structures for each format.</span></span>
4.  <span data-ttu-id="c48b9-220">Crie uma instância de um objeto de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-220">Instantiate a data object.</span></span>
5.  <span data-ttu-id="c48b9-221">Carregue os dados no objeto de dados chamando o método [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) para cada formato com suporte e passando as estruturas [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) e [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) do formato.</span><span class="sxs-lookup"><span data-stu-id="c48b9-221">Load the data into the data object by calling the [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) method for each supported format and passing in the format's [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) and [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structures.</span></span>
6.  <span data-ttu-id="c48b9-222">Com transferências de dados da área de transferência, chame [**OleSetClipboard**](/windows/win32/api/ole2/nf-ole2-olesetclipboard) para posicionar um ponteiro para a interface [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) do objeto de dados na área de transferência.</span><span class="sxs-lookup"><span data-stu-id="c48b9-222">With clipboard data transfers, call [**OleSetClipboard**](/windows/win32/api/ole2/nf-ole2-olesetclipboard) to place a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface on the Clipboard.</span></span> <span data-ttu-id="c48b9-223">Para transferências do tipo "arrastar e soltar", inicie um *loop de arrastar* chamando [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop).</span><span class="sxs-lookup"><span data-stu-id="c48b9-223">For drag-and-drop transfers, initiate a *drag loop* by calling [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop).</span></span> <span data-ttu-id="c48b9-224">O ponteiro **IDataObject** será passado para o destino de soltar quando os dados forem descartados, encerrando o loop de arrastar.</span><span class="sxs-lookup"><span data-stu-id="c48b9-224">The **IDataObject** pointer will be passed to the drop target when the data is dropped, ending the drag loop.</span></span>

<span data-ttu-id="c48b9-225">O objeto de dados agora está pronto para ser transferido para o destino.</span><span class="sxs-lookup"><span data-stu-id="c48b9-225">The data object is now ready to be transferred to the target.</span></span> <span data-ttu-id="c48b9-226">Para transferências de dados da área de transferência, o objeto é simplesmente mantido até que o destino o solicite chamando [**OleGetClipboard**](/windows/win32/api/ole2/nf-ole2-olegetclipboard).</span><span class="sxs-lookup"><span data-stu-id="c48b9-226">For clipboard data transfers, the object is simply held until the target requests it by calling [**OleGetClipboard**](/windows/win32/api/ole2/nf-ole2-olegetclipboard).</span></span> <span data-ttu-id="c48b9-227">Para transferências de dados do tipo "arrastar e soltar", o objeto de dados é responsável por criar um ícone para representar os dados e movê-lo à medida que o usuário move o cursor.</span><span class="sxs-lookup"><span data-stu-id="c48b9-227">For drag-and-drop data transfers, the data object is responsible for creating an icon to represent the data and moving it as the user moves the cursor.</span></span> <span data-ttu-id="c48b9-228">Enquanto o objeto estiver no loop de arrastar, a fonte receberá informações de status por meio de sua interface [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) .</span><span class="sxs-lookup"><span data-stu-id="c48b9-228">While the object is in the drag loop, the source receives status information through its [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) interface.</span></span> <span data-ttu-id="c48b9-229">Para mais discussões, consulte [implementando IDropSource](#implementing-idropsource).</span><span class="sxs-lookup"><span data-stu-id="c48b9-229">For further discussion, see [Implementing IDropSource](#implementing-idropsource).</span></span>

<span data-ttu-id="c48b9-230">A origem não receberá nenhuma notificação se o objeto de dados for recuperado da área de transferência por um destino.</span><span class="sxs-lookup"><span data-stu-id="c48b9-230">The source receives no notification if the data object is retrieved from the Clipboard by a target.</span></span> <span data-ttu-id="c48b9-231">Quando um objeto é Descartado em um destino por uma operação de arrastar e soltar, a função [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) que foi chamada para iniciar o loop de arrastar retornará.</span><span class="sxs-lookup"><span data-stu-id="c48b9-231">When an object is dropped on a target by a drag-and-drop operation, the [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) function that was called to initiate the drag loop will return.</span></span>

### <a name="how-to-add-a-global-memory-object-to-a-data-object"></a><span data-ttu-id="c48b9-232">Como adicionar um objeto de memória global a um objeto de dados</span><span class="sxs-lookup"><span data-stu-id="c48b9-232">How to Add a Global Memory Object to a Data Object</span></span>

<span data-ttu-id="c48b9-233">Muitos dos formatos de dados do Shell estão na forma de um objeto de memória global.</span><span class="sxs-lookup"><span data-stu-id="c48b9-233">Many of the Shell data formats are in the form of a global memory object.</span></span> <span data-ttu-id="c48b9-234">Use o procedimento a seguir para criar um formato que contém um objeto de memória global e carregá-lo no objeto de dados:</span><span class="sxs-lookup"><span data-stu-id="c48b9-234">Use the following procedure to create a format containing a global memory object and load it into the data object:</span></span>

1.  <span data-ttu-id="c48b9-235">Crie uma estrutura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) .</span><span class="sxs-lookup"><span data-stu-id="c48b9-235">Create a [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure.</span></span> <span data-ttu-id="c48b9-236">Defina o membro **cfFormat** como o valor apropriado de formato da área de transferência e o membro **TYMED** como TYMED \_ HGLOBAL.</span><span class="sxs-lookup"><span data-stu-id="c48b9-236">Set the **cfFormat** member to the appropriate clipboard format value and the **tymed** member to TYMED\_HGLOBAL.</span></span>
2.  <span data-ttu-id="c48b9-237">Crie uma estrutura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) .</span><span class="sxs-lookup"><span data-stu-id="c48b9-237">Create an [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span> <span data-ttu-id="c48b9-238">Defina o membro **TYMED** como TYMED \_ HGLOBAL.</span><span class="sxs-lookup"><span data-stu-id="c48b9-238">Set the **tymed** member to TYMED\_HGLOBAL.</span></span>
3.  <span data-ttu-id="c48b9-239">Crie um objeto de memória global chamando [**GlobalAlloc**](/windows/win32/api/winbase/nf-winbase-globalalloc) para alocar um bloco de memória adequado.</span><span class="sxs-lookup"><span data-stu-id="c48b9-239">Create a global memory object by calling [**GlobalAlloc**](/windows/win32/api/winbase/nf-winbase-globalalloc) to allocate a suitably sized block of memory.</span></span>
4.  <span data-ttu-id="c48b9-240">Atribua o bloco de dados a ser transferido para o endereço retornado por [**GlobalAlloc**](/windows/win32/api/winbase/nf-winbase-globalalloc).</span><span class="sxs-lookup"><span data-stu-id="c48b9-240">Assign the block of data to be transferred to the address returned by [**GlobalAlloc**](/windows/win32/api/winbase/nf-winbase-globalalloc).</span></span>
5.  <span data-ttu-id="c48b9-241">Atribua o endereço do objeto de memória global ao membro **HGLOBAL** da estrutura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) .</span><span class="sxs-lookup"><span data-stu-id="c48b9-241">Assign the global memory object's address to the **hGlobal** member of the [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span>
6.  <span data-ttu-id="c48b9-242">Carregue o formato no objeto de dados chamando [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) e passando as estruturas [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) e [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) criadas nas etapas anteriores.</span><span class="sxs-lookup"><span data-stu-id="c48b9-242">Load the format into the data object by calling [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) and passing in the [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) and [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structures created in the previous steps.</span></span>

<span data-ttu-id="c48b9-243">A seguinte função de exemplo cria um objeto de memória global contendo um valor **DWORD** e o carrega em um objeto de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-243">The following sample function creates a global memory object containing a **DWORD** value and loads it into a data object.</span></span> <span data-ttu-id="c48b9-244">O parâmetro **pdtobj** é um ponteiro para a interface [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) do objeto de dados, **CF** é o valor do formato da área de transferência e o **DW** é o valor dos dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-244">The **pdtobj** parameter is a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface, **cf** is the clipboard format value, and **dw** is the data value.</span></span>


```C++
STDAPI DataObj_SetDWORD(IDataObject *pdtobj, UINT cf, DWORD dw)
{
    FORMATETC fmte = {(CLIPFORMAT) cf, 
                      NULL, 
                      DVASPECT_CONTENT, 
                      -1, 
                      TYMED_HGLOBAL};
    STGMEDIUM medium;

    HRESULT hres = E_OUTOFMEMORY;
    DWORD *pdw = (DWORD *)GlobalAlloc(GPTR, sizeof(DWORD));
    
    if (pdw)
    {
        *pdw = dw;       
        medium.tymed = TYMED_HGLOBAL;
        medium.hGlobal = pdw;
        medium.pUnkForRelease = NULL;

        hres = pdtobj->SetData(&fmte, &medium, TRUE);
 
        if (FAILED(hres))
            GlobalFree((HGLOBAL)pdw);
    }
    return hres;
}
```



### <a name="implementing-idataobject"></a><span data-ttu-id="c48b9-245">Implementando IDataObject</span><span class="sxs-lookup"><span data-stu-id="c48b9-245">Implementing IDataObject</span></span>

<span data-ttu-id="c48b9-246">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) é a interface primária de um objeto de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-246">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) is a data object's primary interface.</span></span> <span data-ttu-id="c48b9-247">Ele deve ser implementado por todos os objetos de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-247">It must be implemented by all data objects.</span></span> <span data-ttu-id="c48b9-248">Ele é usado pela origem e pelo destino para uma variedade de finalidades, incluindo:</span><span class="sxs-lookup"><span data-stu-id="c48b9-248">It is used by both source and target for a variety of purposes, including:</span></span>

-   <span data-ttu-id="c48b9-249">Carregando dados no objeto de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-249">Loading data into the data object.</span></span>
-   <span data-ttu-id="c48b9-250">Extraindo dados do objeto de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-250">Extracting data from the data object.</span></span>
-   <span data-ttu-id="c48b9-251">Determinando quais tipos de dados estão no objeto de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-251">Determining what types of data are in the data object.</span></span>
-   <span data-ttu-id="c48b9-252">Fornecer comentários para o objeto de dados no resultado da transferência de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-252">Providing feedback to the data object on outcome of the data transfer.</span></span>

<span data-ttu-id="c48b9-253">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) dá suporte a vários métodos.</span><span class="sxs-lookup"><span data-stu-id="c48b9-253">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) supports a number of methods.</span></span> <span data-ttu-id="c48b9-254">Esta seção discute como implementar os três métodos mais importantes para objetos de dados do Shell, [SetData](#setdata-method), [EnumFormatEtc](#enumformatetc-method)e [GetData](#getdata-method).</span><span class="sxs-lookup"><span data-stu-id="c48b9-254">This section discusses how to implement the three most important methods for Shell data objects, [SetData](#setdata-method), [EnumFormatEtc](#enumformatetc-method), and [GetData](#getdata-method).</span></span> <span data-ttu-id="c48b9-255">Para obter uma discussão sobre os outros métodos, consulte a referência **IDataObject** .</span><span class="sxs-lookup"><span data-stu-id="c48b9-255">For a discussion of the other methods, see the **IDataObject** reference.</span></span>

### <a name="setdata-method"></a><span data-ttu-id="c48b9-256">Método SetData</span><span class="sxs-lookup"><span data-stu-id="c48b9-256">SetData method</span></span>

<span data-ttu-id="c48b9-257">A função principal do método [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) é permitir que a origem carregue dados no objeto de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-257">The primary function of the [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) method is to allow the source to load data into the data object.</span></span> <span data-ttu-id="c48b9-258">Para cada formato a ser incluído, a origem cria uma estrutura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) para identificar o formato e uma estrutura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) para manter um ponteiro para os dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-258">For each format to be included, the source creates a [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure to identify the format and an [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure to hold a pointer to the data.</span></span> <span data-ttu-id="c48b9-259">Em seguida, a origem chama o método **IDataObject:: SetData** do objeto e passa as estruturas **FORMATETC** e **STGMEDIUM** do formato.</span><span class="sxs-lookup"><span data-stu-id="c48b9-259">The source then calls the object's **IDataObject::SetData** method and passes in the format's **FORMATETC** and **STGMEDIUM** structures.</span></span> <span data-ttu-id="c48b9-260">O método deve armazenar essas informações para que elas estejam disponíveis quando o destino chama [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) para extrair dados do objeto.</span><span class="sxs-lookup"><span data-stu-id="c48b9-260">The method must store this information so that it is available when the target calls [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) to extract data from the object.</span></span>

<span data-ttu-id="c48b9-261">No entanto, ao transferir arquivos, o Shell geralmente coloca as informações de cada arquivo a ser transferido para um formato de [ \_ FileContent CFSTR](clipboard.md) separado.</span><span class="sxs-lookup"><span data-stu-id="c48b9-261">However, when transferring files, the Shell often puts the information for each file to be transferred into a separate [CFSTR\_FILECONTENTS](clipboard.md) format.</span></span> <span data-ttu-id="c48b9-262">Para distinguir os arquivos diferentes, o membro **Lindex** da estrutura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) de cada arquivo é definido como um valor de índice que identifica o arquivo específico.</span><span class="sxs-lookup"><span data-stu-id="c48b9-262">To distinguish the different files, the **lIndex** member of each file's [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure is set to an index value that identifies the particular file.</span></span> <span data-ttu-id="c48b9-263">Sua implementação de [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) deve ser capaz de armazenar vários \_ formatos de FileContent CFSTR que diferem apenas por seus membros **Lindex** .</span><span class="sxs-lookup"><span data-stu-id="c48b9-263">Your [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) implementation must be capable of storing multiple CFSTR\_FILECONTENTS formats that differ only by their **lIndex** members.</span></span>

<span data-ttu-id="c48b9-264">Enquanto o cursor está sobre a janela de destino, o destino pode usar o objeto auxiliar do tipo " [arrastar e soltar](#using-the-drag-and-drop-helper-object) " para especificar a imagem de arrastar.</span><span class="sxs-lookup"><span data-stu-id="c48b9-264">While the cursor is over the target window, the target can use the [drag-and-drop helper object](#using-the-drag-and-drop-helper-object) to specify the drag image.</span></span> <span data-ttu-id="c48b9-265">O objeto auxiliar do tipo "arrastar e soltar" chama [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) para carregar formatos privados no objeto de dados que são usados para suporte entre processos.</span><span class="sxs-lookup"><span data-stu-id="c48b9-265">The drag-and-drop helper object calls [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) to load private formats into the data object that are used for cross-process support.</span></span> <span data-ttu-id="c48b9-266">Para dar suporte ao objeto auxiliar do tipo "arrastar e soltar", sua implementação de **IDataObject:: SetData** deve ser capaz de aceitar e armazenar formatos privados arbitrários.</span><span class="sxs-lookup"><span data-stu-id="c48b9-266">To support the drag-and-drop helper object, your **IDataObject::SetData** implementation must be able to accept and store arbitrary private formats.</span></span>

<span data-ttu-id="c48b9-267">Depois que os dados forem descartados, alguns tipos de transferência de dados do Shell exigirão que o destino chame [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) para fornecer ao objeto de dados informações sobre o resultado da operação de remoção.</span><span class="sxs-lookup"><span data-stu-id="c48b9-267">After the data has been dropped, some types of Shell data transfer require the target to call [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) to provide the data object with information about the outcome of the drop operation.</span></span> <span data-ttu-id="c48b9-268">Por exemplo, ao mover arquivos com uma operação de movimentação otimizada, o destino normalmente exclui os arquivos originais, mas não é necessário fazê-lo.</span><span class="sxs-lookup"><span data-stu-id="c48b9-268">For example, when moving files with an optimized move operation, the target normally deletes the original files, but it is not required to do so.</span></span> <span data-ttu-id="c48b9-269">O destino informa ao objeto de dados se ele excluiu os arquivos chamando **IDataObject:: SetData** com um formato [CFSTR \_ LOGICALPERFORMEDDROPEFFECT](clipboard.md) .</span><span class="sxs-lookup"><span data-stu-id="c48b9-269">The target informs the data object whether it deleted the files by calling **IDataObject::SetData** with a [CFSTR\_LOGICALPERFORMEDDROPEFFECT](clipboard.md) format.</span></span> <span data-ttu-id="c48b9-270">Há vários outros [formatos de área de transferência do Shell](clipboard.md) que também são usados pelo destino para passar informações para o objeto de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-270">There are several other [Shell Clipboard Formats](clipboard.md) that are also used by the target to pass information to the data object.</span></span> <span data-ttu-id="c48b9-271">Sua implementação de **IDataObject:: SetData** deve ser capaz de reconhecer esses formatos e responder adequadamente.</span><span class="sxs-lookup"><span data-stu-id="c48b9-271">Your **IDataObject::SetData** implementation must be able to recognize these formats and respond appropriately.</span></span> <span data-ttu-id="c48b9-272">Para mais discussões, consulte [manipulando cenários de transferência de dados do Shell](datascenarios.md).</span><span class="sxs-lookup"><span data-stu-id="c48b9-272">For further discussion, see [Handling Shell Data Transfer Scenarios](datascenarios.md).</span></span>

### <a name="enumformatetc-method"></a><span data-ttu-id="c48b9-273">Método EnumFormatEtc</span><span class="sxs-lookup"><span data-stu-id="c48b9-273">EnumFormatEtc method</span></span>

<span data-ttu-id="c48b9-274">Quando o destino recebe um objeto de dados, ele normalmente chama [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) para determinar os formatos que o objeto contém.</span><span class="sxs-lookup"><span data-stu-id="c48b9-274">When the target receives a data object, it commonly calls [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) to determine what formats the object contains.</span></span> <span data-ttu-id="c48b9-275">O método cria um objeto de enumeração OLE e retorna um ponteiro para a interface [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) do objeto.</span><span class="sxs-lookup"><span data-stu-id="c48b9-275">The method creates an OLE enumeration object and returns a pointer to the object's [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) interface.</span></span> <span data-ttu-id="c48b9-276">Em seguida, o destino usa a interface para enumerar os formatos disponíveis.</span><span class="sxs-lookup"><span data-stu-id="c48b9-276">The target then uses the interface to enumerate the available formats.</span></span>

<span data-ttu-id="c48b9-277">Um objeto de enumeração sempre deve enumerar os formatos disponíveis em ordem de qualidade, começando com o melhor.</span><span class="sxs-lookup"><span data-stu-id="c48b9-277">An enumeration object should always enumerate the available formats in order of quality, starting with the best.</span></span> <span data-ttu-id="c48b9-278">A qualidade relativa dos formatos é definida pela fonte de soltar.</span><span class="sxs-lookup"><span data-stu-id="c48b9-278">The relative quality of formats is defined by the drop source.</span></span> <span data-ttu-id="c48b9-279">Em geral, os formatos de qualidade mais alta contêm os dados mais avançados e mais completos.</span><span class="sxs-lookup"><span data-stu-id="c48b9-279">In general, the highest-quality formats contain the richest and most complete data.</span></span> <span data-ttu-id="c48b9-280">Por exemplo, uma imagem colorida de 24 bits normalmente seria considerada de qualidade mais alta do que uma versão em escala cinza dessa imagem.</span><span class="sxs-lookup"><span data-stu-id="c48b9-280">For instance, a 24-bit color image would normally be considered higher quality than a gray-scale version of that image.</span></span> <span data-ttu-id="c48b9-281">O motivo da enumeração de formatos na ordem de sua qualidade é que os destinos normalmente são enumerados até chegarem a um formato que eles dão suporte e, em seguida, usam esse formato para extrair os dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-281">The reason for enumerating formats in order of their quality is that targets typically enumerate until they get to a format that they support, and then they use that format to extract the data.</span></span> <span data-ttu-id="c48b9-282">Para que este procedimento produza o melhor formato disponível ao qual o destino pode dar suporte, os formatos devem ser enumerados na ordem de sua qualidade.</span><span class="sxs-lookup"><span data-stu-id="c48b9-282">For this procedure to produce the best available format that the target can support, the formats must be enumerated in order of their quality.</span></span>

<span data-ttu-id="c48b9-283">Um objeto de enumeração para os dados do Shell é implementado quase da mesma forma que para outros tipos de transferência de dados, com uma exceção notável.</span><span class="sxs-lookup"><span data-stu-id="c48b9-283">An enumeration object for Shell data is implemented in much the same way as for other types of data transfer, with one notable exception.</span></span> <span data-ttu-id="c48b9-284">Como os objetos de dados normalmente contêm apenas um item de dados por formato, eles normalmente enumeram todos os formatos que são passados para [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata).</span><span class="sxs-lookup"><span data-stu-id="c48b9-284">Because data objects typically contain only one data item per format, they normally enumerate every format that is passed to [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata).</span></span> <span data-ttu-id="c48b9-285">No entanto, como discutido na seção do [método SetData](#setdata-method) , os objetos de dados do Shell podem conter vários formatos [ \_ FileContent CFSTR](clipboard.md) .</span><span class="sxs-lookup"><span data-stu-id="c48b9-285">However, as discussed in the [SetData method](#setdata-method) section, Shell data objects can contain multiple [CFSTR\_FILECONTENTS](clipboard.md) formats.</span></span>

<span data-ttu-id="c48b9-286">Como a finalidade de [**IDataObject:: EnumFormatEtc**](/windows/win32/api/objidl/nf-objidl-idataobject-enumformatetc) é permitir que o destino determine quais tipos de dados estão presentes, não há necessidade de enumerar mais de um formato [ \_ FileContent CFSTR](clipboard.md) .</span><span class="sxs-lookup"><span data-stu-id="c48b9-286">Because the purpose of [**IDataObject::EnumFormatEtc**](/windows/win32/api/objidl/nf-objidl-idataobject-enumformatetc) is to allow the target to determine what types of data are present, there is no need to enumerate more than one [CFSTR\_FILECONTENTS](clipboard.md) format.</span></span> <span data-ttu-id="c48b9-287">Se o destino precisar saber quantos desses formatos o objeto de dados contém, o destino poderá recuperar essas informações do formato de FileDescriptor CFSTR que o acompanha \_ .</span><span class="sxs-lookup"><span data-stu-id="c48b9-287">If the target needs to know how many of these formats the data object contains, the target can retrieve that information from the accompanying CFSTR\_FILEDESCRIPTOR format.</span></span> <span data-ttu-id="c48b9-288">Para obter mais informações sobre como implementar **IDataObject:: EnumFormatEtc**, consulte a documentação de referência do método.</span><span class="sxs-lookup"><span data-stu-id="c48b9-288">For further discussion of how to implement **IDataObject::EnumFormatEtc**, see the method's reference documentation.</span></span>

### <a name="getdata-method"></a><span data-ttu-id="c48b9-289">Método GetData</span><span class="sxs-lookup"><span data-stu-id="c48b9-289">GetData method</span></span>

<span data-ttu-id="c48b9-290">O destino chama [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) para extrair um formato de dados específico.</span><span class="sxs-lookup"><span data-stu-id="c48b9-290">The target calls [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) to extract a particular data format.</span></span> <span data-ttu-id="c48b9-291">O destino especifica o formato passando a estrutura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) apropriada.</span><span class="sxs-lookup"><span data-stu-id="c48b9-291">The target specifies the format by passing in the appropriate [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure.</span></span> <span data-ttu-id="c48b9-292">**IDataObject:: GetData** retorna a estrutura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) do formato.</span><span class="sxs-lookup"><span data-stu-id="c48b9-292">**IDataObject::GetData** returns the format's [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span>

<span data-ttu-id="c48b9-293">O destino pode definir o membro **TYMED** da estrutura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) para um valor específico de TYMED \_ *xxx* para especificar qual mecanismo de transferência de dados será usado para extrair os dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-293">The target can set the **tymed** member of the [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure to a specific TYMED\_*XXX* value to specify which data transfer mechanism it will use to extract the data.</span></span> <span data-ttu-id="c48b9-294">No entanto, o destino também pode fazer uma solicitação mais genérica e permitir que o objeto de dados decida.</span><span class="sxs-lookup"><span data-stu-id="c48b9-294">However, the target can also make a more generic request and let the data object decide.</span></span> <span data-ttu-id="c48b9-295">Para solicitar que o objeto de dados selecione o mecanismo de transferência de dados, o destino define todos os valores de TYMED \_ *xxx* aos quais ele dá suporte.</span><span class="sxs-lookup"><span data-stu-id="c48b9-295">To ask the data object to select the data transfer mechanism, the target sets all the TYMED\_*XXX* values that it supports.</span></span> <span data-ttu-id="c48b9-296">[**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) seleciona um desses mecanismos de transferência de dados e retorna a estrutura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) apropriada.</span><span class="sxs-lookup"><span data-stu-id="c48b9-296">[**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) selects one of these data transfer mechanisms and returns the appropriate [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span> <span data-ttu-id="c48b9-297">Por exemplo, **TYMED** é normalmente definido como TYMED \_ HGLOBAL \| TYMED \_ IStream \| TYMED \_ ISTORAGE para solicitar qualquer um dos três mecanismos de transferência de dados do Shell.</span><span class="sxs-lookup"><span data-stu-id="c48b9-297">For instance, **tymed** is commonly set to TYMED\_HGLOBAL \| TYMED\_ISTREAM \| TYMED\_ISTORAGE to request any of the three Shell data transfer mechanisms.</span></span>

> [!Note]  
> <span data-ttu-id="c48b9-298">Como pode haver vários formatos [ \_ FileContent CFSTR](clipboard.md) , os membros **cfFormat** e **TYMED** da estrutura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) não são suficientes para indicar qual estrutura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) deve retornar.</span><span class="sxs-lookup"><span data-stu-id="c48b9-298">Because there can be multiple [CFSTR\_FILECONTENTS](clipboard.md) formats, the **cfFormat** and **tymed** members of the [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure are not sufficient to indicate which [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) should return.</span></span> <span data-ttu-id="c48b9-299">Para o \_ formato CFSTR FILEcontents, **IDataObject:: GetData** também deve examinar o membro **Lindex** da estrutura **FORMATETC** para retornar a estrutura **STGMEDIUM** correta.</span><span class="sxs-lookup"><span data-stu-id="c48b9-299">For the CFSTR\_FILECONTENTS format, **IDataObject::GetData** must also examine the **FORMATETC** structure's **lIndex** member in order to return the correct **STGMEDIUM** structure.</span></span>

 

<span data-ttu-id="c48b9-300">O formato [CFSTR \_ INDRAGLOOP](clipboard.md) é colocado em objetos de dados para permitir que os destinos verifiquem o status do loop do tipo "arrastar e soltar", evitando a renderização intensiva da memória dos dados do objeto.</span><span class="sxs-lookup"><span data-stu-id="c48b9-300">The [CFSTR\_INDRAGLOOP](clipboard.md) format is placed in data objects to allow targets to check the status of the drag-and-drop loop while avoiding memory intensive rendering of the object's data.</span></span> <span data-ttu-id="c48b9-301">Os dados do formato são um valor **DWORD** que é definido como um valor diferente de zero se o objeto de dados estiver dentro de um loop de arrastar.</span><span class="sxs-lookup"><span data-stu-id="c48b9-301">The format's data is a **DWORD** value that is set to a nonzero value if the data object is within a drag loop.</span></span> <span data-ttu-id="c48b9-302">O valor de dados do formato será definido como zero se os dados tiverem sido descartados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-302">The format's data value is set to zero if the data has been dropped.</span></span> <span data-ttu-id="c48b9-303">Se um destino solicitar esse formato e ele não tiver sido carregado pela origem, [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) deverá responder como se a fonte tivesse carregado o formato com um valor igual a zero.</span><span class="sxs-lookup"><span data-stu-id="c48b9-303">If a target requests this format and it has not been loaded by the source, [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) should respond as if the source had loaded the format with a value of zero.</span></span>

<span data-ttu-id="c48b9-304">Enquanto o cursor está sobre a janela de destino, o destino pode usar o objeto auxiliar do tipo " [arrastar e soltar](#using-the-drag-and-drop-helper-object) " para especificar a imagem de arrastar.</span><span class="sxs-lookup"><span data-stu-id="c48b9-304">While the cursor is over the target window, the target can use the [drag-and-drop helper object](#using-the-drag-and-drop-helper-object) to specify the drag image.</span></span> <span data-ttu-id="c48b9-305">O objeto auxiliar do tipo "arrastar e soltar" chama [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) para carregar formatos privados no objeto de dados que são usados para suporte entre processos.</span><span class="sxs-lookup"><span data-stu-id="c48b9-305">The drag-and-drop helper object calls [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) to load private formats into the data object that are used for cross-process support.</span></span> <span data-ttu-id="c48b9-306">Depois, ele chama [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) para recuperá-los.</span><span class="sxs-lookup"><span data-stu-id="c48b9-306">It later calls [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) to retrieve them.</span></span> <span data-ttu-id="c48b9-307">Para dar suporte ao objeto auxiliar do tipo "arrastar e soltar", a implementação do objeto de dados do Shell deve ser capaz de retornar formatos privados arbitrários quando eles são solicitados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-307">To support the drag-and-drop helper object, your Shell Data Object implementation must be able to return arbitrary private formats when they are requested.</span></span>

### <a name="implementing-idropsource"></a><span data-ttu-id="c48b9-308">Implementando IDropSource</span><span class="sxs-lookup"><span data-stu-id="c48b9-308">Implementing IDropSource</span></span>

<span data-ttu-id="c48b9-309">A origem deve criar um objeto que expõe uma interface [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) .</span><span class="sxs-lookup"><span data-stu-id="c48b9-309">The source must create an object that exposes an [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) interface.</span></span> <span data-ttu-id="c48b9-310">Essa interface permite que a origem atualize a *imagem de arrastar* que indica a posição atual do cursor e forneça comentários ao sistema sobre como encerrar uma operação de arrastar e soltar.</span><span class="sxs-lookup"><span data-stu-id="c48b9-310">This interface allows the source to update the *drag image* that indicates the current position of the cursor and to provide feedback to the system on how to terminate a drag-and-drop operation.</span></span> <span data-ttu-id="c48b9-311">**IDropSource** tem dois métodos: [**GiveFeedback**](/windows/win32/api/oleidl/nf-oleidl-idropsource-givefeedback) e [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag).</span><span class="sxs-lookup"><span data-stu-id="c48b9-311">**IDropSource** has two methods: [**GiveFeedback**](/windows/win32/api/oleidl/nf-oleidl-idropsource-givefeedback) and [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag).</span></span>

### <a name="givefeedback-method"></a><span data-ttu-id="c48b9-312">Método GiveFeedback</span><span class="sxs-lookup"><span data-stu-id="c48b9-312">GiveFeedback method</span></span>

<span data-ttu-id="c48b9-313">Enquanto estiver no loop de arrastar, uma fonte de soltar é responsável por manter o controle da posição do cursor e exibir uma imagem de arrastar apropriada.</span><span class="sxs-lookup"><span data-stu-id="c48b9-313">While in the drag loop, a drop source is responsible for keeping track of the cursor position and displaying an appropriate drag image.</span></span> <span data-ttu-id="c48b9-314">No entanto, em alguns casos, talvez você queira alterar a aparência da imagem de arrastar quando ela estiver acima da janela de destino.</span><span class="sxs-lookup"><span data-stu-id="c48b9-314">However, in some cases you might want to change the appearance of the drag image when it is over the drop target's window.</span></span>

<span data-ttu-id="c48b9-315">Quando o cursor entra ou sai da janela de destino e enquanto está movendo sobre a janela de destino, o sistema chama periodicamente a interface [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) do destino.</span><span class="sxs-lookup"><span data-stu-id="c48b9-315">When the cursor enters or leaves the target window and while it is moving over the target window, the system periodically calls the target's [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface.</span></span> <span data-ttu-id="c48b9-316">O destino responde com um valor [**DROPEFFECT**](../com/dropeffect-constants.md) que é encaminhado para a origem por meio do método [**GiveFeedback**](/windows/win32/api/oleidl/nf-oleidl-idropsource-givefeedback) .</span><span class="sxs-lookup"><span data-stu-id="c48b9-316">The target responds with a [**DROPEFFECT**](../com/dropeffect-constants.md) value that is forwarded to the source through the [**GiveFeedback**](/windows/win32/api/oleidl/nf-oleidl-idropsource-givefeedback) method.</span></span> <span data-ttu-id="c48b9-317">Se apropriado, a origem pode modificar a aparência do cursor com base no valor **DROPEFFECT** .</span><span class="sxs-lookup"><span data-stu-id="c48b9-317">If appropriate, the source can modify the appearance of the cursor based on the **DROPEFFECT** value.</span></span> <span data-ttu-id="c48b9-318">Para obter mais detalhes, consulte as referências de **GiveFeedback** e [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) .</span><span class="sxs-lookup"><span data-stu-id="c48b9-318">For further details, see the **GiveFeedback** and [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) references.</span></span>

### <a name="querycontinuedrag-method"></a><span data-ttu-id="c48b9-319">Método QueryContinueDrag</span><span class="sxs-lookup"><span data-stu-id="c48b9-319">QueryContinueDrag method</span></span>

<span data-ttu-id="c48b9-320">Esse método será chamado se o botão do mouse ou o estado do teclado mudar enquanto o objeto de dados estiver no loop de arrastar.</span><span class="sxs-lookup"><span data-stu-id="c48b9-320">This method is called if the mouse button or keyboard state changes while the data object is in the drag loop.</span></span> <span data-ttu-id="c48b9-321">Ele notifica a origem se a tecla ESC foi pressionada e fornece o estado atual das teclas modificadoras de teclado, como CTRL ou SHIFT.</span><span class="sxs-lookup"><span data-stu-id="c48b9-321">It notifies the source whether the ESC key has been pressed and provides the current state of the keyboard modifier keys, such as CTRL or SHIFT.</span></span> <span data-ttu-id="c48b9-322">O valor de retorno do método [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag) especifica uma das três ações:</span><span class="sxs-lookup"><span data-stu-id="c48b9-322">The [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag) method's return value specifies one of three actions:</span></span>

-   <span data-ttu-id="c48b9-323">S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="c48b9-323">S\_OK.</span></span> <span data-ttu-id="c48b9-324">Continuar a operação de arrastar</span><span class="sxs-lookup"><span data-stu-id="c48b9-324">Continue the drag operation</span></span>
-   <span data-ttu-id="c48b9-325">remoção de S de DRAGDROP \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="c48b9-325">DRAGDROP\_S\_DROP.</span></span> <span data-ttu-id="c48b9-326">Descarte os dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-326">Drop the data.</span></span> <span data-ttu-id="c48b9-327">Em seguida, o sistema chama o método [**IDropTarget::D ROP**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) do destino.</span><span class="sxs-lookup"><span data-stu-id="c48b9-327">The system then calls the target's [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) method.</span></span>
-   <span data-ttu-id="c48b9-328">a DRAGDROP \_ S \_ Cancel.</span><span class="sxs-lookup"><span data-stu-id="c48b9-328">DRAGDROP\_S\_CANCEL.</span></span> <span data-ttu-id="c48b9-329">Encerre o loop de arrastar sem descartar os dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-329">Terminate the drag loop without dropping the data.</span></span> <span data-ttu-id="c48b9-330">Esse valor normalmente será retornado se a tecla ESCAPE tiver sido pressionada.</span><span class="sxs-lookup"><span data-stu-id="c48b9-330">This value is normally returned if the ESCAPE key was pressed.</span></span>

<span data-ttu-id="c48b9-331">Para mais discussões, consulte as referências de [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag) e [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) .</span><span class="sxs-lookup"><span data-stu-id="c48b9-331">For further discussion, see the [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag) and [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) references.</span></span>

## <a name="how-a-target-handles-a-data-object"></a><span data-ttu-id="c48b9-332">Como um destino manipula um objeto de dados</span><span class="sxs-lookup"><span data-stu-id="c48b9-332">How a Target Handles a Data Object</span></span>

<span data-ttu-id="c48b9-333">O destino recebe um objeto de dados quando recupera o objeto de dados da área de transferência ou ele foi Descartado na janela de destino pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="c48b9-333">The target receives a data object when it either retrieves the data object from the Clipboard or has it dropped on the target window by the user.</span></span> <span data-ttu-id="c48b9-334">O destino pode então extrair dados do objeto de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-334">The target can then extract data from the data object.</span></span> <span data-ttu-id="c48b9-335">Se necessário, o destino também pode notificar o objeto de dados do resultado da operação.</span><span class="sxs-lookup"><span data-stu-id="c48b9-335">If necessary, the target can also notify the data object of the outcome of the operation.</span></span> <span data-ttu-id="c48b9-336">Antes de uma transferência de dados de Shell, um destino de soltura deve se preparar para a operação:</span><span class="sxs-lookup"><span data-stu-id="c48b9-336">Prior to a Shell data transfer, a drop target must prepare itself for the operation:</span></span>

1.  <span data-ttu-id="c48b9-337">O destino deve chamar [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) para obter um valor de formato de área de transferência válido para todos os formatos de Shell, diferente de [CF \_ HDROP](clipboard.md), que pode ser incluído no objeto de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-337">The target must call [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) to obtain a valid clipboard format value for all Shell formats, other than [CF\_HDROP](clipboard.md), that might be included in the data object.</span></span> <span data-ttu-id="c48b9-338">O CF \_ HDROP já é um formato de área de transferência válido e não precisa ser registrado.</span><span class="sxs-lookup"><span data-stu-id="c48b9-338">CF\_HDROP is already a valid clipboard format and does not need to be registered.</span></span>
2.  <span data-ttu-id="c48b9-339">Para dar suporte a uma operação de arrastar e soltar, o destino deve implementar uma interface [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) e registrar uma janela de destino.</span><span class="sxs-lookup"><span data-stu-id="c48b9-339">To support a drag-and-drop operation, the target must implement an [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface and register a target window.</span></span> <span data-ttu-id="c48b9-340">Para registrar uma janela de destino, o destino chama [**RegisterDragDrop**](/windows/win32/api/ole2/nf-ole2-registerdragdrop) e passa o identificador da janela e o ponteiro de interface **IDropTarget** .</span><span class="sxs-lookup"><span data-stu-id="c48b9-340">To register a target window, the target calls [**RegisterDragDrop**](/windows/win32/api/ole2/nf-ole2-registerdragdrop) and passes in the window's handle and the **IDropTarget** interface pointer.</span></span>

<span data-ttu-id="c48b9-341">Para transferências da área de transferência, o destino não recebe nenhuma notificação de que um objeto de dados foi colocado na área de transferência.</span><span class="sxs-lookup"><span data-stu-id="c48b9-341">For clipboard transfers, the target does not receive any notification that a data object has been placed on the Clipboard.</span></span> <span data-ttu-id="c48b9-342">Normalmente, um aplicativo é notificado de que um objeto está na área de transferência por uma ação do usuário, como clicar no botão colar na barra de ferramentas do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c48b9-342">Typically, an application is notified that an object is on the Clipboard by a user action, such as clicking the Paste button on the application's toolbar.</span></span> <span data-ttu-id="c48b9-343">Em seguida, o destino recupera o ponteiro [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) do objeto de dados da área de transferência chamando [**OleGetClipboard**](/windows/win32/api/ole2/nf-ole2-olegetclipboard).</span><span class="sxs-lookup"><span data-stu-id="c48b9-343">The target then retrieves the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) pointer from the Clipboard by calling [**OleGetClipboard**](/windows/win32/api/ole2/nf-ole2-olegetclipboard).</span></span> <span data-ttu-id="c48b9-344">Para transferências de dados do tipo "arrastar e soltar", o sistema usa a interface [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) do destino para fornecer o destino com informações sobre o progresso da transferência de dados:</span><span class="sxs-lookup"><span data-stu-id="c48b9-344">For drag-and-drop data transfers, the system uses the target's [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface to provide the target with information about the progress of the data transfer:</span></span>

-   <span data-ttu-id="c48b9-345">O sistema chama [**IDropTarget::D ragenter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) quando o cursor entra na janela de destino.</span><span class="sxs-lookup"><span data-stu-id="c48b9-345">The system calls [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) when the cursor enters the target window.</span></span>
-   <span data-ttu-id="c48b9-346">O sistema chama periodicamente [**IDropTarget::D ragover**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) conforme o cursor passa pela janela de destino, para dar ao destino a posição atual do cursor.</span><span class="sxs-lookup"><span data-stu-id="c48b9-346">The system periodically calls [**IDropTarget::DragOver**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) as the cursor passes over the target window, to give the target the current cursor position.</span></span>
-   <span data-ttu-id="c48b9-347">O sistema chama [**IDropTarget::D ragleave**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragleave) quando o cursor sai da janela de destino.</span><span class="sxs-lookup"><span data-stu-id="c48b9-347">The system calls [**IDropTarget::DragLeave**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragleave) when the cursor leaves the target window.</span></span>
-   <span data-ttu-id="c48b9-348">O sistema chama [**IDropTarget::D ROP**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) quando o usuário remove o objeto de dados na janela de destino.</span><span class="sxs-lookup"><span data-stu-id="c48b9-348">The system calls [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) when the user drops the data object on the target window.</span></span>

<span data-ttu-id="c48b9-349">Para obter uma discussão sobre como implementar esses métodos, consulte [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget).</span><span class="sxs-lookup"><span data-stu-id="c48b9-349">For a discussion of how to implement these methods, see [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget).</span></span>

<span data-ttu-id="c48b9-350">Quando os dados são descartados, [**IDropTarget::D ROP**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) fornece o destino com um ponteiro para a interface [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) do objeto de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-350">When the data is dropped, [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) provides the target with a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface.</span></span> <span data-ttu-id="c48b9-351">Em seguida, o destino usa essa interface para extrair dados do objeto de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-351">The target then uses this interface to extract data from the data object.</span></span>

### <a name="extracting-shell-data-from-a-data-object"></a><span data-ttu-id="c48b9-352">Extraindo dados do Shell de um objeto de dados</span><span class="sxs-lookup"><span data-stu-id="c48b9-352">Extracting Shell Data from a Data Object</span></span>

<span data-ttu-id="c48b9-353">Depois que um objeto de dados for descartado ou recuperado da área de transferência, o destino poderá extrair os dados necessários.</span><span class="sxs-lookup"><span data-stu-id="c48b9-353">Once a data object has been dropped or retrieved from the Clipboard, the target can extract the data it needs.</span></span> <span data-ttu-id="c48b9-354">A primeira etapa no processo de extração costuma enumerar os formatos contidos no objeto de dados:</span><span class="sxs-lookup"><span data-stu-id="c48b9-354">The first step in the extraction process is typically to enumerate the formats contained by the data object:</span></span>

-   <span data-ttu-id="c48b9-355">Chame [**IDataObject:: EnumFormatEtc**](/windows/win32/api/objidl/nf-objidl-idataobject-enumformatetc).</span><span class="sxs-lookup"><span data-stu-id="c48b9-355">Call [**IDataObject::EnumFormatEtc**](/windows/win32/api/objidl/nf-objidl-idataobject-enumformatetc).</span></span> <span data-ttu-id="c48b9-356">O objeto de dados cria um objeto de enumeração OLE padrão e retorna um ponteiro para sua interface [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) .</span><span class="sxs-lookup"><span data-stu-id="c48b9-356">The data object creates a standard OLE enumeration object and returns a pointer to its [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) interface.</span></span>
-   <span data-ttu-id="c48b9-357">Use os métodos [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) para enumerar os formatos contidos pelo objeto de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-357">Use the [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) methods to enumerate the formats contained by the data object.</span></span> <span data-ttu-id="c48b9-358">Essa operação geralmente recupera uma estrutura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) para cada formato que o objeto contém.</span><span class="sxs-lookup"><span data-stu-id="c48b9-358">This operation usually retrieves one [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure for each format that the object contains.</span></span> <span data-ttu-id="c48b9-359">No entanto, o objeto de enumeração normalmente retorna apenas uma única estrutura **FORMATETC** para o formato [ \_ FileContent CFSTR](clipboard.md) , independentemente de quantos desses formatos estão contidos no objeto de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-359">However, the enumeration object normally returns only a single **FORMATETC** structure for the [CFSTR\_FILECONTENTS](clipboard.md) format, regardless of how many such formats are contained by the data object.</span></span>
-   <span data-ttu-id="c48b9-360">Selecione um ou mais formatos a serem extraídos e armazene suas estruturas [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) .</span><span class="sxs-lookup"><span data-stu-id="c48b9-360">Select one or more formats to be extracted, and store their [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structures.</span></span>

<span data-ttu-id="c48b9-361">Para recuperar um formato específico, passe a estrutura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) associada para [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata).</span><span class="sxs-lookup"><span data-stu-id="c48b9-361">To retrieve a particular format, pass the associated [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure to [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata).</span></span> <span data-ttu-id="c48b9-362">Esse método retorna uma estrutura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) que fornece acesso aos dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-362">This method returns an [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure that provides access to the data.</span></span> <span data-ttu-id="c48b9-363">Para especificar um mecanismo de transferência de dados específico, defina o valor **TYMED** da estrutura **FORMATETC** para o valor de TYMED \_ *xxx* correspondente.</span><span class="sxs-lookup"><span data-stu-id="c48b9-363">To specify a particular data transfer mechanism, set the **tymed** value of the **FORMATETC** structure to the corresponding TYMED\_*XXX* value.</span></span> <span data-ttu-id="c48b9-364">Para solicitar que o objeto de dados selecione um mecanismo de transferência de dados, o destino define os valores de TYMED \_ *xxx* para cada mecanismo de transferência de dados que o destino pode manipular.</span><span class="sxs-lookup"><span data-stu-id="c48b9-364">To ask the data object to select a data transfer mechanism, the target sets the TYMED\_*XXX* values for every data transfer mechanism that the target can handle.</span></span> <span data-ttu-id="c48b9-365">O objeto de dados seleciona um desses mecanismos de transferência de dados e retorna a estrutura **STGMEDIUM** apropriada.</span><span class="sxs-lookup"><span data-stu-id="c48b9-365">The data object selects one of these data transfer mechanisms and returns the appropriate **STGMEDIUM** structure.</span></span>

<span data-ttu-id="c48b9-366">Para a maioria dos formatos, o destino pode recuperar os dados, passando a estrutura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) que ele recebeu quando enumerou os formatos disponíveis.</span><span class="sxs-lookup"><span data-stu-id="c48b9-366">For most formats, the target can retrieve the data by passing the [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure that it received when it enumerated the available formats.</span></span> <span data-ttu-id="c48b9-367">Uma exceção a essa regra é o [CFSTR \_ FileContent](clipboard.md).</span><span class="sxs-lookup"><span data-stu-id="c48b9-367">One exception to this rule is [CFSTR\_FILECONTENTS](clipboard.md).</span></span> <span data-ttu-id="c48b9-368">Como um objeto de dados pode conter várias instâncias desse formato, a estrutura **FORMATETC** retornada pelo enumerador pode não corresponder ao formato específico que você deseja extrair.</span><span class="sxs-lookup"><span data-stu-id="c48b9-368">Because a data object can contain multiple instances of this format, the **FORMATETC** structure returned by the enumerator might not correspond to the particular format you want to extract.</span></span> <span data-ttu-id="c48b9-369">Além de especificar os membros **cfFormat** e **TYMED** , você também deve definir o membro **Lindex** como o valor de índice do arquivo.</span><span class="sxs-lookup"><span data-stu-id="c48b9-369">In addition to specifying the **cfFormat** and **tymed** members, you must also set the **lIndex** member to the file's index value.</span></span> <span data-ttu-id="c48b9-370">Para obter mais informações, consulte a seção *usando o \_ formato CFSTR filecontents para extrair dados de um arquivo* de [manipulação de cenários de transferência de dados do Shell](datascenarios.md)</span><span class="sxs-lookup"><span data-stu-id="c48b9-370">For further discussion, see the *Using the CFSTR\_FILECONTENTS Format to Extract Data from a File* section of [Handling Shell Data Transfer Scenarios](datascenarios.md)</span></span>

<span data-ttu-id="c48b9-371">O processo de extração de dados depende do tipo de ponteiro contido na estrutura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) retornada.</span><span class="sxs-lookup"><span data-stu-id="c48b9-371">The data extraction process depends on the type of pointer contained by the returned [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span> <span data-ttu-id="c48b9-372">Se a estrutura contiver um ponteiro para uma interface [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) ou [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) , use os métodos de interface para extrair os dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-372">If the structure contains a pointer to an [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) or [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) interface, use the interface methods to extract the data.</span></span> <span data-ttu-id="c48b9-373">O processo de extração de dados de um objeto de memória global é discutido na próxima seção.</span><span class="sxs-lookup"><span data-stu-id="c48b9-373">The process of extracting data from a global memory object is discussed in the next section.</span></span>

### <a name="extracting-a-global-memory-object-from-a-data-object"></a><span data-ttu-id="c48b9-374">Extraindo um objeto de memória global de um objeto de dados</span><span class="sxs-lookup"><span data-stu-id="c48b9-374">Extracting a global memory object from a data object</span></span>

<span data-ttu-id="c48b9-375">Muitos dos formatos de dados do Shell estão na forma de um objeto de memória global.</span><span class="sxs-lookup"><span data-stu-id="c48b9-375">Many of the Shell data formats are in the form of a global memory object.</span></span> <span data-ttu-id="c48b9-376">Use o procedimento a seguir para extrair um formato que contém um objeto de memória global de um objeto de dados e atribuir seus dados a uma variável local:</span><span class="sxs-lookup"><span data-stu-id="c48b9-376">Use the following procedure to extract a format containing a global memory object from a data object and assign its data to a local variable:</span></span>

1.  <span data-ttu-id="c48b9-377">Crie uma estrutura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) .</span><span class="sxs-lookup"><span data-stu-id="c48b9-377">Create a [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure.</span></span> <span data-ttu-id="c48b9-378">Defina o membro **cfFormat** como o valor apropriado de formato da área de transferência e o membro **TYMED** como TYMED \_ HGLOBAL.</span><span class="sxs-lookup"><span data-stu-id="c48b9-378">Set the **cfFormat** member to the appropriate clipboard format value and the **tymed** member to TYMED\_HGLOBAL.</span></span>
2.  <span data-ttu-id="c48b9-379">Crie uma estrutura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) vazia.</span><span class="sxs-lookup"><span data-stu-id="c48b9-379">Create an empty [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span>
3.  <span data-ttu-id="c48b9-380">Chame o [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata)e passe os ponteiros para as estruturas [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) e [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) .</span><span class="sxs-lookup"><span data-stu-id="c48b9-380">Call [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata), and pass in pointers to the [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) and [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structures.</span></span>

    <span data-ttu-id="c48b9-381">Quando [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) for retornado, a estrutura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) conterá um ponteiro para o objeto de memória global que contém os dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-381">When [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) returns, the [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure will contain a pointer to the global memory object that contains the data.</span></span>

4.  <span data-ttu-id="c48b9-382">Atribua os dados a uma variável local chamando [**GlobalLock**](/windows/win32/api/winbase/nf-winbase-globallock) e passando o membro **HGlobal** da estrutura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) .</span><span class="sxs-lookup"><span data-stu-id="c48b9-382">Assign the data to a local variable by calling [**GlobalLock**](/windows/win32/api/winbase/nf-winbase-globallock) and passing in the **hGlobal** member of the [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span>
5.  <span data-ttu-id="c48b9-383">Chame [**GlobalUnlock**](/windows/win32/api/winbase/nf-winbase-globalunlock) para liberar o bloqueio no objeto de memória global.</span><span class="sxs-lookup"><span data-stu-id="c48b9-383">Call [**GlobalUnlock**](/windows/win32/api/winbase/nf-winbase-globalunlock) to release the lock on the global memory object.</span></span>
6.  <span data-ttu-id="c48b9-384">Chame [**ReleaseStgMedium**](/windows/win32/api/ole2/nf-ole2-releasestgmedium) para liberar o objeto de memória global.</span><span class="sxs-lookup"><span data-stu-id="c48b9-384">Call [**ReleaseStgMedium**](/windows/win32/api/ole2/nf-ole2-releasestgmedium) to release the global memory object.</span></span>

> [!Note]  
> <span data-ttu-id="c48b9-385">Você deve usar [**ReleaseStgMedium**](/windows/win32/api/ole2/nf-ole2-releasestgmedium) para liberar o objeto de memória global, não [**GlobalFree**](/windows/win32/api/winbase/nf-winbase-globalfree).</span><span class="sxs-lookup"><span data-stu-id="c48b9-385">You must use [**ReleaseStgMedium**](/windows/win32/api/ole2/nf-ole2-releasestgmedium) to release the global memory object, not [**GlobalFree**](/windows/win32/api/winbase/nf-winbase-globalfree).</span></span>

 

<span data-ttu-id="c48b9-386">O exemplo a seguir mostra como extrair um valor **DWORD** armazenado como um objeto de memória global de um objeto de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-386">The following example shows how to extract a **DWORD** value stored as a global memory object from a data object.</span></span> <span data-ttu-id="c48b9-387">O parâmetro **pdtobj** é um ponteiro para a interface [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) do objeto de dados, **CF** é o formato da área de transferência que identifica os dados desejados e **pdwOut** é usado para retornar o valor dos dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-387">The **pdtobj** parameter is a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface, **cf** is the clipboard format that identifies the desired data, and **pdwOut** is used to return the data value.</span></span>


```C++
STDAPI DataObj_GetDWORD(IDataObject *pdtobj, UINT cf, DWORD *pdwOut)
{    STGMEDIUM medium;
   FORMATETC fmte = {(CLIPFORMAT) cf, NULL, DVASPECT_CONTENT, -1, 
       TYMED_HGLOBAL};
    HRESULT hres = pdtobj->GetData(&fmte, &medium);
    if (SUCCEEDED(hres))
   {
       DWORD *pdw = (DWORD *)GlobalLock(medium.hGlobal);
       if (pdw)
       {
           *pdwOut = *pdw;
           GlobalUnlock(medium.hGlobal);
       }
       else
       {
           hres = E_UNEXPECTED;
       }
       ReleaseStgMedium(&medium);
   }
   return hres;
}
```



### <a name="implementing-idroptarget"></a><span data-ttu-id="c48b9-388">Implementando IDropTarget</span><span class="sxs-lookup"><span data-stu-id="c48b9-388">Implementing IDropTarget</span></span>

<span data-ttu-id="c48b9-389">O sistema usa a interface [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) para se comunicar com o destino enquanto o cursor está sobre a janela de destino.</span><span class="sxs-lookup"><span data-stu-id="c48b9-389">The system uses the [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface to communicate with the target while the cursor is over the target window.</span></span> <span data-ttu-id="c48b9-390">As respostas do destino são encaminhadas para a origem por meio de sua interface [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) .</span><span class="sxs-lookup"><span data-stu-id="c48b9-390">The target's responses are forwarded to the source through its [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) interface.</span></span> <span data-ttu-id="c48b9-391">Dependendo da resposta, a origem pode modificar o ícone que representa os dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-391">Depending on the response, the source can modify the icon that represents the data.</span></span> <span data-ttu-id="c48b9-392">Se o destino de soltura precisar especificar o ícone de dados, ele poderá fazer isso criando um [objeto auxiliar de arrastar e soltar](#using-the-drag-and-drop-helper-object).</span><span class="sxs-lookup"><span data-stu-id="c48b9-392">If the drop target needs to specify the data icon, it can do so by creating a [drag-and-drop helper object](#using-the-drag-and-drop-helper-object).</span></span>

<span data-ttu-id="c48b9-393">Com as operações do tipo "arrastar e soltar" convencionais, o destino informa o objeto de dados do resultado da operação definindo o parâmetro *pdwEffect* de [**IDropTarget::D ROP**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) para o valor [**DROPEFFECT**](../com/dropeffect-constants.md) apropriado.</span><span class="sxs-lookup"><span data-stu-id="c48b9-393">With conventional drag-and-drop operations, the target informs the data object of the outcome of the operation by setting the *pdwEffect* parameter of [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) to the appropriate [**DROPEFFECT**](../com/dropeffect-constants.md) value.</span></span> <span data-ttu-id="c48b9-394">Com os objetos de dados do Shell, o destino também pode precisar chamar [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata).</span><span class="sxs-lookup"><span data-stu-id="c48b9-394">With Shell data objects, the target might also need to call [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata).</span></span> <span data-ttu-id="c48b9-395">Para obter uma discussão de como os destinos devem responder a diferentes cenários de transferência de dados, consulte [manipulando cenários de transferência de dados do Shell](datascenarios.md).</span><span class="sxs-lookup"><span data-stu-id="c48b9-395">For a discussion of how targets should respond for different data transfer scenarios, see [Handling Shell Data Transfer Scenarios](datascenarios.md).</span></span>

<span data-ttu-id="c48b9-396">As seções a seguir discutem brevemente como implementar os métodos [**IDropTarget::D ragenter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter), [**IDropTarget::D ragover**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover)e [**IDropTarget::D ROP**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) .</span><span class="sxs-lookup"><span data-stu-id="c48b9-396">The following sections briefly discuss how to implement the [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter), [**IDropTarget::DragOver**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover), and [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) methods.</span></span> <span data-ttu-id="c48b9-397">Para obter mais detalhes, consulte a documentação de referência.</span><span class="sxs-lookup"><span data-stu-id="c48b9-397">For further details, see the reference documentation.</span></span>

### <a name="dragenter-method"></a><span data-ttu-id="c48b9-398">Método DragEnter</span><span class="sxs-lookup"><span data-stu-id="c48b9-398">DragEnter method</span></span>

<span data-ttu-id="c48b9-399">O sistema chama o método [**IDropTarget::D ragenter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) quando o cursor entra na janela de destino.</span><span class="sxs-lookup"><span data-stu-id="c48b9-399">The system calls the [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) method when the cursor enters the target window.</span></span> <span data-ttu-id="c48b9-400">Seus parâmetros fornecem o destino com o local do cursor, o estado das teclas modificadoras de teclado, como a tecla CTRL, e um ponteiro para a interface [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) do objeto de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-400">Its parameters provide the target with the location of the cursor, the state of keyboard modifier keys such as the CTRL key, and a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface.</span></span> <span data-ttu-id="c48b9-401">O destino é responsável por usar essa interface para determinar se ela pode aceitar qualquer um dos formatos contidos no objeto de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-401">The target is responsible for using that interface to determine whether it can accept any of the formats contained by the data object.</span></span> <span data-ttu-id="c48b9-402">Se puder, normalmente deixa o valor de *pdwEffect* inalterado.</span><span class="sxs-lookup"><span data-stu-id="c48b9-402">If it can, it normally leaves the value of *pdwEffect* unchanged.</span></span> <span data-ttu-id="c48b9-403">Se ele não puder aceitar nenhum dado do objeto de dados, ele definirá o parâmetro *pdwEffect* como DROPEFFECT \_ None.</span><span class="sxs-lookup"><span data-stu-id="c48b9-403">If it cannot accept any data from the data object, it sets the *pdwEffect* parameter to DROPEFFECT\_NONE.</span></span> <span data-ttu-id="c48b9-404">O sistema passa o valor desse parâmetro para a interface [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) do objeto de dados para permitir que ele exiba a imagem de arrastar apropriada.</span><span class="sxs-lookup"><span data-stu-id="c48b9-404">The system passes the value of this parameter to the data object's [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) interface to allow it to display the appropriate drag image.</span></span>

<span data-ttu-id="c48b9-405">Os destinos não devem usar o método [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) para renderizar dados do Shell antes de serem descartados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-405">Targets should not use the [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) method to render Shell data before it has been dropped.</span></span> <span data-ttu-id="c48b9-406">A renderização total dos dados do objeto para cada ocorrência desse tipo pode causar a parada do cursor de arrasto.</span><span class="sxs-lookup"><span data-stu-id="c48b9-406">Fully rendering the object's data for each such occurrence might cause the drag cursor to stall.</span></span> <span data-ttu-id="c48b9-407">Para evitar esse problema, alguns objetos shell contêm um formato [CFSTR \_ INDRAGLOOP](clipboard.md) .</span><span class="sxs-lookup"><span data-stu-id="c48b9-407">To avoid this problem, some Shell objects contain a [CFSTR\_INDRAGLOOP](clipboard.md) format.</span></span> <span data-ttu-id="c48b9-408">Ao extrair esse formato, os destinos podem verificar o status do loop de arrastar enquanto evitam o processamento intensivo de memória dos dados do objeto.</span><span class="sxs-lookup"><span data-stu-id="c48b9-408">By extracting this format, targets can check the status of the drag loop while avoiding memory intensive rendering of the object's data.</span></span> <span data-ttu-id="c48b9-409">O valor de dados do formato é um **DWORD** que é definido como um valor diferente de zero se o objeto de dados estiver dentro de um loop de arrastar.</span><span class="sxs-lookup"><span data-stu-id="c48b9-409">The format's data value is a **DWORD** that is set to a nonzero value if the data object is within a drag loop.</span></span> <span data-ttu-id="c48b9-410">O valor de dados do formato será definido como zero se os dados tiverem sido descartados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-410">The format's data value is set to zero if the data has been dropped.</span></span>

<span data-ttu-id="c48b9-411">Se o destino puder aceitar dados do objeto de dados, ele deverá examinar **grfKeyState** para determinar se as teclas modificadoras foram pressionadas para modificar o comportamento de remoção normal.</span><span class="sxs-lookup"><span data-stu-id="c48b9-411">If the target can accept data from the data object, it should examine **grfKeyState** to determine whether any modifier keys have been pressed to modify the normal drop behavior.</span></span> <span data-ttu-id="c48b9-412">Por exemplo, a operação padrão é normalmente uma movimentação, mas a remoção da tecla CTRL geralmente indica uma operação de cópia.</span><span class="sxs-lookup"><span data-stu-id="c48b9-412">For instance, the default operation is typically a move, but depressing the CTRL key usually indicates a copy operation.</span></span>

<span data-ttu-id="c48b9-413">Enquanto o cursor está sobre a janela de destino, o destino pode usar o objeto auxiliar do tipo " [arrastar e soltar](#using-the-drag-and-drop-helper-object) " para substituir a imagem de arrastar do objeto de dados por sua própria.</span><span class="sxs-lookup"><span data-stu-id="c48b9-413">While the cursor is over the target window, the target can use the [drag-and-drop helper object](#using-the-drag-and-drop-helper-object) to replace the data object's drag image with its own.</span></span> <span data-ttu-id="c48b9-414">Nesse caso, [**IDropTarget::D ragenter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) deve chamar [**IDropTargetHelper::D ragenter**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragenter) para passar as informações contidas nos parâmetros *DragEnter* para o objeto auxiliar do tipo "arrastar e soltar".</span><span class="sxs-lookup"><span data-stu-id="c48b9-414">If so, [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) should call [**IDropTargetHelper::DragEnter**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragenter) to pass the information contained in the *DragEnter* parameters to the drag-and-drop helper object.</span></span>

### <a name="dragover-method"></a><span data-ttu-id="c48b9-415">Método DragOver</span><span class="sxs-lookup"><span data-stu-id="c48b9-415">DragOver method</span></span>

<span data-ttu-id="c48b9-416">À medida que o cursor se move dentro da janela de destino, o sistema chama periodicamente o método [**IDropTarget::D ragover**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) .</span><span class="sxs-lookup"><span data-stu-id="c48b9-416">As the cursor moves within the target window, the system periodically calls the [**IDropTarget::DragOver**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) method.</span></span> <span data-ttu-id="c48b9-417">Seus parâmetros fornecem o destino com o local do cursor e o estado das teclas modificadoras de teclado, como a tecla CTRL.</span><span class="sxs-lookup"><span data-stu-id="c48b9-417">Its parameters provide the target with the location of the cursor and the state of keyboard modifier keys such as the CTRL key.</span></span> <span data-ttu-id="c48b9-418">**IDropTarget::D ragover** tem muito as mesmas responsabilidades que o [**IDropTarget::D ragenter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter), e as implementações são geralmente muito semelhantes.</span><span class="sxs-lookup"><span data-stu-id="c48b9-418">**IDropTarget::DragOver** has much the same responsibilities as [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter), and the implementations are usually very similar.</span></span>

<span data-ttu-id="c48b9-419">Se o destino estiver usando o objeto auxiliar de arrastar e soltar, [**IDropTarget::D ragover**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) deverá chamar [**IDropTargetHelper::D ragover**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover) para encaminhar as informações contidas nos parâmetros *DragOver* para o objeto auxiliar do tipo "arrastar e soltar".</span><span class="sxs-lookup"><span data-stu-id="c48b9-419">If the target is using the drag-and-drop helper object, [**IDropTarget::DragOver**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) should call [**IDropTargetHelper::DragOver**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover) to forward the information contained in the *DragOver* parameters to the drag-and-drop helper object.</span></span>

### <a name="drop-method"></a><span data-ttu-id="c48b9-420">Método Drop</span><span class="sxs-lookup"><span data-stu-id="c48b9-420">Drop method</span></span>

<span data-ttu-id="c48b9-421">O sistema chama o método [**IDropTarget::D ROP**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) para notificar o destino de que o usuário removeu os dados, normalmente liberando o botão do mouse.</span><span class="sxs-lookup"><span data-stu-id="c48b9-421">The system calls the [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) method to notify the target that the user has dropped the data, typically by releasing the mouse button.</span></span> <span data-ttu-id="c48b9-422">**IDropTarget::D ROP** tem os mesmos parâmetros que [**IDropTarget::D ragenter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter).</span><span class="sxs-lookup"><span data-stu-id="c48b9-422">**IDropTarget::Drop** has the same parameters as [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter).</span></span> <span data-ttu-id="c48b9-423">O destino normalmente responde extraindo um ou mais formatos do objeto de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-423">The target normally responds by extracting one or more formats from the data object.</span></span> <span data-ttu-id="c48b9-424">Quando terminar, o destino deve definir o parâmetro *pdwEffect* para um valor [**DROPEFFECT**](../com/dropeffect-constants.md) que indica o resultado da operação.</span><span class="sxs-lookup"><span data-stu-id="c48b9-424">When finished, the target should set the *pdwEffect* parameter to a [**DROPEFFECT**](../com/dropeffect-constants.md) value that indicates the outcome of the operation.</span></span> <span data-ttu-id="c48b9-425">Para alguns tipos de transferência de dados do Shell, o destino também deve chamar [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) para passar um formato com informações adicionais sobre o resultado da operação para o objeto de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-425">For some types of Shell data transfer, the target must also call [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) to pass a format with additional information on the outcome of the operation to the data object.</span></span> <span data-ttu-id="c48b9-426">Para obter uma discussão detalhada, consulte [manipulando cenários de transferência de dados do Shell](datascenarios.md).</span><span class="sxs-lookup"><span data-stu-id="c48b9-426">For a detailed discussion, see [Handling Shell Data Transfer Scenarios](datascenarios.md).</span></span>

<span data-ttu-id="c48b9-427">Se o destino estiver usando o objeto auxiliar do tipo "arrastar e soltar", [**IDropTarget::D ROP**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) deverá chamar [**IDropTargetHelper::D ROP**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-drop) para encaminhar as informações contidas nos parâmetros [**IDropTargetHelper::D ragover**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover) para o objeto auxiliar do tipo "arrastar e soltar".</span><span class="sxs-lookup"><span data-stu-id="c48b9-427">If the target is using the drag-and-drop helper object, [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) should call [**IDropTargetHelper::Drop**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-drop) to forward the information contained in the [**IDropTargetHelper::DragOver**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover) parameters to the drag-and-drop helper object.</span></span>

## <a name="using-the-drag-and-drop-helper-object"></a><span data-ttu-id="c48b9-428">Usando o objeto auxiliar do tipo "arrastar e soltar"</span><span class="sxs-lookup"><span data-stu-id="c48b9-428">Using the Drag-and-Drop Helper Object</span></span>

<span data-ttu-id="c48b9-429">O objeto auxiliar do tipo "arrastar e soltar" (CLSID \_ DragDropHelper) é exportado pelo shell para permitir que os destinos especifiquem a imagem de arrastar enquanto ela está sobre a janela de destino.</span><span class="sxs-lookup"><span data-stu-id="c48b9-429">The drag-and-drop helper object (CLSID\_DragDropHelper) is exported by the Shell to allow targets to specify the drag image while it is over the target window.</span></span> <span data-ttu-id="c48b9-430">Para usar o objeto auxiliar do tipo "arrastar e soltar", crie um objeto de servidor em processo chamando [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) com um identificador de classe (CLSID) de CLSID \_ DragDropHelper.</span><span class="sxs-lookup"><span data-stu-id="c48b9-430">To use the drag-and-drop helper object, create an in-process server object by calling [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) with a class identifier (CLSID) of CLSID\_DragDropHelper.</span></span> <span data-ttu-id="c48b9-431">O objeto auxiliar do tipo "arrastar e soltar" expõe duas interfaces que são usadas da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="c48b9-431">The drag-and-drop helper object exposes two interfaces that are used in the following way:</span></span>

-   <span data-ttu-id="c48b9-432">A interface [**IDragSourceHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idragsourcehelper) permite que o destino drop especifique um ícone para representar o objeto de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-432">The [**IDragSourceHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idragsourcehelper) interface allows the drop target to specify an icon to represent the data object.</span></span>
-   <span data-ttu-id="c48b9-433">A interface [**IDropTargetHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) permite que o destino drop informe o objeto auxiliar do tipo "arrastar e soltar" do local do cursor e mostre ou oculte o ícone de dados.</span><span class="sxs-lookup"><span data-stu-id="c48b9-433">The [**IDropTargetHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) interface allows the drop target to inform the drag-and-drop helper object of the cursor location, and to show or hide the data icon.</span></span>

### <a name="using-the-idragsourcehelper-interface"></a><span data-ttu-id="c48b9-434">Usando a interface IDragSourceHelper</span><span class="sxs-lookup"><span data-stu-id="c48b9-434">Using the IDragSourceHelper Interface</span></span>

<span data-ttu-id="c48b9-435">A interface [**IDragSourceHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idragsourcehelper) é exposta pelo objeto auxiliar do tipo "arrastar e soltar" para permitir que um destino de soltura forneça a imagem que será exibida enquanto o cursor estiver sobre a janela de destino.</span><span class="sxs-lookup"><span data-stu-id="c48b9-435">The [**IDragSourceHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idragsourcehelper) interface is exposed by the drag-and-drop helper object to allow a drop target to provide the image that will be displayed while the cursor is over the target window.</span></span> <span data-ttu-id="c48b9-436">O **IDragSourceHelper** fornece duas maneiras alternativas de especificar o bitmap a ser usado como uma imagem de arrastar:</span><span class="sxs-lookup"><span data-stu-id="c48b9-436">**IDragSourceHelper** provides two alternative ways to specify the bitmap to be used as a drag image:</span></span>

-   <span data-ttu-id="c48b9-437">Os destinos de destino que têm uma janela podem registrar uma \_ mensagem de janela di GETDRAGIMAGE para ele inicializando o objeto auxiliar do tipo "arrastar e soltar" com [**IDragSourceHelper:: InitializeFromWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idragsourcehelper-initializefromwindow).</span><span class="sxs-lookup"><span data-stu-id="c48b9-437">Drop targets that have a window can register a DI\_GETDRAGIMAGE window message for it by initializing the drag-and-drop helper object with [**IDragSourceHelper::InitializeFromWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idragsourcehelper-initializefromwindow).</span></span> <span data-ttu-id="c48b9-438">Quando o destino recebe uma mensagem de DI \_ GETDRAGIMAGE, o manipulador coloca as informações de bitmap de imagem de arrastar na estrutura [**SHDRAGIMAGE**](/windows/desktop/api/Shobjidl_core/ns-shobjidl_core-shdragimage) que é passada como o valor de *lParam* da mensagem.</span><span class="sxs-lookup"><span data-stu-id="c48b9-438">When the target receives a DI\_GETDRAGIMAGE message, the handler puts the drag image bitmap information in the [**SHDRAGIMAGE**](/windows/desktop/api/Shobjidl_core/ns-shobjidl_core-shdragimage) structure that is passed as the message's *lParam* value.</span></span>
-   <span data-ttu-id="c48b9-439">Os destinos de soltar sem janela especificam um bitmap quando inicializam o objeto auxiliar do tipo "arrastar e soltar" com [**IDragSourceHelper:: InitializeFromBitmap**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idragsourcehelper-initializefrombitmap).</span><span class="sxs-lookup"><span data-stu-id="c48b9-439">Windowless drop targets specify a bitmap when they initialize the drag-and-drop helper object with [**IDragSourceHelper::InitializeFromBitmap**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idragsourcehelper-initializefrombitmap).</span></span>

### <a name="using-the-idroptargethelper-interface"></a><span data-ttu-id="c48b9-440">Usando a interface IDropTargetHelper</span><span class="sxs-lookup"><span data-stu-id="c48b9-440">Using the IDropTargetHelper Interface</span></span>

<span data-ttu-id="c48b9-441">Essa interface permite que o destino de soltura notifique o objeto auxiliar do tipo "arrastar e soltar" quando o cursor entra ou sai do destino.</span><span class="sxs-lookup"><span data-stu-id="c48b9-441">This interface allows the drop target to notify the drag-and-drop helper object when the cursor enters or leaves the target.</span></span> <span data-ttu-id="c48b9-442">Enquanto o cursor está sobre a janela de destino, [**IDropTargetHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) permite que o destino dê ao objeto auxiliar do tipo "arrastar e soltar" as informações que o destino recebe por meio de sua interface [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) .</span><span class="sxs-lookup"><span data-stu-id="c48b9-442">While the cursor is over the target window, [**IDropTargetHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) allows the target to give the drag-and-drop helper object the information that the target receives through its [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface.</span></span>

<span data-ttu-id="c48b9-443">Quatro dos métodos [**IDropTargetHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) —[**IDropTargetHelper::D ragenter**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragenter), [**IDropTargetHelper::D Ragleave**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragleave), [**IDropTargetHelper::D ragover**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover)e [**IDropTargetHelper::D ROP**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-drop)— estão associados ao método [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) do mesmo nome.</span><span class="sxs-lookup"><span data-stu-id="c48b9-443">Four of the [**IDropTargetHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) methods—[**IDropTargetHelper::DragEnter**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragenter), [**IDropTargetHelper::DragLeave**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragleave), [**IDropTargetHelper::DragOver**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover), and [**IDropTargetHelper::Drop**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-drop)—are associated with the [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) method of the same name.</span></span> <span data-ttu-id="c48b9-444">Para usar o objeto auxiliar do tipo "arrastar e soltar", cada um dos métodos **IDropTarget** deve chamar o método **IDropTargetHelper** correspondente para encaminhar as informações para o objeto auxiliar do tipo "arrastar e soltar".</span><span class="sxs-lookup"><span data-stu-id="c48b9-444">To use the drag-and-drop helper object, each of the **IDropTarget** methods should call the corresponding **IDropTargetHelper** method to forward the information to the drag-and-drop helper object.</span></span> <span data-ttu-id="c48b9-445">O quinto método **IDropTargetHelper** , [**IDropTargetHelper:: show**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-show), notifica o objeto auxiliar de arrastar e soltar para mostrar ou ocultar a imagem de arrastar.</span><span class="sxs-lookup"><span data-stu-id="c48b9-445">The fifth **IDropTargetHelper** method, [**IDropTargetHelper::Show**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-show), notifies the drag-and-drop helper object to show or hide the drag image.</span></span> <span data-ttu-id="c48b9-446">Esse método é usado ao arrastar uma janela de destino em um modo de vídeo de intensidade de cor baixo.</span><span class="sxs-lookup"><span data-stu-id="c48b9-446">This method is used when dragging over a target window in a low color-depth video mode.</span></span> <span data-ttu-id="c48b9-447">Ele permite que o destino oculte a imagem de arrastar enquanto está pintando a janela.</span><span class="sxs-lookup"><span data-stu-id="c48b9-447">It allows the target to hide the drag image while it is painting the window.</span></span>

 

 
