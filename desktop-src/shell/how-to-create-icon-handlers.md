---
description: Descreve como criar um manipulador para atribuições de ícone personalizado.
ms.assetid: 23ed3a21-cf62-4440-b983-fae23aa56890
title: Como criar manipuladores de ícone
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e2c620b6f6a4c05f8996a26c8365e4f4201ee0b4
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104967912"
---
# <a name="how-to-create-icon-handlers"></a><span data-ttu-id="3fb24-103">Como criar manipuladores de ícone</span><span class="sxs-lookup"><span data-stu-id="3fb24-103">How to Create Icon Handlers</span></span>

<span data-ttu-id="3fb24-104">Um [tipo de arquivo](fa-file-types.md) geralmente tem um ícone personalizado associado a ele, para tornar seus membros facilmente reconhecíveis no Windows Explorer.</span><span class="sxs-lookup"><span data-stu-id="3fb24-104">A [file type](fa-file-types.md) often has a custom icon associated with it, to make its members easily recognizable in Windows Explorer.</span></span> <span data-ttu-id="3fb24-105">A maneira mais simples de atribuir um ícone personalizado a um tipo de arquivo é registrar o arquivo do ícone.</span><span class="sxs-lookup"><span data-stu-id="3fb24-105">The simplest way to assign a custom icon to a file type is to register the icon's file.</span></span> <span data-ttu-id="3fb24-106">No entanto, um ícone registrado dessa maneira será o mesmo para todos os membros do tipo de arquivo.</span><span class="sxs-lookup"><span data-stu-id="3fb24-106">However, an icon registered in this way will be the same for all members of the file type.</span></span> <span data-ttu-id="3fb24-107">Você pode ter muito mais flexibilidade para atribuir ícones aos membros do tipo de arquivo implementando um *manipulador de ícones*.</span><span class="sxs-lookup"><span data-stu-id="3fb24-107">You can have much more flexibility in assigning icons to the members of the file type by implementing an *icon handler*.</span></span>

<span data-ttu-id="3fb24-108">Um manipulador de ícones é um tipo de manipulador de extensão de shell que permite atribuir ícones dinamicamente aos membros de um tipo de arquivo.</span><span class="sxs-lookup"><span data-stu-id="3fb24-108">An icon handler is a type of Shell extension handler that allows you to dynamically assign icons to the members of a file type.</span></span> <span data-ttu-id="3fb24-109">Toda vez que um arquivo do tipo é exibido, o Shell consulta o manipulador para o ícone apropriado.</span><span class="sxs-lookup"><span data-stu-id="3fb24-109">Every time a file of the type is displayed, the Shell queries the handler for the appropriate icon.</span></span> <span data-ttu-id="3fb24-110">Por exemplo, um manipulador de ícones pode atribuir ícones diferentes a diferentes membros do tipo de arquivo ou variar o ícone com base no estado atual do arquivo.</span><span class="sxs-lookup"><span data-stu-id="3fb24-110">For instance, an icon handler can assign different icons to different members of the file type, or vary the icon based on the current state of the file.</span></span>

<span data-ttu-id="3fb24-111">Os procedimentos gerais para implementar e registrar um manipulador de extensão de shell são discutidos na [criação de manipuladores de extensão de shell](handlers.md).</span><span class="sxs-lookup"><span data-stu-id="3fb24-111">The general procedures for implementing and registering a Shell extension handler are discussed in [Creating Shell Extension Handlers](handlers.md).</span></span> <span data-ttu-id="3fb24-112">Este documento se concentra nesses aspectos da implementação que são específicos para manipuladores de ícones.</span><span class="sxs-lookup"><span data-stu-id="3fb24-112">This document focuses on those aspects of implementation that are specific to icon handlers.</span></span>

-   [<span data-ttu-id="3fb24-113">Implementando manipuladores de ícone</span><span class="sxs-lookup"><span data-stu-id="3fb24-113">Implementing Icon Handlers</span></span>](#step-1-implementing-icon-handlers)
-   [<span data-ttu-id="3fb24-114">Implementando a interface IExtractIcon</span><span class="sxs-lookup"><span data-stu-id="3fb24-114">Implementing the IExtractIcon Interface</span></span>](#step-2-implementing-the-iextracticon-interface)
-   [<span data-ttu-id="3fb24-115">Registrando manipuladores de ícone</span><span class="sxs-lookup"><span data-stu-id="3fb24-115">Registering Icon Handlers</span></span>](#step-3-registering-icon-handlers)
-   [<span data-ttu-id="3fb24-116">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="3fb24-116">Related topics</span></span>](#related-topics)

## <a name="instructions"></a><span data-ttu-id="3fb24-117">Instruções</span><span class="sxs-lookup"><span data-stu-id="3fb24-117">Instructions</span></span>

### <a name="step-1-implementing-icon-handlers"></a><span data-ttu-id="3fb24-118">Etapa 1: implementando manipuladores de ícone</span><span class="sxs-lookup"><span data-stu-id="3fb24-118">Step 1: Implementing Icon Handlers</span></span>

<span data-ttu-id="3fb24-119">Como todos os manipuladores de extensão do Shell, os manipuladores de ícone são objetos COM (Component Object Model) em processo implementados como DLLs.</span><span class="sxs-lookup"><span data-stu-id="3fb24-119">Like all Shell extension handlers, icon handlers are in-process Component Object Model (COM) objects implemented as DLLs.</span></span> <span data-ttu-id="3fb24-120">Eles devem exportar duas interfaces além de [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown): [**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile) e [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona).</span><span class="sxs-lookup"><span data-stu-id="3fb24-120">They must export two interfaces in addition to [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown): [**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile) and [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona).</span></span>

<span data-ttu-id="3fb24-121">O Shell Inicializa o manipulador por meio de sua interface [**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile) .</span><span class="sxs-lookup"><span data-stu-id="3fb24-121">The Shell initializes the handler through its [**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile) interface.</span></span> <span data-ttu-id="3fb24-122">Ele usa essa interface para solicitar o identificador de classe do manipulador (CLSID) e fornece o nome do arquivo.</span><span class="sxs-lookup"><span data-stu-id="3fb24-122">It uses this interface to request the handler's class identifier (CLSID) and provides it with the file's name.</span></span> <span data-ttu-id="3fb24-123">O restante da operação ocorre por meio da interface [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona) .</span><span class="sxs-lookup"><span data-stu-id="3fb24-123">The rest of the operation takes place through the [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona) interface.</span></span> <span data-ttu-id="3fb24-124">Para obter uma discussão geral sobre como implementar manipuladores de extensão de Shell, incluindo a interface **IPersistFile** , consulte [criando manipuladores de extensão de shell](handlers.md).</span><span class="sxs-lookup"><span data-stu-id="3fb24-124">For a general discussion of how to implement Shell extension handlers, including the **IPersistFile** interface, see [Creating Shell Extension Handlers](handlers.md).</span></span> <span data-ttu-id="3fb24-125">O restante deste documento discute como implementar a interface **IExtractIcon** .</span><span class="sxs-lookup"><span data-stu-id="3fb24-125">The remainder of this document discusses how to implement the **IExtractIcon** interface.</span></span>

### <a name="step-2-implementing-the-iextracticon-interface"></a><span data-ttu-id="3fb24-126">Etapa 2: implementando a interface IExtractIcon</span><span class="sxs-lookup"><span data-stu-id="3fb24-126">Step 2: Implementing the IExtractIcon Interface</span></span>

<span data-ttu-id="3fb24-127">Depois que a interface é inicializada, o Shell usa a interface [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona) do manipulador para solicitar o ícone apropriado.</span><span class="sxs-lookup"><span data-stu-id="3fb24-127">After the interface is initialized, the Shell uses the handler's [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona) interface to request the appropriate icon.</span></span> <span data-ttu-id="3fb24-128">A interface tem dois métodos: [**IExtractIcon:: GetIconLocation**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-geticonlocation) e [**IExtractIcon:: Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract).</span><span class="sxs-lookup"><span data-stu-id="3fb24-128">The interface has two methods: [**IExtractIcon::GetIconLocation**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-geticonlocation) and [**IExtractIcon::Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract).</span></span>

<span data-ttu-id="3fb24-129">Os ícones são identificados por sua localização no sistema de arquivos.</span><span class="sxs-lookup"><span data-stu-id="3fb24-129">Icons are identified by their location in the file system.</span></span> <span data-ttu-id="3fb24-130">O método [**IExtractIcon:: GetIconLocation**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-geticonlocation) é chamado para solicitar essas informações.</span><span class="sxs-lookup"><span data-stu-id="3fb24-130">The [**IExtractIcon::GetIconLocation**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-geticonlocation) method is called to request this information.</span></span> <span data-ttu-id="3fb24-131">Defina o parâmetro *szIconFile* como o nome do arquivo.</span><span class="sxs-lookup"><span data-stu-id="3fb24-131">Set the *szIconFile* parameter to the file name.</span></span> <span data-ttu-id="3fb24-132">Se houver mais de um ícone no arquivo, defina *piIndex* como o índice do ícone.</span><span class="sxs-lookup"><span data-stu-id="3fb24-132">If there is more than one icon in the file, set *piIndex* to the icon's index.</span></span> <span data-ttu-id="3fb24-133">Atribua valores apropriados às duas variáveis de sinalizador.</span><span class="sxs-lookup"><span data-stu-id="3fb24-133">Assign appropriate values to the two flag variables.</span></span> <span data-ttu-id="3fb24-134">Se você não quiser especificar um nome de arquivo ou se não quiser que o Shell Extraia o ícone, defina o sinalizador Gil não **\_ filename** no parâmetro *pwFlags* .</span><span class="sxs-lookup"><span data-stu-id="3fb24-134">If you do not want to specify a file name, or if you do not want the Shell to extract the icon, set the **GIL\_NOTFILENAME** flag in the *pwFlags* parameter.</span></span> <span data-ttu-id="3fb24-135">Você não precisa atribuir um valor a *szIconFile*, mas o manipulador deve fornecer identificadores de ícone quando o Shell chama [**IExtractIcon:: Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract).</span><span class="sxs-lookup"><span data-stu-id="3fb24-135">You do not need to assign a value to *szIconFile*, but the handler must provide icon handles when the Shell calls [**IExtractIcon::Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract).</span></span>

<span data-ttu-id="3fb24-136">Se você retornar um nome de arquivo, o Shell normalmente tentará carregar o ícone de seu cache.</span><span class="sxs-lookup"><span data-stu-id="3fb24-136">If you return a file name, the Shell normally attempts to load the icon from its cache.</span></span> <span data-ttu-id="3fb24-137">Para evitar o carregamento de um ícone armazenado em cache, defina o sinalizador **Gil \_ DONTCACHE** no parâmetro *pwFlags* .</span><span class="sxs-lookup"><span data-stu-id="3fb24-137">To prevent the loading of a cached icon, set the **GIL\_DONTCACHE** flag in the *pwFlags* parameter.</span></span> <span data-ttu-id="3fb24-138">Se um ícone armazenado em cache não for carregado, o Shell chamará [**IExtractIcon:: Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract) para solicitar o identificador de ícone.</span><span class="sxs-lookup"><span data-stu-id="3fb24-138">If a cached icon is not loaded, the Shell then calls [**IExtractIcon::Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract) to request the icon handle.</span></span>

<span data-ttu-id="3fb24-139">Se um arquivo e um índice forem especificados por [**IExtractIcon:: GetIconLocation**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-geticonlocation), eles serão passados para [**IExtractIcon:: Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract) nos parâmetros *pszFile* e *nIconIndex* , respectivamente.</span><span class="sxs-lookup"><span data-stu-id="3fb24-139">If a file and index were specified by [**IExtractIcon::GetIconLocation**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-geticonlocation), they are passed to [**IExtractIcon::Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract) in the *pszFile* and *nIconIndex* parameters, respectively.</span></span> <span data-ttu-id="3fb24-140">Se um nome de arquivo for fornecido, o manipulador poderá retornar S \_ false para que o Shell Extraia o ícone.</span><span class="sxs-lookup"><span data-stu-id="3fb24-140">If a file name is provided, your handler can return S\_FALSE to have the Shell extract the icon.</span></span> <span data-ttu-id="3fb24-141">Caso contrário, seu manipulador deve extrair ou produzir ícones grandes e pequenos e atribuir seus identificadores HICON aos parâmetros *phiconLarge* e *phiconSmall* .</span><span class="sxs-lookup"><span data-stu-id="3fb24-141">Otherwise, your handler must extract or otherwise produce large and small icons, and assign their HICON handles to the *phiconLarge* and *phiconSmall* parameters.</span></span> <span data-ttu-id="3fb24-142">O Shell adiciona os ícones ao seu cache para agilizar chamadas subsequentes para o manipulador.</span><span class="sxs-lookup"><span data-stu-id="3fb24-142">The Shell adds the icons to its cache to expedite subsequent calls to the handler.</span></span>

### <a name="step-3-registering-icon-handlers"></a><span data-ttu-id="3fb24-143">Etapa 3: Registrando manipuladores de ícone</span><span class="sxs-lookup"><span data-stu-id="3fb24-143">Step 3: Registering Icon Handlers</span></span>

<span data-ttu-id="3fb24-144">Ao [registrar estaticamente um ícone](icon.md) para um tipo de [arquivo](fa-file-types.md), você cria uma subchave **DefaultIcon** sob o ProgID para o tipo de arquivo.</span><span class="sxs-lookup"><span data-stu-id="3fb24-144">When you [statically register an icon](icon.md) for a [file type](fa-file-types.md), you create a **DefaultIcon** subkey under the ProgID for the file type.</span></span> <span data-ttu-id="3fb24-145">Seu valor padrão é definido como o arquivo que contém o ícone.</span><span class="sxs-lookup"><span data-stu-id="3fb24-145">Its default value is set to the file that contains the icon.</span></span> <span data-ttu-id="3fb24-146">Para registrar um manipulador de ícones, você ainda deve ter a subchave **DefaultIcon** , mas seu valor padrão deve ser definido como "%1".</span><span class="sxs-lookup"><span data-stu-id="3fb24-146">To register an icon handler, you must still have the **DefaultIcon** subkey, but its default value must be set to "%1".</span></span> <span data-ttu-id="3fb24-147">Adicione uma subchave **IconHandler** à subchave **shellex** da subchave ProgID e defina seu valor padrão como a forma de cadeia de caracteres do GUID CLSID do manipulador.</span><span class="sxs-lookup"><span data-stu-id="3fb24-147">Add an **IconHandler** subkey to the **Shellex** subkey of the ProgID subkey, and set its default value to the string form of the handler's CLSID GUID.</span></span> <span data-ttu-id="3fb24-148">Para obter uma discussão geral sobre como registrar manipuladores de extensão de Shell, consulte [criando manipuladores de extensão de shell](handlers.md).</span><span class="sxs-lookup"><span data-stu-id="3fb24-148">For a general discussion of how to register Shell extension handlers, see [Creating Shell Extension Handlers](handlers.md).</span></span>

<span data-ttu-id="3fb24-149">O exemplo a seguir modifica a entrada do registro de [personalização de ícones](icon.md) para que o tipo de arquivo. MYP agora use um manipulador de menu de atalho em vez de um ícone estaticamente definido.</span><span class="sxs-lookup"><span data-stu-id="3fb24-149">The following example modifies the registry entry from [Customizing Icons](icon.md) so that the .myp file type now uses a shortcut menu handler instead of a statically defined icon.</span></span>

```
HKEY_CLASSES_ROOT
   .myp
      (Default) = MyProgram.1
   MyProgram.1
      (Default) = MyProgram Application
      DefaultIcon
         (Default) = %1
      Shellex
         IconHandler
            (Default) = {The handler's CLSID GUID}
```

## <a name="related-topics"></a><span data-ttu-id="3fb24-150">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="3fb24-150">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="3fb24-151">Criar Manipuladores de Extensão de Shell</span><span class="sxs-lookup"><span data-stu-id="3fb24-151">Creating Shell Extension Handlers</span></span>](handlers.md)
</dt> <dt>

[<span data-ttu-id="3fb24-152">**IPersistFile**</span><span class="sxs-lookup"><span data-stu-id="3fb24-152">**IPersistFile**</span></span>](/windows/win32/api/objidl/nn-objidl-ipersistfile)
</dt> <dt>

[<span data-ttu-id="3fb24-153">**IExtractIcon**</span><span class="sxs-lookup"><span data-stu-id="3fb24-153">**IExtractIcon**</span></span>](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona)
</dt> </dl>

 

 
