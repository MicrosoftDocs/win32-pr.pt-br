---
description: Os gerenciadores de visualização são chamados quando um item é selecionado para mostrar uma visualização leve, rica e somente leitura do conteúdo do arquivo no painel de leitura do modo de exibição. Isso é feito sem iniciar o aplicativo associado do arquivo.
ms.assetid: 166a4001-d237-44a4-a457-e320e995639c
title: Gerenciadores de visualização e host de visualização do Shell
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 993c6c8e7b15d9bfc24b5dd42352407a3a53c45b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "104968002"
---
# <a name="preview-handlers-and-shell-preview-host"></a><span data-ttu-id="d0c51-104">Gerenciadores de visualização e host de visualização do Shell</span><span class="sxs-lookup"><span data-stu-id="d0c51-104">Preview Handlers and Shell Preview Host</span></span>

<span data-ttu-id="d0c51-105">Os gerenciadores de visualização são chamados quando um item é selecionado para mostrar uma visualização leve, rica e *somente leitura* do conteúdo do arquivo no painel de leitura do modo de exibição.</span><span class="sxs-lookup"><span data-stu-id="d0c51-105">Preview handlers are called when an item is selected to show a lightweight, rich, *read-only* preview of the file's contents in the view's reading pane.</span></span> <span data-ttu-id="d0c51-106">Isso é feito sem iniciar o aplicativo associado do arquivo.</span><span class="sxs-lookup"><span data-stu-id="d0c51-106">This is done without launching the file's associated application.</span></span>

<span data-ttu-id="d0c51-107">Este tópico aborda os seguintes tópicos:</span><span class="sxs-lookup"><span data-stu-id="d0c51-107">This topic discusses the following topics:</span></span>

-   [<span data-ttu-id="d0c51-108">Arquitetura do Gerenciador de visualização</span><span class="sxs-lookup"><span data-stu-id="d0c51-108">Preview Handler Architecture</span></span>](#preview-handler-architecture)
-   [<span data-ttu-id="d0c51-109">Opções de modelo de servidor</span><span class="sxs-lookup"><span data-stu-id="d0c51-109">Server Model Options</span></span>](#server-model-options)
-   [<span data-ttu-id="d0c51-110">Initialization</span><span class="sxs-lookup"><span data-stu-id="d0c51-110">Initialization</span></span>](#initialization)
-   [<span data-ttu-id="d0c51-111">Fluxo de dados do Gerenciador de visualização</span><span class="sxs-lookup"><span data-stu-id="d0c51-111">Preview Handler Data Flow</span></span>](#preview-handler-data-flow)
-   [<span data-ttu-id="d0c51-112">Depurando um Gerenciador de visualização</span><span class="sxs-lookup"><span data-stu-id="d0c51-112">Debugging a Preview Handler</span></span>](#debugging-a-preview-handler)
-   [<span data-ttu-id="d0c51-113">Fornecendo seu próprio processo para um Gerenciador de visualização</span><span class="sxs-lookup"><span data-stu-id="d0c51-113">Providing Your Own Process for a Preview Handler</span></span>](#providing-your-own-process-for-a-preview-handler)
-   [<span data-ttu-id="d0c51-114">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="d0c51-114">Related topics</span></span>](#related-topics)

## <a name="preview-handler-architecture"></a><span data-ttu-id="d0c51-115">Arquitetura do Gerenciador de visualização</span><span class="sxs-lookup"><span data-stu-id="d0c51-115">Preview Handler Architecture</span></span>

<span data-ttu-id="d0c51-116">Um Gerenciador de visualização é um aplicativo hospedado.</span><span class="sxs-lookup"><span data-stu-id="d0c51-116">A preview handler is a hosted application.</span></span> <span data-ttu-id="d0c51-117">Os hosts incluem o Windows Explorer no Windows Vista ou no Microsoft Outlook 2007.</span><span class="sxs-lookup"><span data-stu-id="d0c51-117">Hosts include the Windows Explorer in Windows Vista or Microsoft Outlook 2007.</span></span> <span data-ttu-id="d0c51-118">Os hosts implementam [**IPreviewHandlerFrame**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ipreviewhandlerframe) como um método de comunicação entre o Gerenciador de visualização e o host.</span><span class="sxs-lookup"><span data-stu-id="d0c51-118">Hosts implement [**IPreviewHandlerFrame**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ipreviewhandlerframe) as a method of communication between the preview handler and the host.</span></span>

<span data-ttu-id="d0c51-119">O próprio Gerenciador de visualização implementa essas interfaces:</span><span class="sxs-lookup"><span data-stu-id="d0c51-119">The preview handler itself implements these interfaces:</span></span>

-   [<span data-ttu-id="d0c51-120">**IInitializeWithStream**</span><span class="sxs-lookup"><span data-stu-id="d0c51-120">**IInitializeWithStream**</span></span>](/windows/desktop/api/Propsys/nn-propsys-iinitializewithstream)
-   [<span data-ttu-id="d0c51-121">**IObjectWithSite**</span><span class="sxs-lookup"><span data-stu-id="d0c51-121">**IObjectWithSite**</span></span>](/windows/win32/api/ocidl/nn-ocidl-iobjectwithsite)
-   [<span data-ttu-id="d0c51-122">**IOleWindow**</span><span class="sxs-lookup"><span data-stu-id="d0c51-122">**IOleWindow**</span></span>](/windows/win32/api/oleidl/nn-oleidl-iolewindow)
-   [<span data-ttu-id="d0c51-123">**IPreviewHandler**</span><span class="sxs-lookup"><span data-stu-id="d0c51-123">**IPreviewHandler**</span></span>](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ipreviewhandler)
-   <span data-ttu-id="d0c51-124">[**IPreviewHandlerVisuals**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ipreviewhandlervisuals) (opcional)</span><span class="sxs-lookup"><span data-stu-id="d0c51-124">[**IPreviewHandlerVisuals**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ipreviewhandlervisuals) (Optional)</span></span>

<span data-ttu-id="d0c51-125">Seu manipulador é chamado por meio de seu [**IObjectWithSite**](/windows/win32/api/ocidl/nn-ocidl-iobjectwithsite), que retorna um ponteiro [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) por meio do qual você solicita um objeto [**IPreviewHandlerFrame**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ipreviewhandlerframe) para interagir com o host.</span><span class="sxs-lookup"><span data-stu-id="d0c51-125">Your handler is called through its [**IObjectWithSite**](/windows/win32/api/ocidl/nn-ocidl-iobjectwithsite), which returns an [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) pointer through which you request an [**IPreviewHandlerFrame**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ipreviewhandlerframe) object to interact with the host.</span></span>

## <a name="server-model-options"></a><span data-ttu-id="d0c51-126">Opções de modelo de servidor</span><span class="sxs-lookup"><span data-stu-id="d0c51-126">Server Model Options</span></span>

<span data-ttu-id="d0c51-127">Os gerenciadores de visualização sempre ficam fora do processo.</span><span class="sxs-lookup"><span data-stu-id="d0c51-127">Preview handlers always run out of process.</span></span> <span data-ttu-id="d0c51-128">Há dois métodos para implementar isso:</span><span class="sxs-lookup"><span data-stu-id="d0c51-128">There are two methods of implementing this:</span></span>

1.  <span data-ttu-id="d0c51-129">Um Gerenciador de visualização pode ser criado como um servidor em processo, mas executado por meio de um host alternativo fora do processo.</span><span class="sxs-lookup"><span data-stu-id="d0c51-129">A preview handler can be built as an in-process server but run through an out-of-process surrogate host.</span></span> <span data-ttu-id="d0c51-130">Este é o método preferencial.</span><span class="sxs-lookup"><span data-stu-id="d0c51-130">This is the preferred method.</span></span> <span data-ttu-id="d0c51-131">O sistema fornece um host alternativo para isso no arquivo de Prevhost.exe.</span><span class="sxs-lookup"><span data-stu-id="d0c51-131">The system provides a surrogate host for this in the Prevhost.exe file.</span></span> <span data-ttu-id="d0c51-132">Os gerenciadores de visualização criados por esse método não são compatíveis com o Outlook 2007 no Windows XP.</span><span class="sxs-lookup"><span data-stu-id="d0c51-132">Preview handlers built by this method are not compatible with Outlook 2007 on Windows XP.</span></span> <span data-ttu-id="d0c51-133">No entanto, esses mesmos manipuladores funcionarão no Windows Explorer e no Outlook 2007 em execução no Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="d0c51-133">However, these same handlers will work in Windows Explorer and Outlook 2007 running on Windows Vista.</span></span>
2.  <span data-ttu-id="d0c51-134">Um Gerenciador de visualização pode ser criado como um servidor local Component Object Model (COM).</span><span class="sxs-lookup"><span data-stu-id="d0c51-134">A preview handler can be built as a local Component Object Model (COM) server.</span></span> <span data-ttu-id="d0c51-135">Isso não é recomendado por vários motivos.</span><span class="sxs-lookup"><span data-stu-id="d0c51-135">This is not recommended for several reasons.</span></span> <span data-ttu-id="d0c51-136">Primeiro, a implementação de um servidor em processo é mais fácil.</span><span class="sxs-lookup"><span data-stu-id="d0c51-136">First, implementation of an in-process server is easier.</span></span> <span data-ttu-id="d0c51-137">O mais importante é que a implementação como um servidor em processo fornece maior controle sobre o tempo de vida do objeto do manipulador, o que permite melhor limpeza e eficiência.</span><span class="sxs-lookup"><span data-stu-id="d0c51-137">More importantly, implementation as an in-process server provides greater control over the lifetime of the handler object, which allows for better cleanup and efficiency.</span></span>

<span data-ttu-id="d0c51-138">Por padrão, os gerenciadores de visualização são executados em um processo de nível de integridade baixo (IL) por motivos de segurança.</span><span class="sxs-lookup"><span data-stu-id="d0c51-138">By default, preview handlers run in a low integrity level (IL) process for security reasons.</span></span> <span data-ttu-id="d0c51-139">Opcionalmente, você pode desabilitar a execução como um processo de IL baixo definindo o seguinte valor no registro.</span><span class="sxs-lookup"><span data-stu-id="d0c51-139">You can optionally disable running as a low IL process by setting the following value in the registry.</span></span> <span data-ttu-id="d0c51-140">No entanto, não é recomendável fazer isso.</span><span class="sxs-lookup"><span data-stu-id="d0c51-140">However, it is not recommended to do so.</span></span> <span data-ttu-id="d0c51-141">Os sistemas podem eventualmente ser configurados para rejeitar qualquer processo que não seja de IL baixo.</span><span class="sxs-lookup"><span data-stu-id="d0c51-141">Systems could eventually be configured to reject any process that is not low IL.</span></span>

```
HKEY_CLASSES_ROOT
   CLSID
      {YOUR HANDLER'S CLSID}
         DisableLowILProcessIsolation [DWORD] = 1
```

<span data-ttu-id="d0c51-142">Os diferentes gerenciadores de visualização compartilham o mesmo processo por padrão.</span><span class="sxs-lookup"><span data-stu-id="d0c51-142">Different preview handlers share the same process by default.</span></span> <span data-ttu-id="d0c51-143">Duas instâncias do Prevhost.exe podem ser executadas simultaneamente; um para os manipuladores executados como processos de IL baixo, um para manipuladores que tenham optado por esse comportamento.</span><span class="sxs-lookup"><span data-stu-id="d0c51-143">Two instances of Prevhost.exe can be running simultaneously; one for handlers running as low IL processes, one for handlers that have opted out of that behavior.</span></span>

## <a name="initialization"></a><span data-ttu-id="d0c51-144">Inicialização</span><span class="sxs-lookup"><span data-stu-id="d0c51-144">Initialization</span></span>

<span data-ttu-id="d0c51-145">Assim como com os manipuladores de miniatura e propriedade, é altamente recomendável que você Inicialize seu manipulador com um fluxo.</span><span class="sxs-lookup"><span data-stu-id="d0c51-145">As with thumbnail and property handlers, it is strongly recommended that you initialize your handler with a stream.</span></span> <span data-ttu-id="d0c51-146">Você pode inicializar por meio de um arquivo ou item, se necessário, mas os fluxos fornecem a maneira mais segura de implementar um manipulador.</span><span class="sxs-lookup"><span data-stu-id="d0c51-146">You can initialize through a file or item if necessary, but streams provide the most secure way to implement a handler.</span></span> <span data-ttu-id="d0c51-147">A inicialização por meio de um fluxo garante a integridade do arquivo e os benefícios de estabilidade para o sistema de executar o manipulador como um processo de IL baixo, como proteger o sistema contra estouros de buffer, limitando onde um manipulador pode gravar informações e limitando a comunicação com outras janelas.</span><span class="sxs-lookup"><span data-stu-id="d0c51-147">Initialization through a stream ensures file integrity and the stability benefits to the system of running the handler as a low IL process, such as protecting the system from buffer overruns, limiting where a handler can write information, and limiting communication with other windows.</span></span>

<span data-ttu-id="d0c51-148">Se você precisar inicializar com um item de arquivo ou de Shell, armazene o caminho do arquivo ou uma referência ao [**IShellItem**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellitem).</span><span class="sxs-lookup"><span data-stu-id="d0c51-148">If you must initialize with a file or Shell item, store the file path or a reference to the [**IShellItem**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellitem).</span></span> <span data-ttu-id="d0c51-149">Não leia dados dessas fontes até que [**IPreviewHandler::D opreview**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-dopreview) seja chamado.</span><span class="sxs-lookup"><span data-stu-id="d0c51-149">Do not read data from these sources until [**IPreviewHandler::DoPreview**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-dopreview) is called.</span></span>

<span data-ttu-id="d0c51-150">Em geral, a inicialização não deve fazer nenhum trabalho pesado, como compor e armazenar uma imagem de visualização.</span><span class="sxs-lookup"><span data-stu-id="d0c51-150">In general, initialization should not do any heavy work such as composing and storing a preview image.</span></span> <span data-ttu-id="d0c51-151">Para uma eficiência ideal, esse tipo de processamento não deve ser feito até que a versão prévia seja chamada para.</span><span class="sxs-lookup"><span data-stu-id="d0c51-151">For optimal efficiency, that sort of processing should not be done until the preview is called for.</span></span>

## <a name="preview-handler-data-flow"></a><span data-ttu-id="d0c51-152">Fluxo de dados do Gerenciador de visualização</span><span class="sxs-lookup"><span data-stu-id="d0c51-152">Preview Handler Data Flow</span></span>

<span data-ttu-id="d0c51-153">O fluxo de dados no processo de visualização segue o caminho geral mostrado aqui.</span><span class="sxs-lookup"><span data-stu-id="d0c51-153">The data flow in the preview process follows the general path shown here.</span></span> <span data-ttu-id="d0c51-154">O host pode ser considerado como o Windows Explorer no Windows Vista ou no Outlook 2007.</span><span class="sxs-lookup"><span data-stu-id="d0c51-154">The host can be thought of as Windows Explorer in Windows Vista or Outlook 2007.</span></span>

1.  <span data-ttu-id="d0c51-155">O Gerenciador de visualização é inicializado, preferencialmente com um fluxo.</span><span class="sxs-lookup"><span data-stu-id="d0c51-155">The preview handler is initialized, preferably with a stream.</span></span>
2.  <span data-ttu-id="d0c51-156">A janela de exibição é passada do host para o manipulador por meio de [**IPreviewHandler:: SetWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setwindow).</span><span class="sxs-lookup"><span data-stu-id="d0c51-156">The view window is passed from the host to the handler through [**IPreviewHandler::SetWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setwindow).</span></span>
3.  <span data-ttu-id="d0c51-157">Neste ponto, o manipulador não deve fazer nada mais até que [**IPreviewHandler::D opreview**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-dopreview) seja chamado.</span><span class="sxs-lookup"><span data-stu-id="d0c51-157">At this point, the handler should do nothing more until [**IPreviewHandler::DoPreview**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-dopreview) is called.</span></span>
4.  <span data-ttu-id="d0c51-158">A visualização é exibida no painel de leitura por meio de uma chamada para [**IPreviewHandler::D opreview**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-dopreview).</span><span class="sxs-lookup"><span data-stu-id="d0c51-158">The preview is displayed in the reading pane through a call to [**IPreviewHandler::DoPreview**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-dopreview).</span></span>
5.  <span data-ttu-id="d0c51-159">O tamanho da janela é definido por meio de [**IPreviewHandler:: SetRect**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setrect).</span><span class="sxs-lookup"><span data-stu-id="d0c51-159">The size of the window is set through [**IPreviewHandler::SetRect**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setrect).</span></span>
6.  <span data-ttu-id="d0c51-160">A janela é redimensionada quando necessário por meio de [**IPreviewHandler:: SetRect**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setrect).</span><span class="sxs-lookup"><span data-stu-id="d0c51-160">The window is resized when needed through [**IPreviewHandler::SetRect**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setrect).</span></span>
7.  <span data-ttu-id="d0c51-161">A visualização é descarregada e seus recursos são liberados quando não são mais necessários, por meio de uma chamada para [**IPreviewHandler:: Unload**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-unload).</span><span class="sxs-lookup"><span data-stu-id="d0c51-161">The preview is unloaded and its resources released when it is no longer needed, through a call to [**IPreviewHandler::Unload**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-unload).</span></span>

## <a name="debugging-a-preview-handler"></a><span data-ttu-id="d0c51-162">Depurando um Gerenciador de visualização</span><span class="sxs-lookup"><span data-stu-id="d0c51-162">Debugging a Preview Handler</span></span>

<span data-ttu-id="d0c51-163">Se você seguiu as recomendações para implementar o Gerenciador de visualização como um servidor em processo, para depurar o Gerenciador de visualização, você pode anexar ao Prevhost.exe.</span><span class="sxs-lookup"><span data-stu-id="d0c51-163">If you have followed the recommendations to implement your preview handler as an in-process server, to debug your preview handler, you can attach to Prevhost.exe.</span></span> <span data-ttu-id="d0c51-164">Como mencionado anteriormente, lembre-se de que pode haver duas instâncias do Prevhost.exe, uma para processos normais de IL baixo e outra para os manipuladores que tenham optado por ser executado como um processo de IL baixo.</span><span class="sxs-lookup"><span data-stu-id="d0c51-164">As mentioned earlier, be aware that there could be two instances of Prevhost.exe, one for normal low IL processes and one for those handlers that have opted out of running as a low IL process.</span></span>

<span data-ttu-id="d0c51-165">Se você não encontrar Prevhost.exe na sua lista de processos disponíveis, provavelmente ele não foi carregado nesse ponto.</span><span class="sxs-lookup"><span data-stu-id="d0c51-165">If you do not find Prevhost.exe in your list of available processes, it probably has not been loaded at that point.</span></span> <span data-ttu-id="d0c51-166">Clicar em um arquivo para uma visualização carrega o substituto e, em seguida, ele deve aparecer como um processo anexável.</span><span class="sxs-lookup"><span data-stu-id="d0c51-166">Clicking on a file for a preview loads the surrogate and it should then appear as an attachable process.</span></span>

## <a name="providing-your-own-process-for-a-preview-handler"></a><span data-ttu-id="d0c51-167">Fornecendo seu próprio processo para um Gerenciador de visualização</span><span class="sxs-lookup"><span data-stu-id="d0c51-167">Providing Your Own Process for a Preview Handler</span></span>

<span data-ttu-id="d0c51-168">Se você quiser forçar a criação de um novo processo para seu manipulador em vez de executar sob o processo padrão, crie uma nova subchave para o manipulador em **AppID** e defina sua entrada DllSurrogate como "Prevhost.exe".</span><span class="sxs-lookup"><span data-stu-id="d0c51-168">If you want to force the creation of a new process for your handler rather than running under the default process, create a new subkey for your handler under **AppID** and set its DllSurrogate entry to "Prevhost.exe".</span></span> <span data-ttu-id="d0c51-169">Use essa subchave **AppID** em vez do padrão Prevhost.exe **AppID**.</span><span class="sxs-lookup"><span data-stu-id="d0c51-169">Use that **AppID** subkey instead of the default Prevhost.exe **AppID**.</span></span>

<span data-ttu-id="d0c51-170">Ao fornecer um novo processo, o manipulador pode evitar a execução em um processo compartilhado como faria por padrão.</span><span class="sxs-lookup"><span data-stu-id="d0c51-170">By providing a new process, the handler can avoid running under a shared process as it would do by default.</span></span> <span data-ttu-id="d0c51-171">Isso pode permitir, por exemplo, garantir a versão específica do Common Language Runtime (CLR) no processo.</span><span class="sxs-lookup"><span data-stu-id="d0c51-171">This could allow you, for example, to ensure the specific version of the common language runtime (CLR) in the process.</span></span> <span data-ttu-id="d0c51-172">Isso será necessário se você estiver criando uma implementação gerenciada de um Gerenciador de visualização.</span><span class="sxs-lookup"><span data-stu-id="d0c51-172">This is required if you are building a managed implementation of a preview handler.</span></span>

> [!Note]  
> <span data-ttu-id="d0c51-173">os gerenciadores de visualização de 32 bits devem usar **AppID** {534A1E02-D58F-44f0-B58B-36CBED287C7C} quando instalados em sistemas operacionais de 64 bits.</span><span class="sxs-lookup"><span data-stu-id="d0c51-173">32-bit preview handlers should use **AppID** {534A1E02-D58F-44f0-B58B-36CBED287C7C} when installed on 64-bit operating systems.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="d0c51-174">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="d0c51-174">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d0c51-175">Criando gerenciadores de visualização</span><span class="sxs-lookup"><span data-stu-id="d0c51-175">Building Preview Handlers</span></span>](building-preview-handlers.md)
</dt> <dt>

[<span data-ttu-id="d0c51-176">Como registrar um Gerenciador de visualização</span><span class="sxs-lookup"><span data-stu-id="d0c51-176">How to Register a Preview Handler</span></span>](how-to-register-a-preview-handler.md)
</dt> <dt>

[<span data-ttu-id="d0c51-177">Diretrizes do Gerenciador de visualização</span><span class="sxs-lookup"><span data-stu-id="d0c51-177">Preview Handler Guidelines</span></span>](preview-handler-guidelines.md)
</dt> </dl>

 

 
