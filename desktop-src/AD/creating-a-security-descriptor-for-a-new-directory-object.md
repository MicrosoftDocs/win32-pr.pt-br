---
title: Criando descritores de segurança para novos objetos de diretório
description: Você pode usar ADSI para criar um descritor de segurança e defini-lo como a propriedade nTSecurityDescriptor de um novo objeto ou usá-lo para substituir a propriedade nTSecurityDescriptor de um objeto existente.
ms.assetid: b9ff626f-17f1-4fc1-9d6e-4f47e29a5aeb
ms.tgt_platform: multiple
keywords:
- Criando um descritor de segurança para um novo objeto de diretório AD
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 78265d27c52023d669e27fc9890fd2d5273e2ffd
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/17/2020
ms.locfileid: "104453942"
---
# <a name="creating-security-descriptors-for-new-directory-objects"></a><span data-ttu-id="5a171-104">Criando descritores de segurança para novos objetos de diretório</span><span class="sxs-lookup"><span data-stu-id="5a171-104">Creating Security Descriptors for new directory objects</span></span>

<span data-ttu-id="5a171-105">Você pode usar ADSI para criar um descritor de segurança e defini-lo como a propriedade **nTSecurityDescriptor** de um novo objeto ou usá-lo para substituir a propriedade **nTSecurityDescriptor** de um objeto existente.</span><span class="sxs-lookup"><span data-stu-id="5a171-105">You can use ADSI to create a security descriptor and set it as a new object's **nTSecurityDescriptor** property or use it to replace an existing object's **nTSecurityDescriptor** property.</span></span>

<span data-ttu-id="5a171-106">Para criar um descritor de segurança para um objeto:</span><span class="sxs-lookup"><span data-stu-id="5a171-106">To create a security descriptor for an object:</span></span>

1.  <span data-ttu-id="5a171-107">Use [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) para criar o objeto com ADSI para o novo descritor de segurança e obter um ponteiro de interface [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) para esse objeto.</span><span class="sxs-lookup"><span data-stu-id="5a171-107">Use [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) to create the ADSI COM object for the new security descriptor and get an [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) interface pointer to that object.</span></span> <span data-ttu-id="5a171-108">Lembre-se de que a ID de classe é **CLSID \_ SecurityDescriptor**.</span><span class="sxs-lookup"><span data-stu-id="5a171-108">Be aware that the class ID is **CLSID\_SecurityDescriptor**.</span></span>
2.  <span data-ttu-id="5a171-109">Use o método [**IADsSecurityDescriptor::p UT \_ Owner**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) para definir o proprietário do objeto.</span><span class="sxs-lookup"><span data-stu-id="5a171-109">Use the [**IADsSecurityDescriptor::put\_Owner**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) method to set the owner of the object.</span></span> <span data-ttu-id="5a171-110">O objeto de confiança é um usuário, grupo ou outra entidade de segurança.</span><span class="sxs-lookup"><span data-stu-id="5a171-110">The trustee is a user, group, or other security principal.</span></span> <span data-ttu-id="5a171-111">Um aplicativo deve usar o valor da propriedade apropriada do objeto user ou Group do Trustee ao qual aplicar a ACE.</span><span class="sxs-lookup"><span data-stu-id="5a171-111">An application should use the value from the appropriate property from the user or group object of the trustee to which to apply the ACE.</span></span>
3.  <span data-ttu-id="5a171-112">Use o método de [**\_ controle IADsSecurityDescriptor::p UT**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) para controlar se as DACLs e SACLs são herdadas pelo objeto de seu contêiner pai.</span><span class="sxs-lookup"><span data-stu-id="5a171-112">Use the [**IADsSecurityDescriptor::put\_Control**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) method to control whether DACLs and SACLs are inherited by the object from its parent container.</span></span>
4.  <span data-ttu-id="5a171-113">Use [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) para criar o objeto com ADSI para a DACL do novo descritor de segurança e obtenha um ponteiro de interface [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) para esse objeto.</span><span class="sxs-lookup"><span data-stu-id="5a171-113">Use [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) to create the ADSI COM object for the DACL for the new security descriptor and get an [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) interface pointer to that object.</span></span> <span data-ttu-id="5a171-114">Lembre-se de que a ID de classe é **CLSID \_ AccessControlList**.</span><span class="sxs-lookup"><span data-stu-id="5a171-114">Be aware that the class ID is **CLSID\_AccessControlList**.</span></span>
5.  <span data-ttu-id="5a171-115">Para cada ACE adicionar à DACL, use [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) para criar o objeto com ADSI para a nova Ace e obter um ponteiro de interface [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) para esse objeto.</span><span class="sxs-lookup"><span data-stu-id="5a171-115">For each ACE to add to the DACL, use [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) to create the ADSI COM object for the new ACE and get an [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) interface pointer to that object.</span></span> <span data-ttu-id="5a171-116">Lembre-se de que a ID de classe é CLSID \_ AccessControlEntry.</span><span class="sxs-lookup"><span data-stu-id="5a171-116">Be aware that the class ID is CLSID\_AccessControlEntry.</span></span>
6.  <span data-ttu-id="5a171-117">Para cada ACE a adicionar à DACL, defina as propriedades da ACE usando os métodos de Propriedade do objeto [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) da Ace.</span><span class="sxs-lookup"><span data-stu-id="5a171-117">For each ACE to add to the DACL, set the properties of the ACE using the property methods of the ACE's [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) object.</span></span> <span data-ttu-id="5a171-118">Para obter mais informações sobre as propriedades a serem definidas em uma ACE, consulte [definindo direitos de acesso em um objeto](setting-access-rights-on-an-object.md).</span><span class="sxs-lookup"><span data-stu-id="5a171-118">For more information about the properties to set on an ACE, see [Setting Access Rights on an Object](setting-access-rights-on-an-object.md).</span></span>
7.  <span data-ttu-id="5a171-119">Para cada ACE a ser adicionada à DACL, use o método **QueryInterface** no objeto [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) para obter um ponteiro [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) .</span><span class="sxs-lookup"><span data-stu-id="5a171-119">For each ACE to add to the DACL, use the **QueryInterface** method on the [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) object to get an [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) pointer.</span></span> <span data-ttu-id="5a171-120">O método [**IADsAccessControlList:: AddAce**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) requer um ponteiro de interface **IDISPATCH** para a Ace.</span><span class="sxs-lookup"><span data-stu-id="5a171-120">The [**IADsAccessControlList::AddAce**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) method requires an **IDispatch** interface pointer to the ACE.</span></span>
8.  <span data-ttu-id="5a171-121">Para cada ACE a ser adicionada à DACL, use [**IADsAccessControlList:: AddAce**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) para adicionar a nova Ace à DACL.</span><span class="sxs-lookup"><span data-stu-id="5a171-121">For each ACE to add to the DACL, use [**IADsAccessControlList::AddAce**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) to add the new ACE to the DACL.</span></span> <span data-ttu-id="5a171-122">Lembre-se de que a ordem das ACEs dentro da ACL pode afetar a avaliação do acesso ao objeto.</span><span class="sxs-lookup"><span data-stu-id="5a171-122">Be aware that the order of the ACEs within the ACL can affect the evaluation of access to the object.</span></span> <span data-ttu-id="5a171-123">O acesso correto ao objeto pode exigir que você crie uma nova ACL, adicione as ACEs da ACL existente na ordem correta à nova ACL e, em seguida, substitua a ACL existente no descritor de segurança pela nova ACL.</span><span class="sxs-lookup"><span data-stu-id="5a171-123">The correct access to the object may require you to create a new ACL, add the ACEs from the existing ACL in the correct order to the new ACL, and then replace the existing ACL in the security descriptor with the new ACL.</span></span> <span data-ttu-id="5a171-124">Para obter mais informações, consulte [ordem das ACEs em uma DACL](/windows/desktop/SecAuthZ/order-of-aces-in-a-dacl).</span><span class="sxs-lookup"><span data-stu-id="5a171-124">For more information, see [Order of ACEs in a DACL](/windows/desktop/SecAuthZ/order-of-aces-in-a-dacl).</span></span>
9.  <span data-ttu-id="5a171-125">Siga as etapas 4-8 para criar a SACL para o novo descritor de segurança.</span><span class="sxs-lookup"><span data-stu-id="5a171-125">Follow Steps 4-8 to create the SACL for the new security descriptor.</span></span>
10. <span data-ttu-id="5a171-126">Use o método [**IADsSecurityDescriptor::p UT \_ DiscretionaryAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) para definir a DACL.</span><span class="sxs-lookup"><span data-stu-id="5a171-126">Use the [**IADsSecurityDescriptor::put\_DiscretionaryAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) method to set the DACL.</span></span> <span data-ttu-id="5a171-127">Para obter mais informações sobre DACLs, consulte [DACLs nulas e DACLs vazias](null-dacls-and-empty-dacls.md).</span><span class="sxs-lookup"><span data-stu-id="5a171-127">For more information about DACLs, see [Null DACLs and Empty DACLs](null-dacls-and-empty-dacls.md).</span></span>
11. <span data-ttu-id="5a171-128">Use o método [**IADsSecurityDescriptor::p UT \_ SystemAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) para definir a SACL.</span><span class="sxs-lookup"><span data-stu-id="5a171-128">Use the [**IADsSecurityDescriptor::put\_SystemAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) method to set the SACL.</span></span>
12. <span data-ttu-id="5a171-129">Converta o objeto [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) em uma [**variante**](/windows/win32/api/oaidl/ns-oaidl-variant) usando o método **QueryInterface** do objeto **IADsSecurityDescriptor** para obter uma interface [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) .</span><span class="sxs-lookup"><span data-stu-id="5a171-129">Convert the [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) object to a [**VARIANT**](/windows/win32/api/oaidl/ns-oaidl-variant) by using the **QueryInterface** method of the **IADsSecurityDescriptor** object to obtain an [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) interface.</span></span> <span data-ttu-id="5a171-130">Em seguida, defina o membro **VT** do **\_ despacho** **Variant** para VT e defina o membro **pdispVal** da **variante** igual ao ponteiro **IDispatch** .</span><span class="sxs-lookup"><span data-stu-id="5a171-130">Then set the **vt** member of the **VARIANT** to **VT\_DISPATCH** and set the **pdispVal** member of the **VARIANT** equal to the **IDispatch** pointer.</span></span>
13. <span data-ttu-id="5a171-131">Obtenha um ponteiro de interface [**IADs**](/windows/desktop/api/iads/nn-iads-iads) para o objeto.</span><span class="sxs-lookup"><span data-stu-id="5a171-131">Obtain an [**IADs**](/windows/desktop/api/iads/nn-iads-iads) interface pointer to the object.</span></span>
14. <span data-ttu-id="5a171-132">Use o método [**IADs::P UT**](/windows/desktop/api/iads/nf-iads-iads-put) com "nTSecurityDescriptor" e a [**variante**](/windows/win32/api/oaidl/ns-oaidl-variant) criada acima para gravar o novo descritor de segurança no cache de propriedades.</span><span class="sxs-lookup"><span data-stu-id="5a171-132">Use the [**IADs::Put**](/windows/desktop/api/iads/nf-iads-iads-put) method with "nTSecurityDescriptor" and the [**VARIANT**](/windows/win32/api/oaidl/ns-oaidl-variant) created above to write the new security descriptor to the property cache.</span></span>
15. <span data-ttu-id="5a171-133">Use o método [**IADs:: setinfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo) para atualizar a propriedade no objeto no diretório.</span><span class="sxs-lookup"><span data-stu-id="5a171-133">Use the [**IADs::SetInfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo) method to update the property on the object in the directory.</span></span>

 

 