---
title: Como um serviço registra seus SPNs
description: Antes que um cliente possa usar um SPN para autenticar uma instância de um serviço, o SPN deve ser registrado na conta de usuário ou computador que a instância de serviço usará para fazer logon.
ms.assetid: 39712c1f-3a9a-4c98-a1cb-879ab0b4cb63
ms.tgt_platform: multiple
keywords:
- Como um serviço registra seu anúncio de SPNs
- nome da entidade de serviço AD, como um serviço registra seus SPNs
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 74410be3a024fc6accd1d8394e2ba8335be9f550
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/16/2019
ms.locfileid: "103822273"
---
# <a name="how-a-service-registers-its-spns"></a><span data-ttu-id="665ad-105">Como um serviço registra seus SPNs</span><span class="sxs-lookup"><span data-stu-id="665ad-105">How a Service Registers its SPNs</span></span>

<span data-ttu-id="665ad-106">Antes que um cliente possa usar um SPN para autenticar uma instância de um serviço, o SPN deve ser registrado na conta de usuário ou computador que a instância de serviço usará para fazer logon.</span><span class="sxs-lookup"><span data-stu-id="665ad-106">Before a client can use an SPN to authenticate an instance of a service, the SPN must be registered on the user or computer account that the service instance will use to log on.</span></span> <span data-ttu-id="665ad-107">Normalmente, o registro de SPN é feito por um programa de instalação de serviço em execução com privilégios de administrador de domínio.</span><span class="sxs-lookup"><span data-stu-id="665ad-107">Typically, SPN registration is done by a service installation program running with domain administrator privileges.</span></span>

<span data-ttu-id="665ad-108">O instalador de serviço que instala uma instância de serviço em um computador host normalmente executa o procedimento a seguir.</span><span class="sxs-lookup"><span data-stu-id="665ad-108">The service installer that installs a service instance on a host computer typically performs the following procedure.</span></span>

<span data-ttu-id="665ad-109">**Para registrar SPNs para uma instância de serviço**</span><span class="sxs-lookup"><span data-stu-id="665ad-109">**To register SPNs for a service instance**</span></span>

1.  <span data-ttu-id="665ad-110">Chame a função [**DsGetSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsgetspna) para criar um ou mais SPNs exclusivos para a instância de serviço.</span><span class="sxs-lookup"><span data-stu-id="665ad-110">Call the [**DsGetSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsgetspna) function to create one or more unique SPNs for the service instance.</span></span> <span data-ttu-id="665ad-111">Para obter mais informações, consulte [formatos de nome para SPNs exclusivos](name-formats-for-unique-spns.md).</span><span class="sxs-lookup"><span data-stu-id="665ad-111">For more information, see [Name Formats for Unique SPNs](name-formats-for-unique-spns.md).</span></span>
2.  <span data-ttu-id="665ad-112">Chame a função [**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) para registrar os nomes na conta de logon do serviço.</span><span class="sxs-lookup"><span data-stu-id="665ad-112">Call the [**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) function to register the names on the service's logon account.</span></span>

<span data-ttu-id="665ad-113">[**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) registra os SPNs como uma propriedade de um usuário ou objeto de conta de computador no diretório.</span><span class="sxs-lookup"><span data-stu-id="665ad-113">[**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) registers SPNs as a property of a user or computer account object in the directory.</span></span> <span data-ttu-id="665ad-114">os objetos de **computador** e de **usuário** têm um atributo **servicePrincipalName** , que é um atributo com vários valores para armazenar todos os SPNs associados a uma conta de usuário ou de computador.</span><span class="sxs-lookup"><span data-stu-id="665ad-114">**user** and **computer** objects have a **servicePrincipalName** attribute, which is a multi-valued attribute for storing all the SPNs associated with a user or computer account.</span></span> <span data-ttu-id="665ad-115">Se o serviço for executado em uma conta de usuário, os SPNs serão armazenados no atributo **servicePrincipalName** dessa conta.</span><span class="sxs-lookup"><span data-stu-id="665ad-115">If the service runs under a user account, the SPNs are stored in the **servicePrincipalName** attribute of that account.</span></span> <span data-ttu-id="665ad-116">Se o serviço for executado na conta LocalSystem, os SPNs serão armazenados no atributo **servicePrincipalName** da conta do computador host do serviço.</span><span class="sxs-lookup"><span data-stu-id="665ad-116">If the service runs in the LocalSystem account, the SPNs are stored in the **servicePrincipalName** attribute of the account of the service's host computer.</span></span> <span data-ttu-id="665ad-117">O chamador **DsWriteAccountSpn** deve especificar o nome distinto do objeto de conta sob o qual os SPNs são armazenados.</span><span class="sxs-lookup"><span data-stu-id="665ad-117">The **DsWriteAccountSpn** caller must specify the distinguished name of the account object under which the SPNs are stored.</span></span>

<span data-ttu-id="665ad-118">Para garantir que os SPNs registrados sejam seguros, o atributo **servicePrincipalName** não pode ser gravado diretamente; Ele só pode ser escrito chamando [**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna).</span><span class="sxs-lookup"><span data-stu-id="665ad-118">To ensure that registered SPNs are secure, the **servicePrincipalName** attribute cannot be written directly; it can only be written by calling [**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna).</span></span> <span data-ttu-id="665ad-119">O chamador deve ter acesso de gravação ao atributo **servicePrincipalName** da conta de destino.</span><span class="sxs-lookup"><span data-stu-id="665ad-119">The caller must have write-access to the **servicePrincipalName** attribute of the target account.</span></span> <span data-ttu-id="665ad-120">Normalmente, o acesso de gravação é concedido por padrão somente para administradores de domínio.</span><span class="sxs-lookup"><span data-stu-id="665ad-120">Typically, write access is granted by default only to domain administrators.</span></span> <span data-ttu-id="665ad-121">No entanto, há um caso especial em que o sistema permite que um serviço em execução na conta LocalSystem Registre seus próprios SPNs na conta de computador do host do serviço.</span><span class="sxs-lookup"><span data-stu-id="665ad-121">However, there is a special case in which the system allows a service running under the LocalSystem account to register its own SPNs on the computer account of the service's host.</span></span> <span data-ttu-id="665ad-122">Nesse caso, o SPN que está sendo gravado deve ter o formato " <service class> / <host> " e " &lt; host &gt; " deve ser o nome DNS do computador local.</span><span class="sxs-lookup"><span data-stu-id="665ad-122">In this case, the SPN being written must have the form "<service class>/<host>" and "&lt;host&gt;" must be the DNS name of the local computer.</span></span>

<span data-ttu-id="665ad-123">[**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) também pode remover SPNs de uma conta.</span><span class="sxs-lookup"><span data-stu-id="665ad-123">[**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) can also remove SPNs from an account.</span></span> <span data-ttu-id="665ad-124">Um parâmetro de operação indica se os SPNs devem ser adicionados à conta, removidos da conta ou usados para substituir completamente todos os SPNs atuais da conta.</span><span class="sxs-lookup"><span data-stu-id="665ad-124">An operation parameter indicates whether the SPNs are to be added to the account, removed from the account, or used to completely replace all current SPNs for the account.</span></span> <span data-ttu-id="665ad-125">Quando uma instância de serviço é desinstalada, remova todos os SPNs registrados para essa instância.</span><span class="sxs-lookup"><span data-stu-id="665ad-125">When a service instance is uninstalled, remove any SPNs registered for that instance.</span></span>

<span data-ttu-id="665ad-126">Para obter mais informações e um exemplo de código que registra ou cancela o registro de SPNs de um serviço, consulte [registrando os SPNs para um serviço](registering-the-spns-for-a-service.md).</span><span class="sxs-lookup"><span data-stu-id="665ad-126">For more information and a code example that registers or unregisters a service's SPNs, see [Registering the SPNs for a Service](registering-the-spns-for-a-service.md).</span></span>

<span data-ttu-id="665ad-127">Os serviços baseados em host que usam o formato SPN simples " <service class> / <host> " têm a opção de usar a função [**DsServerRegisterSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsserverregisterspna) , que cria e registra SPNs para uma instância de serviço.</span><span class="sxs-lookup"><span data-stu-id="665ad-127">Host-based services that use the simple SPN format "<service class>/<host>", have the option of using the [**DsServerRegisterSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsserverregisterspna) function, which both creates and registers SPNs for a service instance.</span></span> <span data-ttu-id="665ad-128">**DsServerRegisterSpn** é uma função auxiliar que chama [**DsGetSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsgetspna) e [**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna).</span><span class="sxs-lookup"><span data-stu-id="665ad-128">**DsServerRegisterSpn** is a helper function that calls [**DsGetSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsgetspna) and [**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna).</span></span>

<span data-ttu-id="665ad-129">Para obter mais informações, consulte [contas de logon de serviço](service-logon-accounts.md).</span><span class="sxs-lookup"><span data-stu-id="665ad-129">For more information, see [Service Logon Accounts](service-logon-accounts.md).</span></span>

 

 




