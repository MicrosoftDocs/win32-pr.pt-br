---
title: Implementando o objeto COM da página de propriedades
description: Uma extensão de folha de propriedades é um objeto COM implementado como um servidor em processo.
ms.assetid: 77a71086-1949-4828-801e-073ea5a6838b
ms.tgt_platform: multiple
keywords:
- Implementando o objeto COM da página de propriedades
- Objeto COM da página de propriedades, implementando
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 55962002ca059ad6e9c137925d1ba21ba9adc513
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/17/2020
ms.locfileid: "103823653"
---
# <a name="implementing-the-property-page-com-object"></a><span data-ttu-id="4fb37-105">Implementando o objeto COM da página de propriedades</span><span class="sxs-lookup"><span data-stu-id="4fb37-105">Implementing the Property Page COM Object</span></span>

<span data-ttu-id="4fb37-106">Uma extensão de folha de propriedades é um objeto COM implementado como um servidor em processo.</span><span class="sxs-lookup"><span data-stu-id="4fb37-106">A property sheet extension is a COM object implemented as an in-proc server.</span></span> <span data-ttu-id="4fb37-107">A extensão da folha de propriedades deve implementar as interfaces [**IShellExtInit**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit) e [**IShellPropSheetExt**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellpropsheetext) .</span><span class="sxs-lookup"><span data-stu-id="4fb37-107">The property sheet extension must implement the [**IShellExtInit**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit) and [**IShellPropSheetExt**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellpropsheetext) interfaces.</span></span> <span data-ttu-id="4fb37-108">Uma extensão de folha de propriedades é instanciada quando o usuário exibe a folha de propriedades de um objeto de uma classe para a qual a extensão da folha de propriedades foi registrada no especificador de exibição da classe.</span><span class="sxs-lookup"><span data-stu-id="4fb37-108">A property sheet extension is instantiated when the user displays the property sheet for an object of a class for which the property sheet extension has been registered in the display specifier of the class.</span></span>

-   [<span data-ttu-id="4fb37-109">Implementando IShellExtInit</span><span class="sxs-lookup"><span data-stu-id="4fb37-109">Implementing IShellExtInit</span></span>](#implementing-ishellextinit)
-   [<span data-ttu-id="4fb37-110">Implementando IShellPropSheetExt</span><span class="sxs-lookup"><span data-stu-id="4fb37-110">Implementing IShellPropSheetExt</span></span>](#implementing-ishellpropsheetext)
-   [<span data-ttu-id="4fb37-111">Passando o objeto de extensão para a página de propriedades</span><span class="sxs-lookup"><span data-stu-id="4fb37-111">Passing the Extension Object to the Property Page</span></span>](#passing-the-extension-object-to-the-property-page)
-   [<span data-ttu-id="4fb37-112">Trabalhando com o objeto de notificação</span><span class="sxs-lookup"><span data-stu-id="4fb37-112">Working With the Notification Object</span></span>](#working-with-the-notification-object)
-   [<span data-ttu-id="4fb37-113">Diversos</span><span class="sxs-lookup"><span data-stu-id="4fb37-113">Miscellaneous</span></span>](#miscellaneous)
-   [<span data-ttu-id="4fb37-114">Folhas de propriedades de seleção múltipla</span><span class="sxs-lookup"><span data-stu-id="4fb37-114">Multiple-Selection Property Sheets</span></span>](#multiple-selection-property-sheets)
-   [<span data-ttu-id="4fb37-115">Novidade no Windows Server 2003</span><span class="sxs-lookup"><span data-stu-id="4fb37-115">New with Windows Server 2003</span></span>](#new-with-windows-server-2003)
-   [<span data-ttu-id="4fb37-116">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="4fb37-116">Related topics</span></span>](#related-topics)

## <a name="implementing-ishellextinit"></a><span data-ttu-id="4fb37-117">Implementando IShellExtInit</span><span class="sxs-lookup"><span data-stu-id="4fb37-117">Implementing IShellExtInit</span></span>

<span data-ttu-id="4fb37-118">Depois que o objeto COM da extensão da folha de Propriedades for instanciado, o método [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) será chamado.</span><span class="sxs-lookup"><span data-stu-id="4fb37-118">After the property sheet extension COM object is instantiated, the [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) method is called.</span></span> <span data-ttu-id="4fb37-119">**IShellExtInit:: Initialize** fornece a extensão da folha de propriedades com um objeto [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) que contém dados pertencentes ao objeto de diretório que a folha de propriedades aplica.</span><span class="sxs-lookup"><span data-stu-id="4fb37-119">**IShellExtInit::Initialize** supplies the property sheet extension with an [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) object that contains data that pertains to the directory object that the property sheet applies.</span></span>

<span data-ttu-id="4fb37-120">O [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) contém dados no formato [**CFSTR \_ DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) .</span><span class="sxs-lookup"><span data-stu-id="4fb37-120">The [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) contains data in the [**CFSTR\_DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) format.</span></span> <span data-ttu-id="4fb37-121">O formato de dados **CFSTR \_ DSOBJECTNAMES** é um **HGLOBAL** que contém uma estrutura [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) .</span><span class="sxs-lookup"><span data-stu-id="4fb37-121">The **CFSTR\_DSOBJECTNAMES** data format is an **HGLOBAL** that contains a [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) structure.</span></span> <span data-ttu-id="4fb37-122">A estrutura **DSOBJECTNAMES** contém dados de objeto de diretório que a extensão de folha de propriedades aplica.</span><span class="sxs-lookup"><span data-stu-id="4fb37-122">The **DSOBJECTNAMES** structure contains directory object data that the property sheet extension applies.</span></span>

<span data-ttu-id="4fb37-123">O [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) também contém dados no formato [**de \_ \_ Opções de \_ especificação \_ de exibição CFSTR DS**](cfstr-ds-display-spec-options.md) .</span><span class="sxs-lookup"><span data-stu-id="4fb37-123">The [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) also contains data in the [**CFSTR\_DS\_DISPLAY\_SPEC\_OPTIONS**](cfstr-ds-display-spec-options.md) format.</span></span> <span data-ttu-id="4fb37-124">O formato de dados de **Opções de especificação de \_ \_ exibição CFSTR \_ \_ DS** é um **HGLOBAL** que contém uma estrutura [**DSDISPLAYSPECOPTIONS**](/windows/desktop/api/Dsclient/ns-dsclient-dsdisplayspecoptions) .</span><span class="sxs-lookup"><span data-stu-id="4fb37-124">The **CFSTR\_DS\_DISPLAY\_SPEC\_OPTIONS** data format is an **HGLOBAL** that contains a [**DSDISPLAYSPECOPTIONS**](/windows/desktop/api/Dsclient/ns-dsclient-dsdisplayspecoptions) structure.</span></span> <span data-ttu-id="4fb37-125">O **DSDISPLAYSPECOPTIONS** contém dados de configuração para uso pela extensão.</span><span class="sxs-lookup"><span data-stu-id="4fb37-125">The **DSDISPLAYSPECOPTIONS** contains configuration data for use by the extension.</span></span>

<span data-ttu-id="4fb37-126">Se qualquer valor diferente de **S \_ OK** for retornado de [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize), a folha de propriedades não será exibida.</span><span class="sxs-lookup"><span data-stu-id="4fb37-126">If any value other than **S\_OK** is returned from [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize), the property sheet is not displayed.</span></span>

<span data-ttu-id="4fb37-127">Os parâmetros *pidlFolder* e *HkeyProgID* do método [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) não são usados.</span><span class="sxs-lookup"><span data-stu-id="4fb37-127">The *pidlFolder* and *hkeyProgID* parameters of the [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) method are not used.</span></span>

<span data-ttu-id="4fb37-128">O ponteiro [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) pode ser salvo pela extensão incrementando a contagem de referência do **IDataObject**.</span><span class="sxs-lookup"><span data-stu-id="4fb37-128">The [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) pointer can be saved by the extension by incrementing the reference count of the **IDataObject**.</span></span> <span data-ttu-id="4fb37-129">Essa interface deve ser liberada quando não for mais necessária.</span><span class="sxs-lookup"><span data-stu-id="4fb37-129">This interface must be released when no longer required.</span></span>

## <a name="implementing-ishellpropsheetext"></a><span data-ttu-id="4fb37-130">Implementando IShellPropSheetExt</span><span class="sxs-lookup"><span data-stu-id="4fb37-130">Implementing IShellPropSheetExt</span></span>

<span data-ttu-id="4fb37-131">Após [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) retornar, o método [**IShellPropSheetExt:: AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) é chamado.</span><span class="sxs-lookup"><span data-stu-id="4fb37-131">After [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) returns, the [**IShellPropSheetExt::AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) method is called.</span></span> <span data-ttu-id="4fb37-132">A extensão da folha de propriedades deve adicionar a página ou as páginas durante esse método.</span><span class="sxs-lookup"><span data-stu-id="4fb37-132">The property sheet extension must add the page or pages during this method.</span></span> <span data-ttu-id="4fb37-133">Uma página de propriedades é criada preenchendo-se uma estrutura [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) e, em seguida, passando essa estrutura para a função [**CreatePropertySheetPage**](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) .</span><span class="sxs-lookup"><span data-stu-id="4fb37-133">A property page is created by filling a [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) structure and then passing this structure to the [**CreatePropertySheetPage**](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) function.</span></span> <span data-ttu-id="4fb37-134">A página de propriedades é adicionada à folha de propriedades chamando a função de retorno de chamada passada para **IShellPropSheetExt:: AddPages** no parâmetro *lpfnAddPage* .</span><span class="sxs-lookup"><span data-stu-id="4fb37-134">The property page is then added to the property sheet by calling the callback function passed to **IShellPropSheetExt::AddPages** in the *lpfnAddPage* parameter.</span></span>

<span data-ttu-id="4fb37-135">Se qualquer valor diferente de **S \_ OK** for retornado de [**IShellPropSheetExt:: AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages), a folha de propriedades não será exibida.</span><span class="sxs-lookup"><span data-stu-id="4fb37-135">If any value other than **S\_OK** is returned from [**IShellPropSheetExt::AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages), the property sheet is not displayed.</span></span>

<span data-ttu-id="4fb37-136">Se a extensão da folha de propriedades não for necessária para adicionar nenhuma página à folha de propriedades, ela não deverá chamar a função de retorno de chamada passada para [**IShellPropSheetExt:: AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) no parâmetro *lpfnAddPage* .</span><span class="sxs-lookup"><span data-stu-id="4fb37-136">If the property sheet extension is not required to add any pages to the property sheet, it should not call the callback function passed to [**IShellPropSheetExt::AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) in the *lpfnAddPage* parameter.</span></span>

<span data-ttu-id="4fb37-137">O método [**IShellPropSheetExt:: ReplacePage**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-replacepage) não é usado.</span><span class="sxs-lookup"><span data-stu-id="4fb37-137">The [**IShellPropSheetExt::ReplacePage**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-replacepage) method is not used.</span></span>

## <a name="passing-the-extension-object-to-the-property-page"></a><span data-ttu-id="4fb37-138">Passando o objeto de extensão para a página de propriedades</span><span class="sxs-lookup"><span data-stu-id="4fb37-138">Passing the Extension Object to the Property Page</span></span>

<span data-ttu-id="4fb37-139">O objeto de extensão de folha de propriedades é independente da página de propriedades.</span><span class="sxs-lookup"><span data-stu-id="4fb37-139">The property sheet extension object is independent from the property page.</span></span> <span data-ttu-id="4fb37-140">Em muitos casos, é desejável poder usar o objeto de extensão ou algum outro objeto da página de propriedades.</span><span class="sxs-lookup"><span data-stu-id="4fb37-140">In many cases, it is desirable to be able to use the extension object, or some other object, from the property page.</span></span> <span data-ttu-id="4fb37-141">Para fazer isso, defina o membro **lParam** da estrutura [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) como o ponteiro do objeto.</span><span class="sxs-lookup"><span data-stu-id="4fb37-141">To do this, set the **lParam** member of [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) structure to the object pointer.</span></span> <span data-ttu-id="4fb37-142">A página de propriedades pode então recuperar esse valor ao processar a mensagem do [**WM \_ INITDIALOG**](../dlgbox/wm-initdialog.md) .</span><span class="sxs-lookup"><span data-stu-id="4fb37-142">The property page can then retrieve this value when it processes the [**WM\_INITDIALOG**](../dlgbox/wm-initdialog.md) message.</span></span> <span data-ttu-id="4fb37-143">Para uma página de propriedades, o parâmetro *lParam* da mensagem do **WM \_ INITDIALOG** é um ponteiro para a estrutura **PROPSHEETPAGE** .</span><span class="sxs-lookup"><span data-stu-id="4fb37-143">For a property page, the *lParam* parameter of the **WM\_INITDIALOG** message is a pointer to the **PROPSHEETPAGE** structure.</span></span> <span data-ttu-id="4fb37-144">Recupere o ponteiro do objeto, convertendo o *lParam* da mensagem **\_ INITDIALOG do WM** em um ponteiro **PROPSHEETPAGE** e, em seguida, recuperando o membro **lParam** da estrutura **PROPSHEETPAGE** .</span><span class="sxs-lookup"><span data-stu-id="4fb37-144">Retrieve the object pointer by casting the *lParam* of the **WM\_INITDIALOG** message to a **PROPSHEETPAGE** pointer and then retrieving the **lParam** member of the **PROPSHEETPAGE** structure.</span></span>

<span data-ttu-id="4fb37-145">O exemplo de código C++ a seguir mostra como passar um objeto para uma página de propriedades.</span><span class="sxs-lookup"><span data-stu-id="4fb37-145">The following C++ code example shows how to pass an object to a property page.</span></span>


```C++
case WM_INITDIALOG:
    {
        LPPROPSHEETPAGE pPage = (LPPROPSHEETPAGE)lParam;

        if(NULL != pPage)
        {
            CPropSheetExt *pPropSheetExt;
            pPropSheetExt = (CPropSheetExt*)pPage->lParam;

            if(pPropSheetExt)
            {
                return pPropSheetExt>OnInitDialog(wParam, lParam);
            }
        }
    }
    break;
```



<span data-ttu-id="4fb37-146">Lembre-se de que depois que [**IShellPropSheetExt:: AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) for chamado, a folha de propriedades liberará o objeto de extensão de folha de propriedades e nunca o usará novamente.</span><span class="sxs-lookup"><span data-stu-id="4fb37-146">Be aware that after [**IShellPropSheetExt::AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) is called, the property sheet will release the property sheet extension object and never use it again.</span></span> <span data-ttu-id="4fb37-147">Isso significa que o objeto de extensão seria excluído antes de a página de propriedades ser exibida.</span><span class="sxs-lookup"><span data-stu-id="4fb37-147">This means that the extension object would be deleted before the property page is displayed.</span></span> <span data-ttu-id="4fb37-148">Quando a página tentar acessar o ponteiro do objeto, a memória será liberada e o ponteiro não será válido.</span><span class="sxs-lookup"><span data-stu-id="4fb37-148">When the page attempts to access the object pointer, the memory will have been freed and the pointer will not be valid.</span></span> <span data-ttu-id="4fb37-149">Para corrigir isso, aumente a contagem de referência para o objeto de extensão quando a página for adicionada e, em seguida, libere o objeto quando a caixa de diálogo da página de Propriedades for destruída.</span><span class="sxs-lookup"><span data-stu-id="4fb37-149">To correct this, increment the reference count for the extension object when the page is added and then release the object when the property page dialog is destroyed.</span></span> <span data-ttu-id="4fb37-150">Isso cria outro problema porque a caixa de diálogo página de propriedades não é criada até a primeira vez em que a página é exibida.</span><span class="sxs-lookup"><span data-stu-id="4fb37-150">This creates another issue because the property page dialog box is not created until the first time the page is displayed.</span></span> <span data-ttu-id="4fb37-151">Se o usuário nunca selecionar a página de extensão, a página nunca será criada e destruída.</span><span class="sxs-lookup"><span data-stu-id="4fb37-151">If the user never selects the extension page, the page never gets created and destroyed.</span></span> <span data-ttu-id="4fb37-152">Isso faz com que o objeto de extensão nunca seja liberado, portanto ocorre um vazamento de memória.</span><span class="sxs-lookup"><span data-stu-id="4fb37-152">This results in the extension object never getting released, so a memory leak occurs.</span></span> <span data-ttu-id="4fb37-153">Para evitar isso, implemente uma função de retorno de chamada de página de propriedades.</span><span class="sxs-lookup"><span data-stu-id="4fb37-153">To avoid this, implement a property page callback function.</span></span> <span data-ttu-id="4fb37-154">Para fazer isso, adicione o sinalizador **PSP \_ USECALLBACK** ao membro **dwFlags** da estrutura [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) e defina o membro **pfnCallback** da estrutura **PROPSHEETPAGE** como o endereço da função [**PropSheetPageProc**](/windows/win32/api/prsht/nc-prsht-lpfnpspcallbacka) implementada.</span><span class="sxs-lookup"><span data-stu-id="4fb37-154">To do this, add the **PSP\_USECALLBACK** flag to the **dwFlags** member of the [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) structure and set the **pfnCallback** member of the **PROPSHEETPAGE** structure to the address of the [**PropSheetPageProc**](/windows/win32/api/prsht/nc-prsht-lpfnpspcallbacka) function implemented.</span></span> <span data-ttu-id="4fb37-155">Quando a função **PropSheetPageProc** recebe a notificação de **\_ liberação de PSPCB** , o parâmetro *PPSP* de **PropSheetPageProc** contém um ponteiro para a estrutura **PROPSHEETPAGE** .</span><span class="sxs-lookup"><span data-stu-id="4fb37-155">When the **PropSheetPageProc** function receives the **PSPCB\_RELEASE** notification, the *ppsp* parameter of the **PropSheetPageProc** contains a pointer to the **PROPSHEETPAGE** structure.</span></span> <span data-ttu-id="4fb37-156">O membro **lParam** da estrutura **PROPSHEETPAGE** contém o ponteiro de extensão que pode ser usado para liberar o objeto.</span><span class="sxs-lookup"><span data-stu-id="4fb37-156">The **lParam** member of the **PROPSHEETPAGE** structure contains the extension pointer which can be used to release the object.</span></span>

<span data-ttu-id="4fb37-157">O exemplo de código C++ a seguir mostra como liberar um objeto de extensão.</span><span class="sxs-lookup"><span data-stu-id="4fb37-157">The following C++ code example shows how to release an extension object.</span></span>


```C++
UINT CALLBACK CPropSheetExt::PageCallbackProc(  HWND hWnd,
                                                UINT uMsg,
                                                LPPROPSHEETPAGE ppsp)
{
    switch(uMsg)
    {
    case PSPCB_CREATE:
        // Must return TRUE to enable the page to be created.
        return TRUE;

    case PSPCB_RELEASE:
        {
            /*
            Release the object. This is called even if the page dialog box was 
            never actually created.
            */
            CPropSheetExt *pPropSheetExt = (CPropSheetExt*)ppsp->lParam;

            if(pPropSheetExt)
            {
                pPropSheetExt->Release();
            }
        }
        break;
    }

    return FALSE;
}
```



## <a name="working-with-the-notification-object"></a><span data-ttu-id="4fb37-158">Trabalhando com o objeto de notificação</span><span class="sxs-lookup"><span data-stu-id="4fb37-158">Working With the Notification Object</span></span>

<span data-ttu-id="4fb37-159">Como as páginas de extensão da folha de propriedades são exibidas em uma folha de propriedades criada por um componente desconhecido para a extensão, é necessário usar um "Gerenciador" para lidar com a transferência de dados entre as páginas de extensão e a folha de propriedades.</span><span class="sxs-lookup"><span data-stu-id="4fb37-159">Because the property sheet extension pages are displayed within a property sheet created by a component unknown to the extension, it is necessary to use a "manager" to handle the data transfer between the extension pages and the property sheet.</span></span> <span data-ttu-id="4fb37-160">Esse "Gerenciador" é chamado de objeto de notificação.</span><span class="sxs-lookup"><span data-stu-id="4fb37-160">This "manager" is called the notification object.</span></span> <span data-ttu-id="4fb37-161">O objeto de notificação Opera como um moderador entre as páginas individuais e a folha de propriedades.</span><span class="sxs-lookup"><span data-stu-id="4fb37-161">The notification object operates as a moderator between the individual pages and the property sheet.</span></span>

<span data-ttu-id="4fb37-162">Quando o objeto de extensão de folha de propriedades é inicializado, a extensão deve criar um objeto de notificação chamando [**ADsPropCreateNotifyObj**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcreatenotifyobj), passando o [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) obtido de [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) e o nome do objeto de diretório.</span><span class="sxs-lookup"><span data-stu-id="4fb37-162">When the property sheet extension object is initialized, the extension must create a notification object by calling [**ADsPropCreateNotifyObj**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcreatenotifyobj), passing the [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) obtained from [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) and the directory object name.</span></span> <span data-ttu-id="4fb37-163">Não é necessário incrementar a contagem de referência da interface **IDataObject** , pois o objeto de notificação criado pela função **ADsPropCreateNotifyObj** fará isso.</span><span class="sxs-lookup"><span data-stu-id="4fb37-163">It is not necessary to increment the reference count of the **IDataObject** interface, because the notification object created by **ADsPropCreateNotifyObj** function will do this.</span></span> <span data-ttu-id="4fb37-164">O identificador de objeto de notificação fornecido pelo **ADsPropCreateNotifyObj** deve ser salvo para uso posterior.</span><span class="sxs-lookup"><span data-stu-id="4fb37-164">The notification object handle provided by **ADsPropCreateNotifyObj** should be saved for later use.</span></span> <span data-ttu-id="4fb37-165">**ADsPropCreateNotifyObj** pode ser chamado durante **IShellExtInit:: Initialize** ou [**IShellPropSheetExt:: AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages).</span><span class="sxs-lookup"><span data-stu-id="4fb37-165">**ADsPropCreateNotifyObj** can be either called during **IShellExtInit::Initialize** or [**IShellPropSheetExt::AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages).</span></span> <span data-ttu-id="4fb37-166">Quando a extensão da folha de propriedades é desligada, ela deve enviar uma mensagem de [**saída do WM \_ ADSPROP \_ Notify \_**](wm-adsprop-notify-exit.md) para o objeto de notificação.</span><span class="sxs-lookup"><span data-stu-id="4fb37-166">When the property sheet extension is shut down, it must send a [**WM\_ADSPROP\_NOTIFY\_EXIT**](wm-adsprop-notify-exit.md) message to the notification object.</span></span> <span data-ttu-id="4fb37-167">Isso faz com que o objeto de notificação se destrua.</span><span class="sxs-lookup"><span data-stu-id="4fb37-167">This causes the notification object to destroy itself.</span></span> <span data-ttu-id="4fb37-168">Isso é melhor feito quando a função [**PropSheetPageProc**](/windows/win32/api/prsht/nc-prsht-lpfnpspcallbacka) recebe a notificação de **\_ liberação de PSPCB** .</span><span class="sxs-lookup"><span data-stu-id="4fb37-168">This is best done when the [**PropSheetPageProc**](/windows/win32/api/prsht/nc-prsht-lpfnpspcallbacka) function receives the **PSPCB\_RELEASE** notification.</span></span>

<span data-ttu-id="4fb37-169">A extensão da folha de propriedades pode obter dados além dos fornecidos pelo formato de área de transferência [**CFSTR \_ DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) chamando [**ADsPropGetInitInfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo).</span><span class="sxs-lookup"><span data-stu-id="4fb37-169">The property sheet extension can obtain data in addition to that provided by the [**CFSTR\_DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) clipboard format by calling [**ADsPropGetInitInfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo).</span></span> <span data-ttu-id="4fb37-170">Uma das vantagens de usar o **ADsPropGetInitInfo** é que ele fornece um objeto [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) usado para trabalhar de forma programática com o objeto de diretório.</span><span class="sxs-lookup"><span data-stu-id="4fb37-170">One of the advantages of using **ADsPropGetInitInfo** is that it provides an [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) object used to programmatically work with the directory object.</span></span>

> [!Note]  
> <span data-ttu-id="4fb37-171">Ao contrário da maioria dos métodos e funções COM, [**ADsPropGetInitInfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo) não incrementa a contagem de referência para o objeto [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) .</span><span class="sxs-lookup"><span data-stu-id="4fb37-171">Unlike most COM methods and functions, [**ADsPropGetInitInfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo) does not increment the reference count for the [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) object.</span></span> <span data-ttu-id="4fb37-172">O **IDirectoryObject** não deve ser liberado a menos que a contagem de referência seja manualmente incrementada primeiro.</span><span class="sxs-lookup"><span data-stu-id="4fb37-172">The **IDirectoryObject** must not be released unless the reference count is manually incremented first.</span></span>

 

<span data-ttu-id="4fb37-173">Quando a página de propriedades é criada pela primeira vez, a extensão deve registrar a página com o objeto de notificação chamando [**ADsPropSetHwnd**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwnd) com o identificador de janela da página.</span><span class="sxs-lookup"><span data-stu-id="4fb37-173">When the property page is first created, the extension should register the page with the notification object by calling [**ADsPropSetHwnd**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwnd) with the window handle of the page.</span></span>

<span data-ttu-id="4fb37-174">[**ADsPropCheckIfWritable**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcheckifwritable) é uma função de utilitário que a extensão de folha de propriedades pode usar para determinar se uma propriedade pode ser gravada.</span><span class="sxs-lookup"><span data-stu-id="4fb37-174">[**ADsPropCheckIfWritable**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcheckifwritable) is a utility function that the property sheet extension can use to determine if a property can be written.</span></span>

## <a name="miscellaneous"></a><span data-ttu-id="4fb37-175">Diversos</span><span class="sxs-lookup"><span data-stu-id="4fb37-175">Miscellaneous</span></span>

<span data-ttu-id="4fb37-176">O identificador da página de propriedades é passado para o procedimento da caixa de diálogo página.</span><span class="sxs-lookup"><span data-stu-id="4fb37-176">The handle of the property page is passed to the page dialog box procedure.</span></span> <span data-ttu-id="4fb37-177">A folha de propriedades é o pai direto da página de propriedades, portanto, o identificador da folha de propriedades pode ser obtido chamando a função [**GetParent**](/windows/win32/api/winuser/nf-winuser-getparent) com o identificador da página de propriedades.</span><span class="sxs-lookup"><span data-stu-id="4fb37-177">The property sheet is the direct parent of the property page, so the handle of the property sheet can be obtained by calling the [**GetParent**](/windows/win32/api/winuser/nf-winuser-getparent) function with the property page handle.</span></span>

<span data-ttu-id="4fb37-178">Quando o conteúdo da página de extensão é alterado, a extensão deve usar a macro [**PropSheet \_ Changed**](/windows/win32/api/prsht/nf-prsht-propsheet_changed) para notificar a folha de propriedades das alterações.</span><span class="sxs-lookup"><span data-stu-id="4fb37-178">When the contents of the extension page changes, the extension should use the [**PropSheet\_Changed**](/windows/win32/api/prsht/nf-prsht-propsheet_changed) macro to notify the property sheet of changes.</span></span> <span data-ttu-id="4fb37-179">Em seguida, a folha de propriedades habilitará o botão Aplicar.</span><span class="sxs-lookup"><span data-stu-id="4fb37-179">The property sheet will then enable the Apply button.</span></span>

## <a name="multiple-selection-property-sheets"></a><span data-ttu-id="4fb37-180">Multiple-Selection folhas de propriedades</span><span class="sxs-lookup"><span data-stu-id="4fb37-180">Multiple-Selection Property Sheets</span></span>

<span data-ttu-id="4fb37-181">Com os sistemas operacionais Windows Server 2003 e posteriores, os snap-ins administrativos do MMC de Active Directory dão suporte a extensões de folha de propriedades para vários objetos de diretório.</span><span class="sxs-lookup"><span data-stu-id="4fb37-181">With Windows Server 2003 and later operating systems, the Active Directory administrative MMC snap-ins support property sheet extensions for multiple directory objects.</span></span> <span data-ttu-id="4fb37-182">Essas folhas de propriedades são exibidas quando as propriedades são exibidas para mais de um item por vez.</span><span class="sxs-lookup"><span data-stu-id="4fb37-182">These property sheets are displayed when the properties are viewed for more than one item at a time.</span></span> <span data-ttu-id="4fb37-183">A principal diferença entre uma extensão de folha de propriedades de seleção única e uma extensão de folha de propriedades de seleção múltipla é que a estrutura [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) fornecida pelo formato [**CFSTR \_ DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) clipboard em [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) conterá mais de uma estrutura de [**DSOBJECT**](/windows/desktop/api/Dsclient/ns-dsclient-dsobject) .</span><span class="sxs-lookup"><span data-stu-id="4fb37-183">The primary difference between a single-selection property sheet extension and a multiple-selection property sheet extension is that the [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) structure supplied by the [**CFSTR\_DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) clipboard format in [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) will contain more than one [**DSOBJECT**](/windows/desktop/api/Dsclient/ns-dsclient-dsobject) structure.</span></span>

<span data-ttu-id="4fb37-184">Quando o objeto de notificação é criado, uma extensão de folha de propriedades de seleção múltipla deve passar um nome exclusivo que é fornecido pelo snap-in em vez de um nome criado pela extensão.</span><span class="sxs-lookup"><span data-stu-id="4fb37-184">When the notification object is created, a multi-selection property sheet extension must pass a unique name that is provided by the snap-in rather than a name created by the extension.</span></span> <span data-ttu-id="4fb37-185">Para obter o nome exclusivo, solicite o formato de área de transferência [**CFSTR \_ DS \_ MULTISELECTPROPPAGE**](cfstr-ds-multiselectproppage.md) do [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) obtido de [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize).</span><span class="sxs-lookup"><span data-stu-id="4fb37-185">To obtain the unique name, request the [**CFSTR\_DS\_MULTISELECTPROPPAGE**](cfstr-ds-multiselectproppage.md) clipboard format from the [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) obtained from [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize).</span></span> <span data-ttu-id="4fb37-186">Esses dados são um **HGLOBAL** que contém uma cadeia de caracteres Unicode terminada em nulo que é o nome exclusivo.</span><span class="sxs-lookup"><span data-stu-id="4fb37-186">This data is an **HGLOBAL** that contains a null-terminated Unicode string that is the unique name.</span></span> <span data-ttu-id="4fb37-187">Esse nome exclusivo é passado para a função [**ADsPropCreateNotifyObj**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcreatenotifyobj) para criar o objeto de notificação.</span><span class="sxs-lookup"><span data-stu-id="4fb37-187">This unique name is then passed to the [**ADsPropCreateNotifyObj**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcreatenotifyobj) function to create the notification object.</span></span> <span data-ttu-id="4fb37-188">A função de exemplo **CreateADsNotificationObject** no [código de exemplo para implementação do objeto com da folha de propriedades](example-code-for-implementation-of-the-property-sheet-com-object.md) demonstra como fazer isso corretamente, bem como ser compatível com versões anteriores do snap-in que não dão suporte a folhas de propriedades de seleção múltipla.</span><span class="sxs-lookup"><span data-stu-id="4fb37-188">The **CreateADsNotificationObject** example function in [Example Code for Implementation of the Property Sheet COM Object](example-code-for-implementation-of-the-property-sheet-com-object.md) demonstrates how to do this correctly, as well as being compatible with earlier versions of the snap-in that do not support multi-selection property sheets.</span></span>

<span data-ttu-id="4fb37-189">Para folhas de propriedades de seleção múltipla, o sistema só é associado ao primeiro objeto na matriz [**DSOBJECT**](/windows/desktop/api/Dsclient/ns-dsclient-dsobject) .</span><span class="sxs-lookup"><span data-stu-id="4fb37-189">For multiple-selection property sheets, the system only binds to the first object in the [**DSOBJECT**](/windows/desktop/api/Dsclient/ns-dsclient-dsobject) array.</span></span> <span data-ttu-id="4fb37-190">Por isso, o [**ADsPropGetInitInfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo) fornece apenas os atributos [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) e Write-graváveis para o primeiro objeto na matriz.</span><span class="sxs-lookup"><span data-stu-id="4fb37-190">Because of this, [**ADsPropGetInitInfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo) only supplies the [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) and write-able attributes for the first object in the array.</span></span> <span data-ttu-id="4fb37-191">Os outros objetos na matriz não estão associados a.</span><span class="sxs-lookup"><span data-stu-id="4fb37-191">The other objects in the array are not bound to.</span></span>

<span data-ttu-id="4fb37-192">Uma extensão de folha de propriedades de seleção múltipla é registrada no atributo [**adminMultiselectPropertyPages**](/windows/desktop/ADSchema/a-adminmultiselectpropertypages) .</span><span class="sxs-lookup"><span data-stu-id="4fb37-192">A multiple-selection property sheet extension is registered under the [**adminMultiselectPropertyPages**](/windows/desktop/ADSchema/a-adminmultiselectpropertypages) attribute.</span></span>

## <a name="new-with-windows-server-2003"></a><span data-ttu-id="4fb37-193">Novidade no Windows Server 2003</span><span class="sxs-lookup"><span data-stu-id="4fb37-193">New with Windows Server 2003</span></span>

<span data-ttu-id="4fb37-194">Os recursos a seguir são novos no Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="4fb37-194">The following features are new with Windows Server 2003.</span></span>

<span data-ttu-id="4fb37-195">Se a página de propriedades encontrar um erro, [**ADsPropSendErrorMessage**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsenderrormessage) poderá ser chamado com os dados de erro apropriados.</span><span class="sxs-lookup"><span data-stu-id="4fb37-195">If the property page encounters an error, [**ADsPropSendErrorMessage**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsenderrormessage) can be called with the appropriate error data.</span></span> <span data-ttu-id="4fb37-196">**ADsPropSendErrorMessage** armazenará todas as mensagens de erro em uma fila.</span><span class="sxs-lookup"><span data-stu-id="4fb37-196">**ADsPropSendErrorMessage** will store all error messages in a queue.</span></span> <span data-ttu-id="4fb37-197">Essas mensagens serão exibidas na próxima vez em que [**ADsPropShowErrorDialog**](/windows/desktop/api/Adsprop/nf-adsprop-adspropshowerrordialog) for chamado.</span><span class="sxs-lookup"><span data-stu-id="4fb37-197">These messages will be displayed the next time [**ADsPropShowErrorDialog**](/windows/desktop/api/Adsprop/nf-adsprop-adspropshowerrordialog) is called.</span></span> <span data-ttu-id="4fb37-198">Quando **ADsPropShowErrorDialog** retorna, as mensagens em fila são excluídas.</span><span class="sxs-lookup"><span data-stu-id="4fb37-198">When **ADsPropShowErrorDialog** returns, the queued messages are deleted.</span></span>

<span data-ttu-id="4fb37-199">O Windows Server 2003 apresenta a função [**ADsPropSetHwndWithTitle**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwndwithtitle) .</span><span class="sxs-lookup"><span data-stu-id="4fb37-199">Windows Server 2003 introduces the [**ADsPropSetHwndWithTitle**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwndwithtitle) function.</span></span> <span data-ttu-id="4fb37-200">Essa função é semelhante a [**ADsPropSetHwnd**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwnd), mas inclui o título da página.</span><span class="sxs-lookup"><span data-stu-id="4fb37-200">This function is similar to [**ADsPropSetHwnd**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwnd), but includes the page title.</span></span> <span data-ttu-id="4fb37-201">Isso habilita a caixa de diálogo de erro exibida pelo [**ADsPropShowErrorDialog**](/windows/desktop/api/Adsprop/nf-adsprop-adspropshowerrordialog) para fornecer dados mais úteis ao usuário.</span><span class="sxs-lookup"><span data-stu-id="4fb37-201">This enables the error dialog box displayed by [**ADsPropShowErrorDialog**](/windows/desktop/api/Adsprop/nf-adsprop-adspropshowerrordialog) to provide more useful data to the user.</span></span> <span data-ttu-id="4fb37-202">Se a extensão da folha de propriedades usar a função **ADsPropShowErrorDialog** , a extensão deverá usar **ADsPropSetHwndWithTitle** em vez de **ADsPropSetHwnd**.</span><span class="sxs-lookup"><span data-stu-id="4fb37-202">If the property sheet extension uses the **ADsPropShowErrorDialog** function, the extension should use **ADsPropSetHwndWithTitle** rather than **ADsPropSetHwnd**.</span></span>

## <a name="related-topics"></a><span data-ttu-id="4fb37-203">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="4fb37-203">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="4fb37-204">Exemplo de código para implementação do objeto COM da folha de propriedades</span><span class="sxs-lookup"><span data-stu-id="4fb37-204">Example Code for Implementation of the Property Sheet COM Object</span></span>](example-code-for-implementation-of-the-property-sheet-com-object.md)
</dt> </dl>

 

 