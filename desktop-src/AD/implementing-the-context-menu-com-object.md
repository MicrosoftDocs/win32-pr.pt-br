---
title: Implementando o objeto COM do menu de contexto
description: Uma extensão de menu de contexto é um objeto COM implementado como um servidor em processo.
ms.assetid: 362dd8e5-1518-4bf4-ac53-115263cd6c62
ms.tgt_platform: multiple
keywords:
- menu de contexto do objeto COM AD
- menu de contexto COM o AD Object, implementando
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a34d6b487d130327b379ed845f2d0157f2b28056
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/17/2020
ms.locfileid: "105752989"
---
# <a name="implementing-the-context-menu-com-object"></a><span data-ttu-id="1b920-105">Implementando o objeto COM do menu de contexto</span><span class="sxs-lookup"><span data-stu-id="1b920-105">Implementing the Context Menu COM Object</span></span>

<span data-ttu-id="1b920-106">Uma extensão de menu de contexto é um objeto COM implementado como um servidor em processo.</span><span class="sxs-lookup"><span data-stu-id="1b920-106">A context menu extension is a COM object implemented as an in-proc server.</span></span> <span data-ttu-id="1b920-107">A extensão do menu de contexto deve implementar as interfaces [**IShellExtInit**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit) e [**IContextMenu**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-icontextmenu) .</span><span class="sxs-lookup"><span data-stu-id="1b920-107">The context menu extension must implement the [**IShellExtInit**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit) and [**IContextMenu**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-icontextmenu) interfaces.</span></span> <span data-ttu-id="1b920-108">Uma extensão de menu de contexto é instanciada quando o usuário exibe o menu de contexto de um objeto de uma classe para a qual a extensão do menu de contexto foi registrada.</span><span class="sxs-lookup"><span data-stu-id="1b920-108">A context menu extension is instantiated when the user displays the context menu for an object of a class for which the context menu extension has been registered.</span></span>

## <a name="implementing-ishellextinit"></a><span data-ttu-id="1b920-109">Implementando IShellExtInit</span><span class="sxs-lookup"><span data-stu-id="1b920-109">Implementing IShellExtInit</span></span>

<span data-ttu-id="1b920-110">Depois que o objeto COM da extensão do menu de contexto é instanciado, o método [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) é chamado.</span><span class="sxs-lookup"><span data-stu-id="1b920-110">After the context menu extension COM object is instantiated, the [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) method is called.</span></span> <span data-ttu-id="1b920-111">**IShellExtInit:: Initialize** fornece a extensão do menu de contexto com um objeto [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) que contém dados pertinentes ao objeto de diretório ao qual o menu de contexto se aplica.</span><span class="sxs-lookup"><span data-stu-id="1b920-111">**IShellExtInit::Initialize** supplies the context menu extension with an [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) object that contains data pertinent to the directory object that the context menu applies to.</span></span>

<span data-ttu-id="1b920-112">O [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) contém dados no formato [**CFSTR \_ DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) .</span><span class="sxs-lookup"><span data-stu-id="1b920-112">The [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) contains data in the [**CFSTR\_DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) format.</span></span> <span data-ttu-id="1b920-113">O formato de dados **CFSTR \_ DSOBJECTNAMES** é um **HGLOBAL** que contém uma estrutura [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) .</span><span class="sxs-lookup"><span data-stu-id="1b920-113">The **CFSTR\_DSOBJECTNAMES** data format is an **HGLOBAL** that contains a [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) structure.</span></span> <span data-ttu-id="1b920-114">A estrutura **DSOBJECTNAMES** contém dados sobre o objeto de diretório ao qual a extensão de folha de propriedades se aplica.</span><span class="sxs-lookup"><span data-stu-id="1b920-114">The **DSOBJECTNAMES** structure contains data about the directory object that the property sheet extension applies to.</span></span>

<span data-ttu-id="1b920-115">O [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) também contém dados no formato [**de \_ \_ Opções de \_ especificação \_ de exibição CFSTR DS**](cfstr-ds-display-spec-options.md) .</span><span class="sxs-lookup"><span data-stu-id="1b920-115">The [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) also contains data in the [**CFSTR\_DS\_DISPLAY\_SPEC\_OPTIONS**](cfstr-ds-display-spec-options.md) format.</span></span> <span data-ttu-id="1b920-116">O formato de dados de **Opções de especificação de \_ \_ exibição CFSTR \_ \_ DS** é um **HGLOBAL** que contém uma estrutura [**DSDISPLAYSPECOPTIONS**](/windows/desktop/api/Dsclient/ns-dsclient-dsdisplayspecoptions) .</span><span class="sxs-lookup"><span data-stu-id="1b920-116">The **CFSTR\_DS\_DISPLAY\_SPEC\_OPTIONS** data format is an **HGLOBAL** that contains a [**DSDISPLAYSPECOPTIONS**](/windows/desktop/api/Dsclient/ns-dsclient-dsdisplayspecoptions) structure.</span></span> <span data-ttu-id="1b920-117">O **DSDISPLAYSPECOPTIONS** contém dados de configuração para uso pela extensão.</span><span class="sxs-lookup"><span data-stu-id="1b920-117">The **DSDISPLAYSPECOPTIONS** contains configuration data for use by the extension.</span></span>

<span data-ttu-id="1b920-118">Se qualquer valor diferente de **S \_ OK** for retornado de [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize), a extensão do menu de contexto não será usada.</span><span class="sxs-lookup"><span data-stu-id="1b920-118">If any value other than **S\_OK** is returned from [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize), the context menu extension will not be used.</span></span>

<span data-ttu-id="1b920-119">Os parâmetros *pidlFolder* e *HkeyProgID* do método [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) não são usados.</span><span class="sxs-lookup"><span data-stu-id="1b920-119">The *pidlFolder* and *hkeyProgID* parameters of the [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) method are not used.</span></span>

## <a name="implementing-icontextmenu"></a><span data-ttu-id="1b920-120">Implementando IContextMenu</span><span class="sxs-lookup"><span data-stu-id="1b920-120">Implementing IContextMenu</span></span>

<span data-ttu-id="1b920-121">Após [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) retornar, o método [**IContextMenu:: QueryContextMenu**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-querycontextmenu) será chamado para obter o item de menu ou os itens que a extensão do menu de contexto adicionará.</span><span class="sxs-lookup"><span data-stu-id="1b920-121">After [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) returns, the [**IContextMenu::QueryContextMenu**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-querycontextmenu) method is called to obtain the menu item or items that the context menu extension will add.</span></span> <span data-ttu-id="1b920-122">A implementação de **QueryContextMenu** é razoavelmente simples.</span><span class="sxs-lookup"><span data-stu-id="1b920-122">The **QueryContextMenu** implementation is fairly straightforward.</span></span> <span data-ttu-id="1b920-123">A extensão do menu de contexto adiciona seus itens de menu usando o [**InsertMenuItem**](/windows/win32/api/winuser/nf-winuser-insertmenuitema) ou a função semelhante.</span><span class="sxs-lookup"><span data-stu-id="1b920-123">The context menu extension adds its menu items using the [**InsertMenuItem**](/windows/win32/api/winuser/nf-winuser-insertmenuitema) or similar function.</span></span> <span data-ttu-id="1b920-124">Os identificadores de comando de menu devem ser maiores ou iguais a *idCmdFirst* e devem ser menores que *idCmdLast*.</span><span class="sxs-lookup"><span data-stu-id="1b920-124">The menu command identifiers must be greater than or equal to *idCmdFirst* and must be less than *idCmdLast*.</span></span> <span data-ttu-id="1b920-125">**QueryContextMenu** deve retornar o maior identificador numérico adicionado ao menu mais um.</span><span class="sxs-lookup"><span data-stu-id="1b920-125">**QueryContextMenu** must return the greatest numeric identifier added to the menu plus one.</span></span> <span data-ttu-id="1b920-126">A melhor maneira de atribuir identificadores de comando de menu é iniciar em zero e trabalhar em sequência.</span><span class="sxs-lookup"><span data-stu-id="1b920-126">The best way to assign menu command identifiers is to start at zero and work up in sequence.</span></span> <span data-ttu-id="1b920-127">Se a extensão do menu de contexto não precisar de nenhum item de menu, ela deverá simplesmente não adicionar nenhum item ao menu e retornar zero de **QueryContextMenu**.</span><span class="sxs-lookup"><span data-stu-id="1b920-127">If the context menu extension does not need to any menu items, it should simply not add any items to the menu and return zero from **QueryContextMenu**.</span></span>

<span data-ttu-id="1b920-128">[**IContextMenu:: GetCommandString**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-getcommandstring) é chamado para recuperar dados textuais para o item de menu, como texto de ajuda a ser exibido para o item de menu.</span><span class="sxs-lookup"><span data-stu-id="1b920-128">[**IContextMenu::GetCommandString**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-getcommandstring) is called to retrieve textual data for the menu item, such as help text to be displayed for the menu item.</span></span> <span data-ttu-id="1b920-129">É possível que o host do menu de contexto use cadeias de caracteres Unicode enquanto a extensão usa cadeias de caracteres ANSI.</span><span class="sxs-lookup"><span data-stu-id="1b920-129">It is possible that the context menu host will use Unicode strings while the extension uses ANSI strings.</span></span> <span data-ttu-id="1b920-130">Por isso, os casos **de \_ GCS helptexta**, **GCS \_ HELPTEXTW**, **GCS \_ verba** e **GCS \_ VERBW** devem ser tratados individualmente.</span><span class="sxs-lookup"><span data-stu-id="1b920-130">Because of this, the **GCS\_HELPTEXTA**, **GCS\_HELPTEXTW**, **GCS\_VERBA** and **GCS\_VERBW** cases must be handled individually.</span></span> <span data-ttu-id="1b920-131">A implementação desse método é opcional.</span><span class="sxs-lookup"><span data-stu-id="1b920-131">Implementation of this method is optional.</span></span>

<span data-ttu-id="1b920-132">[**IContextMenu:: InvokeCommand**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-invokecommand) é chamado quando um dos itens de menu instalados pela extensão do menu de contexto é selecionado.</span><span class="sxs-lookup"><span data-stu-id="1b920-132">[**IContextMenu::InvokeCommand**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-invokecommand) is called when one of the menu items installed by the context menu extension is selected.</span></span> <span data-ttu-id="1b920-133">O menu de contexto executa ou inicia as ações desejadas em resposta a esse método.</span><span class="sxs-lookup"><span data-stu-id="1b920-133">The context menu performs or initiates the desired actions in response to this method.</span></span>

 

 