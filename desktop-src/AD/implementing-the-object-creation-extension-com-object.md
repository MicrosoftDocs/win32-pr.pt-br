---
title: Implementando o objeto COM da extensão de criação de objeto
description: Uma extensão de criação de objeto é um objeto COM implementado como um servidor em processo. As extensões de criação de objeto primário e secundário devem implementar a interface IDsAdminNewObjExt.
ms.assetid: 0a8ed0ed-9dcb-4373-b549-7da3f3d9f641
ms.tgt_platform: multiple
keywords:
- Implementando o objeto COM do AD de extensão de criação de objetos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 05c1a9da94caa300c1277cf6f6030357ca9d573d
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/17/2020
ms.locfileid: "104007307"
---
# <a name="implementing-the-object-creation-extension-com-object"></a><span data-ttu-id="1c7b7-105">Implementando o objeto COM da extensão de criação de objeto</span><span class="sxs-lookup"><span data-stu-id="1c7b7-105">Implementing the Object Creation Extension COM Object</span></span>

<span data-ttu-id="1c7b7-106">Uma extensão de criação de objeto é um objeto COM implementado como um servidor em processo.</span><span class="sxs-lookup"><span data-stu-id="1c7b7-106">An object creation extension is a COM object implemented as an in-proc server.</span></span> <span data-ttu-id="1c7b7-107">As extensões de criação de objeto primário e secundário devem implementar a interface [**IDsAdminNewObjExt**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobjext) .</span><span class="sxs-lookup"><span data-stu-id="1c7b7-107">Both primary and secondary object creation extensions must implement the [**IDsAdminNewObjExt**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobjext) interface.</span></span>

## <a name="implementing-idsadminnewobjext"></a><span data-ttu-id="1c7b7-108">Implementando IDsAdminNewObjExt</span><span class="sxs-lookup"><span data-stu-id="1c7b7-108">Implementing IDsAdminNewObjExt</span></span>

<span data-ttu-id="1c7b7-109">Quando o assistente para criação de objetos é criado, ele inicializa cada extensão de criação de objeto chamando o método [**IDsAdminNewObjExt:: Initialize**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-initialize) da extensão.</span><span class="sxs-lookup"><span data-stu-id="1c7b7-109">When the object creation wizard is created, it initializes each object creation extension by calling the extension's [**IDsAdminNewObjExt::Initialize**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-initialize) method.</span></span> <span data-ttu-id="1c7b7-110">O método **Initialize** fornece a extensão com informações sobre o contêiner no qual o objeto está sendo criado, o nome da classe do novo objeto e as informações sobre o próprio assistente.</span><span class="sxs-lookup"><span data-stu-id="1c7b7-110">The **Initialize** method supplies the extension with information about the container the object is being created in, the class name of the new object and information about the wizard itself.</span></span> <span data-ttu-id="1c7b7-111">Se o assistente de criação de objetos for iniciado para criar um novo objeto a partir de um objeto existente, o parâmetro *pADsCopySource* não será **nulo**.</span><span class="sxs-lookup"><span data-stu-id="1c7b7-111">If the object creation wizard is started to create a new object from an existing object, the *pADsCopySource* parameter will not be **NULL**.</span></span> <span data-ttu-id="1c7b7-112">Nesse caso, a extensão deve tentar obter o máximo de dados do objeto que está sendo copiado como é viável.</span><span class="sxs-lookup"><span data-stu-id="1c7b7-112">In this case, the extension should attempt to obtain as much data from the object being copied as is feasible.</span></span>

<span data-ttu-id="1c7b7-113">Depois que a extensão é inicializada, o método [**IDsAdminNewObjExt:: AddPages**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-addpages) é chamado.</span><span class="sxs-lookup"><span data-stu-id="1c7b7-113">After the extension is initialized, the [**IDsAdminNewObjExt::AddPages**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-addpages) method is called.</span></span> <span data-ttu-id="1c7b7-114">A extensão deve adicionar a página ou páginas ao assistente durante esse método.</span><span class="sxs-lookup"><span data-stu-id="1c7b7-114">The extension must add the page or pages to the wizard during this method.</span></span> <span data-ttu-id="1c7b7-115">Uma página de assistente é criada preenchendo-se uma estrutura [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) e, em seguida, passando essa estrutura para a função [**CreatePropertySheetPage**](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) .</span><span class="sxs-lookup"><span data-stu-id="1c7b7-115">A wizard page is created by filling in a [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) structure and then passing this structure to the [**CreatePropertySheetPage**](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) function.</span></span> <span data-ttu-id="1c7b7-116">Em seguida, a página é adicionada ao assistente chamando a função de retorno de chamada que é passada para **AddPages** no parâmetro *lpfnAddPage* .</span><span class="sxs-lookup"><span data-stu-id="1c7b7-116">The page is then added to the wizard by calling the callback function that is passed to **AddPages** in the *lpfnAddPage* parameter.</span></span>

<span data-ttu-id="1c7b7-117">Antes de a página de extensão ser exibida, [**IDsAdminNewObjExt:: setObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) é chamado.</span><span class="sxs-lookup"><span data-stu-id="1c7b7-117">Before the extension page is displayed, [**IDsAdminNewObjExt::SetObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) is called.</span></span> <span data-ttu-id="1c7b7-118">Isso fornece a extensão com um ponteiro de interface [**IADs**](/windows/desktop/api/iads/nn-iads-iads) para o objeto que está sendo criado.</span><span class="sxs-lookup"><span data-stu-id="1c7b7-118">This supplies the extension with an [**IADs**](/windows/desktop/api/iads/nn-iads-iads) interface pointer for the object being created.</span></span>

<span data-ttu-id="1c7b7-119">Enquanto a página do assistente é exibida, a página deve tratar e responder a todas as mensagens de notificação do assistente necessárias, como [**PSN \_ SetActive**](../controls/psn-setactive.md) e [**PSN \_ WIZNEXT**](../controls/psn-wiznext.md).</span><span class="sxs-lookup"><span data-stu-id="1c7b7-119">While the wizard page is displayed, the page should handle and respond to any necessary wizard notification messages, such as [**PSN\_SETACTIVE**](../controls/psn-setactive.md) and [**PSN\_WIZNEXT**](../controls/psn-wiznext.md).</span></span>

<span data-ttu-id="1c7b7-120">Quando o usuário concluir todas as páginas do assistente, o assistente exibirá uma página "Concluir" que fornece um resumo dos dados inseridos.</span><span class="sxs-lookup"><span data-stu-id="1c7b7-120">When the user completes all of the wizard pages, the wizard will display a "Finish" page that provides a summary of the data entered.</span></span> <span data-ttu-id="1c7b7-121">O assistente Obtém esses dados chamando o método [**IDsAdminNewObjExt:: GetSummaryInfo**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-getsummaryinfo) para cada uma das extensões.</span><span class="sxs-lookup"><span data-stu-id="1c7b7-121">The wizard obtains this data by calling the [**IDsAdminNewObjExt::GetSummaryInfo**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-getsummaryinfo) method for each of the extensions.</span></span> <span data-ttu-id="1c7b7-122">O método **GetSummaryInfo** fornece um **BSTR** que contém os dados de texto exibidos na página "Concluir".</span><span class="sxs-lookup"><span data-stu-id="1c7b7-122">The **GetSummaryInfo** method provides a **BSTR** that contains the text data displayed in the "Finish" page.</span></span> <span data-ttu-id="1c7b7-123">Uma extensão de criação de objeto não precisa fornecer dados de resumo.</span><span class="sxs-lookup"><span data-stu-id="1c7b7-123">An object creation extension does not have to supply summary data.</span></span> <span data-ttu-id="1c7b7-124">Nesse caso, **GetSummaryInfo** deve retornar **E \_ NOTIMPL**.</span><span class="sxs-lookup"><span data-stu-id="1c7b7-124">In this case, **GetSummaryInfo** should return **E\_NOTIMPL**.</span></span> <span data-ttu-id="1c7b7-125">**GetSummaryInfo** é chamado apenas uma vez para cada extensão, não por página, portanto, se a extensão de criação de objeto adicionar mais de uma página, a extensão deverá combinar os dados de resumo em uma cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="1c7b7-125">**GetSummaryInfo** is only called one time for each extension, not per page, so if the object creation extension adds more than one page, the extension must combine the summary data into one string.</span></span>

<span data-ttu-id="1c7b7-126">Quando o usuário clica no botão **concluir** na página "Concluir", o assistente chama cada um dos métodos [**IDsAdminNewObjExt:: WriteData**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-writedata) da extensão com o contexto **de \_ \_ \_ preconfirmação DSA NEWOBJ CTX** .</span><span class="sxs-lookup"><span data-stu-id="1c7b7-126">When the user clicks the **Finish** button in the "Finish" page, the wizard calls each of the extension's [**IDsAdminNewObjExt::WriteData**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-writedata) methods with the **DSA\_NEWOBJ\_CTX\_PRECOMMIT** context.</span></span> <span data-ttu-id="1c7b7-127">Quando isso ocorre, a extensão deve gravar os dados coletados nas propriedades apropriadas usando o método [**IADs::P UT**](/windows/desktop/api/iads/nf-iads-iads-put) ou [**IADs::P utex**](/windows/desktop/api/iads/nf-iads-iads-putex) .</span><span class="sxs-lookup"><span data-stu-id="1c7b7-127">When this occurs, the extension should write the gathered data into the appropriate properties using the [**IADs::Put**](/windows/desktop/api/iads/nf-iads-iads-put) or [**IADs::PutEx**](/windows/desktop/api/iads/nf-iads-iads-putex) method.</span></span> <span data-ttu-id="1c7b7-128">A interface [**IADs**](/windows/desktop/api/iads/nn-iads-iads) é fornecida para a extensão no método [**IDsAdminNewObjExt:: setObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) .</span><span class="sxs-lookup"><span data-stu-id="1c7b7-128">The [**IADs**](/windows/desktop/api/iads/nn-iads-iads) interface is provided to the extension in the [**IDsAdminNewObjExt::SetObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) method.</span></span> <span data-ttu-id="1c7b7-129">A extensão não deve confirmar as propriedades armazenadas em cache chamando [**IADs:: setinfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo).</span><span class="sxs-lookup"><span data-stu-id="1c7b7-129">The extension should not commit the cached properties by calling [**IADs::SetInfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo).</span></span> <span data-ttu-id="1c7b7-130">Quando todas as propriedades tiverem sido gravadas, a extensão de criação do objeto primário confirmará as alterações chamando **IADs:: setinfo**.</span><span class="sxs-lookup"><span data-stu-id="1c7b7-130">When all of the properties have been written, the primary object creation extension commits the changes by calling **IADs::SetInfo**.</span></span> <span data-ttu-id="1c7b7-131">Isso é discutido em mais detalhes abaixo.</span><span class="sxs-lookup"><span data-stu-id="1c7b7-131">This is discussed in more detail below.</span></span>

<span data-ttu-id="1c7b7-132">Se ocorrer um erro, a extensão será notificada sobre o erro e durante a qual operação ocorreu quando o método [**IDsAdminNewObjExt:: OnError**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-onerror) for chamado.</span><span class="sxs-lookup"><span data-stu-id="1c7b7-132">If an error occurs, the extension will be notified of the error and during which operation it occurred when the [**IDsAdminNewObjExt::OnError**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-onerror) method is called.</span></span>

## <a name="implementing-a-primary-object-creation-wizard"></a><span data-ttu-id="1c7b7-133">Implementando um assistente de criação de objeto primário</span><span class="sxs-lookup"><span data-stu-id="1c7b7-133">Implementing a Primary Object Creation Wizard</span></span>

<span data-ttu-id="1c7b7-134">A implementação de um assistente de criação de objeto primário é idêntica a um assistente de criação de objeto secundário, exceto pelo fato de que um assistente de criação de objeto primário deve executar mais algumas etapas.</span><span class="sxs-lookup"><span data-stu-id="1c7b7-134">The implementation of a primary object creation wizard is identical to a secondary object creation wizard, except that a primary object creation wizard must perform a few more steps.</span></span>

<span data-ttu-id="1c7b7-135">Antes da primeira página ser ignorada, o assistente de criação de objeto deve criar o objeto de diretório temporário.</span><span class="sxs-lookup"><span data-stu-id="1c7b7-135">Prior to the first page being dismissed, the object creation wizard must create the temporary directory object.</span></span> <span data-ttu-id="1c7b7-136">Para fazer isso, chame o método [**IDsAdminNewObjPrimarySite:: CreateNew**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-createnew) .</span><span class="sxs-lookup"><span data-stu-id="1c7b7-136">To do this, call the [**IDsAdminNewObjPrimarySite::CreateNew**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-createnew) method.</span></span> <span data-ttu-id="1c7b7-137">Um ponteiro para a interface [**IDsAdminNewObjPrimarySite**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobjprimarysite) é obtido chamando [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) com **\_ IDsAdminNewObjPrimarySite IID** na interface [**IDsAdminNewObj**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobj) que é passada para [**IDsAdminNewObjExt:: Initialize**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-initialize).</span><span class="sxs-lookup"><span data-stu-id="1c7b7-137">A pointer to the [**IDsAdminNewObjPrimarySite**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobjprimarysite) interface is obtained by calling [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) with **IID\_IDsAdminNewObjPrimarySite** on the [**IDsAdminNewObj**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobj) interface that is passed to [**IDsAdminNewObjExt::Initialize**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-initialize).</span></span> <span data-ttu-id="1c7b7-138">O método **CreateNew** cria um novo objeto temporário e chama [**IDsAdminNewObjExt:: setObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) para cada extensão.</span><span class="sxs-lookup"><span data-stu-id="1c7b7-138">The **CreateNew** method creates a new temporary object and calls [**IDsAdminNewObjExt::SetObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) for each extension.</span></span>

<span data-ttu-id="1c7b7-139">Quando um assistente de criação de objeto contém mais de uma página, o sistema implementa uma página "Concluir" que exibe um resumo das informações do objeto a serem salvas.</span><span class="sxs-lookup"><span data-stu-id="1c7b7-139">When an object creation wizard contains more than one page, the system implements a "Finish" page that displays a summary of the object information to be saved.</span></span> <span data-ttu-id="1c7b7-140">Quando o botão **concluir** na página "Concluir" for clicado, o sistema chamará cada um dos métodos [**IDsAdminNewObjExt:: WriteData**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-writedata) da extensão de criação de objeto e, em seguida, confirmará o objeto temporário para a memória persistente.</span><span class="sxs-lookup"><span data-stu-id="1c7b7-140">When the **Finish** button on the "Finish" page is clicked, the system will call each of the object creation extension's [**IDsAdminNewObjExt::WriteData**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-writedata) method and then commit the temporary object to persistent memory.</span></span> <span data-ttu-id="1c7b7-141">No entanto, se o assistente de criação de objetos contiver apenas uma página, a página terá botões **OK** e **Cancelar** em vez dos botões **voltar**, **Avançar** e **Cancelar** normalmente encontrados em um assistente e nenhuma página "Concluir" será fornecida.</span><span class="sxs-lookup"><span data-stu-id="1c7b7-141">If, however, the object creation wizard only contains one page, the page will have **OK** and **Cancel** buttons instead of the **Back**, **Next** and **Cancel** buttons normally found in a wizard and no "Finish" page is provided.</span></span> <span data-ttu-id="1c7b7-142">Por isso, um assistente de extensão de criação de objeto de página única deve chamar [**IDsAdminNewObjPrimarySite:: Commit**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-commit) para executar as operações de gravação e salvamento.</span><span class="sxs-lookup"><span data-stu-id="1c7b7-142">Because of this, a single-page object creation extension wizard must call [**IDsAdminNewObjPrimarySite::Commit**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-commit) to perform the write and save operations.</span></span> <span data-ttu-id="1c7b7-143">Uma extensão de criação de objeto primário de página única deve chamar **Commit** em resposta à notificação [**PSN \_ WIZFINISH**](../controls/psn-wizfinish.md) .</span><span class="sxs-lookup"><span data-stu-id="1c7b7-143">A single-page primary object creation extension should call **Commit** in response to the [**PSN\_WIZFINISH**](../controls/psn-wizfinish.md) notification.</span></span>

<span data-ttu-id="1c7b7-144">Como outras extensões de criação de objeto podem adicionar páginas ao assistente, a extensão de criação de objeto primário pode não saber se há mais de uma página no assistente.</span><span class="sxs-lookup"><span data-stu-id="1c7b7-144">Because other object creation extensions can add pages to the wizard, the primary object creation extension may not know if there is more than one page in the wizard.</span></span> <span data-ttu-id="1c7b7-145">Isso não é um problema por dois motivos: primeiro, se o sistema implementar a página "Concluir", a extensão de criação de objeto primário receberá a notificação [**PSN \_ WIZNEXT**](../controls/psn-wiznext.md) em vez da notificação **PSN \_ WIZNEXT** .</span><span class="sxs-lookup"><span data-stu-id="1c7b7-145">This is not an issue for two reasons: First, if the system implements the "Finish" page, the primary object creation extension will receive the [**PSN\_WIZNEXT**](../controls/psn-wiznext.md) notification instead of the **PSN\_WIZNEXT** notification.</span></span> <span data-ttu-id="1c7b7-146">Em segundo lugar, a [**confirmação**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-commit) falhará de forma inofensiva se o assistente contiver mais de uma página.</span><span class="sxs-lookup"><span data-stu-id="1c7b7-146">Second, [**Commit**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-commit) will fail harmlessly if the wizard contains more than one page.</span></span>

 

 