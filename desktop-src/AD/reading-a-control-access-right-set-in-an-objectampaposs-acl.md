---
title: Lendo um conjunto direito de acesso de controle na ACL de um objeto
description: As propriedades da interface IADsAccessControlEntry são usadas para conceder ou negar direitos de acesso de controle.
ms.assetid: 2c6fef91-990e-4954-9aff-c9ec72d13972
ms.tgt_platform: multiple
keywords:
- Lendo um conjunto direito de acesso de controle na ACL de um objeto Active Directory
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4877c96a95fc94095c79ad129e8a07b1c786abe1
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/17/2020
ms.locfileid: "104007299"
---
# <a name="reading-a-control-access-right-set-in-an-objects-acl"></a><span data-ttu-id="0a782-104">Lendo um conjunto direito de acesso de controle na ACL de um objeto</span><span class="sxs-lookup"><span data-stu-id="0a782-104">Reading a Control Access Right Set in an Object's ACL</span></span>

<span data-ttu-id="0a782-105">Usando o ADSI, você lê um ACE de acesso de controle da mesma forma como faria com qualquer outra ACE em uma ACL.</span><span class="sxs-lookup"><span data-stu-id="0a782-105">Using ADSI, you read a control access right ACE just as you would any other ACE in an ACL.</span></span> <span data-ttu-id="0a782-106">Lembre-se de que você também pode usar as APIs de segurança do Win32 para ler ACLs em objetos de diretório.</span><span class="sxs-lookup"><span data-stu-id="0a782-106">Be aware that you can also use the Win32 security APIs to read ACLs on directory objects.</span></span> <span data-ttu-id="0a782-107">No entanto, os direitos de acesso de controle usam as propriedades da interface [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) de uma maneira específica para conceder e negar direitos de acesso de controle:</span><span class="sxs-lookup"><span data-stu-id="0a782-107">However, control access rights use the properties of the [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) interface in a manner that is specific to granting and denying control access rights:</span></span>

-   <span data-ttu-id="0a782-108">[**AccessMask**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) deve conter **anúncios \_ direito \_ de \_ \_ acesso de controle DS**.</span><span class="sxs-lookup"><span data-stu-id="0a782-108">[**AccessMask**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) must contain **ADS\_RIGHT\_DS\_CONTROL\_ACCESS**.</span></span>
-   <span data-ttu-id="0a782-109">O valor dos [**sinalizadores**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) é **tipo de \_ objeto sinalizador ADS \_ \_ \_ presente**.</span><span class="sxs-lookup"><span data-stu-id="0a782-109">[**Flags**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) value is **ADS\_FLAG\_OBJECT\_TYPE\_PRESENT**.</span></span>
-   <span data-ttu-id="0a782-110">[**Objecttype**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) é a forma de cadeia de caracteres do atributo **rightsGUID** do direito de acesso de controle.</span><span class="sxs-lookup"><span data-stu-id="0a782-110">[**ObjectType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) is the string form of the **rightsGUID** attribute of the control access right.</span></span> <span data-ttu-id="0a782-111">O formato da cadeia de caracteres do GUID é o mesmo formato de cadeia de caracteres que a função de biblioteca com [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) .</span><span class="sxs-lookup"><span data-stu-id="0a782-111">The string format of the GUID is the same string format as the [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) COM Library function.</span></span>
-   <span data-ttu-id="0a782-112">O [**AceType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) é **o \_ \_ objeto de \_ acesso \_ permitido pelo ADS AceType** para conceder o objeto de acesso de controle de confiança do direito ou do **ADS \_ AceType \_ acesso \_ negado \_** para negar o direito de acesso de controle de confiança.</span><span class="sxs-lookup"><span data-stu-id="0a782-112">[**AceType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) is either **ADS\_ACETYPE\_ACCESS\_ALLOWED\_OBJECT** to grant the trustee the control access right or **ADS\_ACETYPE\_ACCESS\_DENIED\_OBJECT** to deny the trustee the control access right.</span></span>
-   <span data-ttu-id="0a782-113">[**Trustee**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) é a entidade de segurança; Esse é o usuário, o grupo, o computador e assim por diante, ao qual a ACE se aplica.</span><span class="sxs-lookup"><span data-stu-id="0a782-113">[**Trustee**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) is the security principal; that is the user, group, computer, and so on, to which the ACE applies.</span></span>

<span data-ttu-id="0a782-114">Use o procedimento a seguir para ler uma ACE para um objeto ADSI.</span><span class="sxs-lookup"><span data-stu-id="0a782-114">Use the following procedure to read an ACE for an ADSI object.</span></span> <span data-ttu-id="0a782-115">O procedimento a seguir se aplica a aplicativos C e C++.</span><span class="sxs-lookup"><span data-stu-id="0a782-115">The following procedure applies to C and C++ applications.</span></span>

<span data-ttu-id="0a782-116">**Para ler uma ACE para um objeto ADSI**</span><span class="sxs-lookup"><span data-stu-id="0a782-116">**To read an ACE for an ADSI object**</span></span>

1.  <span data-ttu-id="0a782-117">Obtenha um ponteiro de interface [**IADs**](/windows/desktop/api/iads/nn-iads-iads) para o objeto.</span><span class="sxs-lookup"><span data-stu-id="0a782-117">Get an [**IADs**](/windows/desktop/api/iads/nn-iads-iads) interface pointer to the object.</span></span>
2.  <span data-ttu-id="0a782-118">Use o método [**IADs:: Get**](/windows/desktop/api/iads/nf-iads-iads-get) para obter o descritor de segurança do objeto.</span><span class="sxs-lookup"><span data-stu-id="0a782-118">Use the [**IADs::Get**](/windows/desktop/api/iads/nf-iads-iads-get) method to get the security descriptor of the object.</span></span> <span data-ttu-id="0a782-119">O nome da propriedade que contém o descritor de segurança é "nTSecurityDescriptor".</span><span class="sxs-lookup"><span data-stu-id="0a782-119">The name of the property that contains the security descriptor is "nTSecurityDescriptor".</span></span> <span data-ttu-id="0a782-120">A propriedade será retornada como uma **variante** que contém um ponteiro [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) .</span><span class="sxs-lookup"><span data-stu-id="0a782-120">The property will be returned as a **VARIANT** that contains an [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) pointer.</span></span> <span data-ttu-id="0a782-121">Lembre-se de que o membro **VT** é **\_ despacho VT**.</span><span class="sxs-lookup"><span data-stu-id="0a782-121">Be aware that the **vt** member is **VT\_DISPATCH**.</span></span> <span data-ttu-id="0a782-122">Chame **QueryInterface** nesse ponteiro **IDispatch** para obter uma interface [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) para usar os métodos nessa interface para acessar a ACL do descritor de segurança.</span><span class="sxs-lookup"><span data-stu-id="0a782-122">Call **QueryInterface** on that **IDispatch** pointer to get an [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) interface to use the methods on that interface to access the security descriptor ACL.</span></span>
3.  <span data-ttu-id="0a782-123">Use o método [**IADsSecurityDescriptor:: get \_ DiscretionaryAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) para obter a ACL.</span><span class="sxs-lookup"><span data-stu-id="0a782-123">Use the [**IADsSecurityDescriptor::get\_DiscretionaryAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) method to get the ACL.</span></span> <span data-ttu-id="0a782-124">O método retorna um ponteiro [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) .</span><span class="sxs-lookup"><span data-stu-id="0a782-124">The method returns an [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) pointer.</span></span> <span data-ttu-id="0a782-125">Chame **QueryInterface** nesse ponteiro **IDispatch** para obter uma interface [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) para usar os métodos nessa interface para acessar as ACEs individuais na ACL.</span><span class="sxs-lookup"><span data-stu-id="0a782-125">Call **QueryInterface** on that **IDispatch** pointer to get an [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) interface to use the methods on that interface to access the individual ACEs in the ACL.</span></span>
4.  <span data-ttu-id="0a782-126">Use o método [**IADsAccessControlList:: get \_ \_ NewEnum**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-get__newenum) para enumerar as ACEs.</span><span class="sxs-lookup"><span data-stu-id="0a782-126">Use the [**IADsAccessControlList::get\_\_NewEnum**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-get__newenum) method to enumerate the ACEs.</span></span> <span data-ttu-id="0a782-127">O método retorna um ponteiro [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) .</span><span class="sxs-lookup"><span data-stu-id="0a782-127">The method returns an [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) pointer.</span></span> <span data-ttu-id="0a782-128">Chame **QueryInterface** nesse ponteiro **IUnknown** para obter uma interface [**IEnumVARIANT**](/windows/win32/api/oaidl/nn-oaidl-ienumvariant) .</span><span class="sxs-lookup"><span data-stu-id="0a782-128">Call **QueryInterface** on that **IUnknown** pointer to get an [**IEnumVARIANT**](/windows/win32/api/oaidl/nn-oaidl-ienumvariant) interface.</span></span>
5.  <span data-ttu-id="0a782-129">Use o método [**IEnumVARIANT:: Next**](/windows/win32/api/oaidl/nf-oaidl-ienumvariant-next) para enumerar as ACEs na ACL.</span><span class="sxs-lookup"><span data-stu-id="0a782-129">Use the [**IEnumVARIANT::Next**](/windows/win32/api/oaidl/nf-oaidl-ienumvariant-next) method to enumerate the ACEs in the ACL.</span></span> <span data-ttu-id="0a782-130">A propriedade é retornada como uma **variante** que contém um ponteiro [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) .</span><span class="sxs-lookup"><span data-stu-id="0a782-130">The property is returned as a **VARIANT** that contains an [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) pointer.</span></span> <span data-ttu-id="0a782-131">Lembre-se de que o membro **VT** é **\_ despacho VT**.</span><span class="sxs-lookup"><span data-stu-id="0a782-131">Be aware that the **vt** member is **VT\_DISPATCH**.</span></span> <span data-ttu-id="0a782-132">Chame **QueryInterface** nesse ponteiro **IDispatch** para obter uma interface [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) para ler a Ace.</span><span class="sxs-lookup"><span data-stu-id="0a782-132">Call **QueryInterface** on that **IDispatch** pointer to get an [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) interface to read the ACE.</span></span>
6.  <span data-ttu-id="0a782-133">Chame o [**método IADsAccessControlEntry:: \_ Get AccessMask**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) para obter a **AccessMask** e verifique se o valor de **AccessMask** para o sinalizador de **\_ \_ \_ \_ acesso de controle DS direito ADS** .</span><span class="sxs-lookup"><span data-stu-id="0a782-133">Call the [**IADsAccessControlEntry::get\_AccessMask**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) method to get the **AccessMask** and verify that the **AccessMask** value for the **ADS\_RIGHT\_DS\_CONTROL\_ACCESS** flag.</span></span> <span data-ttu-id="0a782-134">Se tiver esse sinalizador, a ACE conterá um direito de acesso de controle.</span><span class="sxs-lookup"><span data-stu-id="0a782-134">If it has this flag, the ACE contains a control access right.</span></span>
7.  <span data-ttu-id="0a782-135">Chame o método de [**\_ sinalizadores IADsAccessControlEntry:: Get**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) para obter o sinalizador para o tipo de objeto.</span><span class="sxs-lookup"><span data-stu-id="0a782-135">Call the [**IADsAccessControlEntry::get\_Flags**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) method to get the flag for the object type.</span></span>
8.  <span data-ttu-id="0a782-136">Marque o valor dos [**sinalizadores**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) para o sinalizador do **tipo de \_ objeto sinalizador do ADS \_ \_ \_ presente** .</span><span class="sxs-lookup"><span data-stu-id="0a782-136">Check [**Flags**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) value for **ADS\_FLAG\_OBJECT\_TYPE\_PRESENT** flag.</span></span> <span data-ttu-id="0a782-137">Se **sinalizadores** estiverem definidos para **o \_ tipo de objeto sinalizador ADS \_ \_ \_ presente**, chame o método **IADsAccessControlEntry:: get \_ objecttype** para obter uma cadeia de caracteres que contenha o rightsGUID do direito de acesso de controle ao qual a Ace se aplica.</span><span class="sxs-lookup"><span data-stu-id="0a782-137">If **Flags** is set to **ADS\_FLAG\_OBJECT\_TYPE\_PRESENT**, call the **IADsAccessControlEntry::get\_ObjectType** method to get a string that contains the rightsGUID of the control access right that the ACE applies to.</span></span>
9.  <span data-ttu-id="0a782-138">Chame o método [**IADsAccessControlEntry:: get \_ AceType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) para obter o tipo ACE.</span><span class="sxs-lookup"><span data-stu-id="0a782-138">Call the [**IADsAccessControlEntry::get\_AceType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) method to get the ACE type.</span></span> <span data-ttu-id="0a782-139">O tipo será um **\_ \_ \_ \_ objeto permitido pelo ADS ACETYPE Access** para conceder o objeto de acesso de controle de confiança ao direito ou aos **anúncios \_ ACETYPE \_ acesso \_ negado \_** para negar o direito de acesso de controle.</span><span class="sxs-lookup"><span data-stu-id="0a782-139">The type will be an **ADS\_ACETYPE\_ACCESS\_ALLOWED\_OBJECT** to grant the trustee the control access right or **ADS\_ACETYPE\_ACCESS\_DENIED\_OBJECT** to deny the control access right.</span></span>
10. <span data-ttu-id="0a782-140">Chame o método [**IADsAccessControlEntry:: Get de \_ Trustee**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) para obter a entidade de segurança; ou seja, User, Group, Computer e assim por diante ao qual a Ace se aplica.</span><span class="sxs-lookup"><span data-stu-id="0a782-140">Call the [**IADsAccessControlEntry::get\_Trustee**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) method to get the security principal; that is user, group, computer, and so on to which the ACE applies.</span></span>
11. <span data-ttu-id="0a782-141">Quando terminar com as cadeias de caracteres [**objecttype**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) e **Trustee** , use [**SysFreeString**](/windows/win32/api/oleauto/nf-oleauto-sysfreestring) para liberar a memória para essas cadeias de caracteres.</span><span class="sxs-lookup"><span data-stu-id="0a782-141">When finished with the [**ObjectType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) and **Trustee** strings, use [**SysFreeString**](/windows/win32/api/oleauto/nf-oleauto-sysfreestring) to free the memory for those strings.</span></span>
12. <span data-ttu-id="0a782-142">Quando terminar com as interfaces, chame **Release** para decrementar ou libere todas as referências de interface.</span><span class="sxs-lookup"><span data-stu-id="0a782-142">When finished with the interfaces, call **Release** to decrement or release all the interface references.</span></span>

 

 