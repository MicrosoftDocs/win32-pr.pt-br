---
description: O ETW (rastreamento de eventos para Windows) é um recurso de rastreamento eficiente no nível de kernel que permite que você registre eventos de kernel ou definidos pelo aplicativo em um arquivo de log.
ms.assetid: 0eaa7bd3-8537-483a-b0d6-db3b790a6f3d
title: Sobre o rastreamento de eventos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3a2f13284cec1d9300c23241fafe154f277f72a3
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103921066"
---
# <a name="about-event-tracing"></a><span data-ttu-id="38a8c-103">Sobre o rastreamento de eventos</span><span class="sxs-lookup"><span data-stu-id="38a8c-103">About Event Tracing</span></span>

<span data-ttu-id="38a8c-104">O ETW (rastreamento de eventos para Windows) é um recurso de rastreamento eficiente no nível de kernel que permite que você registre eventos de kernel ou definidos pelo aplicativo em um arquivo de log.</span><span class="sxs-lookup"><span data-stu-id="38a8c-104">Event Tracing for Windows (ETW) is an efficient kernel-level tracing facility that lets you log kernel or application-defined events to a log file.</span></span> <span data-ttu-id="38a8c-105">Você pode consumir os eventos em tempo real ou de um arquivo de log e usá-los para depurar um aplicativo ou para determinar onde estão ocorrendo problemas de desempenho no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="38a8c-105">You can consume the events in real time or from a log file and use them to debug an application or to determine where performance issues are occurring in the application.</span></span>

<span data-ttu-id="38a8c-106">O ETW permite habilitar ou desabilitar o rastreamento de eventos dinamicamente, permitindo que você execute o rastreamento detalhado em um ambiente de produção sem exigir reinicializações do computador ou do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="38a8c-106">ETW lets you enable or disable event tracing dynamically, allowing you to perform detailed tracing in a production environment without requiring computer or application restarts.</span></span>

<span data-ttu-id="38a8c-107">A API de rastreamento de eventos é dividida em três componentes distintos:</span><span class="sxs-lookup"><span data-stu-id="38a8c-107">The Event Tracing API is broken into three distinct components:</span></span>

-   <span data-ttu-id="38a8c-108">[Controladores](#controllers), que iniciam e paramm uma sessão de rastreamento de eventos e habilitam provedores</span><span class="sxs-lookup"><span data-stu-id="38a8c-108">[Controllers](#controllers), which start and stop an event tracing session and enable providers</span></span>
-   <span data-ttu-id="38a8c-109">[Provedores](#providers), que fornecem os eventos</span><span class="sxs-lookup"><span data-stu-id="38a8c-109">[Providers](#providers), which provide the events</span></span>
-   <span data-ttu-id="38a8c-110">[Consumidores](#consumers), que consomem os eventos</span><span class="sxs-lookup"><span data-stu-id="38a8c-110">[Consumers](#consumers), which consume the events</span></span>

<span data-ttu-id="38a8c-111">O diagrama a seguir mostra o modelo de rastreamento de eventos.</span><span class="sxs-lookup"><span data-stu-id="38a8c-111">The following diagram shows the event tracing model.</span></span>

![modelo de rastreamento de eventos](images/etdiag2.png)

## <a name="controllers"></a><span data-ttu-id="38a8c-113">Controladores</span><span class="sxs-lookup"><span data-stu-id="38a8c-113">Controllers</span></span>

<span data-ttu-id="38a8c-114">Controladores são aplicativos que definem o tamanho e o local do arquivo de log, iniciam e param [sessões de rastreamento de eventos](event-tracing-sessions.md), habilitam provedores para que possam registrar eventos na sessão, gerenciar o tamanho do pool de buffers e obter estatísticas de execução para sessões.</span><span class="sxs-lookup"><span data-stu-id="38a8c-114">Controllers are applications that define the size and location of the log file, start and stop [event tracing sessions](event-tracing-sessions.md), enable providers so they can log events to the session, manage the size of the buffer pool, and obtain execution statistics for sessions.</span></span> <span data-ttu-id="38a8c-115">As estatísticas de sessão incluem o número de buffers usados, o número de buffers entregues e o número de eventos e buffers perdidos.</span><span class="sxs-lookup"><span data-stu-id="38a8c-115">Session statistics include the number of buffers used, the number of buffers delivered, and the number of events and buffers lost.</span></span> 

<span data-ttu-id="38a8c-116">Para obter mais informações, consulte [controlando sessões de rastreamento de eventos](controlling-event-tracing-sessions.md).</span><span class="sxs-lookup"><span data-stu-id="38a8c-116">For more information, see [Controlling Event Tracing Sessions](controlling-event-tracing-sessions.md).</span></span>

## <a name="providers"></a><span data-ttu-id="38a8c-117">Provedores</span><span class="sxs-lookup"><span data-stu-id="38a8c-117">Providers</span></span>

<span data-ttu-id="38a8c-118">Provedores são aplicativos que contêm a instrumentação de rastreamento de eventos.</span><span class="sxs-lookup"><span data-stu-id="38a8c-118">Providers are applications that contain event tracing instrumentation.</span></span> <span data-ttu-id="38a8c-119">Depois que um provedor se registra, um controlador pode habilitar ou desabilitar o rastreamento de eventos no provedor.</span><span class="sxs-lookup"><span data-stu-id="38a8c-119">After a provider registers itself, a controller can then enable or disable event tracing in the provider.</span></span> <span data-ttu-id="38a8c-120">O provedor define sua interpretação de ser habilitada ou desabilitada.</span><span class="sxs-lookup"><span data-stu-id="38a8c-120">The provider defines its interpretation of being enabled or disabled.</span></span> <span data-ttu-id="38a8c-121">Geralmente, um provedor habilitado gera eventos, enquanto um provedor desabilitado não faz isso.</span><span class="sxs-lookup"><span data-stu-id="38a8c-121">Generally, an enabled provider generates events, while a disabled provider does not.</span></span> <span data-ttu-id="38a8c-122">Isso permite que você adicione o rastreamento de eventos ao seu aplicativo sem exigir que ele gere eventos o tempo todo.</span><span class="sxs-lookup"><span data-stu-id="38a8c-122">This lets you add event tracing to your application without requiring that it generate events all the time.</span></span> 

<span data-ttu-id="38a8c-123">Embora o modelo ETW separe o controlador e o provedor em aplicativos separados, um aplicativo pode incluir ambos os componentes.</span><span class="sxs-lookup"><span data-stu-id="38a8c-123">Although the ETW model separates the controller and provider into separate applications, an application can include both components.</span></span>

<span data-ttu-id="38a8c-124">Para obter mais informações, consulte [fornecendo eventos](providing-events.md).</span><span class="sxs-lookup"><span data-stu-id="38a8c-124">For more information, see [Providing Events](providing-events.md).</span></span>

### <a name="types-of-providers"></a><span data-ttu-id="38a8c-125">Tipos de provedores</span><span class="sxs-lookup"><span data-stu-id="38a8c-125">Types of Providers</span></span>

<span data-ttu-id="38a8c-126">Há quatro tipos principais de provedores: provedores MOF (clássicos), provedores de WPP, provedores baseados em manifesto e provedores de TraceLogging.</span><span class="sxs-lookup"><span data-stu-id="38a8c-126">There are four main types of providers: MOF (classic) providers, WPP providers, manifest-based providers, and TraceLogging providers.</span></span> <span data-ttu-id="38a8c-127">Você deve usar um provedor baseado em manifesto ou um provedor TraceLogging se estiver escrevendo aplicativos para o Windows Vista ou posterior que não precisam oferecer suporte a sistemas herdados.</span><span class="sxs-lookup"><span data-stu-id="38a8c-127">You should use a manifest-based provider or a TraceLogging provider if you are writing applications for Windows Vista or later that do not need to support legacy systems.</span></span>

#### <a name="mof-classic-providers"></a><span data-ttu-id="38a8c-128">Provedores MOF (clássicos):</span><span class="sxs-lookup"><span data-stu-id="38a8c-128">MOF (classic) providers:</span></span>

-   <span data-ttu-id="38a8c-129">Use as funções [RegisterTraceGuids](/windows/win32/api/evntrace/nf-evntrace-registertraceguidsa) e [TraceEvent](/windows/win32/api/evntrace/nf-evntrace-traceevent) para registrar e gravar eventos.</span><span class="sxs-lookup"><span data-stu-id="38a8c-129">Use the [RegisterTraceGuids](/windows/win32/api/evntrace/nf-evntrace-registertraceguidsa) and [TraceEvent](/windows/win32/api/evntrace/nf-evntrace-traceevent) functions to register and write events.</span></span>
-   <span data-ttu-id="38a8c-130">Use classes MOF para definir eventos para que os consumidores saibam como consumi-los.</span><span class="sxs-lookup"><span data-stu-id="38a8c-130">Use MOF classes to define events so that consumers know how to consume them.</span></span>
-   <span data-ttu-id="38a8c-131">Pode ser habilitado por apenas uma sessão de rastreamento por vez.</span><span class="sxs-lookup"><span data-stu-id="38a8c-131">Can be enabled by only one trace session at a time.</span></span>

#### <a name="wpp-providers"></a><span data-ttu-id="38a8c-132">Provedores de WPP:</span><span class="sxs-lookup"><span data-stu-id="38a8c-132">WPP providers:</span></span>

-   <span data-ttu-id="38a8c-133">Use as funções [RegisterTraceGuids](/windows/win32/api/evntrace/nf-evntrace-registertraceguidsa) e [TraceEvent](/windows/win32/api/evntrace/nf-evntrace-traceevent) para registrar e gravar eventos.</span><span class="sxs-lookup"><span data-stu-id="38a8c-133">Use the [RegisterTraceGuids](/windows/win32/api/evntrace/nf-evntrace-registertraceguidsa) and [TraceEvent](/windows/win32/api/evntrace/nf-evntrace-traceevent) functions to register and write events.</span></span>
-   <span data-ttu-id="38a8c-134">Ter arquivos TMF associados (compilados em um. pdb binário) contendo informações de decodificação inferidas da verificação do pré-processador da instrumentação de WPP no código-fonte.</span><span class="sxs-lookup"><span data-stu-id="38a8c-134">Have associated TMF files (compiled into a binary's .pdb) containing decoding information inferred from the preprocessor's scan of WPP instrumentation in source code.</span></span>
-   <span data-ttu-id="38a8c-135">Pode ser habilitado por apenas uma sessão de rastreamento por vez.</span><span class="sxs-lookup"><span data-stu-id="38a8c-135">Can be enabled by only one trace session at a time.</span></span>

#### <a name="manifest-based-providers"></a><span data-ttu-id="38a8c-136">Provedores baseados em manifesto:</span><span class="sxs-lookup"><span data-stu-id="38a8c-136">Manifest-based providers:</span></span>

-   <span data-ttu-id="38a8c-137">Use [EventRegister](/windows/desktop/api/Evntprov/nf-evntprov-eventregister) e [EventWrite](/windows/desktop/api/Evntprov/nf-evntprov-eventwrite) para registrar e gravar eventos.</span><span class="sxs-lookup"><span data-stu-id="38a8c-137">Use [EventRegister](/windows/desktop/api/Evntprov/nf-evntprov-eventregister) and [EventWrite](/windows/desktop/api/Evntprov/nf-evntprov-eventwrite) to register and write events.</span></span>
-   <span data-ttu-id="38a8c-138">Use um manifesto para definir eventos para que os consumidores saibam como consumi-los.</span><span class="sxs-lookup"><span data-stu-id="38a8c-138">Use a manifest to define events so that consumers know how to consume them.</span></span>
-   <span data-ttu-id="38a8c-139">Pode ser habilitado por até oito sessões de rastreamento simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="38a8c-139">Can be enabled by up to eight trace sessions simultaneously.</span></span>

#### <a name="tracelogging-providers"></a><span data-ttu-id="38a8c-140">Provedores de [TraceLogging](/windows/desktop/tracelogging/trace-logging-about) :</span><span class="sxs-lookup"><span data-stu-id="38a8c-140">[TraceLogging](/windows/desktop/tracelogging/trace-logging-about) providers:</span></span>

-   <span data-ttu-id="38a8c-141">Use [TraceLoggingRegister](/windows/desktop/api/traceloggingprovider/nf-traceloggingprovider-traceloggingregister) e [TraceLoggingWrite](/windows/desktop/api/traceloggingprovider/nf-traceloggingprovider-traceloggingwrite) para registrar e gravar eventos.</span><span class="sxs-lookup"><span data-stu-id="38a8c-141">Use [TraceLoggingRegister](/windows/desktop/api/traceloggingprovider/nf-traceloggingprovider-traceloggingregister) and [TraceLoggingWrite](/windows/desktop/api/traceloggingprovider/nf-traceloggingprovider-traceloggingwrite) to register and write events.</span></span>
-   <span data-ttu-id="38a8c-142">Use eventos autodescritivos para que os próprios eventos contenham todas as informações necessárias para consumi-los.</span><span class="sxs-lookup"><span data-stu-id="38a8c-142">Use self-describing events so that the events themselves contain all required information for consuming them.</span></span>
-   <span data-ttu-id="38a8c-143">Pode ser habilitado por até oito sessões de rastreamento simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="38a8c-143">Can be enabled by up to eight trace sessions simultaneously.</span></span>

<span data-ttu-id="38a8c-144">Todos os provedores de eventos usam fundamentalmente a família de APIs de rastreamento de eventos ([TraceEvent](/windows/win32/api/evntrace/nf-evntrace-traceevent) para tecnologias herdadas e [EventWrite](/windows/desktop/api/Evntprov/nf-evntprov-eventwrite) / [EventWriteEx](/windows/desktop/api/Evntprov/nf-evntprov-eventwriteex) para as mais recentes).</span><span class="sxs-lookup"><span data-stu-id="38a8c-144">All event providers fundamentally use the Event Tracing family of APIs ([TraceEvent](/windows/win32/api/evntrace/nf-evntrace-traceevent) for legacy technologies and [EventWrite](/windows/desktop/api/Evntprov/nf-evntprov-eventwrite)/[EventWriteEx](/windows/desktop/api/Evntprov/nf-evntprov-eventwriteex) for newer ones).</span></span> <span data-ttu-id="38a8c-145">Os provedores de eventos são simplesmente diferentes em quais tipos de campos eles armazenam em cargas de eventos e onde armazenam as informações de decodificação de eventos associadas.</span><span class="sxs-lookup"><span data-stu-id="38a8c-145">Event providers simply differ in what field types they store in event payloads and where they store the associated event decoding information.</span></span>

## <a name="consumers"></a><span data-ttu-id="38a8c-146">Consumidores</span><span class="sxs-lookup"><span data-stu-id="38a8c-146">Consumers</span></span>

<span data-ttu-id="38a8c-147">Os consumidores são aplicativos que selecionam uma ou mais sessões de rastreamento de eventos como uma fonte de eventos.</span><span class="sxs-lookup"><span data-stu-id="38a8c-147">Consumers are applications that select one or more event tracing sessions as a source of events.</span></span> <span data-ttu-id="38a8c-148">Um consumidor pode solicitar eventos de várias sessões de rastreamento de eventos simultaneamente; o sistema entrega os eventos em ordem cronológica.</span><span class="sxs-lookup"><span data-stu-id="38a8c-148">A consumer can request events from multiple event tracing sessions simultaneously; the system delivers the events in chronological order.</span></span> <span data-ttu-id="38a8c-149">Os consumidores podem receber eventos armazenados em arquivos de log ou de sessões que entregam eventos em tempo real.</span><span class="sxs-lookup"><span data-stu-id="38a8c-149">Consumers can receive events stored in log files, or from sessions that deliver events in real time.</span></span> <span data-ttu-id="38a8c-150">Durante o processamento de eventos, um consumidor pode especificar horários de início e término, e somente os eventos que ocorrem no período de tempo especificado serão entregues.</span><span class="sxs-lookup"><span data-stu-id="38a8c-150">When processing events, a consumer can specify start and end times, and only events that occur in the specified time frame will be delivered.</span></span> 

<span data-ttu-id="38a8c-151">Para obter mais informações, consulte [consumindo eventos](consuming-events.md).</span><span class="sxs-lookup"><span data-stu-id="38a8c-151">For more information, see [Consuming Events](consuming-events.md).</span></span>

## <a name="missing-events"></a><span data-ttu-id="38a8c-152">Eventos ausentes</span><span class="sxs-lookup"><span data-stu-id="38a8c-152">Missing Events</span></span>

<span data-ttu-id="38a8c-153">O PerfMon, o diagnóstico do sistema e outras ferramentas do sistema podem relatar eventos ausentes no log de eventos e indicar que as configurações do ETW (rastreamento de eventos para Windows) podem não ser ideais.</span><span class="sxs-lookup"><span data-stu-id="38a8c-153">Perfmon, System Diagnostics, and other system tools may report on missing events in the Event Log and indicate that the settings for Event Tracing for Windows (ETW) may not be optimal.</span></span> <span data-ttu-id="38a8c-154">Os eventos podem ser perdidos por vários motivos:</span><span class="sxs-lookup"><span data-stu-id="38a8c-154">Events can be lost for a number of reasons:</span></span>

-   <span data-ttu-id="38a8c-155">O tamanho total do evento é maior que 64K.</span><span class="sxs-lookup"><span data-stu-id="38a8c-155">The total event size is greater than 64K.</span></span> <span data-ttu-id="38a8c-156">Isso inclui o cabeçalho ETW mais os dados ou a carga.</span><span class="sxs-lookup"><span data-stu-id="38a8c-156">This includes the ETW header plus the data or payload.</span></span> <span data-ttu-id="38a8c-157">Um usuário não tem controle sobre esses eventos ausentes, pois o tamanho do evento é configurado pelo aplicativo.</span><span class="sxs-lookup"><span data-stu-id="38a8c-157">A user has no control over these missing events since the event size is configured by the application.</span></span>

-   <span data-ttu-id="38a8c-158">O tamanho do buffer ETW é menor do que o tamanho total do evento.</span><span class="sxs-lookup"><span data-stu-id="38a8c-158">The ETW buffer size is smaller than the total event size.</span></span> <span data-ttu-id="38a8c-159">Um usuário não tem controle sobre esses eventos ausentes, pois o tamanho do evento é configurado pelo aplicativo que registra os eventos em log.</span><span class="sxs-lookup"><span data-stu-id="38a8c-159">A user has no control over these missing events since the event size is configured by the application logging the events.</span></span>

-   <span data-ttu-id="38a8c-160">Para o registro em log em tempo real, o consumidor em tempo real não está consumindo eventos rápido o suficiente ou não está presente completamente e, em seguida, o arquivo de backup está se enchendo.</span><span class="sxs-lookup"><span data-stu-id="38a8c-160">For real-time logging, the real-time consumer is not consuming events fast enough or is not present altogether and then the backing file is filling up.</span></span> <span data-ttu-id="38a8c-161">Isso pode ocorrer se o serviço log de eventos for interrompido e iniciado quando os eventos estiverem sendo registrados.</span><span class="sxs-lookup"><span data-stu-id="38a8c-161">This can result if the Event Log service is stopped and started when events are being logged.</span></span> <span data-ttu-id="38a8c-162">Um usuário não tem controle sobre esses eventos ausentes.</span><span class="sxs-lookup"><span data-stu-id="38a8c-162">A user has no control over these missing events.</span></span>

-   <span data-ttu-id="38a8c-163">Ao fazer logon em um arquivo, o disco fica muito lento para acompanhar a taxa de registro em log.</span><span class="sxs-lookup"><span data-stu-id="38a8c-163">When logging to a file, the disk is too slow to keep up with the logging rate.</span></span>

<span data-ttu-id="38a8c-164">Por qualquer um desses motivos, informe esses problemas ao provedor do aplicativo ou serviço que está gerando os eventos.</span><span class="sxs-lookup"><span data-stu-id="38a8c-164">For any of these reasons, please report these problems to the provider of the application or service that is generating the events.</span></span> <span data-ttu-id="38a8c-165">Esses problemas só podem ser corrigidos pelo desenvolvedor do aplicativo ou pelo serviço que está registrando os eventos.</span><span class="sxs-lookup"><span data-stu-id="38a8c-165">These issues can only be fixed by the application developer or the service logging the events.</span></span> <span data-ttu-id="38a8c-166">Se os eventos ausentes estiverem sendo relatados no serviço log de eventos, isso poderá indicar um problema com a configuração do serviço log de eventos.</span><span class="sxs-lookup"><span data-stu-id="38a8c-166">If the missing events are being reported in the Event Log Service, this may indicate a problem with the configuration of the Event Log service.</span></span> <span data-ttu-id="38a8c-167">O usuário pode ter alguma capacidade limitada para aumentar o espaço máximo em disco a ser usado pelo serviço de log de eventos, o que pode reduzir o número de eventos ausentes.</span><span class="sxs-lookup"><span data-stu-id="38a8c-167">The user may have some limited ability to increase the maximum disk space to be used by the Event Log Service which may reduce the number of missing events.</span></span>

 

 
