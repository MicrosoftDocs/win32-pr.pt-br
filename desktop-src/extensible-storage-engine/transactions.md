---
description: 'Saiba mais sobre: transações (eventos do Windows)'
title: Transações (Eventos do Windows)
TOCTitle: Transactions
ms:assetid: 1ceb362c-1efe-439b-b10a-016c8a54f27b
ms:mtpsurl: https://msdn.microsoft.com/library/Gg269197(v=EXCHG.10)
ms:contentKeyID: 32765500
ms.date: 04/11/2016
ms.topic: article
ms.openlocfilehash: 90b5b566f5ff961ce7b0ae3725f580e1f39c041d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "104297040"
---
# <a name="transactions-windows-events"></a><span data-ttu-id="06f0c-103">Transações (Eventos do Windows)</span><span class="sxs-lookup"><span data-stu-id="06f0c-103">Transactions (Windows Events)</span></span>


<span data-ttu-id="06f0c-104">_**Aplica-se a:** Windows | Windows Server_</span><span class="sxs-lookup"><span data-stu-id="06f0c-104">_**Applies to:** Windows�| Windows Server_</span></span>

## <a name="transactions"></a><span data-ttu-id="06f0c-105">Transactions</span><span class="sxs-lookup"><span data-stu-id="06f0c-105">Transactions</span></span>

<span data-ttu-id="06f0c-106">Transações ESE são unidades lógicas de processamento que controlam como um aplicativo vê e manipula linhas no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="06f0c-106">ESE transactions are logical units of processing that control how an application sees and manipulates rows in the database.</span></span> <span data-ttu-id="06f0c-107">Seu aplicativo pode usar pontos de salvamento de transação para determinar se deve manter ou descartar um determinado conjunto de alterações no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="06f0c-107">Your application can use transaction save points to determine whether to keep or discard a particular set of changes to the database.</span></span> <span data-ttu-id="06f0c-108">Todas as transações no ESE são atômicas, consistentes, isoladas e duráveis (ACID), conforme descrito abaixo:</span><span class="sxs-lookup"><span data-stu-id="06f0c-108">All transactions in ESE are atomic, consistent, isolated, and durable (ACID) as described below:</span></span>

  - <span data-ttu-id="06f0c-109">**Atômico:** Todas as atualizações na transação aparecem no banco de dados ou são descartadas.</span><span class="sxs-lookup"><span data-stu-id="06f0c-109">**Atomic:** All the updates in the transaction either appear in the database or they are discarded.</span></span>

<!-- end list -->

  - <span data-ttu-id="06f0c-110">**Consistente:** O banco de dados sempre será iniciado em um estado legal e sempre terminará em outro estado legal.</span><span class="sxs-lookup"><span data-stu-id="06f0c-110">**Consistent:** The database will always start in a legal state and will always end in another legal state.</span></span> <span data-ttu-id="06f0c-111">Para aplicativos ESE, o mecanismo de banco de dados controlará algumas restrições simples, por exemplo, exclusividade de um índice exclusivo, mas o aplicativo em si definirá quase todos os outros aspectos do que significa que o banco de dados está em um estado legal.</span><span class="sxs-lookup"><span data-stu-id="06f0c-111">For ESE applications, the database engine will control some simple constraints, for example uniqueness of a unique index, but the application itself will define almost all other aspects of what it means for the database to be in a legal state.</span></span>

<!-- end list -->

  - <span data-ttu-id="06f0c-112">**Isolamento:** As transações são isoladas de atualizações por outras sessões.</span><span class="sxs-lookup"><span data-stu-id="06f0c-112">**Isolation:** Transactions are isolated from updates by other sessions.</span></span> <span data-ttu-id="06f0c-113">Uma transação nunca verá um conjunto parcial de alterações feitas por outra transação.</span><span class="sxs-lookup"><span data-stu-id="06f0c-113">A transaction will never see a partial set of changes made by another transaction.</span></span>

<!-- end list -->

  - <span data-ttu-id="06f0c-114">**Durável:** Depois que o mecanismo de banco de dados reconhece que uma transação foi confirmada, suas alterações são persistentes no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="06f0c-114">**Durable:** After the database engine acknowledges that a transaction has been committed, its changes are persistent in the database.</span></span> <span data-ttu-id="06f0c-115">A durabilidade de uma transação pode ser opcionalmente cancelada por motivos de desempenho.</span><span class="sxs-lookup"><span data-stu-id="06f0c-115">The durability of a transaction may be optionally waived for performance reasons.</span></span>

<span data-ttu-id="06f0c-116">As transações são executadas dentro dos limites das chamadas para [JetBeginTransaction](./jetbegintransaction-function.md) e [JetCommitTransaction](./jetcommittransaction-function.md) ou [JetRollback](./jetrollback-function.md).</span><span class="sxs-lookup"><span data-stu-id="06f0c-116">Transactions are performed within the bounds of the calls to [JetBeginTransaction](./jetbegintransaction-function.md) and [JetCommitTransaction](./jetcommittransaction-function.md) or [JetRollback](./jetrollback-function.md).</span></span> <span data-ttu-id="06f0c-117">Quando o aplicativo entra na transação, o banco de dados aparece congelado na instância no momento em que a transação é iniciada.</span><span class="sxs-lookup"><span data-stu-id="06f0c-117">When the application enters the transaction, the database appears frozen at the instance in time that the transaction begins.</span></span> <span data-ttu-id="06f0c-118">Isso é chamado de isolamento de instantâneo.</span><span class="sxs-lookup"><span data-stu-id="06f0c-118">This is called snapshot isolation.</span></span> <span data-ttu-id="06f0c-119">Se a transação for encerrada chamando [JetRollback](./jetrollback-function.md), nenhuma das operações executadas na transação será confirmada no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="06f0c-119">If the transaction is terminated by calling [JetRollback](./jetrollback-function.md), none of the operations performed in the transaction are committed to the database.</span></span> <span data-ttu-id="06f0c-120">Se o processo ou a máquina falhar antes de [JetCommitTransaction](./jetcommittransaction-function.md) ser chamado, ele será o mesmo que chamar [JetRollback](./jetrollback-function.md).</span><span class="sxs-lookup"><span data-stu-id="06f0c-120">If the process or the machine crashes before [JetCommitTransaction](./jetcommittransaction-function.md) is called, it is the same as calling [JetRollback](./jetrollback-function.md).</span></span>

<span data-ttu-id="06f0c-121">Este procedimento mostra como iniciar e confirmar uma transação que lê e atualiza dados em um banco de dado.</span><span class="sxs-lookup"><span data-stu-id="06f0c-121">This procedure shows how to start and commit a transaction that reads and updates data in a database.</span></span>

### <a name="to-start-and-commit-a-transaction"></a><span data-ttu-id="06f0c-122">Para iniciar e confirmar uma transação</span><span class="sxs-lookup"><span data-stu-id="06f0c-122">To start and commit a transaction</span></span>

1.  <span data-ttu-id="06f0c-123">Chame [JetBeginTransaction](./jetbegintransaction-function.md) ou [JETBEGINTRANSACTION2](./jetbegintransaction2-function.md) com a ID de sessão para iniciar a transação.</span><span class="sxs-lookup"><span data-stu-id="06f0c-123">Call [JetBeginTransaction](./jetbegintransaction-function.md) or [JetBeginTransaction2](./jetbegintransaction2-function.md) with the session ID to start the transaction.</span></span>

2.  <span data-ttu-id="06f0c-124">Mova o cursor para o registro desejado chamando [JetMove](./jetmove-function.md) com JET_MoveFirst especificado no parâmetro de *galinha* .</span><span class="sxs-lookup"><span data-stu-id="06f0c-124">Move the cursor to the desired record by calling [JetMove](./jetmove-function.md) with JET_MoveFirst specified in the *cRow* parameter.</span></span> <span data-ttu-id="06f0c-125">Para obter mais informações sobre como mover o cursor, consulte o tópico [indexação na tabela](./indexing-in-the-table.md) .</span><span class="sxs-lookup"><span data-stu-id="06f0c-125">For more information on how to move the cursor, see the [Indexing in the Table](./indexing-in-the-table.md) topic.</span></span>

3.  <span data-ttu-id="06f0c-126">Chame [JetGetTableColumnInfo](./jetgettablecolumninfo-function.md) no registro atual com JET_ColInfo especificado no parâmetro *InfoLevel* para recuperar a ID de coluna para a coluna.</span><span class="sxs-lookup"><span data-stu-id="06f0c-126">Call [JetGetTableColumnInfo](./jetgettablecolumninfo-function.md) on the current record with JET_ColInfo specified in the *InfoLevel* parameter to retrieve the column ID for the column.</span></span> <span data-ttu-id="06f0c-127">A ID da coluna é retornada na estrutura de [JET_COLUMNDEF](./jet-columndef-structure.md) .</span><span class="sxs-lookup"><span data-stu-id="06f0c-127">The column ID is returned in the [JET_COLUMNDEF](./jet-columndef-structure.md) structure.</span></span>

4.  <span data-ttu-id="06f0c-128">Chame [JetSetColumn](./jetsetcolumn-function.md) com a ID de sessão, ID de tabela e ID de coluna da coluna que é atualizada.</span><span class="sxs-lookup"><span data-stu-id="06f0c-128">Call [JetSetColumn](./jetsetcolumn-function.md) with the session ID, table ID, and column ID of the column that is updated.</span></span> <span data-ttu-id="06f0c-129">Os dados da coluna estão contidos no parâmetro *pvData* .</span><span class="sxs-lookup"><span data-stu-id="06f0c-129">The column data is contained in the *pvData* parameter.</span></span>

5.  <span data-ttu-id="06f0c-130">Chame [JetCommitTransaction](./jetcommittransaction-function.md) para confirmar a transação para o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="06f0c-130">Call [JetCommitTransaction](./jetcommittransaction-function.md) to commit the transaction to the database.</span></span>

<span data-ttu-id="06f0c-131">A maneira como um mecanismo de banco de dados ESE implementa o isolamento de instantâneo tem algumas diferenças importantes de modelos de bloqueio e isolamento de banco de dados relacional tradicionais.</span><span class="sxs-lookup"><span data-stu-id="06f0c-131">The way in which an ESE database engine implements snapshot isolation has some important differences from traditional relational database isolation and locking models.</span></span> <span data-ttu-id="06f0c-132">Quando uma transação lê uma linha, ela sempre pode acessar a linha sem falhar ou aguardar que outras sessões liberem um bloqueio.</span><span class="sxs-lookup"><span data-stu-id="06f0c-132">When a transaction reads a row, it can always access the row without failing or waiting for other sessions to release a lock.</span></span> <span data-ttu-id="06f0c-133">Quando uma transação tenta atualizar uma linha, ela terá sucesso se for a primeira sessão a atualizar essa linha, que é o primeiro gravador vence.</span><span class="sxs-lookup"><span data-stu-id="06f0c-133">When a transaction attempts to update a row, it will succeed if it is the first session to update that row, that is the first writer wins.</span></span> <span data-ttu-id="06f0c-134">Se a sessão não for o primeiro gravador, ela falhará imediatamente com um erro de conflito de gravação.</span><span class="sxs-lookup"><span data-stu-id="06f0c-134">If the session is not the first writer then it will immediately fail with a write conflict error.</span></span> <span data-ttu-id="06f0c-135">A sessão deve abortar sua transação, aguardar (geralmente por um atraso aleatório), para que a outra transação confirme suas alterações e, em seguida, repita a transação.</span><span class="sxs-lookup"><span data-stu-id="06f0c-135">The session must then abort its transaction, wait (usually via a random delay), for the other transaction to commit its changes, and then retry the transaction.</span></span> <span data-ttu-id="06f0c-136">O mecanismo de banco de dados não fará com que a sessão aguarde automaticamente até que a outra transação tenha concluído sua atualização.</span><span class="sxs-lookup"><span data-stu-id="06f0c-136">The database engine will not automatically cause that session to wait until the other transaction has finished its update.</span></span> <span data-ttu-id="06f0c-137">Normalmente, uma transação será testada se puder atualizar uma linha dentro da chamada [JetUpdate](./jetupdate-function.md) .</span><span class="sxs-lookup"><span data-stu-id="06f0c-137">Usually, a transaction will test if it can update a row inside of the [JetUpdate](./jetupdate-function.md) call.</span></span> <span data-ttu-id="06f0c-138">Se não for possível bloquear a linha para atualização, o [JetUpdate](./jetupdate-function.md) falhará com JET_errWriteConflict.</span><span class="sxs-lookup"><span data-stu-id="06f0c-138">If it cannot lock the row for update then [JetUpdate](./jetupdate-function.md) will fail with JET_errWriteConflict.</span></span>

<span data-ttu-id="06f0c-139">As sessões são limitadas a um thread desde o momento em que a transação começa até o final da transação.</span><span class="sxs-lookup"><span data-stu-id="06f0c-139">Sessions are limited to one thread from the time the transaction starts to the end of the transaction.</span></span> <span data-ttu-id="06f0c-140">É recomendável que todas as operações de atualização e recuperação sejam executadas em uma transação.</span><span class="sxs-lookup"><span data-stu-id="06f0c-140">It is recommended that all update and retrieve operations be performed in a transaction.</span></span> <span data-ttu-id="06f0c-141">O ESE também dá suporte a modificações de esquema, como a criação de tabelas e a adição de colunas dentro da transação.</span><span class="sxs-lookup"><span data-stu-id="06f0c-141">ESE also supports schema modifications such as creating tables and adding columns inside the transaction.</span></span> <span data-ttu-id="06f0c-142">Tanto as modificações de atualização quanto de esquema podem ser executadas na mesma transação.</span><span class="sxs-lookup"><span data-stu-id="06f0c-142">Both update and schema modifications can be performed in the same transaction.</span></span> <span data-ttu-id="06f0c-143">Depois que a transação for concluída com [JetCommitTransaction](./jetcommittransaction-function.md), a atualização será registrada no arquivo de log de transações.</span><span class="sxs-lookup"><span data-stu-id="06f0c-143">After the transaction completes with [JetCommitTransaction](./jetcommittransaction-function.md), the update is logged in the transaction log file.</span></span> <span data-ttu-id="06f0c-144">Esses arquivos podem ser usados para manter um estado logicamente consistente no caso de um encerramento de processo inesperado ou de um desligamento do sistema.</span><span class="sxs-lookup"><span data-stu-id="06f0c-144">These files can be used to maintain a logically consistent state in the event of an unexpected process termination or system shutdown.</span></span>

<span data-ttu-id="06f0c-145">As transações podem ser aninhadas até 7 níveis com chamadas correspondentes para [JetBeginTransaction](./jetbegintransaction-function.md) e [JetCommitTransaction](./jetcommittransaction-function.md) ou [JetRollback](./jetrollback-function.md) aninhadas entre si.</span><span class="sxs-lookup"><span data-stu-id="06f0c-145">Transactions may be nested up to 7 levels with matching calls to [JetBeginTransaction](./jetbegintransaction-function.md) and [JetCommitTransaction](./jetcommittransaction-function.md) or [JetRollback](./jetrollback-function.md) nested within each other.</span></span> <span data-ttu-id="06f0c-146">Isso permite que o aplicativo Reverta uma parte da transação sem precisar refazer a transação inteira.</span><span class="sxs-lookup"><span data-stu-id="06f0c-146">This allows the application to rollback a part of the transaction without having to back out of the entire transaction.</span></span> <span data-ttu-id="06f0c-147">A chamada aninhada para [JetCommitTransaction](./jetcommittransaction-function.md) significa que esse nível de processamento está concluído; no entanto, a transação não é confirmada no banco de dados até a chamada mais externa para confirmar a transação com [JetCommitTransaction](./jetcommittransaction-function.md).</span><span class="sxs-lookup"><span data-stu-id="06f0c-147">The nested call to [JetCommitTransaction](./jetcommittransaction-function.md) signifies that this level of processing is complete; however, the transaction is not committed to the database until the outer most call to commit the transaction with [JetCommitTransaction](./jetcommittransaction-function.md).</span></span>

<span data-ttu-id="06f0c-148">Colunas de atualização de caução podem ser atualizadas simultaneamente por várias sessões sem falha com Jet_errWriteConflict.</span><span class="sxs-lookup"><span data-stu-id="06f0c-148">Escrow update columns can be updated concurrently by multiple sessions without failing with Jet_errWriteConflict.</span></span> <span data-ttu-id="06f0c-149">A função [JetEscrowUpdate](./jetescrowupdate-function.md) só pode ser chamada em colunas de caução, colunas que foram criadas com Jet_bitColumnEscrowUpdate.</span><span class="sxs-lookup"><span data-stu-id="06f0c-149">The [JetEscrowUpdate](./jetescrowupdate-function.md) function may only be called on escrow columns, columns that were created with Jet_bitColumnEscrowUpdate.</span></span>
