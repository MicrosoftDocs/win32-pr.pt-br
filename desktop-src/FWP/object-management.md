---
title: Gerenciamento de objetos
description: Esta seção aborda o uso correto dos tipos de objeto da API da Windows Filtering Platform (WFP).
ms.assetid: 2625ef9a-0e62-4e21-ba93-047965d0d782
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: dc41560bb85a7e79c0262d77c0b34fe6c1d9bfd6
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/19/2020
ms.locfileid: "104454012"
---
# <a name="object-management"></a><span data-ttu-id="dde03-103">Gerenciamento de objetos</span><span class="sxs-lookup"><span data-stu-id="dde03-103">Object Management</span></span>

<span data-ttu-id="dde03-104">Esta seção aborda o uso correto dos tipos de objeto da API da Windows Filtering Platform (WFP).</span><span class="sxs-lookup"><span data-stu-id="dde03-104">This section covers the correct use of Windows Filtering Platform (WFP) API object types.</span></span>

## <a name="sessions"></a><span data-ttu-id="dde03-105">Sessões</span><span class="sxs-lookup"><span data-stu-id="dde03-105">Sessions</span></span>

<span data-ttu-id="dde03-106">A API WFP é orientada a sessão e a maioria das chamadas de função são feitas dentro do contexto de uma sessão.</span><span class="sxs-lookup"><span data-stu-id="dde03-106">The WFP API is session-oriented, and most function calls are made within the context of a session.</span></span> <span data-ttu-id="dde03-107">Uma nova sessão de cliente é criada chamando [**FwpmEngineOpen0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineopen0).</span><span class="sxs-lookup"><span data-stu-id="dde03-107">A new client session is created by calling [**FwpmEngineOpen0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineopen0).</span></span> <span data-ttu-id="dde03-108">A sessão termina quando o cliente chama [**FwpmEngineClose0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineclose0) ou o processo do cliente é encerrado.</span><span class="sxs-lookup"><span data-stu-id="dde03-108">The session ends either when the client calls [**FwpmEngineClose0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineclose0) or the client process terminates.</span></span> <span data-ttu-id="dde03-109">Quando uma sessão é destruída, seja por finalidade ou pelo encerramento de RPC, o mecanismo de filtragem base (BFE) primeiro anula qualquer transação existente.</span><span class="sxs-lookup"><span data-stu-id="dde03-109">When a session is destroyed, either on purpose or by the RPC rundown, the Base Filtering Engine (BFE) first aborts any existing transaction.</span></span>

<span data-ttu-id="dde03-110">Ao criar uma nova sessão, o chamador pode criar uma sessão dinâmica passando o sinalizador [**\_ \_ \_ dinâmico sinalizador de sessão FWPM**](/windows/desktop/api/Fwpmtypes/ns-fwpmtypes-fwpm_session0) para [**FwpmEngineOpen0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineopen0).</span><span class="sxs-lookup"><span data-stu-id="dde03-110">When creating a new session, the caller can create a dynamic session by passing the [**FWPM\_SESSION\_FLAG\_DYNAMIC**](/windows/desktop/api/Fwpmtypes/ns-fwpmtypes-fwpm_session0) flag to [**FwpmEngineOpen0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineopen0).</span></span> <span data-ttu-id="dde03-111">Todos os objetos adicionados durante uma sessão dinâmica são excluídos automaticamente quando a sessão termina.</span><span class="sxs-lookup"><span data-stu-id="dde03-111">Any objects added during a dynamic session are automatically deleted when the session ends.</span></span>

## <a name="transactions"></a><span data-ttu-id="dde03-112">Transactions</span><span class="sxs-lookup"><span data-stu-id="dde03-112">Transactions</span></span>

<span data-ttu-id="dde03-113">A API WFP é transacional e a maioria das chamadas de função são feitas dentro do contexto de uma transação.</span><span class="sxs-lookup"><span data-stu-id="dde03-113">The WFP API is transactional, and most function calls are made within the context of a transaction.</span></span> <span data-ttu-id="dde03-114">Os chamadores podem usar [**FwpmTransactionBegin0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionbegin0), [**FwpmTransactionCommit0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactioncommit0)e [**FwpmTransactionAbort0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionabort0) para controlar explicitamente as transações.</span><span class="sxs-lookup"><span data-stu-id="dde03-114">Callers can use [**FwpmTransactionBegin0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionbegin0), [**FwpmTransactionCommit0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactioncommit0), and [**FwpmTransactionAbort0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionabort0) to explicitly control transactions.</span></span> <span data-ttu-id="dde03-115">No entanto, se uma chamada de função for feita fora de uma transação explícita, ela será executada dentro de uma transação implícita.</span><span class="sxs-lookup"><span data-stu-id="dde03-115">However, if a function call is made outside of an explicit transaction, it will be executed within an implicit transaction.</span></span> <span data-ttu-id="dde03-116">Se uma transação estiver em andamento, quando uma sessão for encerrada, ela será anulada automaticamente.</span><span class="sxs-lookup"><span data-stu-id="dde03-116">If a transaction is in progress, when a session terminates, it is automatically aborted.</span></span> <span data-ttu-id="dde03-117">As transações implícitas nunca são anuladas forçosamente.</span><span class="sxs-lookup"><span data-stu-id="dde03-117">Implicit transactions are never forcibly aborted.</span></span>

<span data-ttu-id="dde03-118">As transações são somente leitura ou leitura/gravação e aplicam semântica[Acid](../cossdk/acid-properties.md)(durável) consistente de atomicidade.</span><span class="sxs-lookup"><span data-stu-id="dde03-118">Transactions are either read-only or read/write and enforce rigorous Atomic Consistent Isolated Durable ([ACID](../cossdk/acid-properties.md)) semantics.</span></span>

<span data-ttu-id="dde03-119">Cada sessão de cliente pode ter apenas uma transação em andamento por vez.</span><span class="sxs-lookup"><span data-stu-id="dde03-119">Each client session can have only one transaction in progress at a time.</span></span> <span data-ttu-id="dde03-120">Se o chamador tentar iniciar uma segunda transação antes de confirmar ou anular a primeira, o BFE retornará um erro.</span><span class="sxs-lookup"><span data-stu-id="dde03-120">If the caller attempts to begin a second transaction before committing or aborting the first, BFE returns an error.</span></span>

<span data-ttu-id="dde03-121">Se uma operação falhar durante o curso de uma transação, ela não afetará o estado geral da transação.</span><span class="sxs-lookup"><span data-stu-id="dde03-121">If an operation fails during the course of a transaction, it does not affect the overall state of the transaction.</span></span> <span data-ttu-id="dde03-122">Por exemplo, suponha que o cliente inicie uma transação e chame com êxito [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0) três vezes antes de uma quarta chamada falhar.</span><span class="sxs-lookup"><span data-stu-id="dde03-122">For example, suppose the client begins a transaction and successfully calls [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0) three times before a fourth call fails.</span></span> <span data-ttu-id="dde03-123">Agora, o cliente tem a opção de:</span><span class="sxs-lookup"><span data-stu-id="dde03-123">The client now has the option of:</span></span>

-   <span data-ttu-id="dde03-124">Anulando a transação; nesse caso, nenhum dos filtros será adicionado.</span><span class="sxs-lookup"><span data-stu-id="dde03-124">Aborting the transaction, in which case none of the filters will be added.</span></span>
-   <span data-ttu-id="dde03-125">Confirmando a transação, caso em que os três primeiros filtros serão adicionados.</span><span class="sxs-lookup"><span data-stu-id="dde03-125">Committing the transaction, in which case the first three filters will be added.</span></span>
-   <span data-ttu-id="dde03-126">Continuando com mais operações, incluindo possivelmente repetir o [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0)com falha.</span><span class="sxs-lookup"><span data-stu-id="dde03-126">Continuing with more operations including potentially retrying the failed [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0).</span></span>

<span data-ttu-id="dde03-127">Ao iniciar uma transação, o BFE aguardará até que a [**txnWaitTimeoutInMSec**](/windows/desktop/api/Fwpmtypes/ns-fwpmtypes-fwpm_session0) da sessão expire para adquirir o bloqueio.</span><span class="sxs-lookup"><span data-stu-id="dde03-127">When beginning a transaction, BFE will wait until the session's [**txnWaitTimeoutInMSec**](/windows/desktop/api/Fwpmtypes/ns-fwpmtypes-fwpm_session0) expires to acquire the lock.</span></span> <span data-ttu-id="dde03-128">Se o bloqueio não for adquirido dentro desse tempo, a aquisição de bloqueio (e a chamada [**FwpmTransactionBegin0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionbegin0) ) falhará.</span><span class="sxs-lookup"><span data-stu-id="dde03-128">If the lock is not acquired within this time, the lock acquisition (and the [**FwpmTransactionBegin0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionbegin0) call) will fail.</span></span> <span data-ttu-id="dde03-129">Isso impede que os clientes não respondam indefinidamente.</span><span class="sxs-lookup"><span data-stu-id="dde03-129">This prevents clients from indefinitely failing to respond.</span></span> <span data-ttu-id="dde03-130">Se o cliente não tiver especificado um tempo limite de bloqueio, o padrão será 15 segundos.</span><span class="sxs-lookup"><span data-stu-id="dde03-130">If the client did not specify a lock timeout, it defaults to 15 seconds.</span></span>

<span data-ttu-id="dde03-131">Cada transação também tem um tempo limite de bloqueio.</span><span class="sxs-lookup"><span data-stu-id="dde03-131">Each transaction also has a lock timeout.</span></span> <span data-ttu-id="dde03-132">Essa é a quantidade máxima de tempo que pode ser proprietária do bloqueio.</span><span class="sxs-lookup"><span data-stu-id="dde03-132">This is the maximum amount of time that it can own the lock.</span></span> <span data-ttu-id="dde03-133">Se o proprietário não liberar o bloqueio dentro desse tempo, a transação será anulada à força, fazendo com que o bloqueio seja liberado.</span><span class="sxs-lookup"><span data-stu-id="dde03-133">If the owner does not release the lock within this time, the transaction is forcibly aborted, causing the lock to be released.</span></span> <span data-ttu-id="dde03-134">O tempo limite de bloqueio não é configurável.</span><span class="sxs-lookup"><span data-stu-id="dde03-134">The lock timeout is not configurable.</span></span> <span data-ttu-id="dde03-135">Ele é infinito para chamadores de modo kernel e uma hora para chamadores de modo de usuário.</span><span class="sxs-lookup"><span data-stu-id="dde03-135">It is infinite for kernel-mode callers and one hour for user-mode callers.</span></span> <span data-ttu-id="dde03-136">Se uma transação for forçosamente anulada, a próxima chamada feita dentro dessa transação falhará com **fwp \_ E \_ TXN \_ abortado**.</span><span class="sxs-lookup"><span data-stu-id="dde03-136">If a transaction is forcibly aborted, the next call made within that transaction will fail with **FWP\_E\_TXN\_ABORTED**.</span></span>

## <a name="object-lifetimes"></a><span data-ttu-id="dde03-137">Tempos de vida do objeto</span><span class="sxs-lookup"><span data-stu-id="dde03-137">Object Lifetimes</span></span>

<span data-ttu-id="dde03-138">Os objetos podem ter um dos quatro tempos de vida possíveis:</span><span class="sxs-lookup"><span data-stu-id="dde03-138">Objects can have one of four possible lifetimes:</span></span>

-   <span data-ttu-id="dde03-139">Dinâmico — um objeto será dinâmico somente se for adicionado usando um identificador de sessão dinâmica.</span><span class="sxs-lookup"><span data-stu-id="dde03-139">Dynamic — An object is dynamic only if it is added using a dynamic session handle.</span></span> <span data-ttu-id="dde03-140">Objetos dinâmicos até que sejam excluídos ou a sessão de propriedade seja encerrada.</span><span class="sxs-lookup"><span data-stu-id="dde03-140">Dynamic objects live until they are deleted or the owning session terminates.</span></span>
-   <span data-ttu-id="dde03-141">Estático – os objetos são estáticos por padrão.</span><span class="sxs-lookup"><span data-stu-id="dde03-141">Static — Objects are static by default.</span></span> <span data-ttu-id="dde03-142">Os objetos estáticos são ativados até serem excluídos, o BFE é interrompido ou o sistema é desligado.</span><span class="sxs-lookup"><span data-stu-id="dde03-142">Static objects live until they are deleted, BFE stops, or the system is shutdown.</span></span>
-   <span data-ttu-id="dde03-143">Persistent – objetos persistentes são criados passando o sinalizador **\_ \* \_ \_ persistente de sinalizador FWPM** apropriado para uma função **\* Add0 FWPM** .</span><span class="sxs-lookup"><span data-stu-id="dde03-143">Persistent — Persistent objects are created by passing the appropriate **FWPM\_\*\_FLAG\_PERSISTENT** flag to an **Fwpm\*Add0** function.</span></span> <span data-ttu-id="dde03-144">Objetos persistentes em tempo real até que sejam excluídos.</span><span class="sxs-lookup"><span data-stu-id="dde03-144">Persistent objects live until they are deleted.</span></span>
-   <span data-ttu-id="dde03-145">Interno — os objetos internos são predefinidos por BFE e não podem ser adicionados ou excluídos.</span><span class="sxs-lookup"><span data-stu-id="dde03-145">Built-in — Built-in objects are predefined by BFE and cannot be added or deleted.</span></span> <span data-ttu-id="dde03-146">Eles vivem para sempre.</span><span class="sxs-lookup"><span data-stu-id="dde03-146">They live forever.</span></span>

<span data-ttu-id="dde03-147">Filtros em camadas de modo kernel podem ser marcados como filtros de tempo de inicialização passando o sinalizador apropriado para [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0).</span><span class="sxs-lookup"><span data-stu-id="dde03-147">Filters in kernel-mode layers can be marked as boot-time filters by passing the appropriate flag to [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0).</span></span> <span data-ttu-id="dde03-148">Os filtros de tempo de inicialização são adicionados ao sistema quando o driver TCP/IP é iniciado e removido quando o BFE conclui a inicialização.</span><span class="sxs-lookup"><span data-stu-id="dde03-148">Boot-time filters are added to the system when the TCP/IP driver starts, and removed when BFE finishes initialization.</span></span> <span data-ttu-id="dde03-149">Os objetos persistentes são adicionados quando o BFE é iniciado.</span><span class="sxs-lookup"><span data-stu-id="dde03-149">Persistent objects are added when BFE starts.</span></span>

<span data-ttu-id="dde03-150">Em muitos casos, um provedor de política pode não querer que sua política persistente seja imposta se o provedor tiver sido desabilitado.</span><span class="sxs-lookup"><span data-stu-id="dde03-150">In many cases, a policy provider may not want its persistent policy enforced if the provider has been disabled.</span></span> <span data-ttu-id="dde03-151">Ao adicionar um provedor, o chamador pode especificar um nome de serviço Windows opcional.</span><span class="sxs-lookup"><span data-stu-id="dde03-151">When adding a provider, the caller can specify an optional Windows service name.</span></span> <span data-ttu-id="dde03-152">Ao adicionar objetos persistentes, o chamador pode opcionalmente especificar o provedor que "possui" esse objeto.</span><span class="sxs-lookup"><span data-stu-id="dde03-152">When adding persistent objects, the caller can optionally specify the provider that "owns" that object.</span></span> <span data-ttu-id="dde03-153">No início do serviço, o BFE adiciona somente objetos persistentes ao sistema se eles não estiverem associados a um provedor ou se o provedor associado não tiver nenhum nome de serviço do Windows ou se o serviço do Windows associado estiver definido como início automático.</span><span class="sxs-lookup"><span data-stu-id="dde03-153">At service start, BFE only adds persistent objects to the system if they are not associated with a provider, or the associated provider has no Windows service name, or the associated Windows service is set to auto-start.</span></span>

## <a name="object-associations"></a><span data-ttu-id="dde03-154">Associações de objeto</span><span class="sxs-lookup"><span data-stu-id="dde03-154">Object Associations</span></span>

<span data-ttu-id="dde03-155">Alguns objetos têm referências a outros objetos.</span><span class="sxs-lookup"><span data-stu-id="dde03-155">Some objects have references to other objects.</span></span> <span data-ttu-id="dde03-156">Por exemplo, um filtro sempre faz referência a uma camada e pode fazer referência a um texto explicativo e a um contexto de provedor.</span><span class="sxs-lookup"><span data-stu-id="dde03-156">For example, a filter always references a layer and may reference a callout and a provider context.</span></span> <span data-ttu-id="dde03-157">Os objetos não podem se referir a objetos que podem ter um tempo de vida menor.</span><span class="sxs-lookup"><span data-stu-id="dde03-157">Objects cannot refer to objects that may have a shorter lifetime.</span></span> <span data-ttu-id="dde03-158">Portanto, um objeto dinâmico não pode se referir a um objeto dinâmico de uma sessão diferente.</span><span class="sxs-lookup"><span data-stu-id="dde03-158">Thus, a dynamic object cannot refer to a dynamic object from a different session.</span></span> <span data-ttu-id="dde03-159">Um objeto estático não pode se referir a um objeto dinâmico.</span><span class="sxs-lookup"><span data-stu-id="dde03-159">A static object cannot refer to a dynamic object.</span></span> <span data-ttu-id="dde03-160">Um objeto persistente não pode se referir a um objeto dinâmico, um objeto estático ou um objeto persistente de propriedade de um provedor diferente.</span><span class="sxs-lookup"><span data-stu-id="dde03-160">A persistent object cannot refer to a dynamic object, a static object, or a persistent object owned by a different provider.</span></span>

<span data-ttu-id="dde03-161">Um objeto não pode ser excluído até que todos os objetos que fazem referência a ele tenham sido excluídos primeiro.</span><span class="sxs-lookup"><span data-stu-id="dde03-161">An object cannot be deleted until all objects that reference it have first been deleted.</span></span>

## <a name="luids-and-guids"></a><span data-ttu-id="dde03-162">LUIDs e GUIDs</span><span class="sxs-lookup"><span data-stu-id="dde03-162">LUIDs and GUIDs</span></span>

<span data-ttu-id="dde03-163">Todos os FWPM (objetos de API WFP) de modo de usuário são identificados por um **GUID**(identificador global exclusivo) e fazem referência a outros objetos por seus s **GUID**.</span><span class="sxs-lookup"><span data-stu-id="dde03-163">All user mode WFP API objects (FWPM) are identified by a globally unique identifier (**GUID**) and reference other objects by their **GUID** s.</span></span> <span data-ttu-id="dde03-164">O **GUID** só precisa ser exclusivo dentro do tipo de objeto.</span><span class="sxs-lookup"><span data-stu-id="dde03-164">The **GUID** need only be unique within the object type.</span></span> <span data-ttu-id="dde03-165">Por exemplo, um filtro e um contexto de provedor podem ter o mesmo **GUID**, mas dois filtros não podem.</span><span class="sxs-lookup"><span data-stu-id="dde03-165">For example, a filter and a provider context can have the same **GUID**, but two filters cannot.</span></span> <span data-ttu-id="dde03-166">Ao adicionar um novo objeto, os chamadores podem atribuir o **GUID** do objeto ou deixá-los inicializados com zero e deixar o BFE atribuir o **GUID**.</span><span class="sxs-lookup"><span data-stu-id="dde03-166">When adding a new object, callers can assign the object's **GUID** or leave it zero-initialized and let BFE assign the **GUID**.</span></span>

<span data-ttu-id="dde03-167">Todos os FWPS (objetos de API WFP) de modo kernel são identificados por um **LUID**(identificador local exclusivo) e fazem referência a outros objetos por sua LUID.</span><span class="sxs-lookup"><span data-stu-id="dde03-167">All kernel mode WFP API objects (FWPS) are identified by a locally unique identifier (**LUID**) and reference other objects by their LUID.</span></span> <span data-ttu-id="dde03-168">A mudança de **GUID** para **LUID** permite que a WFP preserve pool não paginável e otimize o processamento em tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="dde03-168">The switch from **GUID** to **LUID** enables WFP to conserve non-paged pool and optimize run-time processing.</span></span> <span data-ttu-id="dde03-169">A largura da **LUID** depende do tipo de objeto e varia de um **UINT16** para um **UINT64**.</span><span class="sxs-lookup"><span data-stu-id="dde03-169">The width of the **LUID** depends on the object type and ranges from a **UINT16** to a **UINT64**.</span></span> <span data-ttu-id="dde03-170">Os s de **LUID** são sempre atribuídos por BFE.</span><span class="sxs-lookup"><span data-stu-id="dde03-170">**LUID** s are always assigned by BFE.</span></span>

 

 