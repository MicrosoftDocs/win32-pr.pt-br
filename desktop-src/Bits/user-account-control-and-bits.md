---
title: Controle de conta de usuário e BITS
description: Quando um usuário administrador faz logon no computador, dois tokens de acesso são criados. Um é um token de acesso de usuário padrão filtrado e o outro é um token de acesso de administrador completo.
ms.assetid: 02439ab3-b885-4a2f-b507-0c48d2b30b76
ms.topic: article
ms.date: 7/12/2019
ms.openlocfilehash: 3017b3a0d816ba393d1427c5c1d2315a68b2dcc0
ms.sourcegitcommit: be77ed1f97d3be57a2f42070589de21b66034adf
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/29/2020
ms.locfileid: "103917071"
---
# <a name="bits-security-tokens-and-administrator-accounts"></a><span data-ttu-id="975d3-104">Segurança de BITS, tokens e contas de administrador</span><span class="sxs-lookup"><span data-stu-id="975d3-104">BITS Security, Tokens, and Administrator Accounts</span></span>

## <a name="http-server-certificate-callbacks"></a><span data-ttu-id="975d3-105">Retornos de chamada de certificado do servidor HTTP</span><span class="sxs-lookup"><span data-stu-id="975d3-105">HTTP Server certificate callbacks</span></span>
<span data-ttu-id="975d3-106">A validação correta de certificados de servidor é uma parte fundamental da manutenção da segurança HTTPS.</span><span class="sxs-lookup"><span data-stu-id="975d3-106">Correctly validating server certificates is a key part of maintaining HTTPS security.</span></span> <span data-ttu-id="975d3-107">O BITS ajuda a sempre validar certificados de servidor em uma lista de requisitos especificados por [**SetSecurityFlags**](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setsecurityflags).</span><span class="sxs-lookup"><span data-stu-id="975d3-107">BITS helps by always validating server certificates against a list of requirements specified by [**SetSecurityFlags**](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setsecurityflags).</span></span> <span data-ttu-id="975d3-108">Por padrão, o BITS usa a validação de certificado de estilo "navegador".</span><span class="sxs-lookup"><span data-stu-id="975d3-108">By default, BITS uses "browser" style certificate validation.</span></span>

<span data-ttu-id="975d3-109">Você também pode especificar uma função personalizada para chamar a fim de validar ainda mais o certificado.</span><span class="sxs-lookup"><span data-stu-id="975d3-109">You can also specify a custom function to call in order to further validate the certificate.</span></span> <span data-ttu-id="975d3-110">Defina o retorno de chamada do certificado do servidor com o método [**SetServerCertificateValidationInterface**](/windows/desktop/api/Bits10_3/nf-bits10_3-ibackgroundcopyjobhttpoptions3-setservercertificatevalidationinterface) .</span><span class="sxs-lookup"><span data-stu-id="975d3-110">Set the server certificate callback with the [**SetServerCertificateValidationInterface**](/windows/desktop/api/Bits10_3/nf-bits10_3-ibackgroundcopyjobhttpoptions3-setservercertificatevalidationinterface) method.</span></span> <span data-ttu-id="975d3-111">Seu método só será chamado depois que o sistema operacional tiver validado o certificado com base na chamada do [ **SetSecurityFlag** s](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setsecurityflags) .</span><span class="sxs-lookup"><span data-stu-id="975d3-111">Your method will only be called after the operating system has validated the certificate based on the [**SetSecurityFlag** s](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setsecurityflags) call.</span></span> 

## <a name="http-client-certificates"></a><span data-ttu-id="975d3-112">Certificados de cliente HTTP</span><span class="sxs-lookup"><span data-stu-id="975d3-112">HTTP Client certificates</span></span>
<span data-ttu-id="975d3-113">Você pode definir um certificado de cliente em um trabalho HTTP com dois métodos de configurações de certificado diferentes.</span><span class="sxs-lookup"><span data-stu-id="975d3-113">You can set a client certificate on an HTTP job with two different certificate settings methods.</span></span> <span data-ttu-id="975d3-114">Você pode definir um certificado por [ID](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setclientcertificatebyid) ou pelo [nome da entidade](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setclientcertificatebyname)do certificado.</span><span class="sxs-lookup"><span data-stu-id="975d3-114">You can set a certificate either by [ID](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setclientcertificatebyid) or by the certificate [subject name](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setclientcertificatebyname).</span></span> <span data-ttu-id="975d3-115">O certificado do cliente será usado durante a negociação TLS (ou renegociação) se o servidor exigir autenticação de cliente.</span><span class="sxs-lookup"><span data-stu-id="975d3-115">The client certificate will be used during TLS negotiation (or renegotiation) if the server requires client authentication.</span></span>

## <a name="write-only-http-headers"></a><span data-ttu-id="975d3-116">Cabeçalhos HTTP somente gravação</span><span class="sxs-lookup"><span data-stu-id="975d3-116">Write-only HTTP headers</span></span>
<span data-ttu-id="975d3-117">O BITS ajuda a proteger tokens de autenticação HTTP de acesso indesejado.</span><span class="sxs-lookup"><span data-stu-id="975d3-117">BITS helps you protect HTTP authentication tokens from unwanted access.</span></span> <span data-ttu-id="975d3-118">Geralmente, um servidor HTTP precisará de algum tipo de token de segurança ou cadeia de caracteres ao baixar ou carregar um arquivo em servidores HTTP.</span><span class="sxs-lookup"><span data-stu-id="975d3-118">Often an HTTP server will need some kind of security token or string when downloading or uploading a file to HTTP servers.</span></span>

<span data-ttu-id="975d3-119">O BITS protege esses tokens de autenticação de várias maneiras.</span><span class="sxs-lookup"><span data-stu-id="975d3-119">BITS protects these authentication tokens in several ways.</span></span>
* <span data-ttu-id="975d3-120">O BITS permite que você use conexões HTTP protegidas por TLS e SSL especificando uma URL HTTPS.</span><span class="sxs-lookup"><span data-stu-id="975d3-120">BITS lets you use TLS- and SSL-protected HTTP connections by specifying an HTTPS URL.</span></span>
* <span data-ttu-id="975d3-121">Os cabeçalhos personalizados sempre são persistidos em um formato criptografado no disco.</span><span class="sxs-lookup"><span data-stu-id="975d3-121">Custom headers are always persisted in an encrypted format on disk.</span></span>
* <span data-ttu-id="975d3-122">Você pode impedir que cabeçalhos de clientes sejam retornados para outros programas com o método [**IBackgroundCopyJobHttpOptions3:: MakeCustomHeadersWriteOnly**](/windows/win32/api/Bits10_3/nf-bits10_3-ibackgroundcopyjobhttpoptions3-makecustomheaderswriteonly) .</span><span class="sxs-lookup"><span data-stu-id="975d3-122">You can prevent customer headers from being returned to other programs with the [**IBackgroundCopyJobHttpOptions3::MakeCustomHeadersWriteOnly**](/windows/win32/api/Bits10_3/nf-bits10_3-ibackgroundcopyjobhttpoptions3-makecustomheaderswriteonly) method.</span></span>


## <a name="standard-and-administrator-users"></a><span data-ttu-id="975d3-123">Usuários padrão e administrador</span><span class="sxs-lookup"><span data-stu-id="975d3-123">Standard and Administrator users</span></span>
<span data-ttu-id="975d3-124">Um usuário que está no grupo de administradores pode executar um processo com acesso de usuário padrão ou em um estado elevado (com privilégios de administrador).</span><span class="sxs-lookup"><span data-stu-id="975d3-124">A user who is in the administrator group can run a process with standard user access or in an elevated state (with administrator privileges).</span></span> <span data-ttu-id="975d3-125">O BITS executará o trabalho em qualquer Estado, desde que o usuário esteja conectado ao computador.</span><span class="sxs-lookup"><span data-stu-id="975d3-125">BITS will run the job in either state as long as the user is logged onto the computer.</span></span> <span data-ttu-id="975d3-126">No entanto, se o usuário criou o trabalho ou assumiu a propriedade do trabalho em um estado elevado, o usuário deve estar no estado elevado para recuperar ou modificar o trabalho (caso contrário, a chamada falhará com acesso negado (0x80070005)).</span><span class="sxs-lookup"><span data-stu-id="975d3-126">However, if the user created the job or took ownership of the job in an elevated state, the user must be in the elevated state to retrieve or modify the job (otherwise, the call fails with Access Denied (0x80070005)).</span></span> <span data-ttu-id="975d3-127">Para determinar o estado elevado de um trabalho, chame o método [**IBackgroundCopyJob4:: GetOwnerElevationState**](/windows/desktop/api/Bits3_0/nf-bits3_0-ibackgroundcopyjob4-getownerelevationstate) .</span><span class="sxs-lookup"><span data-stu-id="975d3-127">To determine the elevated state of a job, call the [**IBackgroundCopyJob4::GetOwnerElevationState**](/windows/desktop/api/Bits3_0/nf-bits3_0-ibackgroundcopyjob4-getownerelevationstate) method.</span></span>

<span data-ttu-id="975d3-128">Um usuário padrão não pode enumerar ou modificar trabalhos pertencentes a outros usuários.</span><span class="sxs-lookup"><span data-stu-id="975d3-128">A standard user cannot enumerate or modify jobs owned by other users.</span></span>

## <a name="integrity-level"></a><span data-ttu-id="975d3-129">Nível de integridade</span><span class="sxs-lookup"><span data-stu-id="975d3-129">Integrity level</span></span>
<span data-ttu-id="975d3-130">Além do estado elevado, o nível de integridade do token pode determinar se o usuário pode modificar um trabalho.</span><span class="sxs-lookup"><span data-stu-id="975d3-130">In addition to the elevated state, the integrity level of the token can determine if the user can modify a job.</span></span> <span data-ttu-id="975d3-131">Um cliente não pode modificar trabalhos criados por um token com um nível de integridade mais alto.</span><span class="sxs-lookup"><span data-stu-id="975d3-131">A client cannot modify jobs created by a token with a higher integrity level.</span></span> <span data-ttu-id="975d3-132">Em particular, muitos tokens do sistema local carregam um nível de integridade maior que o nível de integridade de uma janela com privilégios elevados e, portanto, não podem ser modificados por um administrador de uma janela de comando com privilégios elevados.</span><span class="sxs-lookup"><span data-stu-id="975d3-132">In particular, many local-system tokens carry an integrity level higher than the integrity level of an elevated window, and so they cannot be modified by an administrator from an ordinary elevated command window.</span></span> <span data-ttu-id="975d3-133">Por exemplo, Windows Update e trabalhos de SMS são executados como LocalSystem, que tem um nível de integridade mais alto do que um token elevado, para que um administrador não possa modificar ou excluir esses trabalhos.</span><span class="sxs-lookup"><span data-stu-id="975d3-133">For example, Windows Update and SMS jobs run as LocalSystem which has a higher integrity level than an elevated token so an administrator cannot modify or delete these jobs.</span></span> <span data-ttu-id="975d3-134">Para modificar esses trabalhos, crie uma tarefa Agendador de Tarefas que seja executada como sistema local.</span><span class="sxs-lookup"><span data-stu-id="975d3-134">To modify these job, create a Task Scheduler task that runs as local system.</span></span> <span data-ttu-id="975d3-135">A tarefa pode executar um aplicativo de console que usa a API BITS, ou a tarefa pode executar um script que chama BitsAdmin.exe.</span><span class="sxs-lookup"><span data-stu-id="975d3-135">The task can execute a console application that uses the BITS API, or the task could execute a script that calls BitsAdmin.exe.</span></span> <span data-ttu-id="975d3-136">Para determinar o nível de integridade usado, chame o método [**IBackgroundCopyJob4:: GetOwnerIntegrityLevel**](/windows/desktop/api/Bits3_0/nf-bits3_0-ibackgroundcopyjob4-getownerintegritylevel) .</span><span class="sxs-lookup"><span data-stu-id="975d3-136">To determine the integrity level used, call the [**IBackgroundCopyJob4::GetOwnerIntegrityLevel**](/windows/desktop/api/Bits3_0/nf-bits3_0-ibackgroundcopyjob4-getownerintegritylevel) method.</span></span>

## <a name="service-identity"></a><span data-ttu-id="975d3-137">Identidade do serviço</span><span class="sxs-lookup"><span data-stu-id="975d3-137">Service identity</span></span>
<span data-ttu-id="975d3-138">A partir do Windows 10 pode ser 2019 atualização (10,0; Build 18362), os trabalhos do BITS iniciados a partir de um serviço manterão a identidade do serviço.</span><span class="sxs-lookup"><span data-stu-id="975d3-138">Starting in the Windows 10 May 2019 Update (10.0; Build 18362), BITS jobs started from a service will maintain the service identity.</span></span> <span data-ttu-id="975d3-139">Isso permite que os serviços que desejam usar o BITS baixem arquivos ou carreguem arquivos de um diretório cujas permissões estejam vinculadas ao SID do serviço.</span><span class="sxs-lookup"><span data-stu-id="975d3-139">This allows for services that wish to use BITS to download files to or upload files from a directory whose permissions are tied to the service SID.</span></span> <span data-ttu-id="975d3-140">Além disso, o tráfego de rede será atribuído corretamente ao serviço que solicitou o trabalho BITS em vez de ser atribuído ao BITS.</span><span class="sxs-lookup"><span data-stu-id="975d3-140">Additionally, network traffic will be correctly attributed to the service that requested the BITS job instead of being attributed to BITS.</span></span>

 




