---
title: Definindo permissões em diretórios virtuais
description: Por motivos de segurança, Serviço de Transferência Inteligente em Segundo Plano (BITS) não carrega arquivos em um diretório virtual que tem permissões de execução e script habilitadas.
ms.assetid: cf5c8b50-066f-431e-8bdf-ed0692219b20
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e6753c326e926724a57e1905c3fb9fe24e28fdc7
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/20/2020
ms.locfileid: "104007766"
---
# <a name="setting-permissions-on-virtual-directories"></a><span data-ttu-id="e0f49-103">Definindo permissões em diretórios virtuais</span><span class="sxs-lookup"><span data-stu-id="e0f49-103">Setting Permissions on Virtual Directories</span></span>

<span data-ttu-id="e0f49-104">Por motivos de segurança, Serviço de Transferência Inteligente em Segundo Plano (BITS) não carrega arquivos em um diretório virtual que tem permissões de execução e script habilitadas.</span><span class="sxs-lookup"><span data-stu-id="e0f49-104">For security reasons, Background Intelligent Transfer Service (BITS) does not upload files to a virtual directory that has scripting and execute permissions enabled.</span></span> <span data-ttu-id="e0f49-105">Se você carregar um arquivo em um diretório virtual que tenha essas permissões habilitadas, o trabalho falhará com um código de erro de BG \_ E \_ execução do servidor \_ \_ habilitado.</span><span class="sxs-lookup"><span data-stu-id="e0f49-105">If you upload a file to a virtual directory that has these permissions enabled, the job fails with an error code of BG\_E\_SERVER\_EXECUTE\_ENABLED.</span></span>

<span data-ttu-id="e0f49-106">O BITS não exige que o diretório virtual esteja habilitado para gravação, portanto, é recomendável que você desative o acesso de gravação ao diretório virtual.</span><span class="sxs-lookup"><span data-stu-id="e0f49-106">BITS does not require the virtual directory to be write enabled, so it is recommended that you turn off write access to the virtual directory.</span></span>

<span data-ttu-id="e0f49-107">O usuário autenticado (ou usuário anônimo do IIS para autenticação anônima) deve ter permissões de alteração no diretório físico para o qual o diretório virtual é mapeado; a concessão de permissões de gravação não é suficiente.</span><span class="sxs-lookup"><span data-stu-id="e0f49-107">The authenticated user (or IIS's Anonymous user for anonymous authentication) must have Change permissions on the physical directory to which the virtual directory is mapped; granting Write permissions does not suffice.</span></span>

## <a name="specifying-permissions-for-notifications"></a><span data-ttu-id="e0f49-108">Especificando permissões para notificações</span><span class="sxs-lookup"><span data-stu-id="e0f49-108">Specifying Permissions for Notifications</span></span>

<span data-ttu-id="e0f49-109">O esquema de autenticação especificado para o diretório virtual e a URL de notificação (consulte a propriedade [BITSServerNotificationURL](bits-iis-extension-properties.md) ) deve ser compatível.</span><span class="sxs-lookup"><span data-stu-id="e0f49-109">The authentication scheme you specify for the virtual directory and notification URL (see the [BITSServerNotificationURL](bits-iis-extension-properties.md) property) must be compatible.</span></span> <span data-ttu-id="e0f49-110">O BITS usa o esquema de autenticação especificado para o diretório virtual para acessar a URL de notificação.</span><span class="sxs-lookup"><span data-stu-id="e0f49-110">BITS uses the authentication scheme specified for the virtual directory to access the notification URL.</span></span> <span data-ttu-id="e0f49-111">O trabalho de upload falhará se o BITS não puder acessar a URL de notificação devido a uma falha de autenticação.</span><span class="sxs-lookup"><span data-stu-id="e0f49-111">The upload job fails if BITS is unable to access the notification URL due to authentication failure.</span></span>

<span data-ttu-id="e0f49-112">Se o tipo de notificação (consulte a propriedade [BITSServerNotificationType](bits-iis-extension-properties.md) ) for [por referência](using-bits-notification-request-response-headers.md), o aplicativo deverá garantir que o usuário tenha acesso ao arquivo referenciado (consulte o cabeçalho [bits-Request-DataFile-Name](notification-protocol-for-server-applications.md) ).</span><span class="sxs-lookup"><span data-stu-id="e0f49-112">If the notification type (see the [BITSServerNotificationType](bits-iis-extension-properties.md) property) is [by reference](using-bits-notification-request-response-headers.md), the application must ensure the user has access to the referenced file (see the [BITS-Request-DataFile-Name](notification-protocol-for-server-applications.md) header).</span></span> <span data-ttu-id="e0f49-113">O BITS define as ACLs no arquivo referenciado para aqueles do diretório físico para o qual o diretório virtual é mapeado.</span><span class="sxs-lookup"><span data-stu-id="e0f49-113">BITS sets the ACLs on the referenced file to those of the physical directory to which the virtual directory is mapped.</span></span>

> [!Note]  
> <span data-ttu-id="e0f49-114">O aplicativo notificado deve ser capaz de mapear e acessar o arquivo remoto, mesmo que a URL de notificação seja atendida por um servidor Web que esteja em um computador diferente do diretório de carregamento físico.</span><span class="sxs-lookup"><span data-stu-id="e0f49-114">The notified application must be able to map and access the remote file even if the notification URL is serviced by a web server that is on a different computer than the physical upload directory.</span></span> <span data-ttu-id="e0f49-115">O cabeçalho [bits-Request-DataFile-Name](notification-protocol-for-server-applications.md) sempre contém uma especificação de caminho que é relativa ao computador que hospeda o componente de extensões do bits.</span><span class="sxs-lookup"><span data-stu-id="e0f49-115">The [BITS-Request-DataFile-Name](notification-protocol-for-server-applications.md) header always contains a path specification that is relative to the computer hosting the BITS Extensions component.</span></span> <span data-ttu-id="e0f49-116">Um aplicativo em execução em outro computador pode precisar converter o caminho para um caminho UNC antes de acessá-lo.</span><span class="sxs-lookup"><span data-stu-id="e0f49-116">An application running on another computer might need to convert the path to an UNC path before accessing it.</span></span>

 

<span data-ttu-id="e0f49-117">O BITS dá suporte a muitas combinações de esquemas de autenticação.</span><span class="sxs-lookup"><span data-stu-id="e0f49-117">BITS supports many combinations of authentication schemes.</span></span> <span data-ttu-id="e0f49-118">No entanto, você deve usar o seguinte esquema de autenticação para o diretório virtual e a URL de notificação de correspondência.</span><span class="sxs-lookup"><span data-stu-id="e0f49-118">However, you should use the following authentication scheme for the virtual directory and the matching notification URL.</span></span>

-   <span data-ttu-id="e0f49-119">Para dar suporte a notificações de referência, o diretório virtual deve ser configurado para usar a autenticação NTLM (Negotiate) se o diretório de carregamento físico (o diretório no qual os pontos do diretório virtual) usar um esquema de autenticação diferente de anônimo.</span><span class="sxs-lookup"><span data-stu-id="e0f49-119">To support by reference notifications, the virtual directory should be configured to use NTLM (negotiate) authentication if the physical upload directory (the directory to which the virtual directory points) uses an authentication scheme other than anonymous.</span></span> <span data-ttu-id="e0f49-120">Se o diretório de carregamento físico permitir solicitações anônimas (sem autenticação), o diretório virtual deverá habilitar anônimo (sem autenticação).</span><span class="sxs-lookup"><span data-stu-id="e0f49-120">If the physical upload directory allows anonymous requests (no authentication), the virtual directory should enable anonymous (no authentication).</span></span>

    <span data-ttu-id="e0f49-121">As ACLs no diretório de carregamento físico devem ser definidas de modo que o usuário autenticado possa ler arquivos no diretório para o qual a URL de notificação aponta.</span><span class="sxs-lookup"><span data-stu-id="e0f49-121">The ACLs on the physical upload directory must be set such that the authenticated user can read files on the directory to which the notification URL points.</span></span> <span data-ttu-id="e0f49-122">O BITS usa as ACLs do diretório de carregamento físico para definir as ACLs de arquivo de carregamento temporário (o cabeçalho [bits-Request-DataFile-Name](notification-protocol-for-server-applications.md) contém o caminho para o arquivo temporário).</span><span class="sxs-lookup"><span data-stu-id="e0f49-122">BITS uses the ACLs of the physical upload directory to set the ACLs of temporary upload file (the [BITS-Request-DataFile-Name](notification-protocol-for-server-applications.md) header contains the path to the temporary file).</span></span>

-   <span data-ttu-id="e0f49-123">Como as notificações [de valor](using-bits-notification-request-response-headers.md) não exigem que o aplicativo notificado acesse um arquivo temporário que contém o conteúdo de upload, o esquema de autenticação pode ser anônimo ou Negotiate (NTLM).</span><span class="sxs-lookup"><span data-stu-id="e0f49-123">Because [by value](using-bits-notification-request-response-headers.md) notifications do not require the notified application to access a temporary file that contains the upload contents, the authentication scheme can be either anonymous or negotiate (NTLM).</span></span> <span data-ttu-id="e0f49-124">O único requisito é que o usuário autenticado para o diretório virtual também deva ser autorizado a acessar a URL de notificação.</span><span class="sxs-lookup"><span data-stu-id="e0f49-124">The only requirement is that the authenticated user for the virtual directory must also be authorized to access the notification URL.</span></span>

## <a name="specifying-permissions-for-remote-shares"></a><span data-ttu-id="e0f49-125">Especificando permissões para compartilhamentos remotos</span><span class="sxs-lookup"><span data-stu-id="e0f49-125">Specifying Permissions for Remote Shares</span></span>

<span data-ttu-id="e0f49-126">Um diretório virtual pode apontar para uma unidade mapeada em um computador diferente ou um compartilhamento de rede.</span><span class="sxs-lookup"><span data-stu-id="e0f49-126">A virtual directory can point to a mapped drive on a different machine or a network share.</span></span> <span data-ttu-id="e0f49-127">Se ele apontar para uma unidade de rede mapeada, as credenciais usadas para mapear a unidade deverão ter controle total sobre o compartilhamento remoto.</span><span class="sxs-lookup"><span data-stu-id="e0f49-127">If it points to a mapped network drive, the credentials used to map the drive should have full control on the remote share.</span></span>

<span data-ttu-id="e0f49-128">Se o diretório virtual apontar para um compartilhamento de rede, o BITS usará a **conexão** do diretório virtual como credenciais de usuário para acessar o compartilhamento remoto.</span><span class="sxs-lookup"><span data-stu-id="e0f49-128">If the virtual directory points to a network share, BITS uses the virtual directory's **Connect As** user credentials to access the remote share.</span></span> <span data-ttu-id="e0f49-129">Para acessar um compartilhamento remoto, a conta **conectar como** precisa ter privilégios, conforme descrito na documentação da função [**LogonUser**](/windows/desktop/api/winbase/nf-winbase-logonusera) .</span><span class="sxs-lookup"><span data-stu-id="e0f49-129">To access a remote share, the **Connect As** account needs to have privileges as described in the documentation for the [**LogonUser**](/windows/desktop/api/winbase/nf-winbase-logonusera) function.</span></span> <span data-ttu-id="e0f49-130">O BITS faz logon usando o lote de logon do LOGON32 \_ \_ ou \_ tipos de logon interativo de logon do LOGON32 \_ .</span><span class="sxs-lookup"><span data-stu-id="e0f49-130">BITS logs on using LOGON32\_LOGON\_BATCH or LOGON32\_LOGON\_INTERACTIVE logon types.</span></span> <span data-ttu-id="e0f49-131">A conta **conectar como** usuário precisa Full-Access permissões para o compartilhamento remoto; a concessão de permissões de gravação não é suficiente.</span><span class="sxs-lookup"><span data-stu-id="e0f49-131">The **Connect As** user account needs Full-Access permissions to the remote share; granting Write permissions does not suffice.</span></span>

<span data-ttu-id="e0f49-132">Quando o diretório de carregamento físico é mapeado para um compartilhamento de rede, a identidade do chamador que solicita a URL de notificação é o usuário **Connect** as ou o usuário autenticado do diretório físico de carregamento (disponível somente no IIS 6,0 e posterior, quando a caixa de seleção **sempre usa as credenciais do usuário autenticado ao validar o acesso ao recurso de rede** é selecionada na caixa de diálogo **conectar-se**</span><span class="sxs-lookup"><span data-stu-id="e0f49-132">When the physical upload directory is mapped to a network share, the identity of the caller requesting the notification URL is either the **Connect As** user, or the authenticated user of the physical upload directory (only available in IIS 6.0 and later, when the check box **Always use the authenticated user's credentials when validating access to the network resource** is selected on the **Connect As** dialog box).</span></span>

 

 