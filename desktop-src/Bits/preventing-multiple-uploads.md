---
title: Impedindo vários carregamentos
description: Quando você carrega um arquivo, o BITS cria uma ID de sessão que identifica a sessão de carregamento para o cliente BITS e para o servidor BITS.
ms.assetid: 97283f8e-d2fa-4383-9b92-a05f46680443
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ae59bb1d605af7e4dd53b0c1d66618b6816e7886
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/16/2019
ms.locfileid: "104004967"
---
# <a name="preventing-multiple-uploads"></a><span data-ttu-id="62dd5-103">Impedindo vários carregamentos</span><span class="sxs-lookup"><span data-stu-id="62dd5-103">Preventing Multiple Uploads</span></span>

<span data-ttu-id="62dd5-104">Quando você carrega um arquivo, o BITS cria uma ID de sessão que identifica a sessão de carregamento para o cliente BITS e para o servidor BITS.</span><span class="sxs-lookup"><span data-stu-id="62dd5-104">When you upload a file, BITS creates a session ID that identifies the upload session to both the BITS client and BITS server.</span></span> <span data-ttu-id="62dd5-105">Se a conexão entre o cliente BITS e o servidor for interrompida enquanto o BITS estiver carregando um arquivo, o cliente usará a ID de sessão para tentar retomar o carregamento.</span><span class="sxs-lookup"><span data-stu-id="62dd5-105">If the connection between the BITS client and server is broken while BITS is uploading a file, the client will use the session ID to try to resume the upload.</span></span>

<span data-ttu-id="62dd5-106">Se o cliente BITS se conectar ao mesmo servidor que antes, o servidor reconhecerá a ID de sessão e o carregamento será retomado do ponto de interrupção.</span><span class="sxs-lookup"><span data-stu-id="62dd5-106">If the BITS client connects to the same server as before, the server will recognize the session ID and the upload will resume from the point of interruption.</span></span> <span data-ttu-id="62dd5-107">No entanto, se o cliente se conectar a um servidor diferente, o cliente deverá iniciar o carregamento desde o início, porque o novo servidor não tem o contexto de sessão ou os dados carregados anteriormente.</span><span class="sxs-lookup"><span data-stu-id="62dd5-107">However, if the client connects to a different server, the client must start the upload from the beginning because the new server does not have the session context or the previously uploaded data.</span></span> <span data-ttu-id="62dd5-108">Os BITS podem se conectar a um servidor diferente quando o servidor BITS é hospedado em um web farm e a propriedade de extensão IIS do BITS, [BITSHostId](bits-iis-extension-properties.md), não está definida.</span><span class="sxs-lookup"><span data-stu-id="62dd5-108">BITS may connect to a different server when the BITS server is hosted on a web farm and the BITS IIS extension property, [BITSHostId](bits-iis-extension-properties.md), is not set.</span></span> <span data-ttu-id="62dd5-109">A propriedade BITSHostId impede reinicializações, forçando o cliente BITS a se conectar ao endereço exclusivo do servidor anterior, em vez do endereço do servidor compartilhado.</span><span class="sxs-lookup"><span data-stu-id="62dd5-109">The BITSHostId property prevents restarts by forcing the BITS client to connect to the previous server's unique address instead of the shared server address.</span></span>

<span data-ttu-id="62dd5-110">O servidor BITS tentará enviar o arquivo de upload apenas uma vez para o aplicativo de servidor, mas é possível que o arquivo possa ser enviado mais de uma vez.</span><span class="sxs-lookup"><span data-stu-id="62dd5-110">The BITS server will attempt to send the upload file only once to the server application, but it is possible that the file may be sent more than one time.</span></span> <span data-ttu-id="62dd5-111">Isso pode ocorrer, por exemplo, se o servidor BITS envia o arquivo para o aplicativo de servidor e, em seguida, termina enquanto aguarda a resposta do aplicativo de servidor.</span><span class="sxs-lookup"><span data-stu-id="62dd5-111">This can occur, for example, if the BITS server sends the file to the server application and then terminates while waiting for the reply from the server application.</span></span> <span data-ttu-id="62dd5-112">O cliente BITS receberá um código de erro da camada HTTP e tentará o upload novamente após um atraso.</span><span class="sxs-lookup"><span data-stu-id="62dd5-112">The BITS client will receive an error code from the HTTP layer, and retry the upload after a delay.</span></span> <span data-ttu-id="62dd5-113">Se o servidor ficar offline por mais tempo do que o tempo limite de [BITSHostIdFallbackTimeout](bits-iis-extension-properties.md) , o cliente eventualmente enviará a solicitação para o endereço do servidor compartilhado novamente; um servidor BITS diferente receberá o arquivo e o entregará novamente para o aplicativo do servidor.</span><span class="sxs-lookup"><span data-stu-id="62dd5-113">If the server stays offline for longer than the [BITSHostIdFallbackTimeout](bits-iis-extension-properties.md) timeout, then the client will eventually send the request to the shared server address again; a different BITS server will receive the file and deliver it again to the server application.</span></span>

<span data-ttu-id="62dd5-114">Um caso semelhante pode ocorrer mesmo com um único servidor front-end.</span><span class="sxs-lookup"><span data-stu-id="62dd5-114">A similar case can occur even with a single front-end server.</span></span> <span data-ttu-id="62dd5-115">Por exemplo, quando o cliente carregou o arquivo inteiro no servidor, o bloco final faz com que o servidor encaminhe o arquivo para o aplicativo de servidor.</span><span class="sxs-lookup"><span data-stu-id="62dd5-115">For example, when the client has uploaded the entire file to the server, the final block causes the server to forward the file to the server application.</span></span> <span data-ttu-id="62dd5-116">Se o servidor BITS ou o aplicativo de servidor terminar depois que o arquivo for processado, mas antes que a confirmação seja enviada ao cliente, o cliente receberá um código de erro e tentará novamente mais tarde.</span><span class="sxs-lookup"><span data-stu-id="62dd5-116">If the BITS server or the server application terminate after the file is processed but before the acknowledgment is sent to the client, then the client will receive an error code and retry later.</span></span> <span data-ttu-id="62dd5-117">Quando o cliente tentar novamente, o servidor BITS verá que o bloco final foi carregado, e ele encaminhará novamente o arquivo para o aplicativo de servidor.</span><span class="sxs-lookup"><span data-stu-id="62dd5-117">When the client retries, the BITS server will see that the final block has been uploaded, and it will again forward the file to the server application.</span></span> <span data-ttu-id="62dd5-118">Se receber o arquivo de carregamento várias vezes for um problema para o aplicativo de servidor, você deverá considerar a inclusão de um identificador de transação nos dados.</span><span class="sxs-lookup"><span data-stu-id="62dd5-118">If receiving the upload file multiple times is an issue for your server application, you should consider including a transaction identifier in the data.</span></span>

 

 




