---
title: Chamando SRSetRestorePoint
description: Um aplicativo pode criar um ponto de restauração antes de causar uma alteração significativa no sistema, como uma instalação, desinstalação ou atualização de recursos.
ms.assetid: 77981e75-8c3f-4ecc-82f4-e88d68df661a
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b877c4fe73bcedad363bb4c9cc770a9638550dbd
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/16/2019
ms.locfileid: "103636729"
---
# <a name="calling-srsetrestorepoint"></a><span data-ttu-id="0e826-103">Chamando SRSetRestorePoint</span><span class="sxs-lookup"><span data-stu-id="0e826-103">Calling SRSetRestorePoint</span></span>

<span data-ttu-id="0e826-104">Um aplicativo pode criar um ponto de restauração antes de causar uma alteração significativa no sistema, como uma instalação, desinstalação ou atualização de recursos.</span><span class="sxs-lookup"><span data-stu-id="0e826-104">An application can create a restore point before it causes a significant system change, such as an install, uninstall, or feature update.</span></span>

<span data-ttu-id="0e826-105">Os instaladores devem criar um ponto de restauração logo antes da instalação chamando a função [**SRSetRestorePoint**](/windows/desktop/api/SRRestorePtAPI/nf-srrestoreptapi-srsetrestorepointa) com o membro **DwEventType** da estrutura [**RESTOREPOINTINFO**](/windows/win32/api/srrestoreptapi/ns-srrestoreptapi-restorepointinfoa) definida para iniciar a \_ alteração do sistema \_ .</span><span class="sxs-lookup"><span data-stu-id="0e826-105">Installers should create a restore point just prior to installation by calling the [**SRSetRestorePoint**](/windows/desktop/api/SRRestorePtAPI/nf-srrestoreptapi-srsetrestorepointa) function with the **dwEventType** member of the [**RESTOREPOINTINFO**](/windows/win32/api/srrestoreptapi/ns-srrestoreptapi-restorepointinfoa) structure set to BEGIN\_SYSTEM\_CHANGE.</span></span> <span data-ttu-id="0e826-106">Para notificar a restauração do sistema de que a instalação foi concluída, chame **SRSetRestorePoint** com **DWEVENTTYPE** definido como finalizar \_ alteração do sistema \_ .</span><span class="sxs-lookup"><span data-stu-id="0e826-106">To notify System Restore that the installation has been completed, call **SRSetRestorePoint** with **dwEventType** set to END\_SYSTEM\_CHANGE.</span></span>

<span data-ttu-id="0e826-107">Se o usuário cancelar a instalação do aplicativo, o instalador poderá remover o ponto de restauração criado quando a instalação começou.</span><span class="sxs-lookup"><span data-stu-id="0e826-107">If the user cancels the application installation, the installer may remove the restore point it created when the installation began.</span></span> <span data-ttu-id="0e826-108">A remoção do ponto de restauração é opcional e pode impedir que o usuário se recupere de alterações não intencionais feitas pelo instalador durante o cancelamento.</span><span class="sxs-lookup"><span data-stu-id="0e826-108">Removing the restore point is optional and can prevent the user from recovering from unintentional changes made by the installer during the cancellation.</span></span> <span data-ttu-id="0e826-109">Se o instalador for remover um ponto de restauração, ele poderá chamar a função [**SRRemoveRestorePoint**](/windows/desktop/api/SRRestorePtAPI/nf-srrestoreptapi-srremoverestorepoint) ou chamar [**SRSetRestorePoint**](/windows/desktop/api/SRRestorePtAPI/nf-srrestoreptapi-srsetrestorepointa) com **dwRestorePointType** definido para a operação cancelada \_ , **dwEventType** definido como finalizar \_ alteração do sistema \_ e **llSequenceNumber** definido como o valor retornado pela chamada inicial para **SRSetRestorePoint**.</span><span class="sxs-lookup"><span data-stu-id="0e826-109">If the installer is to remove a restore point, it can call the [**SRRemoveRestorePoint**](/windows/desktop/api/SRRestorePtAPI/nf-srrestoreptapi-srremoverestorepoint) function, or call [**SRSetRestorePoint**](/windows/desktop/api/SRRestorePtAPI/nf-srrestoreptapi-srsetrestorepointa) with **dwRestorePointType** set to CANCELLED\_OPERATION, **dwEventType** set to END\_SYSTEM\_CHANGE, and **llSequenceNumber** set to the value returned by the initial call to **SRSetRestorePoint**.</span></span>

<span data-ttu-id="0e826-110">**Windows 8:  **</span><span class="sxs-lookup"><span data-stu-id="0e826-110">**Windows 8:  **</span></span>

<span data-ttu-id="0e826-111">Uma nova chave do Registro permite que os desenvolvedores de aplicativos alterem a frequência da criação do ponto de restauração.</span><span class="sxs-lookup"><span data-stu-id="0e826-111">A new registry key enables application developers to change the frequency of restore-point creation.</span></span>

<span data-ttu-id="0e826-112">Os aplicativos devem criar essa chave para usá-la porque ela não existirá no sistema.</span><span class="sxs-lookup"><span data-stu-id="0e826-112">Applications should create this key to use it because it will not preexist in the system.</span></span> <span data-ttu-id="0e826-113">O seguinte será aplicado por padrão se a chave não existir.</span><span class="sxs-lookup"><span data-stu-id="0e826-113">The following will apply by default if the key does not exist.</span></span> <span data-ttu-id="0e826-114">Se um aplicativo chamar a função **SRSetRestorePoint** para criar um ponto de restauração, o Windows ignorará a criação desse novo ponto de restauração se quaisquer pontos de restauração tiverem sido criados nas últimas 24 horas.</span><span class="sxs-lookup"><span data-stu-id="0e826-114">If an application calls the **SRSetRestorePoint** function to create a restore point, Windows skips creating this new restore point if any restore points have been created in the last 24 hours.</span></span> <span data-ttu-id="0e826-115">A restauração do sistema define o membro **IISequenceNumber** da estrutura [**STATEMGRSTATUS**](/windows/win32/api/srrestoreptapi/ns-srrestoreptapi-statemgrstatus) para o número de sequência do ponto de restauração criado anteriormente no dia e define o valor do membro **NStatus** para **o \_ êxito do erro**.</span><span class="sxs-lookup"><span data-stu-id="0e826-115">System Restore sets the **IISequenceNumber** member of the [**STATEMGRSTATUS**](/windows/win32/api/srrestoreptapi/ns-srrestoreptapi-statemgrstatus) structure to the sequence number for the restore point created previously in the day and sets the value of the **nStatus** member to **ERROR\_SUCCESS**.</span></span> <span data-ttu-id="0e826-116">A função **SRSetRestorePoint** retorna **true**.</span><span class="sxs-lookup"><span data-stu-id="0e826-116">The **SRSetRestorePoint** function returns **TRUE**.</span></span>

<span data-ttu-id="0e826-117">Os desenvolvedores podem escrever aplicativos que criam o valor **DWORD** **SystemRestorePointCreationFrequency** na chave do registro **HKLM \\ software \\ Microsoft \\ Windows NT \\ CurrentVersion \\ SystemRestore**.</span><span class="sxs-lookup"><span data-stu-id="0e826-117">Developers can write applications that create the **DWORD** value **SystemRestorePointCreationFrequency** under the registry key **HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\SystemRestore**.</span></span> <span data-ttu-id="0e826-118">O valor dessa chave do registro pode alterar a frequência da criação do ponto de restauração.</span><span class="sxs-lookup"><span data-stu-id="0e826-118">The value of this registry key can change the frequency of restore point creation.</span></span> <span data-ttu-id="0e826-119">O valor dessa chave do registro pode alterar a frequência da criação do ponto de restauração.</span><span class="sxs-lookup"><span data-stu-id="0e826-119">The value of this registry key can change the frequency of restore point creation.</span></span>

<span data-ttu-id="0e826-120">Se o aplicativo chamar **SRSetRestorePoint** para criar um ponto de restauração e o valor da chave do registro for 0, a restauração do sistema não ignorará a criação do novo ponto de restauração.</span><span class="sxs-lookup"><span data-stu-id="0e826-120">If the application calls **SRSetRestorePoint** to create a restore point, and the registry key value is 0, system restore does not skip creating the new restore point.</span></span>

<span data-ttu-id="0e826-121">Se o aplicativo chamar **SRSetRestorePoint** para criar um ponto de restauração e o valor da chave do registro for o inteiro N, a restauração do sistema ignorará a criação de um novo ponto de restauração se qualquer ponto de restauração tiver sido criado nos N minutos anteriores.</span><span class="sxs-lookup"><span data-stu-id="0e826-121">If the application calls **SRSetRestorePoint** to create a restore point, and the registry key value is the integer N, system restore skips creating a new restore point if any restore points were created in the previous N minutes.</span></span>

<span data-ttu-id="0e826-122">**Windows 8:  **</span><span class="sxs-lookup"><span data-stu-id="0e826-122">**Windows 8:  **</span></span>

<span data-ttu-id="0e826-123">A restauração do sistema em execução no Windows 8 monitora arquivos no volume de inicialização que são relevantes somente para restauração do sistema.</span><span class="sxs-lookup"><span data-stu-id="0e826-123">System Restore running on Windows 8 monitors files in the boot volume that are relevant for system restore only.</span></span> <span data-ttu-id="0e826-124">Os instantâneos do volume de inicialização criados pela restauração do sistema em execução no Windows 8 poderão ser excluídos se o instantâneo for posteriormente exposto por uma versão anterior do Windows.</span><span class="sxs-lookup"><span data-stu-id="0e826-124">Snapshots of the boot volume created by System Restore running on Windows 8 may be deleted if the snapshot is subsequently exposed by an earlier version of Windows.</span></span> <span data-ttu-id="0e826-125">Observe que, embora haja apenas um volume do sistema, há um volume de inicialização para cada sistema operacional em um sistema de várias inicializações.</span><span class="sxs-lookup"><span data-stu-id="0e826-125">Note that although there is only one system volume, there is one boot volume for each operating system in a multi-boot system.</span></span>

<span data-ttu-id="0e826-126">Os desenvolvedores podem escrever aplicativos que criam o valor **DWORD** **ScopeSnapshots** na chave do registro **HKLM \\ software \\ Microsoft \\ Windows NT \\ CurrentVersion \\ SystemRestore**.</span><span class="sxs-lookup"><span data-stu-id="0e826-126">Developers can write applications that create the **DWORD** value **ScopeSnapshots** under the registry key **HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\SystemRestore**.</span></span> <span data-ttu-id="0e826-127">Se esse valor de chave do registro for 0, a restauração do sistema criará instantâneos do volume de inicialização da mesma maneira que nas versões anteriores do Windows.</span><span class="sxs-lookup"><span data-stu-id="0e826-127">If this registry key value is 0, System Restore creates snapshots of the boot volume in the same way as in earlier versions of Windows.</span></span> <span data-ttu-id="0e826-128">Se esse valor for excluído, a restauração do sistema em execução no Windows 8 retomará a criação de instantâneos que monitoram arquivos no volume de inicialização que são relevantes somente para restauração do sistema.</span><span class="sxs-lookup"><span data-stu-id="0e826-128">If this value is deleted, System Restore running on Windows 8 resumes creating snapshots that monitor files in the boot volume that are relevant for system restore only.</span></span>

<span data-ttu-id="0e826-129">Para obter um exemplo, consulte [usando a restauração do sistema](using-system-restore.md).</span><span class="sxs-lookup"><span data-stu-id="0e826-129">For an example, see [Using System Restore](using-system-restore.md).</span></span>

 

 




