---
title: Diretrizes para aplicativos
description: Os aplicativos executados no Windows Vista e no Windows Server 2008 devem aderir a essas diretrizes para garantir que o Gerenciador de reinicialização possa desligar e reiniciar os aplicativos, se necessário, para instalar atualizações.
ms.assetid: 97b1df63-65a9-47b4-891b-e4a754882b89
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3ebace21e09956c68d34c90775c5ea646a8b2dd0
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/20/2020
ms.locfileid: "103641681"
---
# <a name="guidelines-for-applications"></a><span data-ttu-id="40360-103">Diretrizes para aplicativos</span><span class="sxs-lookup"><span data-stu-id="40360-103">Guidelines for Applications</span></span>

<span data-ttu-id="40360-104">Os aplicativos executados no Windows Vista e no Windows Server 2008 devem aderir a essas diretrizes para garantir que o Gerenciador de reinicialização possa desligar e reiniciar os aplicativos, se necessário, para instalar atualizações.</span><span class="sxs-lookup"><span data-stu-id="40360-104">Applications running on Windows Vista and Windows Server 2008 should adhere to these guidelines to ensure that the Restart Manager can shut down and restart applications if necessary to install updates.</span></span> <span data-ttu-id="40360-105">Os serviços podem usar as diretrizes descritas em [diretrizes para serviços](guidelines-for-services.md).</span><span class="sxs-lookup"><span data-stu-id="40360-105">Services can use the guidelines that are described in [Guidelines for Services](guidelines-for-services.md).</span></span>

-   <span data-ttu-id="40360-106">O Gerenciador de reinicialização consulta aplicativos de GUI para desligamento enviando uma notificação do [**WM \_ QUERYENDSESSION**](/windows/desktop/Shutdown/wm-queryendsession) que tem o parâmetro *lParam* definido como **EndSession \_ CLOSEAPP** (0x1).</span><span class="sxs-lookup"><span data-stu-id="40360-106">The Restart Manager queries GUI applications for shutdown by sending a [**WM\_QUERYENDSESSION**](/windows/desktop/Shutdown/wm-queryendsession) notification that has the *lParam* parameter set to **ENDSESSION\_CLOSEAPP** (0x1).</span></span> <span data-ttu-id="40360-107">Os aplicativos não devem ser desligados quando recebem uma mensagem do **WM \_ QUERYENDSESSION** porque outro aplicativo pode não estar pronto para ser desligado.</span><span class="sxs-lookup"><span data-stu-id="40360-107">Applications should not shut down when they receive a **WM\_QUERYENDSESSION** message because another application may not be ready to shut down.</span></span> <span data-ttu-id="40360-108">Os aplicativos de GUI devem escutar a mensagem do **WM \_ QUERYENDSESSION** e retornar um valor **true** se o aplicativo estiver preparado para ser desligado e reiniciado.</span><span class="sxs-lookup"><span data-stu-id="40360-108">GUI applications should listen for the **WM\_QUERYENDSESSION** message and return a value of **TRUE** if the application is prepared to shut down and restart.</span></span> <span data-ttu-id="40360-109">Se nenhum aplicativo retornar um valor **false**, o Gerenciador de reinicialização enviará uma mensagem de [**\_ EndSession do WM**](/windows/desktop/Shutdown/wm-endsession) com o parâmetro *lParam* definido como **EndSession \_ CLOSEAPP** (0x1) e o parâmetro *wParam* definido como **true**.</span><span class="sxs-lookup"><span data-stu-id="40360-109">If no application returns a value of **FALSE**, the Restart Manager sends a [**WM\_ENDSESSION**](/windows/desktop/Shutdown/wm-endsession) message with the *lParam* parameter set to **ENDSESSION\_CLOSEAPP** (0x1) and the *wparam* parameter set to **TRUE**.</span></span> <span data-ttu-id="40360-110">Os aplicativos devem ser desligados somente quando recebem a mensagem de **\_ EndSession do WM** .</span><span class="sxs-lookup"><span data-stu-id="40360-110">Applications should shut down only when they receive the **WM\_ENDSESSION** message.</span></span> <span data-ttu-id="40360-111">O Gerenciador de reinicialização também envia uma mensagem de [**\_ fechamento do WM**](../winmsg/wm-close.md) para aplicativos de GUI que não são desligados ao receber o **WM \_ EndSession**.</span><span class="sxs-lookup"><span data-stu-id="40360-111">The Restart Manager also sends a [**WM\_CLOSE**](../winmsg/wm-close.md) message for GUI applications that do not shut down on receiving **WM\_ENDSESSION**.</span></span> <span data-ttu-id="40360-112">Se qualquer aplicativo de GUI responder a uma mensagem do **WM \_ QUERYENDSESSION** retornando um valor **false**, o desligamento será cancelado.</span><span class="sxs-lookup"><span data-stu-id="40360-112">If any GUI application responds to a **WM\_QUERYENDSESSION** message by returning a value of **FALSE**, the shutdown is canceled.</span></span> <span data-ttu-id="40360-113">No entanto, se o desligamento for forçado, o aplicativo será encerrado independentemente.</span><span class="sxs-lookup"><span data-stu-id="40360-113">However, if the shutdown is forced, the application is terminated regardless.</span></span>
-   <span data-ttu-id="40360-114">Quando um aplicativo de GUI recebe uma mensagem de [**\_ EndSession do WM**](/windows/desktop/Shutdown/wm-endsession) , o aplicativo deve se preparar para ser desligado dentro do período de tempo limite especificado.</span><span class="sxs-lookup"><span data-stu-id="40360-114">When a GUI application receives a [**WM\_ENDSESSION**](/windows/desktop/Shutdown/wm-endsession) message, the application should prepare itself to shut down within the specified timeout period.</span></span> <span data-ttu-id="40360-115">No mínimo, os aplicativos devem se preparar salvando quaisquer dados de usuário e informações de estado necessárias após uma reinicialização.</span><span class="sxs-lookup"><span data-stu-id="40360-115">At a minimum, applications should prepare by saving any user data and state information that is needed after a restart.</span></span> <span data-ttu-id="40360-116">É recomendável que os aplicativos salvem periodicamente os dados e o estado do usuário.</span><span class="sxs-lookup"><span data-stu-id="40360-116">It is recommended that applications periodically save the user data and state.</span></span>
-   <span data-ttu-id="40360-117">O Gerenciador de reinicialização envia uma notificação de **\_ \_ evento CTRL C** para os aplicativos de console que devem ser desligados e reiniciados.</span><span class="sxs-lookup"><span data-stu-id="40360-117">The Restart Manager sends a **CTRL\_C\_EVENT** notification to console applications that must be shut down and restarted.</span></span> <span data-ttu-id="40360-118">Quando um aplicativo de console recebe uma notificação de **\_ \_ evento CTRL C** , o aplicativo deve executar ações necessárias para se preparar para um desligamento dentro do período de tempo limite especificado.</span><span class="sxs-lookup"><span data-stu-id="40360-118">When a console application receives a **CTRL\_C\_EVENT** notification, the application should take actions necessary to prepare for a shutdown within the specified timeout period.</span></span> <span data-ttu-id="40360-119">No mínimo, os aplicativos de console devem definir uma função [*HandlerRoutine*](/windows/console/handlerroutine) para manipular a notificação de **\_ \_ eventos CTRL C** e devem salvar quaisquer dados de usuário e informações de estado que serão necessárias após uma reinicialização.</span><span class="sxs-lookup"><span data-stu-id="40360-119">At a minimum, console applications should define a [*HandlerRoutine*](/windows/console/handlerroutine) function to handle the **CTRL\_C\_EVENT** notification and should save any user data and state information that is going to be needed after a restart.</span></span> <span data-ttu-id="40360-120">É recomendável que os aplicativos salvem periodicamente os dados e o estado do usuário.</span><span class="sxs-lookup"><span data-stu-id="40360-120">It is recommended that applications periodically save the user data and state.</span></span>
-   <span data-ttu-id="40360-121">Se algum aplicativo não for desligado em resposta às mensagens de desligamento, os instaladores poderão usar a opção **RmForceShutdown** da função [**RmShutdown**](/windows/desktop/api/RestartManager/nf-restartmanager-rmshutdown) para forçar a desligamento dos aplicativos.</span><span class="sxs-lookup"><span data-stu-id="40360-121">If any applications do not shut down in response to the shutdown messages, installers can use the **RmForceShutdown** option of the [**RmShutdown**](/windows/desktop/api/RestartManager/nf-restartmanager-rmshutdown) function to force the applications to shut down.</span></span> <span data-ttu-id="40360-122">Quando o instalador especifica um desligamento forçado, o Gerenciador de reinicialização tenta desligar os aplicativos de forma limpa, enviando as mensagens de desligamento, mas as forçará a fechar se isso falhar.</span><span class="sxs-lookup"><span data-stu-id="40360-122">When the installer specifies a forced shutdown, Restart Manager attempts to shut down the applications cleanly by sending the shutdown messages, but will force them shut if this fails.</span></span> <span data-ttu-id="40360-123">Aplicativos de GUI e aplicativos de console podem ser forçados a desligar para habilitar a instalação de uma atualização de segurança crítica.</span><span class="sxs-lookup"><span data-stu-id="40360-123">GUI applications and console applications can be forced to shut down to enable the installation of a critical security update.</span></span> <span data-ttu-id="40360-124">Como isso pode resultar em perda de dados, os aplicativos devem lidar com as mensagens de desligamento e desligar corretamente quando necessário.</span><span class="sxs-lookup"><span data-stu-id="40360-124">Because this can result in data loss, applications should handle the shutdown messages and shut down cleanly when required.</span></span>
-   <span data-ttu-id="40360-125">Os aplicativos devem se registrar para uma reinicialização usando a função [**RegisterApplicationRestart**](/windows/desktop/api/winbase/nf-winbase-registerapplicationrestart) .</span><span class="sxs-lookup"><span data-stu-id="40360-125">Applications should register for a restart by using the [**RegisterApplicationRestart**](/windows/desktop/api/winbase/nf-winbase-registerapplicationrestart) function.</span></span> <span data-ttu-id="40360-126">O Gerenciador de reinicialização só pode reiniciar os aplicativos que foram registrados para reinicialização.</span><span class="sxs-lookup"><span data-stu-id="40360-126">Restart Manager can only restart applications that have been registered for restart.</span></span> <span data-ttu-id="40360-127">Essa é a única maneira que o Gerenciador de reinicialização pode determinar o comando de linha de comando a ser usado ao reiniciar o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="40360-127">This is the only way that the Restart Manager can determine the command-line command to use when restarting the application.</span></span> <span data-ttu-id="40360-128">Se o aplicativo precisar ser reaberto com algum estado ou dados salvos, essas informações deverão ser incluídas no comando de linha de comando que está registrado para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="40360-128">If the application must reopen with some saved state or data, that information must be included in the command-line command that is registered for the application.</span></span>
    > [!Note]  
    > <span data-ttu-id="40360-129">Se o aplicativo reiniciado deve ser executado no mesmo diretório em que foi executado antes de ser desligado, o aplicativo deve salvar as informações do diretório e, em seguida, alterar para o diretório após a reinicialização.</span><span class="sxs-lookup"><span data-stu-id="40360-129">If the restarted application must run in the same directory it ran in before being shut down, the application must save the directory information and then change to the directory after restarting.</span></span>

     

    > [!Note]  
    > <span data-ttu-id="40360-130">A função [**RmRestart**](/windows/desktop/api/RestartManager/nf-restartmanager-rmrestart) não reinicia os aplicativos que não são executados como o usuário conectado no momento.</span><span class="sxs-lookup"><span data-stu-id="40360-130">The [**RmRestart**](/windows/desktop/api/RestartManager/nf-restartmanager-rmrestart) function does not restart applications that do not run as the currently-logged on user.</span></span> <span data-ttu-id="40360-131">Por exemplo, a função **RmRestart** não reinicia aplicativos iniciados com o comando **Executar como** que não são executados como o usuário conectado no momento.</span><span class="sxs-lookup"><span data-stu-id="40360-131">For example, the **RmRestart** function does not restart applications started with the **Run As** command that do not run as the currently-logged on user.</span></span> <span data-ttu-id="40360-132">Esses aplicativos devem ser reiniciados manualmente.</span><span class="sxs-lookup"><span data-stu-id="40360-132">These applications must be manually restarted.</span></span>

     

-   <span data-ttu-id="40360-133">Quando o Gerenciador de reinicialização determinar que uma reinicialização do sistema é necessária para instalar uma atualização, ele não desligará nenhum aplicativo e serviço.</span><span class="sxs-lookup"><span data-stu-id="40360-133">When Restart Manager determines that a system restart is required to install an update, it does not shut down any applications and services.</span></span> <span data-ttu-id="40360-134">Em vez disso, ele deixa isso no instalador para decidir quando agendar uma reinicialização do sistema e instalar a atualização.</span><span class="sxs-lookup"><span data-stu-id="40360-134">Instead, it leaves this to the installer to decide when to schedule a system restart and install the update.</span></span> <span data-ttu-id="40360-135">Os instaladores podem reduzir a interrupção para os usuários causados por atualizações que exigem uma reinicialização do sistema usando a função [**ExitWindowsEx**](/windows/desktop/api/winuser/nf-winuser-exitwindowsex) com o sinalizador **EWX \_ RESTARTAPPS** ou a função [**InitiateShutdown**](/windows/desktop/api/winreg/nf-winreg-initiateshutdowna) com o sinalizador **Shutdown \_ RESTARTAPPS** .</span><span class="sxs-lookup"><span data-stu-id="40360-135">Installers can reduce the disruption to users caused by updates that require a system restart by using the [**ExitWindowsEx**](/windows/desktop/api/winuser/nf-winuser-exitwindowsex) function with the **EWX\_RESTARTAPPS** flag or the [**InitiateShutdown**](/windows/desktop/api/winreg/nf-winreg-initiateshutdowna) function with the **SHUTDOWN\_RESTARTAPPS** flag.</span></span> <span data-ttu-id="40360-136">O uso desses sinalizadores garante que os aplicativos registrados para reinicialização sejam reiniciados após uma reinicialização do sistema, o que minimiza o impacto sobre o usuário.</span><span class="sxs-lookup"><span data-stu-id="40360-136">Using these flags ensures that applications registered for restart are restarted after a system reboot, which minimizes the impact on the user.</span></span>

 

 