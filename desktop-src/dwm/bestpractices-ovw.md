---
title: Considerações sobre desempenho e práticas recomendadas
description: Este tópico apresenta um conjunto de práticas recomendadas para usar as APIs do Gerenciador de Janelas da Área de Trabalho (DWM).
ms.assetid: 5b1f6ff8-1d3f-4a70-8efd-90f8802e8532
keywords:
- Gerenciador de Janelas da Área de Trabalho (DWM), práticas recomendadas
- DWM (Gerenciador de Janelas da Área de Trabalho), práticas recomendadas
- Gerenciador de Janelas da Área de Trabalho (DWM), práticas de aplicativo
- DWM (Gerenciador de Janelas da Área de Trabalho), práticas de aplicativo
- Gerenciador de Janelas da Área de Trabalho (DWM), práticas de desenho
- DWM (Gerenciador de Janelas da Área de Trabalho), práticas de desenho
- Gerenciador de Janelas da Área de Trabalho (DWM), Desfoque atrás do efeito
- DWM (Gerenciador de Janelas da Área de Trabalho), Desfoque atrás do efeito
- práticas de aplicativo
- práticas de desenho
- desfoque atrás do efeito
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ec76a4920a91f9502940e866d58641a2550d9354
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/20/2020
ms.locfileid: "105782687"
---
# <a name="performance-considerations-and-best-practices"></a><span data-ttu-id="c9b48-114">Considerações sobre desempenho e práticas recomendadas</span><span class="sxs-lookup"><span data-stu-id="c9b48-114">Performance Considerations and Best Practices</span></span>

<span data-ttu-id="c9b48-115">Este tópico apresenta um conjunto de práticas recomendadas para usar as APIs do Gerenciador de Janelas da Área de Trabalho (DWM).</span><span class="sxs-lookup"><span data-stu-id="c9b48-115">This topic presents a set of best practices for using the Desktop Window Manager (DWM) APIs.</span></span>

<span data-ttu-id="c9b48-116">Este tópico contém as seguintes seções:</span><span class="sxs-lookup"><span data-stu-id="c9b48-116">This topic contains the following sections:</span></span>

-   [<span data-ttu-id="c9b48-117">Práticas de aplicativo para DWM</span><span class="sxs-lookup"><span data-stu-id="c9b48-117">Application Practices for DWM</span></span>](#application-practices-for-dwm)
-   [<span data-ttu-id="c9b48-118">Práticas de desenho para DWM</span><span class="sxs-lookup"><span data-stu-id="c9b48-118">Drawing Practices for DWM</span></span>](#drawing-practices-for-dwm)
-   [<span data-ttu-id="c9b48-119">Blur-Behind de região do cliente do DWM</span><span class="sxs-lookup"><span data-stu-id="c9b48-119">DWM Blur-Behind Client Region</span></span>](#dwm-blur-behind-client-region)

## <a name="application-practices-for-dwm"></a><span data-ttu-id="c9b48-120">Práticas de aplicativo para DWM</span><span class="sxs-lookup"><span data-stu-id="c9b48-120">Application Practices for DWM</span></span>

<span data-ttu-id="c9b48-121">Se o seu aplicativo lida com o dimensionamento de pontos por polegada (DPI), você pode declarar um aplicativo como reconhecimento de dpi e impedir o dimensionamento automático definindo o sinalizador de reconhecimento de dpi no manifesto do programa ou chamando a função [**SetProcessDPIAware**](/windows/desktop/api/winuser/nf-winuser-setprocessdpiaware) durante a inicialização do programa.</span><span class="sxs-lookup"><span data-stu-id="c9b48-121">If your application handles dots per inch (dpi) scaling, you can declare an application as dpi-aware and prevent automatic scaling by setting the dpi-aware flag in the program's manifest or by calling the [**SetProcessDPIAware**](/windows/desktop/api/winuser/nf-winuser-setprocessdpiaware) function during program initialization.</span></span>

<span data-ttu-id="c9b48-122">Com a composição do DWM ativada, os aplicativos obscuros não recebem mais mensagens do [**WM \_ Paint**](/windows/desktop/gdi/wm-paint) e não são solicitados a renderizar novamente.</span><span class="sxs-lookup"><span data-stu-id="c9b48-122">With DWM composition turned on, obscured applications no longer receive [**WM\_PAINT**](/windows/desktop/gdi/wm-paint) messages and are not asked to re-render.</span></span> <span data-ttu-id="c9b48-123">O conteúdo de cada janela já está disponível para compor a imagem da tela.</span><span class="sxs-lookup"><span data-stu-id="c9b48-123">Each window's content is already available to compose the screen image.</span></span>

<span data-ttu-id="c9b48-124">As janelas [**\_ \_ transparentes do WS ex**](/windows/desktop/api/winuser/nf-winuser-createwindowexa) de nível superior devem ser combinadas com um estilo de **\_ \_ camada WS ex** para fins de teste de clique.</span><span class="sxs-lookup"><span data-stu-id="c9b48-124">Top-level [**WS\_EX\_TRANSPARENT**](/windows/desktop/api/winuser/nf-winuser-createwindowexa) windows should be combined with a **WS\_EX\_LAYERED** style for the purposes of hit testing.</span></span> <span data-ttu-id="c9b48-125">**WS \_ Por exemplo, \_ transparente** no sentido clássico, sem redirecionamento, é útil para janelas filhas em uma hierarquia de janelas que pertencem ao mesmo thread, mas não se destina a janelas de nível superior.</span><span class="sxs-lookup"><span data-stu-id="c9b48-125">**WS\_EX\_TRANSPARENT** in the classic sense, without redirection, is useful for child windows in a hierarchy of windows that belong to the same thread, but is not intended for top-level windows.</span></span>

<span data-ttu-id="c9b48-126">Use regiões ou camadas para criar janelas moldadas ou mistas.</span><span class="sxs-lookup"><span data-stu-id="c9b48-126">Use regions or layering to create shaped or blended windows.</span></span> <span data-ttu-id="c9b48-127">Observe que no Windows Vista e versões posteriores do Windows, o desenho personalizado apenas parte de uma janela de nível superior não fornecerá o conteúdo obsoleto desejado em regiões não desempates.</span><span class="sxs-lookup"><span data-stu-id="c9b48-127">Note that in Windows Vista and later versions of Windows, custom drawing only part of a top-level window will not provide the desired stale content in undrawn regions.</span></span>

<span data-ttu-id="c9b48-128">APIs como [**GetDCOrgEx**](/windows/desktop/api/wingdi/nf-wingdi-getdcorgex) podem ser usadas para determinar determinados valores reais.</span><span class="sxs-lookup"><span data-stu-id="c9b48-128">APIs such as [**GetDCOrgEx**](/windows/desktop/api/wingdi/nf-wingdi-getdcorgex) can be used to determine certain actual values.</span></span> <span data-ttu-id="c9b48-129">Se você tiver um DC (contexto de dispositivo) para uma janela redirecionada, a origem retornada por **GetDCOrgEx** não corresponderá à origem da janela na tela.</span><span class="sxs-lookup"><span data-stu-id="c9b48-129">If you have a device context (DC) for a redirected window, the origin returned by **GetDCOrgEx** will not match the origin of your window on the screen.</span></span> <span data-ttu-id="c9b48-130">Em vez disso, a origem será a origem da superfície do buffer de fundo para sua janela: (0,0).</span><span class="sxs-lookup"><span data-stu-id="c9b48-130">The origin will instead be the origin of the back-buffer surface for your window: (0, 0).</span></span>

<span data-ttu-id="c9b48-131">Quando todo o resto falhar, desabilite a renderização da janela chamando a função [**DwmSetWindowAttribute**](/windows/desktop/api/Dwmapi/nf-dwmapi-dwmsetwindowattribute) .</span><span class="sxs-lookup"><span data-stu-id="c9b48-131">When all else fails, disable window rendering by calling the [**DwmSetWindowAttribute**](/windows/desktop/api/Dwmapi/nf-dwmapi-dwmsetwindowattribute) function.</span></span>

## <a name="drawing-practices-for-dwm"></a><span data-ttu-id="c9b48-132">Práticas de desenho para DWM</span><span class="sxs-lookup"><span data-stu-id="c9b48-132">Drawing Practices for DWM</span></span>

<span data-ttu-id="c9b48-133">Evite desenhar diretamente na superfície de exibição primária.</span><span class="sxs-lookup"><span data-stu-id="c9b48-133">Avoid drawing directly to the primary display surface.</span></span> <span data-ttu-id="c9b48-134">Isso forçará o DWM a desabilitar a composição até que seu aplicativo libere a superfície do dispositivo primário.</span><span class="sxs-lookup"><span data-stu-id="c9b48-134">Doing so will force the DWM to disable composition until your application releases the primary device surface.</span></span>

<span data-ttu-id="c9b48-135">Avalie se seu aplicativo deve fornecer seu próprio buffer duplo.</span><span class="sxs-lookup"><span data-stu-id="c9b48-135">Evaluate whether your application must provide its own double buffering.</span></span> <span data-ttu-id="c9b48-136">O DWM efetivamente armazena em buffer duplo o conteúdo e apresenta a janela em um único quadro.</span><span class="sxs-lookup"><span data-stu-id="c9b48-136">The DWM effectively double buffers content and presents the window in a single frame.</span></span>

<span data-ttu-id="c9b48-137">Evite ler ou gravar em um controlador de domínio de vídeo.</span><span class="sxs-lookup"><span data-stu-id="c9b48-137">Avoid reading from or writing to a display DC.</span></span> <span data-ttu-id="c9b48-138">Embora tenha suporte do DWM, não recomendamos isso devido a um desempenho reduzido.</span><span class="sxs-lookup"><span data-stu-id="c9b48-138">Although supported by DWM, we do not recommend it because of decreased performance.</span></span>

<span data-ttu-id="c9b48-139">Evite desenhar na área não cliente.</span><span class="sxs-lookup"><span data-stu-id="c9b48-139">Avoid drawing in the non-client area.</span></span> <span data-ttu-id="c9b48-140">Embora essa área possa ser acessada pelo aplicativo e o desenho tenha suporte da API do Microsoft Win32, fazer isso pode fazer com que a janela perca qualquer borda de vidro.</span><span class="sxs-lookup"><span data-stu-id="c9b48-140">Although this area can be accessed by the application, and drawing there is supported by the Microsoft Win32 API, doing this can cause the window to lose any glass border it has.</span></span>

<span data-ttu-id="c9b48-141">Evite misturar o Windows Graphics Device Interface (GDI) e o Microsoft DirectX, a menos que eles não se sobreponham.</span><span class="sxs-lookup"><span data-stu-id="c9b48-141">Avoid mixing Windows Graphics Device Interface (GDI) and Microsoft DirectX unless they do not overlap.</span></span> <span data-ttu-id="c9b48-142">Se a combinação for necessária, desenhe o conteúdo GDI em uma superfície de software do DirectX e combine-o antes de redigir na tela, ou então desenhe-os em janelas separadas.</span><span class="sxs-lookup"><span data-stu-id="c9b48-142">If mixing is necessary, either draw the GDI content into a DirectX software surface and combine them before composing to the screen, or else draw them in separate windows.</span></span>

<span data-ttu-id="c9b48-143">Use a função [**BitBlt**](/windows/desktop/api/wingdi/nf-wingdi-bitblt) ou [**StretchBlt**](/windows/desktop/api/wingdi/nf-wingdi-stretchblt) em vez do Windows GDI+ para apresentar o desenho para renderização.</span><span class="sxs-lookup"><span data-stu-id="c9b48-143">Use [**BitBlt**](/windows/desktop/api/wingdi/nf-wingdi-bitblt) or [**StretchBlt**](/windows/desktop/api/wingdi/nf-wingdi-stretchblt) function instead of Windows GDI+ to present your drawing for rendering.</span></span> <span data-ttu-id="c9b48-144">O GDI+ renderiza uma linha de varredura por vez com a renderização de software.</span><span class="sxs-lookup"><span data-stu-id="c9b48-144">GDI+ renders one scan line at a time with software rendering.</span></span> <span data-ttu-id="c9b48-145">Isso pode causar oscilação em seus aplicativos.</span><span class="sxs-lookup"><span data-stu-id="c9b48-145">This can cause flickering in your applications.</span></span>

## <a name="dwm-blur-behind-client-region"></a><span data-ttu-id="c9b48-146">Blur-Behind de região do cliente do DWM</span><span class="sxs-lookup"><span data-stu-id="c9b48-146">DWM Blur-Behind Client Region</span></span>

<span data-ttu-id="c9b48-147">A renderização do efeito de desfoque é uma operação com uso intensivo de recursos para a CPU e a GPU (unidade de processamento gráfico).</span><span class="sxs-lookup"><span data-stu-id="c9b48-147">Rendering the blur-behind effect is a resource-intensive operation for both the CPU and the graphics processing unit (GPU).</span></span> <span data-ttu-id="c9b48-148">Os desenvolvedores de aplicativos são incentivados a considerar as implicações de usar o desfoque da área do cliente para que ele não consuma recursos excessivos.</span><span class="sxs-lookup"><span data-stu-id="c9b48-148">Application developers are urged to consider the implications of using client-area blur so that it does not consume excessive resources.</span></span> <span data-ttu-id="c9b48-149">Você deve usar cuidado especial nos seguintes casos:</span><span class="sxs-lookup"><span data-stu-id="c9b48-149">You should use particular caution in the following cases:</span></span>

-   <span data-ttu-id="c9b48-150">Quando você espera que o tamanho do desfoque da área do cliente seja significativo, mesmo que nenhuma atualização ocorra na área desfocada.</span><span class="sxs-lookup"><span data-stu-id="c9b48-150">When you expect the size of the client-area blur to be significant, even if no updates will occur in the blurred area itself.</span></span> <span data-ttu-id="c9b48-151">O desfoque deve ser renderizado caso todas as atualizações ocorram na área desfocada da janela, o que incorre em custos de CPU e de GPU.</span><span class="sxs-lookup"><span data-stu-id="c9b48-151">The blur has to be rendered in case any updates occur under the blurred area of the window, which incurs CPU and GPU costs.</span></span> <span data-ttu-id="c9b48-152">Além disso, as operações de janela na janela (mover/redimensionar/transições) incorrerão em mais custos.</span><span class="sxs-lookup"><span data-stu-id="c9b48-152">In addition, window operations on the window (move/resize/transitions) will incur more costs.</span></span>
-   <span data-ttu-id="c9b48-153">Quando você espera atualizações significativas na área do cliente desfocada.</span><span class="sxs-lookup"><span data-stu-id="c9b48-153">When you expect significant updates in the blurred client area.</span></span> <span data-ttu-id="c9b48-154">Isso exigirá um redesenho do desfoque em cada atualização e consumirá recursos excessivos.</span><span class="sxs-lookup"><span data-stu-id="c9b48-154">This will require a repaint of the blur on every update and consume excessive resources.</span></span>
-   <span data-ttu-id="c9b48-155">Se for esperado que o desfoque cubra uma área significativa e as atualizações nessa área também sejam esperadas, é altamente recomendável que você não desfoque a área do cliente.</span><span class="sxs-lookup"><span data-stu-id="c9b48-155">If the blur is expected to cover a significant area, and updates to that area are also expected, we strongly recommended that you do not blur the client area.</span></span>

 

 