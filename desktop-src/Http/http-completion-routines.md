---
title: Rotinas de conclusão de HTTP
description: Os aplicativos têm várias opções para receber indicações de conclusão e fornecer alguma flexibilidade para os desenvolvedores.
ms.assetid: c48a64d2-b6c8-4694-8600-f84751954bad
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8aee05efc8284cb29130efae4bcaefb4834a3fb4
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/19/2020
ms.locfileid: "103917288"
---
# <a name="http-completion-routines"></a><span data-ttu-id="f6a2a-103">Rotinas de conclusão de HTTP</span><span class="sxs-lookup"><span data-stu-id="f6a2a-103">HTTP Completion Routines</span></span>

<span data-ttu-id="f6a2a-104">Os aplicativos têm várias opções para receber indicações de conclusão e fornecer alguma flexibilidade para os desenvolvedores.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-104">Applications have several options for receiving completion indications and providing some flexibility for developers.</span></span> <span data-ttu-id="f6a2a-105">As opções são bloqueadas enquanto aguardam a conclusão de uma chamada à API ou para usar rotinas de conclusão para operações assíncronas.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-105">The options are to block while waiting for an API call to complete or to use completion routines for asynchronous operations.</span></span> <span data-ttu-id="f6a2a-106">A vantagem de usar operações assíncronas é um aumento na capacidade de resposta do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-106">The advantage of using asynchronous operations is an increase in responsiveness of the application.</span></span>

## <a name="blocked-io"></a><span data-ttu-id="f6a2a-107">E/s bloqueada</span><span class="sxs-lookup"><span data-stu-id="f6a2a-107">Blocked I/O</span></span>

<span data-ttu-id="f6a2a-108">Os aplicativos podem ser bloqueados enquanto aguardam a conclusão da chamada de API definindo a estrutura [**sobreposta**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) como **NULL**.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-108">Applications can block while waiting for the API call to complete by setting the [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure to **NULL**.</span></span> <span data-ttu-id="f6a2a-109">Isso realmente bloqueia todas as operações no thread.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-109">This truly blocks all operations on the thread.</span></span> <span data-ttu-id="f6a2a-110">Por exemplo, em chamadas para [**HttpWaitForDisconnect**](/windows/desktop/api/Http/nf-http-httpwaitfordisconnect), a chamada é bloqueada até que a conexão seja interrompida.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-110">For example, in calls to [**HttpWaitForDisconnect**](/windows/desktop/api/Http/nf-http-httpwaitfordisconnect), the call blocks until the connection is broken.</span></span>

## <a name="asynchronous-io"></a><span data-ttu-id="f6a2a-111">E/s assíncrona</span><span class="sxs-lookup"><span data-stu-id="f6a2a-111">Asynchronous I/O</span></span>

<span data-ttu-id="f6a2a-112">Aplicativos que preferem não bloquear podem usar a estrutura [**sobreposta**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) para obter os resultados de conclusão.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-112">Applications that prefer not to block can use the [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure to obtain the completion results.</span></span> <span data-ttu-id="f6a2a-113">O aplicativo fornece um ponteiro para uma estrutura **sobreposta** , que é usada com um objeto de evento ou uma porta de conclusão.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-113">The application supplies a pointer to an **OVERLAPPED** structure, which is used with an event object or a completion port.</span></span> <span data-ttu-id="f6a2a-114">Com uma porta de conclusão de e/s, um identificador HTTP é usado como um identificador de arquivo em uma operação de e/s de arquivo assíncrono.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-114">With an I/O completion port, an HTTP handle is used as a file handle would be in an asynchronous file I/O operation.</span></span> <span data-ttu-id="f6a2a-115">A tabela a seguir resume as opções de conclusão disponíveis para os aplicativos.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-115">The following table summarizes the completion options available to the applications.</span></span>



| <span data-ttu-id="f6a2a-116">Estrutura sobreposta</span><span class="sxs-lookup"><span data-stu-id="f6a2a-116">Overlapped structure</span></span> | <span data-ttu-id="f6a2a-117">Objeto de evento</span><span class="sxs-lookup"><span data-stu-id="f6a2a-117">Event object</span></span>   | <span data-ttu-id="f6a2a-118">Porta de conclusão</span><span class="sxs-lookup"><span data-stu-id="f6a2a-118">Completion port</span></span> | <span data-ttu-id="f6a2a-119">Completion</span><span class="sxs-lookup"><span data-stu-id="f6a2a-119">Completion</span></span>                                                                                                   |
|----------------------|----------------|-----------------|--------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="f6a2a-120">**NULL**</span><span class="sxs-lookup"><span data-stu-id="f6a2a-120">**NULL**</span></span>             | <span data-ttu-id="f6a2a-121">Não Aplicável</span><span class="sxs-lookup"><span data-stu-id="f6a2a-121">Not Applicable</span></span> | <span data-ttu-id="f6a2a-122">Ignored</span><span class="sxs-lookup"><span data-stu-id="f6a2a-122">Ignored</span></span>         | <span data-ttu-id="f6a2a-123">A operação é concluída de forma síncrona.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-123">Operation completes synchronously.</span></span>                                                                           |
| <span data-ttu-id="f6a2a-124">Não **nulo**</span><span class="sxs-lookup"><span data-stu-id="f6a2a-124">Non-**NULL**</span></span>         | <span data-ttu-id="f6a2a-125">Não **nulo**</span><span class="sxs-lookup"><span data-stu-id="f6a2a-125">Non-**NULL**</span></span>   | <span data-ttu-id="f6a2a-126">**NULL**</span><span class="sxs-lookup"><span data-stu-id="f6a2a-126">**NULL**</span></span>        | <span data-ttu-id="f6a2a-127">A operação é concluída de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-127">Operation completes asynchronously.</span></span> <span data-ttu-id="f6a2a-128">A notificação sobreposta é executada por meio da sinalização de um objeto de evento.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-128">Overlapped notification is performed by signaling an event object.</span></span>       |
| <span data-ttu-id="f6a2a-129">Não **nulo**</span><span class="sxs-lookup"><span data-stu-id="f6a2a-129">Non-**NULL**</span></span>         | <span data-ttu-id="f6a2a-130">Ignored</span><span class="sxs-lookup"><span data-stu-id="f6a2a-130">Ignored</span></span>        | <span data-ttu-id="f6a2a-131">Não **nulo**</span><span class="sxs-lookup"><span data-stu-id="f6a2a-131">Non-**NULL**</span></span>    | <span data-ttu-id="f6a2a-132">A operação é concluída de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-132">Operation completes asynchronously.</span></span> <span data-ttu-id="f6a2a-133">A notificação sobreposta é executada por meio do agendamento de uma rotina de conclusão.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-133">Overlapped notification is performed by scheduling a completion routine.</span></span> |



 

## <a name="returning-the-number-of-bytes-read"></a><span data-ttu-id="f6a2a-134">Retornando o número de bytes lidos</span><span class="sxs-lookup"><span data-stu-id="f6a2a-134">Returning the Number of Bytes Read</span></span>

<span data-ttu-id="f6a2a-135">Algumas das funções que usam a estrutura [**sobreposta**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) para conclusão assíncrona retornam um parâmetro *PBytesReceived* (ou *pBytesSent* ou *pBytesRead*) que indica o número de bytes transferidos de forma síncrona.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-135">Some of the functions that use the [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure for asynchronous completion return a *pBytesReceived* (or *pBytesSent* or *pBytesRead*) parameter that indicates the number of bytes transferred synchronously.</span></span> <span data-ttu-id="f6a2a-136">Para chamadas assíncronas, esse parâmetro deve ser definido como **nulo**.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-136">For asynchronous calls, this parameter should be set to **NULL**.</span></span> <span data-ttu-id="f6a2a-137">Para chamadas síncronas, o parâmetro *pBytesReceived* é opcional e pode ser **nulo** ou não **nulo**.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-137">For synchronous calls, the *pBytesReceived* parameter is optional and can be either **NULL** or non-**NULL**.</span></span>

<span data-ttu-id="f6a2a-138">Se o objeto de evento for usado para conclusão assíncrona, a função [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) será chamada para determinar o número de bytes lidos.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-138">If the event object is used for asynchronous completion, the [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) function is called to determine the number of bytes read.</span></span> <span data-ttu-id="f6a2a-139">Se a porta de conclusão for usada (o parâmetro *hFile* está associado a uma porta de conclusão de e/s), o aplicativo chamará a função [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) para determinar o número de bytes lidos.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-139">If the completion port is used (the *hFile* parameter is associated with an I/O completion port), the application calls the [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) function to determine the number of bytes read.</span></span> <span data-ttu-id="f6a2a-140">Se as operações assíncronas não tiverem sido concluídas, os aplicativos poderão chamar a função [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) para obter informações de erro estendidas.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-140">If the asynchronous operations have not completed, applications can call the [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) function to obtain extended error information.</span></span>

<span data-ttu-id="f6a2a-141">A tabela a seguir resume o comportamento de conclusão para a conclusão síncrona e assíncrona em funções como [**HttpReceiveHttpRequest**](/windows/desktop/api/Http/nf-http-httpreceivehttprequest) que usam o parâmetro *pBytesReceived* .</span><span class="sxs-lookup"><span data-stu-id="f6a2a-141">The following table summarizes the completion behavior for synchronous and asynchronous completion in functions such as [**HttpReceiveHttpRequest**](/windows/desktop/api/Http/nf-http-httpreceivehttprequest) that use the *pBytesReceived* parameter.</span></span>



| <span data-ttu-id="f6a2a-142">pBytesReceived\*</span><span class="sxs-lookup"><span data-stu-id="f6a2a-142">pBytesReceived\*</span></span> | <span data-ttu-id="f6a2a-143">pOverlapped</span><span class="sxs-lookup"><span data-stu-id="f6a2a-143">pOverlapped</span></span>  | <span data-ttu-id="f6a2a-144">Description</span><span class="sxs-lookup"><span data-stu-id="f6a2a-144">Description</span></span>                                                                             |
|------------------|--------------|-----------------------------------------------------------------------------------------|
| <span data-ttu-id="f6a2a-145">**NULL**</span><span class="sxs-lookup"><span data-stu-id="f6a2a-145">**NULL**</span></span>         | <span data-ttu-id="f6a2a-146">**NULL**</span><span class="sxs-lookup"><span data-stu-id="f6a2a-146">**NULL**</span></span>     | <span data-ttu-id="f6a2a-147">O aplicativo não recebe informações sobre o número de bytes retornados.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-147">The application does not receive information on the number of bytes returned.</span></span>           |
| <span data-ttu-id="f6a2a-148">**NULL**</span><span class="sxs-lookup"><span data-stu-id="f6a2a-148">**NULL**</span></span>         | <span data-ttu-id="f6a2a-149">Não **nulo**</span><span class="sxs-lookup"><span data-stu-id="f6a2a-149">Non-**NULL**</span></span> | <span data-ttu-id="f6a2a-150">Operação assíncrona, o *pBytesReceived* não faz sentido.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-150">Asynchronous operation, *pBytesReceived* is meaningless.</span></span>                                |
| <span data-ttu-id="f6a2a-151">Não **nulo**</span><span class="sxs-lookup"><span data-stu-id="f6a2a-151">Non-**NULL**</span></span>     | <span data-ttu-id="f6a2a-152">**NULL**</span><span class="sxs-lookup"><span data-stu-id="f6a2a-152">**NULL**</span></span>     | <span data-ttu-id="f6a2a-153">Operação síncrona, número de bytes retornados em *pBytesReceived*.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-153">Synchronous operation, number of bytes returned in *pBytesReceived*.</span></span>                    |
| <span data-ttu-id="f6a2a-154">Não **nulo**</span><span class="sxs-lookup"><span data-stu-id="f6a2a-154">Non-**NULL**</span></span>     | <span data-ttu-id="f6a2a-155">Não **nulo**</span><span class="sxs-lookup"><span data-stu-id="f6a2a-155">Non-**NULL**</span></span> | <span data-ttu-id="f6a2a-156">Operação assíncrona, *pBytesReceived* é ignorada, embora não seja **nula**.\*\*</span><span class="sxs-lookup"><span data-stu-id="f6a2a-156">Asynchronous operation, *pBytesReceived* is ignored even though it is not **NULL**.\*\*</span></span> |



 

> [!Note]  
> <span data-ttu-id="f6a2a-157">\*Esse parâmetro também pode ser *pBytesSent* ou *pBytesRead*.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-157">\*This parameter can also be *pBytesSent* or *pBytesRead*.</span></span>

 

> [!Note]  
> <span data-ttu-id="f6a2a-158">\*\*É recomendável que os aplicativos passem um **valor nulo** no *pBytesReceived* para operações assíncronas e obtenham o número de bytes recebidos de [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) ou [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus).</span><span class="sxs-lookup"><span data-stu-id="f6a2a-158">\*\*It is recommended that applications pass a **NULL** in *pBytesReceived* for asynchronous operations and obtain the number of bytes received from either [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) or [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus).</span></span>

 

## <a name="return-codes"></a><span data-ttu-id="f6a2a-159">Códigos de retorno</span><span class="sxs-lookup"><span data-stu-id="f6a2a-159">Return Codes</span></span>

<span data-ttu-id="f6a2a-160">A API do servidor HTTP retorna três classes de códigos para chamadas de função assíncronas.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-160">The HTTP Server API returns three classes of codes for asynchronous function calls.</span></span>

-   <span data-ttu-id="f6a2a-161">SEM \_ erros</span><span class="sxs-lookup"><span data-stu-id="f6a2a-161">NO\_ERROR</span></span>
-   <span data-ttu-id="f6a2a-162">\_e/s de erro \_ pendente</span><span class="sxs-lookup"><span data-stu-id="f6a2a-162">ERROR\_IO\_PENDING</span></span>
-   <span data-ttu-id="f6a2a-163">Qualquer outro [código de erro do sistema](/windows/desktop/Debug/system-error-codes).</span><span class="sxs-lookup"><span data-stu-id="f6a2a-163">Any other [system error code](/windows/desktop/Debug/system-error-codes).</span></span>

<span data-ttu-id="f6a2a-164">Quando o erro \_ de e/s \_ está pendente ou nenhum \_ erro é retornado da chamada de função assíncrona, os usuários devem esperar que a rotina de evento ou de conclusão seja sinalizada.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-164">When ERROR\_IO\_PENDING or NO\_ERROR are returned from the asynchronous function call, users should expect the event or completion routine to be signaled.</span></span> <span data-ttu-id="f6a2a-165">Chamar a função [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) para o evento ou a função [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) para a porta de conclusão retorna o status de conclusão.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-165">Calling the [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) function for the event or the [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) function for the completion port returns the completion status.</span></span> <span data-ttu-id="f6a2a-166">Além disso, se nenhum \_ erro for retornado, os aplicativos poderão executar o pós-processamento no mesmo thread que fez a chamada à API.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-166">In addition, if NO\_ERROR is returned, applications can perform post-processing on the same thread that made the API call.</span></span>

<span data-ttu-id="f6a2a-167">Se a API do servidor HTTP retornar algo diferente de erro \_ e/s \_ pendente ou nenhum \_ erro, da chamada de função assíncrona, a rotina de conclusão não será sinalizada e o erro será RETORNADO diretamente pela API.</span><span class="sxs-lookup"><span data-stu-id="f6a2a-167">If the HTTP Server API returns anything other than ERROR\_IO\_PENDING or NO\_ERROR, from the asynchronous function call, the completion routine is not signaled, and the error is directly returned by the API.</span></span>

 

 