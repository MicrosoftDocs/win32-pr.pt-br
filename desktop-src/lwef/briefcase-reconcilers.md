---
title: Criando reconciliadores de porta-arquivos
description: Um porta-arquivos reconciliador fornece ao porta-os o meio para reconciliar versões diferentes de um documento.
ms.assetid: 86d66291-96ae-40ea-98ef-ef263f25aa82
keywords:
- reconciliadores de porta-arquivos
- reconciliação
- IReconcilableObject
- IReconcileInitiator
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b925e7055e15f6c7a49408aa28d147fb2eef5a7e
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/19/2020
ms.locfileid: "104365857"
---
# <a name="creating-briefcase-reconcilers"></a><span data-ttu-id="99185-107">Criando reconciliadores de porta-arquivos</span><span class="sxs-lookup"><span data-stu-id="99185-107">Creating Briefcase Reconcilers</span></span>

<span data-ttu-id="99185-108">Um porta-arquivos reconciliador fornece ao porta-os o meio para reconciliar versões diferentes de um documento.</span><span class="sxs-lookup"><span data-stu-id="99185-108">A briefcase reconciler gives Briefcase the means to reconcile different versions of a document.</span></span>

-   [<span data-ttu-id="99185-109">Sobre reconciliadores de porta-arquivos</span><span class="sxs-lookup"><span data-stu-id="99185-109">About Briefcase Reconcilers</span></span>](#about-briefcase-reconcilers)
    -   [<span data-ttu-id="99185-110">Reconciliação</span><span class="sxs-lookup"><span data-stu-id="99185-110">Reconciliation</span></span>](#reconciliation)
    -   [<span data-ttu-id="99185-111">Criando um porta-arquivos reconciliador</span><span class="sxs-lookup"><span data-stu-id="99185-111">Creating a Briefcase Reconciler</span></span>](#creating-a-briefcase-reconciler)
    -   [<span data-ttu-id="99185-112">Interação do usuário em reconciliação</span><span class="sxs-lookup"><span data-stu-id="99185-112">User Interaction in Reconciliation</span></span>](#user-interaction-in-reconciliation)
    -   [<span data-ttu-id="99185-113">Reconciliando objetos inseridos</span><span class="sxs-lookup"><span data-stu-id="99185-113">Reconciling Embedded Objects</span></span>](#reconciling-embedded-objects)
    -   [<span data-ttu-id="99185-114">Residues</span><span class="sxs-lookup"><span data-stu-id="99185-114">Residues</span></span>](#residues)
-   [<span data-ttu-id="99185-115">Referência do porta-arquivos</span><span class="sxs-lookup"><span data-stu-id="99185-115">Briefcase Reconciler Reference</span></span>](#briefcase-reconciler-reference)
    -   [<span data-ttu-id="99185-116">Métodos e interfaces do portador Reconciler</span><span class="sxs-lookup"><span data-stu-id="99185-116">Briefcase Reconciler Interfaces and Methods</span></span>](#briefcase-reconciler-interfaces-and-methods)

## <a name="about-briefcase-reconcilers"></a><span data-ttu-id="99185-117">Sobre reconciliadores de porta-arquivos</span><span class="sxs-lookup"><span data-stu-id="99185-117">About Briefcase Reconcilers</span></span>

<span data-ttu-id="99185-118">Um porta-arquivos reconciliador combina diferentes versões de entrada de um documento para produzir uma nova versão de saída única do documento.</span><span class="sxs-lookup"><span data-stu-id="99185-118">A briefcase reconciler combines different input versions of a document to produce a single, new output version of the document.</span></span> <span data-ttu-id="99185-119">Talvez seja necessário criar um porta-arquivos reconciliador para dar suporte ao seu tipo de documento.</span><span class="sxs-lookup"><span data-stu-id="99185-119">You might need to create a briefcase reconciler to support your type of document.</span></span> <span data-ttu-id="99185-120">Esta visão geral descreve os reconciliadores de porta-arquivos e explica como criá-los.</span><span class="sxs-lookup"><span data-stu-id="99185-120">This overview describes briefcase reconcilers and explains how to create them.</span></span>

<span data-ttu-id="99185-121">Os seguintes tópicos são abordados:</span><span class="sxs-lookup"><span data-stu-id="99185-121">The following topics are discussed:</span></span>

-   [<span data-ttu-id="99185-122">Reconciliação</span><span class="sxs-lookup"><span data-stu-id="99185-122">Reconciliation</span></span>](#reconciliation)
-   [<span data-ttu-id="99185-123">Criando um porta-arquivos reconciliador</span><span class="sxs-lookup"><span data-stu-id="99185-123">Creating a Briefcase Reconciler</span></span>](#creating-a-briefcase-reconciler)
-   [<span data-ttu-id="99185-124">Interação do usuário em reconciliação</span><span class="sxs-lookup"><span data-stu-id="99185-124">User Interaction in Reconciliation</span></span>](#user-interaction-in-reconciliation)
-   [<span data-ttu-id="99185-125">Reconciliando objetos inseridos</span><span class="sxs-lookup"><span data-stu-id="99185-125">Reconciling Embedded Objects</span></span>](#reconciling-embedded-objects)
-   [<span data-ttu-id="99185-126">Residues</span><span class="sxs-lookup"><span data-stu-id="99185-126">Residues</span></span>](#residues)

### <a name="reconciliation"></a><span data-ttu-id="99185-127">Reconciliação</span><span class="sxs-lookup"><span data-stu-id="99185-127">Reconciliation</span></span>

<span data-ttu-id="99185-128">Um documento é uma coleção de informações que podem ser copiadas e alteradas.</span><span class="sxs-lookup"><span data-stu-id="99185-128">A document is a collection of information that can be copied and changed.</span></span> <span data-ttu-id="99185-129">Um documento tem versões diferentes se o conteúdo de pelo menos duas cópias do documento for diferente.</span><span class="sxs-lookup"><span data-stu-id="99185-129">A document has different versions if the contents of at least two copies of the document are different.</span></span> <span data-ttu-id="99185-130">A reconciliação produz uma única versão de um documento de duas ou mais versões iniciais.</span><span class="sxs-lookup"><span data-stu-id="99185-130">Reconciliation produces a single version of a document from two or more initial versions.</span></span> <span data-ttu-id="99185-131">Normalmente, a versão reconciliada é uma combinação de informações das versões iniciais com as informações mais recentes ou mais úteis preservadas.</span><span class="sxs-lookup"><span data-stu-id="99185-131">Typically, the reconciled version is a combination of information from the initial versions with the most recent or most useful information preserved.</span></span>

<span data-ttu-id="99185-132">A reconciliação é iniciada pelo porta-os quando determina que duas ou mais cópias do mesmo documento são diferentes.</span><span class="sxs-lookup"><span data-stu-id="99185-132">Reconciliation is initiated by Briefcase when it determines that two or more copies of the same document are different.</span></span> <span data-ttu-id="99185-133">O porta-arquivos, que atua como iniciador neste contexto, localiza e inicia o porta-dados Reconciler associado ao tipo de documento fornecido.</span><span class="sxs-lookup"><span data-stu-id="99185-133">Briefcase, which acts as the initiator in this context, locates and starts the briefcase reconciler associated with the given document type.</span></span> <span data-ttu-id="99185-134">O Reconciler compara os documentos e determina quais partes dos documentos manter.</span><span class="sxs-lookup"><span data-stu-id="99185-134">The reconciler compares the documents and determines which portions of the documents to retain.</span></span> <span data-ttu-id="99185-135">Alguns reconciliadores podem exigir a interação do usuário para concluir a reconciliação.</span><span class="sxs-lookup"><span data-stu-id="99185-135">Some reconcilers might require user interaction to complete reconciliation.</span></span> <span data-ttu-id="99185-136">Outros podem concluir a reconciliação sem interação com o usuário.</span><span class="sxs-lookup"><span data-stu-id="99185-136">Others might complete reconciliation without user interaction.</span></span> <span data-ttu-id="99185-137">O Reconciler pode estar contido em um aplicativo ou ser uma extensão implementada como uma DLL.</span><span class="sxs-lookup"><span data-stu-id="99185-137">The reconciler can be contained within an application or be an extension implemented as a DLL.</span></span>

<span data-ttu-id="99185-138">Alguns reconciliadores de porta-arquivos podem criar residues.</span><span class="sxs-lookup"><span data-stu-id="99185-138">Some briefcase reconcilers might create residues.</span></span> <span data-ttu-id="99185-139">Um residue é um documento, geralmente com o mesmo tipo de arquivo que o documento inicial, que contém informações não salvas na versão mesclada.</span><span class="sxs-lookup"><span data-stu-id="99185-139">A residue is a document, usually having the same file type as the initial document, that contains information not saved in the merged version.</span></span> <span data-ttu-id="99185-140">Residues são normalmente usados para dar aos autores uma maneira rápida de determinar quais informações de seu documento original não estão na versão mesclada final.</span><span class="sxs-lookup"><span data-stu-id="99185-140">Residues are typically used to give authors a quick way to determine what information from their original document is not in the final merged version.</span></span> <span data-ttu-id="99185-141">Se um Reconciler der suporte a residues, ele criará um residue para cada uma das versões originais do documento.</span><span class="sxs-lookup"><span data-stu-id="99185-141">If a reconciler supports residues, it creates one residue for each of the original versions of the document.</span></span> <span data-ttu-id="99185-142">Residues não são criados, a menos que o iniciador as solicite.</span><span class="sxs-lookup"><span data-stu-id="99185-142">Residues are not created unless the initiator requests them.</span></span>

<span data-ttu-id="99185-143">Alguns reconciliadores do porta-arquivos funcionam com o porta-arquivos para permitir que o usuário encerre a reconciliação.</span><span class="sxs-lookup"><span data-stu-id="99185-143">Some briefcase reconcilers work with Briefcase to allow the user to terminate reconciliation.</span></span> <span data-ttu-id="99185-144">Esse é um recurso importante para um usuário que pode decidir que a reconciliação não deve continuar.</span><span class="sxs-lookup"><span data-stu-id="99185-144">This is an important feature for a user who might decide that the reconciliation should not proceed.</span></span> <span data-ttu-id="99185-145">Um reconciliador normalmente fornece um objeto de encerramento quando a reconciliação requer interação do usuário e pode ser demorada.</span><span class="sxs-lookup"><span data-stu-id="99185-145">A reconciler typically provides a termination object when the reconciliation requires user interaction and might be lengthy.</span></span> <span data-ttu-id="99185-146">Em alguns ambientes, um Reconciler pode permitir a reconciliação parcial, permitindo que um usuário suspenda temporariamente uma reconciliação e retome-a mais tarde.</span><span class="sxs-lookup"><span data-stu-id="99185-146">In some environments, a reconciler might allow partial reconciliation, enabling a user to temporarily suspend a reconciliation and resume it later.</span></span> <span data-ttu-id="99185-147">No entanto, o porta-arquivos não dá suporte à reconciliação parcial.</span><span class="sxs-lookup"><span data-stu-id="99185-147">Briefcase does not currently support partial reconciliation, however.</span></span>

### <a name="creating-a-briefcase-reconciler"></a><span data-ttu-id="99185-148">Criando um porta-arquivos reconciliador</span><span class="sxs-lookup"><span data-stu-id="99185-148">Creating a Briefcase Reconciler</span></span>

<span data-ttu-id="99185-149">Você cria um porta-arquivos reconciliador implementando as interfaces de reconciliação.</span><span class="sxs-lookup"><span data-stu-id="99185-149">You create a briefcase reconciler by implementing the reconciliation interfaces.</span></span> <span data-ttu-id="99185-150">No mínimo, um Reconciler implementa a interface [**IReconcilableObject**](/windows/win32/api/reconcil/nn-reconcil-ireconcilableobject) e a interface [IPersistStorage](/windows/win32/api/objidl/nn-objidl-ipersiststorage) ou [IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile) .</span><span class="sxs-lookup"><span data-stu-id="99185-150">At a minimum, a reconciler implements the [**IReconcilableObject**](/windows/win32/api/reconcil/nn-reconcil-ireconcilableobject) interface and the [IPersistStorage](/windows/win32/api/objidl/nn-objidl-ipersiststorage) or [IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile) interface.</span></span> <span data-ttu-id="99185-151">Como iniciador, o porta-arquivos determina quando a reconciliação é necessária e chama o método [**IReconcilableObject:: reconcilize**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) para iniciar a reconciliação.</span><span class="sxs-lookup"><span data-stu-id="99185-151">As the initiator, Briefcase determines when reconciliation is needed and calls the [**IReconcilableObject::Reconcile**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) method to initiate reconciliation.</span></span>

<span data-ttu-id="99185-152">Embora [**IReconcilableObject:: reconcilse**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) forneça um conjunto amplo de recursos de reconciliação, um porta-arquivos reconciliador executa apenas a reconciliação mínima na maioria dos casos.</span><span class="sxs-lookup"><span data-stu-id="99185-152">Although [**IReconcilableObject::Reconcile**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) provides a wide-ranging set of reconciliation capabilities, a briefcase reconciler carries out only minimal reconciliation in most cases.</span></span> <span data-ttu-id="99185-153">Em particular, o porta-os não requer o reconciliador para dar suporte à geração de residue ou para dar suporte ao objeto de encerramento.</span><span class="sxs-lookup"><span data-stu-id="99185-153">In particular, Briefcase does not require the reconciler to support residue generation or to support the termination object.</span></span> <span data-ttu-id="99185-154">Além disso, o Reconciler realiza uma única reconciliação de cima para baixo e não deve retornar o \_ valor REC E \_ não concluído; ou seja, ele não deve tentar a reconciliação parcial.</span><span class="sxs-lookup"><span data-stu-id="99185-154">Also, the reconciler carries out a single top-to-bottom reconciliation and must not return the REC\_E\_NOTCOMPLETE value; that is, it should not attempt partial reconciliation.</span></span>

<span data-ttu-id="99185-155">O porta-arquivos fornece a interface [**IReconcileInitiator**](ireconcileinitiator.md) .</span><span class="sxs-lookup"><span data-stu-id="99185-155">Briefcase provides the [**IReconcileInitiator**](ireconcileinitiator.md) interface.</span></span> <span data-ttu-id="99185-156">O porta-arquivos Reconciler pode usar o método [**IReconcileInitiator:: SetAbortCallback**](/windows/win32/api/reconcil/nf-reconcil-ireconcileinitiator-setabortcallback) para definir o objeto de terminação.</span><span class="sxs-lookup"><span data-stu-id="99185-156">The briefcase reconciler can use the [**IReconcileInitiator::SetAbortCallback**](/windows/win32/api/reconcil/nf-reconcil-ireconcileinitiator-setabortcallback) method to set the termination object.</span></span> <span data-ttu-id="99185-157">O porta-arquivos não usa identificadores de versão e não pode, portanto, fornecer versões anteriores de um documento se um reconciliador solicitá-los usando os métodos correspondentes no **IReconcileInitiator**.</span><span class="sxs-lookup"><span data-stu-id="99185-157">Briefcase does not use version identifiers and cannot, therefore, provide previous versions of a document if a reconciler requests them using the corresponding methods in **IReconcileInitiator**.</span></span>

<span data-ttu-id="99185-158">O porta-arquivos passa para [**IReconcilableObject:: reconcilie**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) File monikers representando as versões do documento a ser reconciliado.</span><span class="sxs-lookup"><span data-stu-id="99185-158">Briefcase passes to [**IReconcilableObject::Reconcile**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) file monikers representing the versions of the document to be reconciled.</span></span> <span data-ttu-id="99185-159">O porta-arquivos reconcility obtém acesso às versões usando o método [IMoniker:: BindToObject](/windows/win32/api/objidl/nf-objidl-imoniker-bindtoobject) ou [IMoniker:: BindToStorage](/windows/win32/api/objidl/nf-objidl-imoniker-bindtostorage) .</span><span class="sxs-lookup"><span data-stu-id="99185-159">The briefcase reconciler gains access to the versions by using either the [IMoniker::BindToObject](/windows/win32/api/objidl/nf-objidl-imoniker-bindtoobject) or [IMoniker::BindToStorage](/windows/win32/api/objidl/nf-objidl-imoniker-bindtostorage) method.</span></span> <span data-ttu-id="99185-160">A última opção é geralmente mais rápida e recomendada.</span><span class="sxs-lookup"><span data-stu-id="99185-160">The latter is generally faster and is recommended.</span></span> <span data-ttu-id="99185-161">O Reconciler deve liberar qualquer objeto ou armazenamento ao qual ele seja associado.</span><span class="sxs-lookup"><span data-stu-id="99185-161">The reconciler must release any objects or storage to which it binds.</span></span>

<span data-ttu-id="99185-162">Quando o porta-arquivos Reconciler usa [IMoniker:: BindToStorage](/windows/win32/api/objidl/nf-objidl-imoniker-bindtostorage), ele é associado ao armazenamento que é um armazenamento simples (um fluxo) ou um armazenamento estruturado definido por OLE.</span><span class="sxs-lookup"><span data-stu-id="99185-162">When the briefcase reconciler uses [IMoniker::BindToStorage](/windows/win32/api/objidl/nf-objidl-imoniker-bindtostorage), it binds to storage that is either flat storage (a stream) or OLE-defined structured storage.</span></span> <span data-ttu-id="99185-163">Se o Reconciler espera um armazenamento simples, ele deve usar IMoniker:: BindToStorage para solicitar a interface [IStream](/windows/win32/api/objidl/nn-objidl-istream) .</span><span class="sxs-lookup"><span data-stu-id="99185-163">If the reconciler expects flat storage, it should use IMoniker::BindToStorage to request the [IStream](/windows/win32/api/objidl/nn-objidl-istream) interface.</span></span> <span data-ttu-id="99185-164">Se o Reconciler espera armazenamento estruturado, ele deve solicitar a interface [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) .</span><span class="sxs-lookup"><span data-stu-id="99185-164">If the reconciler expects structured storage, it should request the [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) interface.</span></span> <span data-ttu-id="99185-165">Em ambos os casos, ele deve solicitar acesso direto somente leitura (não Transacted) ao armazenamento; o acesso de leitura/gravação pode não estar disponível.</span><span class="sxs-lookup"><span data-stu-id="99185-165">In both cases, it should request read-only direct (nontransacted) access to the storage; read/write access might not be available.</span></span>

<span data-ttu-id="99185-166">Um redirecionador mínimo de porta-arquivos normalmente se parece diretamente com o armazenamento das outras versões e lida com objetos incorporados de uma maneira muito primitiva, como mesclar duas versões do objeto, incluindo ambas as versões na versão de saída.</span><span class="sxs-lookup"><span data-stu-id="99185-166">A minimal briefcase reconciler typically looks directly at the storage of the other versions and deals with embedded objects in a very primitive manner, such as merging two versions of the object by including both versions in the output version.</span></span>

<span data-ttu-id="99185-167">O iniciador localiza o porta-chave apropriado usando um subconjunto da lógica implementada pela função [GetClassFile](/windows/win32/api/objbase/nf-objbase-getclassfile) para determinar o tipo de um determinado arquivo e, em seguida, procura no registro da classe Reconciler associada ao tipo de arquivo fornecido.</span><span class="sxs-lookup"><span data-stu-id="99185-167">The initiator locates the appropriate briefcase reconciler by using a subset of the logic implemented by the [GetClassFile](/windows/win32/api/objbase/nf-objbase-getclassfile) function to determine the type of a given file and then looks in the registry for the reconciler class associated with the given file type.</span></span> <span data-ttu-id="99185-168">O porta-arquivos, como outros componentes do Shell, determina o tipo de um arquivo exclusivamente pela extensão de nome de arquivo.</span><span class="sxs-lookup"><span data-stu-id="99185-168">Briefcase, like other Shell components, determines the type of a file solely by the file name extension.</span></span> <span data-ttu-id="99185-169">A extensão de um arquivo deve ter um tipo de arquivo registrado para o porta-os para invocar um reconciliador para o arquivo.</span><span class="sxs-lookup"><span data-stu-id="99185-169">A file's extension must have a registered file type for Briefcase to invoke a reconciler for the file.</span></span> <span data-ttu-id="99185-170">Você deve definir uma entrada de registro do seguinte formulário ao instalar o Reconciler.</span><span class="sxs-lookup"><span data-stu-id="99185-170">You must set a registry entry of the following form when installing your reconciler.</span></span>

```
CLSID
   {the file CLSID}
      Roles
         Reconciler
            (Default) = {the reconciler-classid}
```

<span data-ttu-id="99185-171">A classe deve ser de carregamento rápido, deve ser designada \_ MULTIPLEUSE e, a menos que os marshalers sejam fornecidos para a interface de reconciliação, deve ser um servidor em processo (contido em uma dll) em vez de um servidor local (implementado em um arquivo. exe).</span><span class="sxs-lookup"><span data-stu-id="99185-171">The class must be quick loading, must be designated \_MULTIPLEUSE, and, unless marshalers are provided for the reconciliation interface, must be an in-process server (contained in a DLL) rather than a local server (implemented in an .exe file).</span></span>

### <a name="user-interaction-in-reconciliation"></a><span data-ttu-id="99185-172">Interação do usuário em reconciliação</span><span class="sxs-lookup"><span data-stu-id="99185-172">User Interaction in Reconciliation</span></span>

<span data-ttu-id="99185-173">Um porta-arquivos reconciliador deve tentar realizar a reconciliação sem interação com o usuário.</span><span class="sxs-lookup"><span data-stu-id="99185-173">A briefcase reconciler should attempt to carry out reconciliation without user interaction.</span></span> <span data-ttu-id="99185-174">Quanto mais automatizada a reconciliação, melhor será a percepção do usuário do processo.</span><span class="sxs-lookup"><span data-stu-id="99185-174">The more automated the reconciliation, the better the user's perception of the process.</span></span>

<span data-ttu-id="99185-175">Em alguns casos, a intervenção do usuário pode ser valiosa.</span><span class="sxs-lookup"><span data-stu-id="99185-175">In some cases, user intervention can be valuable.</span></span> <span data-ttu-id="99185-176">Por exemplo, um sistema de documentos pode exigir que um usuário revise as alterações antes de aceitar a versão mesclada de um documento ou pode exigir comentários do usuário explicando as alterações que foram feitas.</span><span class="sxs-lookup"><span data-stu-id="99185-176">For example, a document system might require a user to review changes before accepting the merged version of a document or might require comments from the user explaining the changes that have been made.</span></span> <span data-ttu-id="99185-177">Nesses casos, o iniciador, não o portador de arquivos reconciliador, é responsável por consultar o usuário e executar as instruções do usuário.</span><span class="sxs-lookup"><span data-stu-id="99185-177">In these cases, the initiator, not the briefcase reconciler, is responsible for querying the user and carrying out the user's instructions.</span></span>

<span data-ttu-id="99185-178">Em outros casos, a intervenção do usuário pode ser necessária — por exemplo, quando duas versões foram editadas de maneiras incompatíveis.</span><span class="sxs-lookup"><span data-stu-id="99185-178">In other cases, user intervention might be necessary—for example, when two versions have been edited in incompatible ways.</span></span> <span data-ttu-id="99185-179">Nesses casos, o iniciador ou o porta-usuário Reconciler deve consultar o usuário para obter instruções sobre como resolver o conflito.</span><span class="sxs-lookup"><span data-stu-id="99185-179">In such cases, either the initiator or briefcase reconciler must query the user for instructions on how to resolve the conflict.</span></span> <span data-ttu-id="99185-180">Em geral, nenhum iniciador pode contar com a conclusão de uma reconciliação sem esperar alguma interação do usuário.</span><span class="sxs-lookup"><span data-stu-id="99185-180">In general, no initiator can rely on completing a reconciliation without expecting some user interaction.</span></span> <span data-ttu-id="99185-181">Os reconciliadores, por outro lado, têm a opção de interagir com o usuário para resolver conflitos ou exigir que o iniciador faça isso.</span><span class="sxs-lookup"><span data-stu-id="99185-181">Reconcilers, on the other hand, have the option of interacting with the user to resolve conflicts or requiring the initiator to do so.</span></span>

### <a name="reconciling-embedded-objects"></a><span data-ttu-id="99185-182">Reconciliando objetos inseridos</span><span class="sxs-lookup"><span data-stu-id="99185-182">Reconciling Embedded Objects</span></span>

<span data-ttu-id="99185-183">Ao reconciliar um documento, o próprio porta-arquivos pode se tornar um iniciador se descobrir um objeto incorporado de um tipo que ele não possa reconciliar.</span><span class="sxs-lookup"><span data-stu-id="99185-183">When reconciling a document, the briefcase reconciler itself can become an initiator if it discovers an embedded object of a type that it cannot reconcile.</span></span> <span data-ttu-id="99185-184">Nesse caso, o reconciliador precisa reconciliar recursivamente cada um dos objetos incorporados e assumir todas as responsabilidades de um iniciador.</span><span class="sxs-lookup"><span data-stu-id="99185-184">In this case, the reconciler needs to recursively reconcile each of the embedded objects and assume all the responsibilities of an initiator.</span></span>

<span data-ttu-id="99185-185">Para executar a recursão, o porta-arquivos reconciliador carrega o objeto e consulta a interface apropriada.</span><span class="sxs-lookup"><span data-stu-id="99185-185">To carry out the recursion, the briefcase reconciler loads the object and queries for the appropriate interface.</span></span> <span data-ttu-id="99185-186">O manipulador do objeto deve dar suporte à interface.</span><span class="sxs-lookup"><span data-stu-id="99185-186">The handler for the object must support the interface.</span></span> <span data-ttu-id="99185-187">Se qualquer método da interface retornar o valor OLE \_ e não \_ executado, o Reconciler deverá executar o objeto para executar a operação.</span><span class="sxs-lookup"><span data-stu-id="99185-187">If any method of the interface returns the OLE\_E\_NOTRUNNING value, the reconciler must run the object in order to carry out the operation.</span></span> <span data-ttu-id="99185-188">Como o código para objetos inseridos não está sempre disponível, um Reconciler deve fornecer uma solução para essa condição.</span><span class="sxs-lookup"><span data-stu-id="99185-188">Because code for embedded objects is not always available, a reconciler must provide a solution for this condition.</span></span> <span data-ttu-id="99185-189">Por exemplo, o Reconciler pode incluir versões antigas e novas do objeto incorporado na versão reconciliada.</span><span class="sxs-lookup"><span data-stu-id="99185-189">For example, the reconciler might include both old and new versions of the embedded object in the reconciled version.</span></span> <span data-ttu-id="99185-190">O reconciliador não deve tentar reconciliar entre links.</span><span class="sxs-lookup"><span data-stu-id="99185-190">The reconciler must not attempt to reconcile across links.</span></span>

<span data-ttu-id="99185-191">O iniciador armazena as versões de documento que estão sendo mescladas.</span><span class="sxs-lookup"><span data-stu-id="99185-191">The initiator stores the document versions being merged.</span></span> <span data-ttu-id="99185-192">Em muitos casos, o iniciador tem acesso ao armazenamento de cada versão e salva o resultado da reconciliação usando armazenamento semelhante.</span><span class="sxs-lookup"><span data-stu-id="99185-192">In many cases, the initiator has access to the storage of each version and saves the result of reconciliation using similar storage.</span></span> <span data-ttu-id="99185-193">Às vezes, no entanto, o iniciador pode ter um objeto na memória para o qual não há nenhuma versão persistente disponível.</span><span class="sxs-lookup"><span data-stu-id="99185-193">Sometimes, however, the initiator might have an in-memory object for which no persistent version is available.</span></span> <span data-ttu-id="99185-194">Essa situação pode ocorrer quando um documento que contém objetos inseridos abertos deve ser reconciliado antes de ser salvo.</span><span class="sxs-lookup"><span data-stu-id="99185-194">This situation can occur when a document containing open embedded objects must be reconciled before being saved.</span></span> <span data-ttu-id="99185-195">Nesses casos, o iniciador salva o resultado da reconciliação na versão encontrada na memória.</span><span class="sxs-lookup"><span data-stu-id="99185-195">In such cases, the initiator saves the result of the reconciliation in the version found in memory.</span></span>

<span data-ttu-id="99185-196">O iniciador usa a interface [IPersistStorage](/windows/win32/api/objidl/nn-objidl-ipersiststorage) para associar (carregar) a versão mesclada.</span><span class="sxs-lookup"><span data-stu-id="99185-196">The initiator uses the [IPersistStorage](/windows/win32/api/objidl/nn-objidl-ipersiststorage) interface to bind (load) the merged version.</span></span> <span data-ttu-id="99185-197">O iniciador usará o método [IPersistStorage:: Load](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load) se uma versão inicial já tiver sido criada e usará o método [IPersistStorage:: InitNew](/windows/win32/api/objidl/nf-objidl-ipersiststorage-initnew) para a versão inicial.</span><span class="sxs-lookup"><span data-stu-id="99185-197">The initiator uses the [IPersistStorage::Load](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load) method if an initial version has already been created and uses the [IPersistStorage::InitNew](/windows/win32/api/objidl/nf-objidl-ipersiststorage-initnew) method for the initial version.</span></span> <span data-ttu-id="99185-198">Quando a versão mesclada é carregada, o iniciador usa [QueryInterface](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) para recuperar o endereço da interface [**IReconcilableObject**](/windows/win32/api/reconcil/nn-reconcil-ireconcilableobject) .</span><span class="sxs-lookup"><span data-stu-id="99185-198">When the merged version is loaded, the initiator uses [QueryInterface](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) to retrieve the address of the [**IReconcilableObject**](/windows/win32/api/reconcil/nn-reconcil-ireconcilableobject) interface.</span></span> <span data-ttu-id="99185-199">Essa interface fornece ao iniciador acesso ao armazenamento do residues existente e oferece uma maneira de criar o armazenamento para qualquer novo residues.</span><span class="sxs-lookup"><span data-stu-id="99185-199">This interface gives the initiator access to the storage of the existing residues and gives it a way to create storage for any new residues.</span></span> <span data-ttu-id="99185-200">Em seguida, o iniciador direciona a interface para realizar a reconciliação.</span><span class="sxs-lookup"><span data-stu-id="99185-200">Then the initiator directs the interface to carry out the reconciliation.</span></span> <span data-ttu-id="99185-201">O iniciador, na verdade, consulta a interface [IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile) antes de IPersistStorage.</span><span class="sxs-lookup"><span data-stu-id="99185-201">The initiator actually queries for the [IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile) interface before IPersistStorage.</span></span> <span data-ttu-id="99185-202">Se o Reconciler der suporte a IPersistFile, o iniciador manipulará a réplica por meio do IPersistFile em vez dos métodos IPersistStorage.</span><span class="sxs-lookup"><span data-stu-id="99185-202">If the reconciler supports IPersistFile, the initiator manipulates the replica through the IPersistFile rather than the IPersistStorage methods.</span></span> <span data-ttu-id="99185-203">Isso permite a reconciliação de arquivos que não são armazenados como documentos compostos.</span><span class="sxs-lookup"><span data-stu-id="99185-203">This permits reconciliation of files that are not stored as compound documents.</span></span>

<span data-ttu-id="99185-204">Quando a reconciliação for concluída, o iniciador poderá salvar a versão mesclada usando a interface [IPersistStorage](/windows/win32/api/objidl/nn-objidl-ipersiststorage) ou [IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile) .</span><span class="sxs-lookup"><span data-stu-id="99185-204">When the reconciliation is complete, the initiator can save the merged version by using the [IPersistStorage](/windows/win32/api/objidl/nn-objidl-ipersiststorage) or [IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile) interface.</span></span> <span data-ttu-id="99185-205">Durante a reconciliação, o porta-arquivos reconciliador cria residues conforme necessário e grava seus bits persistentes no armazenamento.</span><span class="sxs-lookup"><span data-stu-id="99185-205">During reconciliation, the briefcase reconciler creates residues as needed and writes their persistent bits to storage.</span></span> <span data-ttu-id="99185-206">Se a versão mesclada for um fluxo, a interface [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) passada para [IPersistStorage:: Load](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load) conterá um fluxo chamado "Contents" com seu estado de armazenamento definido como STATEBITS \_ Flat.</span><span class="sxs-lookup"><span data-stu-id="99185-206">If the merged version is a stream, the [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) interface passed to [IPersistStorage::Load](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load) contains a stream named "Contents" with its storage state set to STATEBITS\_FLAT.</span></span> <span data-ttu-id="99185-207">(Você pode definir os bits de estado usando o método [IStorage:: stat](/windows/win32/api/objidl/nf-objidl-istorage-stat) .) Após a mesclagem, o iniciador salva a versão mesclada gravando os dados de maneira apropriada.</span><span class="sxs-lookup"><span data-stu-id="99185-207">(You can set the state bits by using the [IStorage::Stat](/windows/win32/api/objidl/nf-objidl-istorage-stat) method.) After the merge, the initiator saves the merged version by writing the data in an appropriate manner.</span></span> <span data-ttu-id="99185-208">Ele deve garantir que STATEBITS \_ Flat esteja definido conforme apropriado para o armazenamento.</span><span class="sxs-lookup"><span data-stu-id="99185-208">It should ensure that STATEBITS\_FLAT is set as appropriate for the storage.</span></span>

### <a name="residues"></a><span data-ttu-id="99185-209">Residues</span><span class="sxs-lookup"><span data-stu-id="99185-209">Residues</span></span>

<span data-ttu-id="99185-210">O iniciador indica se ele quer residues definindo o parâmetro *pstgNewResidues* como um endereço válido ao chamar o método [**IReconcilableObject:: reconcile**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) .</span><span class="sxs-lookup"><span data-stu-id="99185-210">The initiator indicates whether it wants residues by setting the *pstgNewResidues* parameter to a valid address when calling the [**IReconcilableObject::Reconcile**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) method.</span></span> <span data-ttu-id="99185-211">Se o Reconciler não oferecer suporte à criação de residues, ele deverá retornar imediatamente o \_ valor de rec E \_ NORESIDUES, a menos que o parâmetro *dwFlags* especifique o valor de **\_ NORESIDUESOK RECONCILEF** .</span><span class="sxs-lookup"><span data-stu-id="99185-211">If the reconciler does not support the creation of residues, it must return immediately the REC\_E\_NORESIDUES value, unless the *dwFlags* parameter specifies the **RECONCILEF\_NORESIDUESOK** value.</span></span>

<span data-ttu-id="99185-212">O porta-arquivos Reconciler retorna residues para o iniciador criando novos elementos de armazenamento e copiando-os para a matriz apontada por *pstgNewResidues*.</span><span class="sxs-lookup"><span data-stu-id="99185-212">The briefcase reconciler returns residues to the initiator by creating new storage elements and copying them to the array pointed to by *pstgNewResidues*.</span></span> <span data-ttu-id="99185-213">Para residues de armazenamento estruturado, o Reconciler copia uma interface [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) e, para residues de armazenamento simples, ele copia uma interface de [IStream](/windows/win32/api/objidl/nn-objidl-istream) ou IStorage com o \_ conjunto de sinalizadores simples STATEBITS.</span><span class="sxs-lookup"><span data-stu-id="99185-213">For structured storage residues, the reconciler copies an [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) interface, and for flat storage residues, it copies either an [IStream](/windows/win32/api/objidl/nn-objidl-istream) or an IStorage interface with the STATEBITS\_FLAT flag set.</span></span> <span data-ttu-id="99185-214">O Reconciler usa IStorage para criar o armazenamento necessário, usando [IStorage:: CreateStream](/windows/win32/api/objidl/nf-objidl-istorage-createstream) para criar um armazenamento simples para um residue que é um fluxo e [IStorage:: CreateStorage](/windows/win32/api/objidl/nf-objidl-istorage-createstorage) para criar um armazenamento estruturado.</span><span class="sxs-lookup"><span data-stu-id="99185-214">The reconciler uses IStorage to create the necessary storage, using [IStorage::CreateStream](/windows/win32/api/objidl/nf-objidl-istorage-createstream) to create flat storage for a residue that is a stream and [IStorage::CreateStorage](/windows/win32/api/objidl/nf-objidl-istorage-createstorage) to create structured storage.</span></span>

<span data-ttu-id="99185-215">O iniciador prepara *pstgNewResidues* para que ele não contenha nenhum elemento na parte não reservada do namespace [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) .</span><span class="sxs-lookup"><span data-stu-id="99185-215">The initiator prepares *pstgNewResidues* so that it contains no elements in the nonreserved part of the [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) namespace.</span></span> <span data-ttu-id="99185-216">O porta-arquivos Reconciler coloca cada residue em um elemento cujo nome corresponde à ordem de sua versão inicial.</span><span class="sxs-lookup"><span data-stu-id="99185-216">The briefcase reconciler places each residue in an element whose name corresponds to the order of its initial version.</span></span> <span data-ttu-id="99185-217">Por exemplo, o primeiro residue está contido em "1", o segundo em "2" e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="99185-217">For example, the first residue is contained in "1", the second in "2", and so on.</span></span> <span data-ttu-id="99185-218">Se o próprio objeto reconciliado produzir um residue, ele será encontrado no elemento chamado "0".</span><span class="sxs-lookup"><span data-stu-id="99185-218">If the reconciled object itself produces a residue, it is found in the element named "0".</span></span>

<span data-ttu-id="99185-219">O porta-arquivos reconciliador confirma cada um dos elementos recém-criados individualmente, garantindo que o iniciador tenha acesso às informações.</span><span class="sxs-lookup"><span data-stu-id="99185-219">The briefcase reconciler commits each of the newly created elements individually, ensuring that the initiator has access to the information.</span></span> <span data-ttu-id="99185-220">No entanto, o Reconciler não confirma o próprio *pstgNewResidues* .</span><span class="sxs-lookup"><span data-stu-id="99185-220">The reconciler does not, however, commit *pstgNewResidues* itself.</span></span> <span data-ttu-id="99185-221">O iniciador é responsável por confirmar isso ou descartar seu caso.</span><span class="sxs-lookup"><span data-stu-id="99185-221">The initiator is responsible for committing this or otherwise disposing of it.</span></span>

## <a name="briefcase-reconciler-reference"></a><span data-ttu-id="99185-222">Referência do porta-arquivos</span><span class="sxs-lookup"><span data-stu-id="99185-222">Briefcase Reconciler Reference</span></span>

<span data-ttu-id="99185-223">Esta seção contém informações sobre as interfaces de reconciliação.</span><span class="sxs-lookup"><span data-stu-id="99185-223">This section contains information about the reconciliation interfaces.</span></span> <span data-ttu-id="99185-224">Ao lidar com erros, um método pode retornar apenas os valores de erro que são explicitamente definidos como possíveis valores de retorno.</span><span class="sxs-lookup"><span data-stu-id="99185-224">When handling errors, a method can return only those error values that are explicitly defined as possible return values.</span></span> <span data-ttu-id="99185-225">Além disso, o método deve definir todas as variáveis cujos endereços são passados como parâmetros para **NULL** antes de retornar do erro.</span><span class="sxs-lookup"><span data-stu-id="99185-225">Furthermore, the method must set all variables whose addresses are passed as parameters to **NULL** before returning from the error.</span></span>

### <a name="briefcase-reconciler-interfaces-and-methods"></a><span data-ttu-id="99185-226">Métodos e interfaces do portador Reconciler</span><span class="sxs-lookup"><span data-stu-id="99185-226">Briefcase Reconciler Interfaces and Methods</span></span>

-   [<span data-ttu-id="99185-227">**IReconcilableObject**</span><span class="sxs-lookup"><span data-stu-id="99185-227">**IReconcilableObject**</span></span>](/windows/win32/api/reconcil/nn-reconcil-ireconcilableobject) 
    -   -   [<span data-ttu-id="99185-228">**IReconcilableObject::GetProgressFeedbackMaxEstimate**</span><span class="sxs-lookup"><span data-stu-id="99185-228">**IReconcilableObject::GetProgressFeedbackMaxEstimate**</span></span>](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-getprogressfeedbackmaxestimate)
        -   [<span data-ttu-id="99185-229">**IReconcilableObject:: reconcile**</span><span class="sxs-lookup"><span data-stu-id="99185-229">**IReconcilableObject::Reconcile**</span></span>](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile)

-   [<span data-ttu-id="99185-230">**IReconcileInitiator**</span><span class="sxs-lookup"><span data-stu-id="99185-230">**IReconcileInitiator**</span></span>](ireconcileinitiator.md) 
    -   -   [<span data-ttu-id="99185-231">**IReconcileInitiator::SetAbortCallback**</span><span class="sxs-lookup"><span data-stu-id="99185-231">**IReconcileInitiator::SetAbortCallback**</span></span>](/windows/win32/api/reconcil/nf-reconcil-ireconcileinitiator-setabortcallback)
        -   [<span data-ttu-id="99185-232">**IReconcileInitiator::SetProgressFeedback**</span><span class="sxs-lookup"><span data-stu-id="99185-232">**IReconcileInitiator::SetProgressFeedback**</span></span>](/windows/win32/api/reconcil/nf-reconcil-ireconcileinitiator-setprogressfeedback)

-   [<span data-ttu-id="99185-233">**INotifyReplica**</span><span class="sxs-lookup"><span data-stu-id="99185-233">**INotifyReplica**</span></span>](/windows/desktop/api/reconcil/nn-reconcil-inotifyreplica) 
    -   -   [<span data-ttu-id="99185-234">**INotifyReplica::YouAreAReplica**</span><span class="sxs-lookup"><span data-stu-id="99185-234">**INotifyReplica::YouAreAReplica**</span></span>](/windows/desktop/api/reconcil/nf-reconcil-inotifyreplica-youareareplica)

 

 