---
description: Os administradores podem criar, excluir e recriar diários de alterações.
ms.assetid: 26cbacc2-d26b-434b-91b5-31aedc96da13
title: Criando, modificando e excluindo um diário de alterações
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 50c8cf7296f93549e7d9ec05f5d614131cc342ce
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "105764701"
---
# <a name="creating-modifying-and-deleting-a-change-journal"></a><span data-ttu-id="6ad55-103">Criando, modificando e excluindo um diário de alterações</span><span class="sxs-lookup"><span data-stu-id="6ad55-103">Creating, Modifying, and Deleting a Change Journal</span></span>

<span data-ttu-id="6ad55-104">Os administradores podem criar, excluir e recriar diários de alterações no.</span><span class="sxs-lookup"><span data-stu-id="6ad55-104">Administrators can create, delete, and re-create change journals at will.</span></span> <span data-ttu-id="6ad55-105">Um administrador deve excluir um diário quando o valor de USN (número de sequência de atualização) atual se aproximar do valor USN máximo possível, conforme indicado pelo membro **MaxUsn** da estrutura de [**\_ \_ dados do diário USN**](/windows/desktop/api/WinIoCtl/ns-winioctl-usn_journal_data_v0) .</span><span class="sxs-lookup"><span data-stu-id="6ad55-105">An administrator should delete a journal when the current update sequence number (USN) value approaches the maximum possible USN value, as indicated by the **MaxUsn** member of the [**USN\_JOURNAL\_DATA**](/windows/desktop/api/WinIoCtl/ns-winioctl-usn_journal_data_v0) structure.</span></span> <span data-ttu-id="6ad55-106">Um administrador também pode excluir e recriar um diário de alterações para recuperar espaço em disco.</span><span class="sxs-lookup"><span data-stu-id="6ad55-106">An administrator might also delete and re-create a change journal to reclaim disk space.</span></span> <span data-ttu-id="6ad55-107">Para executar essa e todas as outras operações de diário de alteração não programática, você deve ter privilégios de administrador do sistema.</span><span class="sxs-lookup"><span data-stu-id="6ad55-107">To perform this and all other non-programmatic change journal operations, you must have system administrator privileges.</span></span> <span data-ttu-id="6ad55-108">Ou seja, você deve ser um membro do grupo Administradores.</span><span class="sxs-lookup"><span data-stu-id="6ad55-108">That is, you must be a member of the Administrators group.</span></span>

<span data-ttu-id="6ad55-109">Para criar ou modificar um diário de alterações em um volume especificado programaticamente, use o código de controle do [**\_ \_ \_ diário fsctl Create USN**](/windows/win32/api/winioctl/ni-winioctl-fsctl_create_usn_journal) .</span><span class="sxs-lookup"><span data-stu-id="6ad55-109">To create or modify a change journal on a specified volume programmatically, use the [**FSCTL\_CREATE\_USN\_JOURNAL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_create_usn_journal) control code.</span></span>

<span data-ttu-id="6ad55-110">Quando você cria um novo diário de alterações ou modifica um existente, o sistema de arquivos NTFS define informações para esse diário de alterações de informações na estrutura de [**\_ \_ \_ dados criar diário de USN**](/windows/desktop/api/WinIoCtl/ns-winioctl-create_usn_journal_data) , que [**fsctl \_ criar \_ \_ diário de USN**](/windows/win32/api/winioctl/ni-winioctl-fsctl_create_usn_journal) usa como entrada.</span><span class="sxs-lookup"><span data-stu-id="6ad55-110">When you create a new change journal or modify an existing one, the NTFS file system sets information for that change journal from information in the [**CREATE\_USN\_JOURNAL\_DATA**](/windows/desktop/api/WinIoCtl/ns-winioctl-create_usn_journal_data) structure, which [**FSCTL\_CREATE\_USN\_JOURNAL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_create_usn_journal) takes as input.</span></span> <span data-ttu-id="6ad55-111">**Criar \_ Os \_ \_ dados do diário de USN** têm os membros **MaximumSize** e **AllocationDelta**.</span><span class="sxs-lookup"><span data-stu-id="6ad55-111">**CREATE\_USN\_JOURNAL\_DATA** has the members **MaximumSize** and **AllocationDelta**.</span></span>

<span data-ttu-id="6ad55-112">**MaximumSize** é o tamanho máximo de destino para o diário de alterações em bytes.</span><span class="sxs-lookup"><span data-stu-id="6ad55-112">**MaximumSize** is the target maximum size for the change journal in bytes.</span></span> <span data-ttu-id="6ad55-113">O diário de alterações pode crescer maior que esse valor, mas em pontos de verificação do sistema de arquivos NTFS o sistema de arquivos NTFS examina o diário e o corta quando seu tamanho excede o valor de **MaximumSize** mais o valor de **AllocationDelta**.</span><span class="sxs-lookup"><span data-stu-id="6ad55-113">The change journal can grow larger than this value, but at NTFS file system checkpoints the NTFS file system examines the journal and trims it when its size exceeds the value of **MaximumSize** plus the value of **AllocationDelta**.</span></span> <span data-ttu-id="6ad55-114">(Em pontos de verificação do sistema de arquivos NTFS, o sistema operacional grava registros no arquivo de log do sistema de arquivos NTFS que permite que o sistema de arquivos NTFS determine qual processamento é necessário para se recuperar de uma falha.)</span><span class="sxs-lookup"><span data-stu-id="6ad55-114">(At NTFS file system checkpoints, the operating system writes records to the NTFS file system log file that allow the NTFS file system to determine what processing is required to recover from a failure.)</span></span>

<span data-ttu-id="6ad55-115">**AllocationDelta** é o número de bytes adicionados ao final e removido do início do diário de alterações cada vez que a memória é alocada ou desalocada.</span><span class="sxs-lookup"><span data-stu-id="6ad55-115">**AllocationDelta** is the number of bytes added to the end and removed from the beginning of the change journal each time memory is allocated or deallocated.</span></span> <span data-ttu-id="6ad55-116">Em outras palavras, a alocação e a desalocação ocorrem em unidades desse tamanho.</span><span class="sxs-lookup"><span data-stu-id="6ad55-116">In other words, allocation and deallocation take place in units of this size.</span></span> <span data-ttu-id="6ad55-117">Um inteiro múltiplo de um tamanho de cluster é um valor razoável para esse membro.</span><span class="sxs-lookup"><span data-stu-id="6ad55-117">An integer multiple of a cluster size is a reasonable value for this member.</span></span>

<span data-ttu-id="6ad55-118">Se um administrador modificar um diário de alterações existente para ter um valor **MaximumSize** maior, por exemplo, se um volume estiver sendo reindexado com muita frequência, o diário de alterações simplesmente receberá novas entradas até que ela exceda o novo tamanho máximo.</span><span class="sxs-lookup"><span data-stu-id="6ad55-118">If an administrator modifies an existing change journal to have a larger **MaximumSize** value, for example if a volume is being re-indexed too often, the change journal simply receives new entries until it exceeds the new maximum size.</span></span>

<span data-ttu-id="6ad55-119">Para excluir um diário de alterações, use o código de controle do [**diário de fsctl \_ delete \_ USN \_**](/windows/win32/api/winioctl/ni-winioctl-fsctl_delete_usn_journal) .</span><span class="sxs-lookup"><span data-stu-id="6ad55-119">To delete a change journal, use the [**FSCTL\_DELETE\_USN\_JOURNAL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_delete_usn_journal) control code.</span></span> <span data-ttu-id="6ad55-120">Quando você usa essa operação, ela percorre todos os arquivos no volume e redefine o USN para cada arquivo como zero.</span><span class="sxs-lookup"><span data-stu-id="6ad55-120">When you use this operation, it walks through all of the files on the volume and resets the USN for each file to zero.</span></span> <span data-ttu-id="6ad55-121">Em seguida, a operação exclui o diário de alterações existente.</span><span class="sxs-lookup"><span data-stu-id="6ad55-121">The operation then deletes the existing change journal.</span></span> <span data-ttu-id="6ad55-122">Essa operação persiste entre as reinicializações do sistema até que ele seja concluído.</span><span class="sxs-lookup"><span data-stu-id="6ad55-122">This operation persists across system restarts until it completes.</span></span> <span data-ttu-id="6ad55-123">Qualquer tentativa de ler, criar ou modificar o diário de alterações durante esse processo falha com a exclusão do **diário de erros do código \_ de erro \_ \_ em \_ andamento**.</span><span class="sxs-lookup"><span data-stu-id="6ad55-123">Any attempt to read, create, or modify the change journal during this process fails with the error code **ERROR\_JOURNAL\_DELETE\_IN\_PROGRESS**.</span></span>

<span data-ttu-id="6ad55-124">Você também pode usar o código de controle do [**\_ \_ \_ diário fsctl Delete USN**](/windows/win32/api/winioctl/ni-winioctl-fsctl_delete_usn_journal) para determinar se uma exclusão iniciada por algum outro processo está em andamento.</span><span class="sxs-lookup"><span data-stu-id="6ad55-124">You can also use the [**FSCTL\_DELETE\_USN\_JOURNAL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_delete_usn_journal) control code to determine if a deletion started by some other process is in progress.</span></span> <span data-ttu-id="6ad55-125">Por exemplo, seu aplicativo, quando ele é iniciado, pode determinar se uma exclusão está em andamento.</span><span class="sxs-lookup"><span data-stu-id="6ad55-125">For example, your application, when it is started, can determine if a deletion is in progress.</span></span> <span data-ttu-id="6ad55-126">Como as exclusões do diário persistem entre reinicializações do sistema, os serviços e aplicativos iniciados na reinicialização do sistema devem verificar se há uma exclusão em andamento.</span><span class="sxs-lookup"><span data-stu-id="6ad55-126">Because journal deletions persist across system restarts, services and applications started at system restart should check for an ongoing deletion.</span></span>

<span data-ttu-id="6ad55-127">Os diários de alterações não são necessariamente criados na inicialização.</span><span class="sxs-lookup"><span data-stu-id="6ad55-127">Change journals are not necessarily created at startup.</span></span> <span data-ttu-id="6ad55-128">Para criar um diário de alterações, um administrador pode fazê-lo explicitamente ou iniciar outro serviço que exija um diário de alterações.</span><span class="sxs-lookup"><span data-stu-id="6ad55-128">To create a change journal, an administrator may do so explicitly or start another service that requires a change journal.</span></span>

 

 
