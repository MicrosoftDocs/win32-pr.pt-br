---
description: Recomendações para transações de sistema de arquivos ideais.
ms.assetid: 847939ff-5322-4023-8ef7-9d845e80d65c
title: Considerações de desempenho para NTFS Transacional
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3a71f7e100e1ddd8524932a4a259a12092bddcb6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "103922375"
---
# <a name="performance-considerations-for-transactional-ntfs"></a><span data-ttu-id="6ca9b-103">Considerações de desempenho para NTFS Transacional</span><span class="sxs-lookup"><span data-stu-id="6ca9b-103">Performance Considerations for Transactional NTFS</span></span>

<span data-ttu-id="6ca9b-104">O NTFS Transacional (TxF) foi cuidadosamente projetado para desempenho e normalmente funcionará melhor do que as alternativas transacionais de uso geral em cenários semelhantes.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-104">Transactional NTFS (TxF) has been carefully designed for performance and will typically perform better than general-purpose transactional alternatives under similar scenarios.</span></span> <span data-ttu-id="6ca9b-105">No entanto, as transações do sistema de arquivos têm mais sobrecarga do que as operações não transacionadas, e alguma redução no desempenho de e/s em comparação com e/s não transacionada é esperada.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-105">However, file system transactions have more overhead than non-transacted operations, and some reduction in I/O performance compared to non-transacted I/O is to be expected.</span></span> <span data-ttu-id="6ca9b-106">Os aplicativos de desempenho crítico devem executar um ciclo de qualificação de adoção de tecnologia, avaliando o impacto no desempenho das operações do sistema de arquivos transacionais.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-106">Performance-critical applications should perform a technology adoption qualification cycle, evaluating the performance impact of transacted file system operations.</span></span>

## <a name="overview-of-txf-operations"></a><span data-ttu-id="6ca9b-107">Visão geral das operações de TxF</span><span class="sxs-lookup"><span data-stu-id="6ca9b-107">Overview of TxF Operations</span></span>

<span data-ttu-id="6ca9b-108">O TxF usa o registro em log de *desfazer* para registrar as alterações necessárias para colocar o sistema de arquivos novamente em um estado consistente, também conhecido como reversão, caso uma anulação de transação ocorra.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-108">TxF uses *undo* logging to record the changes necessary to put the file system back into a consistent state, also referred to as a rollback, should a transaction abort occur.</span></span> <span data-ttu-id="6ca9b-109">Esse log de desfazer gera e/s adicional e é a origem da sobrecarga de desempenho de TxF em comparação com operações de sistema de arquivos não transacionais.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-109">This undo logging generates additional I/O and is the source of TxF performance overhead compared to non-transactional file system operations.</span></span>

<span data-ttu-id="6ca9b-110">Um resumo de alto nível de como o TxF Opera é o seguinte:</span><span class="sxs-lookup"><span data-stu-id="6ca9b-110">A high-level summary of how TxF operates is as follows:</span></span>

-   <span data-ttu-id="6ca9b-111">À medida que uma transação progride, o TxF grava registros de *desfazer* em seu arquivo de log para cada modificação que faz no sistema de arquivos.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-111">As a transaction progresses, TxF writes *undo* records into its log file for each modification it makes to the file system.</span></span> <span data-ttu-id="6ca9b-112">Se ocorrer uma anulação, esses registros de desfazer serão analisados para colocar o sistema de arquivos novamente no estado em que estava antes do início da transação.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-112">If an abort occurs, these undo records are parsed to put the file system back in the state it was before the transaction began.</span></span>
-   <span data-ttu-id="6ca9b-113">Um registro de desfazer de *alteração de metadados* descreve uma alteração somente nos metadados do sistema de arquivos.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-113">A *metadata change* undo record describes a change only to the file system's metadata.</span></span> <span data-ttu-id="6ca9b-114">Alguns exemplos disso são movimentações, renomeações, acréscimos e alterações de atributo.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-114">Some examples of this are moves, renames, appends, and attribute changes.</span></span> <span data-ttu-id="6ca9b-115">Para registros de desfazer alteração de metadados, todas as informações necessárias para desfazer a alteração estão no registro e armazenadas no arquivo de log.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-115">For metadata change undo records, all of the information necessary to undo the change is in the record and stored in the log file.</span></span>
-   <span data-ttu-id="6ca9b-116">Um registro de desfazer *substituição* descreve uma substituição de uma parte de um arquivo.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-116">An *overwrite* undo record describes an overwrite of a portion of a file.</span></span> <span data-ttu-id="6ca9b-117">Quando ocorre uma substituição de arquivo, o conteúdo original do arquivo é armazenado em um arquivo de desfazer especial em um diretório oculto e os pontos de registro de desfazer de substituição para esse arquivo.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-117">When a file overwrite occurs, the file's original contents are stored in a special undo file in a hidden directory and the overwrite undo record points to this file.</span></span> <span data-ttu-id="6ca9b-118">Quando as atualizações de arquivo são eventualmente liberadas do cache para o disco, o conteúdo do arquivo de desfazer também deve ser liberado e, portanto, uma substituição de arquivo transacionado poderia gerar até duas operações de e/s aleatórias extras: uma para ler os dados antigos e um para gravá-lo no arquivo de desfazer.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-118">When file updates are eventually flushed from cache to disk, the contents of the undo file must also be flushed, so a transacted file overwrite could generate up to two extra random I/O operations: one to read the old data and one to write it to the undo file.</span></span> <span data-ttu-id="6ca9b-119">Essas operações de e/s extras são um custo de desempenho de TxF.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-119">These extra I/O operations are a performance cost of TxF.</span></span>
-   <span data-ttu-id="6ca9b-120">Quando ocorre uma confirmação, o TxF primeiro libera Todas as informações de desfazer e, em seguida, libera as alterações reais do arquivo e, em seguida, grava e libera um registro de confirmação.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-120">When a commit occurs, TxF first flushes all undo information, then flushes the actual file changes, and then writes and flushes a commit record.</span></span> <span data-ttu-id="6ca9b-121">Se não houver nenhum arquivo de desfazer a ser liberado, a única sobrecarga adicional de TxF relativa à e/s não transacionada será a própria liberação de log.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-121">If there are no undo files to flush, the only additional TxF overhead relative to non-transacted I/O is the log flushes themselves.</span></span> <span data-ttu-id="6ca9b-122">No entanto, as liberações de log resultam em grandes gravações sequenciais eficientes para que o custo de desempenho seja mínimo.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-122">However, log flushes result in efficient large sequential writes so the performance cost is minimal.</span></span>
-   <span data-ttu-id="6ca9b-123">O TxF é otimizado para confirmação.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-123">TxF is optimized for commit.</span></span> <span data-ttu-id="6ca9b-124">Espera-se que a maioria das transações seja bem sucedido e não precise ser revertida, portanto, espera-se que todos os registros de desfazer de uma transação fiquem inutilizados.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-124">It is expected that most transactions will succeed and not need to rollback, therefore all undo records for a transaction are expected to go unused.</span></span> <span data-ttu-id="6ca9b-125">Do ponto de vista do desempenho, as operações de confirmação do TxF são rápidas e as reversões são de uso intensivo de recursos.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-125">From a performance perspective, TxF commit operations are fast and rollbacks are resource-intensive.</span></span>
-   <span data-ttu-id="6ca9b-126">A reversão é mais intensiva em recursos do que a confirmação.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-126">Rollback is more resource-intensive than commit.</span></span> <span data-ttu-id="6ca9b-127">Durante a reversão, todas as alterações feitas na transação precisam ser desfeitas.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-127">During rollback, all the changes that were made in the transaction have to be un-done.</span></span> <span data-ttu-id="6ca9b-128">Em geral, a duração da reversão pode ser aproximadamente a mesma tomada para fazer as alterações originalmente.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-128">In general, rollback duration can be approximately the same it took to originally make the changes.</span></span> <span data-ttu-id="6ca9b-129">Por exemplo, se levou 1 segundo para fazer todas as alterações, poderia levar cerca de 1 segundo para desfazê-las.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-129">For example, if it took 1 second to make all the changes then it could take about 1 second to undo them.</span></span> <span data-ttu-id="6ca9b-130">Para transações muito longas, a reversão pode criar impactos de desempenho adicionais.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-130">For very long transactions, rollback can create additional performance impacts.</span></span> <span data-ttu-id="6ca9b-131">Por exemplo, o tempo de inicialização do sistema pode ser atrasado se o sistema precisar reverter automaticamente uma transação caso o sistema pare de responder e deva executar uma reinicialização não agendada.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-131">For example, system boot time can be delayed if the system must automatically rollback a transaction in the event that the system stops responding and must perform an unscheduled restart.</span></span>

<span data-ttu-id="6ca9b-132">As conclusões de resumo sobre o desempenho que podem ser desenhadas da lista anterior são as seguintes:</span><span class="sxs-lookup"><span data-stu-id="6ca9b-132">The summary conclusions about performance that can be drawn from the previous list are as follows:</span></span>

-   <span data-ttu-id="6ca9b-133">O custo de desempenho do TxF para transações que envolvem substituições de arquivo pode ser significativo.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-133">The performance cost of TxF for transactions involving file overwrites can be significant.</span></span>
-   <span data-ttu-id="6ca9b-134">O custo de desempenho do TxF para transações que envolvem apenas operações de metadados pode ser relativamente baixo, desde que sejam usadas transações grandes.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-134">The performance cost of TxF for transactions involving only metadata operations can be relatively low, provided large transactions be used.</span></span> <span data-ttu-id="6ca9b-135">Uma transação grande é quando há muitos registros de desfazer para cada registro de confirmação.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-135">A large transaction is when there are many undo records for every commit record.</span></span>

## <a name="recommendations-for-best-performance"></a><span data-ttu-id="6ca9b-136">Recomendações para melhor desempenho</span><span class="sxs-lookup"><span data-stu-id="6ca9b-136">Recommendations For Best Performance</span></span>

<span data-ttu-id="6ca9b-137">Amortizar a sobrecarga de TxF em transações maiores.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-137">Amortize TxF overhead over larger transactions.</span></span> <span data-ttu-id="6ca9b-138">Por exemplo, se você tiver *N* conjuntos de alterações para fazer onde cada alteração tem *M* etapas e tiver a opção de fazer isso como *N* transações de *m* etapas cada ou fazer tudo como uma única transação com *M* \* *N* etapas, a última opção seria mais eficiente.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-138">For example, if you have *N* sets of changes to make where each change has *M* steps and you have the option to either do this as *N* transactions of *M* steps each or do it all as a single transaction with *M*\**N* steps, the latter option would be more efficient.</span></span>

<span data-ttu-id="6ca9b-139">Considere o possível impacto na inicialização de transações muito grandes.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-139">Consider the possible impact on boot of very large transactions.</span></span> <span data-ttu-id="6ca9b-140">Conforme indicado anteriormente, a reversão pode ser lenta e atrasará o tempo de inicialização se o sistema precisar executar reversões automáticas como tempo de inicialização.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-140">As previously stated, rollback can be slow and will delay boot time if the system needs to perform automatic rollbacks as boot time.</span></span> <span data-ttu-id="6ca9b-141">Quanto maior a transação, mais tempo o atraso.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-141">The larger the transaction, the longer the delay.</span></span>

<span data-ttu-id="6ca9b-142">Manter as transações para a maioria das operações de metadados.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-142">Keep transactions to mostly metadata operations.</span></span> <span data-ttu-id="6ca9b-143">É para isso que o TxF é otimizado para e, em geral, o desempenho é quase igual à e/s de arquivo não transacionado para transações de metadados grandes.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-143">This is what TxF is optimized for and, in general, the performance is about the same as non-transacted file I/O for large metadata transactions.</span></span> <span data-ttu-id="6ca9b-144">Exemplos de funções do TxF de metadados eficientes são [**MoveFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-movefiletransacteda), [**SetFileAttributesTransacted**](/windows/desktop/api/WinBase/nf-winbase-setfileattributestransacteda), [**CopyFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-copyfiletransacteda), [**DeleteFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-deletefiletransacteda), [**CreateHardLinkTransacted**](/windows/desktop/api/WinBase/nf-winbase-createhardlinktransacteda)e gravações acrescentadas (chamadas para a função [**WriteFile**](/windows/desktop/api/FileAPI/nf-fileapi-writefile) quando o ponteiro do arquivo for no final do arquivo ou *EOF*).</span><span class="sxs-lookup"><span data-stu-id="6ca9b-144">Examples of efficient metadata TxF functions are [**MoveFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-movefiletransacteda), [**SetFileAttributesTransacted**](/windows/desktop/api/WinBase/nf-winbase-setfileattributestransacteda), [**CopyFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-copyfiletransacteda), [**DeleteFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-deletefiletransacteda), [**CreateHardLinkTransacted**](/windows/desktop/api/WinBase/nf-winbase-createhardlinktransacteda), and appended writes (calls to the [**WriteFile**](/windows/desktop/api/FileAPI/nf-fileapi-writefile) function when the file pointer as at the end the file, or *EOF*).</span></span> <span data-ttu-id="6ca9b-145">Um exemplo de operações de não metadados com uso intensivo de recursos são chamadas para a função **WriteFile** quando o ponteiro do arquivo não está no EOF.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-145">An example of resource-intensive non-metadata operations are calls to the **WriteFile** function when the file pointer is not at the EOF.</span></span>

## <a name="summary-of-txf-performance-expectations"></a><span data-ttu-id="6ca9b-146">Resumo das expectativas de desempenho de TxF</span><span class="sxs-lookup"><span data-stu-id="6ca9b-146">Summary of TxF Performance Expectations</span></span>

<span data-ttu-id="6ca9b-147">Para atualizações in-loco, as substituições em uma seção de um arquivo serão muito mais lentas do que a e/s de arquivo não transacionado, enquanto o desempenho do TxF para operações de metadados do sistema de arquivos (por exemplo, criar, mover e acrescentar) é comparável a e/s de arquivo não transacionado para transações grandes.</span><span class="sxs-lookup"><span data-stu-id="6ca9b-147">For in-place updates, overwrites to a section of a file will be much slower than non-transacted file I/O, while TxF performance for file system metadata operations (for example, create, move, and append) is comparable to non-transacted file I/O for large transactions.</span></span>

 

 



