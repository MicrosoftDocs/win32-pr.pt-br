---
description: O sistema de arquivos NTFS associa um identificador não assinado de 64 bits a cada diário de alterações.
ms.assetid: 5ae79460-b69a-4901-a417-1d5358dcba29
title: Usando o identificador do diário de alterações
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 692acf98403e45b6bdafd3cd4791a64dd1beb532
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105758813"
---
# <a name="using-the-change-journal-identifier"></a><span data-ttu-id="26981-103">Usando o identificador do diário de alterações</span><span class="sxs-lookup"><span data-stu-id="26981-103">Using the Change Journal Identifier</span></span>

<span data-ttu-id="26981-104">O sistema de arquivos NTFS associa um identificador não assinado de 64 bits a cada diário de alterações.</span><span class="sxs-lookup"><span data-stu-id="26981-104">The NTFS file system associates an unsigned 64-bit identifier with each change journal.</span></span> <span data-ttu-id="26981-105">O diário é carimbado com esse identificador quando ele é criado.</span><span class="sxs-lookup"><span data-stu-id="26981-105">The journal is stamped with this identifier when it is created.</span></span> <span data-ttu-id="26981-106">O sistema de arquivos marca o diário com um novo identificador em que os registros USN (número de sequência de atualização) existentes são ou podem ser inutilizáveis.</span><span class="sxs-lookup"><span data-stu-id="26981-106">The file system stamps the journal with a new identifier where the existing update sequence number (USN) records either are or may be unusable.</span></span>

<span data-ttu-id="26981-107">Por exemplo, o sistema de arquivos NTFS remarca um diário de alterações com um novo identificador quando um volume é movido de uma versão do NTFS para outra e, em seguida, de volta.</span><span class="sxs-lookup"><span data-stu-id="26981-107">For example, the NTFS file system restamps a change journal with a new identifier when a volume is moved from one version of NTFS to another and then back.</span></span> <span data-ttu-id="26981-108">Essa movimentação pode acontecer em um ambiente de inicialização dupla ou ao trabalhar com mídia removível.</span><span class="sxs-lookup"><span data-stu-id="26981-108">Such a move can happen in a dual-boot environment or when working with removable media.</span></span>

<span data-ttu-id="26981-109">Para obter o identificador do diário de alterações atual em um volume especificado, use o código de controle do [**\_ diário de \_ USN \_ do fsctl Query**](/windows/win32/api/winioctl/ni-winioctl-fsctl_query_usn_journal) .</span><span class="sxs-lookup"><span data-stu-id="26981-109">To obtain the identifier of the current change journal on a specified volume, use the [**FSCTL\_QUERY\_USN\_JOURNAL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_query_usn_journal) control code.</span></span> <span data-ttu-id="26981-110">Para executar essa e todas as outras operações de diário de alterações, você deve ter privilégios de administrador do sistema.</span><span class="sxs-lookup"><span data-stu-id="26981-110">To perform this and all other change journal operations, you must have system administrator privileges.</span></span> <span data-ttu-id="26981-111">Ou seja, você deve ser um membro do grupo Administradores.</span><span class="sxs-lookup"><span data-stu-id="26981-111">That is, you must be a member of the Administrators group.</span></span>

<span data-ttu-id="26981-112">Quando um administrador exclui e recria o diário de alterações, por exemplo, quando o valor USN atual se aproxima do valor USN máximo possível, os valores USN começam novamente a partir de zero.</span><span class="sxs-lookup"><span data-stu-id="26981-112">When an administrator deletes and re-creates the change journal, for example when the current USN value approaches the maximum possible USN value, the USN values begin again from zero.</span></span> <span data-ttu-id="26981-113">Quando o sistema de arquivos NTFS carimba um diário com um novo identificador em vez de recriar o diário, ele não redefine o USN para zero, mas continua do USN atual.</span><span class="sxs-lookup"><span data-stu-id="26981-113">When the NTFS file system stamps a journal with a new identifier rather than re-creating the journal, it does not reset the USN to zero but continues from the current USN.</span></span> <span data-ttu-id="26981-114">Em ambos os casos, todos os USNs existentes são menores do que quaisquer USNs futuros.</span><span class="sxs-lookup"><span data-stu-id="26981-114">In either case, all existing USNs are less than any future USNs.</span></span>

<span data-ttu-id="26981-115">Quando você precisar de informações sobre um conjunto específico de registros, use o código de controle do [**diário de fsctl \_ consulta do \_ USN \_**](/windows/win32/api/winioctl/ni-winioctl-fsctl_query_usn_journal) para obter o identificador do diário de alterações.</span><span class="sxs-lookup"><span data-stu-id="26981-115">When you need information on a specific set of records, use the [**FSCTL\_QUERY\_USN\_JOURNAL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_query_usn_journal) control code to obtain the change journal identifier.</span></span> <span data-ttu-id="26981-116">Em seguida, use o código de controle do [**\_ \_ \_ diário USN fsctl ler**](/windows/win32/api/winioctl/ni-winioctl-fsctl_read_usn_journal) para ler os registros de diário de interesse.</span><span class="sxs-lookup"><span data-stu-id="26981-116">Then use the [**FSCTL\_READ\_USN\_JOURNAL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_read_usn_journal) control code to read the journal records of interest.</span></span> <span data-ttu-id="26981-117">O sistema de arquivos NTFS retorna apenas os registros que são válidos para o diário especificado pelo identificador.</span><span class="sxs-lookup"><span data-stu-id="26981-117">The NTFS file system only returns records that are valid for the journal specified by the identifier.</span></span>

<span data-ttu-id="26981-118">Seu aplicativo precisa dos USNs dos registros e do identificador para ler o diário.</span><span class="sxs-lookup"><span data-stu-id="26981-118">Your application needs both the records' USNs and the identifier to read the journal.</span></span> <span data-ttu-id="26981-119">Esse requisito fornece uma verificação de integridade para casos em que o aplicativo deve ignorar os registros existentes no arquivo e onde os registros foram gravados em instâncias anteriores do diário para o mesmo volume.</span><span class="sxs-lookup"><span data-stu-id="26981-119">This requirement provides an integrity check for cases where your application should ignore the existing records in the file and where records were written in previous instances of the journal for the same volume.</span></span>

<span data-ttu-id="26981-120">Para obter os registros nos quais você está interessado, você deve iniciar no registro mais antigo (ou seja, com o USN mais baixo) e fazer uma varredura para frente até localizar o primeiro registro de interesse.</span><span class="sxs-lookup"><span data-stu-id="26981-120">To obtain the records in which you are interested, you must start at the oldest record (that is, with the lowest USN) and scan forward until you locate the first record of interest.</span></span>

 

 
