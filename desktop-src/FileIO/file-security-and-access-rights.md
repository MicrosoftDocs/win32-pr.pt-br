---
description: Como os arquivos são objetos protegíveis, o acesso a eles é regulamentado pelo modelo de controle de acesso que governa o acesso a todos os outros objetos protegíveis no Windows.
ms.assetid: 991d7d94-fae7-406f-b2e3-dee811279366
title: Segurança de arquivo e direitos de acesso
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b161dd78c7585cf6de2781d7339787a22bde95dc
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105764698"
---
# <a name="file-security-and-access-rights"></a><span data-ttu-id="c316b-103">Segurança de arquivo e direitos de acesso</span><span class="sxs-lookup"><span data-stu-id="c316b-103">File Security and Access Rights</span></span>

<span data-ttu-id="c316b-104">Como os arquivos são [objetos protegíveis](/windows/desktop/SecAuthZ/securable-objects), o acesso a eles é regulamentado pelo modelo de controle de acesso que governa o acesso a todos os outros objetos protegíveis no Windows.</span><span class="sxs-lookup"><span data-stu-id="c316b-104">Because files are [securable objects](/windows/desktop/SecAuthZ/securable-objects), access to them is regulated by the access-control model that governs access to all other securable objects in Windows.</span></span> <span data-ttu-id="c316b-105">Para obter uma explicação detalhada desse modelo, consulte [controle de acesso](/windows/desktop/SecAuthZ/access-control).</span><span class="sxs-lookup"><span data-stu-id="c316b-105">For a detailed explanation of this model, see [Access Control](/windows/desktop/SecAuthZ/access-control).</span></span>

<span data-ttu-id="c316b-106">Você pode especificar um [descritor de segurança](/windows/desktop/api/winnt/ns-winnt-security_descriptor) para um arquivo ou diretório ao chamar a função [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea), [**CreateDirectory**](/windows/desktop/api/FileAPI/nf-fileapi-createdirectorya)ou [**CreateDirectoryEx**](/windows/desktop/api/WinBase/nf-winbase-createdirectoryexa) .</span><span class="sxs-lookup"><span data-stu-id="c316b-106">You can specify a [security descriptor](/windows/desktop/api/winnt/ns-winnt-security_descriptor) for a file or directory when you call the [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea), [**CreateDirectory**](/windows/desktop/api/FileAPI/nf-fileapi-createdirectorya), or [**CreateDirectoryEx**](/windows/desktop/api/WinBase/nf-winbase-createdirectoryexa) function.</span></span> <span data-ttu-id="c316b-107">Se você especificar **NULL** para o parâmetro *lpSecurityAttributes* , o arquivo ou diretório obterá um descritor de segurança padrão.</span><span class="sxs-lookup"><span data-stu-id="c316b-107">If you specify **NULL** for the *lpSecurityAttributes* parameter, the file or directory gets a default security descriptor.</span></span> <span data-ttu-id="c316b-108">As listas de controle de acesso (ACL) no descritor de segurança padrão para um arquivo ou diretório são herdadas de seu diretório pai.</span><span class="sxs-lookup"><span data-stu-id="c316b-108">The access control lists (ACL) in the default security descriptor for a file or directory are inherited from its parent directory.</span></span> <span data-ttu-id="c316b-109">Observe que um descritor de segurança padrão é atribuído somente quando um arquivo ou diretório é criado recentemente, e não quando é renomeado ou movido.</span><span class="sxs-lookup"><span data-stu-id="c316b-109">Note that a default security descriptor is assigned only when a file or directory is newly created, and not when it is renamed or moved.</span></span>

<span data-ttu-id="c316b-110">Para recuperar o descritor de segurança de um objeto de arquivo ou de diretório, chame a função [**GetNamedSecurityInfo**](/windows/desktop/api/aclapi/nf-aclapi-getnamedsecurityinfoa) ou [**GetSecurityInfo**](/windows/desktop/api/aclapi/nf-aclapi-getsecurityinfo) .</span><span class="sxs-lookup"><span data-stu-id="c316b-110">To retrieve the security descriptor of a file or directory object, call the [**GetNamedSecurityInfo**](/windows/desktop/api/aclapi/nf-aclapi-getnamedsecurityinfoa) or [**GetSecurityInfo**](/windows/desktop/api/aclapi/nf-aclapi-getsecurityinfo) function.</span></span> <span data-ttu-id="c316b-111">Para alterar o descritor de segurança de um objeto de arquivo ou de diretório, chame a função [**SetNamedSecurityInfo**](/windows/desktop/api/aclapi/nf-aclapi-setnamedsecurityinfoa) ou [**SetSecurityInfo**](/windows/desktop/api/aclapi/nf-aclapi-setsecurityinfo) .</span><span class="sxs-lookup"><span data-stu-id="c316b-111">To change the security descriptor of a file or directory object, call the [**SetNamedSecurityInfo**](/windows/desktop/api/aclapi/nf-aclapi-setnamedsecurityinfoa) or [**SetSecurityInfo**](/windows/desktop/api/aclapi/nf-aclapi-setsecurityinfo) function.</span></span>

<span data-ttu-id="c316b-112">Os direitos de acesso válidos para arquivos e diretórios incluem os direitos de acesso de **exclusão**, **\_ controle de leitura**, **gravação de \_ DAC**, **\_ proprietário de gravação** e **sincronização** [padrão](/windows/desktop/SecAuthZ/standard-access-rights).</span><span class="sxs-lookup"><span data-stu-id="c316b-112">The valid access rights for files and directories include the **DELETE**, **READ\_CONTROL**, **WRITE\_DAC**, **WRITE\_OWNER**, and **SYNCHRONIZE** [standard access rights](/windows/desktop/SecAuthZ/standard-access-rights).</span></span> <span data-ttu-id="c316b-113">A tabela em [**constantes de direitos de acesso**](file-access-rights-constants.md) a arquivos lista os direitos de acesso específicos aos arquivos e diretórios.</span><span class="sxs-lookup"><span data-stu-id="c316b-113">The table in [**File Access Rights Constants**](file-access-rights-constants.md) lists the access rights that are specific to files and directories.</span></span>

<span data-ttu-id="c316b-114">Embora o direito de acesso de **sincronização** seja definido na lista de [direitos de acesso padrão](/windows/desktop/SecAuthZ/standard-access-rights) como a direita para especificar um identificador de arquivo em uma das funções de espera, ao usar operações de e/s de arquivo assíncrono, você deve aguardar o identificador de evento contido em uma estrutura [**sobreposta**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) configurada corretamente em vez de usar o identificador de arquivo com o direito de sincronização de acesso para **sincronizar** .</span><span class="sxs-lookup"><span data-stu-id="c316b-114">Although the **SYNCHRONIZE** access right is defined within the [standard access rights](/windows/desktop/SecAuthZ/standard-access-rights) list as the right to specify a file handle in one of the wait functions, when using asynchronous file I/O operations you should wait on the event handle contained in a properly configured [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure rather than using the file handle with the **SYNCHRONIZE** access right for synchronization.</span></span>

<span data-ttu-id="c316b-115">A seguir estão os [direitos de acesso genéricos](/windows/desktop/SecAuthZ/generic-access-rights) para arquivos e diretórios.</span><span class="sxs-lookup"><span data-stu-id="c316b-115">The following are the [generic access rights](/windows/desktop/SecAuthZ/generic-access-rights) for files and directories.</span></span>



<table>
<thead>
<tr class="header">
<th><span data-ttu-id="c316b-116">Direito de acesso</span><span class="sxs-lookup"><span data-stu-id="c316b-116">Access right</span></span></th>
<th><span data-ttu-id="c316b-117">Descrição</span><span class="sxs-lookup"><span data-stu-id="c316b-117">Description</span></span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span data-ttu-id="c316b-118"><strong>FILE_GENERIC_EXECUTE</strong></span><span class="sxs-lookup"><span data-stu-id="c316b-118"><strong>FILE_GENERIC_EXECUTE</strong></span></span></td>
<td><dl> <span data-ttu-id="c316b-119"><strong>FILE_EXECUTE</strong></span><span class="sxs-lookup"><span data-stu-id="c316b-119"><strong>FILE_EXECUTE</strong></span></span><br /><span data-ttu-id="c316b-120">
<strong>FILE_READ_ATTRIBUTES</strong></span><span class="sxs-lookup"><span data-stu-id="c316b-120">
<strong>FILE_READ_ATTRIBUTES</strong></span></span><br /><span data-ttu-id="c316b-121">
<strong>STANDARD_RIGHTS_EXECUTE</strong></span><span class="sxs-lookup"><span data-stu-id="c316b-121">
<strong>STANDARD_RIGHTS_EXECUTE</strong></span></span><br /><span data-ttu-id="c316b-122">
<strong>SYNCHRONIZE</strong></span><span class="sxs-lookup"><span data-stu-id="c316b-122">
<strong>SYNCHRONIZE</strong></span></span><br />
</dl></td>
</tr>
<tr class="even">
<td><span data-ttu-id="c316b-123"><strong>FILE_GENERIC_READ</strong></span><span class="sxs-lookup"><span data-stu-id="c316b-123"><strong>FILE_GENERIC_READ</strong></span></span></td>
<td><dl> <span data-ttu-id="c316b-124"><strong>FILE_READ_ATTRIBUTES</strong></span><span class="sxs-lookup"><span data-stu-id="c316b-124"><strong>FILE_READ_ATTRIBUTES</strong></span></span><br /><span data-ttu-id="c316b-125">
<strong>FILE_READ_DATA</strong></span><span class="sxs-lookup"><span data-stu-id="c316b-125">
<strong>FILE_READ_DATA</strong></span></span><br /><span data-ttu-id="c316b-126">
<strong>FILE_READ_EA</strong></span><span class="sxs-lookup"><span data-stu-id="c316b-126">
<strong>FILE_READ_EA</strong></span></span><br /><span data-ttu-id="c316b-127">
<strong>STANDARD_RIGHTS_READ</strong></span><span class="sxs-lookup"><span data-stu-id="c316b-127">
<strong>STANDARD_RIGHTS_READ</strong></span></span><br /><span data-ttu-id="c316b-128">
<strong>SYNCHRONIZE</strong></span><span class="sxs-lookup"><span data-stu-id="c316b-128">
<strong>SYNCHRONIZE</strong></span></span><br />
</dl></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="c316b-129"><strong>FILE_GENERIC_WRITE</strong></span><span class="sxs-lookup"><span data-stu-id="c316b-129"><strong>FILE_GENERIC_WRITE</strong></span></span></td>
<td><dl> <span data-ttu-id="c316b-130"><strong>FILE_APPEND_DATA</strong></span><span class="sxs-lookup"><span data-stu-id="c316b-130"><strong>FILE_APPEND_DATA</strong></span></span><br /><span data-ttu-id="c316b-131">
<strong>FILE_WRITE_ATTRIBUTES</strong></span><span class="sxs-lookup"><span data-stu-id="c316b-131">
<strong>FILE_WRITE_ATTRIBUTES</strong></span></span><br /><span data-ttu-id="c316b-132">
<strong>FILE_WRITE_DATA</strong></span><span class="sxs-lookup"><span data-stu-id="c316b-132">
<strong>FILE_WRITE_DATA</strong></span></span><br /><span data-ttu-id="c316b-133">
<strong>FILE_WRITE_EA</strong></span><span class="sxs-lookup"><span data-stu-id="c316b-133">
<strong>FILE_WRITE_EA</strong></span></span><br /><span data-ttu-id="c316b-134">
<strong>STANDARD_RIGHTS_WRITE</strong></span><span class="sxs-lookup"><span data-stu-id="c316b-134">
<strong>STANDARD_RIGHTS_WRITE</strong></span></span><br /><span data-ttu-id="c316b-135">
<strong>SYNCHRONIZE</strong></span><span class="sxs-lookup"><span data-stu-id="c316b-135">
<strong>SYNCHRONIZE</strong></span></span><br />
</dl></td>
</tr>
</tbody>
</table>



 

<span data-ttu-id="c316b-136">O Windows compara os direitos de acesso solicitados e as informações no token de acesso do thread com as informações no descritor de segurança do objeto de diretório ou arquivo.</span><span class="sxs-lookup"><span data-stu-id="c316b-136">Windows compares the requested access rights and the information in the thread's access token with the information in the file or directory object's security descriptor.</span></span> <span data-ttu-id="c316b-137">Se a comparação não proibir a concessão de todos os direitos de acesso solicitados, um identificador para o objeto será retornado ao thread e os direitos de acesso serão concedidos.</span><span class="sxs-lookup"><span data-stu-id="c316b-137">If the comparison does not prohibit all of the requested access rights from being granted, a handle to the object is returned to the thread and the access rights are granted.</span></span> <span data-ttu-id="c316b-138">Para obter mais informações sobre esse processo, consulte [interação entre threads e objetos protegíveis](/windows/desktop/SecAuthZ/interaction-between-threads-and-securable-objects).</span><span class="sxs-lookup"><span data-stu-id="c316b-138">For more information about this process, see [Interaction between Threads and Securable Objects](/windows/desktop/SecAuthZ/interaction-between-threads-and-securable-objects).</span></span>

<span data-ttu-id="c316b-139">Por padrão, a autorização para acesso a um arquivo ou diretório é controlada estritamente pelas ACLs no descritor de segurança associado a esse arquivo ou diretório.</span><span class="sxs-lookup"><span data-stu-id="c316b-139">By default, authorization for access to a file or directory is controlled strictly by the ACLs in the security descriptor associated with that file or directory.</span></span> <span data-ttu-id="c316b-140">Em particular, o descritor de segurança de um diretório pai não é usado para controlar o acesso a qualquer arquivo ou diretório filho.</span><span class="sxs-lookup"><span data-stu-id="c316b-140">In particular, the security descriptor of a parent directory is not used to control access to any child file or directory.</span></span> <span data-ttu-id="c316b-141">O [direito de acesso](/windows/desktop/SecAuthZ/access-rights-and-access-masks) de **\_ atravessamento de arquivo** pode ser imposto removendo o [privilégio](/windows/desktop/SecAuthZ/privileges) de **ignorar a \_ \_ verificação** de desvio dos usuários.</span><span class="sxs-lookup"><span data-stu-id="c316b-141">The **FILE\_TRAVERSE** [access right](/windows/desktop/SecAuthZ/access-rights-and-access-masks) can be enforced by removing the **BYPASS\_TRAVERSE\_CHECKING** [privilege](/windows/desktop/SecAuthZ/privileges) from users.</span></span> <span data-ttu-id="c316b-142">Isso não é recomendado no caso geral, pois muitos programas não manipulam corretamente erros de percurso de diretório.</span><span class="sxs-lookup"><span data-stu-id="c316b-142">This is not recommended in the general case, as many programs do not correctly handle directory traversal errors.</span></span> <span data-ttu-id="c316b-143">O uso principal para o direito de acesso ao **arquivo \_ atravessa** os diretórios é habilitar a conformidade para determinados padrões de POSIX IEEE e ISO quando a interoperabilidade com sistemas UNIX é um requisito.</span><span class="sxs-lookup"><span data-stu-id="c316b-143">The primary use for the **FILE\_TRAVERSE** access right on directories is to enable conformance to certain IEEE and ISO POSIX standards when interoperability with Unix systems is a requirement.</span></span>

<span data-ttu-id="c316b-144">O modelo de segurança do Windows fornece uma maneira para que um diretório filho herde ou seja impedido de herdar, uma ou mais das ACEs no descritor de segurança do diretório pai.</span><span class="sxs-lookup"><span data-stu-id="c316b-144">The Windows security model provides a way for a child directory to inherit, or to be prevented from inheriting, one or more of the ACEs in the parent directory's security descriptor.</span></span> <span data-ttu-id="c316b-145">Cada ACE contém informações que determinam como ela pode ser herdada e se ela terá um efeito no objeto herdado de diretório.</span><span class="sxs-lookup"><span data-stu-id="c316b-145">Each ACE contains information that determines how it can be inherited, and whether it will have an effect on the inheriting directory object.</span></span> <span data-ttu-id="c316b-146">Por exemplo, algumas ACEs herdadas controlam o acesso ao objeto de diretório herdado, e elas são chamadas de *ACEs efetivas*.</span><span class="sxs-lookup"><span data-stu-id="c316b-146">For example, some inherited ACEs control access to the inherited directory object, and these are called *effective ACEs*.</span></span> <span data-ttu-id="c316b-147">Todas as outras ACEs são chamadas *de ACEs somente herdadas*.</span><span class="sxs-lookup"><span data-stu-id="c316b-147">All other ACEs are called *inherit-only ACEs*.</span></span>

<span data-ttu-id="c316b-148">O modelo de segurança do Windows também impõe a herança automática de ACEs para objetos filho de acordo com as [regras de herança da ACE](/windows/desktop/SecAuthZ/ace-inheritance-rules).</span><span class="sxs-lookup"><span data-stu-id="c316b-148">The Windows security model also enforces the automatic inheritance of ACEs to child objects according to the [ACE inheritance rules](/windows/desktop/SecAuthZ/ace-inheritance-rules).</span></span> <span data-ttu-id="c316b-149">Essa herança automática, juntamente com as informações de herança em cada ACE, determina como as restrições de segurança são passadas para baixo na hierarquia de diretório.</span><span class="sxs-lookup"><span data-stu-id="c316b-149">This automatic inheritance, along with the inheritance information in each ACE, determines how security restrictions are passed down the directory hierarchy.</span></span>

<span data-ttu-id="c316b-150">Observe que você não pode usar uma ACE com acesso negado para negar somente a **\_ leitura genérica** ou somente o acesso de **\_ gravação genérico** a um arquivo.</span><span class="sxs-lookup"><span data-stu-id="c316b-150">Note that you cannot use an access-denied ACE to deny only **GENERIC\_READ** or only **GENERIC\_WRITE** access to a file.</span></span> <span data-ttu-id="c316b-151">Isso ocorre porque, para objetos de arquivo, os mapeamentos genéricos **para \_ leitura genérica** ou **\_ gravação genérica** incluem o direito de acesso **sincronizar** .</span><span class="sxs-lookup"><span data-stu-id="c316b-151">This is because for file objects, the generic mappings for both **GENERIC\_READ** or **GENERIC\_WRITE** include the **SYNCHRONIZE** access right.</span></span> <span data-ttu-id="c316b-152">Se uma ACE negar acesso **de \_ gravação genérico** a um confiável e o acesso de **\_ leitura genérico** das solicitações de confiança, a solicitação falhará porque a solicitação inclui implicitamente o acesso de **sincronização** , que é negado implicitamente pela Ace e vice-versa.</span><span class="sxs-lookup"><span data-stu-id="c316b-152">If an ACE denies **GENERIC\_WRITE** access to a trustee, and the trustee requests **GENERIC\_READ** access, the request will fail because the request implicitly includes **SYNCHRONIZE** access which is implicitly denied by the ACE, and vice versa.</span></span> <span data-ttu-id="c316b-153">Em vez de usar ACEs com acesso negado, use ACEs de acesso permitido para permitir explicitamente os direitos de acesso permitidos.</span><span class="sxs-lookup"><span data-stu-id="c316b-153">Instead of using access-denied ACEs, use access-allowed ACEs to explicitly allow the permitted access rights.</span></span>

<span data-ttu-id="c316b-154">Outro meio de gerenciar o acesso a objetos de armazenamento é a criptografia.</span><span class="sxs-lookup"><span data-stu-id="c316b-154">Another means of managing access to storage objects is encryption.</span></span> <span data-ttu-id="c316b-155">A implementação da criptografia do sistema de arquivos no Windows é o sistema de arquivos criptografado, ou EFS.</span><span class="sxs-lookup"><span data-stu-id="c316b-155">The implementation of file system encryption in Windows is the Encrypted File System, or EFS.</span></span> <span data-ttu-id="c316b-156">O EFS criptografa apenas arquivos e não diretórios.</span><span class="sxs-lookup"><span data-stu-id="c316b-156">EFS encrypts only files and not directories.</span></span> <span data-ttu-id="c316b-157">A vantagem da criptografia é que ela fornece proteção adicional aos arquivos que são aplicados na mídia e não ao sistema de arquivos e à arquitetura de controle de acesso padrão do Windows.</span><span class="sxs-lookup"><span data-stu-id="c316b-157">The advantage of encryption is that it provides additional protection to files that is applied on the media and not through the file system and the standard Windows access control architecture.</span></span> <span data-ttu-id="c316b-158">Para obter mais informações sobre criptografia de arquivo, consulte [criptografia de arquivo](file-encryption.md).</span><span class="sxs-lookup"><span data-stu-id="c316b-158">For more information on file encryption, see [File Encryption](file-encryption.md).</span></span>

<span data-ttu-id="c316b-159">Na maioria dos casos, a capacidade de ler e gravar as configurações de segurança de um objeto de arquivo ou diretório é restrita a processos de modo kernel.</span><span class="sxs-lookup"><span data-stu-id="c316b-159">In most cases, the ability to read and write the security settings of a file or directory object is restricted to kernel-mode processes.</span></span> <span data-ttu-id="c316b-160">Claramente, você não desejaria que nenhum processo de usuário pudesse alterar a propriedade ou a restrição de acesso em seu arquivo ou diretório particular.</span><span class="sxs-lookup"><span data-stu-id="c316b-160">Clearly, you would not want any user process to be able to change the ownership or access restriction on your private file or directory.</span></span> <span data-ttu-id="c316b-161">No entanto, um aplicativo de backup não poderá concluir seu trabalho de fazer backup de seu arquivo se as restrições de acesso que você colocou em seu arquivo ou diretório não permitirem que o processo de modo de usuário do aplicativo o leia.</span><span class="sxs-lookup"><span data-stu-id="c316b-161">However, a backup application would not be able to complete its job of backing up your file if the access restrictions you have placed on your file or directory does not allow the application's user-mode process to read it.</span></span> <span data-ttu-id="c316b-162">Os aplicativos de backup devem ser capazes de substituir as configurações de segurança dos objetos de arquivo e de diretório para garantir um backup completo.</span><span class="sxs-lookup"><span data-stu-id="c316b-162">Backup applications must be able to override the security settings of file and directory objects to ensure a complete backup.</span></span> <span data-ttu-id="c316b-163">Da mesma forma, se um aplicativo de backup tentar gravar uma cópia de backup do arquivo na cópia residente em disco e negar explicitamente os privilégios de gravação para o processo do aplicativo de backup, a operação de restauração não poderá ser concluída.</span><span class="sxs-lookup"><span data-stu-id="c316b-163">Similarly, if a backup application attempts to write a backup copy of your file over the disk-resident copy, and you explicitly deny write privileges to the backup application process, the restore operation cannot complete.</span></span> <span data-ttu-id="c316b-164">Nesse caso também, o aplicativo de backup deve ser capaz de substituir as configurações de controle de acesso do arquivo.</span><span class="sxs-lookup"><span data-stu-id="c316b-164">In this case also, the backup application must be able to override the access control settings of your file.</span></span>

<span data-ttu-id="c316b-165">Os privilégios de acesso de nome de **backup do se \_ \_** e se foram criados especificamente para fornecer essa capacidade de fazer backup de aplicativos. **\_ \_**</span><span class="sxs-lookup"><span data-stu-id="c316b-165">The **SE\_BACKUP\_NAME** and **SE\_RESTORE\_NAME** access privileges were specifically created to provide this ability to backup applications.</span></span> <span data-ttu-id="c316b-166">Se esses privilégios tiverem sido concedidos e habilitados no token de acesso do processo do aplicativo de backup, ele poderá chamar [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) para abrir o arquivo ou diretório para backup, especificando o direito de acesso **\_ controle de leitura** padrão como o valor do parâmetro *dwDesiredAccess* .</span><span class="sxs-lookup"><span data-stu-id="c316b-166">If these privileges have been granted and enabled in the access token of the backup application process, it can then call [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) to open your file or directory for backup, specifying the standard **READ\_CONTROL** access right as the value of the *dwDesiredAccess* parameter.</span></span> <span data-ttu-id="c316b-167">No entanto, para identificar o processo de chamada como um processo de backup, a chamada para **CreateFile** deve incluir o sinalizador de semântica de  backup de sinalizador de arquivo no parâmetro dwFlagsAndAttributes. **\_ \_ \_**</span><span class="sxs-lookup"><span data-stu-id="c316b-167">However, to identify the calling process as a backup process, the call to **CreateFile** must include the **FILE\_FLAG\_BACKUP\_SEMANTICS** flag in the *dwFlagsAndAttributes* parameter.</span></span> <span data-ttu-id="c316b-168">A sintaxe completa da chamada de função é a seguinte:</span><span class="sxs-lookup"><span data-stu-id="c316b-168">The full syntax of the function call is the following:</span></span>


```C++
HANDLE hFile = CreateFile( fileName,                   // lpFileName
                           READ_CONTROL,               // dwDesiredAccess
                           0,                          // dwShareMode
                           NULL,                       // lpSecurityAttributes
                           OPEN_EXISTING,              // dwCreationDisposition
                           FILE_FLAG_BACKUP_SEMANTICS, // dwFlagsAndAttributes
                           NULL );                     // hTemplateFile
```



<span data-ttu-id="c316b-169">Isso permitirá que o processo do aplicativo de backup Abra o arquivo e substitua a verificação de segurança padrão.</span><span class="sxs-lookup"><span data-stu-id="c316b-169">This will allow the backup application process to open your file and override the standard security checking.</span></span> <span data-ttu-id="c316b-170">Para restaurar o arquivo, o aplicativo de backup usaria a seguinte sintaxe de chamada de [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) ao abrir o arquivo a ser gravado.</span><span class="sxs-lookup"><span data-stu-id="c316b-170">To restore your file, the backup application would use the following [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) call syntax when opening your file to be written.</span></span>


```C++
HANDLE hFile = CreateFile( fileName,                   // lpFileName
                           WRITE_OWNER | WRITE_DAC,    // dwDesiredAccess
                           0,                          // dwShareMode
                           NULL,                       // lpSecurityAttributes
                           CREATE_ALWAYS,              // dwCreationDisposition
                           FILE_FLAG_BACKUP_SEMANTICS, // dwFlagsAndAttributes
                           NULL );                     // hTemplateFile
```



<span data-ttu-id="c316b-171">Há situações em que um aplicativo de backup deve ser capaz de alterar as configurações de controle de acesso de um arquivo ou diretório.</span><span class="sxs-lookup"><span data-stu-id="c316b-171">There are situations when a backup application must be able to change the access control settings of a file or directory.</span></span> <span data-ttu-id="c316b-172">Um exemplo é quando as configurações de controle de acesso da cópia residente em disco de um arquivo ou diretório são diferentes da cópia de backup.</span><span class="sxs-lookup"><span data-stu-id="c316b-172">An example is when the access control settings of the disk-resident copy of a file or directory is different from the backup copy.</span></span> <span data-ttu-id="c316b-173">Isso aconteceria se essas configurações fossem alteradas após o backup do arquivo ou diretório, ou se ele estava corrompido.</span><span class="sxs-lookup"><span data-stu-id="c316b-173">This would happen if these settings were changed after the file or directory was backed up, or if it was corrupted.</span></span>

<span data-ttu-id="c316b-174">O sinalizador de semântica de backup de sinalizador de arquivo especificado na chamada para [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) fornece a permissão de processo do aplicativo de backup para ler as configurações de controle de acesso do arquivo ou diretório. **\_ \_ \_**</span><span class="sxs-lookup"><span data-stu-id="c316b-174">The **FILE\_FLAG\_BACKUP\_SEMANTICS** flag specified in the call to [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) gives the backup application process permission to read the access-control settings of the file or directory.</span></span> <span data-ttu-id="c316b-175">Com essa permissão, o processo do aplicativo de backup pode chamar [**GetKernelObjectSecurity**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-getkernelobjectsecurity) e [**SetKernelObjectSecurity**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-setkernelobjectsecurity) para leitura e não redefinir as configurações de controle de acesso.</span><span class="sxs-lookup"><span data-stu-id="c316b-175">With this permission, the backup application process can then call [**GetKernelObjectSecurity**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-getkernelobjectsecurity) and [**SetKernelObjectSecurity**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-setkernelobjectsecurity) to read and than reset the access-control settings.</span></span>

<span data-ttu-id="c316b-176">Se um aplicativo de backup precisar ter acesso às [configurações de controle de acesso](/windows/desktop/SecAuthZ/access-control-lists)no nível do sistema, o sinalizador de **\_ \_ segurança do sistema de acesso** deverá ser especificado no valor do parâmetro *dwDesiredAccess* passado para [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea).</span><span class="sxs-lookup"><span data-stu-id="c316b-176">If a backup application must have access to the system-level [access control settings](/windows/desktop/SecAuthZ/access-control-lists), the **ACCESS\_SYSTEM\_SECURITY** flag must be specified in the *dwDesiredAccess* parameter value passed to [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea).</span></span>

<span data-ttu-id="c316b-177">Os aplicativos de backup chamam [**BackupRead**](/windows/desktop/api/winbase/nf-winbase-backupread) para ler os arquivos e diretórios especificados para a operação de restauração e [**BackupWrite**](/windows/desktop/api/winbase/nf-winbase-backupwrite) para escrevê-los.</span><span class="sxs-lookup"><span data-stu-id="c316b-177">Backup applications call [**BackupRead**](/windows/desktop/api/winbase/nf-winbase-backupread) to read the files and directories specified for the restore operation, and [**BackupWrite**](/windows/desktop/api/winbase/nf-winbase-backupwrite) to write them.</span></span>

## <a name="related-topics"></a><span data-ttu-id="c316b-178">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="c316b-178">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="c316b-179">direitos de acesso padrão</span><span class="sxs-lookup"><span data-stu-id="c316b-179">standard access rights</span></span>](/windows/desktop/SecAuthZ/standard-access-rights)
</dt> </dl>

 

 
