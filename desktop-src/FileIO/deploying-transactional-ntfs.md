---
description: Controle de cache em NTFS Transacional.
ms.assetid: 0fd272ee-cf5f-4ba9-b8aa-ff0016f51d4b
title: Implantando o NTFS Transacional
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bd7c44e0ad3b83854e56d18171072a7cb4615d5c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103921336"
---
# <a name="deploying-transactional-ntfs"></a><span data-ttu-id="3e4d8-103">Implantando o NTFS Transacional</span><span class="sxs-lookup"><span data-stu-id="3e4d8-103">Deploying Transactional NTFS</span></span>

<span data-ttu-id="3e4d8-104">O NTFS Transacional (TxF), como a maioria dos mecanismos de transação, depende da ordenação correta de gravações de dados.</span><span class="sxs-lookup"><span data-stu-id="3e4d8-104">Transactional NTFS (TxF), like most transaction mechanisms, depends upon correct ordering of data writes.</span></span> <span data-ttu-id="3e4d8-105">Garantir a ordenação adequada de gravação requer um controle explícito do cache de dados.</span><span class="sxs-lookup"><span data-stu-id="3e4d8-105">Ensuring proper write ordering requires explicit control of data caching.</span></span> <span data-ttu-id="3e4d8-106">Para atender a esse requisito, o TxF requer que as unidades de disco implementem os mecanismos de controle de cache que fazem parte das interfaces de unidade padronizadas, como SCSI, SATA e ATA.</span><span class="sxs-lookup"><span data-stu-id="3e4d8-106">To meet this requirement, TxF requires that disk drives implement the caching control mechanisms that are part of standardized drive interfaces such as SCSI, SATA, and ATA.</span></span>

<span data-ttu-id="3e4d8-107">O mecanismo de controle de cache usado pelo TxF é um sinalizador conhecido como a função de acesso à unidade de força (FUA).</span><span class="sxs-lookup"><span data-stu-id="3e4d8-107">The caching control mechanism used by TxF is a flag known as the Force Unit Access (FUA) function.</span></span> <span data-ttu-id="3e4d8-108">Esse sinalizador especifica que a unidade deve gravar os dados no armazenamento de mídia estável antes da conclusão da sinalização.</span><span class="sxs-lookup"><span data-stu-id="3e4d8-108">This flag specifies that the drive should write the data to stable media storage before signaling complete.</span></span> <span data-ttu-id="3e4d8-109">Em certos pontos críticos em uma transação, o TxF precisa emitir um FUA para garantir que alguns dados de controle necessários para reverter com êxito uma transação não sejam perdidos se ocorrer uma falha de energia.</span><span class="sxs-lookup"><span data-stu-id="3e4d8-109">At certain critical points within a transaction, TxF needs to issue an FUA to ensure that some control data necessary to successfully rollback a transaction is not lost if a power failure occurs.</span></span>

<span data-ttu-id="3e4d8-110">As unidades de disco de classe de servidor (SCSI e Fiber Channel) geralmente dão suporte ao sinalizador FUA.</span><span class="sxs-lookup"><span data-stu-id="3e4d8-110">Server-class disk drives (SCSI and Fiber Channel) generally support the FUA flag.</span></span> <span data-ttu-id="3e4d8-111">A partir do vista, o Windows dá suporte ao sinalizador FUA somente para discos de canal de fibra e SCSI.</span><span class="sxs-lookup"><span data-stu-id="3e4d8-111">Starting in Vista, Windows supports the FUA flag only for SCSI and Fiber Channel disks.</span></span>

<span data-ttu-id="3e4d8-112">Em unidades de mercadoria (ATA/SATA/USB), o TxF tem períodos de vulnerabilidade durante os quais uma falha de energia de unidade pode fazer com que o TxF não consiga reverter corretamente a transação, deixando dados em um estado inconsistente, a menos que o cache de gravação da unidade esteja desabilitado.</span><span class="sxs-lookup"><span data-stu-id="3e4d8-112">On commodity drives (ATA/SATA/USB), TxF has periods of vulnerability during which a drive power failure can result in TxF being unable to correctly rollback the transaction, thus leaving data in an inconsistent state unless the drive's write cache is disabled.</span></span>

<span data-ttu-id="3e4d8-113">Alguns adaptadores de barramento de host (HBAs) e controladores de armazenamento (por exemplo, sistemas RAID) têm caches com suporte de bateria interna.</span><span class="sxs-lookup"><span data-stu-id="3e4d8-113">Some Host Bus Adapters (HBAs) and storage controllers (for example, RAID systems) have built-in battery-backed caches.</span></span> <span data-ttu-id="3e4d8-114">Como esses dispositivos preservam os dados armazenados em cache se ocorrer uma falha de energia, os discos conectados a eles não serão necessários para honrar o sinalizador FUA.</span><span class="sxs-lookup"><span data-stu-id="3e4d8-114">Because these devices preserve cached data if a power fault occurs, any disks connected to them are not required to honor the FUA flag.</span></span> <span data-ttu-id="3e4d8-115">Além disso, um disco cuja fonte de alimentação é protegida por uma fonte de alimentação ininterrupta (UPS) não precisa respeitar o sinalizador FUA.</span><span class="sxs-lookup"><span data-stu-id="3e4d8-115">Further, a disk whose power supply is protected by an uninterruptable power supply (UPS) does not need to honor the FUA flag.</span></span> <span data-ttu-id="3e4d8-116">Isso ocorre porque o no-break manterá a energia longa o suficiente para que o disco libere seu cache para a mídia.</span><span class="sxs-lookup"><span data-stu-id="3e4d8-116">This is because the UPS will maintain power long enough for the disk to flush its cache to the media.</span></span>

<span data-ttu-id="3e4d8-117">Desabilitar o cache de gravação de uma unidade elimina o requisito para que a unidade obedeça o sinalizador FUA.</span><span class="sxs-lookup"><span data-stu-id="3e4d8-117">Disabling a drive's write cache eliminates the requirement for the drive to honor the FUA flag.</span></span> <span data-ttu-id="3e4d8-118">Você pode desabilitar o cache de gravação de um disco emitindo o código de controle de informações do cache do conjunto de discos do IOCTL para o disco. [**\_ \_ \_ \_**](/windows/desktop/api/WinIoCtl/ni-winioctl-ioctl_disk_set_cache_information)</span><span class="sxs-lookup"><span data-stu-id="3e4d8-118">You can disable a disk's write caching by issuing the [**IOCTL\_DISK\_SET\_CACHE\_INFORMATION**](/windows/desktop/api/WinIoCtl/ni-winioctl-ioctl_disk_set_cache_information) control code to the disk.</span></span> <span data-ttu-id="3e4d8-119">O estado do cache de gravação (ligar/desligar) será preservado entre reinicializações do sistema.</span><span class="sxs-lookup"><span data-stu-id="3e4d8-119">The state of the write cache (on/off) will be preserved across system reboots.</span></span> <span data-ttu-id="3e4d8-120">A emissão desse código de controle terá consequências de desempenho muito significativas para todas as e/s emitidas para esse disco, o que provavelmente será uma degradação de desempenho perceptível.</span><span class="sxs-lookup"><span data-stu-id="3e4d8-120">Issuing this control code will have very significant performance consequences for all I/O issued to that disk, which will most likely be a noticeable performance degradation.</span></span> <span data-ttu-id="3e4d8-121">O uso desse código de controle deve ser cuidadosamente considerado antes da implantação.</span><span class="sxs-lookup"><span data-stu-id="3e4d8-121">Use of this control code should be carefully considered prior to deployment.</span></span>

> [!Note]  
> <span data-ttu-id="3e4d8-122">Para que o TxF seja capaz de proteger consistentemente a integridade dos dados por meio de falhas de energia, o sistema deve atender a pelo menos um dos seguintes critérios:</span><span class="sxs-lookup"><span data-stu-id="3e4d8-122">For TxF to be capable of consistently protecting your data's integrity through power faults, the system must satisfy at least one of the following criteria:</span></span>
>
> -   <span data-ttu-id="3e4d8-123">Usar discos de classe de servidor (SCSI, Fiber Channel).</span><span class="sxs-lookup"><span data-stu-id="3e4d8-123">Use server-class disks (SCSI, Fiber Channel).</span></span>
> -   <span data-ttu-id="3e4d8-124">Verifique se os discos estão conectados a um HBA de cache com suporte de bateria.</span><span class="sxs-lookup"><span data-stu-id="3e4d8-124">Make sure the disks are connected to a battery-backed caching HBA.</span></span>
> -   <span data-ttu-id="3e4d8-125">Use um controlador de armazenamento (por exemplo, o sistema RAID) como o dispositivo de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="3e4d8-125">Use a storage controller (for example, RAID system) as the storage device.</span></span>
> -   <span data-ttu-id="3e4d8-126">Verifique se a energia do disco está protegida por um UPS.</span><span class="sxs-lookup"><span data-stu-id="3e4d8-126">Ensure power to the disk is protected by a UPS.</span></span>
> -   <span data-ttu-id="3e4d8-127">Verifique se o recurso de cache de gravação do disco está desabilitado.</span><span class="sxs-lookup"><span data-stu-id="3e4d8-127">Ensure that the disk's write caching feature is disabled.</span></span>

 

 

 



