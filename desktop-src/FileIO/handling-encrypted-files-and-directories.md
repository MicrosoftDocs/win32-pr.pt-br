---
description: Um arquivo marcado como criptografado é criptografado pelo sistema de arquivos NTFS usando o driver de criptografia atual.
ms.assetid: 166bfb8c-b97d-4cc7-bf6b-399837cb8ad0
title: Manipulando arquivos e diretórios criptografados
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2718656a28eb678c10076e228e08a2a95cabd1fc
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "103922629"
---
# <a name="handling-encrypted-files-and-directories"></a><span data-ttu-id="8b082-103">Manipulando arquivos e diretórios criptografados</span><span class="sxs-lookup"><span data-stu-id="8b082-103">Handling Encrypted Files and Directories</span></span>

<span data-ttu-id="8b082-104">Um programador ou usuário pode marcar um diretório ou arquivo como criptografado.</span><span class="sxs-lookup"><span data-stu-id="8b082-104">A programmer or user may mark a directory or file as encrypted.</span></span> <span data-ttu-id="8b082-105">Um arquivo marcado como criptografado é criptografado pelo sistema de arquivos NTFS usando o driver de criptografia atual.</span><span class="sxs-lookup"><span data-stu-id="8b082-105">A file marked encrypted is encrypted by the NTFS file system by using the current encryption driver.</span></span> <span data-ttu-id="8b082-106">Se, em uma data posterior, o arquivo for marcado como não criptografado, ele será descriptografado e deixado em um estado de texto sem formatação (não seguro).</span><span class="sxs-lookup"><span data-stu-id="8b082-106">If at a later date the file is marked as not encrypted, it is decrypted and left in a plain text (unsecured) state.</span></span>

<span data-ttu-id="8b082-107">Os diretórios não são criptografados.</span><span class="sxs-lookup"><span data-stu-id="8b082-107">Directories are not themselves encrypted.</span></span> <span data-ttu-id="8b082-108">Em vez disso, por padrão, em um diretório "criptografado", todos os arquivos novos no diretório são criptografados na criação.</span><span class="sxs-lookup"><span data-stu-id="8b082-108">Rather, by default, in an "encrypted" directory all new files in the directory are encrypted at creation.</span></span> <span data-ttu-id="8b082-109">Um usuário deve alterar especificamente o status de um novo arquivo para descriptografado se o usuário não quiser que o arquivo seja criptografado.</span><span class="sxs-lookup"><span data-stu-id="8b082-109">A user must specifically change the status of a new file to decrypted if the user does not want the file to be encrypted.</span></span> <span data-ttu-id="8b082-110">Um diretório criptografado está visível.</span><span class="sxs-lookup"><span data-stu-id="8b082-110">An encrypted directory is visible.</span></span> <span data-ttu-id="8b082-111">Para tornar um diretório inacessível para outros usuários, use os métodos padrão de controle de acesso.</span><span class="sxs-lookup"><span data-stu-id="8b082-111">To make a directory inaccessible to other users, use the standard methods of access control.</span></span>

<span data-ttu-id="8b082-112">As funções de criptografia não podem ser usadas com a [API de backup](/windows/desktop/Backup/backup).</span><span class="sxs-lookup"><span data-stu-id="8b082-112">The encryption functions cannot be used with the [Backup API](/windows/desktop/Backup/backup).</span></span>

<span data-ttu-id="8b082-113">Para criptografar um novo arquivo, use a função [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) com o sinalizador **\_ \_ criptografado atributo de arquivo** .</span><span class="sxs-lookup"><span data-stu-id="8b082-113">To encrypt a new file, use the [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) function with the **FILE\_ATTRIBUTE\_ENCRYPTED** flag.</span></span> <span data-ttu-id="8b082-114">Para criptografar um arquivo existente, use a função [**EncryptFile**](/windows/desktop/api/WinBase/nf-winbase-encryptfilea) .</span><span class="sxs-lookup"><span data-stu-id="8b082-114">To encrypt an existing file, use the [**EncryptFile**](/windows/desktop/api/WinBase/nf-winbase-encryptfilea) function.</span></span> <span data-ttu-id="8b082-115">Todos os fluxos de dados no arquivo são criptografados.</span><span class="sxs-lookup"><span data-stu-id="8b082-115">All data streams in the file are encrypted.</span></span> <span data-ttu-id="8b082-116">Se o arquivo já estiver criptografado, o **EncryptFile** não fará nada, mas retornará um valor diferente de zero, que indica êxito.</span><span class="sxs-lookup"><span data-stu-id="8b082-116">If the file is already encrypted, **EncryptFile** does nothing but returns a nonzero value, which indicates success.</span></span> <span data-ttu-id="8b082-117">Se o arquivo estiver compactado, o **EncryptFile** descompacta o arquivo antes de criptografá-lo.</span><span class="sxs-lookup"><span data-stu-id="8b082-117">If the file is compressed, **EncryptFile** decompresses the file before encrypting it.</span></span>

<span data-ttu-id="8b082-118">Para descriptografar um arquivo criptografado, use a função [**DecryptFile**](/windows/desktop/api/WinBase/nf-winbase-decryptfilea) .</span><span class="sxs-lookup"><span data-stu-id="8b082-118">To decrypt an encrypted file, use the [**DecryptFile**](/windows/desktop/api/WinBase/nf-winbase-decryptfilea) function.</span></span> <span data-ttu-id="8b082-119">Se o arquivo não estiver criptografado, **descriptografafile** não fará nada, mas retornará um valor diferente de zero indicando êxito.</span><span class="sxs-lookup"><span data-stu-id="8b082-119">If the file is not encrypted, **DecryptFile** does nothing but returns a nonzero value indicating success.</span></span>

<span data-ttu-id="8b082-120">A função [**EncryptionDisable**](/windows/desktop/api/WinEfs/nf-winefs-encryptiondisable) desabilita ou habilita a criptografia do diretório indicado e os arquivos contidos nele.</span><span class="sxs-lookup"><span data-stu-id="8b082-120">The [**EncryptionDisable**](/windows/desktop/api/WinEfs/nf-winefs-encryptiondisable) function disables or enables the encryption of the indicated directory and the files in it.</span></span> <span data-ttu-id="8b082-121">Ele não afeta a criptografia de subdiretórios abaixo do diretório indicado.</span><span class="sxs-lookup"><span data-stu-id="8b082-121">It does not affect the encryption of subdirectories below the indicated directory.</span></span>

<span data-ttu-id="8b082-122">Para recuperar o status de criptografia de um arquivo, use a função [**FileEncryptionStatus**](/windows/desktop/api/WinBase/nf-winbase-fileencryptionstatusa) .</span><span class="sxs-lookup"><span data-stu-id="8b082-122">To retrieve the encryption status of a file, use the [**FileEncryptionStatus**](/windows/desktop/api/WinBase/nf-winbase-fileencryptionstatusa) function.</span></span> <span data-ttu-id="8b082-123">Como alternativa, chame a função [**GetFileAttributes**](/windows/desktop/api/FileAPI/nf-fileapi-getfileattributesa) e examine o **sinalizador \_ \_ criptografado atributo de arquivo** no valor de retorno.</span><span class="sxs-lookup"><span data-stu-id="8b082-123">Alternatively, call the [**GetFileAttributes**](/windows/desktop/api/FileAPI/nf-fileapi-getfileattributesa) function and examine the **FILE\_ATTRIBUTE\_ENCRYPTED** flag in the return value.</span></span>

<span data-ttu-id="8b082-124">[**CopyFile**](/windows/desktop/api/WinBase/nf-winbase-copyfile) e [**CopyFileEx**](/windows/desktop/api/WinBase/nf-winbase-copyfileexa) tentam criptografar o arquivo de destino com as chaves usadas na criptografia do arquivo de origem.</span><span class="sxs-lookup"><span data-stu-id="8b082-124">[**CopyFile**](/windows/desktop/api/WinBase/nf-winbase-copyfile) and [**CopyFileEx**](/windows/desktop/api/WinBase/nf-winbase-copyfileexa) attempt to encrypt the destination file with the keys used in the encryption of the source file.</span></span> <span data-ttu-id="8b082-125">Se isso não puder ser feito, ambas as funções tentarão criptografar o arquivo de destino com chaves padrão.</span><span class="sxs-lookup"><span data-stu-id="8b082-125">If this cannot be done, both functions attempt to encrypt the destination file with default keys.</span></span> <span data-ttu-id="8b082-126">Se ambos os métodos não puderem ser feitos, **CopyFile** e **CopyFileEx** falharão com um erro de **\_ \_ falha na criptografia de erro** .</span><span class="sxs-lookup"><span data-stu-id="8b082-126">If both of these methods cannot be done, **CopyFile** and **CopyFileEx** fail with an **ERROR\_ENCRYPTION\_FAILED** error.</span></span> <span data-ttu-id="8b082-127">Se você quiser que o **CopyFileEx** conclua a operação de cópia mesmo quando o arquivo de destino não puder ser criptografado, inclua o sinalizador de **\_ destino copiar arquivo \_ permitir \_ descriptografado \_** no valor do parâmetro *dwCopyFlags* em sua chamada para **CopyFileEx**.</span><span class="sxs-lookup"><span data-stu-id="8b082-127">If you want **CopyFileEx** to complete the copy operation even when the destination file cannot be encrypted, include the **COPY\_FILE\_ALLOW\_DECRYPTED\_DESTINATION** flag in the value of the *dwCopyFlags* parameter in your call to **CopyFileEx**.</span></span>

 

 
