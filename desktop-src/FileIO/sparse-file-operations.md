---
description: Determine se um sistema de arquivos dá suporte a arquivos esparsos chamando a função GetVolumeInformation.
ms.assetid: a08f6bbc-c139-4396-8964-4aa63285f3f5
title: Operações de arquivo esparsos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2c23d26fc1c52db32ca7674aec2fc487a826e9a6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105756938"
---
# <a name="sparse-file-operations"></a><span data-ttu-id="ac3f7-103">Operações de arquivo esparsos</span><span class="sxs-lookup"><span data-stu-id="ac3f7-103">Sparse File Operations</span></span>

<span data-ttu-id="ac3f7-104">Para determinar se um sistema de arquivos dá suporte a arquivos esparsos, chame a função [**GetVolumeInformation**](/windows/desktop/api/FileAPI/nf-fileapi-getvolumeinformationa) e examine o arquivo que dá suporte ao sinalizador de bits de **\_ \_ \_ arquivos esparsos** retornado por meio do parâmetro *lpFileSystemFlags* .</span><span class="sxs-lookup"><span data-stu-id="ac3f7-104">To determine whether a file system supports sparse files, call the [**GetVolumeInformation**](/windows/desktop/api/FileAPI/nf-fileapi-getvolumeinformationa) function and examine the **FILE\_SUPPORTS\_SPARSE\_FILES** bit flag returned through the *lpFileSystemFlags* parameter.</span></span>

<span data-ttu-id="ac3f7-105">A maioria dos aplicativos não reconhece arquivos esparsos e não criará arquivos esparsos.</span><span class="sxs-lookup"><span data-stu-id="ac3f7-105">Most applications are not aware of sparse files and will not create sparse files.</span></span> <span data-ttu-id="ac3f7-106">O fato de que um aplicativo está lendo um arquivo esparso é transparente para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ac3f7-106">The fact that an application is reading a sparse file is transparent to the application.</span></span> <span data-ttu-id="ac3f7-107">Um aplicativo que reconhece arquivos esparsos deve determinar se seu conjunto de dados é adequado para ser mantido em um arquivo esparso.</span><span class="sxs-lookup"><span data-stu-id="ac3f7-107">An application that is aware of sparse-files should determine whether its data set is suitable to be kept in a sparse file.</span></span> <span data-ttu-id="ac3f7-108">Depois que essa determinação é feita, o aplicativo deve declarar explicitamente um arquivo como esparso, usando o código de controle [**\_ \_ esparso Set fsctl**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_sparse) .</span><span class="sxs-lookup"><span data-stu-id="ac3f7-108">After that determination is made, the application must explicitly declare a file as sparse, using the [**FSCTL\_SET\_SPARSE**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_sparse) control code.</span></span>

<span data-ttu-id="ac3f7-109">Depois que um aplicativo tiver definido um arquivo para ser esparso, o aplicativo poderá usar o código de controle de [**dados do fsctl \_ set \_ zero \_**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_zero_data) para definir uma região do arquivo como zero.</span><span class="sxs-lookup"><span data-stu-id="ac3f7-109">After an application has set a file to be sparse, the application can use the [**FSCTL\_SET\_ZERO\_DATA**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_zero_data) control code to set a region of the file to zero.</span></span> <span data-ttu-id="ac3f7-110">Além disso, o aplicativo pode usar o código de controle de [**\_ \_ \_ intervalos alocados de consulta fsctl**](/windows/win32/api/winioctl/ni-winioctl-fsctl_query_allocated_ranges) para acelerar pesquisas de dados diferentes de zero no arquivo esparso.</span><span class="sxs-lookup"><span data-stu-id="ac3f7-110">In addition, the application can use the [**FSCTL\_QUERY\_ALLOCATED\_RANGES**](/windows/win32/api/winioctl/ni-winioctl-fsctl_query_allocated_ranges) control code to speed searches for nonzero data in the sparse file.</span></span>

<span data-ttu-id="ac3f7-111">Quando você executa uma operação de gravação (com uma função ou operação diferente de [**fsctl \_ define \_ zero \_ Data**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_zero_data)) cujos dados consistem em nada, menos zeros, os zeros serão gravados no disco durante todo o tamanho da gravação.</span><span class="sxs-lookup"><span data-stu-id="ac3f7-111">When you perform a write operation (with a function or operation other than [**FSCTL\_SET\_ZERO\_DATA**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_zero_data)) whose data consists of nothing but zeros, zeros will be written to the disk for the entire length of the write.</span></span> <span data-ttu-id="ac3f7-112">Para zerar um intervalo do arquivo e manter a irgrosseira, use **fsctl \_ definir \_ zero \_ Data**.</span><span class="sxs-lookup"><span data-stu-id="ac3f7-112">To zero out a range of the file and maintain sparseness, use **FSCTL\_SET\_ZERO\_DATA**.</span></span>

<span data-ttu-id="ac3f7-113">Um aplicativo com reconhecimento de uma antigrosseira também pode definir um arquivo existente como esparso.</span><span class="sxs-lookup"><span data-stu-id="ac3f7-113">A sparseness-aware application may also set an existing file to be sparse.</span></span> <span data-ttu-id="ac3f7-114">Se um aplicativo definir um arquivo existente como esparso, ele deverá verificar o arquivo em busca de regiões que contêm zeros e usar [**fsctl \_ definir \_ \_ dados zero**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_zero_data) para redefinir essas regiões, possivelmente desalocando algum armazenamento de disco físico.</span><span class="sxs-lookup"><span data-stu-id="ac3f7-114">If an application sets an existing file to be sparse, it should then scan the file for regions which contain zeros, and use [**FSCTL\_SET\_ZERO\_DATA**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_zero_data) to reset those regions, thereby possibly deallocating some physical disk storage.</span></span> <span data-ttu-id="ac3f7-115">Um aplicativo atualizado para o reconhecimento de arquivos esparsos deve executar essa conversão.</span><span class="sxs-lookup"><span data-stu-id="ac3f7-115">An application upgraded to sparse file awareness should perform this conversion.</span></span>

<span data-ttu-id="ac3f7-116">Quando você executa uma operação de leitura de uma parte zerada de um arquivo esparso, o sistema operacional pode não ler a partir da unidade de disco rígido.</span><span class="sxs-lookup"><span data-stu-id="ac3f7-116">When you perform a read operation from a zeroed-out portion of a sparse file, the operating system may not read from the hard disk drive.</span></span> <span data-ttu-id="ac3f7-117">Em vez disso, o sistema reconhece que a parte do arquivo a ser lido contém zeros e retorna um buffer cheio de zeros sem realmente ler do disco.</span><span class="sxs-lookup"><span data-stu-id="ac3f7-117">Instead, the system recognizes that the portion of the file to be read contains zeros, and it returns a buffer full of zeros without actually reading from the disk.</span></span>

<span data-ttu-id="ac3f7-118">Assim como acontece com qualquer outro arquivo, o sistema pode gravar dados ou ler dados de qualquer posição em um arquivo esparso.</span><span class="sxs-lookup"><span data-stu-id="ac3f7-118">As with any other file, the system can write data to or read data from any position in a sparse file.</span></span> <span data-ttu-id="ac3f7-119">Dados diferentes de zero gravados em uma parte anterior zerada do arquivo podem resultar em alocação de espaço em disco.</span><span class="sxs-lookup"><span data-stu-id="ac3f7-119">Nonzero data being written to a previously zeroed portion of the file may result in allocation of disk space.</span></span> <span data-ttu-id="ac3f7-120">Os zeros que estão sendo gravados em dados diferentes de zero (somente com [**fsctl \_ set \_ zero \_ Data**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_zero_data)) podem resultar em uma desalocação do espaço em disco.</span><span class="sxs-lookup"><span data-stu-id="ac3f7-120">Zeros being written over nonzero data (only with [**FSCTL\_SET\_ZERO\_DATA**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_zero_data)) may result in a deallocation of disk space.</span></span>

> [!Note]  
> <span data-ttu-id="ac3f7-121">Cabe ao aplicativo manter a irgrosseira gravando zeros com [**fsctl \_ define \_ zero \_ Data**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_zero_data).</span><span class="sxs-lookup"><span data-stu-id="ac3f7-121">It is up to the application to maintain sparseness by writing zeros with [**FSCTL\_SET\_ZERO\_DATA**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_zero_data).</span></span>

 

<span data-ttu-id="ac3f7-122">As ferramentas de desfragmentação que lidam com arquivos compactados em sistemas de arquivos NTFS manipulam corretamente arquivos esparsos em volumes do sistema de arquivos NTFS.</span><span class="sxs-lookup"><span data-stu-id="ac3f7-122">Defragmentation tools that handle compressed files on NTFS file systems will correctly handle sparse files on NTFS file system volumes.</span></span> <span data-ttu-id="ac3f7-123">Arquivos esparsos grandes e altamente fragmentados podem exceder a limitação de NTFS em extensões de disco antes que o espaço disponível seja usado.</span><span class="sxs-lookup"><span data-stu-id="ac3f7-123">Large and highly fragmented sparse files can exceed the NTFS limitation on disk extents before available space is used.</span></span> <span data-ttu-id="ac3f7-124">Para obter mais informações, consulte [a extensão de um arquivo pode falhar com o erro "disco cheio", embora o volume tenha espaço livre](https://support.microsoft.com/default.aspx/kb/957180).</span><span class="sxs-lookup"><span data-stu-id="ac3f7-124">For more information, see [Extending a File may fail with "Disk Full" Error even though Volume has Free Space](https://support.microsoft.com/default.aspx/kb/957180).</span></span>

 

 
