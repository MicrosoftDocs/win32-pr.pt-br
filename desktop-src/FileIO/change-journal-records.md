---
description: Como arquivos, diretórios e outros objetos do sistema de arquivos NTFS são adicionados, excluídos e modificados, o sistema de arquivos NTFS insere registros de diário de alterações em fluxos, um para cada volume no computador.
ms.assetid: c41aa3a8-c8d8-4bf2-9bbb-d6a6a556c5e4
title: Alterar registros do diário
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 56580a28c01ca164af4598cb290a37c8e36828f5
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "105785468"
---
# <a name="change-journal-records"></a><span data-ttu-id="a747b-103">Alterar registros do diário</span><span class="sxs-lookup"><span data-stu-id="a747b-103">Change Journal Records</span></span>

<span data-ttu-id="a747b-104">Como arquivos, diretórios e outros objetos do sistema de arquivos NTFS são adicionados, excluídos e modificados, o sistema de arquivos NTFS insere registros de diário de alterações em fluxos, um para cada volume no computador.</span><span class="sxs-lookup"><span data-stu-id="a747b-104">As files, directories, and other NTFS file system objects are added, deleted, and modified, the NTFS file system enters change journal records in streams, one for each volume on the computer.</span></span> <span data-ttu-id="a747b-105">Cada registro indica o tipo de alteração e o objeto alterado.</span><span class="sxs-lookup"><span data-stu-id="a747b-105">Each record indicates the type of change and the object changed.</span></span> <span data-ttu-id="a747b-106">O deslocamento do início do fluxo para um registro específico é chamado de USN (número de sequência de atualização) para o registro específico.</span><span class="sxs-lookup"><span data-stu-id="a747b-106">The offset from the beginning of the stream for a particular record is called the update sequence number (USN) for the particular record.</span></span> <span data-ttu-id="a747b-107">Novos registros são acrescentados ao final do fluxo.</span><span class="sxs-lookup"><span data-stu-id="a747b-107">New records are appended to the end of the stream.</span></span>

<span data-ttu-id="a747b-108">O sistema de arquivos NTFS pode excluir registros antigos para conservar espaço.</span><span class="sxs-lookup"><span data-stu-id="a747b-108">The NTFS file system may delete old records to conserve space.</span></span> <span data-ttu-id="a747b-109">Se os registros necessários tiverem sido excluídos, o serviço de indexação será recuperado ao reindexar o volume, como faz quando não existe um diário de alterações.</span><span class="sxs-lookup"><span data-stu-id="a747b-109">If needed records have been deleted, the indexing service recovers by re-indexing the volume, as it does when no change journal exists.</span></span>

<span data-ttu-id="a747b-110">O diário de alterações registra apenas o fato de uma alteração em um arquivo e o motivo da alteração (por exemplo, operações de gravação, truncamento, ampliação, exclusão e assim por diante).</span><span class="sxs-lookup"><span data-stu-id="a747b-110">The change journal logs only the fact of a change to a file and the reason for the change (for example, write operations, truncation, lengthening, deletion, and so on).</span></span> <span data-ttu-id="a747b-111">Ele não registra informações suficientes para permitir a reversão da alteração.</span><span class="sxs-lookup"><span data-stu-id="a747b-111">It does not record enough information to allow reversing the change.</span></span>

<span data-ttu-id="a747b-112">Além disso, várias alterações no mesmo arquivo podem resultar em apenas um sinalizador de motivo sendo adicionado ao registro atual.</span><span class="sxs-lookup"><span data-stu-id="a747b-112">In addition, multiple changes to the same file may result in only one reason flag being added to the current record.</span></span> <span data-ttu-id="a747b-113">Se o mesmo tipo de alteração ocorrer mais de uma vez, o sistema de arquivos NTFS não gravará um novo registro para as alterações após o primeiro.</span><span class="sxs-lookup"><span data-stu-id="a747b-113">If the same kind of change occurs more than once, the NTFS file system does not write a new record for the changes after the first.</span></span> <span data-ttu-id="a747b-114">Por exemplo, várias operações de gravação sem operações de fechamento e reabertura intermediárias resultam em apenas um registro de alteração com o motivo do sinalizador USN de \_ substituição de dados de motivo \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="a747b-114">For example, several write operations with no intervening close and reopen operations result in only one change record with the reason flag USN\_REASON\_DATA\_OVERWRITE set.</span></span>

<span data-ttu-id="a747b-115">Para ilustrar como o diário de alterações funciona, suponha que um usuário acesse um arquivo na seguinte ordem:</span><span class="sxs-lookup"><span data-stu-id="a747b-115">To illustrate how the change journal works, suppose a user accesses a file in the following order:</span></span>

1.  <span data-ttu-id="a747b-116">Grava no arquivo.</span><span class="sxs-lookup"><span data-stu-id="a747b-116">Writes to the file.</span></span>
2.  <span data-ttu-id="a747b-117">Define o carimbo de data/hora do arquivo.</span><span class="sxs-lookup"><span data-stu-id="a747b-117">Sets the time stamp for the file.</span></span>
3.  <span data-ttu-id="a747b-118">Grava no arquivo.</span><span class="sxs-lookup"><span data-stu-id="a747b-118">Writes to the file.</span></span>
4.  <span data-ttu-id="a747b-119">Trunca o arquivo.</span><span class="sxs-lookup"><span data-stu-id="a747b-119">Truncates the file.</span></span>
5.  <span data-ttu-id="a747b-120">Grava no arquivo.</span><span class="sxs-lookup"><span data-stu-id="a747b-120">Writes to the file.</span></span>
6.  <span data-ttu-id="a747b-121">Fecha o arquivo.</span><span class="sxs-lookup"><span data-stu-id="a747b-121">Closes the file.</span></span>

<span data-ttu-id="a747b-122">Nesse caso, o sistema de arquivos NTFS executa as seguintes ações no diário de alterações (em que \| indica uma operação ou bit de bits).</span><span class="sxs-lookup"><span data-stu-id="a747b-122">In this case, the NTFS file system takes the following actions in the change journal (where \| indicates a bitwise OR operation).</span></span>



| <span data-ttu-id="a747b-123">Evento</span><span class="sxs-lookup"><span data-stu-id="a747b-123">Event</span></span>                                 | <span data-ttu-id="a747b-124">Ação do sistema de arquivos NTFS</span><span class="sxs-lookup"><span data-stu-id="a747b-124">NTFS file system action</span></span>                                                                                                                                                                                                                                                    |
|---------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="a747b-125">Operação de gravação inicial</span><span class="sxs-lookup"><span data-stu-id="a747b-125">Initial write operation</span></span><br/>    | <span data-ttu-id="a747b-126">O sistema de arquivos NTFS grava um novo registro USN com o \_ sinalizador USN motivo da \_ substituição de sinalizadores do \_ motivo.</span><span class="sxs-lookup"><span data-stu-id="a747b-126">The NTFS file system writes a new USN record with the USN\_REASON\_DATA\_OVERWRITE reason flag set.</span></span> <span data-ttu-id="a747b-127">Para obter mais informações sobre possíveis sinalizadores de motivo, consulte a estrutura do [**\_ registro USN**](/windows/desktop/api/WinIoCtl/ns-winioctl-usn_record_v2) .</span><span class="sxs-lookup"><span data-stu-id="a747b-127">For more information on possible reason flags, see the [**USN\_RECORD**](/windows/desktop/api/WinIoCtl/ns-winioctl-usn_record_v2) structure.</span></span><br/>                                                     |
| <span data-ttu-id="a747b-128">Configuração do carimbo de data/hora do arquivo</span><span class="sxs-lookup"><span data-stu-id="a747b-128">Setting of file time stamp</span></span><br/> | <span data-ttu-id="a747b-129">O sistema de arquivos NTFS grava um novo registro de USN com a configuração de sinalizador definição de dados razão do USN motivo do \_ \_ \_ \| USN \_ motivo da alteração das \_ \_ informações básicas \_ .</span><span class="sxs-lookup"><span data-stu-id="a747b-129">The NTFS file system writes a new USN record with the flag setting USN\_REASON\_DATA\_OVERWRITE \| USN\_REASON\_BASIC\_INFO\_CHANGE.</span></span><br/>                                                                                                                            |
| <span data-ttu-id="a747b-130">Segunda operação de gravação</span><span class="sxs-lookup"><span data-stu-id="a747b-130">Second write operation</span></span><br/>     | <span data-ttu-id="a747b-131">O sistema de arquivos NTFS não grava um novo registro USN.</span><span class="sxs-lookup"><span data-stu-id="a747b-131">The NTFS file system does not write a new USN record.</span></span> <span data-ttu-id="a747b-132">Como \_ \_ a substituição de dados do motivo do USN \_ já está definida para o registro existente, nenhuma alteração é feita no registro.</span><span class="sxs-lookup"><span data-stu-id="a747b-132">Because USN\_REASON\_DATA\_OVERWRITE is already set for the existing record, no changes are made to the record.</span></span><br/>                                                                                           |
| <span data-ttu-id="a747b-133">Truncamento de arquivo</span><span class="sxs-lookup"><span data-stu-id="a747b-133">File truncation</span></span><br/>            | <span data-ttu-id="a747b-134">O sistema de arquivos NTFS grava um novo registro de USN com a configuração do sinalizador USN motivo da redefinição de \_ \_ dados do motivo do \_ \| USN \_ razão \_ \_ informações básicas alterar o \_ \| \_ \_ truncamento de dados do motivo do USN \_ .</span><span class="sxs-lookup"><span data-stu-id="a747b-134">The NTFS file system writes a new USN record with the flag setting USN\_REASON\_DATA\_OVERWRITE \| USN\_REASON\_BASIC\_INFO\_CHANGE \| USN\_REASON\_DATA\_TRUNCATION.</span></span><br/>                                                                                           |
| <span data-ttu-id="a747b-135">Terceira operação de gravação</span><span class="sxs-lookup"><span data-stu-id="a747b-135">Third write operation</span></span><br/>      | <span data-ttu-id="a747b-136">O sistema de arquivos NTFS não grava um novo registro USN.</span><span class="sxs-lookup"><span data-stu-id="a747b-136">The NTFS file system does not write a new USN record.</span></span> <span data-ttu-id="a747b-137">Como \_ \_ a substituição de dados do motivo do USN \_ já está definida para o registro existente, nenhuma alteração é feita no registro.</span><span class="sxs-lookup"><span data-stu-id="a747b-137">Because USN\_REASON\_DATA\_OVERWRITE is already set for the existing record, no changes are made to the record.</span></span><br/>                                                                                           |
| <span data-ttu-id="a747b-138">Fechar operação</span><span class="sxs-lookup"><span data-stu-id="a747b-138">Close operation</span></span><br/>            | <span data-ttu-id="a747b-139">Se o usuário que faz alterações for o único usuário do arquivo, o sistema de arquivos NTFS gravará um novo registro de USN com a seguinte configuração de sinalizador: USN motivo de substituição de dados do motivo do USN informações básicas do motivo USN de \_ \_ \_ \| \_ \_ \_ \_ \| \_ \_ truncamento de dados do \_ arredondamento do USN \| \_ motivo \_ fechar.</span><span class="sxs-lookup"><span data-stu-id="a747b-139">If the user making changes is the only user of the file, the NTFS file system writes a new USN record with the following flag setting: USN\_REASON\_DATA\_OVERWRITE \| USN\_REASON\_BASIC\_INFO\_CHANGE \| USN\_REASON\_DATA\_TRUNCATION \| USN\_REASON\_CLOSE.</span></span><br/> |



 

<span data-ttu-id="a747b-140">O diário de alterações acumula uma série de registros entre a primeira abertura e o último fechamento de um arquivo.</span><span class="sxs-lookup"><span data-stu-id="a747b-140">The change journal accumulates a series of records between the first opening and last closing of a file.</span></span> <span data-ttu-id="a747b-141">Cada registro tem um novo sinalizador de motivo definido, indicando que ocorreu um novo tipo de alteração.</span><span class="sxs-lookup"><span data-stu-id="a747b-141">Each record has a new reason flag set, indicating that a new kind of change has occurred.</span></span> <span data-ttu-id="a747b-142">A sequência de registros fornece um histórico parcial do arquivo.</span><span class="sxs-lookup"><span data-stu-id="a747b-142">The sequence of records gives a partial history of the file.</span></span> <span data-ttu-id="a747b-143">O registro final, criado quando o arquivo é fechado, adiciona o sinalizador de fechamento do motivo do USN \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="a747b-143">The final record, created when the file is closed, adds the USN\_REASON\_CLOSE flag.</span></span> <span data-ttu-id="a747b-144">Esse registro representa um resumo das alterações no arquivo, mas ao contrário dos registros anteriores, não fornece nenhuma indicação da ordem das alterações.</span><span class="sxs-lookup"><span data-stu-id="a747b-144">This record represents a summary of changes to the file, but unlike the prior records, gives no indication of the order of the changes.</span></span>

<span data-ttu-id="a747b-145">O próximo usuário a acessar e alterar o arquivo gera um novo registro de USN com um único sinalizador de motivo.</span><span class="sxs-lookup"><span data-stu-id="a747b-145">The next user to access and change the file generates a new USN record with a single reason flag.</span></span>

 

 




