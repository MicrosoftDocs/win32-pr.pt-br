---
description: Um bloqueio oportunista (também chamado de oplock) é um bloqueio colocado por um cliente em um arquivo que reside em um servidor.
ms.assetid: b4c2f5f0-a29b-4598-a49b-da99e93d2991
title: Bloqueios oportunistas
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: faec833caae05bff247a7a3655885b1a967f3435
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103647374"
---
# <a name="opportunistic-locks"></a><span data-ttu-id="4ac44-103">Bloqueios oportunistas</span><span class="sxs-lookup"><span data-stu-id="4ac44-103">Opportunistic Locks</span></span>

<span data-ttu-id="4ac44-104">Um bloqueio oportunista (também chamado de oplock) é um bloqueio colocado por um cliente em um arquivo que reside em um servidor.</span><span class="sxs-lookup"><span data-stu-id="4ac44-104">An opportunistic lock (also called an oplock) is a lock placed by a client on a file residing on a server.</span></span> <span data-ttu-id="4ac44-105">Na maioria dos casos, um cliente solicita um bloqueio oportunista para que possa armazenar dados localmente em cache, reduzindo assim o tráfego de rede e melhorando o tempo de resposta aparente.</span><span class="sxs-lookup"><span data-stu-id="4ac44-105">In most cases, a client requests an opportunistic lock so it can cache data locally, thus reducing network traffic and improving apparent response time.</span></span> <span data-ttu-id="4ac44-106">Os bloqueios oportunistas são usados por redirecionadores de rede em clientes com servidores remotos, bem como por aplicativos cliente em servidores locais.</span><span class="sxs-lookup"><span data-stu-id="4ac44-106">Opportunistic locks are used by network redirectors on clients with remote servers, as well as by client applications on local servers.</span></span>

<span data-ttu-id="4ac44-107">Os bloqueios oportunistas coordenam o cache de dados e a coerência entre clientes e servidores e entre vários clientes.</span><span class="sxs-lookup"><span data-stu-id="4ac44-107">Opportunistic locks coordinate data caching and coherency between clients and servers and among multiple clients.</span></span> <span data-ttu-id="4ac44-108">Os dados que são coerentes são dados que são os mesmos na rede.</span><span class="sxs-lookup"><span data-stu-id="4ac44-108">Data that is coherent is data that is the same across the network.</span></span> <span data-ttu-id="4ac44-109">Em outras palavras, se os dados forem coerentes, os dados no servidor e todos os clientes serão sincronizados.</span><span class="sxs-lookup"><span data-stu-id="4ac44-109">In other words, if data is coherent, data on the server and all the clients is synchronized.</span></span>

<span data-ttu-id="4ac44-110">Os bloqueios oportunistas não são comandos pelo cliente para o servidor.</span><span class="sxs-lookup"><span data-stu-id="4ac44-110">Opportunistic locks are not commands by the client to the server.</span></span> <span data-ttu-id="4ac44-111">Eles são solicitações do cliente para o servidor.</span><span class="sxs-lookup"><span data-stu-id="4ac44-111">They are requests from the client to the server.</span></span> <span data-ttu-id="4ac44-112">Do ponto de vista do cliente, eles são oportunistas.</span><span class="sxs-lookup"><span data-stu-id="4ac44-112">From the point of view of the client, they are opportunistic.</span></span> <span data-ttu-id="4ac44-113">Em outras palavras, o servidor concede esses bloqueios sempre que outros fatores tornam os bloqueios possíveis.</span><span class="sxs-lookup"><span data-stu-id="4ac44-113">In other words, the server grants such locks whenever other factors make the locks possible.</span></span>

<span data-ttu-id="4ac44-114">Quando um aplicativo local solicita acesso a um arquivo remoto, a implementação de bloqueios oportunistas é transparente para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="4ac44-114">When a local application requests access to a remote file, the implementation of opportunistic locks is transparent to the application.</span></span> <span data-ttu-id="4ac44-115">O redirecionador de rede e o servidor envolvidos abrem e fecham os bloqueios oportunistas automaticamente.</span><span class="sxs-lookup"><span data-stu-id="4ac44-115">The network redirector and the server involved open and close the opportunistic locks automatically.</span></span> <span data-ttu-id="4ac44-116">No entanto, os bloqueios oportunistas também podem ser usados quando um aplicativo local solicita acesso a um arquivo local e o acesso por outros aplicativos e processos deve ser delegado para evitar a corrupção do arquivo.</span><span class="sxs-lookup"><span data-stu-id="4ac44-116">However, opportunistic locks can also be used when a local application requests access to a local file, and access by other applications and processes must be delegated to prevent corruption of the file.</span></span> <span data-ttu-id="4ac44-117">Nesse caso, o aplicativo local solicita diretamente um bloqueio oportunista do sistema de arquivos local e armazena o arquivo em cache localmente.</span><span class="sxs-lookup"><span data-stu-id="4ac44-117">In this case, the local application directly requests an opportunistic lock from the local file system and caches the file locally.</span></span> <span data-ttu-id="4ac44-118">Quando usado dessa forma, o bloqueio oportunista é efetivamente um semáforo gerenciado pelo servidor local e é usado principalmente para fins de coerência de dados na notificação de acesso a arquivos e arquivos.</span><span class="sxs-lookup"><span data-stu-id="4ac44-118">When used in this way, the opportunistic lock is effectively a semaphore managed by the local server, and is mainly used for the purposes of data coherency in the file and file access notification.</span></span>

<span data-ttu-id="4ac44-119">Antes de usar bloqueios oportunistas em seu aplicativo, você deve estar familiarizado com os modos de acesso e compartilhamento de arquivos descritos em [criando e abrindo arquivos](creating-and-opening-files.md).</span><span class="sxs-lookup"><span data-stu-id="4ac44-119">Before using opportunistic locks in your application, you should be familiar with the file access and sharing modes described in [Creating and Opening Files](creating-and-opening-files.md).</span></span>

<span data-ttu-id="4ac44-120">O número máximo de bloqueios oportunistas simultâneos que você pode criar é limitado apenas pela quantidade de memória disponível.</span><span class="sxs-lookup"><span data-stu-id="4ac44-120">The maximum number of concurrent opportunistic locks that you can create is limited only by the amount of available memory.</span></span>

<span data-ttu-id="4ac44-121">Os aplicativos locais não devem tentar solicitar bloqueios oportunistas de servidores remotos.</span><span class="sxs-lookup"><span data-stu-id="4ac44-121">Local applications should not attempt to request opportunistic locks from remote servers.</span></span> <span data-ttu-id="4ac44-122">Um erro será retornado por [**DeviceIoControl**](/windows/desktop/api/ioapiset/nf-ioapiset-deviceiocontrol) se for feita uma tentativa de fazer isso.</span><span class="sxs-lookup"><span data-stu-id="4ac44-122">An error will be returned by [**DeviceIoControl**](/windows/desktop/api/ioapiset/nf-ioapiset-deviceiocontrol) if an attempt is made to do this.</span></span>

<span data-ttu-id="4ac44-123">Os bloqueios oportunistas são de uso muito limitado para aplicativos.</span><span class="sxs-lookup"><span data-stu-id="4ac44-123">Opportunistic locks are of very limited use for applications.</span></span> <span data-ttu-id="4ac44-124">O único uso prático é testar um redirecionador de rede ou um manipulador de bloqueio oportunista de servidor.</span><span class="sxs-lookup"><span data-stu-id="4ac44-124">The only practical use is to test a network redirector or a server opportunistic lock handler.</span></span> <span data-ttu-id="4ac44-125">Normalmente, os sistemas de arquivos implementam o suporte a bloqueios oportunistas.</span><span class="sxs-lookup"><span data-stu-id="4ac44-125">Typically, file systems implement support for opportunistic locks.</span></span> <span data-ttu-id="4ac44-126">Os aplicativos geralmente deixam o gerenciamento de bloqueios oportunista para os drivers do sistema de arquivos.</span><span class="sxs-lookup"><span data-stu-id="4ac44-126">Applications generally leave opportunistic lock management to the file system drivers.</span></span> <span data-ttu-id="4ac44-127">Qualquer pessoa que esteja implementando um sistema de arquivos deve usar o [Kit IFS (sistema de arquivos instalável)](https://www.microsoft.com/whdc/devtools/ifskit/default.mspx).</span><span class="sxs-lookup"><span data-stu-id="4ac44-127">Anyone implementing a file system should use the [Installable File System (IFS) Kit](https://www.microsoft.com/whdc/devtools/ifskit/default.mspx).</span></span> <span data-ttu-id="4ac44-128">Qualquer pessoa que esteja desenvolvendo um driver de dispositivo que não seja um sistema de arquivos instalável deve usar o [WDK (Windows Driver Kit)](https://www.microsoft.com/?ref=go).</span><span class="sxs-lookup"><span data-stu-id="4ac44-128">Anyone developing a device driver other than an installable file system should use the [Windows Driver Kit (WDK)](https://www.microsoft.com/?ref=go).</span></span>

<span data-ttu-id="4ac44-129">Os bloqueios oportunistas e as operações associadas são um superconjunto da porção de bloqueio oportunista do protocolo CIFS (Common Internet File System), um rascunho da Internet.</span><span class="sxs-lookup"><span data-stu-id="4ac44-129">Opportunistic locks and the associated operations are a superset of the opportunistic lock portion of the Common Internet File System (CIFS) protocol, an Internet Draft.</span></span> <span data-ttu-id="4ac44-130">O protocolo CIFS é uma versão aprimorada do protocolo SMB.</span><span class="sxs-lookup"><span data-stu-id="4ac44-130">The CIFS protocol is an enhanced version of the Server Message Block (SMB) protocol.</span></span> <span data-ttu-id="4ac44-131">Para obter mais informações, consulte [Microsoft SMB Protocol and CIFS Protocol Overview](microsoft-smb-protocol-and-cifs-protocol-overview.md).</span><span class="sxs-lookup"><span data-stu-id="4ac44-131">For more information, see [Microsoft SMB Protocol and CIFS Protocol Overview](microsoft-smb-protocol-and-cifs-protocol-overview.md).</span></span> <span data-ttu-id="4ac44-132">O rascunho da Internet do CIFS identifica explicitamente que uma implementação de CIFS pode implementar bloqueios oportunistas ao se recusar a concedê-los.</span><span class="sxs-lookup"><span data-stu-id="4ac44-132">The CIFS Internet Draft explicitly identifies that a CIFS implementation may implement opportunistic locks by refusing to grant them.</span></span>

<span data-ttu-id="4ac44-133">Os tópicos a seguir identificam bloqueios oportunistas.</span><span class="sxs-lookup"><span data-stu-id="4ac44-133">The following topics identify opportunistic locks.</span></span>

## <a name="in-this-section"></a><span data-ttu-id="4ac44-134">Nesta seção</span><span class="sxs-lookup"><span data-stu-id="4ac44-134">In this section</span></span>



| <span data-ttu-id="4ac44-135">Tópico</span><span class="sxs-lookup"><span data-stu-id="4ac44-135">Topic</span></span>                                                                                                               | <span data-ttu-id="4ac44-136">Descrição</span><span class="sxs-lookup"><span data-stu-id="4ac44-136">Description</span></span>                                                                                                                                                                                                                                                                                       |
|---------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="4ac44-137">Cache local</span><span class="sxs-lookup"><span data-stu-id="4ac44-137">Local Caching</span></span>](local-caching.md)<br/>                                                                       | <span data-ttu-id="4ac44-138">O *cache local* de dados é uma técnica usada para acelerar o acesso à rede para arquivos de dados.</span><span class="sxs-lookup"><span data-stu-id="4ac44-138">*Local caching* of data is a technique used to speed network access to data files.</span></span> <span data-ttu-id="4ac44-139">Ele envolve o armazenamento em cache de dados em clientes em vez de servidores, quando possível.</span><span class="sxs-lookup"><span data-stu-id="4ac44-139">It involves caching data on clients rather than on servers when possible.</span></span><br/>                                                                                                                           |
| [<span data-ttu-id="4ac44-140">Coerência de dados</span><span class="sxs-lookup"><span data-stu-id="4ac44-140">Data Coherency</span></span>](data-coherency.md)<br/>                                                                     | <span data-ttu-id="4ac44-141">Se os dados forem coerentes, os dados no servidor e todos os clientes serão sincronizados.</span><span class="sxs-lookup"><span data-stu-id="4ac44-141">If data is coherent, data on the server and all the clients is synchronized.</span></span> <span data-ttu-id="4ac44-142">Um tipo de sistema de software que fornece a coerência de dados é um RCS (sistema de controle de revisão).</span><span class="sxs-lookup"><span data-stu-id="4ac44-142">One type of software system that provides data coherency is a revision control system (RCS).</span></span><br/>                                                                                                              |
| [<span data-ttu-id="4ac44-143">Como solicitar um bloqueio oportunista</span><span class="sxs-lookup"><span data-stu-id="4ac44-143">How to Request an Opportunistic Lock</span></span>](how-to-request-an-opportunistic-lock.md)<br/>                         | <span data-ttu-id="4ac44-144">Os bloqueios oportunistas são solicitados abrindo primeiro um arquivo com permissões e sinalizadores apropriados para o aplicativo que abre o arquivo.</span><span class="sxs-lookup"><span data-stu-id="4ac44-144">Opportunistic locks are requested by first opening a file with permissions and flags appropriate to the application opening the file.</span></span> <span data-ttu-id="4ac44-145">Todos os arquivos para os quais os bloqueios oportunistas serão solicitados devem ser abertos para a operação sobreposta (assíncrona).</span><span class="sxs-lookup"><span data-stu-id="4ac44-145">All files for which opportunistic locks will be requested must be opened for overlapped (asynchronous) operation.</span></span><br/>                                |
| [<span data-ttu-id="4ac44-146">Resposta do servidor para abrir solicitações em arquivos bloqueados</span><span class="sxs-lookup"><span data-stu-id="4ac44-146">Server Response to Open Requests on Locked Files</span></span>](server-response-to-open-requests-on-locked-files.md)<br/> | <span data-ttu-id="4ac44-147">Você pode minimizar o impacto que seu aplicativo tem em outros clientes e o impacto que eles têm em seu aplicativo concedendo o máximo de compartilhamento possível, solicitando o nível mínimo de acesso necessário e usando o bloqueio oportunista menos intrusivo adequado para seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="4ac44-147">You can minimize the impact your application has on other clients and the impact they have on your application by granting as much sharing as possible, requesting the minimum access level necessary, and using the least intrusive opportunistic lock suitable for your application.</span></span><br/> |
| [<span data-ttu-id="4ac44-148">Tipos de bloqueios oportunistas</span><span class="sxs-lookup"><span data-stu-id="4ac44-148">Types of Opportunistic Locks</span></span>](types-of-opportunistic-locks.md)<br/>                                         | <span data-ttu-id="4ac44-149">Descreve os bloqueios oportunistas de nível 1, nível 2, lote e filtro.</span><span class="sxs-lookup"><span data-stu-id="4ac44-149">Describes level 1, level 2, batch, and filter opportunistic locks.</span></span><br/>                                                                                                                                                                                                                     |
| [<span data-ttu-id="4ac44-150">Interrompendo bloqueios oportunistas</span><span class="sxs-lookup"><span data-stu-id="4ac44-150">Breaking Opportunistic Locks</span></span>](breaking-opportunistic-locks.md)<br/>                                         | <span data-ttu-id="4ac44-151">Interromper um bloqueio oportunista é o processo de degradação do bloqueio que um cliente tem em um arquivo para que outro cliente possa abrir o arquivo, com ou sem um bloqueio oportunista.</span><span class="sxs-lookup"><span data-stu-id="4ac44-151">Breaking an opportunistic lock is the process of degrading the lock that one client has on a file so that another client can open the file, with or without an opportunistic lock.</span></span><br/>                                                                                                     |
| [<span data-ttu-id="4ac44-152">Exemplos de bloqueio oportunista</span><span class="sxs-lookup"><span data-stu-id="4ac44-152">Opportunistic Lock Examples</span></span>](opportunistic-lock-examples.md)<br/>                                           | <span data-ttu-id="4ac44-153">Diagramas de exibições de tráfego de rede para um bloqueio oportunista de nível 1, um bloqueio oportunista em lote e um bloqueio oportunista de filtro.</span><span class="sxs-lookup"><span data-stu-id="4ac44-153">Diagrams of network-traffic views for a level 1 opportunistic lock, a batch opportunistic lock, and a filter opportunistic lock.</span></span><br/>                                                                                                                                                       |
| [<span data-ttu-id="4ac44-154">Operações de bloqueio oportunista</span><span class="sxs-lookup"><span data-stu-id="4ac44-154">Opportunistic Lock Operations</span></span>](opportunistic-lock-operations.md)<br/>                                       | <span data-ttu-id="4ac44-155">Se um aplicativo solicita bloqueios oportunistas, todos os arquivos para os quais ele solicita bloqueios devem ser abertos para entrada e saída sobrepostas (assíncronas) usando a função [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) com o sinalizador **\_ \_ sobreposto do sinalizador de arquivo** .</span><span class="sxs-lookup"><span data-stu-id="4ac44-155">If an application requests opportunistic locks, all files for which it requests locks must be opened for overlapped (asynchronous) input and output by using the [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) function with the **FILE\_FLAG\_OVERLAPPED** flag.</span></span><br/>                                   |



 

<span data-ttu-id="4ac44-156">Para obter informações adicionais sobre bloqueios oportunistas, consulte o documento de rascunho da Internet do CIFS.</span><span class="sxs-lookup"><span data-stu-id="4ac44-156">For additional information about opportunistic locks, see the CIFS Internet Draft document.</span></span> <span data-ttu-id="4ac44-157">As discrepâncias entre este tópico e o rascunho de Internet atual do CIFS devem ser resolvidas em favor do rascunho da Internet do CIFS.</span><span class="sxs-lookup"><span data-stu-id="4ac44-157">Any discrepancies between this topic and the current CIFS Internet Draft should be resolved in favor of the CIFS Internet Draft.</span></span>

 

