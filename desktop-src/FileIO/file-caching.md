---
description: O Windows armazena em cache os dados de arquivo que são lidos de discos e gravados em discos.
ms.assetid: 0865c741-63e3-4246-ba69-801b02153e4a
title: Cache de arquivo
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1a14fb668af16cfb8a4e42b59b25b73ecefbb7cb
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "103837004"
---
# <a name="file-caching"></a><span data-ttu-id="7ae8b-103">Cache de arquivo</span><span class="sxs-lookup"><span data-stu-id="7ae8b-103">File Caching</span></span>

<span data-ttu-id="7ae8b-104">Por padrão, o Windows armazena em cache os dados de arquivo que são lidos em discos e gravados em discos.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-104">By default, Windows caches file data that is read from disks and written to disks.</span></span> <span data-ttu-id="7ae8b-105">Isso implica que as operações de leitura lêem dados de arquivo de uma área na memória do sistema conhecida como cache de arquivos do sistema, e não do disco físico.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-105">This implies that read operations read file data from an area in system memory known as the system file cache, rather than from the physical disk.</span></span> <span data-ttu-id="7ae8b-106">Do mesmo modo, as operações de gravação gravam dados de arquivo no cache de arquivo do sistema em vez de no disco, e esse tipo de cache é conhecido como um cache de write-back.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-106">Correspondingly, write operations write file data to the system file cache rather than to the disk, and this type of cache is referred to as a write-back cache.</span></span> <span data-ttu-id="7ae8b-107">O armazenamento em cache é gerenciado por um objeto de arquivo.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-107">Caching is managed per file object.</span></span>

<span data-ttu-id="7ae8b-108">O Caching ocorre sob a direção do *Gerenciador de cache*, que opera continuamente enquanto o Windows está em execução.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-108">Caching occurs under the direction of the *cache manager*, which operates continuously while Windows is running.</span></span> <span data-ttu-id="7ae8b-109">Os dados de arquivo no cache de arquivos do sistema são gravados no disco em intervalos determinados pelo sistema operacional e a memória usada anteriormente por esses dados de arquivo é liberada – isso é conhecido como *liberação* do cache.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-109">File data in the system file cache is written to the disk at intervals determined by the operating system, and the memory previously used by that file data is freed—this is referred to as *flushing* the cache.</span></span> <span data-ttu-id="7ae8b-110">A política de atrasar a gravação dos dados no arquivo e armazená-lo no cache até que o cache seja liberado é chamada de gravação lenta e é disparada pelo Gerenciador de cache em um intervalo de tempo determinável.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-110">The policy of delaying the writing of the data to the file and holding it in the cache until the cache is flushed is called lazy writing, and it is triggered by the cache manager at a determinate time interval.</span></span> <span data-ttu-id="7ae8b-111">A hora na qual um bloco de dados de arquivo é liberado tem base em parte na quantidade de tempo que ele ficou armazenado no cache e na quantidade de tempo desde que os dados foram acessados pela última vez em uma operação de leitura.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-111">The time at which a block of file data is flushed is partially based on the amount of time it has been stored in the cache and the amount of time since the data was last accessed in a read operation.</span></span> <span data-ttu-id="7ae8b-112">Isso garante que os dados de arquivos lidos com frequência permaneçam acessíveis no cache de arquivo do sistema pelo máximo de tempo.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-112">This ensures that file data that is frequently read will stay accessible in the system file cache for the maximum amount of time.</span></span>

<span data-ttu-id="7ae8b-113">Esse processo de cache de dados de arquivo é ilustrado na figura a seguir.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-113">This file data caching process is illustrated in the following figure.</span></span>

![processo de cache de dados de arquivo](images/fig3.png)

<span data-ttu-id="7ae8b-115">Conforme descrito pelas setas sólidas na figura anterior, uma região de dados de 256 KB é lida em um "slot" de cache de 256 KB no espaço de endereço do sistema quando ele é solicitado pela primeira vez pelo Gerenciador de cache durante uma operação de leitura de arquivo.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-115">As depicted by the solid arrows in the previous figure, a 256 KB region of data is read into a 256 KB cache "slot" in system address space when it is first requested by the cache manager during a file read operation.</span></span> <span data-ttu-id="7ae8b-116">Em seguida, um processo do modo de usuário copia os dados deste slot em seu próprio espaço de endereço.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-116">A user-mode process then copies the data in this slot to its own address space.</span></span> <span data-ttu-id="7ae8b-117">Após a conclusão do acesso a dados pelo processo, ele grava os dados alterados de volta ao mesmo slot no cache do sistema, como mostrado a seta pontilhada entre o espaço de endereço do processo e o cache do sistema.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-117">When the process has completed its data access, it writes the altered data back to the same slot in the system cache, as shown by the dotted arrow between the process address space and the system cache.</span></span> <span data-ttu-id="7ae8b-118">Quando o Gerenciador de cache determinar que os dados não serão mais necessários por um determinado período de tempo, ele gravará os dados alterados de volta no arquivo no disco, conforme mostrado pela seta pontilhada entre o cache do sistema e o disco.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-118">When the cache manager has determined that the data will no longer be needed for a certain amount of time, it writes the altered data back to the file on the disk, as shown by the dotted arrow between the system cache and the disk.</span></span>

<span data-ttu-id="7ae8b-119">A quantidade de melhorias de desempenho de e/s oferecidas pelo cache de dados de arquivo depende do tamanho do bloco de dados de arquivo que está sendo lido ou gravado.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-119">The amount of I/O performance improvement that file data caching offers depends on the size of the file data block being read or written.</span></span> <span data-ttu-id="7ae8b-120">Quando grandes blocos de dados de arquivo são lidos e gravados, é mais provável que as leituras e gravações de disco sejam necessárias para concluir a operação de e/s.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-120">When large blocks of file data are read and written, it is more likely that disk reads and writes will be necessary to finish the I/O operation.</span></span> <span data-ttu-id="7ae8b-121">O desempenho de e/s será cada vez mais prejudicado à medida que mais desse tipo de operação de e/s ocorrer.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-121">I/O performance will be increasingly impaired as more of this kind of I/O operation occurs.</span></span>

<span data-ttu-id="7ae8b-122">Nessas situações, o Caching pode ser desativado.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-122">In these situations, caching can be turned off.</span></span> <span data-ttu-id="7ae8b-123">Isso é feito no momento em que o arquivo é aberto passando **o \_ sinalizador de arquivo \_ sem \_ buffer** como um valor para o parâmetro *dwFlagsAndAttributes* de [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea).</span><span class="sxs-lookup"><span data-stu-id="7ae8b-123">This is done at the time the file is opened by passing **FILE\_FLAG\_NO\_BUFFERING** as a value for the *dwFlagsAndAttributes* parameter of [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea).</span></span> <span data-ttu-id="7ae8b-124">Quando o Caching está desabilitado, todas as operações de leitura e gravação acessam diretamente o disco físico.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-124">When caching is disabled, all read and write operations directly access the physical disk.</span></span> <span data-ttu-id="7ae8b-125">No entanto, os metadados de arquivo ainda podem ser armazenados em cache.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-125">However, the file metadata may still be cached.</span></span> <span data-ttu-id="7ae8b-126">Para liberar os metadados para o disco, use a função [**FlushFileBuffers**](/windows/desktop/api/FileAPI/nf-fileapi-flushfilebuffers) .</span><span class="sxs-lookup"><span data-stu-id="7ae8b-126">To flush the metadata to disk, use the [**FlushFileBuffers**](/windows/desktop/api/FileAPI/nf-fileapi-flushfilebuffers) function.</span></span>

<span data-ttu-id="7ae8b-127">A frequência na qual a liberação ocorre é uma consideração importante que equilibra o desempenho do sistema com a confiabilidade do sistema.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-127">The frequency at which flushing occurs is an important consideration that balances system performance with system reliability.</span></span> <span data-ttu-id="7ae8b-128">Se o sistema liberar o cache com muita frequência, o número de grandes operações de gravação que liberam incorreções diminuirá significativamente o desempenho do sistema.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-128">If the system flushes the cache too often, the number of large write operations flushing incurs will degrade system performance significantly.</span></span> <span data-ttu-id="7ae8b-129">Se o sistema não for liberado com frequência suficiente, a probabilidade é maior que a memória do sistema será esgotada pelo cache ou uma falha repentina do sistema (como perda de energia para o computador) ocorrerá antes da liberação.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-129">If the system is not flushed often enough, then the likelihood is greater that either system memory will be depleted by the cache, or a sudden system failure (such as a loss of power to the computer) will happen before the flush.</span></span> <span data-ttu-id="7ae8b-130">Na última instância, os dados armazenados em cache serão perdidos.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-130">In the latter instance, the cached data will be lost.</span></span>

<span data-ttu-id="7ae8b-131">Para garantir que a quantidade certa de liberação ocorra, o Gerenciador de cache gera um processo a cada segundo chamado de gravador lento.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-131">To ensure that the right amount of flushing occurs, the cache manager spawns a process every second called a lazy writer.</span></span> <span data-ttu-id="7ae8b-132">O processo de gravador lento enfileira um oitavo das páginas que não foram liberadas recentemente para serem gravadas no disco.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-132">The lazy writer process queues one-eighth of the pages that have not been flushed recently to be written to disk.</span></span> <span data-ttu-id="7ae8b-133">Ele reavalia constantemente a quantidade de dados que estão sendo liberados para o desempenho ideal do sistema e, se mais dados precisarem ser gravados, ele colocará em fila mais dados.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-133">It constantly reevaluates the amount of data being flushed for optimal system performance, and if more data needs to be written it queues more data.</span></span> <span data-ttu-id="7ae8b-134">Os gravadores lentos não liberam arquivos temporários, pois a suposição é que eles serão excluídos pelo aplicativo ou sistema.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-134">Lazy writers do not flush temporary files, because the assumption is that they will be deleted by the application or system.</span></span>

<span data-ttu-id="7ae8b-135">Alguns aplicativos, como software de verificação de vírus, exigem que suas operações de gravação sejam liberadas para o disco imediatamente; O Windows fornece essa capacidade por meio de cache de gravação.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-135">Some applications, such as virus-checking software, require that their write operations be flushed to disk immediately; Windows provides this ability through write-through caching.</span></span> <span data-ttu-id="7ae8b-136">Um processo permite o cache de write-through para uma operação de e/s específica, passando o sinalizador de gravação do sinalizador de arquivo para sua chamada para [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea). **\_ \_ \_**</span><span class="sxs-lookup"><span data-stu-id="7ae8b-136">A process enables write-through caching for a specific I/O operation by passing the **FILE\_FLAG\_WRITE\_THROUGH** flag into its call to [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea).</span></span> <span data-ttu-id="7ae8b-137">Com o cache de gravação habilitado, os dados ainda são gravados no cache, mas o Gerenciador de cache grava os dados imediatamente em disco, em vez de incorrer em um atraso usando o gravador lento.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-137">With write-through caching enabled, data is still written into the cache, but the cache manager writes the data immediately to disk rather than incurring a delay by using the lazy writer.</span></span> <span data-ttu-id="7ae8b-138">Um processo também pode forçar uma liberação de um arquivo que foi aberto chamando a função [**FlushFileBuffers**](/windows/desktop/api/FileAPI/nf-fileapi-flushfilebuffers) .</span><span class="sxs-lookup"><span data-stu-id="7ae8b-138">A process can also force a flush of a file it has opened by calling the [**FlushFileBuffers**](/windows/desktop/api/FileAPI/nf-fileapi-flushfilebuffers) function.</span></span>

<span data-ttu-id="7ae8b-139">Os metadados do sistema de arquivos são sempre armazenados em cache.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-139">File system metadata is always cached.</span></span> <span data-ttu-id="7ae8b-140">Portanto, para armazenar quaisquer alterações de metadados no disco, o arquivo deve ser liberado ou aberto com a **gravação do \_ sinalizador \_ \_ de arquivo**.</span><span class="sxs-lookup"><span data-stu-id="7ae8b-140">Therefore, to store any metadata changes to disk, the file must either be flushed or be opened with **FILE\_FLAG\_WRITE\_THROUGH**.</span></span>

 

 



