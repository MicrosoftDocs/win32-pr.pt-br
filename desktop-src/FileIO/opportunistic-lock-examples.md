---
description: Diagramas de exibições de tráfego de rede para um bloqueio oportunista de nível 1, um bloqueio oportunista em lote e um bloqueio oportunista de filtro.
ms.assetid: 78830113-b18e-40c7-8ec4-8896dbc58030
title: Exemplos de bloqueio oportunista
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ae8b8a0c5b04897ddc2fc8f2e3bdec20f2fdb02d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "104505931"
---
# <a name="opportunistic-lock-examples"></a><span data-ttu-id="6ff65-103">Exemplos de bloqueio oportunista</span><span class="sxs-lookup"><span data-stu-id="6ff65-103">Opportunistic Lock Examples</span></span>

<span data-ttu-id="6ff65-104">Os exemplos a seguir mostram dados e movimentações de mensagem SMB conforme os bloqueios oportunistas são feitos e desfeitos.</span><span class="sxs-lookup"><span data-stu-id="6ff65-104">The following examples show data and SMB message movements as opportunistic locks are made and broken.</span></span> <span data-ttu-id="6ff65-105">Observe que os clientes podem armazenar em cache dados de atributo de arquivo, bem como dados de arquivo.</span><span class="sxs-lookup"><span data-stu-id="6ff65-105">Note that clients can cache file attribute data as well as file data.</span></span>

<span data-ttu-id="6ff65-106">Observe também que esses exemplos se baseiam em situações em que os aplicativos cliente estão solicitando bloqueios oportunistas de servidores remotos.</span><span class="sxs-lookup"><span data-stu-id="6ff65-106">Also note that these examples are based on situations where client applications are requesting opportunistic locks from remote servers.</span></span> <span data-ttu-id="6ff65-107">Esses processos são iniciados automaticamente pelo redirecionador de rede e pelo servidor remoto — não há envolvimento direto pelo aplicativo cliente ou pelos aplicativos.</span><span class="sxs-lookup"><span data-stu-id="6ff65-107">These processes are automatically initiated by the network redirector and the remote server—there is no direct involvement by the client application or applications.</span></span> <span data-ttu-id="6ff65-108">Os processos descritos por esses exemplos podem ser generalizados em situações em que os aplicativos cliente locais estão solicitando diretamente os bloqueios oportunistas do sistema de arquivos local, com exceção de que nenhuma troca de dados pela rede está envolvida.</span><span class="sxs-lookup"><span data-stu-id="6ff65-108">The processes described by these examples can be generalized into situations where local client applications are directly requesting opportunistic locks from the local file system, with the exception that no exchange of data over the network is involved.</span></span>

## <a name="level-1-opportunistic-lock"></a><span data-ttu-id="6ff65-109">Bloqueio oportunista de nível 1</span><span class="sxs-lookup"><span data-stu-id="6ff65-109">Level 1 Opportunistic Lock</span></span>

<span data-ttu-id="6ff65-110">O diagrama a seguir mostra uma exibição de tráfego de rede de um bloqueio oportunista de nível 1 em um arquivo.</span><span class="sxs-lookup"><span data-stu-id="6ff65-110">The following diagram shows a network-traffic view of a level 1 opportunistic lock on a file.</span></span> <span data-ttu-id="6ff65-111">As setas indicam a direção da movimentação de dados, se houver.</span><span class="sxs-lookup"><span data-stu-id="6ff65-111">The arrows indicate the direction of data movement, if any.</span></span>



| <span data-ttu-id="6ff65-112">Evento</span><span class="sxs-lookup"><span data-stu-id="6ff65-112">Event</span></span> | <span data-ttu-id="6ff65-113">Cliente X</span><span class="sxs-lookup"><span data-stu-id="6ff65-113">Client X</span></span>                                          | <span data-ttu-id="6ff65-114">Servidor</span><span class="sxs-lookup"><span data-stu-id="6ff65-114">Server</span></span>                                   | <span data-ttu-id="6ff65-115">Cliente Y</span><span class="sxs-lookup"><span data-stu-id="6ff65-115">Client Y</span></span>                                          |
|-------|---------------------------------------------------|------------------------------------------|---------------------------------------------------|
| <span data-ttu-id="6ff65-116">1</span><span class="sxs-lookup"><span data-stu-id="6ff65-116">1</span></span>     | <span data-ttu-id="6ff65-117">Abre o arquivo, solicita o nível 1 Lock = =></span><span class="sxs-lookup"><span data-stu-id="6ff65-117">Opens file, requests level 1 lock ==></span></span>          |                                          |                                                   |
| <span data-ttu-id="6ff65-118">2</span><span class="sxs-lookup"><span data-stu-id="6ff65-118">2</span></span>     |                                                   | <span data-ttu-id="6ff65-119"><= = concede bloqueio oportunista de nível 1</span><span class="sxs-lookup"><span data-stu-id="6ff65-119"><== Grants level 1 opportunistic lock</span></span> |                                                   |
| <span data-ttu-id="6ff65-120">3</span><span class="sxs-lookup"><span data-stu-id="6ff65-120">3</span></span>     | <span data-ttu-id="6ff65-121">Executa leitura, gravação e outras operações = =></span><span class="sxs-lookup"><span data-stu-id="6ff65-121">Performs read, write, and other operations ==></span></span> |                                          |                                                   |
| <span data-ttu-id="6ff65-122">4</span><span class="sxs-lookup"><span data-stu-id="6ff65-122">4</span></span>     |                                                   |                                          | <span data-ttu-id="6ff65-123"><= = solicitações para abrir o arquivo</span><span class="sxs-lookup"><span data-stu-id="6ff65-123"><== Requests to open file</span></span>                      |
| <span data-ttu-id="6ff65-124">5</span><span class="sxs-lookup"><span data-stu-id="6ff65-124">5</span></span>     |                                                   | <span data-ttu-id="6ff65-125"><= = interrompe o bloqueio oportunista</span><span class="sxs-lookup"><span data-stu-id="6ff65-125"><== Breaks opportunistic lock</span></span>         |                                                   |
| <span data-ttu-id="6ff65-126">6</span><span class="sxs-lookup"><span data-stu-id="6ff65-126">6</span></span>     | <span data-ttu-id="6ff65-127">Descarta dados de leitura antecipada</span><span class="sxs-lookup"><span data-stu-id="6ff65-127">Discards read-ahead data</span></span>                          |                                          |                                                   |
| <span data-ttu-id="6ff65-128">7</span><span class="sxs-lookup"><span data-stu-id="6ff65-128">7</span></span>     | <span data-ttu-id="6ff65-129">Grava dados = =></span><span class="sxs-lookup"><span data-stu-id="6ff65-129">Writes data ==></span></span>                                |                                          |                                                   |
| <span data-ttu-id="6ff65-130">8</span><span class="sxs-lookup"><span data-stu-id="6ff65-130">8</span></span>     | <span data-ttu-id="6ff65-131">Envia mensagem de "fechamento" ou "concluída" = =></span><span class="sxs-lookup"><span data-stu-id="6ff65-131">Sends "close" or "done" message ==></span></span>            |                                          |                                                   |
| <span data-ttu-id="6ff65-132">9</span><span class="sxs-lookup"><span data-stu-id="6ff65-132">9</span></span>     |                                                   | <span data-ttu-id="6ff65-133">Ok operação de abertura = =></span><span class="sxs-lookup"><span data-stu-id="6ff65-133">Okays open operation ==></span></span>              |                                                   |
| <span data-ttu-id="6ff65-134">10</span><span class="sxs-lookup"><span data-stu-id="6ff65-134">10</span></span>    | <span data-ttu-id="6ff65-135">Executa leitura, gravação e outras operações = =></span><span class="sxs-lookup"><span data-stu-id="6ff65-135">Performs read, write, and other operations ==></span></span> |                                          | <span data-ttu-id="6ff65-136"><= = executa operações de leitura, gravação e outras</span><span class="sxs-lookup"><span data-stu-id="6ff65-136"><== Performs read, write, and other operations</span></span> |



 

<span data-ttu-id="6ff65-137">No evento 1, Client X abre um arquivo e, como parte da operação aberta, solicita um bloqueio oportunista de nível 1 no arquivo.</span><span class="sxs-lookup"><span data-stu-id="6ff65-137">In event 1, client X opens a file and as part of the open operation requests a level 1 opportunistic lock on the file.</span></span> <span data-ttu-id="6ff65-138">No evento 2, o servidor concede o bloqueio de nível 1 porque nenhum outro cliente tem o arquivo aberto.</span><span class="sxs-lookup"><span data-stu-id="6ff65-138">In event 2, the server grants the level 1 lock because no other client has the file open.</span></span> <span data-ttu-id="6ff65-139">O cliente continua acessando o arquivo da maneira usual no evento 3.</span><span class="sxs-lookup"><span data-stu-id="6ff65-139">The client proceeds to access the file in the usual manner in event 3.</span></span>

<span data-ttu-id="6ff65-140">No evento 4, o cliente Y tenta abrir o arquivo e solicita um bloqueio oportunista.</span><span class="sxs-lookup"><span data-stu-id="6ff65-140">In event 4, client Y attempts to open the file and requests an opportunistic lock.</span></span> <span data-ttu-id="6ff65-141">O servidor vê que o cliente X tem o arquivo aberto.</span><span class="sxs-lookup"><span data-stu-id="6ff65-141">The server sees that client X has the file open.</span></span> <span data-ttu-id="6ff65-142">O servidor ignora a solicitação de Y enquanto o cliente X libera os dados de gravação e abandona seu cache de leitura para o arquivo.</span><span class="sxs-lookup"><span data-stu-id="6ff65-142">The server ignores Y's request while client X flushes any write data and abandons its read cache for the file.</span></span>

<span data-ttu-id="6ff65-143">O servidor força o X a limpar enviando para X uma mensagem SMB rompendo o bloqueio oportunista, evento 5.</span><span class="sxs-lookup"><span data-stu-id="6ff65-143">The server forces X to clean up by sending to X an SMB message breaking the opportunistic lock, event 5.</span></span> <span data-ttu-id="6ff65-144">O cliente X "silenciosamente" descarta todos os dados de leitura antecipada; em outras palavras, esse processo não gera tráfego de rede.</span><span class="sxs-lookup"><span data-stu-id="6ff65-144">Client X "silently" discards any read-ahead data; in other words, this process generates no network traffic.</span></span> <span data-ttu-id="6ff65-145">No evento 7, o cliente X grava os dados de gravação em cache no servidor.</span><span class="sxs-lookup"><span data-stu-id="6ff65-145">In event 7, client X writes any cached write data to the server.</span></span> <span data-ttu-id="6ff65-146">Quando o cliente X é concluído gravando dados em cache no servidor, o cliente X envia uma mensagem de "fechamento" ou "concluída" para o servidor, evento 8.</span><span class="sxs-lookup"><span data-stu-id="6ff65-146">When client X is done writing cached data to the server, client X sends either a "close" or a "done" message to the server, event 8.</span></span>

<span data-ttu-id="6ff65-147">Depois que o servidor tiver sido notificado de que o cliente X foi concluído, liberando seu cache de gravação para o servidor ou fechou o arquivo, o servidor poderá abrir o arquivo para o cliente Y, no evento 9.</span><span class="sxs-lookup"><span data-stu-id="6ff65-147">After the server has been notified that client X is done flushing its write cache to the server or has closed the file, then the server can open the file for client Y, in event 9.</span></span> <span data-ttu-id="6ff65-148">Como o servidor agora tem dois clientes com o mesmo arquivo aberto, ele concede um bloqueio oportunista a nenhum.</span><span class="sxs-lookup"><span data-stu-id="6ff65-148">Because the server now has two clients with the same file open, it grants an opportunistic lock to neither.</span></span> <span data-ttu-id="6ff65-149">Ambos os clientes passam a ler o arquivo e uma ou nenhuma gravação no arquivo.</span><span class="sxs-lookup"><span data-stu-id="6ff65-149">Both clients proceed to read from the file, and one or neither writes to the file.</span></span>

## <a name="batch-opportunistic-lock"></a><span data-ttu-id="6ff65-150">Bloqueio oportunista em lote</span><span class="sxs-lookup"><span data-stu-id="6ff65-150">Batch Opportunistic Lock</span></span>

<span data-ttu-id="6ff65-151">O diagrama a seguir mostra uma exibição de tráfego de rede de um bloqueio oportunista em lote.</span><span class="sxs-lookup"><span data-stu-id="6ff65-151">The following diagram shows a network-traffic view of a batch opportunistic lock.</span></span> <span data-ttu-id="6ff65-152">As setas indicam a direção da movimentação de dados, se houver.</span><span class="sxs-lookup"><span data-stu-id="6ff65-152">The arrows indicate the direction of data movement, if any.</span></span>



| <span data-ttu-id="6ff65-153">Evento</span><span class="sxs-lookup"><span data-stu-id="6ff65-153">Event</span></span> | <span data-ttu-id="6ff65-154">Cliente X</span><span class="sxs-lookup"><span data-stu-id="6ff65-154">Client X</span></span>                               | <span data-ttu-id="6ff65-155">Servidor</span><span class="sxs-lookup"><span data-stu-id="6ff65-155">Server</span></span>                                 | <span data-ttu-id="6ff65-156">Cliente Y</span><span class="sxs-lookup"><span data-stu-id="6ff65-156">Client Y</span></span>                                          |
|-------|----------------------------------------|----------------------------------------|---------------------------------------------------|
| <span data-ttu-id="6ff65-157">1</span><span class="sxs-lookup"><span data-stu-id="6ff65-157">1</span></span>     | <span data-ttu-id="6ff65-158">Abre o arquivo, solicita bloqueio do lote = =></span><span class="sxs-lookup"><span data-stu-id="6ff65-158">Opens file, requests batch lock ==></span></span> |                                        |                                                   |
| <span data-ttu-id="6ff65-159">2</span><span class="sxs-lookup"><span data-stu-id="6ff65-159">2</span></span>     |                                        | <span data-ttu-id="6ff65-160"><= = concede bloqueio oportunista em lote</span><span class="sxs-lookup"><span data-stu-id="6ff65-160"><== Grants batch opportunistic lock</span></span> |                                                   |
| <span data-ttu-id="6ff65-161">3</span><span class="sxs-lookup"><span data-stu-id="6ff65-161">3</span></span>     | <span data-ttu-id="6ff65-162">Arquivo de leituras = =></span><span class="sxs-lookup"><span data-stu-id="6ff65-162">Reads file ==></span></span>                      |                                        |                                                   |
| <span data-ttu-id="6ff65-163">4</span><span class="sxs-lookup"><span data-stu-id="6ff65-163">4</span></span>     |                                        | <span data-ttu-id="6ff65-164"><= = envia dados</span><span class="sxs-lookup"><span data-stu-id="6ff65-164"><== Sends data</span></span>                      |                                                   |
| <span data-ttu-id="6ff65-165">5</span><span class="sxs-lookup"><span data-stu-id="6ff65-165">5</span></span>     | <span data-ttu-id="6ff65-166">Fecha o arquivo</span><span class="sxs-lookup"><span data-stu-id="6ff65-166">Closes file</span></span>                            |                                        |                                                   |
| <span data-ttu-id="6ff65-167">6</span><span class="sxs-lookup"><span data-stu-id="6ff65-167">6</span></span>     | <span data-ttu-id="6ff65-168">Abre o arquivo</span><span class="sxs-lookup"><span data-stu-id="6ff65-168">Opens file</span></span>                             |                                        |                                                   |
| <span data-ttu-id="6ff65-169">7</span><span class="sxs-lookup"><span data-stu-id="6ff65-169">7</span></span>     | <span data-ttu-id="6ff65-170">Pesquisa dados</span><span class="sxs-lookup"><span data-stu-id="6ff65-170">Searches for data</span></span>                      |                                        |                                                   |
| <span data-ttu-id="6ff65-171">8</span><span class="sxs-lookup"><span data-stu-id="6ff65-171">8</span></span>     | <span data-ttu-id="6ff65-172">Leituras de dados = =></span><span class="sxs-lookup"><span data-stu-id="6ff65-172">Reads data ==></span></span>                      |                                        |                                                   |
| <span data-ttu-id="6ff65-173">9</span><span class="sxs-lookup"><span data-stu-id="6ff65-173">9</span></span>     |                                        | <span data-ttu-id="6ff65-174"><= = envia dados</span><span class="sxs-lookup"><span data-stu-id="6ff65-174"><== Sends data</span></span>                      |                                                   |
| <span data-ttu-id="6ff65-175">10</span><span class="sxs-lookup"><span data-stu-id="6ff65-175">10</span></span>    | <span data-ttu-id="6ff65-176">Fecha o arquivo</span><span class="sxs-lookup"><span data-stu-id="6ff65-176">Closes file</span></span>                            |                                        |                                                   |
| <span data-ttu-id="6ff65-177">11</span><span class="sxs-lookup"><span data-stu-id="6ff65-177">11</span></span>    |                                        |                                        | <span data-ttu-id="6ff65-178"><= = abre o arquivo</span><span class="sxs-lookup"><span data-stu-id="6ff65-178"><== Opens file</span></span>                                 |
| <span data-ttu-id="6ff65-179">12</span><span class="sxs-lookup"><span data-stu-id="6ff65-179">12</span></span>    |                                        | <span data-ttu-id="6ff65-180"><= = interrompe o bloqueio oportunista</span><span class="sxs-lookup"><span data-stu-id="6ff65-180"><== Breaks opportunistic lock</span></span>       |                                                   |
| <span data-ttu-id="6ff65-181">13</span><span class="sxs-lookup"><span data-stu-id="6ff65-181">13</span></span>    | <span data-ttu-id="6ff65-182">Fecha o arquivo = =></span><span class="sxs-lookup"><span data-stu-id="6ff65-182">Closes file ==></span></span>                     |                                        |                                                   |
| <span data-ttu-id="6ff65-183">14</span><span class="sxs-lookup"><span data-stu-id="6ff65-183">14</span></span>    |                                        | <span data-ttu-id="6ff65-184">Ok operação de abertura = =></span><span class="sxs-lookup"><span data-stu-id="6ff65-184">Okays open operation ==></span></span>            |                                                   |
| <span data-ttu-id="6ff65-185">15</span><span class="sxs-lookup"><span data-stu-id="6ff65-185">15</span></span>    |                                        |                                        | <span data-ttu-id="6ff65-186"><= = executa operações de leitura, gravação e outras</span><span class="sxs-lookup"><span data-stu-id="6ff65-186"><== Performs read, write, and other operations</span></span> |



 

<span data-ttu-id="6ff65-187">No bloqueio oportunista em lote, o cliente X abre um arquivo, evento 1, e o servidor concede ao cliente X um bloqueio de lote no evento 2.</span><span class="sxs-lookup"><span data-stu-id="6ff65-187">In the batch opportunistic lock, client X opens a file, event 1, and the server grants client X a batch lock in event 2.</span></span> <span data-ttu-id="6ff65-188">O cliente X tenta ler dados, evento 3, para o qual o servidor responde com os dados, evento 4.</span><span class="sxs-lookup"><span data-stu-id="6ff65-188">Client X attempts to read data, event 3, to which the server responds with data, event 4.</span></span>

<span data-ttu-id="6ff65-189">O evento 5 mostra o bloqueio oportunista em lote no trabalho.</span><span class="sxs-lookup"><span data-stu-id="6ff65-189">Event 5 shows the batch opportunistic lock at work.</span></span> <span data-ttu-id="6ff65-190">O aplicativo no cliente X fecha o arquivo.</span><span class="sxs-lookup"><span data-stu-id="6ff65-190">The application on Client X closes the file.</span></span> <span data-ttu-id="6ff65-191">No entanto, o redirecionador de rede filtra a operação de fechamento e não transmite uma mensagem de fechamento, realizando assim um fechamento "silencioso".</span><span class="sxs-lookup"><span data-stu-id="6ff65-191">However, the network redirector filters out the close operation and does not transmit a close message, thus performing a "silent" close.</span></span> <span data-ttu-id="6ff65-192">O redirecionador de rede pode fazer isso porque o cliente X tem Propriedade exclusiva do arquivo.</span><span class="sxs-lookup"><span data-stu-id="6ff65-192">The network redirector can do this because client X has sole ownership of the file.</span></span> <span data-ttu-id="6ff65-193">Posteriormente, no evento 6, o aplicativo reabrirá o arquivo.</span><span class="sxs-lookup"><span data-stu-id="6ff65-193">Later on, in event 6, the application reopens the file.</span></span> <span data-ttu-id="6ff65-194">Novamente, não há fluxos de dados na rede.</span><span class="sxs-lookup"><span data-stu-id="6ff65-194">Again, no data flows across the network.</span></span> <span data-ttu-id="6ff65-195">No que diz respeito ao servidor, esse cliente teve o arquivo aberto desde o evento 2.</span><span class="sxs-lookup"><span data-stu-id="6ff65-195">As far as the server is concerned, this client has had the file open since event 2.</span></span>

<span data-ttu-id="6ff65-196">Os eventos 7, 8 e 9 mostram o curso normal do tráfego de rede.</span><span class="sxs-lookup"><span data-stu-id="6ff65-196">Events 7, 8, and 9 show the usual course of network traffic.</span></span> <span data-ttu-id="6ff65-197">No evento 10, ocorre outro fechamento silencioso.</span><span class="sxs-lookup"><span data-stu-id="6ff65-197">In event 10, another silent close occurs.</span></span>

<span data-ttu-id="6ff65-198">No evento 11, o cliente Y tenta abrir o arquivo.</span><span class="sxs-lookup"><span data-stu-id="6ff65-198">In event 11, client Y attempts to open the file.</span></span> <span data-ttu-id="6ff65-199">A exibição do arquivo do servidor é que o cliente X o abriu, mesmo que o aplicativo no cliente X o tenha fechado.</span><span class="sxs-lookup"><span data-stu-id="6ff65-199">The server's view of the file is that client X has it open, even though the application on client X has closed it.</span></span> <span data-ttu-id="6ff65-200">Portanto, o servidor envia uma mensagem que quebra o bloqueio oportunista para o cliente X. o cliente X envia agora a mensagem de fechamento pela rede, evento 13.</span><span class="sxs-lookup"><span data-stu-id="6ff65-200">Therefore, the server sends an a message breaking the opportunistic lock to client X. Client X now sends the close message across the network, event 13.</span></span> <span data-ttu-id="6ff65-201">O evento 14 é exibido conforme o servidor abre o arquivo para o cliente Y. O aplicativo no cliente X fechou o arquivo, portanto, ele não faz mais transferências para ou do servidor para esse arquivo.</span><span class="sxs-lookup"><span data-stu-id="6ff65-201">Event 14 follows as the server opens the file for client Y. The application on client X has closed the file, so it does no more transfers to or from the server for that file.</span></span> <span data-ttu-id="6ff65-202">O cliente Y inicia as transferências de dados como de costume no evento 15.</span><span class="sxs-lookup"><span data-stu-id="6ff65-202">Client Y begins data transfers as usual in event 15.</span></span>

<span data-ttu-id="6ff65-203">Entre o tempo, o cliente X recebe o bloqueio no arquivo no evento 2 e o fechamento final no evento 13, todos os dados de arquivo que o cliente armazenou em cache são válidos, apesar das operações de abertura e fechamento do aplicativo intermediário.</span><span class="sxs-lookup"><span data-stu-id="6ff65-203">Between the time client X is granted the lock on the file in event 2 and the final close at event 13, any file data that the client has cached is valid, in spite of the intervening application open and close operations.</span></span> <span data-ttu-id="6ff65-204">No entanto, depois que o bloqueio oportunista for interrompido, os dados armazenados em cache não poderão ser considerados válidos.</span><span class="sxs-lookup"><span data-stu-id="6ff65-204">However, after the opportunistic lock is broken, cached data cannot be considered valid.</span></span>

## <a name="filter-opportunistic-lock"></a><span data-ttu-id="6ff65-205">Filtrar bloqueio oportunista</span><span class="sxs-lookup"><span data-stu-id="6ff65-205">Filter Opportunistic Lock</span></span>

<span data-ttu-id="6ff65-206">O diagrama a seguir mostra uma exibição de tráfego de rede de um bloqueio oportunista de filtro.</span><span class="sxs-lookup"><span data-stu-id="6ff65-206">The following diagram shows a network-traffic view of a filter opportunistic lock.</span></span> <span data-ttu-id="6ff65-207">As setas indicam a direção da movimentação de dados, se houver.</span><span class="sxs-lookup"><span data-stu-id="6ff65-207">The arrows indicate the direction of data movement, if any.</span></span>



| <span data-ttu-id="6ff65-208">Evento</span><span class="sxs-lookup"><span data-stu-id="6ff65-208">Event</span></span> | <span data-ttu-id="6ff65-209">Cliente X</span><span class="sxs-lookup"><span data-stu-id="6ff65-209">Client X</span></span>                                | <span data-ttu-id="6ff65-210">Servidor</span><span class="sxs-lookup"><span data-stu-id="6ff65-210">Server</span></span>                   | <span data-ttu-id="6ff65-211">Cliente Y</span><span class="sxs-lookup"><span data-stu-id="6ff65-211">Client Y</span></span>                    |
|-------|-----------------------------------------|--------------------------|-----------------------------|
| <span data-ttu-id="6ff65-212">1</span><span class="sxs-lookup"><span data-stu-id="6ff65-212">1</span></span>     | <span data-ttu-id="6ff65-213">Abre o arquivo sem direitos de acesso = =></span><span class="sxs-lookup"><span data-stu-id="6ff65-213">Opens file with no access rights ==></span></span> |                          |                             |
| <span data-ttu-id="6ff65-214">2</span><span class="sxs-lookup"><span data-stu-id="6ff65-214">2</span></span>     |                                         | <span data-ttu-id="6ff65-215"><= = abre o arquivo</span><span class="sxs-lookup"><span data-stu-id="6ff65-215"><== Opens the file</span></span>    |                             |
| <span data-ttu-id="6ff65-216">3</span><span class="sxs-lookup"><span data-stu-id="6ff65-216">3</span></span>     | <span data-ttu-id="6ff65-217">Solicita bloqueio de filtro = =></span><span class="sxs-lookup"><span data-stu-id="6ff65-217">Requests filter lock==></span></span>              |                          |                             |
| <span data-ttu-id="6ff65-218">4</span><span class="sxs-lookup"><span data-stu-id="6ff65-218">4</span></span>     |                                         | <span data-ttu-id="6ff65-219"><= = concede bloqueio</span><span class="sxs-lookup"><span data-stu-id="6ff65-219"><== Grants lock</span></span>       |                             |
| <span data-ttu-id="6ff65-220">5</span><span class="sxs-lookup"><span data-stu-id="6ff65-220">5</span></span>     | <span data-ttu-id="6ff65-221">Abre o arquivo para leitura = =></span><span class="sxs-lookup"><span data-stu-id="6ff65-221">Opens file for reading ==></span></span>           |                          |                             |
| <span data-ttu-id="6ff65-222">6</span><span class="sxs-lookup"><span data-stu-id="6ff65-222">6</span></span>     |                                         | <span data-ttu-id="6ff65-223"><= = reabre o arquivo</span><span class="sxs-lookup"><span data-stu-id="6ff65-223"><== Reopens the file</span></span>  |                             |
| <span data-ttu-id="6ff65-224">7</span><span class="sxs-lookup"><span data-stu-id="6ff65-224">7</span></span>     | <span data-ttu-id="6ff65-225">Lê dados usando o identificador de leitura = =></span><span class="sxs-lookup"><span data-stu-id="6ff65-225">Reads data using the read handle ==></span></span> |                          |                             |
| <span data-ttu-id="6ff65-226">8</span><span class="sxs-lookup"><span data-stu-id="6ff65-226">8</span></span>     |                                         | <span data-ttu-id="6ff65-227"><= = envia dados</span><span class="sxs-lookup"><span data-stu-id="6ff65-227"><== Sends data</span></span>        |                             |
| <span data-ttu-id="6ff65-228">9</span><span class="sxs-lookup"><span data-stu-id="6ff65-228">9</span></span>     |                                         | <span data-ttu-id="6ff65-229"><= = envia dados</span><span class="sxs-lookup"><span data-stu-id="6ff65-229"><== Sends data</span></span>        |                             |
| <span data-ttu-id="6ff65-230">10</span><span class="sxs-lookup"><span data-stu-id="6ff65-230">10</span></span>    |                                         | <span data-ttu-id="6ff65-231"><= = envia dados</span><span class="sxs-lookup"><span data-stu-id="6ff65-231"><== Sends data</span></span>        |                             |
| <span data-ttu-id="6ff65-232">11</span><span class="sxs-lookup"><span data-stu-id="6ff65-232">11</span></span>    |                                         |                          | <span data-ttu-id="6ff65-233"><= = abre o arquivo</span><span class="sxs-lookup"><span data-stu-id="6ff65-233"><== Opens the file</span></span>       |
| <span data-ttu-id="6ff65-234">12</span><span class="sxs-lookup"><span data-stu-id="6ff65-234">12</span></span>    |                                         | <span data-ttu-id="6ff65-235">Abre o arquivo = =></span><span class="sxs-lookup"><span data-stu-id="6ff65-235">Opens the file ==></span></span>    |                             |
| <span data-ttu-id="6ff65-236">13</span><span class="sxs-lookup"><span data-stu-id="6ff65-236">13</span></span>    |                                         |                          | <span data-ttu-id="6ff65-237"><= = solicitar bloqueio de filtro</span><span class="sxs-lookup"><span data-stu-id="6ff65-237"><== Requests filter lock</span></span> |
| <span data-ttu-id="6ff65-238">14</span><span class="sxs-lookup"><span data-stu-id="6ff65-238">14</span></span>    |                                         | <span data-ttu-id="6ff65-239">Nega bloqueio de filtro = =></span><span class="sxs-lookup"><span data-stu-id="6ff65-239">Denies filter lock==></span></span> |                             |
| <span data-ttu-id="6ff65-240">15</span><span class="sxs-lookup"><span data-stu-id="6ff65-240">15</span></span>    |                                         |                          | <span data-ttu-id="6ff65-241"><= = lê dados</span><span class="sxs-lookup"><span data-stu-id="6ff65-241"><== Reads data</span></span>           |
| <span data-ttu-id="6ff65-242">16</span><span class="sxs-lookup"><span data-stu-id="6ff65-242">16</span></span>    |                                         | <span data-ttu-id="6ff65-243">Envia dados = =></span><span class="sxs-lookup"><span data-stu-id="6ff65-243">Sends data ==></span></span>        |                             |
| <span data-ttu-id="6ff65-244">17</span><span class="sxs-lookup"><span data-stu-id="6ff65-244">17</span></span>    | <span data-ttu-id="6ff65-245">Leituras (em cache) de dados</span><span class="sxs-lookup"><span data-stu-id="6ff65-245">Reads (cached) data</span></span>                     |                          |                             |
| <span data-ttu-id="6ff65-246">18</span><span class="sxs-lookup"><span data-stu-id="6ff65-246">18</span></span>    | <span data-ttu-id="6ff65-247">Fecha o arquivo = =></span><span class="sxs-lookup"><span data-stu-id="6ff65-247">Closes file ==></span></span>                      |                          |                             |
| <span data-ttu-id="6ff65-248">19</span><span class="sxs-lookup"><span data-stu-id="6ff65-248">19</span></span>    |                                         |                          | <span data-ttu-id="6ff65-249"><= = fecha o arquivo</span><span class="sxs-lookup"><span data-stu-id="6ff65-249"><== Closes file</span></span>          |



 

<span data-ttu-id="6ff65-250">No bloqueio oportunista do filtro, o cliente X abre um arquivo, evento 1, e o servidor responde no evento 2.</span><span class="sxs-lookup"><span data-stu-id="6ff65-250">In the filter opportunistic lock, client X opens a file, event 1, and the server responds in event 2.</span></span> <span data-ttu-id="6ff65-251">Em seguida, o cliente solicita um bloqueio oportunista de filtro no evento 3, seguido pelo servidor que concede o bloqueio oportunista no evento 4.</span><span class="sxs-lookup"><span data-stu-id="6ff65-251">The client then requests a filter opportunistic lock in event 3, followed by the server granting the opportunistic lock in event 4.</span></span> <span data-ttu-id="6ff65-252">O cliente X abre o arquivo novamente para leitura no evento 5, ao qual o servidor responde no evento 6.</span><span class="sxs-lookup"><span data-stu-id="6ff65-252">Client X then opens the file again for reading in event 5, to which the server responds in event 6.</span></span> <span data-ttu-id="6ff65-253">Em seguida, o cliente tenta ler os dados, aos quais o servidor responde com os dados, evento 8.</span><span class="sxs-lookup"><span data-stu-id="6ff65-253">The client then attempts to read data, to which the server responds with data, event 8.</span></span>

<span data-ttu-id="6ff65-254">O evento 9 mostra o bloqueio oportunista do filtro no trabalho.</span><span class="sxs-lookup"><span data-stu-id="6ff65-254">Event 9 shows the filter opportunistic lock at work.</span></span> <span data-ttu-id="6ff65-255">O servidor lê a frente do cliente e envia os dados pela rede, mesmo que o cliente não o tenha solicitado.</span><span class="sxs-lookup"><span data-stu-id="6ff65-255">The server reads ahead of the client and sends the data over the network even though the client has not requested it.</span></span> <span data-ttu-id="6ff65-256">O cliente armazena em cache os dados.</span><span class="sxs-lookup"><span data-stu-id="6ff65-256">The client caches the data.</span></span> <span data-ttu-id="6ff65-257">No evento 10, o servidor também prevê uma solicitação futura de dados e envia outra parte do arquivo para o cliente armazenar em cache.</span><span class="sxs-lookup"><span data-stu-id="6ff65-257">In event 10, the server also anticipates a future request for data and sends another portion of the file for the client to cache.</span></span>

<span data-ttu-id="6ff65-258">No evento 11 e 12, outro cliente, Y, abre o arquivo.</span><span class="sxs-lookup"><span data-stu-id="6ff65-258">In event 11 and 12, another client, Y, opens the file.</span></span> <span data-ttu-id="6ff65-259">O cliente Y também solicita um bloqueio oportunista de filtro.</span><span class="sxs-lookup"><span data-stu-id="6ff65-259">Client Y also requests a filter opportunistic lock.</span></span> <span data-ttu-id="6ff65-260">No evento 14, o servidor o nega.</span><span class="sxs-lookup"><span data-stu-id="6ff65-260">In event 14, the server denies it.</span></span> <span data-ttu-id="6ff65-261">No evento 15, Client Y solicita dados, que o servidor envia no evento 16.</span><span class="sxs-lookup"><span data-stu-id="6ff65-261">In event 15, client Y requests data, which the server sends in event 16.</span></span> <span data-ttu-id="6ff65-262">Nenhum deles afeta o cliente X. A qualquer momento, outro cliente pode abrir esse arquivo para acesso de leitura.</span><span class="sxs-lookup"><span data-stu-id="6ff65-262">None of this affects client X. At any time, another client can open this file for read access.</span></span> <span data-ttu-id="6ff65-263">Nenhum outro cliente afeta o bloqueio de filtro do cliente X.</span><span class="sxs-lookup"><span data-stu-id="6ff65-263">No other client affects client X's filter lock.</span></span>

<span data-ttu-id="6ff65-264">O evento 17 mostra dados de leitura do cliente X.</span><span class="sxs-lookup"><span data-stu-id="6ff65-264">Event 17 shows client X reading data.</span></span> <span data-ttu-id="6ff65-265">No entanto, como o servidor já enviou os dados e o cliente o armazenou em cache, nenhum tráfego cruza a rede.</span><span class="sxs-lookup"><span data-stu-id="6ff65-265">However, because the server has already sent the data and the client has cached it, no traffic crosses the network.</span></span>

<span data-ttu-id="6ff65-266">Neste exemplo, o cliente X nunca tenta ler todos os dados no arquivo, de modo que o Read-Ahead indicado pelos eventos 9 e 10 é "desperdiçado"; ou seja, os dados nunca são realmente usados.</span><span class="sxs-lookup"><span data-stu-id="6ff65-266">In this example, client X never tries to read all the data in the file, so the read-ahead indicated by events 9 and 10 is "wasted"; that is, the data is never actually used.</span></span> <span data-ttu-id="6ff65-267">Essa é uma perda aceitável porque o Read-Ahead tem o SPED up do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="6ff65-267">This is an acceptable loss because the read-ahead has sped up the application.</span></span>

<span data-ttu-id="6ff65-268">No evento 18, o cliente X fecha o arquivo.</span><span class="sxs-lookup"><span data-stu-id="6ff65-268">In event 18, client X closes the file.</span></span> <span data-ttu-id="6ff65-269">O redirecionador de rede do cliente abandona os dados armazenados em cache.</span><span class="sxs-lookup"><span data-stu-id="6ff65-269">The client's network redirector abandons the cached data.</span></span> <span data-ttu-id="6ff65-270">O servidor fecha o arquivo.</span><span class="sxs-lookup"><span data-stu-id="6ff65-270">The server closes the file.</span></span>

 

 



