---
title: Como Pesquisar usando VLV
description: O Active Directory dá suporte a pesquisas de VLV (exibição de lista virtual). Esse estilo de pesquisa é projetado especificamente para grandes conjuntos de resultados e permite que um aplicativo exiba um subconjunto de milhares de entradas sem precisar recuperar cada entrada.
ms.assetid: fea04190-0846-4b62-99f4-7d8fb35fd510
ms.tgt_platform: multiple
keywords:
- Como Pesquisar usando VLV
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8f4a24250c8e54ccb7917f86b193152c62810b93
ms.sourcegitcommit: b0ebdefc3dcd5c04bede94091833aa1015a2f95c
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/21/2020
ms.locfileid: "103917682"
---
# <a name="how-to-search-using-vlv"></a><span data-ttu-id="3a219-105">Como Pesquisar usando VLV</span><span class="sxs-lookup"><span data-stu-id="3a219-105">How to Search Using VLV</span></span>

<span data-ttu-id="3a219-106">O Active Directory dá suporte a pesquisas de VLV (exibição de lista virtual).</span><span class="sxs-lookup"><span data-stu-id="3a219-106">Active Directory supports virtual list view (VLV) searches.</span></span> <span data-ttu-id="3a219-107">Esse estilo de pesquisa é projetado especificamente para grandes conjuntos de resultados e permite que um aplicativo exiba um subconjunto de milhares de entradas sem precisar recuperar cada entrada.</span><span class="sxs-lookup"><span data-stu-id="3a219-107">This style of search is specifically designed for large result sets and enables an application to display a subset of thousands of entries without actually having to retrieve every entry.</span></span>

<span data-ttu-id="3a219-108">Há duas maneiras diferentes de usar uma pesquisa VLV.</span><span class="sxs-lookup"><span data-stu-id="3a219-108">There are two distinct ways that a VLV search can be used.</span></span> <span data-ttu-id="3a219-109">A primeira é recuperar os atributos para entradas específicas com base em um deslocamento numérico.</span><span class="sxs-lookup"><span data-stu-id="3a219-109">The first is to retrieve the attributes for particular entries based on a numeric offset.</span></span> <span data-ttu-id="3a219-110">Esse método é útil ao recuperar resultados da pesquisa em resposta a uma operação de rolagem.</span><span class="sxs-lookup"><span data-stu-id="3a219-110">This method is useful when retrieving search results in response to a scrolling operation.</span></span>

<span data-ttu-id="3a219-111">A segunda maneira de usar pesquisas de VLV é Pesquisar por parte ou por todo um atributo textual e exibir apenas os resultados da pesquisa.</span><span class="sxs-lookup"><span data-stu-id="3a219-111">The second way to use VLV searches is to search for part or all of a textual attribute and only display the results of the search.</span></span> <span data-ttu-id="3a219-112">Um exemplo de uso disso é um catálogo de endereços.</span><span class="sxs-lookup"><span data-stu-id="3a219-112">An example usage of this is an address book.</span></span> <span data-ttu-id="3a219-113">Se o usuário digitar um "s", o aplicativo poderá usar uma pesquisa VLV para pesquisar entradas que tenham um nome comum que comece com "s".</span><span class="sxs-lookup"><span data-stu-id="3a219-113">If the user types an "s", then the application can use a VLV search to search for entries that have a common-name that begins with "s".</span></span> <span data-ttu-id="3a219-114">Se o usuário adicionar um "m" para o "s", o aplicativo poderá usar outra pesquisa de VLV para pesquisar entradas que tenham um nome comum que comece com "SM".</span><span class="sxs-lookup"><span data-stu-id="3a219-114">If the user then adds an "m" to the "s", the application can use another VLV search to search for entries that have a common-name that begins with "sm".</span></span>

<span data-ttu-id="3a219-115">Para executar uma pesquisa de VLV, instrua o ADSI a usar o controle VLV.</span><span class="sxs-lookup"><span data-stu-id="3a219-115">To perform a VLV search, instruct ADSI to use the VLV control.</span></span> <span data-ttu-id="3a219-116">Para fazer isso, chame o método [**IDirectorySearch:: SetSearchPreference**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-setsearchpreference) com uma opção de pesquisa de **\_ \_ VLV SEARCHPREF de anúncios** com um valor **\_ \_ específico de Prov ADSTYPE** .</span><span class="sxs-lookup"><span data-stu-id="3a219-116">To do this, call the [**IDirectorySearch::SetSearchPreference**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-setsearchpreference) method with an **ADS\_SEARCHPREF\_VLV** search option with an **ADSTYPE\_PROV\_SPECIFIC** value.</span></span> <span data-ttu-id="3a219-117">O **valor \_ \_ específico do ADSTYPE Prov** é um ponteiro para uma estrutura [**\_ VLV do ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) que contém dados sobre a pesquisa.</span><span class="sxs-lookup"><span data-stu-id="3a219-117">The **ADSTYPE\_PROV\_SPECIFIC** value is a pointer to an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure that contains data about the search.</span></span> <span data-ttu-id="3a219-118">A função de exemplo [**GetVLVItemCount**](example-code-for-using-a-vlv-search.md) mostra como definir ambas as preferências de pesquisa.</span><span class="sxs-lookup"><span data-stu-id="3a219-118">The [**GetVLVItemCount**](example-code-for-using-a-vlv-search.md) example function shows how to set both of these search preferences.</span></span>

<span data-ttu-id="3a219-119">Todas as pesquisas de VLV devem usar a classificação de resultados do lado do servidor, que é executada pela definição da preferência de pesquisa **SEARCHPREF de anúncios \_ \_ \_** .</span><span class="sxs-lookup"><span data-stu-id="3a219-119">All VLV searches must use server-side result sorting, which is performed by setting the **ADS\_SEARCHPREF\_SORT\_ON** search preference.</span></span> <span data-ttu-id="3a219-120">Para obter mais informações sobre a preferência de pesquisa do **ADS \_ SEARCHPREF \_ \_** , consulte [classificar os resultados da pesquisa com IDirectorySearch](sorting-the-search-results-with-idirectorysearch.md).</span><span class="sxs-lookup"><span data-stu-id="3a219-120">For more information about the **ADS\_SEARCHPREF\_SORT\_ON** search preference, see [Sorting the Search Results with IDirectorySearch](sorting-the-search-results-with-idirectorysearch.md).</span></span>

<span data-ttu-id="3a219-121">Quando uma pesquisa de VLV é executada, uma determinada quantidade de metadados sobre a pesquisa é retornada em uma coluna que é recuperada chamando [**IDirectorySearch:: GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) com o identificador de **\_ \_ resposta VLV ADS** .</span><span class="sxs-lookup"><span data-stu-id="3a219-121">When a VLV search is performed, a certain amount of metadata about the search is returned in a column that is retrieved by calling [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with the **ADS\_VLV\_RESPONSE** identifier.</span></span> <span data-ttu-id="3a219-122">Esses dados estão contidos em uma [**estrutura \_ VLV do ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) .</span><span class="sxs-lookup"><span data-stu-id="3a219-122">This data is contained in an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure.</span></span> <span data-ttu-id="3a219-123">De importância específica são os membros **dwContentCount** e **lpContextID** .</span><span class="sxs-lookup"><span data-stu-id="3a219-123">Of particular importance are the **dwContentCount** and **lpContextID** members.</span></span> <span data-ttu-id="3a219-124">O membro **dwContentCount** conterá o número de resultados que atendem aos critérios de pesquisa VLV.</span><span class="sxs-lookup"><span data-stu-id="3a219-124">The **dwContentCount** member will contain the number of results that meet the VLV search criteria.</span></span> <span data-ttu-id="3a219-125">Esse valor pode ser usado como uma estimativa do número total de itens que seriam retornados para uma pesquisa desse tipo.</span><span class="sxs-lookup"><span data-stu-id="3a219-125">This value can be used as an estimate of the total number of items that would be returned for a search of that type.</span></span> <span data-ttu-id="3a219-126">O membro **lpContextID** contém um valor definido pelo servidor que pode ser passado para a próxima pesquisa para identificar a pesquisa.</span><span class="sxs-lookup"><span data-stu-id="3a219-126">The **lpContextID** member contains a server-defined value that can be passed to the next search to identify the search.</span></span> <span data-ttu-id="3a219-127">O uso do **lpContextID** pode melhorar o desempenho da pesquisa.</span><span class="sxs-lookup"><span data-stu-id="3a219-127">Using the **lpContextID** can enhance the search performance.</span></span> <span data-ttu-id="3a219-128">Lembre-se de que **lpContextID** é um valor definido pelo servidor e seu comprimento está contido no membro **dwContextIDLength** .</span><span class="sxs-lookup"><span data-stu-id="3a219-128">Be aware that the **lpContextID** is a server-defined value and its length is contained in the **dwContextIDLength** member.</span></span> <span data-ttu-id="3a219-129">Esse buffer é liberado quando o método [**IDirectorySearch:: FreeColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-freecolumn) é chamado, portanto, o chamador deve alocar um buffer do tamanho apropriado e copiar e salvar o conteúdo do buffer entre as pesquisas.</span><span class="sxs-lookup"><span data-stu-id="3a219-129">This buffer is freed when the [**IDirectorySearch::FreeColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-freecolumn) method is called, so the caller must allocate a buffer of the appropriate size and copy and save the contents of the buffer between searches.</span></span>

<span data-ttu-id="3a219-130">Para obter mais informações sobre o controle de VLV LDAP, consulte [pesquisando com o controle de VLV LDAP](/previous-versions/windows/desktop/ldap/searching-with-the-ldap-vlv-control).</span><span class="sxs-lookup"><span data-stu-id="3a219-130">For more information about the LDAP VLV control, see [Searching with the LDAP VLV Control](/previous-versions/windows/desktop/ldap/searching-with-the-ldap-vlv-control).</span></span>

<span data-ttu-id="3a219-131">Para obter mais informações, consulte:</span><span class="sxs-lookup"><span data-stu-id="3a219-131">For more information, see:</span></span>

-   <span data-ttu-id="3a219-132">Obtendo o número de itens</span><span class="sxs-lookup"><span data-stu-id="3a219-132">Obtaining the Number of Items</span></span>
-   <span data-ttu-id="3a219-133">Pesquisando por deslocamento</span><span class="sxs-lookup"><span data-stu-id="3a219-133">Searching by Offset</span></span>
-   <span data-ttu-id="3a219-134">Pesquisando por cadeia de caracteres</span><span class="sxs-lookup"><span data-stu-id="3a219-134">Searching by String</span></span>
-   [<span data-ttu-id="3a219-135">Código de exemplo para usar uma pesquisa VLV</span><span class="sxs-lookup"><span data-stu-id="3a219-135">Example Code for Using a VLV Search</span></span>](example-code-for-using-a-vlv-search.md)

## <a name="obtaining-the-number-of-items"></a><span data-ttu-id="3a219-136">Obtendo o número de itens</span><span class="sxs-lookup"><span data-stu-id="3a219-136">Obtaining the Number of Items</span></span>

<span data-ttu-id="3a219-137">**Para obter uma estimativa do número de itens que serão retornados para uma pesquisa específica, execute as etapas a seguir.**</span><span class="sxs-lookup"><span data-stu-id="3a219-137">**To obtain an estimate of the number of items that will be returned for a particular search, perform the following steps.**</span></span>

1.  <span data-ttu-id="3a219-138">Preencha uma [**estrutura \_ VLV do ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) com todos os valores zero ou **nulos** .</span><span class="sxs-lookup"><span data-stu-id="3a219-138">Fill an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure with all zero or **NULL** values.</span></span>
2.  <span data-ttu-id="3a219-139">Preencha uma [**\_ \_ informação de SEARCHPREF do ADS**](/windows/desktop/api/Iads/ns-iads-ads_searchpref_info) com os valores a seguir.</span><span class="sxs-lookup"><span data-stu-id="3a219-139">Fill an [**ADS\_SEARCHPREF\_INFO**](/windows/desktop/api/Iads/ns-iads-ads_searchpref_info) with the following values.</span></span>

    -   <span data-ttu-id="3a219-140">Defina o membro **dwSearchPref** como **ADS \_ SEARCHPREF \_ VLV**.</span><span class="sxs-lookup"><span data-stu-id="3a219-140">Set the **dwSearchPref** member to **ADS\_SEARCHPREF\_VLV**.</span></span>
    -   <span data-ttu-id="3a219-141">Defina o membro **vValue. dwType** como **ADSTYPE \_ Prov \_ específico**.</span><span class="sxs-lookup"><span data-stu-id="3a219-141">Set the **vValue.dwType** member to **ADSTYPE\_PROV\_SPECIFIC**.</span></span>
    -   <span data-ttu-id="3a219-142">Defina o membro **vValue. ProviderSpecific. dwLength** como o tamanho da estrutura [**\_ VLV do ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) .</span><span class="sxs-lookup"><span data-stu-id="3a219-142">Set the **vValue.ProviderSpecific.dwLength** member to the size of the [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure.</span></span>
    -   <span data-ttu-id="3a219-143">Defina o membro **vValue. ProviderSpecific. lpValue** como o endereço da estrutura [**\_ VLV do ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) da etapa 1.</span><span class="sxs-lookup"><span data-stu-id="3a219-143">Set the **vValue.ProviderSpecific.lpValue** member to the address of the [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure from Step 1.</span></span>

3.  <span data-ttu-id="3a219-144">Preencha uma estrutura de [**\_ SORTKEY do ADS**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) , conforme mostrado na [classificação dos resultados da pesquisa com IDirectorySearch](sorting-the-search-results-with-idirectorysearch.md) para classificar o atributo desejado.</span><span class="sxs-lookup"><span data-stu-id="3a219-144">Fill an [**ADS\_SORTKEY**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) structure as shown in [Sorting the Search Results with IDirectorySearch](sorting-the-search-results-with-idirectorysearch.md) to sort on the desired attribute.</span></span>
4.  <span data-ttu-id="3a219-145">Preencha outras [**\_ \_ informações de SEARCHPREF do ADS**](/windows/desktop/api/Iads/ns-iads-ads_searchpref_info) para adicionar a estrutura de [**\_ SORTKEY do ADS**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) às preferências de pesquisa, conforme mostrado em [classificando os resultados da pesquisa com IDirectorySearch](sorting-the-search-results-with-idirectorysearch.md).</span><span class="sxs-lookup"><span data-stu-id="3a219-145">Fill another [**ADS\_SEARCHPREF\_INFO**](/windows/desktop/api/Iads/ns-iads-ads_searchpref_info) to add the [**ADS\_SORTKEY**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) structure to the search preferences as shown in [Sorting the Search Results with IDirectorySearch](sorting-the-search-results-with-idirectorysearch.md).</span></span>
5.  <span data-ttu-id="3a219-146">Adicione outras preferências de pesquisa desejadas e chame [**IDirectorySearch:: SetSearchPreference**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-setsearchpreference) para definir as preferências de pesquisa.</span><span class="sxs-lookup"><span data-stu-id="3a219-146">Add any other desired search preferences and call [**IDirectorySearch::SetSearchPreference**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-setsearchpreference) to set the search preferences.</span></span>
6.  <span data-ttu-id="3a219-147">Execute a pesquisa com [**IDirectorySearch:: ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch).</span><span class="sxs-lookup"><span data-stu-id="3a219-147">Perform the search with [**IDirectorySearch::ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch).</span></span>
7.  <span data-ttu-id="3a219-148">Obtenha a primeira linha de resultados chamando [**IDirectorySearch:: GetFirstRow**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow).</span><span class="sxs-lookup"><span data-stu-id="3a219-148">Get the first row of results by calling [**IDirectorySearch::GetFirstRow**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow).</span></span>
8.  <span data-ttu-id="3a219-149">Chame [**IDirectorySearch:: GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) com **a \_ \_ resposta VLV do ADS** para obter os metadados de pesquisa VLV.</span><span class="sxs-lookup"><span data-stu-id="3a219-149">Call [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with **ADS\_VLV\_RESPONSE** to obtain the VLV search metadata.</span></span>
9.  <span data-ttu-id="3a219-150">Converta o **pADsValues->ProviderSpecific. lpValue** da estrutura de [**coluna de \_ pesquisa \_ do ADS**](/windows/desktop/api/Iads/ns-iads-ads_search_column) em um ponteiro de estrutura [**\_ VLV do ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) .</span><span class="sxs-lookup"><span data-stu-id="3a219-150">Cast the **pADsValues->ProviderSpecific.lpValue** of the [**ADS\_SEARCH\_COLUMN**](/windows/desktop/api/Iads/ns-iads-ads_search_column) structure to an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure pointer.</span></span> <span data-ttu-id="3a219-151">O membro **dwContentCount** desta estrutura **\_ VLV do ADS** contém o número aproximado de itens que seriam retornados por uma pesquisa desse tipo.</span><span class="sxs-lookup"><span data-stu-id="3a219-151">The **dwContentCount** member of this **ADS\_VLV** structure contains the approximate number of items that would be returned by a search of that type.</span></span>
10. <span data-ttu-id="3a219-152">Se outras pesquisas de VLV do mesmo tipo forem executadas, faça uma cópia dos dados do **lpContextID** e preserve-as para a próxima pesquisa de VLV.</span><span class="sxs-lookup"><span data-stu-id="3a219-152">If other VLV searches of the same type will be performed, make a copy of the **lpContextID** data and preserve it for the next VLV search.</span></span>

<span data-ttu-id="3a219-153">A função de exemplo [**GetVLVItemCount**](example-code-for-using-a-vlv-search.md) mostra como fazer isso.</span><span class="sxs-lookup"><span data-stu-id="3a219-153">The [**GetVLVItemCount**](example-code-for-using-a-vlv-search.md) example function shows how to do this.</span></span>

## <a name="searching-by-offset"></a><span data-ttu-id="3a219-154">Pesquisando por deslocamento</span><span class="sxs-lookup"><span data-stu-id="3a219-154">Searching by Offset</span></span>

<span data-ttu-id="3a219-155">Uma coisa que torna a pesquisa de VLV tão rápida é que é possível pesquisar um resultado específico por um deslocamento numérico.</span><span class="sxs-lookup"><span data-stu-id="3a219-155">One thing that makes VLV searches so quick is that it is possible to search for a specific result by a numerical offset.</span></span> <span data-ttu-id="3a219-156">Por exemplo, se uma pesquisa resultar em 10.000 itens sendo retornados, uma pesquisa VLV torna possível obter as informações para aproximadamente o item 4072nd sem precisar recuperar todos os itens antes do item em questão.</span><span class="sxs-lookup"><span data-stu-id="3a219-156">For example, if a search would result in 10,000 items being returned, a VLV search makes it possible to obtain the information for approximately the 4072nd item without having to retrieve all of the items before the item in question.</span></span>

<span data-ttu-id="3a219-157">Os deslocamentos são especificados como uma proporção entre o deslocamento e a contagem de conteúdo.</span><span class="sxs-lookup"><span data-stu-id="3a219-157">Offsets are specified as a ratio between the offset and the content count.</span></span> <span data-ttu-id="3a219-158">As proporções são úteis porque o servidor pode não ter uma estimativa precisa do número de entradas que existem na lista ou o tamanho da lista pode ser alterado durante o tempo que o usuário está navegando.</span><span class="sxs-lookup"><span data-stu-id="3a219-158">Ratios are useful because the server may not have an accurate estimate of the number of entries that exist in the list or the list size may be changing during the time the user is browsing it.</span></span> <span data-ttu-id="3a219-159">Como você deve indicar o início e o fim da lista, você pode usar um valor estimado para a contagem de conteúdo na primeira solicitação de pesquisa, juntamente com um valor de deslocamento.</span><span class="sxs-lookup"><span data-stu-id="3a219-159">Because you must indicate the beginning and end of the list, you can use an estimated value for the content count in the first search request, along with an offset value.</span></span> <span data-ttu-id="3a219-160">O servidor usa esses dados para computar os deslocamentos correspondentes dentro da lista, com base na sua ideia de contagem de conteúdo, que é enviada em sua resposta ao cliente por meio do membro **dwContentCount** da estrutura [**\_ VLV do ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) .</span><span class="sxs-lookup"><span data-stu-id="3a219-160">The server uses this data to compute the corresponding offsets within the list, based on its idea of content count, which is sent in its response to the client through the **dwContentCount** member of the [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure.</span></span> <span data-ttu-id="3a219-161">Por exemplo, se você estimar que o tamanho da lista seja 3000 e quiser que o deslocamento seja a entrada da lista 1500, você definiria **dwContentCount** como 3000 e **dwOffset** como 1500.</span><span class="sxs-lookup"><span data-stu-id="3a219-161">For example, if you estimate the list size to be 3000, and you want the offset to be list entry 1500, you would set **dwContentCount** to 3000 and **dwOffset** to 1500.</span></span> <span data-ttu-id="3a219-162">Se o servidor estimar o tamanho da lista real como 4500, ele recalculará o deslocamento para 2250 e retornará as novas estimativas em **dwContentCount** e **dwOffset**.</span><span class="sxs-lookup"><span data-stu-id="3a219-162">If the server estimates the actual list size to be 4500, it will recalculate the offset to 2250, and return the new estimates in **dwContentCount** and **dwOffset**.</span></span>

> [!Note]
>
> <span data-ttu-id="3a219-163">Todos os valores numéricos em uma pesquisa VLV são aproximações e não devem ser usados para valores absolutos.</span><span class="sxs-lookup"><span data-stu-id="3a219-163">All of the numeric values in a VLV search are approximations and should not be used for absolute values.</span></span> <span data-ttu-id="3a219-164">Por exemplo, se você emitir uma pesquisa VLV para o item 50 º em um ração de 100, não será garantido que você obtenha o item do meio exato.</span><span class="sxs-lookup"><span data-stu-id="3a219-164">For example, if you issue a VLV search for the 50th item in a ration of 100, you are not guaranteed to get the exact middle item.</span></span>
>
> <span data-ttu-id="3a219-165">**Para procurar um item específico por deslocamento, execute as etapas a seguir.**</span><span class="sxs-lookup"><span data-stu-id="3a219-165">**To search for a particular item by offset, perform the following steps.**</span></span>
>
> 1.  <span data-ttu-id="3a219-166">Preencha uma [**estrutura \_ VLV do ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) com os valores a seguir.</span><span class="sxs-lookup"><span data-stu-id="3a219-166">Fill an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure with the following values.</span></span> <span data-ttu-id="3a219-167">Membros adicionais da estrutura devem ser definidos como zero ou **NULL**.</span><span class="sxs-lookup"><span data-stu-id="3a219-167">Additional members of the structure should be set to zero or **NULL**.</span></span>
>
>     -   <span data-ttu-id="3a219-168">Defina o membro **dwContentCount** como o valor máximo da taxa de itens a serem recuperados.</span><span class="sxs-lookup"><span data-stu-id="3a219-168">Set the **dwContentCount** member to the maximum value of the ratio of items to retrieve.</span></span>
>     -   <span data-ttu-id="3a219-169">Defina o membro **dwOffset** para a taxa, em relação a **dwContentCount**, do item ou dos itens a serem recuperados.</span><span class="sxs-lookup"><span data-stu-id="3a219-169">Set the **dwOffset** member to the ratio, relative to **dwContentCount**, of the item or items to retrieve.</span></span>
>     -   <span data-ttu-id="3a219-170">Defina o membro **lpContextID** como o endereço da cópia do buffer de ID de contexto e o **dwContextIDLength** para o comprimento, em bytes, do buffer de ID de contexto.</span><span class="sxs-lookup"><span data-stu-id="3a219-170">Set the **lpContextID** member to the address of the copy of the context ID buffer and the **dwContextIDLength** to the length, in bytes, of the context ID buffer.</span></span> <span data-ttu-id="3a219-171">Se nenhuma ID de contexto tiver sido salva, ambos os membros deverão ser zero ou **NULL**.</span><span class="sxs-lookup"><span data-stu-id="3a219-171">If no context ID has been saved, both of the these members should be zero or **NULL**.</span></span>
>
> 2.  <span data-ttu-id="3a219-172">Defina as preferências de pesquisa, conforme mostrado nas etapas 2 a 5 do procedimento obtendo o número de itens.</span><span class="sxs-lookup"><span data-stu-id="3a219-172">Set the search preferences as shown in Steps 2 through 5 of the Obtaining the Number of Items procedure.</span></span>
> 3.  <span data-ttu-id="3a219-173">Execute a pesquisa com [**IDirectorySearch:: ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch).</span><span class="sxs-lookup"><span data-stu-id="3a219-173">Perform the search with [**IDirectorySearch::ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch).</span></span>
> 4.  <span data-ttu-id="3a219-174">Obtenha a primeira linha de resultados chamando [**IDirectorySearch:: GetFirstRow**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow).</span><span class="sxs-lookup"><span data-stu-id="3a219-174">Get the first row of results by calling [**IDirectorySearch::GetFirstRow**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow).</span></span>
> 5.  <span data-ttu-id="3a219-175">Chame [**IDirectorySearch:: GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) com o nome do atributo a ser recuperado para obter os dados reais para o item solicitado.</span><span class="sxs-lookup"><span data-stu-id="3a219-175">Call [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with the name of the attribute to retrieve to get the actual data for the requested item.</span></span>
> 6.  <span data-ttu-id="3a219-176">Chame [**IDirectorySearch:: GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) com **a \_ \_ resposta VLV do ADS** para obter os metadados de pesquisa VLV.</span><span class="sxs-lookup"><span data-stu-id="3a219-176">Call [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with **ADS\_VLV\_RESPONSE** to obtain the VLV search metadata.</span></span>
> 7.  <span data-ttu-id="3a219-177">Converta o **pADsValues->ProviderSpecific. lpValue** da estrutura de [**coluna de \_ pesquisa \_ do ADS**](/windows/desktop/api/Iads/ns-iads-ads_search_column) em um ponteiro de estrutura [**\_ VLV do ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) .</span><span class="sxs-lookup"><span data-stu-id="3a219-177">Cast the **pADsValues->ProviderSpecific.lpValue** of the [**ADS\_SEARCH\_COLUMN**](/windows/desktop/api/Iads/ns-iads-ads_search_column) structure to an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure pointer.</span></span>
> 8.  <span data-ttu-id="3a219-178">Faça uma cópia dos dados do **lpContextID** e preserve-o para a próxima pesquisa de VLV.</span><span class="sxs-lookup"><span data-stu-id="3a219-178">Make a copy of the **lpContextID** data and preserve it for the next VLV search.</span></span>

 

<span data-ttu-id="3a219-179">A função de exemplo [**GetVLVItemText**](example-code-for-using-a-vlv-search.md) mostra como fazer isso.</span><span class="sxs-lookup"><span data-stu-id="3a219-179">The [**GetVLVItemText**](example-code-for-using-a-vlv-search.md) example function shows how to do this.</span></span>

<span data-ttu-id="3a219-180">Também é possível recuperar mais de uma linha de dados com uma única chamada de pesquisa.</span><span class="sxs-lookup"><span data-stu-id="3a219-180">It is also possible to retrieve more than one row of data with a single search call.</span></span> <span data-ttu-id="3a219-181">Isso é feito na etapa 1 definindo os membros **dwBeforeCount** e **dwAfterCount** da estrutura [**\_ VLV do ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) adequadamente.</span><span class="sxs-lookup"><span data-stu-id="3a219-181">This is done in Step 1 by setting the **dwBeforeCount** and **dwAfterCount** members of the [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure appropriately.</span></span> <span data-ttu-id="3a219-182">O membro **dwBeforeCount** contém o número de itens que aparecem na lista antes do item em questão e o membro **dwAfterCount** contém o número de itens que aparecem na lista depois do item em questão.</span><span class="sxs-lookup"><span data-stu-id="3a219-182">The **dwBeforeCount** member contains the number of items that appear in the list prior to the item in question and the **dwAfterCount** member contains the number of items that appear in the list after to the item in question.</span></span> <span data-ttu-id="3a219-183">Ambas as contagens excluem o item em si, portanto, definir **dwBeforeCount** como 10 e **dwAfterCount** como 10 resultará em um total de 21 itens retornados.</span><span class="sxs-lookup"><span data-stu-id="3a219-183">Both of these counts exclude the item itself, so setting **dwBeforeCount** to 10 and **dwAfterCount** to 10 will result in a total of 21 items returned.</span></span> <span data-ttu-id="3a219-184">Essa opção permite armazenar em cache os resultados da pesquisa no lado do cliente.</span><span class="sxs-lookup"><span data-stu-id="3a219-184">This option enables caching the search results on the client side.</span></span>

## <a name="searching-by-string"></a><span data-ttu-id="3a219-185">Pesquisando por cadeia de caracteres</span><span class="sxs-lookup"><span data-stu-id="3a219-185">Searching by String</span></span>

<span data-ttu-id="3a219-186">Também é possível usar uma pesquisa VLV para localizar itens que têm um atributo de cadeia de caracteres cujo valor corresponde a toda ou parte de uma cadeia de caracteres sem precisar recuperar todos os itens.</span><span class="sxs-lookup"><span data-stu-id="3a219-186">It is also possible to use a VLV search to find items that have a string attribute whose value matches all or part of a string without having to retrieve all items.</span></span> <span data-ttu-id="3a219-187">A correspondência de cadeia de caracteres é executada em relação ao atributo especificado na estrutura de [**\_ SORTKEY do ADS**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) do **\_ SEARCHPREF \_ classificar \_ na preferência de** pesquisa.</span><span class="sxs-lookup"><span data-stu-id="3a219-187">The string matching is performed against the attribute specified in the [**ADS\_SORTKEY**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) structure of the **ADS\_SEARCHPREF\_SORT\_ON** search preference.</span></span>

<span data-ttu-id="3a219-188">**Para procurar um item específico por cadeia de caracteres, execute as etapas a seguir.**</span><span class="sxs-lookup"><span data-stu-id="3a219-188">**To search for a particular item by string, perform the following steps.**</span></span>

1.  <span data-ttu-id="3a219-189">Preencha uma [**estrutura \_ VLV do ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) com os valores a seguir.</span><span class="sxs-lookup"><span data-stu-id="3a219-189">Fill an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure with the following values.</span></span> <span data-ttu-id="3a219-190">Membros adicionais da estrutura devem ser definidos como zero ou **NULL**.</span><span class="sxs-lookup"><span data-stu-id="3a219-190">Additional members of the structure should be set to zero or **NULL**.</span></span>

    -   <span data-ttu-id="3a219-191">Defina o membro **pszTarget** como um ponteiro para uma cadeia de caracteres terminada em nulo que contenha a cadeia de caracteres a ser pesquisada.</span><span class="sxs-lookup"><span data-stu-id="3a219-191">Set the **pszTarget** member to a pointer to a NULL-terminated string that contains the string to search for.</span></span>
    -   <span data-ttu-id="3a219-192">Defina o membro **lpContextID** como o endereço da cópia do buffer de ID de contexto e o **dwContextIDLength** para o comprimento, em bytes, do buffer de ID de contexto.</span><span class="sxs-lookup"><span data-stu-id="3a219-192">Set the **lpContextID** member to the address of the copy of the context ID buffer and the **dwContextIDLength** to the length, in bytes, of the context ID buffer.</span></span> <span data-ttu-id="3a219-193">Se nenhuma ID de contexto tiver sido salva, ambos os membros deverão ser zero ou **NULL**.</span><span class="sxs-lookup"><span data-stu-id="3a219-193">If no context ID has been saved, both of the these members should be zero or **NULL**.</span></span>

2.  <span data-ttu-id="3a219-194">Defina as preferências de pesquisa, conforme mostrado nas etapas 2 a 5 do procedimento obtendo o número de itens.</span><span class="sxs-lookup"><span data-stu-id="3a219-194">Set the search preferences as shown in Steps 2 through 5 of the Obtaining the Number of Items procedure.</span></span>
3.  <span data-ttu-id="3a219-195">Execute a pesquisa com [**IDirectorySearch:: ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch).</span><span class="sxs-lookup"><span data-stu-id="3a219-195">Perform the search with [**IDirectorySearch::ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch).</span></span>
4.  <span data-ttu-id="3a219-196">Obtenha a primeira linha de resultados chamando [**IDirectorySearch:: GetFirstRow**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow).</span><span class="sxs-lookup"><span data-stu-id="3a219-196">Get the first row of results by calling [**IDirectorySearch::GetFirstRow**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow).</span></span>
5.  <span data-ttu-id="3a219-197">Chame [**IDirectorySearch:: GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) com o nome do atributo a ser recuperado para obter os dados reais para o item solicitado.</span><span class="sxs-lookup"><span data-stu-id="3a219-197">Call [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with the name of the attribute to retrieve to get the actual data for the requested item.</span></span>
6.  <span data-ttu-id="3a219-198">Chame [**IDirectorySearch:: GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) com **a \_ \_ resposta VLV do ADS** para obter os metadados de pesquisa VLV.</span><span class="sxs-lookup"><span data-stu-id="3a219-198">Call [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with **ADS\_VLV\_RESPONSE** to obtain the VLV search metadata.</span></span>
7.  <span data-ttu-id="3a219-199">Converta o **pADsValues->ProviderSpecific. lpValue** da estrutura de [**coluna de \_ pesquisa \_ do ADS**](/windows/desktop/api/Iads/ns-iads-ads_search_column) em um ponteiro de estrutura [**\_ VLV do ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) .</span><span class="sxs-lookup"><span data-stu-id="3a219-199">Cast the **pADsValues->ProviderSpecific.lpValue** of the [**ADS\_SEARCH\_COLUMN**](/windows/desktop/api/Iads/ns-iads-ads_search_column) structure to an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure pointer.</span></span>
8.  <span data-ttu-id="3a219-200">Faça uma cópia dos dados do **lpContextID** e preserve-o para a próxima pesquisa de VLV.</span><span class="sxs-lookup"><span data-stu-id="3a219-200">Make a copy of the **lpContextID** data and preserve it for the next VLV search.</span></span> <span data-ttu-id="3a219-201">Se necessário, o membro **dwOffset** contém o índice baseado em um do primeiro item cujo atributo de cadeia de caracteres começa com o valor especificado em **pszTarget**.</span><span class="sxs-lookup"><span data-stu-id="3a219-201">If required, the **dwOffset** member contains the one-based index of the first item whose string attribute begins with the value specified in **pszTarget**.</span></span>

<span data-ttu-id="3a219-202">A função de exemplo [**GetVLVItemsByString**](example-code-for-using-a-vlv-search.md) mostra como fazer isso.</span><span class="sxs-lookup"><span data-stu-id="3a219-202">The [**GetVLVItemsByString**](example-code-for-using-a-vlv-search.md) example function shows how to do this.</span></span>

<span data-ttu-id="3a219-203">Da mesma forma que Pesquisar por índice, também é possível recuperar mais de uma linha de dados com uma única chamada de pesquisa.</span><span class="sxs-lookup"><span data-stu-id="3a219-203">Similarly to searching by index, it is also possible to retrieve more than one row of data with a single search call.</span></span> <span data-ttu-id="3a219-204">Isso é feito da mesma maneira definindo os membros **dwBeforeCount** e **dwAfterCount** da estrutura VLV do [**ADS \_**](/windows/desktop/api/Iads/ns-iads-ads_vlv) adequadamente.</span><span class="sxs-lookup"><span data-stu-id="3a219-204">This is accomplished in the same manner by setting the **dwBeforeCount** and **dwAfterCount** members of the [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure appropriately.</span></span>

 

 