---
title: Visão geral do código
description: A figura a seguir é uma representação conceitual dos blocos de código necessários para implementar o componente do provedor de exemplo ADSI.
ms.assetid: b353c2d9-ef86-4e4c-ac00-4756fc9ec57d
ms.tgt_platform: multiple
keywords:
- Visão geral do código AD
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e99a4974ac97488fc051ea80dbde7a8a83fa329e
ms.sourcegitcommit: b0ebdefc3dcd5c04bede94091833aa1015a2f95c
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/21/2020
ms.locfileid: "104008368"
---
# <a name="code-overview"></a><span data-ttu-id="d7b9f-104">Visão geral do código</span><span class="sxs-lookup"><span data-stu-id="d7b9f-104">Code Overview</span></span>

<span data-ttu-id="d7b9f-105">A figura a seguir é uma representação conceitual dos blocos de código necessários para implementar o componente do provedor de exemplo ADSI.</span><span class="sxs-lookup"><span data-stu-id="d7b9f-105">The following figure is a conceptual representation of the blocks of code necessary to implement the ADSI example provider component.</span></span> <span data-ttu-id="d7b9f-106">Cada seção é descrita na figura a seguir.</span><span class="sxs-lookup"><span data-stu-id="d7b9f-106">Each section is described in the following figure.</span></span> <span data-ttu-id="d7b9f-107">Programadores COM experientes podem achar que essa é uma visão geral adequada do componente de provedor de exemplo.</span><span class="sxs-lookup"><span data-stu-id="d7b9f-107">Experienced COM programmers may find this is to be a suitable overview of the example provider component.</span></span> <span data-ttu-id="d7b9f-108">Para obter mais informações, consulte [detalhes do código](code-details.md).</span><span class="sxs-lookup"><span data-stu-id="d7b9f-108">For more information, see [Code Details](code-details.md).</span></span>

![implementação de provedor de exemplo](images/dssmco.png)

<span data-ttu-id="d7b9f-110">Os itens numerados a seguir correspondem aos elementos de bloco na figura.</span><span class="sxs-lookup"><span data-stu-id="d7b9f-110">The following numbered items correspond to block elements in the figure.</span></span>

1.  <span data-ttu-id="d7b9f-111">Carregando a DLL (LibMain. cpp, GUID. cpp).</span><span class="sxs-lookup"><span data-stu-id="d7b9f-111">Loading the DLL (Libmain.cpp, Guid.cpp).</span></span> <span data-ttu-id="d7b9f-112">O ponto de entrada para a DLL.</span><span class="sxs-lookup"><span data-stu-id="d7b9f-112">The entry point for the DLL.</span></span> <span data-ttu-id="d7b9f-113">Definições de objeto estático de fábrica de classes para os dois objetos de provedor: GUID. cpp contém as definições de CLSID para as implementações dos vários objetos de componente de provedor de exemplo.</span><span class="sxs-lookup"><span data-stu-id="d7b9f-113">Class factory static object definitions for the two provider objects: Guid.cpp contains the CLSID definitions for the implementations of the various Example provider component objects.</span></span>
2.  <span data-ttu-id="d7b9f-114">Fábrica de classes de objeto de provedor e código de criação (Cprovcf. cpp, Cprov. cpp, Stdfact. cpp).</span><span class="sxs-lookup"><span data-stu-id="d7b9f-114">Provider object class factory and creation code (Cprovcf.cpp, Cprov.cpp, Stdfact.cpp).</span></span> <span data-ttu-id="d7b9f-115">O objeto Provider é o objeto que dá suporte a [**IParseDisplayName**](/windows/win32/api/oleidl/nn-oleidl-iparsedisplayname) durante as operações de associação de moniker, conforme discutido em Localizando e ligando no componente de provedor de exemplo.</span><span class="sxs-lookup"><span data-stu-id="d7b9f-115">The provider object is the object that supports [**IParseDisplayName**](/windows/win32/api/oleidl/nn-oleidl-iparsedisplayname) during the moniker binding operations as discussed in Finding and Binding in the Example Provider Component.</span></span>
3.  <span data-ttu-id="d7b9f-116">Associação a um objeto (Getobj. cpp).</span><span class="sxs-lookup"><span data-stu-id="d7b9f-116">Binding to an object (Getobj.cpp).</span></span> <span data-ttu-id="d7b9f-117">Esse código chama o analisador para verificar se o ADsPath fornecido está sintaticamente correto e, em seguida, executa qualquer mapeamento necessário do ADsPath para o caminho do serviço de diretório nativo para o item que está sendo criado como um objeto Active Directory.</span><span class="sxs-lookup"><span data-stu-id="d7b9f-117">This code calls the parser to check that the given ADsPath is syntactically correct, and then performs any necessary mapping from the ADsPath to the native directory service path for the item being created as an Active Directory object.</span></span> <span data-ttu-id="d7b9f-118">Ele pesquisa a definição de esquema para esse tipo de objeto e preenche as propriedades obrigatórias.</span><span class="sxs-lookup"><span data-stu-id="d7b9f-118">It looks up the schema definition for this type of object and fills in the mandatory properties.</span></span> <span data-ttu-id="d7b9f-119">Depois de criar o objeto Active Directory, um ponteiro de interface para [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) é recuperado para o chamador.</span><span class="sxs-lookup"><span data-stu-id="d7b9f-119">After creating the Active Directory object, an interface pointer to [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) is retrieved for the caller.</span></span>
4.  <span data-ttu-id="d7b9f-120">Analisador para o namespace do provedor (Parse. cpp).</span><span class="sxs-lookup"><span data-stu-id="d7b9f-120">Parser for the provider namespace (Parse.cpp).</span></span> <span data-ttu-id="d7b9f-121">Este é o código invocado pelo item 3.</span><span class="sxs-lookup"><span data-stu-id="d7b9f-121">This is the code invoked by item 3.</span></span> <span data-ttu-id="d7b9f-122">O analisador verifica se a cadeia de caracteres ADsPath passada está sintaticamente correta para seu próprio namespace.</span><span class="sxs-lookup"><span data-stu-id="d7b9f-122">The parser verifies that the ADsPath string passed in is syntactically correct for its own namespace.</span></span>
5.  <span data-ttu-id="d7b9f-123">Fábrica de classes, criação e enumeração para o objeto de namespace (Cnamcf. cpp, Cnamesp. cpp, Cenumns. cpp).</span><span class="sxs-lookup"><span data-stu-id="d7b9f-123">Class factory, creation, and enumeration for the namespace object (Cnamcf.cpp, Cnamesp.cpp, Cenumns.cpp).</span></span> <span data-ttu-id="d7b9f-124">O objeto namespace é um objeto contêiner que pode ser enumerado para localizar todos os objetos de nó raiz para esse namespace.</span><span class="sxs-lookup"><span data-stu-id="d7b9f-124">The namespace object is a container object that can be enumerated to find all the root node objects for this namespace.</span></span>
6.  <span data-ttu-id="d7b9f-125">Fábrica de classes e código de criação para um objeto de Active Directory genérico e fábrica de classes, criação e código de enumeração para um objeto de contêiner ADs genérico (Cgenobj. cpp, Cenumobj. cpp, Common. cpp, Core. cpp).</span><span class="sxs-lookup"><span data-stu-id="d7b9f-125">Class factory and creation code for a generic Active Directory object, and class factory, creation and enumeration code for a generic ADs container object (Cgenobj.cpp, Cenumobj.cpp, Common.cpp, Core.cpp).</span></span> <span data-ttu-id="d7b9f-126">Esse código é executado quando um objeto de Active Directory é criado.</span><span class="sxs-lookup"><span data-stu-id="d7b9f-126">This code is executed when an Active Directory object is created.</span></span>
7.  <span data-ttu-id="d7b9f-127">Filtragem e enumeração de VARIAntes (Cenumvar. cpp, Object. cpp).</span><span class="sxs-lookup"><span data-stu-id="d7b9f-127">Filtering and enumerating VARIANTs (Cenumvar.cpp, Object.cpp).</span></span> <span data-ttu-id="d7b9f-128">Quando uma coleção de elementos VARIANT de um único tipo é gerenciada no ADSI, esse código é usado.</span><span class="sxs-lookup"><span data-stu-id="d7b9f-128">When a collection of VARIANT elements of a single type are managed in within ADSI, this code is used.</span></span>
8.  <span data-ttu-id="d7b9f-129">Globais (Globals. cpp).</span><span class="sxs-lookup"><span data-stu-id="d7b9f-129">Globals (Globals.cpp).</span></span> <span data-ttu-id="d7b9f-130">Palavras-chave de namespace, estruturas de mapeamento de sintaxe de formatos de dados nativos para o tipo de variante de automação ADs são todos definidos aqui.</span><span class="sxs-lookup"><span data-stu-id="d7b9f-130">Namespace keywords, syntax mapping structures from native data formats to the ADs Automation VARIANT type are all defined here.</span></span>
9.  <span data-ttu-id="d7b9f-131">Empacotamento/desempacotamento de dados (Pack. cpp, Property. cpp, Smpoper. cpp).</span><span class="sxs-lookup"><span data-stu-id="d7b9f-131">Marshaling/unmarshaling data (Pack.cpp, Property.cpp, Smpoper.cpp).</span></span> <span data-ttu-id="d7b9f-132">A conversão de formatos de dados nativos no conjunto com suporte de tipos VARIAntes de automação ocorre quando as propriedades de um objeto são carregadas no cache de propriedades.</span><span class="sxs-lookup"><span data-stu-id="d7b9f-132">Conversion from native data formats to the supported set of Automation VARIANT types occurs when properties of an object are loaded into the property cache.</span></span> <span data-ttu-id="d7b9f-133">Outras manipulações especiais de dados devem ser executadas quando as estruturas com ponteiros são copiadas, excluídas ou movidas na memória.</span><span class="sxs-lookup"><span data-stu-id="d7b9f-133">Other special handling for data must be performed when structures with pointers are copied, deleted, or moved in memory.</span></span>
10. <span data-ttu-id="d7b9f-134">Cache de Propriedades (cProps. cpp).</span><span class="sxs-lookup"><span data-stu-id="d7b9f-134">Property cache (Cprops.cpp).</span></span> <span data-ttu-id="d7b9f-135">As propriedades de cache são um recurso do ambiente ADSI.</span><span class="sxs-lookup"><span data-stu-id="d7b9f-135">Caching properties is a feature of the ADSI environment.</span></span> <span data-ttu-id="d7b9f-136">Os métodos [**IADs:: GetInfo**](/windows/desktop/api/Iads/nf-iads-iads-getinfo), [**IADs:: GetInfoEx**](/windows/desktop/api/Iads/nf-iads-iads-getinfoex)e [**IADs:: setinfo**](/windows/desktop/api/Iads/nf-iads-iads-setinfo) atuam no cache de propriedades.</span><span class="sxs-lookup"><span data-stu-id="d7b9f-136">The [**IADs::GetInfo**](/windows/desktop/api/Iads/nf-iads-iads-getinfo), [**IADs::GetInfoEx**](/windows/desktop/api/Iads/nf-iads-iads-getinfoex), and [**IADs::SetInfo**](/windows/desktop/api/Iads/nf-iads-iads-setinfo) methods act on the property cache.</span></span>
11. <span data-ttu-id="d7b9f-137">Gerenciamento de memória (Memory. cpp).</span><span class="sxs-lookup"><span data-stu-id="d7b9f-137">Memory management (Memory.cpp).</span></span> <span data-ttu-id="d7b9f-138">O uso de um conjunto de funções de memória para alocar e liberar memória permite que o componente de provedor de exemplo controle o uso de memória e pare os vazamentos de memória.</span><span class="sxs-lookup"><span data-stu-id="d7b9f-138">Using one set of memory functions to allocate and free memory allows the example provider component to track memory use and stop memory leaks.</span></span>
12. <span data-ttu-id="d7b9f-139">Objetos de esquema e gerenciamento (Cschobj. cpp, Cprpobj. cpp, Cclsobj. cpp, Cenumsch. cpp).</span><span class="sxs-lookup"><span data-stu-id="d7b9f-139">Schema objects and management (Cschobj.cpp, Cprpobj.cpp, Cclsobj.cpp, Cenumsch.cpp).</span></span> <span data-ttu-id="d7b9f-140">Isso inclui rotinas para criar, gerenciar e enumerar os objetos de esquema.</span><span class="sxs-lookup"><span data-stu-id="d7b9f-140">This includes routines to create, manage, and enumerate the schema objects.</span></span> <span data-ttu-id="d7b9f-141">Isso inclui objetos de classe de esquema, objetos de propriedade e objetos de sintaxe, além de ser capaz de enumerar o objeto de contêiner de classe de esquema.</span><span class="sxs-lookup"><span data-stu-id="d7b9f-141">This includes schema class objects, property objects, and syntax objects, in addition to being able to enumerate the schema class container object.</span></span>
13. <span data-ttu-id="d7b9f-142">Chamadas específicas do sistema operacional (RegDSAPI. cpp).</span><span class="sxs-lookup"><span data-stu-id="d7b9f-142">Operating-system specific calls (RegDSAPI.cpp).</span></span> <span data-ttu-id="d7b9f-143">Isso inclui todas as chamadas que fazem referência ao sistema operacional nativo.</span><span class="sxs-lookup"><span data-stu-id="d7b9f-143">This includes all calls that reference the native operating system.</span></span> <span data-ttu-id="d7b9f-144">Entre outras funções, elas incluem a abertura de funções, o fechamento, a leitura e a modificação de objetos, bem como aqueles que acessam os dados de esquema e de propriedade.</span><span class="sxs-lookup"><span data-stu-id="d7b9f-144">Among other functions, they include functions opening, closing, reading, and modifying objects as well as those accessing the schema and property data.</span></span> <span data-ttu-id="d7b9f-145">O componente de provedor de exemplo aconteceu para simular uma hierarquia de diretório usando o registro.</span><span class="sxs-lookup"><span data-stu-id="d7b9f-145">The example provider component happened to simulate a directory hierarchy by using the registry.</span></span> <span data-ttu-id="d7b9f-146">Somente nomes de função devem ser muito interessantes para um gravador de provedor.</span><span class="sxs-lookup"><span data-stu-id="d7b9f-146">Only function names should be of much interest to a provider writer.</span></span>
14. <span data-ttu-id="d7b9f-147">Implementação de [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) (Cdispmgr. cpp).</span><span class="sxs-lookup"><span data-stu-id="d7b9f-147">[**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) implementation (Cdispmgr.cpp).</span></span> <span data-ttu-id="d7b9f-148">Esse código acessa os dados da biblioteca de tipos para permitir que os métodos de interface sejam invocados de forma compatível com a automação.</span><span class="sxs-lookup"><span data-stu-id="d7b9f-148">This code accesses the type library data to allow interface methods to be invoked in an Automation-compatible way.</span></span>

 

 