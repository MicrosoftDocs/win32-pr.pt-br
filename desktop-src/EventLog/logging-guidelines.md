---
description: Os logs de eventos armazenam registros de eventos significativos em nome do sistema e aplicativos em execução no sistema.
ms.assetid: 58a6569a-2775-4687-bf99-579fa4153191
title: Diretrizes de registro em log
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c1210757a7961d82d13d4887e40fbd3837b86138
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104091454"
---
# <a name="logging-guidelines"></a><span data-ttu-id="6a365-103">Diretrizes de registro em log</span><span class="sxs-lookup"><span data-stu-id="6a365-103">Logging Guidelines</span></span>

<span data-ttu-id="6a365-104">Os logs de eventos armazenam registros de eventos significativos em nome do sistema e aplicativos em execução no sistema.</span><span class="sxs-lookup"><span data-stu-id="6a365-104">Event logs store records of significant events on behalf of the system and applications running on the system.</span></span> <span data-ttu-id="6a365-105">Como as funções de log são de uso geral, você deve decidir quais informações são apropriadas para o log.</span><span class="sxs-lookup"><span data-stu-id="6a365-105">Because the logging functions are general purpose, you must decide what information is appropriate to log.</span></span> <span data-ttu-id="6a365-106">Em geral, você deve registrar apenas informações que podem ser úteis para diagnosticar um problema de hardware ou software.</span><span class="sxs-lookup"><span data-stu-id="6a365-106">Generally, you should log only information that could be useful in diagnosing a hardware or software problem.</span></span> <span data-ttu-id="6a365-107">O log de eventos não se destina a ser usado como uma ferramenta de rastreamento.</span><span class="sxs-lookup"><span data-stu-id="6a365-107">Event logging is not intended to be used as a tracing tool.</span></span>

## <a name="choosing-events-to-log"></a><span data-ttu-id="6a365-108">Escolhendo eventos para registrar</span><span class="sxs-lookup"><span data-stu-id="6a365-108">Choosing Events to Log</span></span>

<span data-ttu-id="6a365-109">Veja a seguir exemplos de casos em que o log de eventos pode ser útil:</span><span class="sxs-lookup"><span data-stu-id="6a365-109">The following are examples of cases in which event logging can be helpful:</span></span>

-   <span data-ttu-id="6a365-110">Problemas de recursos.</span><span class="sxs-lookup"><span data-stu-id="6a365-110">Resource problems.</span></span> <span data-ttu-id="6a365-111">O registro em log de um evento de aviso quando a alocação de memória falha pode ajudar a indicar a causa de uma situação de baixa memória.</span><span class="sxs-lookup"><span data-stu-id="6a365-111">Logging a Warning event when memory allocation fails can help indicate the cause of a low-memory situation.</span></span>
-   <span data-ttu-id="6a365-112">Problemas de hardware.</span><span class="sxs-lookup"><span data-stu-id="6a365-112">Hardware problems.</span></span> <span data-ttu-id="6a365-113">Se um driver de dispositivo encontrar um tempo limite de controlador de disco, uma falha de energia em uma porta paralela ou um erro de dados de uma rede ou placa serial, o driver de dispositivo poderá registrar informações sobre esses eventos para ajudar o administrador do sistema a diagnosticar problemas de hardware.</span><span class="sxs-lookup"><span data-stu-id="6a365-113">If a device driver encounters a disk controller time-out, a power failure in a parallel port, or a data error from a network or serial card, the device driver can log information about these events to help the system administrator diagnose hardware problems.</span></span>
-   <span data-ttu-id="6a365-114">Setores inválidos.</span><span class="sxs-lookup"><span data-stu-id="6a365-114">Bad sectors.</span></span> <span data-ttu-id="6a365-115">Se um driver de disco encontrar um setor insatisfatório, ele poderá ser capaz de ler ou gravar no setor depois de repetir a operação, mas o setor vai ser inadequado eventualmente.</span><span class="sxs-lookup"><span data-stu-id="6a365-115">If a disk driver encounters a bad sector, it may be able to read from or write to the sector after retrying the operation, but the sector will go bad eventually.</span></span> <span data-ttu-id="6a365-116">Se o driver de disco puder continuar, ele deverá registrar um evento de aviso; caso contrário, ele deve registrar um evento de erro.</span><span class="sxs-lookup"><span data-stu-id="6a365-116">If the disk driver can proceed, it should log a Warning event; otherwise, it should log an Error event.</span></span> <span data-ttu-id="6a365-117">Se um driver de sistema de arquivos encontrar um grande número de setores defeituosos e os corrigir, o log de eventos de aviso poderá ajudar um administrador a determinar que o disco pode estar prestes a falhar.</span><span class="sxs-lookup"><span data-stu-id="6a365-117">If a file system driver finds a large number of bad sectors and fixes them, logging Warning events might help an administrator determine that the disk may be about to fail.</span></span>
-   <span data-ttu-id="6a365-118">Eventos de informações.</span><span class="sxs-lookup"><span data-stu-id="6a365-118">Information events.</span></span> <span data-ttu-id="6a365-119">Um aplicativo de servidor (como um servidor de banco de dados) registra um logon de usuário, abrindo um banco de dados ou iniciando uma transferência de arquivo.</span><span class="sxs-lookup"><span data-stu-id="6a365-119">A server application (such as a database server) records a user logging on, opening a database, or starting a file transfer.</span></span> <span data-ttu-id="6a365-120">O servidor também pode registrar outros eventos, como erros (não é possível acessar o arquivo, processo de host desconectado e assim por diante), corrupção de banco de dados ou se uma transferência de arquivo foi bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="6a365-120">The server can also log other events such as errors (cannot access file, host process disconnected, and so on), database corruption, or whether a file transfer was successful.</span></span>

## <a name="writing-messages"></a><span data-ttu-id="6a365-121">Gravando mensagens</span><span class="sxs-lookup"><span data-stu-id="6a365-121">Writing Messages</span></span>

<span data-ttu-id="6a365-122">As mensagens devem fazer sentido para administradores e usuários que estão tentando solucionar um problema.</span><span class="sxs-lookup"><span data-stu-id="6a365-122">Messages should make sense to administrators and users who are trying to troubleshoot a problem.</span></span> <span data-ttu-id="6a365-123">Uma mensagem deve conter todas as informações necessárias para entender o que causou o problema e como corrigi-lo.</span><span class="sxs-lookup"><span data-stu-id="6a365-123">A message should contain all the information needed to understand what caused the problem and how to correct it.</span></span>

<span data-ttu-id="6a365-124">Evite escrever uma mensagem criptografada, como "um pacote de driver recebido do subsistema de e/s era inválido.</span><span class="sxs-lookup"><span data-stu-id="6a365-124">Avoid writing a cryptic message such as "A driver packet received from the I/O subsystem was invalid.</span></span> <span data-ttu-id="6a365-125">Os dados são o pacote. " Uma mensagem melhor indicaria que o driver em questão está funcionando corretamente, mas está registrando em log os pacotes formatados incorretamente.</span><span class="sxs-lookup"><span data-stu-id="6a365-125">The data is the packet."A better message would indicate that the driver in question is functioning properly, but is logging incorrectly formatted packets.</span></span> <span data-ttu-id="6a365-126">Ele pode continuar a dizer que uma versão Unicode do driver é necessária para corrigir o problema.</span><span class="sxs-lookup"><span data-stu-id="6a365-126">It could go on to say that a Unicode version of the driver is needed to correct the problem.</span></span> <span data-ttu-id="6a365-127">Para obter mais informações sobre como escrever boas mensagens de erro, consulte [diretrizes de mensagem de erro](/windows/desktop/Debug/error-message-guidelines).</span><span class="sxs-lookup"><span data-stu-id="6a365-127">For more information about writing good error messages, see [Error Message Guidelines](/windows/desktop/Debug/error-message-guidelines).</span></span>

<span data-ttu-id="6a365-128">Não use tabulações ou vírgulas no texto da mensagem, porque os logs de eventos podem ser salvos como arquivos de texto separados por vírgula ou por tabulação.</span><span class="sxs-lookup"><span data-stu-id="6a365-128">Do not use tabs or commas in the message text, because event logs can be saved as comma or tab-separated text files.</span></span> <span data-ttu-id="6a365-129">Muitas organizações importam esses arquivos em bancos de dados e os caracteres de formatação extras exigirão a manipulação manual.</span><span class="sxs-lookup"><span data-stu-id="6a365-129">Many organizations import these files into databases, and the extra formatting characters will require manual manipulation.</span></span>

<span data-ttu-id="6a365-130">Ao usar nomes UNC ou outros links que contenham espaços, coloque o nome entre colchetes angulares.</span><span class="sxs-lookup"><span data-stu-id="6a365-130">When using UNC names, or other links that contain spaces, enclose the name in angle brackets.</span></span> <span data-ttu-id="6a365-131">Por exemplo, <\\ \\ *ShareName* \\ *ServerName*>.</span><span class="sxs-lookup"><span data-stu-id="6a365-131">For example, <\\\\*sharename*\\*servername*>.</span></span> <span data-ttu-id="6a365-132">Você pode gravar uma URL no final da mensagem que aponta o usuário para o material de ajuda relacionado.</span><span class="sxs-lookup"><span data-stu-id="6a365-132">You can write a URL to the end of the message that points the user to related help material.</span></span> <span data-ttu-id="6a365-133">A URL deve ser um nome de host DNS totalmente qualificado.</span><span class="sxs-lookup"><span data-stu-id="6a365-133">The URL must be a fully qualified DNS host name.</span></span> <span data-ttu-id="6a365-134">Por exemplo, você pode acrescentar o seguinte texto às suas mensagens: "para obter mais informações sobre esta mensagem, visite nosso site de suporte em https://www.microsoft.com/Support/ProdRedirect/ContentSearch.asp ."</span><span class="sxs-lookup"><span data-stu-id="6a365-134">For example, you could append the following text to your messages: "For additional information on this message, please visit our support site at https://www.microsoft.com/Support/ProdRedirect/ContentSearch.asp."</span></span> <span data-ttu-id="6a365-135">O link levaria a uma página ASP que redireciona o usuário para o conteúdo relacionado à mensagem de erro.</span><span class="sxs-lookup"><span data-stu-id="6a365-135">The link would lead to an ASP page that redirects the user to content relating to the error message.</span></span> <span data-ttu-id="6a365-136">Ele analisaria parâmetros adicionais (passados quando a URL é clicada) para determinar onde redirecionar o usuário.</span><span class="sxs-lookup"><span data-stu-id="6a365-136">It would parse additional parameters (passed when the URL is clicked) to determine where to redirect the user.</span></span>

<span data-ttu-id="6a365-137">Os argumentos passados para a função [**ReportEvent**](/windows/desktop/api/Winbase/nf-winbase-reporteventa) são acrescentados à URL da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="6a365-137">The arguments passed to the [**ReportEvent**](/windows/desktop/api/Winbase/nf-winbase-reporteventa) function are appended to the URL as follows:</span></span>

``` syntax
strHTTPQuery += L"?EvtSrc=" + _strEscapedSource;
strHTTPQuery += L"&EvtCat=" + _strEscapedCategory;
strHTTPQuery += L"&EvtID=" + _strEscapedEventID;
strHTTPQuery += L"&EvtCatID=" + _strEscapedCategoryID;
strHTTPQuery += L"&EvtType=" + _strEscapedType;
strHTTPQuery += L"&EvtTypeID=" + _strEscapedTypeID;
strHTTPQuery += L"&EvtRptTime=" + _strEscapedDateAndTime;
strHTTPQuery += L"&EvtTZBias=" + _strEscapedTimeZoneBias;
```

<span data-ttu-id="6a365-138">Se o nome da empresa, o nome do produto, a versão do produto, o nome do arquivo e a versão do arquivo do cabeçalho DLL da mensagem para a origem do evento forem válidos, eles também serão anexados à URL:</span><span class="sxs-lookup"><span data-stu-id="6a365-138">If the company name, product name, product version, file name, and file version from the message DLL header for the event source are valid, they are also appended to the URL:</span></span>

``` syntax
ADD_VER_STR(L"CoName",   _strEscapedCompanyName);
ADD_VER_STR(L"ProdName", _strEscapedProductName);
ADD_VER_STR(L"ProdVer",  _strEscapedProductVersion);
ADD_VER_STR(L"FileName", _strEscapedFileName);
ADD_VER_STR(L"FileVer",  _strEscapedFileVersion);
```

## <a name="reducing-overhead"></a><span data-ttu-id="6a365-139">Reduzindo a sobrecarga</span><span class="sxs-lookup"><span data-stu-id="6a365-139">Reducing Overhead</span></span>

<span data-ttu-id="6a365-140">O log de eventos consome recursos como espaço em disco e tempo do processador.</span><span class="sxs-lookup"><span data-stu-id="6a365-140">Event logging consumes resources such as disk space and processor time.</span></span> <span data-ttu-id="6a365-141">A quantidade de espaço em disco que um log de eventos requer e a sobrecarga para um aplicativo que registra os eventos dependem da quantidade de informações que você escolhe registrar.</span><span class="sxs-lookup"><span data-stu-id="6a365-141">The amount of disk space that an event log requires and the overhead for an application that logs events depend on how much information you choose to log.</span></span> <span data-ttu-id="6a365-142">É por isso que é importante registrar apenas informações essenciais.</span><span class="sxs-lookup"><span data-stu-id="6a365-142">This is why it is important to log only essential information.</span></span> <span data-ttu-id="6a365-143">Também é bom colocar chamadas de log de eventos em um caminho de erro no código, e não no caminho de código principal, o que reduziria o desempenho.</span><span class="sxs-lookup"><span data-stu-id="6a365-143">It is also good to place event logging calls in an error path in the code rather than in the main code path, which would reduce performance.</span></span>

<span data-ttu-id="6a365-144">A quantidade de espaço em disco necessária para cada registro de log de eventos inclui os membros da estrutura [**EVENTLOGRECORD**](/windows/desktop/api/Winnt/ns-winnt-eventlogrecord) .</span><span class="sxs-lookup"><span data-stu-id="6a365-144">The amount of disk space required for each event log record includes the members of the [**EVENTLOGRECORD**](/windows/desktop/api/Winnt/ns-winnt-eventlogrecord) structure.</span></span> <span data-ttu-id="6a365-145">Esta é uma estrutura de comprimento variável; cadeias de caracteres e dados binários são armazenados após a estrutura.</span><span class="sxs-lookup"><span data-stu-id="6a365-145">This is a variable length structure; strings and binary data are stored following the structure.</span></span>

 

 
