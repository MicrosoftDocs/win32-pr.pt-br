---
description: Embora os provedores de serviço do Windows Sockets sejam incentivados a implementar soquetes como objetos de sistema de arquivos instaláveis (IFS), a arquitetura do Winsock também acomoda provedores de serviços cujas alças de soquete não são objetos IFS.
ms.assetid: ed5e10f4-fa17-4a07-9cac-43767915b8e9
title: Alocação de descritores
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 095301798eb850fc4eb63e1939712379b5ead85e
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105797956"
---
# <a name="descriptor-allocation"></a><span data-ttu-id="0e967-103">Alocação de descritores</span><span class="sxs-lookup"><span data-stu-id="0e967-103">Descriptor Allocation</span></span>

<span data-ttu-id="0e967-104">Embora os provedores de serviço do Windows Sockets sejam incentivados a implementar soquetes como objetos de sistema de arquivos instaláveis (IFS), a arquitetura do Winsock também acomoda provedores de serviços cujas alças de soquete não são objetos IFS.</span><span class="sxs-lookup"><span data-stu-id="0e967-104">While Windows Sockets service providers are encouraged to implement sockets as installable file system (IFS) objects, the Winsock architecture also accommodates service providers whose socket handles are not IFS objects.</span></span> <span data-ttu-id="0e967-105">Provedores com identificadores IFS indicam isso por meio do XP1 \_ IFS \_ manipula o bit de atributo na estrutura de [**\_ informações de WSAPROTOCOL**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) .</span><span class="sxs-lookup"><span data-stu-id="0e967-105">Providers with IFS handles indicate this through the XP1\_IFS\_HANDLES attribute bit in the [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure.</span></span> <span data-ttu-id="0e967-106">(Observação: o XP1 \_ O \_ bits de atributo de identificadores IFS não foi incluído na versão 2.0.8 da especificação de API, mas já foi adicionado por meio do mecanismo de errata.) Os clientes do Winsock SPI podem aproveitar os provedores cujos descritores de soquete são identificadores de IFS usando esses descritores com instalações de e/s padrão do Windows, como [ReadFile](/windows/win32/api/fileapi/nf-fileapi-readfile) e [WriteFile](/windows/win32/api/fileapi/nf-fileapi-writefile).</span><span class="sxs-lookup"><span data-stu-id="0e967-106">(Note: the XP1\_IFS\_HANDLES attribute bit was not included in release 2.0.8 of the API specification, but has since been added through the errata mechanism.) Winsock SPI clients may take advantage of providers whose socket descriptors are IFS handles by using these descriptors with standard Windows I/O facilities, such as [ReadFile](/windows/win32/api/fileapi/nf-fileapi-readfile) and [WriteFile](/windows/win32/api/fileapi/nf-fileapi-writefile).</span></span>

<span data-ttu-id="0e967-107">Sempre que um provedor de IFS cria um novo descritor de soquete, é obrigatório que o provedor chame [**WPUModifyIFSHandle**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpumodifyifshandle) antes de fornecer o novo identificador a um cliente SPI do Windows Sockets.</span><span class="sxs-lookup"><span data-stu-id="0e967-107">Whenever an IFS provider creates a new socket descriptor, it is mandatory that the provider call [**WPUModifyIFSHandle**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpumodifyifshandle) prior to supplying the new handle to a Windows Sockets SPI client.</span></span> <span data-ttu-id="0e967-108">Essa função usa um identificador de provedor e um identificador IFS proposto do provedor como entrada e retorna um identificador modificado (possivelmente).</span><span class="sxs-lookup"><span data-stu-id="0e967-108">This function takes a provider identifier and a proposed IFS handle from the provider as input and returns a (possibly) modified handle.</span></span> <span data-ttu-id="0e967-109">O provedor de IFS deve fornecer apenas o identificador modificado para seu cliente e todas as solicitações do cliente referenciarão apenas esse identificador modificado.</span><span class="sxs-lookup"><span data-stu-id="0e967-109">The IFS provider must supply only the modified handle to its client, and all requests from the client will reference only this modified handle.</span></span> <span data-ttu-id="0e967-110">O identificador modificado é garantido como indistinguíveis do identificador proposto no que diz respeito ao sistema operacional.</span><span class="sxs-lookup"><span data-stu-id="0e967-110">The modified handle is guaranteed to be indistinguishable from the proposed handle as far as the operating system is concerned.</span></span> <span data-ttu-id="0e967-111">Portanto, na maioria dos casos, o provedor de serviços simplesmente optará por usar apenas o identificador modificado em todo o seu processamento interno.</span><span class="sxs-lookup"><span data-stu-id="0e967-111">Thus in most instances, the service provider will simply choose to use only the modified handle in all of its internal processing.</span></span> <span data-ttu-id="0e967-112">A finalidade dessa função de modificação é permitir que o32.dll de ws2 \_ simplifique muito o processo de identificação do provedor de serviços associado a um determinado soquete.</span><span class="sxs-lookup"><span data-stu-id="0e967-112">The purpose of this modification function is to allow the Ws2\_32.dll to greatly streamline the process of identifying the service provider associated with a given socket.</span></span>

<span data-ttu-id="0e967-113">Provedores que não retornam identificadores de IFS devem obter um identificador válido do \_32.dll Ws2 por meio da chamada [**WPUCreateSocketHandle**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpucreatesockethandle) .</span><span class="sxs-lookup"><span data-stu-id="0e967-113">Providers that do not return IFS handles must obtain a valid handle from the Ws2\_32.dll via the [**WPUCreateSocketHandle**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpucreatesockethandle) call.</span></span> <span data-ttu-id="0e967-114">O provedor nonIFS deve oferecer apenas um identificador fornecido pelo Windows Sockets 2.DLL ao seu cliente e todas as solicitações do cliente referenciarão somente esses identificadores.</span><span class="sxs-lookup"><span data-stu-id="0e967-114">The nonIFS provider must offer only a Windows Sockets 2.DLL-supplied handle to its client, and all requests from the client will reference only these handles.</span></span> <span data-ttu-id="0e967-115">Como uma conveniência para implementadores de provedores de serviços, um dos parâmetros de entrada fornecidos por um provedor em **WPUCreateSocketHandle** é um valor de contexto DWORD.</span><span class="sxs-lookup"><span data-stu-id="0e967-115">As a convenience to service provider implementers, one of the input parameters supplied by a provider in **WPUCreateSocketHandle** is a DWORD context value.</span></span> <span data-ttu-id="0e967-116">O ws2 \_32.dll associa esse valor de contexto ao identificador de soquete alocado e permite que um provedor de serviços recupere o valor de contexto a qualquer momento por meio da chamada [**WPUQuerySocketHandleContext**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuquerysockethandlecontext) .</span><span class="sxs-lookup"><span data-stu-id="0e967-116">The Ws2\_32.dll associates this context value with the allocated socket handle and allows a service provider to retrieve the context value at any time through the [**WPUQuerySocketHandleContext**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuquerysockethandlecontext) call.</span></span> <span data-ttu-id="0e967-117">Um uso típico para esse valor de contexto seria armazenar um ponteiro para uma estrutura de dados mantida pelo provedor de serviços usada para armazenar informações de estado do soquete.</span><span class="sxs-lookup"><span data-stu-id="0e967-117">A typical use for this context value would be to store a pointer to a service provider maintained data structure used to store socket state information.</span></span>

 

 
