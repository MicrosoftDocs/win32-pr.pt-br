---
description: Noções básicas de protocolo de WSPListen, WSPAccept e WSPConnect para estabelecer uma conexão de soquete com o Windows Sockets (Winsock).
ms.assetid: b1b4d6b9-36db-4000-9c6b-662765b6d091
title: 'Noções básicas de protocolo: escutar, conectar, aceitar'
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d62ef290d71e571154b4d022c24c7e21f8fffa1c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104090363"
---
# <a name="protocol-basics-listen-connect-accept"></a><span data-ttu-id="4715b-103">Noções básicas de protocolo: escutar, conectar, aceitar</span><span class="sxs-lookup"><span data-stu-id="4715b-103">Protocol Basics: Listen, Connect, Accept</span></span>

<span data-ttu-id="4715b-104">As operações básicas envolvidas com o estabelecimento de uma conexão de soquete podem ser mais convenientemente explicadas em termos do paradigma do cliente-servidor.</span><span class="sxs-lookup"><span data-stu-id="4715b-104">The basic operations involved with establishing a socket connection can be most conveniently explained in terms of the client-server paradigm.</span></span>

<span data-ttu-id="4715b-105">O lado do servidor primeiro criará um soquete, o associará a um endereço local conhecido (para que o cliente possa encontrá-lo) e colocará o soquete no modo de escuta, por meio de [**WSPListen**](/previous-versions/windows/hardware/network/ff566297(v=vs.85)), para se preparar para todas as solicitações de conexão de entrada e para especificar o comprimento da fila de pendências de conexão.</span><span class="sxs-lookup"><span data-stu-id="4715b-105">The server side will first create a socket, bind it to a well known local address (so that the client can find it), and put the socket in listening mode, through [**WSPListen**](/previous-versions/windows/hardware/network/ff566297(v=vs.85)), in order to prepare for any incoming connection requests and to specify the length of the connection backlog queue.</span></span> <span data-ttu-id="4715b-106">Os provedores de serviço mantêm solicitações de conexão pendentes em uma fila de lista de pendências até que sejam acionados pelo servidor ou retirados (devido a um tempo limite) pelo cliente.</span><span class="sxs-lookup"><span data-stu-id="4715b-106">Service providers hold pending connection requests in a backlog queue until they are acted upon by the server or are withdrawn (due to a time-out) by the client.</span></span> <span data-ttu-id="4715b-107">Um provedor de serviços pode ignorar silenciosamente as solicitações para estender o tamanho da fila de pendências além de um limite superior definido pelo provedor.</span><span class="sxs-lookup"><span data-stu-id="4715b-107">A service provider may silently ignore requests to extend the size of the backlog queue beyond a provider-defined upper limit.</span></span>

<span data-ttu-id="4715b-108">Neste ponto, se um soquete de bloqueio estiver sendo usado, o lado do servidor poderá chamar imediatamente o [**WSPAccept**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspaccept) , que será bloqueado até que uma solicitação de conexão esteja pendente.</span><span class="sxs-lookup"><span data-stu-id="4715b-108">At this point, if a blocking socket is being used, the server side may immediately call [**WSPAccept**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspaccept) which will block until a connection request is pending.</span></span> <span data-ttu-id="4715b-109">Por outro lado, o servidor também pode usar um dos mecanismos de indicação de evento de rede discutidos anteriormente para organizar a notificação de solicitações de conexão de entrada.</span><span class="sxs-lookup"><span data-stu-id="4715b-109">Conversely, the server may also use one of the network event indication mechanisms discussed previously to arrange for notification of incoming connection requests.</span></span> <span data-ttu-id="4715b-110">Dependendo do mecanismo de notificação selecionado, o provedor emitirá uma mensagem do Windows ou sinalizará um objeto de evento quando as solicitações de conexão chegarem.</span><span class="sxs-lookup"><span data-stu-id="4715b-110">Depending on the notification mechanism selected, the provider will either issue a Windows message or signal an event object when connection requests arrive.</span></span> <span data-ttu-id="4715b-111">Consulte a [notificação de eventos de rede](notification-of-network-events-2.md) para saber como registrar-se para o \_ evento de aceitação de rede FD.</span><span class="sxs-lookup"><span data-stu-id="4715b-111">See [Notification of Network Events](notification-of-network-events-2.md) for how to register for the FD\_ACCEPT network event.</span></span>

<span data-ttu-id="4715b-112">O lado do cliente criará um soquete apropriado e iniciará a conexão chamando [**WSPConnect**](/previous-versions/windows/hardware/network/ff566275(v=vs.85)), especificando o endereço do servidor conhecido.</span><span class="sxs-lookup"><span data-stu-id="4715b-112">The client side will create an appropriate socket, and initiate the connection by calling [**WSPConnect**](/previous-versions/windows/hardware/network/ff566275(v=vs.85)), specifying the known server address.</span></span> <span data-ttu-id="4715b-113">Geralmente, os clientes não executam uma operação de [**ligação**](/windows/desktop/api/winsock/nf-winsock-bind) explícita antes de iniciar uma conexão, permitindo que o provedor de serviços execute uma ligação implícita em seu nome.</span><span class="sxs-lookup"><span data-stu-id="4715b-113">Clients usually do not perform an explicit [**bind**](/windows/desktop/api/winsock/nf-winsock-bind) operation prior to initiating a connection, allowing the service provider to perform an implicit bind on their behalf.</span></span> <span data-ttu-id="4715b-114">Se o soquete estiver no modo de bloqueio, o **WSPConnect** será bloqueado até que o servidor tenha recebido e aprovado na solicitação de conexão (ou até ocorrer um tempo limite).</span><span class="sxs-lookup"><span data-stu-id="4715b-114">If the socket is in blocking mode, **WSPConnect** will block until the server has received and acted upon the connection request (or until a time-out occurs).</span></span> <span data-ttu-id="4715b-115">Caso contrário, o cliente deve usar um dos mecanismos de indicação de evento de rede discutidos anteriormente para organizar a notificação de uma nova conexão estabelecida.</span><span class="sxs-lookup"><span data-stu-id="4715b-115">Otherwise, the client should use one of the network event indication mechanisms discussed previously to arrange for notification of a new connection being established.</span></span> <span data-ttu-id="4715b-116">Dependendo do mecanismo de notificação selecionado, o provedor indicará isso por meio de uma mensagem do Windows ou sinalizando um objeto de evento.</span><span class="sxs-lookup"><span data-stu-id="4715b-116">Depending on the notification mechanism selected, the provider will indicate this either through a Windows message or by signaling an event object.</span></span>

<span data-ttu-id="4715b-117">Quando o lado do servidor invoca [**WSPAccept**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspaccept), o provedor de serviços chama a função de condição fornecida pelo aplicativo, usando parâmetros de função para passar as informações do servidor da entrada superior na fila de pendências de solicitação de conexão.</span><span class="sxs-lookup"><span data-stu-id="4715b-117">When the server side invokes [**WSPAccept**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspaccept), the service provider calls the application-supplied condition function, using function parameters to pass into the server information from the top entry in the connection request backlog queue.</span></span> <span data-ttu-id="4715b-118">Essas informações incluem itens como endereço de host de conexão, qualquer dado de usuário disponível e qualquer informação de QoS disponível.</span><span class="sxs-lookup"><span data-stu-id="4715b-118">This information includes such things as address of connecting host, any available user data, and any available QoS information.</span></span> <span data-ttu-id="4715b-119">Usando essas informações, a função Condition do servidor determina se deve aceitar a solicitação, rejeitar a solicitação ou adiar a tomada de decisão até mais tarde.</span><span class="sxs-lookup"><span data-stu-id="4715b-119">Using this information the server's condition function determines whether to accept the request, reject the request, or defer making a decision until later.</span></span> <span data-ttu-id="4715b-120">Essa decisão é indicada por meio do valor de retorno da função Condition.</span><span class="sxs-lookup"><span data-stu-id="4715b-120">This decision is indicated through the return value of the condition function.</span></span> <span data-ttu-id="4715b-121">Consulte a [notificação de eventos de rede](notification-of-network-events-2.md) para saber como registrar- \_ se no evento de rede do FD Connect.</span><span class="sxs-lookup"><span data-stu-id="4715b-121">See [Notification of Network Events](notification-of-network-events-2.md) for how to register for the FD\_CONNECT network event.</span></span>

<span data-ttu-id="4715b-122">Se o servidor decidir aceitar a solicitação, o provedor deverá criar um novo soquete com todos os mesmos atributos e registros de eventos que o soquete de escuta.</span><span class="sxs-lookup"><span data-stu-id="4715b-122">If the server decides to accept the request, the provider must create a new socket with all of the same attributes and event registrations as the listening socket.</span></span> <span data-ttu-id="4715b-123">O soquete original permanece no estado de escuta para que as solicitações de conexão subsequentes possam ser recebidas.</span><span class="sxs-lookup"><span data-stu-id="4715b-123">The original socket remains in the listening state so that subsequent connection requests can be received.</span></span> <span data-ttu-id="4715b-124">Por meio de parâmetros de saída da função Condition, o servidor também pode fornecer quaisquer dados do usuário de resposta e atribuir parâmetros de QoS (supondo que essas operações sejam compatíveis com o provedor de serviços).</span><span class="sxs-lookup"><span data-stu-id="4715b-124">Through output parameters of the condition function, the server may also supply any response user data and assign QoS parameters (assuming that these operations are supported by the service provider).</span></span>

 

 
