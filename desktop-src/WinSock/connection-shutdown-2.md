---
description: O seguinte descreve o incidente de operações para desligar uma conexão de soquete estabelecida.
ms.assetid: 052e04a4-5290-4dca-af7a-cd590ebfbe15
title: Desligamento de conexão
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bbde0cfe4c3a97435c2412d28970107f830308fd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103827120"
---
# <a name="connection-shutdown"></a><span data-ttu-id="55565-103">Desligamento de conexão</span><span class="sxs-lookup"><span data-stu-id="55565-103">Connection Shutdown</span></span>

<span data-ttu-id="55565-104">O seguinte descreve o incidente de operações para desligar uma conexão de soquete estabelecida.</span><span class="sxs-lookup"><span data-stu-id="55565-104">The following describes operations incident to shutting down an established socket connection.</span></span>

## <a name="initiating-shutdown-sequence"></a><span data-ttu-id="55565-105">Iniciando sequência de desligamento</span><span class="sxs-lookup"><span data-stu-id="55565-105">Initiating Shutdown Sequence</span></span>

<span data-ttu-id="55565-106">Uma conexão de soquete pode ser retirada de várias maneiras.</span><span class="sxs-lookup"><span data-stu-id="55565-106">A socket connection can be taken down in one of several ways.</span></span> <span data-ttu-id="55565-107">[**WSPShutdown**](/previous-versions/windows/desktop/legacy/ms742294(v=vs.85)) (com *o* igual a SD \_ Send ou SD \_ both) e [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) pode ser usado para iniciar um desligamento de conexão normal.</span><span class="sxs-lookup"><span data-stu-id="55565-107">[**WSPShutdown**](/previous-versions/windows/desktop/legacy/ms742294(v=vs.85)) (with *how* equal to SD\_SEND or SD\_BOTH), and [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) may be used to initiate a graceful connection shutdown.</span></span> <span data-ttu-id="55565-108">O [**WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85)) pode ser usado para iniciar um desligamento normal ou de anulação, dependendo das opções remanescentes invocadas pelo fechamento de um soquete.</span><span class="sxs-lookup"><span data-stu-id="55565-108">[**WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85)) can be used to initiate either a graceful or abortive shutdown, depending on the linger options invoked by the closing a socket.</span></span> <span data-ttu-id="55565-109">Consulte abaixo para obter mais informações sobre desligamentos normais e anuláveis e opções remanescentes.</span><span class="sxs-lookup"><span data-stu-id="55565-109">See below for more information about graceful and abortive shutdowns, and linger options.</span></span>

## <a name="indicating-remote-shutdown"></a><span data-ttu-id="55565-110">Indicando o desligamento remoto</span><span class="sxs-lookup"><span data-stu-id="55565-110">Indicating Remote Shutdown</span></span>

<span data-ttu-id="55565-111">Provedores de serviço indicam a desmontagem de conexão que é iniciada pela parte remota por meio do \_ evento FD Close Network.</span><span class="sxs-lookup"><span data-stu-id="55565-111">Service providers indicate connection teardown that is initiated by the remote party through the FD\_CLOSE network event.</span></span> <span data-ttu-id="55565-112">O desligamento normal também é indicado por meio de [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) quando o número de bytes lidos é 0 para protocolos de fluxo de bytes ou por meio de um código de erro de retorno de WSAEDISCON para protocolos orientados a mensagens.</span><span class="sxs-lookup"><span data-stu-id="55565-112">Graceful shutdown is also be indicated through [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) when the number of bytes read is 0 for byte-stream protocols, or through a return error code of WSAEDISCON for message-oriented protocols.</span></span> <span data-ttu-id="55565-113">Em qualquer caso, um código de erro **WSPRecv** de retorno de WSAECONNRESET indica um desligamento anulado.</span><span class="sxs-lookup"><span data-stu-id="55565-113">In any case, a **WSPRecv** return error code of WSAECONNRESET indicates an abortive shutdown.</span></span>

## <a name="exchanging-user-data-at-shutdown-time"></a><span data-ttu-id="55565-114">Trocando dados do usuário no momento do desligamento</span><span class="sxs-lookup"><span data-stu-id="55565-114">Exchanging User Data at Shutdown Time</span></span>

<span data-ttu-id="55565-115">No momento da desmontagem da conexão, também é possível (para protocolos que dão suporte a isso) para trocar dados de usuário entre os pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="55565-115">At connection teardown time, it is also possible (for protocols that support this) to exchange user data between the endpoints.</span></span> <span data-ttu-id="55565-116">O final que inicia a desmontagem pode chamar [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) para indicar que não é mais possível enviar mais dados e fazer com que a sequência de subdivisão de conexão seja iniciada.</span><span class="sxs-lookup"><span data-stu-id="55565-116">The end that initiates the teardown can call [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) to indicate that no more data is to be sent and cause the connection teardown sequence to be initiated.</span></span> <span data-ttu-id="55565-117">Para determinados protocolos, parte dessa sequência de desmontagem é a entrega de dados desconectados do iniciador de desmontagem.</span><span class="sxs-lookup"><span data-stu-id="55565-117">For certain protocols, part of this teardown sequence is the delivery of disconnect data from the teardown initiator.</span></span> <span data-ttu-id="55565-118">Depois de receber o aviso de que a extremidade remota iniciou a sequência de desmontagem (normalmente por meio da \_ indicação de fechamento FD), a função [**WSPRecvDisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) pode ser chamada para receber os dados de desconexão (se houver).</span><span class="sxs-lookup"><span data-stu-id="55565-118">After receiving notice that the remote end has initiated the teardown sequence (typically through the FD\_CLOSE indication), the [**WSPRecvDisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) function may be called to receive the disconnect data (if any).</span></span>

<span data-ttu-id="55565-119">Para ilustrar como os dados de desconexão podem ser usados, considere o cenário a seguir.</span><span class="sxs-lookup"><span data-stu-id="55565-119">To illustrate how disconnect data might be used, consider the following scenario.</span></span> <span data-ttu-id="55565-120">A metade do cliente de um aplicativo cliente/servidor é responsável por encerrar uma conexão de soquete.</span><span class="sxs-lookup"><span data-stu-id="55565-120">The client half of a client/server application is responsible for terminating a socket connection.</span></span> <span data-ttu-id="55565-121">Coincidente com o encerramento que ele fornece (por meio de dados de desconexão) o número total de transações processadas com o servidor.</span><span class="sxs-lookup"><span data-stu-id="55565-121">Coincident with the termination it provides (through disconnect data) the total number of transactions it processed with the server.</span></span> <span data-ttu-id="55565-122">O servidor, por sua vez, responde com o total geral cumulativo de transações processadas com todos os clientes.</span><span class="sxs-lookup"><span data-stu-id="55565-122">The server in turn responds with the cumulative grand total of transactions that it has processed with all clients.</span></span> <span data-ttu-id="55565-123">A sequência de chamadas e indicações pode ocorrer conforme mostrado na tabela a seguir.</span><span class="sxs-lookup"><span data-stu-id="55565-123">The sequence of calls and indications might occur as shown in the following table.</span></span>

| <span data-ttu-id="55565-124">Lado do cliente</span><span class="sxs-lookup"><span data-stu-id="55565-124">Client side</span></span>                                                                                                               | <span data-ttu-id="55565-125">Lado do Servidor</span><span class="sxs-lookup"><span data-stu-id="55565-125">Server side</span></span>                                                                                                                             |
|---------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="55565-126">(1) invoca [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) para concluir a sessão e fornecer o total da transação.</span><span class="sxs-lookup"><span data-stu-id="55565-126">(1) Invokes [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) to conclude session and supply transaction total.</span></span>            |                                                                                                                                         |
|                                                                                                                           | <span data-ttu-id="55565-127">(2) obtém FD \_ Close ou [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) com um valor de retorno de zero ou WSAEDISCON indicando que o desligamento normal está em andamento.</span><span class="sxs-lookup"><span data-stu-id="55565-127">(2) Gets FD\_CLOSE, or [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) with a return value of zero or WSAEDISCON indicating graceful shutdown in progress.</span></span> |
|                                                                                                                           | <span data-ttu-id="55565-128">(3) invoca [**WSPRecvDisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) para obter o total da transação do cliente.</span><span class="sxs-lookup"><span data-stu-id="55565-128">(3) Invokes [**WSPRecvDisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) to get client's transaction total.</span></span>                                         |
|                                                                                                                           | <span data-ttu-id="55565-129">(4) computa o total geral cumulativo de todas as transações.</span><span class="sxs-lookup"><span data-stu-id="55565-129">(4) Computes cumulative grand total of all transactions.</span></span>                                                                                |
|                                                                                                                           | <span data-ttu-id="55565-130">(5) invoca [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) para transmitir total geral.</span><span class="sxs-lookup"><span data-stu-id="55565-130">(5) Invokes [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) to transmit grand total.</span></span>                                                   |
| <span data-ttu-id="55565-131">(6) recebe a \_ indicação de fechamento FD.</span><span class="sxs-lookup"><span data-stu-id="55565-131">(6) Receives FD\_CLOSE indication.</span></span>                                                                                        | <span data-ttu-id="55565-132">(5 ') invoca [ **WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="55565-132">(5') Invokes [**WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85))</span></span>                                                                                 |
| <span data-ttu-id="55565-133">(7) invoca [**WSPRecvDisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) para receber e armazenar o total geral cumulativo de transações.</span><span class="sxs-lookup"><span data-stu-id="55565-133">(7) Invokes [**WSPRecvDisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) to receive and store cumulative grand total of transactions.</span></span> |                                                                                                                                         |
|                                                                                                                           | <span data-ttu-id="55565-134">(8) invoca [ **WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="55565-134">(8) Invokes [**WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85))</span></span>                                                                                  |



 

<span data-ttu-id="55565-135">A etapa (5 ') deve seguir a etapa (5), mas não tem relação de tempo com as etapas (6), (7) ou (8).</span><span class="sxs-lookup"><span data-stu-id="55565-135">Step (5') must follow step (5), but has no timing relationship with steps (6), (7), or (8).</span></span>

 

 
