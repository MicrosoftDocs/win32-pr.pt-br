---
description: A função WSAAccept permite que um aplicativo Obtenha informações do chamador, como o identificador do chamador e a qualidade do serviço, antes de decidir se deve aceitar uma solicitação de conexão de entrada.
ms.assetid: 65883556-6890-4d0a-8c7f-c4ff68642caf
title: Configuração e desmontagem da conexão
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f9c4ac1f32524d097e11825f8104eb41fee3c528
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105763224"
---
# <a name="connection-setup-and-teardown"></a><span data-ttu-id="16f0d-103">Configuração e desmontagem da conexão</span><span class="sxs-lookup"><span data-stu-id="16f0d-103">Connection Setup and Teardown</span></span>

<span data-ttu-id="16f0d-104">A função [**WSAAccept**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept) permite que um aplicativo Obtenha informações do chamador, como o identificador do chamador e a qualidade do serviço, antes de decidir se deve aceitar uma solicitação de conexão de entrada.</span><span class="sxs-lookup"><span data-stu-id="16f0d-104">The [**WSAAccept**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept) function lets an application obtain caller information such as caller identifier and Quality of Service before deciding whether to accept an incoming connection request.</span></span> <span data-ttu-id="16f0d-105">Isso é feito com um retorno de chamada para uma função de condição fornecida pelo aplicativo.</span><span class="sxs-lookup"><span data-stu-id="16f0d-105">This is done with a callback to an application-supplied condition function.</span></span>

<span data-ttu-id="16f0d-106">Os dados de usuário para usuário especificados por parâmetros na função [**WSAConnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsaconnect) e a função Condition de [**WSAAccept**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept) podem ser transferidos para o par durante o estabelecimento da conexão, desde que esse recurso seja suportado pelo provedor de serviços.</span><span class="sxs-lookup"><span data-stu-id="16f0d-106">User-to-user data specified by parameters in the [**WSAConnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsaconnect) function and the condition function of [**WSAAccept**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept) can be transferred to the peer during connection establishment, provided this feature is supported by the service provider.</span></span>

<span data-ttu-id="16f0d-107">Também é possível (para protocolos que dão suporte a isso) para trocar dados de usuário entre os pontos de extremidade no momento da desmontagem da conexão.</span><span class="sxs-lookup"><span data-stu-id="16f0d-107">It is also possible (for protocols that support this) to exchange user data between the endpoints at connection teardown time.</span></span> <span data-ttu-id="16f0d-108">O final que inicia a desmontagem pode chamar a função [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) para indicar que não é mais possível enviar mais dados e iniciar a sequência de divisão de conexão.</span><span class="sxs-lookup"><span data-stu-id="16f0d-108">The end that initiates the teardown can call the [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) function to indicate that no more data be sent and to initiate the connection teardown sequence.</span></span> <span data-ttu-id="16f0d-109">Para determinados protocolos, parte da desmontagem é a entrega de dados desconectados do iniciador de desmontagem.</span><span class="sxs-lookup"><span data-stu-id="16f0d-109">For certain protocols, part of teardown is the delivery of disconnect data from the teardown initiator.</span></span> <span data-ttu-id="16f0d-110">Após o recebimento do aviso de que a extremidade remota iniciou a subdivisão (normalmente pela \_ indicação de fechamento FD), a função [**WSARecvDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) pode ser chamada para receber os dados de desconexão, se houver.</span><span class="sxs-lookup"><span data-stu-id="16f0d-110">After receiving notice that the remote end has initiated teardown (typically by the FD\_CLOSE indication), the [**WSARecvDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) function can be called to receive the disconnect data, if any.</span></span>

<span data-ttu-id="16f0d-111">Para ilustrar como os dados de desconexão podem ser usados, considere o cenário a seguir.</span><span class="sxs-lookup"><span data-stu-id="16f0d-111">To illustrate how disconnect data can be used, consider the following scenario.</span></span> <span data-ttu-id="16f0d-112">A metade do cliente de um aplicativo cliente/servidor é responsável por encerrar uma conexão de soquete.</span><span class="sxs-lookup"><span data-stu-id="16f0d-112">The client half of a client/server application is responsible for terminating a socket connection.</span></span> <span data-ttu-id="16f0d-113">Coincidente com o encerramento, ele fornece (usando dados de desconexão) o número total de transações processadas com o servidor.</span><span class="sxs-lookup"><span data-stu-id="16f0d-113">Coincident with the termination, it provides (using disconnect data) the total number of transactions it processed with the server.</span></span> <span data-ttu-id="16f0d-114">O servidor, por sua vez, responde com o total cumulativo de transações processadas com todos os clientes.</span><span class="sxs-lookup"><span data-stu-id="16f0d-114">The server in turn responds with the cumulative total of transactions that it has processed with all clients.</span></span> <span data-ttu-id="16f0d-115">A sequência de chamadas e indicações pode ocorrer da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="16f0d-115">The sequence of calls and indications might occur as follows:</span></span>

| <span data-ttu-id="16f0d-116">Lado do cliente</span><span class="sxs-lookup"><span data-stu-id="16f0d-116">Client side</span></span>                                                                                                              | <span data-ttu-id="16f0d-117">Lado do Servidor</span><span class="sxs-lookup"><span data-stu-id="16f0d-117">Server side</span></span>                                                                                                                                                                                                                   |
|--------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="16f0d-118">(1) invocar [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) para concluir a sessão e fornecer o total da transação.</span><span class="sxs-lookup"><span data-stu-id="16f0d-118">(1) Invoke [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) to conclude session and supply transaction total.</span></span>            |                                                                                                                                                                                                                               |
|                                                                                                                          | <span data-ttu-id="16f0d-119">(2) obter FD \_ Close, [**recv**](/windows/desktop/api/winsock/nf-winsock-recv) com um valor de retorno igual a zero ou [WSAEDISCON](windows-sockets-error-codes-2.md) retorno de erro de [**WSARecv**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv) indicando que o desligamento normal está em andamento.</span><span class="sxs-lookup"><span data-stu-id="16f0d-119">(2) Get FD\_CLOSE, [**recv**](/windows/desktop/api/winsock/nf-winsock-recv) with a return value of zero, or [WSAEDISCON](windows-sockets-error-codes-2.md) error return from [**WSARecv**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv) indicating graceful shutdown in progress.</span></span> |
|                                                                                                                          | <span data-ttu-id="16f0d-120">(3) invocar [**WSARecvDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) para obter o total da transação do cliente.</span><span class="sxs-lookup"><span data-stu-id="16f0d-120">(3) Invoke [**WSARecvDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) to get client's transaction total.</span></span>                                                                                                                                |
|                                                                                                                          | <span data-ttu-id="16f0d-121">(4) total da computação cumulativa geral de todas as transações.</span><span class="sxs-lookup"><span data-stu-id="16f0d-121">(4) Compute cumulative grand total of all transactions.</span></span>                                                                                                                                                                       |
|                                                                                                                          | <span data-ttu-id="16f0d-122">(5) invocar [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) para transmitir total geral.</span><span class="sxs-lookup"><span data-stu-id="16f0d-122">(5) Invoke [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) to transmit grand total.</span></span>                                                                                                                                          |
| <span data-ttu-id="16f0d-123">(6) receber \_ indicação de fechamento FD.</span><span class="sxs-lookup"><span data-stu-id="16f0d-123">(6) Receive FD\_CLOSE indication.</span></span>                                                                                        | <span data-ttu-id="16f0d-124">(5A) invocar [**fechamento**](/windows/desktop/api/winsock/nf-winsock-closesocket).</span><span class="sxs-lookup"><span data-stu-id="16f0d-124">(5a) Invoke [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket).</span></span>                                                                                                                                                                             |
| <span data-ttu-id="16f0d-125">(7) invocar [**WSARecvDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) para receber e armazenar o total geral cumulativo de transações.</span><span class="sxs-lookup"><span data-stu-id="16f0d-125">(7) Invoke [**WSARecvDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) to receive and store cumulative grand total of transactions.</span></span> |                                                                                                                                                                                                                               |
| <span data-ttu-id="16f0d-126">(8) invocar [ **fechamento**](/windows/desktop/api/winsock/nf-winsock-closesocket)</span><span class="sxs-lookup"><span data-stu-id="16f0d-126">(8) Invoke [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket)</span></span>                                                                          |                                                                                                                                                                                                                               |



 

<span data-ttu-id="16f0d-127">Observe que a etapa (5A) deve seguir a etapa (5), mas não tem nenhuma relação de tempo com a etapa (6), (7) ou (8).</span><span class="sxs-lookup"><span data-stu-id="16f0d-127">Note that step (5a) must follow step (5), but has no timing relationship with step (6), (7), or (8).</span></span>

 

 



