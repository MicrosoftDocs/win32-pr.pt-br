---
description: Solicita como a pilha de rede deve lidar com determinados comportamentos para os quais a maneira padrão de manipular o comportamento pode ser diferente nas versões do Windows.
ms.assetid: 9574e21f-5ac4-4210-8031-2f3b07416813
title: SIO_SET_COMPATIBILITY_MODE código de controle
ms.topic: reference
ms.date: 05/20/2019
req.target-min-winverclnt: Windows Vista [desktop apps only]
req.target-min-winversvr: Windows Server 2008 [desktop apps only]
api_location:
- mstcpip.h
ms.openlocfilehash: 58972595adb71a30728cb4817a80814cd987a6de
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105802153"
---
# <a name="sio_set_compatibility_mode-control-code"></a><span data-ttu-id="ecb48-103">SIO_SET_COMPATIBILITY_MODE código de controle</span><span class="sxs-lookup"><span data-stu-id="ecb48-103">SIO_SET_COMPATIBILITY_MODE Control Code</span></span>

## <a name="description"></a><span data-ttu-id="ecb48-104">Descrição</span><span class="sxs-lookup"><span data-stu-id="ecb48-104">Description</span></span>

<span data-ttu-id="ecb48-105">O código de controle do **\_ \_ \_ modo de compatibilidade Set sio** solicita como a pilha de rede deve lidar com determinados comportamentos para os quais a maneira padrão de manipular o comportamento pode ser diferente nas versões do Windows.</span><span class="sxs-lookup"><span data-stu-id="ecb48-105">The **SIO\_SET\_COMPATIBILITY\_MODE** control code requests how the networking stack should handle certain behaviors for which the default way of handling the behavior may differ across Windows versions.</span></span>

<span data-ttu-id="ecb48-106">Para executar essa operação, chame a função [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) ou **WSPIoctl** com os parâmetros a seguir.</span><span class="sxs-lookup"><span data-stu-id="ecb48-106">To perform this operation, call the [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) or **WSPIoctl** function with the following parameters.</span></span>

```cpp
int WSAIoctl(
  (socket) s,             // descriptor identifying a socket
  SIO_SET_COMPATIBILITY_MODE, // dwIoControlCode
  (LPVOID) lpvInBuffer,    // pointer to WSA_COMPATIBILITY_MODE struct
  (DWORD) cbInBuffer,      // length of input buffer
  NULL,         // output buffer
  0,       // size of output buffer
  (LPDWORD) lpcbBytesReturned,    // number of bytes returned
  (LPWSAOVERLAPPED) lpOverlapped,   // OVERLAPPED structure
  (LPWSAOVERLAPPED_COMPLETION_ROUTINE) lpCompletionRoutine,  // completion routine
);
```

```cpp
int WSPIoctl(
  (socket) s,             // descriptor identifying a socket
  SIO_SET_COMPATIBILITY_MODE, // dwIoControlCode
  (LPVOID) lpvInBuffer,    // pointer to WSA_COMPATIBILITY_MODE struct
  (DWORD) cbInBuffer,      // length of input buffer
  NULL,         // output buffer
  0,       // size of output buffer
  (LPDWORD) lpcbBytesReturned,    // number of bytes returned
  (LPWSAOVERLAPPED) lpOverlapped,   // OVERLAPPED structure
  (LPWSAOVERLAPPED_COMPLETION_ROUTINE) lpCompletionRoutine,  // completion routine
  (LPWSATHREADID) lpThreadId,   // a WSATHREADID structure
  (LPINT) lpErrno   // a pointer to the error code.
);
```

## <a name="parameters"></a><span data-ttu-id="ecb48-107">Parâmetros</span><span class="sxs-lookup"><span data-stu-id="ecb48-107">Parameters</span></span>

### <a name="s"></a><span data-ttu-id="ecb48-108">s</span><span class="sxs-lookup"><span data-stu-id="ecb48-108">s</span></span>

<span data-ttu-id="ecb48-109">Um descritor que identifica um soquete.</span><span class="sxs-lookup"><span data-stu-id="ecb48-109">A descriptor identifying a socket.</span></span>

### <a name="dwiocontrolcode"></a><span data-ttu-id="ecb48-110">dwIoControlCode</span><span class="sxs-lookup"><span data-stu-id="ecb48-110">dwIoControlCode</span></span>

<span data-ttu-id="ecb48-111">O código de controle para a operação.</span><span class="sxs-lookup"><span data-stu-id="ecb48-111">The control code for the operation.</span></span>
<span data-ttu-id="ecb48-112">Use **o \_ \_ \_ modo de compatibilidade definir sio** para esta operação.</span><span class="sxs-lookup"><span data-stu-id="ecb48-112">Use **SIO\_SET\_COMPATIBILITY\_MODE** for this operation.</span></span>

### <a name="lpvinbuffer"></a><span data-ttu-id="ecb48-113">lpvInBuffer</span><span class="sxs-lookup"><span data-stu-id="ecb48-113">lpvInBuffer</span></span>

<span data-ttu-id="ecb48-114">Um ponteiro para o buffer de entrada.</span><span class="sxs-lookup"><span data-stu-id="ecb48-114">A pointer to the input buffer.</span></span>
<span data-ttu-id="ecb48-115">Esse parâmetro deve apontar para uma estrutura de **\_ \_ modo de compatibilidade de WSA** .</span><span class="sxs-lookup"><span data-stu-id="ecb48-115">This parameter should point to a **WSA\_COMPATIBILITY\_MODE** structure.</span></span>

### <a name="cbinbuffer"></a><span data-ttu-id="ecb48-116">cbInBuffer</span><span class="sxs-lookup"><span data-stu-id="ecb48-116">cbInBuffer</span></span>

<span data-ttu-id="ecb48-117">O tamanho, em bytes, do buffer de entrada.</span><span class="sxs-lookup"><span data-stu-id="ecb48-117">The size, in bytes, of the input buffer.</span></span>
<span data-ttu-id="ecb48-118">Esse parâmetro deve ser igual ou maior que o tamanho da estrutura **do \_ \_ modo de compatibilidade de WSA** apontada pelo parâmetro *lpvInBuffer* .</span><span class="sxs-lookup"><span data-stu-id="ecb48-118">This parameter should equal to or greater than the size of the **WSA\_COMPATIBILITY\_MODE** structure pointed to by the *lpvInBuffer* parameter.</span></span>

### <a name="lpvoutbuffer"></a><span data-ttu-id="ecb48-119">lpvOutBuffer</span><span class="sxs-lookup"><span data-stu-id="ecb48-119">lpvOutBuffer</span></span>

<span data-ttu-id="ecb48-120">Um ponteiro para o buffer de saída.</span><span class="sxs-lookup"><span data-stu-id="ecb48-120">A pointer to the output buffer.</span></span>
<span data-ttu-id="ecb48-121">Este parâmetro não é usado para esta operação.</span><span class="sxs-lookup"><span data-stu-id="ecb48-121">This parameter is unused for this operation.</span></span>

### <a name="cboutbuffer"></a><span data-ttu-id="ecb48-122">cbOutBuffer</span><span class="sxs-lookup"><span data-stu-id="ecb48-122">cbOutBuffer</span></span>

<span data-ttu-id="ecb48-123">O tamanho, em bytes, do buffer de saída.</span><span class="sxs-lookup"><span data-stu-id="ecb48-123">The size, in bytes, of the output buffer.</span></span>
<span data-ttu-id="ecb48-124">Esse parâmetro deve ser definido como zero.</span><span class="sxs-lookup"><span data-stu-id="ecb48-124">This parameter must be set to zero.</span></span>

### <a name="lpcbbytesreturned"></a><span data-ttu-id="ecb48-125">lpcbBytesReturned</span><span class="sxs-lookup"><span data-stu-id="ecb48-125">lpcbBytesReturned</span></span>

<span data-ttu-id="ecb48-126">Um ponteiro para uma variável que recebe o tamanho, em bytes, dos dados armazenados no buffer de saída.</span><span class="sxs-lookup"><span data-stu-id="ecb48-126">A pointer to a variable that receives the size, in bytes, of the data stored in the output buffer.</span></span>
<span data-ttu-id="ecb48-127">Esse parâmetro retornado aponta para um valor **DWORD** de zero para esta operação, pois não há nenhuma saída.</span><span class="sxs-lookup"><span data-stu-id="ecb48-127">This returned parameter points to a **DWORD** value of zero for this operation, since there is no output.</span></span>

### <a name="lpvoverlapped"></a><span data-ttu-id="ecb48-128">lpvOverlapped</span><span class="sxs-lookup"><span data-stu-id="ecb48-128">lpvOverlapped</span></span>

<span data-ttu-id="ecb48-129">Um ponteiro para uma estrutura [**WSAOVERLAPPED**](/windows/desktop/api/winsock2/ns-winsock2-wsaoverlapped) .</span><span class="sxs-lookup"><span data-stu-id="ecb48-129">A pointer to a [**WSAOVERLAPPED**](/windows/desktop/api/winsock2/ns-winsock2-wsaoverlapped) structure.</span></span>

<span data-ttu-id="ecb48-130">Se o soquete *s* foi criado sem o atributo sobreposto, o parâmetro *lpOverlapped* será ignorado.</span><span class="sxs-lookup"><span data-stu-id="ecb48-130">If socket *s* was created without the overlapped attribute, the *lpOverlapped* parameter is ignored.</span></span>

<span data-ttu-id="ecb48-131">Se *s* foi aberto com o atributo Overlapped e o parâmetro *LpOverlapped* não for **nulo**, a operação será executada como uma operação sobreposta (assíncrona).</span><span class="sxs-lookup"><span data-stu-id="ecb48-131">If *s* was opened with the overlapped attribute and the *lpOverlapped* parameter is not **NULL**, the operation is performed as an overlapped (asynchronous) operation.</span></span>
<span data-ttu-id="ecb48-132">Nesse caso, o parâmetro *lpOverlapped* deve apontar para uma estrutura [**WSAOVERLAPPED**](/windows/desktop/api/winsock2/ns-winsock2-wsaoverlapped) válida.</span><span class="sxs-lookup"><span data-stu-id="ecb48-132">In this case, *lpOverlapped* parameter must point to a valid [**WSAOVERLAPPED**](/windows/desktop/api/winsock2/ns-winsock2-wsaoverlapped) structure.</span></span>

<span data-ttu-id="ecb48-133">Para operações sobrepostas, a função [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) ou **WSPIoctl** retorna imediatamente, e o método de conclusão apropriado é sinalizado quando a operação é concluída.</span><span class="sxs-lookup"><span data-stu-id="ecb48-133">For overlapped operations, the [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) or **WSPIoctl** function returns immediately, and the appropriate completion method is signaled when the operation has been completed.</span></span>
<span data-ttu-id="ecb48-134">Caso contrário, a função não retorna até que a operação seja concluída ou um erro ocorra.</span><span class="sxs-lookup"><span data-stu-id="ecb48-134">Otherwise, the function does not return until the operation has been completed or an error occurs.</span></span>

### <a name="lpcompletionroutine"></a><span data-ttu-id="ecb48-135">lpCompletionRoutine</span><span class="sxs-lookup"><span data-stu-id="ecb48-135">lpCompletionRoutine</span></span>

<span data-ttu-id="ecb48-136">Tipo: \_ In_opt \_ [ **LPWSAOVERLAPPED_COMPLETION_ROUTINE**](/windows/win32/api/winsock2/nc-winsock2-lpwsaoverlapped_completion_routine)</span><span class="sxs-lookup"><span data-stu-id="ecb48-136">Type: \_In_opt\_ [**LPWSAOVERLAPPED_COMPLETION_ROUTINE**](/windows/win32/api/winsock2/nc-winsock2-lpwsaoverlapped_completion_routine)</span></span>

<span data-ttu-id="ecb48-137">Um ponteiro para a rotina de conclusão chamada quando a operação foi concluída (ignorada para soquetes não sobrepostos).</span><span class="sxs-lookup"><span data-stu-id="ecb48-137">A pointer to the completion routine called when the operation has been completed (ignored for non-overlapped sockets).</span></span>

### <a name="lpthreadid"></a><span data-ttu-id="ecb48-138">lpThreadId</span><span class="sxs-lookup"><span data-stu-id="ecb48-138">lpThreadId</span></span>

<span data-ttu-id="ecb48-139">Um ponteiro para uma estrutura [**WSATHREADID**](/windows/desktop/api/ws2spi/ns-ws2spi-wsathreadid) a ser usado pelo provedor em uma chamada subsequente para [**WPUQueueApc**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc).</span><span class="sxs-lookup"><span data-stu-id="ecb48-139">A pointer to a [**WSATHREADID**](/windows/desktop/api/ws2spi/ns-ws2spi-wsathreadid) structure to be used by the provider in a subsequent call to [**WPUQueueApc**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc).</span></span>
<span data-ttu-id="ecb48-140">O provedor deve armazenar a estrutura [**WSATHREADID**](/windows/desktop/api/ws2spi/ns-ws2spi-wsathreadid) referenciada (não o ponteiro para o mesmo) até que a função [**WPUQueueApc**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc) seja retornada.</span><span class="sxs-lookup"><span data-stu-id="ecb48-140">The provider should store the referenced [**WSATHREADID**](/windows/desktop/api/ws2spi/ns-ws2spi-wsathreadid) structure (not the pointer to same) until after the [**WPUQueueApc**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc) function returns.</span></span>

<span data-ttu-id="ecb48-141">**Observação**  Esse parâmetro se aplica somente à função **WSPIoctl** .</span><span class="sxs-lookup"><span data-stu-id="ecb48-141">**Note**  This parameter applies only to the **WSPIoctl** function.</span></span>

### <a name="lperrno"></a><span data-ttu-id="ecb48-142">lpErrno</span><span class="sxs-lookup"><span data-stu-id="ecb48-142">lpErrno</span></span>

<span data-ttu-id="ecb48-143">Um ponteiro para o código de erro.</span><span class="sxs-lookup"><span data-stu-id="ecb48-143">A pointer to the error code.</span></span>

<span data-ttu-id="ecb48-144">**Observação**  Esse parâmetro se aplica somente à função **WSPIoctl** .</span><span class="sxs-lookup"><span data-stu-id="ecb48-144">**Note**  This parameter applies only to the **WSPIoctl** function.</span></span>

## <a name="return-value"></a><span data-ttu-id="ecb48-145">Retornar valor</span><span class="sxs-lookup"><span data-stu-id="ecb48-145">Return value</span></span>

<span data-ttu-id="ecb48-146">Se a operação for concluída com êxito, a função [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) ou **WSPIoctl** retornará zero.</span><span class="sxs-lookup"><span data-stu-id="ecb48-146">If the operation completes successfully, the [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) or **WSPIoctl** function returns zero.</span></span>

<span data-ttu-id="ecb48-147">Se a operação falhar ou estiver pendente, a função [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) ou **WSPIoctl** retornará **um \_ erro de soquete**.</span><span class="sxs-lookup"><span data-stu-id="ecb48-147">If the operation fails or is pending, the [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) or **WSPIoctl** function returns **SOCKET\_ERROR**.</span></span>
<span data-ttu-id="ecb48-148">Para obter informações de erro estendidas, chame [**WSAGetLastError**](/windows/desktop/api/winsock/nf-winsock-wsagetlasterror).</span><span class="sxs-lookup"><span data-stu-id="ecb48-148">To get extended error information, call [**WSAGetLastError**](/windows/desktop/api/winsock/nf-winsock-wsagetlasterror).</span></span>

| <span data-ttu-id="ecb48-149">Código do erro</span><span class="sxs-lookup"><span data-stu-id="ecb48-149">Error code</span></span> | <span data-ttu-id="ecb48-150">Significado</span><span class="sxs-lookup"><span data-stu-id="ecb48-150">Meaning</span></span> |
|------------|---------|
| <span data-ttu-id="ecb48-151">**\_e/s de WSA \_ pendente**</span><span class="sxs-lookup"><span data-stu-id="ecb48-151">**WSA\_IO\_PENDING**</span></span> | <span data-ttu-id="ecb48-152">Uma operação sobreposta foi iniciada com êxito e a conclusão será indicada em um momento posterior.</span><span class="sxs-lookup"><span data-stu-id="ecb48-152">An overlapped operation was successfully initiated and completion will be indicated at a later time.</span></span> |
| <span data-ttu-id="ecb48-153">**operação de WSA \_ \_ anulada**</span><span class="sxs-lookup"><span data-stu-id="ecb48-153">**WSA\_OPERATION\_ABORTED**</span></span> | <span data-ttu-id="ecb48-154">Uma operação sobreposta foi cancelada devido ao fechamento do soquete ou à execução do comando **sio \_ flush** IOCTL.</span><span class="sxs-lookup"><span data-stu-id="ecb48-154">An overlapped operation was canceled due to the closure of the socket or the execution of the **SIO\_FLUSH** IOCTL command.</span></span> |
| <span data-ttu-id="ecb48-155">**WSAEFAULT**</span><span class="sxs-lookup"><span data-stu-id="ecb48-155">**WSAEFAULT**</span></span> | <span data-ttu-id="ecb48-156">O parâmetro *lpOverlapped* ou *lpCompletionRoutine* não está totalmente contido em uma parte válida do espaço de endereço do usuário.</span><span class="sxs-lookup"><span data-stu-id="ecb48-156">The *lpOverlapped* or *lpCompletionRoutine* parameter is not totally contained in a valid part of the user address space.</span></span> |
| <span data-ttu-id="ecb48-157">**WSAEINPROGRESS**</span><span class="sxs-lookup"><span data-stu-id="ecb48-157">**WSAEINPROGRESS**</span></span> | <span data-ttu-id="ecb48-158">A função é invocada quando um retorno de chamada está em andamento.</span><span class="sxs-lookup"><span data-stu-id="ecb48-158">The function is invoked when a callback is in progress.</span></span> |
| <span data-ttu-id="ecb48-159">**WSAEINTR**</span><span class="sxs-lookup"><span data-stu-id="ecb48-159">**WSAEINTR**</span></span> | <span data-ttu-id="ecb48-160">Uma operação de bloqueio foi interrompida.</span><span class="sxs-lookup"><span data-stu-id="ecb48-160">A blocking operation was interrupted.</span></span> |
| <span data-ttu-id="ecb48-161">**WSAEINVAL**</span><span class="sxs-lookup"><span data-stu-id="ecb48-161">**WSAEINVAL**</span></span> | <span data-ttu-id="ecb48-162">O parâmetro *dwIoControlCode* não é um comando válido ou um parâmetro de entrada especificado não é aceitável ou o comando não é aplicável ao tipo de soquete especificado.</span><span class="sxs-lookup"><span data-stu-id="ecb48-162">The *dwIoControlCode* parameter is not a valid command, or a specified input parameter is not acceptable, or the command is not applicable to the type of socket specified.</span></span> <span data-ttu-id="ecb48-163">Esse erro será retornado se o parâmetro *cbInBuffer* for menor do que o sizeof da estrutura do **\_ \_ modo de compatibilidade do WSA** .</span><span class="sxs-lookup"><span data-stu-id="ecb48-163">This error is returned if the *cbInBuffer* parameter is less than the sizeof the **WSA\_COMPATIBILITY\_MODE** structure.</span></span>
| <span data-ttu-id="ecb48-164">**WSAENETDOWN**</span><span class="sxs-lookup"><span data-stu-id="ecb48-164">**WSAENETDOWN**</span></span> | <span data-ttu-id="ecb48-165">Falha no subsistema de rede.</span><span class="sxs-lookup"><span data-stu-id="ecb48-165">The network subsystem has failed.</span></span> |
| <span data-ttu-id="ecb48-166">**WSAENOPROTOOPT**</span><span class="sxs-lookup"><span data-stu-id="ecb48-166">**WSAENOPROTOOPT**</span></span> | <span data-ttu-id="ecb48-167">Não há suporte para a opção de soquete no protocolo especificado.</span><span class="sxs-lookup"><span data-stu-id="ecb48-167">The socket option is not supported on the specified protocol.</span></span> |
| <span data-ttu-id="ecb48-168">**WSAENOTCONN**</span><span class="sxs-lookup"><span data-stu-id="ecb48-168">**WSAENOTCONN**</span></span> | <span data-ttu-id="ecb48-169">O Soquete s não está conectado.</span><span class="sxs-lookup"><span data-stu-id="ecb48-169">The socket s is not connected.</span></span> |
| <span data-ttu-id="ecb48-170">**WSAENOTSOCK**</span><span class="sxs-lookup"><span data-stu-id="ecb48-170">**WSAENOTSOCK**</span></span> | <span data-ttu-id="ecb48-171">O descritor *s* não é um soquete.</span><span class="sxs-lookup"><span data-stu-id="ecb48-171">The descriptor *s* is not a socket.</span></span> |
| <span data-ttu-id="ecb48-172">**WSAEOPNOTSUPP**</span><span class="sxs-lookup"><span data-stu-id="ecb48-172">**WSAEOPNOTSUPP**</span></span> | <span data-ttu-id="ecb48-173">Não há suporte para o comando IOCTL especificado.</span><span class="sxs-lookup"><span data-stu-id="ecb48-173">The specified IOCTL command is not supported.</span></span> <span data-ttu-id="ecb48-174">Esse erro será retornado se o **sio \_ definir \_ o \_ modo de compatibilidade** do IOCTL não for suportado pelo provedor de transporte.</span><span class="sxs-lookup"><span data-stu-id="ecb48-174">This error is returned if the **SIO\_SET\_COMPATIBILITY\_MODE** IOCTL is not supported by the transport provider.</span></span> <span data-ttu-id="ecb48-175">Esse erro também é retornado quando uma tentativa de usar o **\_ modo de \_ compatibilidade \_ set de sio** é feita em um soquete de datagrama.</span><span class="sxs-lookup"><span data-stu-id="ecb48-175">This error is also returned when an attempt to use the **SIO\_SET\_COMPATIBILITY\_MODE** IOCTL is made on a datagram socket.</span></span> |

## <a name="remarks"></a><span data-ttu-id="ecb48-176">Comentários</span><span class="sxs-lookup"><span data-stu-id="ecb48-176">Remarks</span></span>

<span data-ttu-id="ecb48-177">o **sio \_ definir \_ o \_ modo de compatibilidade** do IOCTL solicita como a pilha de rede deve lidar com determinados comportamentos para os quais a maneira padrão de manipular o comportamento pode ser diferente nas versões do Windows.</span><span class="sxs-lookup"><span data-stu-id="ecb48-177">the **SIO\_SET\_COMPATIBILITY\_MODE** IOCTL requests how the networking stack should handle certain behaviors for which the default way of handling the behavior may differ across Windows versions.</span></span>
<span data-ttu-id="ecb48-178">A estrutura do argumento de entrada para o modo de compatibilidade do conjunto de sio é especificada na estrutura do **modo de \_ compatibilidade \_ do WSA** definida no arquivo de cabeçalho *Mswsockdef. h* . **\_ \_ \_**</span><span class="sxs-lookup"><span data-stu-id="ecb48-178">The input argument structure for **SIO\_SET\_COMPATIBILITY\_MODE** is specified in the **WSA\_COMPATIBILITY\_MODE** structure defined in the *Mswsockdef.h* header file.</span></span>
<span data-ttu-id="ecb48-179">Um ponteiro para a estrutura do **\_ \_ modo de compatibilidade de WSA** é passado no parâmetro *cbInBuffer* .</span><span class="sxs-lookup"><span data-stu-id="ecb48-179">A pointer to the **WSA\_COMPATIBILITY\_MODE** structure is passed in the *cbInBuffer* parameter.</span></span>
<span data-ttu-id="ecb48-180">Essa estrutura é definida da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="ecb48-180">This structure is defined as follows:</span></span>

```cpp
// Need to #include <mswsock.h>

/* Argument structure for SIO_SET_COMPATIBILITY_MODE */
typedef struct _WSA_COMPATIBILITY_MODE {
    WSA_COMPATIBILITY_BEHAVIOR_ID BehaviorId;
    ULONG TargetOsVersion;
} WSA_COMPATIBILITY_MODE, *PWSA_COMPATIBILITY_MODE;
```

<span data-ttu-id="ecb48-181">O valor especificado no membro **BehaviorID** indica o comportamento solicitado.</span><span class="sxs-lookup"><span data-stu-id="ecb48-181">The value specified in the **BehaviorId** member indicates the behavior requested.</span></span>
<span data-ttu-id="ecb48-182">O valor especificado no membro **TargetOsVersion** indica a versão do Windows que está sendo solicitada para o comportamento.</span><span class="sxs-lookup"><span data-stu-id="ecb48-182">The value specified in the **TargetOsVersion** member indicates the Windows version that is being requested for the behavior.</span></span>

<span data-ttu-id="ecb48-183">O membro **BehaviorID** pode ser um dos valores do tipo de enumeração de ID do comportamento de compatibilidade do WSA definido no arquivo de cabeçalho *Mswsockdef. h* . **\_ \_ \_**</span><span class="sxs-lookup"><span data-stu-id="ecb48-183">The **BehaviorId** member can be one of the values from the **WSA\_COMPATIBILITY\_BEHAVIOR\_ID** enumeration type defined in the *Mswsockdef.h* header file.</span></span>
<span data-ttu-id="ecb48-184">Os valores possíveis para o membro **BehaviorID** são os seguintes:</span><span class="sxs-lookup"><span data-stu-id="ecb48-184">The possible values for the **BehaviorId** member are as follows:</span></span>

| <span data-ttu-id="ecb48-185">Termo</span><span class="sxs-lookup"><span data-stu-id="ecb48-185">Term</span></span> | <span data-ttu-id="ecb48-186">Descrição</span><span class="sxs-lookup"><span data-stu-id="ecb48-186">Description</span></span> |
|------|-------------|
| <span data-ttu-id="ecb48-187">WsaBehaviorAll</span><span class="sxs-lookup"><span data-stu-id="ecb48-187">WsaBehaviorAll</span></span> | <span data-ttu-id="ecb48-188">Isso é equivalente a solicitar todos os comportamentos compatíveis possíveis definidos para a **\_ ID de \_ comportamento \_ de compatibilidade de WSA**.</span><span class="sxs-lookup"><span data-stu-id="ecb48-188">This is equivalent to requesting all of the possible compatible behaviors defined for **WSA\_COMPATIBILITY\_BEHAVIOR\_ID**.</span></span> |
| <span data-ttu-id="ecb48-189">WsaBehaviorReceiveBuffering</span><span class="sxs-lookup"><span data-stu-id="ecb48-189">WsaBehaviorReceiveBuffering</span></span> | <span data-ttu-id="ecb48-190">Quando o membro **TargetOsVersion** é definido como um valor para o Windows Vista ou posterior, as reduções para o tamanho do buffer de recebimento TCP nesse soquete usando a opção de soquete **\_ RCVBUF,** são permitidas mesmo após uma conexão TCP ter sido estabelecimento.</span><span class="sxs-lookup"><span data-stu-id="ecb48-190">When the **TargetOsVersion** member is set to a value for Windows Vista or later, reductions to the TCP receive buffer size on this socket using the **SO\_RCVBUF** socket option are allowed even after a TCP connection has been establishment.</span></span> <span data-ttu-id="ecb48-191">Quando o membro **TargetOsVersion** é definido como um valor anterior ao Windows Vista, as reduções no tamanho do buffer de recebimento TCP nesse soquete usando a opção de soquete **\_ RCVBUF** não são permitidas após o estabelecimento da conexão.</span><span class="sxs-lookup"><span data-stu-id="ecb48-191">When the **TargetOsVersion** member is set to a value earlier than Windows Vista, reductions to the TCP receive buffer size on this socket using the **SO\_RCVBUF** socket option are not allowed after connection establishment.</span></span> |
| <span data-ttu-id="ecb48-192">WsaBehaviorAutoTuning</span><span class="sxs-lookup"><span data-stu-id="ecb48-192">WsaBehaviorAutoTuning</span></span> | <span data-ttu-id="ecb48-193">Quando o membro **TargetOsVersion** é definido como um valor para o Windows Vista ou posterior, o ajuste automático da janela de recebimento é habilitado e o fator de escala da janela TCP é reduzido para 2 a partir do valor padrão de 8.</span><span class="sxs-lookup"><span data-stu-id="ecb48-193">When the **TargetOsVersion** member is set to a value for Windows Vista or later, receive window auto-tuning is enabled and the TCP window scale factor is reduced to 2 from the default value of 8.</span></span> <span data-ttu-id="ecb48-194">Quando **TargetOsVersion** é definido como um valor anterior ao Windows Vista, o ajuste automático da janela de recebimento está desabilitado.</span><span class="sxs-lookup"><span data-stu-id="ecb48-194">When the **TargetOsVersion** is set to a value earlier than Windows Vista, receive window auto-tuning is disabled.</span></span> <span data-ttu-id="ecb48-195">A opção de dimensionamento da janela TCP também está desabilitada e o tamanho máximo da janela de recepção é limitado a 65.535 bytes.</span><span class="sxs-lookup"><span data-stu-id="ecb48-195">The TCP window scaling option is also disabled and the maximum true receive window size is limited to 65,535 bytes.</span></span> <span data-ttu-id="ecb48-196">A opção de dimensionamento da janela TCP não pode ser negociada na conexão mesmo que a opção de soquete **\_ RCVBUF** seja chamada nesse soquete especificando um valor maior que 65.535 bytes antes da conexão ser estabelecida.</span><span class="sxs-lookup"><span data-stu-id="ecb48-196">The TCP window scaling option can't be negotiated on the connection even if the **SO\_RCVBUF** socket option was called on this socket specifying a value greater than 65,535 bytes before the connection was established.</span></span> |

<span data-ttu-id="ecb48-197">O membro **TargetOsVersion** pode ser uma das constantes da versão NTDDI definidas no arquivo de cabeçalho *Sdkddkver. h* .</span><span class="sxs-lookup"><span data-stu-id="ecb48-197">The **TargetOsVersion** member can be one of the NTDDI version constants defined in the *Sdkddkver.h* header file.</span></span>
<span data-ttu-id="ecb48-198">Alguns dos valores possíveis para o membro **TargetOsVersion** são os seguintes:</span><span class="sxs-lookup"><span data-stu-id="ecb48-198">Some of the possible values for the **TargetOsVersion** member are as follows:</span></span>

| <span data-ttu-id="ecb48-199">Termo</span><span class="sxs-lookup"><span data-stu-id="ecb48-199">Term</span></span> | <span data-ttu-id="ecb48-200">Descrição</span><span class="sxs-lookup"><span data-stu-id="ecb48-200">Description</span></span> |
|------|-------------|
| <span data-ttu-id="ecb48-201">NTDDI \_ Longhorn</span><span class="sxs-lookup"><span data-stu-id="ecb48-201">NTDDI\_LONGHORN</span></span> | <span data-ttu-id="ecb48-202">O comportamento de destino é o padrão para o Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="ecb48-202">The target behavior is the default for Windows Vista.</span></span> |
| <span data-ttu-id="ecb48-203">NTDDI \_ WS03</span><span class="sxs-lookup"><span data-stu-id="ecb48-203">NTDDI\_WS03</span></span> | <span data-ttu-id="ecb48-204">O comportamento de destino é o padrão para o Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="ecb48-204">The target behavior is the default for Windows Server 2003.</span></span> |
| <span data-ttu-id="ecb48-205">NTDDI \_ WinXP</span><span class="sxs-lookup"><span data-stu-id="ecb48-205">NTDDI\_WINXP</span></span> | <span data-ttu-id="ecb48-206">O comportamento de destino é o padrão para o Windows XP.</span><span class="sxs-lookup"><span data-stu-id="ecb48-206">The target behavior is the default for Windows XP.</span></span> |
| <span data-ttu-id="ecb48-207">NTDDI \_ Win2k</span><span class="sxs-lookup"><span data-stu-id="ecb48-207">NTDDI\_WIN2K</span></span> | <span data-ttu-id="ecb48-208">O comportamento de destino é o padrão para o Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="ecb48-208">The target behavior is the default for Windows 2000.</span></span> |

<span data-ttu-id="ecb48-209">O impacto principal do membro **TargetOsVersion** é se esse membro está definido como um valor igual ou maior que o **NTDDI \_ Longhorn**.</span><span class="sxs-lookup"><span data-stu-id="ecb48-209">The primary impact of the **TargetOsVersion** member is whether this member is set to a value equal or greater than **NTDDI\_LONGHORN**.</span></span>

<span data-ttu-id="ecb48-210">O desempenho do TCP depende não apenas da própria taxa de transferência, mas sim do produto da taxa de transferência e do tempo de atraso da viagem de ida e volta.</span><span class="sxs-lookup"><span data-stu-id="ecb48-210">TCP performance depends not only on the transfer rate itself, but rather on the product of the transfer rate and the round-trip delay time.</span></span>
<span data-ttu-id="ecb48-211">Esse produto de atraso de largura de banda mede a quantidade de dados que "preencherão o pipe".</span><span class="sxs-lookup"><span data-stu-id="ecb48-211">This bandwidth-delay product measures the amount of data that would "fill the pipe".</span></span>
<span data-ttu-id="ecb48-212">Esse produto de atraso de largura de banda é o espaço em buffer necessário no remetente e no destinatário para obter a taxa de transferência máxima na conexão TCP no caminho.</span><span class="sxs-lookup"><span data-stu-id="ecb48-212">This bandwidth-delay product is the buffer space required at sender and receiver to obtain maximum throughput on the TCP connection over the path.</span></span>
<span data-ttu-id="ecb48-213">Esse espaço de buffer representa a quantidade de dados não confirmados que o TCP deve manipular para manter o pipeline cheio.</span><span class="sxs-lookup"><span data-stu-id="ecb48-213">This buffer space represents the amount of unacknowledged data that TCP must handle in order to keep the pipeline full.</span></span>
<span data-ttu-id="ecb48-214">Problemas de desempenho de TCP surgem quando o produto de atraso de largura de banda é grande.</span><span class="sxs-lookup"><span data-stu-id="ecb48-214">TCP performance problems arise when the bandwidth-delay product is large.</span></span>
<span data-ttu-id="ecb48-215">Um caminho de rede operando nessas condições geralmente é chamado de "pipe longo, de Fat".</span><span class="sxs-lookup"><span data-stu-id="ecb48-215">A network path operating under these conditions is often called a "long, fat pipe".</span></span>
<span data-ttu-id="ecb48-216">Os exemplos incluem links de satélite de pacotes de alta capacidade, links sem fio de alta velocidade e links de fibra óptica terrestres por longas distâncias.</span><span class="sxs-lookup"><span data-stu-id="ecb48-216">Examples include high-capacity packet satellite links, high-speed wireless links, and terrestrial fiber-optical links over long distances.</span></span>

<span data-ttu-id="ecb48-217">O cabeçalho TCP usa um campo de dados de 16 bits (o campo de janela no cabeçalho do pacote TCP) para relatar o tamanho da janela de recebimento para o remetente.</span><span class="sxs-lookup"><span data-stu-id="ecb48-217">The TCP header uses a 16-bit data field (the Window field in the TCP packet header) to report the receive window size to the sender.</span></span>
<span data-ttu-id="ecb48-218">Portanto, a maior janela que pode ser usada é de 65.535 bytes.</span><span class="sxs-lookup"><span data-stu-id="ecb48-218">Therefore, the largest window that can be used is 65,535 bytes.</span></span>
<span data-ttu-id="ecb48-219">Para evitar essa limitação, uma opção de extensão TCP, escala de janela TCP, foi adicionada para TCP de alto desempenho para permitir o Windows com mais de 65.535 bytes.</span><span class="sxs-lookup"><span data-stu-id="ecb48-219">To circumvent this limitation a TCP extension option, TCP Window Scale, was added for high-performance TCP to allow windows larger than 65,535 bytes.</span></span>
<span data-ttu-id="ecb48-220">A opção de dimensionamento de janela TCP (WSopt) é definida no RFC 1323 disponível no [site da IETF](https://www.ietf.org/rfc/rfc1122.txt).</span><span class="sxs-lookup"><span data-stu-id="ecb48-220">The TCP Window Scale option (WSopt) is defined in RFC 1323 available at the [IETF website](https://www.ietf.org/rfc/rfc1122.txt).</span></span>
<span data-ttu-id="ecb48-221">A extensão WSopt expande a definição da janela TCP para 32 bits usando um fator de escala logarítmica de um byte para estender o campo de janela de 16 bits no cabeçalho TCP.</span><span class="sxs-lookup"><span data-stu-id="ecb48-221">The WSopt extension expands the definition of the TCP window to 32 bits using a one-byte logarithmic scale factor to extend the 16-bit Window field in the TCP header.</span></span>
<span data-ttu-id="ecb48-222">A extensão WSopt define um fator de escala implícito (2 a alguma potência), que é usado para multiplicar o valor de tamanho da janela encontrado em um cabeçalho TCP para obter o tamanho de janela verdadeiro.</span><span class="sxs-lookup"><span data-stu-id="ecb48-222">The WSopt extension defines an implicit scale factor (2 to some power), which is used to multiply the window size value found in a TCP header to obtain the true window size.</span></span>
<span data-ttu-id="ecb48-223">Portanto, um fator de dimensionamento de janela de 8 resultaria em um tamanho de janela verdadeiro igual ao valor no campo janela no cabeçalho TCP multiplicado por 2 ^ 8 ou 256.</span><span class="sxs-lookup"><span data-stu-id="ecb48-223">So a window scale factor of 8 would result in a true window size equal to the value in the Window field in the TCP header multiplied by 2^8 or 256.</span></span>
<span data-ttu-id="ecb48-224">Portanto, se o campo de janela no cabeçalho TCP tiver sido definido com o valor máximo de 65.535 bytes e o fator de escala WSopt fosse negociado com um valor de 8, o tamanho de janela verdadeiro seria de 16.776.960 bytes.</span><span class="sxs-lookup"><span data-stu-id="ecb48-224">So if the Window field in the TCP header was set to the maximum value of 65,535 bytes and the WSopt scale factor was negotiated to a value of 8, the true window size would be 16,776,960 bytes.</span></span>

<span data-ttu-id="ecb48-225">O verdadeiro tamanho da janela de recepção e, portanto, o fator de escala é determinado pelo espaço máximo de buffer de recebimento.</span><span class="sxs-lookup"><span data-stu-id="ecb48-225">The true receive window size and therefore the scale factor is determined by the maximum receive buffer space.</span></span>
<span data-ttu-id="ecb48-226">Esse espaço máximo de buffer é a quantidade de dados que um receptor TCP permite que um remetente TCP envie antes de ter que esperar por uma confirmação.</span><span class="sxs-lookup"><span data-stu-id="ecb48-226">This maximum buffer space is the amount of data that a TCP receiver allows a TCP sender to send before having to wait for an acknowledgement.</span></span>
<span data-ttu-id="ecb48-227">Depois que a conexão é estabelecida, o tamanho da janela de recebimento é anunciado em cada segmento TCP (o campo janela no cabeçalho TCP).</span><span class="sxs-lookup"><span data-stu-id="ecb48-227">After the connection is established, the receive window size is advertised in each TCP segment (the Window field in the TCP header).</span></span>
<span data-ttu-id="ecb48-228">Anunciar a quantidade máxima de dados que o remetente pode enviar é um mecanismo de controle de fluxo do lado do destinatário que impede que o remetente envie dados que o receptor não pode armazenar.</span><span class="sxs-lookup"><span data-stu-id="ecb48-228">Advertising the maximum amount of data that the sender can send is a receiver-side flow control mechanism that prevents the sender from sending data that the receiver cannot store.</span></span>
<span data-ttu-id="ecb48-229">Um host de envio só pode enviar a quantidade máxima de dados anunciados pelo receptor antes de aguardar uma confirmação e uma atualização de tamanho de janela de recebimento.</span><span class="sxs-lookup"><span data-stu-id="ecb48-229">A sending host can only send the maximum amount of data advertised by the receiver before waiting for an acknowledgment and a receive window size update.</span></span>

<span data-ttu-id="ecb48-230">No Windows Server 2003 e no Windows XP, o espaço máximo de buffer de recebimento que representa o tamanho da janela de recebimento para a pilha TCP/IP tem um valor padrão baseado na velocidade do link da interface de envio.</span><span class="sxs-lookup"><span data-stu-id="ecb48-230">On Windows Server 2003 and Windows XP, the maximum receive buffer space which represents the receive window size for the TCP/IP stack has a default value based on the link speed of the sending interface.</span></span>
<span data-ttu-id="ecb48-231">O valor real é ajustado automaticamente para até mesmo incrementos do MSS (tamanho máximo de segmento) negociado durante o estabelecimento de conexão TCP.</span><span class="sxs-lookup"><span data-stu-id="ecb48-231">The actual value automatically adjusts to even increments of the maximum segment size (MSS) negotiated during TCP connection establishment.</span></span>
<span data-ttu-id="ecb48-232">Portanto, para um link de 10 Mbit/s, o tamanho padrão da janela de recepção normalmente seria definido como 16K bytes, enquanto em um link de 100 MBit/s o tamanho da janela de recebimento padrão seria definido como 65.535 bytes.</span><span class="sxs-lookup"><span data-stu-id="ecb48-232">So for a 10 Mbit/sec link, the default receive window size would normally be set to 16K bytes, while on a 100 MBit/sec link the default receive window size would be set to 65,535 bytes.</span></span>

<span data-ttu-id="ecb48-233">No Windows Server 2003 e no Windows XP, o tamanho máximo real da janela de recepção para a pilha TCP/IP pode ser configurado manualmente usando os seguintes valores de registro em uma interface específica ou para todo o sistema:</span><span class="sxs-lookup"><span data-stu-id="ecb48-233">On Windows Server 2003 and Windows XP, the true maximum receive window size for the TCP/IP stack can be manually configured using the following registry values on a specific interface or for the entire system:</span></span>

`HKEY_LOCAL_MACHINE\SYSTEM\Current Control Set\Services\Tcpip\Parameters\TCPWindowSize`

`HKEY_LOCAL_MACHINE\SYSTEM\Current Control Set\Services\Tcpip\Parameters\Interface\TCPWindowSize`

<span data-ttu-id="ecb48-234">O valor do registro para **TcpWindowSize** pode ser definido como um máximo de 65.535 bytes quando não estiver usando a extensão WSopt ou um máximo de 1.073.741.823 bytes quando a extensão WSopt for usada (há suporte para um fator de escala máximo de 4).</span><span class="sxs-lookup"><span data-stu-id="ecb48-234">The registry value for **TCPWindowSize** can be set to a maximum of 65,535 bytes when not using the WSopt extension or a maximum of 1,073,741,823 bytes when the WSopt extension is used (a maximum scale factor of 4 is supported).</span></span>
<span data-ttu-id="ecb48-235">Sem o dimensionamento da janela, um aplicativo só pode obter uma taxa de transferência de aproximadamente 5 megabits por segundo (Mbps) em um caminho com um RTT (tempo de ida e volta) de 100 milissegundo, independentemente da largura de banda do caminho.</span><span class="sxs-lookup"><span data-stu-id="ecb48-235">Without window scaling, an application can only achieve a throughput of approximately 5 megabits per second (Mbps) on a path with a 100 millisecond round-trip time (RTT), regardless of the path bandwidth.</span></span>
<span data-ttu-id="ecb48-236">Essa taxa de transferência pode ser dimensionada para mais de um gigabit por segundo (Gbps) com dimensionamento de janela, o que permite que o TCP negocie o fator de dimensionamento para o tamanho da janela durante o estabelecimento da conexão.</span><span class="sxs-lookup"><span data-stu-id="ecb48-236">This throughput can be scaled to over a gigabit per second (Gbps) with window scaling, which allows TCP to negotiate the scaling factor for the window size during connection establishment.</span></span>

<span data-ttu-id="ecb48-237">No Windows Server 2003 e no Windows XP, a extensão WSopt pode ser habilitada definindo o seguinte valor de registro.</span><span class="sxs-lookup"><span data-stu-id="ecb48-237">On Windows Server 2003 and Windows XP, the WSopt extension can be enabled by setting the following registry value.</span></span>

`HKEY_LOCAL_MACHINE\SYSTEM\Current Control Set\Services\Tcpip\Parameters\Tcp1323Opts`

<span data-ttu-id="ecb48-238">O valor do registro **TCP1323Opts** é um **DWORD** codificado de modo que quando o bit 0 é definido, a extensão TCP WSopt está habilitada.</span><span class="sxs-lookup"><span data-stu-id="ecb48-238">The **Tcp1323Opts** registry value is a **DWORD** encoded such that when bit 0 is set, TCP WSopt extension is enabled.</span></span>
<span data-ttu-id="ecb48-239">Quando o bit 1 é definido, a opção de carimbo de data/hora TCP (TSopt) definida no RFC 1323 é habilitada.</span><span class="sxs-lookup"><span data-stu-id="ecb48-239">When bit 1 is set, the TCP Timestamp option (TSopt) defined in RFC 1323 is enabled.</span></span>
<span data-ttu-id="ecb48-240">Portanto, um valor de 1 ou 3 habilitará a extensão WSopt.</span><span class="sxs-lookup"><span data-stu-id="ecb48-240">So a value of either 1 or 3 will enable the WSopt extension.</span></span>

<span data-ttu-id="ecb48-241">No Windows Server 2003 e no Windows XP, o padrão é que os valores de registro TCPWindowSize e Tcp1323Opts não sejam criados.</span><span class="sxs-lookup"><span data-stu-id="ecb48-241">On Windows Server 2003 and Windows XP, the default is that the TCPWindowSize and the Tcp1323Opts registry values are not created.</span></span>
<span data-ttu-id="ecb48-242">Portanto, o padrão é que a extensão WSopt está desabilitada e o tamanho da janela de recepção TCP é definido pelo sistema para o valor máximo de até 65.535 bytes com base na velocidade do link.</span><span class="sxs-lookup"><span data-stu-id="ecb48-242">So the default is that the WSopt extension is disabled and the TCP receive window size is set by the system to maximum value of up to 65,535 bytes based on the link speed.</span></span>
<span data-ttu-id="ecb48-243">Quando o dimensionamento de janela é habilitado no Windows Server 2003 e no Windows XP definindo o valor do registro Tcp1323Opts, o dimensionamento da janela em uma conexão TCP ainda é usado apenas quando o remetente e o receptor incluem uma opção de escala de janela TCP no segmento sincronizar (SYN) enviado entre si para negociar um fator de escala de janela.</span><span class="sxs-lookup"><span data-stu-id="ecb48-243">When window scaling is enabled on Windows Server 2003 and Windows XP by setting the Tcp1323Opts registry value, window scaling on a TCP connection is still only used when both the sender and receiver include a TCP window scale option in the synchronize (SYN) segment sent to each other to negotiate a window scale factor.</span></span>
<span data-ttu-id="ecb48-244">Quando o dimensionamento da janela é usado em uma conexão, o campo janela no cabeçalho TCP é definido como 65.535 bytes e o fator de escala da janela é usado para ajustar o tamanho da janela de recepção em cima pelo fator de escala da janela negociado quando a conexão é estabelecida.</span><span class="sxs-lookup"><span data-stu-id="ecb48-244">When window scaling is used on a connection, the Window field in the TCP header is set to 65,535 bytes and the window scale factor is used to adjust the true receive window size upward by the window scale factor negotiated when the connection is established.</span></span>

<span data-ttu-id="ecb48-245">Um aplicativo pode especificar o tamanho da janela de recepção TCP para uma conexão usando a opção de soquete **\_ RCVBUF** .</span><span class="sxs-lookup"><span data-stu-id="ecb48-245">An application can specify the TCP receive window size for a connection by using the **SO\_RCVBUF** socket option.</span></span>
<span data-ttu-id="ecb48-246">O tamanho da janela de recepção TCP para um soquete pode ser aumentado a qualquer momento usando o **\_ RCVBUF**, mas só pode ser reduzido antes de estabelecer uma conexão.</span><span class="sxs-lookup"><span data-stu-id="ecb48-246">The TCP receive window size for a socket can be increased at any time using **SO\_RCVBUF**, but it can only be decreased prior to establishing a connection.</span></span>
<span data-ttu-id="ecb48-247">Para usar o dimensionamento de janela, um aplicativo deve especificar um tamanho de janela maior que 65.535 bytes ao usar a opção de soquete **\_ RCVBUF** antes que a conexão seja estabelecida.</span><span class="sxs-lookup"><span data-stu-id="ecb48-247">In order to use window scaling, an application must specify a window size larger than 65,535 bytes when using the **SO\_RCVBUF** socket option before the connection is established.</span></span>

<span data-ttu-id="ecb48-248">Geralmente, é difícil determinar o valor ideal para o tamanho da janela de recepção TCP.</span><span class="sxs-lookup"><span data-stu-id="ecb48-248">The ideal value for the TCP receive window size is often difficult to determine.</span></span>
<span data-ttu-id="ecb48-249">Para preencher a capacidade da rede entre o remetente e o destinatário, o tamanho da janela de recebimento deve ser definido como o produto de atraso da largura de banda da conexão, que é a largura de banda multiplicada pelo tempo de viagem de ida e volta.</span><span class="sxs-lookup"><span data-stu-id="ecb48-249">In order to fill the capacity of the network between the sender and receiver, the receive window size should be set to the bandwidth-delay product for the connection, which is the bandwidth multiplied by the round-trip time.</span></span>
<span data-ttu-id="ecb48-250">Mesmo que um aplicativo possa determinar corretamente o produto de atraso da largura de banda, ainda não é conhecido com a rapidez com que o aplicativo de recebimento recuperará dados do buffer de dados de entrada (a taxa de recuperação do aplicativo).</span><span class="sxs-lookup"><span data-stu-id="ecb48-250">Even if an application can correctly determine the bandwidth-delay product, it is still not known how quickly the receiving application will retrieve data from the incoming data buffer (the application retrieve rate).</span></span>
<span data-ttu-id="ecb48-251">Apesar do suporte para o dimensionamento de janela de TCP, o tamanho máximo da janela de recepção no Windows Server 2003 e no Windows XP ainda pode limitar a taxa de transferência, pois é um tamanho máximo fixo para todas as conexões TCP (a menos que especificado por aplicativo usando **\_ RCVBUF**), o que pode melhorar a taxa de transferência para algumas conexões e diminuir a taxa de transferência para outras.</span><span class="sxs-lookup"><span data-stu-id="ecb48-251">Despite the support for TCP window scaling, the maximum receive window size in Windows Server 2003 and Windows XP can still limit throughput because it is a fixed maximum size for all TCP connections (unless specified per application using **SO\_RCVBUF**), which can enhance throughput for some connections and decrease throughput for others.</span></span>
<span data-ttu-id="ecb48-252">Além disso, o tamanho máximo fixo da janela de recepção para uma conexão TCP não varia de acordo com as condições de rede em alteração.</span><span class="sxs-lookup"><span data-stu-id="ecb48-252">Additionally, the fixed maximum receive window size for a TCP connection does not vary with changing network conditions.</span></span>

<span data-ttu-id="ecb48-253">Para resolver o problema de determinar corretamente o valor do tamanho máximo da janela de recepção para uma conexão TCP com base nas condições atuais da rede, a pilha de TCP/IP no Windows Vista dá suporte a um recurso de ajuste automático da janela de recebimento.</span><span class="sxs-lookup"><span data-stu-id="ecb48-253">To solve the problem of correctly determining the value of the maximum receive window size for a TCP connection based on the current conditions of the network, the TCP/IP stack in Windows Vista supports a receive window auto-tuning feature.</span></span>
<span data-ttu-id="ecb48-254">Quando esse recurso é habilitado, o ajuste automático da janela de recebimento determina continuamente o tamanho da janela de recepção verdadeiro ideal medindo o produto de atraso da largura de banda e a taxa de recuperação do aplicativo e ajusta o tamanho máximo real da janela de recepção com base na alteração das condições de rede.</span><span class="sxs-lookup"><span data-stu-id="ecb48-254">When this feature is enabled, receive window auto-tuning continually determines the optimal true receive window size by measuring the bandwidth-delay product and the application retrieve rate, and adjusts the true maximum receive window size based on changing network conditions.</span></span>
<span data-ttu-id="ecb48-255">O ajuste automático da janela de recebimento habilita a extensão TCP WSopt por padrão, permitindo até 16.776.960 bytes para o tamanho real da janela.</span><span class="sxs-lookup"><span data-stu-id="ecb48-255">Receive window auto-tuning enables the TCP WSopt extension by default, allowing up to 16,776,960 bytes for the true window size.</span></span>
<span data-ttu-id="ecb48-256">À medida que os dados fluem pela conexão, a pilha TCP/IP monitora a conexão, mede o produto de atraso de largura de banda atual para a conexão e a taxa de recebimento do aplicativo e ajusta o tamanho real da janela de recepção para otimizar a taxa de transferência.</span><span class="sxs-lookup"><span data-stu-id="ecb48-256">As the data flows over the connection, the TCP/IP stack monitors the connection, measures the current bandwidth-delay product for the connection and the application receive rate, and adjusts the actual receive window size to optimize throughput.</span></span>
<span data-ttu-id="ecb48-257">A pilha TCP/IP altera o valor do campo Window no cabeçalho TCP com base nas condições de rede, pois o fator de escala WSopt é fixo quando a conexão é estabelecida pela primeira vez.</span><span class="sxs-lookup"><span data-stu-id="ecb48-257">The TCP/IP stack changes the value of the Window field in the TCP header based on network conditions, since the WSopt scale factor is fixed when the connection is first established.</span></span>

<span data-ttu-id="ecb48-258">A pilha de TCP/IP no Windows Vista não usa mais os valores de registro **TcpWindowSize** .</span><span class="sxs-lookup"><span data-stu-id="ecb48-258">The TCP/IP stack in Windows Vista no longer uses the **TCPWindowSize** registry values.</span></span>
<span data-ttu-id="ecb48-259">Com uma melhor taxa de transferência entre os pares de TCP, a utilização da largura de banda de rede aumenta durante a transferência de dados.</span><span class="sxs-lookup"><span data-stu-id="ecb48-259">With better throughput between TCP peers, the utilization of network bandwidth increases during data transfer.</span></span>
<span data-ttu-id="ecb48-260">Se todos os aplicativos forem otimizados para receber dados TCP, a utilização geral da rede poderá aumentar substancialmente, tornando o uso da QoS (qualidade de serviço) mais importante em redes que estão operando na capacidade ou perto dela.</span><span class="sxs-lookup"><span data-stu-id="ecb48-260">If all the applications are optimized to receive TCP data, then the overall utilization of the network can increase substantially, making the use of Quality of Service (QoS) more important on networks that are operating at or near capacity.</span></span>

<span data-ttu-id="ecb48-261">O comportamento padrão no Windows Vista para buffer de recebimento quando **o \_ \_ \_ modo de compatibilidade Set sio** não é especificado usando **WsaBehaviorReceiveBuffering** é que nenhuma reduções de tamanho de janela de recebimento usando a opção de soquete **\_ RCVBUF** é permitida depois que uma conexão é estabelecida.</span><span class="sxs-lookup"><span data-stu-id="ecb48-261">The default behavior on Windows Vista for receive buffering when **SIO\_SET\_COMPATIBILITY\_MODE** is not specified using **WsaBehaviorReceiveBuffering** is that no receive window size reductions using **SO\_RCVBUF** socket option are allowed after a connection is established.</span></span>

<span data-ttu-id="ecb48-262">O comportamento padrão no Windows Vista para ajuste automático quando o **\_ modo de \_ compatibilidade \_ set sio** não é especificado usando **WsaBehaviorAutoTuning** é que a pilha fará o ajuste automático da janela de recepção usando um fator de escala de janela de 8.</span><span class="sxs-lookup"><span data-stu-id="ecb48-262">The default behavior on Windows Vista for auto-tuning when **SIO\_SET\_COMPATIBILITY\_MODE** is not specified using **WsaBehaviorAutoTuning** is that the stack will do receive window auto-tuning using a window scale factor of 8.</span></span>
<span data-ttu-id="ecb48-263">Observe que, se um aplicativo definir um tamanho de janela de recebimento válido com a opção de soquete **\_ RCVBUF** , a pilha usará o tamanho especificado e a janela de recebimento automático será desabilitada.</span><span class="sxs-lookup"><span data-stu-id="ecb48-263">Note that if an application sets a valid receive window size with the **SO\_RCVBUF** socket option, the stack will use the size specified and window receive auto-tuning will disabled.</span></span>
<span data-ttu-id="ecb48-264">O ajuste automática do Windows também pode ser desabilitado completamente usando o comando a seguir `netsh interface tcp set global autotuninglevel=disabled` . nesse caso, especificar **WsaBehaviorAutoTuning** não terá nenhum efeito.</span><span class="sxs-lookup"><span data-stu-id="ecb48-264">Windows autotuning may also be disabled completely using the following command, `netsh interface tcp set global autotuninglevel=disabled`, in which case specifying **WsaBehaviorAutoTuning** will have no affect.</span></span>
<span data-ttu-id="ecb48-265">A janela receber ajuste automática também pode ser desabilitada com base na política de grupo definida no Windows Server 2008.</span><span class="sxs-lookup"><span data-stu-id="ecb48-265">Window receive autotuning can also be disabled based on group policy set on Windows Server 2008.</span></span>

<span data-ttu-id="ecb48-266">A opção **WsaBehaviorAutoTuning** é necessária no Windows Vista para alguns dispositivos de gateway de Internet e firewalls que não dão suporte correto a fluxos de dados para conexões TCP que usam a extensão WSopt e um fator de escala do Windows.</span><span class="sxs-lookup"><span data-stu-id="ecb48-266">The **WsaBehaviorAutoTuning** option is needed on Windows Vista for some Internet gateway devices and firewalls that do not correctly support data flows for TCP connections that use the WSopt extension and a windows scale factor.</span></span>
<span data-ttu-id="ecb48-267">No Windows Vista, um receptor, por padrão, negocia um fator de dimensionamento de janela de 8 para um tamanho de janela verdadeiro máximo de 16.776.960 bytes.</span><span class="sxs-lookup"><span data-stu-id="ecb48-267">On Windows Vista, a receiver by default negotiates a window scale factor of 8 for a maximum true window size of 16,776,960 bytes.</span></span>
<span data-ttu-id="ecb48-268">Quando os dados começam a fluir em um link rápido, o Windows inicialmente começa com um tamanho de janela true de 64 KB definindo o campo Window do cabeçalho TCP como 256 e definindo o fator de escala da janela como 8 nas opções TCP (256 \* 2 ^ 8 = 64 KB).</span><span class="sxs-lookup"><span data-stu-id="ecb48-268">When data begins to flow on a fast link, Windows initially starts with a 64 Kilobyte true window size by setting the Window field of the TCP header to 256 and setting the window scale factor to 8 in the TCP options (256\*2^8=64KB).</span></span>
<span data-ttu-id="ecb48-269">Alguns dispositivos e firewalls de gateway de Internet ignoram o fator de escala da janela e apenas examinam o campo de janela anunciado no cabeçalho TCP especificado como 256 e removem os pacotes de entrada para a conexão que contém mais de 256 bytes de dados TCP.</span><span class="sxs-lookup"><span data-stu-id="ecb48-269">Some Internet gateway devices and firewalls ignore the window scale factor and only look at the advertised Window field in the TCP header specified as 256, and drop incoming packets for the connection that contain more than 256 bytes of TCP data.</span></span>
<span data-ttu-id="ecb48-270">Para dar suporte ao dimensionamento da janela de recepção TCP, um dispositivo ou firewall de gateway deve monitorar o handshake TCP e acompanhar o fator de escala da janela negociada como parte dos dados de conexão TCP.</span><span class="sxs-lookup"><span data-stu-id="ecb48-270">To support TCP receive window scaling, a gateway device or firewall must monitor the TCP handshake and track the negotiated window scale factor as part of the TCP connection data.</span></span>
<span data-ttu-id="ecb48-271">Além disso, alguns aplicativos e implementações de pilha TCP em outras plataformas ignoram a extensão TCP WSopt e o fator de dimensionamento de janela.</span><span class="sxs-lookup"><span data-stu-id="ecb48-271">Also some applications and TCP stack implementations on other platforms ignore the TCP WSopt extension and the window scaling factor.</span></span>
<span data-ttu-id="ecb48-272">Portanto, o host remoto que envia os dados pode enviar dados na taxa anunciada no campo janela do cabeçalho TCP (256 bytes).</span><span class="sxs-lookup"><span data-stu-id="ecb48-272">So the remote host sending the data may send data at the rate advertised in the Window field of the TCP header (256 bytes).</span></span>
<span data-ttu-id="ecb48-273">Isso pode resultar na recebimento de dados muito lentos pelo receptor.</span><span class="sxs-lookup"><span data-stu-id="ecb48-273">This can result in data being received very slowly by the receiver.</span></span>

<span data-ttu-id="ecb48-274">Definir o membro **BehaviorID** como **WsaBehaviorAutoTuning** e o **TargetOsVersion** para o Windows Vista reduz o fator de escala da janela para 2, de modo que o campo janela no cabeçalho TCP é inicialmente definido como 16.384 bytes e o fator de escala da janela é definido como 2 para um tamanho de recebimento de janela real inicial de 64K bytes.</span><span class="sxs-lookup"><span data-stu-id="ecb48-274">Setting the **BehaviorId** member to **WsaBehaviorAutoTuning** and the **TargetOsVersion** to Windows Vista reduces the window scale factor to 2, so the Window field in the TCP header is initially set to 16,384 bytes and the window scale factor is set to 2 for an initial true window receive size of 64K bytes.</span></span>
<span data-ttu-id="ecb48-275">O recurso de ajuste automático da janela pode aumentar o tamanho de recebimento da janela true até 262.140 bytes, definindo o campo Window no cabeçalho TCP para 65.535 bytes.</span><span class="sxs-lookup"><span data-stu-id="ecb48-275">The window auto-tuning feature can then increase the true window receive size up to 262,140 bytes by setting the Window field in the TCP header to 65,535 bytes.</span></span>
<span data-ttu-id="ecb48-276">Um aplicativo deve definir o **\_ modo de \_ compatibilidade \_ do sio Set** para o IOCTL assim que um soquete é criado, pois essa opção não faz sentido ou se aplica depois que um SYN é enviado.</span><span class="sxs-lookup"><span data-stu-id="ecb48-276">An application should set the **SIO\_SET\_COMPATIBILITY\_MODE** IOCTL as soon as a socket is created, since this option doesn't make sense or apply after a SYN is sent.</span></span>
<span data-ttu-id="ecb48-277">Definir essa opção tem o mesmo impacto que o seguinte comando: `netsh interface tcp set global autotuninglevel=highlyrestricted`</span><span class="sxs-lookup"><span data-stu-id="ecb48-277">Setting this option has the same impact as the following command: `netsh interface tcp set global autotuninglevel=highlyrestricted`</span></span>

<span data-ttu-id="ecb48-278">Observe que o arquivo de cabeçalho *Mswsockdef. h* é incluído automaticamente em *mswsock. h* ou *Netiodef. h* e não deve ser usado diretamente.</span><span class="sxs-lookup"><span data-stu-id="ecb48-278">Note that the *Mswsockdef.h* header file is automatically included in *Mswsock.h* or *Netiodef.h*, and should not be used directly.</span></span>

## <a name="see-also"></a><span data-ttu-id="ecb48-279">Confira também</span><span class="sxs-lookup"><span data-stu-id="ecb48-279">See also</span></span>

[<span data-ttu-id="ecb48-280">**SSA**</span><span class="sxs-lookup"><span data-stu-id="ecb48-280">**socket**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-socket)

[<span data-ttu-id="ecb48-281">**WSAGetLastError**</span><span class="sxs-lookup"><span data-stu-id="ecb48-281">**WSAGetLastError**</span></span>](/windows/desktop/api/winsock/nf-winsock-wsagetlasterror)

[<span data-ttu-id="ecb48-282">**WSAGetOverlappedResult**</span><span class="sxs-lookup"><span data-stu-id="ecb48-282">**WSAGetOverlappedResult**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-wsagetoverlappedresult)

[<span data-ttu-id="ecb48-283">**WSAIoctl**</span><span class="sxs-lookup"><span data-stu-id="ecb48-283">**WSAIoctl**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl)

[<span data-ttu-id="ecb48-284">**WSAOVERLAPPED**</span><span class="sxs-lookup"><span data-stu-id="ecb48-284">**WSAOVERLAPPED**</span></span>](/windows/desktop/api/winsock2/ns-winsock2-wsaoverlapped)

[<span data-ttu-id="ecb48-285">**WSASocketA**</span><span class="sxs-lookup"><span data-stu-id="ecb48-285">**WSASocketA**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-wsasocketa)

[<span data-ttu-id="ecb48-286">**WSASocketW**</span><span class="sxs-lookup"><span data-stu-id="ecb48-286">**WSASocketW**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-wsasocketw)
