---
description: Um soquete bruto é um tipo de soquete que permite o acesso ao provedor de transporte subjacente.
ms.assetid: 4cbe5505-75e7-454f-9e6b-f38bdc60bf6d
title: Soquetes brutos TCP/IP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 25cc08d59d80089a4e655f363e4a899edac8d2b8
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105808210"
---
# <a name="tcpip-raw-sockets"></a><span data-ttu-id="ba50e-103">Soquetes brutos TCP/IP</span><span class="sxs-lookup"><span data-stu-id="ba50e-103">TCP/IP Raw Sockets</span></span>

<span data-ttu-id="ba50e-104">Um soquete bruto é um tipo de soquete que permite o acesso ao provedor de transporte subjacente.</span><span class="sxs-lookup"><span data-stu-id="ba50e-104">A raw socket is a type of socket that allows access to the underlying transport provider.</span></span> <span data-ttu-id="ba50e-105">Este tópico se concentra apenas em soquetes brutos e protocolos IPv4 e IPv6.</span><span class="sxs-lookup"><span data-stu-id="ba50e-105">This topic focuses only on raw sockets and the IPv4 and IPv6 protocols.</span></span> <span data-ttu-id="ba50e-106">Isso ocorre porque a maioria dos outros protocolos com exceção de ATM não oferece suporte a soquetes brutos.</span><span class="sxs-lookup"><span data-stu-id="ba50e-106">This is because most other protocols with the exception of ATM do not support raw sockets.</span></span> <span data-ttu-id="ba50e-107">Para usar soquetes brutos, um aplicativo precisa ter informações detalhadas sobre o protocolo subjacente que está sendo usado.</span><span class="sxs-lookup"><span data-stu-id="ba50e-107">To use raw sockets, an application needs to have detailed information on the underlying protocol being used.</span></span>

<span data-ttu-id="ba50e-108">Provedores de serviço Winsock para o protocolo IP podem dar suporte a um *tipo* de soquete de **Sock \_ RAW**.</span><span class="sxs-lookup"><span data-stu-id="ba50e-108">Winsock service providers for the IP protocol may support a socket *type* of **SOCK\_RAW**.</span></span> <span data-ttu-id="ba50e-109">O provedor do Windows Sockets 2 para TCP/IP incluído no Windows dá suporte a esse tipo de soquete **\_ bruto Sock** .</span><span class="sxs-lookup"><span data-stu-id="ba50e-109">The Windows Sockets 2 provider for TCP/IP included on Windows supports this **SOCK\_RAW** socket type.</span></span>

<span data-ttu-id="ba50e-110">Há dois tipos básicos desses soquetes brutos:</span><span class="sxs-lookup"><span data-stu-id="ba50e-110">There are two basic types of such raw sockets:</span></span>

-   <span data-ttu-id="ba50e-111">O primeiro tipo usa um tipo de protocolo conhecido gravado no cabeçalho IP que é reconhecido por um provedor de serviços do Winsock.</span><span class="sxs-lookup"><span data-stu-id="ba50e-111">The first type uses a known protocol type written in the IP header that is recognized by a Winsock service provider.</span></span> <span data-ttu-id="ba50e-112">Um exemplo do primeiro tipo de soquete é um soquete para o protocolo ICMP (tipo de protocolo IP = 1) ou o protocolo ICMPv6 (IP Procotol Type = 58).</span><span class="sxs-lookup"><span data-stu-id="ba50e-112">An example of the first type of socket is a socket for the ICMP protocol (IP protocol type = 1) or the ICMPv6 protocol (IP procotol type = 58).</span></span>
-   <span data-ttu-id="ba50e-113">O segundo tipo permite que qualquer tipo de protocolo seja especificado.</span><span class="sxs-lookup"><span data-stu-id="ba50e-113">The second type allows any protocol type to be specified.</span></span> <span data-ttu-id="ba50e-114">Um exemplo do segundo tipo seria um protocolo experimental que não é suportado diretamente pelo provedor de serviços do Winsock, como o SCTP (Stream Control transmiting Protocol).</span><span class="sxs-lookup"><span data-stu-id="ba50e-114">An example of the second type would be an experimental protocol that is not directly supported by the Winsock service provider such as the Stream Control Transmission Protocol (SCTP).</span></span>

## <a name="determining-if-raw-sockets-are-supported"></a><span data-ttu-id="ba50e-115">Determinando se há suporte para soquetes brutos</span><span class="sxs-lookup"><span data-stu-id="ba50e-115">Determining if Raw Sockets are Supported</span></span>

<span data-ttu-id="ba50e-116">Se um provedor de serviços Winsock oferecer suporte a soquetes **\_ brutos Sock** para as \_ famílias de endereços INET6 inet ou AF \_ , o tipo de soquete de **Sock \_ bruto** deverá ser incluído na estrutura de [**\_ informações WSAPROTOCOL**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) retornada pela função [**WSAEnumProtocols**](/windows/desktop/api/Winsock2/nf-winsock2-wsaenumprotocolsa) para um ou mais dos provedores de transporte disponíveis.</span><span class="sxs-lookup"><span data-stu-id="ba50e-116">If a Winsock service provider supports **SOCK\_RAW** sockets for the AF\_INET or AF\_INET6 address families, the socket type of **SOCK\_RAW** should be included in the [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure returned by [**WSAEnumProtocols**](/windows/desktop/api/Winsock2/nf-winsock2-wsaenumprotocolsa) function for one or more of the available transport providers.</span></span>

<span data-ttu-id="ba50e-117">O membro **iAddressFamily** na estrutura [**de \_ informações de WSAPROTOCOL**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) deve especificar a INET6 de AF \_ ou AF \_ , e o membro **ISocketType** da estrutura de **\_ informações WSAPROTOCOL** deve especificar **Sock \_ RAW** para um dos provedores de transporte.</span><span class="sxs-lookup"><span data-stu-id="ba50e-117">The **iAddressFamily** member in the [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure should specify AF\_INET or AF\_INET6 and the **iSocketType** member of the **WSAPROTOCOL\_INFO** structure should specify **SOCK\_RAW** for one of the transport providers.</span></span>

<span data-ttu-id="ba50e-118">O membro **iProtocol** da estrutura [**de \_ informações de WSAPROTOCOL**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) pode ser definido como **IPROTO \_ IP**.</span><span class="sxs-lookup"><span data-stu-id="ba50e-118">The **iProtocol** member of the [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure may be set to **IPROTO\_IP**.</span></span> <span data-ttu-id="ba50e-119">O membro **iProtocol** da estrutura **de \_ informações de WSAPROTOCOL** também poderá ser definido como zero se o provedor de serviços permitir que um aplicativo use um tipo de soquete **\_ bruto Sock** para outros protocolos de rede que não sejam o protocolo de Internet para a família de endereços.</span><span class="sxs-lookup"><span data-stu-id="ba50e-119">The **iProtocol** member of the **WSAPROTOCOL\_INFO** structure may also be set to zero if the service provider allows an application to use a **SOCK\_RAW** socket type for other network protocols other than the Internet Protocol for the address family.</span></span>

<span data-ttu-id="ba50e-120">Os outros membros na estrutura [**de \_ informações WSAPROTOCOL**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) indicam outras propriedades do suporte de protocolo para **Sock \_ RAW** e indicam como um soquete de **Sock \_ bruto** deve ser tratado.</span><span class="sxs-lookup"><span data-stu-id="ba50e-120">The other members in the [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure indicate other properties of the protocol support for **SOCK\_RAW** and indicate how a socket of **SOCK\_RAW** should be treated.</span></span> <span data-ttu-id="ba50e-121">Esses outros membros das **\_ informações de WSAPROTOCOL** para o **Sock \_ RAW** normalmente especificam que o protocolo é sem conexão, orientado a mensagens, dá suporte à difusão/multicast (o XP1 sem \_ conexão e à \_ mensagem XP1, a difusão de suporte a \_ XP1 e os bits do MultiPoint com \_ \_ \_ suporte \_ são definidos no membro XP1) e pode ter um tamanho máximo de mensagem de 65.467 bytes.</span><span class="sxs-lookup"><span data-stu-id="ba50e-121">These other members of the **WSAPROTOCOL\_INFO** for **SOCK\_RAW** normally specify that the protocol is connectionless, message-oriented, supports broadcast/multicast (the XP1\_CONNECTIONLESS, XP1\_MESSAGE\_ORIENTED, XP1\_SUPPORT\_BROADCAST, and XP1\_SUPPORT\_MULTIPOINT bits are set in the dwServiceFlags1 member), and can have a maximum message size of 65,467 bytes.</span></span>

<span data-ttu-id="ba50e-122">No Windows XP e posterior, o comando *NetSh.exe* pode ser usado para determinar se há suporte para soquetes brutos.</span><span class="sxs-lookup"><span data-stu-id="ba50e-122">On Windows XP and later, the *NetSh.exe* command can be used to determine if raw sockets are supported.</span></span> <span data-ttu-id="ba50e-123">O comando a seguir executado de uma janela CMD exibirá dados do catálogo Winsock no console:</span><span class="sxs-lookup"><span data-stu-id="ba50e-123">The following command run from a CMD window will display data from the Winsock catalog on the console:</span></span>

<span data-ttu-id="ba50e-124">**netsh winsock mostrar catálogo**</span><span class="sxs-lookup"><span data-stu-id="ba50e-124">**netsh winsock show catalog**</span></span>

<span data-ttu-id="ba50e-125">A saída incluirá uma lista que contém alguns dos dados das estruturas de [**\_ informações de WSAPROTOCOL**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) com suporte no computador local.</span><span class="sxs-lookup"><span data-stu-id="ba50e-125">The output will include a list that contains some of the data from the [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structures supported on the local computer.</span></span> <span data-ttu-id="ba50e-126">Procure o termo RAW/IP ou RAW/IPv6 no campo Descrição para localizar os protocolos que oferecem suporte a soquetes brutos.</span><span class="sxs-lookup"><span data-stu-id="ba50e-126">Search for the term RAW/IP or RAW/IPv6 in the Description field to find those protocols that support raw sockets.</span></span>

## <a name="creating-a-raw-socket"></a><span data-ttu-id="ba50e-127">Criando um soquete bruto</span><span class="sxs-lookup"><span data-stu-id="ba50e-127">Creating a Raw Socket</span></span>

<span data-ttu-id="ba50e-128">Para criar um soquete do tipo **Sock \_ RAW**, chame a função [**Socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) ou [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) com o parâmetro *AF* (família de endereços) definido como \_ AF inet ou AF \_ INET6, o parâmetro de *tipo* definido como **Sock \_ RAW** e o parâmetro de *protocolo* definido como o número de protocolo necessário.</span><span class="sxs-lookup"><span data-stu-id="ba50e-128">To create a socket of type **SOCK\_RAW**, call the [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) or [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) function with the *af* parameter (address family) set to AF\_INET or AF\_INET6, the *type* parameter set to **SOCK\_RAW**, and the *protocol* parameter set to the protocol number required.</span></span> <span data-ttu-id="ba50e-129">O parâmetro de *protocolo* se torna o valor de protocolo no cabeçalho IP (SCTP é 132, por exemplo).</span><span class="sxs-lookup"><span data-stu-id="ba50e-129">The *protocol* parameter becomes the protocol value in the IP header (SCTP is 132, for example).</span></span>

> [!Note]  
> <span data-ttu-id="ba50e-130">Um aplicativo não pode especificar zero (0) como o parâmetro de *protocolo* para as funções [**Socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket), [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa)e [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket) se o parâmetro de *tipo* estiver definido como **Sock \_ RAW**.</span><span class="sxs-lookup"><span data-stu-id="ba50e-130">An application may not specify zero (0) as the *protocol* parameter for the [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket), [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa), and [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket) functions if the *type* parameter is set to **SOCK\_RAW**.</span></span>

 

<span data-ttu-id="ba50e-131">Os soquetes brutos oferecem a capacidade de manipular o transporte subjacente, para que possam ser usados para fins mal-intencionados que apresentam uma ameaça à segurança.</span><span class="sxs-lookup"><span data-stu-id="ba50e-131">Raw sockets offer the capability to manipulate the underlying transport, so they can be used for malicious purposes that pose a security threat.</span></span> <span data-ttu-id="ba50e-132">Portanto, somente os membros do grupo Administradores podem criar soquetes do tipo SOCK \_ RAW no Windows 2000 e posterior.</span><span class="sxs-lookup"><span data-stu-id="ba50e-132">Therefore, only members of the Administrators group can create sockets of type SOCK\_RAW on Windows 2000 and later.</span></span>

## <a name="send-and-receive-operations"></a><span data-ttu-id="ba50e-133">Operações de envio e recebimento</span><span class="sxs-lookup"><span data-stu-id="ba50e-133">Send and Receive Operations</span></span>

<span data-ttu-id="ba50e-134">Quando um aplicativo cria um soquete do tipo **Sock \_ RAW**, esse soquete pode ser usado para enviar e receber dados.</span><span class="sxs-lookup"><span data-stu-id="ba50e-134">Once an application creates a socket of type **SOCK\_RAW**, this socket may be used to send and receive data.</span></span> <span data-ttu-id="ba50e-135">Todos os pacotes enviados ou recebidos em um soquete do tipo **Sock \_ RAW** são tratados como datagrams em um soquete não conectado.</span><span class="sxs-lookup"><span data-stu-id="ba50e-135">All packets sent or received on a socket of type **SOCK\_RAW** are treated as datagrams on an unconnected socket.</span></span>

<span data-ttu-id="ba50e-136">As regras a seguir se aplicam às operações em soquetes **\_ brutos Sock** :</span><span class="sxs-lookup"><span data-stu-id="ba50e-136">The following rules apply to the operations over **SOCK\_RAW** sockets:</span></span>

-   <span data-ttu-id="ba50e-137">A função [**SendTo**](/windows/desktop/api/winsock/nf-winsock-sendto) ou [**WSASendTo**](/windows/desktop/api/Winsock2/nf-winsock2-wsasendto) normalmente é usada para enviar dados em um soquete do tipo **Sock \_ RAW**.</span><span class="sxs-lookup"><span data-stu-id="ba50e-137">The [**sendto**](/windows/desktop/api/winsock/nf-winsock-sendto) or [**WSASendTo**](/windows/desktop/api/Winsock2/nf-winsock2-wsasendto) function is normally used to send data on a socket of type **SOCK\_RAW**.</span></span> <span data-ttu-id="ba50e-138">O endereço de destino pode ser qualquer endereço válido na família de endereços do soquete, incluindo um endereço de difusão ou multicast.</span><span class="sxs-lookup"><span data-stu-id="ba50e-138">The destination address can be any valid address in the socket's address family, including a broadcast or multicast address.</span></span> <span data-ttu-id="ba50e-139">Para enviar para um endereço de difusão, um aplicativo deve ter usado [**setsockopt**](/windows/desktop/api/winsock/nf-winsock-setsockopt) com a \_ difusão habilitada.</span><span class="sxs-lookup"><span data-stu-id="ba50e-139">To send to a broadcast address, an application must have used [**setsockopt**](/windows/desktop/api/winsock/nf-winsock-setsockopt) with SO\_BROADCAST enabled.</span></span> <span data-ttu-id="ba50e-140">Caso contrário, **SendTo** ou **WSASendTo** falhará com o código de erro [WSAEACCES](windows-sockets-error-codes-2.md).</span><span class="sxs-lookup"><span data-stu-id="ba50e-140">Otherwise, **sendto** or **WSASendTo** will fail with the error code [WSAEACCES](windows-sockets-error-codes-2.md).</span></span> <span data-ttu-id="ba50e-141">Para IP, um aplicativo pode enviar para qualquer endereço de multicast (sem se tornar um membro do grupo).</span><span class="sxs-lookup"><span data-stu-id="ba50e-141">For IP, an application can send to any multicast address (without becoming a group member).</span></span>
-   <span data-ttu-id="ba50e-142">Ao enviar dados IPv4, um aplicativo tem a opção de especificar o cabeçalho IPv4 na frente do datagrama de saída para o pacote.</span><span class="sxs-lookup"><span data-stu-id="ba50e-142">When sending IPv4 data, an application has a choice on whether to specify the IPv4 header at the front of the outgoing datagram for the packet.</span></span> <span data-ttu-id="ba50e-143">Se a opção **IP \_ HDRINCL** Socket estiver definida como true para um soquete IPv4 (família de endereços da \_ inet série AF), o aplicativo deverá fornecer o cabeçalho IPv4 nos dados de saída para operações de envio.</span><span class="sxs-lookup"><span data-stu-id="ba50e-143">If the **IP\_HDRINCL** socket option is set to true for an IPv4 socket (address family of AF\_INET), the application must supply the IPv4 header in the outgoing data for send operations.</span></span> <span data-ttu-id="ba50e-144">Se essa opção de soquete for falsa (a configuração padrão), o cabeçalho IPv4 não deverá estar incluído nos dados de saída para operações de envio.</span><span class="sxs-lookup"><span data-stu-id="ba50e-144">If this socket option is false (the default setting), then the IPv4 header should not be in included the outgoing data for send operations.</span></span>
-   <span data-ttu-id="ba50e-145">Ao enviar dados IPv6, um aplicativo tem a opção de especificar o cabeçalho IPv6 na frente do datagrama de saída para o pacote.</span><span class="sxs-lookup"><span data-stu-id="ba50e-145">When sending IPv6 data, an application has a choice on whether to specify the IPv6 header at the front of the outgoing datagram for the packet.</span></span> <span data-ttu-id="ba50e-146">Se a opção de soquete de **\_ HDRINCL IPv6** estiver definida como true para um soquete IPv6 (família de endereços de AF \_ INET6), o aplicativo deverá fornecer o cabeçalho IPv6 nos dados de saída para operações de envio.</span><span class="sxs-lookup"><span data-stu-id="ba50e-146">If the **IPV6\_HDRINCL** socket option is set to true for an IPv6 socket (address family of AF\_INET6), the application must supply the IPv6 header in the outgoing data for send operations.</span></span> <span data-ttu-id="ba50e-147">A configuração padrão para essa opção é false.</span><span class="sxs-lookup"><span data-stu-id="ba50e-147">The default setting for this option is false.</span></span> <span data-ttu-id="ba50e-148">Se essa opção de soquete for falsa (a configuração padrão), o cabeçalho IPv6 não deverá ser incluído nos dados de saída para operações de envio.</span><span class="sxs-lookup"><span data-stu-id="ba50e-148">If this socket option is false (the default setting), then the IPv6 header should not be included in the outgoing data for send operations.</span></span> <span data-ttu-id="ba50e-149">Para IPv6, não deve haver necessidade de incluir o cabeçalho IPv6.</span><span class="sxs-lookup"><span data-stu-id="ba50e-149">For IPv6, there should be no need to include the IPv6 header.</span></span> <span data-ttu-id="ba50e-150">Se as informações estiverem disponíveis usando funções de soquete, o cabeçalho IPv6 não deverá ser incluído para evitar problemas de compatibilidade no futuro.</span><span class="sxs-lookup"><span data-stu-id="ba50e-150">If information is available using socket functions, then the IPv6 header should not be included to avoid compatibility problems in the future.</span></span> <span data-ttu-id="ba50e-151">Esses problemas são discutidos no RFC 3542 publicado pela IETF.</span><span class="sxs-lookup"><span data-stu-id="ba50e-151">These issues are discussed in RFC 3542 published by the IETF.</span></span> <span data-ttu-id="ba50e-152">Usar a opção de soquete de **\_ HDRINCL IPv6** não é recomendado e pode ser preterido no futuro.</span><span class="sxs-lookup"><span data-stu-id="ba50e-152">Using the **IPV6\_HDRINCL** socket option is not recommended and may be deprecated in future.</span></span>
-   <span data-ttu-id="ba50e-153">A função [**recvfrom**](/windows/desktop/api/winsock/nf-winsock-recvfrom) ou [**WSARecvFrom**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvfrom) normalmente é usada para receber dados em um soquete do tipo **\_ RAW Sock**.</span><span class="sxs-lookup"><span data-stu-id="ba50e-153">The [**recvfrom**](/windows/desktop/api/winsock/nf-winsock-recvfrom) or [**WSARecvFrom**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvfrom) function is normally used to receive data on a socket of type **SOCK\_RAW**.</span></span> <span data-ttu-id="ba50e-154">Ambas as funções têm uma opção para retornar o endereço IP de origem do qual o pacote foi enviado.</span><span class="sxs-lookup"><span data-stu-id="ba50e-154">Both of these functions have an option to return the source IP address where the packet was sent from.</span></span> <span data-ttu-id="ba50e-155">Os dados recebidos são um datagrama de um soquete não conectado.</span><span class="sxs-lookup"><span data-stu-id="ba50e-155">The received data is a datagram from an unconnected socket.</span></span>
-   <span data-ttu-id="ba50e-156">Para IPv4 (família de endereços da inet da série AF \_ ), um aplicativo recebe o cabeçalho IP na frente de cada datagrama recebido, independentemente da opção de soquete **IP \_ HDRINCL** .</span><span class="sxs-lookup"><span data-stu-id="ba50e-156">For IPv4 (address family of AF\_INET), an application receives the IP header at the front of each received datagram regardless of the **IP\_HDRINCL** socket option.</span></span>
-   <span data-ttu-id="ba50e-157">Para IPv6 (família de endereços de AF \_ INET6), um aplicativo recebe tudo após o último cabeçalho IPv6 em cada datagrama recebido, independentemente da opção de soquete **\_ HDRINCL do IPv6** .</span><span class="sxs-lookup"><span data-stu-id="ba50e-157">For IPv6 (address family of AF\_INET6), an application receives everything after the last IPv6 header in each received datagram regardless of the **IPV6\_HDRINCL** socket option.</span></span> <span data-ttu-id="ba50e-158">O aplicativo não recebe nenhum cabeçalho IPv6 usando um soquete bruto.</span><span class="sxs-lookup"><span data-stu-id="ba50e-158">The application does not receive any IPv6 headers using a raw socket.</span></span>
-   <span data-ttu-id="ba50e-159">Os datagramas recebidos são copiados em todos os soquetes **\_ brutos do Sock** que atendem às seguintes condições:</span><span class="sxs-lookup"><span data-stu-id="ba50e-159">Received datagrams are copied into all **SOCK\_RAW** sockets that satisfy the following conditions:</span></span>

    -   <span data-ttu-id="ba50e-160">O número de protocolo especificado no parâmetro de *protocolo* quando o soquete foi criado deve corresponder ao número de protocolo no cabeçalho IP do datagrama recebido.</span><span class="sxs-lookup"><span data-stu-id="ba50e-160">The protocol number specified in the *protocol* parameter when the socket was created should match the protocol number in the IP header of the received datagram.</span></span>
    -   <span data-ttu-id="ba50e-161">Se um endereço IP local for definido para o soquete, ele deverá corresponder ao endereço de destino conforme especificado no cabeçalho IP do datagrama recebido.</span><span class="sxs-lookup"><span data-stu-id="ba50e-161">If a local IP address is defined for the socket, it should correspond to the destination address as specified in the IP header of the received datagram.</span></span> <span data-ttu-id="ba50e-162">Um aplicativo pode especificar o endereço IP local chamando a função [**BIND**](/windows/desktop/api/winsock/nf-winsock-bind) .</span><span class="sxs-lookup"><span data-stu-id="ba50e-162">An application may specify the local IP address by calling the [**bind**](/windows/desktop/api/winsock/nf-winsock-bind) function.</span></span> <span data-ttu-id="ba50e-163">Se nenhum endereço IP local for especificado para o soquete, os datagrams serão copiados no soquete, independentemente do endereço IP de destino no cabeçalho IP do datagrama recebido.</span><span class="sxs-lookup"><span data-stu-id="ba50e-163">If no local IP address is specified for the socket, the datagrams are copied into the socket regardless of the destination IP address in the IP header of the received datagram.</span></span>
    -   <span data-ttu-id="ba50e-164">Se um endereço externo for definido para o soquete, ele deverá corresponder ao endereço de origem, conforme especificado no cabeçalho IP do datagrama recebido.</span><span class="sxs-lookup"><span data-stu-id="ba50e-164">If a foreign address is defined for the socket, it should correspond to the source address as specified in the IP header of the received datagram.</span></span> <span data-ttu-id="ba50e-165">Um aplicativo pode especificar o endereço IP externo chamando a função [**Connect**](/windows/desktop/api/Winsock2/nf-winsock2-connect) ou [**WSAConnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsaconnect) .</span><span class="sxs-lookup"><span data-stu-id="ba50e-165">An application may specify the foreign IP address by calling the [**connect**](/windows/desktop/api/Winsock2/nf-winsock2-connect) or [**WSAConnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsaconnect) function.</span></span> <span data-ttu-id="ba50e-166">Se nenhum endereço IP externo for especificado para o soquete, os datagramas serão copiados no soquete, independentemente do endereço IP de origem no cabeçalho IP do datagrama recebido.</span><span class="sxs-lookup"><span data-stu-id="ba50e-166">If no foreign IP address is specified for the socket, the datagrams are copied into the socket regardless of the source IP address in the IP header of the received datagram.</span></span>

<span data-ttu-id="ba50e-167">É importante entender que alguns soquetes do tipo **\_ RAW Sock** podem receber muitos datagramas inesperados.</span><span class="sxs-lookup"><span data-stu-id="ba50e-167">It is important to understand that some sockets of type **SOCK\_RAW** may receive many unexpected datagrams.</span></span> <span data-ttu-id="ba50e-168">Por exemplo, um programa PING pode criar um soquete do tipo **Sock \_ RAW** para enviar solicitações de eco ICMP e receber respostas.</span><span class="sxs-lookup"><span data-stu-id="ba50e-168">For example, a PING program may create a socket of type **SOCK\_RAW** to send ICMP echo requests and receive responses.</span></span> <span data-ttu-id="ba50e-169">Embora o aplicativo esteja esperando respostas de eco ICMP, todas as outras mensagens ICMP (como o HOST ICMP \_ inacessível) também podem ser entregues a esse aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ba50e-169">While the application is expecting ICMP echo responses, all other ICMP messages (such as ICMP HOST\_UNREACHABLE) may also be delivered to this application.</span></span> <span data-ttu-id="ba50e-170">Além disso, se vários soquetes **\_ brutos Sock** estiverem abertos em um computador ao mesmo tempo, os mesmos datagramas poderão ser entregues a todos os soquetes abertos.</span><span class="sxs-lookup"><span data-stu-id="ba50e-170">Moreover, if several **SOCK\_RAW** sockets are open on a computer at the same time, the same datagrams may be delivered to all the open sockets.</span></span> <span data-ttu-id="ba50e-171">Um aplicativo deve ter um mecanismo para reconhecer os datagramas de interesse e ignorar todos os outros.</span><span class="sxs-lookup"><span data-stu-id="ba50e-171">An application must have a mechanism to recognize the datagrams of interest and to ignore all others.</span></span> <span data-ttu-id="ba50e-172">Para um programa PING, tal mecanismo pode incluir inspecionar o cabeçalho IP recebido para identificadores exclusivos no cabeçalho ICMP (a ID do processo do aplicativo, por exemplo).</span><span class="sxs-lookup"><span data-stu-id="ba50e-172">For a PING program, such a mechanism might include inspecting the received IP header for unique identifiers in the ICMP header (the application's process ID, for example).</span></span>

> [!Note]  
> <span data-ttu-id="ba50e-173">Para usar um soquete do tipo **Sock \_ RAW** , é necessário ter privilégios administrativos.</span><span class="sxs-lookup"><span data-stu-id="ba50e-173">To use a socket of type **SOCK\_RAW** requires administrative privileges.</span></span> <span data-ttu-id="ba50e-174">Os usuários que executam aplicativos Winsock que usam soquetes brutos devem ser membros do grupo Administradores no computador local, caso contrário, as chamadas de soquete brutas falharão com um código de erro de [WSAEACCES](windows-sockets-error-codes-2.md).</span><span class="sxs-lookup"><span data-stu-id="ba50e-174">Users running Winsock applications that use raw sockets must be a member of the Administrators group on the local computer, otherwise raw socket calls will fail with an error code of [WSAEACCES](windows-sockets-error-codes-2.md).</span></span> <span data-ttu-id="ba50e-175">No Windows Vista e posterior, o acesso a soquetes brutos é imposto na criação do soquete.</span><span class="sxs-lookup"><span data-stu-id="ba50e-175">On Windows Vista and later, access for raw sockets is enforced at socket creation.</span></span> <span data-ttu-id="ba50e-176">Nas versões anteriores do Windows, o acesso a soquetes brutos é imposto durante outras operações de soquete.</span><span class="sxs-lookup"><span data-stu-id="ba50e-176">In earlier versions of Windows, access for raw sockets is enforced during other socket operations.</span></span>

 

## <a name="common-uses-of-raw-sockets"></a><span data-ttu-id="ba50e-177">Usos comuns de soquetes brutos</span><span class="sxs-lookup"><span data-stu-id="ba50e-177">Common Uses of Raw Sockets</span></span>

<span data-ttu-id="ba50e-178">Um uso comum de soquetes brutos é a solução de problemas de aplicativos que precisam examinar pacotes IP e cabeçalhos em detalhes.</span><span class="sxs-lookup"><span data-stu-id="ba50e-178">One common use of raw sockets are troubleshooting applications that need to examine IP packets and headers in detail.</span></span> <span data-ttu-id="ba50e-179">Por exemplo, um soquete bruto pode ser usado com o \_ IOCTL sio RCVALL para permitir que um soquete receba todos os pacotes IPv4 ou IPv6 passando por uma interface de rede.</span><span class="sxs-lookup"><span data-stu-id="ba50e-179">For example, a raw socket can be used with the SIO\_RCVALL IOCTL to enable a socket to receive all IPv4 or IPv6 packets passing through a network interface.</span></span> <span data-ttu-id="ba50e-180">Para obter mais informações, consulte a referência do [**sio \_ RCVALL**](/previous-versions/windows/desktop/legacy/ee309610(v=vs.85)) .</span><span class="sxs-lookup"><span data-stu-id="ba50e-180">For more information, see the [**SIO\_RCVALL**](/previous-versions/windows/desktop/legacy/ee309610(v=vs.85)) reference.</span></span>

## <a name="limitations-on-raw-sockets"></a><span data-ttu-id="ba50e-181">Limitações em soquetes brutos</span><span class="sxs-lookup"><span data-stu-id="ba50e-181">Limitations on Raw Sockets</span></span>

<span data-ttu-id="ba50e-182">No Windows 7, no Windows Vista, no Windows XP com Service Pack 2 (SP2) e no Windows XP com Service Pack 3 (SP3), a capacidade de enviar tráfego sobre soquetes brutos foi restrita de várias maneiras:</span><span class="sxs-lookup"><span data-stu-id="ba50e-182">On Windows 7, Windows Vista, Windows XP with Service Pack 2 (SP2), and Windows XP with Service Pack 3 (SP3), the ability to send traffic over raw sockets has been restricted in several ways:</span></span>

-   <span data-ttu-id="ba50e-183">Os dados TCP não podem ser enviados por meio de soquetes brutos.</span><span class="sxs-lookup"><span data-stu-id="ba50e-183">TCP data cannot be sent over raw sockets.</span></span>
-   <span data-ttu-id="ba50e-184">Os datagramas UDP com um endereço de origem inválido não podem ser enviados por meio de soquetes brutos.</span><span class="sxs-lookup"><span data-stu-id="ba50e-184">UDP datagrams with an invalid source address cannot be sent over raw sockets.</span></span> <span data-ttu-id="ba50e-185">O endereço IP de origem para qualquer datagrama UDP de saída deve existir em uma interface de rede ou o datagrama é Descartado.</span><span class="sxs-lookup"><span data-stu-id="ba50e-185">The IP source address for any outgoing UDP datagram must exist on a network interface or the datagram is dropped.</span></span> <span data-ttu-id="ba50e-186">Essa alteração foi feita para limitar a capacidade de código mal-intencionado de criar ataques de negação de serviço distribuídos e limita a capacidade de enviar pacotes falsificados (pacotes TCP/IP com um endereço IP de origem forjado).</span><span class="sxs-lookup"><span data-stu-id="ba50e-186">This change was made to limit the ability of malicious code to create distributed denial-of-service attacks and limits the ability to send spoofed packets (TCP/IP packets with a forged source IP address).</span></span>
-   <span data-ttu-id="ba50e-187">Não é permitida uma chamada para a função [**BIND**](/windows/desktop/api/winsock/nf-winsock-bind) com um soquete bruto para o \_ protocolo TCP IPPROTO.</span><span class="sxs-lookup"><span data-stu-id="ba50e-187">A call to the [**bind**](/windows/desktop/api/winsock/nf-winsock-bind) function with a raw socket for the IPPROTO\_TCP protocol is not allowed.</span></span>
    > [!Note]  
    > <span data-ttu-id="ba50e-188">A função [**BIND**](/windows/desktop/api/winsock/nf-winsock-bind) com um soquete bruto é permitida para outros protocolos (IPPROTO \_ IP, IPPROTO \_ UDP ou IPPROTO \_ SCTP, por exemplo).</span><span class="sxs-lookup"><span data-stu-id="ba50e-188">The [**bind**](/windows/desktop/api/winsock/nf-winsock-bind) function with a raw socket is allowed for other protocols (IPPROTO\_IP, IPPROTO\_UDP, or IPPROTO\_SCTP, for example).</span></span>

     

<span data-ttu-id="ba50e-189">Essas restrições acima não se aplicam ao Windows Server 2008 R2, ao Windows Server 2008, ao Windows Server 2003 ou às versões do sistema operacional anteriores ao Windows XP com SP2.</span><span class="sxs-lookup"><span data-stu-id="ba50e-189">These above restrictions do not apply to Windows Server 2008 R2, Windows Server 2008 , Windows Server 2003, or to versions of the operating system earlier than Windows XP with SP2.</span></span>

> [!Note]  
> <span data-ttu-id="ba50e-190">A implementação da Microsoft do TCP/IP no Windows é capaz de abrir um soquete UDP ou TCP bruto com base nas restrições acima.</span><span class="sxs-lookup"><span data-stu-id="ba50e-190">The Microsoft implementation of TCP/IP on Windows is capable of opening a raw UDP or TCP socket based on the above restrictions.</span></span> <span data-ttu-id="ba50e-191">Outros provedores Winsock podem não dar suporte ao uso de soquetes brutos.</span><span class="sxs-lookup"><span data-stu-id="ba50e-191">Other Winsock providers may not support the use of raw sockets.</span></span>

 

<span data-ttu-id="ba50e-192">Há mais limitações para aplicativos que usam um soquete do tipo **Sock \_ RAW**.</span><span class="sxs-lookup"><span data-stu-id="ba50e-192">There are further limitations for applications that use a socket of type **SOCK\_RAW**.</span></span> <span data-ttu-id="ba50e-193">Por exemplo, todos os aplicativos que escutam um protocolo específico receberão todos os pacotes recebidos para esse protocolo.</span><span class="sxs-lookup"><span data-stu-id="ba50e-193">For example, all applications listening for a specific protocol will receive all packets received for this protocol.</span></span> <span data-ttu-id="ba50e-194">Isso pode não ser o que é desejado para vários aplicativos usando um protocolo.</span><span class="sxs-lookup"><span data-stu-id="ba50e-194">This may not be what is desired for multiple applications using a protocol.</span></span> <span data-ttu-id="ba50e-195">Isso também não é adequado para aplicativos de alto desempenho.</span><span class="sxs-lookup"><span data-stu-id="ba50e-195">This is also not suitable for high-performance applications.</span></span> <span data-ttu-id="ba50e-196">Para resolver esses problemas, pode ser necessário gravar um driver de protocolo de rede do Windows (driver de dispositivo) para o protocolo de rede específico.</span><span class="sxs-lookup"><span data-stu-id="ba50e-196">To get around these issues, it may be required to write a Windows network protocol driver (device driver) for the specific network protocol.</span></span> <span data-ttu-id="ba50e-197">No Windows Vista e posterior, o kernel do Winsock (WSK), uma nova interface de programação de rede de modo de kernel independente de transporte pode ser usada para gravar um driver de protocolo de rede.</span><span class="sxs-lookup"><span data-stu-id="ba50e-197">On Windows Vista and later, Winsock Kernel (WSK), a new transport-independent kernel mode Network Programming Interface can be used to write a network protocol driver.</span></span> <span data-ttu-id="ba50e-198">No Windows Server 2003 e versões anteriores, um provedor de interface do driver de transporte (TDI) e uma DLL auxiliar do Winsock podem ser escritos para dar suporte ao protocolo de rede.</span><span class="sxs-lookup"><span data-stu-id="ba50e-198">On Windows Server 2003 and earlier, a Transport Driver Interface (TDI) provider and a Winsock helper DLL can be written to support the network protocol.</span></span> <span data-ttu-id="ba50e-199">O protocolo de rede seria então adicionado ao catálogo do Winsock como um protocolo com suporte.</span><span class="sxs-lookup"><span data-stu-id="ba50e-199">The network protocol would then be added to the Winsock catalog as a supported protocol.</span></span> <span data-ttu-id="ba50e-200">Isso permite que vários aplicativos abram soquetes para esse protocolo específico e o driver de dispositivo possa manter o controle de qual soquete recebe erros e pacotes específicos.</span><span class="sxs-lookup"><span data-stu-id="ba50e-200">This allows multiple applications to open sockets for this specific protocol and the device driver can keep track of which socket receives specific packets and errors.</span></span> <span data-ttu-id="ba50e-201">Para obter informações sobre como escrever um provedor de protocolo de rede, consulte as seções em WSK e TDI no Windows Driver Kit (WDK).</span><span class="sxs-lookup"><span data-stu-id="ba50e-201">For information on writing a network protocol provider, see the sections on WSK and TDI in the Windows Driver Kit (WDK).</span></span>

<span data-ttu-id="ba50e-202">Os aplicativos também precisam estar cientes do impacto que as configurações de firewall podem ter ao enviar e receber pacotes usando soquetes brutos.</span><span class="sxs-lookup"><span data-stu-id="ba50e-202">Applications also need to be aware of the impact that firewall settings may have on sending and receiving packets using raw sockets.</span></span>

 

 
