---
title: Categorizando provedores de serviços em camadas e aplicativos
description: O Winsock 2 acomoda protocolos em camadas.
ms.assetid: 1c5efd2e-1b42-4c20-a4da-b81a5fc4243c
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a966d54da0be26f75a074de18abe1b9e080c0c9f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105813584"
---
# <a name="categorizing-layered-service-providers-and-apps"></a><span data-ttu-id="8d65d-103">Categorizando provedores de serviços em camadas e aplicativos</span><span class="sxs-lookup"><span data-stu-id="8d65d-103">Categorizing layered service providers and apps</span></span>

> [!Note]  
> <span data-ttu-id="8d65d-104">Os provedores de serviço em camadas são preteridos.</span><span class="sxs-lookup"><span data-stu-id="8d65d-104">Layered Service Providers are deprecated.</span></span> <span data-ttu-id="8d65d-105">A partir do Windows 8 e do Windows Server 2012, use a [plataforma de filtragem do Windows](../fwp/windows-filtering-platform-start-page.md).</span><span class="sxs-lookup"><span data-stu-id="8d65d-105">Starting with Windows 8 and Windows Server 2012, use [Windows Filtering Platform](../fwp/windows-filtering-platform-start-page.md).</span></span>

 

<span data-ttu-id="8d65d-106">O Winsock 2 acomoda protocolos em camadas.</span><span class="sxs-lookup"><span data-stu-id="8d65d-106">Winsock 2 accommodates layered protocols.</span></span> <span data-ttu-id="8d65d-107">Um protocolo em camadas é aquele que implementa apenas funções de comunicação de nível mais alto, enquanto dependem de uma pilha de transporte subjacente para a troca real de dados com um ponto de extremidade remoto.</span><span class="sxs-lookup"><span data-stu-id="8d65d-107">A layered protocol is one that implements only higher level communications functions, while relying on an underlying transport stack for the actual exchange of data with a remote endpoint.</span></span> <span data-ttu-id="8d65d-108">Um exemplo de um protocolo em camadas ou de um provedor de serviços em camadas seria uma camada de segurança que adiciona o protocolo ao processo de estabelecimento da conexão para executar a autenticação e estabelecer um esquema de criptografia acordado mutuamente.</span><span class="sxs-lookup"><span data-stu-id="8d65d-108">An example of a layered protocol or layered service provider would be a security layer that adds protocol to the connection establishment process in order to perform authentication and to establish a mutually agreed upon encryption scheme.</span></span> <span data-ttu-id="8d65d-109">Esse protocolo de segurança, em geral, exigiria os serviços de um protocolo de transporte confiável subjacente, como TCP ou SPX.</span><span class="sxs-lookup"><span data-stu-id="8d65d-109">Such a security protocol would generally require the services of an underlying reliable transport protocol such as TCP or SPX.</span></span> <span data-ttu-id="8d65d-110">O termo protocolo base implementado pelo provedor base refere-se a um provedor de Winsock que implementa um protocolo como TCP ou SPX que é capaz de executar comunicações de dados com um ponto de extremidade remoto.</span><span class="sxs-lookup"><span data-stu-id="8d65d-110">The term base protocol implemented by base provider refers to a Winsock provider that implements a protocol such as TCP or SPX which is capable of performing data communications with a remote endpoint.</span></span> <span data-ttu-id="8d65d-111">O termo protocolo em camadas é usado para descrever um protocolo que não pode ser autônomo.</span><span class="sxs-lookup"><span data-stu-id="8d65d-111">The term layered protocol is used to describe a protocol that cannot stand alone.</span></span> <span data-ttu-id="8d65d-112">Esses protocolos em camadas são instalados como LSPs (provedores de serviços em camadas) do Winsock.</span><span class="sxs-lookup"><span data-stu-id="8d65d-112">These layered protocols are installed as Winsock Layered Service Providers (LSPs).</span></span>

<span data-ttu-id="8d65d-113">Um exemplo de LSP é o provedor de serviços de firewall da Microsoft instalado como parte do servidor de autenticação e secutity da Internet (ISA) em clientes.</span><span class="sxs-lookup"><span data-stu-id="8d65d-113">An example of an LSP is the Microsoft Firewall Client Service Provider installed as part of the Internet Secutity and Authentication Server (ISA) on clients.</span></span> <span data-ttu-id="8d65d-114">O provedor de serviços do Microsoft Firewall Client é instalado nos provedores de base do Winsock para TCP e UDP.</span><span class="sxs-lookup"><span data-stu-id="8d65d-114">The Microsoft Firewall Client Service Provider installs over the Winsock base providers for TCP and UDP.</span></span> <span data-ttu-id="8d65d-115">Uma DLL (biblioteca de vínculo dinâmico) no software cliente do ISA firewall se torna um provedor de serviços em camadas do Winsock que todos os aplicativos Winsock usam de forma transparente.</span><span class="sxs-lookup"><span data-stu-id="8d65d-115">A dynamic-link library (DLL) in the ISA Firewall Client software becomes a Winsock layered service provider that all Winsock applications use transparently.</span></span> <span data-ttu-id="8d65d-116">Dessa forma, o LSP do cliente ISA firewall pode interceptar chamadas de função Winsock de aplicativos cliente e, em seguida, rotear uma solicitação para o provedor de serviço base subjacente original se o destino for local ou para o serviço de firewall em um computador do ISA Server se o destino for remoto.</span><span class="sxs-lookup"><span data-stu-id="8d65d-116">This way, the ISA Firewall Client LSP can intercept Winsock function calls from client applications and then route a request to the original underlying base service provider if the destination is local or to the Firewall service on an ISA Server computer if the destination is remote.</span></span> <span data-ttu-id="8d65d-117">Um LSP semelhante é instalado como parte do serviço Microsoft Forefront firewall e do cliente TMG (Threat Management Gateway) em clientes.</span><span class="sxs-lookup"><span data-stu-id="8d65d-117">A similar LSP is installed as part of the Microsoft Forefront Firewall Service and the Threat Management Gateway (TMG) Client on clients.</span></span>

<span data-ttu-id="8d65d-118">Durante a inicialização de LSP, o LSP deve fornecer ponteiros para uma série de funções de SPI (interface do provedor de serviço) do Winsock.</span><span class="sxs-lookup"><span data-stu-id="8d65d-118">During LSP initialization, the LSP must provide pointers to a number of Winsock Service Provider Interface (SPI) functions.</span></span> <span data-ttu-id="8d65d-119">Essas funções serão chamadas durante o processamento normal pela camada diretamente acima do LSP (outro LSP ou Ws2 \_32.DLL).</span><span class="sxs-lookup"><span data-stu-id="8d65d-119">These functions will be called during normal processing by the layer directly above the LSP (either another LSP or Ws2\_32.DLL).</span></span>

<span data-ttu-id="8d65d-120">É possível definir categorias de LSP com base no subconjunto de funções SPI que um LSP implementa e a natureza do processamento extra realizado para cada uma dessas funções.</span><span class="sxs-lookup"><span data-stu-id="8d65d-120">It is possible to define LSP categories based upon the subset of SPI functions an LSP implements and the nature of the extra processing performed for each of those functions.</span></span> <span data-ttu-id="8d65d-121">Ao classificar LSPs, além de classificar os aplicativos que usam soquetes Winsock, é possível determinar seletivamente se um LSP deve estar envolvido em um determinado processo no tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="8d65d-121">By classifying LSPs, as well as classifying applications which use Winsock sockets, it becomes possible to selectively determine if an LSP should be involved in a given process at runtime.</span></span>

<span data-ttu-id="8d65d-122">No Windows Vista e posterior, um novo método é fornecido para categorizar os provedores de serviços em camadas do Winsock e os aplicativos para que apenas determinados LSPs sejam carregados.</span><span class="sxs-lookup"><span data-stu-id="8d65d-122">On Windows Vista and later, a new method is provided for categorizing both Winsock Layered Service Providers and applications so that only certain LSPs will be loaded.</span></span> <span data-ttu-id="8d65d-123">Há vários motivos para adicionar esses recursos.</span><span class="sxs-lookup"><span data-stu-id="8d65d-123">There are several reasons for adding these features.</span></span>

<span data-ttu-id="8d65d-124">Um dos principais motivos é que determinados processos críticos do sistema, como Winlogon e LSASS, criam soquetes, mas esses processos não usam esses soquetes para enviar qualquer tráfego na rede.</span><span class="sxs-lookup"><span data-stu-id="8d65d-124">One of the primary reasons is that certain system critical processes such as winlogon and lsass create sockets, but these processes do not use these sockets to send any traffic on the network.</span></span> <span data-ttu-id="8d65d-125">Portanto, a maioria dos LSPs não deve ser carregada nesses processos.</span><span class="sxs-lookup"><span data-stu-id="8d65d-125">So most LSPs should not be loaded into these processes.</span></span> <span data-ttu-id="8d65d-126">Vários casos também foram documentados em que LSPs de bugs podem causar *lsass.exe* a falhar.</span><span class="sxs-lookup"><span data-stu-id="8d65d-126">A number of cases have also been documented where buggy LSPs can cause *lsass.exe* to crash.</span></span> <span data-ttu-id="8d65d-127">Se o LSASS falhar, o sistema forçará um desligamento.</span><span class="sxs-lookup"><span data-stu-id="8d65d-127">If lsass crashes, the system forces a shutdown.</span></span> <span data-ttu-id="8d65d-128">Um efeito colateral desses processos do sistema de carregamento de LSPs é que esses processos nunca são encerrados, assim quando um LSP é instalado ou removido, uma reinicialização é necessária.</span><span class="sxs-lookup"><span data-stu-id="8d65d-128">A side affect of these system processes loading LSPs is that these processes never exit so when an LSP is installed or removed, a reboot is required.</span></span>

<span data-ttu-id="8d65d-129">Um motivo secundário é que há alguns casos em que os aplicativos podem não querer carregar determinados LSPs.</span><span class="sxs-lookup"><span data-stu-id="8d65d-129">A secondary reason is that there are some cases where applications may not want to load certain LSPs.</span></span> <span data-ttu-id="8d65d-130">Por exemplo, alguns aplicativos podem não querer carregar LSPs criptográficos que poderiam impedir que o aplicativo se comunique com outros sistemas que não têm o LSP cyptographic instalado.</span><span class="sxs-lookup"><span data-stu-id="8d65d-130">For example, some applications may not want to load cryptographic LSPs which could prevent the application from communicating with other systems that do not have the cyptographic LSP installed.</span></span>

<span data-ttu-id="8d65d-131">Por fim, as categorias de LSP podem ser usadas por outros LSPs para determinar onde na cadeia de protocolo Winsock eles devem se instalar.</span><span class="sxs-lookup"><span data-stu-id="8d65d-131">Finally, LSP categories can be used by other LSPs to determine where in the Winsock protocol chain they should install themselves.</span></span> <span data-ttu-id="8d65d-132">Há anos, vários desenvolvedores de LSP queriam uma maneira de saber como um LSP se comportará.</span><span class="sxs-lookup"><span data-stu-id="8d65d-132">For years, various LSP developers have wanted a way of knowing how an LSP will behave.</span></span> <span data-ttu-id="8d65d-133">Por exemplo, um LSP que inspeciona o fluxo de dados deve estar acima de um LSP que criptografa os dados.</span><span class="sxs-lookup"><span data-stu-id="8d65d-133">For example, an LSP that inspects the data stream would want to be above an LSP that encrypts the data.</span></span> <span data-ttu-id="8d65d-134">É claro que esse método de categorização de LSP não é uma prova de obsolescência, pois se baseia em LSPs de terceiros para se categorizar adequadamente.</span><span class="sxs-lookup"><span data-stu-id="8d65d-134">Of course, this method of LSP categorization isn't fool proof since it relies on third-party LSPs to categorize themselves appropriately.</span></span>

<span data-ttu-id="8d65d-135">A categorização de LSP e outros aprimoramentos de segurança no Windows Vista e versões posteriores foram criados para ajudar a impedir que os usuários instalem os LSPs mal-intencionados de forma não intencional.</span><span class="sxs-lookup"><span data-stu-id="8d65d-135">The LSP categorization and other security enhancements in Windows Vista and later are designed to help prevent users from unintentionally installing malicious LSPs.</span></span>

## <a name="lsp-categories"></a><span data-ttu-id="8d65d-136">Categorias de LSP</span><span class="sxs-lookup"><span data-stu-id="8d65d-136">LSP Categories</span></span>

<span data-ttu-id="8d65d-137">No Windows Vista e posterior, um LSP pode ser classificado com base em como ele interage com os dados e as chamadas do Windows Sockets.</span><span class="sxs-lookup"><span data-stu-id="8d65d-137">On Windows Vista and later, an LSP can be classified based on how it interacts with Windows Sockets calls and data.</span></span> <span data-ttu-id="8d65d-138">Uma categoria LSP é um grupo de comportamentos identificável em um subconjunto de funções SPI do Winsock.</span><span class="sxs-lookup"><span data-stu-id="8d65d-138">An LSP category is an identifiable group of behaviors on a subset of Winsock SPI functions.</span></span> <span data-ttu-id="8d65d-139">Por exemplo, um filtro de conteúdo HTTP seria Categorizado como um inspetor de dados (a \_ categoria do Inspetor LSP).</span><span class="sxs-lookup"><span data-stu-id="8d65d-139">For example, an HTTP content filter would be categorized as a data inspector (the LSP\_INSPECTOR category).</span></span> <span data-ttu-id="8d65d-140">A categoria do Inspetor de LSP \_ inspecionará (mas não alterar) os parâmetros para as funções SPI de transferência de dados.</span><span class="sxs-lookup"><span data-stu-id="8d65d-140">The LSP\_INSPECTOR category will inspect (but not alter) parameters to data transfer SPI functions.</span></span> <span data-ttu-id="8d65d-141">Um aplicativo pode consultar a categoria de um LSP e optar por não carregar o LSP com base na categoria de LSP e no conjunto de categorias LSP permitidas do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="8d65d-141">An application can query for the category of an LSP and choose to not load the LSP based on the LSP category and the application's set of permitted LSP categories.</span></span>

<span data-ttu-id="8d65d-142">A tabela a seguir lista as categorias nas quais um LSP pode ser classificado.</span><span class="sxs-lookup"><span data-stu-id="8d65d-142">The following table lists categories that an LSP can be classified into.</span></span>

| <span data-ttu-id="8d65d-143">Categoria de LSP</span><span class="sxs-lookup"><span data-stu-id="8d65d-143">LSP Category</span></span>              | <span data-ttu-id="8d65d-144">Descrição</span><span class="sxs-lookup"><span data-stu-id="8d65d-144">Description</span></span>                                                     |
|---------------------------|-----------------------------------------------------------------|
| <span data-ttu-id="8d65d-145">**\_compactação de criptografia LSP \_**</span><span class="sxs-lookup"><span data-stu-id="8d65d-145">**LSP\_CRYPTO\_COMPRESS**</span></span> | <span data-ttu-id="8d65d-146">O LSP é um provedor de criptografia ou de compactação de dados.</span><span class="sxs-lookup"><span data-stu-id="8d65d-146">The LSP is a cryptography or data compression provider.</span></span>         |
| <span data-ttu-id="8d65d-147">**\_Firewall LSP**</span><span class="sxs-lookup"><span data-stu-id="8d65d-147">**LSP\_FIREWALL**</span></span>         | <span data-ttu-id="8d65d-148">O LSP é um provedor de firewall.</span><span class="sxs-lookup"><span data-stu-id="8d65d-148">The LSP is a firewall provider.</span></span>                                 |
| <span data-ttu-id="8d65d-149">**\_cache local \_ LSP**</span><span class="sxs-lookup"><span data-stu-id="8d65d-149">**LSP\_LOCAL\_CACHE**</span></span>     | <span data-ttu-id="8d65d-150">O LSP é um provedor de cache local.</span><span class="sxs-lookup"><span data-stu-id="8d65d-150">The LSP is a local cache provider.</span></span>                              |
| <span data-ttu-id="8d65d-151">**modificação de entrada de LSP \_ \_**</span><span class="sxs-lookup"><span data-stu-id="8d65d-151">**LSP\_INBOUND\_MODIFY**</span></span>  | <span data-ttu-id="8d65d-152">O LSP modifica os dados de entrada.</span><span class="sxs-lookup"><span data-stu-id="8d65d-152">The LSP modifies inbound data.</span></span>                                  |
| <span data-ttu-id="8d65d-153">**Inspetor de LSP \_**</span><span class="sxs-lookup"><span data-stu-id="8d65d-153">**LSP\_INSPECTOR**</span></span>        | <span data-ttu-id="8d65d-154">O LSP inspeciona ou filtra os dados.</span><span class="sxs-lookup"><span data-stu-id="8d65d-154">The LSP inspects or filters data.</span></span>                               |
| <span data-ttu-id="8d65d-155">**\_modificação de saída de LSP \_**</span><span class="sxs-lookup"><span data-stu-id="8d65d-155">**LSP\_OUTBOUND\_MODIFY**</span></span> | <span data-ttu-id="8d65d-156">O LSP modifica os dados de saída.</span><span class="sxs-lookup"><span data-stu-id="8d65d-156">The LSP modifies outbound data.</span></span>                                 |
| <span data-ttu-id="8d65d-157">**\_proxy LSP**</span><span class="sxs-lookup"><span data-stu-id="8d65d-157">**LSP\_PROXY**</span></span>            | <span data-ttu-id="8d65d-158">O LSP atua como um proxy e redireciona os pacotes.</span><span class="sxs-lookup"><span data-stu-id="8d65d-158">The LSP acts as a proxy and redirects packets.</span></span>                  |
| <span data-ttu-id="8d65d-159">**Redirecionador de LSP \_**</span><span class="sxs-lookup"><span data-stu-id="8d65d-159">**LSP\_REDIRECTOR**</span></span>       | <span data-ttu-id="8d65d-160">O LSP é um redirecionador de rede.</span><span class="sxs-lookup"><span data-stu-id="8d65d-160">The LSP is a network redirector.</span></span>                                |
| <span data-ttu-id="8d65d-161">**\_sistema LSP**</span><span class="sxs-lookup"><span data-stu-id="8d65d-161">**LSP\_SYSTEM**</span></span>           | <span data-ttu-id="8d65d-162">O LSP é aceitável para uso em serviços e processos do sistema.</span><span class="sxs-lookup"><span data-stu-id="8d65d-162">The LSP is acceptable for use in services and system processes.</span></span> |



 

<span data-ttu-id="8d65d-163">Um LSP pode pertencer a mais de uma categoria.</span><span class="sxs-lookup"><span data-stu-id="8d65d-163">An LSP may belong to more than one category.</span></span> <span data-ttu-id="8d65d-164">Por exemplo, um LSP de firewall/segurança poderia pertencer às categorias Inspetor (**LSP \_ Inspector**) e firewall **( \_ Firewall LSP**).</span><span class="sxs-lookup"><span data-stu-id="8d65d-164">For example, a firewall/security LSP could belong to both the inspector (**LSP\_INSPECTOR**) and firewall (**LSP\_FIREWALL**) categories.</span></span>

<span data-ttu-id="8d65d-165">Se um LSP não tiver uma categoria definida, ele será considerado na categoria todos.</span><span class="sxs-lookup"><span data-stu-id="8d65d-165">If an LSP does not have a category set, it is considered to be in the All Other category.</span></span> <span data-ttu-id="8d65d-166">Essa categoria de LSP não será carregada em serviços ou processos do sistema (por exemplo, LSASS, Winlogon e muitos processos do svchost).</span><span class="sxs-lookup"><span data-stu-id="8d65d-166">This LSP category will not be loaded in services or system processes (for example, lsass, winlogon, and many svchost processes).</span></span>

## <a name="categorizing-lsps"></a><span data-ttu-id="8d65d-167">Categorizando LSPs</span><span class="sxs-lookup"><span data-stu-id="8d65d-167">Categorizing LSPs</span></span>

<span data-ttu-id="8d65d-168">Várias novas funções estão disponíveis no Windows Vista e posterior para categorizar um LSP:</span><span class="sxs-lookup"><span data-stu-id="8d65d-168">Several new functions are available on Windows Vista and later for categorizing an LSP:</span></span>

-   [<span data-ttu-id="8d65d-169">**WSCGetProviderInfo**</span><span class="sxs-lookup"><span data-stu-id="8d65d-169">**WSCGetProviderInfo**</span></span>](/windows/desktop/api/Ws2spi/nf-ws2spi-wscgetproviderinfo)
-   [<span data-ttu-id="8d65d-170">**WSCGetProviderInfo32**</span><span class="sxs-lookup"><span data-stu-id="8d65d-170">**WSCGetProviderInfo32**</span></span>](/windows/desktop/api/Ws2spi/nf-ws2spi-wscgetproviderinfo32)
-   [<span data-ttu-id="8d65d-171">**WSCSetProviderInfo**</span><span class="sxs-lookup"><span data-stu-id="8d65d-171">**WSCSetProviderInfo**</span></span>](/windows/desktop/api/Ws2spi/nf-ws2spi-wscsetproviderinfo)
-   [<span data-ttu-id="8d65d-172">**WSCSetProviderInfo32**</span><span class="sxs-lookup"><span data-stu-id="8d65d-172">**WSCSetProviderInfo32**</span></span>](/windows/desktop/api/Ws2spi/nf-ws2spi-wscsetproviderinfo32)

<span data-ttu-id="8d65d-173">Para categorizar um LSP, a função [**WSCSetProviderInfo**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscsetproviderinfo) ou [**WSCSetProviderInfo32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscsetproviderinfo32) é chamada com um GUID para identificar a entrada oculta de LSP, a classe Information a ser definida para essa entrada de protocolo LSP e um conjunto de sinalizadores usado para modificar o comportamento da função.</span><span class="sxs-lookup"><span data-stu-id="8d65d-173">In order to categorize an LSP, the [**WSCSetProviderInfo**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscsetproviderinfo) or [**WSCSetProviderInfo32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscsetproviderinfo32) function is called with a GUID to identify the LSP hidden entry, the information class to be set for this LSP protocol entry, and a set of flags used to modify the behavior of the function.</span></span>

<span data-ttu-id="8d65d-174">A função [**WSCGetProviderInfo**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscgetproviderinfo) ou [**WSCGetProviderInfo32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscgetproviderinfo32) é usada da mesma forma para recuperar os dados associados a uma classe de informações para um LSP.</span><span class="sxs-lookup"><span data-stu-id="8d65d-174">The [**WSCGetProviderInfo**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscgetproviderinfo) or [**WSCGetProviderInfo32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscgetproviderinfo32) function is similarly used to retrieve the data associated with an information class for an LSP.</span></span>

## <a name="categorizing-applications"></a><span data-ttu-id="8d65d-175">Categorizando aplicativos</span><span class="sxs-lookup"><span data-stu-id="8d65d-175">Categorizing Applications</span></span>

<span data-ttu-id="8d65d-176">Várias novas funções estão disponíveis no Windows Vista e posterior para categorizar um aplicativo:</span><span class="sxs-lookup"><span data-stu-id="8d65d-176">Several new functions are available on Windows Vista and later for categorizing an application:</span></span>

-   [<span data-ttu-id="8d65d-177">**WSCGetApplicationCategory**</span><span class="sxs-lookup"><span data-stu-id="8d65d-177">**WSCGetApplicationCategory**</span></span>](/windows/desktop/api/Ws2spi/nf-ws2spi-wscgetapplicationcategory)
-   [<span data-ttu-id="8d65d-178">**WSCSetApplicationCategory**</span><span class="sxs-lookup"><span data-stu-id="8d65d-178">**WSCSetApplicationCategory**</span></span>](/windows/desktop/api/Ws2spi/nf-ws2spi-wscsetapplicationcategory)

<span data-ttu-id="8d65d-179">Para categorizar um aplicativo, a função [**WSCSetApplicationCategory**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscsetapplicationcategory) é chamada com o caminho de carga para a imagem executável para identificar o aplicativo, os argumentos de linha de comando usados ao iniciar o aplicativo e as categorias de LSP que são permitidas para todas as instâncias desse aplicativo.</span><span class="sxs-lookup"><span data-stu-id="8d65d-179">In order to categorize an application, the [**WSCSetApplicationCategory**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscsetapplicationcategory) function is called with the load path to the executable image to identify the application, the command line arguments used when starting the application, and the LSP categories which are permitted for all instances of this application.</span></span>

<span data-ttu-id="8d65d-180">A função [**WSCGetApplicationCategory**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscgetapplicationcategory) é usada da mesma forma para recuperar as categorias de LSP (provedor de serviço em camadas) associadas a um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="8d65d-180">The [**WSCGetApplicationCategory**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscgetapplicationcategory) function is similarly used to retrieve the layered service provider (LSP) categories associated with an application.</span></span>

## <a name="determining-which-lsps-get-loaded"></a><span data-ttu-id="8d65d-181">Determinando quais LSPs são carregados</span><span class="sxs-lookup"><span data-stu-id="8d65d-181">Determining Which LSPs Get Loaded</span></span>

<span data-ttu-id="8d65d-182">A parte final da categorização de LSP é determinar quais LSPs serão carregados em quais processos.</span><span class="sxs-lookup"><span data-stu-id="8d65d-182">The final part of LSP categorization is determining which LSPs will be loaded into which processes.</span></span> <span data-ttu-id="8d65d-183">Quando um processo carrega o Winsock, as seguintes comparações são feitas na categoria do aplicativo e nas categorias de LSP para todos os LSPs instalados:</span><span class="sxs-lookup"><span data-stu-id="8d65d-183">When a process loads Winsock, the following comparisons are made of the application category and the LSP categories for all installed LSPs:</span></span>

-   <span data-ttu-id="8d65d-184">Se o aplicativo não for Categorizado, permita que todos os LSPs sejam carregados no processo.</span><span class="sxs-lookup"><span data-stu-id="8d65d-184">If the application is not categorized, allow all LSPs to be loaded into the process.</span></span>
-   <span data-ttu-id="8d65d-185">Se o aplicativo e o LSP tiverem categorias atribuídas, todos os itens a seguir deverão ser verdadeiros:</span><span class="sxs-lookup"><span data-stu-id="8d65d-185">If both the application and the LSP have assigned categories, all of the following must be true:</span></span> <dl> <span data-ttu-id="8d65d-186">Pelo menos uma das categorias LSP está presente nas categorias especificadas do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="8d65d-186">At least one of the LSP categories is present in the application's specified categories.</span></span>  
    <span data-ttu-id="8d65d-187">Somente as categorias especificadas nas categorias especificadas do aplicativo são especificadas nas categorias LSPs.</span><span class="sxs-lookup"><span data-stu-id="8d65d-187">Only categories specified in the application's specified categories are specified in the LSPs categories.</span></span> <span data-ttu-id="8d65d-188">Por exemplo, se o aplicativo especificar uma categoria, ele deverá estar na categoria do LSP.</span><span class="sxs-lookup"><span data-stu-id="8d65d-188">For example, if the application specifies a category it must be in the LSP's category.</span></span>  
    <span data-ttu-id="8d65d-189">Se a \_ categoria do sistema LSP estiver presente na categoria do aplicativo, ela deverá estar presente nas categorias do LSP.</span><span class="sxs-lookup"><span data-stu-id="8d65d-189">If the LSP\_SYSTEM category is present in the application's category, it must be present in the LSP's categories.</span></span>  
    </dl>

> [!Note]  
> <span data-ttu-id="8d65d-190">Se um LSP não for Categorizado, sua categoria será efetivamente zero.</span><span class="sxs-lookup"><span data-stu-id="8d65d-190">If an LSP is not categorized, its category is effectively zero.</span></span> <span data-ttu-id="8d65d-191">Para que ocorra uma correspondência, todas as categorias especificadas do LSP devem estar presentes nas categorias do aplicativo (as categorias do aplicativo devem ser um superconjunto das categorias do LSP) com a limitação de que, se o \_ sistema LSP estiver presente na categoria do aplicativo, ele também deverá estar presente na categoria do LSP.</span><span class="sxs-lookup"><span data-stu-id="8d65d-191">For a match to occur, all the LSP's specified categories must be present in the application's categories (the application's categories must be a superset of the LSP's categories) with the caveat that if LSP\_SYSTEM is present in the application's category it must also be present in the LSP's category.</span></span>

 

<span data-ttu-id="8d65d-192">Considere o seguinte exemplo:</span><span class="sxs-lookup"><span data-stu-id="8d65d-192">Consider the following example:</span></span>

<span data-ttu-id="8d65d-193">O aplicativo *Foo.exe* é Categorizado como sistema de LSP \_ + \_ Firewall LSP + \_ compactação de criptografia LSP \_ .</span><span class="sxs-lookup"><span data-stu-id="8d65d-193">The *Foo.exe* application is categorized as LSP\_SYSTEM + LSP\_FIREWALL + LSP\_CRYPTO\_COMPRESS.</span></span> <span data-ttu-id="8d65d-194">O *Bar.exe* do aplicativo é Categorizado como \_ Firewall LSP + \_ compactação de criptografia LSP \_ .</span><span class="sxs-lookup"><span data-stu-id="8d65d-194">The application *Bar.exe* is categorized as LSP\_FIREWALL + LSP\_CRYPTO\_COMPRESS.</span></span> <span data-ttu-id="8d65d-195">Há quatro LSPs instalados no sistema:</span><span class="sxs-lookup"><span data-stu-id="8d65d-195">There are four LSPs installed on the system:</span></span>

-   <span data-ttu-id="8d65d-196">LSP1 definiu uma categoria de \_ sistema LSP.</span><span class="sxs-lookup"><span data-stu-id="8d65d-196">LSP1 has set a category of LSP\_SYSTEM.</span></span>
-   <span data-ttu-id="8d65d-197">LSP2 não é categorias definidas, portanto, sua categoria é zero.</span><span class="sxs-lookup"><span data-stu-id="8d65d-197">LSP2 is not categories set, so its category is zero.</span></span>
-   <span data-ttu-id="8d65d-198">LSP3 definiu uma categoria de \_ Firewall LSP.</span><span class="sxs-lookup"><span data-stu-id="8d65d-198">LSP3 has set a category of LSP\_FIREWALL.</span></span>
-   <span data-ttu-id="8d65d-199">LSP4 tem categorias definidas de um \_ sistema de LSP + firewall LSP + \_ \_ criptografia LSP \_ compress + Inspetor de LSP \_</span><span class="sxs-lookup"><span data-stu-id="8d65d-199">LSP4 has set categories of LSP\_SYSTEM + LSP\_FIREWALL + LSP\_CRYPTO\_COMPRESS + LSP\_INSPECTOR</span></span>

<span data-ttu-id="8d65d-200">Neste exemplo, o aplicativo *Foo.exe* só carregaria LSP1, enquanto o aplicativo *Bar.exe* carregaria LSP3.</span><span class="sxs-lookup"><span data-stu-id="8d65d-200">In this example, the *Foo.exe* application would only load LSP1, while the *Bar.exe* application would load LSP3.</span></span>

## <a name="determining-winsock-providers-installed"></a><span data-ttu-id="8d65d-201">Determinando provedores Winsock instalados</span><span class="sxs-lookup"><span data-stu-id="8d65d-201">Determining Winsock Providers Installed</span></span>

<span data-ttu-id="8d65d-202">O SDK (Software Development Kit) do Microsoft Windows inclui um programa de exemplo de Winsock que pode ser usado para determinar os provedores de transporte do Winsock instalados em um computador local.</span><span class="sxs-lookup"><span data-stu-id="8d65d-202">The Microsoft Windows Software Development Kit (SDK) includes a sample Winsock program that can be used to determine the Winsock transport providers installed on a local computer.</span></span> <span data-ttu-id="8d65d-203">Por padrão, o código-fonte para este exemplo de Winsock é instalado no seguinte diretório do SDK do Windows para o Windows 7:</span><span class="sxs-lookup"><span data-stu-id="8d65d-203">By default, the source code for this Winsock sample is installed in the following directory of the Windows SDK for Windows 7:</span></span>

<span data-ttu-id="8d65d-204">*C: \\ arquivos de programas \\ Microsoft SDKs \\ Windows \\ v 7.0 \\ amostras \\ NetDs \\ Winsock \\ LSP*</span><span class="sxs-lookup"><span data-stu-id="8d65d-204">*C:\\Program Files\\Microsoft SDKs\\Windows\\v7.0\\Samples\\NetDs\\winsock\\LSP*</span></span>

<span data-ttu-id="8d65d-205">Este exemplo é um utilitário para instalar e testar provedores de serviço em camadas.</span><span class="sxs-lookup"><span data-stu-id="8d65d-205">This sample is a utility for installing and testing layered service providers.</span></span> <span data-ttu-id="8d65d-206">Mas ele também pode ser usado para coletar programaticamente informações detalhadas do catálogo do Winsock em um computador local.</span><span class="sxs-lookup"><span data-stu-id="8d65d-206">But it can also be used to programmatically collect detailed information from the Winsock catalog on a local computer.</span></span> <span data-ttu-id="8d65d-207">Para listar todos os provedores de Winsock atuais, incluindo provedores de base e provedores de serviço de camada, compile este exemplo de Winsock e execute o seguinte comando de console:</span><span class="sxs-lookup"><span data-stu-id="8d65d-207">To list all of the current Winsock providers including both base providers and layer service providers, build this Winsock sample and execute the following console command:</span></span>

<span data-ttu-id="8d65d-208">**instlsp-p**</span><span class="sxs-lookup"><span data-stu-id="8d65d-208">**instlsp -p**</span></span>

<span data-ttu-id="8d65d-209">A saída será uma lista de provedores de Winsock instalados no computador local, incluindo provedores de serviço em camadas.</span><span class="sxs-lookup"><span data-stu-id="8d65d-209">The output will be a list of Winsock providers installed on the local computer including layered service providers.</span></span> <span data-ttu-id="8d65d-210">A saída lista a ID do catálogo e o nome da cadeia de caracteres para o provedor de Winsock</span><span class="sxs-lookup"><span data-stu-id="8d65d-210">The output lists the catalog ID and the string name for the Winsock provider</span></span>

<span data-ttu-id="8d65d-211">Para coletar informações mais detalhadas sobre todos os provedores de Winsock, execute o seguinte comando de console:</span><span class="sxs-lookup"><span data-stu-id="8d65d-211">To collect more detailed information on all Winsock providers, execute the following console command:</span></span>

<span data-ttu-id="8d65d-212">**instlsp-p-v**</span><span class="sxs-lookup"><span data-stu-id="8d65d-212">**instlsp -p -v**</span></span>

<span data-ttu-id="8d65d-213">A saída será uma lista de estruturas de [**\_ informações de WSAPROTOCOL**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) com suporte no computador local.</span><span class="sxs-lookup"><span data-stu-id="8d65d-213">The output will be a list [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structures supported on the local computer.</span></span>

<span data-ttu-id="8d65d-214">Para obter uma lista de somente provedores de serviço em camadas instalados no computador local, execute o seguinte comando de console:</span><span class="sxs-lookup"><span data-stu-id="8d65d-214">For a list of only layered service providers installed on the local computer, execute the following console command:</span></span>

<span data-ttu-id="8d65d-215">**instlsp-l**</span><span class="sxs-lookup"><span data-stu-id="8d65d-215">**instlsp -l**</span></span>

<span data-ttu-id="8d65d-216">Para mapear a estrutura LSP, execute o seguinte comando de console:</span><span class="sxs-lookup"><span data-stu-id="8d65d-216">To map the LSP structure, execute the following console command:</span></span>

<span data-ttu-id="8d65d-217">**instlsp-m**</span><span class="sxs-lookup"><span data-stu-id="8d65d-217">**instlsp -m**</span></span>

> [!Note]  
> <span data-ttu-id="8d65d-218">O recurso TDI foi preterido e será removido em versões futuras do Microsoft Windows.</span><span class="sxs-lookup"><span data-stu-id="8d65d-218">The TDI feature is deprecated and will be removed in future versions of Microsoft Windows.</span></span> <span data-ttu-id="8d65d-219">Dependendo de como você usa o TDI, use o kernel do Winsock (WSK) ou a WFP (plataforma de filtragem do Windows).</span><span class="sxs-lookup"><span data-stu-id="8d65d-219">Depending on how you use TDI, use either the Winsock Kernel (WSK) or Windows Filtering Platform (WFP).</span></span> <span data-ttu-id="8d65d-220">Para obter mais informações sobre WFP e WSK, consulte [Windows Filtering Platform](../fwp/windows-filtering-platform-start-page.md) e [Winsock Kernel](/windows-hardware/drivers/ddi/_netvista/).</span><span class="sxs-lookup"><span data-stu-id="8d65d-220">For more information about WFP and WSK, see [Windows Filtering Platform](../fwp/windows-filtering-platform-start-page.md) and [Winsock Kernel](/windows-hardware/drivers/ddi/_netvista/).</span></span> <span data-ttu-id="8d65d-221">Para obter uma entrada de blog de sistema de rede do Windows Core sobre WSK e TDI, consulte [Introduction to Winsock kernel (WSK)](/archive/blogs/wndp/).</span><span class="sxs-lookup"><span data-stu-id="8d65d-221">For a Windows Core Networking blog entry about WSK and TDI, see [Introduction to Winsock Kernel (WSK)](/archive/blogs/wndp/).</span></span>

 

 

 
