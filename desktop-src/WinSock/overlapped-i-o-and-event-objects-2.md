---
description: O Windows Sockets 2 dá suporte a e/s sobreposta e todos os provedores de transporte dão suporte a esse recurso.
ms.assetid: b36ab606-df1a-4254-b048-6d47eb366275
title: Objetos de evento e e/s sobrepostos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ed034f06243959d94a1ada7eaa71e33c84cd35ee
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105781661"
---
# <a name="overlapped-io-and-event-objects"></a><span data-ttu-id="7a38c-103">Objetos de evento e e/s sobrepostos</span><span class="sxs-lookup"><span data-stu-id="7a38c-103">Overlapped I/O and Event Objects</span></span>

<span data-ttu-id="7a38c-104">O Windows Sockets 2 dá suporte a e/s sobreposta e todos os provedores de transporte dão suporte a esse recurso.</span><span class="sxs-lookup"><span data-stu-id="7a38c-104">Windows Sockets 2 supports overlapped I/O and all transport providers support this capability.</span></span> <span data-ttu-id="7a38c-105">A e/s sobreposta segue o modelo estabelecido no Windows e pode ser executada em soquetes criados com a função de [**soquete**](/windows/desktop/api/Winsock2/nf-winsock2-socket) ou com soquetes criados com a função [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) com o sinalizador de **cabeçalho wsa \_ \_ sobreposto** definido no parâmetro *dwFlags* .</span><span class="sxs-lookup"><span data-stu-id="7a38c-105">Overlapped I/O follows the model established in Windows and can be performed on sockets created with the [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) function or sockets created with the [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) function with the **WSA\_FLAG\_OVERLAPPED** flag set in the *dwFlags* parameter.</span></span>

> [!Note]  
> <span data-ttu-id="7a38c-106">A criação de um soquete com o atributo Overlapped não afeta se um soquete está atualmente no modo de bloqueio ou sem bloqueio.</span><span class="sxs-lookup"><span data-stu-id="7a38c-106">Creating a socket with the overlapped attribute has no impact on whether a socket is currently in blocking or nonblocking mode.</span></span> <span data-ttu-id="7a38c-107">Os soquetes criados com o atributo Overlapped podem ser usados para executar e/s sobreposta — fazer isso não altera o modo de bloqueio de um soquete.</span><span class="sxs-lookup"><span data-stu-id="7a38c-107">Sockets created with the overlapped attribute can be used to perform overlapped I/O—doing so does not change the blocking mode of a socket.</span></span> <span data-ttu-id="7a38c-108">Como as operações de e/s sobrepostas não são bloqueadas, o modo de bloqueio de um soquete é irrelevante para essas operações.</span><span class="sxs-lookup"><span data-stu-id="7a38c-108">Since overlapped I/O operations do not block, the blocking mode of a socket is irrelevant for these operations.</span></span>

 

<span data-ttu-id="7a38c-109">Para receber, os aplicativos usam as funções [**WSARecv**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv) ou [**WSARecvFrom**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvfrom) para fornecer buffers para os quais os dados serão recebidos.</span><span class="sxs-lookup"><span data-stu-id="7a38c-109">For receiving, applications use the [**WSARecv**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv) or [**WSARecvFrom**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvfrom) functions to supply buffers into which data is to be received.</span></span> <span data-ttu-id="7a38c-110">Se um ou mais buffers forem postados antes do momento em que os dados tiverem sido recebidos pela rede, esses dados poderão ser colocados nos buffers do usuário imediatamente conforme ele chegar.</span><span class="sxs-lookup"><span data-stu-id="7a38c-110">If one or more buffers are posted prior to the time when data has been received by the network, that data could be placed in the user's buffers immediately as it arrives.</span></span> <span data-ttu-id="7a38c-111">Portanto, ele pode evitar a operação de cópia que, caso contrário, ocorreria no momento em que a função [**recv**](/windows/desktop/api/winsock/nf-winsock-recv) ou [**recvfrom**](/windows/desktop/api/winsock/nf-winsock-recvfrom) é invocada.</span><span class="sxs-lookup"><span data-stu-id="7a38c-111">Thus, it can avoid the copy operation that would otherwise occur at the time the [**recv**](/windows/desktop/api/winsock/nf-winsock-recv) or [**recvfrom**](/windows/desktop/api/winsock/nf-winsock-recvfrom) function is invoked.</span></span> <span data-ttu-id="7a38c-112">Se os dados já estiverem presentes quando os buffers de recebimento forem postados, eles serão copiados imediatamente para os buffers do usuário.</span><span class="sxs-lookup"><span data-stu-id="7a38c-112">If data is already present when receive buffers are posted, it is copied immediately into the user's buffers.</span></span>

<span data-ttu-id="7a38c-113">Se os dados chegarem quando nenhum buffer de recebimento tiver sido postado pelo aplicativo, os resorts de rede para o estilo de operação síncrono conhecido.</span><span class="sxs-lookup"><span data-stu-id="7a38c-113">If data arrives when no receive buffers have been posted by the application, the network resorts to the familiar synchronous style of operation.</span></span> <span data-ttu-id="7a38c-114">Ou seja, os dados de entrada são armazenados em buffer internamente até que o aplicativo emita uma chamada de recebimento e, portanto, forneça um buffer no qual os dados possam ser copiados.</span><span class="sxs-lookup"><span data-stu-id="7a38c-114">That is, the incoming data is buffered internally until the application issues a receive call and thereby supplies a buffer into which the data can be copied.</span></span> <span data-ttu-id="7a38c-115">Uma exceção a isso é quando o aplicativo usa [**setsockopt**](/windows/desktop/api/winsock/nf-winsock-setsockopt) para definir o tamanho do buffer de recebimento como zero.</span><span class="sxs-lookup"><span data-stu-id="7a38c-115">An exception to this is when the application uses [**setsockopt**](/windows/desktop/api/winsock/nf-winsock-setsockopt) to set the size of the receive buffer to zero.</span></span> <span data-ttu-id="7a38c-116">Nessa instância, os protocolos confiáveis só permitiriam que os dados fossem recebidos quando os buffers de aplicativo tivessem sido postados e dados em protocolos não confiáveis seriam perdidos.</span><span class="sxs-lookup"><span data-stu-id="7a38c-116">In this instance, reliable protocols would only allow data to be received when application buffers had been posted and data on unreliable protocols would be lost.</span></span>

<span data-ttu-id="7a38c-117">No lado de envio, os aplicativos usam [**WSASend**](/windows/desktop/api/Winsock2/nf-winsock2-wsasend) ou [**WSASendTo**](/windows/desktop/api/Winsock2/nf-winsock2-wsasendto) para fornecer ponteiros para os buffers preenchidos e, em seguida, concorda em não incomodar os buffers de forma alguma até que a rede consumisse o conteúdo do buffer.</span><span class="sxs-lookup"><span data-stu-id="7a38c-117">On the sending side, applications use [**WSASend**](/windows/desktop/api/Winsock2/nf-winsock2-wsasend) or [**WSASendTo**](/windows/desktop/api/Winsock2/nf-winsock2-wsasendto) to supply pointers to filled buffers and then agree not to disturb the buffers in any way until the network has consumed the buffer's contents.</span></span>

<span data-ttu-id="7a38c-118">Chamadas de envio e recebimento sobrepostas retornam imediatamente.</span><span class="sxs-lookup"><span data-stu-id="7a38c-118">Overlapped send and receive calls return immediately.</span></span> <span data-ttu-id="7a38c-119">Um valor de retorno de zero indica que a operação de e/s foi concluída imediatamente e que a indicação de conclusão correspondente já ocorreu.</span><span class="sxs-lookup"><span data-stu-id="7a38c-119">A return value of zero indicates that the I/O operation was completed immediately and that the corresponding completion indication already occurred.</span></span> <span data-ttu-id="7a38c-120">Ou seja, o objeto de evento associado foi sinalizado, ou uma rotina de conclusão foi enfileirada e será executada quando o thread de chamada chegar ao estado de espera alertável.</span><span class="sxs-lookup"><span data-stu-id="7a38c-120">That is, the associated event object has been signaled, or a completion routine has been queued and will be executed when the calling thread gets into the alertable wait state.</span></span>

<span data-ttu-id="7a38c-121">Um valor de retorno do \_ erro de soquete associado a um código de erro de [WSA \_ e/s de cabeçalho \_ pendente](windows-sockets-error-codes-2.md) indica que a operação sobreposta foi iniciada com êxito e que uma indicação subseqüente será fornecida quando os buffers de envio tiverem sido consumidos ou quando uma operação de recebimento tiver sido concluída.</span><span class="sxs-lookup"><span data-stu-id="7a38c-121">A return value of SOCKET\_ERROR coupled with an error code of [WSA\_IO\_PENDING](windows-sockets-error-codes-2.md) indicates that the overlapped operation has been successfully initiated and that a subsequent indication will be provided when send buffers have been consumed or when a receive operation has been completed.</span></span> <span data-ttu-id="7a38c-122">No entanto, para soquetes que são o estilo de fluxo de bytes, a indicação de conclusão ocorre sempre que os dados de entrada são esgotados, independentemente de os buffers estarem cheios ou não.</span><span class="sxs-lookup"><span data-stu-id="7a38c-122">However, for sockets that are byte-stream style, the completion indication occurs whenever the incoming data is exhausted, regardless of whether the buffers are full.</span></span> <span data-ttu-id="7a38c-123">Qualquer outro código de erro indica que a operação sobreposta não foi iniciada com êxito e que nenhuma indicação de conclusão estará disponível.</span><span class="sxs-lookup"><span data-stu-id="7a38c-123">Any other error code indicates that the overlapped operation was not successfully initiated and that no completion indication will be forthcoming.</span></span>

<span data-ttu-id="7a38c-124">Ambas as operações de envio e recebimento podem ser sobrepostas.</span><span class="sxs-lookup"><span data-stu-id="7a38c-124">Both send and receive operations can be overlapped.</span></span> <span data-ttu-id="7a38c-125">As funções Receive podem ser chamadas várias vezes para postar buffers de recebimento em preparação para dados de entrada, e as funções Send podem ser chamadas várias vezes para enfileirar vários buffers para enviar.</span><span class="sxs-lookup"><span data-stu-id="7a38c-125">The receive functions can be invoked several times to post receive buffers in preparation for incoming data, and the send functions can be invoked several times to queue multiple buffers to send.</span></span> <span data-ttu-id="7a38c-126">Embora o aplicativo possa contar com uma série de buffers de envio sobrepostos sendo enviados na ordem fornecida, as indicações de conclusão correspondentes podem ocorrer em uma ordem diferente.</span><span class="sxs-lookup"><span data-stu-id="7a38c-126">While the application can rely upon a series of overlapped send buffers being sent in the order supplied, the corresponding completion indications might occur in a different order.</span></span> <span data-ttu-id="7a38c-127">Da mesma forma, no lado de recebimento, os buffers podem ser preenchidos na ordem em que são fornecidos, mas as indicações de conclusão podem ocorrer em uma ordem diferente.</span><span class="sxs-lookup"><span data-stu-id="7a38c-127">Likewise, on the receiving side, buffers can be filled in the order they are supplied, but the completion indications might occur in a different order.</span></span>

<span data-ttu-id="7a38c-128">Em muitos casos, as operações do Winsock Overlapped usando [**AcceptEx**](/windows/win32/api/mswsock/nf-mswsock-acceptex), [**ConnectEx**](/windows/desktop/api/Mswsock/nc-mswsock-lpfn_connectex), [**WSASend**](/windows/desktop/api/Winsock2/nf-winsock2-wsasend), [**WSARecv**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv), [**TransmitFile**](/windows/win32/api/mswsock/nf-mswsock-transmitfile)e funções semelhantes são canceláveis.</span><span class="sxs-lookup"><span data-stu-id="7a38c-128">In many cases, Winsock overlapped operations using [**AcceptEx**](/windows/win32/api/mswsock/nf-mswsock-acceptex), [**ConnectEx**](/windows/desktop/api/Mswsock/nc-mswsock-lpfn_connectex), [**WSASend**](/windows/desktop/api/Winsock2/nf-winsock2-wsasend), [**WSARecv**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv), [**TransmitFile**](/windows/win32/api/mswsock/nf-mswsock-transmitfile), and similar functions are cancelable.</span></span> <span data-ttu-id="7a38c-129">No entanto, o comportamento é indefinido para o uso contínuo de um soquete que cancelou operações pendentes.</span><span class="sxs-lookup"><span data-stu-id="7a38c-129">However, behavior is undefined for the continued use of a socket that has canceled outstanding operations.</span></span> <span data-ttu-id="7a38c-130">A função [**fechamento**](/windows/desktop/api/winsock/nf-winsock-closesocket) deve ser chamada depois de cancelar uma operação sobreposta.</span><span class="sxs-lookup"><span data-stu-id="7a38c-130">The [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) function should be called after canceling an overlapped operation.</span></span> <span data-ttu-id="7a38c-131">Portanto, para obter melhores resultados, em vez de cancelar a e/s diretamente, a função **fechamento** deve ser chamada para fechar o soquete, o que eventualmente interromperá todas as operações pendentes.</span><span class="sxs-lookup"><span data-stu-id="7a38c-131">Therefore, for best results, instead of canceling the I/O directly, the **closesocket** function should be called to close the socket which will eventually discontinue all pending operations.</span></span>

<span data-ttu-id="7a38c-132">O recurso de conclusão adiada de e/s sobreposta também está disponível para [**WSAIoctl**](/windows/desktop/api/Winsock2/nf-winsock2-wsaioctl), que é uma versão aprimorada do [**ioctlsocket**](/windows/desktop/api/winsock/nf-winsock-ioctlsocket).</span><span class="sxs-lookup"><span data-stu-id="7a38c-132">The deferred completion feature of overlapped I/O is also available for [**WSAIoctl**](/windows/desktop/api/Winsock2/nf-winsock2-wsaioctl), which is an enhanced version of [**ioctlsocket**](/windows/desktop/api/winsock/nf-winsock-ioctlsocket).</span></span>

 

 
