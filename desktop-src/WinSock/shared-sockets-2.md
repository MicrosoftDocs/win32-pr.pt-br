---
description: A função WSADuplicateSocket é introduzida para habilitar o compartilhamento de soquete entre processos.
ms.assetid: f7cf40e9-f3a6-4b62-8a78-df25464e2365
title: Soquetes compartilhados
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fb6753b01f6389254756254d2ebe196af8e2a8a3
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103921314"
---
# <a name="shared-sockets"></a><span data-ttu-id="442ec-103">Soquetes compartilhados</span><span class="sxs-lookup"><span data-stu-id="442ec-103">Shared Sockets</span></span>

<span data-ttu-id="442ec-104">A função [**WSADuplicateSocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsaduplicatesocketa) é introduzida para habilitar o compartilhamento de soquete entre processos.</span><span class="sxs-lookup"><span data-stu-id="442ec-104">The [**WSADuplicateSocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsaduplicatesocketa) function is introduced to enable socket sharing across processes.</span></span> <span data-ttu-id="442ec-105">Um processo de origem chama **WSADuplicateSocket** para obter uma estrutura de [**\_ informações de WSAPROTOCOL**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) especial para um identificador de processo de destino.</span><span class="sxs-lookup"><span data-stu-id="442ec-105">A source process calls **WSADuplicateSocket** to obtain a special [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure for a target process identifier.</span></span> <span data-ttu-id="442ec-106">Ele usa um mecanismo de IPC (comunicação entre processos) para passar o conteúdo dessa estrutura para um processo de destino.</span><span class="sxs-lookup"><span data-stu-id="442ec-106">It uses some interprocess communications (IPC) mechanism to pass the contents of this structure to a target process.</span></span> <span data-ttu-id="442ec-107">Em seguida, o processo de destino usa a estrutura de **\_ informações WSAPROTOCOL** em uma chamada para [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket).</span><span class="sxs-lookup"><span data-stu-id="442ec-107">The target process then uses the **WSAPROTOCOL\_INFO** structure in a call to [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket).</span></span> <span data-ttu-id="442ec-108">O descritor de soquete retornado por essa função será um descritor de soquete adicional para um soquete subjacente que, portanto, se tornará compartilhado.</span><span class="sxs-lookup"><span data-stu-id="442ec-108">The socket descriptor returned by this function will be an additional socket descriptor to an underlying socket which thus becomes shared.</span></span> <span data-ttu-id="442ec-109">Os soquetes podem ser compartilhados entre threads em um determinado processo sem usar a função **WSADuplicateSocket** porque um descritor de soquete é válido em todos os threads de um processo.</span><span class="sxs-lookup"><span data-stu-id="442ec-109">Sockets can be shared among threads in a given process without using the **WSADuplicateSocket** function because a socket descriptor is valid in all threads of a process.</span></span>

<span data-ttu-id="442ec-110">Os dois (ou mais) descritores que fazem referência a um Soquete compartilhado podem ser usados de forma independente no que diz respeito à e/s.</span><span class="sxs-lookup"><span data-stu-id="442ec-110">The two (or more) descriptors that reference a shared socket can be used independently as far as I/O is concerned.</span></span> <span data-ttu-id="442ec-111">No entanto, a interface Winsock não implementa nenhum tipo de controle de acesso, portanto, os processos devem coordenar qualquer operação em um Soquete compartilhado.</span><span class="sxs-lookup"><span data-stu-id="442ec-111">However, the Winsock interface does not implement any type of access control, so the processes must coordinate any operations on a shared socket.</span></span> <span data-ttu-id="442ec-112">Um exemplo típico de compartilhamento de soquetes é usar um processo para criar soquetes e estabelecer conexões.</span><span class="sxs-lookup"><span data-stu-id="442ec-112">A typical example of sharing sockets is to use one process for creating sockets and establishing connections.</span></span> <span data-ttu-id="442ec-113">Esse processo então transfere os soquetes para outros processos responsáveis pela troca de informações.</span><span class="sxs-lookup"><span data-stu-id="442ec-113">This process then hands off sockets to other processes that are responsible for information exchange.</span></span>

<span data-ttu-id="442ec-114">A função [**WSADuplicateSocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsaduplicatesocketa) cria descritores de soquete e não o soquete subjacente.</span><span class="sxs-lookup"><span data-stu-id="442ec-114">The [**WSADuplicateSocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsaduplicatesocketa) function creates socket descriptors and not the underlying socket.</span></span> <span data-ttu-id="442ec-115">Como resultado, todos os Estados associados a um soquete são mantidos em comum em todos os descritores.</span><span class="sxs-lookup"><span data-stu-id="442ec-115">As a result, all the states associated with a socket are held in common across all the descriptors.</span></span> <span data-ttu-id="442ec-116">Por exemplo, uma operação [**setsockopt**](/windows/desktop/api/winsock/nf-winsock-setsockopt) executada usando um descritor é posteriormente visível usando um [**getsockopt**](/windows/desktop/api/winsock/nf-winsock-getsockopt) de qualquer um ou de todos os descritores.</span><span class="sxs-lookup"><span data-stu-id="442ec-116">For example, a [**setsockopt**](/windows/desktop/api/winsock/nf-winsock-setsockopt) operation performed using one descriptor is subsequently visible using a [**getsockopt**](/windows/desktop/api/winsock/nf-winsock-getsockopt) from any or all descriptors.</span></span> <span data-ttu-id="442ec-117">Um processo pode chamar [**fechamento**](/windows/desktop/api/winsock/nf-winsock-closesocket) em um soquete duplicado e o descritor ficará desalocado.</span><span class="sxs-lookup"><span data-stu-id="442ec-117">A process can call [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) on a duplicated socket and the descriptor will become deallocated.</span></span> <span data-ttu-id="442ec-118">No entanto, o soquete subjacente permanece aberto até que **fechamento** seja chamado com o último descritor restante.</span><span class="sxs-lookup"><span data-stu-id="442ec-118">The underlying socket, however, remains open until **closesocket** is called with the last remaining descriptor.</span></span>

<span data-ttu-id="442ec-119">A notificação em soquetes compartilhados está sujeita às restrições usuais das funções [**WSAAsyncSelect**](/windows/desktop/api/winsock/nf-winsock-wsaasyncselect) e [**WSAEventSelect**](/windows/desktop/api/Winsock2/nf-winsock2-wsaeventselect) .</span><span class="sxs-lookup"><span data-stu-id="442ec-119">Notification on shared sockets is subject to the usual constraints of the [**WSAAsyncSelect**](/windows/desktop/api/winsock/nf-winsock-wsaasyncselect) and [**WSAEventSelect**](/windows/desktop/api/Winsock2/nf-winsock2-wsaeventselect) functions.</span></span> <span data-ttu-id="442ec-120">A emissão de qualquer uma dessas chamadas usando qualquer um dos descritores compartilhados cancela qualquer registro de evento anterior para o soquete, independentemente do qual foi usado para fazer esse registro.</span><span class="sxs-lookup"><span data-stu-id="442ec-120">Issuing either of these calls using any of the shared descriptors cancels any previous event registration for the socket, regardless of which descriptor was used to make that registration.</span></span> <span data-ttu-id="442ec-121">Portanto, por exemplo, não seria possível ter o processo A receber \_ eventos de leitura FD e o processo B receber eventos de gravação FD \_ .</span><span class="sxs-lookup"><span data-stu-id="442ec-121">Thus, for example, it would not be possible to have process A receive FD\_READ events and process B receive FD\_WRITE events.</span></span> <span data-ttu-id="442ec-122">Para situações em que tal coordenação rígida é necessária, é recomendável que os desenvolvedores usem threads em vez de processos separados.</span><span class="sxs-lookup"><span data-stu-id="442ec-122">For situations when such tight coordination is required, it is suggested that developers use threads instead of separate processes.</span></span>

 

 
