---
title: Algoritmo e esquema do perfil do modelo de mapa de gamut do WCS
description: Algoritmo e esquema do perfil do modelo de mapa de gamut do WCS
ms.assetid: 64b9871a-1b4f-4e9a-be4d-4c25b3198b91
keywords:
- WCS (sistema de cores do Windows), perfil de modelo de mapa de gamut (GMMP)
- WCS (sistema de cores do Windows), perfil de modelo de mapa de gamut (GMMP)
- gerenciamento de cores de imagem, perfil de modelo de mapa de gamut (GMMP)
- gerenciamento de cores, perfil de modelo de mapa de gamut (GMMP)
- cores, perfil de modelo de mapa de gamut (GMMP)
- WCS (sistema de cores do Windows), perfis
- WCS (sistema de cores do Windows), perfis
- gerenciamento de cores de imagem, perfis
- gerenciamento de cores, perfis
- cores, perfis
- Perfil de modelo de mapa de gamut (GMMP)
- GMMP (perfil de modelo de mapa de gamut)
- Perfil do modelo de mapa de gamut WCS
- esquemas, perfil de modelo de mapa de gamut (GMMP)
- algoritmos, perfil de modelo de mapa de gamut (GMMP)
ms.localizationpriority: high
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3714e5d7592cb1fbbbfa98e238642a2fcb38bafd
ms.sourcegitcommit: de72a1294df274b0a71dc0fdc42d757e5f6df0f3
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/05/2021
ms.locfileid: "104557691"
---
# <a name="wcs-gamut-map-model-profile-schema-and-algorithms"></a><span data-ttu-id="54673-118">Algoritmo e esquema do perfil do modelo de mapa de gamut do WCS</span><span class="sxs-lookup"><span data-stu-id="54673-118">WCS Gamut Map Model Profile Schema and Algorithms</span></span>

-   [<span data-ttu-id="54673-119">Visão geral</span><span class="sxs-lookup"><span data-stu-id="54673-119">Overview</span></span>](#overview)
-   [<span data-ttu-id="54673-120">Arquitetura de perfil de modelo de mapa de gamut</span><span class="sxs-lookup"><span data-stu-id="54673-120">Gamut Map Model Profile Architecture</span></span>](#gamut-map-model-profile-architecture)
-   [<span data-ttu-id="54673-121">Geração do limite de gama</span><span class="sxs-lookup"><span data-stu-id="54673-121">Generation of the Gamut Boundary</span></span>](#generation-of-the-gamut-boundary)
-   [<span data-ttu-id="54673-122">O esquema GMMP</span><span class="sxs-lookup"><span data-stu-id="54673-122">The GMMP Schema</span></span>](#the-gmmp-schema)
-   [<span data-ttu-id="54673-123">Os elementos do esquema GMMP</span><span class="sxs-lookup"><span data-stu-id="54673-123">The GMMP Schema Elements</span></span>](#the-gmmp-schema-elements)
-   [<span data-ttu-id="54673-124">GamutMapModel</span><span class="sxs-lookup"><span data-stu-id="54673-124">GamutMapModel</span></span>](#defaultbaselinegamutmapmodel-type)
    -   [<span data-ttu-id="54673-125">Namespace</span><span class="sxs-lookup"><span data-stu-id="54673-125">Namespace</span></span>](#namespace)
    -   [<span data-ttu-id="54673-126">Versão</span><span class="sxs-lookup"><span data-stu-id="54673-126">Version</span></span>](#version)
    -   [<span data-ttu-id="54673-127">Documentação</span><span class="sxs-lookup"><span data-stu-id="54673-127">Documentation</span></span>](#documentation)
    -   [<span data-ttu-id="54673-128">Tipo de DefaultBaselineGamutMapModel</span><span class="sxs-lookup"><span data-stu-id="54673-128">DefaultBaselineGamutMapModel type</span></span>](#defaultbaselinegamutmapmodel-type)
    -   [<span data-ttu-id="54673-129">PlugInGamutMapType</span><span class="sxs-lookup"><span data-stu-id="54673-129">PlugInGamutMapType</span></span>](#plugingamutmaptype)
    -   [<span data-ttu-id="54673-130">ExtensionType</span><span class="sxs-lookup"><span data-stu-id="54673-130">ExtensionType</span></span>](#extensiontype)
-   [<span data-ttu-id="54673-131">Os algoritmos de linha de base GMMP</span><span class="sxs-lookup"><span data-stu-id="54673-131">The GMMP Baseline Algorithms</span></span>](#the-gmmp-baseline-algorithms)
-   [<span data-ttu-id="54673-132">Alinhando os eixos neutros</span><span class="sxs-lookup"><span data-stu-id="54673-132">Aligning the Neutral Axes</span></span>](#aligning-the-neutral-axes)
    -   [<span data-ttu-id="54673-133">Diferença mínima de cor (MinCD)</span><span class="sxs-lookup"><span data-stu-id="54673-133">Minimum Color Difference (MinCD)</span></span>](#minimum-color-difference-mincd)
    -   [<span data-ttu-id="54673-134">BasicPhoto</span><span class="sxs-lookup"><span data-stu-id="54673-134">BasicPhoto</span></span>](#basicphoto)
    -   [<span data-ttu-id="54673-135">Visão geral</span><span class="sxs-lookup"><span data-stu-id="54673-135">Overview</span></span>](#overview)
    -   [<span data-ttu-id="54673-136">O caso de um único Shell de gamut</span><span class="sxs-lookup"><span data-stu-id="54673-136">The case of single gamut shell</span></span>](#the-case-of-single-gamut-shell)
    -   [<span data-ttu-id="54673-137">Aprimoramento preto</span><span class="sxs-lookup"><span data-stu-id="54673-137">Black enhancement</span></span>](#black-enhancement)
    -   [<span data-ttu-id="54673-138">O caso de shells de gama dupla</span><span class="sxs-lookup"><span data-stu-id="54673-138">The case of dual gamut shells</span></span>](#the-case-of-dual-gamut-shells)
    -   [<span data-ttu-id="54673-139">Motivos para alterações das recomendações de CIE TC8-03</span><span class="sxs-lookup"><span data-stu-id="54673-139">Reasons for changes from the CIE TC8-03 recommendations</span></span>](#reasons-for-changes-from-the-cie-tc8-03-recommendations)
    -   [<span data-ttu-id="54673-140">Mapeamento de matiz</span><span class="sxs-lookup"><span data-stu-id="54673-140">Hue mapping</span></span>](#hue-mapping)
-   [<span data-ttu-id="54673-141">Descrição de limite de gama e algoritmos de Shell de gamut</span><span class="sxs-lookup"><span data-stu-id="54673-141">Gamut Boundary Description and Gamut Shell Algorithms</span></span>](#gamut-boundary-description-and-gamut-shell-algorithms)
    -   [<span data-ttu-id="54673-142">Triangulação do limite de gama</span><span class="sxs-lookup"><span data-stu-id="54673-142">Triangulation of the Gamut Boundary</span></span>](#triangulation-of-the-gamut-boundary)
    -   [<span data-ttu-id="54673-143">Elementos de linha de limite</span><span class="sxs-lookup"><span data-stu-id="54673-143">Boundary Line Elements</span></span>](#boundary-line-elements)
    -   [<span data-ttu-id="54673-144">Operação de gama: CheckGamut</span><span class="sxs-lookup"><span data-stu-id="54673-144">Gamut Operation: CheckGamut</span></span>](#gamut-operation-checkgamut)
    -   [<span data-ttu-id="54673-145">Plano de matiz completo: Intersect</span><span class="sxs-lookup"><span data-stu-id="54673-145">Full Hue Plane: Intersect</span></span>](#full-hue-plane-intersect)
    -   [<span data-ttu-id="54673-146">Operação de gama: CheckGamut (continuação)</span><span class="sxs-lookup"><span data-stu-id="54673-146">Gamut Operation: CheckGamut (continued)</span></span>](#gamut-operation-checkgamut-continued)
    -   [<span data-ttu-id="54673-147">Mapeamento de gama da diferença de cor mínima</span><span class="sxs-lookup"><span data-stu-id="54673-147">Minimum Color Difference Gamut Mapping</span></span>](#minimum-color-difference-gamut-mapping)
    -   [<span data-ttu-id="54673-148">Suavização de matiz</span><span class="sxs-lookup"><span data-stu-id="54673-148">Hue Smoothing</span></span>](#hue-smoothing)
    -   [<span data-ttu-id="54673-149">Definindo primárias e secundárias na descrição do limite de gama</span><span class="sxs-lookup"><span data-stu-id="54673-149">Setting Primaries and Secondaries in the Gamut Boundary Description</span></span>](#setting-primaries-and-secondaries-in-the-gamut-boundary-description)
    -   [<span data-ttu-id="54673-150">Definindo o eixo neutro na descrição do limite de gama</span><span class="sxs-lookup"><span data-stu-id="54673-150">Setting the Neutral Axis in the Gamut Boundary Description</span></span>](#setting-the-neutral-axis-in-the-gamut-boundary-description)
-   [<span data-ttu-id="54673-151">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="54673-151">Related topics</span></span>](#related-topics)

## <a name="overview"></a><span data-ttu-id="54673-152">Visão geral</span><span class="sxs-lookup"><span data-stu-id="54673-152">Overview</span></span>

<span data-ttu-id="54673-153">Esse esquema é usado para especificar o conteúdo de um perfil de modelo de mapa de gamut (GMMP).</span><span class="sxs-lookup"><span data-stu-id="54673-153">This schema is used to specify the content of a gamut map model profile (GMMP).</span></span> <span data-ttu-id="54673-154">Os algoritmos de linha de base associados são descritos no tópico a seguir.</span><span class="sxs-lookup"><span data-stu-id="54673-154">The associated baseline algorithms are described in the following topic.</span></span>

<span data-ttu-id="54673-155">O esquema GMMP básico consiste em informações de cabeçalho comuns, uma referência opcional a um plug-in de modelo de mapa de gamut preferencial e marcas de extensão.</span><span class="sxs-lookup"><span data-stu-id="54673-155">The basic GMMP schema consists of common header information, an optional reference to a preferred Gamut Map Model plug-in, and extension tags.</span></span>

<span data-ttu-id="54673-156">Além disso, o GMMP fornece informações explícitas sobre o modelo de mapa de gamut de destino e fornece uma política sobre o modelo de mapa de gamut de fallback de linha de base a ser usado se o modelo de destino não estiver disponível.</span><span class="sxs-lookup"><span data-stu-id="54673-156">In addition, the GMMP provides explicit information on the targeted Gamut Map Model, and provides a policy on the baseline fallback Gamut Map Model to use if the targeted model is unavailable.</span></span> <span data-ttu-id="54673-157">O esquema pode incluir informações de extensão particulares, mas não incluirá nenhuma outra informação estranha.</span><span class="sxs-lookup"><span data-stu-id="54673-157">The schema can include private extensional information, but will include no other extraneous information.</span></span>

## <a name="gamut-map-model-profile-architecture"></a><span data-ttu-id="54673-158">Arquitetura de perfil de modelo de mapa de gamut</span><span class="sxs-lookup"><span data-stu-id="54673-158">Gamut Map Model Profile Architecture</span></span>

![Diagrama que mostra o perfil de modelo de mapa de gamut.](images/gmmp-image002.png)

<span data-ttu-id="54673-160">A amostragem do espaço de Colorant do dispositivo de saída é feita com a iteração pela colorants de 0,0 para 1,0 com uma etapa fracionária, acumulando todas as combinações de cada Colorant em cada etapa e, em seguida, convertendo-as do espaço de Colorant de dispositivo para o espaço de aparência de cores usando o método DM::D seguido pelo método CAM:: Evicetocolorimetriccolors.</span><span class="sxs-lookup"><span data-stu-id="54673-160">The sampling of the output device colorant space is done by iterating through the colorants from 0.0 to 1.0 with a fractional step, accumulating all combinations of each colorant at each step, and then converting them from device colorant space to color appearance space using the DM::DeviceToColorimetricColors method followed by the CAM::ColorimetricToAppearanceColors method.</span></span> <span data-ttu-id="54673-161">Veja a seguir um exemplo de como isso é feito para RGB.</span><span class="sxs-lookup"><span data-stu-id="54673-161">The following is an example of how this is done for RGB.</span></span>


```C++
For (red= 0.0; red <= 1.0; red += redStep) {

     For (green = 0.0; green <= 1.0; green += greenStep) {

          For (blue = 0.0; blue <= 1.0; blue += blueStep) {

               Colorants[0] = red; colorants[1] = green; colorants[2] = blue;

               pRGBDM->DeviceToColorimetricColors(1, colorants, &amp;XYZ);

               pCAM->ColorimetricToAppearanceColors(1, &amp;XYZ, &amp;JCh);

          }

     }

}

```



## <a name="generation-of-the-gamut-boundary"></a><span data-ttu-id="54673-162">Geração do limite de gama</span><span class="sxs-lookup"><span data-stu-id="54673-162">Generation of the Gamut Boundary</span></span>

<span data-ttu-id="54673-163">Há três componentes para o limite de gama: os primários, os exemplos neutros e os shells.</span><span class="sxs-lookup"><span data-stu-id="54673-163">There are three components to the gamut boundary: the primaries, the neutral samples, and the shells.</span></span> <span data-ttu-id="54673-164">Os primários são gerados pela obtenção de primárias de dispositivo e aplicação da transformação DeviceToColorimetric/ColorimetricToAppearance.</span><span class="sxs-lookup"><span data-stu-id="54673-164">The primaries are generated by taking the device primaries and applying the DeviceToColorimetric/ColorimetricToAppearance transformation.</span></span> <span data-ttu-id="54673-165">Os exemplos neutros são gerados pela amostragem do espaço do dispositivo Colorant na área neutra e pela aplicação da mesma transformação.</span><span class="sxs-lookup"><span data-stu-id="54673-165">The neutral samples are generated by sampling the device colorant space in the neutral area and applying the same transformation.</span></span> <span data-ttu-id="54673-166">Para três dispositivos Colorant (RGB ou CMY), os exemplos neutros são definidos como tendo todas as colorants iguais, por exemplo, R = = G = = B. Para CMYK, as amostras neutras são definidas como tendo C = = M = = Y = = 0.</span><span class="sxs-lookup"><span data-stu-id="54673-166">For three colorant devices (RGB or CMY), the neutral samples are defined as having all of the colorants equal, for example, R == G == B. For CMYK, the neutral samples are defined as having C == M == Y == 0.</span></span>

<span data-ttu-id="54673-167">Os fatores que influenciam os dados usados para criar o limite de gama são os exemplos de dados (somente dispositivos de linha de base) e as condições de exibição.</span><span class="sxs-lookup"><span data-stu-id="54673-167">The factors that influence the data used to create the gamut boundary are the data samples (baseline devices only) and the viewing conditions.</span></span> <span data-ttu-id="54673-168">O tamanho da etapa usada para fazer a amostragem completa do espaço Colorant (para monitores e para o Shell plausível) é uma constante interna e não está disponível para manipulação externa.</span><span class="sxs-lookup"><span data-stu-id="54673-168">The step size used to do the full sampling of the colorant space (for monitors and for plausible shell) is an internal constant and isn't available for outside manipulation.</span></span> <span data-ttu-id="54673-169">Alterar as condições de exibição altera o comportamento do CAM (modelo de aparência de cor) e altera a forma do limite de gama, portanto, você deve gerar um limite de gama associado ao perfil de condições de exibição.</span><span class="sxs-lookup"><span data-stu-id="54673-169">Changing the viewing conditions changes the behavior of the color appearance model (CAM) and alters the shape of the gamut boundary, so you must generate a gamut boundary tied to the viewing conditions profile.</span></span> <span data-ttu-id="54673-170">Se os dados de exemplo forem usados, como no caso de impressoras de linha de base e dispositivos de captura, os exemplos terão um grande impacto na forma da gama de referência e afetarão o comportamento do próprio modelo.</span><span class="sxs-lookup"><span data-stu-id="54673-170">If sample data is used, as in the case of baseline printers and capture devices, then the samples will have a lot of impact on the shape of the reference gamut and affect the behavior of the model itself.</span></span>

<span data-ttu-id="54673-171">Para dispositivos de entrada, como câmeras e scanners, diferentes amostras são usadas para gerar o Shell de referência e o Shell plausível.</span><span class="sxs-lookup"><span data-stu-id="54673-171">For input devices, such as cameras and scanners, different samplings are used to generate the reference shell and the plausible shell.</span></span> <span data-ttu-id="54673-172">O Shell de referência é gerado a partir das medidas usadas para inicializar o modelo do dispositivo.</span><span class="sxs-lookup"><span data-stu-id="54673-172">The reference shell is generated from the measurements used to initialize the device model.</span></span> <span data-ttu-id="54673-173">O Shell plausível é gerado de forma semelhante à ilustração anterior para dispositivos de saída.</span><span class="sxs-lookup"><span data-stu-id="54673-173">The plausible shell is generated similar to the prior illustration for output devices.</span></span> <span data-ttu-id="54673-174">A diferença que quando você insere um destino típico, você não obtém valores totalmente saturados (em que R, G ou B = 255).</span><span class="sxs-lookup"><span data-stu-id="54673-174">The difference it that when you input a typical target, you don't get fully saturated values (where R, G, or B = 255).</span></span> <span data-ttu-id="54673-175">Você deve extrapolar usando o modelo de dispositivo para estimar esses valores.</span><span class="sxs-lookup"><span data-stu-id="54673-175">You must extrapolate using the device model to estimate those values.</span></span>

## <a name="the-gmmp-schema"></a><span data-ttu-id="54673-176">O esquema GMMP</span><span class="sxs-lookup"><span data-stu-id="54673-176">The GMMP Schema</span></span>


```C++
<?xml version="1.0" encoding="UTF-8"?>
<xs:schema 
  xmlns:gmm="http://schemas.microsoft.com/windows/2005/02/color/GamutMapModel"
  xmlns:wcs="http://schemas.microsoft.com/windows/2005/02/color/WcsCommonProfileTypes"
  targetNamespace="http://schemas.microsoft.com/windows/2005/02/color/GamutMapModel"
  xmlns:xs="http://www.w3.org/2001/XMLSchema"
  elementFormDefault="qualified"
  attributeFormDefault="unqualified"
  blockDefault="#all"
  version="1.0">

  <xs:annotation>
    <xs:documentation>
      Gamut Map Model profile schema.
      Copyright (C) Microsoft. All rights reserved.
    </xs:documentation>
  </xs:annotation>

  <xs:import namespace="http://schemas.microsoft.com/windows/2005/02/color/WcsCommonProfileTypes" />

  <xs:element name="GamutMapModel">
    <xs:complexType>
      <xs:sequence>
        <xs:element name="ProfileName" type="wcs:MultiLocalizedTextType"/>
        <xs:element name="Description" type="wcs:MultiLocalizedTextType" minOccurs="0"/>
        <xs:element name="Author" type="wcs:MultiLocalizedTextType" minOccurs="0"/>
        <xs:element name="DefaultBaselineGamutMapModel">
          <xs:simpleType>
            <xs:restriction base="xs:string">
              <xs:enumeration value="HPMinCD_Absolute"/>
              <xs:enumeration value="HPMinCD_Relative"/>
              <xs:enumeration value="SGCK"/>
              <xs:enumeration value="HueMap"/>
            </xs:restriction>
          </xs:simpleType>
        </xs:element>
        <xs:element name="PlugInGamutMapModel" minOccurs="0">
          <xs:complexType>
            <xs:sequence>
              <xs:any namespace="##other" processContents="skip"
                minOccurs="0" maxOccurs="unbounded" />
            </xs:sequence>
            <xs:attribute name="GUID" type="wcs:GUIDType" use="required"/>
          </xs:complexType>
        </xs:element>
      </xs:sequence>
      <xs:attribute name="ID" type="xs:string" use="optional" />
    </xs:complexType>
  </xs:element>
</xs:schema>
```



## <a name="the-gmmp-schema-elements"></a><span data-ttu-id="54673-177">Os elementos do esquema GMMP</span><span class="sxs-lookup"><span data-stu-id="54673-177">The GMMP Schema Elements</span></span>

## <a name="gamutmapmodel"></a><span data-ttu-id="54673-178">GamutMapModel</span><span class="sxs-lookup"><span data-stu-id="54673-178">GamutMapModel</span></span>

<span data-ttu-id="54673-179">Esse elemento é uma sequência dos seguintes subelementos:</span><span class="sxs-lookup"><span data-stu-id="54673-179">This element is a sequence of the following sub-elements:</span></span>

1.  <span data-ttu-id="54673-180">Cadeia de caracteres ProfileName,</span><span class="sxs-lookup"><span data-stu-id="54673-180">ProfileName string,</span></span>
2.  <span data-ttu-id="54673-181">DefaultBaselineGamutMapModel,</span><span class="sxs-lookup"><span data-stu-id="54673-181">DefaultBaselineGamutMapModel,</span></span>
3.  <span data-ttu-id="54673-182">Cadeia de caracteres de descrição opcional,</span><span class="sxs-lookup"><span data-stu-id="54673-182">Optional Description string,</span></span>
4.  <span data-ttu-id="54673-183">Cadeia de caracteres de autor opcional,</span><span class="sxs-lookup"><span data-stu-id="54673-183">Optional Author string,</span></span>
5.  <span data-ttu-id="54673-184">Opcional PlugInGamutMap e</span><span class="sxs-lookup"><span data-stu-id="54673-184">Optional PlugInGamutMap, and</span></span>
6.  <span data-ttu-id="54673-185">ExtensionType opcional.</span><span class="sxs-lookup"><span data-stu-id="54673-185">Optional ExtensionType.</span></span>

<span data-ttu-id="54673-186">**Condições de validação** : cada subelemento é validado por seu próprio tipo.</span><span class="sxs-lookup"><span data-stu-id="54673-186">**Validation conditions** : Each sub-element is validated by its own type.</span></span>

### <a name="namespace"></a><span data-ttu-id="54673-187">Namespace</span><span class="sxs-lookup"><span data-stu-id="54673-187">Namespace</span></span>

<span data-ttu-id="54673-188">xmlns: GMM = " http://schemas.microsoft.com/windows/2005/02/color/GamutMapModel "</span><span class="sxs-lookup"><span data-stu-id="54673-188">xmlns:gmm="http://schemas.microsoft.com/windows/2005/02/color/GamutMapModel"</span></span>

<span data-ttu-id="54673-189">targetNamespace = " http://schemas.microsoft.com/windows/2005/02/color/GamutMapModel "</span><span class="sxs-lookup"><span data-stu-id="54673-189">targetNamespace="http://schemas.microsoft.com/windows/2005/02/color/GamutMapModel"</span></span>

### <a name="version"></a><span data-ttu-id="54673-190">Versão</span><span class="sxs-lookup"><span data-stu-id="54673-190">Version</span></span>

<span data-ttu-id="54673-191">Versão "1,0" com a primeira versão do Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="54673-191">Version "1.0" with the first release of Windows Vista.</span></span>

<span data-ttu-id="54673-192">**Condições de validação** : 1,0 no Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="54673-192">**Validation conditions** : 1.0 in Windows Vista.</span></span> <span data-ttu-id="54673-193">As versões &lt; 2,0 também são válidas para oferecer suporte a alterações não significativas no formato.</span><span class="sxs-lookup"><span data-stu-id="54673-193">Versions &lt;2.0 are also valid in order to support non-breaking changes to the format.</span></span>

### <a name="documentation"></a><span data-ttu-id="54673-194">Documentação</span><span class="sxs-lookup"><span data-stu-id="54673-194">Documentation</span></span>

<span data-ttu-id="54673-195">Esquema de perfil de modelo de mapa de gamut.</span><span class="sxs-lookup"><span data-stu-id="54673-195">Gamut Map Model Profile schema.</span></span>

<span data-ttu-id="54673-196">Copyright (C) Microsoft.</span><span class="sxs-lookup"><span data-stu-id="54673-196">Copyright (C) Microsoft.</span></span> <span data-ttu-id="54673-197">Todos os direitos reservados.</span><span class="sxs-lookup"><span data-stu-id="54673-197">All rights reserved.</span></span>

<span data-ttu-id="54673-198">**Condições de validação** : cada subelemento é validado por seu próprio tipo.</span><span class="sxs-lookup"><span data-stu-id="54673-198">**Validation conditions** : Each sub-element is validated by its own type.</span></span>

### <a name="defaultbaselinegamutmapmodel-type"></a><span data-ttu-id="54673-199">Tipo de DefaultBaselineGamutMapModel</span><span class="sxs-lookup"><span data-stu-id="54673-199">DefaultBaselineGamutMapModel type</span></span>

<span data-ttu-id="54673-200">Tipo UINT</span><span class="sxs-lookup"><span data-stu-id="54673-200">UINT type</span></span>

<span data-ttu-id="54673-201">Valores de enumeração:</span><span class="sxs-lookup"><span data-stu-id="54673-201">Enumeration values:</span></span>

<dl> <span data-ttu-id="54673-202">"MinCD \_ absoluta"</span><span class="sxs-lookup"><span data-stu-id="54673-202">"MinCD\_Absolute"</span></span>  
<span data-ttu-id="54673-203">"MinCD \_ relativo"</span><span class="sxs-lookup"><span data-stu-id="54673-203">"MinCD\_Relative"</span></span>  
<span data-ttu-id="54673-204">"SIG \_ joelho"</span><span class="sxs-lookup"><span data-stu-id="54673-204">"SIG\_KNEE"</span></span>  
<span data-ttu-id="54673-205">"HueMap"</span><span class="sxs-lookup"><span data-stu-id="54673-205">"HueMap"</span></span>  
</dl>

<span data-ttu-id="54673-206">**Condições de validação** : os valores devem corresponder a uma das enumerações acima.</span><span class="sxs-lookup"><span data-stu-id="54673-206">**Validation conditions** : The values must match one of the enumerations above.</span></span>

### <a name="plugingamutmaptype"></a><span data-ttu-id="54673-207">PlugInGamutMapType</span><span class="sxs-lookup"><span data-stu-id="54673-207">PlugInGamutMapType</span></span>

<span data-ttu-id="54673-208">Esse elemento é uma sequência de um GUIDtype GUID e quaisquer subelementos.</span><span class="sxs-lookup"><span data-stu-id="54673-208">This element is a sequence of a GUID GUIDType and any sub-elements.</span></span>

<span data-ttu-id="54673-209">**Condições de validação** : o GUID é usado para corresponder ao GUID da dll do plug-in GMM.</span><span class="sxs-lookup"><span data-stu-id="54673-209">**Validation conditions** : The GUID is used to match the GMM PlugIn DLL GUID.</span></span> <span data-ttu-id="54673-210">Há um máximo de 100.000 subelementos personalizados.</span><span class="sxs-lookup"><span data-stu-id="54673-210">There are a maximum of 100,000 custom sub-elements.</span></span>

### <a name="extensiontype"></a><span data-ttu-id="54673-211">ExtensionType</span><span class="sxs-lookup"><span data-stu-id="54673-211">ExtensionType</span></span>

<span data-ttu-id="54673-212">Esse elemento é uma sequência opcional de qualquer subelemento.</span><span class="sxs-lookup"><span data-stu-id="54673-212">This element is a optional sequence of any sub-elements.</span></span>

<span data-ttu-id="54673-213">**Condições de validação** : pode haver no máximo 100.000 subelementos.</span><span class="sxs-lookup"><span data-stu-id="54673-213">**Validation conditions** : There can be a maximum of 100,000 sub-elements.</span></span>

## <a name="the-gmmp-baseline-algorithms"></a><span data-ttu-id="54673-214">Os algoritmos de linha de base GMMP</span><span class="sxs-lookup"><span data-stu-id="54673-214">The GMMP Baseline Algorithms</span></span>

## <a name="aligning-the-neutral-axes"></a><span data-ttu-id="54673-215">Alinhando os eixos neutros</span><span class="sxs-lookup"><span data-stu-id="54673-215">Aligning the Neutral Axes</span></span>

<span data-ttu-id="54673-216">A maioria dos algoritmos de mapeamento de gamut tem uma meta de mapear o eixo neutro do dispositivo de origem para o eixo neutro do dispositivo de destino: ou seja, branco vai para branco, preto para preto e cinza para cinza.</span><span class="sxs-lookup"><span data-stu-id="54673-216">Most gamut mapping algorithms have a goal of mapping the neutral axis of the source device to the neutral axis of the destination device: that is, white goes to white, black to black, and gray to gray.</span></span> <span data-ttu-id="54673-217">Isso é abordado em parte, dimensionando a claridade das cores de origem para corresponder ao intervalo de claridade do dispositivo de destino.</span><span class="sxs-lookup"><span data-stu-id="54673-217">This is addressed in part by scaling the lightness of source colors to match the lightness range of the destination device.</span></span> <span data-ttu-id="54673-218">Mas isso não resolve completamente o problema.</span><span class="sxs-lookup"><span data-stu-id="54673-218">But that does not completely address the problem.</span></span>

<span data-ttu-id="54673-219">É uma propriedade física da maioria dos dispositivos de geração de imagens que a desvio do dispositivo branco não corresponde exatamente à desvio do dispositivo em preto.</span><span class="sxs-lookup"><span data-stu-id="54673-219">It is a physical property of most imaging devices that the chromaticity of the device white does not exactly match the chromaticity of the device black.</span></span> <span data-ttu-id="54673-220">Por exemplo, o monitor branco depende da soma das desvios e das luminosidades relativas das três primárias, enquanto o monitor preto depende da reflexão da superfície de exibição.</span><span class="sxs-lookup"><span data-stu-id="54673-220">For example, monitor white depends on the sum of the chromaticities and relative luminances of the three primaries, while monitor black depends on the reflectance of the display surface.</span></span> <span data-ttu-id="54673-221">A impressora branca depende da desvio do papel, enquanto a impressora preta depende da tinta ou do toner usado.</span><span class="sxs-lookup"><span data-stu-id="54673-221">Printer white depends on the chromaticity of the paper, while printer black depends on the ink or toner used.</span></span> <span data-ttu-id="54673-222">Um modelo de aparência que mapeia o dispositivo em branco exatamente para o eixo neutro do espaço de aparência (croma exatamente igual a zero) não mapeará o dispositivo preto para o eixo neutro.</span><span class="sxs-lookup"><span data-stu-id="54673-222">An appearance model that maps device white exactly to the neutral axis of the appearance space (chroma exactly equal to zero) will not map device black to the neutral axis.</span></span> <span data-ttu-id="54673-223">Como o olho é mais sensível às diferenças de croma à medida que aumenta a claridade, os cinza médios serão representados como ainda mais desvios do que o dispositivo preto.</span><span class="sxs-lookup"><span data-stu-id="54673-223">Because the eye is more sensitive to chroma differences as lightness increases, mid-grays will be represented as even more chromatic than device black.</span></span> <span data-ttu-id="54673-224">(A Figura 1 ilustra a curvatura dos eixos neutros em duas dimensões.</span><span class="sxs-lookup"><span data-stu-id="54673-224">(Figure 1 illustrates the curvature of the neutral axes in two dimensions.</span></span> <span data-ttu-id="54673-225">Na verdade, os eixos neutros formam uma curva mais complexa em três dimensões.)</span><span class="sxs-lookup"><span data-stu-id="54673-225">In fact, the neutral axes form a more complex curve in three dimensions.)</span></span>

<span data-ttu-id="54673-226">Enquanto o CAM prevê que essas cores neutras de dispositivo aparecerão como desvios, os observadores reais parecem compensar isso.</span><span class="sxs-lookup"><span data-stu-id="54673-226">While the CAM predicts that these device neutral colors will appear chromatic, actual observers seem to compensate for this.</span></span> <span data-ttu-id="54673-227">A maioria das pessoas não considera esses valores neutros de dispositivo como desvio.</span><span class="sxs-lookup"><span data-stu-id="54673-227">Most people do not consider these device neutral values to be chromatic.</span></span> <span data-ttu-id="54673-228">Para a maioria dos modelos de mapeamento de gama, você deve continuar a mapear os neutros de origem para os neutros de dispositivo.</span><span class="sxs-lookup"><span data-stu-id="54673-228">For most gamut mapping models, therefore, you should continue to map source neutrals to device neutrals.</span></span>

<span data-ttu-id="54673-229">Para mapear os neutros de origem para os neutros de dispositivo, ajuste os limites de gama de origem e de destino e cada pixel ao aplicar o algoritmo de mapeamento de gamut.</span><span class="sxs-lookup"><span data-stu-id="54673-229">To map source neutrals to device neutrals, adjust the source and destination gamut boundaries and each pixel when you apply the gamut mapping algorithm.</span></span> <span data-ttu-id="54673-230">Primeiro, ajuste cada valor na cor de origem para que o eixo neutro do dispositivo de origem na claridade da cor de origem fique diretamente no eixo neutro do espaço de aparência.</span><span class="sxs-lookup"><span data-stu-id="54673-230">First adjust each value in the source color so that the source device's neutral axis at the source color's lightness falls directly on the neutral axis of the appearance space.</span></span> <span data-ttu-id="54673-231">(Consulte o lado esquerdo da Figura 1.) Em seguida, ajuste a descrição do limite de gama do dispositivo de destino para que cada cor no eixo neutro do dispositivo de destino na luminosidade da cor do limite de gama do dispositivo de destino fique diretamente no eixo neutro do espaço de aparência.</span><span class="sxs-lookup"><span data-stu-id="54673-231">(See the left side of Figure 1.) Then adjust the destination device's gamut boundary description so that each color on the destination device's neutral axis at the destination device gamut boundary color's lightness falls directly on the neutral axis of the appearance space.</span></span> <span data-ttu-id="54673-232">(Consulte o lado direito da Figura 1.)</span><span class="sxs-lookup"><span data-stu-id="54673-232">(See the right side of Figure 1.)</span></span>

![Diagrama que mostra o gráfico de limite de gama de origem à esquerda e o limite de gama de destino à direita.](images/gmmp-image004.png)

<span data-ttu-id="54673-234">**Figura 1** : alinhamento dos eixos neutros ilustrados.</span><span class="sxs-lookup"><span data-stu-id="54673-234">**Figure 1** : Alignment of the neutral axes illustrated.</span></span> <span data-ttu-id="54673-235">Esquerda: ajustando os pontos de origem relativos ao eixo neutro do dispositivo de origem.</span><span class="sxs-lookup"><span data-stu-id="54673-235">Left: Adjusting source points relative to the source device neutral axis.</span></span> <span data-ttu-id="54673-236">Direita: ajustando a descrição do limite de gama de destino em relação à descrição do limite de gama de destino.</span><span class="sxs-lookup"><span data-stu-id="54673-236">Right: Adjusting the destination gamut boundary description relative to the destination gamut boundary description.</span></span>

<span data-ttu-id="54673-237">Observe que você ajusta cada valor de pixel de origem relativo ao eixo neutro nesse valor de claridade.</span><span class="sxs-lookup"><span data-stu-id="54673-237">Note that you adjust each source pixel value relative to the neutral axis at that lightness value.</span></span> <span data-ttu-id="54673-238">Isso garante que os neutros do dispositivo de origem se enquadram no eixo neutro do modelo de aparência.</span><span class="sxs-lookup"><span data-stu-id="54673-238">This assures that source device neutrals will fall on the neutral axis of the appearance model.</span></span> <span data-ttu-id="54673-239">Você também move todas as outras cores nessa claridade pelo mesmo valor, para que não haja nenhum descontinuidades na representação da gama de origem.</span><span class="sxs-lookup"><span data-stu-id="54673-239">You also shift all other colors at that lightness by the same amount, so that there are no discontinuities in the representation of the source gamut.</span></span> <span data-ttu-id="54673-240">Você precisa mudar de acordo com valores diferentes em níveis de claridade diferentes, pois os neutros do dispositivo de origem não são representados como desvios igualmente nos diferentes níveis de luminosidade.</span><span class="sxs-lookup"><span data-stu-id="54673-240">You have to shift by different amounts at different lightness levels, because the source device neutrals are not represented as equally chromatic at the different lightness levels.</span></span> <span data-ttu-id="54673-241">Claramente, essa não é uma transformação trivial.</span><span class="sxs-lookup"><span data-stu-id="54673-241">Clearly, this is not a trivial transformation.</span></span>

<span data-ttu-id="54673-242">Lidar com os valores do dispositivo de destino é um pouco mais complicado.</span><span class="sxs-lookup"><span data-stu-id="54673-242">Handling the destination device values is a little more tricky.</span></span> <span data-ttu-id="54673-243">Inicialmente, você ajusta todo o limite de gama de destino de maneira semelhante, mas relativo ao eixo neutro do dispositivo de destino.</span><span class="sxs-lookup"><span data-stu-id="54673-243">Initially, you adjust the entire destination gamut boundary in a similar manner, but relative to the destination device neutral axis.</span></span> <span data-ttu-id="54673-244">Isso é ilustrado na Figura 1 no lado direito.</span><span class="sxs-lookup"><span data-stu-id="54673-244">This is illustrated in Figure 1 on the right side.</span></span> <span data-ttu-id="54673-245">Esse ajuste garante que os valores de cinza de origem serão mapeados para valores cinza de destino.</span><span class="sxs-lookup"><span data-stu-id="54673-245">That adjustment assures that source gray values will map to destination gray values.</span></span> <span data-ttu-id="54673-246">Este é o espaço no qual os algoritmos de mapeamento de gama operam.</span><span class="sxs-lookup"><span data-stu-id="54673-246">This is the space in which the gamut mapping algorithms operate.</span></span>

<span data-ttu-id="54673-247">No entanto, esse espaço não descreve precisamente o comportamento real do dispositivo de destino.</span><span class="sxs-lookup"><span data-stu-id="54673-247">However, this space does not accurately describe the true behavior of the destination device.</span></span> <span data-ttu-id="54673-248">Você deve inverter o mapeamento antes que as cores mapeadas em gamut sejam entregues ao modelo de aparência e ao modelo de dispositivo de destino.</span><span class="sxs-lookup"><span data-stu-id="54673-248">You must invert the mapping before gamut mapped colors are handed to the appearance model and destination device model.</span></span> <span data-ttu-id="54673-249">Você desloca todos os valores mapeados pelo oposto do deslocamento aplicado anteriormente ao eixo neutro do dispositivo de destino.</span><span class="sxs-lookup"><span data-stu-id="54673-249">You offset all the mapped values by the opposite of the offset applied earlier to the destination device neutral axis.</span></span> <span data-ttu-id="54673-250">Isso mapeia o eixo neutro de destino de volta para o valor representado originalmente pelo CAM.</span><span class="sxs-lookup"><span data-stu-id="54673-250">This maps the destination neutral axis back to the value represented originally by the CAM.</span></span> <span data-ttu-id="54673-251">Ele faz o mesmo para o limite de gama e todos os valores intermediários.</span><span class="sxs-lookup"><span data-stu-id="54673-251">It does the same for the gamut boundary and all intermediate values.</span></span>

![Diagrama que mostra um grafo para desfazer o alinhamento do eixo neutro do dispositivo de destino.](images/gmmp-image008.png)

<span data-ttu-id="54673-253">**Figura 2** : desfazendo o alinhamento do eixo neutro do dispositivo de destino</span><span class="sxs-lookup"><span data-stu-id="54673-253">**Figure 2** : Undoing the alignment of the destination device neutral axis</span></span>

### <a name="minimum-color-difference-mincd"></a><span data-ttu-id="54673-254">Diferença mínima de cor (MinCD)</span><span class="sxs-lookup"><span data-stu-id="54673-254">Minimum Color Difference (MinCD)</span></span>

<span data-ttu-id="54673-255">Diferença de cor mínima (MinCD) versões relativas e absolutas-equivalentes à intenção colorimétrico ICC.</span><span class="sxs-lookup"><span data-stu-id="54673-255">Minimum Color Difference(MinCD) Relative and Absolute versions - equivalent to the ICC colorimetric intent.</span></span>

> [!Note]  
> <span data-ttu-id="54673-256">O MinCD GMM é adequado para mapear gráficos e arte de linhas contendo cores de "logotipos" (cores spot), gradientes de cores de logotipo com algumas cores fora do gamut e para o estágio final de transformações de verificação.</span><span class="sxs-lookup"><span data-stu-id="54673-256">The MinCD GMM is suitable for mapping graphics and line art containing "logo" colors (spot colors), logo color gradients with some out-of-gamut colors, and for the final stage of proofing transforms.</span></span> <span data-ttu-id="54673-257">Embora o MinCD GMM pudesse ser usado para imagens fotográficas que são inteiramente dentro da gama de destino, não é recomendável para renderização geral de imagens fotográficas.</span><span class="sxs-lookup"><span data-stu-id="54673-257">While the MinCD GMM could be used for photographic images that are entirely within the destination gamut, it is not recommended for general rendering of photographic images.</span></span> <span data-ttu-id="54673-258">O mapeamento de cores fora do gamut para cores na superfície da gama de destino pode resultar em artefatos indesejados, como tons ou irregularidades croma em gradientes suaves que cruzam o limite de gama.</span><span class="sxs-lookup"><span data-stu-id="54673-258">The mapping of out-of-gamut colors to colors on the destination gamut surface can result in unwanted artifacts, such as tone or chroma irregularities in smooth gradients that cross the gamut boundary.</span></span> <span data-ttu-id="54673-259">BasicPhoto é recomendado para imagens fotográficas.</span><span class="sxs-lookup"><span data-stu-id="54673-259">BasicPhoto is recommended for photographic images.</span></span> <span data-ttu-id="54673-260">Se uma imagem fotográfica ou de contom exigir um mapeamento de gamut diferente de BasicPhoto, a alternativa deverá ser criar um GMM de plug-in que implemente esse mapeamento, em vez de usar MinCD.</span><span class="sxs-lookup"><span data-stu-id="54673-260">If a photographic or contone image requires a gamut mapping other than BasicPhoto, then the alternative should be to create a plug-in GMM implementing that mapping, instead of using MinCD.</span></span>

 

<span data-ttu-id="54673-261">As cores na gama permanecem inalteradas.</span><span class="sxs-lookup"><span data-stu-id="54673-261">In-gamut colors are left unchanged.</span></span> <span data-ttu-id="54673-262">Para cores fora do gamut, a claridade e a croma são ajustadas encontrando o ponto na gama de destino que tem a distância de cor mínima de pontos de entrada fora do gamut.</span><span class="sxs-lookup"><span data-stu-id="54673-262">For out-of-gamut colors, lightness and chroma are adjusted by finding the point in the destination gamut that has the minimum color distance from out-of-gamut input points.</span></span> <span data-ttu-id="54673-263">A distância da cor é calculada no espaço JCh.</span><span class="sxs-lookup"><span data-stu-id="54673-263">The color distance is computed in JCh space.</span></span> <span data-ttu-id="54673-264">No entanto, você pondera a distância na claridade (J) e a distância em croma (C) ou matiz (h) de forma diferente.</span><span class="sxs-lookup"><span data-stu-id="54673-264">However, you weight the distance in lightness (J) and the distance in chroma (C) or hue (h) differently.</span></span> <span data-ttu-id="54673-265">Uma função de peso dependente de croma é usada para a distância na claridade, de forma que o peso seja menor para pequenos croma e maior para grandes croma até que um limite croma seja atingido, após o qual o peso permanece em 1, ou seja, o mesmo peso que a distância em croma ou matiz.</span><span class="sxs-lookup"><span data-stu-id="54673-265">A chroma-dependent weight function is used for the distance in lightness so that the weight is smaller for small chroma and larger for large chroma until a threshold chroma is reached, after which the weight stays at 1, that is, the same weight as distance in chroma or hue.</span></span> <span data-ttu-id="54673-266">Isso segue o uso recomendado para CMC e CIEDE2000.</span><span class="sxs-lookup"><span data-stu-id="54673-266">This follows recommended usage for CMC and CIEDE2000.</span></span> <span data-ttu-id="54673-267">Há duas variantes: colorimétrico relativo e colorimétrico absoluto.</span><span class="sxs-lookup"><span data-stu-id="54673-267">There are two variants: Relative colorimetric and absolute colorimetric.</span></span>

<span data-ttu-id="54673-268">**Colorimétrico relativo:** Primeiro, alinhe os eixos neutros de origem e de destino conforme descrito anteriormente.</span><span class="sxs-lookup"><span data-stu-id="54673-268">**Relative colorimetric:** First, align the source and destination neutral axes as described previously.</span></span> <span data-ttu-id="54673-269">Em seguida, recorte a cor de origem ajustada para o limite de gama de destino ajustado.</span><span class="sxs-lookup"><span data-stu-id="54673-269">Then clip the adjusted source color to the adjusted destination gamut boundary.</span></span> <span data-ttu-id="54673-270">(Consulte a Figura 4.</span><span class="sxs-lookup"><span data-stu-id="54673-270">(See Figure 4.</span></span> <span data-ttu-id="54673-271">Mapeamento de croma ao longo da luminosidade constante.) Reajuste os valores do dispositivo de destino conforme descrito anteriormente.</span><span class="sxs-lookup"><span data-stu-id="54673-271">Chroma mapping along constant lightness.) Readjust the destination device values as described previously.</span></span> <span data-ttu-id="54673-272">No caso de um limite de gama de destino monocromático, o recorte croma significa que o valor de croma (C) é definido como zero (0,0).</span><span class="sxs-lookup"><span data-stu-id="54673-272">In the case of a monochrome destination gamut boundary, the chroma clipping means that the chroma value (C) is set to zero (0.0).</span></span>

<span data-ttu-id="54673-273">**Colorimétrico absoluto:** Isso é semelhante ao colorimétrico relativo, mas sem o alinhamento do eixo neutro de origem e de destino.</span><span class="sxs-lookup"><span data-stu-id="54673-273">**Absolute colorimetric:** This is similar to relative colorimetric, but without the alignment of the source and destination neutral axis.</span></span> <span data-ttu-id="54673-274">O valor de origem é recortado diretamente para o eixo neutro de destino.</span><span class="sxs-lookup"><span data-stu-id="54673-274">The source value is clipped directly to the destination neutral axis.</span></span> <span data-ttu-id="54673-275">Observe que se os limites de gama de origem e de destino forem monocromáticos, o comportamento será idêntico à variante colorimétrico relativa; ou seja, o alinhamento dos eixos neutros é executado e, em seguida, o croma é recortado para zero.</span><span class="sxs-lookup"><span data-stu-id="54673-275">Note that if both the source and destination gamut boundaries are monochrome, the behavior is identical to the relative colorimetric variant; that is, the neutral axes alignment is performed, and then the chroma is clipped to zero.</span></span> <span data-ttu-id="54673-276">Isso garante que uma saída razoável seja obtida mesmo se a mídia e a colorants forem significativamente diferentes.</span><span class="sxs-lookup"><span data-stu-id="54673-276">This ensures that a reasonable output is attained even if the media and colorants are significantly different.</span></span>

![Diagrama que mostra um grafo para recorte de MinCD para a gama ajustada.](images/gmmp-image010.png)

<span data-ttu-id="54673-278">**Figura 3** : recorte de MinCD para a gama ajustada</span><span class="sxs-lookup"><span data-stu-id="54673-278">**Figure 3** : MinCD clipping to the adjusted gamut</span></span>

### <a name="basicphoto"></a><span data-ttu-id="54673-279">BasicPhoto</span><span class="sxs-lookup"><span data-stu-id="54673-279">BasicPhoto</span></span>

### <a name="overview"></a><span data-ttu-id="54673-280">Visão geral</span><span class="sxs-lookup"><span data-stu-id="54673-280">Overview</span></span>

<span data-ttu-id="54673-281">BasicPhoto-equivalente à intenção de ICC, de ilustrações ou de perceptiva.</span><span class="sxs-lookup"><span data-stu-id="54673-281">BasicPhoto - equivalent to the ICC preferred, pictorial, or perceptual intent.</span></span>

<span data-ttu-id="54673-282">Esse algoritmo é uma variante do mapeamento de luminosidade de sigmoidal dependente de croma e SGCK (Cusp de dimensionamento joelho) descritos por CIE TC8-03 em CIE156:2004.</span><span class="sxs-lookup"><span data-stu-id="54673-282">This algorithm is a variant of the chroma-dependent sigmoidal lightness mapping and cusp knee scaling (SGCK) described by CIE TC8-03 in CIE156:2004.</span></span> <span data-ttu-id="54673-283">Este algoritmo variante dá suporte a descritores de limite de gamut (GBDs) com shells de gama dupla; ou seja, GBDs com um shell de referência e um shell plausível.</span><span class="sxs-lookup"><span data-stu-id="54673-283">This variant algorithm supports gamut boundary descriptors (GBDs) with dual gamut shells; that is, GBDs with a reference shell and a plausible shell.</span></span> <span data-ttu-id="54673-284">O algoritmo SGCK, que originalmente assume um shell de gamut no GBD, é baseado no \_ algoritmo SIG joelho (Braun 1999), que incorpora o mapeamento de claridade de sigmoidal e o dimensionamento de função joelho proposto por Braun e Fairchild (1999), combinados com a dependência croma de GCUSP (Morovic, 1998).</span><span class="sxs-lookup"><span data-stu-id="54673-284">The SGCK algorithm, which originally assumes only one gamut shell in the GBD, is based on the SIG\_KNEE algorithm (Braun 1999), that incorporates the sigmoidal lightness mapping and knee function scaling proposed by Braun and Fairchild (1999), combined with the chroma dependence from GCUSP (Morovic, 1998).</span></span> <span data-ttu-id="54673-285">Ele mantém uma constante de matiz percebida, por exemplo, ângulo de matiz em jab corrigida por matiz e usa um dimensionamento de claridade de sigmoidal genérico (independente de imagem), que é aplicado de uma maneira dependente de croma e uma função croma joelho de 90%.</span><span class="sxs-lookup"><span data-stu-id="54673-285">It keeps perceived hue constant, for example, hue angle in hue-corrected Jab, and uses a generic (image-independent) sigmoidal lightness scaling which is applied in a chroma-dependent way and a 90 percent knee function chroma.</span></span> <span data-ttu-id="54673-286">A variante é dimensionada junto com as linhas de luminosidade constante.</span><span class="sxs-lookup"><span data-stu-id="54673-286">The variant scales along lines of constant lightness.</span></span>

### <a name="the-case-of-single-gamut-shell"></a><span data-ttu-id="54673-287">O caso de um único Shell de gamut</span><span class="sxs-lookup"><span data-stu-id="54673-287">The case of single gamut shell</span></span>

<span data-ttu-id="54673-288">É útil examinar o algoritmo no caso em que a origem e o destino GBDs têm apenas um shell de gamut.</span><span class="sxs-lookup"><span data-stu-id="54673-288">It is helpful to review the algorithm in the case where both source and destination GBDs have only one gamut shell.</span></span> <span data-ttu-id="54673-289">Nesse caso, o algoritmo consiste nos seguintes cálculos.</span><span class="sxs-lookup"><span data-stu-id="54673-289">In this case, the algorithm consists of the following calculations.</span></span>

<span data-ttu-id="54673-290">Primeiro, execute o mapeamento de claridade inicial usando a seguinte fórmula:</span><span class="sxs-lookup"><span data-stu-id="54673-290">First, perform initial lightness mapping using the following formula:</span></span>

![Mostra a fórmula para o mapeamento de claridade inicial.](images/gmmp-image012.png) <span data-ttu-id="54673-292">(1)</span><span class="sxs-lookup"><span data-stu-id="54673-292">(1)</span></span>

<span data-ttu-id="54673-293">em que *j ₒ* é a claridade original e *j <sub>R</sub>* é a claridade da reprodução.</span><span class="sxs-lookup"><span data-stu-id="54673-293">where *Jₒ* is the original lightness and *J<sub>R</sub>* is the reproduction lightness.</span></span>

![Mostra a segunda fórmula de mapeamento de claridade.](images/gmmp-image014.png) <span data-ttu-id="54673-295">(2)</span><span class="sxs-lookup"><span data-stu-id="54673-295">(2)</span></span>

<span data-ttu-id="54673-296">Quando o limite de gamut de origem for monocromático, o valor de croma será zero para o limite monocromático devido ao alinhamento de eixo neutro.</span><span class="sxs-lookup"><span data-stu-id="54673-296">When the source gamut boundary is monochrome, the chroma value will be zero for the monochrome boundary due to neutral axis alignment.</span></span> <span data-ttu-id="54673-297">Isso resultará no caso de degeneração, em que C é igual a zero.</span><span class="sxs-lookup"><span data-stu-id="54673-297">This will result in the degenerate case where C is equal to zero.</span></span> <span data-ttu-id="54673-298">Nesse caso, *p <sub>C</sub>* é definido como 1.</span><span class="sxs-lookup"><span data-stu-id="54673-298">In this case, *p<sub>C</sub>* is set to 1.</span></span>

<span data-ttu-id="54673-299">*p <sub>C</sub>* é um fator de ponderação dependente de croma (Morovic, 1998) que depende do Croma da cor original, C e *J <sub>S</sub>* são o resultado da claridade original que está sendo mapeada usando uma função sigmoidal.</span><span class="sxs-lookup"><span data-stu-id="54673-299">*p <sub>C</sub>* is a chroma-dependent weighting factor (Morovic, 1998) that depends on the chroma of the original color, C and *J<sub>S</sub>* are the result of the original lightness being mapped using a sigmoidal function.</span></span>

 

<span data-ttu-id="54673-300">Para calcular *J <sub>S</sub>* (Braun e Fairchild, 1999), uma tabela de pesquisa unidimensional (LUT) entre os valores de claridade original e de reprodução é configurada pela primeira vez de uma função normal cumulativa (S) discreta.</span><span class="sxs-lookup"><span data-stu-id="54673-300">To calculate *J<sub>S</sub>* (Braun and Fairchild, 1999), a one-dimensional lookup table (LUT) between original and reproduction lightness values is first set up on the basis of a discrete cumulative normal function (S).</span></span>

![Mostra uma fórmula para calcular J s.](images/gmmp-image016.png) <span data-ttu-id="54673-302">(3)</span><span class="sxs-lookup"><span data-stu-id="54673-302">(3)</span></span>

<span data-ttu-id="54673-303">onde x ₀ e S são a média e o desvio padrão da distribuição normal, respectivamente, e *eu* = 0, 1, 2... *m*,*m* é o número de pontos usados no lut.</span><span class="sxs-lookup"><span data-stu-id="54673-303">where x ₀ and S are the mean and standard deviation of the normal distribution respectively and *i* = 0,1,2... *m*,*m* is the number of points used in the LUT.</span></span> <span data-ttu-id="54673-304">*S <sub>i</sub>* é o valor da função normal cumulativa para *i*  / *m* %.</span><span class="sxs-lookup"><span data-stu-id="54673-304">*S <sub>i</sub>* is the value of the cumulative normal function for *i* /*m* percent.</span></span> <span data-ttu-id="54673-305">Os parâmetros dependem da claridade do ponto preto da gama de reprodução e podem ser interpolados da tabela 1.</span><span class="sxs-lookup"><span data-stu-id="54673-305">The parameters depend on the lightness of the black point of the reproduction gamut and can be interpolated from Table 1.</span></span> <span data-ttu-id="54673-306">Para obter detalhes sobre como calcular esses parâmetros, consulte Braun e Fairchild (1999, p.</span><span class="sxs-lookup"><span data-stu-id="54673-306">For details of calculating these parameters see Braun and Fairchild (1999, p.</span></span> <span data-ttu-id="54673-307">391).</span><span class="sxs-lookup"><span data-stu-id="54673-307">391).</span></span>

:::row:::
    :::column:::
        <span data-ttu-id="54673-308"><sub>MinOut</sub> J</span><span class="sxs-lookup"><span data-stu-id="54673-308">J <sub>minOut</sub></span></span>
    :::column-end:::
    :::column:::
       <span data-ttu-id="54673-309">5.0</span><span class="sxs-lookup"><span data-stu-id="54673-309">5.0</span></span>
    :::column-end:::
    :::column:::
        <span data-ttu-id="54673-310">10.0</span><span class="sxs-lookup"><span data-stu-id="54673-310">10.0</span></span>
    :::column-end:::
    :::column:::
        <span data-ttu-id="54673-311">15.0</span><span class="sxs-lookup"><span data-stu-id="54673-311">15.0</span></span>
    :::column-end:::
    :::column:::
        <span data-ttu-id="54673-312">20,0</span><span class="sxs-lookup"><span data-stu-id="54673-312">20.0</span></span>
    :::column-end:::
:::row-end:::
:::row:::
    :::column:::
        <span data-ttu-id="54673-313">x ₀</span><span class="sxs-lookup"><span data-stu-id="54673-313">x ₀</span></span>
    :::column-end:::
    :::column:::
       <span data-ttu-id="54673-314">53,7</span><span class="sxs-lookup"><span data-stu-id="54673-314">53.7</span></span>
    :::column-end:::
    :::column:::
        <span data-ttu-id="54673-315">56,8</span><span class="sxs-lookup"><span data-stu-id="54673-315">56.8</span></span>
    :::column-end:::
    :::column:::
        <span data-ttu-id="54673-316">58,2</span><span class="sxs-lookup"><span data-stu-id="54673-316">58.2</span></span>
    :::column-end:::
    :::column:::
        <span data-ttu-id="54673-317">60,6</span><span class="sxs-lookup"><span data-stu-id="54673-317">60.6</span></span>
    :::column-end:::
:::row-end:::
:::row:::
    :::column:::
        <span data-ttu-id="54673-318">S</span><span class="sxs-lookup"><span data-stu-id="54673-318">S</span></span>
    :::column-end:::
    :::column:::
       <span data-ttu-id="54673-319">43.0</span><span class="sxs-lookup"><span data-stu-id="54673-319">43.0</span></span>
    :::column-end:::
    :::column:::
        <span data-ttu-id="54673-320">49.0</span><span class="sxs-lookup"><span data-stu-id="54673-320">40.0</span></span>
    :::column-end:::
    :::column:::
        <span data-ttu-id="54673-321">35,0</span><span class="sxs-lookup"><span data-stu-id="54673-321">35.0</span></span>
    :::column-end:::
    :::column:::
        <span data-ttu-id="54673-322">34,5</span><span class="sxs-lookup"><span data-stu-id="54673-322">34.5</span></span>
    :::column-end:::
:::row-end:::


<span data-ttu-id="54673-323">**Tabela 1** : cálculo do parâmetro de compactação de claridade BasicPhoto</span><span class="sxs-lookup"><span data-stu-id="54673-323">**Table 1** : BasicPhoto lightness compression parameter calculation</span></span>

<span data-ttu-id="54673-324">Para usar S como um mapeamento de claridade LUT (S <sub>lut</sub> ), ele deve ser normalizado primeiro no intervalo de claridade de \[ 0100 \] .</span><span class="sxs-lookup"><span data-stu-id="54673-324">To use S as a lightness mapping LUT (S <sub>LUT</sub> ) it must first be normalized into the lightness range of \[0,100\].</span></span> <span data-ttu-id="54673-325">Os dados normalizados são então dimensionados para o intervalo dinâmico do dispositivo de destino, conforme mostrado na equação 4, em que *j*<sub>min \ *out*</sub> e *j*<sub>Max \ *out*</sub> são os valores de luminosidade do ponto preto e do ponto branco da mídia de reprodução, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="54673-325">The normalized data is then scaled into the dynamic range of the destination device, as shown in Equation 4, where *J*<sub>min\ *Out*</sub> and *J*<sub>max\ *Out*</sub> are the values of lightness of the black point and the white point of the reproduction medium, respectively.</span></span>

![Mostra a fórmula para S como um mapeamento de claridade LUT.](images/gmmp-image018.png) <span data-ttu-id="54673-327">(4)</span><span class="sxs-lookup"><span data-stu-id="54673-327">(4)</span></span>

<span data-ttu-id="54673-328">Neste ponto, os valores de *j s* podem ser obtidos na <sub>lut</sub> de s, interpolando entre os pontos *m* dos valores de *j O* e *j s* correspondentes que ele contém e usando a equação a seguir como entrada.</span><span class="sxs-lookup"><span data-stu-id="54673-328">At this point, the *J S* values can be obtained from the S <sub>LUT</sub> by interpolating between the *m* points of corresponding *J O'* and *J S* values it contains, and using the following equation as the input.</span></span>

![Mostra a fórmula para obter os valores de J S.](images/gmmp-image020.png) <span data-ttu-id="54673-330">(5)</span><span class="sxs-lookup"><span data-stu-id="54673-330">(5)</span></span>

<span data-ttu-id="54673-331">J <sub>Mini</sub> é o valor de claridade do ponto preto da mídia original, j é o valor de claridade do ponto branco do meio original, <sub>e j</sub> <sub>o é a</sub> claridade original do.</span><span class="sxs-lookup"><span data-stu-id="54673-331">J <sub>minIn</sub> is the lightness value of the black point of the original medium, J <sub>maxIn</sub> is the lightness value of the white point of the original medium, and J <sub>O</sub> is the original lightness.</span></span> <span data-ttu-id="54673-332">Para referência posterior, você pode indicar por *S* a função sigmoidal definida da maneira que acabou de ser descrita, conforme ilustrado na Figura 4 a seguir.</span><span class="sxs-lookup"><span data-stu-id="54673-332">For later reference, you can denote by *S* the sigmoidal function defined in the manner just outlined, as illustrated in the following Figure 4.</span></span>

![Diagrama que mostra o grafo para o mapeamento de croma ao longo da luminosidade constante.](images/gmmp-image024.png)

<span data-ttu-id="54673-334">**Figura 4** : mapeamento de croma ao longo da luminosidade constante</span><span class="sxs-lookup"><span data-stu-id="54673-334">**Figure 4** : Chroma mapping along constant lightness</span></span>

<span data-ttu-id="54673-335">Em segundo lugar, se o limite de gama de destino for desvio, compacte croma junto com as linhas de luminosidade constante (l) e execute a compactação da seguinte maneira.</span><span class="sxs-lookup"><span data-stu-id="54673-335">Second, if the destination gamut boundary is chromatic, compress chroma along lines of constant lightness (l) and perform the compression as follows.</span></span>

![Mostra a fórmula para executar a compactação croma.](images/gmmp-image026.png) <span data-ttu-id="54673-337"> (6)</span><span class="sxs-lookup"><span data-stu-id="54673-337">(6)</span></span>

<span data-ttu-id="54673-338">onde *d* representa a distância de *E* em *l*; *g* representa o limite médio de gama; *r* representa a reprodução; e *o* original Figura 5.</span><span class="sxs-lookup"><span data-stu-id="54673-338">where *d* represents distance from *E* on *l*;*g* represents the medium gamut boundary; *r* represents the reproduction; and *o* the original Figure 5.</span></span>

![Diagrama que mostra o grafo para compactação croma e claridade em BasicPhoto.](images/gmmp-image028.png)

<span data-ttu-id="54673-340">**Figura 5** : compactação de croma e claridade no BasicPhoto</span><span class="sxs-lookup"><span data-stu-id="54673-340">**Figure 5** : Chroma and lightness compression in BasicPhoto</span></span>

<span data-ttu-id="54673-341">Se o limite de gama de destino for monocromático, o valor de croma será recortado para zero.</span><span class="sxs-lookup"><span data-stu-id="54673-341">If the destination gamut boundary is monochrome, then the chroma value is clipped to zero.</span></span>

<span data-ttu-id="54673-342">Em terceiro lugar, use um clipe MinCD (descrito anteriormente) para eliminar qualquer erro residual.</span><span class="sxs-lookup"><span data-stu-id="54673-342">Third, use a MinCD clip (described earlier) to eliminate any residual error.</span></span>

### <a name="black-enhancement"></a><span data-ttu-id="54673-343">Aprimoramento preto</span><span class="sxs-lookup"><span data-stu-id="54673-343">Black enhancement</span></span>

<span data-ttu-id="54673-344">O algoritmo anterior pode ser modificado para melhorar o preto quando o destino é um dispositivo de impressora.</span><span class="sxs-lookup"><span data-stu-id="54673-344">The preceding algorithm can be modified to improve the black when the destination is a printer device.</span></span> <span data-ttu-id="54673-345">O problema tem a ver com a escolha de *J <sub>minOut</sub>*, que geralmente não corresponde à cor mais escura que uma impressora pode produzir.</span><span class="sxs-lookup"><span data-stu-id="54673-345">The issue has to do with the choice of *J<sub>minOut</sub>*, which usually does not correspond to the darkest color a printer can produce.</span></span>

<span data-ttu-id="54673-346">Mais especificamente, a cor com densidade mais alta, obtida com a colocação de tintas de 100% (ou cobertura máxima possível, se a limitação de GCR/tinta estiver em vigor), geralmente não é "neutra" no espaço de aparência da cor.</span><span class="sxs-lookup"><span data-stu-id="54673-346">More specifically, the color with highest density, obtained by putting 100 percent inks (or maximum possible coverage, if GCR/ink limiting is in effect), is usually not "neutral" in the color appearance space.</span></span> <span data-ttu-id="54673-347">Consulte a Figura 6.</span><span class="sxs-lookup"><span data-stu-id="54673-347">See Figure 6.</span></span> <span data-ttu-id="54673-348">Em outras palavras, se a claridade mínima neutra for usada para o dispositivo de destino, o dimensionador de luminosidade construído será mapeado para uma claridade mínima que não seja a maior densidade que pode ser obtida pela impressora.</span><span class="sxs-lookup"><span data-stu-id="54673-348">In other words, if neutral minimum lightness is used for the destination device, the lightness scaler constructed will map to a minimum lightness that is not the highest density that can be achieved by the printer.</span></span> <span data-ttu-id="54673-349">Considere o caso de uso adicional do monitor para a impressora.</span><span class="sxs-lookup"><span data-stu-id="54673-349">Consider the further use case of monitor to printer.</span></span> <span data-ttu-id="54673-350">O monitor preto, R = G = B = 0, será impresso como não a densidade mais alta.</span><span class="sxs-lookup"><span data-stu-id="54673-350">The monitor black, R=G=B=0, will then be printed as not the highest density.</span></span> <span data-ttu-id="54673-351">O impacto na qualidade da imagem é que há uma falta de profundidade e contraste.</span><span class="sxs-lookup"><span data-stu-id="54673-351">The impact on the image quality is that there is a lack of depth and contrast.</span></span>

![Diagrama que mostra como o ponto preto do dispositivo pode ser mais escuro do que a claridade mínima neutra.](images/gmmp-seqfigure01.png)

<span data-ttu-id="54673-353">**Figura 6** : o ponto preto do dispositivo pode ser mais escuro do que a claridade mínima neutra.</span><span class="sxs-lookup"><span data-stu-id="54673-353">**Figure 6** : The device black point may be darker than the neutral minimum lightness.</span></span>

<span data-ttu-id="54673-354">Suponha que o "ponto preto do dispositivo" de destino seja Jkakbk/JkCkh k.</span><span class="sxs-lookup"><span data-stu-id="54673-354">Suppose the destination "device black point" is Jₖaₖbₖ/JₖCₖh ₖ.</span></span> <span data-ttu-id="54673-355">Se C k não for zero, o ponto preto do dispositivo não será neutro em relação a CAM02.</span><span class="sxs-lookup"><span data-stu-id="54673-355">If C ₖ is not zero, then the device black point is not neutral relative to CAM02.</span></span> <span data-ttu-id="54673-356">Se você usar J k para o destino "claridade mínima neutra" na construção do dimensionador de claridade; ou seja, definindo</span><span class="sxs-lookup"><span data-stu-id="54673-356">If you use J ₖ for the destination "neutral minimum lightness" in the construction of the lightness scaler; that is, setting</span></span>

<span data-ttu-id="54673-357">*J <sub>minOut</sub> = JK*</span><span class="sxs-lookup"><span data-stu-id="54673-357">*J<sub>minOut</sub> = Jₖ*</span></span>

<span data-ttu-id="54673-358">e aplicá-lo ao Shell de gamut de origem, você obtém a configuração descrita na Figura 7.</span><span class="sxs-lookup"><span data-stu-id="54673-358">and apply it to the source gamut shell, you obtain the configuration depicted in Figure 7.</span></span> <span data-ttu-id="54673-359">Na figura, o plano de matiz corresponde a h k.</span><span class="sxs-lookup"><span data-stu-id="54673-359">In the figure, the hue plane corresponds to h ₖ.</span></span>

![Diagrama que mostra o dimensionador de claridade modificado com o ponto preto do dispositivo de destino.](images/gmmp-seqfigure02.png)

<span data-ttu-id="54673-361">**Figura 7** : geometria usando o dimensionador de claridade modificado com o ponto preto do dispositivo de destino</span><span class="sxs-lookup"><span data-stu-id="54673-361">**Figure 7** : Geometry using the modified lightness scaler with destination device black point</span></span>

<span data-ttu-id="54673-362">Para permitir que o algoritmo de compactação de croma subsequente prossiga, você deseja alinhar o máximo e o mínimo de lightnesses nos shells de origem e de destino.</span><span class="sxs-lookup"><span data-stu-id="54673-362">To allow the subsequent chroma compression algorithm to proceed, you want to align the maximum and minimum lightnesses on the source and destination shells.</span></span> <span data-ttu-id="54673-363">Isso pode ser feito ajustando o Shell de destino entre J <sub>neutralMin</sub> e j k ao deslocar pontos para a esquerda.</span><span class="sxs-lookup"><span data-stu-id="54673-363">This can be achieved by adjusting the destination shell between J <sub>neutralMin</sub> and J ₖ by shifting points to the left.</span></span> <span data-ttu-id="54673-364">Além disso, essa transformação deve ser aplicada em todo o espaço jab, não apenas no plano de matiz correspondente a h k.</span><span class="sxs-lookup"><span data-stu-id="54673-364">Furthermore, this transformation must be applied on the whole Jab space, not just the hue plane corresponding to h ₖ.</span></span>

<span data-ttu-id="54673-365">A transformação é</span><span class="sxs-lookup"><span data-stu-id="54673-365">The transformation is</span></span>

![Mostra a fórmula da transformação.](images/gmmp-seqfigure03.png)

<span data-ttu-id="54673-367">A Figura 8 mostra o efeito da transformação.</span><span class="sxs-lookup"><span data-stu-id="54673-367">Figure 8 shows the effect of the transformation.</span></span>

![Diagrama que mostra o efeito do dimensionador de claridade modificado com o ponto preto do dispositivo de destino.](images/gmmp-seqfigure04.png)

<span data-ttu-id="54673-369">**Figura 8** : geometria usando o dimensionador de claridade modificado com o ponto preto do dispositivo de destino</span><span class="sxs-lookup"><span data-stu-id="54673-369">**Figure 8** : Geometry using the modified lightness scaler with destination device black point</span></span>

<span data-ttu-id="54673-370">Depois de aplicar o algoritmo de compactação croma usual, o ponto deve ser "deslocado;" ou seja, a transformação inversa deve ser aplicada para obter a cor final mapeada.</span><span class="sxs-lookup"><span data-stu-id="54673-370">After applying the usual chroma compression algorithm, the point must then be "shifted back;" that is, the inverse transformation must be applied to obtain the final mapped color.</span></span>

![Mostra a fórmula da transformação inversa para obter a cor final mapeada.](images/gmmp-seqfigure05.png)

### <a name="the-case-of-dual-gamut-shells"></a><span data-ttu-id="54673-372">O caso de shells de gama dupla</span><span class="sxs-lookup"><span data-stu-id="54673-372">The case of dual gamut shells</span></span>

<span data-ttu-id="54673-373">O objetivo é generalizar o SIG \_ joelho para o Shell de gamut único para o caso em que o dispositivo de origem gbd ou o dispositivo de destino gbd tem uma estrutura de dois shells.</span><span class="sxs-lookup"><span data-stu-id="54673-373">The goal is to generalize SIG\_KNEE for single gamut shell to the case where either the source device GBD or the destination device GBD has a two-shell structure.</span></span> <span data-ttu-id="54673-374">O Shell interno será chamado de Shell de referência, enquanto o Shell externo será chamado de shell plausível.</span><span class="sxs-lookup"><span data-stu-id="54673-374">The inner shell will be called the Reference Shell, while the outer shell will be called the Plausible Shell.</span></span> <span data-ttu-id="54673-375">Você deseja considerar os casos a seguir.</span><span class="sxs-lookup"><span data-stu-id="54673-375">You want to consider the following cases.</span></span>

<span data-ttu-id="54673-376">(a) o GBD de origem e o GBD de destino têm uma estrutura de dois shells.</span><span class="sxs-lookup"><span data-stu-id="54673-376">(a) Both the source GBD and destination GBD have a two-shell structure.</span></span>

<span data-ttu-id="54673-377">(b) a fonte GBD tem uma estrutura de dois shells; o GBD de destino tem apenas um shell.</span><span class="sxs-lookup"><span data-stu-id="54673-377">(b) The source GBD has a two-shell structure; the destination GBD has only one shell.</span></span>

<span data-ttu-id="54673-378">(c) a fonte GBD tem apenas um shell; o GBD de destino tem uma estrutura de dois shells.</span><span class="sxs-lookup"><span data-stu-id="54673-378">(c) The source GBD has only one shell; the destination GBD has a two-shell structure.</span></span>

<span data-ttu-id="54673-379">(d) tanto o GBD de origem quanto o GBD de destino têm apenas um shell.</span><span class="sxs-lookup"><span data-stu-id="54673-379">(d) Both the source GBD and destination GBD have only one shell.</span></span>

<span data-ttu-id="54673-380">Case (d) é o caso de um único Shell de gamut que foi discutido anteriormente.</span><span class="sxs-lookup"><span data-stu-id="54673-380">Case (d) is the case of single gamut shell that was discussed previously.</span></span> <span data-ttu-id="54673-381">Para casos (a), (b) e (c), você pode generalizar o redimensionamento de claridade para usar as informações extras da estrutura de shell dupla.</span><span class="sxs-lookup"><span data-stu-id="54673-381">For cases (a), (b), and (c), you can generalize the lightness rescaling to use the extra information from the dual shell structure.</span></span> <span data-ttu-id="54673-382">Nos casos (b) e (c) em que a origem ou o destino tem apenas um shell, você introduz um "Shell de referência induzido" que será discutido em uma seção subsequente, "Shell de referência induzido".</span><span class="sxs-lookup"><span data-stu-id="54673-382">In cases (b) and (c) where either the source or the destination has only one shell, you introduce an "induced reference shell" which will be discussed in a subsequent section, "Induced Reference Shell."</span></span> <span data-ttu-id="54673-383">O algoritmo geral para dois shells será descrito para o caso (a).</span><span class="sxs-lookup"><span data-stu-id="54673-383">The general algorithm for two shells will be described for case (a).</span></span> <span data-ttu-id="54673-384">Depois que a construção do Shell de referência induzida é explicada, o algoritmo também pode ser aplicado a Case (b) e (c).</span><span class="sxs-lookup"><span data-stu-id="54673-384">After the Induced Reference Shell construction is explained, the algorithm can be applied to case (b) and (c), as well.</span></span> <span data-ttu-id="54673-385">Para a compactação croma, a taxa de compactação será determinada pelos maiores shells disponíveis.</span><span class="sxs-lookup"><span data-stu-id="54673-385">As for chroma compression, the compression ratio will be determined by the largest shells available.</span></span> <span data-ttu-id="54673-386">Em outras palavras, se o Shell plausível e o Shell de referência estiverem disponíveis, o Shell plausível será usado; caso contrário, o Shell de referência será usado.</span><span class="sxs-lookup"><span data-stu-id="54673-386">In other words, if both the Plausible Shell and Reference Shell are available, the Plausible Shell will be used; otherwise, the Reference Shell will be used.</span></span>

<span data-ttu-id="54673-387">*Redimensionamento de luminosidade generalizado*</span><span class="sxs-lookup"><span data-stu-id="54673-387">*Generalized Lightness Rescaling*</span></span>

<span data-ttu-id="54673-388">A existência de dois shells para GBD de origem e de destino significa que você deve mapear um conjunto de quatro pontos do GBD de origem para um conjunto correspondente no GBD de destino.</span><span class="sxs-lookup"><span data-stu-id="54673-388">The existence of two shells for both source and destination GBD means that you must map a set of four points from the source GBD to a corresponding set in the destination GBD.</span></span>

![Mostra como mapear um conjunto de quatro pontos para um conjunto correspondente.](images/gmmp-image030.png)

<span data-ttu-id="54673-390">Os subscritos têm os seguintes significados.</span><span class="sxs-lookup"><span data-stu-id="54673-390">The subscripts have the following meanings.</span></span>

<span data-ttu-id="54673-391">o ou r: "original" (origem) ou "reprodução" (destino)</span><span class="sxs-lookup"><span data-stu-id="54673-391">o or r: "original" (source) or "reproduction" (destination)</span></span>

<span data-ttu-id="54673-392">min ou Max: claridade mínima neutra ou claridade máxima neutra</span><span class="sxs-lookup"><span data-stu-id="54673-392">min or max: minimum neutral lightness or maximum neutral lightness</span></span>

<span data-ttu-id="54673-393">PLA ou ref: Shell plausível ou Shell de referência</span><span class="sxs-lookup"><span data-stu-id="54673-393">pla or ref: Plausible Shell or Reference Shell</span></span>

<span data-ttu-id="54673-394">A ordenação em cada quádruplo também é a magnitude relativa esperada desses pontos.</span><span class="sxs-lookup"><span data-stu-id="54673-394">The ordering in each quadruple is also the expected relative magnitude of these points.</span></span>

<span data-ttu-id="54673-395">O mapa de redimensionamento de claridade usa as mesmas primeiras equações que o Shell único, mas *J S* é definida de forma piecewise da seguinte maneira.</span><span class="sxs-lookup"><span data-stu-id="54673-395">The Lightness Rescaling map uses the same first two equations as the single shell, but *J S* is defined in a piecewise manner as follows.</span></span>

![Mostra a fórmula para J S de uma maneira piecewise.](images/gmmp-image032.png) <span data-ttu-id="54673-397">(7)</span><span class="sxs-lookup"><span data-stu-id="54673-397">(7)</span></span>

<span data-ttu-id="54673-398">Em outras palavras, ele é sigmoidal dentro do Shell de referência e linear externo.</span><span class="sxs-lookup"><span data-stu-id="54673-398">In other words, it is sigmoidal within the reference shell, and linear outside.</span></span> <span data-ttu-id="54673-399">Consulte a Figura 9.</span><span class="sxs-lookup"><span data-stu-id="54673-399">See Figure 9.</span></span>

![Diagrama que mostra um grafo para a função de redimensionamento de claridade para GBDs de dois shells.](images/gmmp-image033.png)

<span data-ttu-id="54673-401">**Figura 9** : função de redimensionamento de luminosidade para GBDs de dois shells</span><span class="sxs-lookup"><span data-stu-id="54673-401">**Figure 9** : Lightness Rescaling function for two-shell GBDs</span></span>

<span data-ttu-id="54673-402">**SHELL DE REFERÊNCIA INDUZIDO**</span><span class="sxs-lookup"><span data-stu-id="54673-402">**INDUCED REFERENCE SHELL**</span></span>

<span data-ttu-id="54673-403">Onde um GBD tem um shell e o outro GBD tem dois shells, você deve criar um "Shell de referência" para o GBD com apenas um shell.</span><span class="sxs-lookup"><span data-stu-id="54673-403">Where one GBD has one shell and the other GBD has two shells, you must create a "Reference Shell" for the GBD with only one shell.</span></span> <span data-ttu-id="54673-404">O Shell existente, que seria chamado de Shell de referência, será alterado para o "Shell plausível". Na verdade, você não precisa realmente criar um shell no espaço completo do jab.</span><span class="sxs-lookup"><span data-stu-id="54673-404">The existing shell, which would be called the Reference Shell, will be changed to the "Plausible Shell."In fact, you don't actually have to create a shell in the full Jab space.</span></span> <span data-ttu-id="54673-405">Como o redimensionamento de claridade usa apenas *j Max* e *j min*, você só precisa criar esses valores para o Shell de referência induzido.</span><span class="sxs-lookup"><span data-stu-id="54673-405">Because the lightness rescaling only uses *J max* and *J min*, you only have to make up these values for the induced Reference Shell.</span></span> <span data-ttu-id="54673-406">Há dois casos, dependendo de qual GBD tem dois shells.</span><span class="sxs-lookup"><span data-stu-id="54673-406">There are two cases, depending on which GBD has two shells.</span></span>

<span data-ttu-id="54673-407">Caso 1: Source GBD tem dois shells; o GBD de destino tem um shell.</span><span class="sxs-lookup"><span data-stu-id="54673-407">Case 1: Source GBD has two shells; destination GBD has one shell.</span></span>

<span data-ttu-id="54673-408">Determinar o Shell de referência induzido de destino no eixo neutro; ou seja, J <sub>r, \ min, \ ref</sub> e J <sub>r, \ Max, \ ref</sub> do Shell.</span><span class="sxs-lookup"><span data-stu-id="54673-408">Determine the destination induced Reference Shell on the neutral axis; that is, the J <sub>r,\ min,\ ref</sub> and J <sub>r,\ max,\ ref</sub> of the shell.</span></span> <span data-ttu-id="54673-409">Isso é feito usando o algoritmo a seguir.</span><span class="sxs-lookup"><span data-stu-id="54673-409">This is done using the following algorithm.</span></span>

![Mostra o algoritmo para determinar o Shell de referência induzido de destino.](images/gmmp-induced01.png)

<span data-ttu-id="54673-411">Os fatores?</span><span class="sxs-lookup"><span data-stu-id="54673-411">The factors ?</span></span> <span data-ttu-id="54673-412"><sub>baixa</sub> e?</span><span class="sxs-lookup"><span data-stu-id="54673-412"><sub>low</sub> and ?</span></span> <span data-ttu-id="54673-413">controle <sub>alto</sub> a separação entre o Shell plausível e o Shell de referência.</span><span class="sxs-lookup"><span data-stu-id="54673-413"><sub>high</sub> control the separation between the Plausible Shell and the Reference Shell.</span></span> <span data-ttu-id="54673-414">Um valor de 1 significa que os valores J <sub>min</sub> ou j m ₐ ₓ coincidem.</span><span class="sxs-lookup"><span data-stu-id="54673-414">A value of 1 means that the J <sub>min</sub> values or J ₘₐₓ values coincide.</span></span> <span data-ttu-id="54673-415">Seus valores são "induzidos" do Shell de referência de origem e do Shell plausível de origem.</span><span class="sxs-lookup"><span data-stu-id="54673-415">Their values are "induced" from the source Reference Shell and source Plausible Shell.</span></span>

![Mostra a fórmula para os valores do Shell de referência de origem e o Shell plausível de origem.](images/gmmp-induced02.png)

<span data-ttu-id="54673-417">Os "fatores adequações" F <sub>baixo</sub> e f <sub>alto</sub> são *parâmetros ajustáveis* que devem estar entre 0 e 1.</span><span class="sxs-lookup"><span data-stu-id="54673-417">The "fudge factors" F <sub>low</sub> and F <sub>high</sub> are *tunable parameters* that must lie between 0 and 1.</span></span> <span data-ttu-id="54673-418">Se o valor for 0, os ₓ de ₐ J <sub>min</sub> ou j m serão induzidos diretamente dos shells de origem.</span><span class="sxs-lookup"><span data-stu-id="54673-418">If the value is 0, then the J <sub>min</sub> or J ₘₐₓ are directly induced from the source shells.</span></span> <span data-ttu-id="54673-419">Para esse caso, escolha F <sub>Low</sub> = 0,95 e f <sub>High</sub> = 0,1.</span><span class="sxs-lookup"><span data-stu-id="54673-419">For this case, choose F <sub>low</sub> = 0.95, and F <sub>high</sub> = 0.1.</span></span>

<span data-ttu-id="54673-420">Caso 2: o GBD de origem tem um shell; o GBD de destino tem dois shells.</span><span class="sxs-lookup"><span data-stu-id="54673-420">Case 2: Source GBD has one shell; destination GBD has two shells.</span></span>

<span data-ttu-id="54673-421">Determinar o Shell de referência induzido de origem no eixo neutro; ou seja, a J o <sub>, \ min, \ ref</sub> e J <sub>o, \ Max, \ ref</sub> do Shell.</span><span class="sxs-lookup"><span data-stu-id="54673-421">Determine the source induced Reference Shell on the neutral axis; that is, the J <sub>o,\ min,\ ref</sub> and J <sub>o,\ max,\ ref</sub> of the shell.</span></span> <span data-ttu-id="54673-422">Isso é feito usando o algoritmo a seguir.</span><span class="sxs-lookup"><span data-stu-id="54673-422">This is done using the following algorithm.</span></span>

![Mostra o algoritmo para determinar o Shell de referência induzido de destino no eixo neutro.](images/gmmp-induced03.png)

<span data-ttu-id="54673-424">Mais uma vez, os fatores?</span><span class="sxs-lookup"><span data-stu-id="54673-424">Again, the factors ?</span></span> <span data-ttu-id="54673-425"><sub>baixa</sub> e?</span><span class="sxs-lookup"><span data-stu-id="54673-425"><sub>low</sub> and ?</span></span> <span data-ttu-id="54673-426">controle <sub>alto</sub> a separação entre o Shell plausível e o Shell de referência.</span><span class="sxs-lookup"><span data-stu-id="54673-426"><sub>high</sub> control the separation between the Plausible Shell and Reference Shell.</span></span> <span data-ttu-id="54673-427">Um valor de 1 significa que os valores J <sub>min</sub> ou j m ₐ ₓ coincidem.</span><span class="sxs-lookup"><span data-stu-id="54673-427">A value of 1 means the J <sub>min</sub> values or J ₘₐₓ values coincide.</span></span> <span data-ttu-id="54673-428">Seus valores são "induzidos" do Shell de referência de origem e do Shell plausível de origem:</span><span class="sxs-lookup"><span data-stu-id="54673-428">Their values are "induced" from the source Reference Shell and source Plausible Shell:</span></span>

![Mostra o algoritmo para controlar a separação entre o Shell de referência e o Shell plausível de origem.](images/gmmp-induced04.png)

### <a name="reasons-for-changes-from-the-cie-tc8-03-recommendations"></a><span data-ttu-id="54673-430">Motivos para alterações das recomendações de CIE TC8-03</span><span class="sxs-lookup"><span data-stu-id="54673-430">Reasons for changes from the CIE TC8-03 recommendations</span></span>

<span data-ttu-id="54673-431">O BasicPhoto difere das recomendações de CIE TC8-03 das seguintes maneiras.</span><span class="sxs-lookup"><span data-stu-id="54673-431">BasicPhoto differs from the CIE TC8-03 recommendations in the following ways.</span></span>

1.  <span data-ttu-id="54673-432">Croma não é compactado em direção a Cusp, mas junto com as linhas de luminosidade constante.</span><span class="sxs-lookup"><span data-stu-id="54673-432">Chroma is not compressed toward the cusp but along lines of constant lightness.</span></span>
2.  <span data-ttu-id="54673-433">O intervalo de claridade usa a claridade da cor mais escura na gama, em vez do ponto em que o limite de gama cruza o eixo neutro.</span><span class="sxs-lookup"><span data-stu-id="54673-433">The lightness range uses the lightness of the darkest color in the gamut rather than the point at which the gamut boundary crosses the neutral axis.</span></span>
3.  <span data-ttu-id="54673-434">O BasicPhoto dá suporte a um shell de gamut de referência e a um shell de gamut plausível, se o limite de gama na transformação tiver dois shells.</span><span class="sxs-lookup"><span data-stu-id="54673-434">BasicPhoto supports both a reference gamut shell and a plausible gamut shell, if either gamut boundary in the transform has two shells.</span></span>
4.  <span data-ttu-id="54673-435">BasicPhoto usa CIECAM02; em vez de usar CIECAM97s para converter para D65 em 400 cd/m2 e, em seguida, usar RIT XISTENTE de espaço de cores.</span><span class="sxs-lookup"><span data-stu-id="54673-435">BasicPhoto uses CIECAM02; instead of using CIECAM97s to convert to D65 at 400 cd/m2, and then using RIT IPT color space.</span></span>

<span data-ttu-id="54673-436">A primeira alteração foi feita para evitar problemas de inversão de Tom que podem ocorrer ao usar a compactação em direção a um Cusp.</span><span class="sxs-lookup"><span data-stu-id="54673-436">The first change was made to prevent tone inversion problems that can occur when using compression toward a cusp.</span></span> <span data-ttu-id="54673-437">Como mostra a Figura 10, a compactação Cusp pode causar inversões de Tom.</span><span class="sxs-lookup"><span data-stu-id="54673-437">As shown in Figure 10, cusp compression can cause tone inversions.</span></span> <span data-ttu-id="54673-438">Isso pode acontecer quando as cores de alta croma são mais claras que as cores de croma menores.</span><span class="sxs-lookup"><span data-stu-id="54673-438">This can happen when colors of high chroma are lighter than colors of lower chroma.</span></span> <span data-ttu-id="54673-439">Como o SGCK compacta cada pixel independentemente na claridade e croma, não é garantido preservar a relação de luminosidade entre os valores de pixel após a compactação.</span><span class="sxs-lookup"><span data-stu-id="54673-439">Because SGCK compresses each pixel independently in both lightness and chroma, it is not guaranteed to preserve the lightness relationship between the pixel values after the compression.</span></span> <span data-ttu-id="54673-440">A desvantagem bem conhecida dessa decisão de compactar as linhas da claridade constante é que você pode sofrer perdas de croma, em particular em áreas em que o limite de gama de destino é muito simples, como acontece com amarelos brilhantes.</span><span class="sxs-lookup"><span data-stu-id="54673-440">The well-known downside to this decision to compress on lines of constant lightness is that you can suffer losses of chroma, particular in areas where the destination gamut boundary is very flat, as happens with bright yellows.</span></span>

![Diagrama que mostra a inversão de Tom causada por SGCK.](images/gmmp-toneinversion.png)

<span data-ttu-id="54673-442">**Figura 10** : inversão de Tom causada por SGCK</span><span class="sxs-lookup"><span data-stu-id="54673-442">**Figure 10** : Tone inversion caused by SGCK</span></span>

![Mostra uma imagem original de um bule.](images/originalteapot.jpg)![Mostra o resultado de SGCK da imagem bule.](images/badteapot.jpg)![Mostra o resultado de BasicPhoto da imagem bule.](images/betterteapot.jpg)

<span data-ttu-id="54673-446">**Figura 11** : imagem original, resultado SGCK e resultado de BasicPhoto</span><span class="sxs-lookup"><span data-stu-id="54673-446">**Figure 11** : Original image, SGCK result, and BasicPhoto result</span></span>

<span data-ttu-id="54673-447">A Figura 11 ilustra essa inversão de Tom.</span><span class="sxs-lookup"><span data-stu-id="54673-447">Figure 11 illustrates this tone inversion.</span></span> <span data-ttu-id="54673-448">À esquerda, está uma imagem original capturada por uma câmera digital; no centro, a imagem é reproduzida por SGCK; e à direita, a imagem é reproduzida pelo BasicPhoto.</span><span class="sxs-lookup"><span data-stu-id="54673-448">On the left is an original image captured by a digital camera; in the center, the image as reproduced by SGCK; and on the right, the image as reproduced by BasicPhoto.</span></span> <span data-ttu-id="54673-449">A imagem à esquerda está no espaço de cores da câmera digital, as imagens central e direita estão no espaço de cores de uma tela de vídeo LCD.</span><span class="sxs-lookup"><span data-stu-id="54673-449">The image on the left is in the digital camera's color space, the center and right images are in the color space of an LCD video display.</span></span> <span data-ttu-id="54673-450">Na imagem original, a parte superior do bule é mais escura que a parte inferior, pois a parte inferior está refletindo a toalha de que está sentado.</span><span class="sxs-lookup"><span data-stu-id="54673-450">In the original image, the top part of the teapot is darker than the bottom, because the bottom is reflecting the tablecloth that it is sitting upon.</span></span> <span data-ttu-id="54673-451">Na imagem SGCK, a parte superior é realmente mais clara do que a inferior, devido à inversão de Tom.</span><span class="sxs-lookup"><span data-stu-id="54673-451">In the SGCK image, the top part is actually lighter than the bottom, because of the tone inversion.</span></span> <span data-ttu-id="54673-452">Além disso, é difícil ver os itens refletidos na parte inferior do bule.</span><span class="sxs-lookup"><span data-stu-id="54673-452">Also, it is difficult to see the items reflected in the lower part of the teapot.</span></span> <span data-ttu-id="54673-453">À direita, BasicPhoto corrigiu a inversão de Tom e os artigos refletidos são mais claramente distinguíveis.</span><span class="sxs-lookup"><span data-stu-id="54673-453">On the right, BasicPhoto has fixed the tone inversion and the reflected articles are more clearly distinguishable.</span></span>

<span data-ttu-id="54673-454">A segunda alteração foi feita para melhorar a reprodução de cores quase pretas em impressoras em que o preto Blackest não se enquadra diretamente no eixo neutro CIECAM02.</span><span class="sxs-lookup"><span data-stu-id="54673-454">The second change was made to improve the reproduction of nearly black colors on printers where the blackest black does not fall directly on the CIECAM02 neutral axis.</span></span> <span data-ttu-id="54673-455">A Figura 12 a seguir mostra uma imagem convertida em sRGB; reproduzida para uma impressora de jato de Inkjet RGB usando SGCK; e reproduzida para a mesma impressora usando BasicPhoto.</span><span class="sxs-lookup"><span data-stu-id="54673-455">The following Figure 12 shows an image converted to sRGB; reproduced for an RGB inkjet printer using SGCK; and reproduced for the same printer using BasicPhoto.</span></span> <span data-ttu-id="54673-456">A imagem no centro não está usando o dispositivo completo preto e, portanto, falta o contraste visto no original.</span><span class="sxs-lookup"><span data-stu-id="54673-456">The image in the center is not using the full device black, and so it lacks the contrast seen in the original.</span></span> <span data-ttu-id="54673-457">O contraste é restaurado com BasicPhoto.</span><span class="sxs-lookup"><span data-stu-id="54673-457">The contrast is restored with BasicPhoto.</span></span>

![Mostra a imagem original de um playset.](images/playstructure.jpg)![Mostra a imagem do playset reproduzida para uma impressora de jato de impressão R G B usando SGCK.](images/playstructurebad.jpg)![Mostra a imagem do playset reproduzida para uma impressora de jato de impressão R G B usando BasicPhoto.](images/betterplaystructure.jpg)

<span data-ttu-id="54673-461">**Figura 12** : preto aprimorado</span><span class="sxs-lookup"><span data-stu-id="54673-461">**Figure 12** : Enhanced black</span></span>

<span data-ttu-id="54673-462">A terceira alteração foi feita para melhorar a reprodução de cores para câmeras digitais.</span><span class="sxs-lookup"><span data-stu-id="54673-462">The third change was made to improve the color reproduction for digital cameras.</span></span> <span data-ttu-id="54673-463">Particularmente em casos em que a câmera digital tiver sido criada com o uso de um destino de referência, uma descrição de limite de gama criada com base em cores medidas pode não incluir todas as cores que podem ser capturadas em uma cena do mundo real.</span><span class="sxs-lookup"><span data-stu-id="54673-463">Particularly in cases where the digital camera has been profiled using a reference target, a gamut boundary description built from measured colors might not include all the colors that might be captured in a real world scene.</span></span> <span data-ttu-id="54673-464">Em vez de recortar todas as cores na gama do destino de cor medido, você permite que a extrapolação produza um limite de gamut plausível.</span><span class="sxs-lookup"><span data-stu-id="54673-464">Rather than clipping all colors to the gamut of the measured color target, you allow for extrapolation to produce a plausible gamut boundary.</span></span> <span data-ttu-id="54673-465">O algoritmo BasicPhoto foi projetado para dar suporte a tal limite de gama extrapolado.</span><span class="sxs-lookup"><span data-stu-id="54673-465">The BasicPhoto algorithm is designed to support such an extrapolated gamut boundary.</span></span>

<span data-ttu-id="54673-466">A quarta alteração foi feita porque CIECAM02 funciona bem para o mapeamento de gamut.</span><span class="sxs-lookup"><span data-stu-id="54673-466">The fourth change was made because CIECAM02 works well for gamut mapping.</span></span> <span data-ttu-id="54673-467">O processo recomendado pelo TC8-03 de converter as cores do dispositivo para o D65 em 400 cd/m2 e, em seguida, usar o espaço de cores RIT XISTENTE é de computação intensiva e demorada.</span><span class="sxs-lookup"><span data-stu-id="54673-467">The process recommended by TC8-03 of converting device colors to D65 at 400 cd/m2, and then using the RIT IPT color space is both computation-intensive and time-consuming.</span></span>

### <a name="hue-mapping"></a><span data-ttu-id="54673-468">Mapeamento de matiz</span><span class="sxs-lookup"><span data-stu-id="54673-468">Hue mapping</span></span>

<span data-ttu-id="54673-469">HueMap é o equivalente à intenção de saturação de ICC.</span><span class="sxs-lookup"><span data-stu-id="54673-469">HueMap is the equivalent of the ICC Saturation intent.</span></span>

<span data-ttu-id="54673-470">Se o limite de gamut de origem ou o limite de gama de destino não contiver primárias, esse modelo será revertido para o modelo MinCD (relativo) descrito em uma seção anterior; por exemplo, dispositivos para os quais os primários não podem ser determinados (perfis ICC com mais de quatro canais) ou perfis ICC monocromáticos.</span><span class="sxs-lookup"><span data-stu-id="54673-470">If either the source gamut boundary or the destination gamut boundary does not contain primaries, this model reverts to the MinCD (relative) model described in a preceding section; for example, devices for which the primaries cannot be determined (ICC profiles with more than four channels) or monochrome ICC profiles.</span></span>

<span data-ttu-id="54673-471">Esse algoritmo primeiro ajusta o matiz do valor de cor de entrada.</span><span class="sxs-lookup"><span data-stu-id="54673-471">This algorithm first adjusts the hue of the input color value.</span></span> <span data-ttu-id="54673-472">Em seguida, ele ajusta simultaneamente a claridade e a croma, usando um mapeamento de distorção.</span><span class="sxs-lookup"><span data-stu-id="54673-472">Then it simultaneously adjusts the lightness and chroma, using a shearing mapping.</span></span> <span data-ttu-id="54673-473">Por fim, ele corta o valor de cor para ter certeza de que ele está dentro do gamut.</span><span class="sxs-lookup"><span data-stu-id="54673-473">Finally, it clips color value to make sure it is within gamut.</span></span>

<span data-ttu-id="54673-474">A primeira etapa é determinar as "rodas de matiz".</span><span class="sxs-lookup"><span data-stu-id="54673-474">The first step is to determine the "Hue Wheels."</span></span> <span data-ttu-id="54673-475">Localize os valores de JCh para as cores primária e secundária para o dispositivo de origem e de destino.</span><span class="sxs-lookup"><span data-stu-id="54673-475">Find the JCh values for primary and secondary colors for both source and destination device.</span></span> <span data-ttu-id="54673-476">Você está considerando apenas os componentes de matiz.</span><span class="sxs-lookup"><span data-stu-id="54673-476">You are only considering the hue components.</span></span> <span data-ttu-id="54673-477">Isso resulta em uma roda de matiz primária ou secundária com seis pontos de cor para cada dispositivo.</span><span class="sxs-lookup"><span data-stu-id="54673-477">This results in a primary or secondary hue wheel with six color points for each device.</span></span> <span data-ttu-id="54673-478">(Veja a Figura 13.)</span><span class="sxs-lookup"><span data-stu-id="54673-478">(See Figure 13.)</span></span>

![Diagrama que mostra as rodas de matiz com seis pontos de cor.](images/gmmp-figure12.png)

<span data-ttu-id="54673-480">**Figura 13** : rodas de matiz</span><span class="sxs-lookup"><span data-stu-id="54673-480">**Figure 13** : Hue wheels</span></span>

<span data-ttu-id="54673-481">Melhores resultados poderão ser obtidos se a fonte primária azul não for girada para o destino azul primário.</span><span class="sxs-lookup"><span data-stu-id="54673-481">Better results can be obtained if the source blue primary is not rotated to the destination blue primary.</span></span> <span data-ttu-id="54673-482">Em vez disso, o ângulo de matiz primário de origem azul é usado como o ângulo de matiz primário de destino.</span><span class="sxs-lookup"><span data-stu-id="54673-482">Instead, the source blue primary hue angle is used as the destination blue primary hue angle.</span></span>

<span data-ttu-id="54673-483">Em seguida, execute as rotações de matiz para cada cor de entrada da imagem de origem,</span><span class="sxs-lookup"><span data-stu-id="54673-483">Next, perform the hue rotations for each input color from the source image,</span></span>

<span data-ttu-id="54673-484">a) usando o ângulo de matiz da cor de entrada, determine o local da cor na roda de matiz de origem em relação às duas cores primárias ou secundárias adjacentes.</span><span class="sxs-lookup"><span data-stu-id="54673-484">a)Using the hue angle of the input color, determine the location of the color on the source hue wheel relative to the two adjacent primary or secondary color.</span></span> <span data-ttu-id="54673-485">O local pode ser considerado como uma porcentagem da distância entre os primários.</span><span class="sxs-lookup"><span data-stu-id="54673-485">The location can be thought of as a percentage of the distance between the primaries.</span></span> <span data-ttu-id="54673-486">Por exemplo, o matiz da cor de entrada é de 40% do caminho do valor de matiz de magenta para o valor de matiz de vermelho.</span><span class="sxs-lookup"><span data-stu-id="54673-486">For example, the input color hue is 40 percent of the way from the hue value of Magenta to the hue value of Red.</span></span>

<span data-ttu-id="54673-487">b) na roda de matiz de destino, localize o ângulo de matiz associado, por exemplo, 40 por cento de magenta para vermelho.</span><span class="sxs-lookup"><span data-stu-id="54673-487">b)On the destination hue wheel, find the associated hue angle, for example, 40 percent from Magenta to Red.</span></span> <span data-ttu-id="54673-488">Esse valor será o ângulo de matiz de destino.</span><span class="sxs-lookup"><span data-stu-id="54673-488">This value will be the destination hue angle.</span></span>

<span data-ttu-id="54673-489">Em geral, os primários de origem e os secundários não estarão nos mesmos ângulos de matiz que os primários de destino e secundários; ou seja, o ângulo de matiz de destino geralmente será diferente do ângulo de matiz de origem.</span><span class="sxs-lookup"><span data-stu-id="54673-489">In general, the source primaries and secondaries will not be at the same hue angles as the destination primaries and secondaries; that is, the destination hue angle usually will be different from the source hue angle.</span></span>

<span data-ttu-id="54673-490">Por exemplo, suponha que as rodas de matiz produzam os seguintes valores:</span><span class="sxs-lookup"><span data-stu-id="54673-490">For example, suppose the hue wheels produce the following values:</span></span>

<span data-ttu-id="54673-491">Origem M = 295 graus, fonte R = 355 graus.</span><span class="sxs-lookup"><span data-stu-id="54673-491">Source M = 295 degrees, Source R = 355 degrees.</span></span>

<span data-ttu-id="54673-492">Destino M = 290 graus, destino R = 346 graus.</span><span class="sxs-lookup"><span data-stu-id="54673-492">Destination M = 290 degrees, Destination R = 346 degrees.</span></span>

<span data-ttu-id="54673-493">Se o ângulo de matiz da cor de entrada for de 319 graus, será 40% do ângulo (24 graus) da origem M para o R de origem. O ângulo de M para R é de 60 graus e o ângulo de M para inserir matiz é de 24 graus.</span><span class="sxs-lookup"><span data-stu-id="54673-493">If the hue angle of the input color is 319 degrees, it is 40 percent of the angle (24 degrees) from source M to source R. The angle from M to R is 60 degrees, and the angle from M to input hue is 24 degrees.</span></span> <span data-ttu-id="54673-494">Calcule o ângulo no destino que é de 40% do destino M para o R de destino (22 graus), portanto, o ângulo de matiz da cor de destino é de 312 graus.</span><span class="sxs-lookup"><span data-stu-id="54673-494">Calculate the angle on the destination that is 40 percent from destination M to destination R (22 degrees), so the hue angle of the destination color is 312 degrees.</span></span>

<span data-ttu-id="54673-495">Em seguida, calcule os pontos de referência de matiz para o matiz de origem e o matiz de destino.</span><span class="sxs-lookup"><span data-stu-id="54673-495">Next, calculate the hue reference points for the source hue and the destination hue.</span></span> <span data-ttu-id="54673-496">Para calcular o ponto de referência de matiz para um valor de h (matiz) específico, você deseja localizar o valor de J (claridade) e de C (croma).</span><span class="sxs-lookup"><span data-stu-id="54673-496">To calculate the hue reference point for a particular h (hue) value, you want to find the J (lightness) value and C (chroma) value.</span></span>

-   <span data-ttu-id="54673-497">Localize o valor J do ponto de referência de matiz interpolando entre os valores J para os pontos primários ou secundários adjacentes, usando a posição relativa do matiz; por exemplo, 40 por cento neste exemplo.</span><span class="sxs-lookup"><span data-stu-id="54673-497">Find the J value of the hue reference point by interpolating between the J values for the adjacent primary or secondary points, using the relative position of the hue; for example, 40 percent in this example.</span></span>
-   <span data-ttu-id="54673-498">Localize o valor de C máximo nesse valor J e no valor h.</span><span class="sxs-lookup"><span data-stu-id="54673-498">Find the maximum C value at this J value and h value.</span></span> <span data-ttu-id="54673-499">Agora você tem o JCh do ponto de referência de matiz para esse matiz.</span><span class="sxs-lookup"><span data-stu-id="54673-499">You now have the JCh of the hue reference point for that hue.</span></span>

![Diagrama que mostra uma folha de matiz.](images/gmmp-figure13.png)

<span data-ttu-id="54673-501">**Figura 14** : uma folha de matiz (visualização de uma fatia de limite de gamut em um matiz específico)</span><span class="sxs-lookup"><span data-stu-id="54673-501">**Figure 14** : A hue leaf (visualization of a gamut boundary slice at a specific hue)</span></span>

<span data-ttu-id="54673-502">A próxima etapa é computar o mapeamento de distorção para cada pixel.</span><span class="sxs-lookup"><span data-stu-id="54673-502">The next step is to compute the shear mapping for each pixel.</span></span> <span data-ttu-id="54673-503">Primeiro, visualize uma folha de matiz da gama de origem para o ângulo de matiz da cor de origem e uma folha de matiz da gama de destino para o ângulo de matiz de destino calculado durante a rotação de matiz.</span><span class="sxs-lookup"><span data-stu-id="54673-503">First, visualize a hue leaf from the source gamut for the source color hue angle, and a hue leaf from the destination gamut for the destination hue angle computed during hue rotation.</span></span> <span data-ttu-id="54673-504">As folhas de matiz são criadas por meio de uma "fatia" da superfície de limite de gama de JCh em um ângulo de matiz específico (consulte a Figura 14).</span><span class="sxs-lookup"><span data-stu-id="54673-504">The hue leaves are created by taking a "slice" from the JCh gamut boundary surface at a specific hue angle (see Figure 14).</span></span>

<span data-ttu-id="54673-505">Observação: para fins de otimização de desempenho, as folhas de matiz não são realmente criadas; Eles são descritos e mostrados aqui apenas para fins de visualização.</span><span class="sxs-lookup"><span data-stu-id="54673-505">NOTE: For performance optimization reasons, hue leaves are not actually created; they are described and shown here for visualization purposes only.</span></span> <span data-ttu-id="54673-506">As operações são executadas diretamente na superfície de limite da gama no matiz especificado.</span><span class="sxs-lookup"><span data-stu-id="54673-506">The operations are performed directly on the gamut boundary surface at the specified hue.</span></span> <span data-ttu-id="54673-507">Em seguida, você computa os pontos de referência de matiz para determinar o mapeamento de distorção.</span><span class="sxs-lookup"><span data-stu-id="54673-507">You then compute the hue reference points to determine the shear mapping.</span></span>

-   <span data-ttu-id="54673-508">Execute um redimensionamento de claridade para mapear os pontos pretos e brancos da folha de origem para a folha de destino (veja a Figura 15).</span><span class="sxs-lookup"><span data-stu-id="54673-508">Perform a lightness rescaling to map the black and white points of the source leaf to the destination leaf (see Figure 15).</span></span> <span data-ttu-id="54673-509">Os pontos pretos e brancos da folha de matiz de origem são mapeados linearmente para os pontos pretos e brancos da folha de matiz de destino, dimensionando todas as coordenadas J do limite de origem.</span><span class="sxs-lookup"><span data-stu-id="54673-509">The black and white points of the source hue leaf are mapped linearly to the black and white points of the destination hue leaf, by scaling all the J coordinates of the source boundary.</span></span> <span data-ttu-id="54673-510">O valor de cor de entrada mapeada para matiz é dimensionado da mesma maneira.</span><span class="sxs-lookup"><span data-stu-id="54673-510">The hue-mapped input color value is scaled in the same manner.</span></span>

![Diagrama que mostra o mapeamento de claridade.](images/gmmp-figure14.png)

<span data-ttu-id="54673-512">**Figura 15** : mapeamento de luminosidade</span><span class="sxs-lookup"><span data-stu-id="54673-512">**Figure 15** : Lightness mapping</span></span>

-   <span data-ttu-id="54673-513">Determine os pontos de referência de matiz para cada folha de matiz.</span><span class="sxs-lookup"><span data-stu-id="54673-513">Determine the hue reference points for each hue leaf.</span></span> <span data-ttu-id="54673-514">Aplique um mapeamento de distorção à folha de origem para que os pontos de referência de origem e destino coincidam (consulte a Figura 16).</span><span class="sxs-lookup"><span data-stu-id="54673-514">Apply a shear mapping to the source leaf so that the source and destination reference points coincide (see Figure 16).</span></span> <span data-ttu-id="54673-515">O ponto de referência para uma gama em um matiz específico é o ponto de referência de matiz interpolado entre os primários adjacentes.</span><span class="sxs-lookup"><span data-stu-id="54673-515">The reference point for a gamut at a specific hue is the interpolated hue reference point between the adjacent primaries.</span></span> <span data-ttu-id="54673-516">O ponto de referência da folha de matiz de origem é mapeado linearmente para o ponto de referência da folha de matiz de destino, usando uma operação de "distorção" que bloqueia o eixo J, mantendo os pontos pretos e os pontos brancos fixos.</span><span class="sxs-lookup"><span data-stu-id="54673-516">The reference point of the source hue leaf is mapped linearly to the reference point of the destination hue leaf, using a "shear" operation that locks the J axis, keeping the black points and the white points stationary.</span></span> <span data-ttu-id="54673-517">Os pontos pretos, os pontos brancos e os pontos de referência das folhas de matiz de origem e de destino devem coincidir.</span><span class="sxs-lookup"><span data-stu-id="54673-517">The black points, white points, and reference points of the source and destination hue leaves should coincide.</span></span>
-   <span data-ttu-id="54673-518">Aplique o mapeamento de distorção ao valor de cor de entrada com ajuste de luminosidade.</span><span class="sxs-lookup"><span data-stu-id="54673-518">Apply the shear mapping to the lightness-adjusted input color value.</span></span> <span data-ttu-id="54673-519">As coordenadas J e C do valor da cor de origem são proporcionalmente dimensionadas, em relação à sua distância do eixo J.</span><span class="sxs-lookup"><span data-stu-id="54673-519">The J and C coordinates of the source color value are proportionally scaled, relative to its distance from the J axis.</span></span>
-   <span data-ttu-id="54673-520">Em seguida, uma compactação sutil dependente de croma em direção ao J-Value do ponto de referência de matiz é executada no ponto de cores mapeado para distorção.</span><span class="sxs-lookup"><span data-stu-id="54673-520">Next, a subtle chroma-dependent lightness compression toward the J-value of the hue reference point is performed on the shear-mapped color point.</span></span> <span data-ttu-id="54673-521">A compactação para referência de matiz J é feita de maneira semelhante a gama, em que branco, preto, cinza e pontos na referência de matiz J não são afetados.</span><span class="sxs-lookup"><span data-stu-id="54673-521">The compression toward hue reference J is done in a gamma-like fashion, where white, black, grays, and points on the hue reference J are not affected.</span></span> <span data-ttu-id="54673-522">Todos os outros pontos tendem a fazer a referência de matiz J de maneira suave, o que é um pouco próximo da referência de matiz J, com constante croma restante.</span><span class="sxs-lookup"><span data-stu-id="54673-522">All other points tend toward the hue reference J in a smooth fashion, slightly bunching up near the hue reference J, with chroma remaining constant.</span></span> <span data-ttu-id="54673-523">A dependência croma garante que as cores neutras não sejam afetadas e que o efeito seja aumentado em cores com croma maiores.</span><span class="sxs-lookup"><span data-stu-id="54673-523">The chroma dependency assures that neutral colors are not affected, and the effect is increased on colors with higher chroma.</span></span>

<span data-ttu-id="54673-524">Veja a seguir uma descrição matemática da compactação de claridade em direção à referência de matiz J ou ajuste do J-Value do ponto de destino.</span><span class="sxs-lookup"><span data-stu-id="54673-524">The following is a mathematical description of the lightness compression toward the hue reference J, or adjusting the J-value of the destination point.</span></span> <span data-ttu-id="54673-525">Ele é chamado de ponto de destino porque foi mapeado para a gama de destino.</span><span class="sxs-lookup"><span data-stu-id="54673-525">It is called the destination point because it has been shear mapped into the destination gamut.</span></span>

<span data-ttu-id="54673-526">Primeiro, COMPUTE "factorC" (fator de dependência croma) para o ponto de destino, que determina a quantidade de efeito que a compactação de claridade terá.</span><span class="sxs-lookup"><span data-stu-id="54673-526">First, compute "factorC" (chroma dependency factor) for the destination point, which determines how much effect the lightness compression will have.</span></span> <span data-ttu-id="54673-527">Pontos próximos ou no eixo J terão pouca ou nenhuma compactação; pontos distantes do eixo J (alta croma) terão mais compactação aplicada.</span><span class="sxs-lookup"><span data-stu-id="54673-527">Points near or on the J-axis will have little or no compression; points farther away from the J-axis (high-chroma) will have more compression applied.</span></span> <span data-ttu-id="54673-528">Multiplique por 0,5 para garantir que factorC seja menor que 1, porque é possível que sourceC possa ser um pouco maior do que referenceC, mas não duas vezes tão grande.</span><span class="sxs-lookup"><span data-stu-id="54673-528">Multiply by 0.5 to ensure that factorC is less than 1, because it is possible that sourceC could be slightly greater than referenceC, but not twice as great.</span></span>

<span data-ttu-id="54673-529">factorC = (destinationC/referenceC)?</span><span class="sxs-lookup"><span data-stu-id="54673-529">factorC = (destinationC / referenceC) ?</span></span> <span data-ttu-id="54673-530">0,5</span><span class="sxs-lookup"><span data-stu-id="54673-530">0.5</span></span>

<span data-ttu-id="54673-531">onde:</span><span class="sxs-lookup"><span data-stu-id="54673-531">where:</span></span>

<span data-ttu-id="54673-532">destinationC é o valor C do ponto de destino.</span><span class="sxs-lookup"><span data-stu-id="54673-532">destinationC is the C-value of the destination point.</span></span>

<span data-ttu-id="54673-533">referenceC é o valor C do ponto de referência de matiz.</span><span class="sxs-lookup"><span data-stu-id="54673-533">referenceC is the C-value of the Hue Reference point.</span></span>

<span data-ttu-id="54673-534">Em seguida, determine se o ponto de destino J está acima ou abaixo da referência de matiz J. Se estiver acima, faça o seguinte:</span><span class="sxs-lookup"><span data-stu-id="54673-534">Next, determine whether the destination point J is above or below the hue reference J. If it is above, do the following:</span></span>

1.  <span data-ttu-id="54673-535">Compute "factorJ" para o ponto de destino em relação ao referenceJ.</span><span class="sxs-lookup"><span data-stu-id="54673-535">Compute "factorJ" for the destination point relative to the referenceJ.</span></span> <span data-ttu-id="54673-536">Esse valor de factorJ estará entre 0 e 1 (0 se estiver no referenceJ; 1 se em maxJ).</span><span class="sxs-lookup"><span data-stu-id="54673-536">This factorJ value will be between 0 and 1 (0 if on the referenceJ; 1 if at maxJ).</span></span>
2.  <span data-ttu-id="54673-537">factorJ = (destinationJ-referenceJ)/(maxJ-referenceJ)</span><span class="sxs-lookup"><span data-stu-id="54673-537">factorJ = (destinationJ - referenceJ) / (maxJ - referenceJ)</span></span>

    <span data-ttu-id="54673-538">onde:</span><span class="sxs-lookup"><span data-stu-id="54673-538">where:</span></span>

    <span data-ttu-id="54673-539">destinationJ é o J-Value do ponto de destino.</span><span class="sxs-lookup"><span data-stu-id="54673-539">destinationJ is the J-value of the destination point.</span></span>

    <span data-ttu-id="54673-540">referenceJ é o J-Value do ponto de referência de matiz.</span><span class="sxs-lookup"><span data-stu-id="54673-540">referenceJ is the J-value of the hue reference point.</span></span>

    <span data-ttu-id="54673-541">maxJ é o valor J máximo da gama.</span><span class="sxs-lookup"><span data-stu-id="54673-541">maxJ is the maximum J-value of the gamut.</span></span>

3.  <span data-ttu-id="54673-542">Aplique uma função de energia do tipo gama ao factorJ, o que reduzirá o factorJ por um determinado valor.</span><span class="sxs-lookup"><span data-stu-id="54673-542">Apply a gamma-like power function to factorJ, which will reduce factorJ by a certain amount.</span></span> <span data-ttu-id="54673-543">Este exemplo usa a potência de 2 (o quadrado).</span><span class="sxs-lookup"><span data-stu-id="54673-543">This example uses the power of 2 (the square).</span></span> <span data-ttu-id="54673-544">Subtraia o factorJ reduzido do factorJ original e multiplique o resultado pelo intervalo J total acima do referenceJ primário para localizar o "deltaJ", que representa a alteração em J após a compactação de claridade, mas não incluindo a dependência croma.</span><span class="sxs-lookup"><span data-stu-id="54673-544">Subtract the reduced factorJ from the original factorJ and multiply the result by the total J-range above the primary referenceJ to find the "deltaJ," which represents the change in J after the lightness compression, but not including the chroma dependency.</span></span>
4.  <span data-ttu-id="54673-545">deltaJ = (factorJ-(factorJ?</span><span class="sxs-lookup"><span data-stu-id="54673-545">deltaJ = (factorJ - (factorJ ?</span></span> <span data-ttu-id="54673-546">factorJ)) ?</span><span class="sxs-lookup"><span data-stu-id="54673-546">factorJ)) ?</span></span> <span data-ttu-id="54673-547">(maxJ - referenceJ)</span><span class="sxs-lookup"><span data-stu-id="54673-547">(maxJ - referenceJ)</span></span>

5.  <span data-ttu-id="54673-548">Aplique factorC ao deltaJ (quanto maior o croma, maior o efeito) e calcule o novo J-Value para o ponto de destino.</span><span class="sxs-lookup"><span data-stu-id="54673-548">Apply factorC to the deltaJ (the higher the chroma, the greater the effect), and compute the new J-value for the destination point.</span></span>
6.  <span data-ttu-id="54673-549">destinationJ = destinationJ-(deltaJ?</span><span class="sxs-lookup"><span data-stu-id="54673-549">destinationJ = destinationJ - (deltaJ ?</span></span> <span data-ttu-id="54673-550">factorC)</span><span class="sxs-lookup"><span data-stu-id="54673-550">factorC)</span></span>

<span data-ttu-id="54673-551">Se J-Value para o ponto de destino estiver abaixo de referenceJ, uma computação semelhante às etapas anteriores a-C será executada, usando minJ em vez de maxJ para encontrar o intervalo em J para computar o factorJ e levar em conta a polaridade das operações "embaixo" da referenceJ.</span><span class="sxs-lookup"><span data-stu-id="54673-551">If J-value for the destination point is below referenceJ, then a similar computation to the preceding steps A-C is performed, using minJ instead of maxJ to find the range in J to compute the factorJ, and taking into account the polarity of the operations "underneath" the referenceJ.</span></span>

<span data-ttu-id="54673-552">factorJ = (referenceJ-destinationJ)/(referenceJ-minJ)</span><span class="sxs-lookup"><span data-stu-id="54673-552">factorJ = (referenceJ - destinationJ) / (referenceJ - minJ)</span></span>

<span data-ttu-id="54673-553">deltaJ = (factorJ-(factorJ?</span><span class="sxs-lookup"><span data-stu-id="54673-553">deltaJ = (factorJ - (factorJ ?</span></span> <span data-ttu-id="54673-554">factorJ)) ?</span><span class="sxs-lookup"><span data-stu-id="54673-554">factorJ)) ?</span></span> <span data-ttu-id="54673-555">(referenceJ - minJ)</span><span class="sxs-lookup"><span data-stu-id="54673-555">(referenceJ - minJ)</span></span>

<span data-ttu-id="54673-556">destinationJ = destinationJ + (deltaJ?</span><span class="sxs-lookup"><span data-stu-id="54673-556">destinationJ = destinationJ + (deltaJ ?</span></span> <span data-ttu-id="54673-557">factorC)</span><span class="sxs-lookup"><span data-stu-id="54673-557">factorC)</span></span>

<span data-ttu-id="54673-558">onde:</span><span class="sxs-lookup"><span data-stu-id="54673-558">where:</span></span>

<span data-ttu-id="54673-559">minJ é o valor J mínimo da gama.</span><span class="sxs-lookup"><span data-stu-id="54673-559">minJ is the minimum J-value of the gamut.</span></span>

<span data-ttu-id="54673-560">O croma para pontos de cor de entrada é expandido linearmente (quando possível) ao longo da luminosidade constante proporcional ao valor máximo de croma das gamas de origem e de destino no matiz e na claridade.</span><span class="sxs-lookup"><span data-stu-id="54673-560">The chroma for input color points is expanded linearly (when possible) along constant lightness proportional to the maximum chroma value of the source and destination gamuts at that hue and lightness.</span></span> <span data-ttu-id="54673-561">Combinado com a compactação de luminosidade dependente de croma, isso ajuda a preservar a saturação porque o mapeamento de distorção usando os pontos de referência às vezes faz com que o ponto de origem seja supercompactado em croma (consulte a Figura 16).</span><span class="sxs-lookup"><span data-stu-id="54673-561">Combined with the preceding chroma-dependent lightness compression, this helps preserve the saturation because shear mapping using the reference points sometimes causes the source point to over-compress in chroma (see Figure 16).</span></span>

![Diagrama que mostra o mapeamento de distorção para corresponder pontos de referência de matiz, antes da distorção à esquerda, depois de distorcer à direita.](images/gmmp-shearmapping.png)

<span data-ttu-id="54673-563">**Figura 16** : mapeamento de distorção, compactação de claridade para referência de matiz J e expansão de croma</span><span class="sxs-lookup"><span data-stu-id="54673-563">**Figure 16** : Shear mapping, lightness compression toward hue reference J, and chroma expansion</span></span>

<span data-ttu-id="54673-564">Veja a seguir uma descrição matemática do processo de expansão croma ou ajuste do valor C do ponto de destino.</span><span class="sxs-lookup"><span data-stu-id="54673-564">The following is a mathematical description of the chroma expansion process, or adjusting the C-value of the destination point.</span></span> <span data-ttu-id="54673-565">Ele é chamado de ponto de destino porque foi mapeado por distorção e luminosidade compactado na gama de destino.</span><span class="sxs-lookup"><span data-stu-id="54673-565">It is called the destination point because it has been shear mapped and lightness compressed into the destination gamut.</span></span>

1.  <span data-ttu-id="54673-566">Antes do mapeamento de distorção, determine sourceExtentC (a extensão croma na claridade e no matiz do ponto de origem).</span><span class="sxs-lookup"><span data-stu-id="54673-566">Before the shear mapping, determine sourceExtentC (the chroma extent at the lightness and hue of the source point).</span></span>
2.  <span data-ttu-id="54673-567">Após o mapeamento de distorção e a compactação de claridade que transforma o ponto de origem no ponto de destino, determine o destExtentC (a extensão croma na claridade e no matiz do ponto de destino).</span><span class="sxs-lookup"><span data-stu-id="54673-567">After the shear mapping and lightness compression which transforms the source point into the destination point, determine the destExtentC (the chroma extent at the lightness and hue of the destination point).</span></span>
3.  <span data-ttu-id="54673-568">Se o sourceExtentC for maior que o destExtentC, nenhum ajuste de croma para o ponto de destino será necessário e você poderá ignorar a próxima etapa.</span><span class="sxs-lookup"><span data-stu-id="54673-568">If the sourceExtentC is greater than the destExtentC, no chroma adjustment to the destination point is necessary, and you can skip the next step.</span></span>
4.  <span data-ttu-id="54673-569">Ajuste destinationC (o croma do ponto de destino) para caber na extensão de croma de destino nessa luminosidade e matiz.</span><span class="sxs-lookup"><span data-stu-id="54673-569">Adjust destinationC (the chroma of the destination point) to fit within the destination chroma extent at this lightness and hue.</span></span>
5.  <span data-ttu-id="54673-570">destinationC = destinationC?</span><span class="sxs-lookup"><span data-stu-id="54673-570">destinationC = destinationC ?</span></span> <span data-ttu-id="54673-571">(destExtentC / sourceExtentC)</span><span class="sxs-lookup"><span data-stu-id="54673-571">(destExtentC / sourceExtentC)</span></span>

    <span data-ttu-id="54673-572">onde:</span><span class="sxs-lookup"><span data-stu-id="54673-572">where:</span></span>

    <span data-ttu-id="54673-573">destinationC é o ponto de destino C-Value.</span><span class="sxs-lookup"><span data-stu-id="54673-573">destinationC is the destination point C-value.</span></span>

    <span data-ttu-id="54673-574">sourceExtentC é o valor C máximo da gama de origem na claridade e no matiz do ponto de origem.</span><span class="sxs-lookup"><span data-stu-id="54673-574">sourceExtentC is the maximum C-value of the source gamut at the lightness and hue of the source point.</span></span>

    <span data-ttu-id="54673-575">destExtentC é o valor C máximo da gama de destino na claridade e no matiz do ponto de destino.</span><span class="sxs-lookup"><span data-stu-id="54673-575">destExtentC is the maximum C-value of the destination gamut at the lightness and hue of the destination point.</span></span>

<span data-ttu-id="54673-576">Por fim, execute o recorte de distância mínimo.</span><span class="sxs-lookup"><span data-stu-id="54673-576">Finally, perform the mimimum distance clipping.</span></span> <span data-ttu-id="54673-577">Se a cor de entrada de matiz-girado, com ajuste de luminosidade e com mapeamento de distorção ainda estiver ligeiramente fora da gama de destino, recorte-a (Mova-a) para o ponto mais próximo no limite de gama de destino (veja a figura 17).</span><span class="sxs-lookup"><span data-stu-id="54673-577">If the hue-rotated, lightness-adjusted, and shear-mapped input color is still slightly outside the destination gamut, clip it (move it) to the closest point on the destination gamut boundary (see Figure 17).</span></span>

![Diagrama que mostra o recorte de distância mínimo.](images/gmmp-figure15.png)

<span data-ttu-id="54673-579">**Figura 17** : recorte de distância mínimo</span><span class="sxs-lookup"><span data-stu-id="54673-579">**Figure 17** : Minimum distance clipping</span></span>

## <a name="gamut-boundary-description-and-gamut-shell-algorithms"></a><span data-ttu-id="54673-580">Descrição de limite de gama e algoritmos de Shell de gamut</span><span class="sxs-lookup"><span data-stu-id="54673-580">Gamut Boundary Description and Gamut Shell Algorithms</span></span>

<span data-ttu-id="54673-581">A função de limite de gama de dispositivos usa o mecanismo de modelo de dispositivo e os parâmetros analíticos para derivar um limite de gama de dispositivos de cores, descrito como uma lista de vértices indexados do envoltória da gama do dispositivo.</span><span class="sxs-lookup"><span data-stu-id="54673-581">The device gamut boundary function uses the device model engine and analytical parameters to derive a color device gamut boundary, described as an indexed vertex list of the hull of the device gamut.</span></span> <span data-ttu-id="54673-582">O envoltória é calculado de forma diferente, dependendo se você está trabalhando com dispositivos aditivos, como monitores e projetores ou dispositivos subtraíis.</span><span class="sxs-lookup"><span data-stu-id="54673-582">The hull is computed differently depending on whether you are working with additive devices, such as monitors and projectors, or subtractive devices.</span></span> <span data-ttu-id="54673-583">A lista de vértices indexados é armazenada em CIEJab.</span><span class="sxs-lookup"><span data-stu-id="54673-583">The indexed vertex list is stored in CIEJab.</span></span> <span data-ttu-id="54673-584">A estrutura da lista de vértices indexados é otimizada para aceleração de hardware pelo DirectX.</span><span class="sxs-lookup"><span data-stu-id="54673-584">The structure of the indexed vertex list is optimized for hardware acceleration by DirectX.</span></span>

<span data-ttu-id="54673-585">Essa abordagem tem muitas soluções conhecidas.</span><span class="sxs-lookup"><span data-stu-id="54673-585">This approach has many well-known solutions.</span></span> <span data-ttu-id="54673-586">Se você Pesquisar "convexa envoltória DirectX" na Web, obterá mais de 100 ocorrências.</span><span class="sxs-lookup"><span data-stu-id="54673-586">If you search for "convex hull DirectX" on the Web, you get more than 100 hits.</span></span> <span data-ttu-id="54673-587">Por exemplo, há uma referência de 1983 neste tópico específico (teoria e aplicativo de gráficos de computador, "Shiphulls, superfícies b-spline e CADCAM", pp. 34-49) com referências de 1970 a 1982 no tópico.</span><span class="sxs-lookup"><span data-stu-id="54673-587">For example, there is a reference from 1983 on this specific topic (Computer Graphics Theory and Application, "Shiphulls, b-spline surfaces, and cadcam," pp. 34-49) with references dating from 1970 to 1982 on the topic.</span></span>

<span data-ttu-id="54673-588">A coleção de pontos pode ser determinada de informações externamente disponíveis, da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="54673-588">The collection of points can be determined from externally available information, as follows:</span></span>

-   <span data-ttu-id="54673-589">Os pontos para o Shell de referência para monitores são gerados usando uma amostragem do cubo de cores no espaço de Colorant do dispositivo.</span><span class="sxs-lookup"><span data-stu-id="54673-589">Points for the reference shell for monitors are generated using a sampling of the color cube in device colorant space.</span></span>
-   <span data-ttu-id="54673-590">Os pontos para o Shell de referência para impressoras e dispositivos de captura são obtidos dos dados de exemplo usados para inicializar o modelo.</span><span class="sxs-lookup"><span data-stu-id="54673-590">Points for the reference shell for printers and capture devices are obtained from the sample data used to initialize the model.</span></span>
-   <span data-ttu-id="54673-591">Pontos para o Shell de referência para scRGB e sRGB são gerados usando uma amostragem do cubo de cor para sRGB.</span><span class="sxs-lookup"><span data-stu-id="54673-591">Points for the reference shell for scRGB and sRGB are generated using a sampling of the color cube for sRGB.</span></span>
-   <span data-ttu-id="54673-592">Os pontos para o Shell plausível para dispositivos de captura são gerados usando uma amostragem do cubo de cores no espaço de Colorant do dispositivo.</span><span class="sxs-lookup"><span data-stu-id="54673-592">Points for the plausible shell for capture devices are generated using a sampling of the color cube in device colorant space.</span></span>
-   <span data-ttu-id="54673-593">Pontos para o Shell de referência para projetores são gerados usando uma amostragem de um poliedro no cubo de cores no espaço Colorant do dispositivo.</span><span class="sxs-lookup"><span data-stu-id="54673-593">Points for the reference shell for projectors are generated using a sampling of a polyhedron in the color cube in device colorant space.</span></span>
-   <span data-ttu-id="54673-594">Os pontos para o possível Shell de espaços de cores de intervalo dinâmico amplos são gerados usando uma amostragem do cubo de cores no próprio espaço.</span><span class="sxs-lookup"><span data-stu-id="54673-594">Points for the possible shell for wide dynamic range color spaces are generated using a sampling of the color cube in the space itself.</span></span>

<span data-ttu-id="54673-595">Você pode criar uma lista de vértices que descreve com eficiência a gama do dispositivo de cores, dado um perfil de dispositivo e serviços de suporte do sistema.</span><span class="sxs-lookup"><span data-stu-id="54673-595">You can create a vertex list that efficiently describes the color device gamut, given a device profile and system support services.</span></span>

<span data-ttu-id="54673-596">Para dispositivos de saída, o limite de gama descreve o intervalo de cores que podem ser exibidas pelo dispositivo.</span><span class="sxs-lookup"><span data-stu-id="54673-596">For output devices, the gamut boundary describes the range of colors that can be displayed by the device.</span></span> <span data-ttu-id="54673-597">Um limite de gama é gerado a partir dos mesmos dados usados para modelar o comportamento do dispositivo.</span><span class="sxs-lookup"><span data-stu-id="54673-597">A gamut boundary is generated from the same data used to model the behavior of the device.</span></span> <span data-ttu-id="54673-598">Conceitualmente, você produz uma amostra do intervalo de cores que o dispositivo pode produzir, mede as cores, converte as medidas em espaço de aparência e, em seguida, usa os resultados para criar o limite de gama.</span><span class="sxs-lookup"><span data-stu-id="54673-598">Conceptually, you output a sampling of the range of colors the device can produce, measure the colors, convert the measurements into appearance space, and then use the results to create the gamut boundary.</span></span>

<span data-ttu-id="54673-599">Os dispositivos de entrada são mais complicados.</span><span class="sxs-lookup"><span data-stu-id="54673-599">Input devices are trickier.</span></span> <span data-ttu-id="54673-600">Cada pixel em uma imagem de entrada deve ter algum valor.</span><span class="sxs-lookup"><span data-stu-id="54673-600">Each pixel in an input image must have some value.</span></span> <span data-ttu-id="54673-601">Cada pixel deve ser capaz de representar qualquer cor encontrada no mundo real de alguma forma.</span><span class="sxs-lookup"><span data-stu-id="54673-601">Each pixel must be able to represent any color found in the real world in some way.</span></span> <span data-ttu-id="54673-602">Nesse sentido, nenhuma cor é "fora da gama" para um dispositivo de entrada, pois eles sempre podem ser representados.</span><span class="sxs-lookup"><span data-stu-id="54673-602">In this sense, no colors are "out of gamut" for an input device, because they can always be represented.</span></span>

<span data-ttu-id="54673-603">Todos os formatos de imagem digital têm algum intervalo dinâmico fixo.</span><span class="sxs-lookup"><span data-stu-id="54673-603">All digital image formats have some fixed dynamic range.</span></span> <span data-ttu-id="54673-604">Devido a essa limitação, sempre há alguns estímulos distintos que mapeiam para o mesmo valor digital.</span><span class="sxs-lookup"><span data-stu-id="54673-604">Because of this limitation, there is always some distinct stimuli that map to the same digital value.</span></span> <span data-ttu-id="54673-605">Portanto, você não pode estabelecer um mapeamento de um para um entre cores do mundo real e valores de câmera digital.</span><span class="sxs-lookup"><span data-stu-id="54673-605">So, you cannot establish a one-to-one mapping between real-world colors and digital camera values.</span></span> <span data-ttu-id="54673-606">Em vez disso, o limite de gama é formado por meio da estimativa de uma variedade de cores do mundo real que podem produzir as respostas digitais da câmera.</span><span class="sxs-lookup"><span data-stu-id="54673-606">Instead, the gamut boundary is formed by estimating a range of real-world colors that can produce the digital responses of the camera.</span></span> <span data-ttu-id="54673-607">Você usa esse intervalo estimado como a gama do dispositivo de entrada.</span><span class="sxs-lookup"><span data-stu-id="54673-607">You use that estimated range as the gamut for the input device.</span></span>

<span data-ttu-id="54673-608">Os primários estão incluídos para fornecer mapeamento de gamut de tipo de intenção de gráficos comerciais.</span><span class="sxs-lookup"><span data-stu-id="54673-608">Primaries are included to provide for business graphics intent-type gamut mapping.</span></span>

<span data-ttu-id="54673-609">No estilo real orientado a objeto, você abstrai a representação subjacente do limite de gama.</span><span class="sxs-lookup"><span data-stu-id="54673-609">In true object-oriented style, you abstract the underlying representation of the gamut boundary.</span></span> <span data-ttu-id="54673-610">Isso permite que você tenha a flexibilidade de alterar a representação no futuro.</span><span class="sxs-lookup"><span data-stu-id="54673-610">This allows you the flexibility to change the representation in the future.</span></span> <span data-ttu-id="54673-611">Para entender o GBD (descritor de limite de gama) usado na nova CTE, primeiro você deve entender como o GMAs (algoritmos de mapeamento de gamut) funciona.</span><span class="sxs-lookup"><span data-stu-id="54673-611">To understand the gamut boundary descriptor (GBD) used in the new CTE, you must first understand how gamut mapping algorithms (GMAs) work.</span></span> <span data-ttu-id="54673-612">Tradicionalmente, o GMAs foi projetado para atender às necessidades da comunidade de arte gráfica; ou seja, para reproduzir as imagens que já foram processadas corretamente para o dispositivo no qual a imagem de entrada foi criada.</span><span class="sxs-lookup"><span data-stu-id="54673-612">Traditionally, GMAs have been designed to meet the needs of the graphic art community; that is, to reproduce images that have already been properly rendered for the device on which the input image was created.</span></span> <span data-ttu-id="54673-613">O objetivo da GMAs de artes gráficas é fazer a melhor reprodução possível da imagem de entrada no dispositivo de saída.</span><span class="sxs-lookup"><span data-stu-id="54673-613">The goal of graphic arts GMAs is to make the best possible reproduction of the input image on the output device.</span></span> <span data-ttu-id="54673-614">A nova CTE GBD foi projetada para resolver quatro problemas principais.</span><span class="sxs-lookup"><span data-stu-id="54673-614">The new CTE GBD is designed to solve four key problems.</span></span>

<span data-ttu-id="54673-615">Como a imagem de entrada é renderizada para o dispositivo de entrada, todas as cores se ajustam dentro do intervalo entre o ponto branco médio e o ponto preto.</span><span class="sxs-lookup"><span data-stu-id="54673-615">Because the input image is rendered for the input device, all colors fit within the range between the medium's white point and black point.</span></span> <span data-ttu-id="54673-616">Suponha que a imagem seja uma fotografia de uma cena na qual há um branco difuso, como uma pessoa em uma camisa de baixo branco e um realce especulativo, como a reflexão clara de uma janela ou um amortecedor de cromo.</span><span class="sxs-lookup"><span data-stu-id="54673-616">Suppose that the image is a photograph of a scene in which there is a diffuse white, such as a person in a white tee shirt, and a specular highlight, such as light reflecting off a window or chrome bumper.</span></span> <span data-ttu-id="54673-617">A cena será renderizada para o meio de entrada para que o realce de especulação seja mapeado para o ponto branco médio e o branco difuso seja mapeado para uma cor neutra mais escura do que o ponto branco médio.</span><span class="sxs-lookup"><span data-stu-id="54673-617">The scene will be rendered to the input medium so that the specular highlight is mapped to the medium's white point, and the diffuse white is mapped to some neutral color darker than the medium's white point.</span></span> <span data-ttu-id="54673-618">A escolha de como mapear cores da cena para a mídia de entrada é uma decisão dependente de cena e uma decisão estética.</span><span class="sxs-lookup"><span data-stu-id="54673-618">The choice of how to map colors from the scene to the input medium is both a scene-dependent decision and an aesthetic decision.</span></span> <span data-ttu-id="54673-619">Se o realce especular estava ausente da cena original, o branco difuso provavelmente será mapeado para o ponto branco médio.</span><span class="sxs-lookup"><span data-stu-id="54673-619">If the specular highlight was missing from the original scene, then the diffuse white would probably be mapped to the medium's white point.</span></span> <span data-ttu-id="54673-620">Em uma cena com muitos detalhes de realce, mais intervalo seria deixado entre o branco especular e o branco difuso.</span><span class="sxs-lookup"><span data-stu-id="54673-620">In a scene with a lot of highlight detail, more range would be left between the specular white and the diffuse white.</span></span> <span data-ttu-id="54673-621">Em uma cena em que o realce não é significativo, um intervalo muito pequeno pode ser deixado.</span><span class="sxs-lookup"><span data-stu-id="54673-621">In a scene where the highlight is not significant, very little range might be left.</span></span>

<span data-ttu-id="54673-622">Para imagens previamente renderizadas, o mapeamento de gamut é relativamente simples.</span><span class="sxs-lookup"><span data-stu-id="54673-622">For pre-rendered images, gamut mapping is relatively straightforward.</span></span> <span data-ttu-id="54673-623">Basicamente, o ponto branco da média original é mapeado para o ponto branco da média de reprodução, o ponto preto de origem é mapeado para o ponto preto de destino e a maior parte do mapeamento é concluída.</span><span class="sxs-lookup"><span data-stu-id="54673-623">Basically, the original medium's white point is mapped to the reproduction medium's white point, the source black point is mapped to the destination black point, and most of the mapping is complete.</span></span> <span data-ttu-id="54673-624">Os diferentes GMAs de existência fornecem variações para mapear outros pontos na escala de tons da média de origem e diferentes maneiras de lidar com valores de croma fora do gamut.</span><span class="sxs-lookup"><span data-stu-id="54673-624">The different GMAs in existence provide variations for mapping other points on the source medium's tone scale and different ways to handle out-of-gamut chroma values.</span></span> <span data-ttu-id="54673-625">Mas o mapeamento de branco para branco e preto para preto é consistente em todas essas variações.</span><span class="sxs-lookup"><span data-stu-id="54673-625">But the mapping of white to white and black to black is consistent throughout these variations.</span></span> <span data-ttu-id="54673-626">Essa implementação exige que o branco esteja acima de um J \* de 50 e preto abaixo de um j \* de 50.</span><span class="sxs-lookup"><span data-stu-id="54673-626">This implementation requires that white be above a J\* of 50 and black below a J\* of 50.</span></span>

<span data-ttu-id="54673-627">Nem todas as codificações de cores limitam os intervalos de cores para imagens de entrada.</span><span class="sxs-lookup"><span data-stu-id="54673-627">Not all color encodings limit color ranges for input images.</span></span> <span data-ttu-id="54673-628">A scRGB de codificação de cores padrão IEC (IEC 61966-2-2) fornece 16 bits para cada um dos três canais de cores vermelho, verde e azul (RGB).</span><span class="sxs-lookup"><span data-stu-id="54673-628">The IEC standard color encoding scRGB (IEC 61966-2-2) provides 16 bits for each of the three color channels red, green, and blue (RGB).</span></span> <span data-ttu-id="54673-629">Nessa codificação, a referência preta não é codificada como o triplo RGB (0, 0, 0), mas como (4096, 4096, 4096).</span><span class="sxs-lookup"><span data-stu-id="54673-629">In that encoding, reference black is not encoded as the RGB triple (0, 0, 0), but as (4096, 4096, 4096).</span></span> <span data-ttu-id="54673-630">A referência branca é codificada como (12288, 12288, 12288).</span><span class="sxs-lookup"><span data-stu-id="54673-630">Reference white is encoded as (12288, 12288, 12288).</span></span> <span data-ttu-id="54673-631">A codificação scRGB pode ser usada para representar realces especulares e detalhes de sombra.</span><span class="sxs-lookup"><span data-stu-id="54673-631">The scRGB encoding can be used to represent specular highlights and shadow detail.</span></span> <span data-ttu-id="54673-632">Ele inclui corridas RGB que não são fisicamente possíveis porque exigem quantidades negativas de luz e codificações que estão fora do local de CIE Spectral.</span><span class="sxs-lookup"><span data-stu-id="54673-632">It includes RGB triples that are not physically possible because they require negative amounts of light, and encodings that are outside the CIE spectral locus.</span></span> <span data-ttu-id="54673-633">Claramente, nenhum dispositivo pode produzir todas as cores na gama de scRGB.</span><span class="sxs-lookup"><span data-stu-id="54673-633">Clearly, no device can possibly produce all the colors in the scRGB gamut.</span></span> <span data-ttu-id="54673-634">Na verdade, nenhum dispositivo pode produzir todas as cores que um humano pode ver.</span><span class="sxs-lookup"><span data-stu-id="54673-634">In fact, no device can produce all the colors that a human being can see.</span></span> <span data-ttu-id="54673-635">Portanto, os dispositivos não podem preencher a gama de scRGB, e seria útil ser capaz de representar a parte da gama de preenchimento.</span><span class="sxs-lookup"><span data-stu-id="54673-635">So, devices cannot fill the scRGB gamut, and it would be useful to be able to represent the part of the gamut that they do fill.</span></span> <span data-ttu-id="54673-636">Cada dispositivo tem um intervalo de valores no espaço scRGB que ele pode produzir.</span><span class="sxs-lookup"><span data-stu-id="54673-636">Each device has a range of values in scRGB space that it can produce.</span></span> <span data-ttu-id="54673-637">Essas são as cores "esperadas" para o dispositivo; seria surpreendente que o dispositivo produza cores fora desta gama.</span><span class="sxs-lookup"><span data-stu-id="54673-637">These are the "expected" colors for the device; it would be surprising for the device to produce colors outside this gamut.</span></span> <span data-ttu-id="54673-638">Há uma transformação definida do espaço de scRGB para o espaço de aparência; portanto, cada dispositivo também tem um intervalo de valores de aparência que espera-se reproduzir.</span><span class="sxs-lookup"><span data-stu-id="54673-638">There is a defined transformation from scRGB space to appearance space, so each device also has a range of appearance values that it is expected to reproduce.</span></span>

<span data-ttu-id="54673-639">Em scRGB e entrada de dispositivos de captura caracterizados com um destino fixo, é possível obter um valor fora do intervalo de valores esperados.</span><span class="sxs-lookup"><span data-stu-id="54673-639">In both scRGB and input from capture devices characterized with a fixed target, it is possible to get a value outside the range of expected values.</span></span> <span data-ttu-id="54673-640">Se alguém calibrar uma câmera para um destino de teste; e, em seguida, captura uma cena com destaques especulares, pode haver pixels mais brilhantes do que o ponto branco do destino.</span><span class="sxs-lookup"><span data-stu-id="54673-640">If someone calibrates a camera to a test target; and then captures a scene with specular highlights, there might be pixels that are brighter than the target's white point.</span></span> <span data-ttu-id="54673-641">A mesma coisa pode acontecer se um vermelho ocorrido naturalmente for mais desvio do que o vermelho de destino.</span><span class="sxs-lookup"><span data-stu-id="54673-641">The same thing can happen if a naturally occurring red is more chromatic than the target red.</span></span> <span data-ttu-id="54673-642">Se alguém usar uma imagem scRGB de um dispositivo e editar manualmente as cores na imagem, será possível criar pixels que se enquadram fora do intervalo esperado da gama do dispositivo, mesmo que estejam dentro da gama completa do scRGB.</span><span class="sxs-lookup"><span data-stu-id="54673-642">If someone takes an scRGB image from a device, and then manually edits the colors in the image, it is possible to create pixels that fall outside the expected range of the device gamut, even though they are within the full scRGB gamut.</span></span>

<span data-ttu-id="54673-643">Um segundo problema pode não, à primeira, parecer estar relacionado a isso.</span><span class="sxs-lookup"><span data-stu-id="54673-643">A second problem may not, at first, seem to be related to this.</span></span> <span data-ttu-id="54673-644">Surge quando você usa um destino de cor para caracterizar um dispositivo de entrada, como uma câmera ou um scanner.</span><span class="sxs-lookup"><span data-stu-id="54673-644">It arises when you use a color target to characterize an input device, such as a camera or scanner.</span></span> <span data-ttu-id="54673-645">Os destinos refletiis normalmente são produzidos em papel e contêm vários patches coloridos.</span><span class="sxs-lookup"><span data-stu-id="54673-645">Reflective targets are typically produced on paper and contain a number of colored patches.</span></span> <span data-ttu-id="54673-646">O manufaturers fornece arquivos de dados com medidas de cores tomadas sob uma condição de exibição fixa para cada patch de cor.</span><span class="sxs-lookup"><span data-stu-id="54673-646">Manufaturers provide data files with color measurements taken under a fixed viewing condition for each color patch.</span></span> <span data-ttu-id="54673-647">Ferramentas de criação de perfil de cores crie um mapeamento entre esses valores medidos e os valores retornados pelos sensores de cor nos dispositivos.</span><span class="sxs-lookup"><span data-stu-id="54673-647">Color profiling tools create a mapping between these measured values and the values returned by the color sensors in the devices.</span></span> <span data-ttu-id="54673-648">O problema é que geralmente esses destinos de cor não cobrem o intervalo completo de valores de dispositivo.</span><span class="sxs-lookup"><span data-stu-id="54673-648">The problem is that often these color targets do not cover the full range of device values.</span></span> <span data-ttu-id="54673-649">Por exemplo, o scanner ou a câmera pode retornar um valor de (253, 253, 253) para o ponto branco de referência e um patch vermelho de referência pode ter um valor RGB de (254, 12, 4).</span><span class="sxs-lookup"><span data-stu-id="54673-649">For example, the scanner or camera might return a value of (253, 253, 253) for the reference white point, and a reference red patch might have an RGB value of (254, 12, 4).</span></span> <span data-ttu-id="54673-650">Elas representam o intervalo de valores esperados para o dispositivo de entrada, com base nos valores de destino.</span><span class="sxs-lookup"><span data-stu-id="54673-650">These represent the range of expected values for the input device, based on the target values.</span></span> <span data-ttu-id="54673-651">Se você caracterizar o dispositivo de entrada com base nas respostas para o destino, esperará apenas as cores dentro desse intervalo estreito.</span><span class="sxs-lookup"><span data-stu-id="54673-651">If you characterize the input device based on the responses to the target, then you only expect colors within this narrow range.</span></span> <span data-ttu-id="54673-652">Esse intervalo não é apenas menor do que o intervalo de cores que as pessoas podem ver, é menor do que o intervalo de cores que o dispositivo pode produzir.</span><span class="sxs-lookup"><span data-stu-id="54673-652">This range is not only smaller than the range of colors humans can see, it is smaller than the range of colors the device can produce.</span></span>

<span data-ttu-id="54673-653">Em ambos os casos, é difícil estimar a gama do dispositivo ou da imagem de entrada, apesar da existência de uma gama de referência ou medidas.</span><span class="sxs-lookup"><span data-stu-id="54673-653">In both cases, it is difficult to estimate the gamut of the input device or image, despite the existence of a reference gamut or measurements.</span></span> <span data-ttu-id="54673-654">No primeiro problema, a gama plausível do dispositivo de entrada é menor do que a gama completa de scRGB.</span><span class="sxs-lookup"><span data-stu-id="54673-654">In the first problem, the plausible gamut of the input device is less than the full gamut of scRGB.</span></span> <span data-ttu-id="54673-655">No segundo problema, a gama de referência do destino é menor que a gama total possível do dispositivo de entrada.</span><span class="sxs-lookup"><span data-stu-id="54673-655">In the second problem, the reference gamut of the target is less than the full possible gamut of the input device.</span></span>

<span data-ttu-id="54673-656">O terceiro problema envolve o mapeamento de Tom.</span><span class="sxs-lookup"><span data-stu-id="54673-656">The third problem involves tone mapping.</span></span> <span data-ttu-id="54673-657">Muitos modelos de limites de gama que podem representar adequadamente imagens previamente renderizadas usadas nas artes gráficas foram propostas, por exemplo, o Braun e Fairchild Mountain Range GBD (Braun \[ 97 \] ) e o descritor de limite Morovic de segmento de máximo (Morovic \[ 98 \] ).</span><span class="sxs-lookup"><span data-stu-id="54673-657">Many models of gamut boundaries that can adequately represent pre-rendered images used in the graphic arts have been proposed, for example, the Braun and Fairchild Mountain range GBD (Braun\[97\]), and Morovic's Segment Maxima boundary descriptor (Morovic\[98\]).</span></span> <span data-ttu-id="54673-658">Mas esses modelos fornecem apenas informações sobre os extremos da gama do dispositivo; estão faltando informações sobre outros pontos no mapeamento de tons.</span><span class="sxs-lookup"><span data-stu-id="54673-658">But these models only provide information about the extremes of the device's gamut; they are missing information about other points in the tonal mapping.</span></span> <span data-ttu-id="54673-659">Sem essas informações, o GMAs só pode fazer estimativas aproximadas do mapeamento de Tom ideal.</span><span class="sxs-lookup"><span data-stu-id="54673-659">Without such information, GMAs can only make rough estimates of optimal tone mapping.</span></span> <span data-ttu-id="54673-660">Pior, esses modelos não fornecem ajuda para o intervalo dinâmico estendido em scRGB e em imagens de câmera digital.</span><span class="sxs-lookup"><span data-stu-id="54673-660">Worse, these models provide no help for the extended dynamic range in scRGB and in digital camera images.</span></span>

<span data-ttu-id="54673-661">Como esse problema é resolvido nos setores fotográficos e videographic?</span><span class="sxs-lookup"><span data-stu-id="54673-661">How is this problem resolved in the photographic and videographic industries?</span></span> <span data-ttu-id="54673-662">A câmera captura uma imagem.</span><span class="sxs-lookup"><span data-stu-id="54673-662">The camera captures an image.</span></span> <span data-ttu-id="54673-663">Os especialistas podem debater quanto o processamento ocorre no dispositivo de captura; Mas eles concordam que não é uma quantidade significativa.</span><span class="sxs-lookup"><span data-stu-id="54673-663">Experts might debate how much rendering occurs in the capture device; but they agree that it is not a significant amount.</span></span> <span data-ttu-id="54673-664">Ambas as tecnologias não mapeiam um branco difuso em uma cena capturada para o ponto branco da média.</span><span class="sxs-lookup"><span data-stu-id="54673-664">Both technologies do not map a diffuse white in a captured scene to the medium's white point.</span></span> <span data-ttu-id="54673-665">Da mesma forma, eles não mapeiam o ponto preto da cena para o ponto preto da média.</span><span class="sxs-lookup"><span data-stu-id="54673-665">Similarly, they do not map the black point from the scene to the medium's black point.</span></span> <span data-ttu-id="54673-666">O comportamento do filme fotográfico é descrito em espaço de densidade usando uma curva de característica, geralmente chamada de um Prejudicador e Driffield, ou a curva de H&D.</span><span class="sxs-lookup"><span data-stu-id="54673-666">The behavior of photographic film is described in density space using a characteristic curve, often called a Hurter and Driffield, or H&D curve.</span></span> <span data-ttu-id="54673-667">A curva mostra a densidade da cena original e a densidade resultante no filme.</span><span class="sxs-lookup"><span data-stu-id="54673-667">The curve shows the density of the original scene and the resulting density on the film.</span></span> <span data-ttu-id="54673-668">A Figura 18 mostra uma curva típica de H&D.</span><span class="sxs-lookup"><span data-stu-id="54673-668">Figure 18 shows a typical H&D curve.</span></span> <span data-ttu-id="54673-669">O eixo x representa o aumento da exposição do log.</span><span class="sxs-lookup"><span data-stu-id="54673-669">The x-axis represents increasing log exposure.</span></span> <span data-ttu-id="54673-670">O eixo y representa a densidade no slide.</span><span class="sxs-lookup"><span data-stu-id="54673-670">The y-axis represents the density on the slide.</span></span> <span data-ttu-id="54673-671">Cinco pontos de referência são marcados na curva: preto sem detalhes, que representa a densidade mínima no negativo; preto com detalhe; cartão de referência média-cinza; branco com detalhes; e branco sem detalhes.</span><span class="sxs-lookup"><span data-stu-id="54673-671">Five reference points are marked on the curve: black without detail, which represents the minimum density on the negative; black with detail; reference mid-gray card; white with detail; and white without detail.</span></span> <span data-ttu-id="54673-672">Observe que há espaço entre preto sem detalhes (que representa o preto do dispositivo) e preto com detalhe (sombra preta).</span><span class="sxs-lookup"><span data-stu-id="54673-672">Note that there is space between black without detail (which represents device black) and black with detail (shadow black).</span></span> <span data-ttu-id="54673-673">Da mesma forma, há espaço entre branco com detalhe (branco difuso) e branco sem detalhes (que representa o dispositivo branco).</span><span class="sxs-lookup"><span data-stu-id="54673-673">Similarly, there is space between white with detail (diffuse white) and white without detail (which represents device white).</span></span>

![Diagrama que mostra a curva de H e D para filme de slide.](images/gmmp-image079.png)

<span data-ttu-id="54673-675">**Figura 18** : curva de&D para filme de slide</span><span class="sxs-lookup"><span data-stu-id="54673-675">**Figure 18** : H&D curve for slide film</span></span>

<span data-ttu-id="54673-676">A indústria de vídeo fornece "espaço" e "footroom" em imagens.</span><span class="sxs-lookup"><span data-stu-id="54673-676">The video industry provides "headroom" and "footroom" in images.</span></span> <span data-ttu-id="54673-677">Na especificação ITU 709, a luminância (chamada Y) é codificada em 8 bits, com um intervalo de 0 a 255.</span><span class="sxs-lookup"><span data-stu-id="54673-677">In the ITU 709 specification, luminance (called Y) is encoded in 8 bits, with a range of 0 to 255.</span></span> <span data-ttu-id="54673-678">No entanto, a referência preta é codificada em 15 e a branca de referência é codificada como 235.</span><span class="sxs-lookup"><span data-stu-id="54673-678">However, reference black is encoded at 15 and reference white is encoded as 235.</span></span> <span data-ttu-id="54673-679">Isso deixa o intervalo de codificação entre 236 e 255 para representar os realces especulares.</span><span class="sxs-lookup"><span data-stu-id="54673-679">This leaves the encoding range between 236 and 255 to represent specular highlights.</span></span>

<span data-ttu-id="54673-680">O setor de vídeo apresenta um sistema de loops essencialmente fechado.</span><span class="sxs-lookup"><span data-stu-id="54673-680">The video industry presents an essentially closed loop system.</span></span> <span data-ttu-id="54673-681">Embora existam muitos fornecedores de equipamentos diferentes, os sistemas de vídeo são baseados nos dispositivos de referência.</span><span class="sxs-lookup"><span data-stu-id="54673-681">While there are many different equipment vendors, video systems are based upon reference devices.</span></span> <span data-ttu-id="54673-682">Há uma codificação padrão para imagens de vídeo.</span><span class="sxs-lookup"><span data-stu-id="54673-682">There is a standard encoding for video images.</span></span> <span data-ttu-id="54673-683">Não é necessário comunicar um limite de gama com imagens de vídeo, pois todas as imagens são codificadas para reprodução no mesmo dispositivo de referência.</span><span class="sxs-lookup"><span data-stu-id="54673-683">There is no need to communicate a gamut boundary with video images, because all images are encoded for reproduction on the same reference device.</span></span> <span data-ttu-id="54673-684">O filme também é um loop fechado porque não há necessidade de transmitir dados intermediários entre componentes diferentes.</span><span class="sxs-lookup"><span data-stu-id="54673-684">Film is also closed loop because there is no need to convey intermediate data between different components.</span></span> <span data-ttu-id="54673-685">Você deseja uma solução que permita imagens de dispositivos com gamas variáveis e que representem cenas previamente renderizados e não renderizados a serem reproduzidos na saída com gamas variáveis.</span><span class="sxs-lookup"><span data-stu-id="54673-685">You want a solution that enables images from devices with varying gamuts and representing both pre-rendered and unrendered scenes to be reproduced on output with varying gamuts.</span></span>

<span data-ttu-id="54673-686">Um quarto problema que a nova CTE deve resolver é que as cores visualmente cinzas produzidas por um dispositivo, por exemplo, quando vermelho = verde = azul em um monitor, frequentemente não se enquadram no eixo neutro do CAM (quando croma = 0,0).</span><span class="sxs-lookup"><span data-stu-id="54673-686">A fourth problem that the new CTE must resolve is that the visually gray colors produced by a device, for example, when red=green=blue on a monitor, frequently do not fall upon the neutral axis of the CAM (when the chroma = 0.0).</span></span> <span data-ttu-id="54673-687">Isso causa grandes dificuldades para o GMAs.</span><span class="sxs-lookup"><span data-stu-id="54673-687">This causes great difficulties for GMAs.</span></span> <span data-ttu-id="54673-688">Para tornar o GMAs funcionar bem, você precisa ajustar a descrição da gama do dispositivo e dos pontos de entrada para que o eixo neutro do dispositivo fique no eixo neutro do espaço de aparência.</span><span class="sxs-lookup"><span data-stu-id="54673-688">To make GMAs work well, you have to adjust the description of the device's gamut and of the input points so that the device's neutral axis falls on the appearance space's neutral axis.</span></span> <span data-ttu-id="54673-689">Você precisa ajustar os pontos do eixo neutro por um valor semelhante.</span><span class="sxs-lookup"><span data-stu-id="54673-689">You have to adjust points off the neutral axis by a similar amount.</span></span> <span data-ttu-id="54673-690">Caso contrário, não será possível fazer gradações suaves por meio da imagem.</span><span class="sxs-lookup"><span data-stu-id="54673-690">Otherwise, you cannot make smooth gradations through the image.</span></span> <span data-ttu-id="54673-691">No caminho do GMA, você desfaz esse mapeamento em relação ao eixo neutro do dispositivo de saída.</span><span class="sxs-lookup"><span data-stu-id="54673-691">On the way out of the GMA, you undo this mapping, relative to the output device's neutral axis.</span></span> <span data-ttu-id="54673-692">Isso é chamado de "chiropractic" a retificação do eixo.</span><span class="sxs-lookup"><span data-stu-id="54673-692">This is referred to as a "chiropractic" straightening of the axis.</span></span> <span data-ttu-id="54673-693">Como um chiropractor, você não apenas acerta o esqueleto (eixo neutro), mas ajusta o restante do corpo para se mover junto com o esqueleto.</span><span class="sxs-lookup"><span data-stu-id="54673-693">Like a chiropractor, you not only straighten the skeleton (neutral axis), but you adjust the rest of the body to move along with the skeleton.</span></span> <span data-ttu-id="54673-694">Como um chiropractor, você não ajusta o esqueleto pelo mesmo valor por todo o espaço.</span><span class="sxs-lookup"><span data-stu-id="54673-694">Like a chiropractor, you do not adjust the skeleton by the same amount through the entire space.</span></span> <span data-ttu-id="54673-695">Em vez disso, você ajusta diferentes seções de forma diferente.</span><span class="sxs-lookup"><span data-stu-id="54673-695">Instead, you adjust different sections differently.</span></span>

![Diagrama que mostra a curvatura do eixo neutro do dispositivo em relação ao eixo neutro CIECAM.](images/gmmp-image081.png)

<span data-ttu-id="54673-697">**Figura 19:** Curvatura do eixo neutro do dispositivo em relação ao eixo neutro CIECAM</span><span class="sxs-lookup"><span data-stu-id="54673-697">**Figure 19:** Curvature of the device neutral axis relative to the CIECAM neutral axis</span></span>

<span data-ttu-id="54673-698">O que a nova CTE requer é um modelo de um limite de gama que pode ser usado para representar imagens de origem renderizadas e não renderizadas, fornecer informações sobre a aparência de neutros de dispositivo e fornecer informações para imagens de mapeamento de Tom com um grande intervalo de luminância.</span><span class="sxs-lookup"><span data-stu-id="54673-698">What the new CTE requires is a model of a gamut boundary that can be used to represent both rendered and unrendered source images, provide information about the appearance of device neutrals, and provide information for tone mapping images with a wide luminance range.</span></span>

![Diagrama que mostra os três shells de gamut.](images/gmmp-image083.png)

<span data-ttu-id="54673-700">**Figura 20** : três shells de gamut</span><span class="sxs-lookup"><span data-stu-id="54673-700">**Figure 20** : Three gamut shells</span></span>

<span data-ttu-id="54673-701">O limite de gama é composto por três shells que definem três regiões.</span><span class="sxs-lookup"><span data-stu-id="54673-701">The gamut boundary is composed of three shells that define three regions.</span></span>

<span data-ttu-id="54673-702">Na nova CTE, o Shell externo da gama é formado com um envoltória convexa feito dos pontos de amostra na gama do dispositivo.</span><span class="sxs-lookup"><span data-stu-id="54673-702">In the new CTE, the outer shell of the gamut is formed with a convex hull made from sample points in the device gamut.</span></span> <span data-ttu-id="54673-703">Um envoltória é formado por meio de um conjunto de pontos de exemplo e ao redor deles por uma superfície.</span><span class="sxs-lookup"><span data-stu-id="54673-703">A hull is formed by taking a set of sample points and surrounding them by a surface.</span></span> <span data-ttu-id="54673-704">Um convexa envoltória tem a propriedade adicional de ser convexa em todos os lugares.</span><span class="sxs-lookup"><span data-stu-id="54673-704">A convex hull has the additional property of being convex everywhere.</span></span> <span data-ttu-id="54673-705">Portanto, esse não é o menor envoltória possível que pode se ajustar aos dados.</span><span class="sxs-lookup"><span data-stu-id="54673-705">Therefore, this is not the smallest possible hull that can be fit to the data.</span></span> <span data-ttu-id="54673-706">Mas a experimentação mostrou que ajustar os pontos de amostra de forma muito rígida causa artefatos desinteressantes em imagens, como a falta de um sombreamento suave.</span><span class="sxs-lookup"><span data-stu-id="54673-706">But experimentation has shown that fitting the sample points too tightly causes unappealing artifacts in images, such as a lack of smooth shading.</span></span> <span data-ttu-id="54673-707">O convexa envoltória parece resolver esses problemas.</span><span class="sxs-lookup"><span data-stu-id="54673-707">The convex hull seems to solve these problems.</span></span>

<span data-ttu-id="54673-708">No algoritmo, os valores de aparência de cor são obtidos para um conjunto de pontos amostrados do dispositivo.</span><span class="sxs-lookup"><span data-stu-id="54673-708">In the algorithm, color appearance values are obtained for a set of points sampled from the device.</span></span> <span data-ttu-id="54673-709">Para monitores e impressoras, os valores de aparência de cor são obtidos pela geração de amostras e, em seguida, medindo-os.</span><span class="sxs-lookup"><span data-stu-id="54673-709">For monitors and printers, the color appearance values are obtained by outputting samples, and then measuring them.</span></span> <span data-ttu-id="54673-710">Você também pode criar um modelo de dispositivo e, em seguida, executar dados sintéticos por meio do modelo de dispositivo para prever valores medidos.</span><span class="sxs-lookup"><span data-stu-id="54673-710">You can also create a device model, and then run synthetic data through the device model to predict measured values.</span></span> <span data-ttu-id="54673-711">Os valores medidos são então convertidos do espaço colorimétrico (XYZ) para o espaço de aparência (jab) e o envoltória é disposto em torno dos pontos.</span><span class="sxs-lookup"><span data-stu-id="54673-711">The measured values are then converted from colorimetric space (XYZ) to appearance space (Jab), and the hull is wrapped around the points.</span></span>

<span data-ttu-id="54673-712">O ponto principal para esse algoritmo é que o ponto branco adotado usado na conversão de colorimétrico para aparência espaço não precisa ser o ponto branco médio.</span><span class="sxs-lookup"><span data-stu-id="54673-712">The key point to this algorithm is that the adopted white point used in the conversion from colorimetric to appearance space does not have to be the medium's white point.</span></span> <span data-ttu-id="54673-713">Em vez disso, você pode selecionar um ponto distante dentro da gama e em (ou próximo) do eixo neutro.</span><span class="sxs-lookup"><span data-stu-id="54673-713">Instead, you can select a point farther inside the gamut and on (or near) the neutral axis.</span></span> <span data-ttu-id="54673-714">Esse ponto terá um J-Value de 100.</span><span class="sxs-lookup"><span data-stu-id="54673-714">That point will then have a J-value of 100.</span></span> <span data-ttu-id="54673-715">Os exemplos com um valor Y medido acima do ponto branco adotado acabarão com um valor J maior que 100.</span><span class="sxs-lookup"><span data-stu-id="54673-715">Samples with a measured Y-value higher than the adopted white point will end up with a J-value greater than 100.</span></span>

<span data-ttu-id="54673-716">Se você colocar o ponto branco difuso da cena como o ponto branco adotado para a conversão de espaço de cores, os destaques especulares na cena serão facilmente detectados como tendo um J-Value maior que 100.</span><span class="sxs-lookup"><span data-stu-id="54673-716">If you place the scene's diffuse white point as the adopted white point for the color space conversion, then specular highlights in the scene will be easily detected as having a J-value greater than 100.</span></span>

<span data-ttu-id="54673-717">Como o modelo de cor CIECAM02 é baseado no sistema visual humano, depois que um branco adotado é selecionado, o nível de luminância do ponto preto (J = 0) é determinado automaticamente pelo modelo.</span><span class="sxs-lookup"><span data-stu-id="54673-717">Because the CIECAM02 color model is based on the human visual system, after an adopted white is selected, the luminance level of the black point (J = 0) is automatically determined by the model.</span></span> <span data-ttu-id="54673-718">Se a imagem de entrada tiver um intervalo dinâmico amplo, é possível que haja valores que sejam mapeados para os valores J menores que zero.</span><span class="sxs-lookup"><span data-stu-id="54673-718">If the input image has a wide dynamic range, it is possible that there might be values that map to J-values less than zero.</span></span>

<span data-ttu-id="54673-719">A figura 21 a seguir mostra os neutros de dispositivo em execução no centro das gamas de referência e plausível.</span><span class="sxs-lookup"><span data-stu-id="54673-719">The following Figure 21 shows the device neutrals running through the center of the plausible and reference gamuts.</span></span>

![Diagrama que mostra o eixo neutro do dispositivo adicionado ao limite de gamut.](images/gmmp-image085.png)

<span data-ttu-id="54673-721">**Figura 21** : eixo neutro do dispositivo adicionado ao limite de gamut</span><span class="sxs-lookup"><span data-stu-id="54673-721">**Figure 21** : Device neutral axis added to gamut boundary</span></span>

<span data-ttu-id="54673-722">Todos os mapeamentos de gama envolvem o recorte de um intervalo de entrada para uma gama de saída ou a compactação da gama de entrada para caber na gama de saída.</span><span class="sxs-lookup"><span data-stu-id="54673-722">All gamut mappings involve either clipping an input range to an output gamut, or compressing the input gamut to fit within the output gamut.</span></span> <span data-ttu-id="54673-723">Algoritmos mais complexos são formados pela compactação e recorte em direções diferentes, ou pela divisão da gama em regiões diferentes e, em seguida, pela execução de recorte ou compactação em regiões diferentes.</span><span class="sxs-lookup"><span data-stu-id="54673-723">More complex algorithms are formed by compressing and clipping in different directions, or by dividing the gamut into different regions, and then performing clipping or compression in the different regions.</span></span>

<span data-ttu-id="54673-724">A nova CTE estende esse conceito para dar suporte às regiões de uma gama possível, uma gama plausível e uma gama de referência e permite que o GMAs as mapeie de diferentes maneiras.</span><span class="sxs-lookup"><span data-stu-id="54673-724">The new CTE extends this concept to support the regions of a possible gamut, a plausible gamut, and a reference gamut, and enables GMAs to map them in different ways.</span></span> <span data-ttu-id="54673-725">Além disso, o GMAs tem informações sobre o eixo neutro do dispositivo.</span><span class="sxs-lookup"><span data-stu-id="54673-725">In addition, the GMAs have information about the device neutral axis.</span></span> <span data-ttu-id="54673-726">A discussão a seguir aborda como lidar com situações em que as gamaes de referência e as cores plausívels foram recolhidas entre si.</span><span class="sxs-lookup"><span data-stu-id="54673-726">The following discussion addresses how to handle situations where the plausible gamuts and reference gamuts have collapsed on each other.</span></span>

![Diagrama que mostra o G M A com dois descritores de gamut não recolhidos.](images/gmmp-image091.png)

<span data-ttu-id="54673-728">**Figura 22** : GMA com dois descritores de gamut não recolhidos</span><span class="sxs-lookup"><span data-stu-id="54673-728">**Figure 22** : GMA with two un-collapsed gamut descriptors</span></span>

<span data-ttu-id="54673-729">Você poderá ver este exemplo se você mapear de um dispositivo de entrada, como uma câmera ou um scanner que é caracterizado com um destino reflexivo, para scRGB espaço.</span><span class="sxs-lookup"><span data-stu-id="54673-729">You might see this example if you map from an input device, such as a camera or scanner that is characterized with a reflective target, to scRGB space.</span></span> <span data-ttu-id="54673-730">Aqui, as cores plausível mais claras que as de referência são realces especulares.</span><span class="sxs-lookup"><span data-stu-id="54673-730">Here the plausible colors that are lighter than reference white are specular highlights.</span></span> <span data-ttu-id="54673-731">Na prática, a caracterização de uma câmera com um destino pode não gerar o intervalo completo de valores possíveis na câmera; no entanto, os realces especulares e as cores de desvio são encontradas por natureza.</span><span class="sxs-lookup"><span data-stu-id="54673-731">In practice, characterizing a camera with a target might not generate the full range of values possible in the camera; however, specular highlights and very chromatic colors found in nature would.</span></span> <span data-ttu-id="54673-732">(Os destinos transmissos geralmente têm um patch que é a densidade mínima possível na mídia.</span><span class="sxs-lookup"><span data-stu-id="54673-732">(Transmissive targets usually have a patch that is the minimum density possible on the medium.</span></span> <span data-ttu-id="54673-733">Com esse destino, os destaques especulares se enquadrariam no intervalo do destino.) O preto de referência para um destino reflexivo seria o início da região preta de sombra.</span><span class="sxs-lookup"><span data-stu-id="54673-733">With such a target, specular highlights would fall within the target's range.) The reference black for a reflective target would be the beginning of the shadow black region.</span></span> <span data-ttu-id="54673-734">Ou seja, é provável que haja cores nas sombras mais escuras do que o preto no destino.</span><span class="sxs-lookup"><span data-stu-id="54673-734">That is, there are likely to be colors in the shadows that are darker than the black on the target.</span></span> <span data-ttu-id="54673-735">Se a imagem contiver muito conteúdo interessante nessa região, poderá valer a pena preservar essa variação de tons.</span><span class="sxs-lookup"><span data-stu-id="54673-735">If the image contains a lot of interesting content in that region, it may be worthwhile preserving that tonal variation.</span></span>

![Diagrama que mostra a G M A com uma gama de destino recolhida.](images/gmmp-image095.png)

<span data-ttu-id="54673-737">**Figura 23** : GMA com gama de destino recolhida</span><span class="sxs-lookup"><span data-stu-id="54673-737">**Figure 23** : GMA with collapsed destination gamut</span></span>

<span data-ttu-id="54673-738">A Figura 23 mostra um algoritmo de mapeamento de gamut possível quando a gama de destino só fornece o intervalo de dispositivo branco para preto e não há nenhuma cor possível fora desta gama.</span><span class="sxs-lookup"><span data-stu-id="54673-738">Figure 23 shows one possible gamut mapping algorithm when the destination gamut only provides the range from device white to black, and there are no possible colors outside this gamut.</span></span> <span data-ttu-id="54673-739">Isso provavelmente ocorrerá para dispositivos de saída típicos, como impressoras.</span><span class="sxs-lookup"><span data-stu-id="54673-739">This is likely to happen for typical output devices, such as printers.</span></span> <span data-ttu-id="54673-740">As cores possíveis são mapeadas para a borda da gama de destino.</span><span class="sxs-lookup"><span data-stu-id="54673-740">The possible colors are mapped to the edge of the destination gamut.</span></span> <span data-ttu-id="54673-741">Mas ele não tem uma curva de Tom para o dispositivo de saída.</span><span class="sxs-lookup"><span data-stu-id="54673-741">But it lacks a tone curve for the output device.</span></span> <span data-ttu-id="54673-742">O GMA deve selecionar um ponto neutro de luminância inferior para usar como um destino de mapeamento para o branco de referência.</span><span class="sxs-lookup"><span data-stu-id="54673-742">The GMA must select some neutral point of lower luminance to use as a mapping destination for the reference white.</span></span> <span data-ttu-id="54673-743">Um algoritmo sofisticado pode fazer isso histogramming o lightnesses na imagem de origem e ver quantas estão no intervalo de espera, mas mais claro do que o branco de referência.</span><span class="sxs-lookup"><span data-stu-id="54673-743">A sophisticated algorithm can do this by histogramming the lightnesses in the source image and seeing how many fall in the range of expected but lighter than the reference white.</span></span> <span data-ttu-id="54673-744">Quanto mais lightnesses, mais espaço é necessário no dispositivo de destino entre os pontos mapeados para os realces especulares e o branco de referência.</span><span class="sxs-lookup"><span data-stu-id="54673-744">The more lightnesses, the more space is required in the destination device between the mapped points for the specular highlights and reference white.</span></span> <span data-ttu-id="54673-745">Um algoritmo mais simples pode escolher uma distância arbitrária abaixo da escala de claridade do dispositivo branco, como 5 por cento.</span><span class="sxs-lookup"><span data-stu-id="54673-745">A simpler algorithm might pick an arbitrary distance down the lightness scale from device white, such as 5 percent.</span></span> <span data-ttu-id="54673-746">Uma abordagem semelhante se aplica para o mapeamento do preto máximo de preto e sombra.</span><span class="sxs-lookup"><span data-stu-id="54673-746">A similar approach applies for the mapping of the maximum black and shadow black.</span></span>

<span data-ttu-id="54673-747">Depois de gerar a curva de Tom de destino, você poderá mapear um método semelhante ao usado na Figura 23 anterior.</span><span class="sxs-lookup"><span data-stu-id="54673-747">After you generate the destination tone curve, you can map in a method similar to that used in the preceding Figure 23.</span></span> <span data-ttu-id="54673-748">Todos os pontos na curva de Tom de destino ficarão dentro da gama do dispositivo, e todos os pontos no mapeamento devem estar dentro da gama do dispositivo.</span><span class="sxs-lookup"><span data-stu-id="54673-748">All points in the destination tone curve will fall within the device gamut, and all points in the mapping must fall within the device gamut.</span></span>

<span data-ttu-id="54673-749">Se você reverte os valores à esquerda e as figuras à direita e as direções das setas na Figura 23, você pode descrever o caso em que a imagem de origem tem apenas uma gama de referência e as três gamas do dispositivo de saída não foram recolhidas entre si.</span><span class="sxs-lookup"><span data-stu-id="54673-749">If you reverse the left figures and right figures, and the directions of the arrows in Figure 23, you can describe the case where the source image has only a reference gamut, and the three gamuts of the output device have not collapsed onto each other.</span></span> <span data-ttu-id="54673-750">Um exemplo disso pode ser o mapeamento de um monitor para o scRGB.</span><span class="sxs-lookup"><span data-stu-id="54673-750">An example of this might be mapping from a monitor to scRGB.</span></span> <span data-ttu-id="54673-751">Novamente, o GMA deve sintetizar os pontos de controle para os cinco pontos na curva de Tom da imagem de origem.</span><span class="sxs-lookup"><span data-stu-id="54673-751">Again, the GMA must synthesize the control points for the five points on the tone curve for the source image.</span></span> <span data-ttu-id="54673-752">Alguns mapeamentos podem colocar todos os pontos da curva de Tom dentro da gama do dispositivo scRGB, enquanto outros mapeamentos podem usar mais da gama scRGB mapeando o branco difuso para a branca de referência e permitindo que o branco especular seja mapeado para um valor mais claro.</span><span class="sxs-lookup"><span data-stu-id="54673-752">Some mappings might put all points of the tone curve within the scRGB device gamut, while other mappings might use more of the scRGB gamut by mapping diffuse white to the reference white and allowing specular white to map to a lighter value.</span></span>

<span data-ttu-id="54673-753">Por fim, você tem o caso em que ambos os dispositivos têm apenas a gama de referência, que é a forma como a maioria dos algoritmos de mapeamento de gama funciona.</span><span class="sxs-lookup"><span data-stu-id="54673-753">Finally, you have the case where both devices have only the reference gamut, which is how most gamut mapping algorithms work.</span></span> <span data-ttu-id="54673-754">Portanto, você pode resolver isso apenas voltando para os algoritmos atuais.</span><span class="sxs-lookup"><span data-stu-id="54673-754">So you can resolve this by just falling back to current algorithms.</span></span> <span data-ttu-id="54673-755">Como alternativa, se você tiver uma maneira razoável de determinar os cinco pontos de referência para os dispositivos de origem e de destino, poderá organizar para mapear os pontos de referência.</span><span class="sxs-lookup"><span data-stu-id="54673-755">Alternatively, if you have a reasonable way to determine the five reference points for the source and destination devices, then you can arrange to map the reference points.</span></span>

<span data-ttu-id="54673-756">As gamas de dispositivos contêm mais do que os cinco pontos de referência no eixo neutro.</span><span class="sxs-lookup"><span data-stu-id="54673-756">Device gamuts contain more than the five reference points on the neutral axis.</span></span> <span data-ttu-id="54673-757">Elas representam apenas os limites entre regiões potenciais na imagem.</span><span class="sxs-lookup"><span data-stu-id="54673-757">These just represent the boundaries between potential regions in the image.</span></span> <span data-ttu-id="54673-758">Entre cada um dos pontos de referência, você pode usar qualquer uma das técnicas de mapeamento de gamut existentes.</span><span class="sxs-lookup"><span data-stu-id="54673-758">Between each of the reference points, you can use any of the existing gamut mapping techniques.</span></span> <span data-ttu-id="54673-759">Portanto, você pode cortar o intervalo de cores inesperadas e compactar todas as cores entre o esperado branco e o preto, ou você pode cortar todas as cores fora do intervalo de referência e compactar dentro desse intervalo.</span><span class="sxs-lookup"><span data-stu-id="54673-759">So you might clip the range of unexpected colors, and compress all colors between the expected white and black, or you might clip all colors outside the reference range and compress within that range.</span></span> <span data-ttu-id="54673-760">Há muitas possibilidades, que podem ser implementadas em diferentes GMAs.</span><span class="sxs-lookup"><span data-stu-id="54673-760">There are many possibilities, which can be implemented in different GMAs.</span></span> <span data-ttu-id="54673-761">Além disso, o GMAs pode compactar e cortar de maneiras diferentes.</span><span class="sxs-lookup"><span data-stu-id="54673-761">Further, the GMAs can compress and clip in different ways.</span></span> <span data-ttu-id="54673-762">Todas essas combinações são abordadas nessa invenção.</span><span class="sxs-lookup"><span data-stu-id="54673-762">All of those combinations are covered within this invention.</span></span>

<span data-ttu-id="54673-763">Até agora nesta discussão, a gama foi tratada como se fosse apenas uma função do dispositivo no qual a imagem foi criada, capturada ou exibida.</span><span class="sxs-lookup"><span data-stu-id="54673-763">So far in this discussion, the gamut has been treated as if it were solely a function of the device on which the image was created, captured, or displayed.</span></span> <span data-ttu-id="54673-764">No entanto, não há nenhum motivo pelo qual todas as imagens de um dispositivo devem ter a mesma gama.</span><span class="sxs-lookup"><span data-stu-id="54673-764">However, there is no reason why all images for a device must have the same gamut.</span></span> <span data-ttu-id="54673-765">O GMAs depende dos dados no GBD.</span><span class="sxs-lookup"><span data-stu-id="54673-765">The GMAs depend on the data in the GBD.</span></span> <span data-ttu-id="54673-766">Se o descritor for alterado entre as imagens, não haverá nenhuma maneira para o GMAs saber.</span><span class="sxs-lookup"><span data-stu-id="54673-766">If the descriptor is changed between images, there is no way for the GMAs to know.</span></span> <span data-ttu-id="54673-767">Em particular, se as imagens não tiverem realces especulares, o GMAs executará melhor se o descritor de gamut não mostrar que há cores mais claras do que o branco difuso.</span><span class="sxs-lookup"><span data-stu-id="54673-767">In particular, if images have no specular highlights, GMAs perform better if the gamut descriptor does not show that there are colors lighter than diffuse white.</span></span>

<span data-ttu-id="54673-768">Na nova arquitetura da CTE, é possível usar mais de um GMA.</span><span class="sxs-lookup"><span data-stu-id="54673-768">In the new CTE architecture, it is possible to use more than one GMA.</span></span> <span data-ttu-id="54673-769">O uso de vários GMAs é inerentemente mal definido.</span><span class="sxs-lookup"><span data-stu-id="54673-769">Using multiple GMAs is inherently ill-defined.</span></span> <span data-ttu-id="54673-770">Por exemplo, se um dispositivo de captura associar um GMA à sua "aparência", ele tende a fazer isso com uma gama de destino "direcionada".</span><span class="sxs-lookup"><span data-stu-id="54673-770">For example, if a capture device associates a GMA with its "look and feel," it tends to do so with a "targeted" destination gamut.</span></span> <span data-ttu-id="54673-771">O mesmo é verdadeiro para dispositivos de saída e gamut de origem "direcionados".</span><span class="sxs-lookup"><span data-stu-id="54673-771">The same is true for output devices and "targeted" source gamuts.</span></span> <span data-ttu-id="54673-772">A gama sRGB é uma gama implícita de destino.</span><span class="sxs-lookup"><span data-stu-id="54673-772">The sRGB gamut is one commonly targeted implied gamut.</span></span> <span data-ttu-id="54673-773">Portanto, é altamente recomendável que você use um único GMA, se a previsibilidade for uma prioridade.</span><span class="sxs-lookup"><span data-stu-id="54673-773">Therefore, it is strongly recommended that you use a single GMA, if predictability is a priority.</span></span> <span data-ttu-id="54673-774">Um fluxo de trabalho do GMA único deve ser o padrão para todos os fluxos de trabalho, especialmente fluxos de trabalho do consumidor e do Prosumidor.</span><span class="sxs-lookup"><span data-stu-id="54673-774">A single GMA workflow should be the default for all workflows, especially consumer and prosumer workflows.</span></span> <span data-ttu-id="54673-775">Embora o mapeamento de gamut para a reprodução preferida deva ser feito uma vez, há instâncias em que vários processos de mapeamento são incluídos.</span><span class="sxs-lookup"><span data-stu-id="54673-775">While gamut mapping for preferred reproduction should be done one time, there are instances where multiple mapping processes are included.</span></span> <span data-ttu-id="54673-776">Primeiro, para prova, você faz um mapeamento preferencial para a gama do dispositivo de destino final e, em seguida, um processamento colorimétrico para a gama do dispositivo de prova de notação.</span><span class="sxs-lookup"><span data-stu-id="54673-776">First, for proofing, you do a preferred mapping to the gamut of the final target device, and then a colorimetric rendering to the gamut of the proofing device.</span></span> <span data-ttu-id="54673-777">Em segundo lugar, alguns tipos de mapeamento são usados para alterar as características da imagem, mas não são incluídos para mapear para uma gama do dispositivo, por exemplo, ajustar a curva de Tom ou a desvio.</span><span class="sxs-lookup"><span data-stu-id="54673-777">Second, some types of mapping are used to alter the characteristics of the image, but aren't included to map to a device gamut, for example, adjusting the tone curve or the chromaticity.</span></span> <span data-ttu-id="54673-778">Se vários GMAs forem usados, a interface de transformação usará uma matriz de mapas de gamut limitados, ou seja, mapas de gamut que foram inicializados com um par de descrições de limites de gama.</span><span class="sxs-lookup"><span data-stu-id="54673-778">If multiple GMAs are used, the transform interface takes an array of bound gamut maps, that is, gamut maps that have been initialized with a pair of gamut boundary descriptions.</span></span> <span data-ttu-id="54673-779">Quando há mais de um mapa de gamut, o limite de gama de entrada para um mapa de gama com sucesso deve ser igual ao limite de gama de saída de seu antecessor.</span><span class="sxs-lookup"><span data-stu-id="54673-779">When there is more than one gamut map, the input gamut boundary for a succeeding gamut map must be the same as the output gamut boundary of its predecessor.</span></span>

<span data-ttu-id="54673-780">A função de limite de gama de dispositivos usa o mecanismo de modelo de dispositivo e parâmetros analíticos e deriva um limite de gama de dispositivos de cores descrito como uma lista de vértices ordenada do convexa envoltória da gama do dispositivo.</span><span class="sxs-lookup"><span data-stu-id="54673-780">The device gamut boundary function takes the device model engine and analytical parameters and derives a color device gamut boundary described as an ordered vertex list of the convex hull of the device gamut.</span></span> <span data-ttu-id="54673-781">A lista de vértices ordenados é armazenada em CIEJab.</span><span class="sxs-lookup"><span data-stu-id="54673-781">The ordered vertex list is stored in CIEJab.</span></span> <span data-ttu-id="54673-782">A estrutura da lista de vértices ordenados é otimizada para aceleração de hardware pelo DirectX.</span><span class="sxs-lookup"><span data-stu-id="54673-782">The structure of the ordered vertex list is optimized for hardware acceleration by DirectX.</span></span> <span data-ttu-id="54673-783">Essa abordagem tem muitas soluções bem conhecidas (pesquise "convexa envoltória DirectX" na Web e você obtém mais de 100 ocorrências).</span><span class="sxs-lookup"><span data-stu-id="54673-783">This approach has many well known solutions (search for "convex hull DirectX" on the web and you get well over 100 hits).</span></span> <span data-ttu-id="54673-784">Há também uma referência de 1983 neste tópico (teoria de gráficos de computador e aplicativo, "Shiphulls, superfícies b-spline e CADCAM" PP. 34-49), com referências de 1970 a 1982 no tópico.</span><span class="sxs-lookup"><span data-stu-id="54673-784">There is also a reference from 1983 on this topic (Computer Graphics Theory and Application, "Shiphulls, b-spline surfaces and cadcam" pp. 34-49), with references dating from 1970 to 1982 on the topic.</span></span>

<span data-ttu-id="54673-785">Duas técnicas diferentes podem ser usadas para calcular os triângulos no Shell de gamut.</span><span class="sxs-lookup"><span data-stu-id="54673-785">Two different techniques can be used to compute the triangles in the gamut shell.</span></span> <span data-ttu-id="54673-786">Para outros dispositivos diferentes de dispositivos RGB aditivos, você computa um convexa envoltória.</span><span class="sxs-lookup"><span data-stu-id="54673-786">For other devices other than additive RGB devices, you compute a convex hull.</span></span> <span data-ttu-id="54673-787">Você pode considerar investigar o suporte não convexa envoltória para outros dispositivos se tiver acesso direto a tais dispositivos para validar a robustez, o desempenho e a fidelidade dos algoritmos.</span><span class="sxs-lookup"><span data-stu-id="54673-787">You can consider investigating non-convex hull support for other devices if you have direct access to such devices to validate the robustness, performance, and fidelity of the algorithms.</span></span> <span data-ttu-id="54673-788">Esse é um processo bem conhecido que não requer mais descrição.</span><span class="sxs-lookup"><span data-stu-id="54673-788">This is a well-known process that does not require further description.</span></span> <span data-ttu-id="54673-789">A técnica usada para dispositivos RGB aditivos é descrita a seguir.</span><span class="sxs-lookup"><span data-stu-id="54673-789">The technique used for additive RGB devices is described as follows.</span></span>

<span data-ttu-id="54673-790">Diferentes GBDs têm vantagens e desvantagens.</span><span class="sxs-lookup"><span data-stu-id="54673-790">Different GBDs have advantages and drawbacks.</span></span> <span data-ttu-id="54673-791">A representação convexa envoltória garante boas Propriedades geométricas, como fatias de matiz convexa que fornecem um ponto de interseção exclusivo com um raio de um ponto no eixo neutro.</span><span class="sxs-lookup"><span data-stu-id="54673-791">The convex hull representation guarantees nice geometric properties, such as convex hue slices that provide a unique intersection point with a ray emanating from a point on the neutral axis.</span></span> <span data-ttu-id="54673-792">A desvantagem da representação convexa envoltória também é convexity.</span><span class="sxs-lookup"><span data-stu-id="54673-792">The downside of the convex hull representation is also convexity.</span></span> <span data-ttu-id="54673-793">É conhecido que muitos dispositivos, especificamente para exibir dispositivos, têm gamas que estão longe de serem convexas.</span><span class="sxs-lookup"><span data-stu-id="54673-793">It is known that many devices, specifically display devices, have gamuts that are far from being convex.</span></span> <span data-ttu-id="54673-794">Se a gama real se desviar significativamente da suposição convexity, a representação convexa envoltória seria imprecisa, possivelmente na medida em que ela não representa a realidade.</span><span class="sxs-lookup"><span data-stu-id="54673-794">If the actual gamut deviates significantly from the convexity assumption, the convex hull representation would be inaccurate, possibly to the extent that it doesn't represent reality.</span></span>

<span data-ttu-id="54673-795">Depois de adotar um GBD que fornece uma representação razoavelmente precisa da gama real, surgem outros problemas, devido ao grande conceito de fatia de matiz.</span><span class="sxs-lookup"><span data-stu-id="54673-795">After you adopt a GBD that gives a reasonably accurate representation of the actual gamut, other problems arise, some due to the very concept of hue slice.</span></span> <span data-ttu-id="54673-796">Há pelo menos duas situações pathologicals.</span><span class="sxs-lookup"><span data-stu-id="54673-796">There are at least two pathological situations.</span></span> <span data-ttu-id="54673-797">Na Figura 24 a seguir, uma gama de CRT fornece aumento de fatias de matiz com "ilhas".</span><span class="sxs-lookup"><span data-stu-id="54673-797">In the following Figure 24, a CRT gamut gives rise to hue slices with "islands."</span></span> <span data-ttu-id="54673-798">Na figura 25, uma gama de impressora dá a elevação a uma fatia de matiz com parte do eixo neutro ausente.</span><span class="sxs-lookup"><span data-stu-id="54673-798">In Figure 25, a printer gamut gives rise to a hue slice with part of the neutral axis missing.</span></span> <span data-ttu-id="54673-799">As fatias de matiz pathological não são causadas por limites de gamut especialmente pathological nesses casos.</span><span class="sxs-lookup"><span data-stu-id="54673-799">The pathological hue slices are not caused by particularly pathological gamut boundaries in these cases.</span></span> <span data-ttu-id="54673-800">Elas são causadas pelo conceito de fatia de matiz, porque (a) ela é tomada ao longo do matiz constante e (b) leva apenas uma metade do plano que corresponde ao ângulo de matiz.</span><span class="sxs-lookup"><span data-stu-id="54673-800">They are caused by the very concept of hue slice, because (a) it is taken along constant hue, and (b) it only takes one-half of the plane that corresponds to the hue angle.</span></span>

![Diagrama que mostra uma exibição superior e uma exibição lateral da ' curva em ' no matiz azul.](images/gmmp-image097.jpg)

<span data-ttu-id="54673-802">**Figura 24** : um monitor CRT típico tem uma gama que mostra "curva" de peculiarização no matiz azul.</span><span class="sxs-lookup"><span data-stu-id="54673-802">**Figure 24** : A typical CRT monitor has a gamut that shows peculiar "curving in" in the blue hues.</span></span> <span data-ttu-id="54673-803">Se as fatias de matiz forem tomadas nesse intervalo de matiz, as ilhas isoladas poderão aparecer nas fatias de matiz.</span><span class="sxs-lookup"><span data-stu-id="54673-803">If hue slices are taken within this hue range, isolated islands may appear in the hue slices.</span></span>

![Diagrama de uma gama com um ' gap ' em seu eixo neutro.](images/gmmp-image099.jpg)

<span data-ttu-id="54673-805">**Figura 25** : uma impressora pode ter uma gama com "Gap" em seu eixo neutro.</span><span class="sxs-lookup"><span data-stu-id="54673-805">**Figure 25** : A printer may have a gamut that has "gap" in its neutral axis.</span></span> <span data-ttu-id="54673-806">Quando uma fatia de matiz é tomada (que é apenas uma metade do plano), há um "recuo" na parte do limite que é o eixo neutro.</span><span class="sxs-lookup"><span data-stu-id="54673-806">When a hue slice is taken (which is only one-half the plane), there is a "dent" on the part of the boundary that is the neutral axis.</span></span> <span data-ttu-id="54673-807">Isso pode ser difícil de resolver forma algorítmica.</span><span class="sxs-lookup"><span data-stu-id="54673-807">This can be hard to resolve algorithmically.</span></span>

<span data-ttu-id="54673-808">Para resolver esses pathologies, é proposta uma nova estrutura que abandona o conceito de fatia de matiz que foi usado como ponto de partida.</span><span class="sxs-lookup"><span data-stu-id="54673-808">To resolve these pathologies, a new framework is proposed that abandons the concept of hue slice that used as the starting point.</span></span> <span data-ttu-id="54673-809">Em vez disso, a estrutura usa o conjunto de "elementos de linha de limite" ou linhas que se encontram no limite de gama.</span><span class="sxs-lookup"><span data-stu-id="54673-809">Instead, the framework uses the set of "boundary line elements," or lines that lie on the gamut boundary.</span></span> <span data-ttu-id="54673-810">Eles não fornecem necessariamente uma visualização geométrica coerente, como fatias de matiz, mas dão suporte a todas as operações de gamut comuns.</span><span class="sxs-lookup"><span data-stu-id="54673-810">They do not necessarily provide a coherent geometric visualization like hue slices, but they support all the common gamut operations.</span></span> <span data-ttu-id="54673-811">Além de resolver os problemas mencionados anteriormente, essa abordagem também sugere que a construção de fatias de matiz, mesmo quando possível, seja um desperdício computacional.</span><span class="sxs-lookup"><span data-stu-id="54673-811">Besides solving the problems mentioned previously, this approach also suggests that the construction of hue slices, even when it is possible, is computationally wasteful.</span></span>

### <a name="triangulation-of-the-gamut-boundary"></a><span data-ttu-id="54673-812">Triangulação do limite de gama</span><span class="sxs-lookup"><span data-stu-id="54673-812">Triangulation of the Gamut Boundary</span></span>

<span data-ttu-id="54673-813">O ponto de partida é um GBD que consiste em uma triangulação do limite de gama.</span><span class="sxs-lookup"><span data-stu-id="54673-813">The starting point is a GBD consisting of a triangulation of the gamut boundary.</span></span> <span data-ttu-id="54673-814">Métodos conhecidos de construir GBDs geralmente fornecem essa triangulação.</span><span class="sxs-lookup"><span data-stu-id="54673-814">Known methods of constructing GBDs usually provide that triangulation.</span></span> <span data-ttu-id="54673-815">Para a concretação, um método de construir GBDs para dispositivos aditivos seu espaço de dispositivo é descrito aqui.</span><span class="sxs-lookup"><span data-stu-id="54673-815">For concreteness, one method of constructing GBDs for additive devices its device space is described here.</span></span> <span data-ttu-id="54673-816">Esses dispositivos incluem monitores (baseados em CRT e baseado em LCD) e projetores.</span><span class="sxs-lookup"><span data-stu-id="54673-816">These devices include monitors (both CRT-based and LCD-based) and projectors.</span></span> <span data-ttu-id="54673-817">A geometria simples do cubo permite que você introduza um malha regular no cubo.</span><span class="sxs-lookup"><span data-stu-id="54673-817">The simple geometry of the cube enables you to introduce a regular lattice on the cube.</span></span> <span data-ttu-id="54673-818">As faces de limite do cubo podem ser trianguladas em várias modas, como a mostrada na Figura 26.</span><span class="sxs-lookup"><span data-stu-id="54673-818">The boundary faces of the cube can be triangulated in a number of fashions, such as the one shown in Figure 26.</span></span> <span data-ttu-id="54673-819">A arquitetura fornece um modelo de dispositivo para o dispositivo para que os valores de colorimétrico dos pontos malha possam ser obtidos forma algorítmica ou que as medidas tenham sido feitas diretamente para esses pontos.</span><span class="sxs-lookup"><span data-stu-id="54673-819">The architecture provides either a device model for the device so that colorimetric values of the lattice points can be obtained algorithmically, or measurements have been made directly for those points.</span></span> <span data-ttu-id="54673-820">A arquitetura também fornece CIECAM02, para que você possa assumir que os dados iniciais já foram mapeados para o espaço CIECAM02 jab.</span><span class="sxs-lookup"><span data-stu-id="54673-820">The architecture also provides CIECAM02, so that you can assume the starting data has already been mapped into CIECAM02 Jab space.</span></span> <span data-ttu-id="54673-821">Em seguida, cada ponto de malha nas faces de limite do cubo RGB tem um ponto correspondente no espaço jab.</span><span class="sxs-lookup"><span data-stu-id="54673-821">Then each lattice point on the boundary faces of the RGB cube has a corresponding point in Jab space.</span></span> <span data-ttu-id="54673-822">As conexões de pontos que formam o conjunto de triângulos no espaço RGB também induzim a um conjunto de triângulos no espaço jab.</span><span class="sxs-lookup"><span data-stu-id="54673-822">The connections of points that form the set of triangles in RGB space also induces a set of triangles in Jab space.</span></span> <span data-ttu-id="54673-823">Esse conjunto de triângulos forma uma triangulação razoável do limite de gama se (a) o malha no cubo RGB é suficientemente suficiente e (b) a transformação do espaço do dispositivo para o espaço de cores uniforme é topologicamente bem-comparada; ou seja, ele mapeia o limite para o limite e não vira a gama para dentro para que os pontos interiores se tornem pontos de limite.</span><span class="sxs-lookup"><span data-stu-id="54673-823">This set of triangles forms a reasonable triangulation of the gamut boundary if (a) the lattice on the RGB cube is fine enough, and (b) the transformation from device space to the uniform color space is topologically well-behaved; that is, it maps boundary to boundary, and it doesn't turn the gamut inside out so that interior points become boundary points.</span></span>

![Diagrama que mostra um método simples para triangluate o limite de gama de um dispositivo com R G B como seu espaço de dispositivo.](images/gmmp-image100.png)

<span data-ttu-id="54673-825">**Figura 26** : um método simples para triangular o limite de gama de um dispositivo com RGB como seu espaço de dispositivo</span><span class="sxs-lookup"><span data-stu-id="54673-825">**Figure 26** : A simple method to triangulate the gamut boundary of a device with RGB as its device space</span></span>

### <a name="boundary-line-elements"></a><span data-ttu-id="54673-826">Elementos de linha de limite</span><span class="sxs-lookup"><span data-stu-id="54673-826">Boundary Line Elements</span></span>

<span data-ttu-id="54673-827">Central para essa estrutura é o conceito de elementos de linha de limite; um conjunto de segmentos de linha que (a) se situam no limite de gamut e (b) está em um plano.</span><span class="sxs-lookup"><span data-stu-id="54673-827">Central to this framework is the concept of boundary line elements; a set of line segments that (a) lie on the gamut boundary, and (b) lie on a plane.</span></span> <span data-ttu-id="54673-828">Nesse caso, o plano é um plano de matiz.</span><span class="sxs-lookup"><span data-stu-id="54673-828">In this case, the plane is a hue plane.</span></span> <span data-ttu-id="54673-829">Cada segmento de linha é o resultado da interseção do plano com um triângulo de limite de gamut.</span><span class="sxs-lookup"><span data-stu-id="54673-829">Each line segment is the result of intersecting the plane with a gamut boundary triangle.</span></span> <span data-ttu-id="54673-830">Embora muitos pesquisadores tenham usado a construção de interseção de um plano com triângulos de limite, eles geralmente analisam a relação entre esses segmentos de linha e tentam construir um objeto geométrico coerente dos segmentos de linha.</span><span class="sxs-lookup"><span data-stu-id="54673-830">Although many researchers have used the construction of intersecting a plane with boundary triangles, they generally analyze the relationship among these line segments, and attempt to construct a coherent geometric object out of the line segments.</span></span> <span data-ttu-id="54673-831">Algoritmos diferentes foram elaborados para seguir esses segmentos de linha um após o outro até que uma fatia de matiz inteira seja obtida e muitas tentativas tenham sido feitas para acelerar o processo de pesquisa.</span><span class="sxs-lookup"><span data-stu-id="54673-831">Different algorithms have been devised to follow these line segments one after the other until a whole hue slice is obtained, and many attempts have been made to speed up the process of searching.</span></span>

<span data-ttu-id="54673-832">Essa abordagem é diferente.</span><span class="sxs-lookup"><span data-stu-id="54673-832">This approach is different.</span></span> <span data-ttu-id="54673-833">Você cruza o plano com os triângulos para obter os segmentos de linha.</span><span class="sxs-lookup"><span data-stu-id="54673-833">You intersect the plane with the triangles to obtain the line segments.</span></span> <span data-ttu-id="54673-834">Em seguida, você considera esses segmentos de linha como os objetos conceituais *básicos* .</span><span class="sxs-lookup"><span data-stu-id="54673-834">You then consider these line segments as the *basic* conceptual objects.</span></span> <span data-ttu-id="54673-835">É necessário analisar a relação entre os segmentos de linha; Você não precisa saber como eles são interconectados entre si.</span><span class="sxs-lookup"><span data-stu-id="54673-835">It is necessary to analyze the relationship among the line segments; you don't have to know how they are interconnected with each other.</span></span> <span data-ttu-id="54673-836">Esse ponto de vista resolve o problema da fatia de matiz com ilhas.</span><span class="sxs-lookup"><span data-stu-id="54673-836">This point of view solves the problem of hue slice with islands.</span></span> <span data-ttu-id="54673-837">As abordagens conhecidas que tentam construir a fatia de matiz pressupõem que, se uma começa com um segmento de linha e a segue para o próximo segmento de linha, e assim por diante; Ele eventualmente leva ao ponto de partida, ponto em que uma fatia de matiz inteira seria construída.</span><span class="sxs-lookup"><span data-stu-id="54673-837">The known approaches that attempt to construct hue slice assume that, if one starts with one line segment and follows it to the next line segment, and so on; it eventually leads back to the starting point, at which point a whole hue slice would be constructed.</span></span> <span data-ttu-id="54673-838">Infelizmente, essa abordagem perderia a ilha (e, no pior cenário, o continente).</span><span class="sxs-lookup"><span data-stu-id="54673-838">Unfortunately, this approach would miss the island (and in the worst scenario, the continent).</span></span> <span data-ttu-id="54673-839">Não insiste em obter uma imagem geométrica coerente; ou seja, a fatia de matiz, você pode manipular o problema da ilha sem esforço.</span><span class="sxs-lookup"><span data-stu-id="54673-839">By not insisting on obtaining a coherent geometric picture; that is, hue slice, you can handle the island problem effortlessly.</span></span> <span data-ttu-id="54673-840">Outra diferença importante nessa abordagem é que, para acelerar a construção de segmentos de linha, ele usa um "filtro de triângulo".</span><span class="sxs-lookup"><span data-stu-id="54673-840">Another important difference in this approach is that, to speed up the construction of line segments, it uses a "triangle filter."</span></span> <span data-ttu-id="54673-841">O filtro de triângulo gera determinados triângulos que definitivamente não produzirão segmentos de linha que seriam úteis na operação de gamut atual.</span><span class="sxs-lookup"><span data-stu-id="54673-841">The triangle filter throws out certain triangles that will definitely not produce line segments that would be useful in the current gamut operation.</span></span> <span data-ttu-id="54673-842">Como a interseção de um triângulo com o plano é cara computacionalmente, isso melhora a velocidade.</span><span class="sxs-lookup"><span data-stu-id="54673-842">Because intersecting a triangle with the plane is expensive computationally, this improves speed.</span></span> <span data-ttu-id="54673-843">Um efeito colateral é que, você não pode construir a fatia de matiz porque alguns segmentos de linha estavam ausentes devido à filtragem de triângulo.</span><span class="sxs-lookup"><span data-stu-id="54673-843">A side effect is that, you cannot construct hue slice because some line segments would be missing due to the triangle filtering.</span></span>

### <a name="gamut-operation-checkgamut"></a><span data-ttu-id="54673-844">Operação de gama: CheckGamut</span><span class="sxs-lookup"><span data-stu-id="54673-844">Gamut Operation: CheckGamut</span></span>

<span data-ttu-id="54673-845">O exemplo a seguir explicará como o Framework funciona e como o CheckGamut é executado, ou seja, a operação de verificar se uma cor está em gamut.</span><span class="sxs-lookup"><span data-stu-id="54673-845">The following example will explain how the framework works, and how CheckGamut is carried out, that is, the operation of checking if a color is in-gamut.</span></span>

<span data-ttu-id="54673-846">A estrutura geral é ilustrada na Figura 27 a seguir.</span><span class="sxs-lookup"><span data-stu-id="54673-846">The general framework is illustrated in the following Figure 27.</span></span> <span data-ttu-id="54673-847">Há vários componentes.</span><span class="sxs-lookup"><span data-stu-id="54673-847">There are various components.</span></span> <span data-ttu-id="54673-848">Os componentes rotulados em itálico são componentes que podem ser diferentes na implementação, dependendo da operação de gamut em questão.</span><span class="sxs-lookup"><span data-stu-id="54673-848">The components labeled in italics are components that may be different in implementation depending on the gamut operation in question.</span></span> <span data-ttu-id="54673-849">Os outros componentes são invariáveis em todas as operações de gama.</span><span class="sxs-lookup"><span data-stu-id="54673-849">The other components are invariant across all gamut operations.</span></span> <span data-ttu-id="54673-850">Para começar, a ***entrada*** é um conjunto de atributos de cor.</span><span class="sxs-lookup"><span data-stu-id="54673-850">To begin, the ***Input*** is a set of color attributes.</span></span> <span data-ttu-id="54673-851">No caso de CheckGamut, é a cor da consulta.</span><span class="sxs-lookup"><span data-stu-id="54673-851">In the case of CheckGamut, it is the query color.</span></span> <span data-ttu-id="54673-852">Na Figura 27 e na discussão a seguir, supõe-se que o ângulo de matiz está entre os atributos de cor de entrada ou pode ser obtido deles.</span><span class="sxs-lookup"><span data-stu-id="54673-852">In Figure 27 and the following discussion, it is assumed that the hue angle is either among the input color attributes, or can be obtained from them.</span></span> <span data-ttu-id="54673-853">Isso é claramente o caso se a entrada for o ponto de cor inteiro, seja em jab ou JCh, da qual você pode calcular o ângulo de matiz.</span><span class="sxs-lookup"><span data-stu-id="54673-853">This is clearly the case if the input is the whole color point, either in Jab or JCh, from which you can then compute the hue angle.</span></span> <span data-ttu-id="54673-854">Observe que o ângulo de matiz só é necessário porque os planos de matiz estão sendo usados.</span><span class="sxs-lookup"><span data-stu-id="54673-854">Note that the hue angle is only needed because hue planes are being used.</span></span> <span data-ttu-id="54673-855">Dependendo da operação de gama em questão, talvez não seja necessário usar o plano de matiz.</span><span class="sxs-lookup"><span data-stu-id="54673-855">Depending on the gamut operation in question, it might not be necessary to use the hue plane.</span></span> <span data-ttu-id="54673-856">Por exemplo, na construção da rotina CheckGamut, talvez você queira usar planos de constante J. Essa é uma generalidade que não será usada ou discutida ainda mais; Mas pode ser útil lembrar dessa flexibilidade da metodologia para dar suporte a outras operações de gama quando o plano de matizes pode não ser a melhor opção.</span><span class="sxs-lookup"><span data-stu-id="54673-856">For example, in the construction of the routine CheckGamut, you might want to use planes of constant J. This is a generality that will not be used or discussed further; but it might be helpful to remember this flexibility of the methodology to support other gamut operations when hue plane might not be the best choice.</span></span>

![Diagrama que mostra o fluxo para dar suporte a operações de gamut.](images/gmmp-image112.jpg)

<span data-ttu-id="54673-858">**Figura 27** : a estrutura para oferecer suporte a operações de gamut</span><span class="sxs-lookup"><span data-stu-id="54673-858">**Figure 27** : The framework to support gamut operations</span></span>

<span data-ttu-id="54673-859">O ângulo de matiz, que é obtido diretamente das entradas ou computadas das entradas, é usado para inicializar o plano de matiz rotulado como **plano de matiz completo** na figura.</span><span class="sxs-lookup"><span data-stu-id="54673-859">The hue angle, which is obtained directly from the inputs or computed from the inputs, is used to initialize the hue plane labeled **Full Hue Plane** in the figure.</span></span> <span data-ttu-id="54673-860">"Full" é enfatizado porque este é o plano completo, não apenas o meio-plano que contém o matiz.</span><span class="sxs-lookup"><span data-stu-id="54673-860">"Full" is emphasized because this is the full plane, not just the half-plane containing the hue.</span></span> <span data-ttu-id="54673-861">O plano completo contém o ângulo de matiz de entrada e o ângulo 180 graus opostos a ele.</span><span class="sxs-lookup"><span data-stu-id="54673-861">The full plane contains both the input hue angle and the angle 180 degrees opposite to it.</span></span> <span data-ttu-id="54673-862">A principal funcionalidade do plano de matiz é a função Intersect, que é explicada na subseção a seguir, plano de matiz completo: Intersect.</span><span class="sxs-lookup"><span data-stu-id="54673-862">The key functionality of the hue plane is the Intersect function, which is explained in the following subsection, Full Hue Plane: Intersect.</span></span> <span data-ttu-id="54673-863">Suponha que o GBD já tenha sido construído e que o conjunto de **triângulos de limite de gamut** esteja disponível.</span><span class="sxs-lookup"><span data-stu-id="54673-863">Assume that the GBD has already been constructed, and the set of **Gamut Boundary Triangles** is available.</span></span> <span data-ttu-id="54673-864">Interseccionar os triângulos que têm sobreviveram do filtro \* de *_triângulo_* _ com o plano de matiz usando a interseção.</span><span class="sxs-lookup"><span data-stu-id="54673-864">Intersect the triangles that have survived the \**_Triangle Filter_* _ with the hue plane using Intersect.</span></span> <span data-ttu-id="54673-865">O _componente filtro de triângulo \* é rotulado em itálico, o que significa que o componente varia de acordo com a implementação para operações de gama diferentes. O *filtro de triângulo* para CheckGamut é explicado na seção operação de gamut: CheckGamut (continuação). O resultado da interseção de um triângulo com o plano de matiz está vazio ou um **elemento de linha de limite** , ou seja, um par de pontos distintos. Se o resultado for não vazio, ele será passado para o processador do *_elemento_* de \* linha_ , que novamente faz coisas diferentes, dependendo da operação de gamut.</span><span class="sxs-lookup"><span data-stu-id="54673-865">The _Triangle Filter\* component is labeled in italics, which means that the component varies in implementation for different gamut operations. The *Triangle Filter* for CheckGamut is explained in the section, Gamut Operation: CheckGamut (continued). The result of intersecting a triangle with the hue plane is either empty or a **Boundary Line Element** , that is, a pair of distinct points. If the result is non-empty, it is passed into the \**_Line Element Processor_*_ , which again does different things depending on the gamut operation.</span></span> <span data-ttu-id="54673-866">O _processador de elemento de linha \* atualiza a estrutura de dados interna, \***dados processados internos**_ , cujo conteúdo ou layout também depende da operação de gama.</span><span class="sxs-lookup"><span data-stu-id="54673-866">The _Line Element Processor\* updates the internal data structure, \***Internal Processed Data**_ , whose content or layout also depends on the gamut operation.</span></span> <span data-ttu-id="54673-867">Em geral, os _dados internos processados \* contêm a "resposta" para o problema, que é continuamente atualizada com cada novo elemento de linha de limite encontrado. Quando todos os elementos da linha de limite tiverem sido processados, a resposta foi encontrada. Ele permanece acessando-o por meio do **adaptador de saída**\*_.</span><span class="sxs-lookup"><span data-stu-id="54673-867">Generally, the _Internal Processed Data\* contains the "answer" to the problem, which is continually updated with each new Boundary Line Element found. When all the Boundary Line Elements have been processed, the answer has been found. It remains to access it through the \***Output Adaptor**_.</span></span> <span data-ttu-id="54673-868">Como o _Internal dados processados \* é específico da operação em gamut, o *adaptador de saída* também é específico da operação em gamut.</span><span class="sxs-lookup"><span data-stu-id="54673-868">Because the _Internal Processed Data\* is gamut operation specific, the *Output Adaptor* is also gamut operation specific.</span></span>

### <a name="full-hue-plane-intersect"></a><span data-ttu-id="54673-869">Plano de matiz completo: Intersect</span><span class="sxs-lookup"><span data-stu-id="54673-869">Full Hue Plane: Intersect</span></span>

<span data-ttu-id="54673-870">A função Intersect calcula a interseção do plano de matiz e um triângulo.</span><span class="sxs-lookup"><span data-stu-id="54673-870">The Intersect function calculates the intersection of the hue plane and a triangle.</span></span> <span data-ttu-id="54673-871">Tão simples quanto parece, essa função é importante por dois motivos.</span><span class="sxs-lookup"><span data-stu-id="54673-871">As simple as it sounds, this function is important for two reasons.</span></span>

<span data-ttu-id="54673-872">Primeiro, a interseção de cada borda do triângulo com o plano pode produzir três pontos interseccionais, uma situação geométricamente impossível.</span><span class="sxs-lookup"><span data-stu-id="54673-872">First, intersecting each edge of the triangle with the plane might yield three intersection points, a geometrically impossible situation.</span></span> <span data-ttu-id="54673-873">O motivo pelo qual isso pode acontecer na computação é que, quando os cálculos são feitos em ponto flutuante, por exemplo, formato IEEE, há incertezas ou "ruído numérico", em cada etapa que afeta a conclusão de uma interseção do plano.</span><span class="sxs-lookup"><span data-stu-id="54673-873">The reason why this might happen in the computation is that, when calculations are done in floating point, for example, IEEE format, there are uncertainties, or "numeric noise," in each step that affects the conclusion of whether an edge intersects the plane.</span></span> <span data-ttu-id="54673-874">Quando o plano intercepta as bordas em uma situação quase de perda, os pontos de interseção estão próximos um do outro e a determinação se um ponto de interseção está dentro da borda é aleatória.</span><span class="sxs-lookup"><span data-stu-id="54673-874">When the plane intersects the edges in a near-miss situation, the intersection points are close to each other, and the determination whether an intersection point lies within the edge is random.</span></span> <span data-ttu-id="54673-875">Embora o ruído nos valores numéricos dos pontos seja pequeno, a conclusão qualitativa de que há mais de dois pontos de interseção é geométricamente impossível e difícil de lidar corretamente no algoritmo.</span><span class="sxs-lookup"><span data-stu-id="54673-875">Although noise in the numeric values of the points is small, the qualitative conclusion that there are more than two intersection points is geometrically impossible and difficult to handle correctly in the algorithm.</span></span>

<span data-ttu-id="54673-876">Em segundo lugar, essa função está no loop crítico para cada borda de cada triângulo filtrado, portanto, é importante que você otimize sua eficiência o máximo possível.</span><span class="sxs-lookup"><span data-stu-id="54673-876">Second, this function is in the critical loop for each edge of each filtered triangle, so it is important that you optimize its efficiency as much as possible.</span></span>

<span data-ttu-id="54673-877">Para resolver o primeiro problema de ruído numérico, execute os cálculos em inteiros.</span><span class="sxs-lookup"><span data-stu-id="54673-877">To address the first issue Of numeric noise, perform the calculations in integers.</span></span> <span data-ttu-id="54673-878">Para resolver o segundo problema de otimização de sua eficiência, armazene em cache o atributo mais usado de cada vértice ou o "produto de ponto" associado a cada vértice.</span><span class="sxs-lookup"><span data-stu-id="54673-878">To address the second issue of optimizing its efficiency, cache the most used attribute of each vertex, or the "dot product" associated with each vertex.</span></span> <span data-ttu-id="54673-879">A passagem de inteiros é uma maneira comum de garantir a consistência geométrica.</span><span class="sxs-lookup"><span data-stu-id="54673-879">Passing into integers is a typical way to guarantee geometric consistency.</span></span> <span data-ttu-id="54673-880">A ideia básica é que, se você tiver que quantificar, faça isso no início.</span><span class="sxs-lookup"><span data-stu-id="54673-880">The basic idea is that if you have to quantize, do it at the beginning.</span></span> <span data-ttu-id="54673-881">Em seguida, os cálculos subsequentes podem ser executados em inteiros e, se os inteiros forem amplos o suficiente para que não haja nenhum risco de estouro, os cálculos poderão ser feitos com precisão infinita.</span><span class="sxs-lookup"><span data-stu-id="54673-881">Then subsequent calculations can be performed in integers, and if the integers are wide enough so that there is no danger of overflow, the calculations can be done with infinite precision.</span></span> <span data-ttu-id="54673-882">A seguinte função de quantificação é útil para essa finalidade.</span><span class="sxs-lookup"><span data-stu-id="54673-882">The following quantization function useful for this purpose.</span></span>

<span data-ttu-id="54673-883">ScaleAndTruncate (x) = parte inteira de x \* 10000</span><span class="sxs-lookup"><span data-stu-id="54673-883">ScaleAndTruncate(x) = Integer part of x\*10000</span></span>

<span data-ttu-id="54673-884">O fator de dimensionamento 10000 significa que o número de ponto flutuante de entrada tem quatro casas decimais, o que é preciso o suficiente para esse aplicativo.</span><span class="sxs-lookup"><span data-stu-id="54673-884">The scaling factor 10000 means that the input floating-point number has four decimal places, which is precise enough for this application.</span></span> <span data-ttu-id="54673-885">Dependendo do intervalo de valores do espaço de aparência da cor, você deseja escolher um tipo inteiro com bits de largura suficiente para manter os cálculos intermediários.</span><span class="sxs-lookup"><span data-stu-id="54673-885">Depending on the range of values of the color appearance space, you want to choose an integer type with bits wide enough to hold the intermediate calculations.</span></span> <span data-ttu-id="54673-886">Na maioria dos espaços de aparência de cor, o intervalo de cada coordenada está dentro do intervalo de-1.000 a 1.000.</span><span class="sxs-lookup"><span data-stu-id="54673-886">In most color appearance spaces, the range of each coordinate is within the range -1,000 to 1,000.</span></span> <span data-ttu-id="54673-887">A coordenada quantificada tem um valor absoluto máximo possível de 1.000 \* 10.000 = 10 milhões.</span><span class="sxs-lookup"><span data-stu-id="54673-887">The quantized coordinate has a maximum possible absolute value of 1,000\*10,000 = 10,000,000.</span></span> <span data-ttu-id="54673-888">Como você verá, a quantidade intermediária é um produto de ponto, que é uma soma de dois produtos de coordenadas, portanto, ele tem um valor absoluto máximo possível de 2 \* (10 milhões) ₂ = 2? 10 ₁ ₄.</span><span class="sxs-lookup"><span data-stu-id="54673-888">As you will see, the intermediate quantity is a dot product, which is a sum of two products of coordinates, so it has a maximum possible absolute value of 2\*(10,000,000) ₂ = 2?10 ₁₄.</span></span> <span data-ttu-id="54673-889">O número de bits necessário é log ₂ (2? 10 ₁ ₄) = 47,51.</span><span class="sxs-lookup"><span data-stu-id="54673-889">The number of bits required is log ₂ (2?10 ₁₄ ) = 47.51.</span></span> <span data-ttu-id="54673-890">Uma opção conveniente para o tipo Integer é, portanto, inteiros de 64 bits.</span><span class="sxs-lookup"><span data-stu-id="54673-890">A convenient choice for the integer type is, therefore, 64-bit integers.</span></span>

<span data-ttu-id="54673-891">Para garantir que a interseção de um plano com um triângulo sempre forneça um conjunto vazio ou um conjunto de dois pontos, você deve considerar o triângulo como um todo, não como bordas individuais do triângulo separadamente.</span><span class="sxs-lookup"><span data-stu-id="54673-891">To guarantee that intersecting a plane with a triangle always gives either empty set or a set of two points, you must consider the triangle as a whole, not as individual edges of the triangle separately.</span></span> <span data-ttu-id="54673-892">Para entender a situação geométrica, considere as "distâncias assinadas" dos vértices do triângulo do plano de matiz.</span><span class="sxs-lookup"><span data-stu-id="54673-892">To understand the geometric situation, consider the "signed distances" of the vertices of the triangle from the hue plane.</span></span> <span data-ttu-id="54673-893">Não Calcule essas distâncias assinadas diretamente; em vez disso, calcule os produtos dot dos vetores de posição dos vértices com o vetor normal quantificado para o plano.</span><span class="sxs-lookup"><span data-stu-id="54673-893">Do not calculate these signed distances directly; instead calculate the dot products of the position vectors of the vertices with the quantized normal vector to the plane.</span></span> <span data-ttu-id="54673-894">Mais especificamente, durante a inicialização do plano de matiz, o vetor normal quantificado é calculado da seguinte maneira.</span><span class="sxs-lookup"><span data-stu-id="54673-894">More specifically, during the initialization of the hue plane, the quantized normal vector is calculated as follows.</span></span>

<span data-ttu-id="54673-895">NormalVector = (ScaleAndTruncate (-sin (matiz)), ScaleAndTruncate (cos (matiz))</span><span class="sxs-lookup"><span data-stu-id="54673-895">NormalVector = (ScaleAndTruncate(-sin(hue)), ScaleAndTruncate(cos(hue)))</span></span>

<span data-ttu-id="54673-896">Observe que esse vetor é um vetor bidimensional.</span><span class="sxs-lookup"><span data-stu-id="54673-896">Note that this vector is a two-dimensional vector.</span></span> <span data-ttu-id="54673-897">Você pode usar um vetor bidimensional porque o plano de matiz é vertical, portanto, o terceiro componente do vetor normal é sempre zero.</span><span class="sxs-lookup"><span data-stu-id="54673-897">You can use a two-dimensional vector because the hue plane is vertical, so the third component of the normal vector is always zero.</span></span> <span data-ttu-id="54673-898">Além disso, uma tabela de pesquisa de produtos dot é inicializada para ter uma entrada para cada vértice dos triângulos de limite de gamut e o produto do ponto correspondente definido como um valor inválido.</span><span class="sxs-lookup"><span data-stu-id="54673-898">Moreover, a lookup table of dot products is initialized to have an entry for each vertex from the Gamut Boundary Triangles and the corresponding dot product set to an invalid value.</span></span>

<span data-ttu-id="54673-899">Durante uma operação de interseção do plano de matiz com um triângulo, o produto do ponto de cada vértice do triângulo é pesquisado.</span><span class="sxs-lookup"><span data-stu-id="54673-899">During one operation of intersecting the hue plane with a triangle, the dot product of each vertex of the triangle is looked up.</span></span> <span data-ttu-id="54673-900">Se o valor na tabela de pesquisa for o valor inválido, o produto de ponto será calculado usando a expressão a seguir.</span><span class="sxs-lookup"><span data-stu-id="54673-900">If the value in the lookup table is the invalid value, then the dot product is computed using the following expression.</span></span>

<span data-ttu-id="54673-901">NormalVector. a \* ScaleAndTruncate (Vertex. a) + NormalVector. b \* ScaleAndTruncate (vértice. b)</span><span class="sxs-lookup"><span data-stu-id="54673-901">NormalVector.a\*ScaleAndTruncate(vertex.a) + NormalVector.b\*ScaleAndTruncate(vertex.b)</span></span>

<span data-ttu-id="54673-902">Novamente, o componente J do vértice nunca é usado, pois o vetor normal é horizontal.</span><span class="sxs-lookup"><span data-stu-id="54673-902">Again, the J-component of the vertex is never used, because the normal vector is horizontal.</span></span> <span data-ttu-id="54673-903">Esse produto de ponto é salvo na tabela de pesquisa para que não precise ser computado novamente se o produto de ponto do vértice for consultado posteriormente.</span><span class="sxs-lookup"><span data-stu-id="54673-903">This dot product is then saved in the lookup table so that it doesn't have to be computed again if the dot product of the vertex is queried later.</span></span>

<span data-ttu-id="54673-904">O cache permite uma rápida determinação de se uma borda cruza o plano, depois que os produtos de ponto são tabulados na tabela de pesquisa, que é criada progressivamente conforme os vértices são processados.</span><span class="sxs-lookup"><span data-stu-id="54673-904">Caching allows for a quick determination of whether an edge intersects the plane, after the dot products are tabulated in the lookup table, which is built progressively as the vertices are processed.</span></span>

![Diagrama que mostra a interseção do plano de matiz com um triângulo.](images/gmmp-image114.jpg)

<span data-ttu-id="54673-906">**Figura 28** : interseccionando o plano de matiz com um triângulo</span><span class="sxs-lookup"><span data-stu-id="54673-906">**Figure 28** : Intersecting the hue plane with a triangle</span></span>

<span data-ttu-id="54673-907">Para o triângulo da figura 28 Interseccionar o plano de matiz em um segmento de linha que não é degenerado, os produtos de ponto dos vértices devem estar em um dos padrões a seguir, quando classificados em ordem crescente.</span><span class="sxs-lookup"><span data-stu-id="54673-907">For the triangle in Figure 28 to intersect the hue plane in a non-degenerate line segment, the dot products of the vertices must be in one of the following patterns, when sorted in ascending order.</span></span>

<span data-ttu-id="54673-908">0, 0, +; -, 0, 0; -, 0, +; -,-,+; -,+,+</span><span class="sxs-lookup"><span data-stu-id="54673-908">0,0,+; -,0,0; -,0,+; -,-,+; -,+,+</span></span>

<span data-ttu-id="54673-909">Um ponto de extremidade do segmento de linha surge quando o plano é interseccionado por uma borda com vértices que têm sinais diferentes no produto do ponto.</span><span class="sxs-lookup"><span data-stu-id="54673-909">An end point of the line segment arises when the plane is intersected by an edge with vertices that have different signs in the dot product.</span></span> <span data-ttu-id="54673-910">Se o sinal for zero, o vértice estará diretamente no plano e a interseção da borda com o plano será o próprio vértice.</span><span class="sxs-lookup"><span data-stu-id="54673-910">If the sign is zero, then the vertex lies right on the plane, and the intersection of the edge with the plane is the vertex itself.</span></span> <span data-ttu-id="54673-911">Observe também que os casos 0, 0, 0; -,-, 0; 0, +, + não são relatados.</span><span class="sxs-lookup"><span data-stu-id="54673-911">Note also that the cases 0,0,0; -,-,0; 0,+,+ are not reported.</span></span> <span data-ttu-id="54673-912">O primeiro caso (0, 0, 0) significa que o triângulo inteiro está no plano.</span><span class="sxs-lookup"><span data-stu-id="54673-912">The first case (0,0,0) means the whole triangle lies on the plane.</span></span> <span data-ttu-id="54673-913">Isso não é relatado porque cada borda do triângulo deve pertencer a um triângulo vizinho que também não se encontra inteiramente no plano.</span><span class="sxs-lookup"><span data-stu-id="54673-913">This is not reported because each edge of the triangle should belong to a neighboring triangle that does not also lie entirely on the plane.</span></span> <span data-ttu-id="54673-914">A borda será relatada quando esse triângulo for considerado.</span><span class="sxs-lookup"><span data-stu-id="54673-914">The edge will be reported when that triangle is considered.</span></span> <span data-ttu-id="54673-915">Os outros dois casos (-,-, 0 e 0, +, +) correspondem à configuração geométrica que o triângulo toca no plano em um vértice.</span><span class="sxs-lookup"><span data-stu-id="54673-915">The other two cases (-,-,0 and 0,+,+) correspond to the geometric configuration that the triangle touches the plane in one vertex.</span></span> <span data-ttu-id="54673-916">Esses casos não são relatados porque não fornecem aumento para um segmento de linha que não é degenerado.</span><span class="sxs-lookup"><span data-stu-id="54673-916">These cases are not reported because they don't give rise to a non-degenerate line segment.</span></span>

<span data-ttu-id="54673-917">O algoritmo anterior determina quando calcular uma interseção entre uma borda do triângulo e o plano de matiz.</span><span class="sxs-lookup"><span data-stu-id="54673-917">The preceding algorithm determines when to calculate an intersection between an edge of the triangle and the hue plane.</span></span> <span data-ttu-id="54673-918">Depois que uma borda é determinada, a interseção é calculada usando equações paramétricas.</span><span class="sxs-lookup"><span data-stu-id="54673-918">After an edge is determined, the intersection is calculated using parametric equations.</span></span> <span data-ttu-id="54673-919">Se um dos produtos de ponto for zero, a interseção é o próprio vértice, portanto, nenhum cálculo é necessário.</span><span class="sxs-lookup"><span data-stu-id="54673-919">If one of the dot products is zero, the intersection is the vertex itself, so no calculation is necessary.</span></span> <span data-ttu-id="54673-920">Supondo que os dois produtos de ponto dos vértices da borda sejam diferentes de zero, vertex1 é o vértice com o ponto *negativo* dotProduct1 do produto; e vertex2 é o vértice com o ponto *positivo* dotProduct2 do produto.</span><span class="sxs-lookup"><span data-stu-id="54673-920">Assuming that both dot products of the vertices of the edge are non-zero , vertex1 is the vertex with *negative* dot product dotProduct1; and vertex2 is the vertex with *positive* dot product dotProduct2.</span></span> <span data-ttu-id="54673-921">Essa ordem é importante para garantir que o ponto de interseção calculado não dependa de como a ordenação dos vértices aparece na representação da borda.</span><span class="sxs-lookup"><span data-stu-id="54673-921">This order is important to ensure that the calculated intersection point does not depend on how the ordering of the vertices appears in the representation of the edge.</span></span> <span data-ttu-id="54673-922">O conceito geométrico da borda é simétrico em relação aos seus vértices.</span><span class="sxs-lookup"><span data-stu-id="54673-922">The geometric concept of the edge is symmetrical with respect to its vertices.</span></span> <span data-ttu-id="54673-923">O aspecto computacional do uso de equações paramétricas da borda apresenta assimetria (escolha de vértice inicial), que pode dar um ponto de interseção um pouco diferente devido ao ruído numérico e à condição das equações lineares a serem resolvidas.</span><span class="sxs-lookup"><span data-stu-id="54673-923">The computational aspect of using parametric equations of the edge introduces asymmetry (choice of starting vertex), which may give a slightly different intersection point due to numeric noise and conditioning of the linear equations to be solved.</span></span> <span data-ttu-id="54673-924">Dito isso, o ponto de interseção, a interseção, é fornecido pelo seguinte.</span><span class="sxs-lookup"><span data-stu-id="54673-924">With this said, the intersection point, intersection,is given by the following.</span></span>

<span data-ttu-id="54673-925">t = dotProduct1/(dotProduct1-dotProduct2)</span><span class="sxs-lookup"><span data-stu-id="54673-925">t = dotProduct1/(dotProduct1 - dotProduct2)</span></span>

<span data-ttu-id="54673-926">interseção. J = vertex1. J + t \* (vertex2. J-vertex1. J</span><span class="sxs-lookup"><span data-stu-id="54673-926">intersection.J = vertex1.J + t \* (vertex2.J - vertex1.J)</span></span>

<span data-ttu-id="54673-927">interseção. a = vertex1. a + t \* (vertex2. a-vertex1. a)</span><span class="sxs-lookup"><span data-stu-id="54673-927">intersection.a = vertex1.a + t \* (vertex2.a - vertex1.a)</span></span>

<span data-ttu-id="54673-928">interseção. b = vertex1. b + t \* (vertex2. b-vertex1. b)</span><span class="sxs-lookup"><span data-stu-id="54673-928">intersection.b = vertex1.b + t \* (vertex2.b - vertex1.b)</span></span>

### <a name="gamut-operation-checkgamut-continued"></a><span data-ttu-id="54673-929">Operação de gama: CheckGamut (continuação)</span><span class="sxs-lookup"><span data-stu-id="54673-929">Gamut Operation: CheckGamut (continued)</span></span>

<span data-ttu-id="54673-930">O algoritmo geométrico básico usado para verificação de gama é contar o número de raios cruzados.</span><span class="sxs-lookup"><span data-stu-id="54673-930">The basic geometric algorithm used for gamut checking is to count the number of ray crossings.</span></span> <span data-ttu-id="54673-931">Para um determinado ponto de consulta, considere um raio começando com o ponto de consulta e apontando para cima (direção J).</span><span class="sxs-lookup"><span data-stu-id="54673-931">For a given query point, consider a ray starting with the query point and pointing upwards (J-direction).</span></span> <span data-ttu-id="54673-932">Contar o número de vezes que esse raio cruza o limite de gama.</span><span class="sxs-lookup"><span data-stu-id="54673-932">Count the number of times this ray crosses the gamut boundary.</span></span> <span data-ttu-id="54673-933">Se esse número for par, o ponto de consulta estará fora do gamut.</span><span class="sxs-lookup"><span data-stu-id="54673-933">If this number is even, then the query point is out-of-gamut.</span></span> <span data-ttu-id="54673-934">Se esse número for ímpar, o ponto estará dentro.</span><span class="sxs-lookup"><span data-stu-id="54673-934">If this number is odd, the point is inside.</span></span> <span data-ttu-id="54673-935">Em princípio, esse algoritmo pode ser implementado em 3-D, geralmente é afetado por dificuldades causadas por situações de degeneração, como o raio (parte) de um triângulo de limite, ou um Degeneracy dimensional inferior, como o raio (parte) de uma borda de um triângulo de limite.</span><span class="sxs-lookup"><span data-stu-id="54673-935">In principle, this algorithm can be implemented in 3-D, it is generally plagued by difficulties caused by degenerate situations, such as the ray lying (partly) on a boundary triangle, or lower dimensional degeneracy, such as the ray lying (partly) on an edge of a boundary triangle.</span></span> <span data-ttu-id="54673-936">Mesmo em 2-D, você precisa lidar com essas situações de degeneração; Mas o problema é mais simples e foi resolvido de maneira satisfatória.</span><span class="sxs-lookup"><span data-stu-id="54673-936">Even in 2-D, you have to deal with these degenerate situations; but the problem is simpler and has been addressed in a satisfactory manner.</span></span> <span data-ttu-id="54673-937">Consulte \[ O'Rourke \] .</span><span class="sxs-lookup"><span data-stu-id="54673-937">See \[O'Rourke\].</span></span>

<span data-ttu-id="54673-938">Para um determinado ponto de entrada jab, determine seu ângulo de matiz h da seguinte maneira.</span><span class="sxs-lookup"><span data-stu-id="54673-938">For a given input point Jab, determine its hue angle h as follows.</span></span>

<span data-ttu-id="54673-939">h = ATAN (b/a),</span><span class="sxs-lookup"><span data-stu-id="54673-939">h = atan(b/a),</span></span>

<span data-ttu-id="54673-940">Inicialize o plano de matiz e determine os elementos da linha de limite correspondentes a este plano de matiz.</span><span class="sxs-lookup"><span data-stu-id="54673-940">Initialize the hue plane, and then determine the Boundary Line Elements corresponding to this hue plane.</span></span> <span data-ttu-id="54673-941">Como os elementos da linha de limite só são relevantes se eles cruzam o raio de cima, configure um filtro de triângulo para remover triângulos que fornecem elementos de linha que definitivamente não interseccionam o raio de cima.</span><span class="sxs-lookup"><span data-stu-id="54673-941">Because the Boundary Line Elements are only relevant if they intersect the upward ray, set up a Triangle Filter to remove triangles that give line elements that definitely will not intersect the upward ray.</span></span> <span data-ttu-id="54673-942">Nesse caso, considere a caixa delimitadora do triângulo.</span><span class="sxs-lookup"><span data-stu-id="54673-942">In this case, consider the bounding box of the triangle.</span></span> <span data-ttu-id="54673-943">O raio para cima não interseccionará o triângulo se o ponto de consulta estiver fora da conversão de "sombra" pela caixa delimitadora se uma fonte de luz estava diretamente acima.</span><span class="sxs-lookup"><span data-stu-id="54673-943">The upward ray will not intersect the triangle if the query point is outside the "shadow" cast by the bounding box if a light source was directly above.</span></span> <span data-ttu-id="54673-944">Aumente isso ligeiramente com uma tolerância fixa para permitir ruídos numéricos para que você não jogue inadvertidamente triângulos que possam dar elementos de linha úteis.</span><span class="sxs-lookup"><span data-stu-id="54673-944">Inflate this slightly with a pre-fixed tolerance to allow for numeric noise so that you don't inadvertently throw away triangles that might give useful line elements.</span></span> <span data-ttu-id="54673-945">O resultado é o cilindro retangular semiinfinito mostrado na figura 29.</span><span class="sxs-lookup"><span data-stu-id="54673-945">The result is the semi-infinite rectangular cylinder shown in Figure 29.</span></span> <span data-ttu-id="54673-946">Verificar se o ponto de consulta está dentro ou fora desse cilindro pode ser implementado com eficiência usando desigualdades simples.</span><span class="sxs-lookup"><span data-stu-id="54673-946">Checking whether the query point is inside or outside this cylinder can be efficiently implemented using simple inequalities.</span></span>

![Mostra o filtro de triângulo para CheckGamut.](images/gmmp-image116.jpg)

<span data-ttu-id="54673-948">**Figura 29** : filtro de triângulo para CheckGamut</span><span class="sxs-lookup"><span data-stu-id="54673-948">**Figure 29** : Triangle Filter for CheckGamut</span></span>

<span data-ttu-id="54673-949">CheckGamut tem três componentes específicos de operação de gama: *dados processados internos*,*processador de elemento de linha* e adaptador de *saída*.</span><span class="sxs-lookup"><span data-stu-id="54673-949">CheckGamut has three gamut operation specific components: *Internal Processed Data*,*Line Element Processor*, and *Output Adaptor*.</span></span> <span data-ttu-id="54673-950">Os *dados processados internos* são uma lista de elementos de linha que foram processados por *processador de elemento de linha*.</span><span class="sxs-lookup"><span data-stu-id="54673-950">The *Internal Processed Data* is a list of line elements that have been processed by *Line Element Processor*.</span></span> <span data-ttu-id="54673-951">Nesse caso, o *processador de elemento de linha* simplesmente adiciona um elemento de linha à lista.</span><span class="sxs-lookup"><span data-stu-id="54673-951">In this case, the *Line Element Processor* simply adds a line element to the list.</span></span> <span data-ttu-id="54673-952">A estrutura de dados interna para *dados processados internos* pode ser uma lista vinculada ou uma matriz que pode crescer em tamanho.</span><span class="sxs-lookup"><span data-stu-id="54673-952">The internal data structure for *Internal Processed Data* can be either a linked list or an array that can grow in size.</span></span>

<span data-ttu-id="54673-953">O *adaptador de saída* é um módulo que acessa a lista de elementos de linha, determina se um elemento de linha cruza o raio superior (contagem 1) ou não (contagem 0).</span><span class="sxs-lookup"><span data-stu-id="54673-953">The *Output Adaptor* is a module that accesses the list of line elements, determines if a line element crosses the upward ray (count 1) or not (count 0).</span></span> <span data-ttu-id="54673-954">Somar todas essas contagens fornece uma contagem total.</span><span class="sxs-lookup"><span data-stu-id="54673-954">Summing all these counts gives a total count.</span></span> <span data-ttu-id="54673-955">O *adaptador de saída* , por fim, gera uma resposta de "Sim" (em gamut) ou "não" (fora do gamut), dependendo se a contagem total é ímpar ou uniforme.</span><span class="sxs-lookup"><span data-stu-id="54673-955">The *Output Adaptor* ultimately outputs an answer of "yes" (in-gamut) or "no" (out-of-gamut), depending on whether the total count is odd or even.</span></span> <span data-ttu-id="54673-956">A etapa em que você determina se um elemento de linha cruza o raio de cima merece atenção, pois é aí que ocorre o problema do Degeneracy e também o problema de excesso de contagem.</span><span class="sxs-lookup"><span data-stu-id="54673-956">The step where you determine if a line element crosses the upward ray deserves some attention because this is where the problem of degeneracy arises and also the problem of over-counting arises.</span></span> <span data-ttu-id="54673-957">Após \[ O'Rourke \] , para um elemento de linha cruzar o raio, o ponto de extremidade direito (o ponto de extremidade com croma maior) deve ser estritamente no lado direito do raio.</span><span class="sxs-lookup"><span data-stu-id="54673-957">Following \[O'Rourke\], for a line element to cross the ray, the right end point (the end point with larger chroma) must be strictly on the right side of the ray.</span></span> <span data-ttu-id="54673-958">Isso garante que, se um ponto de extremidade já estiver exatamente no raio, ele será contado apenas uma vez.</span><span class="sxs-lookup"><span data-stu-id="54673-958">This guarantees that, if an end point ever lies exactly on the ray, it is only counted one time.</span></span> <span data-ttu-id="54673-959">A mesma regra também resolve a situação de degeneração em que o elemento line está exatamente no raio.</span><span class="sxs-lookup"><span data-stu-id="54673-959">The same rule also solves the degenerate situation where the line element lies exactly on the ray.</span></span> <span data-ttu-id="54673-960">Você não incrementa a contagem para este elemento de linha.</span><span class="sxs-lookup"><span data-stu-id="54673-960">You do not increment the count for this line element.</span></span>

<span data-ttu-id="54673-961">A figura 30 mostra os elementos de linha resultantes de uma gama de amostra com o ponto de consulta em várias posições.</span><span class="sxs-lookup"><span data-stu-id="54673-961">Figure 30 shows the resulting line elements of a sample gamut with the query point in various positions.</span></span>

![Diagrama que mostra os elementos de linha resultantes de uma gama de amostra com o ponto de consulta em várias posições.](images/gmmp-image118.jpg)

<span data-ttu-id="54673-963">**Figura 30** : como o CheckGamut funciona</span><span class="sxs-lookup"><span data-stu-id="54673-963">**Figure 30** : How CheckGamut works</span></span>

### <a name="minimum-color-difference-gamut-mapping"></a><span data-ttu-id="54673-964">Mapeamento de gama da diferença de cor mínima</span><span class="sxs-lookup"><span data-stu-id="54673-964">Minimum Color Difference Gamut Mapping</span></span>

<span data-ttu-id="54673-965">O mapeamento de gama da diferença de cor mínima, MinDEMap, tem uma especificação simples: se uma cor estiver em gamut, não faça nada.</span><span class="sxs-lookup"><span data-stu-id="54673-965">The Minimum Color Difference Gamut Mapping, MinDEMap, has a simple specification: If a color is in-gamut, do nothing.</span></span> <span data-ttu-id="54673-966">Se uma cor estiver fora do gamut, projeta-a no ponto "mais próximo" no limite de gamut.</span><span class="sxs-lookup"><span data-stu-id="54673-966">If a color is out-of-gamut, project it to the "nearest" point on the gamut boundary.</span></span> <span data-ttu-id="54673-967">A palavra-chave "mais próxima" não é bem definida até que você especifique a equação de diferença de cor a ser usada.</span><span class="sxs-lookup"><span data-stu-id="54673-967">The keyword "nearest" is not well-defined until you specify which color difference equation to use.</span></span> <span data-ttu-id="54673-968">Na prática, para tornar a computação mais fácil e rápida, a distância euclidiana do espaço de aparência da cor escolhida, ou uma variante dela, é usada como a métrica de diferença de cor.</span><span class="sxs-lookup"><span data-stu-id="54673-968">In practice, to make computation easier and faster, the Euclidean distance of the chosen color appearance space, or a variant of it, is used as the color difference metric.</span></span> <span data-ttu-id="54673-969">A vantagem da métrica euclidiana é que ela é compatível com o produto dot do espaço, o que torna possível o uso de algebra linear.</span><span class="sxs-lookup"><span data-stu-id="54673-969">The advantage of the Euclidean metric is that it is compatible with the dot product of the space, which makes it possible to use linear algebra.</span></span> <span data-ttu-id="54673-970">Em detalhes, se um "produto de ponto" for definido no espaço, uma distância poderá ser definida como a raiz quadrada do produto de ponto do vetor de diferença com ele mesmo.</span><span class="sxs-lookup"><span data-stu-id="54673-970">In detail, if a "dot product" is defined in the space, then a distance can be defined as the square root of the dot product of the difference vector with itself.</span></span> <span data-ttu-id="54673-971">Um produto de ponto geralmente pode ser definido por uma matriz 3x3 definida positiva A.</span><span class="sxs-lookup"><span data-stu-id="54673-971">A dot product can generally be defined by a positive definite 3x3 matrix A.</span></span>

<span data-ttu-id="54673-972">u? v = u <sub>T</sub> AV</span><span class="sxs-lookup"><span data-stu-id="54673-972">u?v = u <sub>T</sub> Av</span></span>

<span data-ttu-id="54673-973">onde o lado direito é a multiplicação de matriz usual.</span><span class="sxs-lookup"><span data-stu-id="54673-973">where the right hand side is the usual matrix multiplication.</span></span> <span data-ttu-id="54673-974">Se um for a matriz de identidade, o produto Standard dot será recuperado.</span><span class="sxs-lookup"><span data-stu-id="54673-974">If A is the identity matrix, the standard dot product is recovered.</span></span> <span data-ttu-id="54673-975">Na prática, se jab for o espaço de cores, você não deseja misturar os componentes, portanto, uma matriz diagonal diferente da matriz de identidade pode ser usada.</span><span class="sxs-lookup"><span data-stu-id="54673-975">In practice, if Jab is the color space, you do not want to mix up the components, so a diagonal matrix other than the identity matrix can be used.</span></span> <span data-ttu-id="54673-976">Além disso, talvez você queira manter a escala em a e b inalterada para que a medida de matiz seja preservada.</span><span class="sxs-lookup"><span data-stu-id="54673-976">In addition, you might want to keep the scale on a and b unchanged so that the measure of hue is preserved.</span></span> <span data-ttu-id="54673-977">Portanto, uma variação útil do produto Standard euclidiana dot é a seguinte.</span><span class="sxs-lookup"><span data-stu-id="54673-977">So a useful variation of the standard Euclidean dot product is the following.</span></span>

<span data-ttu-id="54673-978">w <sub>j</sub> (componente j de você) (componente j de v) + (um componente de você) (um componente do v) + (componente b de você) (componente b de v)</span><span class="sxs-lookup"><span data-stu-id="54673-978">w <sub>J</sub> (J component of u)(J component of v) + (a component of u)(a component of v) + (b component of u)(b component of v)</span></span>

<span data-ttu-id="54673-979">onde w <sub>J</sub> é um número positivo.</span><span class="sxs-lookup"><span data-stu-id="54673-979">where w <sub>J</sub> is a positive number.</span></span> <span data-ttu-id="54673-980">Uma variação adicional é permitir que w <sub>J</sub> varie de acordo com o ponto de consulta de entrada:</span><span class="sxs-lookup"><span data-stu-id="54673-980">One further variation is to let w <sub>J</sub> vary with the input query point:</span></span>

<span data-ttu-id="54673-981">w <sub>j \ =</sub> w <sub>j</sub> (queryPoint)</span><span class="sxs-lookup"><span data-stu-id="54673-981">w <sub>J\ =</sub> w <sub>J</sub> (queryPoint)</span></span>

<span data-ttu-id="54673-982">O resultado final é uma medida de distância que é assimétrica em relação aos dois pontos e com pesos relativos diferentes na claridade e croma ou matiz à medida que o ponto de consulta de entrada varia.</span><span class="sxs-lookup"><span data-stu-id="54673-982">The end result is a measure of distance that is asymmetric with respect to the two points, and with different relative weights on lightness and chroma or hue as the input query point varies.</span></span> <span data-ttu-id="54673-983">Isso é de acordo com algumas observações sobre a percepção de cores humanas de que as diferenças de cores não são ponderadas igualmente em todas as dimensões.</span><span class="sxs-lookup"><span data-stu-id="54673-983">This is in accordance with some observations about human color perception that color differences are not weighted equally in all dimensions.</span></span> <span data-ttu-id="54673-984">Foi detectado que as pessoas são menos sensíveis às diferenças na claridade do que são diferenças no matiz e no croma.</span><span class="sxs-lookup"><span data-stu-id="54673-984">It has been found that people are less sensitive to differences in lightness than they are to differences in hue and chroma.</span></span>

<span data-ttu-id="54673-985">A função de peso a seguir é útil.</span><span class="sxs-lookup"><span data-stu-id="54673-985">The following weight function is useful.</span></span>

<span data-ttu-id="54673-986">w <sub>J</sub> = k ₂-k ₁ (C-c m ₐ ₓ) n</span><span class="sxs-lookup"><span data-stu-id="54673-986">w <sub>J</sub> = k ₂ - k ₁ (C - C ₘₐₓ ) ₙ</span></span>

<span data-ttu-id="54673-987">em que k ₂ = 1, k ₁ = 0,75/(C m ₐ ₓ) n, C m ₐ ₓ = 100, n = 2 e C é o menor de croma do ponto de consulta e C m ₐ ₓ.</span><span class="sxs-lookup"><span data-stu-id="54673-987">where k ₂ = 1, k ₁ = 0.75/(C ₘₐₓ ) ₙ, C ₘₐₓ = 100, n = 2 and C is the smaller of chroma of the query point and C ₘₐₓ.</span></span>

<span data-ttu-id="54673-988">de forma que um peso de 0,25 seja colocado no termo J quando croma for zero e um peso de 1 quando croma for 100.</span><span class="sxs-lookup"><span data-stu-id="54673-988">so that a weight of 0.25 is put on the J term when chroma is zero, and a weight of 1 when chroma is 100.</span></span> <span data-ttu-id="54673-989">A tendência de colocar menos peso em J quando croma é pequena e mais peso em J quando croma é grande segue o uso recomendado para CMC e CIEDE2000.</span><span class="sxs-lookup"><span data-stu-id="54673-989">The trend of putting less weight on J when chroma is small, and more weight on J when chroma is large follows the recommended usage for CMC and CIEDE2000.</span></span>

![Grafo que mostra a função Weight no componente J da métrica.](images/gmmp-image119.png)

<span data-ttu-id="54673-991">**Figura 31** : a função Weight no componente J da métrica</span><span class="sxs-lookup"><span data-stu-id="54673-991">**Figure 31** : The weight function on the J component of the metric</span></span>

<span data-ttu-id="54673-992">Use o espaço jab para o exemplo a seguir.</span><span class="sxs-lookup"><span data-stu-id="54673-992">Use Jab space for the following example.</span></span> <span data-ttu-id="54673-993">É computacionalmente exigente Pesquisar todos os triângulos de limite para determinar o ponto mais próximo na métrica euclidiana.</span><span class="sxs-lookup"><span data-stu-id="54673-993">It is computationally demanding to search through all the boundary triangles to determine the closest point in the Euclidean metric.</span></span> <span data-ttu-id="54673-994">Veja a seguir uma abordagem simples para tornar esse processo o mais eficiente possível, sem introduzir suposições adicionais que possam acelerar o processo, mas também terminar em apenas uma resposta aproximada.</span><span class="sxs-lookup"><span data-stu-id="54673-994">The following is a simple approach to make this process as efficient as possible, without introducing additional assumptions that may speed up the process but also end up in only an approximate answer.</span></span> <span data-ttu-id="54673-995">Primeiro, é necessário entender o procedimento geométrico do projeto de um ponto no triângulo determinado.</span><span class="sxs-lookup"><span data-stu-id="54673-995">First, it is necessary to understand the geometric procedure of projecting a point onto the given triangle.</span></span> <span data-ttu-id="54673-996">Uma descrição é fornecida aqui.</span><span class="sxs-lookup"><span data-stu-id="54673-996">A description is given here.</span></span>

<span data-ttu-id="54673-997">Uma projeção ortogonal no plano infinito que contém o triângulo é executada pela primeira vez.</span><span class="sxs-lookup"><span data-stu-id="54673-997">An orthogonal projection onto the infinite plane containing the triangle is first performed.</span></span> <span data-ttu-id="54673-998">A distância mais curta do ponto de consulta do plano pode ser determinada em duas etapas.</span><span class="sxs-lookup"><span data-stu-id="54673-998">The shortest distance of the query point from the plane can be determined in two steps.</span></span>

<span data-ttu-id="54673-999">**(a)** Calcule o vetor normal da unidade para o triângulo.</span><span class="sxs-lookup"><span data-stu-id="54673-999">**(a)** Calculate the unit normal vector to the triangle.</span></span>

<span data-ttu-id="54673-1000">**(b)** calcular o produto de ponto do vetor normal da unidade e um vetor formado do ponto de consulta e um ponto no triângulo; ou seja, um de seus vértices.</span><span class="sxs-lookup"><span data-stu-id="54673-1000">**(b)** Calculate the dot product of the unit normal vector and a vector formed from the query point and a point on the triangle; that is, one of its vertices.</span></span> <span data-ttu-id="54673-1001">Como o vetor normal tem comprimento de unidade, o valor absoluto deste ponto é a distância do ponto de consulta do plano.</span><span class="sxs-lookup"><span data-stu-id="54673-1001">Because the normal vector has unit length, the absolute value of this dot product is the distance of the query point from the plane.</span></span>

<span data-ttu-id="54673-1002">O ponto projetado pode não ser a resposta, pois pode estar fora do triângulo.</span><span class="sxs-lookup"><span data-stu-id="54673-1002">The projected point might not be the answer, because it might lie outside the triangle.</span></span> <span data-ttu-id="54673-1003">Portanto, você deve executar uma verificação primeiro.</span><span class="sxs-lookup"><span data-stu-id="54673-1003">So, you must perform a check first.</span></span> <span data-ttu-id="54673-1004">O cálculo é equivalente ao cálculo das coordenadas barycentric do ponto projetado em relação ao triângulo.</span><span class="sxs-lookup"><span data-stu-id="54673-1004">The calculation is equivalent to calculating the barycentric coordinates of the projected point relative to the triangle.</span></span> <span data-ttu-id="54673-1005">Se o ponto projetado for determinado para estar dentro do triângulo, será a resposta.</span><span class="sxs-lookup"><span data-stu-id="54673-1005">If the projected point is determined to be inside the triangle, it is the answer.</span></span> <span data-ttu-id="54673-1006">Caso contrário, o ponto mais próximo é adquirido em uma das bordas do triângulo.</span><span class="sxs-lookup"><span data-stu-id="54673-1006">If not, the closest point is acquired on one of the edges of the triangle.</span></span> <span data-ttu-id="54673-1007">Faça uma pesquisa em cada uma das três bordas.</span><span class="sxs-lookup"><span data-stu-id="54673-1007">Perform a search on each of the three edges.</span></span> <span data-ttu-id="54673-1008">A determinação da projeção do ponto de consulta em uma borda é um processo semelhante à projeção no triângulo, mas uma dimensão é menor.</span><span class="sxs-lookup"><span data-stu-id="54673-1008">Determining the projection of the query point onto an edge is a process similar to projection onto the triangle, but one dimension less.</span></span> <span data-ttu-id="54673-1009">Uma projeção ortogonal é calculada pela primeira vez.</span><span class="sxs-lookup"><span data-stu-id="54673-1009">An orthogonal projection is first calculated.</span></span> <span data-ttu-id="54673-1010">Se o ponto projetado estiver na borda, será a resposta.</span><span class="sxs-lookup"><span data-stu-id="54673-1010">If the projected point lies on the edge, it is the answer.</span></span> <span data-ttu-id="54673-1011">Caso contrário, o ponto mais próximo é adquirido em um dos dois pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="54673-1011">If not, the closest point is acquired on one of the two end points.</span></span> <span data-ttu-id="54673-1012">Executar uma pesquisa nos dois pontos de extremidade; ou seja, calcule a distância do ponto de consulta de cada um e compare qual deles é menor.</span><span class="sxs-lookup"><span data-stu-id="54673-1012">Perform a search on the two end points; that is, calculate the distance of query point from each one, and compare which one is smaller.</span></span>

<span data-ttu-id="54673-1013">O exame cuidadoso revela que há muita pesquisa repetida quando você passa por todos os triângulos porque uma borda é sempre compartilhada por dois triângulos e um vértice compartilhado por pelo menos três bordas.</span><span class="sxs-lookup"><span data-stu-id="54673-1013">Careful examination reveals that there is a lot of repeated searching when you go through all the triangles because an edge is always shared by two triangles, and a vertex shared by at least three edges.</span></span> <span data-ttu-id="54673-1014">Além disso, você não está muito interessado em encontrar o ponto mais próximo de um triângulo específico; em vez disso, você está interessado em encontrar o ponto mais próximo de todo o limite da gama.</span><span class="sxs-lookup"><span data-stu-id="54673-1014">In addition, you are not much interested in finding the closest point to one particular triangle; instead you are interested in finding the closest point to the whole gamut boundary.</span></span> <span data-ttu-id="54673-1015">No entanto, um triângulo específico seria aquele em que isso é conseguido.</span><span class="sxs-lookup"><span data-stu-id="54673-1015">However,one particular triangle would be the one in which this is achieved.</span></span> <span data-ttu-id="54673-1016">Há duas estratégias que você pode usar para acelerar a pesquisa.</span><span class="sxs-lookup"><span data-stu-id="54673-1016">There are two strategies that you can use to speed up the search.</span></span>

<span data-ttu-id="54673-1017">**Estratégia I**. Cada vértice será processado, no máximo, uma vez.</span><span class="sxs-lookup"><span data-stu-id="54673-1017">**Strategy I**. Each vertex will be processed, at most, once.</span></span> <span data-ttu-id="54673-1018">Cada borda será processada, no máximo, uma vez.</span><span class="sxs-lookup"><span data-stu-id="54673-1018">Each edge will be processed, at most, once.</span></span>

<span data-ttu-id="54673-1019">**Estratégia II**.</span><span class="sxs-lookup"><span data-stu-id="54673-1019">**Strategy II**.</span></span> <span data-ttu-id="54673-1020">Em qualquer ponto da pesquisa, você tem um melhor candidato com a melhor distância correspondente.</span><span class="sxs-lookup"><span data-stu-id="54673-1020">At any point in the search, you have a best candidate with the corresponding best distance.</span></span> <span data-ttu-id="54673-1021">Se você puder determinar, por uma verificação rápida, que um triângulo não é capaz de dar uma distância melhor, não há necessidade de continuar o cálculo ainda mais.</span><span class="sxs-lookup"><span data-stu-id="54673-1021">If you can determine, by a quick check, that a triangle is not capable of giving a better distance, there is no need to continue the calculation further.</span></span> <span data-ttu-id="54673-1022">Você não precisa do ponto e da distância mais próximos deste triângulo.</span><span class="sxs-lookup"><span data-stu-id="54673-1022">You do not need the closest point and distance for this triangle.</span></span>

![Diagrama que mostra o fluxo do mínimo DE mapeamento.](images/gmmp-image120.png)

<span data-ttu-id="54673-1024">**Figura 32** : esquemáticos mínimos de mapeamento</span><span class="sxs-lookup"><span data-stu-id="54673-1024">**Figure 32** : Minimum DE Mapping schematics</span></span>

<span data-ttu-id="54673-1025">A Figura 32 mostra o fluxo geral de lógica para o mapa de gamut MinDEMap.</span><span class="sxs-lookup"><span data-stu-id="54673-1025">Figure 32 shows the general flow of logic for the gamut map MinDEMap.</span></span> <span data-ttu-id="54673-1026">Para um ponto de consulta, a função CheckGamut é invocada pela primeira vez.</span><span class="sxs-lookup"><span data-stu-id="54673-1026">For a query point, the CheckGamut function is first invoked.</span></span> <span data-ttu-id="54673-1027">Se o ponto estiver em gamut, o mapa será não operacional.</span><span class="sxs-lookup"><span data-stu-id="54673-1027">If the point is in-gamut, the map is a no-op.</span></span> <span data-ttu-id="54673-1028">Se o ponto estiver fora do gamut, chame ProjectPointToBoundary.</span><span class="sxs-lookup"><span data-stu-id="54673-1028">If the point is out-of-gamut, call ProjectPointToBoundary.</span></span> <span data-ttu-id="54673-1029">Agora, passe para a figura 33.</span><span class="sxs-lookup"><span data-stu-id="54673-1029">Now move on to Figure 33.</span></span> <span data-ttu-id="54673-1030">Neste ponto, supõe-se que os valores a seguir foram computados.</span><span class="sxs-lookup"><span data-stu-id="54673-1030">At this point, it is assumed that the following values have been computed.</span></span>

<span data-ttu-id="54673-1031">**(a)** unidade de vetor normal para cada triângulo de limite de gamut em relação ao produto Standard dot.</span><span class="sxs-lookup"><span data-stu-id="54673-1031">**(a)** Unit normal vector to each Gamut Boundary Triangle with respect to the standard dot product.</span></span>

<span data-ttu-id="54673-1032">**(b)** lista de vértices e lista de borda, além da lista de triângulos.</span><span class="sxs-lookup"><span data-stu-id="54673-1032">**(b)** Vertex list and edge list, in addition to the triangle list.</span></span>

![Diagrama que mostra a rotina ' ProjectPointToBoundary '.](images/gmmp-image122.jpg)

<span data-ttu-id="54673-1034">**Figura 33** : a rotina ProjectPointToBoundary</span><span class="sxs-lookup"><span data-stu-id="54673-1034">**Figure 33** : The ProjectPointToBoundary routine</span></span>

<span data-ttu-id="54673-1035">Tudo isso é uma sobrecarga constante e diminuiria o custo se consultas suficientes a esse limite de gama forem feitas.</span><span class="sxs-lookup"><span data-stu-id="54673-1035">All these are constant overhead, and would have diminishing cost if sufficient queries to this gamut boundary are made.</span></span> <span data-ttu-id="54673-1036">Normalmente, esse é o caso quando você cria um LUT de transformação de um dispositivo para outro, onde há apenas duas gamas fixas, e o LUT de transformação é executado por pontos na grade de amostra uniforme.</span><span class="sxs-lookup"><span data-stu-id="54673-1036">Usually, this is the case when you build a transform LUT from one device to another, where there are only two fixed gamuts, and the transform LUT runs through points on the uniformly sampled grid.</span></span> <span data-ttu-id="54673-1037">Você computa previamente os vetores normais em relação ao produto Standard dot, mesmo que a noção da perpendicularidade se baseie no produto de ponto ponderado, que depende do ponto de consulta, conforme explicado anteriormente.</span><span class="sxs-lookup"><span data-stu-id="54673-1037">You pre-compute the normal vectors with respect to the standard dot product, even though the notion of perpendicularity will be based on the weighted dot product, which depends on the query point as explained previously.</span></span> <span data-ttu-id="54673-1038">O motivo é que um vetor normal em relação ao produto de ponto ponderado pode ser obtido facilmente do vetor normal em relação ao produto Standard dot.</span><span class="sxs-lookup"><span data-stu-id="54673-1038">The reason is because a normal vector with respect to the weighted dot product can be obtained easily from the normal vector with respect to the standard dot product.</span></span> <span data-ttu-id="54673-1039">Se n ₀ for um vetor normal em relação ao produto Standard dot, então</span><span class="sxs-lookup"><span data-stu-id="54673-1039">If n ₀ is a normal vector with respect to the standard dot product, then</span></span>

<span data-ttu-id="54673-1040">n = (componente J-de n ₀/w <sub>J</sub>, a-componente de n ₀, b-Component de n ₀)</span><span class="sxs-lookup"><span data-stu-id="54673-1040">n = (J-component of n ₀ /w <sub>J</sub>, a-component of n ₀, b-component of n ₀ )</span></span>

<span data-ttu-id="54673-1041">é normal para o triângulo em relação ao produto de ponto ponderado.</span><span class="sxs-lookup"><span data-stu-id="54673-1041">is normal to the triangle with respect to the weighted dot product.</span></span> <span data-ttu-id="54673-1042">Por causa dessa relação, ainda é benéfico computar n ₀, mesmo que ele deva ser ajustado com base no ponto de consulta.</span><span class="sxs-lookup"><span data-stu-id="54673-1042">Because of this relationship, it is still beneficial to pre-compute n ₀ even though it must be adjusted based on the query point.</span></span>

<span data-ttu-id="54673-1043">A rotina ProjectPointToBoundary começa redefinindo o "histórico processado" dos vértices e das bordas.</span><span class="sxs-lookup"><span data-stu-id="54673-1043">The ProjectPointToBoundary routine starts by resetting the "processed history" of the vertices and edges.</span></span> <span data-ttu-id="54673-1044">Essas são tabelas de sinalizadores BOOLIANos que controlam se um vértice ou uma borda foi visitada antes.</span><span class="sxs-lookup"><span data-stu-id="54673-1044">These are tables of BOOLEAN flags that track whether a vertex or edge has been visited before.</span></span> <span data-ttu-id="54673-1045">Ele também redefine a variável ShortestDistance para "Infinity", que é o valor codificado máximo no sistema de números de ponto flutuante usado.</span><span class="sxs-lookup"><span data-stu-id="54673-1045">It also resets the variable ShortestDistance to "INFINITY," which is the maximum encoded value in the floating-point number system used.</span></span> <span data-ttu-id="54673-1046">Em seguida, ele é executado por meio de um loop, pesquisando o ponto mais próximo de cada triângulo usando a chamada ProcessTriangle.</span><span class="sxs-lookup"><span data-stu-id="54673-1046">Then it runs through a loop, searching for the closest point from each triangle using the ProcessTriangle call.</span></span> <span data-ttu-id="54673-1047">ProcessTriangle é a rotina para atualizar a variável ShortestDistance e está claramente no loop crítico.</span><span class="sxs-lookup"><span data-stu-id="54673-1047">ProcessTriangle is the routine to update the ShortestDistance variable and is clearly in the critical loop.</span></span> <span data-ttu-id="54673-1048">Uma otimização é parar quando o resultado é bom o suficiente.</span><span class="sxs-lookup"><span data-stu-id="54673-1048">One optimization is to stop when the result is good enough.</span></span> <span data-ttu-id="54673-1049">Após cada chamada para ProcessTriangle, a variável ShortestDistance é examinada.</span><span class="sxs-lookup"><span data-stu-id="54673-1049">After each call to ProcessTriangle, the variable ShortestDistance is examined.</span></span> <span data-ttu-id="54673-1050">Se ele satisfizer um limite predefinido, você poderá parar.</span><span class="sxs-lookup"><span data-stu-id="54673-1050">If it satisfies a predefined threshold, you can stop.</span></span> <span data-ttu-id="54673-1051">O limite predefinido depende do espaço de cores usado e da precisão necessária do sistema de imagem colorida.</span><span class="sxs-lookup"><span data-stu-id="54673-1051">The predefined threshold is dependent on the color space used and on the required accuracy of the color imaging system.</span></span> <span data-ttu-id="54673-1052">Para um aplicativo típico, você não deseja fazer trabalho desnecessário se a diferença de cores for menor do que o que pode ser discernido pela visão humana.</span><span class="sxs-lookup"><span data-stu-id="54673-1052">For a typical application, you do not want to do unnecessary work if the color difference is less than what can be discerned by human vision.</span></span> <span data-ttu-id="54673-1053">Para CIECAM02, essa diferença de cor é 1.</span><span class="sxs-lookup"><span data-stu-id="54673-1053">For CIECAM02, this color difference is 1.</span></span> <span data-ttu-id="54673-1054">No entanto, use um valor de limite de 0, 5 na implementação para preservar a precisão dos cálculos, pois isso pode ser apenas uma etapa intermediária em uma cadeia de transformações.</span><span class="sxs-lookup"><span data-stu-id="54673-1054">Use a threshold value of 0.005 in the implementation, however, to preserve the precision of computations, because this might be only an intermediate step in a chain of transforms.</span></span>

<span data-ttu-id="54673-1055">ProcessTriangle implementa a estratégia anterior II.</span><span class="sxs-lookup"><span data-stu-id="54673-1055">ProcessTriangle implements the preceding Strategy II.</span></span> <span data-ttu-id="54673-1056">Obter um vetor normal do vetor normal da unidade previamente computada para o triângulo com relação ao produto Standard dot, ele computa a distância do ponto de consulta para o plano infinito que contém o triângulo formando o produto do ponto do vetor normal da unidade e o queryVector, o vetor de um dos vértices do triângulo, vertex1, para o ponto de consulta , queryPoint.</span><span class="sxs-lookup"><span data-stu-id="54673-1056">Obtaining a normal vector from the pre-computed unit normal vector to the triangle with respect to the standard dot product, it computes the distance of the query point to the infinite plane containing the triangle by forming the dot product of the unit normal vector and the queryVector, the vector from one of the vertices of the triangle, vertex1, to the query point, queryPoint.</span></span>

<span data-ttu-id="54673-1057">queryVector = queryPoint-vertex1</span><span class="sxs-lookup"><span data-stu-id="54673-1057">queryVector = queryPoint - vertex1</span></span>

<span data-ttu-id="54673-1058">Distance = \| normalVector \* queryVector \| / \| \| normalVector\|\|</span><span class="sxs-lookup"><span data-stu-id="54673-1058">distance = \| normalVector \* queryVector \|/\|\|normalVector\|\|</span></span>

<span data-ttu-id="54673-1059">Esse é um cálculo relativamente barato e a distância é necessária para realizar cálculos adicionais.</span><span class="sxs-lookup"><span data-stu-id="54673-1059">This is a relatively inexpensive calculation, and the distance is required to carry out further calculations.</span></span> <span data-ttu-id="54673-1060">Se essa distância não for menor que a melhor distância atual, ShortestDistance, esse triângulo não produzirá uma distância melhor, pois não dará uma distância melhor do que o plano que a contém.</span><span class="sxs-lookup"><span data-stu-id="54673-1060">If this distance is not less than the current best distance, ShortestDistance, this triangle will not produce a better distance, because it will not give a better distance than the plane containing it.</span></span> <span data-ttu-id="54673-1061">Nesse caso, você retorna o controle para o loop de triângulo.</span><span class="sxs-lookup"><span data-stu-id="54673-1061">In this case, you return control to the triangle loop.</span></span> <span data-ttu-id="54673-1062">Se a distância for menor do que ShortestDistance, potencialmente, você terá um ponto mais próximo, se esse ponto estiver dentro do triângulo.</span><span class="sxs-lookup"><span data-stu-id="54673-1062">If the distance is smaller than ShortestDistance, potentially, you have a closer point, if this point lies inside the triangle.</span></span> <span data-ttu-id="54673-1063">Você deve executar alguns cálculos "difíceis" (embora nada além de algebra linear) para determinar isso.</span><span class="sxs-lookup"><span data-stu-id="54673-1063">You must perform some "hard" calculations (though nothing beyond linear algebra) to determine that.</span></span> <span data-ttu-id="54673-1064">Se os outros dois vértices do triângulo forem vertex2 e vertex3, formate os vetores de base firstBasisVector e secondBasisVector.</span><span class="sxs-lookup"><span data-stu-id="54673-1064">If the other two vertices of the triangle are vertex2 and vertex3, then form the basis vectors firstBasisVector and secondBasisVector.</span></span>

<span data-ttu-id="54673-1065">firstBasisVector = vertex2-vertex1</span><span class="sxs-lookup"><span data-stu-id="54673-1065">firstBasisVector = vertex2 - vertex1</span></span>

<span data-ttu-id="54673-1066">secondBasisVector = vertex3-vertex1</span><span class="sxs-lookup"><span data-stu-id="54673-1066">secondBasisVector = vertex3 - vertex1</span></span>

<span data-ttu-id="54673-1067">Use o sistema linear a seguir de equações para resolver os desconhecidos e v.</span><span class="sxs-lookup"><span data-stu-id="54673-1067">Use the following linear system of equations to solve for unknowns u and v.</span></span>

<span data-ttu-id="54673-1068">firstBasisVector \* queryVector = (firstBasisVector \* firstBasisVector) u + (firstBasisVector \* secondBasisVector) v</span><span class="sxs-lookup"><span data-stu-id="54673-1068">firstBasisVector \* queryVector = (firstBasisVector \* firstBasisVector)u + (firstBasisVector \* secondBasisVector)v</span></span>

<span data-ttu-id="54673-1069">secondBasisVector \* queryVector = (secondBasisVector \* firstBasisVector) u + (secondBasisVector \* secondBasisVector) v</span><span class="sxs-lookup"><span data-stu-id="54673-1069">secondBasisVector \* queryVector = (secondBasisVector \* firstBasisVector)u + (secondBasisVector \* secondBasisVector)v</span></span>

<span data-ttu-id="54673-1070">e as condições para o ponto projetado estar dentro do triângulo são:</span><span class="sxs-lookup"><span data-stu-id="54673-1070">and the conditions for the projected point to lie inside the triangle are:</span></span>

<span data-ttu-id="54673-1071">0 ≤ u ≤ 1, 0 ≤ v ≤ 1 e + v ≤ 1</span><span class="sxs-lookup"><span data-stu-id="54673-1071">0 ≤ u ≤ 1, 0 ≤ v ≤ 1 and u + v ≤ 1</span></span>

<span data-ttu-id="54673-1072">Após esse cálculo, se for determinado que o ponto projetado está dentro do triângulo, você encontrará um novo ponto mais próximo; a distância que você calculou no início é a nova distância mais curta.</span><span class="sxs-lookup"><span data-stu-id="54673-1072">After this calculation, if it is determined that the projected point lies within the triangle, then you have found a new closest point; the distance that you calculated at the beginning is the new shortest distance.</span></span> <span data-ttu-id="54673-1073">Nesse caso, atualize as variáveis ShortestDistance e ClosestPoint.</span><span class="sxs-lookup"><span data-stu-id="54673-1073">In this case, update the variables ShortestDistance and ClosestPoint.</span></span> <span data-ttu-id="54673-1074">Se o ponto projetado estiver fora do triângulo, você poderá encontrar um ponto mais próximo em uma de suas bordas.</span><span class="sxs-lookup"><span data-stu-id="54673-1074">If the projected point lies outside the triangle, you might find a closer point on one of its edges.</span></span> <span data-ttu-id="54673-1075">Portanto, você pode chamar a rotina ProcessEdge em cada uma das três bordas.</span><span class="sxs-lookup"><span data-stu-id="54673-1075">So, you can call the ProcessEdge routine on each of the three edges.</span></span>

![Diagrama que mostra o fluxo das rotinas ProcessEdge e ProcessVertex.](images/gmmp-image124.jpg)

<span data-ttu-id="54673-1077">**Figura 34** : rotinas ProcessEdge e ProcessVertex</span><span class="sxs-lookup"><span data-stu-id="54673-1077">**Figure 34** : ProcessEdge and ProcessVertex routines</span></span>

<span data-ttu-id="54673-1078">A rotina ProcessEdge implementa a estratégia I, que é ilustrada na Figura 34.</span><span class="sxs-lookup"><span data-stu-id="54673-1078">The ProcessEdge routine implements Strategy I, which is illustrated in Figure 34.</span></span> <span data-ttu-id="54673-1079">ProcessEdge começa verificando se a borda foi processada antes.</span><span class="sxs-lookup"><span data-stu-id="54673-1079">ProcessEdge starts by checking whether the edge has been processed before.</span></span> <span data-ttu-id="54673-1080">Nesse caso, nenhuma ação adicional é executada.</span><span class="sxs-lookup"><span data-stu-id="54673-1080">If so, no further action is taken.</span></span> <span data-ttu-id="54673-1081">Caso contrário, ele continua a calcular a projeção ortogonal do ponto de consulta na linha infinita que contém a borda.</span><span class="sxs-lookup"><span data-stu-id="54673-1081">If not, it proceeds to calculate the orthogonal projection of the query point onto the infinite line containing the edge.</span></span> <span data-ttu-id="54673-1082">A Algebra linear envolvida no cálculo é semelhante às equações de triângulo anteriores.</span><span class="sxs-lookup"><span data-stu-id="54673-1082">The linear algebra involved in the calculation is similar to the previous triangle equations.</span></span> <span data-ttu-id="54673-1083">No entanto, o cálculo é mais simples, não é descrito aqui.</span><span class="sxs-lookup"><span data-stu-id="54673-1083">However, the calculation is simpler, it is not described here.</span></span> <span data-ttu-id="54673-1084">Se o ponto projetado estiver dentro da borda, você descobrirá a distância do ponto projetado do ponto de consulta.</span><span class="sxs-lookup"><span data-stu-id="54673-1084">If the projected point lies within the edge, you find the distance of the projected point from the query point.</span></span> <span data-ttu-id="54673-1085">Se essa distância for menor que ShortestDistance, você encontrará um novo ponto mais próximo.</span><span class="sxs-lookup"><span data-stu-id="54673-1085">If this distance is smaller than ShortestDistance, you have found a new closest point.</span></span> <span data-ttu-id="54673-1086">Atualize ShortestDistance e ClosestPoint.</span><span class="sxs-lookup"><span data-stu-id="54673-1086">Update both ShortestDistance and ClosestPoint.</span></span> <span data-ttu-id="54673-1087">Se o ponto projetado estiver fora da borda, chame ProcessVertex nos dois pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="54673-1087">If the projected point lies outside the edge, call ProcessVertex on the two end points.</span></span> <span data-ttu-id="54673-1088">Antes de retornar o controle, atualize o histórico de borda para que essa borda seja marcada como "PROCESSAda".</span><span class="sxs-lookup"><span data-stu-id="54673-1088">Before returning control, update the edge history so that this edge is marked as "PROCESSED."</span></span>

<span data-ttu-id="54673-1089">Por fim, você fornece uma descrição de ProcessVertex.</span><span class="sxs-lookup"><span data-stu-id="54673-1089">Finally, you give a description of ProcessVertex.</span></span> <span data-ttu-id="54673-1090">A rotina ProjectVertex também implementa a estratégia I e mantém uma tabela de histórico de vértice.</span><span class="sxs-lookup"><span data-stu-id="54673-1090">The ProjectVertex routine also implements Strategy I and maintains a vertex history table.</span></span> <span data-ttu-id="54673-1091">Como ilustrado na Figura 34, ele primeiro verifica se o vértice foi processado antes.</span><span class="sxs-lookup"><span data-stu-id="54673-1091">As illustrated in Figure 34, it first checks whether the vertex has been processed before.</span></span> <span data-ttu-id="54673-1092">Nesse caso, nenhuma ação adicional é executada.</span><span class="sxs-lookup"><span data-stu-id="54673-1092">If so, no further action is taken.</span></span> <span data-ttu-id="54673-1093">Caso contrário, ele prossegue para calcular a distância do vértice do ponto de consulta.</span><span class="sxs-lookup"><span data-stu-id="54673-1093">If not, it proceeds to calculate the distance of the vertex from the query point.</span></span> <span data-ttu-id="54673-1094">Se a distância for menor que ShortestDistance, atualize ShortestDistance e ClosestPoint.</span><span class="sxs-lookup"><span data-stu-id="54673-1094">If the distance is smaller than ShortestDistance, update both ShortestDistance and ClosestPoint.</span></span> <span data-ttu-id="54673-1095">No final, ele atualiza o histórico de vértice para que esse vértice seja marcado como "processado".</span><span class="sxs-lookup"><span data-stu-id="54673-1095">At the end, it updates the vertex history so that this vertex is marked as "PROCESSED."</span></span>

<span data-ttu-id="54673-1096">Quando o loop de controle externo tiver esgotado todos os triângulos ou encerrado antes do limite de diferença de cor ter sido atingido, a variável ClosestPoint será acessada.</span><span class="sxs-lookup"><span data-stu-id="54673-1096">When the outer control loop has either exhausted all the triangles or exited before color difference threshold has been met, the variable ClosestPoint is accessed.</span></span> <span data-ttu-id="54673-1097">Esse é o resultado de MinDEMap.</span><span class="sxs-lookup"><span data-stu-id="54673-1097">This is the result of MinDEMap.</span></span> <span data-ttu-id="54673-1098">O chamador também pode recuperar ShortestDistance se estiver interessado em quão longe a cor mapeada é da cor da consulta.</span><span class="sxs-lookup"><span data-stu-id="54673-1098">The caller can also retrieve ShortestDistance if interested in how far the mapped color is from the query color.</span></span>

### <a name="hue-smoothing"></a><span data-ttu-id="54673-1099">Suavização de matiz</span><span class="sxs-lookup"><span data-stu-id="54673-1099">Hue Smoothing</span></span>

![Diagrama que mostra duas exibições principais de suavização de matiz, o original na parte superior e o matiz suaves na parte inferior.](images/gmmp-image125.png)

<span data-ttu-id="54673-1101">**Figura 35** : suavização de matiz</span><span class="sxs-lookup"><span data-stu-id="54673-1101">**Figure 35** : Hue Smoothing</span></span>

<span data-ttu-id="54673-1102">Um problema ocorre com as operações que são restritas por matiz; ou seja, a operação só considera variáveis em um plano de matiz.</span><span class="sxs-lookup"><span data-stu-id="54673-1102">An issue arises with operations that are hue constrained; that is, the operation only considers variables within a hue plane.</span></span> <span data-ttu-id="54673-1103">A Figura 35 mostra um exemplo de uma gama que exibe fatias de matiz "descontínuas" no matiz azul.</span><span class="sxs-lookup"><span data-stu-id="54673-1103">Figure 35 shows an example of a gamut exhibiting "discontinuous" hue slices in the blue hues.</span></span> <span data-ttu-id="54673-1104">Dentro desse intervalo de matizes, para certos ângulos de matiz, o limite de gama é tangential para o plano de matiz.</span><span class="sxs-lookup"><span data-stu-id="54673-1104">Within this hue range, for certain hue angles, the gamut boundary is tangential to the hue plane.</span></span> <span data-ttu-id="54673-1105">Na verdade, isso causa uma alteração na estrutura topológica das fatias de matiz.</span><span class="sxs-lookup"><span data-stu-id="54673-1105">In effect, this causes a change in the topological structure of the hue slices.</span></span> <span data-ttu-id="54673-1106">No exemplo mostrado, como o plano de matiz varre esse intervalo de matizes, uma "ilha" surge e submesclagens.</span><span class="sxs-lookup"><span data-stu-id="54673-1106">In the example shown, as the hue plane sweeps across this hue range, an "island" emerges and submerges.</span></span> <span data-ttu-id="54673-1107">Essa alteração na topologia fará com que as operações específicas de matiz sejam descontínuas.</span><span class="sxs-lookup"><span data-stu-id="54673-1107">This change in topology will cause hue specific operations to be discontinuous.</span></span> <span data-ttu-id="54673-1108">Por exemplo, o Cusp em matiz fixo será alterado abruptamente conforme o ângulo de matiz mudar em todo esse intervalo.</span><span class="sxs-lookup"><span data-stu-id="54673-1108">For example, the cusp at fixed hue will change abruptly as the hue angle changes across this range.</span></span>

<span data-ttu-id="54673-1109">Há um motivo de ciência da cor por que é desejável preservar o matiz em determinadas operações.</span><span class="sxs-lookup"><span data-stu-id="54673-1109">There is a color science reason why it is desirable to preserve hue in certain operations.</span></span> <span data-ttu-id="54673-1110">Para resolver o problema anterior, os triângulos de limite de gamut originais devem ser "matiz suaves".</span><span class="sxs-lookup"><span data-stu-id="54673-1110">To resolve the preceding issue, the original Gamut Boundary Triangles must be "hue smoothed."</span></span> <span data-ttu-id="54673-1111">Em termos gerais, uma suavização de matizes de um conjunto de triângulos de limite de gamut é um conjunto de triângulos de forma que (a) ele forma o limite de uma nova "gama", que pode não corresponder à gama real do dispositivo e que contém a gama definida pelo conjunto original de triângulos; e (b) os triângulos no novo conjunto estão limitados de serem paralelos aos planos de matiz.</span><span class="sxs-lookup"><span data-stu-id="54673-1111">Generally speaking, a hue smoothing of a set of Gamut Boundary Triangles is a set of triangles such that (a) it forms the boundary of a new "gamut," which might not correspond to the actual device gamut, and that contains the gamut defined by the original set of triangles; and (b) the triangles in the new set are bounded away from being parallel to the hue planes.</span></span>

<span data-ttu-id="54673-1112">Uma maneira prática de obter um conjunto de triângulos suaves de matiz é pegar o convexa envoltória dos vértices originais.</span><span class="sxs-lookup"><span data-stu-id="54673-1112">One practical way to obtain a hue smoothed set of triangles is to take the convex hull of the original vertices.</span></span> <span data-ttu-id="54673-1113">Como ilustrado na Figura 35, as fatias de matiz do convexa envoltória variam suavemente no intervalo de matiz problemático, sem uma alteração repentina na topologia.</span><span class="sxs-lookup"><span data-stu-id="54673-1113">As illustrated in Figure 35, the hue slices of the convex hull vary smoothly in the problematic hue range without a sudden change in topology.</span></span>

### <a name="setting-primaries-and-secondaries-in-the-gamut-boundary-description"></a><span data-ttu-id="54673-1114">Definindo primárias e secundárias na descrição do limite de gama</span><span class="sxs-lookup"><span data-stu-id="54673-1114">Setting Primaries and Secondaries in the Gamut Boundary Description</span></span>

<span data-ttu-id="54673-1115">Determinados métodos de mapeamento de gama, como HueMap, dependem do local dos primários e secundários do dispositivo.</span><span class="sxs-lookup"><span data-stu-id="54673-1115">Certain gamut mapping methods, such as HueMap, depend on the location of the device primaries and secondaries.</span></span> <span data-ttu-id="54673-1116">Para dispositivos aditivos, os primários são vermelho, verde e azul (R, G e B); e os secundários são ciano, magenta e amarelo (C, M e Y).</span><span class="sxs-lookup"><span data-stu-id="54673-1116">For additive devices, the primaries are red, green, and blue (R, G, and B); and the secondaries are cyan, magenta, and yellow (C, M, and Y).</span></span> <span data-ttu-id="54673-1117">Para dispositivos subtraíis, os primários são C, M e Y; e os secundários são R, G e B. O GBD mantém o controle de todos os seis valores, além de branco e preto (W e K), em uma matriz de valores de cor jab.</span><span class="sxs-lookup"><span data-stu-id="54673-1117">For subtractive devices, the primaries are C, M, and Y; and the secondaries are R, G, and B. The GBD keeps track of all six of those values, plus white and black (W and K), in a array of Jab color values.</span></span> <span data-ttu-id="54673-1118">Esses valores são definidos na descrição do limite de gamut quando ele é criado.</span><span class="sxs-lookup"><span data-stu-id="54673-1118">These values are set into the gamut boundary description when it is created.</span></span> <span data-ttu-id="54673-1119">Para dispositivos de saída, os primários podem ser determinados pela execução de combinações de valores de controle de dispositivo por meio do modelo de dispositivo.</span><span class="sxs-lookup"><span data-stu-id="54673-1119">For output devices, the primaries can be determined by running combinations of device control values through the device model.</span></span> <span data-ttu-id="54673-1120">Para dispositivos de captura, essa abordagem não é adequada para criar a referência GBD, pois é quase impossível capturar uma imagem que produz um valor de dispositivo puro totalmente saturado, como (0,0, 0,0, 1,0).</span><span class="sxs-lookup"><span data-stu-id="54673-1120">For capture devices, this approach is not well-suited for creating the reference GBD, because it is almost impossible to capture an image that yields a fully saturated pure device value, such as (0.0, 0.0, 1.0).</span></span> <span data-ttu-id="54673-1121">Os perfis de dispositivo WCS contêm os índices dos primários no destino de captura.</span><span class="sxs-lookup"><span data-stu-id="54673-1121">WCS device profiles contain the indices of the primaries in the capture target.</span></span> <span data-ttu-id="54673-1122">Como esses valores não estão contidos em um perfil ICC, use valores medidos de um destino de scanner típico após a conversão em jab, em relação às condições de exibição de ICC.</span><span class="sxs-lookup"><span data-stu-id="54673-1122">Because these values are not contained in an ICC profile, use values measured from a typical scanner target after converting to Jab, relative to the ICC viewing conditions.</span></span>

### <a name="setting-the-neutral-axis-in-the-gamut-boundary-description"></a><span data-ttu-id="54673-1123">Definindo o eixo neutro na descrição do limite de gama</span><span class="sxs-lookup"><span data-stu-id="54673-1123">Setting the Neutral Axis in the Gamut Boundary Description</span></span>

<span data-ttu-id="54673-1124">Os métodos de mapeamento de gamut HueMap e Relative MinCD usam o eixo neutro do dispositivo para retificação.</span><span class="sxs-lookup"><span data-stu-id="54673-1124">The HueMap and the Relative MinCD gamut mapping methods use the device neutral axis for straightening.</span></span> <span data-ttu-id="54673-1125">Para os dispositivos de saída de linha de base, o eixo neutro pode ser determinado pela execução de valores neutros de dispositivo (R = G = B ou C = M = Y) por meio do método DeviceToColorimetric e, em seguida, pelo método ColorimetricToAppearance do objeto CIECAM02.</span><span class="sxs-lookup"><span data-stu-id="54673-1125">For the baseline output devices, the neutral axis can be determined by running device neutral values (R=G=B or C=M=Y) through the DeviceToColorimetric method, and then through the ColorimetricToAppearance method of the CIECAM02 object.</span></span> <span data-ttu-id="54673-1126">No entanto, os dispositivos de captura nem sempre retornam um valor neutro de dispositivo quando apresentados com um exemplo neutro.</span><span class="sxs-lookup"><span data-stu-id="54673-1126">However, capture devices do not always return a device neutral value when presented with a neutral sample.</span></span> <span data-ttu-id="54673-1127">Isso é especialmente verdadeiro quando a iluminação ambiente não é perfeitamente neutra.</span><span class="sxs-lookup"><span data-stu-id="54673-1127">This is particularly true when the ambient lighting is not perfectly neutral.</span></span> <span data-ttu-id="54673-1128">Os perfis de dispositivo WCS contêm os índices dos exemplos neutros no destino.</span><span class="sxs-lookup"><span data-stu-id="54673-1128">WCS device profiles contain the indices of the neutral samples in the target.</span></span> <span data-ttu-id="54673-1129">Use esses exemplos para definir o eixo neutro.</span><span class="sxs-lookup"><span data-stu-id="54673-1129">Use those samples to set the neutral axis.</span></span> <span data-ttu-id="54673-1130">Como essas informações não estão disponíveis para perfis ICC, você deve usar o mesmo método usado para dispositivos de saída; Execute amostras neutras de dispositivo por meio do método DeviceToColorimetric e, em seguida, associe os valores de entrada e os resultados colorimétrico.</span><span class="sxs-lookup"><span data-stu-id="54673-1130">Because this information is not available for ICC profiles, you must use the same method that is used for output devices; run device neutral samples through the DeviceToColorimetric method, and then couple the input values and the colorimetric results.</span></span>

## <a name="related-topics"></a><span data-ttu-id="54673-1131">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="54673-1131">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="54673-1132">Conceitos básicos de gerenciamento de cores</span><span class="sxs-lookup"><span data-stu-id="54673-1132">Basic color management concepts</span></span>](basic-color-management-concepts.md)
</dt> <dt>

[<span data-ttu-id="54673-1133">Algoritmos e esquemas do sistema de cores do Windows</span><span class="sxs-lookup"><span data-stu-id="54673-1133">Windows Color System Schemas and Algorithms</span></span>](windows-color-system-schemas-and-algorithms.md)
</dt> </dl>

 

 




