---
title: Como hospedar um controle ActiveX sem janela do MSAA
description: Saiba como criar um contêiner de controle que pode hospedar controles Microsoft ActiveX sem janelas que implementam o Microsoft Acessibilidade Ativa.
ms.assetid: 9497561C-37ED-4094-A6B0-C219F63C04B6
keywords:
- MSAA, controle ActiveX sem janela
- Controle ActiveX sem janela, MSAA
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9de45313b19490af3c3fffb633f3822ad93d25a4
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/20/2020
ms.locfileid: "103641155"
---
# <a name="how-to-host-an-msaa-windowless-activex-control"></a><span data-ttu-id="20461-105">Como hospedar um controle ActiveX sem janela do MSAA</span><span class="sxs-lookup"><span data-stu-id="20461-105">How to Host an MSAA Windowless ActiveX Control</span></span>

<span data-ttu-id="20461-106">Saiba como criar um contêiner de controle que pode hospedar controles Microsoft ActiveX sem janelas que implementam o Microsoft Acessibilidade Ativa.</span><span class="sxs-lookup"><span data-stu-id="20461-106">Learn how to create a control container that can host windowless Microsoft ActiveX controls that implement Microsoft Active Accessibility.</span></span> <span data-ttu-id="20461-107">Seguindo as etapas descritas aqui, você pode garantir que todos os controles sem janela baseados no Microsoft Acessibilidade Ativa hospedados no seu contêiner de controle estejam acessíveis para aplicativos cliente de tecnologia assistencial (AT).</span><span class="sxs-lookup"><span data-stu-id="20461-107">By following the steps described here, you can ensure that any Microsoft Active Accessibility-based windowless controls that are hosted in your control container are accessible to assistive technology (AT) client applications.</span></span>

## <a name="what-you-need-to-know"></a><span data-ttu-id="20461-108">O que você precisa saber</span><span class="sxs-lookup"><span data-stu-id="20461-108">What you need to know</span></span>

### <a name="technologies"></a><span data-ttu-id="20461-109">Tecnologias</span><span class="sxs-lookup"><span data-stu-id="20461-109">Technologies</span></span>

-   [<span data-ttu-id="20461-110">Controles ActiveX</span><span class="sxs-lookup"><span data-stu-id="20461-110">ActiveX Controls</span></span>](/windows/desktop/com/activex-controls)
-   [<span data-ttu-id="20461-111">Acessibilidade Ativa da Microsoft</span><span class="sxs-lookup"><span data-stu-id="20461-111">Microsoft Active Accessibility</span></span>](microsoft-active-accessibility.md)

### <a name="prerequisites"></a><span data-ttu-id="20461-112">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="20461-112">Prerequisites</span></span>

-   <span data-ttu-id="20461-113">C/C++</span><span class="sxs-lookup"><span data-stu-id="20461-113">C/C++</span></span>
-   <span data-ttu-id="20461-114">Programação do COM (Microsoft Win32 e Component Object Model)</span><span class="sxs-lookup"><span data-stu-id="20461-114">Microsoft Win32 and Component Object Model (COM) programming</span></span>
-   <span data-ttu-id="20461-115">Controles ActiveX sem janela</span><span class="sxs-lookup"><span data-stu-id="20461-115">Windowless ActiveX controls</span></span>
-   <span data-ttu-id="20461-116">Servidores Microsoft Acessibilidade Ativa</span><span class="sxs-lookup"><span data-stu-id="20461-116">Microsoft Active Accessibility servers</span></span>

## <a name="instructions"></a><span data-ttu-id="20461-117">Instruções</span><span class="sxs-lookup"><span data-stu-id="20461-117">Instructions</span></span>

### <a name="step-1-provide-the-root-iaccessible-interface-on-behalf-of-the-windowless-control"></a><span data-ttu-id="20461-118">Etapa 1: fornecer a interface IAccessible raiz em nome do controle sem janela.</span><span class="sxs-lookup"><span data-stu-id="20461-118">Step 1: Provide the root IAccessible interface on behalf of the windowless control.</span></span>

<span data-ttu-id="20461-119">Sempre que o sistema precisar do ponteiro [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) para a raiz de um controle sem janela, o sistema consultará o contêiner de controle.</span><span class="sxs-lookup"><span data-stu-id="20461-119">Whenever the system needs the [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) pointer for the root of a windowless control, the system queries the control container.</span></span> <span data-ttu-id="20461-120">Para recuperar o ponteiro, o contêiner chama a implementação de controle sem janela do método [**IServiceProvider:: QueryService**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/cc678966(v=vs.85)) .</span><span class="sxs-lookup"><span data-stu-id="20461-120">To retrieve the pointer, the container calls the windowless control's implementation of the [**IServiceProvider::QueryService**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/cc678966(v=vs.85)) method.</span></span>

<span data-ttu-id="20461-121">Se o contêiner de controle tiver uma implementação de Acessibilidade Ativa da Microsoft, ele poderá retornar o ponteiro [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) do controle sem janela para o sistema.</span><span class="sxs-lookup"><span data-stu-id="20461-121">If the control container has a Microsoft Active Accessibility implementation, it can return the windowless control's [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) pointer to the system.</span></span>

<span data-ttu-id="20461-122">Se o contêiner de controle tiver uma implementação de automação de interface do usuário da Microsoft, chame a função [**UiaProviderFromIAccessible**](/windows/desktop/api/UIAutomationCoreApi/nf-uiautomationcoreapi-uiaproviderfromiaccessible) para obter um ponteiro de interface [**IRawElementProviderSimple**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-irawelementprovidersimple) que represente o controle e, em seguida, retorne o ponteiro de interface **IRawElementProviderSimple** para o sistema.</span><span class="sxs-lookup"><span data-stu-id="20461-122">If the control container has a Microsoft UI Automation implementation, call the [**UiaProviderFromIAccessible**](/windows/desktop/api/UIAutomationCoreApi/nf-uiautomationcoreapi-uiaproviderfromiaccessible) function to obtain an [**IRawElementProviderSimple**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-irawelementprovidersimple) interface pointer that represents the control, and then return the **IRawElementProviderSimple** interface pointer to the system.</span></span>

### <a name="step-2-respond-to-the-wm_getobject-message-on-behalf-of-the-windowless-control"></a><span data-ttu-id="20461-123">Etapa 2: responder à mensagem do WM \_ GetObject em nome do controle sem janela.</span><span class="sxs-lookup"><span data-stu-id="20461-123">Step 2: Respond to the WM\_GETOBJECT message on behalf of the windowless control.</span></span>

<span data-ttu-id="20461-124">Quando um aplicativo cliente responde a um WinEvent gerado por um controle sem janela, o contêiner de controle recebe uma mensagem do [**WM \_ GetObject**](wm-getobject.md) em nome do controle.</span><span class="sxs-lookup"><span data-stu-id="20461-124">When a client application responds to a WinEvent raised by a windowless control, the control container receives a [**WM\_GETOBJECT**](wm-getobject.md) message on behalf of the control.</span></span> <span data-ttu-id="20461-125">A mensagem inclui a ID de objeto do controle sem janela que disparou o evento.</span><span class="sxs-lookup"><span data-stu-id="20461-125">The message includes the object ID of the windowless control that raised the event.</span></span>

<span data-ttu-id="20461-126">O contêiner de controle responde pesquisando o controle sem janela que "possui" a ID de objeto e, em seguida, chamando o método [**IAccessibleHandler:: AccessibleObjectFromID**](/windows/desktop/api/Oleacc/nf-oleacc-iaccessiblehandler-accessibleobjectfromid) do controle.</span><span class="sxs-lookup"><span data-stu-id="20461-126">The control container responds by looking up the windowless control that "owns" the object ID, and then calling that control's [**IAccessibleHandler::AccessibleObjectFromID**](/windows/desktop/api/Oleacc/nf-oleacc-iaccessiblehandler-accessibleobjectfromid) method.</span></span> <span data-ttu-id="20461-127">O método **AccessibleObjectFromID** retorna o ponteiro da interface [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) para o item da interface do usuário, e o contêiner de controle retorna o ponteiro para o sistema, que o encaminha para o aplicativo cliente.</span><span class="sxs-lookup"><span data-stu-id="20461-127">The **AccessibleObjectFromID** method returns the [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) interface pointer for the UI item, and the control container returns the pointer to the system, which forwards it to the client application.</span></span>

### <a name="step-3-implement-the-iaccessiblewindowlesssite-interface"></a><span data-ttu-id="20461-128">Etapa 3: implementar a interface IAccessibleWindowlessSite.</span><span class="sxs-lookup"><span data-stu-id="20461-128">Step 3: Implement the IAccessibleWindowlessSite interface.</span></span>

1.  <span data-ttu-id="20461-129">Implemente o método [**IAccessibleWindowlessSite:: GetParentAccessible**](/windows/desktop/api/oleacc/nf-oleacc-iaccessiblewindowlesssite-getparentaccessible) .</span><span class="sxs-lookup"><span data-stu-id="20461-129">Implement the [**IAccessibleWindowlessSite::GetParentAccessible**](/windows/desktop/api/oleacc/nf-oleacc-iaccessiblewindowlesssite-getparentaccessible) method.</span></span>

    <span data-ttu-id="20461-130">Quando um aplicativo cliente precisa de informações de acessibilidade sobre o pai do provedor raiz do controle sem janela, o sistema chama o método [**IAccessible:: get \_ accParent**](/windows/desktop/api/Oleacc/nf-oleacc-iaccessible-get_accparent) do controle sem janela.</span><span class="sxs-lookup"><span data-stu-id="20461-130">When a client application needs accessibility information about the parent of the windowless control's root provider, the system calls the windowless control's [**IAccessible::get\_accParent**](/windows/desktop/api/Oleacc/nf-oleacc-iaccessible-get_accparent) method.</span></span> <span data-ttu-id="20461-131">O controle responde chamando o método [**IAccessibleWindowlessSite:: GetParentAccessible**](/windows/desktop/api/oleacc/nf-oleacc-iaccessiblewindowlesssite-getparentaccessible) do contêiner de controle, que fornece o ponteiro [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) do pai do controle sem janela.</span><span class="sxs-lookup"><span data-stu-id="20461-131">The control responds by calling the control container's [**IAccessibleWindowlessSite::GetParentAccessible**](/windows/desktop/api/oleacc/nf-oleacc-iaccessiblewindowlesssite-getparentaccessible) method, which provides the [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) pointer of the windowless control's parent.</span></span>

2.  <span data-ttu-id="20461-132">Implemente os métodos [**IAccessibleWindowlessSite:: AcquireObjectIdRange**](/windows/desktop/api/oleacc/nf-oleacc-iaccessiblewindowlesssite-acquireobjectidrange), [**QueryObjectIdRange**](/windows/desktop/api/oleacc/nf-oleacc-iaccessiblewindowlesssite-queryobjectidranges)e [**ReleaseObjectIdRange**](/windows/desktop/api/oleacc/nf-oleacc-iaccessiblewindowlesssite-releaseobjectidrange) .</span><span class="sxs-lookup"><span data-stu-id="20461-132">Implement the [**IAccessibleWindowlessSite::AcquireObjectIdRange**](/windows/desktop/api/oleacc/nf-oleacc-iaccessiblewindowlesssite-acquireobjectidrange), [**QueryObjectIdRange**](/windows/desktop/api/oleacc/nf-oleacc-iaccessiblewindowlesssite-queryobjectidranges), and [**ReleaseObjectIdRange**](/windows/desktop/api/oleacc/nf-oleacc-iaccessiblewindowlesssite-releaseobjectidrange) methods.</span></span>

    <span data-ttu-id="20461-133">Seu contêiner de controle deve manter um mapeamento de intervalos de ID de objeto para controles sem janela.</span><span class="sxs-lookup"><span data-stu-id="20461-133">Your control container must maintain a mapping of object ID ranges to windowless controls.</span></span> <span data-ttu-id="20461-134">O mapeamento permite que o contêiner de controle identifique o controle que deve responder a uma solicitação específica para uma ID de objeto.</span><span class="sxs-lookup"><span data-stu-id="20461-134">The mapping enables the control container to identify the control that should respond to a particular request for an object ID.</span></span> <span data-ttu-id="20461-135">A tabela a seguir mostra um exemplo de mapeamento de intervalos de ID de objeto para controles sem janela.</span><span class="sxs-lookup"><span data-stu-id="20461-135">The following table shows an example of mapping object ID ranges to windowless controls.</span></span>

    

    | <span data-ttu-id="20461-136">Base do intervalo</span><span class="sxs-lookup"><span data-stu-id="20461-136">Range base</span></span> | <span data-ttu-id="20461-137">Tamanho do intervalo</span><span class="sxs-lookup"><span data-stu-id="20461-137">Range size</span></span> | <span data-ttu-id="20461-138">Control</span><span class="sxs-lookup"><span data-stu-id="20461-138">Control</span></span>   |
    |------------|------------|-----------|
    | <span data-ttu-id="20461-139">1000</span><span class="sxs-lookup"><span data-stu-id="20461-139">1000</span></span>       | <span data-ttu-id="20461-140">500</span><span class="sxs-lookup"><span data-stu-id="20461-140">500</span></span>        | <span data-ttu-id="20461-141">Controle 1</span><span class="sxs-lookup"><span data-stu-id="20461-141">Control 1</span></span> |
    | <span data-ttu-id="20461-142">1500</span><span class="sxs-lookup"><span data-stu-id="20461-142">1500</span></span>       | <span data-ttu-id="20461-143">1000</span><span class="sxs-lookup"><span data-stu-id="20461-143">1000</span></span>       | <span data-ttu-id="20461-144">Controle 2</span><span class="sxs-lookup"><span data-stu-id="20461-144">Control 2</span></span> |
    | <span data-ttu-id="20461-145">2500</span><span class="sxs-lookup"><span data-stu-id="20461-145">2500</span></span>       | <span data-ttu-id="20461-146">2000</span><span class="sxs-lookup"><span data-stu-id="20461-146">2000</span></span>       | <span data-ttu-id="20461-147">Controle 1</span><span class="sxs-lookup"><span data-stu-id="20461-147">Control 1</span></span> |

    

     

    <span data-ttu-id="20461-148">O contêiner de controle deve manter o mapeamento de intervalos de ID de objeto para controles sem janelas para si mesmo e todos os filhos sem janelas.</span><span class="sxs-lookup"><span data-stu-id="20461-148">The control container must maintain the mapping of object ID ranges to windowless controls for itself and all windowless children.</span></span> <span data-ttu-id="20461-149">Os intervalos de ID de objeto não precisam ser adjacentes uns aos outros.</span><span class="sxs-lookup"><span data-stu-id="20461-149">The object ID ranges do not need to be adjacent to one another.</span></span> <span data-ttu-id="20461-150">Além disso, para evitar ataques de negação de serviço, o contêiner de controle pode colocar limites no número de intervalos que são concedidos a um controle específico.</span><span class="sxs-lookup"><span data-stu-id="20461-150">Also, to avoid denial-of-service attacks, the control container can place limits on the number of ranges that are granted to a particular control.</span></span> <span data-ttu-id="20461-151">No entanto, é útil permitir mais de um intervalo por controle, para permitir que um controle cresça.</span><span class="sxs-lookup"><span data-stu-id="20461-151">However, it is useful to allow more than one range per control, to enable a control to grow.</span></span>

### <a name="step-4-optional-implement-the-iaccessiblehostingelementproviders-interface"></a><span data-ttu-id="20461-152">Etapa 4: opcional: implementar a interface IAccessibleHostingElementProviders.</span><span class="sxs-lookup"><span data-stu-id="20461-152">Step 4: Optional: Implement the IAccessibleHostingElementProviders interface.</span></span>

<span data-ttu-id="20461-153">Implemente a interface [**IAccessibleHostingElementProviders**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-iaccessiblehostingelementproviders) se o seu contêiner de controle tiver uma implementação do Microsoft acessibilidade ativa Server e o servidor for a raiz de uma árvore de acessibilidade que inclui controles ActiveX sem janela que dão suporte à automação da interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="20461-153">Implement the [**IAccessibleHostingElementProviders**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-iaccessiblehostingelementproviders) interface if your control container has a Microsoft Active Accessibility server implementation and the server is the root of an accessibility tree that includes windowless ActiveX controls that support UI Automation.</span></span> <span data-ttu-id="20461-154">A interface **IAccessibleHostingElementProviders** tem um único método, [**GetEmbeddedFragmentRoots**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-irawelementproviderfragment-getembeddedfragmentroots), que recupera os ponteiros de interface [**IRawElementProviderFragmentRoot**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-irawelementproviderfragmentroot) de todos os controles ActiveX sem janela de automação da interface do usuário hospedados pelo seu contêiner de controle.</span><span class="sxs-lookup"><span data-stu-id="20461-154">The **IAccessibleHostingElementProviders** interface has a single method, [**GetEmbeddedFragmentRoots**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-irawelementproviderfragment-getembeddedfragmentroots), which retrieves the [**IRawElementProviderFragmentRoot**](/windows/desktop/api/UIAutomationCore/nn-uiautomationcore-irawelementproviderfragmentroot) interface pointers of all UI Automation windowless ActiveX controls that are hosted by your control container.</span></span>

## <a name="related-topics"></a><span data-ttu-id="20461-155">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="20461-155">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="20461-156">Como hospedar um controle ActiveX sem janela de automação da interface do usuário</span><span class="sxs-lookup"><span data-stu-id="20461-156">How to Host a UI Automation Windowless ActiveX Control</span></span>](host-a-ui-automation-windowless-activex-control.md)
</dt> <dt>

[<span data-ttu-id="20461-157">Acessibilidade de controle ActiveX sem janela</span><span class="sxs-lookup"><span data-stu-id="20461-157">Windowless ActiveX Control Accessibility</span></span>](windowless-activex-control-accessibility.md)
</dt> </dl>

 

 