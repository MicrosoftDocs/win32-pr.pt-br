---
title: Precauções de função de gancho de In-Context
description: Por motivos de desempenho, os desenvolvedores de cliente registram funções de gancho no contexto.
ms.assetid: 14b48920-a291-4519-b005-e559263a0e83
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8c0e319037cb1295725548b3361bf076b4b1f760
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/20/2020
ms.locfileid: "105771446"
---
# <a name="in-context-hook-function-precautions"></a><span data-ttu-id="25a96-103">Precauções de função de gancho de In-Context</span><span class="sxs-lookup"><span data-stu-id="25a96-103">In-Context Hook Function Precautions</span></span>

<span data-ttu-id="25a96-104">Por motivos de desempenho, os desenvolvedores de cliente registram funções de gancho no contexto.</span><span class="sxs-lookup"><span data-stu-id="25a96-104">For performance reasons, client developers register in-context hook functions.</span></span> <span data-ttu-id="25a96-105">No entanto, como essas funções de conexão são mapeadas para o espaço de endereço do servidor, os desenvolvedores de cliente e servidor devem tomar precauções para garantir que o processamento do evento ocorra sem problemas.</span><span class="sxs-lookup"><span data-stu-id="25a96-105">However, because these hook functions are mapped into the server's address space, client and server developers must take precautions to ensure that the event processing goes smoothly.</span></span>

## <a name="precautions-for-client-developers"></a><span data-ttu-id="25a96-106">Precauções para desenvolvedores clientes</span><span class="sxs-lookup"><span data-stu-id="25a96-106">Precautions for Client Developers</span></span>

<span data-ttu-id="25a96-107">Os desenvolvedores de cliente devem estar cientes dos seguintes problemas:</span><span class="sxs-lookup"><span data-stu-id="25a96-107">Client developers should be aware of the following issues:</span></span>

-   <span data-ttu-id="25a96-108">Funções de gancho no contexto não devem usar muito tempo do processador, pois a função Hook deve retornar antes de o aplicativo do servidor continuar.</span><span class="sxs-lookup"><span data-stu-id="25a96-108">In-context hook functions should not use a lot of processor time, because the hook function must return before the server application continues.</span></span>
-   <span data-ttu-id="25a96-109">Depois que um evento é disparado, é possível que a janela associada a um evento não exista mais no momento em que a função de Hook é chamada.</span><span class="sxs-lookup"><span data-stu-id="25a96-109">After an event is triggered, it is possible that the window associated with an event no longer exists by the time the hook function is called.</span></span> <span data-ttu-id="25a96-110">Os clientes devem verificar se a janela associada a um evento ainda existe antes de realizar qualquer outra ação relacionada ao evento.</span><span class="sxs-lookup"><span data-stu-id="25a96-110">Clients must verify that the window associated with an event still exists before taking any other action related to the event.</span></span> <span data-ttu-id="25a96-111">Para garantir que uma janela ainda exista, os clientes usam a função [**IsWindow**](/windows/desktop/api/winuser/nf-winuser-iswindow) do Microsoft Win32.</span><span class="sxs-lookup"><span data-stu-id="25a96-111">To ensure that a window still exists, clients use the Microsoft Win32 [**IsWindow**](/windows/desktop/api/winuser/nf-winuser-iswindow) function.</span></span>
-   <span data-ttu-id="25a96-112">Se a DLL na qual a função de Hook é definida vincula-se a outra DLL, os desenvolvedores de cliente devem garantir que o sistema carregue a outra DLL.</span><span class="sxs-lookup"><span data-stu-id="25a96-112">If the DLL in which the hook function is defined links to another DLL, client developers must ensure that the system loads the other DLL.</span></span> <span data-ttu-id="25a96-113">Se estiver vinculando implicitamente (usando arquivos. def e importações), a DLL adicional deverá estar no diretório do Windows ou em um dos diretórios do sistema, como o \\ sistema Windows, o Windows \\ System32 ou o Windows \\ SysWOW64.</span><span class="sxs-lookup"><span data-stu-id="25a96-113">If linking implicitly (using .def files and imports), the additional DLL must be in either the Windows directory or one of the system directories such as Windows\\System, Windows\\System32, or Windows\\SysWOW64.</span></span> <span data-ttu-id="25a96-114">Se estiver vinculando explicitamente (usando [**LoadLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-loadlibrarya)), o caminho completo para o diretório no qual a dll adicional reside deve ser especificado na chamada para **LoadLibrary**.</span><span class="sxs-lookup"><span data-stu-id="25a96-114">If linking explicitly (using [**LoadLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-loadlibrarya)), the full path to the directory in which the additional DLL resides must be specified in the call to **LoadLibrary**.</span></span>
-   <span data-ttu-id="25a96-115">As funções de gancho no contexto podem causar um estouro de pilha quando a DLL que contém a função de Hook é carregada em um aplicativo de 16 bits.</span><span class="sxs-lookup"><span data-stu-id="25a96-115">In-context hook functions may cause a stack overflow when the DLL that contains the hook function is loaded into a 16-bit application.</span></span> <span data-ttu-id="25a96-116">Esse problema ocorre porque os aplicativos de 16 bits usam um tamanho de pilha fixo que não é grande o suficiente para acomodar a cadeia de chamadas de função do sistema que resultam em uma chamada para a função de gancho.</span><span class="sxs-lookup"><span data-stu-id="25a96-116">This problem occurs because 16-bit applications use a fixed stack size that is not large enough to accommodate the chain of system function calls that result in a call to the hook function.</span></span>

## <a name="precautions-for-server-developers"></a><span data-ttu-id="25a96-117">Precauções para desenvolvedores de servidor</span><span class="sxs-lookup"><span data-stu-id="25a96-117">Precautions for Server Developers</span></span>

<span data-ttu-id="25a96-118">Os desenvolvedores de servidor precisam estar cientes de que os aplicativos cliente podem registrar funções de interceptação no contexto.</span><span class="sxs-lookup"><span data-stu-id="25a96-118">Server developers need to be aware that client applications might register in-context hook functions.</span></span> <span data-ttu-id="25a96-119">Quando um servidor chama [**NotifyWinEvent**](/windows/desktop/api/Winuser/nf-winuser-notifywinevent), ele deve estar preparado para manipular o [**WM \_ GetObject**](wm-getobject.md) e outros métodos [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) .</span><span class="sxs-lookup"><span data-stu-id="25a96-119">When a server calls [**NotifyWinEvent**](/windows/desktop/api/Winuser/nf-winuser-notifywinevent), it must be prepared to handle [**WM\_GETOBJECT**](wm-getobject.md) and other [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) methods.</span></span>

## <a name="invalid-interface-pointers"></a><span data-ttu-id="25a96-120">Ponteiros de interface inválidos</span><span class="sxs-lookup"><span data-stu-id="25a96-120">Invalid Interface Pointers</span></span>

<span data-ttu-id="25a96-121">Quando um cliente chama [**AccessibleObjectFromEvent**](/windows/desktop/api/Oleacc/nf-oleacc-accessibleobjectfromevent) dentro de uma função de gancho no contexto, o ponteiro da interface [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) que é retornado aponta diretamente para o código no espaço de endereço do servidor.</span><span class="sxs-lookup"><span data-stu-id="25a96-121">When a client calls [**AccessibleObjectFromEvent**](/windows/desktop/api/Oleacc/nf-oleacc-accessibleobjectfromevent) within an in-context hook function, the [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) interface pointer that is returned points directly to code in the server's address space.</span></span> <span data-ttu-id="25a96-122">Se o cliente chamar uma propriedade de interface usando esse ponteiro, a biblioteca de Component Object Model (COM) não estará envolvida com o marshaling (empacotamento e envio de parâmetros de interface entre limites de processo) ou desempacotamento (parâmetros de desempacotamento que foram enviados entre limites de processo) e não detectará se um objeto é destruído.</span><span class="sxs-lookup"><span data-stu-id="25a96-122">If the client calls an interface property using this pointer, the Component Object Model (COM) library is not involved with marshaling (packaging and sending interface parameters across process boundaries) or unmarshaling (unpackaging parameters that have been sent across process boundaries) and does not detect if an object is destroyed.</span></span>

<span data-ttu-id="25a96-123">Se o cliente chamar uma propriedade de interface para um objeto que é destruído, o ponteiro de interface inválido causará uma falha de proteção geral no espaço de endereço do servidor, a menos que o servidor detecte essa situação.</span><span class="sxs-lookup"><span data-stu-id="25a96-123">If the client calls an interface property to an object that is destroyed, the invalid interface pointer causes a General Protection fault in the server's address space unless the server detects this situation.</span></span>

<span data-ttu-id="25a96-124">Para proteger contra ponteiros de interface inválidos, os servidores [criam objetos de proxy](creating-proxy-objects.md) que encapsulam objetos acessíveis e monitoram a vida útil de objetos acessíveis.</span><span class="sxs-lookup"><span data-stu-id="25a96-124">To protect against invalid interface pointers, servers [create proxy objects](creating-proxy-objects.md) that wrap accessible objects and monitor the life span of accessible objects.</span></span> <span data-ttu-id="25a96-125">Por exemplo, quando um cliente chama uma propriedade [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) para obter informações sobre um objeto, o proxy verifica se o objeto acessível ainda está disponível e, nesse caso, encaminha a solicitação do cliente para o objeto acessível.</span><span class="sxs-lookup"><span data-stu-id="25a96-125">For instance, when a client calls an [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) property to get information about an object, the proxy checks whether the accessible object is still available, and if so, forwards the client's request to the accessible object.</span></span> <span data-ttu-id="25a96-126">Se o objeto acessível for destruído, o proxy retornará um erro ao cliente.</span><span class="sxs-lookup"><span data-stu-id="25a96-126">If the accessible object is destroyed, the proxy returns an error to the client.</span></span>

 

 