---
description: Você pode depurar ações personalizadas baseadas em bibliotecas de vínculo dinâmico usando as ferramentas de depuração para Windows. Não é possível usar a depuração dinâmica com ações personalizadas com base em arquivos ou scripts executáveis.
ms.assetid: 4241a27a-c127-4c65-96a2-1d655b343eba
title: Depurando ações personalizadas
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9ddfbc9952f0dd7fc1b85b5c64fa6a23381ceafe
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "105768473"
---
# <a name="debugging-custom-actions"></a><span data-ttu-id="27ab3-104">Depurando ações personalizadas</span><span class="sxs-lookup"><span data-stu-id="27ab3-104">Debugging Custom Actions</span></span>

<span data-ttu-id="27ab3-105">Você pode depurar ações personalizadas baseadas em bibliotecas de [vínculo dinâmico](dynamic-link-libraries.md) usando as [ferramentas de depuração para Windows](https://www.microsoft.com/?ref=go).</span><span class="sxs-lookup"><span data-stu-id="27ab3-105">You can debug custom actions that are based on [dynamic-link libraries](dynamic-link-libraries.md) by using [Debugging Tools for Windows](https://www.microsoft.com/?ref=go).</span></span> <span data-ttu-id="27ab3-106">Não é possível usar a depuração dinâmica com ações personalizadas com base em arquivos ou [scripts](scripts.md) [executáveis](executable-files.md) .</span><span class="sxs-lookup"><span data-stu-id="27ab3-106">It is not possible to use dynamic debugging with custom actions based on [executable files](executable-files.md) or [scripts](scripts.md).</span></span>

<span data-ttu-id="27ab3-107">As técnicas descritas nesta seção podem ajudá-lo a depurar Windows Installer ações personalizadas.</span><span class="sxs-lookup"><span data-stu-id="27ab3-107">The techniques described in this section can help you debug Windows Installer custom actions.</span></span> <span data-ttu-id="27ab3-108">Consulte a seção ferramentas de desenvolvimento de driver do WDK (Kit de driver do Windows) para obter informações sobre as [ferramentas de depuração para Windows](https://www.microsoft.com/?ref=go).</span><span class="sxs-lookup"><span data-stu-id="27ab3-108">See the Driver Development Tools section of the Windows Driver Kit (WDK) for information about [Debugging Tools for Windows](https://www.microsoft.com/?ref=go).</span></span>

<span data-ttu-id="27ab3-109">Windows Installer usa a variável de ambiente MsiBreak para determinar qual ação personalizada deve ser depurada.</span><span class="sxs-lookup"><span data-stu-id="27ab3-109">Windows Installer uses the MsiBreak environment variable to determine which custom action is to be debugged.</span></span> <span data-ttu-id="27ab3-110">Se você tiver acesso ao código-fonte da ação personalizada, talvez seja possível usar a depuração sem MsiBreak.</span><span class="sxs-lookup"><span data-stu-id="27ab3-110">If you have access to the custom action's source code, you may be able to use debugging without MsiBreak.</span></span> <span data-ttu-id="27ab3-111">Para iniciar a depuração sem MsiBreak, coloque uma caixa de mensagem temporária no início do código da ação.</span><span class="sxs-lookup"><span data-stu-id="27ab3-111">To start debugging without MsiBreak, put a temporary message box at the beginning of the action's code.</span></span> <span data-ttu-id="27ab3-112">Quando a caixa de mensagem aparecer durante a instalação, anexe o depurador ao processo que possui a caixa de mensagem.</span><span class="sxs-lookup"><span data-stu-id="27ab3-112">When the message box appears during the installation, attach the debugger to the process owning the message box.</span></span> <span data-ttu-id="27ab3-113">Em seguida, você pode definir todos os pontos de interrupção necessários e ignorar a caixa de mensagem para retomar a execução.</span><span class="sxs-lookup"><span data-stu-id="27ab3-113">You can then set any necessary breakpoints and dismiss the message box to resume execution.</span></span> <span data-ttu-id="27ab3-114">Não é possível depurar as partes anteriores da ação personalizada por este método.</span><span class="sxs-lookup"><span data-stu-id="27ab3-114">It is not possible to debug the earlier portions of the custom action by this method.</span></span>

<span data-ttu-id="27ab3-115">Para usar a variável de ambiente MsiBreak para depurar a ação personalizada, defina MsiBreak como o nome da ação personalizada na [tabela CustomAction](customaction-table.md).</span><span class="sxs-lookup"><span data-stu-id="27ab3-115">To use the MsiBreak environment variable to debug the custom action, set MsiBreak to the custom action's name in the [CustomAction table](customaction-table.md).</span></span> <span data-ttu-id="27ab3-116">MsiBreak pode ser um sistema ou uma variável de ambiente de usuário.</span><span class="sxs-lookup"><span data-stu-id="27ab3-116">MsiBreak can be either a system or a user environment variable.</span></span> <span data-ttu-id="27ab3-117">Se a variável for definida como uma variável do sistema, uma reinicialização do sistema poderá ser necessária quando o valor for alterado para detectar o novo valor.</span><span class="sxs-lookup"><span data-stu-id="27ab3-117">If the variable is set as a system variable, a restart of the system may be needed when the value is changed to detect the new value.</span></span>

<span data-ttu-id="27ab3-118">Para usar a variável de ambiente MsiBreak para depurar uma interface de usuário inserida, defina o valor de MsiBreak como MsiEmbeddedUI.</span><span class="sxs-lookup"><span data-stu-id="27ab3-118">To use the MsiBreak environment variable to debug an embedded user interface, set the value of MsiBreak to MsiEmbeddedUI.</span></span>

<span data-ttu-id="27ab3-119">Windows Installer verificará apenas a variável de ambiente MsiBreak se o usuário for um administrador.</span><span class="sxs-lookup"><span data-stu-id="27ab3-119">Windows Installer only checks the MsiBreak environment variable if the user is an Administrator.</span></span> <span data-ttu-id="27ab3-120">O instalador ignora o valor de MsiBreak se o usuário não for um administrador, mesmo que este seja um [*aplicativo gerenciado*](m-gly.md).</span><span class="sxs-lookup"><span data-stu-id="27ab3-120">The installer ignores the value of MsiBreak if the user is not an Administrator, even if this is a [*managed application*](m-gly.md).</span></span>

<span data-ttu-id="27ab3-121">Se você estiver Depurando uma ação personalizada que é executada com privilégios elevados (sistema) na sequência de execução, anexe o depurador ao serviço de Windows Installer.</span><span class="sxs-lookup"><span data-stu-id="27ab3-121">If you are debugging a custom action that runs with elevated (system) privileges in the execution sequence, attach the debugger to the Windows Installer service.</span></span> <span data-ttu-id="27ab3-122">Ao depurar uma ação personalizada que é executada com privilégios representados na sequência de execução, o sistema solicita uma caixa de diálogo que indica qual processo deve ser depurado.</span><span class="sxs-lookup"><span data-stu-id="27ab3-122">When debugging a custom action that runs with impersonated privileges in the execution sequence, the system prompts with a dialog box that indicates which process should be debugged.</span></span> <span data-ttu-id="27ab3-123">O usuário recebe uma caixa de diálogo indicando qual processo Depurar.</span><span class="sxs-lookup"><span data-stu-id="27ab3-123">The user is prompted with a dialog box indicating which process to debug.</span></span> <span data-ttu-id="27ab3-124">Para obter mais informações sobre ações personalizadas elevadas, consulte [segurança de ação personalizada](custom-action-security.md).</span><span class="sxs-lookup"><span data-stu-id="27ab3-124">For more information about elevated custom actions, see [Custom Action Security](custom-action-security.md).</span></span>

<span data-ttu-id="27ab3-125">Depois que o depurador tiver sido anexado ao processo correto, o instalador acionará um ponto de interrupção do depurador imediatamente antes de chamar o Point de entrada da DLL.</span><span class="sxs-lookup"><span data-stu-id="27ab3-125">Once the debugger has been attached to the correct process, the installer triggers a debugger breakpoint immediately before calling the entry point of the DLL.</span></span> <span data-ttu-id="27ab3-126">No ponto de interrupção, sua DLL já está carregada no processo e o endereço do ponto de entrada foi determinado.</span><span class="sxs-lookup"><span data-stu-id="27ab3-126">At the breakpoint, your DLL is already loaded into the process and the entry point address determined.</span></span> <span data-ttu-id="27ab3-127">Se não foi possível carregar a DLL de ação personalizada ou se o ponto de entrada da ação personalizada não existia, nenhuma interrupção é disparada.</span><span class="sxs-lookup"><span data-stu-id="27ab3-127">If your custom action DLL could not be loaded or the custom action entry point did not exist, no breakpoint is triggered.</span></span> <span data-ttu-id="27ab3-128">Como o ponto de interrupção é disparado antes de chamar a função de DLL, depois de disparado, você deve usar o depurador para avançar até que o pontos de entrada de ação personalizada seja chamado.</span><span class="sxs-lookup"><span data-stu-id="27ab3-128">Because the breakpoint is triggered before calling the DLL function, once the breakpoint has been triggered you should use your debugger to step forward until your custom action entry point is called.</span></span> <span data-ttu-id="27ab3-129">Como alternativa, você pode definir um ponto de interrupção em qualquer lugar em sua ação personalizada e retomar a execução normal.</span><span class="sxs-lookup"><span data-stu-id="27ab3-129">Alternately, you can set a breakpoint anywhere in your custom action and resume normal execution.</span></span>

<span data-ttu-id="27ab3-130">O Windows Installer executa DLLs não armazenadas na [tabela binária](binary-table.md) diretamente do local da dll.</span><span class="sxs-lookup"><span data-stu-id="27ab3-130">The Windows Installer executes DLLs not stored in the [Binary table](binary-table.md) directly from the DLL location.</span></span> <span data-ttu-id="27ab3-131">O instalador não sabe o nome original de uma DLL armazenada na tabela binária e executa a ação personalizada de DLL em um nome de arquivo temporário.</span><span class="sxs-lookup"><span data-stu-id="27ab3-131">The installer does not know the original name of a DLL stored in the Binary table and runs the DLL custom action under a temporary file name.</span></span> <span data-ttu-id="27ab3-132">A forma do nome de arquivo temporário é MSI?????. TMP.</span><span class="sxs-lookup"><span data-stu-id="27ab3-132">The form of the temporary file name is MSI?????.TMP.</span></span> <span data-ttu-id="27ab3-133">No Windows XP, esse arquivo temporário é armazenado em um local seguro, geralmente o <WindowFolder> \\ instalador.</span><span class="sxs-lookup"><span data-stu-id="27ab3-133">On Windows XP, this temporary file is stored in a secure location, commonly <WindowFolder>\\Installer.</span></span>

<span data-ttu-id="27ab3-134">Observe que muitas DLLs criadas para depuração contêm o nome e o caminho do arquivo PDB correspondente como parte da própria DLL.</span><span class="sxs-lookup"><span data-stu-id="27ab3-134">Note that many DLLs created for debugging contain the name and path of the corresponding PDB file as part of the DLL itself.</span></span> <span data-ttu-id="27ab3-135">Ao depurar esse tipo de DLL em um sistema em que o PDB pode ser encontrado no local armazenado na DLL, os símbolos podem ser carregados automaticamente pela ferramenta do depurador.</span><span class="sxs-lookup"><span data-stu-id="27ab3-135">When debugging this type of DLL on a system where the PDB can be found at the location stored in the DLL, symbols may be loaded automatically by the debugger tool.</span></span> <span data-ttu-id="27ab3-136">Em situações em que o PDB não pode ser encontrado no local armazenado, em que o depurador não oferece suporte ao carregamento de símbolos a partir do local armazenado, ou onde a DLL não foi criada com informações de depuração, talvez seja necessário posicionar os arquivos de símbolo na pasta com o arquivo DLL temporário.</span><span class="sxs-lookup"><span data-stu-id="27ab3-136">In situations where the PDB cannot be found at the stored location, where the debugger does not support loading symbols from the stored location, or where the DLL was not built with debugging information, you may need to place your symbol files in the folder with the temporary DLL file.</span></span>

<span data-ttu-id="27ab3-137">O instalador adiciona informações de depuração para scripts de ação personalizados ao arquivo de log de instalação.</span><span class="sxs-lookup"><span data-stu-id="27ab3-137">The installer adds debugging information for custom action scripts to the installation log file.</span></span>

``` syntax
There is a problem with this Windows Installer package. A script 
required for this install to complete could not be run. Contact your 
support personnel or package vendor.  {Custom action [2] script error 
[3], [4]: [5] Line [6], Column [7], [8] }
```

 

 



