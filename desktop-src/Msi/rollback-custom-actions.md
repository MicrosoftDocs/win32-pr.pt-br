---
description: Quando o instalador processa o script de instalação, ele gera um script de reversão simultaneamente.
ms.assetid: 5b9bfc5a-6a78-4b0e-aed8-f25aba089af1
title: Reverter ações personalizadas
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1c4ad91f8f94145399d51ed2ef53999ab0a91d65
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103827600"
---
# <a name="rollback-custom-actions"></a><span data-ttu-id="0d9e6-103">Reverter ações personalizadas</span><span class="sxs-lookup"><span data-stu-id="0d9e6-103">Rollback Custom Actions</span></span>

<span data-ttu-id="0d9e6-104">Quando o instalador processa o script de instalação, ele gera um script de reversão simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="0d9e6-104">When the installer processes the installation script, it simultaneously generates a rollback script.</span></span> <span data-ttu-id="0d9e6-105">Além do script de reversão, o instalador salva uma cópia de cada arquivo que ele exclui durante a instalação.</span><span class="sxs-lookup"><span data-stu-id="0d9e6-105">In addition to the rollback script, the installer saves a copy of every file it deletes during the installation.</span></span> <span data-ttu-id="0d9e6-106">Esses arquivos são mantidos em um diretório de sistema oculto.</span><span class="sxs-lookup"><span data-stu-id="0d9e6-106">These files are kept in a hidden system directory.</span></span> <span data-ttu-id="0d9e6-107">Quando a instalação for concluída, o script de reversão e os arquivos salvos serão excluídos.</span><span class="sxs-lookup"><span data-stu-id="0d9e6-107">Once the installation is complete, the rollback script and the saved files are deleted.</span></span> <span data-ttu-id="0d9e6-108">Se uma instalação não for bem-sucedida, o instalador tentará reverter as alterações feitas durante a instalação e restaurar o estado original do computador.</span><span class="sxs-lookup"><span data-stu-id="0d9e6-108">If an installation is unsuccessful, the installer attempts to rollback the changes made during the installation and restore the original state of the computer.</span></span>

<span data-ttu-id="0d9e6-109">Embora as ações personalizadas que agendam operações do sistema inserindo linhas na tabela de banco de dados são revertidas por uma reversão da instalação, as ações personalizadas que alteram o sistema diretamente ou que emitem comandos para outros serviços do sistema não podem ser sempre revertidas por uma reversão.</span><span class="sxs-lookup"><span data-stu-id="0d9e6-109">Although custom actions that schedule system operations by inserting rows into database table are reversed by a rollback of the installation, custom actions that change the system directly, or that issue commands to other system services, cannot always be reversed by a rollback.</span></span> <span data-ttu-id="0d9e6-110">Uma ação personalizada de reversão é uma ação que o instalador executa somente durante uma reversão de instalação, e sua finalidade é reverter uma ação personalizada que tenha feito alterações no sistema.</span><span class="sxs-lookup"><span data-stu-id="0d9e6-110">A rollback custom action is an action that the installer executes only during an installation rollback, and its purpose is to reverse a custom action that has made changes to the system.</span></span>

<span data-ttu-id="0d9e6-111">Uma ação personalizada de reversão é um tipo de [ação personalizada de execução adiada](deferred-execution-custom-actions.md), porque sua execução é adiada quando é invocada durante a sequência de instalação.</span><span class="sxs-lookup"><span data-stu-id="0d9e6-111">A rollback custom action is a type of [deferred execution custom action](deferred-execution-custom-actions.md), because its execution is deferred when it is invoked during the installation sequence.</span></span> <span data-ttu-id="0d9e6-112">Ele difere de uma ação personalizada regular adiada, pois ela só é executada durante uma reversão.</span><span class="sxs-lookup"><span data-stu-id="0d9e6-112">It differs from a regular deferred custom action in that it is only executed during a rollback.</span></span> <span data-ttu-id="0d9e6-113">Uma ação personalizada de reversão sempre deve preceder a ação personalizada adiada que é revertida na sequência de ação.</span><span class="sxs-lookup"><span data-stu-id="0d9e6-113">A rollback custom action must always precede the deferred custom action it rolls back in the action sequence.</span></span> <span data-ttu-id="0d9e6-114">Uma ação personalizada de reversão também deve lidar com o caso em que a ação personalizada adiada é interrompida no meio da execução.</span><span class="sxs-lookup"><span data-stu-id="0d9e6-114">A rollback custom action should also handle the case where the deferred custom action is interrupted in the middle of execution.</span></span> <span data-ttu-id="0d9e6-115">Por exemplo, se o usuário fosse pressionar o botão Cancelar enquanto a ação personalizada estava em execução.</span><span class="sxs-lookup"><span data-stu-id="0d9e6-115">For example, if the user were to press the Cancel button while the custom action was executing.</span></span>

<span data-ttu-id="0d9e6-116">Observe que a reversão de ações personalizadas não pode ser executada de modo assíncrono.</span><span class="sxs-lookup"><span data-stu-id="0d9e6-116">Note that Rollback Custom Actions cannot run asynchronously.</span></span> <span data-ttu-id="0d9e6-117">Consulte [ações personalizadas síncronas e assíncronas](synchronous-and-asynchronous-custom-actions.md).</span><span class="sxs-lookup"><span data-stu-id="0d9e6-117">See [Synchronous and Asynchronous Custom Actions](synchronous-and-asynchronous-custom-actions.md).</span></span>

<span data-ttu-id="0d9e6-118">O complemento a uma ação personalizada de reversão é uma [ação personalizada de confirmação](commit-custom-actions.md).</span><span class="sxs-lookup"><span data-stu-id="0d9e6-118">The complement to a rollback custom action is a [commit custom action](commit-custom-actions.md).</span></span> <span data-ttu-id="0d9e6-119">O instalador executa uma ação personalizada de confirmação durante a sequência de instalação, copia a ação personalizada no script de reversão, mas não executa a ação durante a reversão.</span><span class="sxs-lookup"><span data-stu-id="0d9e6-119">The installer executes a commit custom action during the installation sequence, copies the custom action into the rollback script, but does not execute the action during rollback.</span></span>

<span data-ttu-id="0d9e6-120">Observe que uma ação personalizada de reversão pode não ser capaz de remover todas as alterações feitas por ações personalizadas de confirmação.</span><span class="sxs-lookup"><span data-stu-id="0d9e6-120">Note that a rollback custom action may not be able to remove all of the changes made by commit custom actions.</span></span> <span data-ttu-id="0d9e6-121">Embora o instalador grave as ações de reversão e confirmação personalizada no script de reversão, as ações personalizadas de confirmação são executadas somente depois que o instalador tiver processado com êxito o script de instalação.</span><span class="sxs-lookup"><span data-stu-id="0d9e6-121">Although the installer writes both rollback and commit custom actions into the rollback script, commit custom actions only run after the installer has successfully processed the installation script.</span></span> <span data-ttu-id="0d9e6-122">As ações personalizadas de confirmação são as primeiras ações a serem executadas no script de reversão.</span><span class="sxs-lookup"><span data-stu-id="0d9e6-122">Commit custom actions are the first actions to run in the rollback script.</span></span> <span data-ttu-id="0d9e6-123">Se uma ação personalizada de confirmação falhar, o instalador iniciará a reversão, mas só poderá reverter as operações já gravadas no script de reversão.</span><span class="sxs-lookup"><span data-stu-id="0d9e6-123">If a commit custom action fails, the installer initiates rollback but can only rollback those operations already written to the rollback script.</span></span> <span data-ttu-id="0d9e6-124">Isso significa que, dependendo da ação personalizada de confirmação, uma reversão pode não ser capaz de desfazer as alterações feitas pela ação.</span><span class="sxs-lookup"><span data-stu-id="0d9e6-124">This means that depending on the commit custom action, a rollback may not be able to undo the changes made by the action.</span></span> <span data-ttu-id="0d9e6-125">Você pode ignorar as falhas em confirmar ações personalizadas, criando a ação personalizada para ignorar códigos de retorno.</span><span class="sxs-lookup"><span data-stu-id="0d9e6-125">You can ignore failures in commit custom actions by authoring the custom action to ignore return codes.</span></span>

<span data-ttu-id="0d9e6-126">Quando o instalador executa uma ação de reversão personalizada, o único parâmetro de modo que ele definirá é MSIRUNMODE \_ Rollback.</span><span class="sxs-lookup"><span data-stu-id="0d9e6-126">When the installer runs a rollback custom action, the only mode parameter it will set is MSIRUNMODE\_ROLLBACK.</span></span> <span data-ttu-id="0d9e6-127">Consulte [**MsiGetMode**](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode) para obter uma descrição dos parâmetros do modo de execução.</span><span class="sxs-lookup"><span data-stu-id="0d9e6-127">See [**MsiGetMode**](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode) for a description of the run mode parameters.</span></span>

<span data-ttu-id="0d9e6-128">Uma ação personalizada de reversão pode ser especificada adicionando um sinalizador de opção ao campo tipo da [tabela CustomAction](customaction-table.md).</span><span class="sxs-lookup"><span data-stu-id="0d9e6-128">A rollback custom action can be specified by adding an option flag to the Type field of the [CustomAction table](customaction-table.md).</span></span> <span data-ttu-id="0d9e6-129">Consulte [Opções de execução de In-Script de ação personalizada](custom-action-in-script-execution-options.md) para o sinalizador de opção que designa uma ação personalizada de reversão.</span><span class="sxs-lookup"><span data-stu-id="0d9e6-129">See [Custom Action In-Script Execution Options](custom-action-in-script-execution-options.md) for the option flag designating a rollback custom action.</span></span>

<span data-ttu-id="0d9e6-130">As ações personalizadas de reversão e confirmação não são executadas quando a reversão está desabilitada.</span><span class="sxs-lookup"><span data-stu-id="0d9e6-130">Rollback and commit custom actions do not run when rollback is disabled.</span></span> <span data-ttu-id="0d9e6-131">Se um autor de pacote exigir esses tipos de ações personalizadas para a instalação adequada, eles deverão usar a propriedade [**RollbackDisabled**](rollbackdisabled.md) em uma condição que impeça a instalação de continuar quando a reversão estiver desabilitada.</span><span class="sxs-lookup"><span data-stu-id="0d9e6-131">If a package author requires these types of custom actions for proper installation, they should use the [**RollbackDisabled**](rollbackdisabled.md) property in a condition that prevents the installation from continuing when rollback is disabled.</span></span> <span data-ttu-id="0d9e6-132">Para obter informações sobre como desabilitar a reversão, consulte [Rollback Installation (Windows Installer)](rollback-installation.md).</span><span class="sxs-lookup"><span data-stu-id="0d9e6-132">For information on how to disable rollback see [Rollback Installation (Windows Installer)](rollback-installation.md).</span></span>

 

 



