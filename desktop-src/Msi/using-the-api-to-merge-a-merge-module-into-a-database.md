---
description: Os módulos de mesclagem fornecem um método padrão para que os desenvolvedores forneçam componentes de Windows Installer compartilhados e a lógica de instalação para seus aplicativos.
ms.assetid: 3eb087b1-0f44-40d8-a950-67d489f09408
title: Usando a API para mesclar um módulo de mesclagem em um banco de dados
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2e68298671045825dda41ad120896fa22c89f068
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "105750588"
---
# <a name="using-the-api-to-merge-a-merge-module-into-a-database"></a><span data-ttu-id="46e87-103">Usando a API para mesclar um módulo de mesclagem em um banco de dados</span><span class="sxs-lookup"><span data-stu-id="46e87-103">Using the API to Merge a Merge Module into a Database</span></span>

<span data-ttu-id="46e87-104">Os [módulos de mesclagem](merge-modules.md) fornecem um método padrão para que os desenvolvedores forneçam [*componentes*](c-gly.md) de Windows Installer compartilhados e a lógica de instalação para seus aplicativos.</span><span class="sxs-lookup"><span data-stu-id="46e87-104">[Merge modules](merge-modules.md) provide a standard method for developers to deliver shared Windows Installer [*components*](c-gly.md) and setup logic to their applications.</span></span> <span data-ttu-id="46e87-105">Os módulos de mesclagem devem ser mesclados em um pacote de instalação usando uma ferramenta de mesclagem.</span><span class="sxs-lookup"><span data-stu-id="46e87-105">Merge modules must be merged into an installation package using a merge tool.</span></span> <span data-ttu-id="46e87-106">A melhor alternativa é obter uma ferramenta de mesclagem distribuída livremente ou comprar uma das ferramentas de mesclagem disponíveis de fornecedores de software independentes.</span><span class="sxs-lookup"><span data-stu-id="46e87-106">The best alternative is to obtain a freely distributed merge tool or purchase one of the merging tools available from independent software vendors.</span></span> <span data-ttu-id="46e87-107">Por exemplo, você pode usar a funcionalidade fornecida pelo [Mergemod.dll](merge-module-automation.md).</span><span class="sxs-lookup"><span data-stu-id="46e87-107">For example you can use the functionality provided by [Mergemod.dll](merge-module-automation.md).</span></span>

<span data-ttu-id="46e87-108">Use as etapas a seguir em sequência para mesclar um módulo de mesclagem em um Windows Installer banco de dados de instalação pela API do [Mergemod.dll](merge-module-automation.md).</span><span class="sxs-lookup"><span data-stu-id="46e87-108">Use the following steps in sequence to merge a merge module into a Windows Installer installation database by the API of [Mergemod.dll](merge-module-automation.md).</span></span>

<span data-ttu-id="46e87-109">**Para mesclar um módulo de mesclagem em um Windows Installer banco de dados de instalação**</span><span class="sxs-lookup"><span data-stu-id="46e87-109">**To merge a merge module into a Windows Installer installation database**</span></span>

1.  <span data-ttu-id="46e87-110">Abra um arquivo de log usando [**OpenLog**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-openlog).</span><span class="sxs-lookup"><span data-stu-id="46e87-110">Open a log file using [**OpenLog**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-openlog).</span></span> <span data-ttu-id="46e87-111">Essa etapa será necessária somente se você precisar criar um arquivo de log ou acrescentar um arquivo de log existente para o processo de mesclagem.</span><span class="sxs-lookup"><span data-stu-id="46e87-111">This step is required only if you need to create a log file, or append an existing log file, for the merge process.</span></span>
2.  <span data-ttu-id="46e87-112">Abra o banco de dados de instalação, um [arquivo. msi](windows-installer-file-extensions.md), que receberá o módulo de mesclagem usando [**OpenDatabase**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-opendatabase).</span><span class="sxs-lookup"><span data-stu-id="46e87-112">Open the installation database, an [.msi file](windows-installer-file-extensions.md), that will receive the merge module using [**OpenDatabase**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-opendatabase).</span></span> <span data-ttu-id="46e87-113">Essa etapa é necessária.</span><span class="sxs-lookup"><span data-stu-id="46e87-113">This step is required.</span></span>
3.  <span data-ttu-id="46e87-114">Abra o módulo de mesclagem, um [arquivo. msm](windows-installer-file-extensions.md), que está sendo mesclado no banco de dados usando [**AbrirMódulo**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-openmodule).</span><span class="sxs-lookup"><span data-stu-id="46e87-114">Open the merge module, an [.msm file](windows-installer-file-extensions.md), that is being merged into the database using [**OpenModule**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-openmodule).</span></span> <span data-ttu-id="46e87-115">Um módulo deve ser aberto antes que possa ser mesclado com um banco de dados de instalação.</span><span class="sxs-lookup"><span data-stu-id="46e87-115">A module must be opened before it can be merged with an installation database.</span></span> <span data-ttu-id="46e87-116">Essa etapa é necessária.</span><span class="sxs-lookup"><span data-stu-id="46e87-116">This step is required.</span></span>
4.  <span data-ttu-id="46e87-117">Mescle o módulo no banco de dados de instalação usando [**Merge**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-merge) ou [**MergeEx**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-mergeex).</span><span class="sxs-lookup"><span data-stu-id="46e87-117">Merge the module into the installation database by using [**Merge**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-merge) or [**MergeEx**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-mergeex).</span></span> <span data-ttu-id="46e87-118">Observe que **Merge** ou **MergeEx** só podem ser chamados uma vez para mesclar uma combinação específica de arquivos. msi e. msm.</span><span class="sxs-lookup"><span data-stu-id="46e87-118">Note that **Merge** or **MergeEx** can only be called once to merge a particular combination of .msi and .msm files.</span></span> <span data-ttu-id="46e87-119">**MergeEx** só está disponível ao usar [Mergemod.dll versão 2,0](merge-module-automation.md) ou posterior e somente ao usar a interface [IMsmMerge2](/windows/desktop/api/Mergemod/nn-mergemod-imsmmerge2) .</span><span class="sxs-lookup"><span data-stu-id="46e87-119">**MergeEx** is only available when using [Mergemod.dll version 2.0](merge-module-automation.md) or later and only when using the [IMsmMerge2](/windows/desktop/api/Mergemod/nn-mergemod-imsmmerge2) interface.</span></span> <span data-ttu-id="46e87-120">Essa etapa é necessária.</span><span class="sxs-lookup"><span data-stu-id="46e87-120">This step is required.</span></span>
5.  <span data-ttu-id="46e87-121">Chame [**\_ erros Get**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-get_errors) e examine a coleção de erros recuperada para conflitos de mesclagem ou outros erros.</span><span class="sxs-lookup"><span data-stu-id="46e87-121">Call [**get\_Errors**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-get_errors) and examine the retrieved collection of errors for merge conflicts or other errors.</span></span> <span data-ttu-id="46e87-122">A recuperação não é destrutiva.</span><span class="sxs-lookup"><span data-stu-id="46e87-122">The retrieval is non-destructive.</span></span> <span data-ttu-id="46e87-123">Várias instâncias da coleção de erros podem ser recuperadas com a leitura repetida de **\_ erros Get** de chamada.</span><span class="sxs-lookup"><span data-stu-id="46e87-123">Multiple instances of the error collection may be retrieved by repeatedly reading calling **get\_Errors**.</span></span> <span data-ttu-id="46e87-124">Você precisará resolver todos os erros conforme apropriado para seu caso.</span><span class="sxs-lookup"><span data-stu-id="46e87-124">You will need to resolve any errors as appropriate for your case.</span></span>
6.  <span data-ttu-id="46e87-125">Associe os componentes do módulo de mesclagem a todos os recursos adicionais que foram, ou serão, mesclados no banco de dados de instalação usando o [**Connect**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-connect).</span><span class="sxs-lookup"><span data-stu-id="46e87-125">Associate the components of the merge module with any additional features that have been, or will be, merged into the installation database using [**Connect**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-connect).</span></span> <span data-ttu-id="46e87-126">O recurso já deve existir antes de chamar este método.</span><span class="sxs-lookup"><span data-stu-id="46e87-126">The feature must already exist before calling this method.</span></span> <span data-ttu-id="46e87-127">Esta etapa só será necessária se você tiver recursos adicionais. para obter mais informações, consulte [conectando um módulo de mesclagem a vários recursos](connecting-a-merge-module-to-multiple-features.md)</span><span class="sxs-lookup"><span data-stu-id="46e87-127">This step is only required if you have additional features, for more information see [Connecting a Merge Module to Multiple Features](connecting-a-merge-module-to-multiple-features.md)</span></span>
7.  <span data-ttu-id="46e87-128">Se necessário, extraia os arquivos de origem do módulo seguindo um ou mais dos procedimentos a seguir.</span><span class="sxs-lookup"><span data-stu-id="46e87-128">If necessary, extract source files from the module by doing one or more of the following.</span></span>

    <span data-ttu-id="46e87-129">Para extrair arquivos de um arquivo. cab inserido e, em seguida, copiar para um diretório especificado, use [**ExtractFiles**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-extractfiles) ou [**ExtractFilesEx**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-extractfilesex).</span><span class="sxs-lookup"><span data-stu-id="46e87-129">To extract files from an embedded .cab file and then copy into a specified directory, use [**ExtractFiles**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-extractfiles) or [**ExtractFilesEx**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-extractfilesex).</span></span> <span data-ttu-id="46e87-130">Observe que o **ExtractFilesEx** requer [Mergemod.dll versão 2,0](merge-module-automation.md) ou posterior.</span><span class="sxs-lookup"><span data-stu-id="46e87-130">Note that **ExtractFilesEx** requires [Mergemod.dll version 2.0](merge-module-automation.md) or later.</span></span>

    <span data-ttu-id="46e87-131">Para extrair arquivos de um arquivo. cab inserido e, em seguida, salvar em um arquivo especificado, use [**ExtractCAB**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-extractcab).</span><span class="sxs-lookup"><span data-stu-id="46e87-131">To extract files from an embedded .cab file and then save in a specified file, use [**ExtractCAB**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-extractcab).</span></span>

    <span data-ttu-id="46e87-132">Para extrair arquivos de um módulo e, em seguida, copiar para uma imagem de origem no disco após a mesclagem, use [**CreateSourceImage**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-createsourceimage).</span><span class="sxs-lookup"><span data-stu-id="46e87-132">To extract files from a module and then copy to a source image on disk after the merge, use [**CreateSourceImage**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-createsourceimage).</span></span> <span data-ttu-id="46e87-133">Observe que o **CreateSourceImage** só está disponível com [Mergemod.dll versão 2,0](merge-module-automation.md) ou posterior.</span><span class="sxs-lookup"><span data-stu-id="46e87-133">Note that **CreateSourceImage** is only available with [Mergemod.dll version 2.0](merge-module-automation.md) or later.</span></span>

8.  <span data-ttu-id="46e87-134">Feche o módulo de mesclagem aberto atual usando [**CloseModule**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closemodule).</span><span class="sxs-lookup"><span data-stu-id="46e87-134">Close the current open merge module using [**CloseModule**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closemodule).</span></span> <span data-ttu-id="46e87-135">Essa etapa é necessária.</span><span class="sxs-lookup"><span data-stu-id="46e87-135">This step is required.</span></span>
9.  <span data-ttu-id="46e87-136">Feche o banco de dados de instalação aberta atual usando o [**CloseDatabase**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closedatabase).</span><span class="sxs-lookup"><span data-stu-id="46e87-136">Close the current open installation database using [**CloseDatabase**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closedatabase).</span></span> <span data-ttu-id="46e87-137">Essa etapa é necessária.</span><span class="sxs-lookup"><span data-stu-id="46e87-137">This step is required.</span></span> <span data-ttu-id="46e87-138">Fechar um banco de dados limpa todas as informações de dependência, mas não afeta os erros que não foram recuperados.</span><span class="sxs-lookup"><span data-stu-id="46e87-138">Closing a database clears all dependency information but does not affect any errors that have not been retrieved.</span></span>
10. <span data-ttu-id="46e87-139">Feche o arquivo de log atual usando [**CloseLog**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closelog).</span><span class="sxs-lookup"><span data-stu-id="46e87-139">Close the current log file using [**CloseLog**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closelog).</span></span> <span data-ttu-id="46e87-140">Essa etapa será necessária se você tiver aberto um arquivo de log.</span><span class="sxs-lookup"><span data-stu-id="46e87-140">This step is required if you have opened a log file.</span></span>

<span data-ttu-id="46e87-141">Depois que o módulo tiver sido mesclado no banco de dados usando [Mergemod.dll](merge-module-automation.md), a [tabela de mídia](media-table.md) deverá ser atualizada para descrever o layout da imagem de origem desejada.</span><span class="sxs-lookup"><span data-stu-id="46e87-141">After the module has been merged into the database using [Mergemod.dll](merge-module-automation.md), the [Media Table](media-table.md) must be updated to describe the desired source image layout.</span></span> <span data-ttu-id="46e87-142">O processo de mesclagem fornecido pelo Mergemod.dll não atualiza a tabela de mídia porque o consumidor do módulo de mesclagem pode selecionar várias maneiras de fazer o layout da imagem de origem.</span><span class="sxs-lookup"><span data-stu-id="46e87-142">The merge process provided by Mergemod.dll does not update the Media Table because the consumer of the merge module can select various ways to layout the source image.</span></span>

 

 
