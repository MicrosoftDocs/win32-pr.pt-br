---
description: A partir do Windows Installer versão 3,0, os autores de patch podem usar a linha de base do produto armazenada em cache pelo instalador para atender mais facilmente aos aplicativos com patches Delta menores.
ms.assetid: ab5b193d-79ce-4ed4-af53-89a4197197c1
title: Reduzindo o tamanho do patch
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4fa365e831ab8685073347dc254bac58269135f1
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105759641"
---
# <a name="reducing-patch-size"></a><span data-ttu-id="03441-103">Reduzindo o tamanho do patch</span><span class="sxs-lookup"><span data-stu-id="03441-103">Reducing Patch Size</span></span>

<span data-ttu-id="03441-104">A partir do Windows Installer versão 3,0, os autores de patch podem usar a linha de base do produto armazenada em cache pelo instalador para atender mais facilmente aos aplicativos com patches Delta menores.</span><span class="sxs-lookup"><span data-stu-id="03441-104">Beginning with Windows Installer version 3.0, patch authors can use the product baseline cached by the installer to more easily service applications with smaller delta patches.</span></span> <span data-ttu-id="03441-105">Em muitos casos, um [*patch Delta*](d-gly.md) que fornece informações de serviço para um aplicativo pode ser significativamente menor do que um patch de arquivo completo ou pacote de instalação que fornece as mesmas informações.</span><span class="sxs-lookup"><span data-stu-id="03441-105">In many cases, a [*delta patch*](d-gly.md) that delivers servicing information to an application can be significantly smaller than a full-file patch or installation package that delivers the same information.</span></span>

<span data-ttu-id="03441-106">**Windows Installer 2,0:** Sem suporte.</span><span class="sxs-lookup"><span data-stu-id="03441-106">**Windows Installer 2.0:** Not supported.</span></span> <span data-ttu-id="03441-107">A partir do Windows Installer 3,0, o instalador salva seletivamente as informações de linha de base sobre os arquivos quando eles são atualizados.</span><span class="sxs-lookup"><span data-stu-id="03441-107">Beginning with Windows Installer 3.0, the installer selectively saves baseline information about files when they are updated.</span></span>

<span data-ttu-id="03441-108">O Windows Installer fornece três métodos de atualização e manutenção de aplicativos: [pequenas atualizações](small-updates.md) [, pequenas atualizações e](minor-upgrades.md) [atualizações importantes](major-upgrades.md).</span><span class="sxs-lookup"><span data-stu-id="03441-108">Windows Installer provides three methods for updating and servicing applications: [small updates](small-updates.md), [minor upgrades](minor-upgrades.md), and [major upgrades](major-upgrades.md).</span></span> <span data-ttu-id="03441-109">Uma pequena atualização também é conhecida como atualização de QFE (Quick Fix Engineering) e uma atualização secundária também é conhecida como atualização de service pack (SP).</span><span class="sxs-lookup"><span data-stu-id="03441-109">A small update is also referred to as a quick fix engineering (QFE) update, and a minor upgrade is also referred to as a service pack (SP) update.</span></span> <span data-ttu-id="03441-110">Uma atualização principal típica remove um aplicativo anterior e instala um novo aplicativo.</span><span class="sxs-lookup"><span data-stu-id="03441-110">A typical major upgrade removes a previous application and installs a new application.</span></span> <span data-ttu-id="03441-111">Windows Installer pode fornecer informações de serviço para aplicativos como um [pacote de instalação](installation-package.md) (arquivo. msi) ou como um pacote de [patch](patch-packages.md) (arquivo. msp).</span><span class="sxs-lookup"><span data-stu-id="03441-111">Windows Installer can deliver servicing information to applications as an [installation package](installation-package.md) (.msi file) or as a [patch package](patch-packages.md) (.msp file).</span></span>

<span data-ttu-id="03441-112">Um Windows Installer pacote de patch que fornece informações de serviço para uma atualização pequena ou secundária é geralmente muito menor do que o pacote de instalação equivalente que fornece as mesmas informações de serviço.</span><span class="sxs-lookup"><span data-stu-id="03441-112">A Windows Installer patch package that delivers servicing information for a small update or minor upgrade is generally much smaller than the equivalent installation package that delivers the same servicing information.</span></span> <span data-ttu-id="03441-113">É recomendável que os pacotes de patch sejam usados para a distribuição de atualizações pequenas e secundárias.</span><span class="sxs-lookup"><span data-stu-id="03441-113">It is recommended that patch packages be used for the distribution of small and minor upgrades.</span></span> <span data-ttu-id="03441-114">É recomendável que um pacote de instalação seja usado para a distribuição de uma atualização principal.</span><span class="sxs-lookup"><span data-stu-id="03441-114">It is recommended that an installation package be used for the distribution of a major upgrade.</span></span>

<span data-ttu-id="03441-115">Windows Installer patches (arquivos. msp) podem ser gerados a partir de arquivos completos ou de diferenças de arquivo (também chamadas de deltas de arquivo). Um patch Windows Installer gerado a partir de deltas de arquivo pode ser muito menor do que o patch de arquivo completo equivalente.</span><span class="sxs-lookup"><span data-stu-id="03441-115">Windows Installer patches (.msp files) can be generated from either full files or from file differences (also called file deltas.) A Windows Installer patch generated from file deltas can be much smaller than the equivalent full-file patch.</span></span> <span data-ttu-id="03441-116">Todas as versões do Windows Installer podem usar patches de arquivo completo ou patches Delta.</span><span class="sxs-lookup"><span data-stu-id="03441-116">All versions of the Windows Installer can use both full-file patches or delta patches.</span></span>

<span data-ttu-id="03441-117">A partir do Windows Installer versão 3,0, o instalador salva seletivamente as informações de linha de base sobre os arquivos quando eles são atualizados.</span><span class="sxs-lookup"><span data-stu-id="03441-117">Beginning with Windows Installer version 3.0, the installer selectively saves baseline information about files when they are updated.</span></span> <span data-ttu-id="03441-118">As informações sobre o aplicativo base original (a versão RTM) e a atualização secundária mais recente (service pack) são salvas em um local privado quando o aplicativo é instalado ou recebe uma atualização secundária.</span><span class="sxs-lookup"><span data-stu-id="03441-118">Information about the original base application (the RTM version) and the most recent minor upgrade (service pack) are saved in a private location when the application is installed or receives a minor upgrade.</span></span>

<span data-ttu-id="03441-119">O instalador faz o seguinte para minimizar o tamanho do cache de linha de base:</span><span class="sxs-lookup"><span data-stu-id="03441-119">The installer does the following to minimize the size of the baseline cache:</span></span>

-   <span data-ttu-id="03441-120">No máximo duas linhas de base são mantidas para cada aplicativo: uma linha de base do arquivo como lançada originalmente (RTM) e uma linha de base do arquivo na atualização secundária mais recente (service pack.)</span><span class="sxs-lookup"><span data-stu-id="03441-120">No more than two baselines are maintained for each application: a baseline of the file as originally released (RTM) and a baseline of the file at the most recent minor upgrade (service pack.)</span></span>
-   <span data-ttu-id="03441-121">Um arquivo não é adicionado ao cache até que seja corrigido.</span><span class="sxs-lookup"><span data-stu-id="03441-121">A file is not added to the cache until it is patched.</span></span> <span data-ttu-id="03441-122">O cache de linha de base é copiar em gravação.</span><span class="sxs-lookup"><span data-stu-id="03441-122">The baseline cache is copy-on-write.</span></span>
-   <span data-ttu-id="03441-123">Se o aplicativo nunca tiver sido atualizado, não haverá arquivos no cache de linha de base.</span><span class="sxs-lookup"><span data-stu-id="03441-123">If the application has never been updated, there are no files in the baseline cache.</span></span>
-   <span data-ttu-id="03441-124">Quando a última manutenção do aplicativo era uma atualização secundária (service pack), o aplicativo está em um nível de linha de base e no máximo duas cópias de um arquivo podem estar presentes no computador.</span><span class="sxs-lookup"><span data-stu-id="03441-124">When the application's last servicing was a minor upgrade (service pack) the application is at a baseline level and at most two copies of a file can be present on the computer.</span></span> <span data-ttu-id="03441-125">Uma cópia do arquivo está no diretório de destino da instalação.</span><span class="sxs-lookup"><span data-stu-id="03441-125">One copy of the file is in the target directory of the installation.</span></span> <span data-ttu-id="03441-126">A outra cópia pode estar no cache de linha de base RTM.</span><span class="sxs-lookup"><span data-stu-id="03441-126">The other copy can be in the RTM baseline cache.</span></span>
-   <span data-ttu-id="03441-127">Quando a última manutenção do aplicativo era uma QFE (atualização pequena), o aplicativo não está em um nível de linha de base e, no máximo, três cópias de um arquivo podem estar presentes no computador.</span><span class="sxs-lookup"><span data-stu-id="03441-127">When the application's last servicing was a small update (QFE) the application is not at a baseline level and at most three copies of a file can be present on the computer.</span></span> <span data-ttu-id="03441-128">A primeira cópia do arquivo está no diretório de destino da instalação.</span><span class="sxs-lookup"><span data-stu-id="03441-128">The first copy of the file is in the target directory of the installation.</span></span> <span data-ttu-id="03441-129">A segunda cópia do arquivo está no cache de linha de base RTM.</span><span class="sxs-lookup"><span data-stu-id="03441-129">The second copy of the file is in the RTM baseline cache.</span></span> <span data-ttu-id="03441-130">A última cópia do arquivo está no cache de linha de base mais recente.</span><span class="sxs-lookup"><span data-stu-id="03441-130">The last copy of the file is in the most recent baseline cache.</span></span>
-   <span data-ttu-id="03441-131">O cache de linha de base do aplicativo é removido quando o produto é desinstalado.</span><span class="sxs-lookup"><span data-stu-id="03441-131">The application's baseline cache is removed when the product is uninstalled.</span></span>

<span data-ttu-id="03441-132">A partir do Windows Installer versão 3,0, o instalador pode usar o cache de linha de base quando os patches são aplicados ao aplicativo.</span><span class="sxs-lookup"><span data-stu-id="03441-132">Beginning with Windows Installer version 3.0, the installer can use the baseline cache when patches are applied to the application.</span></span> <span data-ttu-id="03441-133">As informações de linha de base podem ser usadas para aplicar um patch Delta ou para reverter um arquivo para uma versão anterior durante uma desinstalação de patch.</span><span class="sxs-lookup"><span data-stu-id="03441-133">The baseline information can be used to apply a delta patch or to revert a file to a previous version during a patch uninstall.</span></span> <span data-ttu-id="03441-134">Isso pode permitir que os autores de patch se beneficiem de patches Delta menores.</span><span class="sxs-lookup"><span data-stu-id="03441-134">This can enable patch authors to benefit from smaller delta patches.</span></span> <span data-ttu-id="03441-135">Se o instalador descobrir que o patch Delta não pode ser aplicado ao arquivo de destino, o instalador poderá tentar usar um arquivo salvo no cache de linha de base como um ponto de partida.</span><span class="sxs-lookup"><span data-stu-id="03441-135">If the installer finds that the delta patch cannot be applied to the target file, the installer can attempt to use a file saved in the baseline cache as a starting point.</span></span> <span data-ttu-id="03441-136">O instalador só realiza Resorts para solicitar a fonte de instalação original depois de tentar todas as possibilidades no cache.</span><span class="sxs-lookup"><span data-stu-id="03441-136">The installer only resorts to requesting the original installation source after trying all the possibilities in the cache.</span></span>

<span data-ttu-id="03441-137">A adesão às seguintes diretrizes pode ajudar os autores de patch a usarem Windows Installer patches da versão 3,0 e o cache de linha de base para criar patches Delta menores:</span><span class="sxs-lookup"><span data-stu-id="03441-137">Adherence to the following guidelines can help patch authors use Windows Installer version 3.0 patches and the baseline cache to create smaller delta patches:</span></span>

-   <span data-ttu-id="03441-138">Crie patches que incluam a [tabela MsiPatchSequence](msipatchsequence-table.md).</span><span class="sxs-lookup"><span data-stu-id="03441-138">Author patches that include the [MsiPatchSequence table](msipatchsequence-table.md).</span></span> <span data-ttu-id="03441-139">Esta tabela é necessária para usar o cache de linha de base e está disponível a partir do Windows Installer versão 3,0.</span><span class="sxs-lookup"><span data-stu-id="03441-139">This table is required to use the baseline cache and is available beginning with Windows Installer version 3.0.</span></span>
-   <span data-ttu-id="03441-140">Não defina a política que impede o cache de linha de base.</span><span class="sxs-lookup"><span data-stu-id="03441-140">Do not set policy that prevents baseline caching.</span></span> <span data-ttu-id="03441-141">O valor da política [MaxPatchCacheSize](maxpatchcachesize.md) especifica a porcentagem máxima de espaço em disco que pode ser usada.</span><span class="sxs-lookup"><span data-stu-id="03441-141">The value of the [MaxPatchCacheSize](maxpatchcachesize.md) policy specifies the maximum percentage of disk space that can be used.</span></span> <span data-ttu-id="03441-142">Se a política MaxPatchCacheSize for definida como 0, nenhum arquivo adicional será salvo no cache de linha de base.</span><span class="sxs-lookup"><span data-stu-id="03441-142">If the MaxPatchCacheSize policy is set to 0, no additional files are saved in the baseline cache.</span></span> <span data-ttu-id="03441-143">Se a política não estiver definida, o padrão é que um máximo de 10% do espaço em disco pode ser usado.</span><span class="sxs-lookup"><span data-stu-id="03441-143">If the policy is not set, the default is that a maximum of 10% of the disk space can be used.</span></span> <span data-ttu-id="03441-144">Se o tamanho total do cache atingir o percentual máximo de espaço em disco, nenhum arquivo adicional será salvo.</span><span class="sxs-lookup"><span data-stu-id="03441-144">If the total size of the cache reaches the maximum percentage of disk space, no additional files are saved.</span></span> <span data-ttu-id="03441-145">A política não afeta os arquivos que já foram salvos.</span><span class="sxs-lookup"><span data-stu-id="03441-145">The policy does not affect files that have already been saved.</span></span> <span data-ttu-id="03441-146">Mesmo quando o Caching está desabilitado, o instalador pode usar caches de linha de base de produtos existentes.</span><span class="sxs-lookup"><span data-stu-id="03441-146">Even when caching is disabled, the installer can use existing product baseline caches.</span></span>
-   <span data-ttu-id="03441-147">Se o primeiro patch aplicado incluir a [tabela MsiPatchSequence](msipatchsequence-table.md), o Caching será habilitado para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="03441-147">If the first patch applied includes the [MsiPatchSequence table](msipatchsequence-table.md), caching is enabled for the application.</span></span>
-   <span data-ttu-id="03441-148">Se qualquer patch na transação de serviço não incluir a [tabela MsiPatchSequence](msipatchsequence-table.md), o cache será habilitado para o aplicativo somente se um patch de atualização menor (Service Pack) que inclui a tabela MsiPatchSequence for aplicado com êxito ao produto.</span><span class="sxs-lookup"><span data-stu-id="03441-148">If any patch in the servicing transaction does not include the [MsiPatchSequence table](msipatchsequence-table.md), caching is enabled for the application only if a minor upgrade patch (service pack) that includes the MsiPatchSequence table is successfully applied to the product.</span></span>
-   <span data-ttu-id="03441-149">Gere o pacote de patch usando ferramentas de criação de patch, como [Msimsp.exe](msimsp-exe.md) e [PATCHWIZ.DLL](patchwiz-dll.md).</span><span class="sxs-lookup"><span data-stu-id="03441-149">Generate the patch package using patch creation tools such as [Msimsp.exe](msimsp-exe.md) and [PATCHWIZ.DLL](patchwiz-dll.md).</span></span>
-   <span data-ttu-id="03441-150">Sempre direcione patches para a versão RTM do aplicativo ou uma versão de atualização secundária (service pack) do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="03441-150">Always target patches for the RTM version of the application or a minor upgrade (service pack) version of the application.</span></span> <span data-ttu-id="03441-151">Os destinos especificados na [tabela TargetImages](targetimages-table-patchwiz-dll-.md) do arquivo PCP (Propriedades de criação de patch) devem ser pontos de verificação de produto definidos pelos três primeiros campos da propriedade [**ProductVersion**](productversion.md) .</span><span class="sxs-lookup"><span data-stu-id="03441-151">The targets specified in the [TargetImages table](targetimages-table-patchwiz-dll-.md) of the Patch Creation Properties (PCP) file should be product check points defined by the first three fields of the [**ProductVersion**](productversion.md) property.</span></span>
-   <span data-ttu-id="03441-152">Nunca direcione patches em imagens de atualização pequenas.</span><span class="sxs-lookup"><span data-stu-id="03441-152">Never target patches at small update images.</span></span> <span data-ttu-id="03441-153">Os destinos para a criação do patch não devem incluir as imagens anteriores de atualização de atualizações pequenas.</span><span class="sxs-lookup"><span data-stu-id="03441-153">The targets for building the patch should not include previous small update upgrade images.</span></span>

 

 



