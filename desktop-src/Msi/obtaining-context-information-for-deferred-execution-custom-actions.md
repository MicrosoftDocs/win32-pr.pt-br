---
description: Como o script de instalação pode ser executado fora da sessão de instalação em que foi gravado, a sessão pode não existir mais durante a execução do script de instalação.
ms.assetid: 13174c5d-c810-4b5d-9d1e-60ed30b8c44d
title: Obtendo informações de contexto para ações personalizadas de execução adiada
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a13cd956509a5b8a4c92e0a53bfa455154a59bcc
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103647653"
---
# <a name="obtaining-context-information-for-deferred-execution-custom-actions"></a><span data-ttu-id="8c36c-103">Obtendo informações de contexto para ações personalizadas de execução adiada</span><span class="sxs-lookup"><span data-stu-id="8c36c-103">Obtaining Context Information for Deferred Execution Custom Actions</span></span>

<span data-ttu-id="8c36c-104">Como o script de instalação pode ser executado fora da sessão de instalação em que foi gravado, a sessão pode não existir mais durante a execução do script de instalação.</span><span class="sxs-lookup"><span data-stu-id="8c36c-104">Because installation script can be executed outside of the installation session in which it was written, the session may no longer exist during execution of the installation script.</span></span> <span data-ttu-id="8c36c-105">Nesse caso, o identificador de sessão original e as propriedades definidas durante a sequência de instalação não estão disponíveis para uma ação personalizada de execução adiada.</span><span class="sxs-lookup"><span data-stu-id="8c36c-105">In this case, the original session handle and properties set during the installation sequence are not available to a deferred execution custom action.</span></span> <span data-ttu-id="8c36c-106">Todas as funções que exigem um identificador de sessão são restritas a alguns métodos que podem recuperar informações de contexto ou, caso contrário, as propriedades necessárias durante a execução do script devem ser gravadas no script de instalação.</span><span class="sxs-lookup"><span data-stu-id="8c36c-106">Any functions that require a session handle are restricted to a few methods that can retrieve context information, or else properties that are needed during script execution must be written into the installation script.</span></span> <span data-ttu-id="8c36c-107">Por exemplo, as ações personalizadas adiadas que chamam DLLs (bibliotecas de vínculo dinâmico) passam um identificador que pode ser usado apenas para obter uma quantidade muito limitada de informações.</span><span class="sxs-lookup"><span data-stu-id="8c36c-107">For example, deferred custom actions that call dynamic-link libraries (DLLs) pass a handle which can only be used to obtain a very limited amount of information.</span></span> <span data-ttu-id="8c36c-108">Funções que não exigem um identificador de sessão podem ser acessadas de uma ação personalizada adiada.</span><span class="sxs-lookup"><span data-stu-id="8c36c-108">Functions that do not require a session handle can be accessed from a deferred custom action.</span></span>

<span data-ttu-id="8c36c-109">As ações personalizadas de execução adiada são restritas à chamada apenas às funções a seguir que exigem um identificador.</span><span class="sxs-lookup"><span data-stu-id="8c36c-109">Deferred execution custom actions are restricted to calling only the following functions requiring a handle.</span></span>



| <span data-ttu-id="8c36c-110">Função</span><span class="sxs-lookup"><span data-stu-id="8c36c-110">Function</span></span>                                       | <span data-ttu-id="8c36c-111">Descrição</span><span class="sxs-lookup"><span data-stu-id="8c36c-111">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="8c36c-112">**MsiGetProperty**</span><span class="sxs-lookup"><span data-stu-id="8c36c-112">**MsiGetProperty**</span></span>](/windows/desktop/api/Msiquery/nf-msiquery-msigetpropertya)       | <span data-ttu-id="8c36c-113">Dá suporte a um conjunto limitado de propriedades quando usado com [ações personalizadas de execução adiada](deferred-execution-custom-actions.md): a propriedade CustomActionData, a propriedade [**ProductCode**](productcode.md) e a propriedade [**userid**](usersid.md) . As [ações personalizadas de confirmação](commit-custom-actions.md) não podem usar a função [**MsiGetProperty**](/windows/desktop/api/Msiquery/nf-msiquery-msigetpropertya) para obter a propriedade [**ProductCode**](productcode.md) .</span><span class="sxs-lookup"><span data-stu-id="8c36c-113">Supports a limited set of properties when used with [deferred execution custom actions](deferred-execution-custom-actions.md): the CustomActionData property, [**ProductCode**](productcode.md) property, and [**UserSID**](usersid.md) property.[Commit custom actions](commit-custom-actions.md) cannot use the [**MsiGetProperty**](/windows/desktop/api/Msiquery/nf-msiquery-msigetpropertya) function to obtain the [**ProductCode**](productcode.md) property.</span></span> <span data-ttu-id="8c36c-114">As ações personalizadas de confirmação podem usar a propriedade CustomActionData para obter o código do produto.</span><span class="sxs-lookup"><span data-stu-id="8c36c-114">Commit custom actions can use the CustomActionData property to obtain the product code.</span></span><br/> |
| [<span data-ttu-id="8c36c-115">**MsiFormatRecord**</span><span class="sxs-lookup"><span data-stu-id="8c36c-115">**MsiFormatRecord**</span></span>](/windows/desktop/api/Msiquery/nf-msiquery-msiformatrecorda)     | <span data-ttu-id="8c36c-116">Dá suporte a um conjunto limitado de propriedades quando usado com [ações personalizadas de execução adiada](deferred-execution-custom-actions.md): as propriedades CustomActionData e ProductCode.</span><span class="sxs-lookup"><span data-stu-id="8c36c-116">Supports a limited set of properties when used with [deferred execution custom actions](deferred-execution-custom-actions.md): the CustomActionData and ProductCode properties.</span></span>                                                                                                                                                                                                                                                                                                                                                      |
| [<span data-ttu-id="8c36c-117">**MsiGetMode**</span><span class="sxs-lookup"><span data-stu-id="8c36c-117">**MsiGetMode**</span></span>](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode)               | <span data-ttu-id="8c36c-118">Quando chamado de [ações personalizadas de execução adiada](deferred-execution-custom-actions.md), [confirmação de ações personalizadas](commit-custom-actions.md)ou [reversão de ações personalizadas](rollback-custom-actions.md), [**MsiGetMode**](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode) retorna true ou false quando solicitado a verificar os parâmetros de modo MSIRUNMODE \_ agendado, MSIRUNMODE \_ Commit ou \_ reversão de MSIRUNMODE.</span><span class="sxs-lookup"><span data-stu-id="8c36c-118">When called from [deferred execution custom actions](deferred-execution-custom-actions.md), [commit custom actions](commit-custom-actions.md), or [rollback custom actions](rollback-custom-actions.md), [**MsiGetMode**](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode) returns True or False when requested to check the mode parameters MSIRUNMODE\_SCHEDULED, MSIRUNMODE\_COMMIT, or MSIRUNMODE\_ROLLBACK.</span></span> <span data-ttu-id="8c36c-119">As solicitações para verificar qualquer outro parâmetro do modo de execução de uma ação personalizada adiada, Commit ou Rollback retorna false.</span><span class="sxs-lookup"><span data-stu-id="8c36c-119">Requests to check any other run mode parameters from a deferred, commit, or rollback custom action returns False.</span></span><br/>                       |
| [<span data-ttu-id="8c36c-120">**MsiGetLanguage**</span><span class="sxs-lookup"><span data-stu-id="8c36c-120">**MsiGetLanguage**</span></span>](/windows/desktop/api/Msiquery/nf-msiquery-msigetlanguage)       | <span data-ttu-id="8c36c-121">A ID do idioma numérico do produto atual. As [ações personalizadas de confirmação](commit-custom-actions.md) não podem usar a função [**MsiGetLanguage**](/windows/desktop/api/Msiquery/nf-msiquery-msigetlanguage) .</span><span class="sxs-lookup"><span data-stu-id="8c36c-121">The numeric language ID for the current product.[Commit custom actions](commit-custom-actions.md) cannot use the [**MsiGetLanguage**](/windows/desktop/api/Msiquery/nf-msiquery-msigetlanguage) function.</span></span> <span data-ttu-id="8c36c-122">As ações personalizadas de confirmação podem usar a propriedade CustomActionData para obter a ID do idioma numérico.</span><span class="sxs-lookup"><span data-stu-id="8c36c-122">Commit custom actions can use the CustomActionData property to get the numeric language ID.</span></span><br/>                                                                                                                                                                                                                                                           |
| [<span data-ttu-id="8c36c-123">**MsiProcessMessage**</span><span class="sxs-lookup"><span data-stu-id="8c36c-123">**MsiProcessMessage**</span></span>](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage) | <span data-ttu-id="8c36c-124">Processa mensagens de erro ou de progresso da ação personalizada.</span><span class="sxs-lookup"><span data-stu-id="8c36c-124">Processes error or progress messages from the custom action.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |



 

<span data-ttu-id="8c36c-125">Uma ação personalizada escrita em JScript ou VBScript requer o objeto de [**sessão**](session-object.md) de instalação.</span><span class="sxs-lookup"><span data-stu-id="8c36c-125">A custom action that is written in JScript or VBScript requires the install [**Session**](session-object.md) object.</span></span> <span data-ttu-id="8c36c-126">Esse é o objeto de **sessão** de tipo e o instalador o anexa ao script com o nome "Session".</span><span class="sxs-lookup"><span data-stu-id="8c36c-126">This is of the type **Session Object** and the installer attaches it to the script with the name "Session".</span></span> <span data-ttu-id="8c36c-127">Como o objeto de **sessão** pode não existir durante uma reversão de instalação, uma ação personalizada adiada escrita em script deve usar um dos métodos ou propriedades a seguir do objeto de **sessão** para recuperar seu contexto.</span><span class="sxs-lookup"><span data-stu-id="8c36c-127">Because the **Session** object may not exist during an installation rollback, a deferred custom action written in script must use one of the following methods or properties of the **Session** object to retrieve its context.</span></span>



| <span data-ttu-id="8c36c-128">Name</span><span class="sxs-lookup"><span data-stu-id="8c36c-128">Name</span></span>                                                           | <span data-ttu-id="8c36c-129">Descrição</span><span class="sxs-lookup"><span data-stu-id="8c36c-129">Description</span></span>                                                                                                                        |
|----------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="8c36c-130">**Propriedade Mode**</span><span class="sxs-lookup"><span data-stu-id="8c36c-130">**Mode Property**</span></span>](session-mode.md)                          | <span data-ttu-id="8c36c-131">Retorna true para MSIRUNMODE \_ somente agendado.</span><span class="sxs-lookup"><span data-stu-id="8c36c-131">Returns True for MSIRUNMODE\_SCHEDULED only.</span></span>                                                                                       |
| [<span data-ttu-id="8c36c-132">**Propriedade Property (objeto Session)**</span><span class="sxs-lookup"><span data-stu-id="8c36c-132">**Property Property (Session Object)**</span></span>](session-session.md)  | <span data-ttu-id="8c36c-133">Retorna a propriedade CustomActionData, a propriedade [**ProductCode**](productcode.md) ou a propriedade [**userid**](usersid.md) .</span><span class="sxs-lookup"><span data-stu-id="8c36c-133">Returns the CustomActionData property, [**ProductCode**](productcode.md) property, or [**UserSID**](usersid.md) property.</span></span>        |
| [<span data-ttu-id="8c36c-134">**Propriedade Language (objeto Session)**</span><span class="sxs-lookup"><span data-stu-id="8c36c-134">**Language Property (Session Object)**</span></span>](session-language.md) | <span data-ttu-id="8c36c-135">Retorna a ID de idioma numérico da sessão de instalação.</span><span class="sxs-lookup"><span data-stu-id="8c36c-135">Returns numeric language ID of the installation session.</span></span>                                                                           |
| [<span data-ttu-id="8c36c-136">**Método de mensagem**</span><span class="sxs-lookup"><span data-stu-id="8c36c-136">**Message Method**</span></span>](session-message.md)                      | <span data-ttu-id="8c36c-137">Chamado para tratar erros e progresso.</span><span class="sxs-lookup"><span data-stu-id="8c36c-137">Called to handle errors and progress.</span></span>                                                                                              |
| [<span data-ttu-id="8c36c-138">**Propriedade do instalador**</span><span class="sxs-lookup"><span data-stu-id="8c36c-138">**Installer Property**</span></span>](session-installer.md)                | <span data-ttu-id="8c36c-139">Retorna o objeto pai, que é usado para funções que não são de sessão, como o acesso do registro e o gerenciamento de configuração do instalador.</span><span class="sxs-lookup"><span data-stu-id="8c36c-139">Returns the parent object, which is used for non-session functions such as registry access and installer configuration management.</span></span> |



 

<span data-ttu-id="8c36c-140">Os valores de propriedade que são definidos no momento em que a sequência de instalação é processada no script podem estar indisponíveis no momento da execução do script.</span><span class="sxs-lookup"><span data-stu-id="8c36c-140">Property values that are set at the time the installation sequence is processed into script may be unavailable at the time of script execution.</span></span> <span data-ttu-id="8c36c-141">Somente o seguinte conjunto limitado de propriedades é sempre acessível para ações personalizadas durante a execução do script.</span><span class="sxs-lookup"><span data-stu-id="8c36c-141">Only the following limited set of properties is always accessible to custom actions during script execution.</span></span>



| <span data-ttu-id="8c36c-142">Nome da propriedade</span><span class="sxs-lookup"><span data-stu-id="8c36c-142">Property name</span></span>                      | <span data-ttu-id="8c36c-143">Descrição</span><span class="sxs-lookup"><span data-stu-id="8c36c-143">Description</span></span>                                                                                                                                                                                                     |
|------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="8c36c-144">CustomActionData</span><span class="sxs-lookup"><span data-stu-id="8c36c-144">CustomActionData</span></span>                   | <span data-ttu-id="8c36c-145">O valor no momento em que a ação personalizada é processada na tabela de sequência.</span><span class="sxs-lookup"><span data-stu-id="8c36c-145">Value at time custom action is processed in sequence table.</span></span> <span data-ttu-id="8c36c-146">A propriedade CustomActionData só está disponível para ações personalizadas de execução adiada.</span><span class="sxs-lookup"><span data-stu-id="8c36c-146">The CustomActionData property is only available to deferred execution custom actions.</span></span> <span data-ttu-id="8c36c-147">As ações personalizadas imediatas não têm acesso a essa propriedade.</span><span class="sxs-lookup"><span data-stu-id="8c36c-147">Immediate custom actions do not have access to this property.</span></span> |
| [<span data-ttu-id="8c36c-148">**ProductCode**</span><span class="sxs-lookup"><span data-stu-id="8c36c-148">**ProductCode**</span></span>](productcode.md) | <span data-ttu-id="8c36c-149">Código exclusivo para o produto, uma cadeia de caracteres [GUID](guid.md) .</span><span class="sxs-lookup"><span data-stu-id="8c36c-149">Unique code for the product, a [GUID](guid.md) string.</span></span>                                                                                                                                                         |
| [<span data-ttu-id="8c36c-150">**UserSID**</span><span class="sxs-lookup"><span data-stu-id="8c36c-150">**UserSID**</span></span>](usersid.md)         | <span data-ttu-id="8c36c-151">Definido pelo instalador para o SID (identificador de segurança) do usuário.</span><span class="sxs-lookup"><span data-stu-id="8c36c-151">Set by the installer to the user's security identifier (SID).</span></span>                                                                                                                                                   |



 

<span data-ttu-id="8c36c-152">Se outros dados de propriedade forem exigidos pela ação personalizada de execução adiada, seus valores deverão ser armazenados no script de instalação.</span><span class="sxs-lookup"><span data-stu-id="8c36c-152">If other property data is required by the deferred execution custom action, then their values must be stored in the installation script.</span></span> <span data-ttu-id="8c36c-153">Isso pode ser feito usando uma segunda ação personalizada.</span><span class="sxs-lookup"><span data-stu-id="8c36c-153">This can be done by using a second custom action.</span></span>

<span data-ttu-id="8c36c-154">**Para gravar o valor de uma propriedade no script de instalação para uso durante uma ação personalizada de execução adiada**</span><span class="sxs-lookup"><span data-stu-id="8c36c-154">**To write the value of a property into the installation script for use during a deferred execution custom action**</span></span>

1.  <span data-ttu-id="8c36c-155">Insira uma pequena ação personalizada na sequência de instalação que define a propriedade de interesse para uma propriedade com o mesmo nome da ação personalizada de execução adiada.</span><span class="sxs-lookup"><span data-stu-id="8c36c-155">Insert a small custom action into the installation sequence that sets the property of interest to a property having the same name as the deferred execution custom action.</span></span> <span data-ttu-id="8c36c-156">Por exemplo, se a chave primária para a ação personalizada de execução adiada for "myaction", defina uma propriedade chamada "myaction" como a propriedade X que você precisa recuperar.</span><span class="sxs-lookup"><span data-stu-id="8c36c-156">For example, if the primary key for the deferred execution custom action is "MyAction" set a property named "MyAction" to the property X which you need to retrieve.</span></span> <span data-ttu-id="8c36c-157">Você deve definir a propriedade "myaction" na sequência de instalação antes da ação personalizada "myaction".</span><span class="sxs-lookup"><span data-stu-id="8c36c-157">You must set the "MyAction" property in the installation sequence before the "MyAction" custom action.</span></span> <span data-ttu-id="8c36c-158">Embora qualquer tipo de ação personalizada possa definir os dados de contexto, o método mais simples é usar uma ação personalizada de atribuição de propriedade (por exemplo, [tipo de ação personalizada 51](custom-action-type-51.md)).</span><span class="sxs-lookup"><span data-stu-id="8c36c-158">Although any type of custom action can set the context data, the simplest method is to use a property assignment custom action (for example [Custom Action Type 51](custom-action-type-51.md)).</span></span>
2.  <span data-ttu-id="8c36c-159">No momento em que a sequência de instalação é processada, o instalador gravará o valor da propriedade X no script de execução como o valor da propriedade CustomActionData.</span><span class="sxs-lookup"><span data-stu-id="8c36c-159">At the time when the installation sequence is processed, the installer will write the value of property X into the execution script as the value of the property CustomActionData.</span></span>

## <a name="related-topics"></a><span data-ttu-id="8c36c-160">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="8c36c-160">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="8c36c-161">Sobre propriedades</span><span class="sxs-lookup"><span data-stu-id="8c36c-161">About Properties</span></span>](about-properties.md)
</dt> <dt>

[<span data-ttu-id="8c36c-162">Usando propriedades</span><span class="sxs-lookup"><span data-stu-id="8c36c-162">Using Properties</span></span>](using-properties.md)
</dt> <dt>

[<span data-ttu-id="8c36c-163">Referência de propriedade</span><span class="sxs-lookup"><span data-stu-id="8c36c-163">Property Reference</span></span>](property-reference.md)
</dt> </dl>

 

 




