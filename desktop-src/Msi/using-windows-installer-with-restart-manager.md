---
description: Os aplicativos que usam o Windows Installer 4,0 para instalação e manutenção no Windows Vista usam automaticamente o Gerenciador de reinicialização para reduzir as reinicializações do sistema.
ms.assetid: 821739ff-f7a7-4192-ad34-254aa7d74d13
title: Usando Windows Installer com o Gerenciador de reinicialização
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4160b2241c75ec7305accd1ab4d1295a54fa9f65
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105785416"
---
# <a name="using-windows-installer-with-restart-manager"></a><span data-ttu-id="07eb8-103">Usando Windows Installer com o Gerenciador de reinicialização</span><span class="sxs-lookup"><span data-stu-id="07eb8-103">Using Windows Installer with Restart Manager</span></span>

<span data-ttu-id="07eb8-104">Os aplicativos que usam o Windows Installer 4,0 para instalação e manutenção no Windows Vista usam automaticamente o [Gerenciador de reinicialização](../rstmgr/restart-manager-portal.md) para reduzir as reinicializações do sistema.</span><span class="sxs-lookup"><span data-stu-id="07eb8-104">Applications that use Windows Installer 4.0 for installation and servicing on Windows Vista automatically use the [Restart Manager](../rstmgr/restart-manager-portal.md) to reduce system restarts.</span></span> <span data-ttu-id="07eb8-105">O comportamento padrão no Windows Vista é desligar os aplicativos em vez de desligar e reiniciar o sistema operacional sempre que possível.</span><span class="sxs-lookup"><span data-stu-id="07eb8-105">The default behavior on Windows Vista is to shut down applications rather than shut down and restart the operating system whenever possible.</span></span> <span data-ttu-id="07eb8-106">Nos casos em que uma reinicialização do sistema é inevitável, os instaladores podem usar a API do [Gerenciador de reinicialização](../rstmgr/restart-manager-portal.md) para agendar reinicializações de forma a minimizar a interrupção do fluxo de trabalho do usuário.</span><span class="sxs-lookup"><span data-stu-id="07eb8-106">In cases where a system restart is unavoidable, installers can use the [Restart Manager](../rstmgr/restart-manager-portal.md) API to schedule restarts in such a way that it minimizes the disruption of the user's work flow.</span></span>

<span data-ttu-id="07eb8-107">Windows Installer os desenvolvedores podem executar as seguintes ações para preparar seu pacote para trabalhar com o [Gerenciador de reinicialização](../rstmgr/restart-manager-portal.md).</span><span class="sxs-lookup"><span data-stu-id="07eb8-107">Windows Installer developers can perform the following actions to prepare their package to work with the [Restart Manager](../rstmgr/restart-manager-portal.md).</span></span>

-   <span data-ttu-id="07eb8-108">Adicione a caixa de diálogo [MsiRMFilesInUse](msirmfilesinuse-dialog.md) ao seu pacote.</span><span class="sxs-lookup"><span data-stu-id="07eb8-108">Add the [MsiRMFilesInUse](msirmfilesinuse-dialog.md) dialog box to your package.</span></span> <span data-ttu-id="07eb8-109">Se a caixa de diálogo MsiRMFilesInUse estiver presente no pacote, o usuário do Windows Vista que está executando uma instalação no [nível da interface do usuário](user-interface-levels.md) da interface de usuários completa terá a opção de fechar e reiniciar os aplicativos automaticamente.</span><span class="sxs-lookup"><span data-stu-id="07eb8-109">If the MsiRMFilesInUse dialog box is present in the package, the Windows Vista user running an installation at the Full UI [user interface level](user-interface-levels.md) is given the option to automatically close and restart applications.</span></span> <span data-ttu-id="07eb8-110">Um pacote de instalação pode conter informações para a caixa de diálogo MsiRMFilesInUse e para a caixa de diálogo [FilesInUse](filesinuse-dialog.md) .</span><span class="sxs-lookup"><span data-stu-id="07eb8-110">An installation package can contain information for both the MsiRMFilesInUse dialog box and the [FilesInUse](filesinuse-dialog.md) dialog box .</span></span> <span data-ttu-id="07eb8-111">A caixa de diálogo MsiRMFilesInUse só será exibida se o pacote for instalado com pelo menos Windows Installer 4,0 no Windows Vista e, caso contrário, será ignorado.</span><span class="sxs-lookup"><span data-stu-id="07eb8-111">The MsiRMFilesInUse dialog box is only displayed if the package is installed with at least Windows Installer 4.0 on Windows Vista, and is otherwise ignored.</span></span> <span data-ttu-id="07eb8-112">Os pacotes existentes que não têm a caixa de diálogo MsiRMFilesInUse continuam a funcionar usando a caixa de diálogo FilesInUse.</span><span class="sxs-lookup"><span data-stu-id="07eb8-112">Existing packages that do not have the MsiRMFilesInUse dialog box continue to function using the FilesInUse dialog box.</span></span> <span data-ttu-id="07eb8-113">Uma transformação de personalização pode ser usada para adicionar uma caixa de diálogo MsiRMFilesInUse a pacotes existentes.</span><span class="sxs-lookup"><span data-stu-id="07eb8-113">A customization transform can be used to add an MsiRMFilesInUse dialog box to existing packages.</span></span>

    <span data-ttu-id="07eb8-114">Normalmente, os usuários finais executam instalações no nível completo da [interface do usuário](user-interface-levels.md)da IU.</span><span class="sxs-lookup"><span data-stu-id="07eb8-114">End-users typically run installations at the Full UI [user interface level](user-interface-levels.md).</span></span> <span data-ttu-id="07eb8-115">Interface do usuário básica ou instalações reduzidas no nível da interface do usuário oferecem aos usuários a opção de usar o [Gerenciador de reinicialização](../rstmgr/restart-manager-portal.md) para reduzir as reinicializações do sistema, mesmo que a caixa de diálogo [MsiRMFilesInUse](msirmfilesinuse-dialog.md) não esteja presente.</span><span class="sxs-lookup"><span data-stu-id="07eb8-115">Basic UI or Reduced UI level installations give the user the option of using the [Restart Manager](../rstmgr/restart-manager-portal.md) to reduce system restarts even if the [MsiRMFilesInUse](msirmfilesinuse-dialog.md) dialog box is not present.</span></span> <span data-ttu-id="07eb8-116">Instalações silenciosas em nível de interface do usuário sempre desligam aplicativos e serviços e, no Windows Vista, sempre usam o Gerenciador de reinicialização.</span><span class="sxs-lookup"><span data-stu-id="07eb8-116">Silent UI level installations always shut down applications and services, and on Windows Vista, always use Restart Manager.</span></span>

-   <span data-ttu-id="07eb8-117">Registre aplicativos para uma reinicialização usando a função [**RegisterApplicationRestart**](/windows/win32/api/winbase/nf-winbase-registerapplicationrestart) .</span><span class="sxs-lookup"><span data-stu-id="07eb8-117">Register applications for a restart using the [**RegisterApplicationRestart**](/windows/win32/api/winbase/nf-winbase-registerapplicationrestart) function.</span></span> <span data-ttu-id="07eb8-118">O Gerenciador de reinicialização só pode reiniciar os aplicativos que foram registrados para reinicialização.</span><span class="sxs-lookup"><span data-stu-id="07eb8-118">Restart Manager can only restart applications that have been registered for restart.</span></span> <span data-ttu-id="07eb8-119">O Restart Manager reinicia os aplicativos registrados após a instalação.</span><span class="sxs-lookup"><span data-stu-id="07eb8-119">Restart Manager restarts registered applications after the installation.</span></span> <span data-ttu-id="07eb8-120">Se a instalação exigir uma reinicialização do sistema, o Gerenciador de reinicialização reiniciará o aplicativo registrado após a reinicialização do sistema.</span><span class="sxs-lookup"><span data-stu-id="07eb8-120">If the installation requires a system restart, Restart Manager restarts the registered application after the system restart.</span></span>
-   <span data-ttu-id="07eb8-121">Especifique INSTALLLOGMODE \_ RMFILESINUSE ao habilitar um manipulador de interface de usuário externo com as funções [**MsiSetExternalUI**](/windows/desktop/api/Msi/nf-msi-msisetexternaluia) e [**MsiSetExternalUIRecord**](/windows/desktop/api/Msi/nf-msi-msisetexternaluirecord) .</span><span class="sxs-lookup"><span data-stu-id="07eb8-121">Specify INSTALLLOGMODE\_RMFILESINUSE when enabling an external user-interface handler with the [**MsiSetExternalUI**](/windows/desktop/api/Msi/nf-msi-msisetexternaluia) and [**MsiSetExternalUIRecord**](/windows/desktop/api/Msi/nf-msi-msisetexternaluirecord) functions.</span></span> <span data-ttu-id="07eb8-122">Windows Installer enviará uma \_ mensagem INSTALLMESSAGE RMFILESINUSE para manipuladores de interface do usuário externos que dão suporte ao [Gerenciador de reinicialização](../rstmgr/restart-manager-portal.md).</span><span class="sxs-lookup"><span data-stu-id="07eb8-122">Windows Installer will send a INSTALLMESSAGE\_RMFILESINUSE message for external user-interface handlers that support the [Restart Manager](../rstmgr/restart-manager-portal.md).</span></span> <span data-ttu-id="07eb8-123">Se nenhuma interface de usuário registrada ou interna manipular a \_ mensagem INSTALLMESSAGE RMFILESINUSE, o instalador enviará uma \_ mensagem INSTALLMESSAGE FILESINUSE para manipuladores de interface do usuário que dão suporte à caixa de diálogo [FILESINUSE](filesinuse-dialog.md) .</span><span class="sxs-lookup"><span data-stu-id="07eb8-123">If no registered or internal user-interface handles the INSTALLMESSAGE\_RMFILESINUSE message, the installer sends a INSTALLMESSAGE\_FILESINUSE message for user-interface handlers that support the [FilesInUse](filesinuse-dialog.md) dialog box.</span></span> <span data-ttu-id="07eb8-124">Para obter mais informações, consulte [usando o Gerenciador de reinicialização com uma interface do usuário externa](using-restart-manager-with-an-external-ui-.md).</span><span class="sxs-lookup"><span data-stu-id="07eb8-124">For more information, see [Using Restart Manager with an External UI](using-restart-manager-with-an-external-ui-.md).</span></span>
-   <span data-ttu-id="07eb8-125">As ações personalizadas podem adicionar recursos que pertencem a uma sessão do [Gerenciador de reinicialização](../rstmgr/restart-manager-portal.md) .</span><span class="sxs-lookup"><span data-stu-id="07eb8-125">Custom actions can add resources belonging to a [Restart Manager](../rstmgr/restart-manager-portal.md) session.</span></span> <span data-ttu-id="07eb8-126">A ação personalizada deve ser sequenciada antes da ação [InstallValidate](installvalidate-action.md) .</span><span class="sxs-lookup"><span data-stu-id="07eb8-126">The custom action should be sequenced before the [InstallValidate](installvalidate-action.md) action.</span></span> <span data-ttu-id="07eb8-127">As ações personalizadas podem usar a propriedade [**MsiRestartManagerSessionKey**](msirestartmanagersessionkey.md) para obter a chave de sessão e devem chamar as funções [**RmJoinSession**](/windows/win32/api/restartmanager/nf-restartmanager-rmjoinsession) e [**RmEndSession**](/windows/win32/api/restartmanager/nf-restartmanager-rmendsession) da API do Gerenciador de reinicialização.</span><span class="sxs-lookup"><span data-stu-id="07eb8-127">Custom actions can use the [**MsiRestartManagerSessionKey**](msirestartmanagersessionkey.md) property to obtain the session key, and should call the [**RmJoinSession**](/windows/win32/api/restartmanager/nf-restartmanager-rmjoinsession) and [**RmEndSession**](/windows/win32/api/restartmanager/nf-restartmanager-rmendsession) functions of the Restart Manager API.</span></span> <span data-ttu-id="07eb8-128">Ações personalizadas não podem remover recursos que pertencem a uma sessão do Gerenciador de reinicialização.</span><span class="sxs-lookup"><span data-stu-id="07eb8-128">Custom actions cannot remove resources belonging to a Restart Manager session.</span></span> <span data-ttu-id="07eb8-129">As ações personalizadas não devem tentar desligar ou reiniciar aplicativos usando as funções [**RmShutdown**](/windows/win32/api/restartmanager/nf-restartmanager-rmshutdown), [**RmGetList**](/windows/win32/api/restartmanager/nf-restartmanager-rmgetlist) e [**RmRestart**](/windows/win32/api/restartmanager/nf-restartmanager-rmrestart) .</span><span class="sxs-lookup"><span data-stu-id="07eb8-129">Custom actions should not attempt to shutdown or restart applications using the [**RmShutdown**](/windows/win32/api/restartmanager/nf-restartmanager-rmshutdown), [**RmGetList**](/windows/win32/api/restartmanager/nf-restartmanager-rmgetlist) and [**RmRestart**](/windows/win32/api/restartmanager/nf-restartmanager-rmrestart) functions.</span></span>
-   <span data-ttu-id="07eb8-130">Os autores de pacote podem basear uma condição na [tabela LaunchCondition](launchcondition-table.md) na propriedade [**MsiSystemRebootPending**](msisystemrebootpending.md) para impedir a instalação do pacote quando uma reinicialização do sistema estiver pendente.</span><span class="sxs-lookup"><span data-stu-id="07eb8-130">Package authors can base a condition in the [LaunchCondition table](launchcondition-table.md) on the [**MsiSystemRebootPending**](msisystemrebootpending.md) property to prevent the installation of their package when a system restart is pending.</span></span>
-   <span data-ttu-id="07eb8-131">Os autores e os administradores de pacotes podem controlar a interação do Windows Installer e do Gerenciador de reinicialização usando as propriedades [**MSIRESTARTMANAGERCONTROL**](msirestartmanagercontrol.md), [**MSIDISABLERMRESTART**](msidisablermrestart.md), [**MSIRMSHUTDOWN**](msirmshutdown.md) e a política [DisableAutomaticApplicationShutdown](disableautomaticapplicationshutdown.md) .</span><span class="sxs-lookup"><span data-stu-id="07eb8-131">Package authors and administrators can control the interaction of the Windows Installer and Restart Manager by using the [**MSIRESTARTMANAGERCONTROL**](msirestartmanagercontrol.md), [**MSIDISABLERMRESTART**](msidisablermrestart.md), [**MSIRMSHUTDOWN**](msirmshutdown.md) properties and the [DisableAutomaticApplicationShutdown](disableautomaticapplicationshutdown.md) policy.</span></span>
-   <span data-ttu-id="07eb8-132">Os aplicativos e serviços devem seguir as diretrizes descritas na seção [usando o Gerenciador de reinicialização](../rstmgr/using-restart-manager.md) da documentação do [Gerenciador de reinicialização](../rstmgr/restart-manager-portal.md) .</span><span class="sxs-lookup"><span data-stu-id="07eb8-132">Applications and services should follow the guidelines described in the [Using Restart Manager](../rstmgr/using-restart-manager.md) section of the [Restart Manager](../rstmgr/restart-manager-portal.md) documentation.</span></span>

 

 
