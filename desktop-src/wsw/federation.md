---
title: Federação
description: A Federação permite a delegação de autoridade de autorização para outros membros de um Interprise.
ms.assetid: 574496df-95dc-45f7-8c42-e646aec12e69
keywords:
- Serviços Web de Federação para Windows
- WWSAPI
- WWS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 45a02744c9c0a5358da35f4c31c20633c420fee9
ms.sourcegitcommit: 5b98bf8c68922f8f03c14f793fbe17504900559c
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 02/12/2021
ms.locfileid: "104563259"
---
# <a name="federation"></a><span data-ttu-id="fbb31-106">Federação</span><span class="sxs-lookup"><span data-stu-id="fbb31-106">Federation</span></span>

<span data-ttu-id="fbb31-107">A Federação permite a delegação de autoridade de autorização para outros membros de um Interprise.</span><span class="sxs-lookup"><span data-stu-id="fbb31-107">Federation allows the delegation of authorization authority to other members of an interprise.</span></span> <span data-ttu-id="fbb31-108">Por exemplo, considere o seguinte problema de negócios: a empresa de fabricação de peças auto Ltd deseja permitir que funcionários autorizados de seu cliente Fabrikam Inc acessem com segurança o serviço Web de pedidos de peças da contoso.</span><span class="sxs-lookup"><span data-stu-id="fbb31-108">For example, consider the following business problem: The auto parts manufacturing company Contoso Ltd would like to allow authorized employees of its customer Fabrikam Inc to securely access Contoso's parts order Web Service.</span></span> <span data-ttu-id="fbb31-109">Uma solução de segurança para esse cenário é que a contoso configure um mecanismo de confiança com a Fabrikam para delegar a decisão de autorização de acesso à fabrikam.</span><span class="sxs-lookup"><span data-stu-id="fbb31-109">One security solution for this scenario is for Contoso to set up a trust mechanism with Fabrikam to delegate the access authorization decision to Fabrikam.</span></span> <span data-ttu-id="fbb31-110">Esse processo pode funcionar da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="fbb31-110">This process could work as follows:</span></span>

-   <span data-ttu-id="fbb31-111">A Fabrikam, quando se torna um parceiro da Contoso, configura um contrato de confiança com a contoso.</span><span class="sxs-lookup"><span data-stu-id="fbb31-111">Fabrikam, when it becomes a partner of Contoso, sets up a trust agreement with Contoso.</span></span> <span data-ttu-id="fbb31-112">O objetivo desta etapa é concordar com o tipo de token de segurança e o conteúdo que representará a autorização da Fabrikam e será aceitável para a contoso.</span><span class="sxs-lookup"><span data-stu-id="fbb31-112">The goal of this step is to agree on the security token type and content that will represent Fabrikam's authorization and will be acceptable to Contoso.</span></span> <span data-ttu-id="fbb31-113">Por exemplo, pode ser decidido que um certificado X. 509 confiável com o nome da entidade "CN = Fabrikam Inc Supplier STS" deve assinar um token SAML para que o SAML seja aceito pelo serviço Web da contoso.</span><span class="sxs-lookup"><span data-stu-id="fbb31-113">For example, it may be decided that a trusted X.509 certificate with subject name "CN=Fabrikam Inc Supplier STS" should sign a SAML token for that SAML to be accepted by the Contoso Web Service.</span></span> <span data-ttu-id="fbb31-114">Além disso, pode ser decidido que a declaração de segurança no token SAML emitido deve ser ' https://schemas.contoso.com/claims/lookup ' (para autorização de pesquisa de parte) ou ' https://schemas.contoso.com/claims/order ' (para autorização de ordenação de partes).</span><span class="sxs-lookup"><span data-stu-id="fbb31-114">Further, it may be decided that the security claim in the issued SAML token should be either 'https://schemas.contoso.com/claims/lookup' (for part lookup authorization) or 'https://schemas.contoso.com/claims/order' (for part ordering authorization).</span></span>
-   <span data-ttu-id="fbb31-115">Quando um funcionário da Fabrikam usa o aplicativo de ordenação de partes internas, ele primeiro entra em contato com um serviço de token de segurança (STS) dentro da Fabrikam.</span><span class="sxs-lookup"><span data-stu-id="fbb31-115">When a Fabrikam employee uses the internal parts ordering application, it first contacts a security token service (STS) inside Fabrikam.</span></span> <span data-ttu-id="fbb31-116">Esse funcionário é autenticado usando o mecanismo de segurança interno da Fabrikam (digamos, nome de usuário do domínio do Windows/senha), sua autorização para ordenar partes é verificada e recebe um token SAML de curta duração que contém as declarações apropriadas e assinado pelo certificado X. 509 decidido acima.</span><span class="sxs-lookup"><span data-stu-id="fbb31-116">That employee is authenticated using the internal Fabrikam security mechanism (say, Windows domain username/password), his authorization to order parts is verified, and he is issued a short lived SAML token containing the appropriate claims and signed by the X.509 certificate decided above.</span></span> <span data-ttu-id="fbb31-117">O aplicativo de ordenação de peças, em seguida, contata o serviço contoso, apresentando o token SAML emitido para autenticar e executar a tarefa de ordenação.</span><span class="sxs-lookup"><span data-stu-id="fbb31-117">The parts ordering application then contacts the Contoso service presenting the issued SAML token to authenticate and perform the ordering task.</span></span>

<span data-ttu-id="fbb31-118">Aqui, o STS da Fabrikam atua como "parte emissora" e o serviço de peças da Contoso atua como "terceira parte confiável".</span><span class="sxs-lookup"><span data-stu-id="fbb31-118">Here, the Fabrikam STS acts as the 'issuing party' and the Contoso parts service acts as the 'relying party'.</span></span> ![Diagrama mostrando uma parte emissora e uma terceira parte confiável em uma federação.](images/stsmodel.png)

## <a name="federation-features"></a><span data-ttu-id="fbb31-120">Recursos de Federação</span><span class="sxs-lookup"><span data-stu-id="fbb31-120">Federation Features</span></span>

<span data-ttu-id="fbb31-121">Veja a seguir os recursos de segurança com suporte para as partes ou funções envolvidas em um cenário de Federação:</span><span class="sxs-lookup"><span data-stu-id="fbb31-121">The following are the supported security features for the parties or roles involved in a federation scenario:</span></span>

-   <span data-ttu-id="fbb31-122">No lado do cliente: para obter o token de segurança do STS, é possível usar a função [**WsRequestSecurityToken**](/windows/desktop/api/WebServices/nf-webservices-wsrequestsecuritytoken) .</span><span class="sxs-lookup"><span data-stu-id="fbb31-122">Client-side: For obtaining the security token from the STS, one may use [**WsRequestSecurityToken**](/windows/desktop/api/WebServices/nf-webservices-wsrequestsecuritytoken) function.</span></span> <span data-ttu-id="fbb31-123">Como alternativa, é possível usar uma biblioteca do provedor de token de segurança do lado do cliente, como o CardSpace ou o LiveID, e usar a saída para criar localmente um token de segurança usando [**WsCreateXmlSecurityToken**](/windows/desktop/api/WebServices/nf-webservices-wscreatexmlsecuritytoken).</span><span class="sxs-lookup"><span data-stu-id="fbb31-123">Alternatively, one may use a client side security token provider library such as CardSpace or LiveID, and then use their output to locally create a security token using [**WsCreateXmlSecurityToken**](/windows/desktop/api/WebServices/nf-webservices-wscreatexmlsecuritytoken).</span></span> <span data-ttu-id="fbb31-124">De qualquer forma, depois que o cliente tiver o token de segurança, ele poderá criar um canal para o serviço especificando a [**Associação de segurança de \_ \_ mensagem de token \_ \_ \_ XML do WS**](/windows/desktop/api/WebServices/ns-webservices-ws_xml_token_message_security_binding) para apresentar o token, junto com uma associação de segurança de transporte, como a [**\_ \_ \_ \_ Associação de segurança de transporte WS SSL**](/windows/desktop/api/WebServices/ns-webservices-ws_ssl_transport_security_binding) para proteger o canal.</span><span class="sxs-lookup"><span data-stu-id="fbb31-124">Either way, once the client has the security token, it may then create a channel to the service specifying [**WS\_XML\_TOKEN\_MESSAGE\_SECURITY\_BINDING**](/windows/desktop/api/WebServices/ns-webservices-ws_xml_token_message_security_binding) to present the token, together with a transport security binding such as [**WS\_SSL\_TRANSPORT\_SECURITY\_BINDING**](/windows/desktop/api/WebServices/ns-webservices-ws_ssl_transport_security_binding) to protect the channel.</span></span>
-   <span data-ttu-id="fbb31-125">No lado do servidor: em um cenário de Federação com um serviço de token de segurança que emite tokens SAML, o servidor pode usar a [**\_ Associação de \_ \_ segurança \_ de mensagem SAML do WS**](/windows/desktop/api/WebServices/ns-webservices-ws_saml_message_security_binding), junto com uma associação de segurança de transporte, como a associação de [**segurança de transporte do WS \_ SSL \_ \_ \_**](/windows/desktop/api/WebServices/ns-webservices-ws_ssl_transport_security_binding) para proteger o canal.</span><span class="sxs-lookup"><span data-stu-id="fbb31-125">Server-side: In a federation scenario with a security token service that issues SAML tokens, the server may use the [**WS\_SAML\_MESSAGE\_SECURITY\_BINDING**](/windows/desktop/api/WebServices/ns-webservices-ws_saml_message_security_binding), together with a transport security binding such as [**WS\_SSL\_TRANSPORT\_SECURITY\_BINDING**](/windows/desktop/api/WebServices/ns-webservices-ws_ssl_transport_security_binding) to protect the channel.</span></span>
-   <span data-ttu-id="fbb31-126">STS-lado: Observe que o STS é um aplicativo de serviço Web e pode especificar os requisitos de segurança para aqueles que solicitam um token de segurança usando uma estrutura de [**Descrição de segurança**](/windows/desktop/api/WebServices/ns-webservices-ws_security_description) no momento da criação do ouvinte, assim como qualquer outro serviço Web seguro.</span><span class="sxs-lookup"><span data-stu-id="fbb31-126">STS-side: Note that the STS is a Web Service application, and it can specify the security requirements for those requesting a security token from it using a [**security description**](/windows/desktop/api/WebServices/ns-webservices-ws_security_description) structure at listener creation time just as any other secure Web Service would.</span></span> <span data-ttu-id="fbb31-127">Em seguida, ele pode analisar cargas de mensagens de solicitação de entrada para validar as solicitações de token e enviar tokens emitidos de volta como cargas de mensagens de resposta.</span><span class="sxs-lookup"><span data-stu-id="fbb31-127">It may then parse incoming request message payloads to validate the token requests and send back issued tokens as reply message payloads.</span></span> <span data-ttu-id="fbb31-128">No momento, nenhum recurso é fornecido para ajudar essas etapas de análise e emissão.</span><span class="sxs-lookup"><span data-stu-id="fbb31-128">Currently, no features are provided to help these parsing and issuing steps.</span></span>

<span data-ttu-id="fbb31-129">Observe que o lado do cliente pode manipular o token de segurança emitido genericamente como um token de segurança XML sem saber o tipo de token ou fazer o processamento específico do tipo de token.</span><span class="sxs-lookup"><span data-stu-id="fbb31-129">Note that the client side can handle the issued security token generically as an XML security token without knowing the token type, or doing token type specific processing.</span></span> <span data-ttu-id="fbb31-130">No entanto, o servidor precisa entender o tipo de token de segurança específico para poder entender e processá-lo.</span><span class="sxs-lookup"><span data-stu-id="fbb31-130">However, the server has to understand the specific security token type in order to understand and process it.</span></span> <span data-ttu-id="fbb31-131">As etapas de solicitação e resposta de token de segurança usam as construções definidas na especificação de WS-Trust.</span><span class="sxs-lookup"><span data-stu-id="fbb31-131">The security token request and response steps use the constructs defined in the WS-Trust specification.</span></span>

## <a name="more-complex-federation-scenarios"></a><span data-ttu-id="fbb31-132">Cenários de Federação mais complexos</span><span class="sxs-lookup"><span data-stu-id="fbb31-132">More Complex Federation Scenarios</span></span>

<span data-ttu-id="fbb31-133">Um cenário de Federação pode envolver vários STSs que formam uma cadeia de Federação.</span><span class="sxs-lookup"><span data-stu-id="fbb31-133">A federation scenario may involve multiple STSs that form a federation chain.</span></span> <span data-ttu-id="fbb31-134">Considere o seguinte exemplo:</span><span class="sxs-lookup"><span data-stu-id="fbb31-134">Consider the following example:</span></span>

-   <span data-ttu-id="fbb31-135">O cliente é autenticado no STS do LiveID usando um nome de usuário/senha do LiveID e Obtém um token de segurança T1.</span><span class="sxs-lookup"><span data-stu-id="fbb31-135">Client authenticates to the LiveID STS using a LiveID username/password, and obtains a security token T1.</span></span>
-   <span data-ttu-id="fbb31-136">O cliente é autenticado no STS1 usando T1 e Obtém um token de segurança T2.</span><span class="sxs-lookup"><span data-stu-id="fbb31-136">Client authenticates to STS1 using T1 and obtains a security token T2.</span></span>
-   <span data-ttu-id="fbb31-137">O cliente é autenticado no STS2 usando T2 e Obtém um token de segurança T3.</span><span class="sxs-lookup"><span data-stu-id="fbb31-137">Client authenticates to STS2 using T2 and obtains a security token T3.</span></span>
-   <span data-ttu-id="fbb31-138">O cliente é autenticado para o serviço de destino usando T3.</span><span class="sxs-lookup"><span data-stu-id="fbb31-138">Client authenticates to the target service S using T3.</span></span>

<span data-ttu-id="fbb31-139">Aqui, o STS do LiveID, STS1, STS2 e S formam a cadeia de Federação.</span><span class="sxs-lookup"><span data-stu-id="fbb31-139">Here, the LiveID STS, STS1, STS2 and S form the federation chain.</span></span> <span data-ttu-id="fbb31-140">O STSs em uma cadeia de Federação pode executar várias funções para o cenário de aplicativo geral.</span><span class="sxs-lookup"><span data-stu-id="fbb31-140">The STSs in a federation chain may perform various roles for the overall application scenario.</span></span> <span data-ttu-id="fbb31-141">Exemplos de tais funções funcionais do STS incluem provedor de identidade, tomador de decisão de autorização, Anonymizer e Gerenciador de recursos.</span><span class="sxs-lookup"><span data-stu-id="fbb31-141">Examples of such STS functional roles include identity provider, authorization decision maker, anonymizer, and resource manager.</span></span>

## <a name="sts-request-parameters-and-metadata-exchange"></a><span data-ttu-id="fbb31-142">Parâmetros de solicitação do STS e troca de metadados</span><span class="sxs-lookup"><span data-stu-id="fbb31-142">STS Request Parameters and Metadata Exchange</span></span>

<span data-ttu-id="fbb31-143">Para que o cliente faça uma chamada [**WsRequestSecurityToken**](/windows/desktop/api/WebServices/nf-webservices-wsrequestsecuritytoken) bem-sucedida, ele precisa saber os parâmetros dessa chamada (como o tipo de token necessário e os tipos de declaração), os requisitos de [**Descrição de segurança**](/windows/desktop/api/WebServices/ns-webservices-ws_security_description) do canal de solicitação para o STS e o endereço do [ponto de extremidade](endpoint-address.md) do STS.</span><span class="sxs-lookup"><span data-stu-id="fbb31-143">For the client to make a successful [**WsRequestSecurityToken**](/windows/desktop/api/WebServices/nf-webservices-wsrequestsecuritytoken) call, it needs to know the parameters of that call (such as the required token type and claim types), the [**security description**](/windows/desktop/api/WebServices/ns-webservices-ws_security_description) requirements of the request channel to the STS, and the [endpoint address](endpoint-address.md) of the STS.</span></span> <span data-ttu-id="fbb31-144">O aplicativo cliente pode usar qualquer uma das seguintes técnicas para determinar essas informações:</span><span class="sxs-lookup"><span data-stu-id="fbb31-144">The client application may use any of the following techniques for determining this information:</span></span>

-   <span data-ttu-id="fbb31-145">Codifique as informações no aplicativo como parte das decisões de tempo de design.</span><span class="sxs-lookup"><span data-stu-id="fbb31-145">Hard code the information in the application as part of the design time decisions.</span></span>
-   <span data-ttu-id="fbb31-146">Leia estas informações de um arquivo de configuração de nível de aplicativo configurado pelo implantador de aplicativos local.</span><span class="sxs-lookup"><span data-stu-id="fbb31-146">Read this information from an application level configuration file set up by the local application deployer.</span></span>
-   <span data-ttu-id="fbb31-147">Descobrir dinamicamente essas informações em tempo de execução usando o recurso de [importação de metadados](metadata-import.md) com a estrutura de restrição de [**\_ \_ Associação de segurança de mensagem de token \_ \_ \_ \_ emitida do WS**](/windows/desktop/api/WebServices/ns-webservices-ws_issued_token_message_security_binding_constraint) .</span><span class="sxs-lookup"><span data-stu-id="fbb31-147">Dynamically discover this information at runtime using the [metadata import](metadata-import.md) feature with the [**WS\_ISSUED\_TOKEN\_MESSAGE\_SECURITY\_BINDING\_CONSTRAINT**](/windows/desktop/api/WebServices/ns-webservices-ws_issued_token_message_security_binding_constraint) structure.</span></span>

<span data-ttu-id="fbb31-148">Para ilustrar o uso de MEX dinâmico com Federação, considere o exemplo de 3 STS acima.</span><span class="sxs-lookup"><span data-stu-id="fbb31-148">To illustrate the use of dynamic MEX with federation, consider the 3 STS example above.</span></span> <span data-ttu-id="fbb31-149">O cliente primeiro fará um MEX dinâmico com S para obter informações sobre o T3 (ou seja, o que fazer a partir de STS2), bem como o endereço MEX do STS2 Dynamic (ou seja, onde encontrar STS2).</span><span class="sxs-lookup"><span data-stu-id="fbb31-149">The client will first do a dynamic MEX with S to obtain information about T3 (i.e., what to ask from STS2) as well as the STS2 dynamic MEX address (i.e., where to find STS2).</span></span> <span data-ttu-id="fbb31-150">Em seguida, ele usará essas informações para fazer um MEX dinâmico com STS2 para descobrir informações sobre T2 e STS1, e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="fbb31-150">It will then use that information to do a dynamic MEX with STS2 to discover information about T2 and STS1, and so on.</span></span>

<span data-ttu-id="fbb31-151">Assim, as etapas de MEX dinâmico ocorrem na ordem 4, 3, 2, 1 para criar a cadeia de Federação e as etapas de solicitação de token e de apresentação ocorrem na ordem 1, 2, 3, 4 para desenrolar a cadeia de Federação.</span><span class="sxs-lookup"><span data-stu-id="fbb31-151">Thus, the dynamic MEX steps take place in the order 4, 3, 2, 1 to build up the federation chain and the token request and presentation steps take place in the order 1, 2, 3, 4 to unwind the federation chain.</span></span>

> [!Note]  
> <span data-ttu-id="fbb31-152">Windows 7 e Windows Server 2008 R2: o WWSAPI dá suporte apenas ao [WS-Trust](https://specs.xmlsoap.org/ws/2005/02/trust/WS-Trust.pdf) e ao [WS-SecureConversation](https://specs.xmlsoap.org/ws/2005/02/sc/WS-SecureConversation.pdf) , conforme definido pelo [perfil de especificação Web Services Security leve (LWSSP)](/openspecs/windows_protocols/ms-lwssp/376af2f8-f4fe-4577-bfd5-370ac12cac2e).</span><span class="sxs-lookup"><span data-stu-id="fbb31-152">Windows 7 and Windows Server 2008 R2: WWSAPI only supports [Ws-Trust](https://specs.xmlsoap.org/ws/2005/02/trust/WS-Trust.pdf) and [Ws-SecureConversation](https://specs.xmlsoap.org/ws/2005/02/sc/WS-SecureConversation.pdf) as defined by [Lightweight Web Services Security Profile (LWSSP)](/openspecs/windows_protocols/ms-lwssp/376af2f8-f4fe-4577-bfd5-370ac12cac2e).</span></span> <span data-ttu-id="fbb31-153">Para obter detalhes sobre a implementação da Microsoft, consulte a seção de [sintaxe da mensagem](/openspecs/windows_protocols/ms-lwssp/d4f0f509-e14a-47b5-81e8-ade06a51d1ed) de LWSSP.</span><span class="sxs-lookup"><span data-stu-id="fbb31-153">For details regarding Microsoft's implementation please see the [MESSAGE Syntax](/openspecs/windows_protocols/ms-lwssp/d4f0f509-e14a-47b5-81e8-ade06a51d1ed) section of LWSSP.</span></span>

 

 

 