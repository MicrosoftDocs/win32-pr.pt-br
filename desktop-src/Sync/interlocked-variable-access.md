---
description: Os aplicativos devem sincronizar o acesso a variáveis que são compartilhadas por vários threads.
ms.assetid: 729c0e68-ef52-4d6c-b771-a89043a937e6
title: Acesso de variável interbloqueada
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ca2e083d3e3420e870ad9781b0d262df3d0786f1
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "105753700"
---
# <a name="interlocked-variable-access"></a><span data-ttu-id="6acdd-103">Acesso de variável interbloqueada</span><span class="sxs-lookup"><span data-stu-id="6acdd-103">Interlocked Variable Access</span></span>

<span data-ttu-id="6acdd-104">Os aplicativos devem sincronizar o acesso a variáveis que são compartilhadas por vários threads.</span><span class="sxs-lookup"><span data-stu-id="6acdd-104">Applications must synchronize access to variables that are shared by multiple threads.</span></span> <span data-ttu-id="6acdd-105">Os aplicativos também devem garantir que as operações nessas variáveis sejam executadas atomicamente (executadas em sua totalidade ou não).</span><span class="sxs-lookup"><span data-stu-id="6acdd-105">Applications must also ensure that operations on these variables are performed atomically (performed in their entirety or not at all.)</span></span>

<span data-ttu-id="6acdd-106">Leituras e gravações simples para variáveis de 32 bits alinhadas corretamente são operações atômicas.</span><span class="sxs-lookup"><span data-stu-id="6acdd-106">Simple reads and writes to properly-aligned 32-bit variables are atomic operations.</span></span> <span data-ttu-id="6acdd-107">Em outras palavras, você não acabará com apenas uma parte da variável atualizada; todos os bits são atualizados de maneira atômica.</span><span class="sxs-lookup"><span data-stu-id="6acdd-107">In other words, you will not end up with only one portion of the variable updated; all bits are updated in an atomic fashion.</span></span> <span data-ttu-id="6acdd-108">No entanto, não há garantia de que o acesso seja sincronizado.</span><span class="sxs-lookup"><span data-stu-id="6acdd-108">However, access is not guaranteed to be synchronized.</span></span> <span data-ttu-id="6acdd-109">Se dois threads estiverem lendo e gravando da mesma variável, você não poderá determinar se um thread executará sua operação de leitura antes que o outro execute sua operação de gravação.</span><span class="sxs-lookup"><span data-stu-id="6acdd-109">If two threads are reading and writing from the same variable, you cannot determine if one thread will perform its read operation before the other performs its write operation.</span></span>

<span data-ttu-id="6acdd-110">Leituras e gravações simples para as variáveis de 64 bits alinhadas corretamente são atômicas no Windows de 64 bits.</span><span class="sxs-lookup"><span data-stu-id="6acdd-110">Simple reads and writes to properly aligned 64-bit variables are atomic on 64-bit Windows.</span></span> <span data-ttu-id="6acdd-111">Leituras e gravações em valores de 64 bits não têm garantia de serem atômicas no Windows de 32 bits.</span><span class="sxs-lookup"><span data-stu-id="6acdd-111">Reads and writes to 64-bit values are not guaranteed to be atomic on 32-bit Windows.</span></span> <span data-ttu-id="6acdd-112">Leituras e gravações em variáveis de outros tamanhos não têm garantia de serem atômicas em qualquer plataforma.</span><span class="sxs-lookup"><span data-stu-id="6acdd-112">Reads and writes to variables of other sizes are not guaranteed to be atomic on any platform.</span></span>

## <a name="the-interlocked-api"></a><span data-ttu-id="6acdd-113">A API intercadeado</span><span class="sxs-lookup"><span data-stu-id="6acdd-113">The Interlocked API</span></span>

<span data-ttu-id="6acdd-114">As funções intercadeados fornecem um mecanismo simples para sincronizar o acesso a uma variável que é compartilhada por vários threads.</span><span class="sxs-lookup"><span data-stu-id="6acdd-114">The interlocked functions provide a simple mechanism for synchronizing access to a variable that is shared by multiple threads.</span></span> <span data-ttu-id="6acdd-115">Eles também executam operações em variáveis de maneira atômica.</span><span class="sxs-lookup"><span data-stu-id="6acdd-115">They also perform operations on variables in an atomic manner.</span></span> <span data-ttu-id="6acdd-116">Os threads de processos diferentes podem usar essas funções se a variável estiver na memória compartilhada.</span><span class="sxs-lookup"><span data-stu-id="6acdd-116">The threads of different processes can use these functions if the variable is in shared memory.</span></span>

<span data-ttu-id="6acdd-117">As funções [**InterlockedIncrement**](/windows/win32/api/winnt/nf-winnt-interlockedincrement) e [**InterlockedDecrement**](/windows/win32/api/winnt/nf-winnt-interlockeddecrement) combinam as etapas envolvidas em incrementar ou decrementar uma variável em uma operação atômica.</span><span class="sxs-lookup"><span data-stu-id="6acdd-117">The [**InterlockedIncrement**](/windows/win32/api/winnt/nf-winnt-interlockedincrement) and [**InterlockedDecrement**](/windows/win32/api/winnt/nf-winnt-interlockeddecrement) functions combine the steps involved in incrementing or decrementing a variable into an atomic operation.</span></span> <span data-ttu-id="6acdd-118">Esse recurso é útil em um sistema operacional multitarefa, no qual o sistema pode interromper a execução de um thread para conceder uma fatia do tempo do processador a outro thread.</span><span class="sxs-lookup"><span data-stu-id="6acdd-118">This feature is useful in a multitasking operating system, in which the system can interrupt one thread's execution to grant a slice of processor time to another thread.</span></span> <span data-ttu-id="6acdd-119">Sem essa sincronização, dois threads podiam ler o mesmo valor, incrementar a ti em 1 e armazenar o novo valor para um aumento total de 1 em vez de 2.</span><span class="sxs-lookup"><span data-stu-id="6acdd-119">Without such synchronization, two threads could read the same value, increment it by 1, and store the new value for a total increase of 1 instead of 2.</span></span> <span data-ttu-id="6acdd-120">As funções de acesso a variáveis interbloqueadas protegem contra esse tipo de erro.</span><span class="sxs-lookup"><span data-stu-id="6acdd-120">The interlocked variable-access functions protect against this kind of error.</span></span>

<span data-ttu-id="6acdd-121">As funções [**InterlockedExchange**](/windows/win32/api/winnt/nf-winnt-interlockedexchange) e [**InterlockedExchangePointer**](/windows/win32/api/winnt/nf-winnt-interlockedexchangepointer) , de forma atômica, trocam os valores das variáveis especificadas.</span><span class="sxs-lookup"><span data-stu-id="6acdd-121">The [**InterlockedExchange**](/windows/win32/api/winnt/nf-winnt-interlockedexchange) and [**InterlockedExchangePointer**](/windows/win32/api/winnt/nf-winnt-interlockedexchangepointer) functions atomically exchange the values of the specified variables.</span></span> <span data-ttu-id="6acdd-122">A função [**InterlockedExchangeAdd**](/windows/win32/api/winnt/nf-winnt-interlockedexchangeadd) combina duas operações: adicionar duas variáveis juntas e armazenar o resultado em uma das variáveis.</span><span class="sxs-lookup"><span data-stu-id="6acdd-122">The [**InterlockedExchangeAdd**](/windows/win32/api/winnt/nf-winnt-interlockedexchangeadd) function combines two operations: adding two variables together and storing the result in one of the variables.</span></span>

<span data-ttu-id="6acdd-123">As funções [**InterlockedCompareExchange**](/windows/win32/api/winnt/nf-winnt-interlockedcompareexchange), [**InterlockedCompare64Exchange128**](/previous-versions/windows/desktop/legacy/ms683553(v=vs.85))e [**InterlockedCompareExchangePointer**](/windows/win32/api/winnt/nf-winnt-interlockedcompareexchangepointer) combinam duas operações: comparando dois valores e armazenando um terceiro valor em uma das variáveis, com base no resultado da comparação.</span><span class="sxs-lookup"><span data-stu-id="6acdd-123">The [**InterlockedCompareExchange**](/windows/win32/api/winnt/nf-winnt-interlockedcompareexchange), [**InterlockedCompare64Exchange128**](/previous-versions/windows/desktop/legacy/ms683553(v=vs.85)), and [**InterlockedCompareExchangePointer**](/windows/win32/api/winnt/nf-winnt-interlockedcompareexchangepointer) functions combine two operations: comparing two values and storing a third value in one of the variables, based on the outcome of the comparison.</span></span>

<span data-ttu-id="6acdd-124">As funções [**InterlockedAnd**](/windows/win32/api/winnt/nf-winnt-interlockedand), [**interbloqueador**](/windows/win32/api/winnt/nf-winnt-interlockedor)e [**InterlockedXor**](/windows/win32/api/winnt/nf-winnt-interlockedxor) executam atomicamente as operações and, or e XOR, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="6acdd-124">The [**InterlockedAnd**](/windows/win32/api/winnt/nf-winnt-interlockedand), [**InterlockedOr**](/windows/win32/api/winnt/nf-winnt-interlockedor), and [**InterlockedXor**](/windows/win32/api/winnt/nf-winnt-interlockedxor) functions atomically perform AND, OR, and XOR operations, respectively.</span></span>

<span data-ttu-id="6acdd-125">Há funções que são projetadas especificamente para executar acesso de variável intercadeado em valores e endereços de memória de 64 bits e são otimizadas para uso em janelas de 64 bits.</span><span class="sxs-lookup"><span data-stu-id="6acdd-125">There are functions that are specifically designed to perform interlocked variable access on 64-bit memory values and addresses, and are optimized for use on 64-bit Windows.</span></span> <span data-ttu-id="6acdd-126">Cada uma dessas funções contém "64" no nome; por exemplo, [**InterlockedDecrement64**](/windows/win32/api/winnt/nf-winnt-interlockeddecrement64) e [**InterlockedCompareExchangeAcquire64**](/previous-versions/windows/desktop/legacy/ms683566(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="6acdd-126">Each of these functions contains "64" in the name; for example, [**InterlockedDecrement64**](/windows/win32/api/winnt/nf-winnt-interlockeddecrement64) and [**InterlockedCompareExchangeAcquire64**](/previous-versions/windows/desktop/legacy/ms683566(v=vs.85)).</span></span>

<span data-ttu-id="6acdd-127">A maioria das funções interligadas fornece barreiras de memória total em todas as plataformas Windows.</span><span class="sxs-lookup"><span data-stu-id="6acdd-127">Most of the interlocked functions provide full memory barriers on all Windows platforms.</span></span> <span data-ttu-id="6acdd-128">Também há funções que combinam as operações de acesso de variável interbloqueada básica com a semântica de ordenação de memória de aquisição e liberação suportada por determinados processadores.</span><span class="sxs-lookup"><span data-stu-id="6acdd-128">There are also functions that combine the basic interlocked variable access operations with the acquire and release memory ordering semantics supported by certain processors.</span></span> <span data-ttu-id="6acdd-129">Cada uma dessas funções contém a palavra "adquirir" ou "Release" em seus nomes; por exemplo, [**InterlockedDecrementAcquire**](/previous-versions/windows/desktop/legacy/ms683583(v=vs.85)) e [**InterlockedDecrementRelease**](/previous-versions/windows/desktop/legacy/ms683586(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="6acdd-129">Each of these functions contains the word "Acquire" or "Release" in their names; for example, [**InterlockedDecrementAcquire**](/previous-versions/windows/desktop/legacy/ms683583(v=vs.85)) and [**InterlockedDecrementRelease**](/previous-versions/windows/desktop/legacy/ms683586(v=vs.85)).</span></span> <span data-ttu-id="6acdd-130">Adquirir a semântica de memória especifique que a operação de memória que está sendo executada pelo thread atual ficará visível antes de qualquer operação de memória ser tentada.</span><span class="sxs-lookup"><span data-stu-id="6acdd-130">Acquire memory semantics specify that the memory operation being performed by the current thread will be visible before any other memory operations are attempted.</span></span> <span data-ttu-id="6acdd-131">Semântica de memória de liberação especifique que a operação de memória que está sendo executada pelo thread atual ficará visível depois que todas as outras operações de memória forem concluídas.</span><span class="sxs-lookup"><span data-stu-id="6acdd-131">Release memory semantics specify that the memory operation being performed by the current thread will be visible after all other memory operations have been completed.</span></span> <span data-ttu-id="6acdd-132">Essas semânticas permitem que você force as operações de memória a serem executadas em uma ordem específica.</span><span class="sxs-lookup"><span data-stu-id="6acdd-132">These semantics allow you to force memory operations to be performed in a specific order.</span></span> <span data-ttu-id="6acdd-133">Use a semântica de aquisição ao inserir uma região protegida e a semântica de liberação ao deixá-la.</span><span class="sxs-lookup"><span data-stu-id="6acdd-133">Use acquire semantics when entering a protected region and release semantics when leaving it.</span></span>

## <a name="related-topics"></a><span data-ttu-id="6acdd-134">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="6acdd-134">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="6acdd-135">Intrínsecos do compilador</span><span class="sxs-lookup"><span data-stu-id="6acdd-135">Compiler Intrinsics</span></span>](/cpp/intrinsics/compiler-intrinsics?view=vs-2019)
</dt> <dt>

[<span data-ttu-id="6acdd-136">Sincronização e problemas de multiprocessador</span><span class="sxs-lookup"><span data-stu-id="6acdd-136">Synchronization and Multiprocessor Issues</span></span>](synchronization-and-multiprocessor-issues.md)
</dt> </dl>

 

 
