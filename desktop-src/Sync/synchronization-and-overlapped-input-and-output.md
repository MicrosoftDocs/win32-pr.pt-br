---
description: Você pode executar operações síncronas ou assíncronas (também chamadas sobrepostas) de e/s em arquivos, pipes nomeados e dispositivos de comunicação serial.
ms.assetid: db44990e-5a0f-4153-8ff6-79dd7cda48af
title: Sincronização e entrada e saída sobrepostas
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e263bb39badc7cbfadd67d80eb169dc1fe6d6c35
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "105754483"
---
# <a name="synchronization-and-overlapped-input-and-output"></a><span data-ttu-id="b0c37-103">Sincronização e entrada e saída sobrepostas</span><span class="sxs-lookup"><span data-stu-id="b0c37-103">Synchronization and Overlapped Input and Output</span></span>

<span data-ttu-id="b0c37-104">Você pode executar operações síncronas ou assíncronas (também chamadas sobrepostas) de e/s em arquivos, pipes nomeados e dispositivos de comunicação serial.</span><span class="sxs-lookup"><span data-stu-id="b0c37-104">You can perform either synchronous or asynchronous (also called overlapped) I/O operations on files, named pipes, and serial communications devices.</span></span> <span data-ttu-id="b0c37-105">As funções [**WriteFile**](/windows/win32/api/fileapi/nf-fileapi-writefile), [**ReadFile**](/windows/win32/api/fileapi/nf-fileapi-readfile), [**DeviceIoControl**](/windows/win32/api/ioapiset/nf-ioapiset-deviceiocontrol), [**WaitCommEvent**](/windows/win32/api/winbase/nf-winbase-waitcommevent), [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe)e [**TransactNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-transactnamedpipe) podem ser executadas de forma síncrona ou assíncrona.</span><span class="sxs-lookup"><span data-stu-id="b0c37-105">The [**WriteFile**](/windows/win32/api/fileapi/nf-fileapi-writefile), [**ReadFile**](/windows/win32/api/fileapi/nf-fileapi-readfile), [**DeviceIoControl**](/windows/win32/api/ioapiset/nf-ioapiset-deviceiocontrol), [**WaitCommEvent**](/windows/win32/api/winbase/nf-winbase-waitcommevent), [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe), and [**TransactNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-transactnamedpipe) functions can be performed either synchronously or asynchronously.</span></span> <span data-ttu-id="b0c37-106">As funções [**ReadFileEx**](/windows/win32/api/fileapi/nf-fileapi-readfileex) e [**WriteFileEx**](/windows/win32/api/fileapi/nf-fileapi-writefileex) podem ser executadas apenas de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="b0c37-106">The [**ReadFileEx**](/windows/win32/api/fileapi/nf-fileapi-readfileex) and [**WriteFileEx**](/windows/win32/api/fileapi/nf-fileapi-writefileex) functions can be performed only asynchronously.</span></span>

<span data-ttu-id="b0c37-107">Quando uma função é executada de forma síncrona, ela não retorna até que a operação seja concluída.</span><span class="sxs-lookup"><span data-stu-id="b0c37-107">When a function is executed synchronously, it does not return until the operation has been completed.</span></span> <span data-ttu-id="b0c37-108">Isso significa que a execução do thread de chamada pode ser bloqueada por um período indefinido enquanto aguarda a conclusão de uma operação demorada.</span><span class="sxs-lookup"><span data-stu-id="b0c37-108">This means that the execution of the calling thread can be blocked for an indefinite period while it waits for a time-consuming operation to finish.</span></span> <span data-ttu-id="b0c37-109">As funções chamadas para a operação sobreposta podem retornar imediatamente, embora a operação não tenha sido concluída.</span><span class="sxs-lookup"><span data-stu-id="b0c37-109">Functions called for overlapped operation can return immediately, even though the operation has not been completed.</span></span> <span data-ttu-id="b0c37-110">Isso permite que uma operação de e/s demorada seja executada em segundo plano enquanto o thread de chamada está livre para executar outras tarefas.</span><span class="sxs-lookup"><span data-stu-id="b0c37-110">This enables a time-consuming I/O operation to be executed in the background while the calling thread is free to perform other tasks.</span></span> <span data-ttu-id="b0c37-111">Por exemplo, um único thread pode executar operações de e/s simultâneas em diferentes identificadores ou até mesmo operações de leitura e gravação simultâneas no mesmo identificador.</span><span class="sxs-lookup"><span data-stu-id="b0c37-111">For example, a single thread can perform simultaneous I/O operations on different handles, or even simultaneous read and write operations on the same handle.</span></span>

<span data-ttu-id="b0c37-112">Para sincronizar sua execução com a conclusão da operação sobreposta, o thread de chamada usa a função [**GetOverlappedResult**](/windows/win32/api/ioapiset/nf-ioapiset-getoverlappedresult) , a função [**GetOverlappedResultEx**](/windows/desktop/api/Ioapiset/nf-ioapiset-getoverlappedresultex) ou uma das [funções Wait](wait-functions.md) para determinar quando a operação sobreposta foi concluída.</span><span class="sxs-lookup"><span data-stu-id="b0c37-112">To synchronize its execution with the completion of the overlapped operation, the calling thread uses the [**GetOverlappedResult**](/windows/win32/api/ioapiset/nf-ioapiset-getoverlappedresult) function, the [**GetOverlappedResultEx**](/windows/desktop/api/Ioapiset/nf-ioapiset-getoverlappedresultex) function, or one of the [wait functions](wait-functions.md) to determine when the overlapped operation has been completed.</span></span> <span data-ttu-id="b0c37-113">Você também pode usar a macro [**HasOverlappedIoCompleted**](/windows/desktop/api/WinBase/nf-winbase-hasoverlappediocompleted) para sondar a conclusão.</span><span class="sxs-lookup"><span data-stu-id="b0c37-113">You can also use the [**HasOverlappedIoCompleted**](/windows/desktop/api/WinBase/nf-winbase-hasoverlappediocompleted) macro to poll for completion.</span></span>

<span data-ttu-id="b0c37-114">Para cancelar todas as operações de e/s assíncronas pendentes, use a função [**CancelIoEx**](/windows/win32/api/ioapiset/nf-ioapiset-cancelioex) e forneça uma estrutura [**sobreposta**](/windows/win32/api/minwinbase/ns-minwinbase-overlapped) que especifique a solicitação a ser cancelada.</span><span class="sxs-lookup"><span data-stu-id="b0c37-114">To cancel all pending asynchronous I/O operations, use the [**CancelIoEx**](/windows/win32/api/ioapiset/nf-ioapiset-cancelioex) function and provide an [**OVERLAPPED**](/windows/win32/api/minwinbase/ns-minwinbase-overlapped) structure that specifies the request to cancel.</span></span> <span data-ttu-id="b0c37-115">Use a função [**CancelIo**](/windows/win32/api/ioapiset/nf-ioapiset-cancelio) para cancelar as operações de e/s assíncronas pendentes emitidas pelo thread de chamada para o identificador de arquivo especificado.</span><span class="sxs-lookup"><span data-stu-id="b0c37-115">Use the [**CancelIo**](/windows/win32/api/ioapiset/nf-ioapiset-cancelio) function to cancel pending asynchronous I/O operations issued by the calling thread for the specified file handle.</span></span>

<span data-ttu-id="b0c37-116">As operações sobrepostas exigem um arquivo, um pipe nomeado ou um dispositivo de comunicação criado com o sinalizador **\_ \_ sobreposto do sinalizador de arquivo** .</span><span class="sxs-lookup"><span data-stu-id="b0c37-116">Overlapped operations require a file, named pipe, or communications device that was created with the **FILE\_FLAG\_OVERLAPPED** flag.</span></span> <span data-ttu-id="b0c37-117">Quando um thread chama uma função (como a função [**ReadFile**](/windows/win32/api/fileapi/nf-fileapi-readfile) ) para executar uma operação sobreposta, o thread de chamada deve especificar um ponteiro para uma estrutura [**sobreposta**](/windows/win32/api/minwinbase/ns-minwinbase-overlapped) .</span><span class="sxs-lookup"><span data-stu-id="b0c37-117">When a thread calls a function (such as the [**ReadFile**](/windows/win32/api/fileapi/nf-fileapi-readfile) function) to perform an overlapped operation, the calling thread must specify a pointer to an [**OVERLAPPED**](/windows/win32/api/minwinbase/ns-minwinbase-overlapped) structure.</span></span> <span data-ttu-id="b0c37-118">(Se esse ponteiro for **nulo**, o valor de retorno da função poderá indicar incorretamente que a operação foi concluída.) Todos os membros da estrutura **sobreposta** devem ser inicializados para zero, a menos que um evento seja usado para sinalizar a conclusão de uma operação de e/s.</span><span class="sxs-lookup"><span data-stu-id="b0c37-118">(If this pointer is **NULL**, the function return value may incorrectly indicate that the operation completed.) All of the members of the **OVERLAPPED** structure must be initialized to zero unless an event will be used to signal completion of an I/O operation.</span></span> <span data-ttu-id="b0c37-119">Se um evento for usado, o membro **hEvent** da estrutura **sobreposta** especificará um identificador para o objeto de evento alocado.</span><span class="sxs-lookup"><span data-stu-id="b0c37-119">If an event is used, the **hEvent** member of the **OVERLAPPED** structure specifies a handle to the allocated event object.</span></span> <span data-ttu-id="b0c37-120">O sistema define o estado do objeto de evento como não sinalizado quando uma chamada para a função de e/s retorna antes de a operação ser concluída.</span><span class="sxs-lookup"><span data-stu-id="b0c37-120">The system sets the state of the event object to nonsignaled when a call to the I/O function returns before the operation has been completed.</span></span> <span data-ttu-id="b0c37-121">O sistema define o estado do objeto de evento para sinalizado quando a operação foi concluída.</span><span class="sxs-lookup"><span data-stu-id="b0c37-121">The system sets the state of the event object to signaled when the operation has been completed.</span></span> <span data-ttu-id="b0c37-122">Um evento será necessário apenas se houver mais de uma operação de e/s pendente ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="b0c37-122">An event is needed only if there will be more than one outstanding I/O operation at the same time.</span></span> <span data-ttu-id="b0c37-123">Se um evento não for usado, cada operação de e/s concluída sinalizará o arquivo, o pipe nomeado ou o dispositivo de comunicação.</span><span class="sxs-lookup"><span data-stu-id="b0c37-123">If an event is not used, each completed I/O operation will signal the file, named pipe, or communications device.</span></span>

<span data-ttu-id="b0c37-124">Quando uma função é chamada para executar uma operação sobreposta, a operação pode ser concluída antes que a função retorne.</span><span class="sxs-lookup"><span data-stu-id="b0c37-124">When a function is called to perform an overlapped operation, the operation might be completed before the function returns.</span></span> <span data-ttu-id="b0c37-125">Quando isso acontece, os resultados são tratados como se a operação tivesse sido executada de forma síncrona.</span><span class="sxs-lookup"><span data-stu-id="b0c37-125">When this happens, the results are handled as if the operation had been performed synchronously.</span></span> <span data-ttu-id="b0c37-126">Se a operação não tiver sido concluída, no entanto, o valor de retorno da função será **false** e a função [**GetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror) retornará o **erro \_ e/s \_ pendente**.</span><span class="sxs-lookup"><span data-stu-id="b0c37-126">If the operation was not completed, however, the function's return value is **FALSE**, and the [**GetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror) function returns **ERROR\_IO\_PENDING**.</span></span>

<span data-ttu-id="b0c37-127">Um thread pode gerenciar operações sobrepostas de um dos dois métodos:</span><span class="sxs-lookup"><span data-stu-id="b0c37-127">A thread can manage overlapped operations by either of two methods:</span></span>

-   <span data-ttu-id="b0c37-128">Use a função [**GetOverlappedResult**](/windows/win32/api/ioapiset/nf-ioapiset-getoverlappedresult) ou [**GetOverlappedResultEx**](/windows/desktop/api/Ioapiset/nf-ioapiset-getoverlappedresultex) para aguardar a conclusão da operação sobreposta.</span><span class="sxs-lookup"><span data-stu-id="b0c37-128">Use the [**GetOverlappedResult**](/windows/win32/api/ioapiset/nf-ioapiset-getoverlappedresult) or [**GetOverlappedResultEx**](/windows/desktop/api/Ioapiset/nf-ioapiset-getoverlappedresultex) function to wait for the overlapped operation to be completed.</span></span> <span data-ttu-id="b0c37-129">Se **GetOverlappedResultEx** for usado, o thread de chamada poderá especificar um tempo limite para a operação sobreposta ou executar uma espera alertável.</span><span class="sxs-lookup"><span data-stu-id="b0c37-129">If **GetOverlappedResultEx** is used, the calling thread can specify a timeout for the overlapped operation or perform an alertable wait.</span></span>
-   <span data-ttu-id="b0c37-130">Especifique um identificador para o objeto de evento de redefinição manual da estrutura [**sobreposta**](/windows/win32/api/minwinbase/ns-minwinbase-overlapped) em uma das [funções de espera](wait-functions.md) e, depois, a função Wait retorna, chame [**GetOverlappedResult**](/windows/win32/api/ioapiset/nf-ioapiset-getoverlappedresult) ou [**GetOverlappedResultEx**](/windows/desktop/api/Ioapiset/nf-ioapiset-getoverlappedresultex).</span><span class="sxs-lookup"><span data-stu-id="b0c37-130">Specify a handle to the [**OVERLAPPED**](/windows/win32/api/minwinbase/ns-minwinbase-overlapped) structure's manual-reset event object in one of the [wait functions](wait-functions.md) and then, after the wait function returns, call [**GetOverlappedResult**](/windows/win32/api/ioapiset/nf-ioapiset-getoverlappedresult) or [**GetOverlappedResultEx**](/windows/desktop/api/Ioapiset/nf-ioapiset-getoverlappedresultex).</span></span> <span data-ttu-id="b0c37-131">A função retorna os resultados da operação sobreposta concluída e, para funções nas quais essas informações são apropriadas, ele relata o número real de bytes que foram transferidos.</span><span class="sxs-lookup"><span data-stu-id="b0c37-131">The function returns the results of the completed overlapped operation, and for functions in which such information is appropriate, it reports the actual number of bytes that were transferred.</span></span>

<span data-ttu-id="b0c37-132">Ao executar várias operações sobrepostas simultâneas em um único thread, o thread de chamada deve especificar uma estrutura [**sobreposta**](/windows/win32/api/minwinbase/ns-minwinbase-overlapped) para cada operação.</span><span class="sxs-lookup"><span data-stu-id="b0c37-132">When performing multiple simultaneous overlapped operations on a single thread, the calling thread must specify an [**OVERLAPPED**](/windows/win32/api/minwinbase/ns-minwinbase-overlapped) structure for each operation.</span></span> <span data-ttu-id="b0c37-133">Cada estrutura **sobreposta** deve especificar um identificador para um objeto de evento de redefinição manual diferente.</span><span class="sxs-lookup"><span data-stu-id="b0c37-133">Each **OVERLAPPED** structure must specify a handle to a different manual-reset event object.</span></span> <span data-ttu-id="b0c37-134">Para aguardar a conclusão de qualquer uma das operações sobrepostas, o thread especifica todos os identificadores de eventos de redefinição manual como critérios de espera em uma das [funções de espera](wait-functions.md)de vários objetos.</span><span class="sxs-lookup"><span data-stu-id="b0c37-134">To wait for any one of the overlapped operations to be completed, the thread specifies all the manual-reset event handles as wait criteria in one of the multiple-object [wait functions](wait-functions.md).</span></span> <span data-ttu-id="b0c37-135">O valor de retorno da função Wait de vários objetos indica qual objeto de evento de redefinição manual foi sinalizado, para que o thread possa determinar qual operação sobreposta causou a conclusão da operação de espera.</span><span class="sxs-lookup"><span data-stu-id="b0c37-135">The return value of the multiple-object wait function indicates which manual-reset event object was signaled, so the thread can determine which overlapped operation caused the wait operation to be completed.</span></span>

<span data-ttu-id="b0c37-136">É mais seguro usar um objeto de evento separado para cada operação sobreposta, em vez de especificar nenhum objeto de evento ou reutilizar o mesmo objeto de evento para várias operações.</span><span class="sxs-lookup"><span data-stu-id="b0c37-136">It is safer to use a separate event object for each overlapped operation, rather than specify no event object or reuse the same event object for multiple operations.</span></span> <span data-ttu-id="b0c37-137">Se nenhum objeto de evento for especificado na estrutura [**sobreposta**](/windows/win32/api/minwinbase/ns-minwinbase-overlapped) , o sistema sinalizará o estado do arquivo, o pipe nomeado ou o dispositivo de comunicação quando a operação sobreposta tiver sido concluída.</span><span class="sxs-lookup"><span data-stu-id="b0c37-137">If no event object is specified in the [**OVERLAPPED**](/windows/win32/api/minwinbase/ns-minwinbase-overlapped) structure, the system signals the state of the file, named pipe, or communications device when the overlapped operation has been completed.</span></span> <span data-ttu-id="b0c37-138">Assim, você pode especificar esses identificadores como objetos de sincronização em uma função de espera, embora seu uso para essa finalidade possa ser difícil de gerenciar porque, ao executar operações sobrepostas simultâneas no mesmo arquivo, pipe nomeado ou dispositivo de comunicação, não há como saber qual operação causou a sinalização do estado do objeto.</span><span class="sxs-lookup"><span data-stu-id="b0c37-138">Thus, you can specify these handles as synchronization objects in a wait function, though their use for this purpose can be difficult to manage because, when performing simultaneous overlapped operations on the same file, named pipe, or communications device, there is no way to know which operation caused the object's state to be signaled.</span></span>

<span data-ttu-id="b0c37-139">Um thread não deve reutilizar um evento com a suposição de que o evento será sinalizado somente pela operação sobreposta do thread.</span><span class="sxs-lookup"><span data-stu-id="b0c37-139">A thread should not reuse an event with the assumption that the event will be signaled only by that thread's overlapped operation.</span></span> <span data-ttu-id="b0c37-140">Um evento é sinalizado no mesmo thread que a operação sobreposta que está sendo concluída.</span><span class="sxs-lookup"><span data-stu-id="b0c37-140">An event is signaled on the same thread as the overlapped operation that is completing.</span></span> <span data-ttu-id="b0c37-141">Usar o mesmo evento em vários threads pode levar a uma condição de corrida na qual o evento é sinalizado corretamente para o thread cuja operação é concluída primeiro e prematuramente para outros threads que usam esse evento.</span><span class="sxs-lookup"><span data-stu-id="b0c37-141">Using the same event on multiple threads can lead to a race condition in which the event is signaled correctly for the thread whose operation completes first and prematurely for other threads using that event.</span></span> <span data-ttu-id="b0c37-142">Em seguida, quando a próxima operação sobreposta for concluída, o evento será sinalizado novamente para todos os threads que usam esse evento e assim por diante até que todas as operações sobrepostas sejam concluídas.</span><span class="sxs-lookup"><span data-stu-id="b0c37-142">Then, when the next overlapped operation completes, the event is signaled again for all threads using that event, and so on until all overlapped operations are complete.</span></span>

<span data-ttu-id="b0c37-143">Para obter exemplos que ilustram o uso de operações sobrepostas, rotinas de conclusão e a função [**GetOverlappedResult**](/windows/win32/api/ioapiset/nf-ioapiset-getoverlappedresult) , consulte [usando pipes](../ipc/using-pipes.md).</span><span class="sxs-lookup"><span data-stu-id="b0c37-143">For examples that illustrate the use of overlapped operations, completion routines, and the [**GetOverlappedResult**](/windows/win32/api/ioapiset/nf-ioapiset-getoverlappedresult) function, see [Using Pipes](../ipc/using-pipes.md).</span></span>

<span data-ttu-id="b0c37-144">\* \* Windows Vista, Windows Server 2003 e Windows XP: \* \*</span><span class="sxs-lookup"><span data-stu-id="b0c37-144">\*\*Windows Vista, Windows Server 2003 and Windows XP:  \*\*</span></span>

<span data-ttu-id="b0c37-145">Tenha cuidado ao reutilizar estruturas [**sobrepostas**](/windows/win32/api/minwinbase/ns-minwinbase-overlapped) .</span><span class="sxs-lookup"><span data-stu-id="b0c37-145">Be careful when reusing [**OVERLAPPED**](/windows/win32/api/minwinbase/ns-minwinbase-overlapped) structures.</span></span> <span data-ttu-id="b0c37-146">Se as estruturas **sobrepostas** forem reutilizadas em vários threads e [**GetOverlappedResult**](/windows/win32/api/ioapiset/nf-ioapiset-getoverlappedresult) for chamado com o parâmetro *bWait* definido como **true**, o thread de chamada deverá garantir que o evento associado seja sinalizado antes de reutilizar a estrutura.</span><span class="sxs-lookup"><span data-stu-id="b0c37-146">If **OVERLAPPED** structures are reused on multiple threads and [**GetOverlappedResult**](/windows/win32/api/ioapiset/nf-ioapiset-getoverlappedresult) is called with the *bWait* parameter set to **TRUE**, the calling thread must ensure that the associated event is signaled before reusing the structure.</span></span> <span data-ttu-id="b0c37-147">Isso pode ser feito usando a função [**WaitForSingleObject**](/windows/win32/api/winbase/nf-winbase-registerwaitforsingleobject) depois de chamar **GetOverlappedResult** para forçar o thread a aguardar até que a operação seja concluída.</span><span class="sxs-lookup"><span data-stu-id="b0c37-147">This can be accomplished by using the [**WaitForSingleObject**](/windows/win32/api/winbase/nf-winbase-registerwaitforsingleobject) function after calling **GetOverlappedResult** to force the thread to wait until the operation completes.</span></span> <span data-ttu-id="b0c37-148">Observe que o objeto de evento deve ser um objeto de evento de redefinição manual.</span><span class="sxs-lookup"><span data-stu-id="b0c37-148">Note that the event object must be a manual-reset event object.</span></span> <span data-ttu-id="b0c37-149">Se um objeto de evento AutoReset for usado, chamar **GetOverlappedResult** com o parâmetro *BWait* definido como **true** fará com que a função seja bloqueada indefinidamente.</span><span class="sxs-lookup"><span data-stu-id="b0c37-149">If an autoreset event object is used, calling **GetOverlappedResult** with the *bWait* parameter set to **TRUE** causes the function to be blocked indefinitely.</span></span> <span data-ttu-id="b0c37-150">Esse comportamento mudou a partir do Windows 7 e do Windows Server 2008 R2 para aplicativos que especificam o Windows 7 como o sistema operacional com suporte no manifesto do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b0c37-150">This behavior changed starting with Windows 7 and Windows Server 2008 R2 for applications that specify Windows 7 as the supported operating system in the application manifest.</span></span> <span data-ttu-id="b0c37-151">Para obter mais informações, consulte [manifestos do aplicativo](/previous-versions/windows/desktop/adrms_sdk/application-manifests).</span><span class="sxs-lookup"><span data-stu-id="b0c37-151">For more information see [Application Manifests](/previous-versions/windows/desktop/adrms_sdk/application-manifests).</span></span>

## <a name="related-topics"></a><span data-ttu-id="b0c37-152">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="b0c37-152">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="b0c37-153">Conceitos de e/s</span><span class="sxs-lookup"><span data-stu-id="b0c37-153">I/O Concepts</span></span>](../fileio/i-o-concepts.md)
</dt> </dl>

 

 
