---
description: Um objeto de seção crítica fornece sincronização semelhante à fornecida por um objeto mutex, exceto que uma seção crítica pode ser usada somente pelos threads de um único processo.
ms.assetid: 2ec11a42-3d12-4d60-9dd7-dc38926d56e1
title: Objetos de seção crítica
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cbcada1f2ddbc6d370445f36a3dbd51c5c9f54bf
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "105751062"
---
# <a name="critical-section-objects"></a><span data-ttu-id="3777a-103">Objetos de seção crítica</span><span class="sxs-lookup"><span data-stu-id="3777a-103">Critical Section Objects</span></span>

<span data-ttu-id="3777a-104">Um *objeto de seção crítica* fornece sincronização semelhante à fornecida por um objeto mutex, exceto que uma seção crítica pode ser usada somente pelos threads de um único processo.</span><span class="sxs-lookup"><span data-stu-id="3777a-104">A *critical section object* provides synchronization similar to that provided by a mutex object, except that a critical section can be used only by the threads of a single process.</span></span> <span data-ttu-id="3777a-105">Os objetos de seção crítica não podem ser compartilhados entre processos.</span><span class="sxs-lookup"><span data-stu-id="3777a-105">Critical section objects cannot be shared across processes.</span></span>

<span data-ttu-id="3777a-106">Objetos de evento, mutex e Semaphore também podem ser usados em um aplicativo de processo único, mas os objetos de seção crítica fornecem um mecanismo um pouco mais rápido e eficiente para sincronização de exclusão mútua (um teste específico do processador e uma instrução SET).</span><span class="sxs-lookup"><span data-stu-id="3777a-106">Event, mutex, and semaphore objects can also be used in a single-process application, but critical section objects provide a slightly faster, more efficient mechanism for mutual-exclusion synchronization (a processor-specific test and set instruction).</span></span> <span data-ttu-id="3777a-107">Como um objeto mutex, um objeto section crítico pode pertencer a apenas um thread por vez, o que o torna útil para proteger um recurso compartilhado do acesso simultâneo.</span><span class="sxs-lookup"><span data-stu-id="3777a-107">Like a mutex object, a critical section object can be owned by only one thread at a time, which makes it useful for protecting a shared resource from simultaneous access.</span></span> <span data-ttu-id="3777a-108">Ao contrário de um objeto mutex, não há como dizer se uma seção crítica foi abandonada.</span><span class="sxs-lookup"><span data-stu-id="3777a-108">Unlike a mutex object, there is no way to tell whether a critical section has been abandoned.</span></span>

<span data-ttu-id="3777a-109">A partir do Windows Server 2003 com Service Pack 1 (SP1), os threads que esperam em uma seção crítica não adquirem a seção crítica de acordo com uma primeira e mais servem.</span><span class="sxs-lookup"><span data-stu-id="3777a-109">Starting with Windows Server 2003 with Service Pack 1 (SP1), threads waiting on a critical section do not acquire the critical section on a first-come, first-serve basis.</span></span> <span data-ttu-id="3777a-110">Essa alteração aumenta significativamente o desempenho para a maioria dos códigos.</span><span class="sxs-lookup"><span data-stu-id="3777a-110">This change increases performance significantly for most code.</span></span> <span data-ttu-id="3777a-111">No entanto, alguns aplicativos dependem da ordenação PEPS (primeiro a entrar, primeiro a sair) e podem funcionar de forma ruim ou não em versões atuais do Windows (por exemplo, aplicativos que usam seções críticas como um limitador de taxa).</span><span class="sxs-lookup"><span data-stu-id="3777a-111">However, some applications depend on first-in, first-out (FIFO) ordering and may perform poorly or not at all on current versions of Windows (for example, applications that have been using critical sections as a rate-limiter).</span></span> <span data-ttu-id="3777a-112">Para garantir que o código continue a funcionar corretamente, talvez seja necessário adicionar um nível adicional de sincronização.</span><span class="sxs-lookup"><span data-stu-id="3777a-112">To ensure that your code continues to work correctly, you may need to add an additional level of synchronization.</span></span> <span data-ttu-id="3777a-113">Por exemplo, suponha que você tenha um thread de produtor e um thread de consumidor que estão usando um objeto de seção crítica para sincronizar seu trabalho.</span><span class="sxs-lookup"><span data-stu-id="3777a-113">For example, suppose you have a producer thread and a consumer thread that are using a critical section object to synchronize their work.</span></span> <span data-ttu-id="3777a-114">Crie dois objetos de evento, um para cada thread a ser usado para sinalizar que ele está pronto para o outro thread continuar.</span><span class="sxs-lookup"><span data-stu-id="3777a-114">Create two event objects, one for each thread to use to signal that it is ready for the other thread to proceed.</span></span> <span data-ttu-id="3777a-115">O thread do consumidor aguardará que o produtor sinalize seu evento antes de entrar na seção crítica, e o thread do produtor aguardará o thread do consumidor para sinalizar seu evento antes de entrar na seção crítica.</span><span class="sxs-lookup"><span data-stu-id="3777a-115">The consumer thread will wait for the producer to signal its event before entering the critical section, and the producer thread will wait for the consumer thread to signal its event before entering the critical section.</span></span> <span data-ttu-id="3777a-116">Depois que cada thread deixa a seção crítica, ele sinaliza seu evento para liberar o outro thread.</span><span class="sxs-lookup"><span data-stu-id="3777a-116">After each thread leaves the critical section, it signals its event to release the other thread.</span></span>

<span data-ttu-id="3777a-117">**Windows Server 2003 e Windows XP:** Os threads que estão esperando em uma seção crítica são adicionados a uma fila de espera; Eles são ativados e geralmente adquirem a seção crítica na ordem em que foram adicionados à fila.</span><span class="sxs-lookup"><span data-stu-id="3777a-117">**Windows Server 2003 and Windows XP:** Threads that are waiting on a critical section are added to a wait queue; they are woken and generally acquire the critical section in the order in which they were added to the queue.</span></span> <span data-ttu-id="3777a-118">No entanto, se os threads forem adicionados a essa fila a uma taxa rápida o suficiente, o desempenho poderá ser degradado devido ao tempo necessário para despertar cada thread em espera.</span><span class="sxs-lookup"><span data-stu-id="3777a-118">However, if threads are added to this queue at a fast enough rate, performance can be degraded because of the time it takes to awaken each waiting thread.</span></span>

<span data-ttu-id="3777a-119">O processo é responsável por alocar a memória usada por uma seção crítica.</span><span class="sxs-lookup"><span data-stu-id="3777a-119">The process is responsible for allocating the memory used by a critical section.</span></span> <span data-ttu-id="3777a-120">Normalmente, isso é feito simplesmente declarando uma variável do **tipo \_ seção crítica**.</span><span class="sxs-lookup"><span data-stu-id="3777a-120">Typically, this is done by simply declaring a variable of type **CRITICAL\_SECTION**.</span></span> <span data-ttu-id="3777a-121">Antes que os threads do processo possam usá-lo, inicialize a seção crítica usando a função [**InitializeCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-initializecriticalsection) ou [**InitializeCriticalSectionAndSpinCount**](/windows/win32/api/synchapi/nf-synchapi-initializecriticalsectionandspincount) .</span><span class="sxs-lookup"><span data-stu-id="3777a-121">Before the threads of the process can use it, initialize the critical section by using the [**InitializeCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-initializecriticalsection) or [**InitializeCriticalSectionAndSpinCount**](/windows/win32/api/synchapi/nf-synchapi-initializecriticalsectionandspincount) function.</span></span>

<span data-ttu-id="3777a-122">Um thread usa a função [**EnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-entercriticalsection) ou [**TryEnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-tryentercriticalsection) para solicitar a propriedade de uma seção crítica.</span><span class="sxs-lookup"><span data-stu-id="3777a-122">A thread uses the [**EnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-entercriticalsection) or [**TryEnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-tryentercriticalsection) function to request ownership of a critical section.</span></span> <span data-ttu-id="3777a-123">Ele usa a função [**LeaveCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-leavecriticalsection) para liberar a propriedade de uma seção crítica.</span><span class="sxs-lookup"><span data-stu-id="3777a-123">It uses the [**LeaveCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-leavecriticalsection) function to release ownership of a critical section.</span></span> <span data-ttu-id="3777a-124">Se o objeto de seção crítica estiver pertencente a outro thread, o **EnterCriticalSection** aguardará indefinidamente a propriedade.</span><span class="sxs-lookup"><span data-stu-id="3777a-124">If the critical section object is currently owned by another thread, **EnterCriticalSection** waits indefinitely for ownership.</span></span> <span data-ttu-id="3777a-125">Por outro lado, quando um objeto mutex é usado para exclusão mútua, as [funções Wait](wait-functions.md) aceitam um intervalo de tempo limite especificado.</span><span class="sxs-lookup"><span data-stu-id="3777a-125">In contrast, when a mutex object is used for mutual exclusion, the [wait functions](wait-functions.md) accept a specified time-out interval.</span></span> <span data-ttu-id="3777a-126">A função **TryEnterCriticalSection** tenta inserir uma seção crítica sem bloquear o thread de chamada.</span><span class="sxs-lookup"><span data-stu-id="3777a-126">The **TryEnterCriticalSection** function attempts to enter a critical section without blocking the calling thread.</span></span>

<span data-ttu-id="3777a-127">Quando um thread possui uma seção crítica, ele pode fazer chamadas adicionais para [**EnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-entercriticalsection) ou [**TryEnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-tryentercriticalsection) sem bloquear sua execução.</span><span class="sxs-lookup"><span data-stu-id="3777a-127">When a thread owns a critical section, it can make additional calls to [**EnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-entercriticalsection) or [**TryEnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-tryentercriticalsection) without blocking its execution.</span></span> <span data-ttu-id="3777a-128">Isso impede que um thread seja bloqueado enquanto aguarda uma seção crítica que ele já possui.</span><span class="sxs-lookup"><span data-stu-id="3777a-128">This prevents a thread from deadlocking itself while waiting for a critical section that it already owns.</span></span> <span data-ttu-id="3777a-129">Para liberar sua propriedade, o thread deve chamar [**LeaveCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-leavecriticalsection) uma vez para cada vez que ele inseriu a seção crítica.</span><span class="sxs-lookup"><span data-stu-id="3777a-129">To release its ownership, the thread must call [**LeaveCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-leavecriticalsection) one time for each time that it entered the critical section.</span></span> <span data-ttu-id="3777a-130">Não há nenhuma garantia sobre a ordem na qual os threads em espera adquirirão a propriedade da seção crítica.</span><span class="sxs-lookup"><span data-stu-id="3777a-130">There is no guarantee about the order in which waiting threads will acquire ownership of the critical section.</span></span>

<span data-ttu-id="3777a-131">Um thread usa a função [**InitializeCriticalSectionAndSpinCount**](/windows/win32/api/synchapi/nf-synchapi-initializecriticalsectionandspincount) ou [**SetCriticalSectionSpinCount**](/windows/win32/api/synchapi/nf-synchapi-setcriticalsectionspincount) para especificar uma contagem de rotação para o objeto de seção crítica.</span><span class="sxs-lookup"><span data-stu-id="3777a-131">A thread uses the [**InitializeCriticalSectionAndSpinCount**](/windows/win32/api/synchapi/nf-synchapi-initializecriticalsectionandspincount) or [**SetCriticalSectionSpinCount**](/windows/win32/api/synchapi/nf-synchapi-setcriticalsectionspincount) function to specify a spin count for the critical section object.</span></span> <span data-ttu-id="3777a-132">A rotação significa que, quando um thread tenta adquirir uma seção crítica bloqueada, o thread entra em um loop, verifica se o bloqueio foi liberado e, se o bloqueio não for liberado, o thread vai para o modo de suspensão.</span><span class="sxs-lookup"><span data-stu-id="3777a-132">Spinning means that when a thread tries to acquire a critical section that is locked, the thread enters a loop, checks to see if the lock is released, and if the lock is not released, the thread goes to sleep.</span></span> <span data-ttu-id="3777a-133">Em sistemas de processador único, a contagem de rotação é ignorada e a contagem de rotação de seção crítica é definida como 0 (zero).</span><span class="sxs-lookup"><span data-stu-id="3777a-133">On single-processor systems, the spin count is ignored and the critical section spin count is set to 0 (zero).</span></span> <span data-ttu-id="3777a-134">Em sistemas multiprocessadores, se a seção crítica não estiver disponível, o thread de chamada girará *dwSpinCount* vezes antes de executar uma operação de espera em um semáforo associado à seção crítica.</span><span class="sxs-lookup"><span data-stu-id="3777a-134">On multiprocessor systems, if the critical section is unavailable, the calling thread spins *dwSpinCount* times before performing a wait operation on a semaphore that is associated with the critical section.</span></span> <span data-ttu-id="3777a-135">Se a seção crítica for liberada durante a operação de rotação, o thread de chamada evitará a operação de espera.</span><span class="sxs-lookup"><span data-stu-id="3777a-135">If the critical section becomes free during the spin operation, the calling thread avoids the wait operation.</span></span>

<span data-ttu-id="3777a-136">Qualquer thread do processo pode usar a função [**DeleteCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-deletecriticalsection) para liberar os recursos do sistema que são alocados quando o objeto da seção crítica é inicializado.</span><span class="sxs-lookup"><span data-stu-id="3777a-136">Any thread of the process can use the [**DeleteCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-deletecriticalsection) function to release the system resources that are allocated when the critical section object is initialized.</span></span> <span data-ttu-id="3777a-137">Depois que essa função é chamada, o objeto de seção crítica não pode ser usado para sincronização.</span><span class="sxs-lookup"><span data-stu-id="3777a-137">After this function is called, the critical section object cannot be used for synchronization.</span></span>

<span data-ttu-id="3777a-138">Quando um objeto de seção crítica é de propriedade, os únicos outros threads afetados são os threads que estão aguardando a propriedade em uma chamada para [**EnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-entercriticalsection).</span><span class="sxs-lookup"><span data-stu-id="3777a-138">When a critical section object is owned, the only other threads affected are the threads that are waiting for ownership in a call to [**EnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-entercriticalsection).</span></span> <span data-ttu-id="3777a-139">Os threads que não estão aguardando são livres para continuar em execução.</span><span class="sxs-lookup"><span data-stu-id="3777a-139">Threads that are not waiting are free to continue running.</span></span>

## <a name="related-topics"></a><span data-ttu-id="3777a-140">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="3777a-140">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="3777a-141">Objetos mutex</span><span class="sxs-lookup"><span data-stu-id="3777a-141">Mutex Objects</span></span>](mutex-objects.md)
</dt> <dt>

[<span data-ttu-id="3777a-142">Usando objetos de seção crítica</span><span class="sxs-lookup"><span data-stu-id="3777a-142">Using Critical Section Objects</span></span>](using-critical-section-objects.md)
</dt> </dl>

 

 
