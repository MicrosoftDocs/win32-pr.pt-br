---
description: Um objeto Semaphore é um objeto de sincronização que mantém uma contagem entre zero e um valor máximo especificado.
ms.assetid: d9da1d98-a306-4e2d-a149-1eef6a724751
title: Objetos de semáforo
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a77f36313d76c5d98c786a76f10ad8439965f180
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "105753698"
---
# <a name="semaphore-objects"></a><span data-ttu-id="ed773-103">Objetos de semáforo</span><span class="sxs-lookup"><span data-stu-id="ed773-103">Semaphore Objects</span></span>

<span data-ttu-id="ed773-104">Um *objeto Semaphore* é um objeto de sincronização que mantém uma contagem entre zero e um valor máximo especificado.</span><span class="sxs-lookup"><span data-stu-id="ed773-104">A *semaphore object* is a synchronization object that maintains a count between zero and a specified maximum value.</span></span> <span data-ttu-id="ed773-105">A contagem é decrementada toda vez que um thread conclui uma espera para o objeto Semaphore e é incrementado sempre que um thread libera o semáforo.</span><span class="sxs-lookup"><span data-stu-id="ed773-105">The count is decremented each time a thread completes a wait for the semaphore object and incremented each time a thread releases the semaphore.</span></span> <span data-ttu-id="ed773-106">Quando a contagem chega a zero, nenhum thread pode aguardar com êxito que o estado do objeto de semáforo se torne sinalizado.</span><span class="sxs-lookup"><span data-stu-id="ed773-106">When the count reaches zero, no more threads can successfully wait for the semaphore object state to become signaled.</span></span> <span data-ttu-id="ed773-107">O estado de um semáforo é definido como sinalizado quando a contagem é maior que zero e não sinalizado quando a contagem é zero.</span><span class="sxs-lookup"><span data-stu-id="ed773-107">The state of a semaphore is set to signaled when its count is greater than zero, and nonsignaled when its count is zero.</span></span>

<span data-ttu-id="ed773-108">O objeto Semaphore é útil para controlar um recurso compartilhado que pode dar suporte a um número limitado de usuários.</span><span class="sxs-lookup"><span data-stu-id="ed773-108">The semaphore object is useful in controlling a shared resource that can support a limited number of users.</span></span> <span data-ttu-id="ed773-109">Ele atua como uma porta que limita o número de threads que compartilham o recurso para um número máximo especificado.</span><span class="sxs-lookup"><span data-stu-id="ed773-109">It acts as a gate that limits the number of threads sharing the resource to a specified maximum number.</span></span> <span data-ttu-id="ed773-110">Por exemplo, um aplicativo pode inserir um limite no número de janelas que ele cria.</span><span class="sxs-lookup"><span data-stu-id="ed773-110">For example, an application might place a limit on the number of windows that it creates.</span></span> <span data-ttu-id="ed773-111">Ele usa um semáforo com uma contagem máxima igual ao limite da janela, diminuindo a contagem sempre que uma janela é criada e incrementando-a sempre que uma janela é fechada.</span><span class="sxs-lookup"><span data-stu-id="ed773-111">It uses a semaphore with a maximum count equal to the window limit, decrementing the count whenever a window is created and incrementing it whenever a window is closed.</span></span> <span data-ttu-id="ed773-112">O aplicativo especifica o objeto de semáforo em chamada a uma das [funções de espera](wait-functions.md) antes de cada janela ser criada.</span><span class="sxs-lookup"><span data-stu-id="ed773-112">The application specifies the semaphore object in call to one of the [wait functions](wait-functions.md) before each window is created.</span></span> <span data-ttu-id="ed773-113">Quando a contagem é zero — indicando que o limite da janela foi atingido — a função Wait bloqueia a execução do código de criação de janela.</span><span class="sxs-lookup"><span data-stu-id="ed773-113">When the count is zero—indicating that the window limit has been reached—the wait function blocks execution of the window-creation code.</span></span>

<span data-ttu-id="ed773-114">Um thread usa a função [**CreateSemaphore**](/windows/desktop/api/WinBase/nf-winbase-createsemaphorea) ou [**CreateSemaphoreEx**](/windows/desktop/api/WinBase/nf-winbase-createsemaphoreexa) para criar um objeto Semaphore.</span><span class="sxs-lookup"><span data-stu-id="ed773-114">A thread uses the [**CreateSemaphore**](/windows/desktop/api/WinBase/nf-winbase-createsemaphorea) or [**CreateSemaphoreEx**](/windows/desktop/api/WinBase/nf-winbase-createsemaphoreexa) function to create a semaphore object.</span></span> <span data-ttu-id="ed773-115">O thread de criação especifica a contagem inicial e o valor máximo da contagem para o objeto.</span><span class="sxs-lookup"><span data-stu-id="ed773-115">The creating thread specifies the initial count and the maximum value of the count for the object.</span></span> <span data-ttu-id="ed773-116">A contagem inicial não deve ser menor que zero nem maior que o valor máximo.</span><span class="sxs-lookup"><span data-stu-id="ed773-116">The initial count must be neither less than zero nor greater than the maximum value.</span></span> <span data-ttu-id="ed773-117">O thread de criação também pode especificar um nome para o objeto Semaphore.</span><span class="sxs-lookup"><span data-stu-id="ed773-117">The creating thread can also specify a name for the semaphore object.</span></span> <span data-ttu-id="ed773-118">Os threads em outros processos podem abrir um identificador para um objeto de semáforo existente especificando seu nome em uma chamada para a função [**OpenSemaphore**](/windows/win32/api/synchapi/nf-synchapi-opensemaphorew) .</span><span class="sxs-lookup"><span data-stu-id="ed773-118">Threads in other processes can open a handle to an existing semaphore object by specifying its name in a call to the [**OpenSemaphore**](/windows/win32/api/synchapi/nf-synchapi-opensemaphorew) function.</span></span> <span data-ttu-id="ed773-119">Para obter informações adicionais sobre nomes de mutex, evento, semáforo e objetos de temporizador, consulte [sincronização entre processos](interprocess-synchronization.md).</span><span class="sxs-lookup"><span data-stu-id="ed773-119">For additional information about names for mutex, event, semaphore, and timer objects, see [Interprocess Synchronization](interprocess-synchronization.md).</span></span>

<span data-ttu-id="ed773-120">Se mais de um thread estiver aguardando um semáforo, um thread em espera será selecionado.</span><span class="sxs-lookup"><span data-stu-id="ed773-120">If more than one thread is waiting on a semaphore, a waiting thread is selected.</span></span> <span data-ttu-id="ed773-121">Não assuma uma ordem FIFO (primeiro a entrar, primeiro a sair).</span><span class="sxs-lookup"><span data-stu-id="ed773-121">Do not assume a first-in, first-out (FIFO) order.</span></span> <span data-ttu-id="ed773-122">Eventos externos, como APCs de modo kernel, podem alterar a ordem de espera.</span><span class="sxs-lookup"><span data-stu-id="ed773-122">External events such as kernel-mode APCs can change the wait order.</span></span>

<span data-ttu-id="ed773-123">Cada vez que uma das [funções de espera](wait-functions.md) retorna porque o estado de um semáforo foi definido como signaled, a contagem do semáforo é diminuída em um.</span><span class="sxs-lookup"><span data-stu-id="ed773-123">Each time one of the [wait functions](wait-functions.md) returns because the state of a semaphore was set to signaled, the count of the semaphore is decreased by one.</span></span> <span data-ttu-id="ed773-124">A função [**ReleaseSemaphore**](/windows/win32/api/synchapi/nf-synchapi-releasesemaphore) aumenta a contagem de um semáforo por um valor especificado.</span><span class="sxs-lookup"><span data-stu-id="ed773-124">The [**ReleaseSemaphore**](/windows/win32/api/synchapi/nf-synchapi-releasesemaphore) function increases a semaphore's count by a specified amount.</span></span> <span data-ttu-id="ed773-125">A contagem nunca pode ser menor que zero ou maior que o valor máximo.</span><span class="sxs-lookup"><span data-stu-id="ed773-125">The count can never be less than zero or greater than the maximum value.</span></span>

<span data-ttu-id="ed773-126">A contagem inicial de um semáforo normalmente é definida como o valor máximo.</span><span class="sxs-lookup"><span data-stu-id="ed773-126">The initial count of a semaphore is typically set to the maximum value.</span></span> <span data-ttu-id="ed773-127">A contagem é então diminuída a partir desse nível, pois o recurso protegido é consumido.</span><span class="sxs-lookup"><span data-stu-id="ed773-127">The count is then decremented from that level as the protected resource is consumed.</span></span> <span data-ttu-id="ed773-128">Como alternativa, você pode criar um semáforo com uma contagem inicial de zero para bloquear o acesso ao recurso protegido enquanto o aplicativo está sendo inicializado.</span><span class="sxs-lookup"><span data-stu-id="ed773-128">Alternatively, you can create a semaphore with an initial count of zero to block access to the protected resource while the application is being initialized.</span></span> <span data-ttu-id="ed773-129">Após a inicialização, você pode usar [**ReleaseSemaphore**](/windows/win32/api/synchapi/nf-synchapi-releasesemaphore) para incrementar a contagem para o valor máximo.</span><span class="sxs-lookup"><span data-stu-id="ed773-129">After initialization, you can use [**ReleaseSemaphore**](/windows/win32/api/synchapi/nf-synchapi-releasesemaphore) to increment the count to the maximum value.</span></span>

<span data-ttu-id="ed773-130">Um thread que possui um objeto mutex pode aguardar repetidamente que o mesmo objeto mutex seja sinalizado sem que sua execução se torne bloqueada.</span><span class="sxs-lookup"><span data-stu-id="ed773-130">A thread that owns a mutex object can wait repeatedly for the same mutex object to become signaled without its execution becoming blocked.</span></span> <span data-ttu-id="ed773-131">Um thread que aguarda repetidamente o mesmo objeto Semaphore, no entanto, decrementa a contagem do semáforo toda vez que uma operação de espera é concluída; o thread é bloqueado quando a contagem chega a zero.</span><span class="sxs-lookup"><span data-stu-id="ed773-131">A thread that waits repeatedly for the same semaphore object, however, decrements the semaphore's count each time a wait operation is completed; the thread is blocked when the count gets to zero.</span></span> <span data-ttu-id="ed773-132">Da mesma forma, somente o thread que possui um mutex pode chamar com êxito a função [**ReleaseMutex**](/windows/win32/api/synchapi/nf-synchapi-releasemutex) , embora qualquer thread possa usar [**ReleaseSemaphore**](/windows/win32/api/synchapi/nf-synchapi-releasesemaphore) para aumentar a contagem de um objeto Semaphore.</span><span class="sxs-lookup"><span data-stu-id="ed773-132">Similarly, only the thread that owns a mutex can successfully call the [**ReleaseMutex**](/windows/win32/api/synchapi/nf-synchapi-releasemutex) function, though any thread can use [**ReleaseSemaphore**](/windows/win32/api/synchapi/nf-synchapi-releasesemaphore) to increase the count of a semaphore object.</span></span>

<span data-ttu-id="ed773-133">Um thread pode decrementar a contagem de um semáforo mais de uma vez especificando repetidamente o mesmo objeto Semaphore em chamadas para qualquer uma das [funções Wait](wait-functions.md).</span><span class="sxs-lookup"><span data-stu-id="ed773-133">A thread can decrement a semaphore's count more than once by repeatedly specifying the same semaphore object in calls to any of the [wait functions](wait-functions.md).</span></span> <span data-ttu-id="ed773-134">No entanto, chamar uma das funções de espera de vários objetos com uma matriz que contém vários identificadores do mesmo semáforo não resulta em vários decrementos.</span><span class="sxs-lookup"><span data-stu-id="ed773-134">However, calling one of the multiple-object wait functions with an array that contains multiple handles of the same semaphore does not result in multiple decrements.</span></span>

<span data-ttu-id="ed773-135">Quando terminar de usar o objeto Semaphore, chame a função [**CloseHandle**](/windows/win32/api/handleapi/nf-handleapi-closehandle) para fechar o identificador.</span><span class="sxs-lookup"><span data-stu-id="ed773-135">When you have finished using the semaphore object, call the [**CloseHandle**](/windows/win32/api/handleapi/nf-handleapi-closehandle) function to close the handle.</span></span> <span data-ttu-id="ed773-136">O objeto Semaphore é destruído quando seu último identificador é fechado.</span><span class="sxs-lookup"><span data-stu-id="ed773-136">The semaphore object is destroyed when its last handle has been closed.</span></span> <span data-ttu-id="ed773-137">O fechamento do identificador não afeta a contagem de semáforos; Portanto, certifique-se de chamar [**ReleaseSemaphore**](/windows/win32/api/synchapi/nf-synchapi-releasesemaphore) antes de fechar o identificador ou antes de o processo ser encerrado.</span><span class="sxs-lookup"><span data-stu-id="ed773-137">Closing the handle does not affect the semaphore count; therefore, be sure to call [**ReleaseSemaphore**](/windows/win32/api/synchapi/nf-synchapi-releasesemaphore) before closing the handle or before the process terminates.</span></span> <span data-ttu-id="ed773-138">Caso contrário, as operações de espera pendentes atingirão o tempo limite ou continuarão indefinidamente, dependendo se um valor de tempo limite foi especificado.</span><span class="sxs-lookup"><span data-stu-id="ed773-138">Otherwise, pending wait operations will either time out or continue indefinitely, depending on whether a time-out value has been specified.</span></span>

## <a name="related-topics"></a><span data-ttu-id="ed773-139">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="ed773-139">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="ed773-140">Usando objetos Semaphore</span><span class="sxs-lookup"><span data-stu-id="ed773-140">Using Semaphore Objects</span></span>](using-semaphore-objects.md)
</dt> </dl>

 

 
