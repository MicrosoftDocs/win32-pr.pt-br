---
title: Negociação de formato de vídeo no plug-in de DSP de vídeo de exemplo
description: Negociação de formato de vídeo no plug-in de DSP de vídeo de exemplo
ms.assetid: 3e92ce10-2b9b-4689-a181-f56c33472fea
keywords:
- Plug-ins do Windows Media Player, DSP de vídeo
- plug-ins, DSP de vídeo
- plug-ins de processamento de sinal digital, negociação de formato de vídeo
- Plug-ins do DSP, negociação de formato de vídeo
- plug-ins de DSP de vídeo, negociação de formato
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c287a38fbfcf11f1b9d74087a91c5825b22f1243
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/16/2019
ms.locfileid: "104292251"
---
# <a name="video-format-negotiation-in-the-sample-video-dsp-plug-in"></a><span data-ttu-id="2ae72-108">Negociação de formato de vídeo no plug-in de DSP de vídeo de exemplo</span><span class="sxs-lookup"><span data-stu-id="2ae72-108">Video Format Negotiation in the Sample Video DSP Plug-in</span></span>

<span data-ttu-id="2ae72-109">Antes de o Windows Media Player inserir um plug-in de DSP de vídeo na cadeia de sinais, o Player deve determinar se o plug-in pode processar o vídeo que está sendo reproduzido.</span><span class="sxs-lookup"><span data-stu-id="2ae72-109">Before Windows Media Player inserts a video DSP plug-in into the signal chain, the Player must determine whether the plug-in can process the video being played.</span></span> <span data-ttu-id="2ae72-110">O processo pelo qual o plug-in e o Player se comunicam sobre formatos de vídeo com suporte é chamado de negociação de formato.</span><span class="sxs-lookup"><span data-stu-id="2ae72-110">The process by which the plug-in and the Player communicate about supported video formats is called format negotiation.</span></span>

## <a name="providing-the-supported-input-and-output-types"></a><span data-ttu-id="2ae72-111">Fornecendo os tipos de entrada e saída com suporte</span><span class="sxs-lookup"><span data-stu-id="2ae72-111">Providing the Supported Input and Output Types</span></span>

<span data-ttu-id="2ae72-112">Se o plug-in do DSP estiver agindo como um DMO (objeto de mídia do DirectX), o Player consultará o plug-in sobre seus formatos com suporte fazendo uma sequência de chamadas para **IMediaObject:: GetInputType** e **IMediaObject:: GetOutputType**.</span><span class="sxs-lookup"><span data-stu-id="2ae72-112">If the DSP plug-in is acting as a DirectX Media Object (DMO), the Player queries the plug-in about its supported formats by making a sequence of calls to **IMediaObject::GetInputType** and **IMediaObject::GetOutputType**.</span></span>

<span data-ttu-id="2ae72-113">Se o plug-in do DSP estiver agindo como uma Media Foundation transformação (MFT), o Player consultará o plug-in sobre seus formatos com suporte fazendo uma sequência de chamadas para **IMFTransform:: GetInputAvailableType** e **IMFTransform:: GetOutputAvailableType**.</span><span class="sxs-lookup"><span data-stu-id="2ae72-113">If the DSP plug-in is acting as a Media Foundation Transform (MFT), the Player queries the plug-in about its supported formats by making a sequence of calls to **IMFTransform::GetInputAvailableType** and **IMFTransform::GetOutputAvailableType**.</span></span>

<span data-ttu-id="2ae72-114">O plug-in de vídeo de exemplo gerado pelo assistente de plug-in do Windows Media Player armazena a lista de formatos de vídeo com suporte como uma matriz de GUIDs.</span><span class="sxs-lookup"><span data-stu-id="2ae72-114">The sample video plug-in generated by the Windows Media Player Plug-in Wizard stores the list of supported video formats as an array of GUIDs.</span></span> <span data-ttu-id="2ae72-115">O código a seguir é do arquivo Main. cpp:</span><span class="sxs-lookup"><span data-stu-id="2ae72-115">The following code is from the main .cpp file:</span></span>


```C++
static const GUID*    k_guidValidSubtypes[] = {
    &MEDIASUBTYPE_NV12,
    &MEDIASUBTYPE_YV12,
    &MEDIASUBTYPE_YUY2,
    &MEDIASUBTYPE_UYVY,
    &MEDIASUBTYPE_RGB32,
    &MEDIASUBTYPE_RGB24,
    &MEDIASUBTYPE RGB555,
    &MEDIASUBTYPE RGB565
};

```



<span data-ttu-id="2ae72-116">O player pode chamar **IMediaObject:: GetInputType** e **IMediaObject:: GetOutputType** em qualquer ordem, portanto, o código do plug-in deve prever isso.</span><span class="sxs-lookup"><span data-stu-id="2ae72-116">The Player can call **IMediaObject::GetInputType** and **IMediaObject::GetOutputType** in any order, so the plug-in code must anticipate this.</span></span> <span data-ttu-id="2ae72-117">De forma semelhante, o player pode chamar **IMFTransform:: GetInputAvailableType** e **IMFTransform:: GetOutputAvailableType** em qualquer ordem.</span><span class="sxs-lookup"><span data-stu-id="2ae72-117">Similary, the Player can call **IMFTransform::GetInputAvailableType** and **IMFTransform::GetOutputAvailableType** in any order.</span></span> <span data-ttu-id="2ae72-118">As implementações de exemplo de **GetOutputType** e **GetOutputAvailableType** testam se o tipo de entrada já foi definido.</span><span class="sxs-lookup"><span data-stu-id="2ae72-118">The sample implementations of **GetOutputType** and **GetOutputAvailableType** test whether the input type has already been defined.</span></span> <span data-ttu-id="2ae72-119">Se tiver, o plug-in responderá que ele dá suporte apenas a esse tipo.</span><span class="sxs-lookup"><span data-stu-id="2ae72-119">If it has, the plug-in responds that it supports only that type.</span></span> <span data-ttu-id="2ae72-120">Caso contrário, o plug-in retorna o tipo que corresponde ao índice fornecido, como demonstra o código a seguir:</span><span class="sxs-lookup"><span data-stu-id="2ae72-120">Otherwise, the plug-in returns the type that corresponds to the supplied index, as the following code demonstrates:</span></span>


```C++
// If input type has been defined, then use that as output type.
if (GUID_NULL != m_mtInput.majortype)
{
    hr = ::MoCopyMediaType( pmt, &m_mtInput );
}
else // Otherwise use default for this plug-in.
{
    ::ZeroMemory( pmt, sizeof( DMO_MEDIA_TYPE ) );
    pmt->majortype = MEDIATYPE_Video;
    pmt->subtype = *k_guidValidSubtypes[dwTypeIndex];     
}

```



## <a name="setting-the-input-and-output-types"></a><span data-ttu-id="2ae72-121">Definindo os tipos de entrada e saída</span><span class="sxs-lookup"><span data-stu-id="2ae72-121">Setting the Input and Output Types</span></span>

<span data-ttu-id="2ae72-122">Se o plug-in do DSP estiver agindo como DMO, o Windows Media Player definirá o tipo de mídia chamando **IMediaObject:: SetInputType** e **IMediaObject:: SetOutputType**, passando para cada função um ponteiro para uma estrutura de **\_ \_ tipo de mídia DMO** que representa o tipo de mídia solicitado.</span><span class="sxs-lookup"><span data-stu-id="2ae72-122">If the DSP plug-in is acting as a DMO, Windows Media Player sets the media type by calling **IMediaObject::SetInputType** and **IMediaObject::SetOutputType**, passing to each function a pointer to a **DMO\_MEDIA\_TYPE** structure that represents the requested media type.</span></span>

<span data-ttu-id="2ae72-123">Se o plug-in do DSP estiver agindo como um MFT, o Windows Media Player definirá o tipo de mídia chamando **IMFTransform:: SetInputType** e **IMFTransform:: SetOutputType**, passando para cada função um ponteiro para uma interface **IMFMediaType** que representa o tipo de mídia solicitado.</span><span class="sxs-lookup"><span data-stu-id="2ae72-123">If the DSP plug-in is acting as an MFT, Windows Media Player sets the media type by calling **IMFTransform::SetInputType** and **IMFTransform::SetOutputType**, passing to each function a pointer to an **IMFMediaType** interface that represents the requested media type.</span></span>

<span data-ttu-id="2ae72-124">Não há nenhuma garantia de que o Player chamará métodos de negociação de formato em qualquer ordem específica, portanto, o código de plug-in deve lidar com qualquer caso.</span><span class="sxs-lookup"><span data-stu-id="2ae72-124">There is no guarantee that the Player will call format negotiation methods in any particular order, so plug-in code must handle any case.</span></span> <span data-ttu-id="2ae72-125">Por exemplo, se o Player chamar **Setoutputtypetype** antes de chamar **SetInputType**, ele será um curso de ação válido para que o plug-in rejeite o tipo de mídia de saída proposto.</span><span class="sxs-lookup"><span data-stu-id="2ae72-125">For instance, if the Player calls **SetOutputType** before calling **SetInputType**, it is a valid course of action for the plug-in to reject the proposed output media type.</span></span> <span data-ttu-id="2ae72-126">O código a seguir da implementação de exemplo de **IMediaObject:: SetOutputType** demonstra isso:</span><span class="sxs-lookup"><span data-stu-id="2ae72-126">The following code from the sample implementation of **IMediaObject::SetOutputType** demonstrates this:</span></span>


```C++
if( GUID_NULL != m_mtInput.majortype )
{
    // Validate that the output media type matches our requirements 
    // and matches our input type (if set).
    hr = ValidateMediaType(pmt, &m_mtInput);
}
else
{
    hr = DMO_E_TYPE_NOT_ACCEPTED;
}

```



<span data-ttu-id="2ae72-127">As implementações de plug-in de exemplo de **SetInputType** e **setoutputtypetype** chamam a função personalizada chamada **ValidateMediaType**.</span><span class="sxs-lookup"><span data-stu-id="2ae72-127">The sample plug-in implementations of **SetInputType** and **SetOutputType** call the custom function named **ValidateMediaType**.</span></span> <span data-ttu-id="2ae72-128">Essa função de plug-in executa uma série de testes no tipo de mídia proposto projetado para garantir que o tipo de mídia seja bem formado e tenha suporte do plug-in.</span><span class="sxs-lookup"><span data-stu-id="2ae72-128">This plug-in function performs a series of tests on the proposed media type designed to ensure that the media type is well-formed and supported by the plug-in.</span></span> <span data-ttu-id="2ae72-129">O **ValidateMediaType** executa os seguintes testes:</span><span class="sxs-lookup"><span data-stu-id="2ae72-129">**ValidateMediaType** performs the following tests:</span></span>

-   <span data-ttu-id="2ae72-130">Verifica se os membros **majortype** e **formatType** contêm os valores corretos.</span><span class="sxs-lookup"><span data-stu-id="2ae72-130">Verifies that the **majortype** and **formattype** members contain the correct values.</span></span>
-   <span data-ttu-id="2ae72-131">Verifica se o membro do **subtipo** corresponde a um dos formatos com suporte.</span><span class="sxs-lookup"><span data-stu-id="2ae72-131">Verifies that the **subtype** member matches one of the supported formats.</span></span>
-   <span data-ttu-id="2ae72-132">Verifica se as informações nas estruturas **BITMAPINFOHEADER** e **VIDEOINFOHEADER** ou **VIDEOINFOHEADER2** contêm valores válidos.</span><span class="sxs-lookup"><span data-stu-id="2ae72-132">Verifies that the information in the **BITMAPINFOHEADER** and **VIDEOINFOHEADER** or **VIDEOINFOHEADER2** structures contain valid values.</span></span>
-   <span data-ttu-id="2ae72-133">Testa se os tipos de mídia de entrada e saída correspondem, pois o plug-in não converte formatos de entrada para saída.</span><span class="sxs-lookup"><span data-stu-id="2ae72-133">Tests whether the input and output media types match because the plug-in does not convert formats from input to output.</span></span>

<span data-ttu-id="2ae72-134">Se o tipo de mídia proposto passar os testes de validação, ele será armazenado em uma variável de membro: **m \_ mtInput** para o tipo de mídia de entrada, **m \_ mtOutput** para o tipo de mídia de saída.</span><span class="sxs-lookup"><span data-stu-id="2ae72-134">If the proposed media type passes the validation tests, it is stored in a member variable: **m\_mtInput** for the input media type, **m\_mtOutput** for the output media type.</span></span>

## <a name="related-topics"></a><span data-ttu-id="2ae72-135">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="2ae72-135">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="2ae72-136">**Implementando um plug-in de DSP de vídeo**</span><span class="sxs-lookup"><span data-stu-id="2ae72-136">**Implementing a Video DSP Plug-in**</span></span>](implementing-a-video-dsp-plug-in.md)
</dt> </dl>

 

 




