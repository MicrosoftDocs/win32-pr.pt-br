---
description: Para ajudar a evitar ataques mal-intencionados, determine se seu aplicativo requer privilégios de administrador. Para funções que exigem permissões de administrador, crie um aplicativo separado e use o comando de linha de comando RunAs do Windows.
ms.assetid: afa520fc-c206-49de-8d73-8f6566ec4fb6
title: Executando com privilégios de administrador
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: dc28843195e9b5cabadc13aa2317b0bdd8058ef8
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "105753415"
---
# <a name="running-with-administrator-privileges"></a><span data-ttu-id="2d56d-104">Executando com privilégios de administrador</span><span class="sxs-lookup"><span data-stu-id="2d56d-104">Running with Administrator Privileges</span></span>

<span data-ttu-id="2d56d-105">A primeira etapa para estabelecer o tipo de conta em que seu aplicativo precisa ser executado é examinar quais recursos o aplicativo usará e quais APIs com privilégios ele chamará.</span><span class="sxs-lookup"><span data-stu-id="2d56d-105">The first step in establishing which type of account your application needs to run under is to examine what resources the application will use and what privileged APIs it will call.</span></span> <span data-ttu-id="2d56d-106">Você pode achar que o aplicativo, ou partes grandes, não exigem privilégios de administrador.</span><span class="sxs-lookup"><span data-stu-id="2d56d-106">You may find that the application, or large parts of it, do not require administrator privileges.</span></span> <span data-ttu-id="2d56d-107">*Escrever código seguro*, de Michael Howard e David LeBlanc, oferece uma descrição excelente de como realizar essa avaliação e é altamente recomendável.</span><span class="sxs-lookup"><span data-stu-id="2d56d-107">*Writing Secure Code*, by Michael Howard and David LeBlanc offers an excellent description of how to carry out this assessment and is highly recommended.</span></span> <span data-ttu-id="2d56d-108">(Esse recurso pode não estar disponível em alguns idiomas e países.)</span><span class="sxs-lookup"><span data-stu-id="2d56d-108">(This resource may not be available in some languages and countries.)</span></span>

<span data-ttu-id="2d56d-109">Você pode fornecer os privilégios de que seu aplicativo precisa com menos exposição a um ataque mal-intencionado usando uma das seguintes abordagens:</span><span class="sxs-lookup"><span data-stu-id="2d56d-109">You can provide the privileges your application needs with less exposure to malicious attack by using one of the following approaches:</span></span>

-   <span data-ttu-id="2d56d-110">Execute sob uma conta com menos privilégios.</span><span class="sxs-lookup"><span data-stu-id="2d56d-110">Run under an account with less privilege.</span></span> <span data-ttu-id="2d56d-111">Uma maneira de fazer isso é usar [**PrivilegeCheck**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-privilegecheck) para determinar quais privilégios estão habilitados em um token.</span><span class="sxs-lookup"><span data-stu-id="2d56d-111">One way to do this is to use [**PrivilegeCheck**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-privilegecheck) to determine what privileges are enabled in a token.</span></span> <span data-ttu-id="2d56d-112">Se os privilégios disponíveis não forem adequados para a operação atual, você poderá desabilitar esse código e solicitar que o usuário faça logon em uma conta com privilégios de administrador.</span><span class="sxs-lookup"><span data-stu-id="2d56d-112">If the available privileges are not adequate for the current operation, you can disable that code and ask the user to logon to an account with administrator privileges.</span></span>
-   <span data-ttu-id="2d56d-113">Quebra em uma função de aplicativo separada que exige permissões de administrador.</span><span class="sxs-lookup"><span data-stu-id="2d56d-113">Break into a separate application functions that require administrator permissions.</span></span> <span data-ttu-id="2d56d-114">Você pode fornecer ao usuário um atalho que execute o comando RunAs.</span><span class="sxs-lookup"><span data-stu-id="2d56d-114">You can provide for the user a shortcut that executes the RunAs command.</span></span> <span data-ttu-id="2d56d-115">Para obter instruções detalhadas sobre como configurar o atalho, pesquise "runas" na ajuda.</span><span class="sxs-lookup"><span data-stu-id="2d56d-115">For detailed instructions on how to set up the shortcut, search for "runas" in Help.</span></span> <span data-ttu-id="2d56d-116">Programaticamente, você pode configurar o comando [runas](/windows/desktop/com/runas) na chave do registro da [chave AppID](/windows/desktop/com/appid-key) para seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2d56d-116">Programmatically, you can configure the [RunAs](/windows/desktop/com/runas) command under the [AppId Key](/windows/desktop/com/appid-key) registry key for your application.</span></span>
-   <span data-ttu-id="2d56d-117">Autentique o usuário chamando [**CredUIPromptForCredentials**](/windows/desktop/api/wincred/nf-wincred-creduipromptforcredentialsa) (GUI) ou [**CredUICmdLinePromptForCredentials**](/windows/desktop/api/wincred/nf-wincred-creduicmdlinepromptforcredentialsa) (linha de comando) para obter o nome de usuário e a senha.</span><span class="sxs-lookup"><span data-stu-id="2d56d-117">Authenticate the user by calling [**CredUIPromptForCredentials**](/windows/desktop/api/wincred/nf-wincred-creduipromptforcredentialsa) (GUI) or [**CredUICmdLinePromptForCredentials**](/windows/desktop/api/wincred/nf-wincred-creduicmdlinepromptforcredentialsa) (command line) to obtain user name and password.</span></span> <span data-ttu-id="2d56d-118">Para obter um exemplo, consulte [solicitando credenciais ao usuário](asking-the-user-for-credentials.md).</span><span class="sxs-lookup"><span data-stu-id="2d56d-118">For an example, see [Asking the User for Credentials](asking-the-user-for-credentials.md).</span></span>
-   <span data-ttu-id="2d56d-119">Representar o usuário.</span><span class="sxs-lookup"><span data-stu-id="2d56d-119">Impersonate the user.</span></span> <span data-ttu-id="2d56d-120">Um processo que inicia sob uma conta altamente privilegiada, como o sistema, pode representar uma conta de usuário chamando [**ImpersonateLoggedOnUser**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-impersonateloggedonuser) ou funções de representação semelhantes, reduzindo assim o nível de privilégio.</span><span class="sxs-lookup"><span data-stu-id="2d56d-120">A process that starts under a highly privileged account like System can impersonate a user account by calling [**ImpersonateLoggedOnUser**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-impersonateloggedonuser) or similar Impersonate functions, thus reducing privilege level.</span></span> <span data-ttu-id="2d56d-121">No entanto, se uma chamada para [**RevertToSelf**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-reverttoself) for injetada no thread, o processo retornará aos privilégios do sistema original.</span><span class="sxs-lookup"><span data-stu-id="2d56d-121">However, if a call to [**RevertToSelf**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-reverttoself) is injected into the thread, the process returns to the original System privileges.</span></span>

<span data-ttu-id="2d56d-122">Se você determinou que seu aplicativo deve ser executado em uma conta com privilégios de administrador e que uma senha de administrador deve ser armazenada no sistema de software, consulte [tratamento de senhas](handling-passwords.md) para métodos de fazer isso com segurança.</span><span class="sxs-lookup"><span data-stu-id="2d56d-122">If you have determined that your application must run under an account with administrator privileges and that an administrator password must be stored in the software system, see [Handling Passwords](handling-passwords.md) for methods of doing this safely.</span></span>

 

 
