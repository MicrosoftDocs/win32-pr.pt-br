---
title: Detalhes de marshaling
description: Se você usar o marshaling padrão, o COM tratará todos os detalhes descritos aqui para você.
ms.assetid: bf3fe212-648e-4d00-ad1d-43d2e5e6a7ae
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f4d0fd46ee29c712c6f2b5b286df76a30f1047e6
ms.sourcegitcommit: d39e82e232f6510f843fdb8d55d25b4e9e02e880
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 02/03/2021
ms.locfileid: "105771417"
---
# <a name="marshaling-details"></a><span data-ttu-id="3daf3-103">Detalhes de marshaling</span><span class="sxs-lookup"><span data-stu-id="3daf3-103">Marshaling Details</span></span>

<span data-ttu-id="3daf3-104">Se você usar o marshaling padrão, o COM tratará todos os detalhes descritos aqui para você.</span><span class="sxs-lookup"><span data-stu-id="3daf3-104">If you use standard marshaling, COM handles all of the details described here for you.</span></span> <span data-ttu-id="3daf3-105">No entanto, existem poucos programadores que precisam desses detalhes e para aqueles interessados nas informações subjacentes.</span><span class="sxs-lookup"><span data-stu-id="3daf3-105">However, there are those few programmers who need these details and for those interested in the underlying information.</span></span> <span data-ttu-id="3daf3-106">O marshaling é o processo de empacotamento e desempacotamento de parâmetros para que uma chamada de procedimento remota possa ocorrer.</span><span class="sxs-lookup"><span data-stu-id="3daf3-106">Marshaling is the process of packaging and unpackaging parameters so a remote procedure call can take place.</span></span>

<span data-ttu-id="3daf3-107">Tipos de parâmetros diferentes são empacotados de maneiras diferentes.</span><span class="sxs-lookup"><span data-stu-id="3daf3-107">Different parameter types are marshaled in different ways.</span></span> <span data-ttu-id="3daf3-108">Por exemplo, o marshaling de um parâmetro inteiro envolve simplesmente copiar o valor para o buffer de mensagens.</span><span class="sxs-lookup"><span data-stu-id="3daf3-108">For example, marshaling an integer parameter involves simply copying the value into the message buffer.</span></span> <span data-ttu-id="3daf3-109">(Embora mesmo nesse caso simples, há problemas como a ordenação de bytes para lidar em chamadas entre computadores.) O marshaling de uma matriz, no entanto, é um processo mais complexo.</span><span class="sxs-lookup"><span data-stu-id="3daf3-109">(Although even in this simple case, there are issues such as byte ordering to deal with in cross-computer calls.) Marshaling an array, however, is a more complex process.</span></span> <span data-ttu-id="3daf3-110">Os membros da matriz são copiados em uma ordem específica para que o outro lado possa reconstruir a matriz exatamente.</span><span class="sxs-lookup"><span data-stu-id="3daf3-110">Array members are copied in a specific order so that the other side can reconstruct the array exactly.</span></span> <span data-ttu-id="3daf3-111">Quando um ponteiro é empacotado, os dados aos quais o ponteiro está apontando são copiados seguindo regras e convenções para lidar com ponteiros aninhados em estruturas.</span><span class="sxs-lookup"><span data-stu-id="3daf3-111">When a pointer is marshaled, the data that the pointer is pointing to is copied following rules and conventions for dealing with nested pointers in structures.</span></span> <span data-ttu-id="3daf3-112">Existem funções exclusivas para lidar com o marshaling de cada tipo de parâmetro.</span><span class="sxs-lookup"><span data-stu-id="3daf3-112">Unique functions exist to handle the marshaling of each parameter type.</span></span>

<span data-ttu-id="3daf3-113">Com o marshaling padrão, os proxies e os stubs são recursos de todo o recurso para a interface e interagem com o canal por meio de um protocolo padrão.</span><span class="sxs-lookup"><span data-stu-id="3daf3-113">With standard marshaling, the proxies and stubs are systemwide resources for the interface and they interact with the channel through a standard protocol.</span></span> <span data-ttu-id="3daf3-114">O empacotamento padrão pode ser usado por interfaces padrão definidas COM e por interfaces personalizadas, da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="3daf3-114">Standard marshaling can be used both by standard COM-defined interfaces and by custom interfaces, as follows:</span></span>

-   <span data-ttu-id="3daf3-115">No caso da maioria das interfaces COM, os proxies e os stubs para marshaling padrão são objetos de componente em processo que são carregados de uma DLL de todo o setor fornecida pelo COM no Ole32.dll.</span><span class="sxs-lookup"><span data-stu-id="3daf3-115">In the case of most COM interfaces, the proxies and stubs for standard marshaling are in-process component objects which are loaded from a systemwide DLL provided by COM in Ole32.dll.</span></span>
-   <span data-ttu-id="3daf3-116">No caso de interfaces personalizadas, os proxies e os stubs para marshaling padrão são gerados pelo designer de interface, normalmente com MIDL.</span><span class="sxs-lookup"><span data-stu-id="3daf3-116">In the case of custom interfaces, the proxies and stubs for standard marshaling are generated by the interface designer, typically with MIDL.</span></span> <span data-ttu-id="3daf3-117">Esses proxies e stubs são configurados estaticamente no registro, de modo que qualquer cliente potencial pode usar a interface personalizada entre limites de processo.</span><span class="sxs-lookup"><span data-stu-id="3daf3-117">These proxies and stubs are statically configured in the registry, so any potential client can use the custom interface across process boundaries.</span></span> <span data-ttu-id="3daf3-118">Esses proxies e stubs são carregados de uma DLL localizada por meio do registro do sistema, usando a IID (ID de interface) para a interface personalizada que eles realizam marshaling.</span><span class="sxs-lookup"><span data-stu-id="3daf3-118">These proxies and stubs are loaded from a DLL that is located via the system registry, using the interface ID (IID) for the custom interface they marshal.</span></span>
-   <span data-ttu-id="3daf3-119">Uma alternativa ao uso de MIDL para gerar proxies e stubs para interfaces personalizadas, uma biblioteca de tipos pode ser gerada em vez disso e o sistema fornecido, o "mecanismo de marshaling controlado pelo tipo libraryâ €" realizará marshaling da interface.</span><span class="sxs-lookup"><span data-stu-id="3daf3-119">An alternative to using MIDL to generate proxies and stubs for custom interfaces, a type library can be generated instead and the system provided, type-libraryâ€“driven marshaling engine will marshal the interface.</span></span>

<span data-ttu-id="3daf3-120">Como uma alternativa ao empacotamento padrão, uma interface (padrão ou personalizada) pode usar o marshaling personalizado.</span><span class="sxs-lookup"><span data-stu-id="3daf3-120">As an alternative to standard marshaling, an interface (standard or custom) can use custom marshaling.</span></span> <span data-ttu-id="3daf3-121">Com o marshaling personalizado, um objeto implementa dinamicamente os proxies em tempo de execução para cada interface que ele suporta.</span><span class="sxs-lookup"><span data-stu-id="3daf3-121">With custom marshaling, an object dynamically implements the proxies at run time for each interface that it supports.</span></span> <span data-ttu-id="3daf3-122">Para qualquer interface especificada, o objeto pode selecionar marshaling padrão fornecido COM ou marshaling personalizado.</span><span class="sxs-lookup"><span data-stu-id="3daf3-122">For any given interface, the object can select COM-provided standard marshaling or custom marshaling.</span></span> <span data-ttu-id="3daf3-123">Essa opção é feita pelo objeto em uma base interface por interface.</span><span class="sxs-lookup"><span data-stu-id="3daf3-123">This choice is made by the object on an interface-by-interface basis.</span></span> <span data-ttu-id="3daf3-124">Depois que a escolha é feita para uma determinada interface, ela permanece em vigor durante o tempo de vida do objeto.</span><span class="sxs-lookup"><span data-stu-id="3daf3-124">Once the choice is made for a given interface, it remains in effect during the object's lifetime.</span></span> <span data-ttu-id="3daf3-125">No entanto, uma interface em um objeto pode usar marshaling personalizado enquanto outro usa marshaling padrão.</span><span class="sxs-lookup"><span data-stu-id="3daf3-125">However, one interface on an object can use custom marshaling while another uses standard marshaling.</span></span>

<span data-ttu-id="3daf3-126">O marshaling personalizado é inerentemente exclusivo ao objeto que o implementa.</span><span class="sxs-lookup"><span data-stu-id="3daf3-126">Custom marshaling is inherently unique to the object that implements it.</span></span> <span data-ttu-id="3daf3-127">Ele usa proxies implementados pelo objeto e fornecido ao sistema na solicitação em tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="3daf3-127">It uses proxies implemented by the object and provided to the system on request at run time.</span></span> <span data-ttu-id="3daf3-128">Os objetos que implementam o marshaling personalizado devem implementar a interface [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal) , enquanto os objetos que dão suporte ao marshaling padrão não.</span><span class="sxs-lookup"><span data-stu-id="3daf3-128">Objects that implement custom marshaling must implement the [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal) interface, whereas objects that support standard marshaling do not.</span></span>

<span data-ttu-id="3daf3-129">Se você decidir escrever uma interface personalizada, deverá fornecer suporte de marshaling para ela.</span><span class="sxs-lookup"><span data-stu-id="3daf3-129">If you decide to write a custom interface, you must provide marshaling support for it.</span></span> <span data-ttu-id="3daf3-130">Normalmente, você fornecerá uma DLL de marshaling padrão para a interface que você projeta.</span><span class="sxs-lookup"><span data-stu-id="3daf3-130">Typically, you will provide a standard marshaling DLL for the interface you design.</span></span> <span data-ttu-id="3daf3-131">Você pode criar o código de proxy/stub e o proxy/DLL de stub, ou pode criar uma biblioteca de tipos que o COM usará para realizar o marshaling controlado por dados (usando os dados na biblioteca de tipos).</span><span class="sxs-lookup"><span data-stu-id="3daf3-131">You can create the proxy/stub code and the proxy/stub DLL, or you can create a type library that COM will use to do data-driven marshaling (using the data in the type library).</span></span>

<span data-ttu-id="3daf3-132">Para que um cliente faça uma chamada para um método de interface em um objeto em outro processo envolve a cooperação de vários componentes.</span><span class="sxs-lookup"><span data-stu-id="3daf3-132">For a client to make a call to an interface method in an object in another process involves the cooperation of several components.</span></span> <span data-ttu-id="3daf3-133">O proxy padrão é uma parte do código específico de interface que reside no espaço de processo do cliente e prepara os parâmetros de interface para transmissão.</span><span class="sxs-lookup"><span data-stu-id="3daf3-133">The standard proxy is a piece of interface-specific code that resides in the client's process space and prepares the interface parameters for transmittal.</span></span> <span data-ttu-id="3daf3-134">Pacotes de ti, ou Marshals, de forma que eles possam ser recriados e compreendidos no processo de recebimento.</span><span class="sxs-lookup"><span data-stu-id="3daf3-134">It packages, or marshals, them in such a way that they can be re-created and understood in the receiving process.</span></span> <span data-ttu-id="3daf3-135">O stub padrão, também uma parte do código específico da interface, reside no espaço do processo do servidor e reverte o trabalho do proxy.</span><span class="sxs-lookup"><span data-stu-id="3daf3-135">The standard stub, also a piece of interface-specific code, resides in the server's process space and reverses the work of the proxy.</span></span> <span data-ttu-id="3daf3-136">O stub desempacota ou desempacota os parâmetros enviados e os encaminha para o aplicativo de objeto.</span><span class="sxs-lookup"><span data-stu-id="3daf3-136">The stub unpackages, or unmarshals, the sent parameters and forwards them to the object application.</span></span> <span data-ttu-id="3daf3-137">Ele também empacota informações de resposta para enviar de volta para o cliente.</span><span class="sxs-lookup"><span data-stu-id="3daf3-137">It also packages reply information to send back to the client.</span></span>

> [!Note]  
> <span data-ttu-id="3daf3-138">Os leitores mais familiarizados com RPC do que COM podem ser usados para ver os termos stub de cliente e stub de servidor.</span><span class="sxs-lookup"><span data-stu-id="3daf3-138">Readers more familiar with RPC than COM may be used to seeing the terms client stub and server stub.</span></span> <span data-ttu-id="3daf3-139">Esses termos são análogos ao proxy e ao stub.</span><span class="sxs-lookup"><span data-stu-id="3daf3-139">These terms are analogous to proxy and stub.</span></span>

 

## <a name="components-of-interprocess-communications"></a><span data-ttu-id="3daf3-140">Componentes de comunicações entre processos</span><span class="sxs-lookup"><span data-stu-id="3daf3-140">Components of Interprocess Communications</span></span>

<span data-ttu-id="3daf3-141">O diagrama a seguir mostra o fluxo de comunicação entre os componentes envolvidos.</span><span class="sxs-lookup"><span data-stu-id="3daf3-141">The following diagram shows the flow of communication between the components involved.</span></span> <span data-ttu-id="3daf3-142">No lado do cliente do limite do processo, a chamada do método do cliente passa pelo proxy e, em seguida, para o canal, que faz parte da biblioteca COM.</span><span class="sxs-lookup"><span data-stu-id="3daf3-142">On the client side of the process boundary, the client's method call goes through the proxy and then onto the channel, which is part of the COM library.</span></span> <span data-ttu-id="3daf3-143">O canal envia o buffer que contém os parâmetros de marshaling para a biblioteca de tempo de execução RPC, que o transmite ao longo do limite do processo.</span><span class="sxs-lookup"><span data-stu-id="3daf3-143">The channel sends the buffer containing the marshaled parameters to the RPC run-time library, which transmits it across the process boundary.</span></span> <span data-ttu-id="3daf3-144">O tempo de execução RPC e as bibliotecas COM existem em ambos os lados do processo.</span><span class="sxs-lookup"><span data-stu-id="3daf3-144">The RPC run time and the COM libraries exist on both sides of the process.</span></span> <span data-ttu-id="3daf3-145">A distinção entre o canal e o tempo de execução de RPC é uma característica dessa implementação e não faz parte do modelo de programação ou do modelo conceitual para objetos cliente/servidor COM.</span><span class="sxs-lookup"><span data-stu-id="3daf3-145">The distinction between the channel and the RPC run time is a characteristic of this implementation and is not part of the programming model or the conceptual model for COM client/server objects.</span></span> <span data-ttu-id="3daf3-146">Os servidores COM só veem o proxy ou o stub e, indiretamente, o canal.</span><span class="sxs-lookup"><span data-stu-id="3daf3-146">COM servers see only the proxy or stub and, indirectly, the channel.</span></span> <span data-ttu-id="3daf3-147">Implementações futuras podem usar camadas diferentes abaixo do canal ou nenhuma camada.</span><span class="sxs-lookup"><span data-stu-id="3daf3-147">Future implementations may use different layers below the channel or no layers.</span></span>

![Diagrama que mostra o Client.exe e Server.exe flui em cada lado do limite do processo.](images/457036c1-98b8-4f35-aebe-70de38112b83.png)

## <a name="related-topics"></a><span data-ttu-id="3daf3-149">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="3daf3-149">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="3daf3-150">Channel</span><span class="sxs-lookup"><span data-stu-id="3daf3-150">Channel</span></span>](channel.md)
</dt> <dt>

[<span data-ttu-id="3daf3-151">Comunicação entre objetos</span><span class="sxs-lookup"><span data-stu-id="3daf3-151">Inter-Object Communication</span></span>](inter-object-communication.md)
</dt> <dt>

[<span data-ttu-id="3daf3-152">RPC da Microsoft</span><span class="sxs-lookup"><span data-stu-id="3daf3-152">Microsoft RPC</span></span>](microsoft-rpc.md)
</dt> <dt>

[<span data-ttu-id="3daf3-153">Proxy</span><span class="sxs-lookup"><span data-stu-id="3daf3-153">Proxy</span></span>](proxy.md)
</dt> <dt>

[<span data-ttu-id="3daf3-154">Gerenciador</span><span class="sxs-lookup"><span data-stu-id="3daf3-154">Stub</span></span>](stub.md)
</dt> </dl>

 

 