---
title: Encobrimento (COM)
description: O encobrimento é uma funcionalidade de segurança COM que determina qual identidade o cliente projeta para o servidor durante a representação.
ms.assetid: 5b97d9d6-8fa9-4da2-8351-64772227d9a2
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 588651cfa37def4e174ef0f2fdba9b79b0c60ca8
ms.sourcegitcommit: d39e82e232f6510f843fdb8d55d25b4e9e02e880
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 02/03/2021
ms.locfileid: "103837538"
---
# <a name="cloaking-com"></a><span data-ttu-id="e8527-103">Encobrimento (COM)</span><span class="sxs-lookup"><span data-stu-id="e8527-103">Cloaking (COM)</span></span>

<span data-ttu-id="e8527-104">O encobrimento é uma funcionalidade de segurança COM que determina qual identidade o cliente projeta para o servidor durante a representação.</span><span class="sxs-lookup"><span data-stu-id="e8527-104">Cloaking is a COM security capability that determines what identity the client projects toward the server during impersonation.</span></span> <span data-ttu-id="e8527-105">Quando o encobrimento é definido, o servidor intermediário mascara sua própria identidade e apresenta a identidade do cliente para o servidor que ele chama em nome do cliente.</span><span class="sxs-lookup"><span data-stu-id="e8527-105">When cloaking is set, the intermediate server masks its own identity and presents the client's identity to the server that it calls on the client's behalf.</span></span> <span data-ttu-id="e8527-106">Basicamente a identidade do cliente que é vista pelo servidor é a identidade associada ao proxy.</span><span class="sxs-lookup"><span data-stu-id="e8527-106">Basically; the client identity that is seen by the server is the identity associated with the proxy.</span></span> <span data-ttu-id="e8527-107">A identidade do proxy é determinada por vários fatores, um dos quais é o tipo de encobrimento definido (se houver).</span><span class="sxs-lookup"><span data-stu-id="e8527-107">The proxy's identity is determined by several factors, one of which is the type of cloaking that is set (if any).</span></span> <span data-ttu-id="e8527-108">Não há suporte para o encobrimento do provedor de segurança Schannel.</span><span class="sxs-lookup"><span data-stu-id="e8527-108">Cloaking is not supported by the Schannel security provider.</span></span>

<span data-ttu-id="e8527-109">Os tópicos a seguir fornecem mais informações sobre o encobrimento:</span><span class="sxs-lookup"><span data-stu-id="e8527-109">The following topics provide more information about cloaking:</span></span>

-   [<span data-ttu-id="e8527-110">Tipos de encobrimento</span><span class="sxs-lookup"><span data-stu-id="e8527-110">Types of Cloaking</span></span>](#types-of-cloaking)
-   [<span data-ttu-id="e8527-111">Como o encobrimento afeta a identidade do cliente</span><span class="sxs-lookup"><span data-stu-id="e8527-111">How Cloaking Affects Client Identity</span></span>](#how-cloaking-affects-client-identity)
-   [<span data-ttu-id="e8527-112">Configurando o encobrimento</span><span class="sxs-lookup"><span data-stu-id="e8527-112">Setting Cloaking</span></span>](#setting-cloaking)
-   [<span data-ttu-id="e8527-113">Níveis de encobrimento e representação</span><span class="sxs-lookup"><span data-stu-id="e8527-113">Cloaking and Impersonation Levels</span></span>](#cloaking-and-impersonation-levels)
-   [<span data-ttu-id="e8527-114">Cenários de encobrimento</span><span class="sxs-lookup"><span data-stu-id="e8527-114">Cloaking Scenarios</span></span>](#cloaking-scenarios)
-   [<span data-ttu-id="e8527-115">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="e8527-115">Related topics</span></span>](#related-topics)

## <a name="types-of-cloaking"></a><span data-ttu-id="e8527-116">Tipos de encobrimento</span><span class="sxs-lookup"><span data-stu-id="e8527-116">Types of Cloaking</span></span>

<span data-ttu-id="e8527-117">Há dois tipos de encobrimento: encobrimento *estático* e encobrimento *dinâmico* :</span><span class="sxs-lookup"><span data-stu-id="e8527-117">There are two types of cloaking: *static* cloaking and *dynamic* cloaking:</span></span>

-   <span data-ttu-id="e8527-118">Com o encobrimento estático \_ ( \_ encobrimento estático EOAC), o servidor vê o token de thread da primeira chamada de um cliente para o servidor.</span><span class="sxs-lookup"><span data-stu-id="e8527-118">With static cloaking (EOAC\_STATIC\_CLOAKING), the server sees the thread token from the first call from a client to the server.</span></span> <span data-ttu-id="e8527-119">Para a primeira chamada, se a identidade de proxy tiver sido definida anteriormente durante uma chamada para [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket), essa identidade de proxy será usada.</span><span class="sxs-lookup"><span data-stu-id="e8527-119">For the first call, if the proxy identity was previously set during a call to [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket), that proxy identity is used.</span></span> <span data-ttu-id="e8527-120">No entanto, se a identidade de proxy não tiver sido definida anteriormente, o token de thread será usado.</span><span class="sxs-lookup"><span data-stu-id="e8527-120">However, if the proxy identity was not previously set, the thread token is used.</span></span> <span data-ttu-id="e8527-121">Se nenhum token de thread estiver presente, o token de processo será usado.</span><span class="sxs-lookup"><span data-stu-id="e8527-121">If no thread token is present, the process token is used.</span></span> <span data-ttu-id="e8527-122">Para todas as chamadas futuras, o conjunto de identidades na primeira chamada é usado.</span><span class="sxs-lookup"><span data-stu-id="e8527-122">For all future calls, the identity set on the first call is used.</span></span>
-   <span data-ttu-id="e8527-123">Com o encobrimento dinâmico (EOAC \_ Dynamic \_ encobrimento), em cada chamada, o token de thread atual (se houver um token de thread) é usado para determinar a identidade do cliente.</span><span class="sxs-lookup"><span data-stu-id="e8527-123">With dynamic cloaking (EOAC\_DYNAMIC\_CLOAKING), on each call the current thread token (if there is a thread token) is used to determine the client's identity.</span></span> <span data-ttu-id="e8527-124">Se não houver nenhum token de thread, o token de processo será usado.</span><span class="sxs-lookup"><span data-stu-id="e8527-124">If there is no thread token, the process token is used.</span></span> <span data-ttu-id="e8527-125">Isso significa que os servidores chamados em nome do cliente durante a representação veem a identidade do cliente COM que originou a chamada, que geralmente é o comportamento desejado.</span><span class="sxs-lookup"><span data-stu-id="e8527-125">This means that servers called on the client's behalf during impersonation see the identity of the COM client that originated the call, which is generally the desired behavior.</span></span> <span data-ttu-id="e8527-126">(É claro que, para que a representação tenha sucesso, o cliente deve ter dado a autoridade de servidor para representar definindo um nível de representação apropriado.</span><span class="sxs-lookup"><span data-stu-id="e8527-126">(Of course, for impersonation to succeed, the client must have given the server authority to impersonate by setting an appropriate impersonation level.</span></span> <span data-ttu-id="e8527-127">Para obter mais informações, consulte [níveis de representação](impersonation-levels.md).) Esse tipo de encobrimento é caro.</span><span class="sxs-lookup"><span data-stu-id="e8527-127">For more information, see [Impersonation Levels](impersonation-levels.md).) This type of cloaking is expensive.</span></span>

## <a name="how-cloaking-affects-client-identity"></a><span data-ttu-id="e8527-128">Como o encobrimento afeta a identidade do cliente</span><span class="sxs-lookup"><span data-stu-id="e8527-128">How Cloaking Affects Client Identity</span></span>

<span data-ttu-id="e8527-129">Quando uma chamada criptografada é feita e o servidor solicita sua identidade ao cliente, ele geralmente obtém a identidade vinculada ao proxy.</span><span class="sxs-lookup"><span data-stu-id="e8527-129">When an encrypted call is made and the server asks the client for its identity, it usually gets the identity tied to the proxy.</span></span> <span data-ttu-id="e8527-130">(Às vezes, o serviço de autenticação executa uma conversão da identidade real, mas geralmente a identidade do proxy é a identidade que o servidor vê.) O proxy apresenta uma identidade para o servidor que depende do tipo de encobrimento definido e de outros fatores.</span><span class="sxs-lookup"><span data-stu-id="e8527-130">(Sometimes the authentication service performs a translation from the real identity, but generally the proxy identity is the identity the server sees.) The proxy presents an identity to the server that depends on the type of cloaking that is set and other factors.</span></span>

<span data-ttu-id="e8527-131">Para resumir, a identidade do cliente é uma função do conjunto de sinalizadores de encobrimento, o token do processo, a presença ou a ausência de um token de thread e se a identidade do proxy foi definida anteriormente.</span><span class="sxs-lookup"><span data-stu-id="e8527-131">To summarize, the identity of the client is a function of the cloaking flag set, the process token, the presence or absence of a thread token, and whether the proxy identity has been previously set.</span></span> <span data-ttu-id="e8527-132">A tabela a seguir mostra a identidade de proxy resultante (identidade do cliente) quando esses fatores variam.</span><span class="sxs-lookup"><span data-stu-id="e8527-132">The following table shows the resulting proxy identity (client identity) when these factors vary.</span></span>



| <span data-ttu-id="e8527-133">Sinalizadores de encobrimento</span><span class="sxs-lookup"><span data-stu-id="e8527-133">Cloaking Flags</span></span>                     | <span data-ttu-id="e8527-134">Presença de token de thread</span><span class="sxs-lookup"><span data-stu-id="e8527-134">Thread Token Presence</span></span>  | <span data-ttu-id="e8527-135">Identidade de proxy definida anteriormente</span><span class="sxs-lookup"><span data-stu-id="e8527-135">Proxy Identity Previously Set</span></span> | <span data-ttu-id="e8527-136">Identidade do proxy (identidade do cliente)</span><span class="sxs-lookup"><span data-stu-id="e8527-136">Proxy Identity (Client Identity)</span></span>                    |
|------------------------------------|------------------------|-------------------------------|-----------------------------------------------------|
| <span data-ttu-id="e8527-137">Encobrimento não definido</span><span class="sxs-lookup"><span data-stu-id="e8527-137">Cloaking not set</span></span><br/>        | <span data-ttu-id="e8527-138">Não se preocupe</span><span class="sxs-lookup"><span data-stu-id="e8527-138">Don't care</span></span><br/>  | <span data-ttu-id="e8527-139">Não se preocupe</span><span class="sxs-lookup"><span data-stu-id="e8527-139">Don't care</span></span><br/>         | <span data-ttu-id="e8527-140">Token de processo ou identidade de autenticação</span><span class="sxs-lookup"><span data-stu-id="e8527-140">Process token or authentication identity</span></span><br/> |
| <span data-ttu-id="e8527-141">\_encobrimento estático EOAC \_</span><span class="sxs-lookup"><span data-stu-id="e8527-141">EOAC\_STATIC\_CLOAKING</span></span><br/>  | <span data-ttu-id="e8527-142">Presente</span><span class="sxs-lookup"><span data-stu-id="e8527-142">Present</span></span><br/>     | <span data-ttu-id="e8527-143">No</span><span class="sxs-lookup"><span data-stu-id="e8527-143">No</span></span><br/>                 | <span data-ttu-id="e8527-144">Token de thread</span><span class="sxs-lookup"><span data-stu-id="e8527-144">Thread token</span></span><br/>                             |
| <span data-ttu-id="e8527-145">\_encobrimento estático EOAC \_</span><span class="sxs-lookup"><span data-stu-id="e8527-145">EOAC\_STATIC\_CLOAKING</span></span><br/>  | <span data-ttu-id="e8527-146">Presente</span><span class="sxs-lookup"><span data-stu-id="e8527-146">Present</span></span><br/>     | <span data-ttu-id="e8527-147">Yes</span><span class="sxs-lookup"><span data-stu-id="e8527-147">Yes</span></span><br/>                | <span data-ttu-id="e8527-148">Identidade do proxy atual</span><span class="sxs-lookup"><span data-stu-id="e8527-148">Current proxy identity</span></span><br/>                   |
| <span data-ttu-id="e8527-149">\_encobrimento estático EOAC \_</span><span class="sxs-lookup"><span data-stu-id="e8527-149">EOAC\_STATIC\_CLOAKING</span></span><br/>  | <span data-ttu-id="e8527-150">Não está presente</span><span class="sxs-lookup"><span data-stu-id="e8527-150">Not present</span></span><br/> | <span data-ttu-id="e8527-151">No</span><span class="sxs-lookup"><span data-stu-id="e8527-151">No</span></span><br/>                 | <span data-ttu-id="e8527-152">Token de processo</span><span class="sxs-lookup"><span data-stu-id="e8527-152">Process token</span></span><br/>                            |
| <span data-ttu-id="e8527-153">\_encobrimento estático EOAC \_</span><span class="sxs-lookup"><span data-stu-id="e8527-153">EOAC\_STATIC\_CLOAKING</span></span><br/>  | <span data-ttu-id="e8527-154">Não está presente</span><span class="sxs-lookup"><span data-stu-id="e8527-154">Not present</span></span><br/> | <span data-ttu-id="e8527-155">Yes</span><span class="sxs-lookup"><span data-stu-id="e8527-155">Yes</span></span><br/>                | <span data-ttu-id="e8527-156">Identidade do proxy atual</span><span class="sxs-lookup"><span data-stu-id="e8527-156">Current proxy identity</span></span><br/>                   |
| <span data-ttu-id="e8527-157">\_encobrimento dinâmico EOAC \_</span><span class="sxs-lookup"><span data-stu-id="e8527-157">EOAC\_DYNAMIC\_CLOAKING</span></span><br/> | <span data-ttu-id="e8527-158">Presente</span><span class="sxs-lookup"><span data-stu-id="e8527-158">Present</span></span><br/>     | <span data-ttu-id="e8527-159">Não se preocupe</span><span class="sxs-lookup"><span data-stu-id="e8527-159">Don't care</span></span><br/>         | <span data-ttu-id="e8527-160">Token de thread</span><span class="sxs-lookup"><span data-stu-id="e8527-160">Thread token</span></span><br/>                             |
| <span data-ttu-id="e8527-161">\_encobrimento dinâmico EOAC \_</span><span class="sxs-lookup"><span data-stu-id="e8527-161">EOAC\_DYNAMIC\_CLOAKING</span></span><br/> | <span data-ttu-id="e8527-162">Não está presente</span><span class="sxs-lookup"><span data-stu-id="e8527-162">Not present</span></span><br/> | <span data-ttu-id="e8527-163">Não se preocupe</span><span class="sxs-lookup"><span data-stu-id="e8527-163">Don't care</span></span> <br/>        | <span data-ttu-id="e8527-164">Token de processo</span><span class="sxs-lookup"><span data-stu-id="e8527-164">Process token</span></span><br/>                            |



 

<span data-ttu-id="e8527-165">O fluxograma a seguir ilustra como a identidade do proxy é determinada em situações diferentes.</span><span class="sxs-lookup"><span data-stu-id="e8527-165">The following flowchart illustrates how the proxy identity is determined in different situations.</span></span>

![Diagrama que mostra o fluxo para determinar a identidade do proxy.](images/9e8409b7-8475-4824-bdff-cf6b09c139c5.png)

## <a name="setting-cloaking"></a><span data-ttu-id="e8527-167">Configurando o encobrimento</span><span class="sxs-lookup"><span data-stu-id="e8527-167">Setting Cloaking</span></span>

<span data-ttu-id="e8527-168">O encobrimento é definido como um sinalizador de recurso em uma chamada para [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity), que define o encobrimento para todo o processo.</span><span class="sxs-lookup"><span data-stu-id="e8527-168">Cloaking is set as a capability flag in a call to [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity), which sets cloaking for the entire process.</span></span> <span data-ttu-id="e8527-169">Em seguida, o recurso de encobrimento é definido até que o cliente o altere por meio de uma chamada para IClientSecurity::[**setampla**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket) (ou para [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket)), que define o encobrimento para o proxy.</span><span class="sxs-lookup"><span data-stu-id="e8527-169">The cloaking capability is then set until the client changes it through a call to IClientSecurity::[**SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket) (or to [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket)), which sets cloaking for the proxy.</span></span>

<span data-ttu-id="e8527-170">Por padrão, o encobrimento não está definido.</span><span class="sxs-lookup"><span data-stu-id="e8527-170">By default, cloaking is not set.</span></span> <span data-ttu-id="e8527-171">Para defini-lo, passe \_ \_ o encobrimento estático EOAC ou \_ \_ o encobrimento dinâmico EOAC para o [](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket)parâmetro *pCapabilities* em [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) ou.</span><span class="sxs-lookup"><span data-stu-id="e8527-171">To set it, pass EOAC\_STATIC\_CLOAKING or EOAC\_DYNAMIC\_CLOAKING to the *pCapabilities* parameter in [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) or [**SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket).</span></span>

<span data-ttu-id="e8527-172">Quando o encobrimento estático é habilitado usando [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity), cada proxy pega um token (thread ou processo) na primeira vez que você faz uma chamada no proxy.</span><span class="sxs-lookup"><span data-stu-id="e8527-172">When static cloaking is enabled using [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity), each proxy picks up a token (thread or process) the first time you make a call on the proxy.</span></span> <span data-ttu-id="e8527-173">Quando o encobrimento estático é habilitado usando [**setampla**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket), o proxy pega o token no thread naquele momento.</span><span class="sxs-lookup"><span data-stu-id="e8527-173">When static cloaking is enabled using [**SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket), the proxy picks up the token on the thread at that time.</span></span> <span data-ttu-id="e8527-174">Se nenhum token de thread estiver disponível quando **setampla** for chamado, o token de processo será usado para a identidade do proxy.</span><span class="sxs-lookup"><span data-stu-id="e8527-174">If no thread token is available when **SetBlanket** is called, the process token is used for the proxy's identity.</span></span> <span data-ttu-id="e8527-175">Basicamente,  corrige a identidade do proxy.</span><span class="sxs-lookup"><span data-stu-id="e8527-175">Basically, **SetBlanket** fixes the identity of the proxy.</span></span>

<span data-ttu-id="e8527-176">Com o encobrimento dinâmico, a identidade do proxy é determinada da mesma forma, independentemente de o encobrimento dinâmico ser definido usando [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) ou com [**setampla**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket).</span><span class="sxs-lookup"><span data-stu-id="e8527-176">With dynamic cloaking, the proxy's identity is determined the same way regardless of whether dynamic cloaking is set using [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) or with [**SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket).</span></span> <span data-ttu-id="e8527-177">O token de thread atual será usado se houver um; caso contrário, o token de processo será usado.</span><span class="sxs-lookup"><span data-stu-id="e8527-177">The current thread token is used if there is one; otherwise, the process token is used.</span></span>

<span data-ttu-id="e8527-178">Se o encobrimento estiver definido para todo o processo por meio de uma chamada para [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) e você quiser fazer chamadas com o token do processo, não se represente ao fazer chamadas.</span><span class="sxs-lookup"><span data-stu-id="e8527-178">If cloaking is set for the entire process through a call to [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) and you want to make calls with the process token, do not impersonate while making calls.</span></span>

## <a name="cloaking-and-impersonation-levels"></a><span data-ttu-id="e8527-179">Níveis de encobrimento e representação</span><span class="sxs-lookup"><span data-stu-id="e8527-179">Cloaking and Impersonation Levels</span></span>

<span data-ttu-id="e8527-180">Conforme mencionado anteriormente, o recurso de encobrimento determina qual identidade é apresentada a um servidor durante a representação.</span><span class="sxs-lookup"><span data-stu-id="e8527-180">As mentioned previously, the cloaking capability determines what identity is presented to a server during impersonation.</span></span> <span data-ttu-id="e8527-181">O encobrimento fornece uma maneira de um servidor projetar uma identidade diferente de sua própria para outro servidor que está chamando em nome do cliente.</span><span class="sxs-lookup"><span data-stu-id="e8527-181">Cloaking provides a way for a server to project an identity other than its own to another server it is calling on behalf of the client.</span></span> <span data-ttu-id="e8527-182">O nível de representação indica a quantidade de autoridade que o cliente atribuiu ao servidor.</span><span class="sxs-lookup"><span data-stu-id="e8527-182">The impersonation level indicates how much authority the client has given the server.</span></span>

<span data-ttu-id="e8527-183">A representação sem encobrir funciona, mas pode não ser a melhor opção porque, em alguns casos, o servidor final precisa saber a identidade do chamador inicial.</span><span class="sxs-lookup"><span data-stu-id="e8527-183">Impersonation without cloaking works, but it may not be the best choice because, in some cases, the final server needs to know the identity of the initial caller.</span></span> <span data-ttu-id="e8527-184">Isso não pode ser obtido sem o uso do encobrimento porque é difícil garantir que somente clientes autorizados possam acessar um computador remoto.</span><span class="sxs-lookup"><span data-stu-id="e8527-184">This cannot be achieved without using cloaking because it is difficult to ensure that only authorized clients can access a remote computer.</span></span> <span data-ttu-id="e8527-185">Quando a representação é usada sem encobrimento, a identidade apresentada a um servidor downstream é a do processo de chamada imediata.</span><span class="sxs-lookup"><span data-stu-id="e8527-185">When impersonation is used without cloaking, the identity presented to a downstream server is that of the immediate calling process.</span></span>

<span data-ttu-id="e8527-186">No entanto, o encobrimento não é útil sem representação.</span><span class="sxs-lookup"><span data-stu-id="e8527-186">However, cloaking is not useful without impersonation.</span></span> <span data-ttu-id="e8527-187">O encobrimento faz sentido apenas quando o cliente tiver definido um nível de representação de representar ou delegar.</span><span class="sxs-lookup"><span data-stu-id="e8527-187">Cloaking makes sense only when the client has set an impersonation level of impersonate or delegate.</span></span> <span data-ttu-id="e8527-188">(Com níveis inferiores de representação, o servidor não pode fazer chamadas encobertas.) Se o encobrimento for bem-sucedido, dependerá do número de limites do computador cruzado e do nível de representação, que indica a quantidade de autoridade que o servidor deve agir em nome do cliente.</span><span class="sxs-lookup"><span data-stu-id="e8527-188">(With lower impersonation levels, the server cannot make cloaked calls.) Whether cloaking is successful depends on the number of computer boundaries crossed and on the impersonation level, which indicates how much authority the server has to act on behalf of the client.</span></span>

<span data-ttu-id="e8527-189">Em algumas situações, faz sentido que o servidor defina o encobrimento quando o cliente define o nível de representação para a representação do nível de imp do RPC \_ C \_ \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="e8527-189">In some situations, it makes sense for the server to set cloaking when the client sets the impersonation level to RPC\_C\_IMP\_LEVEL\_IMPERSONATE.</span></span> <span data-ttu-id="e8527-190">No entanto, algumas limitações estão em vigor.</span><span class="sxs-lookup"><span data-stu-id="e8527-190">However, certain limitations are in effect.</span></span> <span data-ttu-id="e8527-191">Se o cliente original definir o nível de representação para o nível de Requery do RPC \_ C \_ \_ \_ , o servidor intermediário (agindo como um cliente no mesmo computador) poderá se encobrir entre apenas um limite de computador.</span><span class="sxs-lookup"><span data-stu-id="e8527-191">If the original client sets the impersonation level to RPC\_C\_IMP\_LEVEL\_IMPERSONATE, the intermediate server (acting as a client on the same computer) can cloak across only one computer boundary.</span></span> <span data-ttu-id="e8527-192">Isso ocorre porque um token de representação de nível representativo pode ser passado entre apenas um limite de computador.</span><span class="sxs-lookup"><span data-stu-id="e8527-192">This is because an impersonate-level impersonation token can be passed across only one computer boundary.</span></span> <span data-ttu-id="e8527-193">Depois que o limite do computador tiver sido ultrapassado, somente os recursos locais poderão ser acessados.</span><span class="sxs-lookup"><span data-stu-id="e8527-193">After the computer boundary has been crossed, only local resources can be accessed.</span></span> <span data-ttu-id="e8527-194">A identidade apresentada ao servidor depende do tipo de encobrimento definido.</span><span class="sxs-lookup"><span data-stu-id="e8527-194">The identity presented to the server depends on the type of cloaking that is set.</span></span> <span data-ttu-id="e8527-195">Se nenhum encobrimento estiver definido, a identidade apresentada a um servidor será a do processo que faz a chamada imediata.</span><span class="sxs-lookup"><span data-stu-id="e8527-195">If no cloaking is set, the identity presented to a server will be that of the process making the immediate call.</span></span>

<span data-ttu-id="e8527-196">Para encobrir os limites de vários computadores, você deve especificar um sinalizador de recurso de cobertura apropriado e uma representação de nível de delegado.</span><span class="sxs-lookup"><span data-stu-id="e8527-196">To cloak over multiple computer boundaries, you must specify both an appropriate cloaking capability flag and delegate-level impersonation.</span></span> <span data-ttu-id="e8527-197">Com esse tipo de representação, as credenciais locais e de rede do cliente são dadas ao servidor, portanto, o token de representação pode cruzar qualquer número de limites de computador.</span><span class="sxs-lookup"><span data-stu-id="e8527-197">With this type of impersonation, both the local and network credentials of the client are given to the server, so the impersonation token can cross any number of computer boundaries.</span></span> <span data-ttu-id="e8527-198">Novamente, a identidade apresentada ao servidor depende do tipo de encobrimento definido.</span><span class="sxs-lookup"><span data-stu-id="e8527-198">Again, the identity presented to the server depends on the type of cloaking that is set.</span></span> <span data-ttu-id="e8527-199">Se nenhum encobrimento for definido com representação de nível delegado, a identidade apresentada a um servidor será a do processo que faz a chamada.</span><span class="sxs-lookup"><span data-stu-id="e8527-199">If no cloaking is set with delegate-level impersonation, the identity presented to a server is that of the process making the call.</span></span>

<span data-ttu-id="e8527-200">Por exemplo, suponha que o Process A chama B e B chame C. B tenha definido o encobrimento e um tenha definido o nível de representação como Impersonate.</span><span class="sxs-lookup"><span data-stu-id="e8527-200">For example, suppose Process A calls B, and B calls C. B has set cloaking and A has set the impersonation level to impersonate.</span></span> <span data-ttu-id="e8527-201">Se A, B e C estiverem no mesmo computador, passar o token de representação de a para B e, em seguida, para C funcionará.</span><span class="sxs-lookup"><span data-stu-id="e8527-201">If A, B, and C are on the same computer, passing the impersonation token from A to B and then to C will work.</span></span> <span data-ttu-id="e8527-202">Mas se a e C estiverem no mesmo computador e B não estiver, passar o token funcionará entre A e B, mas não de B para C. A chamada de B para C falhará porque B não pode chamar C durante o encobrimento.</span><span class="sxs-lookup"><span data-stu-id="e8527-202">But if A and C are on the same computer, and B is not, passing the token will work between A and B, but not from B to C. The call from B to C will fail because B cannot call C while cloaking.</span></span> <span data-ttu-id="e8527-203">No entanto, se um definir o nível de representação como delegado, o token poderá ser passado de B para C e a chamada poderá ter êxito.</span><span class="sxs-lookup"><span data-stu-id="e8527-203">However, if A sets the impersonation level to delegate, the token can be passed from B to C and the call may succeed.</span></span>

## <a name="cloaking-scenarios"></a><span data-ttu-id="e8527-204">Cenários de encobrimento</span><span class="sxs-lookup"><span data-stu-id="e8527-204">Cloaking Scenarios</span></span>

<span data-ttu-id="e8527-205">Na ilustração a seguir, processe uma chamada B, chamadas C, chamadas D quando o encobrimento não está definido.</span><span class="sxs-lookup"><span data-stu-id="e8527-205">In the following illustration, Process A calls B, calls C, calls D when cloaking is not set.</span></span> <span data-ttu-id="e8527-206">Como resultado, cada processo intermediário vê a identidade do processo que o chamou.</span><span class="sxs-lookup"><span data-stu-id="e8527-206">As a result, each intermediate process sees the identity of the process that called it.</span></span>

![Diagrama que mostra o processo quando o encobrimento não está definido.](images/0d2eb6cf-97d6-4c4e-b97e-abad854b1120.png)

<span data-ttu-id="e8527-208">Com o encobrimento estático, o servidor vê a identidade do proxy que foi definida durante a primeira chamada do cliente para o servidor.</span><span class="sxs-lookup"><span data-stu-id="e8527-208">With static cloaking, the server sees the proxy identity that was set during the first call from the client to the server.</span></span> <span data-ttu-id="e8527-209">A figura a seguir mostra um exemplo da identidade do proxy que está sendo definida durante uma chamada de B para C. Em uma chamada subsequente, o processo D vê a identidade de B quando o encobrimento estático é definido por B e C.</span><span class="sxs-lookup"><span data-stu-id="e8527-209">The following figure shows an example of the proxy identity being set during a call from B to C. On a subsequent call, Process D sees B's identity when static cloaking is set by B and C.</span></span>

![Diagrama que mostra o processo de encobrimento estático.](images/520938e0-c4a6-4ac1-937d-02baf2007a27.png)

<span data-ttu-id="e8527-211">Com o encobrimento dinâmico, a identidade do chamador durante a representação é baseada no token do thread atual, se houver.</span><span class="sxs-lookup"><span data-stu-id="e8527-211">With dynamic cloaking, the identity of the caller during impersonation is based on the current thread token, if there is one.</span></span> <span data-ttu-id="e8527-212">A ilustração a seguir mostra a situação em que B e C definem o encobrimento dinâmico e D vê a identidade de A, apesar de uma chamada anterior de B para C.</span><span class="sxs-lookup"><span data-stu-id="e8527-212">The following illustration shows the situation where B and C set dynamic cloaking and D sees the identity of A, despite an earlier call from B to C.</span></span>

![Diagrama que mostra o processo de encobrimento dinâmico.](images/d0848465-82f3-4d5a-851e-566d7800ada0.png)

## <a name="related-topics"></a><span data-ttu-id="e8527-214">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="e8527-214">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="e8527-215">Delegação e representação</span><span class="sxs-lookup"><span data-stu-id="e8527-215">Delegation and Impersonation</span></span>](delegation-and-impersonation.md)
</dt> </dl>

 

