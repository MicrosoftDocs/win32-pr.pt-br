---
title: Implementando e ativando um manipulador sem dados de servidor adicionais
description: Implementando e ativando um manipulador sem dados de servidor adicionais
ms.assetid: 9d91260a-4cec-4a10-bb57-d02999efae47
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6866b40e1257a865aa5068ffd46611c411498877
ms.sourcegitcommit: d39e82e232f6510f843fdb8d55d25b4e9e02e880
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 02/03/2021
ms.locfileid: "103923024"
---
# <a name="implementing-and-activating-a-handler-with-no-extra-server-data"></a><span data-ttu-id="72c29-103">Implementando e ativando um manipulador sem dados de servidor adicionais</span><span class="sxs-lookup"><span data-stu-id="72c29-103">Implementing and Activating a Handler with No Extra Server Data</span></span>

<span data-ttu-id="72c29-104">Para criar uma instância do seu manipulador, se for um que não obtém dados de servidor adicionais, o servidor deve implementar [**IStdMarshalInfo**](/windows/win32/api/objidlbase/nn-objidlbase-istdmarshalinfo) , mas não [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal).</span><span class="sxs-lookup"><span data-stu-id="72c29-104">To create an instance of your handler, if it is one that gets no extra server data, the server must implement [**IStdMarshalInfo**](/windows/win32/api/objidlbase/nn-objidlbase-istdmarshalinfo) but not [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal).</span></span> <span data-ttu-id="72c29-105">**IStdMarshalInfo** tem um método, [**GetClassForHandler**](/windows/win32/api/objidlbase/nf-objidlbase-istdmarshalinfo-getclassforhandler), que recupera o CLSID do manipulador de objetos a ser usado no processo de destino.</span><span class="sxs-lookup"><span data-stu-id="72c29-105">**IStdMarshalInfo** has one method, [**GetClassForHandler**](/windows/win32/api/objidlbase/nf-objidlbase-istdmarshalinfo-getclassforhandler), which retrieves the CLSID of the object handler to be used in the destination process.</span></span> <span data-ttu-id="72c29-106">COM chama isso quando chama [**CoMarshalInterface**](/windows/desktop/api/combaseapi/nf-combaseapi-comarshalinterface) para você e ativa o manipulador no lado do cliente.</span><span class="sxs-lookup"><span data-stu-id="72c29-106">COM calls this when it calls [**CoMarshalInterface**](/windows/desktop/api/combaseapi/nf-combaseapi-comarshalinterface) for you and activates the handler on the client side.</span></span>

<span data-ttu-id="72c29-107">Em seguida, as implementações de servidor e de manipulador devem chamar a função [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex) .</span><span class="sxs-lookup"><span data-stu-id="72c29-107">Next, both the server and handler implementations must call the [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex) function.</span></span> <span data-ttu-id="72c29-108">Essa função cria um marshaler padrão em cada lado (chamado de Gerenciador de proxy no lado do cliente e um Gerenciador de stub no lado do servidor).</span><span class="sxs-lookup"><span data-stu-id="72c29-108">This function creates a standard marshaler on each side (called a proxy manager on the client side and a stub manager on the server side).</span></span>

<span data-ttu-id="72c29-109">O servidor chama [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), passando o sinalizador SMEXF \_ Server.</span><span class="sxs-lookup"><span data-stu-id="72c29-109">The server calls [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), passing in the flag SMEXF\_SERVER.</span></span> <span data-ttu-id="72c29-110">Isso cria um marshaler padrão do lado do servidor (Gerenciador de stub).</span><span class="sxs-lookup"><span data-stu-id="72c29-110">This creates a server-side standard marshaler (stub manager).</span></span> <span data-ttu-id="72c29-111">A estrutura do lado do servidor é mostrada na ilustração a seguir:</span><span class="sxs-lookup"><span data-stu-id="72c29-111">The server-side structure is shown in the following illustration:</span></span>

![Diagrama que mostra a estrutura do lado do servidor.](images/b47b3bc0-3e7d-4be4-9767-7ae436bd1b21.png)

## <a name="server-side-structure"></a><span data-ttu-id="72c29-113">Estrutura de Server-Side</span><span class="sxs-lookup"><span data-stu-id="72c29-113">Server-Side Structure</span></span>

<span data-ttu-id="72c29-114">O manipulador chama [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), passando o manipulador SMEXF do sinalizador \_ .</span><span class="sxs-lookup"><span data-stu-id="72c29-114">The handler calls [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), passing in the flag SMEXF\_HANDLER.</span></span> <span data-ttu-id="72c29-115">Isso cria um marshaler padrão do lado do cliente (Gerenciador de proxy) e o agrega com o manipulador no lado do cliente.</span><span class="sxs-lookup"><span data-stu-id="72c29-115">This creates a client-side standard marshaler (proxy manager) and aggregates it with the handler on the client side.</span></span> <span data-ttu-id="72c29-116">O tempo de vida de ambos são gerenciados pelo objeto de identidade de controle (implementando [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown)) que o sistema implementa quando o manipulador chama **CoGetStdMarshalEx**.</span><span class="sxs-lookup"><span data-stu-id="72c29-116">The lifetime of both are managed by the controlling identity object (implementing [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown)) that the system implements when the handler calls **CoGetStdMarshalEx**.</span></span> <span data-ttu-id="72c29-117">A estrutura do lado do cliente é mostrada na ilustração a seguir.</span><span class="sxs-lookup"><span data-stu-id="72c29-117">The client-side structure is shown in the following illustration.</span></span>

![Diagrama que mostra a estrutura do lado do cliente.](images/24ae70ef-dfa8-4784-90ac-dc6cfb043ee5.png)

## <a name="client-side-structure"></a><span data-ttu-id="72c29-119">Estrutura de Client-Side</span><span class="sxs-lookup"><span data-stu-id="72c29-119">Client-Side Structure</span></span>

<span data-ttu-id="72c29-120">Conforme mostrado na ilustração anterior, o manipulador é, na verdade, Sandwich entre o Gerenciador de proxy e a identidade/controle desconhecida.</span><span class="sxs-lookup"><span data-stu-id="72c29-120">As shown in the preceding illustration, the handler is actually sandwiched between the proxy manager and the identity/controlling unknown.</span></span> <span data-ttu-id="72c29-121">Isso dá ao controle do sistema o tempo de vida do objeto, oferecendo ao controle do manipulador as interfaces expostas.</span><span class="sxs-lookup"><span data-stu-id="72c29-121">This gives the system control over the lifetime of the object while giving the handler control over the exposed interfaces.</span></span> <span data-ttu-id="72c29-122">A linha tracejada entre a identidade e o Gerenciador de proxy indica que os dois compartilham a forte integração por meio de interfaces privadas internas.</span><span class="sxs-lookup"><span data-stu-id="72c29-122">The dashed line between the Identity and Proxy Manager indicates that the two share tight integration through internal private interfaces.</span></span>

<span data-ttu-id="72c29-123">Quando COM chama [**CoUnmarshalInterface**](/windows/desktop/api/combaseapi/nf-combaseapi-counmarshalinterface) para o cliente, ele cria a instância do manipulador, agregando-a com a identidade.</span><span class="sxs-lookup"><span data-stu-id="72c29-123">When COM calls [**CoUnmarshalInterface**](/windows/desktop/api/combaseapi/nf-combaseapi-counmarshalinterface) for the client, it creates the handler instance, aggregating it with the Identity.</span></span> <span data-ttu-id="72c29-124">O manipulador criará o marshaler padrão (por meio da chamada para [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), passando o controle desconhecido que ele recebeu quando foi criado).</span><span class="sxs-lookup"><span data-stu-id="72c29-124">The handler will create the standard marshaler (through the call to [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), passing in the controlling unknown it received when it was created).</span></span> <span data-ttu-id="72c29-125">O manipulador não implementa [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal) , mas apenas retorna **IMarshal** do marshaler padrão.</span><span class="sxs-lookup"><span data-stu-id="72c29-125">The handler does not implement [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal) but just returns **IMarshal** from the standard marshaler.</span></span> <span data-ttu-id="72c29-126">Mesmo que o manipulador implemente **IMarshal**, ele não será chamado durante um desempacotamento.</span><span class="sxs-lookup"><span data-stu-id="72c29-126">Even if the handler does implement **IMarshal**, it will not get called during an unmarshal.</span></span>

<span data-ttu-id="72c29-127">Se dois threads simultaneamente desempacotarem o mesmo objeto pela primeira vez, é possível que dois manipuladores sejam criados temporariamente.</span><span class="sxs-lookup"><span data-stu-id="72c29-127">If two threads simultaneously unmarshal the same object for the first time, it is possible for two handlers to get created temporarily.</span></span> <span data-ttu-id="72c29-128">Um será lançado posteriormente.</span><span class="sxs-lookup"><span data-stu-id="72c29-128">One will subsequently be released.</span></span>

## <a name="related-topics"></a><span data-ttu-id="72c29-129">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="72c29-129">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="72c29-130">O manipulador de Client-Side leve</span><span class="sxs-lookup"><span data-stu-id="72c29-130">The Lightweight Client-Side Handler</span></span>](the-lightweight-client-side-handler.md)
</dt> </dl>

 

 