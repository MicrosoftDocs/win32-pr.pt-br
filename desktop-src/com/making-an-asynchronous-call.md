---
title: Fazendo uma chamada assíncrona
description: O procedimento para fazer uma chamada síncrona é simples. o cliente obtém um ponteiro de interface no objeto de servidor e chama métodos por meio desse ponteiro. A chamada assíncrona envolve um objeto de chamada, portanto, ele envolve algumas etapas.
ms.assetid: ab65d38d-836a-48d4-87c1-8812cbc8ff92
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 22dcd7a6509cd07e12357a96222baa04f9e4c942
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/21/2020
ms.locfileid: "104366780"
---
# <a name="making-an-asynchronous-call"></a><span data-ttu-id="8b7f7-104">Fazendo uma chamada assíncrona</span><span class="sxs-lookup"><span data-stu-id="8b7f7-104">Making an Asynchronous Call</span></span>

<span data-ttu-id="8b7f7-105">O procedimento para fazer uma chamada síncrona é simples: o cliente obtém um ponteiro de interface no objeto de servidor e chama métodos por meio desse ponteiro.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-105">The procedure for making a synchronous call is straightforward: The client obtains an interface pointer on the server object and calls methods through that pointer.</span></span> <span data-ttu-id="8b7f7-106">A chamada assíncrona envolve um objeto de chamada, portanto, ele envolve algumas etapas.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-106">Asynchronous calling involves a call object, so it involves a few more steps.</span></span>

<span data-ttu-id="8b7f7-107">Para cada método em uma interface síncrona, a interface assíncrona correspondente implementa dois métodos.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-107">For each method on a synchronous interface, the corresponding asynchronous interface implements two methods.</span></span> <span data-ttu-id="8b7f7-108">Esses métodos anexam os prefixos Begin \_ e Finish \_ ao nome do método síncrono.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-108">These methods attach the prefixes Begin\_ and Finish\_ to the name of the synchronous method.</span></span> <span data-ttu-id="8b7f7-109">Por exemplo, se uma interface chamada ISimpleStream tiver um método Read, a interface AsyncISimpleStream terá um método Begin \_ Read e Finish \_ Read.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-109">For example, if an interface named ISimpleStream has a Read method, the AsyncISimpleStream interface will have a Begin\_Read and a Finish\_Read method.</span></span> <span data-ttu-id="8b7f7-110">Para iniciar uma chamada assíncrona, o cliente chama o \_ método Begin.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-110">To begin an asynchronous call, the client calls the Begin\_ method.</span></span>

<span data-ttu-id="8b7f7-111">**Para iniciar uma chamada assíncrona**</span><span class="sxs-lookup"><span data-stu-id="8b7f7-111">**To begin an asynchronous call**</span></span>

1.  <span data-ttu-id="8b7f7-112">Consulte o objeto Server para a interface [**ICallFactory**](/windows/win32/api/objidlbase/nn-objidlbase-icallfactory) .</span><span class="sxs-lookup"><span data-stu-id="8b7f7-112">Query the server object for the [**ICallFactory**](/windows/win32/api/objidlbase/nn-objidlbase-icallfactory) interface.</span></span> <span data-ttu-id="8b7f7-113">Se [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) retornar e \_ nointerface, o objeto Server não oferecerá suporte à chamada assíncrona.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-113">If [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) returns E\_NOINTERFACE, the server object does not support asynchronous calling.</span></span>

2.  <span data-ttu-id="8b7f7-114">Chame [**ICallFactory:: createcall**](/windows/win32/api/objidlbase/nf-objidlbase-icallfactory-createcall) para criar um objeto de chamada correspondente à interface que você deseja e, em seguida, solte o ponteiro para [**ICallFactory**](/windows/win32/api/objidlbase/nn-objidlbase-icallfactory).</span><span class="sxs-lookup"><span data-stu-id="8b7f7-114">Call [**ICallFactory::CreateCall**](/windows/win32/api/objidlbase/nf-objidlbase-icallfactory-createcall) to create a call object corresponding to the interface you want, and then release the pointer to [**ICallFactory**](/windows/win32/api/objidlbase/nn-objidlbase-icallfactory).</span></span>

3.  <span data-ttu-id="8b7f7-115">Se você não solicitou um ponteiro para a interface assíncrona da chamada para [**createcall**](/windows/win32/api/objidlbase/nf-objidlbase-icallfactory-createcall), consulte o objeto de chamada para a interface assíncrona.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-115">If you did not request a pointer to the asynchronous interface from the call to [**CreateCall**](/windows/win32/api/objidlbase/nf-objidlbase-icallfactory-createcall), query the call object for the asynchronous interface.</span></span>

4.  <span data-ttu-id="8b7f7-116">Chame o método Begin apropriado \_ .</span><span class="sxs-lookup"><span data-stu-id="8b7f7-116">Call the appropriate Begin\_ method.</span></span>

<span data-ttu-id="8b7f7-117">O objeto de servidor agora está processando a chamada assíncrona e o cliente está livre para realizar outro trabalho até que ele precise dos resultados da chamada.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-117">The server object is now processing the asynchronous call, and the client is free to do other work until it needs the results of the call.</span></span>

<span data-ttu-id="8b7f7-118">Um objeto de chamada pode processar apenas uma chamada assíncrona por vez.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-118">A call object can process only one asynchronous call at a time.</span></span> <span data-ttu-id="8b7f7-119">Se o mesmo ou um segundo cliente chamar um \_ método Begin antes de uma chamada assíncrona pendente ser concluída, o \_ método Begin retornará RPC \_ E \_ chamada \_ pendente.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-119">If the same or a second client calls a Begin\_ method before a pending asynchronous call is finished, the Begin\_ method will return RPC\_E\_CALL\_PENDING.</span></span>

<span data-ttu-id="8b7f7-120">Se o cliente não precisar dos resultados do \_ método Begin, ele poderá liberar o objeto de chamada no final deste procedimento.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-120">If the client does not need the results of the Begin\_ method, it can release the call object at the end of this procedure.</span></span> <span data-ttu-id="8b7f7-121">COM detecta essa condição e limpa a chamada.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-121">COM detects this condition and cleans up the call.</span></span> <span data-ttu-id="8b7f7-122">O \_ método Finish não é chamado e o cliente não obtém nenhum parâmetro de saída ou um valor de retorno.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-122">The Finish\_ method is not called, and the client does not get any out parameters or a return value.</span></span>

<span data-ttu-id="8b7f7-123">Quando o objeto de servidor está pronto para retornar do \_ método Begin, ele sinaliza o objeto de chamada que ele está pronto.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-123">When the server object is ready to return from the Begin\_ method, it signals the call object that it is done.</span></span> <span data-ttu-id="8b7f7-124">Quando o cliente estiver pronto, ele verificará se o objeto de chamada foi sinalizado.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-124">When the client is ready, it checks to see whether the call object has been signaled.</span></span> <span data-ttu-id="8b7f7-125">Nesse caso, o cliente pode concluir a chamada assíncrona.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-125">If so, the client can complete the asynchronous call.</span></span>

<span data-ttu-id="8b7f7-126">O mecanismo para essa sinalização e verificação entre o cliente e o servidor é a interface [**ISynchronize**](/windows/win32/api/objidlbase/nn-objidlbase-isynchronize) no objeto de chamada.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-126">The mechanism for this signaling and checking between client and server is the [**ISynchronize**](/windows/win32/api/objidlbase/nn-objidlbase-isynchronize) interface on the call object.</span></span> <span data-ttu-id="8b7f7-127">Normalmente, o objeto de chamada implementa essa interface agregando um objeto de sincronização fornecido pelo sistema.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-127">The call object normally implements this interface by aggregating a system-supplied synchronization object.</span></span> <span data-ttu-id="8b7f7-128">O objeto de sincronização encapsula um identificador de evento, que o servidor sinaliza pouco antes de retornar do \_ método Begin chamando [**ISynchronize:: Signal**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-signal).</span><span class="sxs-lookup"><span data-stu-id="8b7f7-128">The synchronization object wraps an event handle, which the server signals just before returning from the Begin\_ method by calling [**ISynchronize::Signal**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-signal).</span></span>

<span data-ttu-id="8b7f7-129">**Para concluir uma chamada assíncrona**</span><span class="sxs-lookup"><span data-stu-id="8b7f7-129">**To complete an asynchronous call**</span></span>

1.  <span data-ttu-id="8b7f7-130">Consulte o objeto de chamada para a interface [**ISynchronize**](/windows/win32/api/objidlbase/nn-objidlbase-isynchronize) .</span><span class="sxs-lookup"><span data-stu-id="8b7f7-130">Query the call object for the [**ISynchronize**](/windows/win32/api/objidlbase/nn-objidlbase-isynchronize) interface.</span></span>

2.  <span data-ttu-id="8b7f7-131">Chamar [**ISynchronize:: Wait**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-wait).</span><span class="sxs-lookup"><span data-stu-id="8b7f7-131">Call [**ISynchronize::Wait**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-wait).</span></span>

3.  <span data-ttu-id="8b7f7-132">Se [**Wait**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-wait) retornar RPC \_ E \_ timeout, o \_ método Begin não terminará o processamento.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-132">If [**Wait**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-wait) returns RPC\_E\_TIMEOUT, the Begin\_ method is not finished processing.</span></span> <span data-ttu-id="8b7f7-133">O cliente pode continuar com outro trabalho e chamar **aguardar** novamente mais tarde.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-133">The client can continue with other work and call **Wait** again later.</span></span> <span data-ttu-id="8b7f7-134">Ele não pode chamar o \_ método Finish até que **Wait** retorne S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-134">It cannot call the Finish\_ method until **Wait** returns S\_OK.</span></span>

    <span data-ttu-id="8b7f7-135">Se [**Wait**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-wait) retornar S \_ OK, o método Begin retornará \_ .</span><span class="sxs-lookup"><span data-stu-id="8b7f7-135">If [**Wait**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-wait) returns S\_OK, the Begin\_ method has returned.</span></span> <span data-ttu-id="8b7f7-136">Chame o método de conclusão apropriado \_ .</span><span class="sxs-lookup"><span data-stu-id="8b7f7-136">Call the appropriate Finish\_ method.</span></span>

<span data-ttu-id="8b7f7-137">O \_ método Finish passa os parâmetros de saída do cliente.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-137">The Finish\_ method passes the client any out parameters.</span></span> <span data-ttu-id="8b7f7-138">O comportamento dos métodos assíncronos, incluindo o valor de retorno do \_ método Finish, deve corresponder exatamente ao método síncrono correspondente.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-138">The behavior of the asynchronous methods, including the return value of the Finish\_ method, should match exactly that of the corresponding synchronous method.</span></span>

<span data-ttu-id="8b7f7-139">O cliente pode liberar o objeto de chamada assim que o \_ método Finish retorna ou pode conter um ponteiro para o objeto de chamada para fazer chamadas adicionais.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-139">The client can release the call object as soon as the Finish\_ method returns, or it can hold a pointer to the call object to make additional calls.</span></span> <span data-ttu-id="8b7f7-140">Em ambos os casos, o cliente é responsável por liberar o objeto de chamada quando o objeto não é mais necessário.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-140">In either case, the client is responsible for releasing the call object when the object is no longer needed.</span></span>

<span data-ttu-id="8b7f7-141">Se você chamar um \_ método Finish quando nenhuma chamada estiver em andamento, o método retornará RPC \_ E \_ chamada \_ concluída.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-141">If you call a Finish\_ method when no call is in progress, the method will return RPC\_E\_CALL\_COMPLETE.</span></span>

> [!Note]  
> <span data-ttu-id="8b7f7-142">Se os objetos de cliente e de servidor estiverem no mesmo apartamento, as chamadas para [**ICallFactory:: createcall**](/windows/win32/api/objidlbase/nf-objidlbase-icallfactory-createcall) não têm garantia de sucesso.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-142">If the client and server objects are in the same apartment, calls to [**ICallFactory::CreateCall**](/windows/win32/api/objidlbase/nf-objidlbase-icallfactory-createcall) are not guaranteed to succeed.</span></span> <span data-ttu-id="8b7f7-143">Se o objeto de servidor não oferecer suporte à chamada assíncrona em uma interface específica, a tentativa de criar um objeto de chamada falhará e o cliente deverá usar a interface síncrona.</span><span class="sxs-lookup"><span data-stu-id="8b7f7-143">If the server object does not support asynchronous calling on a particular interface, the attempt to create a call object will fail and the client must use the synchronous interface.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="8b7f7-144">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="8b7f7-144">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="8b7f7-145">Cancelando uma chamada assíncrona</span><span class="sxs-lookup"><span data-stu-id="8b7f7-145">Canceling an Asynchronous Call</span></span>](canceling-an-asynchronous-call.md)
</dt> <dt>

[<span data-ttu-id="8b7f7-146">Client Security durante uma chamada assíncrona</span><span class="sxs-lookup"><span data-stu-id="8b7f7-146">Client Security During an Asynchronous Call</span></span>](client-security-during-an-asynchronous-call.md)
</dt> <dt>

[<span data-ttu-id="8b7f7-147">Representação e chamadas assíncronas</span><span class="sxs-lookup"><span data-stu-id="8b7f7-147">Impersonation and Asynchronous Calls</span></span>](impersonation-and-asynchronous-calls.md)
</dt> </dl>

 

 