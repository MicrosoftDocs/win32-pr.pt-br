---
title: Definindo Process-Wide segurança com CoInitializeSecurity
description: A função CoInitializeSecurity permite controlar cenários de segurança complexos definindo a segurança de um aplicativo programaticamente.
ms.assetid: 20b66868-fb9a-489f-97a2-59a8a825c8d9
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 567a6dfaf47dbd278fc248558cd25969c733b24a
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/21/2020
ms.locfileid: "104366773"
---
# <a name="setting-process-wide-security-with-coinitializesecurity"></a><span data-ttu-id="c2e08-103">Definindo Process-Wide segurança com CoInitializeSecurity</span><span class="sxs-lookup"><span data-stu-id="c2e08-103">Setting Process-Wide Security with CoInitializeSecurity</span></span>

<span data-ttu-id="c2e08-104">A função [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) permite controlar cenários de segurança complexos definindo a segurança de um aplicativo programaticamente.</span><span class="sxs-lookup"><span data-stu-id="c2e08-104">The [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) function allows you to control complex security scenarios by setting security for an application programmatically.</span></span> <span data-ttu-id="c2e08-105">Este tópico descreve os cenários em que você pode usar **CoInitializeSecurity** e fornece alguns detalhes sobre como usá-lo.</span><span class="sxs-lookup"><span data-stu-id="c2e08-105">This topic describes scenarios when you might use **CoInitializeSecurity** and provides some details on how you use it.</span></span>

<span data-ttu-id="c2e08-106">Há várias razões pelas quais você pode querer usar [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) para definir a segurança em todo o processo em seu programa.</span><span class="sxs-lookup"><span data-stu-id="c2e08-106">There are several reasons why you might want to use [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) to set process-wide security within your program.</span></span> <span data-ttu-id="c2e08-107">Por exemplo, embora você possa definir o nível de autenticação e as permissões de acesso para o aplicativo usando dcomcnfg.exe, o nível de representação padrão para o computador pode não ser o que você deseja para seu processo.</span><span class="sxs-lookup"><span data-stu-id="c2e08-107">For example, although you can set the authentication level and the access permissions for the application using dcomcnfg.exe, the default impersonation level for the computer might not be the one you want for your process.</span></span> <span data-ttu-id="c2e08-108">A única maneira de alterar essa configuração para seu processo é chamar **CoInitializeSecurity**.</span><span class="sxs-lookup"><span data-stu-id="c2e08-108">The only way to change this setting for your process is to call **CoInitializeSecurity**.</span></span>

<span data-ttu-id="c2e08-109">Se você quiser usar o provedor de segurança Schannel, deverá especificá-lo como um serviço de autenticação em uma chamada para [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity).</span><span class="sxs-lookup"><span data-stu-id="c2e08-109">If you want to use the Schannel security provider, you must specify it as an authentication service in a call to [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity).</span></span>

<span data-ttu-id="c2e08-110">Outro cenário comum no qual você pode definir a segurança de todo o processo de forma programática é quando você deseja definir a segurança padrão para todo o processo, mas você tem um ou mais objetos dentro desse processo que expõem interfaces com requisitos de segurança especiais.</span><span class="sxs-lookup"><span data-stu-id="c2e08-110">Another common scenario in which you might set process-wide security programmatically is when you would like to set default security for the entire process but you have one or more objects within that process that expose interfaces with special security requirements.</span></span> <span data-ttu-id="c2e08-111">Nesse caso, você pode chamar [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) para definir a segurança para o processo, permitindo que o com manipule a maioria das verificações de segurança, e você pode chamar outros métodos para definir a segurança para os objetos com necessidades de segurança especiais.</span><span class="sxs-lookup"><span data-stu-id="c2e08-111">In this case, you can call [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) to set security for the process, allowing COM to handle most of the security checks, and you can call other methods to set security for the objects with special security needs.</span></span> <span data-ttu-id="c2e08-112">Chamar esses métodos e funções é descrito em [definindo a segurança no nível do proxy da interface](setting-security-at-the-interface-proxy-level.md).</span><span class="sxs-lookup"><span data-stu-id="c2e08-112">Calling these methods and functions is described in [Setting Security at the Interface Proxy Level](setting-security-at-the-interface-proxy-level.md).</span></span>

<span data-ttu-id="c2e08-113">Se seu aplicativo tiver requisitos de segurança muito especializados, como permitir que determinados grupos acessem objetos diferentes dependendo da hora do dia, você talvez queira lidar com toda a segurança de forma programática, garantindo que o COM não faça nenhuma verificação automática.</span><span class="sxs-lookup"><span data-stu-id="c2e08-113">If your application has very specialized security requirements, such as allowing certain groups access to different objects depending on the time of day, you might want to handle all of your security programmatically, ensuring that COM does no automatic checking for you at all.</span></span> <span data-ttu-id="c2e08-114">Para fazer isso, você deve chamar [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity), definindo o parâmetro *dwAuthnLevel* como None e o parâmetro *pVoid* como **NULL**.</span><span class="sxs-lookup"><span data-stu-id="c2e08-114">To do this, you must call [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity), setting the *dwAuthnLevel* parameter to none and the *pVoid* parameter to **NULL**.</span></span> <span data-ttu-id="c2e08-115">Se você tiver seu próprio pacote de segurança, também precisará registrá-lo no parâmetro *pAuthnSvc* .</span><span class="sxs-lookup"><span data-stu-id="c2e08-115">If you have your own security package you would also need to register it in the *pAuthnSvc* parameter.</span></span> <span data-ttu-id="c2e08-116">Em seguida, você pode manipular toda a sua segurança programaticamente por meio de chamadas para a interface de nível de proxy e funções descritas em [definindo a segurança no nível de proxy da interface](setting-security-at-the-interface-proxy-level.md).</span><span class="sxs-lookup"><span data-stu-id="c2e08-116">Then you can handle all of your own security programmatically through calls to the proxy-level interface and functions described in [Setting Security at the Interface Proxy Level](setting-security-at-the-interface-proxy-level.md).</span></span>

<span data-ttu-id="c2e08-117">[**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) oferece um conjunto avançado de recursos.</span><span class="sxs-lookup"><span data-stu-id="c2e08-117">[**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) offers a rich set of capabilities.</span></span> <span data-ttu-id="c2e08-118">Se você chamar **CoInitializeSecurity**, os valores do registro serão ignorados e os valores de inicialização de segurança que você passar para a chamada serão usados em vez disso.</span><span class="sxs-lookup"><span data-stu-id="c2e08-118">If you call **CoInitializeSecurity**, the registry values are ignored and the security initialization values you pass in to the call are used instead.</span></span> <span data-ttu-id="c2e08-119">Dependendo do resultado desejado, o primeiro parâmetro, *pVoid*, pode apontar para três tipos diferentes de valores: um [**\_ descritor de segurança**](/windows/desktop/api/winnt/ns-winnt-security_descriptor) , um objeto [**IAccessControl**](/windows/desktop/api/IAccess/nn-iaccess-iaccesscontrol) ou um ponteiro para um AppID.</span><span class="sxs-lookup"><span data-stu-id="c2e08-119">Depending on the result you want, the first parameter, *pVoid*, can point to three different types of values: a [**SECURITY\_DESCRIPTOR**](/windows/desktop/api/winnt/ns-winnt-security_descriptor) , an [**IAccessControl**](/windows/desktop/api/IAccess/nn-iaccess-iaccesscontrol) object, or a pointer to an AppID.</span></span> <span data-ttu-id="c2e08-120">Na maioria dos casos, você usará as funções do Windows para criar um **\_ descritor de segurança** para o qual *pVoid* apontará.</span><span class="sxs-lookup"><span data-stu-id="c2e08-120">In most cases, you will use Windows functions to create a **SECURITY\_DESCRIPTOR** that *pVoid* will point to.</span></span>

<span data-ttu-id="c2e08-121">No entanto, o *pVoid* também pode apontar para um objeto [**IAccessControl**](/windows/desktop/api/IAccess/nn-iaccess-iaccesscontrol) .</span><span class="sxs-lookup"><span data-stu-id="c2e08-121">However, *pVoid* can also point to an [**IAccessControl**](/windows/desktop/api/IAccess/nn-iaccess-iaccesscontrol) object.</span></span>

<span data-ttu-id="c2e08-122">Para indicar a [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) que você está passando um objeto [**IAccessControl**](/windows/desktop/api/IAccess/nn-iaccess-iaccesscontrol) para *pVoid*, você deve passar o \_ valor de controle de acesso EOAC \_ para o parâmetro *dwCapabilities* .</span><span class="sxs-lookup"><span data-stu-id="c2e08-122">To indicate to [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) that you are passing an [**IAccessControl**](/windows/desktop/api/IAccess/nn-iaccess-iaccesscontrol) object to *pVoid*, you must pass the EOAC\_ACCESS\_CONTROL value to the *dwCapabilities* parameter.</span></span> <span data-ttu-id="c2e08-123">Como **CoInitializeSecurity** armazena em cache os resultados das verificações de acesso, a lista de controle de acesso não deve ser alterada depois de chamar **CoInitializeSecurity**.</span><span class="sxs-lookup"><span data-stu-id="c2e08-123">Since **CoInitializeSecurity** caches the results of access checks, the access control list must not be changed after calling **CoInitializeSecurity**.</span></span>

<span data-ttu-id="c2e08-124">Outro tipo de valor que você pode passar para o parâmetro *pVoid* é um ponteiro para um GUID, que é o AppID do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c2e08-124">Another type of value you can pass to the *pVoid* parameter is a pointer to a GUID, which is the AppID of your application.</span></span> <span data-ttu-id="c2e08-125">Se *pVoid* for um ponteiro para uma AppID, você deverá especificar EOAC \_ AppID no parâmetro *pCapabilities* para que a função saiba qual valor esperar em *pVoid*.</span><span class="sxs-lookup"><span data-stu-id="c2e08-125">If *pVoid* is a pointer to an AppID, you must specify EOAC\_APPID in the *pCapabilities* parameter so that the function knows what value to expect in *pVoid*.</span></span> <span data-ttu-id="c2e08-126">Se *pVoid* apontar para um AppID, [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) usará apenas o registro para valores de autenticação e ignorará todos os outros parâmetros para **CoInitializeSecurity**.</span><span class="sxs-lookup"><span data-stu-id="c2e08-126">If *pVoid* points to an AppID, [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) uses only the registry for authentication values and ignores all other parameters to **CoInitializeSecurity**.</span></span>

## <a name="related-topics"></a><span data-ttu-id="c2e08-127">Tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="c2e08-127">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="c2e08-128">Definindo Process-Wide segurança</span><span class="sxs-lookup"><span data-stu-id="c2e08-128">Setting Process-Wide Security</span></span>](setting-processwide-security.md)
</dt> </dl>

 

 