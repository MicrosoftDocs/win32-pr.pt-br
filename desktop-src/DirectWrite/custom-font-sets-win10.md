---
title: Conjuntos de fontes personalizados
description: Este tópico descreve várias maneiras em que você pode usar fontes personalizadas em seu aplicativo.
ms.assetid: 50842838-d150-df9a-f1b7-67ce5ea2bc80
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a79f1ccfcb1dadd355c5f582417aacb5041ecf8b
ms.sourcegitcommit: 89f99926f946dc6c5ea600fb7c41f6b19ceac516
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/21/2020
ms.locfileid: "104366901"
---
# <a name="custom-font-sets"></a><span data-ttu-id="23063-103">Conjuntos de fontes personalizados</span><span class="sxs-lookup"><span data-stu-id="23063-103">Custom Font Sets</span></span>

<span data-ttu-id="23063-104">Este tópico descreve várias maneiras em que você pode usar fontes personalizadas em seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="23063-104">This topic describes various ways in which you can use custom fonts in your app.</span></span>

-   [<span data-ttu-id="23063-105">Apresentações </span><span class="sxs-lookup"><span data-stu-id="23063-105">Introduction </span></span>](#introduction)
-   [<span data-ttu-id="23063-106">Resumo das APIs</span><span class="sxs-lookup"><span data-stu-id="23063-106">Summary of APIs</span></span>](#summary-of-apis)
-   [<span data-ttu-id="23063-107">Principais conceitos</span><span class="sxs-lookup"><span data-stu-id="23063-107">Key concepts</span></span>](#key-concepts)
-   [<span data-ttu-id="23063-108">Fontes e formatos de arquivo de fonte</span><span class="sxs-lookup"><span data-stu-id="23063-108">Fonts and font file formats</span></span>](#fonts-and-font-file-formats)
-   [<span data-ttu-id="23063-109">Conjuntos de fontes e coleções de fontes</span><span class="sxs-lookup"><span data-stu-id="23063-109">Font sets and font collections</span></span>](#font-sets-and-font-collections)
-   [<span data-ttu-id="23063-110">Cenários comuns</span><span class="sxs-lookup"><span data-stu-id="23063-110">Common scenarios</span></span>](#common-scenarios)
    -   [<span data-ttu-id="23063-111">Criando um conjunto de fontes usando fontes arbitrárias no sistema de arquivos local</span><span class="sxs-lookup"><span data-stu-id="23063-111">Creating a font set using arbitrary fonts in the local file system</span></span>](#creating-a-font-set-using-arbitrary-fonts-in-the-local-file-system)
    -   [<span data-ttu-id="23063-112">Criando um conjunto de fontes usando fontes conhecidas no sistema de arquivos local</span><span class="sxs-lookup"><span data-stu-id="23063-112">Creating a font set using known fonts in the local file system</span></span>](#creating-a-font-set-using-known-fonts-in-the-local-file-system)
    -   [<span data-ttu-id="23063-113">Criar um conjunto de fontes personalizado usando fontes remotas conhecidas na Web</span><span class="sxs-lookup"><span data-stu-id="23063-113">Creating a custom font set using known, remote fonts on the Web</span></span>](#creating-a-custom-font-set-using-known-remote-fonts-on-the-web)
    -   [<span data-ttu-id="23063-114">Criando um conjunto de fontes personalizado usando dados de fonte carregados na memória</span><span class="sxs-lookup"><span data-stu-id="23063-114">Creating a custom font set using font data loaded into memory</span></span>](#creating-a-custom-font-set-using-font-data-loaded-into-memory)
-   [<span data-ttu-id="23063-115">Cenários avançados</span><span class="sxs-lookup"><span data-stu-id="23063-115">Advanced scenarios</span></span>](#advanced-scenarios)
    -   [<span data-ttu-id="23063-116">Combinando conjuntos de fontes</span><span class="sxs-lookup"><span data-stu-id="23063-116">Combining font sets</span></span>](#combining-font-sets)
    -   [<span data-ttu-id="23063-117">Usando dados de fonte WOFF ou WOFF2 locais </span><span class="sxs-lookup"><span data-stu-id="23063-117">Using local WOFF or WOFF2 font data </span></span>](#using-local-woff-or-woff2-font-data)
    -   [<span data-ttu-id="23063-118">Usando mecanismos de fonte remota DirectWrite com implementação de rede de nível inferior personalizada </span><span class="sxs-lookup"><span data-stu-id="23063-118">Using DirectWrite remote font mechanisms with custom low-level network implementation </span></span>](#using-directwrite-remote-font-mechanisms-with-custom-low-level-network-implementation)
    -   [<span data-ttu-id="23063-119">Cenários de suporte em versões anteriores do Windows </span><span class="sxs-lookup"><span data-stu-id="23063-119">Supporting scenarios on earlier Windows versions </span></span>](#supporting-scenarios-on-earlier-windows-versions)

## <a name="introduction"></a><span data-ttu-id="23063-120">Introdução</span><span class="sxs-lookup"><span data-stu-id="23063-120">Introduction</span></span>

<span data-ttu-id="23063-121">Na maioria das vezes, os aplicativos usam as fontes que são instaladas localmente no sistema.</span><span class="sxs-lookup"><span data-stu-id="23063-121">Most of the time, apps use the fonts that are installed locally on the system.</span></span> <span data-ttu-id="23063-122">O DirectWrite fornece acesso a essas fontes usando os métodos [**IDWriteFactory3:: GetSystemFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-getsystemfontset) ou [**IDWriteFactory:: GetSystemFontCollection**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-getsystemfontcollection) .</span><span class="sxs-lookup"><span data-stu-id="23063-122">DirectWrite provides access to these fonts using the [**IDWriteFactory3::GetSystemFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-getsystemfontset) or [**IDWriteFactory::GetSystemFontCollection**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-getsystemfontcollection) methods.</span></span> <span data-ttu-id="23063-123">Em alguns casos, os aplicativos também podem querer usar fontes incluídas como parte do Windows 10, mas que não estão atualmente instaladas no sistema atual.</span><span class="sxs-lookup"><span data-stu-id="23063-123">In some cases, apps may also want to use fonts that are included as part of Windows 10 but that are not currently installed on the current system.</span></span> <span data-ttu-id="23063-124">Essas fontes podem ser acessadas do serviço de fontes do Windows usando o método **GetSystemFontSet** ou chamando [**IDWriteFactory3:: GetSystemFontCollection**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-getsystemfontcollection) com includeDownloadableFonts definido como true.</span><span class="sxs-lookup"><span data-stu-id="23063-124">Such fonts can be accessed from the Windows font service by using the **GetSystemFontSet** method, or by calling [**IDWriteFactory3::GetSystemFontCollection**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-getsystemfontcollection) with includeDownloadableFonts set to TRUE.</span></span> 

<span data-ttu-id="23063-125">Em alguns cenários de aplicativo, no entanto, os aplicativos precisam usar fontes que não estão instaladas no sistema e não são fornecidas pelo serviço de fontes do Windows.</span><span class="sxs-lookup"><span data-stu-id="23063-125">In some application scenarios, however, apps need to use fonts that are not installed in the system and are not provided by the Windows Font Service.</span></span> <span data-ttu-id="23063-126">Veja a seguir exemplos de tais cenários:</span><span class="sxs-lookup"><span data-stu-id="23063-126">The following are examples of such scenarios:</span></span>

-   <span data-ttu-id="23063-127">As fontes são inseridas como recursos dentro de um binário de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="23063-127">Fonts are embedded as resources within an app binary.</span></span>
-   <span data-ttu-id="23063-128">Os arquivos de fonte são agrupados em um pacote de aplicativo e armazenados em disco na pasta de instalação do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="23063-128">Font files are bundled within an app package and stored on disk under the app’s installation folder.</span></span>
-   <span data-ttu-id="23063-129">O aplicativo é uma ferramenta de desenvolvimento de fontes que precisa carregar arquivos de fonte especificados pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="23063-129">The app is a font-development tool that needs to load user-specified font files.</span></span> 
-   <span data-ttu-id="23063-130">As fontes são inseridas em arquivos de documento que podem ser exibidas ou editadas no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="23063-130">Fonts are embedded in document files that can be viewed or edited in the app.</span></span> 
-   <span data-ttu-id="23063-131">O aplicativo usa fontes obtidas de um serviço de fontes da Web pública.</span><span class="sxs-lookup"><span data-stu-id="23063-131">The app uses fonts obtained from a public Web font service.</span></span> 
-   <span data-ttu-id="23063-132">O aplicativo usa dados de fonte transmitidos por meio de um protocolo de rede privada.</span><span class="sxs-lookup"><span data-stu-id="23063-132">The app uses font data streamed via a private network protocol.</span></span> 

<span data-ttu-id="23063-133">O DirectWrite fornece APIs para trabalhar com fontes personalizadas nesses e em outros cenários semelhantes.</span><span class="sxs-lookup"><span data-stu-id="23063-133">DirectWrite provides APIs for working with custom fonts in these and other similar scenarios.</span></span> <span data-ttu-id="23063-134">Os dados de fonte personalizados podem vir de arquivos no sistema de arquivos local; de fontes remotas baseadas em nuvem acessadas usando HTTP; ou de fontes arbitrárias depois de terem sido carregadas em um buffer de memória.</span><span class="sxs-lookup"><span data-stu-id="23063-134">The custom font data might come from files in the local file system; from remote, cloud-based sources accessed using HTTP; or from arbitrary sources after having been loaded into a memory buffer.</span></span> 

> [!Note]  
> <span data-ttu-id="23063-135">Embora o DirectWrite tenha fornecido APIs para trabalhar com fontes personalizadas desde o Windows 7, as APIs mais recentes foram adicionadas no Windows 10 e novamente na atualização do Windows 10 para criadores (versão prévia 15021 ou posterior) que facilitam a implementação de vários dos cenários mencionados.</span><span class="sxs-lookup"><span data-stu-id="23063-135">While DirectWrite has provided APIs for working with custom fonts since Windows 7, newer APIs were added in Windows 10 and again in the Windows 10 Creators Update (preview build 15021 or later) that make it easier to implement several of the scenarios mentioned.</span></span> <span data-ttu-id="23063-136">Este tópico se concentra nas APIs disponíveis no Windows 10.</span><span class="sxs-lookup"><span data-stu-id="23063-136">This topic focuses on APIs available in Window 10.</span></span> <span data-ttu-id="23063-137">Para aplicativos que precisam trabalhar em versões anteriores do Windows, consulte [coleções de fontes personalizadas (Windows 7/8)](custom-font-collections.md).</span><span class="sxs-lookup"><span data-stu-id="23063-137">For applications that need to work on earlier Windows versions, see [Custom Font Collections (Windows 7/8)](custom-font-collections.md).</span></span> 

 

## <a name="summary-of-apis"></a><span data-ttu-id="23063-138">Resumo das APIs</span><span class="sxs-lookup"><span data-stu-id="23063-138">Summary of APIs</span></span>

<span data-ttu-id="23063-139">Este tópico se concentra na funcionalidade fornecida pelas seguintes APIs:</span><span class="sxs-lookup"><span data-stu-id="23063-139">This topic focuses on functionality provided by the following APIs:</span></span> 

-   <span data-ttu-id="23063-140">Interface [**IDWriteFontSet**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontset)</span><span class="sxs-lookup"><span data-stu-id="23063-140">[**IDWriteFontSet**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontset) interface</span></span>
-   <span data-ttu-id="23063-141">Interface [**IDWriteFontSetBuilder**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder)</span><span class="sxs-lookup"><span data-stu-id="23063-141">[**IDWriteFontSetBuilder**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder) interface</span></span>
-   <span data-ttu-id="23063-142">Interface [**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1)</span><span class="sxs-lookup"><span data-stu-id="23063-142">[**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1) interface</span></span> 
-   <span data-ttu-id="23063-143">Interface [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference)</span><span class="sxs-lookup"><span data-stu-id="23063-143">[**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) interface</span></span>
-   <span data-ttu-id="23063-144">Interface [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile)</span><span class="sxs-lookup"><span data-stu-id="23063-144">[**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) interface</span></span>
-   <span data-ttu-id="23063-145">Método [**IDWriteFactory:: CreateFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createfontfilereference)</span><span class="sxs-lookup"><span data-stu-id="23063-145">[**IDWriteFactory::CreateFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createfontfilereference) method</span></span> 
-   <span data-ttu-id="23063-146">Método [**IDWriteFactory:: CreateCustomFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontfilereference)</span><span class="sxs-lookup"><span data-stu-id="23063-146">[**IDWriteFactory::CreateCustomFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontfilereference) method</span></span> 
-   <span data-ttu-id="23063-147">Métodos [**IDWriteFactory3:: CreateFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontresource-createfontfacereference)</span><span class="sxs-lookup"><span data-stu-id="23063-147">[**IDWriteFactory3::CreateFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontresource-createfontfacereference) methods</span></span> 
-   <span data-ttu-id="23063-148">[**DWRITE \_ Estrutura da \_ propriedade de fonte**](/windows/win32/api/dwrite_3/ns-dwrite_3-dwrite_font_property)</span><span class="sxs-lookup"><span data-stu-id="23063-148">[**DWRITE\_FONT\_PROPERTY**](/windows/win32/api/dwrite_3/ns-dwrite_3-dwrite_font_property) structure</span></span> 
-   <span data-ttu-id="23063-149">[**DWRITE \_ Enumeração \_ de \_ ID de propriedade de fonte**](/windows/win32/api/dwrite_3/ne-dwrite_3-dwrite_font_property_id)</span><span class="sxs-lookup"><span data-stu-id="23063-149">[**DWRITE\_FONT\_PROPERTY\_ID**](/windows/win32/api/dwrite_3/ne-dwrite_3-dwrite_font_property_id) enumeration</span></span> 
-   <span data-ttu-id="23063-150">Interface [**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader)</span><span class="sxs-lookup"><span data-stu-id="23063-150">[**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader) interface</span></span> 
-   <span data-ttu-id="23063-151">Método [**IDWriteFactory:: RegisterFontFileLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-registerfontfileloader)</span><span class="sxs-lookup"><span data-stu-id="23063-151">[**IDWriteFactory::RegisterFontFileLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-registerfontfileloader) method</span></span> 
-   <span data-ttu-id="23063-152">Método [**IDWriteFactory:: UnregisterFontFileLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-unregisterfontfileloader)</span><span class="sxs-lookup"><span data-stu-id="23063-152">[**IDWriteFactory::UnregisterFontFileLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-unregisterfontfileloader) method</span></span> 
-   <span data-ttu-id="23063-153">Método [**IDWriteFactory5:: CreateInMemoryFontFileLoader**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-createinmemoryfontfileloader)</span><span class="sxs-lookup"><span data-stu-id="23063-153">[**IDWriteFactory5::CreateInMemoryFontFileLoader**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-createinmemoryfontfileloader) method</span></span> 
-   <span data-ttu-id="23063-154">Interface [**IDWriteInMemoryFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteinmemoryfontfileloader)</span><span class="sxs-lookup"><span data-stu-id="23063-154">[**IDWriteInMemoryFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteinmemoryfontfileloader) interface</span></span> 
-   <span data-ttu-id="23063-155">Método [**IDWriteFactory5:: CreateHttpFontFileLoader**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-createhttpfontfileloader)</span><span class="sxs-lookup"><span data-stu-id="23063-155">[**IDWriteFactory5::CreateHttpFontFileLoader**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-createhttpfontfileloader) method</span></span> 
-   <span data-ttu-id="23063-156">Interface [**IDWriteRemoteFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader)</span><span class="sxs-lookup"><span data-stu-id="23063-156">[**IDWriteRemoteFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader) interface</span></span> 
-   <span data-ttu-id="23063-157">Interface [**IDWriteFontDownloadQueue**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadqueue)</span><span class="sxs-lookup"><span data-stu-id="23063-157">[**IDWriteFontDownloadQueue**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadqueue) interface</span></span> 
-   <span data-ttu-id="23063-158">Interface [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener)</span><span class="sxs-lookup"><span data-stu-id="23063-158">[**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) interface</span></span> 
-   <span data-ttu-id="23063-159">Interface [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream)</span><span class="sxs-lookup"><span data-stu-id="23063-159">[**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) interface</span></span> 
-   <span data-ttu-id="23063-160">Interface [**IDWriteRemoteFontFileStream**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfilestream)</span><span class="sxs-lookup"><span data-stu-id="23063-160">[**IDWriteRemoteFontFileStream**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfilestream) interface</span></span> 
-   <span data-ttu-id="23063-161">Interface [**IDWriteAsyncResult**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteasyncresult)</span><span class="sxs-lookup"><span data-stu-id="23063-161">[**IDWriteAsyncResult**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteasyncresult) interface</span></span> 
-   <span data-ttu-id="23063-162">Método [**IDWriteFactory5:: AnalyzeContainerType**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-analyzecontainertype)</span><span class="sxs-lookup"><span data-stu-id="23063-162">[**IDWriteFactory5::AnalyzeContainerType**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-analyzecontainertype) method</span></span> 
-   <span data-ttu-id="23063-163">Método [**IDWriteFactory5:: UnpackFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-unpackfontfile)</span><span class="sxs-lookup"><span data-stu-id="23063-163">[**IDWriteFactory5::UnpackFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-unpackfontfile) method</span></span> 

 

## <a name="key-concepts"></a><span data-ttu-id="23063-164">Principais conceitos</span><span class="sxs-lookup"><span data-stu-id="23063-164">Key concepts</span></span>

<span data-ttu-id="23063-165">Para entender as APIs do DirectWrite para trabalhar com fontes personalizadas, pode ser útil entender o modelo conceitual subjacente a essas APIs.</span><span class="sxs-lookup"><span data-stu-id="23063-165">To understand the DirectWrite APIs for working with custom fonts, it can be helpful to understand the conceptual model that underlies these APIs.</span></span> <span data-ttu-id="23063-166">Os conceitos principais serão descritos aqui.</span><span class="sxs-lookup"><span data-stu-id="23063-166">Key concepts will be described here.</span></span> 

<span data-ttu-id="23063-167">Quando o DirectWrite faz o layout do texto real ou a renderização, ele precisa acessar os dados reais da fonte.</span><span class="sxs-lookup"><span data-stu-id="23063-167">When DirectWrite does actual text layout or rendering, it needs to access actual font data.</span></span> <span data-ttu-id="23063-168">Um objeto de face de fonte contém dados de fonte reais, que devem existir no sistema local.</span><span class="sxs-lookup"><span data-stu-id="23063-168">A font face object holds actual font data, which must exist in the local system.</span></span> <span data-ttu-id="23063-169">Mas, para outras operações, como verificar a disponibilidade de uma fonte específica ou apresentar opções de fonte a um usuário, tudo o que é necessário é uma referência a uma fonte específica, e não os próprios dados da fonte propriamente dito.</span><span class="sxs-lookup"><span data-stu-id="23063-169">But for other operations, such as checking availability of a particular font, or presenting font choices to a user, all that is needed is a reference to a particular font, not the actual font data itself.</span></span> <span data-ttu-id="23063-170">No DirectWrite, um objeto de referência de face de fonte contém apenas as informações necessárias para localizar e criar uma instância de uma fonte.</span><span class="sxs-lookup"><span data-stu-id="23063-170">In DirectWrite, a font face reference object holds just the information needed to locate and instantiate a font.</span></span> <span data-ttu-id="23063-171">Como a referência de face de fonte não contém dados reais, o DirectWrite pode lidar com referências de face de fonte para as quais os dados reais estão em um local de rede remota, bem como quando os dados reais são locais.</span><span class="sxs-lookup"><span data-stu-id="23063-171">Because the font face reference doesn’t hold actual data, DirectWrite can deal with font face references for which actual data is in a remote network location as well as when the actual data is local.</span></span>

<span data-ttu-id="23063-172">Um conjunto de fontes é um conjunto de referências de face de fonte, juntamente com determinadas propriedades básicas e informativas que podem ser usadas na referência à fonte ou na comparação com outras fontes, como o nome da família ou um valor de peso da fonte.</span><span class="sxs-lookup"><span data-stu-id="23063-172">A font set is a set of font face references, along with certain basic, informational properties that can be used in referring to the font or in comparing it to other fonts, such as the family name, or a font-weight value.</span></span> <span data-ttu-id="23063-173">Os dados reais para as várias fontes podem ser locais ou podem ser remotos ou ter alguma mistura.</span><span class="sxs-lookup"><span data-stu-id="23063-173">The actual data for the various fonts may be local, or it may all be remote, or some mixture.</span></span>

<span data-ttu-id="23063-174">Um conjunto de fontes pode ser usado para obter um objeto de coleção de fontes correspondente.</span><span class="sxs-lookup"><span data-stu-id="23063-174">A font set can be used to obtain a corresponding font collection object.</span></span> <span data-ttu-id="23063-175">Consulte conjuntos de fontes e coleções de fontes abaixo para obter mais detalhes.</span><span class="sxs-lookup"><span data-stu-id="23063-175">See Font sets and font collections below for more details.</span></span> 

<span data-ttu-id="23063-176">A interface IDWriteFontSet fornece métodos que permitem consultar valores de propriedade, como nome de família ou peso de fonte, ou para referências de face de fonte que correspondem a valores de propriedade específicos.</span><span class="sxs-lookup"><span data-stu-id="23063-176">The IDWriteFontSet interface provides methods that allow querying for property values such as family name or font-weight, or for font face references that match particular property values.</span></span> <span data-ttu-id="23063-177">Após a filtragem para uma seleção específica, uma instância da interface [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) pode ser obtida, com métodos para download (se os dados reais da fonte são remotos no momento), para obter o objeto [**IDWriteFontFace3**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontface3) correspondente que pode ser usado para layout e renderização.</span><span class="sxs-lookup"><span data-stu-id="23063-177">After filtering down to a particular selection, an instance of the [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) interface can be obtained, with methods for downloading (if the actual font data is currently remote), for obtaining the corresponding [**IDWriteFontFace3**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontface3) object that can be used for layout and rendering.</span></span> 

<span data-ttu-id="23063-178">A interface IDWriteFontFile baseia-se em cada face de fonte ou referência de face de fonte.</span><span class="sxs-lookup"><span data-stu-id="23063-178">The IDWriteFontFile interface underlies each font face or font face reference.</span></span> <span data-ttu-id="23063-179">Isso representa o local de um arquivo de fonte e tem dois componentes: um carregador de arquivo de fonte e uma chave de arquivo de fonte.</span><span class="sxs-lookup"><span data-stu-id="23063-179">This represents the location of a font file, and has two components: a font file loader, and a font file key.</span></span> <span data-ttu-id="23063-180">O [**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader)(carregador de arquivo de fonte) é usado para abrir um arquivo, se necessário, e retorna um fluxo com os dados ([**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream)).</span><span class="sxs-lookup"><span data-stu-id="23063-180">The font file loader ([**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader)) is used to open a file if needed, and returns a stream with the data ([**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream)).</span></span> <span data-ttu-id="23063-181">Dependendo do carregador, os dados podem estar localizados em um caminho de arquivo local, uma URL remota ou em um buffer de memória.</span><span class="sxs-lookup"><span data-stu-id="23063-181">Depending on the loader, the data may be located at a local file path, a remote URL, or in a memory buffer.</span></span> <span data-ttu-id="23063-182">A chave é um valor definido pelo carregador que identifica exclusivamente o arquivo dentro do contexto do carregador, permitindo que o carregador Localize os dados e crie um fluxo para ele.</span><span class="sxs-lookup"><span data-stu-id="23063-182">The key is a loader-defined value that uniquely identifies the file within the loader context, allowing the loader to locate the data and create a stream for it.</span></span> 

<span data-ttu-id="23063-183">As fontes personalizadas podem ser facilmente adicionadas a um conjunto de fontes personalizado que, por sua vez, podem ser usadas para filtrar ou organizar informações de fonte para fins como a criação de uma interface de usuário de seletor de fonte.</span><span class="sxs-lookup"><span data-stu-id="23063-183">Custom fonts can easily be added to a custom font set, which in turn can be used for filtering or organizing font information for purposes such as creating a font-picker user interface.</span></span> <span data-ttu-id="23063-184">O conjunto de fontes também pode ser usado para criar uma coleção de fontes para uso em APIs de nível superior, como [**IDWriteTextFormat**](/windows/win32/api/dwrite/nn-dwrite-idwritetextformat) e [**IDWriteTextLayout**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout).</span><span class="sxs-lookup"><span data-stu-id="23063-184">The font set can also be used to create a font collection for use in higher-level APIs like [**IDWriteTextFormat**](/windows/win32/api/dwrite/nn-dwrite-idwritetextformat) and [**IDWriteTextLayout**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout).</span></span> <span data-ttu-id="23063-185">A interface [**IDWriteFontSetBuilder**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder) pode ser usada para criar um conjunto de fontes personalizado que inclui várias fontes personalizadas.</span><span class="sxs-lookup"><span data-stu-id="23063-185">The [**IDWriteFontSetBuilder**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder) interface can be used to create a custom font set that includes several custom fonts.</span></span> <span data-ttu-id="23063-186">Ele também pode ser usado para criar um conjunto de fontes personalizado que combina fontes personalizadas e fontes fornecidas pelo sistema; ou que combina fontes com fontes diferentes para os dados reais — armazenamento local, URLs remotas e memória.</span><span class="sxs-lookup"><span data-stu-id="23063-186">It can also be used to create a custom font set that mixes custom fonts and system-provided fonts; or that mixes fonts with different sources for the actual data — local storage, remote URLs, and memory.</span></span> 

<span data-ttu-id="23063-187">Como mencionado, uma referência de face de fonte pode se referir a dados de fonte em uma fonte remota, mas os dados devem ser locais para obter um objeto de face de fonte que pode ser usado para layout e renderização.</span><span class="sxs-lookup"><span data-stu-id="23063-187">As mentioned, a font face reference may refer to font data at a remote source, but the data must be local in order to obtain a font face object that can be used for layout and rendering.</span></span> <span data-ttu-id="23063-188">O download de dados remotos é manipulado por uma fila de download de fontes.</span><span class="sxs-lookup"><span data-stu-id="23063-188">Downloading of remote data is handled by a font download queue.</span></span> <span data-ttu-id="23063-189">Os aplicativos podem usar a interface [**IDWriteFontDownloadQueue**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadqueue) para enfileirar solicitações para baixar fontes remotas para iniciar o processo de download e registrar um objeto [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) para executar uma ação quando o processo de download for concluído.</span><span class="sxs-lookup"><span data-stu-id="23063-189">Apps can use the [**IDWriteFontDownloadQueue**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadqueue) interface to enqueue requests to download remote fonts to initiate the download process, and to register an [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) object to take action when the download process has completed.</span></span> 

<span data-ttu-id="23063-190">Para a maioria das interfaces descritas aqui, o DirectWrite fornece implementações de sistema.</span><span class="sxs-lookup"><span data-stu-id="23063-190">For most of the interfaces described here, DirectWrite provides system implementations.</span></span> <span data-ttu-id="23063-191">A única exceção é a interface [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) , que um aplicativo implementa para tomar as ações específicas do aplicativo quando as fontes remotas são baixadas localmente.</span><span class="sxs-lookup"><span data-stu-id="23063-191">The one exception is the [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) interface, which an app implements to take app-specific actions when remote fonts have been downloaded locally.</span></span> <span data-ttu-id="23063-192">Os aplicativos podem ter motivo para fornecer suas próprias implementações personalizadas para determinadas outras interfaces, embora isso seja necessário apenas em cenários específicos e mais avançados.</span><span class="sxs-lookup"><span data-stu-id="23063-192">Apps may have reason to provide their own custom implementations for certain other interfaces, though that would only be needed in specific, more advanced scenarios.</span></span> <span data-ttu-id="23063-193">Por exemplo, um aplicativo precisaria fornecer uma implementação personalizada da interface [**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader) para manipular arquivos de fonte no armazenamento local que usam o formato de contêiner WOFF2.</span><span class="sxs-lookup"><span data-stu-id="23063-193">For example, an app would need to provide a custom implementation of the [**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader) interface to handle font files in local storage that use the WOFF2 container format.</span></span> <span data-ttu-id="23063-194">Detalhes adicionais serão fornecidos abaixo.</span><span class="sxs-lookup"><span data-stu-id="23063-194">Additional details will be provided below.</span></span> 

## <a name="fonts-and-font-file-formats"></a><span data-ttu-id="23063-195">Fontes e formatos de arquivo de fonte</span><span class="sxs-lookup"><span data-stu-id="23063-195">Fonts and font file formats</span></span>

<span data-ttu-id="23063-196">Outro conceito importante que é útil entender é a relação entre as faces de fonte individuais e os arquivos de fonte que os contêm.</span><span class="sxs-lookup"><span data-stu-id="23063-196">Another key concept that is helpful to understand is the relationship between individual font faces and font files that contain them.</span></span> <span data-ttu-id="23063-197">A ideia de um arquivo de fonte OpenType (. ttf ou. otf) que contém uma única fonte é familiar.</span><span class="sxs-lookup"><span data-stu-id="23063-197">The idea of an OpenType font file (.ttf or .otf) containing a single font is familiar.</span></span> <span data-ttu-id="23063-198">Mas o formato de fonte OpenType também permite uma coleção de fontes OpenType (. ttc ou. OTC), que é um único arquivo que contém várias fontes.</span><span class="sxs-lookup"><span data-stu-id="23063-198">But the OpenType font format also allows for an OpenType Font Collection (.ttc or .otc), which is a single file that contains multiple fonts.</span></span> <span data-ttu-id="23063-199">Os arquivos de coleção OpenType são frequentemente usados para fontes grandes que estão fortemente relacionadas e têm valores idênticos para determinados dados de fonte: ao combinar as fontes em um único arquivo, os dados comuns podem ser eliminados de duplicação.</span><span class="sxs-lookup"><span data-stu-id="23063-199">OpenType Collection files are often used for large fonts that are closely related and have identical values for certain font data: by combining the fonts in a single file, the common data can be de-duplicated.</span></span> <span data-ttu-id="23063-200">Por esse motivo, um tipo de fonte ou referência de face de fonte precisa fazer referência não apenas a um arquivo de fonte (ou fonte de dados equivalente), mas também deve especificar um índice de fonte dentro desse arquivo, para o caso geral em que o arquivo pode ser um arquivo de coleção.</span><span class="sxs-lookup"><span data-stu-id="23063-200">For this reason, a font face or font face reference needs to refer not only to a font file (or equivalent data source), but it must also specify a font index within that file, for the general case in which the file may be a Collection file.</span></span> 

<span data-ttu-id="23063-201">Para fontes usadas na Web, os dados de fonte geralmente são incluídos em determinados formatos de contêiner, WOFF ou WOFF2, que fornecem alguma compactação dos dados da fonte e algum nível de proteção contra pirataria e violação de licenças de fontes.</span><span class="sxs-lookup"><span data-stu-id="23063-201">For fonts used on the Web, font data is often packed into certain container formats, WOFF or WOFF2, which provide some compression of the font data and some level of protection against piracy and violation of font licenses.</span></span> <span data-ttu-id="23063-202">Funcionalmente, um arquivo WOFF ou WOFF2 é equivalente a uma fonte OpenType ou arquivo de coleção de fontes, mas os dados são codificados em um formato diferente que requer descompactação antes que possa ser usado.</span><span class="sxs-lookup"><span data-stu-id="23063-202">Functionally, a WOFF or WOFF2 file is equivalent to an OpenType font or Font Collection file, but the data is encoded in a different format that requires unpacking before it can be used.</span></span> 

<span data-ttu-id="23063-203">Certas APIs DirectWrite podem lidar com rostos de fontes individuais, enquanto outras APIs podem manipular arquivos que podem incluir arquivos de coleção OpenType que contêm várias faces.</span><span class="sxs-lookup"><span data-stu-id="23063-203">Certain DirectWrite APIs may deal with individual font faces, while other APIs can handle files that might include OpenType Collection files that contain multiple faces.</span></span> <span data-ttu-id="23063-204">Da mesma forma, certas APIs lidam apenas com dados brutos de formato OpenType, enquanto outras APIs podem lidar com os formatos de contêiner embalado, WOFF e WOFF2.</span><span class="sxs-lookup"><span data-stu-id="23063-204">Similarly, certain APIs deal only with raw, OpenType-format data, while other APIs can handle the packed, WOFF and WOFF2 container formats.</span></span> <span data-ttu-id="23063-205">Esses detalhes são fornecidos na discussão abaixo.</span><span class="sxs-lookup"><span data-stu-id="23063-205">These details are provided in the discussion below.</span></span> 

## <a name="font-sets-and-font-collections"></a><span data-ttu-id="23063-206">Conjuntos de fontes e coleções de fontes</span><span class="sxs-lookup"><span data-stu-id="23063-206">Font sets and font collections</span></span>

<span data-ttu-id="23063-207">Alguns aplicativos podem ser implementados para trabalhar com fontes usando a interface [**IDWriteFontCollection**](/windows/win32/api/dwrite/nn-dwrite-idwritefontcollection) .</span><span class="sxs-lookup"><span data-stu-id="23063-207">Some applications may be implemented to work with fonts using the [**IDWriteFontCollection**](/windows/win32/api/dwrite/nn-dwrite-idwritefontcollection) interface.</span></span> <span data-ttu-id="23063-208">Há uma correspondência direta entre uma coleção de fontes e um conjunto de fontes.</span><span class="sxs-lookup"><span data-stu-id="23063-208">There is a direct correspondence between a font collection and a font set.</span></span> <span data-ttu-id="23063-209">Cada uma pode conter as mesmas fontes, mas elas as apresentam com uma organização diferente.</span><span class="sxs-lookup"><span data-stu-id="23063-209">Each can hold the same fonts, but they present them with a different organization.</span></span> <span data-ttu-id="23063-210">De qualquer coleção de fontes, um conjunto de fontes correspondente pode ser obtido, e vice-versa.</span><span class="sxs-lookup"><span data-stu-id="23063-210">From any font collection, a corresponding font set can be obtained, and vice versa.</span></span>

<span data-ttu-id="23063-211">Ao trabalhar com várias fontes personalizadas, é mais fácil usar uma interface do construtor de conjunto de fontes para criar um conjunto de fontes personalizado e obter uma coleção de fontes após a criação do conjunto de fontes.</span><span class="sxs-lookup"><span data-stu-id="23063-211">When working with a number of custom fonts, it is easiest to use a font set builder interface to create a custom font set, and then obtain a font collection after the font set is created.</span></span> <span data-ttu-id="23063-212">O processo para criar um conjunto de fontes personalizado será descrito em detalhes abaixo.</span><span class="sxs-lookup"><span data-stu-id="23063-212">The process for creating a custom font set will be described in detail below.</span></span> <span data-ttu-id="23063-213">Para obter uma interface [**IDWriteFontCollection1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontcollection1) de um conjunto de fontes, o método [**IDWriteFactory3:: CreateFontCollectionFromFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-createfontcollectionfromfontset) é usado.</span><span class="sxs-lookup"><span data-stu-id="23063-213">To obtain an [**IDWriteFontCollection1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontcollection1) interface from a font set, the [**IDWriteFactory3::CreateFontCollectionFromFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-createfontcollectionfromfontset) method is used.</span></span>

<span data-ttu-id="23063-214">Se o aplicativo tiver um objeto de coleção e precisar obter um conjunto de fontes correspondente, isso poderá ser feito usando o método [**IDWriteFontCollection1:: Getfontset**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontcollection1-getfontset) .</span><span class="sxs-lookup"><span data-stu-id="23063-214">If the app has a collection object and needs to obtain a corresponding font set, this can be done using the [**IDWriteFontCollection1::GetFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontcollection1-getfontset) method.</span></span> 

## <a name="common-scenarios"></a><span data-ttu-id="23063-215">Cenários comuns</span><span class="sxs-lookup"><span data-stu-id="23063-215">Common scenarios</span></span>

<span data-ttu-id="23063-216">Esta seção descreve alguns dos cenários mais comuns que envolvem conjuntos de fontes personalizadas:</span><span class="sxs-lookup"><span data-stu-id="23063-216">This section describes some of the most common scenarios involving custom font sets:</span></span>

-   <span data-ttu-id="23063-217">Criar um conjunto de fontes personalizado usando fontes arbitrárias em caminhos no sistema de arquivos local.</span><span class="sxs-lookup"><span data-stu-id="23063-217">Creating a custom font set using arbitrary fonts at paths in the local file system.</span></span>
-   <span data-ttu-id="23063-218">Criar um conjunto de fontes personalizado usando fontes conhecidas (talvez agrupadas com o aplicativo) armazenadas no sistema de arquivos local.</span><span class="sxs-lookup"><span data-stu-id="23063-218">Creating a custom font set using known fonts (perhaps bundled with the app) that are stored in the local file system.</span></span>
-   <span data-ttu-id="23063-219">Criar um conjunto de fontes personalizado usando fontes remotas conhecidas na Web.</span><span class="sxs-lookup"><span data-stu-id="23063-219">Creating a custom font set using known, remote fonts on the Web.</span></span>
-   <span data-ttu-id="23063-220">Criar um conjunto de fontes personalizado usando dados de fonte carregados na memória.</span><span class="sxs-lookup"><span data-stu-id="23063-220">Creating a custom font set using font data loaded into memory.</span></span>

<span data-ttu-id="23063-221">Implementações completas para esses cenários são fornecidas no [exemplo de conjuntos de fontes personalizadas do DirectWrite](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/).</span><span class="sxs-lookup"><span data-stu-id="23063-221">Complete implementations for these scenarios are provided in the [DirectWrite Custom Font Sets sample](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/).</span></span> <span data-ttu-id="23063-222">Esse exemplo também ilustra um cenário mais avançado para manipulação de dados de fonte empacotados em formatos de contêiner WOFF ou WOFF2, que serão discutidos abaixo.</span><span class="sxs-lookup"><span data-stu-id="23063-222">That sample also illustrates one more advanced scenario for handling font data packed in WOFF or WOFF2 container formats, which will be discussed below.</span></span> 

### <a name="creating-a-font-set-using-arbitrary-fonts-in-the-local-file-system"></a><span data-ttu-id="23063-223">Criando um conjunto de fontes usando fontes arbitrárias no sistema de arquivos local</span><span class="sxs-lookup"><span data-stu-id="23063-223">Creating a font set using arbitrary fonts in the local file system</span></span>

<span data-ttu-id="23063-224">Ao lidar com um conjunto arbitrário de arquivos de fonte no armazenamento local, o método [**IDWriteFontSetBuilder1:: AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) é conveniente, já que, em uma única chamada, ele pode manipular todas as faces de fonte em um arquivo de coleção de fontes OpenType, bem como todas as instâncias para uma fonte de variável OpenType.</span><span class="sxs-lookup"><span data-stu-id="23063-224">When dealing with an arbitrary set of font files in local storage, the [**IDWriteFontSetBuilder1::AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) method is convenient since, in a single call, it can handle all of the font faces within an OpenType Font Collection file, as well as all instances for an OpenType variable font.</span></span> <span data-ttu-id="23063-225">Isso está disponível na atualização do Windows 10 para criadores (versão prévia 15021 ou posterior) e é recomendado sempre que disponível.</span><span class="sxs-lookup"><span data-stu-id="23063-225">This is available in the Windows 10 Creators Update (preview build 15021 or later), and is recommended whenever available.</span></span> 

<span data-ttu-id="23063-226">Para usar esse método, use o processo a seguir.</span><span class="sxs-lookup"><span data-stu-id="23063-226">To use this method, use the following process.</span></span>

<dl> <span data-ttu-id="23063-227">1. Comece criando a interface <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory5">IDWriteFactory5</a> :</span><span class="sxs-lookup"><span data-stu-id="23063-227">1. Start by creating the <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory5">IDWriteFactory5</a> interface:</span></span> 


```C++
IDWriteFactory5* pDWriteFactory; 
HRESULT hr = DWriteCreateFactory( 
  DWRITE_FACTORY_TYPE_SHARED, 
  __uuidof(IDWriteFactory5), 
  reinterpret_cast<IUnknown**>(&pDWriteFactory) 
); 
```



   
2. <span data-ttu-id="23063-228">Use a fábrica para obter a <a href=""></a> interface [**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1) :</span><span class="sxs-lookup"><span data-stu-id="23063-228">Use the factory to obtain the <a href=""></a>[**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1) interface:</span></span> 


```C++
IDWriteFontSetBuilder1* pFontSetBuilder; 
if (SUCCEEDED(hr)) 
{ 
  hr = pDWriteFactory->CreateFontSetBuilder(&pFontSetBuilder); 
}  
                
```



  
3. <span data-ttu-id="23063-229">Para cada arquivo de fonte no sistema de arquivos local, crie um [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) que se refira a ele:</span><span class="sxs-lookup"><span data-stu-id="23063-229">For each font file in the local file system, create an [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) that refers to it:</span></span> 


```C++
IDWriteFontFile* pFontFile; 
if (SUCCEEDED(hr)) 
{ 
  hr = pDWriteFactory->CreateFontFileReference(pFilePath, /* lastWriteTime*/ nullptr, &pFontFile); 
} 
```



   
4. <span data-ttu-id="23063-230">Adicione o objeto [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) ao construtor de conjunto de fontes usando o método [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) :</span><span class="sxs-lookup"><span data-stu-id="23063-230">Add the [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) object to the font set builder using the [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) method:</span></span> 


```C++
hr = pFontSetBuilder->AddFontFile(pFontFile); 
```

<span data-ttu-id="23063-231">Se o caminho do arquivo especificado na chamada para [**CreateFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createfontfilereference) tiver sido referenciado como algo diferente de um arquivo OpenType com suporte, a chamada para [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) retornará um erro, DWRITE \_ E \_ FileFormat.</span><span class="sxs-lookup"><span data-stu-id="23063-231">If the file path specified in the call to [**CreateFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createfontfilereference) referred to something other than a supported OpenType file, then the call to [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) will return an error, DWRITE\_E\_FILEFORMAT.</span></span>

5. <span data-ttu-id="23063-232">Depois que todos os arquivos tiverem sido adicionados ao construtor de conjunto de fontes, o conjunto de fontes personalizado poderá ser criado:</span><span class="sxs-lookup"><span data-stu-id="23063-232">After all of the files have been added to the font set builder, the custom font set can be created:</span></span> 


```C++
IDWriteFontSet* pFontSet; 
hr = pFontSetBuilder->CreateFontSet(&pFontSet); 
```



   
</dl>

<span data-ttu-id="23063-233">Se o aplicativo precisar ser executado em versões do Windows 10 anteriores à atualização do Windows 10 para criadores, o método AddFontFile não estará disponível.</span><span class="sxs-lookup"><span data-stu-id="23063-233">If the app needs to run on Windows 10 versions earlier than the Windows 10 Creators Update, then the AddFontFile method will not be available.</span></span> <span data-ttu-id="23063-234">A disponibilidade pode ser detectada criando-se uma interface [**IDWriteFactory3**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory3) e, em seguida, usando QueryInterface para tentar obter uma interface [**IDWriteFactory5**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory5) : se isso for bem sucedido, a interface [**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1) e o método [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) também estarão disponíveis.</span><span class="sxs-lookup"><span data-stu-id="23063-234">Availability can be detected by creating an [**IDWriteFactory3**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory3) interface and then using QueryInterface to try to obtain an [**IDWriteFactory5**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory5) interface: if this succeeds, then the [**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1) interface and [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) method will also be available.</span></span>

<span data-ttu-id="23063-235">Se o método AddFontFile não estiver disponível, o método [**IDWriteFontSetBuilder:: AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) deverá ser usado para adicionar rostos de fonte individuais.</span><span class="sxs-lookup"><span data-stu-id="23063-235">If the AddFontFile method is not available, then the [**IDWriteFontSetBuilder::AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) method must be used to add individual font faces.</span></span> <span data-ttu-id="23063-236">Para permitir arquivos de coleção de fontes OpenType que contenham várias faces, o método [**IDWriteFontFile:: Analyze**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfile-analyze) pode ser usado para determinar o número de rostos contidas no arquivo.</span><span class="sxs-lookup"><span data-stu-id="23063-236">To allow for OpenType Font Collection files that contain multiple faces, the [**IDWriteFontFile::Analyze**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfile-analyze) method can be used to determine the number of faces contained within the file.</span></span> <span data-ttu-id="23063-237">O processo é o seguinte.</span><span class="sxs-lookup"><span data-stu-id="23063-237">The process is as follows.</span></span>

<dl> <span data-ttu-id="23063-238">1. Comece criando a interface <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory3">IDWriteFactory3</a> :</span><span class="sxs-lookup"><span data-stu-id="23063-238">1. Start by creating the <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory3">IDWriteFactory3</a> interface:</span></span> 


```C++
IDWriteFactory3* pDWriteFactory; 
HRESULT hr = DWriteCreateFactory( 
DWRITE_FACTORY_TYPE_SHARED, 
  __uuidof(IDWriteFactory5), 
  reinterpret_cast<IUnknown**>(&pDWriteFactory) 
); 
```



  
2. <span data-ttu-id="23063-239">Use a fábrica para obter a interface [**IDWriteFontSetBuilder**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder) :</span><span class="sxs-lookup"><span data-stu-id="23063-239">Use the factory to obtain the [**IDWriteFontSetBuilder**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder) interface:</span></span> 


```C++
IDWriteFontSetBuilder* pFontSetBuilder; 
if (SUCCEEDED(hr)) 
{ 
  hr = pDWriteFactory->CreateFontSetBuilder(&pFontSetBuilder); 
} 
```



  
3. <span data-ttu-id="23063-240">Para cada arquivo de fonte, crie um [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile), como acima:</span><span class="sxs-lookup"><span data-stu-id="23063-240">For each font file, create an [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile), as above:</span></span> 


```C++
IDWriteFontFile* pFontFile; 
if (SUCCEEDED(hr)) 
{ 
  hr = pDWriteFactory->CreateFontFileReference(pFilePath, /* lastWriteTime*/ nullptr, &pFontFile); 
} 
```



<span data-ttu-id="23063-241">Em vez de adicionar o arquivo diretamente ao construtor de conjunto de fontes, precisamos determinar o número de rostos e criar objetos [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) individuais.</span><span class="sxs-lookup"><span data-stu-id="23063-241">Instead of adding the file directly to the font set builder, we need to determine the number of faces and create individual [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) objects.</span></span>   
4. <span data-ttu-id="23063-242">Use o método [**Analyze**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfile-analyze) para obter o número de faces no arquivo.</span><span class="sxs-lookup"><span data-stu-id="23063-242">Use the [**Analyze**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfile-analyze) method to get the number of faces in the file.</span></span> 


```C++
BOOL isSupported; 
DWRITE_FONT_FILE_TYPE fileType; 
UINT32 numberOfFonts; 
hr = pFontFile->Analyze(&isSupported, &fileType, /* face type */ nullptr, &numberOfFonts); 
```



<span data-ttu-id="23063-243">O método [**Analyze**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfile-analyze) também definirá valores para os parâmetros IsSupported e filetype.</span><span class="sxs-lookup"><span data-stu-id="23063-243">The [**Analyze**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfile-analyze) method will also set values for the isSupported and fileType parameters.</span></span> <span data-ttu-id="23063-244">Se o arquivo não for um formato com suporte, IsSupported será FALSE e a ação apropriada, como ignorar o arquivo, poderá ser executada.</span><span class="sxs-lookup"><span data-stu-id="23063-244">If the file is not a supported format, then isSupported will be FALSE, and appropriate action, such as ignoring the file, can be taken.</span></span>   
5. <span data-ttu-id="23063-245">Execute o loop sobre o número de fontes definidas no parâmetro numberOfFonts.</span><span class="sxs-lookup"><span data-stu-id="23063-245">Loop over the number of fonts set in the numberOfFonts parameter.</span></span> <span data-ttu-id="23063-246">Dentro do loop, crie um [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) para cada par de arquivo/índice e adicione-o ao construtor de conjunto de fontes.</span><span class="sxs-lookup"><span data-stu-id="23063-246">Within the loop, create an [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) for each file/index pair, and add that to the font set builder.</span></span> 


```C++
for (uint32_t fontIndex = 0; fontIndex < numberOfFonts; fontIndex++) 
{ 
  IDWriteFontFaceReference* pFontFaceReference;
  hr = pDWriteFactory->CreateFontFaceReference(pFontFile, fontIndex, DWRITE_FONT_SIMULATIONS_NONE, &pFontFaceReference);

  if (SUCCEEDED(hr))
  {
    hr = pFontSetBuilder->AddFontFaceReference(pFontFaceReference);
  }
} 
```



  
6. <span data-ttu-id="23063-247">Depois que todas as faces tiverem sido adicionadas ao construtor de conjunto de fontes, crie o conjunto de fontes personalizadas, conforme mostrado acima.</span><span class="sxs-lookup"><span data-stu-id="23063-247">After all the faces have been added to the font set builder, create the custom font set, as shown above.</span></span>  
</dl>

<span data-ttu-id="23063-248">Um aplicativo pode ser projetado para que use o método [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) preferencial ao ser executado na atualização do Windows 10 para criadores, mas volte a usar o método [**AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) ao ser executado em versões anteriores do Windows 10.</span><span class="sxs-lookup"><span data-stu-id="23063-248">An app can be designed so that it will use the preferred [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) method when running on the Windows 10 Creators Update, but fall back to use the [**AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) method when running on earlier Windows 10 versions.</span></span> <span data-ttu-id="23063-249">Teste a disponibilidade da interface [**IDWriteFactory5**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory5) , conforme descrito acima, e, em seguida, Branche de acordo.</span><span class="sxs-lookup"><span data-stu-id="23063-249">Test for availability of the [**IDWriteFactory5**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory5) interface, as described above, and then branch accordingly.</span></span> <span data-ttu-id="23063-250">Essa abordagem é ilustrada no [exemplo de conjuntos de fontes personalizadas do DirectWrite](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/).</span><span class="sxs-lookup"><span data-stu-id="23063-250">This approach is illustrated in the [DirectWrite Custom Font Sets sample](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/).</span></span> 

### <a name="creating-a-font-set-using-known-fonts-in-the-local-file-system"></a><span data-ttu-id="23063-251">Criando um conjunto de fontes usando fontes conhecidas no sistema de arquivos local</span><span class="sxs-lookup"><span data-stu-id="23063-251">Creating a font set using known fonts in the local file system</span></span>

<span data-ttu-id="23063-252">Conforme mencionado acima, cada referência de face de fonte em um conjunto de fontes está associada a determinadas propriedades informativas, como o nome da família e a espessura da fonte.</span><span class="sxs-lookup"><span data-stu-id="23063-252">As mentioned above, each font face reference in a font set is associated with certain informational properties, such as family name and font weight.</span></span> <span data-ttu-id="23063-253">Quando fontes personalizadas são adicionadas a um construtor de conjunto de fontes usando as chamadas de API listadas acima, essas propriedades informativas são obtidas diretamente dos dados reais da fonte, que são lidas à medida que a fonte é adicionada.</span><span class="sxs-lookup"><span data-stu-id="23063-253">When custom fonts are added to a font set builder using the API calls listed above, these informational properties are obtained directly from the actual font data, which is read as the font is added.</span></span> <span data-ttu-id="23063-254">Em algumas situações, no entanto, se um aplicativo tiver outra fonte de informações sobre uma fonte, talvez queira fornecer seus próprios valores personalizados para essas propriedades.</span><span class="sxs-lookup"><span data-stu-id="23063-254">In some situations, however, if an app has another source of information about a font, it might wish to provide its own custom values for these properties.</span></span> 

<span data-ttu-id="23063-255">Como um exemplo de como isso pode ser útil, suponha que um aplicativo agrupe algumas fontes que são usadas para apresentar elementos específicos da interface do usuário dentro do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="23063-255">As an example of how this might be useful, suppose an app bundles some fonts that are used for presenting particular user-interface elements within the app.</span></span> <span data-ttu-id="23063-256">Às vezes, como com uma nova versão do aplicativo, as fontes específicas que o aplicativo usa para esses elementos podem precisar ser alteradas.</span><span class="sxs-lookup"><span data-stu-id="23063-256">At times, such as with a new app version, the specific fonts that the app uses for these elements may need to change.</span></span> <span data-ttu-id="23063-257">Se o aplicativo tiver referências codificadas para as fontes específicas, a substituição de uma fonte por outra exigirá a alteração de cada uma dessas referências.</span><span class="sxs-lookup"><span data-stu-id="23063-257">If the app has encoded references to the specific fonts, then replacement of one font with another will require changing every one of those references.</span></span> <span data-ttu-id="23063-258">Em vez disso, se o aplicativo usar propriedades personalizadas para atribuir aliases funcionais com base no tipo de elemento ou texto que está sendo renderizado, o mapeará cada alias para uma fonte específica em um único lugar e, em seguida, usará os aliases em todos os contextos onde as fontes são criadas e manipuladas e, em seguida, a substituição de uma fonte por outra requer apenas a alteração</span><span class="sxs-lookup"><span data-stu-id="23063-258">Instead, if the app uses custom properties to assign functional aliases based on the type of element or text being rendered, maps each alias to a specific font in one place and then uses the aliases in all the contexts where fonts are created and manipulated, then replacing one font with another requires only changing the one place where the alias is mapped to a specific font.</span></span> 

<span data-ttu-id="23063-259">Valores personalizados para propriedades informativas podem ser atribuídos quando o método [**IDWriteFontSetBuilder:: AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) é chamado.</span><span class="sxs-lookup"><span data-stu-id="23063-259">Custom values for informational properties can be assigned when the [**IDWriteFontSetBuilder::AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) method is called.</span></span> <span data-ttu-id="23063-260">O método para fazer isso é o seguinte: Isso pode ser usado em qualquer versão do Windows 10.</span><span class="sxs-lookup"><span data-stu-id="23063-260">The method for doing this is as follows; this can be used on any Windows 10 version.</span></span> 

<span data-ttu-id="23063-261">Como mostrado acima, comece obtendo as interfaces [**IDWriteFactory3**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory3) e [**IDWriteFontSet**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontset) .</span><span class="sxs-lookup"><span data-stu-id="23063-261">As shown above, start by obtaining the [**IDWriteFactory3**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory3) and [**IDWriteFontSet**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontset) interfaces.</span></span> <span data-ttu-id="23063-262">Para cada face de fonte personalizada a ser adicionada, crie um [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference), como mostrado acima.</span><span class="sxs-lookup"><span data-stu-id="23063-262">For each custom font face to be added, create an [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference), as shown above.</span></span> <span data-ttu-id="23063-263">Antes que isso seja adicionado ao construtor de conjunto de fontes (dentro do loop na etapa 5, mostrado acima), no entanto, o aplicativo define os valores de propriedade personalizada a serem usados.</span><span class="sxs-lookup"><span data-stu-id="23063-263">Before this is added to the font set builder (within the loop in step 5, shown above), however, the app defines the custom property values to be used.</span></span> 

<span data-ttu-id="23063-264">Um conjunto de valores de propriedade personalizada é definido usando uma matriz de estruturas de [**\_ \_ propriedade de fonte DWRITE**](/windows/win32/api/dwrite_3/ns-dwrite_3-dwrite_font_property) .</span><span class="sxs-lookup"><span data-stu-id="23063-264">A set of custom property values is defined using an array of [**DWRITE\_FONT\_PROPERTY**](/windows/win32/api/dwrite_3/ns-dwrite_3-dwrite_font_property) structures.</span></span> <span data-ttu-id="23063-265">Cada um deles identifica uma determinada propriedade da enumeração [**de \_ \_ \_ ID da propriedade de fonte DWRITE**](/windows/win32/api/dwrite_3/ne-dwrite_3-dwrite_font_property_id) e o valor de propriedade correspondente a ser usado.</span><span class="sxs-lookup"><span data-stu-id="23063-265">Each of these identifies a particular property from the [**DWRITE\_FONT\_PROPERTY\_ID**](/windows/win32/api/dwrite_3/ne-dwrite_3-dwrite_font_property_id) enum, and the corresponding property value that is to be used.</span></span>  

<span data-ttu-id="23063-266">Observe que todos os valores de propriedade são atribuídos como cadeias de caracteres.</span><span class="sxs-lookup"><span data-stu-id="23063-266">Note that all property values are assigned as strings.</span></span> <span data-ttu-id="23063-267">Se eles podem ser exibidos posteriormente para os usuários, os valores alternativos para uma determinada propriedade para diferentes idiomas podem ser definidos, mas isso não é necessário.</span><span class="sxs-lookup"><span data-stu-id="23063-267">If these may later be displayed to users, then alternate values for a given property for different languages may be set, but this is not required.</span></span> <span data-ttu-id="23063-268">Observe também que, se qualquer valor de propriedade personalizada for definido pelo aplicativo, somente os valores especificados serão usados dentro do conjunto de fontes; DirectWrite não derivará nenhum valor diretamente da fonte para as propriedades informativas usadas em um conjunto de fontes.</span><span class="sxs-lookup"><span data-stu-id="23063-268">Also note that if any custom property values are set by the app, then only those values that are specified will be used within the Font set; DirectWrite will not derive any values directly from the font for informational properties used in a font set.</span></span> 

<span data-ttu-id="23063-269">O exemplo a seguir define valores personalizados para três propriedades informativas: nome da família, nome completo e espessura da fonte.</span><span class="sxs-lookup"><span data-stu-id="23063-269">The following example defines custom values for three informational properties: family name, full name, and font weight.</span></span> 


```C++
DWRITE_FONT_PROPERTY props[] = 
{ 
  { DWRITE_FONT_PROPERTY_ID_FAMILY_NAME, L"My Icon Font", L"en-US" }, 
  { DWRITE_FONT_PROPERTY_ID_FULL_NAME, L"My Icon Font", L"en-US" }, 
  { DWRITE_FONT_PROPERTY_ID_WEIGHT, L"400", nullptr } 
}; 
               
            
```



<span data-ttu-id="23063-270">Depois de definir a matriz desejada de valores de propriedade para uma fonte, faça uma chamada para AddFontFaceRefence, passando a matriz de propriedade, bem como a referência de face de fonte.</span><span class="sxs-lookup"><span data-stu-id="23063-270">After defining the desired array of property values for a font, make a call to AddFontFaceRefence, passing the property array as well as the font face reference.</span></span> 


```C++
hr = pFontSetBuilder->AddFontFaceReference(pFontFaceReference, props, ARRAYSIZE(props)); 
```



 

<span data-ttu-id="23063-271">Depois que todas as faces de fontes personalizadas tiverem sido adicionadas ao construtor de conjunto de fontes, junto com suas propriedades personalizadas, crie o conjunto de fontes personalizadas, conforme mostrado acima.</span><span class="sxs-lookup"><span data-stu-id="23063-271">Once all custom font faces have been added to the font set builder, along with their custom properties, create the custom font set, as shown above.</span></span> 

### <a name="creating-a-custom-font-set-using-known-remote-fonts-on-the-web"></a><span data-ttu-id="23063-272">Criar um conjunto de fontes personalizado usando fontes remotas conhecidas na Web</span><span class="sxs-lookup"><span data-stu-id="23063-272">Creating a custom font set using known, remote fonts on the Web</span></span>

<span data-ttu-id="23063-273">As propriedades personalizadas são importantes para trabalhar com fontes remotas.</span><span class="sxs-lookup"><span data-stu-id="23063-273">Custom properties are important for working with remote fonts.</span></span> <span data-ttu-id="23063-274">Cada referência de face de fonte deve ter algumas propriedades informativas para caracterizar a fonte e distingui-la de outras fontes.</span><span class="sxs-lookup"><span data-stu-id="23063-274">Each font face reference must have some informational properties to characterize the font and distinguish it from other fonts.</span></span> <span data-ttu-id="23063-275">Como os dados de fonte para fontes remotas não são locais, DirectWrite não pode derivar propriedades diretamente dos dados da fonte.</span><span class="sxs-lookup"><span data-stu-id="23063-275">Since the font data for remote fonts is not local, DirectWrite cannot derive properties directly from the font data.</span></span> <span data-ttu-id="23063-276">Portanto, as propriedades devem ser fornecidas explicitamente ao adicionar uma fonte remota ao construtor de conjunto de fontes.</span><span class="sxs-lookup"><span data-stu-id="23063-276">Hence, properties must be provided explicitly when adding a remote font to the font set builder.</span></span>

<span data-ttu-id="23063-277">A sequência de chamadas à API para adicionar fontes remotas a um conjunto de fontes é semelhante à sequência descrita para o cenário anterior.</span><span class="sxs-lookup"><span data-stu-id="23063-277">The sequence of API calls for adding remote fonts to a font set is similar to the sequence described for the previous scenario.</span></span> <span data-ttu-id="23063-278">No entanto, como os dados da fonte são remotos, as operações envolvidas na leitura dos dados reais da fonte serão diferentes do que ao trabalhar com arquivos no armazenamento local.</span><span class="sxs-lookup"><span data-stu-id="23063-278">Since the font data is remote, however, the operations involved for reading the actual font data will be different than when working with files in local storage.</span></span> <span data-ttu-id="23063-279">Para essa situação, uma nova interface de nível inferior, [**IDWriteRemoteFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader), foi adicionada à atualização do Windows 10 para criadores.</span><span class="sxs-lookup"><span data-stu-id="23063-279">For this situation, a new lower-level interface, [**IDWriteRemoteFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader), has been added in the Windows 10 Creators Update.</span></span> 

<span data-ttu-id="23063-280">Para usar o carregador de arquivo de fonte remoto, ele deve primeiro ser registrado com uma fábrica DirectWrite.</span><span class="sxs-lookup"><span data-stu-id="23063-280">To use the remote font file loader, it must first be registered with a DirectWrite factory.</span></span> <span data-ttu-id="23063-281">O carregador precisará ser mantido pelo aplicativo enquanto as fontes associadas a ele estiverem sendo usadas.</span><span class="sxs-lookup"><span data-stu-id="23063-281">The loader will need to be held by the app for as long as the fonts associated with it are being used.</span></span> <span data-ttu-id="23063-282">Depois que as fontes não estiverem mais em uso e em algum momento antes que a fábrica seja destruída, o carregador deverá ter o registro cancelado.</span><span class="sxs-lookup"><span data-stu-id="23063-282">Once the fonts are no longer in use, and at some point before the factory is destroyed, the loader must be unregistered.</span></span> <span data-ttu-id="23063-283">Isso pode ser feito no destruidor para a classe que possui o objeto Loader.</span><span class="sxs-lookup"><span data-stu-id="23063-283">This can be done in the destructor for the class that owns the loader object.</span></span> <span data-ttu-id="23063-284">Essas etapas serão mostradas abaixo.</span><span class="sxs-lookup"><span data-stu-id="23063-284">These steps will be shown below.</span></span> 

<span data-ttu-id="23063-285">O método para criar um conjunto de fontes personalizado usando fontes remotas é o seguinte: Isso requer a atualização do Windows 10 para criadores.</span><span class="sxs-lookup"><span data-stu-id="23063-285">The method for creating a custom font set using remote fonts is as follows; this requires the Windows 10 Creators Update.</span></span>  

<dl> <span data-ttu-id="23063-286">1. Crie uma interface IDWriteFactory5, conforme mostrado acima.</span><span class="sxs-lookup"><span data-stu-id="23063-286">1. Create an IDWriteFactory5 interface, as shown above.</span></span>   
<span data-ttu-id="23063-287">2. Crie uma interface <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder">IDWriteFontSetBuilder</a> , conforme mostrado acima.</span><span class="sxs-lookup"><span data-stu-id="23063-287">2. Create an <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder">IDWriteFontSetBuilder</a> interface, as shown above.</span></span>   
<span data-ttu-id="23063-288">3. Use a fábrica para obter um <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader">IDWriteRemoteFontFileLoader</a>.</span><span class="sxs-lookup"><span data-stu-id="23063-288">3. Use the factory to obtain an <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader">IDWriteRemoteFontFileLoader</a>.</span></span> 


```C++
IDWriteRemoteFontFileLoader* pRemoteFontFileLoader; 
if (SUCCEEDED(hr)) 
{ 
    hr = pDWriteFactory->CreateHttpFontFileLoader( 
        /* referrerURL */ nullptr, 
        /* extraHeaders */ nullptr, 
        &pRemoteFontFileLoader 
    ); 
} 
```



<span data-ttu-id="23063-289">Isso retorna uma implementação fornecida pelo sistema da interface do carregador de arquivo de fonte remoto que é capaz de lidar com as interações de HTTP para baixar dados de fonte em nome do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="23063-289">This returns a system-provided implementation of the remote font file loader interface that is able to handle HTTP interactions for downloading font data on behalf of the app.</span></span> <span data-ttu-id="23063-290">Uma URL de referencial ou cabeçalhos extras podem ser especificados se exigido pelo serviço de fonte ou serviços que são a origem das fontes.</span><span class="sxs-lookup"><span data-stu-id="23063-290">A referrer URL or extra headers can be specified if required by the font service or services that are the source for the fonts.</span></span>    

> [!IMPORTANT]
> <span data-ttu-id="23063-291">Observação de segurança: quando é feita uma tentativa de buscar uma fonte remota, o potencial existe para um invasor falsificar o servidor desejado que será chamado.</span><span class="sxs-lookup"><span data-stu-id="23063-291">Security note: When an attempt is made to fetch a remote font, the potential exists for an attacker to spoof the intended server that will be called.</span></span> <span data-ttu-id="23063-292">Nesse caso, as URLs de destino e referenciador e os detalhes do cabeçalho seriam divulgados para o invasor.</span><span class="sxs-lookup"><span data-stu-id="23063-292">In that case, the target and referrer URLs and header details would be disclosed to the attacker.</span></span> <span data-ttu-id="23063-293">Os desenvolvedores de aplicativos são responsáveis por mitigar esse risco.</span><span class="sxs-lookup"><span data-stu-id="23063-293">App developers are responsible for mitigating this risk.</span></span> <span data-ttu-id="23063-294">O uso do protocolo HTTPS, em vez de HTTP, é recomendado.</span><span class="sxs-lookup"><span data-stu-id="23063-294">Use of the HTTPS protocol, rather than HTTP, is recommended.</span></span> 

 

<span data-ttu-id="23063-295">Um único carregador de arquivo de fonte remoto pode ser usado para várias fontes, embora carregadores diferentes possam ser usados se as fontes forem obtidas de vários serviços que têm requisitos diferentes para URL referencial ou cabeçalhos adicionais.</span><span class="sxs-lookup"><span data-stu-id="23063-295">A single remote font file loader can be used for multiple fonts, though different loaders can be used if fonts are obtained from multiple services that have different requirements for referrer URL or extra headers.</span></span>   
4. <span data-ttu-id="23063-296">Registre o carregador de arquivo de fonte remoto com a fábrica.</span><span class="sxs-lookup"><span data-stu-id="23063-296">Register the remote font file loader with the factory.</span></span> 


```C++
 if (SUCCEEDED(hr)) 
 { 
     hr = pDWriteFactory->RegisterFontFileLoader(pRemoteFontFileLoader); 
 } 
```



<span data-ttu-id="23063-297">A partir desse ponto, as etapas para criar o conjunto de fontes personalizadas são semelhantes àquelas descritas para arquivos de fontes locais conhecidos, com duas exceções importantes.</span><span class="sxs-lookup"><span data-stu-id="23063-297">From this point, the steps for creating the custom font set are similar to those described for known, local font files, with two important exceptions.</span></span> <span data-ttu-id="23063-298">Primeiro, o objeto [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) é criado usando a interface do carregador do arquivo de fonte remoto em vez de usar a fábrica.</span><span class="sxs-lookup"><span data-stu-id="23063-298">First, the [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) object is created using the remote font file loader interface rather than using the factory.</span></span> <span data-ttu-id="23063-299">Em segundo lugar, o método Analyze não pode ser usado porque os dados da fonte não são locais.</span><span class="sxs-lookup"><span data-stu-id="23063-299">Second, the Analyze method cannot be used since the font data is not local.</span></span> <span data-ttu-id="23063-300">Em vez disso, o aplicativo deve saber se o arquivo de fonte remoto é um arquivo de coleção de fontes OpenType e, nesse caso, ele deve saber qual das fontes dentro da coleção será usada e o índice de cada um.</span><span class="sxs-lookup"><span data-stu-id="23063-300">Instead, the app must know whether the remote font file is an OpenType Font Collection file, and if so, then it must know which of the fonts within the collection it will use, and the index for each.</span></span> <span data-ttu-id="23063-301">Portanto, as etapas restantes são as seguintes.</span><span class="sxs-lookup"><span data-stu-id="23063-301">Hence, the remaining steps are as follows.</span></span>   
5. <span data-ttu-id="23063-302">Para cada arquivo de fonte remoto, use a interface do carregador de arquivo de fonte remoto para criar um [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile), ESPECIFICANDO a URL necessária para acessar o arquivo de fonte.</span><span class="sxs-lookup"><span data-stu-id="23063-302">For each remote font file, use the remote font file loader interface to create an [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile), specifying the URL required to access the font file.</span></span> 


```C++
 IDWriteFontFile* pFontFile; 
 hr = pRemoteFontFileLoader->CreateFontFileReferenceFromUrl( 
     pDWriteFactory, 
     /* baseUrl */ L"https://github.com/", 
     /* fontFileUrl */ L"winjs/winjs/blob/master/src/fonts/Symbols.ttf?raw=true", 
     &pFontFile 
 ); 
```



<span data-ttu-id="23063-303">Observe que a URL completa pode ser especificada no parâmetro fontFileUrl ou pode ser dividida em partes base e relativas.</span><span class="sxs-lookup"><span data-stu-id="23063-303">Note that the complete URL can be specified in the fontFileUrl parameter, or it can be split into base and relative portions.</span></span> <span data-ttu-id="23063-304">Se uma URL base for especificada, a concatenação dos valores de baseUrl e fontFileUrl deverá fornecer a URL completa — DirectWrite não fornecerá nenhum delimitador adicional.</span><span class="sxs-lookup"><span data-stu-id="23063-304">If a base URL is specified, then the concatenation of the baseUrl and fontFileUrl values must provide the complete URL — DirectWrite will not supply any additional delimiter.</span></span>  

> [!IMPORTANT]
> <span data-ttu-id="23063-305">Observação de segurança/desempenho: quando é feita uma tentativa de buscar uma fonte remota, não há nenhuma garantia de que o Windows receberá uma resposta do servidor.</span><span class="sxs-lookup"><span data-stu-id="23063-305">Security / performance note: When an attempt is made to fetch a remote font, there is no guarantee that Windows will receive a response from the server.</span></span> <span data-ttu-id="23063-306">Em alguns casos, um servidor pode responder com um erro de arquivo não encontrado para uma URL relativa inválida, mas parar de responder se receber várias solicitações inválidas.</span><span class="sxs-lookup"><span data-stu-id="23063-306">In some cases, a server may respond with a file-not-found error for an invalid relative URL, but stop responding if it receives multiple invalid requests.</span></span> <span data-ttu-id="23063-307">Se o servidor não responder, o Windows eventualmente atingirá o tempo limite, embora isso possa levar vários minutos se várias buscas forem iniciadas.</span><span class="sxs-lookup"><span data-stu-id="23063-307">If the server does not respond, Windows will eventually time out, though this may take several minutes if multiple fetches are initiated.</span></span> <span data-ttu-id="23063-308">Você deve fazer o que é possível para garantir que as URLs serão válidas quando forem feitas chamadas.</span><span class="sxs-lookup"><span data-stu-id="23063-308">You should do what you can to ensure that URLs will be valid when calls are made.</span></span> 

 

<span data-ttu-id="23063-309">Observe também que a URL pode apontar para um arquivo de fonte OpenType bruto (. ttf,. OTF,. TTC,. OTC), mas também pode apontar para fontes em um arquivo de contêiner WOFF ou WOFF2.</span><span class="sxs-lookup"><span data-stu-id="23063-309">Also note that the URL can point to a raw OpenType font file (.ttf, .otf, .ttc, .otc), but it can also point to fonts in a WOFF or WOFF2 container file.</span></span> <span data-ttu-id="23063-310">Se um arquivo WOFF ou WOFF2 for referenciado, a implementação DirectWrite do carregador de arquivo de fonte remoto descompactará automaticamente os dados da fonte do arquivo de contêiner.</span><span class="sxs-lookup"><span data-stu-id="23063-310">If a WOFF or WOFF2 file is referenced, then the DirectWrite implementation of the remote font file loader will automatically unpack the font data from the container file.</span></span>   
6. <span data-ttu-id="23063-311">Para cada índice de face de fonte dentro do arquivo de fonte remoto que será usado, crie um [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference).</span><span class="sxs-lookup"><span data-stu-id="23063-311">For each font face index within the remote font file that is to be used, create an [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference).</span></span> 


```C++
 IDWriteFontFaceReference* pFontFaceReference; 
 hr = pDWriteFactory->CreateFontFaceReference(pFontFile, /* faceIndex */ 0, DWRITE_FONT_SIMULATIONS_NONE, &pFontFaceReference);
```



  
7. <span data-ttu-id="23063-312">Defina propriedades personalizadas para a face da fonte, conforme mostrado acima.</span><span class="sxs-lookup"><span data-stu-id="23063-312">Define custom properties for the font face, as shown above.</span></span>   
8. <span data-ttu-id="23063-313">Adicione a referência de face de fonte junto com as propriedades personalizadas ao construtor de conjunto de fontes, conforme mostrado acima.</span><span class="sxs-lookup"><span data-stu-id="23063-313">Add the font face reference along with custom properties to the font set builder, as shown above.</span></span>   
9. <span data-ttu-id="23063-314">Depois que todas as fontes tiverem sido adicionadas ao construtor de conjunto de fontes, crie o conjunto de fontes, como mostrado acima.</span><span class="sxs-lookup"><span data-stu-id="23063-314">After all fonts have been added to the font set builder, create the font set, as shown above.</span></span>   
10. <span data-ttu-id="23063-315">Em algum momento, quando as fontes remotas não serão mais usadas, cancele o registro do carregador de arquivo de fonte remoto.</span><span class="sxs-lookup"><span data-stu-id="23063-315">At some point when the remote fonts will no longer be used, unregister the remote font file loader.</span></span> 


```C++
hr = pDWriteFactory->UnregisterFontFileLoader(pRemoteFontFileLoader); 
```



  
</dl>

<span data-ttu-id="23063-316">Depois que um conjunto de fontes personalizadas com fontes remotas personalizadas é criado, o conjunto de fontes contém referências e propriedades informativas para as fontes remotas, mas os dados reais ainda são remotos.</span><span class="sxs-lookup"><span data-stu-id="23063-316">Once a custom font set with custom remote fonts is created, the font set contains references and informational properties for the remote fonts, but the actual data is still remote.</span></span> <span data-ttu-id="23063-317">O suporte do DirectWrite para fontes remotas permite que uma referência de face de fonte seja mantida no conjunto de fontes e que uma fonte seja selecionada para uso no layout e na renderização, mas que os dados reais não sejam baixados até que haja uma necessidade real de usá-lo, como quando o layout de texto será executado.</span><span class="sxs-lookup"><span data-stu-id="23063-317">DirectWrite support for remote fonts allows a font face reference to be maintained in the font set, and for a font to be selected for use in layout and rendering, but that the actual data is not downloaded until there is an actual need to use it, such as when text layout will be performed.</span></span>  

<span data-ttu-id="23063-318">Um aplicativo pode usar uma abordagem antecipada solicitando que o DirectWrite Baixe os dados da fonte e, em seguida, aguardando a confirmação de um download bem-sucedido antes que qualquer processamento com a fonte seja iniciado.</span><span class="sxs-lookup"><span data-stu-id="23063-318">An app can take an up-front approach by requesting that DirectWrite download the font data and then waiting for confirmation of a successful download before any processing with the font is begun.</span></span> <span data-ttu-id="23063-319">Mas um download de rede implica alguma latência de duração imprevisível e o sucesso também é incerto.</span><span class="sxs-lookup"><span data-stu-id="23063-319">But a network download implies some latency of unpredictable duration, and success is also uncertain.</span></span> <span data-ttu-id="23063-320">Por esse motivo, geralmente será melhor usar uma abordagem diferente, permitindo que o layout e a renderização sejam feitos inicialmente usando fontes alternativas ou de fallback que já são locais, ao mesmo tempo que solicita o download da fonte desejada e remota em paralelo e, em seguida, atualizando os resultados depois que a fonte desejada tiver sido baixada.</span><span class="sxs-lookup"><span data-stu-id="23063-320">For this reason, it will usually be better to take a different approach, allowing layout and rendering to be done initially using alternate or fallback fonts that are already local, while requesting download of the desired, remote font in parallel, and then updating the results once the desired font has been downloaded.</span></span> 

<span data-ttu-id="23063-321">Para solicitar que toda a fonte seja baixada antes de ser usada, o método [**IDWriteFontFaceReference:: EnqueueFontDownloadRequest**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontfacereference-enqueuefontdownloadrequest) pode ser usado.</span><span class="sxs-lookup"><span data-stu-id="23063-321">To request that the entire font be downloaded before it gets used, the [**IDWriteFontFaceReference::EnqueueFontDownloadRequest**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontfacereference-enqueuefontdownloadrequest) method can be used.</span></span> <span data-ttu-id="23063-322">Se a fonte for muito grande, somente uma parte dos dados poderá ser necessária para o processamento de cadeias de caracteres específicas.</span><span class="sxs-lookup"><span data-stu-id="23063-322">If the font is very large, only a portion of the data may be needed for processing particular strings.</span></span> <span data-ttu-id="23063-323">O DirectWrite fornece métodos adicionais que podem ser usados para solicitar partes dos dados de fonte necessários para um determinado conteúdo, [**EnqueueCharacterDownloadRequest**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontfacereference-enqueuecharacterdownloadrequest) e [**EnqueueGlyphDownloadRequest**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontfacereference-enqueueglyphdownloadrequest).</span><span class="sxs-lookup"><span data-stu-id="23063-323">DirectWrite provides additional methods that can be used to request portions of the font data needed for particular content, [**EnqueueCharacterDownloadRequest**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontfacereference-enqueuecharacterdownloadrequest) and [**EnqueueGlyphDownloadRequest**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontfacereference-enqueueglyphdownloadrequest).</span></span>  

<span data-ttu-id="23063-324">Suponha que a abordagem seja executada no aplicativo para permitir que o processamento seja feito inicialmente usando fontes locais, alternativas ou de fallback.</span><span class="sxs-lookup"><span data-stu-id="23063-324">Suppose the approach to be taken in the app is to allow processing to be done initially using local, alternate or fallback fonts.</span></span> <span data-ttu-id="23063-325">O método IDWriteFontFallback::[**MapCharacters**](idwritefontfallback-mapcharacters.md) pode ser usado para identificar fontes de fallback locais e também enfileirará automaticamente uma solicitação para baixar a fonte preferida.</span><span class="sxs-lookup"><span data-stu-id="23063-325">The IDWriteFontFallback::[**MapCharacters**](idwritefontfallback-mapcharacters.md) method can be used to identify local fallback fonts, and it will also automatically enqueue a request to download the preferred font.</span></span> <span data-ttu-id="23063-326">Além disso, se [**IDWriteTextLayout**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout) for usado e algum ou todo o texto no layout for formatado usando uma referência de fonte remota, o DirectWrite usará automaticamente o método **MapCharacters** para obter fontes de fallback locais e enfileirar uma solicitação para baixar os dados da fonte remota.</span><span class="sxs-lookup"><span data-stu-id="23063-326">Also, if [**IDWriteTextLayout**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout) is used and some or all of the text in the layout is formatted using a remote font reference, then DirectWrite will automatically use the **MapCharacters** method to get local fallback fonts and to enqueue a request to download the remote font data.</span></span> 

<span data-ttu-id="23063-327">O DirectWrite mantém uma fila de download de fontes para cada fábrica e as solicitações feitas usando os métodos mencionados acima são adicionadas a essa fila.</span><span class="sxs-lookup"><span data-stu-id="23063-327">DirectWrite maintains a font download queue for each factory, and the requests made using the methods mentioned above get added to that queue.</span></span> <span data-ttu-id="23063-328">A fila de download de fontes pode ser obtida usando o método [**IDWriteFactory3:: GetFontDownloadQueue**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-getfontdownloadqueue) .</span><span class="sxs-lookup"><span data-stu-id="23063-328">The font download queue can be obtained using the [**IDWriteFactory3::GetFontDownloadQueue**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-getfontdownloadqueue) method.</span></span> 

<span data-ttu-id="23063-329">Se uma solicitação de download for feita, mas os dados da fonte já estiverem locais, isso resultará em um não op: nada será adicionado à fila de download.</span><span class="sxs-lookup"><span data-stu-id="23063-329">If a download request is made but the font data is already local, this will result in a no-op: Nothing will be added to the download queue.</span></span> <span data-ttu-id="23063-330">Um aplicativo pode verificar se a fila está vazia ou se há solicitações de download pendentes chamando o método [**IDWriteFontDownloadQueue:: IsEmpty**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadqueue-isempty) .</span><span class="sxs-lookup"><span data-stu-id="23063-330">An app can check whether the queue is empty or there are pending download requests by calling the [**IDWriteFontDownloadQueue::IsEmpty**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadqueue-isempty) method.</span></span> 

<span data-ttu-id="23063-331">Depois que as solicitações de fonte remota tiverem sido adicionadas à fila, o processo de download deverá ser iniciado.</span><span class="sxs-lookup"><span data-stu-id="23063-331">After remote font requests have been added to the queue, the download process must be initiated.</span></span> <span data-ttu-id="23063-332">Quando as fontes remotas são usadas no [**IDWriteTextLayout**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout), o download será iniciado automaticamente quando o aplicativo chamar os métodos **IDWriteTextLayout** que forçam operações de layout ou renderização, como os métodos GetLineMetrics ou Draw.</span><span class="sxs-lookup"><span data-stu-id="23063-332">When remote fonts are used in [**IDWriteTextLayout**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout), the download will be initiated automatically when the app calls **IDWriteTextLayout** methods that force layout or rendering operations, such as the GetLineMetrics or Draw methods.</span></span> <span data-ttu-id="23063-333">Em outros cenários, o aplicativo deve iniciar o download diretamente chamando [**IDWriteFontDownloadQueue:: BeginDownload**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadqueue-begindownload).</span><span class="sxs-lookup"><span data-stu-id="23063-333">In other scenarios, the app must initiate the download directly by calling [**IDWriteFontDownloadQueue::BeginDownload**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadqueue-begindownload).</span></span>  

<span data-ttu-id="23063-334">Quando um download for concluído, será necessário que o aplicativo execute as ações apropriadas – prosseguindo com operações pendentes ou repetindo operações que foram feitas inicialmente com fontes de fallback.</span><span class="sxs-lookup"><span data-stu-id="23063-334">When a download is completed, it will be up to the app to take appropriate actions — proceeding with pending operations, or repeating operations that were done initially with fallback fonts.</span></span> <span data-ttu-id="23063-335">(Se o layout de texto de DirectWrite estiver sendo usado, [**IDWriteTextLayout3:: InvalidateLayout**](idwritetextlayout3-invalidatelayout.md) poderá ser usado para limpar os resultados temporários computados usando fontes de fallback.) Para que o aplicativo seja notificado quando o processo de download for concluído e para executar as ações apropriadas, o aplicativo deve fornecer uma implementação da interface [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) e passá-la para a chamada BeginDownload.</span><span class="sxs-lookup"><span data-stu-id="23063-335">(If DirectWrite’s text layout is being used, then [**IDWriteTextLayout3::InvalidateLayout**](idwritetextlayout3-invalidatelayout.md) can be used to clear the temporary results computed using fallback fonts.) In order for the app to be notified when the download process has completed and to take appropriate actions, the app must provide an implementation of the [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) interface, and pass this into the BeginDownload call.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="23063-336">Observação de segurança/desempenho: quando é feita uma tentativa de buscar uma fonte remota, não há nenhuma garantia de que o Windows receberá uma resposta do servidor.</span><span class="sxs-lookup"><span data-stu-id="23063-336">Security / performance note: When an attempt is made to fetch a remote font, there is no guarantee that Windows will receive a response from the server.</span></span> <span data-ttu-id="23063-337">Se o servidor não responder, o Windows eventualmente atingirá o tempo limite, embora isso possa levar vários minutos se várias fontes remotas estiverem sendo buscadas, mas com falha.</span><span class="sxs-lookup"><span data-stu-id="23063-337">If the server does not respond, Windows will eventually time out, though this may take several minutes if multiple remote fonts are being fetched but failing.</span></span> <span data-ttu-id="23063-338">A chamada BeginDownload retornará imediatamente.</span><span class="sxs-lookup"><span data-stu-id="23063-338">The BeginDownload call will return immediately.</span></span> <span data-ttu-id="23063-339">Os aplicativos não devem bloquear a interface do usuário enquanto esperam por [**IDWriteFontDownloadListener::D ownloadcompleted**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadlistener-downloadcompleted) seja chamado.</span><span class="sxs-lookup"><span data-stu-id="23063-339">Apps should not block UI while waiting for [**IDWriteFontDownloadListener::DownloadCompleted**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadlistener-downloadcompleted) to be called.</span></span> 

 

<span data-ttu-id="23063-340">As implementações de exemplo dessas interações com a fila de download de fontes do DirectWrite e da interface [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) podem ser vistas no [exemplo de conjuntos de fontes personalizadas do DirectWrite](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/)e também na amostra de fontes do DirectWrite para [Download](https://github.com/Microsoft/Windows-universal-samples/tree/master/Samples/DWriteTextLayoutCloudFont).</span><span class="sxs-lookup"><span data-stu-id="23063-340">Sample implementations of these interactions with DirectWrite’s font download queue and of the [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) interface can be seen in the [DirectWrite Custom Font Sets sample](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/), and also in the [DirectWrite Downloadable Fonts sample](https://github.com/Microsoft/Windows-universal-samples/tree/master/Samples/DWriteTextLayoutCloudFont).</span></span> 

### <a name="creating-a-custom-font-set-using-font-data-loaded-into-memory"></a><span data-ttu-id="23063-341">Criando um conjunto de fontes personalizado usando dados de fonte carregados na memória</span><span class="sxs-lookup"><span data-stu-id="23063-341">Creating a custom font set using font data loaded into memory</span></span>

<span data-ttu-id="23063-342">Assim como as operações de nível baixo para ler dados de um arquivo de fonte são diferentes para arquivos em um disco local versus arquivos remotos na Web, o mesmo também é verdadeiro para dados de fonte carregados em um buffer de memória.</span><span class="sxs-lookup"><span data-stu-id="23063-342">Just as the low-level operations for reading data from a font file are different for files on a local disk versus remote files on the Web, the same is also true for font data loaded into a memory buffer.</span></span> <span data-ttu-id="23063-343">Uma nova interface de baixo nível para lidar com dados de fonte na memória foi adicionada à atualização do Windows 10 para criadores, [**IDWriteInMemoryFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteinmemoryfontfileloader).</span><span class="sxs-lookup"><span data-stu-id="23063-343">A new low-level interface for handling in-memory font data has been added in the Windows 10 Creators Update, [**IDWriteInMemoryFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteinmemoryfontfileloader).</span></span> 

<span data-ttu-id="23063-344">Assim como com um carregador de arquivo de fonte remoto, um carregador de arquivo de fonte na memória deve primeiro ser registrado com uma fábrica DirectWrite.</span><span class="sxs-lookup"><span data-stu-id="23063-344">As with a remote font file loader, an in-memory font file loader must first be registered with a DirectWrite factory.</span></span> <span data-ttu-id="23063-345">O carregador precisará ser mantido pelo aplicativo enquanto as fontes associadas a ele estiverem sendo usadas.</span><span class="sxs-lookup"><span data-stu-id="23063-345">The loader will need to be held by the app for as long as the fonts associated with it are being used.</span></span> <span data-ttu-id="23063-346">Depois que as fontes não estiverem mais em uso e em algum momento antes que a fábrica seja destruída, o carregador deverá ter o registro cancelado.</span><span class="sxs-lookup"><span data-stu-id="23063-346">Once the fonts are no longer in use, and at some point before the factory is destroyed, the loader must be unregistered.</span></span> <span data-ttu-id="23063-347">Isso pode ser feito no destruidor para a classe que possui o objeto Loader.</span><span class="sxs-lookup"><span data-stu-id="23063-347">This can be done in the destructor for the class that owns the loader object.</span></span> <span data-ttu-id="23063-348">Essas etapas serão mostradas abaixo.</span><span class="sxs-lookup"><span data-stu-id="23063-348">These steps will be shown below.</span></span> 

<span data-ttu-id="23063-349">Se o aplicativo tiver informações separadas sobre os rostos de fonte representados pelos dados, ele poderá adicionar referências de face de fonte individuais a um construtor de conjunto de fontes com propriedades personalizadas especificadas.</span><span class="sxs-lookup"><span data-stu-id="23063-349">If the app has separate information about the font faces represented by the data, it can add individual font face references to a font set builder with custom properties specified.</span></span> <span data-ttu-id="23063-350">No entanto, como os dados da fonte estão na memória local, isso não é necessário; DirectWrite poderá ler os dados diretamente para derivar os valores de propriedade.</span><span class="sxs-lookup"><span data-stu-id="23063-350">Since the font data is in local memory, however, this is not required; DirectWrite will be able to read the data directly to derive the property values.</span></span> 

<span data-ttu-id="23063-351">O DirectWrite assume que os dados da fonte estão no formato RAW, OpenType, equivalente a um arquivo OpenType (. ttf,. OTF,. TTC,. OTC), mas na memória e não no disco.</span><span class="sxs-lookup"><span data-stu-id="23063-351">DirectWrite assumes the font data is in raw, OpenType format, equivalent to an OpenType file (.ttf, .otf, .ttc, .otc), but in memory rather than on disk.</span></span> <span data-ttu-id="23063-352">Os dados não podem estar em um formato de contêiner WOFF ou WOFF2.</span><span class="sxs-lookup"><span data-stu-id="23063-352">The data cannot be in a WOFF or WOFF2 container format.</span></span> <span data-ttu-id="23063-353">Os dados podem representar uma coleção de fontes OpenType.</span><span class="sxs-lookup"><span data-stu-id="23063-353">The data can represent an OpenType Font Collection.</span></span> <span data-ttu-id="23063-354">Se as propriedades personalizadas não estiverem sendo usadas, o método [**IDWriteFontSetBuilder1:: AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) poderá ser usado para adicionar todas as faces de fonte nos dados em uma única chamada.</span><span class="sxs-lookup"><span data-stu-id="23063-354">If custom properties are not being used, then the [**IDWriteFontSetBuilder1::AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) method can be used to add all font faces in the data in a single call.</span></span> 

<span data-ttu-id="23063-355">Uma consideração importante para o cenário na memória é o tempo de vida dos dados.</span><span class="sxs-lookup"><span data-stu-id="23063-355">An important consideration for the in-memory scenario is the lifetime of the data.</span></span> <span data-ttu-id="23063-356">Se um ponteiro para o buffer for fornecido para DirectWrite sem uma indicação clara de que há um proprietário, o DirectWrite fará uma cópia dos dados em um novo buffer de memória que ele terá.</span><span class="sxs-lookup"><span data-stu-id="23063-356">If a pointer to the buffer is provided to DirectWrite without a clear indication that there is an owner, then DirectWrite will make a copy of the data into a new memory buffer that it will own.</span></span> <span data-ttu-id="23063-357">Para evitar a cópia de dados e a alocação de memória adicional, o aplicativo pode passar um objeto de proprietário de dados que implementa IUnknown e que é proprietário do buffer de memória que contém os dados da fonte.</span><span class="sxs-lookup"><span data-stu-id="23063-357">To avoid copying of data and additional memory allocation, the app can pass a data-owner object that implements IUnknown, and that owns the memory buffer containing the font data.</span></span> <span data-ttu-id="23063-358">Ao implementar essa interface, o DirectWrite pode adicionar a contagem de referência do objeto, garantindo assim o tempo de vida dos dados de propriedade.</span><span class="sxs-lookup"><span data-stu-id="23063-358">By implementing this interface, DirectWrite can add to the ref count of the object, thereby ensuring the lifetime of the owned data.</span></span> 

<span data-ttu-id="23063-359">O método para criar um conjunto de fontes personalizado usando dados de fonte na memória é o seguinte: Isso requer a atualização do Windows 10 para criadores.</span><span class="sxs-lookup"><span data-stu-id="23063-359">The method for creating a custom font set using in-memory font data is as follows; this requires the Windows 10 Creators Update.</span></span> <span data-ttu-id="23063-360">Isso assumirá um objeto de proprietário de dados implementado pelo aplicativo, que implementa IUnknown e também tem métodos que retornam um ponteiro para o buffer de memória e o tamanho do buffer.</span><span class="sxs-lookup"><span data-stu-id="23063-360">This will assume an app-implemented data-owner object, that implements IUnknown and also has methods that return a pointer to the memory buffer and the size of the buffer.</span></span> 

<dl> <span data-ttu-id="23063-361">1. Crie uma interface IDWriteFactory5, conforme mostrado acima.</span><span class="sxs-lookup"><span data-stu-id="23063-361">1. Create an IDWriteFactory5 interface, as shown above.</span></span>  
<span data-ttu-id="23063-362">2. Crie uma interface [**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1) , conforme mostrado acima.</span><span class="sxs-lookup"><span data-stu-id="23063-362">2. Create an [**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1) interface, as shown above.</span></span>  
<span data-ttu-id="23063-363">3. Use a fábrica para obter um IDWriteInMemoryFontFileLoader.</span><span class="sxs-lookup"><span data-stu-id="23063-363">3. Use the factory to obtain an IDWriteInMemoryFontFileLoader.</span></span> 


```C++
 IDWriteInMemoryFontFileLoader* pInMemoryFontFileLoader; 
if (SUCCEEDED(hr)) 
{ 
    hr = pDWriteFactory->CreateInMemoryFontFileLoader(&pInMemoryFontFileLoader); 
}
```



<span data-ttu-id="23063-364">Isso retorna uma implementação fornecida pelo sistema da interface do carregador do arquivo de fonte na memória.</span><span class="sxs-lookup"><span data-stu-id="23063-364">This returns a system-provided implementation of the in-memory font file loader interface.</span></span>   
4. <span data-ttu-id="23063-365">Registre o carregador de arquivo de fonte na memória com a fábrica.</span><span class="sxs-lookup"><span data-stu-id="23063-365">Register the in-memory font file loader with the factory.</span></span> 


```C++
if (SUCCEEDED(hr)) 
{ 
    hr = pDWriteFactory->RegisterFontFileLoader(pInMemoryFontFileLoader); 
}
```



   
5. <span data-ttu-id="23063-366">Para cada arquivo de fonte na memória, use o carregador de arquivo de fonte na memória para criar um [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile).</span><span class="sxs-lookup"><span data-stu-id="23063-366">For each in-memory font file, use the in-memory font file loader to create an [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile).</span></span> 


```C++
IDWriteFontFile* pFontFile; 
hr = pInMemoryFontFileLoader->CreateInMemoryFontFileReference( 
    pDWriteFactory, 
    pFontDataOwner->fontData /* returns void* */, 
    pFontDataOwner->fontDataSize /* returns UINT32 */, 
    pFontDataOwner /* ownerObject, owns the memory with font data and implements IUknown */, 
    &pFontFile 
); 
```



   
6. <span data-ttu-id="23063-367">Adicione o objeto [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) ao construtor de conjunto de fontes usando o método [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) , como mostrado acima.</span><span class="sxs-lookup"><span data-stu-id="23063-367">Add the [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) object to the font set builder using the [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) method, as shown above.</span></span>  <span data-ttu-id="23063-368">Se houver uma necessidade, o aplicativo poderá criar objetos [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) individuais com base no **IDWriteFontFile**, opcionalmente, definir propriedades personalizadas para cada referência de face de fonte e, em seguida, adicionar a referência de face de fonte com propriedades personalizadas ao conjunto de fontes usando o método [**AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) , conforme mostrado acima.</span><span class="sxs-lookup"><span data-stu-id="23063-368">If there is a need, the app can instead create individual [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) objects based on the **IDWriteFontFile**, optionally define custom properties for each font face reference, and then add the font face reference with custom properties to the font set using the [**AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) method, as shown above.</span></span>   
7. <span data-ttu-id="23063-369">Depois que todas as fontes tiverem sido adicionadas ao construtor de conjunto de fontes, crie o conjunto de fontes personalizadas, conforme mostrado acima.</span><span class="sxs-lookup"><span data-stu-id="23063-369">After all fonts have been added to the font set builder, create the custom font set, as shown above.</span></span>   
8. <span data-ttu-id="23063-370">Em algum momento, quando as fontes na memória não serão mais usadas, cancele o registro do carregador de arquivo de fonte na memória.</span><span class="sxs-lookup"><span data-stu-id="23063-370">At some point when the in-memory fonts will no longer be used, unregister the in-memory font file loader.</span></span> 


```C++
hr = pDWriteFactory->UnregisterFontFileLoader(pInMemoryFontFileLoader);
```



  
</dl>

 

## <a name="advanced-scenarios"></a><span data-ttu-id="23063-371">Cenários avançados</span><span class="sxs-lookup"><span data-stu-id="23063-371">Advanced scenarios</span></span>

<span data-ttu-id="23063-372">Alguns aplicativos podem ter requisitos especiais que exigem processamento mais avançado do que o descrito acima.</span><span class="sxs-lookup"><span data-stu-id="23063-372">Some apps may have special requirements that require more advanced processing than is described above.</span></span> 

### <a name="combining-font-sets"></a><span data-ttu-id="23063-373">Combinando conjuntos de fontes</span><span class="sxs-lookup"><span data-stu-id="23063-373">Combining font sets</span></span>

<span data-ttu-id="23063-374">Alguns aplicativos podem precisar criar um conjunto de fontes que compreende alguma combinação de itens de outros conjuntos de fontes.</span><span class="sxs-lookup"><span data-stu-id="23063-374">Some apps may need to create a font set that comprises some combination of items from other font sets.</span></span> <span data-ttu-id="23063-375">Por exemplo, um aplicativo pode querer criar um conjunto de fontes que combine todas as fontes instaladas no sistema com uma seleção de fontes personalizadas ou que combine as fontes instaladas correspondentes a determinados critérios com outras fontes.</span><span class="sxs-lookup"><span data-stu-id="23063-375">For example, an app may want to create a font set that combines all the fonts installed on the system with a selection of custom fonts, or that combines installed fonts matching certain criteria with other fonts.</span></span> <span data-ttu-id="23063-376">DirectWrite tem APIs para dar suporte à manipulação e à combinação de conjuntos de fontes.</span><span class="sxs-lookup"><span data-stu-id="23063-376">DirectWrite has APIs to support manipulation and combining of font sets.</span></span> 

<span data-ttu-id="23063-377">Para combinar dois ou mais conjuntos de fontes, o método [**IDWriteFontSetBuilder:: Addfontset**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontset) adiciona todas as fontes em determinado conjunto de fontes a serem adicionadas a um construtor de conjunto de fontes em uma única chamada.</span><span class="sxs-lookup"><span data-stu-id="23063-377">To combine two or more font sets, the [**IDWriteFontSetBuilder::AddFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontset) method adds all of the fonts in given font set to be added to a font set builder in a single call.</span></span> <span data-ttu-id="23063-378">Se apenas determinadas fontes de um conjunto de fontes existente forem desejadas no novo conjunto de fontes, o método [**IDWriteFontSet:: GetMatchingFonts**](idwritefontset-getmatchingfonts-overload.md) poderá ser usado para derivar um novo objeto de conjunto de fontes que foi filtrado para incluir apenas as fontes que correspondem às propriedades especificadas.</span><span class="sxs-lookup"><span data-stu-id="23063-378">If only certain fonts from an existing font set are wanted in the new font set, the [**IDWriteFontSet::GetMatchingFonts**](idwritefontset-getmatchingfonts-overload.md) method can be used to derive a new font set object that has been filtered to include only fonts matching specified properties.</span></span> <span data-ttu-id="23063-379">Esses métodos fornecem uma maneira fácil de criar um conjunto de fontes personalizado combinando fontes de dois ou mais conjuntos de fontes existentes</span><span class="sxs-lookup"><span data-stu-id="23063-379">These methods provide an easy way to create a custom font set combining fonts from two or more existing font sets</span></span> 

### <a name="using-local-woff-or-woff2-font-data"></a><span data-ttu-id="23063-380">Usando dados de fonte WOFF ou WOFF2 locais</span><span class="sxs-lookup"><span data-stu-id="23063-380">Using local WOFF or WOFF2 font data</span></span>

<span data-ttu-id="23063-381">Se um aplicativo tiver arquivos de fonte no sistema de arquivos local ou em um buffer de memória, mas eles usarem os formatos de contêiner WOFF ou WOFF2, DirectWrite (Windows 10 Creator Update ou posterior) fornecerá um método para desempacotar o formato de contêiner, [**IDWriteFactory5:: UnpackFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-unpackfontfile), que retorna um [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream).</span><span class="sxs-lookup"><span data-stu-id="23063-381">If an app has font files in the local file system or in a memory buffer, but they use the WOFF or WOFF2 container formats, DirectWrite (Windows 10 Creator Update or later) provides a method for unpacking the container format, [**IDWriteFactory5::UnpackFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-unpackfontfile), which returns an [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream).</span></span> 

<span data-ttu-id="23063-382">No entanto, o aplicativo precisará de uma maneira de obter o [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) em um objeto de carregador de arquivo de fonte.</span><span class="sxs-lookup"><span data-stu-id="23063-382">However, the app will need a way to get the [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) into a font file loader object.</span></span> <span data-ttu-id="23063-383">Uma maneira de fazer isso é criar uma implementação de [**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader) personalizada que encapsula o fluxo.</span><span class="sxs-lookup"><span data-stu-id="23063-383">One way to do this is to create a custom [**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader) implementation that wraps the stream.</span></span> <span data-ttu-id="23063-384">Assim como ocorre com outros carregadores de arquivo de fonte, isso deve ser registrado antes do uso e cancelado antes da fábrica sair do escopo.</span><span class="sxs-lookup"><span data-stu-id="23063-384">As with other font file loaders, this must be registered before use, and unregistered before the factory goes out of scope.</span></span>  

<span data-ttu-id="23063-385">Se o carregador personalizado também for usado com arquivos de fonte brutos (não compactados), o aplicativo também precisará fornecer uma implementação personalizada da interface [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) para lidar com esses arquivos.</span><span class="sxs-lookup"><span data-stu-id="23063-385">If the custom loader will also be used with raw (not packed) font files, then the app would also need to provide a custom implementation of the [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) interface for handling those files.</span></span> <span data-ttu-id="23063-386">No entanto, há maneiras mais fáceis de usar as APIs abordadas acima para lidar com arquivos de fonte brutos.</span><span class="sxs-lookup"><span data-stu-id="23063-386">There are easier ways that use APIs discussed above for handling raw font files, however.</span></span> <span data-ttu-id="23063-387">A necessidade de uma implementação de fluxo personalizado pode ser evitada usando caminhos de código separados para arquivos de fonte compactados versus arquivos de fonte brutos.</span><span class="sxs-lookup"><span data-stu-id="23063-387">The need for a custom stream implementation could be avoided by using separate code paths for packed font files versus raw font files.</span></span> 

<span data-ttu-id="23063-388">Depois que um objeto de carregador de arquivo de fonte personalizado é criado, os dados de arquivo de fonte empacotados são adicionados ao carregador por meios específicos do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="23063-388">After a custom font file loader object is created, the packed font file data is added to the loader by app-specific means.</span></span> <span data-ttu-id="23063-389">O carregador pode manipular vários arquivos de fonte, cada um dos quais é identificado usando uma chave definida pelo aplicativo que é opaca para DirectWrite.</span><span class="sxs-lookup"><span data-stu-id="23063-389">The loader can handle multiple font files, each of which is identified using an app-defined key that is opaque to DirectWrite.</span></span> <span data-ttu-id="23063-390">Depois que um arquivo de fonte empacotado tiver sido adicionado ao carregador, o método [**IDWriteFactory:: CreateCustomFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontfilereference) será usado para obter um [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) com base nesse carregador para os dados de fonte identificados por uma determinada chave.</span><span class="sxs-lookup"><span data-stu-id="23063-390">After a packed font file has been added to the loader, the [**IDWriteFactory::CreateCustomFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontfilereference) method is used to obtain an [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) based on that loader for the font data identified by a given key.</span></span>  

<span data-ttu-id="23063-391">O desempacotamento real dos dados da fonte pode ser feito, pois as fontes são adicionadas ao carregador, mas também podem ser manipuladas no método [**IDWriteFontFileLoader:: CreateStreamFromKey**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileloader-createstreamfromkey) , que DirectWrite chamará quando precisar ler o dados da fonte pela primeira vez.</span><span class="sxs-lookup"><span data-stu-id="23063-391">The actual unpacking of the font data can be done as fonts are added to the loader, but can also be handled in the [**IDWriteFontFileLoader::CreateStreamFromKey**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileloader-createstreamfromkey) method, which DirectWrite will call when it first needs to read the font data.</span></span> 

<span data-ttu-id="23063-392">Depois que um objeto IDWriteFontFile tiver sido criado, as etapas restantes para adicionar as fontes a um conjunto de fontes personalizadas serão as descritas acima.</span><span class="sxs-lookup"><span data-stu-id="23063-392">After an IDWriteFontFile object has been created, remaining steps for adding the fonts to a custom font set will be as described above.</span></span> 

<span data-ttu-id="23063-393">Uma implementação que usa essa abordagem é ilustrada no [exemplo de conjuntos de fontes personalizadas do DirectWrite](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/).</span><span class="sxs-lookup"><span data-stu-id="23063-393">An implementation using this approach is illustrated in the [DirectWrite Custom Font Sets sample](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/).</span></span> 

### <a name="using-directwrite-remote-font-mechanisms-with-custom-low-level-network-implementation"></a><span data-ttu-id="23063-394">Usando mecanismos de fonte remota DirectWrite com implementação de rede de nível inferior personalizada</span><span class="sxs-lookup"><span data-stu-id="23063-394">Using DirectWrite remote font mechanisms with custom low-level network implementation</span></span>

<span data-ttu-id="23063-395">Os mecanismos de DirectWrite para manipular fontes remotas podem ser divididos em mecanismos de nível superior, tendo conjuntos de fontes que incluem referências de face de fonte para fontes remotas, verificando a localidade dos dados da fonte e gerenciando a fila para solicitações de download de fontes – e os mecanismos de nível inferior que lidam com o download real.</span><span class="sxs-lookup"><span data-stu-id="23063-395">The DirectWrite mechanisms for handling remote fonts can be divided into higher-level mechanisms — having font sets that include font face references for remote fonts, checking locality of the font data, and managing the queue for font download requests — and the lower-level mechanisms that handle actual download.</span></span> <span data-ttu-id="23063-396">Alguns aplicativos podem querer utilizar os mecanismos de fonte remota de nível superior, mas também exigem interações de rede personalizadas, como a comunicação com servidores usando protocolos diferentes de HTTP.</span><span class="sxs-lookup"><span data-stu-id="23063-396">Some apps may want to utilize the higher-level remote font mechanisms, but also require custom network interactions, such as communicating with servers using protocols other than HTTP.</span></span> 

<span data-ttu-id="23063-397">Para essa situação, um aplicativo precisará criar uma implementação personalizada da interface [**IDWriteRemoteFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader) que interage com outras interfaces de nível inferior das maneiras necessárias.</span><span class="sxs-lookup"><span data-stu-id="23063-397">For this situation, an app will need to create a custom implementation of the [**IDWriteRemoteFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader) interface that interacts with other lower-level interfaces in the required ways.</span></span> <span data-ttu-id="23063-398">O aplicativo também precisará fornecer implementações personalizadas dessas interfaces de nível inferior: [**IDWriteRemoteFontFileStream**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfilestream)e [**IDWriteAsyncResult**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteasyncresult).</span><span class="sxs-lookup"><span data-stu-id="23063-398">The app will also need to provide custom implementations of these lower-level interfaces: [**IDWriteRemoteFontFileStream**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfilestream), and [**IDWriteAsyncResult**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteasyncresult).</span></span> <span data-ttu-id="23063-399">Essas três interfaces têm métodos de retorno de chamada que DirectWrite serão chamados durante as operações de download.</span><span class="sxs-lookup"><span data-stu-id="23063-399">These three interfaces have callback methods that DirectWrite will call during download operations.</span></span> 

<span data-ttu-id="23063-400">Quando [**IDWriteFontDownloadQueue:: BeginDownload**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadqueue-begindownload) for chamado, DirectWrite fará consultas ao carregador de arquivo de fonte remoto sobre a localidade dos dados e solicitará o fluxo remoto.</span><span class="sxs-lookup"><span data-stu-id="23063-400">When [**IDWriteFontDownloadQueue::BeginDownload**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadqueue-begindownload) is called, DirectWrite will make queries to the remote font file loader about locality of the data, and will request the remote stream.</span></span> <span data-ttu-id="23063-401">Se os dados não forem locais, ele chamará o método BeginDownload do fluxo.</span><span class="sxs-lookup"><span data-stu-id="23063-401">If data is not local, then it will call the stream’s BeginDownload method.</span></span> <span data-ttu-id="23063-402">A implementação do fluxo não deve bloquear essa chamada, mas deve retornar imediatamente, passando um objeto [**IDWriteAsyncResult**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteasyncresult) que forneça o identificador de espera que o DirectWrite usará para aguardar a operação de download assíncrono.</span><span class="sxs-lookup"><span data-stu-id="23063-402">The stream implementation should not block on that call, but should immediately return, passing back an [**IDWriteAsyncResult**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteasyncresult) object that provides the wait handle DirectWrite will use to wait on the asynchronous download operation.</span></span> <span data-ttu-id="23063-403">A implementação do fluxo personalizado é responsável por lidar com a comunicação remota.</span><span class="sxs-lookup"><span data-stu-id="23063-403">The custom stream implementation is responsible for handling the remote communication.</span></span> <span data-ttu-id="23063-404">Quando o evento de conclusão tiver ocorrido, DirectWrite chamará [**IDWriteAsyncResult:: GetResult**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwriteasyncresult-getresult) para determinar o resultado da operação.</span><span class="sxs-lookup"><span data-stu-id="23063-404">When the completion event has occurred, then DirectWrite will call [**IDWriteAsyncResult::GetResult**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwriteasyncresult-getresult) to determine the result of the operation.</span></span> <span data-ttu-id="23063-405">Se o resultado for bem-sucedido, espera-se que as chamadas ReadFragment subsequentes para o fluxo para os intervalos baixados tenham êxito.</span><span class="sxs-lookup"><span data-stu-id="23063-405">If the result is successful, then it’s expected that subsequent ReadFragment calls to the stream for the downloaded ranges will succeed.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="23063-406">Observação de segurança/desempenho: quando é feita uma tentativa de buscar uma fonte remota, o potencial existe em geral para que um invasor falsifique o servidor desejado que está sendo chamado ou que o servidor possa não responder.</span><span class="sxs-lookup"><span data-stu-id="23063-406">Security / performance note: When an attempt is made to fetch a remote font, the potential exists in general for an attacker to spoof the intended server being called, or that the server may not respond.</span></span> <span data-ttu-id="23063-407">Se você estiver implementando interações de rede personalizadas, poderá ter mais controle sobre as atenuações do que ao lidar com servidores de terceiros.</span><span class="sxs-lookup"><span data-stu-id="23063-407">If you are implementing custom network interactions, you may have greater control over mitigations than when dealing with third-party servers.</span></span> <span data-ttu-id="23063-408">No entanto, cabe a você considerar as atenuações apropriadas para evitar a divulgação de informações ou a negação de serviço.</span><span class="sxs-lookup"><span data-stu-id="23063-408">However, it is up to you to consider appropriate mitigations to avoid information disclosure or denial of service.</span></span> <span data-ttu-id="23063-409">Protocolos seguros, como HTTPS, são recomendados.</span><span class="sxs-lookup"><span data-stu-id="23063-409">Secure protocols such as HTTPS are recommended.</span></span> <span data-ttu-id="23063-410">Além disso, você deve compilar em algum tempo limite para que o identificador de evento retornado para DirectWrite, eventualmente, seja definido.</span><span class="sxs-lookup"><span data-stu-id="23063-410">Also, you should build in some timeout so that the event handle returned to DirectWrite does eventually get set.</span></span> 

 

### <a name="supporting-scenarios-on-earlier-windows-versions"></a><span data-ttu-id="23063-411">Cenários de suporte em versões anteriores do Windows</span><span class="sxs-lookup"><span data-stu-id="23063-411">Supporting scenarios on earlier Windows versions</span></span>

<span data-ttu-id="23063-412">Os cenários descritos podem ter suporte no DirectWrite em versões anteriores do Windows, mas exigiriam uma implementação muito mais personalizada na parte do aplicativo usando as APIs mais limitadas que estavam disponíveis antes do Windows 10.</span><span class="sxs-lookup"><span data-stu-id="23063-412">The scenarios that have been described can be supported in DirectWrite on earlier versions of Windows, but would require much more custom implementation on the part of the app using the more limited APIs that were available prior to Windows 10.</span></span> <span data-ttu-id="23063-413">Para obter mais informações, consulte [coleções de fontes personalizadas (Windows 7/8)](custom-font-collections.md).</span><span class="sxs-lookup"><span data-stu-id="23063-413">For more information, see [Custom Font Collections (Windows 7/8)](custom-font-collections.md).</span></span>

 

 