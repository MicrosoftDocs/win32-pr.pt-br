---
description: Ao se preparar para uma restauração, um solicitante usa os documentos de metadados do gravador armazenados em conjunto com seu próprio documento de componentes de backup recuperado para determinar o que será restaurado e como.
ms.assetid: 36cf188f-fce6-467c-a200-cbd9dc8f31a6
title: Visão geral da preparação para restauração
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d8b1bc3e429da5be9872e8345fe6da32a5340005
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105763763"
---
# <a name="overview-of-preparing-for-restore"></a>Visão geral da preparação para restauração

Ao se preparar para uma restauração, um solicitante usa os documentos de metadados do gravador armazenados em conjunto com seu próprio documento de componentes de backup recuperado para determinar o que será restaurado e como. Para obter mais informações, consulte [visão geral do processamento de uma restauração no VSS](overview-of-processing-a-restore-under-vss.md).

Após a seleção dos componentes candidatos à restauração, os gravadores atualmente em execução no sistema acessam o documento de componentes de backup do solicitante. Os gravadores usam esse acesso para indicar como causar o mínimo de dificuldade para a execução de serviços devido à restauração.

Depois que isso for concluído, o solicitante terá informações suficientes para determinar quais arquivos precisarão ser restaurados, bem como onde e como eles devem ser restaurados. (Para obter mais informações, consulte [gerando um conjunto de restauração](generating-a-restore-set.md).)

A tabela a seguir mostra a sequência de ações e eventos que são necessários para se preparar para uma operação de restauração.



| Ação do solicitante                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Evento                                                         | Ação do gravador                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Recuperar informações do documento de componentes de backup sobre os componentes [*incluídos explicitamente*](vssgloss-e.md) na operação de backup (consulte [**IVssBackupComponents:: GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents)) examine documentos de metadados do gravador recuperados para obter detalhes sobre esses componentes incluídos explicitamente no backup e quaisquer subcomponentes de localização [*implicitamente incluídos*](vssgloss-i.md) . (Consulte [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata), [**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent).)<br/> | Nenhum                                                          | Nenhum                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Selecione componentes e conjuntos de componentes a serem restaurados (consulte [**IVssBackupComponents:: SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) e [**IVssBackupComponents:: AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent).)                                                                                                                                                                                                                                                                                                                                                                                          | Nenhum                                                          | Nenhum                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| O solicitante permite que o gravador atualize o documento de componentes de backup e pode, opcionalmente, comunicar quaisquer opções de restauração especiais ao gravador. (Consulte [**IVssBackupComponents:: setrestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions), [**IVssBackupComponents:: AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget)e [**IVssBackupComponents::P rerestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore).)                                                                                                                                                                                                                                         | [*Prerestore*](vssgloss-p.md) | O gravador determina a participação na restauração, prepara os arquivos para restauração e, opcionalmente, modifica o documento de componentes de backup, se necessário. (Consulte [**CVssWriter:: OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore), [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent), [**IVssComponent:: IsSelectedForRestore**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-isselectedforrestore), [**IVssComponent:: getrestore**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoreoptions), [**IVssComponent:: SetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget), [**IVssComponent:: SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata), [**IVssComponent:: AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget).) |
| O solicitante aguarda os gravadores para manipular o evento de [**Prerestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) com [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync). Ele também deve verificar o status do gravador. (Consulte [**IVssBackupComponents:: GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents:: GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus).)                                                                                                                                                                                                                                                                                  | Nenhum                                                          | Nenhum                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |



 

## <a name="requester-actions-during-restore-preparations"></a>Ações do solicitante durante a preparação da restauração

Para determinar quais componentes são candidatos para restauração, o solicitante deve fazer o seguinte:

-   Estabeleça o componente e a estrutura do [*conjunto de componentes*](vssgloss-c.md) usada para fazer o backup.
-   Examine a seleção dos componentes [*para restauração*](vssgloss-s.md).
-   Use as diretrizes de seleção ([trabalhando com a seleção de restauração e subcomponentes](working-with-selectability-for-restore-and-subcomponents.md)) para escolher os componentes a serem incluídos.
-   Use informações de [*conjunto de arquivos*](vssgloss-f.md) de componente para determinar quais arquivos na mídia de backup devem ser restaurados.

Para fazer isso, o solicitante precisa examinar os componentes [*explicitamente incluídos*](vssgloss-e.md) no documento componentes de backup armazenados. Essas informações de componente estão disponíveis em uma base de gravador por gravador usando [**IVssBackupComponents:: GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents), que retorna instâncias da interface [**IVssWriterComponentsExt**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) , da qual as informações do gravador e as instâncias da interface [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) podem ser recuperadas.

Conforme observado em outro lugar ([uso de componentes pelo solicitante](use-of-components-by-the-requestor.md)), o documento componentes de backup e a interface **IVssComponent** não contêm informações suficientes para dar suporte ao backup. Portanto, o solicitante deve examinar o documento de metadados do gravador armazenado correspondente usando [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) (consulte [informações de identificação do gravador](writer-metadata-document-contents.md)).

O número de componentes gerenciados por cada gravador é retornado por [**IVssExamineWriterMetadata:: GetFileCounts**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getfilecounts). O solicitante pode usar [**IVssExamineWriterMetadata:: GetComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) para obter uma interface [**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent) para cada componente que um gravador gerencia.

Ao examinar a seleção dos componentes [*de backup*](vssgloss-s.md) e de [*caminhos lógicos*](vssgloss-l.md) (consulte [trabalhando com a seleção e os caminhos lógicos](working-with-selectability-and-logical-paths.md)), um solicitante é capaz de identificar os componentes que definiram conjuntos de componentes de tempo de backup (componentes explicitamente incluídos) e os membros dos subcomponentes desses conjuntos (componentes incluídos implicitamente).

Os solicitantes indicam o documento de componentes de backup se um componente deve ser restaurado explicitamente, usando [**IVssBackupComponents:: SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) ou [**IVssBackupComponents:: AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent). A escolha do método dependerá de como o backup do componente foi originalmente feito e de sua [*seleção de restauração*](vssgloss-s.md). Esses componentes incluídos explicitamente para a restauração designam outros componentes que são incluídos implicitamente (consulte [trabalhando com a seleção de restauração e subcomponentes](working-with-selectability-for-restore-and-subcomponents.md) para obter detalhes).

Um solicitante pode incluir explicitamente nenhum dos componentes do gravador em execução no momento para restauração usando [**IVssBackupComponents:: SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) ou [**IVssBackupComponents:: AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent). Nesse caso, esse gravador não receberá nenhum evento do VSS para o restante da operação de restauração.

O uso explícito de [**IVssBackupComponents:: SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) ou [**IVssBackupComponents:: AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent) para selecionar um componente de um gravador que não está em execução no momento retorna um \_ erro de objeto VSS E \_ \_ não \_ encontrado. Consulte restaurações [sem a participação do gravador](restores-without-writer-participation.md) para obter informações sobre como restaurar os dados de gravadores ausentes.

Para permitir que um gravador tenha informações completas sobre as quais agir, as opções de restauração específicas do gravador e a indicação de uma restauração incremental podem ser enviadas para os gravadores por chamadas do solicitante para [**IVssBackupComponents:: setrestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions) e [**IVssBackupComponents:: SetAdditionalRestores**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores), respectivamente.

Neste ponto, um solicitante concluiu sua preparação e gera um evento de **Prerestore** chamando [**IVssBackupComponents::P rerestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore), permitindo que os gravadores se preparem para a restauração real.

## <a name="writer-actions-during-restore-preparations"></a>Ações do gravador durante a preparação da restauração

A preparação do gravador para a operação de restauração ocorre ao manipular o evento de [**Prerestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) com o método virtual [**CVssWriter:: OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore). A implementação padrão simplesmente retorna sem realizar nenhuma ação. Os gravadores podem optar por substituir a implementação padrão para exercer mais controle por:

-   Substituindo [*métodos de restauração*](vssgloss-r.md) por [*destinos de restauração*](vssgloss-r.md)
-   Definindo [ *destinos direcionados*](vssgloss-d.md)
-   Criando mensagens de erro e dados adicionais
-   Fornecendo informações de carimbo de backup

O manipulador de eventos [**CVssWriter:: OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore) recebe uma instância do [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents), da qual ele pode obter as interfaces do [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) para aqueles de seus componentes explicitamente incluídos no documento de componentes de backup durante o backup.

Informações sobre subcomponentes incluídos implicitamente nas operações de backup e explicitamente incluídas em restaurações usando uma instância do **IVssComponent** correspondente ao componente que definiu seu [*conjunto de componentes*](vssgloss-c.md)de backup.

O método [**IVssComponent:: IsSelectedForRestore**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-isselectedforrestore) é usado para determinar se um componente explicitamente incluído para backup deve ser restaurado.

Para determinar se um subcomponente de backup foi incluído explicitamente na restauração, os gravadores usam [**IVssComponent:: GetRestoreSubcomponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoresubcomponent).

O gravador deve examinar o [*conjunto de arquivos*](vssgloss-f.md) em cada componente e determinar se ele precisa executar ações para dar suporte à restauração. O gravador precisará avaliar se deseja que seus arquivos atuais sejam substituídos ou se exigirá a restauração em novos locais. As ações podem incluir o seguinte:

-   Obter e agir em qualquer opção específica de gravador ou solicitante que governa as operações de restauração (consulte [**IVssComponent:: getrestore**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoreoptions))
-   Fechar e tornar graváveis arquivos abertos no momento
-   Atualizando o destino de restauração (por exemplo, para forçar a restauração para um mapeamento de local alternativo). Consulte [**IVssComponent:: SetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget).
-   Comunicando-se com o solicitante por meio de metadados privados (consulte [**IVssComponent:: SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata))
-   Indicando que um arquivo deve ser restaurado por remapeamento por meio da definição de [*destinos direcionados*](vssgloss-d.md) (consulte [**IVssComponent:: AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget))

A instância de [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) usada será criada pela inclusão explícita do componente no documento de componentes de backup durante o backup ou a do componente que define o conjunto de componentes de backup do qual ele era um membro (consulte [trabalhando com a seleção para restauração e subcomponentes](working-with-selectability-for-restore-and-subcomponents.md)).

 

 
