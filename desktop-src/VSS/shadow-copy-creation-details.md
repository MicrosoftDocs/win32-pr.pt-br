---
description: Em geral, a forma como uma cópia de sombra é criada depende do tipo de cópia de sombra a ser criado, seu contexto e da função com o acordeão dos gravadores na operação de cópia de sombra.
ms.assetid: eab3b39b-dfa7-43ea-adba-cd0b495c373f
title: Detalhes da criação da cópia de sombra
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8b9281b899593ca0751f1d549aed60305041b18c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105763413"
---
# <a name="shadow-copy-creation-details"></a><span data-ttu-id="11503-103">Detalhes da criação da cópia de sombra</span><span class="sxs-lookup"><span data-stu-id="11503-103">Shadow Copy Creation Details</span></span>

<span data-ttu-id="11503-104">Em geral, a forma como uma cópia de sombra é criada depende do tipo de cópia de sombra a ser criado, seu contexto e da função com o acordeão dos gravadores na operação de cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="11503-104">In general, how a shadow copy is created depends on the type of shadow copy to be created, its context, and the role accorded to writers in the shadow copy operation.</span></span> <span data-ttu-id="11503-105">(Consulte [configurações de contexto de cópia de sombra](shadow-copy-context-configurations.md) para obter mais informações.)</span><span class="sxs-lookup"><span data-stu-id="11503-105">(See [Shadow Copy Context Configurations](shadow-copy-context-configurations.md) for more information.)</span></span>

<span data-ttu-id="11503-106">O contexto de cópia de sombra é definido chamando o método [**IVssBackupComponents:: SetContext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext) .</span><span class="sxs-lookup"><span data-stu-id="11503-106">The shadow copy context is set by calling the [**IVssBackupComponents::SetContext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext) method.</span></span> <span data-ttu-id="11503-107">Antes de chamar o método [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) para criar uma cópia de sombra, os solicitantes devem chamar os métodos [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) na ordem especificada nas seções a seguir.</span><span class="sxs-lookup"><span data-stu-id="11503-107">Before calling the [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) method to create a shadow copy, requesters must call the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) methods in the order specified in the following sections.</span></span>

## <a name="prerequisites-for-all-shadow-copies"></a><span data-ttu-id="11503-108">Pré-requisitos para todas as cópias de sombra</span><span class="sxs-lookup"><span data-stu-id="11503-108">Prerequisites for All Shadow Copies</span></span>

<span data-ttu-id="11503-109">Independentemente do nível de participação no gravador, a criação de qualquer cópia de sombra sempre exigirá que o solicitante seja inicializado com chamadas para [**IVssBackupComponents:: InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) e [**IVssBackupComponents:: StartSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset).</span><span class="sxs-lookup"><span data-stu-id="11503-109">Regardless of the level of writer participation, the creation of any shadow copy will always require the requestor be initialized with calls to [**IVssBackupComponents::InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) and [**IVssBackupComponents::StartSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset).</span></span>

<span data-ttu-id="11503-110">Se essa chamada não for feita, o método [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) retornará um erro.</span><span class="sxs-lookup"><span data-stu-id="11503-110">If this call is not made, the [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) method will return an error.</span></span>

## <a name="shadow-copies-with-writer-participation"></a><span data-ttu-id="11503-111">Cópias de sombra com participação no gravador</span><span class="sxs-lookup"><span data-stu-id="11503-111">Shadow Copies with Writer Participation</span></span>

<span data-ttu-id="11503-112">Se o contexto de cópia de sombra especificar a participação do gravador (ou seja, [**IVssBackupComponents:: SetContext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext) é chamado com o **\_ \_ backup do VSS CTX** ou **\_ \_ \_ reversão do aplicativo CTX VSS**):</span><span class="sxs-lookup"><span data-stu-id="11503-112">If the shadow copy context specifies writer participation (that is, [**IVssBackupComponents::SetContext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext) is called with **VSS\_CTX\_BACKUP**, or **VSS\_CTX\_APP\_ROLLBACK**):</span></span>

-   <span data-ttu-id="11503-113">Os solicitantes devem sempre chamar [**IVssBackupComponents:: GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) quando o contexto da cópia de sombra dá suporte à participação no gravador.</span><span class="sxs-lookup"><span data-stu-id="11503-113">Requesters must always call [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) when the shadow copy context supports writer participation.</span></span> <span data-ttu-id="11503-114">Se o contexto de cópia de sombra oferecer suporte à participação de gravador e **IVssBackupComponents:: GatherWriterMetadata** não for chamado antes do [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset), um erro será retornado.</span><span class="sxs-lookup"><span data-stu-id="11503-114">If the shadow copy context supports writer participation and **IVssBackupComponents::GatherWriterMetadata** is not called prior to [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset), an error will be returned.</span></span>
-   <span data-ttu-id="11503-115">Se um solicitante quiser selecionar componentes específicos do gravador, ele deverá chamar [**IVssBackupComponents:: addComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent) antes de chamar [**StartSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset) para criar o conjunto de cópias de sombra.</span><span class="sxs-lookup"><span data-stu-id="11503-115">If a requester wants to select specific writer components, it must call [**IVssBackupComponents::AddComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent) before calling [**StartSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset) to create the shadow copy set.</span></span>
-   <span data-ttu-id="11503-116">[**StartSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset) deve ser chamado para criar o conjunto de cópias de sombra.</span><span class="sxs-lookup"><span data-stu-id="11503-116">[**StartSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset) must be called to create the shadow copy set.</span></span>
-   <span data-ttu-id="11503-117">Os solicitantes podem adicionar um ou mais volumes ao conjunto de cópias de sombra chamando [**AddToSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addtosnapshotset).</span><span class="sxs-lookup"><span data-stu-id="11503-117">Requesters may add one or more volumes to the shadow copy set by calling [**AddToSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addtosnapshotset).</span></span> <span data-ttu-id="11503-118">Alguns componentes do gravador podem não especificar nenhum volume afetado.</span><span class="sxs-lookup"><span data-stu-id="11503-118">Some writer components may not specify any affected volumes.</span></span> <span data-ttu-id="11503-119">Nesse caso, é aceitável que um conjunto de instantâneos esteja vazio (ou seja, não contenha nenhum volume).</span><span class="sxs-lookup"><span data-stu-id="11503-119">In this case, it is acceptable for a snapshot set to be empty (that is, to contain no volumes).</span></span>
-   <span data-ttu-id="11503-120">Para garantir a consistência dos metadados do gravador, um solicitante sempre deve chamar [**IVssBackupComponents::P repareforbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) mesmo que nenhum componente esteja selecionado.</span><span class="sxs-lookup"><span data-stu-id="11503-120">To guarantee the consistency of writer metadata, a requester should always call [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) even if no components are selected.</span></span> <span data-ttu-id="11503-121">Isso faz com que o VSS gere um evento **PrepareForBackup** , no qual o VSS chama o método [**CVssWriter:: OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) para cada gravador participante.</span><span class="sxs-lookup"><span data-stu-id="11503-121">This causes VSS to generate a **PrepareForBackup** event, in which VSS calls the [**CVssWriter::OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) method for each participating writer.</span></span>
-   <span data-ttu-id="11503-122">O VSS irá gerar eventos [*PrepareForSnapshot*](vssgloss-p.md) e [*Freeze*](vssgloss-f.md) antes de criar a cópia de sombra em resposta a [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span><span class="sxs-lookup"><span data-stu-id="11503-122">VSS will generate [*PrepareForSnapshot*](vssgloss-p.md) and [*Freeze*](vssgloss-f.md) events before creating the shadow copy in response to [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span></span> <span data-ttu-id="11503-123">Os gravadores tratarão os eventos com [**CVssWriter:: OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot) e [**CVssWriter:: OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze).</span><span class="sxs-lookup"><span data-stu-id="11503-123">Writers will handle the events with [**CVssWriter::OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot) and [**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze).</span></span>
-   <span data-ttu-id="11503-124">O VSS gerará eventos [*descongelar*](vssgloss-t.md) e eventos de [*instantâneo*](vssgloss-p.md) após a criação de uma cópia de sombra em resposta a [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span><span class="sxs-lookup"><span data-stu-id="11503-124">VSS will generate [*Thaw*](vssgloss-t.md) events and [*PostSnapshot*](vssgloss-p.md) events after creating a shadow copy in response to [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span></span> <span data-ttu-id="11503-125">Os gravadores tratarão os eventos com [**CVssWriter:: descongelar**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw) e [**CVssWriter:: OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot).</span><span class="sxs-lookup"><span data-stu-id="11503-125">Writers will handle the events with [**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw) and [**CVssWriter::OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot).</span></span>

## <a name="shadow-copies-without-writer-participation"></a><span data-ttu-id="11503-126">Cópias de sombra sem participação no gravador</span><span class="sxs-lookup"><span data-stu-id="11503-126">Shadow Copies without Writer Participation</span></span>

<span data-ttu-id="11503-127">A criação de cópias de sombra sem a participação do gravador é desencorajada para aplicativos de backup padrão (consulte [backups sem participação no gravador](backups-without-writer-participation.md)).</span><span class="sxs-lookup"><span data-stu-id="11503-127">Creating shadow copies without writer participation is discouraged for standard backup applications (see [Backups without Writer Participation](backups-without-writer-participation.md)).</span></span>

<span data-ttu-id="11503-128">Há usos, como backups rápidos de um disco para fornecer uma rede de segurança contra corrupção acidental de arquivos, que pode ser realizado sem a participação explícita do gravador.</span><span class="sxs-lookup"><span data-stu-id="11503-128">There are uses, such as fast backups of a disk to provide a safety net against accidental file corruption, which can be conducted without explicit writer participation.</span></span> <span data-ttu-id="11503-129">Essa cópia de sombra teria um contexto de backup de **\_ compartilhamento de \_ arquivos \_ \_ VSS CTX** ou **de \_ \_ \_ reversão de nas CTX do VSS**.</span><span class="sxs-lookup"><span data-stu-id="11503-129">Such a shadow copy would have a context of either **VSS\_CTX\_FILE\_SHARE\_BACKUP** or **VSS\_CTX\_NAS\_ROLLBACK**.</span></span>

<span data-ttu-id="11503-130">Para esse tipo de cópia de sombra, observe o seguinte:</span><span class="sxs-lookup"><span data-stu-id="11503-130">For this type of shadow copy, note the following:</span></span>

-   <span data-ttu-id="11503-131">Os solicitantes ainda devem chamar os métodos necessários listados em [pré-requisitos para todas as cópias de sombra](#prerequisites-for-all-shadow-copies).</span><span class="sxs-lookup"><span data-stu-id="11503-131">Requesters must still call the required methods listed in [Prerequisites for All Shadow Copies](#prerequisites-for-all-shadow-copies).</span></span>
-   <span data-ttu-id="11503-132">Os solicitantes podem chamar [**IVssBackupComponents:: GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), mas isso não é necessário.</span><span class="sxs-lookup"><span data-stu-id="11503-132">Requesters may call [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), but this is not required.</span></span>
-   <span data-ttu-id="11503-133">Se os solicitantes chamarem [**IVssBackupComponents:: addComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent), [**IVssBackupComponents::P repareforbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup)ou [**IVssBackupComponents:: BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete), um erro será retornado.</span><span class="sxs-lookup"><span data-stu-id="11503-133">If requesters call [**IVssBackupComponents::AddComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent), [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), or [**IVssBackupComponents::BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete), an error will be returned.</span></span>
-   <span data-ttu-id="11503-134">Os provedores não gerarão eventos [*PrepareForSnapshot*](vssgloss-p.md), [*Freeze*](vssgloss-f.md), [*descongelar*](vssgloss-t.md)ou [*upsnapshot*](vssgloss-p.md) para esse tipo de cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="11503-134">Providers will not generate [*PrepareForSnapshot*](vssgloss-p.md), [*Freeze*](vssgloss-f.md), [*Thaw*](vssgloss-t.md), or [*PostSnapshot*](vssgloss-p.md) events for this type of shadow copy.</span></span>

 

 



