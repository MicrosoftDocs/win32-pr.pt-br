---
description: As tarefas de pré-backup no VSS concentram-se na criação de uma cópia de sombra dos volumes que contêm dados para backup.
ms.assetid: e6b082af-719b-4426-8217-0fc940f5884d
title: Visão geral das tarefas de pré-backup
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 709345b8aa0421699efe26ad2901cc497b7d4ac0
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105759774"
---
# <a name="overview-of-pre-backup-tasks"></a><span data-ttu-id="ee6f4-103">Visão geral das tarefas de pré-backup</span><span class="sxs-lookup"><span data-stu-id="ee6f4-103">Overview of Pre-Backup Tasks</span></span>

<span data-ttu-id="ee6f4-104">As tarefas de pré-backup no VSS concentram-se na criação de uma cópia de sombra dos volumes que contêm dados para backup.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-104">Pre-backup tasks under VSS are focused on creating a shadow copy of the volumes containing data for backup.</span></span> <span data-ttu-id="ee6f4-105">O aplicativo de backup salvará os dados da cópia de sombra, não do volume real.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-105">The backup application will save data from the shadow copy, not the actual volume.</span></span> <span data-ttu-id="ee6f4-106">Para obter mais informações, consulte [visão geral do processamento de um backup em VSS](overview-of-processing-a-backup-under-vss.md).</span><span class="sxs-lookup"><span data-stu-id="ee6f4-106">For more information, see [Overview of Processing a Backup Under VSS](overview-of-processing-a-backup-under-vss.md).</span></span>

<span data-ttu-id="ee6f4-107">Os solicitantes normalmente esperam que os gravadores se preparem para o backup e criem a cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-107">Requesters typically wait for writers to prepare for backup and creating the shadow copy.</span></span> <span data-ttu-id="ee6f4-108">O gravador deve determinar se é para participar do backup e, se estiver, configurar seus arquivos e para estar pronto para backup e cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-108">The writer must determine if it is to participate in the backup and, if it is, configure its files and itself to be ready for backup and shadow copy.</span></span> <span data-ttu-id="ee6f4-109">A tabela a seguir mostra a sequência de ações e eventos que são necessários para se preparar para uma operação de backup.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-109">The following table shows the sequence of actions and events that are required to prepare for a backup operation.</span></span>



| <span data-ttu-id="ee6f4-110">Ação do solicitante</span><span class="sxs-lookup"><span data-stu-id="ee6f4-110">Requester action</span></span>                                                                                                                                                                                                                                                                                                            | <span data-ttu-id="ee6f4-111">Evento</span><span class="sxs-lookup"><span data-stu-id="ee6f4-111">Event</span></span>                                                                      | <span data-ttu-id="ee6f4-112">Ação do gravador</span><span class="sxs-lookup"><span data-stu-id="ee6f4-112">Writer action</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="ee6f4-113">O solicitante pode definir opções de backup (consulte [**IVssBackupComponents:: Setbackupoptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupoptions))</span><span class="sxs-lookup"><span data-stu-id="ee6f4-113">The requester can set backup options (see [**IVssBackupComponents::SetBackupOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupoptions))</span></span>                                                                                                                                                                                          | <span data-ttu-id="ee6f4-114">Nenhum</span><span class="sxs-lookup"><span data-stu-id="ee6f4-114">None</span></span>                                                                       | <span data-ttu-id="ee6f4-115">Nenhum</span><span class="sxs-lookup"><span data-stu-id="ee6f4-115">None</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| <span data-ttu-id="ee6f4-116">Suporte a operações de backup incrementais e diferenciais examinando quaisquer carimbos de backup armazenados (consulte [**IVssComponent:: GetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupstamp), [**IVssBackupComponents:: SetPreviousBackupStamp**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp))</span><span class="sxs-lookup"><span data-stu-id="ee6f4-116">Support incremental and differential backup operations by examining any stored backup stamps (see [**IVssComponent::GetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupstamp), [**IVssBackupComponents::SetPreviousBackupStamp**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp))</span></span>                                               | <span data-ttu-id="ee6f4-117">Nenhum</span><span class="sxs-lookup"><span data-stu-id="ee6f4-117">None</span></span>                                                                       | <span data-ttu-id="ee6f4-118">Nenhum</span><span class="sxs-lookup"><span data-stu-id="ee6f4-118">None</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| <span data-ttu-id="ee6f4-119">Notifique os gravadores para se preparar para uma operação de backup usando [ **IVssBackupComponents::P repareforbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup)</span><span class="sxs-lookup"><span data-stu-id="ee6f4-119">Notify writers to prepare for a backup operation using [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup)</span></span>                                                                                                                                                                              | [<span data-ttu-id="ee6f4-120">*PrepareForBackup*</span><span class="sxs-lookup"><span data-stu-id="ee6f4-120">*PrepareForBackup*</span></span>](vssgloss-p.md)  | <span data-ttu-id="ee6f4-121">As preparações do gravador incluem determinar se os arquivos devem ser copiados em backup, se o gravador participará do congelamento da cópia de sombra, bem como da criação de metadados específicos do gravador (consulte [**CVssWriter:: OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup), [**CVssWriter:: IsPathAffected**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispathaffected), [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents), [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent), [**IVssComponent:: getbackupoptions**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupoptions), [**CVssWriter:: AreComponentsSelected**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-arecomponentsselected), [**IVssComponent:: SetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupmetadata)e [**IVssComponent:: GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp).</span><span class="sxs-lookup"><span data-stu-id="ee6f4-121">Writer preparations include determining if files are to be backed up, whether the writer will participate in the shadow copy freeze, as well as creating writer-specific metadata (see [**CVssWriter::OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup), [**CVssWriter::IsPathAffected**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispathaffected), [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents), [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent), [**IVssComponent::GetBackupOptions**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupoptions), [**CVssWriter::AreComponentsSelected**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-arecomponentsselected), [**IVssComponent::SetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupmetadata), and [**IVssComponent::GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp).</span></span> |
| <span data-ttu-id="ee6f4-122">O solicitante aguarda que os gravadores sejam configurados para backup usando [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync).</span><span class="sxs-lookup"><span data-stu-id="ee6f4-122">The requester waits for writers to set up for backup using [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync).</span></span> <span data-ttu-id="ee6f4-123">Ele também deve verificar o status do gravador (consulte [**IVssBackupComponents:: GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents:: GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus))</span><span class="sxs-lookup"><span data-stu-id="ee6f4-123">It should also verify writer status (see [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus))</span></span>     | <span data-ttu-id="ee6f4-124">Nenhum</span><span class="sxs-lookup"><span data-stu-id="ee6f4-124">None</span></span>                                                                       | <span data-ttu-id="ee6f4-125">Nenhum</span><span class="sxs-lookup"><span data-stu-id="ee6f4-125">None</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| <span data-ttu-id="ee6f4-126">O solicitante solicita uma cópia de sombra usando [ **IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset)</span><span class="sxs-lookup"><span data-stu-id="ee6f4-126">Requester requests a shadow copy using [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset)</span></span>                                                                                                                                                                                                    | <span data-ttu-id="ee6f4-127">Nenhum</span><span class="sxs-lookup"><span data-stu-id="ee6f4-127">None</span></span>                                                                       | <span data-ttu-id="ee6f4-128">Nenhum</span><span class="sxs-lookup"><span data-stu-id="ee6f4-128">None</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| <span data-ttu-id="ee6f4-129">Nenhum</span><span class="sxs-lookup"><span data-stu-id="ee6f4-129">None</span></span>                                                                                                                                                                                                                                                                                                                        | [<span data-ttu-id="ee6f4-130">*PrepareForSnapshot*</span><span class="sxs-lookup"><span data-stu-id="ee6f4-130">*PrepareForSnapshot*</span></span>](vssgloss-p.md) | <span data-ttu-id="ee6f4-131">[**CVssWriter:: OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot): colocar o gravador em um estado pronto de cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-131">[**CVssWriter::OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot): Put the writer into a shadow copy ready state.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| <span data-ttu-id="ee6f4-132">Nenhum</span><span class="sxs-lookup"><span data-stu-id="ee6f4-132">None</span></span>                                                                                                                                                                                                                                                                                                                        | [<span data-ttu-id="ee6f4-133">*Congelamento*</span><span class="sxs-lookup"><span data-stu-id="ee6f4-133">*Freeze*</span></span>](vssgloss-f.md)                      | <span data-ttu-id="ee6f4-134">[**CVssWriter:: OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze): configuração final antes da cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-134">[**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze): Final setup before the shadow copy.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| <span data-ttu-id="ee6f4-135">Nenhum</span><span class="sxs-lookup"><span data-stu-id="ee6f4-135">None</span></span>                                                                                                                                                                                                                                                                                                                        | [<span data-ttu-id="ee6f4-136">*Congelar*</span><span class="sxs-lookup"><span data-stu-id="ee6f4-136">*Thaw*</span></span>](vssgloss-t.md)                          | <span data-ttu-id="ee6f4-137">[**CVssWriter:: descongelar**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw): o funcionamento normal (incluindo e/s) pode ser retomado.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-137">[**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw): Normal functioning (including I/O) can resume.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| <span data-ttu-id="ee6f4-138">Nenhum</span><span class="sxs-lookup"><span data-stu-id="ee6f4-138">None</span></span>                                                                                                                                                                                                                                                                                                                        | [<span data-ttu-id="ee6f4-139">*Pós-instantâneo*</span><span class="sxs-lookup"><span data-stu-id="ee6f4-139">*PostSnapshot*</span></span>](vssgloss-p.md)          | <span data-ttu-id="ee6f4-140">[**CVssWriter:: OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot): a limpeza final dos preparações de cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-140">[**CVssWriter::OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot): Final clean ups of shadow copy preparations.</span></span> <span data-ttu-id="ee6f4-141">Consulte [**IVssComponent:: AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) e [**IVssComponent:: SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp).</span><span class="sxs-lookup"><span data-stu-id="ee6f4-141">See [**IVssComponent::AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) and [**IVssComponent::SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp).</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| <span data-ttu-id="ee6f4-142">O solicitante aguarda a conclusão da cópia de sombra usando: [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync), ele também deve verificar o status do gravador (consulte [**IVssBackupComponents:: GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents:: GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)</span><span class="sxs-lookup"><span data-stu-id="ee6f4-142">Requester waits for completion of shadow copy using: [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync), it should also verify writer status (see [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)</span></span><br/> | <span data-ttu-id="ee6f4-143">Nenhum</span><span class="sxs-lookup"><span data-stu-id="ee6f4-143">None</span></span>                                                                       | <span data-ttu-id="ee6f4-144">Nenhum</span><span class="sxs-lookup"><span data-stu-id="ee6f4-144">None</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |



 

## <a name="requester-pre-backup-tasks"></a><span data-ttu-id="ee6f4-145">Tarefas de pré-backup do solicitante</span><span class="sxs-lookup"><span data-stu-id="ee6f4-145">Requester Pre-Backup Tasks</span></span>

<span data-ttu-id="ee6f4-146">Além disso, antes de criar um evento [**IVssBackupComponents::P repareforbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) , um solicitante também pode definir opções de backup para gravadores individuais usando [**IVssBackupComponents:: setbackupoptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupoptions) dependendo das especificidades de cada gravador e se um solicitante está ciente deles.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-146">In addition, before creating a [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) event, a requester may also set backup options for individual writers using [**IVssBackupComponents::SetBackupOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupoptions) depending on the specifics of each writer and whether a requester is aware of them.</span></span>

<span data-ttu-id="ee6f4-147">Para dar suporte a operações incrementais e diferenciais, os solicitantes podem, neste ponto, optar por examinar os componentes de carimbos de data/hora da operação de backup anterior (usando [**IVssComponent:: GetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupstamp)) e usar essas informações para definir um carimbo de data/hora anterior para um gravador processar (usando [**IVssBackupComponents:: SetPreviousBackupStamp**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp)).</span><span class="sxs-lookup"><span data-stu-id="ee6f4-147">To support incremental and differential operations, requesters may at this point choose to examine components for time stamps of earlier backup operation (using [**IVssComponent::GetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupstamp)) and use that information to set a previous time stamp for a writer to process (using [**IVssBackupComponents::SetPreviousBackupStamp**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp)).</span></span> <span data-ttu-id="ee6f4-148">Consulte [backups incrementais e diferenciais](incremental-and-differential-backups.md) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-148">See [Incremental and Differential Backups](incremental-and-differential-backups.md) for more information.</span></span>

<span data-ttu-id="ee6f4-149">Um solicitante agora pode direcionar os gravadores do sistema para concluir preparações de pré-backup e para lidar com a criação de uma cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-149">A requester can now direct the system's writers to complete pre-backup preparations and to handle the creation of a shadow copy.</span></span>

<span data-ttu-id="ee6f4-150">Primeiro, o solicitante gera um evento [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) chamando [**IVssBackupComponents::P repareforbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup).</span><span class="sxs-lookup"><span data-stu-id="ee6f4-150">First, the requester generates a [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) event by calling [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup).</span></span>

<span data-ttu-id="ee6f4-151">Depois que todos os criadores de participação retornam do tratamento do evento [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) (que um solicitante determina usando a instância da interface [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync) retornada pelo **PrepareForBackup**), o solicitante pode iniciar a cópia de sombra chamando [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset), que, conforme progride, gerará eventos [*PrepareForSnapshot*](vssgloss-p.md), [*Freeze*](vssgloss-f.md), [*descongelar*](vssgloss-t.md)e [*upsnapshot*](vssgloss-p.md) para que os gravadores manipulem.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-151">After all participating writers return from handling the [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) event (which a requester determines by using the instance of the [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync) interface returned by **PrepareForBackup**), the requester can initiate the shadow copy by calling [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset), which, as it progresses, will generate [*PrepareForSnapshot*](vssgloss-p.md), [*Freeze*](vssgloss-f.md), [*Thaw*](vssgloss-t.md), and [*PostSnapshot*](vssgloss-p.md) events for the writers to handle.</span></span>

<span data-ttu-id="ee6f4-152">Há alguns casos em que um solicitante pode não precisar criar uma cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-152">There are some cases where a requester may not need to create a shadow copy.</span></span> <span data-ttu-id="ee6f4-153">Especificamente, cada [*conjunto de arquivos*](vssgloss-f.md) gerenciado por um dos componentes de um determinado gravador tem uma máscara de backup de especificação de arquivo (indicada por um ou bit ou de valores de tipo de backup de especificação de [**\_ arquivo \_ \_ \_ VSS**](/windows/desktop/api/Vss/ne-vss-vss_file_spec_backup_type) ) definido durante o evento de [*identificação*](vssgloss-i.md) .</span><span class="sxs-lookup"><span data-stu-id="ee6f4-153">Specifically, each [*file set*](vssgloss-f.md) managed by one of a given writer's components has a File Specification Backup mask (indicated by a bitwise OR of [**VSS\_FILE\_SPEC\_BACKUP\_TYPE**](/windows/desktop/api/Vss/ne-vss-vss_file_spec_backup_type) values) set during the [*Identify*](vssgloss-i.md) event.</span></span> <span data-ttu-id="ee6f4-154">Essa máscara especifica, entre outras coisas, se um conjunto de arquivos exige que o sistema seja copiado em sombra antes de seu backup ser executado.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-154">This mask specifies, among other things, whether a file set requires the system to be shadow copied before its backup is performed.</span></span>

<span data-ttu-id="ee6f4-155">Se nenhum conjunto de arquivos a ser submetido a backup em qualquer volume exigir uma cópia de sombra, [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) não precisa ser chamado.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-155">If no file sets to be backed up on any volumes require a shadow copy, then [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) need not be called.</span></span>

## <a name="writer-pre-backup-tasks"></a><span data-ttu-id="ee6f4-156">Tarefas de pré-backup do gravador</span><span class="sxs-lookup"><span data-stu-id="ee6f4-156">Writer Pre-Backup Tasks</span></span>

<span data-ttu-id="ee6f4-157">Ao manipular o evento [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) , o VSS chamará o método [**CVssWriter:: OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) de cada gravador, um método virtual que, por padrão, simplesmente retorna true.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-157">When handling the [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) event, VSS will call each writer's [**CVssWriter::OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) method, a virtual method, which by default simply returns true.</span></span>

<span data-ttu-id="ee6f4-158">Os gravadores podem substituir essa implementação padrão e usar a manipulação para encontrar informações sobre o próximo backup e executar a ação.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-158">Writers can override this default implementation and use the handling to find information about the upcoming backup and take action.</span></span>

<span data-ttu-id="ee6f4-159">Um gravador pode determinar informações sobre o tipo de operação de backup contempladas usando os seguintes métodos:</span><span class="sxs-lookup"><span data-stu-id="ee6f4-159">A writer can determine information about the sort of backup operation contemplated by using the following methods:</span></span>

1.  [<span data-ttu-id="ee6f4-160">**CVssWriter:: getbackuptype**</span><span class="sxs-lookup"><span data-stu-id="ee6f4-160">**CVssWriter::GetBackupType**</span></span>](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-getbackuptype)
2.  [<span data-ttu-id="ee6f4-161">**CVssWriter::IsBootableStateBackedUp**</span><span class="sxs-lookup"><span data-stu-id="ee6f4-161">**CVssWriter::IsBootableStateBackedUp**</span></span>](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-isbootablesystemstatebackedup)
3.  [<span data-ttu-id="ee6f4-162">**CVssWriter::AreComponentsSelected**</span><span class="sxs-lookup"><span data-stu-id="ee6f4-162">**CVssWriter::AreComponentsSelected**</span></span>](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-arecomponentsselected)

<span data-ttu-id="ee6f4-163">Um gravador determina se os arquivos que ele gerencia estarão envolvidos na cópia de sombra usando [**CVssWriter:: IsPathAffected**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispathaffected).</span><span class="sxs-lookup"><span data-stu-id="ee6f4-163">A writer determines if the files it manages will be involved in the shadow copy by using [**CVssWriter::IsPathAffected**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispathaffected).</span></span>

<span data-ttu-id="ee6f4-164">Mais importante: quando o VSS chama o método [**CVssWriter:: OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) , ele passa uma instância da interface [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) , que permite o acesso direto por meio da interface [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) para aqueles de seus componentes [*explicitamente incluídos*](vssgloss-e.md) no documento de componentes de backup do solicitante.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-164">More important, when VSS calls the [**CVssWriter::OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) method, it passes in an instance of the [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) interface, which allows direct access through the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface to those of its components [*explicitly included*](vssgloss-e.md) in the requester's Backup Components Document.</span></span> <span data-ttu-id="ee6f4-165">O gravador usou as instâncias da interface **IVssComponent** que definem conjuntos de componentes para obter acesso ao componente *incluído implicitamente* (consulte a [seleção e trabalhando com propriedades de componente](selectability-and-working-with-component-properties.md)).</span><span class="sxs-lookup"><span data-stu-id="ee6f4-165">The writer used the instances of the **IVssComponent** interface that define component sets to gain access to its *implicitly included* component (see [Selectability and working with Component Properties](selectability-and-working-with-component-properties.md)).</span></span>

<span data-ttu-id="ee6f4-166">Durante a manipulação do evento [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) , os gravadores usam a interface [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) para executar operações componente a componente (ou conjunto de componentes por conjunto de componentes), incluindo:</span><span class="sxs-lookup"><span data-stu-id="ee6f4-166">During the handling of the [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) event, writers use the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface to perform component-by-component (or component set by component set) operations, including:</span></span>

1.  <span data-ttu-id="ee6f4-167">Adicionando [*arquivos parciais*](vssgloss-p.md) (se houver suporte) chamando [**IVssComponent:: addparcialfile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile).</span><span class="sxs-lookup"><span data-stu-id="ee6f4-167">Adding [*partial files*](vssgloss-p.md) (if supported) by calling [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile).</span></span>
2.  <span data-ttu-id="ee6f4-168">Definir quaisquer metadados privados que o gravador precisará para lidar com a restauração.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-168">Setting any private metadata that the writer will need to handle the restore.</span></span>
3.  <span data-ttu-id="ee6f4-169">Se o gravador oferecer suporte a backups incrementais e diferenciais (consulte [backups incrementais e diferenciais](incremental-and-differential-backups.md)), faça o seguinte:</span><span class="sxs-lookup"><span data-stu-id="ee6f4-169">If the writer supports incremental and differential backups (see [Incremental and Differential Backups](incremental-and-differential-backups.md)), doing the following:</span></span>
    -   <span data-ttu-id="ee6f4-170">Verificando carimbos de data/hora de backup anteriores chamando [**IVssComponent:: GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp).</span><span class="sxs-lookup"><span data-stu-id="ee6f4-170">Checking for previous backup time stamps by calling [**IVssComponent::GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp).</span></span>
    -   <span data-ttu-id="ee6f4-171">Adicionar quaisquer [*arquivos diferenciados*](vssgloss-d.md) necessários chamando [**IVssComponent:: AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime).</span><span class="sxs-lookup"><span data-stu-id="ee6f4-171">Adding any required [*differenced files*](vssgloss-d.md) by calling [**IVssComponent::AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime).</span></span>
    -   <span data-ttu-id="ee6f4-172">Se o gravador for compatível com o esquema de **\_ \_ carimbo** de data/hora do VSS, adicionar cadeias de caracteres de carimbo de data/horário de backup no formato próprio do gravador usando [**IVssComponent:: SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp).</span><span class="sxs-lookup"><span data-stu-id="ee6f4-172">If the writer supports the **VSS\_BS\_TIMESTAMPED** schema, adding backup time-stamp strings in the writer's own format using [**IVssComponent::SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp).</span></span>
4.  <span data-ttu-id="ee6f4-173">Iniciar operações assíncronas muito demoradas, como sincronização de dados em vários discos.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-173">Initiating very time-consuming asynchronous operations, such as synchronizing data across multiple disks.</span></span> <span data-ttu-id="ee6f4-174">Isso permitirá que o gravador continue trabalhando enquanto a operação é processada, incluindo o tratamento de outros eventos do VSS.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-174">This will allow the writer to continue working while the operation is processed, including handling other VSS events.</span></span> <span data-ttu-id="ee6f4-175">Essas operações devem terminar antes do evento [*Freeze*](vssgloss-f.md) .</span><span class="sxs-lookup"><span data-stu-id="ee6f4-175">These operations must terminate before the [*Freeze*](vssgloss-f.md) event.</span></span>

<span data-ttu-id="ee6f4-176">A chamada do solicitante para [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) inicia a cópia de sombra e gera os seguintes eventos para que os gravadores manipulem:</span><span class="sxs-lookup"><span data-stu-id="ee6f4-176">The requester's call to [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) initiates the shadow copy and generates the following events for the writers to handle:</span></span>

-   [<span data-ttu-id="ee6f4-177">*PrepareForSnapshot*</span><span class="sxs-lookup"><span data-stu-id="ee6f4-177">*PrepareForSnapshot*</span></span>](vssgloss-p.md)
-   [<span data-ttu-id="ee6f4-178">*Congelamento*</span><span class="sxs-lookup"><span data-stu-id="ee6f4-178">*Freeze*</span></span>](vssgloss-f.md)
-   [<span data-ttu-id="ee6f4-179">*Congelar*</span><span class="sxs-lookup"><span data-stu-id="ee6f4-179">*Thaw*</span></span>](vssgloss-t.md)
-   [<span data-ttu-id="ee6f4-180">*Pós-instantâneo*</span><span class="sxs-lookup"><span data-stu-id="ee6f4-180">*PostSnapshot*</span></span>](vssgloss-p.md)

<span data-ttu-id="ee6f4-181">Três dos manipuladores do escritor —[**CVssWriter:: OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot), [**CVssWriter:: OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze)e [**CVssWriter:: descongelar**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)— são métodos virtuais puros, e cada gravador deve implementá-los em vez de confiar nos padrões.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-181">Three of the writer's handlers—[**CVssWriter::OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot), [**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze), and [**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)—are pure virtual methods, and each writer must implement them rather than relying on defaults.</span></span> <span data-ttu-id="ee6f4-182">Dependendo das necessidades de um gravador, eles podem ser codificados como métodos fictícios, simplesmente retornando **true**.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-182">Depending on a writer's needs, they may be coded as dummy methods, simply returning **TRUE**.</span></span>

<span data-ttu-id="ee6f4-183">Como normalmente há uma janela de tempo estreita entre a emissão de um evento [*Freeze*](vssgloss-f.md) e a emissão de um evento de [*descongelamento*](vssgloss-t.md) , a maior parte do trabalho principal na preparação para a cópia de sombra — como desligar processos, criar arquivos temporários ou descarregar filas de e/s — seria manipulada em [**CVssWriter:: OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot).</span><span class="sxs-lookup"><span data-stu-id="ee6f4-183">Because there is typically a narrow time window between the issuing of a [*Freeze*](vssgloss-f.md) event and the issuing of a [*Thaw*](vssgloss-t.md) event, most of the major work in preparing for the shadow copy—such as shutting down processes, creating temporary files, or draining I/O queues—would be handled in [**CVssWriter::OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot).</span></span>

<span data-ttu-id="ee6f4-184">Como um gravador pode usar [**CVssWriter:: OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot) para lidar com sua e/s antes que a criação de uma cópia de sombra seja altamente dependente da própria arquitetura do gravador.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-184">How a writer might use [**CVssWriter::OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot) to handle its I/O before the creation of a shadow copy is highly dependent on the writer's own architecture.</span></span>

<span data-ttu-id="ee6f4-185">Gravadores que podem conter todas as gravações e manter os dados em um estado consistente absoluto antes de [*congelar*](vssgloss-f.md), devem fazer isso.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-185">Writers that can afford to hold all writes and keep the data in an absolute consistent state before [*Freeze*](vssgloss-f.md), should do so.</span></span>

<span data-ttu-id="ee6f4-186">Se o escritor não puder congelar sua e/s, deverá executar ações para criar uma fonte estável para backup e para reduzir o tempo de recuperação para uma cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-186">If the writer cannot freeze its I/O, then it should take actions to create a stable source for backup and to reduce the recovery time for a shadow copy.</span></span> <span data-ttu-id="ee6f4-187">Exemplos disso podem incluir o enfileiramento de solicitações de e/s de entrada ou a geração de um conjunto duplicado de arquivos em um [*caminho alternativo*](vssgloss-a.md) a ser usado como a origem de um backup.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-187">Examples of this might include queuing incoming I/O requests or generating a duplicate set of files in an [*alternate path*](vssgloss-a.md) to be used as the source of a backup.</span></span>

<span data-ttu-id="ee6f4-188">O método [**CVssWriter:: OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) executa tarefas simples e curtas, como verificar se a e/s esquerda [**CVssWriter:: OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot) saiu no estado correto e que todas as tarefas assíncronas iniciadas por [**CVssWriter:: OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) concluídas.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-188">The [**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) method performs simple, short tasks such as verifying that the [**CVssWriter::OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot) left I/O in the correct state, and that any asynchronous tasks started by [**CVssWriter::OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) completed.</span></span> <span data-ttu-id="ee6f4-189">Esse método é a última chance do escritor de vetar uma cópia de sombra se houver problemas (consulte [erros do gravador e vetas](writer-errors-and-vetoes.md)).</span><span class="sxs-lookup"><span data-stu-id="ee6f4-189">This method is a writer's last chance to veto a shadow copy if there are problems (see [Writer Errors and Vetoes](writer-errors-and-vetoes.md)).</span></span>

<span data-ttu-id="ee6f4-190">Geralmente, é possível que um gravador retome a operação normal após um evento de [*descongelamento*](vssgloss-t.md) : uma cópia de sombra pode não estar imediatamente pronta para backup após descongelar, mas um gravador deve ser capaz de retomar a operação normal.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-190">It is generally possible for a writer to resume normal operation following a [*Thaw*](vssgloss-t.md) event: a shadow copy may not be immediately ready for backup after the Thaw, but a writer should be able to resume normal operation.</span></span> <span data-ttu-id="ee6f4-191">Portanto, normalmente [**CVssWriter:: descongelar**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw) é usado por gravadores para retornar a um estado anterior ao congelamento.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-191">Therefore, typically [**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw) is used by writers to return to a pre-freeze state.</span></span> <span data-ttu-id="ee6f4-192">No entanto, todos os arquivos temporários criados para dar suporte à cópia de sombra devem ser deixados em vigor até o evento de [*pós-instantâneo*](vssgloss-p.md) .</span><span class="sxs-lookup"><span data-stu-id="ee6f4-192">However, any temporary files created to support the shadow copy should be left in place until the [*PostSnapshot*](vssgloss-p.md) event.</span></span> <span data-ttu-id="ee6f4-193">Normalmente, você usaria [**CVssWriter:: OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) para esse tipo de limpeza.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-193">Typically, you would use [**CVssWriter::OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) for this sort of cleanup.</span></span> <span data-ttu-id="ee6f4-194">Como muitos aplicativos não exigem esse tipo de limpeza, **CVssWriter:: OnPostSnapshot** é um método virtual com uma implementação padrão que simplesmente retorna **true**.</span><span class="sxs-lookup"><span data-stu-id="ee6f4-194">Because many applications do not require this sort of cleanup, **CVssWriter::OnPostSnapshot** is a virtual method with a default implementation that simply returns **TRUE**.</span></span> <span data-ttu-id="ee6f4-195">Se um backup incremental ou diferencial estiver sendo executado, o gravador poderá chamar [**IVssComponent:: GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp) e [**IVssComponent:: SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp).</span><span class="sxs-lookup"><span data-stu-id="ee6f4-195">If an incremental or differential backup is being performed, the writer may call [**IVssComponent::GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp) and [**IVssComponent::SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp).</span></span> <span data-ttu-id="ee6f4-196">Para obter mais informações, consulte [gravador função no backup de repositórios complexos](writer-role-in-backing-up-complex-stores.md).</span><span class="sxs-lookup"><span data-stu-id="ee6f4-196">For more information, see [Writer Role in Backing Up Complex Stores](writer-role-in-backing-up-complex-stores.md).</span></span> <span data-ttu-id="ee6f4-197">Outro método que pode ser chamado neste momento é [**IVssComponent:: AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime).</span><span class="sxs-lookup"><span data-stu-id="ee6f4-197">Another method that can be called at this time is [**IVssComponent::AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime).</span></span>

 

 




