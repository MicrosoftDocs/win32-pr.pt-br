---
description: O processo de criação de cópia de sombra
ms.assetid: ca484eec-31c6-4790-9232-3ed67263f6fb
title: O processo de criação de cópia de sombra
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4239e2b671edcaeb35b404d9b9411b43316c0212
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "103647174"
---
# <a name="the-shadow-copy-creation-process"></a><span data-ttu-id="2ff98-103">O processo de criação de cópia de sombra</span><span class="sxs-lookup"><span data-stu-id="2ff98-103">The Shadow Copy Creation Process</span></span>

<span data-ttu-id="2ff98-104">Veja a seguir uma descrição detalhada da função do provedor de hardware na criação de um conjunto de cópias de sombra.</span><span class="sxs-lookup"><span data-stu-id="2ff98-104">The following is a detailed description of the hardware provider's role in the creation of a shadow copy set.</span></span> <span data-ttu-id="2ff98-105">Para obter um diagrama desse processo, consulte [criação de cópia de sombra para provedores](shadow-copy-creation-for-providers.md).</span><span class="sxs-lookup"><span data-stu-id="2ff98-105">For a diagram of this process, see [Shadow Copy Creation for Providers](shadow-copy-creation-for-providers.md).</span></span>

1.  <span data-ttu-id="2ff98-106">Como o solicitante adiciona cada volume ao conjunto de cópias de sombra, o VSS determina os LUNs associados.</span><span class="sxs-lookup"><span data-stu-id="2ff98-106">As the requester adds each volume to the shadow copy set, VSS determines the associated LUNs.</span></span> <span data-ttu-id="2ff98-107">Por exemplo, um volume estendido pode ser composto por vários LUNs.</span><span class="sxs-lookup"><span data-stu-id="2ff98-107">For example, a spanned volume could be composed of multiple LUNs.</span></span> <span data-ttu-id="2ff98-108">O VSS cria uma [**\_ \_ informação de LUN VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) inicial usando informações de dispositivo físico para cada LUN.</span><span class="sxs-lookup"><span data-stu-id="2ff98-108">VSS creates an initial [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) using physical device information for each LUN.</span></span>
2.  <span data-ttu-id="2ff98-109">O VSS chama [**AreLunsSupported**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-arelunssupported) para determinar se o provedor oferece suporte a uma cópia de sombra para esse LUN.</span><span class="sxs-lookup"><span data-stu-id="2ff98-109">VSS calls [**AreLunsSupported**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-arelunssupported) to determine if the provider supports a shadow copy for that LUN.</span></span> <span data-ttu-id="2ff98-110">O provedor de hardware usa [**as \_ \_ informações de LUN VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) para determinar se há suporte para os LUNs.</span><span class="sxs-lookup"><span data-stu-id="2ff98-110">The hardware provider uses the [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) to determine whether the LUNs are supported.</span></span> <span data-ttu-id="2ff98-111">Essa determinação deve ser tudo ou nada — o mesmo provedor de hardware deve dar suporte a todos os LUNs que contribuem para um volume específico.</span><span class="sxs-lookup"><span data-stu-id="2ff98-111">This determination must be all or nothing—the same hardware provider must support all LUNs contributing to a specific volume.</span></span> <span data-ttu-id="2ff98-112">No exemplo de volume estendido, o provedor não pode indicar que ele dá suporte a apenas um dos LUNs que compõem o volume.</span><span class="sxs-lookup"><span data-stu-id="2ff98-112">In the spanned volume example, the provider cannot indicate that it supports only one of the LUNs that comprise the volume.</span></span>
3.  <span data-ttu-id="2ff98-113">Para cada volume no conjunto de cópias de sombra, o VSS chama [**IVssHardwareSnapshotProvider:: BeginPrepareSnapshot**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-beginpreparesnapshot) com a mesma matriz de estruturas de [**\_ \_ informações de LUN VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) .</span><span class="sxs-lookup"><span data-stu-id="2ff98-113">For each volume in the shadow copy set, VSS calls [**IVssHardwareSnapshotProvider::BeginPrepareSnapshot**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-beginpreparesnapshot) with the same array of [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) structures.</span></span> <span data-ttu-id="2ff98-114">Em uma única chamada, todos os LUNs na matriz são exclusivos, mas o mesmo LUN pode aparecer em uma chamada subsequente sempre que o mesmo LUN contribuir para vários volumes.</span><span class="sxs-lookup"><span data-stu-id="2ff98-114">Within a single call, all LUNs in the array are unique, but the same LUN may appear in a subsequent call whenever the same LUN contributes to multiple volumes.</span></span> <span data-ttu-id="2ff98-115">O provedor deve lidar com esse caso corretamente.</span><span class="sxs-lookup"><span data-stu-id="2ff98-115">The provider must handle that case correctly.</span></span>
4.  <span data-ttu-id="2ff98-116">Imediatamente após [**IVssProviderCreateSnapshotSet:: EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots), o VSS definirá os sinalizadores somente leitura, oculto, sem letra da unidade e cópia de sombra em todos os LUNs afetados.</span><span class="sxs-lookup"><span data-stu-id="2ff98-116">Immediately after [**IVssProviderCreateSnapshotSet::EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots), VSS will set the read-only, hidden, no drive letter, and shadow copy flags on all affected LUNs.</span></span> <span data-ttu-id="2ff98-117">Os sinalizadores são implementados usando setores ocultos em discos MBR ou bits específicos do sistema operacional na entrada de cabeçalho da partição em discos GPT.</span><span class="sxs-lookup"><span data-stu-id="2ff98-117">The flags are implemented using hidden sectors on MBR disks or operating-system-specific bits in the partition header entry on GPT disks.</span></span> <span data-ttu-id="2ff98-118">Os sinalizadores farão com que todos os volumes nos discos afetados sejam exibidos nos computadores de recebimento como somente leitura e ocultos.</span><span class="sxs-lookup"><span data-stu-id="2ff98-118">The flags will cause all volumes on the affected disks to be surfaced on the receiving machines as read-only and hidden.</span></span> <span data-ttu-id="2ff98-119">Observe que os LUNs copiados por sombra não foram confirmados nesse estágio, para que, no caso de uma falha do sistema, os sinalizadores sejam limpos e o LUN original não seja afetado.</span><span class="sxs-lookup"><span data-stu-id="2ff98-119">Note that the shadow-copied LUNs have not been committed at this stage, so that in the event of a system crash, the flags will be cleared and the original LUN will not be affected.</span></span> <span data-ttu-id="2ff98-120">Ou seja, todos os volumes no LUN original serão tratados como normais — e manterão suas atribuições de letra de unidade original, pastas montadas e status de leitura/gravação.</span><span class="sxs-lookup"><span data-stu-id="2ff98-120">That is, all volumes on the original LUN will be treated as normal—and keep their original drive-letter assignments, mounted folders, and read/write status.</span></span>
    > [!Note]  
    > <span data-ttu-id="2ff98-121">Os provedores não devem tentar modificar nenhum dos sinalizadores de LUN.</span><span class="sxs-lookup"><span data-stu-id="2ff98-121">Providers should not attempt to modify any of the LUN flags.</span></span>

     

5.  <span data-ttu-id="2ff98-122">Em [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots), os LUNs de cópia de sombra são confirmados.</span><span class="sxs-lookup"><span data-stu-id="2ff98-122">At [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots), the shadow copy LUNs are committed.</span></span> <span data-ttu-id="2ff98-123">**CommitSnapshots** deve ser retornado dentro de alguns segundos ou o processo de criação de cópia de sombra inteiro provavelmente falhará.</span><span class="sxs-lookup"><span data-stu-id="2ff98-123">**CommitSnapshots** should be returned within a few seconds or the whole shadow copy creation process will probably fail.</span></span>
6.  <span data-ttu-id="2ff98-124">Após [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots), o VSS limpa os sinalizadores em todos os LUNs originais envolvidos na cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="2ff98-124">After [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots), VSS clears the flags on all original LUNs involved in the shadow copy.</span></span> <span data-ttu-id="2ff98-125">Como os LUNs de cópia de sombra foram confirmados neste ponto, os LUNs de cópia de sombra retêm esses sinalizadores.</span><span class="sxs-lookup"><span data-stu-id="2ff98-125">Since the shadow copy LUNs have been committed at this point, the shadow copy LUNs retain these flags.</span></span>
7.  <span data-ttu-id="2ff98-126">Após [**IVssProviderCreateSnapshotSet::P ostcommitsnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots), o VSS limpa os sinalizadores de LUN (que ele definiu após [**IVssProviderCreateSnapshotSet:: EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots)) e notifica os gravadores para descongelar.</span><span class="sxs-lookup"><span data-stu-id="2ff98-126">After [**IVssProviderCreateSnapshotSet::PostCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots), VSS clears the LUN flags (that it set after [**IVssProviderCreateSnapshotSet::EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots)) and notifies the writers to thaw.</span></span> <span data-ttu-id="2ff98-127">Em seguida, o VSS chama os métodos [**IVssProviderCreateSnapshotSet::P refinalcommitsnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-prefinalcommitsnapshots) e [**IVssProviderCreateSnapshotSet::P ostfinalcommitsnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postfinalcommitsnapshots) do provedor.</span><span class="sxs-lookup"><span data-stu-id="2ff98-127">VSS then calls the provider's [**IVssProviderCreateSnapshotSet::PreFinalCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-prefinalcommitsnapshots) and [**IVssProviderCreateSnapshotSet::PostFinalCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postfinalcommitsnapshots) methods.</span></span>
8.  <span data-ttu-id="2ff98-128">O VSS recupera uma matriz de estruturas de [**\_ \_ informações de LUN VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) , uma para cada LUN de cópia de sombra criado recentemente, chamando [**IVssHardwareSnapshotProvider:: GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns).</span><span class="sxs-lookup"><span data-stu-id="2ff98-128">VSS retrieves an array of [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) structures, one for each newly created shadow copy LUN, by calling [**IVssHardwareSnapshotProvider::GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns).</span></span> <span data-ttu-id="2ff98-129">O provedor deve fornecer informações suficientes para permitir que o VSS e o provedor identifiquem as cópias de sombra em qualquer momento posterior e em qualquer sistema conectado ao subsistema.</span><span class="sxs-lookup"><span data-stu-id="2ff98-129">The provider must provide enough information to allow VSS and the provider to identify the shadow copies at any later time and on any system connected to the subsystem.</span></span> <span data-ttu-id="2ff98-130">Neste momento, os LUNs de cópia de sombra devem estar inacessíveis a esse computador — o provedor deve usar algum mecanismo além de simplesmente ler as informações do LUN.</span><span class="sxs-lookup"><span data-stu-id="2ff98-130">At this time, the shadow copy LUNs should be inaccessible to this machine—the provider must use some mechanism other than by simply reading the information from the LUN.</span></span>
9.  <span data-ttu-id="2ff98-131">Para cópias de sombra transportáveis, o VSS acrescenta o seguinte ao documento de componentes de backup que descreve o conjunto de cópias de sombra:</span><span class="sxs-lookup"><span data-stu-id="2ff98-131">For transportable shadow copies, VSS appends the following to the Backup Components Document describing the shadow copy set:</span></span>
    1.  <span data-ttu-id="2ff98-132">A matriz de [**\_ \_ informações do LUN VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) do LUN original.</span><span class="sxs-lookup"><span data-stu-id="2ff98-132">The original LUN [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) array.</span></span>
    2.  <span data-ttu-id="2ff98-133">A nova matriz de [**informações de \_ LUN \_ VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) de LUN de cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="2ff98-133">The new shadow copy LUN [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) array.</span></span>
    3.  <span data-ttu-id="2ff98-134">As extensões de disco para cada volume no conjunto de cópias de sombra.</span><span class="sxs-lookup"><span data-stu-id="2ff98-134">The disk extents for each volume in the shadow copy set.</span></span>
10. <span data-ttu-id="2ff98-135">Para a importação automática de cópias de sombra, o processo de importação é iniciado.</span><span class="sxs-lookup"><span data-stu-id="2ff98-135">For auto-import shadow copies, the import process begins.</span></span> <span data-ttu-id="2ff98-136">Em [**IVssHardwareSnapshotProvider:: LocateLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-locateluns), o provedor receberá as [**informações de \_ LUN \_ VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) geradas em [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) no momento da criação.</span><span class="sxs-lookup"><span data-stu-id="2ff98-136">In [**IVssHardwareSnapshotProvider::LocateLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-locateluns), the provider will be given the [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) generated in [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) at creation time.</span></span> <span data-ttu-id="2ff98-137">Durante a **LocateLuns**, o provedor deve tornar esses LUNs de cópia de sombra visíveis para o sistema.</span><span class="sxs-lookup"><span data-stu-id="2ff98-137">During **LocateLuns**, the provider should make those shadow copy LUNs visible to the system.</span></span> <span data-ttu-id="2ff98-138">O provedor não deve fazer um novo exame do barramento.</span><span class="sxs-lookup"><span data-stu-id="2ff98-138">The provider should not cause a bus rescan.</span></span> <span data-ttu-id="2ff98-139">O VSS causará a nova verificação e a enumeração para permitir que os LUNs sejam descobertos por PNP e os volumes sejam online.</span><span class="sxs-lookup"><span data-stu-id="2ff98-139">VSS will cause the rescan and enumeration to allow the LUNs to be discovered by PNP and the volumes to come online.</span></span>
11. <span data-ttu-id="2ff98-140">O VSS chama [**IVssHardwareSnapshotProvider:: FillInLunInfo**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-fillinluninfo) para os discos recentemente recebidos no sistema.</span><span class="sxs-lookup"><span data-stu-id="2ff98-140">VSS calls [**IVssHardwareSnapshotProvider::FillInLunInfo**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-fillinluninfo) for the newly arrived disks in the system.</span></span> <span data-ttu-id="2ff98-141">O VSS usa a matriz de [**\_ \_ informações de LUN**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) de cópia de sombra LUN VDS do **FillInLunInfo**, comparando-a com as **\_ \_ informações de LUN VDS** geradas durante a criação em [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) e as extensões de disco para cada volume na cópia de sombra definida para identificar os LUNs de cópia de sombra recentemente recebidos.</span><span class="sxs-lookup"><span data-stu-id="2ff98-141">VSS uses the shadow copy LUN [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) array from **FillInLunInfo**, comparing it with the **VDS\_LUN\_INFORMATION** generated during creation in [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) and the disk extents for each volume in the shadow copy set to identify the newly arrived shadow copy LUNs.</span></span>
12. <span data-ttu-id="2ff98-142">Neste ponto, todos os volumes contidos nos LUNs de cópia de sombra são montados como somente leitura e ocultos, e o VSS tem um mapeamento do volume original para o volume da cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="2ff98-142">At this point, all volumes contained on the shadow copy LUNs are mounted hidden and read-only, and VSS has a mapping from original volume to shadow copy volume.</span></span>

<span data-ttu-id="2ff98-143">Como um único LUN pode conter partes de vários volumes, o conjunto de LUNs de cópia de sombra pode incluir volumes "extras".</span><span class="sxs-lookup"><span data-stu-id="2ff98-143">Because a single LUN can contain portions of multiple volumes, the set of shadow copy LUNs may include "extra" volumes.</span></span> <span data-ttu-id="2ff98-144">Esses volumes não fazem parte do conjunto de cópias de sombra e não devem ser usados, pois não há garantia de que eles sejam consistentes.</span><span class="sxs-lookup"><span data-stu-id="2ff98-144">Those volumes are not part of the shadow copy set and should not be used as they are not guaranteed to be consistent.</span></span>

<span data-ttu-id="2ff98-145">Após a importação, a cópia de sombra pode ser acessada por meio do método [**IVssBackupComponents:: Query**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-query) .</span><span class="sxs-lookup"><span data-stu-id="2ff98-145">After import, the shadow copy can be accessed via the [**IVssBackupComponents::Query**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-query) method.</span></span> <span data-ttu-id="2ff98-146">Uma cópia de sombra também pode ser exposta como uma letra da unidade, pasta montada ou compartilhamento usando [**IVssBackupComponents:: ExposeSnapshot**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-exposesnapshot).</span><span class="sxs-lookup"><span data-stu-id="2ff98-146">A shadow copy can also be exposed as a drive letter, mounted folder, or share using [**IVssBackupComponents::ExposeSnapshot**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-exposesnapshot).</span></span> <span data-ttu-id="2ff98-147">Um conjunto de cópias de sombra também pode ser convertido em um LUN regular usando o método [**IVssBackupComponents:: BreakSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-breaksnapshotset) .</span><span class="sxs-lookup"><span data-stu-id="2ff98-147">A shadow copy set may also be converted to a regular LUN by using the [**IVssBackupComponents::BreakSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-breaksnapshotset) method.</span></span> <span data-ttu-id="2ff98-148">A partir daí, os aplicativos de gerenciamento podem usar APIs de gerenciamento de disco apropriadas para gerenciar ainda mais o LUN (como alterar os atributos de leitura/gravação).</span><span class="sxs-lookup"><span data-stu-id="2ff98-148">From there management applications can use appropriate disk management APIs to further manage the LUN (such as changing the read/write attributes).</span></span>

### <a name="transportable-shadow-copies-on-a-san"></a><span data-ttu-id="2ff98-149">Cópias de sombra transportáveis em uma SAN</span><span class="sxs-lookup"><span data-stu-id="2ff98-149">Transportable Shadow Copies on a SAN</span></span>

<span data-ttu-id="2ff98-150">A partir do Windows Server 2003, Datacenter Edition e Windows Server 2003, Enterprise Edition, o VSS habilita conjuntos de cópia de sombra transportáveis em uma SAN.</span><span class="sxs-lookup"><span data-stu-id="2ff98-150">Beginning with Windows Server 2003, Datacenter Edition and Windows Server 2003, Enterprise Edition, VSS enables transportable shadow copy sets on a SAN.</span></span> <span data-ttu-id="2ff98-151">Do ponto de vista de um provedor capaz de transportar LUNs entre hosts, há pouca ou nenhuma diferença entre um conjunto de cópia de sombra não transportável e transportável.</span><span class="sxs-lookup"><span data-stu-id="2ff98-151">From the point of view of a provider capable of transporting LUNs between hosts, there is little or no difference between a non-transportable and a transportable shadow copy set.</span></span>

<span data-ttu-id="2ff98-152">**Windows server 2003, Standard Edition, Windows server 2003, Web Edition e Windows XP:** Não há suporte para conjuntos de cópia de sombra transportáveis.</span><span class="sxs-lookup"><span data-stu-id="2ff98-152">**Windows Server 2003, Standard Edition, Windows Server 2003, Web Edition and Windows XP:** Transportable shadow copy sets are not supported.</span></span> <span data-ttu-id="2ff98-153">Todas as edições do Windows Server 2003 com Service Pack 1 (SP1) oferecem suporte a conjuntos de cópia de sombra transportáveis.</span><span class="sxs-lookup"><span data-stu-id="2ff98-153">All editions of Windows Server 2003 with Service Pack 1 (SP1) support transportable shadow copy sets.</span></span>

<span data-ttu-id="2ff98-154">Os conjuntos de cópia de sombra transportáveis devem ser criados com o atributo **\_ \_ \_ transportável do VSS VOLSNAP attr** adicionado ao contexto de cópia de sombra descrito pela enumeração [**\_ \_ atributos de \_ instantâneo \_ de volume do VSS**](/windows/desktop/api/Vss/ne-vss-vss_volume_snapshot_attributes) .</span><span class="sxs-lookup"><span data-stu-id="2ff98-154">Transportable shadow copy sets must be created with the **VSS\_VOLSNAP\_ATTR\_TRANSPORTABLE** attribute added to the shadow copy context described by the [**\_VSS\_VOLUME\_SNAPSHOT\_ATTRIBUTES**](/windows/desktop/api/Vss/ne-vss-vss_volume_snapshot_attributes) enumeration.</span></span> <span data-ttu-id="2ff98-155">Todos os volumes no conjunto devem ser transportáveis.</span><span class="sxs-lookup"><span data-stu-id="2ff98-155">All volumes in the set must be transportable.</span></span> <span data-ttu-id="2ff98-156">Ao retornar o sucesso de [**IVssHardwareSnapshotProvider:: AreLunsSupported**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-arelunssupported), o provedor indica que ele não apenas oferece suporte ao LUN, mas também que ele pode transportar o LUN.</span><span class="sxs-lookup"><span data-stu-id="2ff98-156">By returning success from [**IVssHardwareSnapshotProvider::AreLunsSupported**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-arelunssupported), the provider is indicating that not only does it support the LUN, but also that it can transport the LUN.</span></span> <span data-ttu-id="2ff98-157">A criação de um conjunto de cópia de sombra transportável é concluída quando o VSS registra as informações de LUN no documento de componentes de backup.</span><span class="sxs-lookup"><span data-stu-id="2ff98-157">The creation of a transportable shadow copy set concludes when VSS records the LUN information in the Backup Components Document.</span></span> <span data-ttu-id="2ff98-158">Um conjunto de cópias de sombra só pode ser importado uma vez após a criação inicial.</span><span class="sxs-lookup"><span data-stu-id="2ff98-158">A shadow copy set may only be imported once after initial creation.</span></span>

<span data-ttu-id="2ff98-159">No computador receptor, o solicitante importa o conjunto de cópias de sombra.</span><span class="sxs-lookup"><span data-stu-id="2ff98-159">On the receiving machine, the requester imports the shadow copy set.</span></span> <span data-ttu-id="2ff98-160">O método [**IVssBackupComponents:: ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) usa o documento componentes de backup que descreve o conjunto de cópias de sombra como entrada.</span><span class="sxs-lookup"><span data-stu-id="2ff98-160">The [**IVssBackupComponents::ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) method uses the Backup Components Document describing the shadow copy set as input.</span></span> <span data-ttu-id="2ff98-161">A importação prossegue por:</span><span class="sxs-lookup"><span data-stu-id="2ff98-161">Importing proceeds by:</span></span>

1.  <span data-ttu-id="2ff98-162">O VSS constrói uma matriz de estruturas de [**\_ \_ informações de LUN VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) de cópia de sombra do documento de componentes de backup.</span><span class="sxs-lookup"><span data-stu-id="2ff98-162">VSS constructs an array of shadow copy [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) structures from the Backup Components Document.</span></span>
2.  <span data-ttu-id="2ff98-163">Quando o VSS chama [**IVssHardwareSnapshotProvider:: LocateLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-locateluns), a matriz de estruturas de [**\_ \_ informações de LUN VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) gerada em [**IVssHardwareSnapshotProvider:: GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) será passada para o provedor.</span><span class="sxs-lookup"><span data-stu-id="2ff98-163">When VSS calls [**IVssHardwareSnapshotProvider::LocateLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-locateluns), the array of [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) structures generated in [**IVssHardwareSnapshotProvider::GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) will be passed to the provider.</span></span> <span data-ttu-id="2ff98-164">Durante o processamento desse método, o provedor deve tornar esses LUNs de cópia de sombra visíveis para o sistema.</span><span class="sxs-lookup"><span data-stu-id="2ff98-164">While processing this method, the provider should make those shadow copy LUNs visible to the system.</span></span> <span data-ttu-id="2ff98-165">O provedor não deve fazer um novo exame do barramento.</span><span class="sxs-lookup"><span data-stu-id="2ff98-165">The provider should not cause a bus rescan.</span></span> <span data-ttu-id="2ff98-166">O VSS disparará a nova verificação e a enumeração para permitir que os LUNs sejam descobertos pelo PNP e pelos volumes para ficarem online.</span><span class="sxs-lookup"><span data-stu-id="2ff98-166">VSS will trigger the rescan and enumeration to allow the LUNs to be discovered by PNP and the volumes to come online.</span></span>
3.  <span data-ttu-id="2ff98-167">O VSS chama [**IVssHardwareSnapshotProvider:: FillInLunInfo**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-fillinluninfo) para os discos recentemente recebidos no sistema.</span><span class="sxs-lookup"><span data-stu-id="2ff98-167">VSS calls [**IVssHardwareSnapshotProvider::FillInLunInfo**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-fillinluninfo) for the newly arrived disks in the system.</span></span> <span data-ttu-id="2ff98-168">O VSS usa a matriz de LUN de cópia de sombra das estruturas de [**\_ \_ informações de LUN VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) do **FillInLunInfo**, comparando-a com as **informações de \_ LUN \_ do VDS** geradas durante a criação do conjunto de cópias de sombra em [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) e as extensões de disco para cada volume na cópia de sombra definida para identificar os LUNs de cópia de sombra recentemente recebidos.</span><span class="sxs-lookup"><span data-stu-id="2ff98-168">VSS uses the shadow copy LUN array of [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) structures from **FillInLunInfo**, comparing it with the **VDS\_LUN\_INFORMATION** generated during shadow copy set creation in [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) and the disk extents for each volume in the shadow copy set to identify the newly arrived shadow copy LUNs.</span></span>
4.  <span data-ttu-id="2ff98-169">Neste ponto, todos os volumes contidos nos LUNs transportados são apenas ocultos e somente leitura, e o VSS tem um mapeamento do volume original para o volume da cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="2ff98-169">At this point, all volumes contained on the transported LUNs are mounted hidden and read-only and VSS has a mapping from the original volume to the shadow copy volume.</span></span>

<span data-ttu-id="2ff98-170">Para o caso de computador único e transportável, a sequência é semelhante a partir do ponto em que [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) é chamado.</span><span class="sxs-lookup"><span data-stu-id="2ff98-170">For both the single machine and transportable case, the sequence is similar starting with the point that [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) is called.</span></span> <span data-ttu-id="2ff98-171">Para a importação automática, as etapas acontecem diretamente após a criação.</span><span class="sxs-lookup"><span data-stu-id="2ff98-171">For auto-import, the steps happen directly after creation.</span></span>

 

 
