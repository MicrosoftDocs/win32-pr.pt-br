---
description: Uma cópia de sombra é um instantâneo de um volume que duplica todos os dados que são mantidos nesse volume, em um instante bem definido. O VSS identifica cada cópia de sombra por um GUID persistente.
ms.assetid: 8ef2478a-c8bc-4517-9a14-e1d9226ec4cd
title: Cópias de sombra e conjuntos de cópias de sombra
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 18709842b1fb0fbf6d6cce2557b51042dfb024ea
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105811383"
---
# <a name="shadow-copies-and-shadow-copy-sets"></a><span data-ttu-id="fd59c-104">Cópias de sombra e conjuntos de cópias de sombra</span><span class="sxs-lookup"><span data-stu-id="fd59c-104">Shadow Copies and Shadow Copy Sets</span></span>

<span data-ttu-id="fd59c-105">Uma [*cópia de sombra*](vssgloss-s.md) é um instantâneo de um volume que duplica todos os dados que são mantidos nesse volume, em um instante bem definido.</span><span class="sxs-lookup"><span data-stu-id="fd59c-105">A [*shadow copy*](vssgloss-s.md) is a snapshot of a volume that duplicates all of the data that is held on that volume at one well-defined instant in time.</span></span> <span data-ttu-id="fd59c-106">O VSS identifica cada cópia de sombra por um GUID persistente.</span><span class="sxs-lookup"><span data-stu-id="fd59c-106">VSS identifies each shadow copy by a persistent GUID.</span></span>

<span data-ttu-id="fd59c-107">Um [*conjunto de cópias de sombra*](vssgloss-s.md) é uma coleção de cópias de sombra de vários volumes obtidos ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="fd59c-107">A [*shadow copy set*](vssgloss-s.md) is a collection of shadow copies of various volumes all taken at the same time.</span></span> <span data-ttu-id="fd59c-108">O VSS identifica cada conjunto de cópias de sombra por um GUID persistente.</span><span class="sxs-lookup"><span data-stu-id="fd59c-108">VSS identifies each shadow copy set by a persistent GUID.</span></span>

<span data-ttu-id="fd59c-109">A forma como um fornecedor específico de hardware ou software opta por implementar cópias de sombra é completamente a seu critério.</span><span class="sxs-lookup"><span data-stu-id="fd59c-109">How a particular hardware or software vendor chooses to implement shadow copies is completely at its discretion.</span></span> <span data-ttu-id="fd59c-110">Depois que uma cópia de sombra é criada, há efetivamente duas imagens do volume copiado por sombra disponíveis para o sistema: o volume original, que pode ser acessado de forma convencional; e os dados copiados, que podem ser acessados por meio da API do VSS.</span><span class="sxs-lookup"><span data-stu-id="fd59c-110">Once a shadow copy is created, there are effectively two images of the shadow-copied volume available to the system: the original volume, which can be accessed conventionally; and the copied data, which can be accessed through the VSS API.</span></span>

<span data-ttu-id="fd59c-111">Isso permite que dois conjuntos de atividades ocorram ao mesmo tempo:</span><span class="sxs-lookup"><span data-stu-id="fd59c-111">This allows two sets of activities to take place at the same time:</span></span>

-   <span data-ttu-id="fd59c-112">Aplicativos comuns no sistema podem continuar ou retomar rapidamente usando o volume original, atualizando os dados no disco.</span><span class="sxs-lookup"><span data-stu-id="fd59c-112">Ordinary applications on the system can quickly continue or resume using the original volume, updating data on the disk.</span></span>
-   <span data-ttu-id="fd59c-113">Os aplicativos que estão usando a API do solicitante do VSS para acessar o volume copiado por sombra podem executar backups ou operações semelhantes.</span><span class="sxs-lookup"><span data-stu-id="fd59c-113">Applications that are using the VSS requester API to access the shadow-copied volume can perform backups or similar operations.</span></span>

<span data-ttu-id="fd59c-114">As cópias de sombra não precisam ser implementadas da mesma maneira para cada arquivo, diretório ou volume.</span><span class="sxs-lookup"><span data-stu-id="fd59c-114">Shadow copies need not be implemented in the same way for every file, directory, or volume.</span></span> <span data-ttu-id="fd59c-115">Implementações diferentes do mecanismo de cópia de sombra ([*provedores*](vssgloss-p.md)) podem usar abordagens diferentes para criar uma cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="fd59c-115">Different implementations of the shadow copy mechanism ([*providers*](vssgloss-p.md)) may use different approaches to creating a shadow copy.</span></span> <span data-ttu-id="fd59c-116">No entanto, para todos os aplicativos que estão usando a API do VSS, todas as cópias de sombra devem ser iguais.</span><span class="sxs-lookup"><span data-stu-id="fd59c-116">However, to all applications that are using the VSS API, all shadow copies should appear the same.</span></span>

<span data-ttu-id="fd59c-117">Para obter informações sobre a implementação padrão do provedor do Windows, consulte [provedor do sistema](providers.md).</span><span class="sxs-lookup"><span data-stu-id="fd59c-117">For information on the default Windows provider implementation, see [System Provider](providers.md).</span></span>

## <a name="default-shadow-copy-state"></a><span data-ttu-id="fd59c-118">Estado de cópia de sombra padrão</span><span class="sxs-lookup"><span data-stu-id="fd59c-118">Default Shadow Copy State</span></span>

<span data-ttu-id="fd59c-119">Embora o sistema de arquivos libere todos os buffers de e/s antes de criar uma cópia de sombra, isso não garantirá que a e/s incompleta seja manipulada corretamente.</span><span class="sxs-lookup"><span data-stu-id="fd59c-119">Even though the file system flushes all I/O buffers prior to creating a shadow copy, this will not ensure that incomplete I/O is properly handled.</span></span>

<span data-ttu-id="fd59c-120">Portanto, supondo que o sistema não tenha aplicativos habilitados para VSS, os dados em uma cópia de sombra são considerados em um [*estado consistente de falha*](vssgloss-c.md).</span><span class="sxs-lookup"><span data-stu-id="fd59c-120">Therefore, assuming that the system has no VSS-enabled applications, the data in a shadow copy is said to be in a [*crash-consistent state*](vssgloss-c.md).</span></span> <span data-ttu-id="fd59c-121">Uma cópia de sombra em um estado consistente com falhas contém uma imagem do disco que é a mesma que a que existe após um desligamento catastrófico do sistema.</span><span class="sxs-lookup"><span data-stu-id="fd59c-121">A shadow copy in a crash-consistent state contains an image of the disk that is the same as that which would exist following a catastrophic system shutdown.</span></span> <span data-ttu-id="fd59c-122">Todos os arquivos que estavam abertos ainda existirão no volume, mas não há garantia de que estejam livres de operações de e/s incompletas ou dados corrompidos.</span><span class="sxs-lookup"><span data-stu-id="fd59c-122">All files that were open will still exist on the volume, but they are not guaranteed to be free of incomplete I/O operations or data corruption.</span></span>

<span data-ttu-id="fd59c-123">Embora o estado de falha consistente não lide totalmente com todos os problemas associados à definição de um conjunto de backup estável (consulte [problemas comuns de backup de volume](common-volume-backup-issues.md)), ele tem várias vantagens em relação ao conjunto de backup que as operações de backup convencionais teriam para usar:</span><span class="sxs-lookup"><span data-stu-id="fd59c-123">While the crash-consistent state does not fully deal with all the issues associated with defining a stable backup set (see [Common Volume Backup Issues](common-volume-backup-issues.md)), it has several advantages over the backup set that conventional backup operations would have to use:</span></span>

-   <span data-ttu-id="fd59c-124">Um volume contido em uma cópia de sombra, mesmo em um estado consistente em caso de falhas, ainda contém todos os arquivos.</span><span class="sxs-lookup"><span data-stu-id="fd59c-124">A volume contained in a shadow copy, even in a crash-consistent state, still contains all files.</span></span> <span data-ttu-id="fd59c-125">Um conjunto de backup criado sem uma cópia de sombra não conteria todos os arquivos abertos no momento do backup.</span><span class="sxs-lookup"><span data-stu-id="fd59c-125">A backup set created without a shadow copy would not contain all files open at the time of the backup.</span></span> <span data-ttu-id="fd59c-126">Os arquivos mantidos abertos no momento da operação de backup são excluídos do backup.</span><span class="sxs-lookup"><span data-stu-id="fd59c-126">Files held open at the time of the backup operation are excluded from the backup.</span></span>
-   <span data-ttu-id="fd59c-127">A cópia de sombra do volume é criada em um instante no tempo e não atravessando um sistema de arquivos ativo, que normalmente requer muito mais tempo.</span><span class="sxs-lookup"><span data-stu-id="fd59c-127">The shadow copy of the volume is created at one instant in time, and not by traversing an active file system, which typically requires much more time.</span></span>

<span data-ttu-id="fd59c-128">Os aplicativos em um sistema que não reconhecem o VSS — processadores de texto, editores e assim por diante — provavelmente terão seus arquivos deixados em um estado consistente com falhas.</span><span class="sxs-lookup"><span data-stu-id="fd59c-128">Applications on a system that are not VSS-aware—word processors, editors, and so on—will likely have their files left in a crash-consistent state.</span></span> <span data-ttu-id="fd59c-129">No entanto, os aplicativos com reconhecimento de VSS (gravadores) podem coordenar suas ações para que o estado de seus arquivos na cópia de sombra seja bem definido e consistente.</span><span class="sxs-lookup"><span data-stu-id="fd59c-129">However, VSS-aware applications (writers) can coordinate their actions so that the state of their files in the shadow copy is well defined and consistent.</span></span>

## <a name="shadow-copy-freeze-and-thaw"></a><span data-ttu-id="fd59c-130">Congelar e descongelar cópias de sombra</span><span class="sxs-lookup"><span data-stu-id="fd59c-130">Shadow Copy Freeze and Thaw</span></span>

<span data-ttu-id="fd59c-131">A criação de cada operação de cópia de sombra do VSS tem como colchete [*congelar*](vssgloss-f.md) e [*descongelar*](vssgloss-t.md) eventos, que os gravadores usam para colocar seus arquivos em um estado estável antes da cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="fd59c-131">The creation of every VSS shadow copy operation is bracketed by [*Freeze*](vssgloss-f.md) and [*Thaw*](vssgloss-t.md) events, which writers use to put their files in a stable state prior to shadow copy.</span></span>

<span data-ttu-id="fd59c-132">Ter congelar e descongelar eventos como parte do modelo VSS significa:</span><span class="sxs-lookup"><span data-stu-id="fd59c-132">Having Freeze and Thaw events as part of the VSS model means:</span></span>

-   <span data-ttu-id="fd59c-133">Manipular o evento Freeze significa que aqueles que estão desenvolvendo gravadores devem ter um ponto claramente delimitado no ciclo de backup, no qual eles garantem que todas as operações de gravação no disco sejam interrompidas e que os arquivos estejam em um estado bem definido para backup.</span><span class="sxs-lookup"><span data-stu-id="fd59c-133">Handling the Freeze event means that those who are developing writers must have a clearly delineated point in the backup cycle where they ensure that all write operations to the disk are stopped and that files are in a well-defined state for backup.</span></span>
-   <span data-ttu-id="fd59c-134">Manipular o evento descongelar fornece o mecanismo para que os gravadores retomem gravações no disco e limpem quaisquer arquivos temporários ou outras informações de estado temporários que foram criadas em associação com a cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="fd59c-134">Handling the Thaw event provides the mechanism for writers to resume writes to the disk and clean up any temporary files or other temporary state information that were created in association with the shadow copy.</span></span>
-   <span data-ttu-id="fd59c-135">A janela padrão entre os eventos Freeze e descongelar é curta (geralmente 60 segundos); Portanto, a interrupção real de qualquer serviço que um gravador fornece pode ser minimizada.</span><span class="sxs-lookup"><span data-stu-id="fd59c-135">The default window between the Freeze and Thaw events is short (typically 60 seconds); therefore, actual interruption of any service that a writer provides can be minimized.</span></span>
-   <span data-ttu-id="fd59c-136">O tratamento de outros eventos (como PrepareForSnapshot) que antecedem e seguir os eventos Freeze e descongelar, respectivamente, fornece a flexibilidade necessária para permitir que os gravadores concluam operações complicadas para dar suporte a cópias de sombra.</span><span class="sxs-lookup"><span data-stu-id="fd59c-136">Handling of other events (such as PrepareForSnapshot) preceding and following the Freeze and Thaw events, respectively, provides the necessary flexibility to allow writers to complete complicated operations to support shadow copies.</span></span>

 

 



