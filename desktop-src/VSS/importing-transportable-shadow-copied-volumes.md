---
description: Às vezes, é desejável criar uma cópia de sombra em um sistema, mas usar a cópia de sombra em um segundo sistema.
ms.assetid: 4ec63917-03c0-434e-892e-3d9d4c47740e
title: Importando volumes copiados de sombra transportável
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3d259fbc047d088ee1f7064804a3ee98fe48da1b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104091436"
---
# <a name="importing-transportable-shadow-copied-volumes"></a><span data-ttu-id="86192-103">Importando volumes copiados de sombra transportável</span><span class="sxs-lookup"><span data-stu-id="86192-103">Importing Transportable Shadow Copied Volumes</span></span>

<span data-ttu-id="86192-104">Às vezes, é desejável criar uma cópia de sombra em um sistema, mas usar a cópia de sombra em um segundo sistema.</span><span class="sxs-lookup"><span data-stu-id="86192-104">It is sometimes desirable to create a shadow copy on one system, but use the shadow copy on a second system.</span></span>

<span data-ttu-id="86192-105">Considere o caso em que os dados de backup são normalmente gerenciados por um determinado sistema (*systemOne*) durante operações normais e que esses dados são armazenados fisicamente em uma matriz de armazenamento ou um dispositivo.</span><span class="sxs-lookup"><span data-stu-id="86192-105">Consider the case where data to be backed up is normally managed by a given system (*systemOne*) during normal operations, and that this data is physically stored on a storage array or an appliance.</span></span>

<span data-ttu-id="86192-106">Para minimizar qualquer interrupção em *systemOne* (como as operações de backup podem consumir muitos recursos), é desejável executar o backup usando o *systemTwo*, um servidor de backup, que tem acesso à mesma matriz de armazenamento que *systemOne*.</span><span class="sxs-lookup"><span data-stu-id="86192-106">To minimize any disruption to *systemOne* (because backup operations can be resource intensive), it is desirable to perform the backup using *systemTwo*, a backup server, which has access to the same storage array as *systemOne*.</span></span>

<span data-ttu-id="86192-107">Para garantir uma cópia de sombra adequada — cooperar com os gravadores no *systemOne* e preservar o estado adequadamente para tarefas em andamento — a cópia de sombra deve ser executada pelo *systemOne*.</span><span class="sxs-lookup"><span data-stu-id="86192-107">To ensure a proper shadow copy—cooperating with the writers on *systemOne* and preserving the state appropriately for ongoing tasks—the shadow copy should be performed by *systemOne*.</span></span>

<span data-ttu-id="86192-108">Portanto, *systemOne* deve criar uma [*cópia de sombra transportável*](vssgloss-t.md), que *systemTwo* será importada.</span><span class="sxs-lookup"><span data-stu-id="86192-108">Therefore, *systemOne* must create a [*transportable shadow copy*](vssgloss-t.md), which *systemTwo* will then import.</span></span>

<span data-ttu-id="86192-109">**Windows server 2003, Standard Edition, Windows server 2003, Web Edition e Windows XP:** Não há suporte para conjuntos de cópia de sombra transportáveis.</span><span class="sxs-lookup"><span data-stu-id="86192-109">**Windows Server 2003, Standard Edition, Windows Server 2003, Web Edition and Windows XP:** Transportable shadow copy sets are not supported.</span></span> <span data-ttu-id="86192-110">Todas as edições do Windows Server 2003 com Service Pack 1 (SP1) oferecem suporte a conjuntos de cópia de sombra transportáveis.</span><span class="sxs-lookup"><span data-stu-id="86192-110">All editions of Windows Server 2003 with Service Pack 1 (SP1) support transportable shadow copy sets.</span></span>

<span data-ttu-id="86192-111">Um exemplo típico de importação de uma cópia de sombra transportável pode proceder da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="86192-111">A typical example of importing a transportable shadow copy can proceed in the following way:</span></span>

1.  <span data-ttu-id="86192-112">Inicialmente, a LUN (unidade lógica) fornecida pela matriz de armazenamento é montada como um volume em *systemOne* (digamos, F:).</span><span class="sxs-lookup"><span data-stu-id="86192-112">Initially, the logical unit (LUN) that is provided by the storage array is mounted as a volume on *systemOne* (say, F:).</span></span>
2.  <span data-ttu-id="86192-113">Um solicitante em execução em *systemOne* instancia uma instância de [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) e prossegue como se estivesse se preparando para um backup.</span><span class="sxs-lookup"><span data-stu-id="86192-113">A requester that is running on *systemOne* instantiates an instance of [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) and proceeds as if it were preparing for a backup.</span></span> <span data-ttu-id="86192-114">(Consulte [visão geral da inicialização de backup](overview-of-backup-initialization.md), [visão geral da fase de descoberta de backup](overview-of-the-backup-discovery-phase.md)e [visão geral de tarefas de pré-backup](overview-of-pre-backup-tasks.md) para obter mais informações.)</span><span class="sxs-lookup"><span data-stu-id="86192-114">(See [Overview of Backup Initialization](overview-of-backup-initialization.md), [Overview of the Backup Discovery Phase](overview-of-the-backup-discovery-phase.md), and [Overview of Pre-Backup Tasks](overview-of-pre-backup-tasks.md) for more information.)</span></span>
3.  <span data-ttu-id="86192-115">O solicitante em *systemOne* modifica o contexto de cópia de sombra que normalmente é usado para a operação de backup local (**\_ backup de \_ aplicativo \_ do VSS CTX**) para indicar que uma cópia de sombra transportável será criada (**VSS \_ VOLSNAP \_ attr \_ transportável**).</span><span class="sxs-lookup"><span data-stu-id="86192-115">The requester on *systemOne* modifies the shadow copy context that is typically used for local backup operation (**VSS\_CTX\_APP\_BACKUP**) to indicate that a transportable shadow copy will be created (**VSS\_VOLSNAP\_ATTR\_TRANSPORTABLE**).</span></span> <span data-ttu-id="86192-116">O atributo transportável também pode ser adicionado a outros contextos de cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="86192-116">The transportable attribute can be added to other shadow copy contexts as well.</span></span>
4.  <span data-ttu-id="86192-117">Com um contexto de cópia de sombra do VSS CTX o VSS de **\_ \_ \_ backup de aplicativo do VSS** de não \| **\_ \_ \_ Transportable**, o solicitante que está no *systemOne* cria uma cópia de sombra chamando [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span><span class="sxs-lookup"><span data-stu-id="86192-117">With a shadow copy context of **VSS\_CTX\_APP\_BACKUP** \| **VSS\_VOLSNAP\_ATTR\_TRANSPORTABLE**, the requester that is on *systemOne* creates a shadow copy by calling [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span></span>
5.  <span data-ttu-id="86192-118">*SystemOne* usa [**IVssBackupComponents:: SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml) para salvar o estado atual do documento de componentes de backup e [**IVssExamineWriterMetadata:: SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-saveasxml) para salvar os documentos de metadados do gravador de cada gravador.</span><span class="sxs-lookup"><span data-stu-id="86192-118">*SystemOne* uses [**IVssBackupComponents::SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml) to save the current state of the Backup Components Document and [**IVssExamineWriterMetadata::SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-saveasxml) to save each writer's Writer Metadata Documents.</span></span> <span data-ttu-id="86192-119">As cadeias de caracteres XML que contêm esses documentos são disponibilizadas para um solicitante em execução no *systemTwo*.</span><span class="sxs-lookup"><span data-stu-id="86192-119">The XML strings that contain these documents are then made available to a requester that is running on *systemTwo*.</span></span>

    <span data-ttu-id="86192-120">O solicitante transfere o documento de componentes de backup para *systemTwo*.</span><span class="sxs-lookup"><span data-stu-id="86192-120">The requester transfers the Backup Components Document to *systemTwo*.</span></span>

    <span data-ttu-id="86192-121">Observe que o solicitante em *systemOne* não libera sua instância de [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) neste ponto se a finalidade da cópia de sombra for backup.</span><span class="sxs-lookup"><span data-stu-id="86192-121">Note that the requester on *systemOne* does not release its instance of [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) at this point if the purpose of the shadow copy is for backup.</span></span> <span data-ttu-id="86192-122">A interface deve permanecer aberta até que o *systemTwo* conclua com êxito suas operações de backup.</span><span class="sxs-lookup"><span data-stu-id="86192-122">The interface should remain open until *systemTwo* successfully finishes its backup operations.</span></span> <span data-ttu-id="86192-123">Somente o solicitante deve emitir um evento [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) , uma vez que alguns gravadores truncarão logs e farão outro trabalho após um backup bem-sucedido.</span><span class="sxs-lookup"><span data-stu-id="86192-123">Only then should the requester issue a [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) event since some writers will truncate logs and do other work after a successful backup.</span></span> <span data-ttu-id="86192-124">Se a meta da cópia de sombra for Data Mining ou outras finalidades, a interface poderá ser fechada nesta etapa.</span><span class="sxs-lookup"><span data-stu-id="86192-124">If the goal of the shadow copy is data mining or other purposes, then the interface can be closed at this step.</span></span>

6.  <span data-ttu-id="86192-125">O solicitante em *systemTwo* então chama [**IVssBackupComponents:: ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) para obter acesso à cópia de sombra que foi criada pelo solicitante no *systemOne*.</span><span class="sxs-lookup"><span data-stu-id="86192-125">The requester on *systemTwo* then calls [**IVssBackupComponents::ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) to get access to the shadow copy that was created by the requester on *systemOne*.</span></span>
    > [!Note]  
    > <span data-ttu-id="86192-126">O solicitante é responsável por serializar a operação de cópia de sombra de importação.</span><span class="sxs-lookup"><span data-stu-id="86192-126">The requester is responsible for serializing the import shadow copy operation.</span></span> <span data-ttu-id="86192-127">Além disso, se a chamada para [**IVssBackupComponents:: ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) falhar, o VSS não limpará os LUNs sozinhos.</span><span class="sxs-lookup"><span data-stu-id="86192-127">Also, if the call to [**IVssBackupComponents::ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) fails, the VSS won't clean up LUNs on it's own.</span></span> <span data-ttu-id="86192-128">O solicitante precisa iniciar a limpeza de LUNs.</span><span class="sxs-lookup"><span data-stu-id="86192-128">The requester has to initiate the cleanup of LUNs.</span></span>

     

7.  <span data-ttu-id="86192-129">O solicitante em *systemTwo* prossegue com o backup do material copiado de sombra exatamente como se estivesse fazendo backup de uma cópia de sombra criada por si só (consulte [visão geral do backup real de arquivos](overview-of-actual-backup-of-files.md)).</span><span class="sxs-lookup"><span data-stu-id="86192-129">The requester on *systemTwo* proceeds with the backup of the shadow copied material exactly as if it were backing up a shadow copy that it created by itself (see [Overview of Actual Backup Of Files](overview-of-actual-backup-of-files.md)).</span></span>

    <span data-ttu-id="86192-130">O solicitante em *systemTwo* Obtém o [*objeto de dispositivo*](vssgloss-d.md) da cópia de sombra usando [**IVssBackupComponents:: getsnapshotproperties**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getsnapshotproperties) na cópia de sombra importada e acrescenta isso ao início dos caminhos de arquivo originais que foram obtidos dos metadados para acessar os arquivos cujo backup será feito.</span><span class="sxs-lookup"><span data-stu-id="86192-130">The requester on *systemTwo* obtains the shadow copy's [*device object*](vssgloss-d.md) using [**IVssBackupComponents::GetSnapshotProperties**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getsnapshotproperties) on the imported shadow copy and appends that to the beginning of the original file paths that were obtained from the metadata to access files to be backed up.</span></span>

8.  <span data-ttu-id="86192-131">Depois de usar a cópia de sombra, o solicitante em *systemTwo* deve excluir a cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="86192-131">After using the shadow copy, the requester on *systemTwo* must delete the shadow copy.</span></span> <span data-ttu-id="86192-132">Assim como ocorre com cópias de sombra não transportáveis, se o contexto de cópia de sombra indicar cópias de sombra de liberação automática (por exemplo, **\_ \_ backup CTX VSS**), a liberação do [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) no *systemTwo* fará com que o serviço VSS exclua a cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="86192-132">As with non-transportable shadow copies, if the shadow copy context indicates auto-release shadow copies (for example, **VSS\_CTX\_BACKUP**), then releasing the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) on *systemTwo* will cause the VSS service to delete the shadow copy.</span></span> <span data-ttu-id="86192-133">Caso contrário, se o contexto indicar uma cópia de sombra persistente (por exemplo, a **\_ \_ \_ reversão do aplicativo VSS CTX**), o solicitante em *systemTwo* deverá excluir explicitamente a cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="86192-133">Otherwise, if the context indicates a persistent shadow copy (for example, **VSS\_CTX\_APP\_ROLLBACK**), then the requester on *systemTwo* must explicitly delete the shadow copy.</span></span>

    <span data-ttu-id="86192-134">Em seguida, o solicitante em *systemTwo* sinaliza o solicitante no *systemOne* que ele concluiu com o backup da cópia de sombra transportável.</span><span class="sxs-lookup"><span data-stu-id="86192-134">Then the requester on *systemTwo* signals the requester on *systemOne* that it has finished with the backup of the transportable shadow copy.</span></span>

9.  <span data-ttu-id="86192-135">Depois que o solicitante no *systemOne* recebeu uma notificação de que o solicitante no *systemTwo* concluiu o backup da cópia de sombra transportável, ele notifica os gravadores em seu sistema gerando um evento [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) com uma chamada para **IVssBackupComponents:: BackupComplete**.</span><span class="sxs-lookup"><span data-stu-id="86192-135">After the requester on *systemOne* has received notification that the requester on *systemTwo* has finished the backup of the transportable shadow copy, it notifies the writers on its system by generating a [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) event with a call to **IVssBackupComponents::BackupComplete**.</span></span> <span data-ttu-id="86192-136">Neste ponto, o solicitante no *systemOne* é gratuito para liberar sua instância do [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents).</span><span class="sxs-lookup"><span data-stu-id="86192-136">At this point, the requester on *systemOne* is free to release its instance of [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents).</span></span>

<span data-ttu-id="86192-137">**Cópias de sombra transportáveis em um cluster:** As cópias de sombra transportáveis devem ser importadas de fora do cluster, contanto que o volume original seja montado no cluster.</span><span class="sxs-lookup"><span data-stu-id="86192-137">**Transportable shadow copies in a cluster:** Transportable shadow copies must be imported from outside the cluster as long as the original volume is mounted within the cluster.</span></span> <span data-ttu-id="86192-138">Para obter informações sobre como implementar uma recuperação rápida em um cluster, consulte [recuperação rápida usando volumes copiados de sombra transportável](fast-recovery-using-transportable-shadow-copied-volumes.md).</span><span class="sxs-lookup"><span data-stu-id="86192-138">For information about implementing a fast recovery in a cluster, see [Fast Recovery Using Transportable Shadow Copied Volumes](fast-recovery-using-transportable-shadow-copied-volumes.md).</span></span>

 

 



