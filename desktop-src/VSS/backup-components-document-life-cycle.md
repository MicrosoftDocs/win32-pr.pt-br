---
description: Os solicitantes têm responsabilidade principal pelo ciclo de vida de um documento de componentes de backup.
ms.assetid: 287b7b9a-ac04-4a74-83c1-2cdd4a571ac1
title: Ciclo de vida do documento de componentes de backup
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a4bcb0263f46466d7be2bc19f3c8809167b2da08
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "105760953"
---
# <a name="backup-components-document-life-cycle"></a><span data-ttu-id="09cbc-103">Ciclo de vida do documento de componentes de backup</span><span class="sxs-lookup"><span data-stu-id="09cbc-103">Backup Components Document Life Cycle</span></span>

<span data-ttu-id="09cbc-104">Os solicitantes têm responsabilidade principal pelo ciclo de vida de um documento de componentes de backup.</span><span class="sxs-lookup"><span data-stu-id="09cbc-104">Requesters have primary responsibility for the life cycle of a Backup Components Document.</span></span>

<span data-ttu-id="09cbc-105">Esse controle é exercido por uma instância do objeto de interface [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) retornado por [**CreateVssBackupComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents).</span><span class="sxs-lookup"><span data-stu-id="09cbc-105">This control is exercised by an instance of the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface object returned by [**CreateVssBackupComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents).</span></span>

<span data-ttu-id="09cbc-106">Um solicitante deve inicializar um documento de componentes de backup antes de um backup ou restauração chamando [**IVssBackupComponents:: InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) ou [**IVssBackupComponents:: InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore).</span><span class="sxs-lookup"><span data-stu-id="09cbc-106">A requester must initialize a Backup Components Document prior to a backup or restore by calling [**IVssBackupComponents::InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) or [**IVssBackupComponents::InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore).</span></span> <span data-ttu-id="09cbc-107">O solicitante pode inicializar o documento como vazio, ou pode carregar uma cópia armazenada anteriormente do documento.</span><span class="sxs-lookup"><span data-stu-id="09cbc-107">The requester can initialize the document as empty, or it can load a previously stored copy of the document.</span></span>

<span data-ttu-id="09cbc-108">Para operações de backup, um documento de componentes de backup normalmente é inicializado como vazio.</span><span class="sxs-lookup"><span data-stu-id="09cbc-108">For backup operations, a Backup Components Document is typically initialized as empty.</span></span> <span data-ttu-id="09cbc-109">Seus dados serão preenchidos com a cooperação dos gravadores do sistema no decorrer do processamento do backup.</span><span class="sxs-lookup"><span data-stu-id="09cbc-109">Its data will be filled in with cooperation from the system's writers in the course of processing the backup.</span></span>

<span data-ttu-id="09cbc-110">Para operações de restauração, um documento de componentes de backup normalmente é inicializado a partir de um documento armazenado gerado durante o backup inicial.</span><span class="sxs-lookup"><span data-stu-id="09cbc-110">For restore operations, a Backup Components Document is typically initialized from a stored document generated during the initial backup.</span></span> <span data-ttu-id="09cbc-111">Isso permite que a restauração (em conjunto com o exame de documentos de metadados do gravador armazenados) determine quais dados foram inicialmente copiados em backup e como eles devem ser restaurados.</span><span class="sxs-lookup"><span data-stu-id="09cbc-111">This allows the restore (in conjunction with examination of stored Writer Metadata Documents) to determine what data was initially backed up and how it should be restored.</span></span>

<span data-ttu-id="09cbc-112">O backup de [*cópias de sombra transportáveis*](vssgloss-t.md) é uma exceção a essa regra.</span><span class="sxs-lookup"><span data-stu-id="09cbc-112">Backing up [*transportable shadow copies*](vssgloss-t.md) is an exception to this rule.</span></span> <span data-ttu-id="09cbc-113">Nesse caso, uma cópia de sombra poderia ter sido movida de um sistema (onde foi criada junto com o documento de componentes de backup inicial) para outro por meio da reatribuição de uma unidade lógica do dispositivo de armazenamento compartilhado.</span><span class="sxs-lookup"><span data-stu-id="09cbc-113">In this case, a shadow copy could have been moved from one system (where it was created along with the initial Backup Components Document) to another by means of reassigning a shared storage device's logical unit.</span></span> <span data-ttu-id="09cbc-114">Para fazer backup dessas circunstâncias, um solicitante carrega o estado de backup armazenado e prossegue de onde o sistema inicial parou.</span><span class="sxs-lookup"><span data-stu-id="09cbc-114">To back up under these circumstances, a requester loads the stored backup state and proceeds from where the initial system left off.</span></span> <span data-ttu-id="09cbc-115">(Para obter mais informações, consulte [importando volumes copiados de sombra transportável](importing-transportable-shadow-copied-volumes.md).)</span><span class="sxs-lookup"><span data-stu-id="09cbc-115">(For more information, see [Importing Transportable Shadow Copied Volumes](importing-transportable-shadow-copied-volumes.md).)</span></span>

<span data-ttu-id="09cbc-116">No decorrer do processamento de um backup, o solicitante decide quais componentes são realmente copiados com base em quais componentes são marcados como [*selecionáveis para backup*](vssgloss-s.md), os [*caminhos lógicos*](vssgloss-l.md)do componente e sua própria lógica interna.</span><span class="sxs-lookup"><span data-stu-id="09cbc-116">In the course of processing a backup, the requester decides which components to actually copy on the basis of which components are marked as [*selectable for backup*](vssgloss-s.md), the component's [*logical paths*](vssgloss-l.md), and its own internal logic.</span></span>

<span data-ttu-id="09cbc-117">Alguns dos componentes serão [*incluídos explicitamente*](vssgloss-e.md) na operação de backup; as informações sobre o componente serão adicionadas ao documento componentes de backup.</span><span class="sxs-lookup"><span data-stu-id="09cbc-117">Some of the components will be [*explicitly included*](vssgloss-e.md) in the backup operation; information about the component will be added to the Backup Components Document.</span></span> <span data-ttu-id="09cbc-118">Outras serão [*incluídas implicitamente*](vssgloss-i.md) no backup; as informações sobre os componentes adicionados não serão adicionadas ao documento de componentes de backup.</span><span class="sxs-lookup"><span data-stu-id="09cbc-118">Others will be [*implicitly included*](vssgloss-i.md) in the backup; information about the added components will not be added to the Backup Components Document.</span></span>

<span data-ttu-id="09cbc-119">Todos os não selecionáveis do gravador para componentes de backup sem um ancestral selecionável em seu caminho lógico e aqueles selecionáveis para componentes de backup que o solicitante escolhe, serão adicionados explicitamente.</span><span class="sxs-lookup"><span data-stu-id="09cbc-119">All of a writer's nonselectable for backup components without a selectable ancestor in their logical path, and those selectable for backup components the requester chooses, will be added explicitly.</span></span>

<span data-ttu-id="09cbc-120">Não selecionável e selecionável para componentes de backup podem ser adicionados implicitamente se tiverem um ancestral selecionável em seu caminho lógico, que é explicitamente incluído no backup.</span><span class="sxs-lookup"><span data-stu-id="09cbc-120">Both nonselectable and selectable for backup components can be added implicitly if they have a selectable ancestor in their logical path, which is explicitly included in the backup.</span></span> <span data-ttu-id="09cbc-121">Esses componentes ([*Subcomponentes*](vssgloss-s.md)) são membros de [*conjuntos de componentes*](vssgloss-s.md) definidos pelo ancestral selecionável.</span><span class="sxs-lookup"><span data-stu-id="09cbc-121">These components ([*subcomponents*](vssgloss-s.md)) are members of [*component sets*](vssgloss-s.md) defined by their selectable ancestor.</span></span>

<span data-ttu-id="09cbc-122">Ao lidar com operações de restauração, o solicitante usa a [*seleção para restauração*](vssgloss-s.md) em vez de seleção para backup em conjunto com informações de caminho lógico e sua própria lógica interna para decidir quais arquivos restaurar.</span><span class="sxs-lookup"><span data-stu-id="09cbc-122">When handling restore operations, the requester uses [*selectability for restore*](vssgloss-s.md) instead of selectability for backup in conjunction with logical path information and its own internal logic to decide which files to restore.</span></span>

<span data-ttu-id="09cbc-123">Se um componente que foi implicitamente adicionado ao backup agora for explicitamente adicionado à restauração, o solicitante atualizará o documento de componentes de backup com as informações desse componente.</span><span class="sxs-lookup"><span data-stu-id="09cbc-123">If a component that had been implicitly added to the backup is now to be explicitly added to the restore, the requester will update the Backup Components Document with that component's information.</span></span>

<span data-ttu-id="09cbc-124">As informações sobre os componentes armazenados estão disponíveis para solicitantes e gravadores por meio de instâncias da interface [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) .</span><span class="sxs-lookup"><span data-stu-id="09cbc-124">Information about the stored components is available both to requesters and writers through instances of the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface.</span></span>

<span data-ttu-id="09cbc-125">É por meio de interfaces [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) que os gravadores podem consultar e (até o fim dos eventos de [**reinstantâneo**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) e de [**restauração**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore) ) modificam as informações no documento de componentes de backup.</span><span class="sxs-lookup"><span data-stu-id="09cbc-125">It is through [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interfaces that writers can query and (until the end of [**PostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) and [**PostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore) events) modify information in the Backup Components Document.</span></span>

<span data-ttu-id="09cbc-126">Quando o manipulador de eventos [**CVssWriter:: OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup), [**CVssWriter:: OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore), [**CVssWriter:: OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot), [**CVssWriter:: OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete)ou [**CVssWriter:: OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore) é chamado, um gravador recebe uma instância de uma interface [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) .</span><span class="sxs-lookup"><span data-stu-id="09cbc-126">When the [**CVssWriter::OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup), [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore), [**CVssWriter::OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot), [**CVssWriter::OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete), or [**CVssWriter::OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore) event handler is called, a writer receives an instance of an [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) interface.</span></span>

<span data-ttu-id="09cbc-127">Observe que, após a geração do evento [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) , o documento de componentes de backup é tornado somente leitura e, portanto, [**CVssWriter:: OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) não pode usar a interface [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) para modificá-lo.</span><span class="sxs-lookup"><span data-stu-id="09cbc-127">Note that upon generation of the [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) event, the Backup Components Document is made read-only, and therefore [**CVssWriter::OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) cannot use the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface to modify it.</span></span>

<span data-ttu-id="09cbc-128">Na interface [**IVSSWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) , o gravador pode recuperar instâncias da interface [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) que permitirão que ela acesse todos os seus componentes explicitamente adicionados ao documento de componentes de backup e altere seu estado.</span><span class="sxs-lookup"><span data-stu-id="09cbc-128">From the [**IVSSWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) interface, the writer can retrieve instances of the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface that will allow it to access all of its components explicitly added to the Backup Components Document and to alter their state.</span></span> <span data-ttu-id="09cbc-129">Para obter mais informações, consulte [visão geral do processamento de um backup em VSS](overview-of-processing-a-backup-under-vss.md) e [visão geral do processamento de uma restauração no VSS](overview-of-processing-a-restore-under-vss.md).</span><span class="sxs-lookup"><span data-stu-id="09cbc-129">For more information, see [Overview of Processing a Backup Under VSS](overview-of-processing-a-backup-under-vss.md) and [Overview of Processing a Restore Under VSS](overview-of-processing-a-restore-under-vss.md).</span></span>

<span data-ttu-id="09cbc-130">Os documentos de componentes de backup são removidos da memória quando a interface [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) é liberada e devem ser armazenados usando [**IVssBackupComponents:: SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml)ou todas as suas informações serão perdidas.</span><span class="sxs-lookup"><span data-stu-id="09cbc-130">Backup Components Documents are removed from memory when the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface is released, and must be stored using [**IVssBackupComponents::SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml), or all their information will be lost.</span></span>

<span data-ttu-id="09cbc-131">Além disso, quando um documento [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) é liberado corretamente, um evento [**BackupShutdown**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupshutdown) é gerado e as [*cópias de sombra de lançamento automático*](vssgloss-a.md) são excluídas.</span><span class="sxs-lookup"><span data-stu-id="09cbc-131">In addition, when an [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) document is properly released, a [**BackupShutdown**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupshutdown) event is generated and [*auto-release shadow copies*](vssgloss-a.md) are deleted.</span></span>

 

 



