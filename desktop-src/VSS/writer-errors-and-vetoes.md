---
description: Um gravador pode falhar por vários motivos programáticos.
ms.assetid: 50eced73-3917-4d7e-96cc-2d793b448738
title: Erros e Vetações do gravador
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7c24c15ad10766fc6ec395ed058ab3cb72a689d9
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104164491"
---
# <a name="writer-errors-and-vetoes"></a><span data-ttu-id="33685-103">Erros e Vetações do gravador</span><span class="sxs-lookup"><span data-stu-id="33685-103">Writer Errors and Vetoes</span></span>

<span data-ttu-id="33685-104">Um gravador pode falhar por vários motivos programáticos.</span><span class="sxs-lookup"><span data-stu-id="33685-104">A writer can fail for numerous programmatic reasons.</span></span> <span data-ttu-id="33685-105">Quando isso acontece, ele deve vetar a operação de backup, restauração ou cópia de sombra em andamento chamando o método [**CVssWriter:: SetWriterFailure**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-setwriterfailure) em um dos seus métodos de manipuladores (por exemplo, [**CVssWriter:: OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) ou [**CVssWriter:: OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore)) e retornando **true**.</span><span class="sxs-lookup"><span data-stu-id="33685-105">When this happens, it should veto the ongoing backup, restore, or shadow copy operation by calling the [**CVssWriter::SetWriterFailure**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-setwriterfailure) method in one of its handler methods (for example, [**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) or [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore)) and returning **TRUE**.</span></span> <span data-ttu-id="33685-106">Opcionalmente, ele também pode definir uma cadeia de caracteres de mensagem de erro em resposta a uma condição de falha em determinados métodos de manipulador com os métodos [**IVssComponentEx:: SetPrepareForBackupFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-setprepareforbackupfailuremsg), [**IVssComponentEx:: SetPostSnapshotFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-setpostsnapshotfailuremsg), [**IVssComponent:: SetPreRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setprerestorefailuremsg)e [**IVssComponent:: SetPostRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setpostrestorefailuremsg) .</span><span class="sxs-lookup"><span data-stu-id="33685-106">It can also optionally set an error message string in response to a failure condition in certain handler methods with the [**IVssComponentEx::SetPrepareForBackupFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-setprepareforbackupfailuremsg), [**IVssComponentEx::SetPostSnapshotFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-setpostsnapshotfailuremsg), [**IVssComponent::SetPreRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setprerestorefailuremsg), and [**IVssComponent::SetPostRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setpostrestorefailuremsg) methods.</span></span> <span data-ttu-id="33685-107">O solicitante pode aceitar a veto ou continuar com o backup, ignorando a veto.</span><span class="sxs-lookup"><span data-stu-id="33685-107">The requester can accept the veto or continue with the backup, ignoring the veto.</span></span>

<span data-ttu-id="33685-108">Um solicitante deve verificar o status do gravador (usando [**IVssBackupComponents:: GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) e [**IVssBackupComponents:: GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)) seguindo cada evento gerado por ele.</span><span class="sxs-lookup"><span data-stu-id="33685-108">A requester should check the writer status (using [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) and [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)) following each event it generates.</span></span>

<span data-ttu-id="33685-109">Em alguns casos, as mensagens de erro podem ser recuperadas dessas falhas (usando os métodos [**IVssComponentEx:: GetPrepareForBackupFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getprepareforbackupfailuremsg), [**IVssComponent:: GetPreRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getprerestorefailuremsg), [**IVssComponentEx:: GetPostSnapshotFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getpostsnapshotfailuremsg)e [**IVssComponent:: GetPostRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpostrestorefailuremsg) ) ou um gravador pode optar por definir os metadados (usando [**IVssComponent:: SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata) e [**IVssComponent:: SetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupmetadata) com informações de estado de erro).</span><span class="sxs-lookup"><span data-stu-id="33685-109">In some cases, error messages can be retrieved from these failures (using the [**IVssComponentEx::GetPrepareForBackupFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getprepareforbackupfailuremsg), [**IVssComponent::GetPreRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getprerestorefailuremsg), [**IVssComponentEx::GetPostSnapshotFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getpostsnapshotfailuremsg), and [**IVssComponent::GetPostRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpostrestorefailuremsg) methods), or a writer may choose to set metadata (using [**IVssComponent::SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata) and [**IVssComponent::SetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupmetadata) with error state information).</span></span> <span data-ttu-id="33685-110">Por exemplo, código que mostra como exibir essas mensagens de erro, consulte [**IVssComponentEx:: GetPrepareForBackupFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getprepareforbackupfailuremsg).</span><span class="sxs-lookup"><span data-stu-id="33685-110">For example code that shows how to view such error messages, see [**IVssComponentEx::GetPrepareForBackupFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getprepareforbackupfailuremsg).</span></span>

<span data-ttu-id="33685-111">Dependendo do estado do erro, um solicitante ou seu operador pode reiniciar o backup e a cópia de sombra com qualquer modificação necessária no estado do trabalho ou do sistema de backup.</span><span class="sxs-lookup"><span data-stu-id="33685-111">Depending on the error state, a requester or its operator could restart the backup and shadow copy with any necessary modification to the state of the backup job or system.</span></span>

<span data-ttu-id="33685-112">Por exemplo, suponha que [**GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) retornou o seguinte:</span><span class="sxs-lookup"><span data-stu-id="33685-112">For example, suppose [**GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) returned the following:</span></span>

-   <span data-ttu-id="33685-113">**VSS \_ E \_ WRITERERROR \_ INCONSISTENTSNAPSHOT** sugere que um solicitante pode adicionar volumes adicionais à cópia de sombra</span><span class="sxs-lookup"><span data-stu-id="33685-113">**VSS\_E\_WRITERERROR\_INCONSISTENTSNAPSHOT** suggests that a requester might add additional volumes to the shadow copy</span></span>
-   <span data-ttu-id="33685-114">**VSS \_ E \_ WRITERERROR com \_ nova tentativa** indica que tentar novamente sem reconfiguração pode funcionar.</span><span class="sxs-lookup"><span data-stu-id="33685-114">**VSS\_E\_WRITERERROR\_RETRYABLE** indicates that retrying without reconfiguration might work.</span></span> <span data-ttu-id="33685-115">Se o gravador continuar a retornar o erro após várias tentativas, tente reiniciar o serviço que hospeda o gravador.</span><span class="sxs-lookup"><span data-stu-id="33685-115">If the writer continues to return the error after several retries, try restarting the service that hosts the writer.</span></span> <span data-ttu-id="33685-116">Os seguintes gravadores estão hospedados no serviço VSS: gravador de registro, gravador de banco de dados de registro de classe COM+, gravador de otimização de cópia de sombra e gravador ASR (recuperação automatizada do sistema).</span><span class="sxs-lookup"><span data-stu-id="33685-116">The following writers are hosted in the VSS service: registry writer, COM+ class registration database writer, shadow copy optimization writer, and Automated System Recovery (ASR) writer.</span></span> <span data-ttu-id="33685-117">Se o gravador pertencer a um aplicativo que hospeda o gravador em seu próprio processo, tente reiniciar o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="33685-117">If the writer belongs to an application that hosts the writer in its own process, try restarting the application.</span></span>

    <span data-ttu-id="33685-118">**Windows Server 2003 e Windows XP:** Os seguintes gravadores estão hospedados no serviço VSS: gravador de registro, gravador de banco de dados de registro de classe COM+, gravador de log de eventos de aplicativo e Microsoft SQL Server gravador do mecanismo de área de trabalho 2000 (MSDE).</span><span class="sxs-lookup"><span data-stu-id="33685-118">**Windows Server 2003 and Windows XP:** The following writers are hosted in the VSS service: registry writer, COM+ class registration database writer, application event log writer, and Microsoft SQL Server 2000 Desktop Engine (MSDE) writer.</span></span>

-   <span data-ttu-id="33685-119">\_ \_ O status do VSS e do gravador \_ \_ não \_ disponível indica que um gravador pode ter atingido o número máximo de sessões de backup e restauração disponíveis e tentar novamente pode funcionar quando o sistema está menos ocupado.</span><span class="sxs-lookup"><span data-stu-id="33685-119">VSS\_E\_WRITER\_STATUS\_NOT\_AVAILABLE indicates that a writer may have reached the maximum number of available backup and restore sessions, and retrying might work when the system is less busy.</span></span>
-   <span data-ttu-id="33685-120">**VSS \_ E \_ WRITERERROR \_ OUTOFRESOURCES** ou **VSS \_ e \_ WRITERERROR \_ Timeout** podem sugerir que a carga do sistema seja reduzida antes de tentar novamente</span><span class="sxs-lookup"><span data-stu-id="33685-120">**VSS\_E\_WRITERERROR\_OUTOFRESOURCES** or **VSS\_E\_WRITERERROR\_TIMEOUT** might suggest that system load be reduced prior to retrying</span></span>
-   <span data-ttu-id="33685-121">**VSS \_ E \_ WRITERERROR sem \_ nova tentativa** ou **o \_ gravador E o VSS \_ \_ não \_ responderiam** provavelmente indicando um erro do gravador tão grave quanto para impedir a tentativa de fazer backup de seus dados com o VSS.</span><span class="sxs-lookup"><span data-stu-id="33685-121">**VSS\_E\_WRITERERROR\_NONRETRYABLE** or **VSS\_E\_WRITER\_NOT\_RESPONDING** would likely indicate a writer error so severe as to preclude trying to back up its data with VSS.</span></span>

<span data-ttu-id="33685-122">Dependendo de qual gravador e quais componentes os geram, nem sempre é necessário que um aplicativo de backup anule após um veto ou erro.</span><span class="sxs-lookup"><span data-stu-id="33685-122">Depending on which writer and which components generate them, it is not always necessary for a backup application to abort following a veto or error.</span></span>

<span data-ttu-id="33685-123">Por exemplo, um solicitante pode decidir que a intenção da cópia de sombra é fazer backup do aplicativo A e a veto foi recebida do gravador para o aplicativo de backup B. Nesse caso, é perfeitamente aceitável continuar a fazer backup do aplicativo a enquanto ignora a veto.</span><span class="sxs-lookup"><span data-stu-id="33685-123">For example, a requester may decide that the intent of the shadow copy is to back up application A and the veto has been received from the writer for backup application B. In this case, it is perfectly acceptable to continue to back up application A while ignoring the veto.</span></span>

<span data-ttu-id="33685-124">Veja a seguir exemplos de uma veto de gravador:</span><span class="sxs-lookup"><span data-stu-id="33685-124">The following are examples of a writer veto:</span></span>

-   <span data-ttu-id="33685-125">O gravador veta o processo de criação de cópia de sombra quando não conseguiu suspender suas atividades durante o tempo em que a cópia de sombra estava sendo criada.</span><span class="sxs-lookup"><span data-stu-id="33685-125">The writer vetoes the shadow copy creation process when it could not suspend its activities during the time the shadow copy was being created.</span></span> <span data-ttu-id="33685-126">Isso indica que há uma alta probabilidade de que a cópia de sombra não seja válida porque ocorreu uma operação de gravação durante o estado de congelamento.</span><span class="sxs-lookup"><span data-stu-id="33685-126">This indicates that there is a high probability that the shadow copy is not valid because a write operation has occurred during the Freeze state.</span></span>
-   <span data-ttu-id="33685-127">Um aplicativo de backup solicitou uma cópia de sombra do volume C: e um gravador determina que uma cópia de sombra de C: e D: é fazer backup de seus dados.</span><span class="sxs-lookup"><span data-stu-id="33685-127">A backup application has requested a shadow copy of only volume C: and a writer determines that a shadow copy of C: and D: is to back up its data.</span></span> <span data-ttu-id="33685-128">Nesse caso, o gravador será vetado.</span><span class="sxs-lookup"><span data-stu-id="33685-128">In this case, the writer will veto.</span></span> <span data-ttu-id="33685-129">O aplicativo de backup pode examinar os metadados e determinar se o gravador será ignorado ou se o processo de criação da cópia de sombra será anulado e depois reiniciado.</span><span class="sxs-lookup"><span data-stu-id="33685-129">The backup application may examine the metadata and determine whether the writer will be ignored or the shadow copy creation process will be aborted and later restarted.</span></span>

 

 



