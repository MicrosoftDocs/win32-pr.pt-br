---
description: O serviço registro do Windows dá suporte a um gravador VSS, chamado de gravador de registro, que permite aos solicitantes fazer backup de um registro do sistema usando dados armazenados em um volume copiado de sombra.
ms.assetid: 94a45b04-0bdc-4211-bed0-caeabba774af
title: Operações de backup e restauração do registro no VSS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: db1a3022ec2fb08b07bcff8b28455ae7154e4c40
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105781485"
---
# <a name="registry-backup-and-restore-operations-under-vss"></a><span data-ttu-id="85965-103">Operações de backup e restauração do registro no VSS</span><span class="sxs-lookup"><span data-stu-id="85965-103">Registry Backup and Restore Operations Under VSS</span></span>

<span data-ttu-id="85965-104">O serviço registro do Windows dá suporte a um gravador VSS, chamado de gravador de registro, que permite aos solicitantes fazer backup de um registro do sistema usando dados armazenados em um volume copiado de sombra.</span><span class="sxs-lookup"><span data-stu-id="85965-104">The Windows Registry Service supports a VSS writer, called the registry writer, which allows requesters to back up a system registry using data stored on a shadow copied volume.</span></span> <span data-ttu-id="85965-105">Para obter mais informações sobre o gravador do registro, consulte [gravadores VSS in-box](in-box-vss-writers.md).</span><span class="sxs-lookup"><span data-stu-id="85965-105">For more information about the registry writer, see [In-Box VSS Writers](in-box-vss-writers.md).</span></span>

<span data-ttu-id="85965-106">O gravador do registro executa backups e restaurações in-loco do registro.</span><span class="sxs-lookup"><span data-stu-id="85965-106">The registry writer performs in-place backups and restores of the registry.</span></span> <span data-ttu-id="85965-107">Além disso, o gravador do registro relata apenas hives do sistema; Ele não relata hives de usuário.</span><span class="sxs-lookup"><span data-stu-id="85965-107">In addition, the registry writer reports only system hives; it does not report user hives.</span></span>

<span data-ttu-id="85965-108">**Windows Server 2003:** O gravador do registro usa um arquivo de repositório intermediário (também conhecido como um arquivo saliva) para armazenar dados de registro.</span><span class="sxs-lookup"><span data-stu-id="85965-108">**Windows Server 2003:** The registry writer uses an intermediate repository file (also known as a spit file) to store registry data.</span></span> <span data-ttu-id="85965-109">Além disso, o gravador do registro relata hives do sistema e hives do usuário.</span><span class="sxs-lookup"><span data-stu-id="85965-109">In addition, the registry writer reports system hives and user hives.</span></span>

<span data-ttu-id="85965-110">A ID do gravador para o gravador do registro é AFBAB4A2-367D-4D15-A586-71DBB18F8485.</span><span class="sxs-lookup"><span data-stu-id="85965-110">The writer ID for the registry writer is AFBAB4A2-367D-4D15-A586-71DBB18F8485.</span></span>

<span data-ttu-id="85965-111">**Windows XP:** Não há nenhum gravador de registro.</span><span class="sxs-lookup"><span data-stu-id="85965-111">**Windows XP:** There is no registry writer.</span></span> <span data-ttu-id="85965-112">Os dados do registro são relatados pelo gravador de estado inicializável, cuja ID do gravador é F2436E37-09F5-41AF-9B2A-4CA2435DBFD5.</span><span class="sxs-lookup"><span data-stu-id="85965-112">The registry data is reported by the Bootable State writer, whose writer ID is F2436E37-09F5-41AF-9B2A-4CA2435DBFD5.</span></span>

> [!Note]  
> <span data-ttu-id="85965-113">A Microsoft não fornece suporte técnico de desenvolvedor ou profissional de ti para implementar restaurações de estado do sistema online no Windows (todas as versões).</span><span class="sxs-lookup"><span data-stu-id="85965-113">Microsoft does not provide developer or IT professional technical support for implementing online system state restores on Windows (all releases).</span></span> <span data-ttu-id="85965-114">Para obter informações sobre como usar as APIs e os procedimentos fornecidos pela Microsoft para implementar restaurações de estado do sistema online, consulte os recursos da Comunidade disponíveis no [msdn Community Center](https://msdn.microsoft.com/community/default.aspx).</span><span class="sxs-lookup"><span data-stu-id="85965-114">For information about using Microsoft-provided APIs and procedures to implement online system state restores, see the community resources available at the [MSDN Community Center](https://msdn.microsoft.com/community/default.aspx).</span></span>

 

> [!Note]  
> <span data-ttu-id="85965-115">As informações a seguir se aplicam somente ao Windows Server 2003 e ao Windows XP.</span><span class="sxs-lookup"><span data-stu-id="85965-115">The following information only applies to Windows Server 2003 and Windows XP.</span></span>

 

## <a name="registry-backup-using-vss"></a><span data-ttu-id="85965-116">Backup do registro usando VSS</span><span class="sxs-lookup"><span data-stu-id="85965-116">Registry Backup Using VSS</span></span>

<span data-ttu-id="85965-117">O gravador do registro exportará e salvará os arquivos de registro ativos nos locais definidos pela chave **HKEY \_ local \_ Machine** \\ **System** \\ **CurrentControlSet** \\ **Control** \\ **hivelist**.</span><span class="sxs-lookup"><span data-stu-id="85965-117">The registry writer will export and save active registry files in the locations defined by the key **HKEY\_LOCAL\_MACHINE**\\**System**\\**CurrentControlSet**\\**Control**\\**hivelist**.</span></span>

<span data-ttu-id="85965-118">Os nomes dos valores nessa entrada de registro identificam o hive do registro a ser salvo e os dados do valor fornecem o arquivo que contém o arquivo (o arquivo do hive).</span><span class="sxs-lookup"><span data-stu-id="85965-118">The names of the values under this registry entry identify the registry hive to be saved, and the value's data provides the file containing the file (the hive file).</span></span> <span data-ttu-id="85965-119">Os arquivos do hive são especificados com o seguinte formato: \\ dispositivo \\ *HarddiskVolumeX* \\ *caminho* \\ *nome do arquivo*.</span><span class="sxs-lookup"><span data-stu-id="85965-119">The hive files are specified with the following format: \\Device\\*HarddiskVolumeX*\\*path*\\*filename*.</span></span>

<span data-ttu-id="85965-120">Por exemplo, em **HKEY \_ local \_ máquina** \\ **sistema** \\ **CurrentControlSet** \\ **Control** \\ **hivelist**, você pode ver o dispositivo de **\\ \\ \\ software computador de registro**  =  \\ \\ HarddiskVolume1 \\ Windows \\ System32 \\ config \\ software.</span><span class="sxs-lookup"><span data-stu-id="85965-120">For example, under **HKEY\_LOCAL\_MACHINE**\\**System**\\**CurrentControlSet**\\**Control**\\**hivelist**, you might see **\\REGISTRY\\MACHINE\\SOFTWARE** = \\Device\\HarddiskVolume1\\Windows\\System32\\config\\SOFTWARE.</span></span>

<span data-ttu-id="85965-121">O gravador do registro garante que os arquivos do hive sejam salvos em disco antes da sua cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="85965-121">The registry writer ensures that hive files are saved to disk prior to its shadow copy.</span></span>

<span data-ttu-id="85965-122">Ao fazer backup dos hives do registro, um solicitante substituiria o \\ dispositivo \\ *HarddiskVolumeX* pela cadeia de caracteres do [*objeto de dispositivo*](vssgloss-d.md) da cópia de sombra do volume.</span><span class="sxs-lookup"><span data-stu-id="85965-122">When backing up the registry hives, a requester would replace \\Device\\*HarddiskVolumeX* with the [*device object*](vssgloss-d.md) string of the volume's shadow copy.</span></span>

> [!Note]  
> <span data-ttu-id="85965-123">Você pode converter o \\ caminho do dispositivo \\ *HarddiskVolumeX* para um caminho Win32 equivalente usando a função [**QueryDosDevice**](/windows/win32/api/fileapi/nf-fileapi-querydosdevicew) .</span><span class="sxs-lookup"><span data-stu-id="85965-123">You can convert the \\Device\\*HarddiskVolumeX* path to an equivalent Win32 path by using the [**QueryDosDevice**](/windows/win32/api/fileapi/nf-fileapi-querydosdevicew) function.</span></span> <span data-ttu-id="85965-124">Para obter mais informações, consulte [obtendo um nome de arquivo de um identificador de arquivo](../memory/obtaining-a-file-name-from-a-file-handle.md) ou [exibindo nomes de caminho de volume](../fileio/displaying-volume-paths.md).</span><span class="sxs-lookup"><span data-stu-id="85965-124">For more information, see [Obtaining a File Name From a File Handle](../memory/obtaining-a-file-name-from-a-file-handle.md) or [Displaying Volume Path Names](../fileio/displaying-volume-paths.md).</span></span>

 

## <a name="registry-restore-using-non-vss-win32-apis"></a><span data-ttu-id="85965-125">Restauração do registro usando APIs do Win32 não VSS</span><span class="sxs-lookup"><span data-stu-id="85965-125">Registry Restore Using Non-VSS Win32 APIs</span></span>

<span data-ttu-id="85965-126">Para uma restauração online (modo de segurança ou sistema operacional completo), as subchaves na chave de registro **HKEY \_ local \_** \\ **System sistema** \\ **CurrentControlSet** \\ **Control** \\ **Session Manager** \\ **PendingFileRenameOperations** devem ser preservadas.</span><span class="sxs-lookup"><span data-stu-id="85965-126">For an online (safe mode or full operating system) restore, the subkeys in the **HKEY\_LOCAL\_MACHINE**\\**SYSTEM**\\**CurrentControlSet**\\**Control**\\**Session Manager**\\**PendingFileRenameOperations** registry key must be preserved.</span></span>

<span data-ttu-id="85965-127">As funções [**MoveFileEx**](/windows/win32/api/winbase/nf-winbase-movefileexa) e [**MoveFileTransacted**](/windows/win32/api/winbase/nf-winbase-movefiletransacteda) usam essa chave do registro para armazenar informações sobre os arquivos que foram renomeados usando o atraso de MoveFile até o \_ valor de \_ \_ reinicialização no parâmetro *dwFlags* .</span><span class="sxs-lookup"><span data-stu-id="85965-127">The [**MoveFileEx**](/windows/win32/api/winbase/nf-winbase-movefileexa) and [**MoveFileTransacted**](/windows/win32/api/winbase/nf-winbase-movefiletransacteda) functions use this registry key to store information about files that were renamed by using the MOVEFILE\_DELAY\_UNTIL\_REBOOT value in the *dwFlags* parameter.</span></span>

<span data-ttu-id="85965-128">Para preservar o conteúdo da chave do registro **PendingFileRenameOperations** , o aplicativo de backup deve chamar a função [**RegLoadKey**](/windows/win32/api/winreg/nf-winreg-regloadkeya) para conectar o arquivo do registro a ser restaurado no registro ativo.</span><span class="sxs-lookup"><span data-stu-id="85965-128">To preserve the contents of the **PendingFileRenameOperations** registry key, your backup application should call the [**RegLoadKey**](/windows/win32/api/winreg/nf-winreg-regloadkeya) function to connect the registry file to be restored to the active registry.</span></span> <span data-ttu-id="85965-129">O aplicativo de backup pode usar as várias funções de registro para copiar as chaves e os valores desejados no hive carregado.</span><span class="sxs-lookup"><span data-stu-id="85965-129">Your backup application can then use the various registry functions to copy the desired keys and values into the loaded hive.</span></span> <span data-ttu-id="85965-130">Após a conclusão da cópia, as funções [**RegFlushKey**](/windows/win32/api/winreg/nf-winreg-regflushkey) e [**RegUnloadKey**](/windows/win32/api/winreg/nf-winreg-regunloadkeya) devem ser chamadas.</span><span class="sxs-lookup"><span data-stu-id="85965-130">After the copy is complete, the [**RegFlushKey**](/windows/win32/api/winreg/nf-winreg-regflushkey) and [**RegUnloadKey**](/windows/win32/api/winreg/nf-winreg-regunloadkeya) functions should be called.</span></span>

<span data-ttu-id="85965-131">Para uma restauração offline (ambiente de recuperação do Windows ou Windows PE), não é necessário respeitar a chave do registro **PendingFileRenameOperations** .</span><span class="sxs-lookup"><span data-stu-id="85965-131">For an offline (Windows Recovery Environment or Windows PE) restore, it is not necessary to honor the **PendingFileRenameOperations** registry key.</span></span>

## <a name="registry-restore-using-non-vss-win32-apis-in-windows-server-2003"></a><span data-ttu-id="85965-132">Restauração do registro usando APIs do Win32 não VSS no Windows Server 2003</span><span class="sxs-lookup"><span data-stu-id="85965-132">Registry Restore Using Non-VSS Win32 APIs in Windows Server 2003</span></span>

> [!Note]  
> <span data-ttu-id="85965-133">As informações a seguir se aplicam somente a operações de restauração relacionadas à recuperação de desastre (também conhecida como recuperação bare-metal) que são executadas no Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="85965-133">The following information applies only to restore operations related to disaster recovery (also known as bare-metal recovery) that are performed in Windows Server 2003.</span></span>

 

<span data-ttu-id="85965-134">Ao restaurar o registro, um aplicativo de backup precisa mover algumas das subchaves do registro atual para o registro que deve ser restaurado.</span><span class="sxs-lookup"><span data-stu-id="85965-134">When restoring the registry, a backup application needs to move some of the subkeys from the current registry into the registry that is to be restored.</span></span>

<span data-ttu-id="85965-135">Para fazer isso, um aplicativo de backup pode chamar **RegLoadKey** para conectar o arquivo do registro a ser restaurado para o registro ativo no momento.</span><span class="sxs-lookup"><span data-stu-id="85965-135">To do this, a backup application can call **RegLoadKey** to connect the registry file to be restored to the currently active registry.</span></span> <span data-ttu-id="85965-136">Em seguida, ele pode usar as várias funções de registro para copiar as chaves e os valores desejados no hive carregado.</span><span class="sxs-lookup"><span data-stu-id="85965-136">It can then use the various registry functions to copy the desired keys and values into the loaded hive.</span></span> <span data-ttu-id="85965-137">Depois que a cópia for concluída, **RegFlushKey** e **RegUnloadKey** serão chamados.</span><span class="sxs-lookup"><span data-stu-id="85965-137">After the copy is complete, **RegFlushKey** and **RegUnloadKey** are called.</span></span>

<span data-ttu-id="85965-138">Há uma chave do registro que indica a um aplicativo de restauração (solicitante) as chaves do registro em **HKEY \_ local \_ Machine \\ System** que não devem ser substituídas no momento da restauração:</span><span class="sxs-lookup"><span data-stu-id="85965-138">There is a registry key that indicates to a restore application (requester) the registry keys under **HKEY\_LOCAL\_MACHINE\\SYSTEM** that should not be overwritten at restore time:</span></span>

<span data-ttu-id="85965-139">**HKEY \_ local \_ Machine \\ sistema \\ CurrentControlSet \\ Control \\ BackupRestore \\ KeysNotToRestore**</span><span class="sxs-lookup"><span data-stu-id="85965-139">**HKEY\_LOCAL\_MACHINE\\System\\CurrentControlSet\\Control\\BackupRestore\\KeysNotToRestore**</span></span>

<span data-ttu-id="85965-140">Parte do processo de restauração de estado do sistema envolve a restauração de um registro de backup anterior.</span><span class="sxs-lookup"><span data-stu-id="85965-140">Part of the system state restore process involves restoring a previously backed-up registry.</span></span>

<span data-ttu-id="85965-141">Os aplicativos de backup precisam tomar cuidado especial ao restaurar o hive do **\_ \_ \\ sistema de máquina local hKey** , pois o processo de instalação de uma versão temporária do sistema operacional Windows terá estabelecido chaves no hive do sistema recém-instalado, cujos valores devem sobreviver à operação de restauração.</span><span class="sxs-lookup"><span data-stu-id="85965-141">Backup applications need to take special care when restoring the **HKEY\_LOCAL\_MACHINE\\SYSTEM** hive because the process of installing a temporary version of the Windows operating system will have established keys in the newly installed system hive whose values must survive the restore operation.</span></span>

<span data-ttu-id="85965-142">Por exemplo, quando o sistema de substituição tiver uma placa de interface de rede diferente do sistema original, a restauração das chaves originais para o cartão anterior resultará em resultados imprevisíveis.</span><span class="sxs-lookup"><span data-stu-id="85965-142">For example, when the replacement system has a network interface card different from the original system, restoration of the original keys for the previous card will lead to unpredictable results.</span></span> <span data-ttu-id="85965-143">Isso ocorre porque o serviço de Plug and Play detectou e colocou entradas apropriadas de registro de serviço e driver no registro.</span><span class="sxs-lookup"><span data-stu-id="85965-143">This is because the Plug and Play service has detected and placed proper service and driver registry entries into the registry.</span></span> <span data-ttu-id="85965-144">Esses valores devem ser preservados para uma inicialização adequada após a restauração do sistema.</span><span class="sxs-lookup"><span data-stu-id="85965-144">These values must be preserved to properly boot after system restore.</span></span>

<span data-ttu-id="85965-145">Esta seção descreve como os aplicativos de backup podem descobrir quais chaves e arquivos devem ser preservados ao executar uma restauração do hive do **\_ \_ \\ sistema de máquina local hKey** .</span><span class="sxs-lookup"><span data-stu-id="85965-145">This section describes how backup applications can discover which keys and files are to be preserved when executing a restore of the **HKEY\_LOCAL\_MACHINE\\SYSTEM** hive.</span></span> <span data-ttu-id="85965-146">Em alguns casos, isso envolverá a cópia programática das chaves do hive de instalação recém instalado para o hive a ser restaurado.</span><span class="sxs-lookup"><span data-stu-id="85965-146">In some cases, this will involve programmatically copying the keys from the newly installed installation hive into the hive to be restored.</span></span> <span data-ttu-id="85965-147">Em outros casos, garantir que as chaves do registro de um produto não sejam substituídas é tão simples quanto especificar essas chaves no arquivo de configuração INF do produto.</span><span class="sxs-lookup"><span data-stu-id="85965-147">In other cases, ensuring that a product's registry keys are not replaced is as simple as specifying such keys in the product's INF configuration file.</span></span>

<span data-ttu-id="85965-148">Chaves (e dados de chave) que devem ser preservadas são enumeradas no hive do **\_ \_ \\ sistema de máquina local hKey** no</span><span class="sxs-lookup"><span data-stu-id="85965-148">Keys (and key data) that are to be preserved are enumerated in the **HKEY\_LOCAL\_MACHINE\\SYSTEM** hive under the</span></span>

<span data-ttu-id="85965-149">**HKEY \_ local \_ Machine \\ sistema \\ CurrentControlSet \\ Control \\ BackupRestore \\ KeysNotToRestore**</span><span class="sxs-lookup"><span data-stu-id="85965-149">**HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\BackupRestore\\KeysNotToRestore**</span></span>

<span data-ttu-id="85965-150">chave como conjuntos de \_ \_ cadeias de caracteres reg multi sz (chamadas de *cadeias de caracteres de chave* neste documento).</span><span class="sxs-lookup"><span data-stu-id="85965-150">key as sets of REG\_MULTI\_SZ strings (called *key strings* in this document).</span></span>

<span data-ttu-id="85965-151">Um aplicativo de backup (solicitante) deve examinar os valores dessas chaves no registro ativo e o registro recém restaurado, pois qualquer aplicativo ou serviço pode adicionar valores a qualquer momento.</span><span class="sxs-lookup"><span data-stu-id="85965-151">A backup application (requester) must examine the values of these keys in the active registry and the newly restored registry because any application or service can add values at any time.</span></span>

<span data-ttu-id="85965-152">Como as principais cadeias de caracteres devem ser interpretadas por aplicativos de backup são determinadas pelo caractere de terminal:</span><span class="sxs-lookup"><span data-stu-id="85965-152">How key strings are to be interpreted by backup applications is determined by their terminal character:</span></span>

1.  <span data-ttu-id="85965-153">As cadeias de caracteres-chave terminadas com uma barra invertida (' \\ ') são interpretadas como subchaves.</span><span class="sxs-lookup"><span data-stu-id="85965-153">Key strings terminated with a backslash ('\\') are interpreted as subkeys.</span></span> <span data-ttu-id="85965-154">Quando tal subcadeia de caracteres é encontrada, o aplicativo de backup deve preservar todos os dados e todas as chaves subordinadas.</span><span class="sxs-lookup"><span data-stu-id="85965-154">When such a substring is encountered, the backup application must preserve all data and all subordinate keys.</span></span>

    <span data-ttu-id="85965-155">Por exemplo, o seguinte especifica que todas as chaves subordinadas e os dados serão preservados em uma operação de restauração:</span><span class="sxs-lookup"><span data-stu-id="85965-155">For example, the following specifies that all subordinate keys and data are to be preserved across a restore operation:</span></span>

    <span data-ttu-id="85965-156">**HKEY \_ local \_ Machine \\ System \\ CurrentControlSet \\ Services \\ dmio \\ informações de inicialização\\**</span><span class="sxs-lookup"><span data-stu-id="85965-156">**HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\dmio\\boot info\\**</span></span>

    <span data-ttu-id="85965-157">Para esse fim, essa chave e todas as chaves e os dados subordinados devem ser copiados do registro existente (ou seja, aquele criado pela instalação do Windows) no registro recém restaurado.</span><span class="sxs-lookup"><span data-stu-id="85965-157">To this end, this key and all subordinate keys and data must be copied from the existing registry (that is, the one created by the installation of Windows) into the newly restored registry.</span></span> <span data-ttu-id="85965-158">Isso é chamado de operação de *substituição de chave* .</span><span class="sxs-lookup"><span data-stu-id="85965-158">This is called a *key replace* operation.</span></span> <span data-ttu-id="85965-159">Essa operação substitui a chave correspondente no Registro restaurado.</span><span class="sxs-lookup"><span data-stu-id="85965-159">This operation replaces the corresponding key in the restored registry.</span></span>

2.  <span data-ttu-id="85965-160">As cadeias de caracteres-chave cujo caractere de terminação é um asterisco (' \* ') especifica que todas as subchaves devem ser mescladas.</span><span class="sxs-lookup"><span data-stu-id="85965-160">Key strings whose termination character is an asterisk ('\*') specifies that all subkeys should be merged.</span></span> <span data-ttu-id="85965-161">Por exemplo, a cadeia de caracteres chave:</span><span class="sxs-lookup"><span data-stu-id="85965-161">For example, the key string:</span></span>

    <span data-ttu-id="85965-162">\**HKEY \_ \_Sistema de computador local \\ \\ CurrentControlSet \\ \\ \* Serviços* _</span><span class="sxs-lookup"><span data-stu-id="85965-162">\**HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\\** _</span></span>

    <span data-ttu-id="85965-163">Especifica que a chave de serviços no registro existente (por exemplo, as criadas pela instalação do Windows) deve ser mesclada no Registro restaurado.</span><span class="sxs-lookup"><span data-stu-id="85965-163">specifies that the services key in the existing registry (for example those created by the installation of Windows) must be merged into the restored registry.</span></span> <span data-ttu-id="85965-164">Isso é chamado de _key operação Merge \* e, se existir uma subchave no hive existente e no hive restaurado, a chave no diretório restaurado será preservada com as seguintes exceções:</span><span class="sxs-lookup"><span data-stu-id="85965-164">This is called a _key merge\* operation, and if a subkey exists in both the existing hive and the restored hive, the key in the restored directory is preserved with the following exceptions:</span></span>

    -   <span data-ttu-id="85965-165">Se a subchave no hive existente contiver um valor chamado "Start", e a subchave no restaurada não.</span><span class="sxs-lookup"><span data-stu-id="85965-165">If the subkey in the existing hive contains a value named "start", and the subkey in the restored does not.</span></span>
    -   <span data-ttu-id="85965-166">Se a subchave no hive existente e no que foi restaurado contiver um valor chamado "Start", e seu valor numérico no hive existente for menor.</span><span class="sxs-lookup"><span data-stu-id="85965-166">If the subkey in both the existing and restored hive contain a value named "start", and its numeric value in the existing hive is less.</span></span>

    <span data-ttu-id="85965-167">O valor "Start" no registro especifica quando um serviço ou driver será iniciado e pode ter um valor numérico de 0-4.</span><span class="sxs-lookup"><span data-stu-id="85965-167">The "start" value in the registry specifies when a service or driver will start and can have a numeric value from 0-4.</span></span> <span data-ttu-id="85965-168">Quanto menor o valor, mais cedo no processo de inicialização o serviço será iniciado.</span><span class="sxs-lookup"><span data-stu-id="85965-168">The lower the value, the sooner in the boot process the service will start.</span></span>

    <span data-ttu-id="85965-169">Se essa chave existir nos diretórios existente e restaurado, você deverá examinar o valor da chave inicial em cada Hive.</span><span class="sxs-lookup"><span data-stu-id="85965-169">If this key exists in both the existing and the restored directory, you must examine the value of the start key in each hive.</span></span> <span data-ttu-id="85965-170">Se o valor no hive existente for menor que o valor no diretório restaurado, o valor mais baixo deverá ser preservado.</span><span class="sxs-lookup"><span data-stu-id="85965-170">If the value in the existing hive is lower than the value in the restored directory, the lower value must be preserved.</span></span>

    <span data-ttu-id="85965-171">Mais uma vez, essa chave é usada para determinar se um serviço ou driver deve ser iniciado no momento da inicialização, na hora do sistema, manualmente, automaticamente ou desabilitado.</span><span class="sxs-lookup"><span data-stu-id="85965-171">Once again, this key is used to determine whether a service or driver is to be started at boot time, at system time, manually, automatically, or be disabled.</span></span> <span data-ttu-id="85965-172">O valor mais baixo representa uma hora de início anterior.</span><span class="sxs-lookup"><span data-stu-id="85965-172">The lower value represents an earlier start time.</span></span> <span data-ttu-id="85965-173">A hora de início anterior deve ser aplicada ao novo registro para garantir que o serviço ou os drivers sejam iniciados corretamente na próxima inicialização.</span><span class="sxs-lookup"><span data-stu-id="85965-173">The earlier start time must be applied to the new registry to ensure that the service or drivers are started properly at the next boot.</span></span>

3.  <span data-ttu-id="85965-174">As cadeias de caracteres-chave cujo caractere de término não é uma barra invertida nem um asterisco são interpretados como valores do registro a serem preservados.</span><span class="sxs-lookup"><span data-stu-id="85965-174">Key strings whose termination character is neither a backslash nor an asterisk are interpreted as registry values to be preserved.</span></span>

    <span data-ttu-id="85965-175">Por exemplo, a cadeia de caracteres chave:</span><span class="sxs-lookup"><span data-stu-id="85965-175">For example, the key string:</span></span>

    <span data-ttu-id="85965-176">**HKEY \_ local \_ Machine \\ sistema \\ CurrentControlSet \\ Control \\ Session Manager \\ PendingFileRenameOperations**</span><span class="sxs-lookup"><span data-stu-id="85965-176">**HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\PendingFileRenameOperations**</span></span>

    <span data-ttu-id="85965-177">O mecanismo pelo qual as chaves podem ser preservadas programaticamente envolve a API do registro do Win32.</span><span class="sxs-lookup"><span data-stu-id="85965-177">The mechanism by which keys can be preserved programmatically involves the Win32 registry API.</span></span> <span data-ttu-id="85965-178">Por exemplo, um algoritmo é enumerado abaixo:</span><span class="sxs-lookup"><span data-stu-id="85965-178">For example, one algorithm is enumerated below:</span></span>

    1.  <span data-ttu-id="85965-179">Restaure o arquivo do hive do sistema com backup em um arquivo.</span><span class="sxs-lookup"><span data-stu-id="85965-179">Restore the backed-up system hive file to a file.</span></span> <span data-ttu-id="85965-180">Para este exemplo, deixe o nome ser System. reg.</span><span class="sxs-lookup"><span data-stu-id="85965-180">For this example, let the name be System.reg.</span></span>
    2.  <span data-ttu-id="85965-181">Use **RegLoadKey** para carregar System. reg em **HKEY \_ local \_ Machine** com um nome temporário.</span><span class="sxs-lookup"><span data-stu-id="85965-181">Use **RegLoadKey** to load System.reg into **HKEY\_LOCAL\_MACHINE** under a temporary name.</span></span> <span data-ttu-id="85965-182">Por exemplo, um desses nomes pode ser</span><span class="sxs-lookup"><span data-stu-id="85965-182">For example, one such name might be</span></span>

        <span data-ttu-id="85965-183">**HKEY \_ \_ computador local \\ tmp \_ System**</span><span class="sxs-lookup"><span data-stu-id="85965-183">**HKEY\_LOCAL\_MACHINE\\TMP\_SYSTEM**</span></span>

    3.  <span data-ttu-id="85965-184">Enumere os valores na subchave **KeysNotToRestore** de ambas as cópias do registro e crie um superconjunto das listas.</span><span class="sxs-lookup"><span data-stu-id="85965-184">Enumerate the values in the **KeysNotToRestore** subkey from both of the registry copies and create a superset of the lists.</span></span> <span data-ttu-id="85965-185">Copiar cada chave desse tipo existente</span><span class="sxs-lookup"><span data-stu-id="85965-185">Copy each such key from the existing</span></span>

        <span data-ttu-id="85965-186">**HKEY \_ \_ computador local \\ System**</span><span class="sxs-lookup"><span data-stu-id="85965-186">**HKEY\_LOCAL\_MACHINE\\SYSTEM**</span></span>

        <span data-ttu-id="85965-187">chave para o</span><span class="sxs-lookup"><span data-stu-id="85965-187">key into the</span></span>

        <span data-ttu-id="85965-188">**HKEY \_ \_ computador local \\ tmp \_ System**</span><span class="sxs-lookup"><span data-stu-id="85965-188">**HKEY\_LOCAL\_MACHINE\\TMP\_SYSTEM**</span></span>

        <span data-ttu-id="85965-189">chave de acordo com a semântica descrita acima.</span><span class="sxs-lookup"><span data-stu-id="85965-189">key according to the semantics described above.</span></span>

    4.  <span data-ttu-id="85965-190">Ao concluir, use os pontos de entrada do **RegFlushKey**  &  **RegUnloadKey** para salvar o</span><span class="sxs-lookup"><span data-stu-id="85965-190">When complete use the **RegFlushKey** & **RegUnloadKey** entry points to save the</span></span>

        <span data-ttu-id="85965-191">**HKEY \_ \_ computador local \\ tmp \_ System**</span><span class="sxs-lookup"><span data-stu-id="85965-191">**HKEY\_LOCAL\_MACHINE\\TMP\_SYSTEM**</span></span>

        <span data-ttu-id="85965-192">Volte para System. reg.</span><span class="sxs-lookup"><span data-stu-id="85965-192">key back to System.reg.</span></span>

    5.  <span data-ttu-id="85965-193">Por fim, use **RegReplaceKey** para especificar que System. reg é substituir o</span><span class="sxs-lookup"><span data-stu-id="85965-193">Finally, use **RegReplaceKey** to specify that System.reg is to replace the</span></span>

        <span data-ttu-id="85965-194">**HKEY \_ \_ computador local \\ System**</span><span class="sxs-lookup"><span data-stu-id="85965-194">**HKEY\_LOCAL\_MACHINE\\SYSTEM**</span></span>

        <span data-ttu-id="85965-195">arquivo do hive, sistema.</span><span class="sxs-lookup"><span data-stu-id="85965-195">hive file, SYSTEM.</span></span>

 

 
