---
description: Os gravadores são aplicativos ou serviços que armazenam informações persistentes em arquivos em disco e que fornecem os nomes e locais desses arquivos para os solicitantes usando a interface de cópia de sombra.
ms.assetid: 24fc2d7c-f8d6-49ca-9bb5-0179bef68e78
title: Gravadores
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 52ca409e8dc6153a6b3e2b747dc23cc391055471
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105763142"
---
# <a name="writers"></a><span data-ttu-id="139ec-103">Gravadores</span><span class="sxs-lookup"><span data-stu-id="139ec-103">Writers</span></span>

<span data-ttu-id="139ec-104">Os [*gravadores*](vssgloss-w.md) são aplicativos ou serviços que armazenam informações persistentes em arquivos em disco e que fornecem os nomes e locais desses arquivos para os solicitantes usando a interface de cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="139ec-104">[*Writers*](vssgloss-w.md) are applications or services that store persistent information in files on disk and that provide the names and locations of these files to requesters by using the shadow copy interface.</span></span>

<span data-ttu-id="139ec-105">Durante as operações de backup, os gravadores asseguram que seus dados estejam inativos e estáveis – adequados para cópia de sombra e backup.</span><span class="sxs-lookup"><span data-stu-id="139ec-105">During backup operations, writers ensure that their data is quiescent and stable—suitable for shadow copy and backup.</span></span> <span data-ttu-id="139ec-106">Os gravadores colaboram com restaurações desbloqueando arquivos quando possível e indicando locais alternativos quando necessário.</span><span class="sxs-lookup"><span data-stu-id="139ec-106">Writers collaborate with restores by unlocking files when possible and indicating alternate locations when necessary.</span></span>

<span data-ttu-id="139ec-107">Se nenhum gravador estiver presente durante uma operação de backup do VSS, uma cópia de sombra ainda poderá ser criada.</span><span class="sxs-lookup"><span data-stu-id="139ec-107">If no writers are present during a VSS backup operation, a shadow copy can still be created.</span></span> <span data-ttu-id="139ec-108">Nesse caso, todos os dados no volume copiado por sombra estarão no [*estado consistente com falhas*](vssgloss-c.md).</span><span class="sxs-lookup"><span data-stu-id="139ec-108">In this case, all data on the shadow-copied volume will be in the [*crash-consistent state*](vssgloss-c.md).</span></span>

## <a name="writer-state"></a><span data-ttu-id="139ec-109">Estado do gravador</span><span class="sxs-lookup"><span data-stu-id="139ec-109">Writer State</span></span>

<span data-ttu-id="139ec-110">Os gravadores mantêm seu estado em um objeto de metadados baseado em XML, o [*documento de metadados do gravador*](vssgloss-w.md).</span><span class="sxs-lookup"><span data-stu-id="139ec-110">Writers maintain their state in an XML-based metadata object, the [*Writer Metadata Document*](vssgloss-w.md).</span></span>

<span data-ttu-id="139ec-111">Esses metadados de gravador são a única estrutura de dados que contém o [*conjunto de arquivos*](vssgloss-f.md)— caminho, especificação de arquivo e sinalizador de recursão — dos dados a serem armazenados em backup e restaurados.</span><span class="sxs-lookup"><span data-stu-id="139ec-111">This writer metadata is the only data structure that contains the [*file set*](vssgloss-f.md)—path, file specification, and recursion flag—of the data to be backed up and restored.</span></span>

<span data-ttu-id="139ec-112">O documento de metadados do gravador organiza os conjuntos de arquivos do gravador em grupos ou [*componentes*](vssgloss-c.md).</span><span class="sxs-lookup"><span data-stu-id="139ec-112">The Writer Metadata Document organizes the writer's file sets into groups or [*components*](vssgloss-c.md).</span></span> <span data-ttu-id="139ec-113">A relação de um desses componentes durante as operações de backup e restauração para os outros componentes gerenciados pelo gravador é descrita no documento de metadados do gravador pela seleção do componente [*para backup*](vssgloss-s.md), sua [*seleção para restauração*](vssgloss-s.md)e seus [*caminhos lógicos*](vssgloss-l.md).</span><span class="sxs-lookup"><span data-stu-id="139ec-113">The relationship of one of these components during backup and restore operations to the other components managed by the writer is described in the Writer Metadata Document by the component's [*selectability for backup*](vssgloss-s.md), its [*selectability for restore*](vssgloss-s.md), and its [*logical paths*](vssgloss-l.md).</span></span> <span data-ttu-id="139ec-114">(Para obter mais informações, consulte [Configurando a organização do componente](definition-of-components-by-writers.md) e [trabalhando com a seleção e os caminhos lógicos](working-with-selectability-and-logical-paths.md).)</span><span class="sxs-lookup"><span data-stu-id="139ec-114">(For more information, see [Setting up Component Organization](definition-of-components-by-writers.md) and [Working with Selectability and Logical Paths](working-with-selectability-and-logical-paths.md).)</span></span>

<span data-ttu-id="139ec-115">Informações adicionais que regem a restauração de arquivos e outros problemas também estão contidas neste documento.</span><span class="sxs-lookup"><span data-stu-id="139ec-115">Additional information that governs file restoration and other issues is also contained in this document.</span></span>

<span data-ttu-id="139ec-116">O solicitante precisa dos metadados do gravador, em conjunto com seu próprio documento de componentes de backup, para processar um backup ou uma restauração.</span><span class="sxs-lookup"><span data-stu-id="139ec-116">The requester needs the writer metadata, in conjunction with its own Backup Components Document, to process a backup or a restore.</span></span>

<span data-ttu-id="139ec-117">Ao contrário do documento de componentes de backup, o documento de metadados do gravador deve ser considerado como uma estrutura somente leitura.</span><span class="sxs-lookup"><span data-stu-id="139ec-117">Unlike the Backup Components Document, the Writer Metadata Document should be thought of as a read-only structure.</span></span> <span data-ttu-id="139ec-118">Depois que um gravador o cria, o documento não é alterado.</span><span class="sxs-lookup"><span data-stu-id="139ec-118">Once a writer creates it, the document is not altered.</span></span>

## <a name="writer-event-handling"></a><span data-ttu-id="139ec-119">Manipulação de eventos do gravador</span><span class="sxs-lookup"><span data-stu-id="139ec-119">Writer Event Handling</span></span>

<span data-ttu-id="139ec-120">As operações do VSS de um gravador são iniciadas por meio do recebimento de eventos COM.</span><span class="sxs-lookup"><span data-stu-id="139ec-120">A writer's VSS operations are initiated through the receipt of COM events.</span></span>

<span data-ttu-id="139ec-121">Quando nenhum evento estiver presente, um gravador não executará operações do VSS (como um backup ou uma restauração VSS).</span><span class="sxs-lookup"><span data-stu-id="139ec-121">When no events are present, a writer does not perform VSS operations (such as a VSS backup or restore).</span></span> <span data-ttu-id="139ec-122">Em vez disso, ele executa seu trabalho normal, como responder a consultas de banco de dados, gerenciar os dados do usuário ou fornecer outros serviços.</span><span class="sxs-lookup"><span data-stu-id="139ec-122">Instead, it performs its normal work, such as responding to database queries, managing user data, or providing other services.</span></span>

<span data-ttu-id="139ec-123">Para garantir que o tratamento de erros para várias sessões de backup e restauração paralelas seja executado corretamente e para garantir que uma sessão de backup ou restauração não corrompa outra, você deve fazer o seguinte:</span><span class="sxs-lookup"><span data-stu-id="139ec-123">To ensure that error handling for multiple parallel backup and restore sessions is performed correctly, and to ensure that one backup or restore session does not corrupt another, you must do the following:</span></span>

-   <span data-ttu-id="139ec-124">Se o manipulador de eventos de um gravador (como [**CVssWriter:: OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze)) chamar o método [**CVssWriterEx2:: GetSessionID**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriterex2-getsessionid), [**CVssWriter:: SetWriterFailure**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-setwriterfailure)ou [**CVssWriterEx2:: SetWriterFailureEx**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriterex2-setwriterfailureex) , o manipulador de eventos deverá chamar o método no mesmo thread que chamou o manipulador de eventos.</span><span class="sxs-lookup"><span data-stu-id="139ec-124">If a writer's event handler (such as [**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze)) calls the [**CVssWriterEx2::GetSessionId**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriterex2-getsessionid), [**CVssWriter::SetWriterFailure**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-setwriterfailure), or [**CVssWriterEx2::SetWriterFailureEx**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriterex2-setwriterfailureex) method, the event handler must call the method in the same thread that called the event handler.</span></span>
-   <span data-ttu-id="139ec-125">A implementação do gravador de um manipulador de eventos, como o [**OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) , pode descarregar o trabalho em threads de trabalho, se desejado, desde que cada thread de trabalho realize o relatório de todos os relatórios de erros necessários de volta para o thread do manipulador de eventos original.</span><span class="sxs-lookup"><span data-stu-id="139ec-125">Your writer’s implementation of an event handler such as [**OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) can offload work to worker threads if desired, as long as each worker thread marshals any needed error reporting back to the original event handler thread.</span></span>

## <a name="handling-identify-events"></a><span data-ttu-id="139ec-126">Tratamento de eventos de identificação</span><span class="sxs-lookup"><span data-stu-id="139ec-126">Handling Identify Events</span></span>

<span data-ttu-id="139ec-127">Com exceção do evento identify, o tipo e a ordem dos eventos que um gravador recebe dependem exclusivamente do tipo de operações do VSS que estão atualmente em andamento.</span><span class="sxs-lookup"><span data-stu-id="139ec-127">With the exception of the Identify event, the type and order of the events a writer receives depends uniquely on the type of VSS operations that are currently ongoing.</span></span>

<span data-ttu-id="139ec-128">O evento de identificação requer que os gravadores forneçam as informações do sistema sobre sua configuração e os arquivos que eles gerenciam por meio de seu [*documento de metadados do gravador*](vssgloss-w.md).</span><span class="sxs-lookup"><span data-stu-id="139ec-128">The Identify event requires writers to provide the system information about their configuration and the files they manage through their [*Writer Metadata Document*](vssgloss-w.md).</span></span> <span data-ttu-id="139ec-129">Um evento de identificação é gerado no suporte de quase qualquer operação do VSS, incluindo consultas do sistema, bem como operações de cópia de sombra e backup e restauração.</span><span class="sxs-lookup"><span data-stu-id="139ec-129">An Identify event is generated in support of almost any VSS operation, including system queries as well as shadow copy and backup and restore operations.</span></span> <span data-ttu-id="139ec-130">Portanto, qualquer implementação do gravador do manipulador de eventos de identificação [**CVssWriter:: onidentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) deve ser capaz de lidar com um evento de identificação a qualquer momento, incluindo no meio do processamento de outra operação VSS, como um backup ou uma restauração.</span><span class="sxs-lookup"><span data-stu-id="139ec-130">Therefore, any writer's implementation of the Identify event handler [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) must be able to handle an Identify event at any time—including in the middle of processing another VSS operation, such as a backup or restore.</span></span> <span data-ttu-id="139ec-131">Um evento de identificação nunca deve ser considerado como parte do ciclo de vida de uma operação VSS, embora sua geração seja esperada e necessária antes do início dessa operação.</span><span class="sxs-lookup"><span data-stu-id="139ec-131">An Identify event should never be thought of as part of the life cycle of a VSS operation, even though its generation may be expected and required prior to the start of that operation.</span></span>

<span data-ttu-id="139ec-132">É particularmente importante que as informações de estado sobre uma operação do VSS não sejam modificadas em [**CVssWriter:: Onidentification**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify), pois o recebimento de um evento fora de ordem redefiniria essas informações.</span><span class="sxs-lookup"><span data-stu-id="139ec-132">It is particularly important that state information about a VSS operation not be modified in [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify), because receipt of an out-of-order event would reset that information.</span></span>

## <a name="backup-and-restore-events"></a><span data-ttu-id="139ec-133">Eventos de backup e restauração</span><span class="sxs-lookup"><span data-stu-id="139ec-133">Backup and Restore Events</span></span>

<span data-ttu-id="139ec-134">Dependendo se estiver participando de um backup ou uma restauração, um gravador receberá entre dois e sete eventos, além de um evento de identificação inicial.</span><span class="sxs-lookup"><span data-stu-id="139ec-134">Depending on whether it is participating in a backup or restore, a writer will receive between two and seven events, in addition to an initial Identify event.</span></span>

<span data-ttu-id="139ec-135">Lidar com esses eventos constitui (do ponto de vista de um gravador) o ciclo de vida de uma operação de backup ou restauração.</span><span class="sxs-lookup"><span data-stu-id="139ec-135">Handling these events constitutes (from the point of view of a writer) the life cycle of a backup or restore operation.</span></span>

<span data-ttu-id="139ec-136">Em uma operação de backup típica (consulte [visão geral do processamento de um backup no VSS](overview-of-processing-a-backup-under-vss.md)), um gravador trataria os seguintes eventos (além de um evento de identificação inicial):</span><span class="sxs-lookup"><span data-stu-id="139ec-136">In a typical backup operation (see [Overview of Processing a Backup Under VSS](overview-of-processing-a-backup-under-vss.md)), a writer would handle the following events (in addition to an initial Identify event):</span></span>

-   <span data-ttu-id="139ec-137">PrepareForBackup</span><span class="sxs-lookup"><span data-stu-id="139ec-137">PrepareForBackup</span></span>
-   <span data-ttu-id="139ec-138">PrepareForSnapshot</span><span class="sxs-lookup"><span data-stu-id="139ec-138">PrepareForSnapshot</span></span>
-   <span data-ttu-id="139ec-139">Congelamento</span><span class="sxs-lookup"><span data-stu-id="139ec-139">Freeze</span></span>
-   <span data-ttu-id="139ec-140">Descongelar</span><span class="sxs-lookup"><span data-stu-id="139ec-140">Thaw</span></span>
-   <span data-ttu-id="139ec-141">Pós-instantâneo</span><span class="sxs-lookup"><span data-stu-id="139ec-141">PostSnapshot</span></span>
-   <span data-ttu-id="139ec-142">BackupComplete</span><span class="sxs-lookup"><span data-stu-id="139ec-142">BackupComplete</span></span>
-   <span data-ttu-id="139ec-143">BackupShutdown</span><span class="sxs-lookup"><span data-stu-id="139ec-143">BackupShutdown</span></span>

<span data-ttu-id="139ec-144">Em uma operação de restauração típica (consulte [visão geral do processamento de uma restauração no VSS](overview-of-processing-a-restore-under-vss.md)), um gravador trataria os seguintes eventos:</span><span class="sxs-lookup"><span data-stu-id="139ec-144">In a typical restore operation (see [Overview of Processing a Restore Under VSS](overview-of-processing-a-restore-under-vss.md)), a writer would handle the following events:</span></span>

-   <span data-ttu-id="139ec-145">Prerestore</span><span class="sxs-lookup"><span data-stu-id="139ec-145">PreRestore</span></span>
-   <span data-ttu-id="139ec-146">Restauração</span><span class="sxs-lookup"><span data-stu-id="139ec-146">PostRestore</span></span>

 

 



