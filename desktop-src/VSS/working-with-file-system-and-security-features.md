---
description: Veja a seguir dicas para interoperar corretamente com vários sistemas de arquivos e recursos de segurança que foram introduzidos no Windows Vista e no Windows Server 2008.
ms.assetid: 3e8a1fd2-59e5-4f18-aafc-0ce5ac1e1cfa
title: Trabalhando com recursos de segurança e sistema de arquivos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 12903599beb7ed153965f4b803ad8147fd32067a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104090432"
---
# <a name="working-with-file-system-and-security-features"></a><span data-ttu-id="ede12-103">Trabalhando com recursos de segurança e sistema de arquivos</span><span class="sxs-lookup"><span data-stu-id="ede12-103">Working with File System and Security Features</span></span>

<span data-ttu-id="ede12-104">Veja a seguir dicas para interoperar corretamente com vários sistemas de arquivos e recursos de segurança que foram introduzidos no Windows Vista e no Windows Server 2008.</span><span class="sxs-lookup"><span data-stu-id="ede12-104">The following are hints for interoperating correctly with various file system and security features that were introduced in Windows Vista and Windows Server 2008.</span></span>

## <a name="interoperability-with-transactions"></a><span data-ttu-id="ede12-105">Interoperabilidade com transações</span><span class="sxs-lookup"><span data-stu-id="ede12-105">Interoperability with Transactions</span></span>

<span data-ttu-id="ede12-106">Para dar suporte a transações, o VSS garante que o KTM (kernel Transaction Manager) e o Coordenador de Transações Distribuídas (DTC) estejam congelados antes da criação de cópias de sombra de volume.</span><span class="sxs-lookup"><span data-stu-id="ede12-106">To support transactions, VSS ensures that both the Kernel Transaction Manager (KTM) and the Distributed Transaction Coordinator (DTC) are frozen prior to the creation of volume shadow copies.</span></span> <span data-ttu-id="ede12-107">Se o sistema falhar ao congelar ou descongelar o KTM ou o DTC, os erros de tempo limite a seguir poderão ser retornados pelo método [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) :</span><span class="sxs-lookup"><span data-stu-id="ede12-107">If the system fails to freeze or thaw KTM or DTC, the following timeout errors may be returned by the [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) method:</span></span>

<dl> <span data-ttu-id="ede12-108">\_ \_ \_ tempo limite de congelamento da transação E VSS \_</span><span class="sxs-lookup"><span data-stu-id="ede12-108">VSS\_E\_TRANSACTION\_FREEZE\_TIMEOUT</span></span>  
<span data-ttu-id="ede12-109">\_ \_ \_ tempo limite de descongelar da transação E \_ VSS</span><span class="sxs-lookup"><span data-stu-id="ede12-109">VSS\_E\_TRANSACTION\_THAW\_TIMEOUT</span></span>  
</dl>

<span data-ttu-id="ede12-110">Se o solicitante receber um desses códigos de erro, ele deverá repetir a criação da cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="ede12-110">If the requester receives one of these error codes, it must retry the shadow copy creation.</span></span>

<span data-ttu-id="ede12-111">As operações de registro e sistema de arquivos também podem ser transacionadas.</span><span class="sxs-lookup"><span data-stu-id="ede12-111">Registry and file system operations can also be transacted.</span></span> <span data-ttu-id="ede12-112">No caso do registro, o gravador do registro é responsável por garantir a consistência transacional.</span><span class="sxs-lookup"><span data-stu-id="ede12-112">In the case of the registry, the registry writer is responsible for ensuring transactional consistency.</span></span> <span data-ttu-id="ede12-113">No caso de operações do sistema de arquivos NTFS transacionais (TxF), o provedor do sistema é responsável por garantir a consistência transacional.</span><span class="sxs-lookup"><span data-stu-id="ede12-113">In the case of Transactional NTFS (TxF) file system operations, the system provider is responsible for ensuring transactional consistency.</span></span> <span data-ttu-id="ede12-114">Isso é feito com a montagem da cópia de sombra como leitura/gravação depois que ela é criada para permitir a recuperação automática.</span><span class="sxs-lookup"><span data-stu-id="ede12-114">This is accomplished by mounting the shadow copy as read/write after it is created to allow for auto-recovery.</span></span> <span data-ttu-id="ede12-115">Durante a fase de recuperação automática, o KTM reverte todas as transações incompletas.</span><span class="sxs-lookup"><span data-stu-id="ede12-115">During the auto-recovery phase, KTM rolls back any incomplete transactions.</span></span>

## <a name="identifying-and-creating-hard-links"></a><span data-ttu-id="ede12-116">Identificando e criando links físicos</span><span class="sxs-lookup"><span data-stu-id="ede12-116">Identifying and Creating Hard Links</span></span>

<span data-ttu-id="ede12-117">Ao fazer backup de arquivos, um aplicativo de backup deve identificar todos os links físicos de cada arquivo para evitar o backup do mesmo arquivo mais de uma vez.</span><span class="sxs-lookup"><span data-stu-id="ede12-117">When backing up files, a backup application must identify all hard links to each file to avoid backing up the same file more than once.</span></span> <span data-ttu-id="ede12-118">Duas novas funções estão disponíveis para enumerar links físicos: [**FindFirstFileNameW**](/windows/win32/api/fileapi/nf-fileapi-findfirstfilenamew) e [**FindNextFileNameW**](/windows/win32/api/fileapi/nf-fileapi-findnextfilenamew).</span><span class="sxs-lookup"><span data-stu-id="ede12-118">Two new functions are available for enumerating hard links: [**FindFirstFileNameW**](/windows/win32/api/fileapi/nf-fileapi-findfirstfilenamew) and [**FindNextFileNameW**](/windows/win32/api/fileapi/nf-fileapi-findnextfilenamew).</span></span>

<span data-ttu-id="ede12-119">Da mesma forma, ao restaurar arquivos, o aplicativo de backup deve restaurar links físicos usando a função [**CreateHardLink**](/windows/win32/api/winbase/nf-winbase-createhardlinka) .</span><span class="sxs-lookup"><span data-stu-id="ede12-119">Similarly, when restoring files, the backup application must restore hard links using the [**CreateHardLink**](/windows/win32/api/winbase/nf-winbase-createhardlinka) function.</span></span>

<span data-ttu-id="ede12-120">Os aplicativos de backup também devem declarar o \_ privilégio de nome de backup se \_ durante a fase de backup e o \_ nome de restauração se \_ durante a fase de restauração.</span><span class="sxs-lookup"><span data-stu-id="ede12-120">Backup applications must also assert the SE\_BACKUP\_NAME privilege during the backup phase and the SE\_RESTORE\_NAME during the restore phase.</span></span>

## <a name="permissions-and-privileges-required-by-backup-applications"></a><span data-ttu-id="ede12-121">Permissões e privilégios exigidos pelos aplicativos de backup</span><span class="sxs-lookup"><span data-stu-id="ede12-121">Permissions and Privileges Required by Backup Applications</span></span>

<span data-ttu-id="ede12-122">Os aplicativos de backup que restauram arquivos do sistema exigem os seguintes privilégios:</span><span class="sxs-lookup"><span data-stu-id="ede12-122">Backup applications that restore system files require the following privileges:</span></span>

<dl> <span data-ttu-id="ede12-123">\_nome do backup se \_</span><span class="sxs-lookup"><span data-stu-id="ede12-123">SE\_BACKUP\_NAME</span></span>  
<span data-ttu-id="ede12-124">\_nome de restauração do se \_</span><span class="sxs-lookup"><span data-stu-id="ede12-124">SE\_RESTORE\_NAME</span></span>  
<span data-ttu-id="ede12-125">\_nome de segurança se \_</span><span class="sxs-lookup"><span data-stu-id="ede12-125">SE\_SECURITY\_NAME</span></span>  
<span data-ttu-id="ede12-126">SE \_ obter \_ nome de propriedade \_</span><span class="sxs-lookup"><span data-stu-id="ede12-126">SE\_TAKE\_OWNERSHIP\_NAME</span></span>  
</dl>

<span data-ttu-id="ede12-127">Os aplicativos de backup também devem solicitar \_ direitos de acesso de proprietário de gravação durante a fase de restauração.</span><span class="sxs-lookup"><span data-stu-id="ede12-127">Backup applications must also request WRITE\_OWNER access rights during the restore phase.</span></span>

## <a name="windows-media-digital-rights-management"></a><span data-ttu-id="ede12-128">Rights Management digital do Windows Media</span><span class="sxs-lookup"><span data-stu-id="ede12-128">Windows Media Digital Rights Management</span></span>

<span data-ttu-id="ede12-129">O cliente Windows Media Digital Rights Management (DRM) mantém um diretório de arquivos de estado e licença confidenciais no diretório% ProgramData% \\ Microsoft \\ Windows \\ DRM.</span><span class="sxs-lookup"><span data-stu-id="ede12-129">Windows Media Digital Rights Management (DRM) client maintains a directory of sensitive state and license files in the %ProgramData%\\Microsoft\\Windows\\DRM directory.</span></span> <span data-ttu-id="ede12-130">Os arquivos nesse diretório devem ser limpos ao mesmo tempo que arquivos temporários e de cache.</span><span class="sxs-lookup"><span data-stu-id="ede12-130">The files in this directory should be purged at the same time as temporary and cache files.</span></span> <span data-ttu-id="ede12-131">Para garantir que o cliente DRM do Windows permaneça em um estado consistente, você deve evitar fazer backup ou restaurar esses arquivos.</span><span class="sxs-lookup"><span data-stu-id="ede12-131">To ensure that the Windows DRM client remains in a consistent state, you must avoid backing up or restoring these files.</span></span> <span data-ttu-id="ede12-132">Esse diretório está listado na chave do Registro FilesNotToBackup.</span><span class="sxs-lookup"><span data-stu-id="ede12-132">This directory is listed in the FilesNotToBackup registry key.</span></span> <span data-ttu-id="ede12-133">Para obter mais informações sobre a chave FilesNotToBackup, consulte [gerando um conjunto de backup](generating-a-backup-set.md).</span><span class="sxs-lookup"><span data-stu-id="ede12-133">For more information about the FilesNotToBackup key, see [Generating a Backup Set](generating-a-backup-set.md).</span></span>

## <a name="user-account-control"></a><span data-ttu-id="ede12-134">Controle de Conta de Usuário</span><span class="sxs-lookup"><span data-stu-id="ede12-134">User Account Control</span></span>

<span data-ttu-id="ede12-135">A introdução do UAC (controle de conta de usuário) no Windows Vista significa que, a menos que especificado de outra forma, os aplicativos devem ser executados em uma conta de usuário padrão.</span><span class="sxs-lookup"><span data-stu-id="ede12-135">The introduction of User Account Control (UAC) in Windows Vista means that unless specified otherwise, applications must run under a standard user account.</span></span> <span data-ttu-id="ede12-136">Além disso, o recurso de virtualização de arquivo e registro do UAC altera os locais onde os dados do usuário são armazenados.</span><span class="sxs-lookup"><span data-stu-id="ede12-136">Additionally, the file and registry virtualization feature of UAC alters the locations where user data is stored.</span></span> <span data-ttu-id="ede12-137">Para obter mais informações sobre como trabalhar com o UAC e a virtualização de arquivo e registro, consulte as seguintes referências:</span><span class="sxs-lookup"><span data-stu-id="ede12-137">For more information about how to work with UAC and file and registry virtualization, see the following references:</span></span>

<dl>

<span data-ttu-id="ede12-138">[A história do desenvolvedor do Windows Vista e do Windows Server 2008: requisitos de desenvolvimento de aplicativos do Windows Vista para UAC (controle de conta de usuário)](/previous-versions/aa905330(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="ede12-138">[The Windows Vista and Windows Server 2008 Developer Story: Windows Vista Application Development Requirements for User Account Control (UAC)](/previous-versions/aa905330(v=msdn.10))</span></span>  
<span data-ttu-id="ede12-139">[Requisitos de desenvolvimento de aplicativos do Windows Vista para compatibilidade de controle de conta de usuário](/previous-versions/dotnet/articles/bb530410(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="ede12-139">[Windows Vista Application Development Requirements for User Account Control Compatibility](/previous-versions/dotnet/articles/bb530410(v=msdn.10))</span></span>  
[<span data-ttu-id="ede12-140">Aplicação de patch de UAC (controle de conta de usuário)</span><span class="sxs-lookup"><span data-stu-id="ede12-140">User Account Control (UAC) Patching</span></span>](../msi/user-account-control--uac--patching.md)  
</dl>

## <a name="bitlocker-drive-encryption"></a><span data-ttu-id="ede12-141">Criptografia de Unidade de Disco BitLocker</span><span class="sxs-lookup"><span data-stu-id="ede12-141">BitLocker Drive Encryption</span></span>

<span data-ttu-id="ede12-142">Criptografia de Unidade de Disco BitLocker é um novo recurso do Windows Vista Enterprise, do Windows Vista Ultimate e do Windows Server 2008 que oferece inicialização segura e criptografia de volume completo.</span><span class="sxs-lookup"><span data-stu-id="ede12-142">BitLocker Drive Encryption is a new feature in Windows Vista Enterprise, Windows Vista Ultimate, and Windows Server 2008 that offers secure startup and full volume encryption.</span></span> <span data-ttu-id="ede12-143">Entender esse recurso é importante para desenvolvedores de aplicativos de backup que executam restaurações offline, onde os dados podem precisar ser restaurados em uma unidade criptografada.</span><span class="sxs-lookup"><span data-stu-id="ede12-143">Understanding this feature is important for developers of backup applications that perform offline restores where data may need to be restored onto an encrypted drive.</span></span>

<span data-ttu-id="ede12-144">Para restaurar dados em uma unidade criptografada, execute as seguintes etapas:</span><span class="sxs-lookup"><span data-stu-id="ede12-144">To restore data onto an encrypted drive, perform the following steps:</span></span>

1.  <span data-ttu-id="ede12-145">Desbloqueie a unidade.</span><span class="sxs-lookup"><span data-stu-id="ede12-145">Unlock the drive.</span></span>
2.  <span data-ttu-id="ede12-146">Desative Criptografia de Unidade de Disco BitLocker.</span><span class="sxs-lookup"><span data-stu-id="ede12-146">Turn off BitLocker Drive Encryption.</span></span>
3.  <span data-ttu-id="ede12-147">Execute a restauração.</span><span class="sxs-lookup"><span data-stu-id="ede12-147">Perform the restore.</span></span>
4.  <span data-ttu-id="ede12-148">Inicialize no sistema operacional restaurado e ative Criptografia de Unidade de Disco BitLocker.</span><span class="sxs-lookup"><span data-stu-id="ede12-148">Boot into the restored operating system and turn on BitLocker Drive Encryption.</span></span>

<span data-ttu-id="ede12-149">Para obter informações detalhadas sobre Criptografia de Unidade de Disco BitLocker, incluindo um guia passo a passo, consulte [criptografia de unidade de disco BitLocker](https://www.microsoft.com/technet/windowsvista/security/bitlockr.mspx) no site do Microsoft TechNet Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="ede12-149">For detailed information about BitLocker Drive Encryption, including a step-by-step guide, see [BitLocker Drive Encryption](https://www.microsoft.com/technet/windowsvista/security/bitlockr.mspx) on the Microsoft TechNet Windows Vista website.</span></span> <span data-ttu-id="ede12-150">Para obter informações sobre o provedor WMI Criptografia de Unidade de Disco BitLocker, consulte [criptografia de unidade de disco BitLocker Provider](../secprov/bitlocker-drive-encryption-provider.md).</span><span class="sxs-lookup"><span data-stu-id="ede12-150">For information about the BitLocker Drive Encryption WMI provider, see [BitLocker Drive Encryption Provider](../secprov/bitlocker-drive-encryption-provider.md).</span></span>

 

 
