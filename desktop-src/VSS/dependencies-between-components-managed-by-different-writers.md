---
description: Há situações em que os dados de um gravador dependem dos dados gerenciados por outro gravador. Nesses casos, você deve fazer backup ou restaurar dados de ambos os gravadores.
ms.assetid: 0413c289-74b7-4e83-a227-00bfb264e56e
title: Dependências entre componentes gerenciados por diferentes gravadores
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 91ba3be6a2c2f0a722c4c5f06ca95351e004e1cd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "104297503"
---
# <a name="dependencies-between-components-managed-by-different-writers"></a><span data-ttu-id="2bd26-104">Dependências entre componentes gerenciados por diferentes gravadores</span><span class="sxs-lookup"><span data-stu-id="2bd26-104">Dependencies between Components Managed by Different Writers</span></span>

<span data-ttu-id="2bd26-105">Há situações em que os dados de um gravador dependem dos dados gerenciados por outro gravador.</span><span class="sxs-lookup"><span data-stu-id="2bd26-105">There are situations where data from one writer depends on data managed by another writer.</span></span> <span data-ttu-id="2bd26-106">Nesses casos, você deve fazer backup ou restaurar dados de ambos os gravadores.</span><span class="sxs-lookup"><span data-stu-id="2bd26-106">In these cases, you should back up or restore data from both writers.</span></span>

<span data-ttu-id="2bd26-107">O VSS lida com esse problema por meio da noção de uma dependência de componente de gravador explícita e da interface [**IVssWMDependency**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmdependency) .</span><span class="sxs-lookup"><span data-stu-id="2bd26-107">VSS handles this problem through the notion of an explicit writer-component dependency and the [**IVssWMDependency**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmdependency) interface.</span></span>

<span data-ttu-id="2bd26-108">Um gravador adiciona uma ou mais dependências ao criar o documento de metadados do gravador usando o método [**IVssCreateWriterMetadata:: AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) .</span><span class="sxs-lookup"><span data-stu-id="2bd26-108">A writer adds one or more dependencies while creating the Writer Metadata Document using the [**IVssCreateWriterMetadata::AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) method.</span></span> <span data-ttu-id="2bd26-109">O gravador passa o método, o nome e o caminho lógico do componente dependente (que ele gerencia), bem como o nome e o caminho lógico e a [*ID da classe do gravador*](vssgloss-w.md) (o GUID que identifica a classe) do componente sobre o qual ele depende.</span><span class="sxs-lookup"><span data-stu-id="2bd26-109">The writer passes the method the name and logical path of the dependent component (which it manages), as well as the name and logical path and the [*writer class ID*](vssgloss-w.md) (the GUID identifying the class) of the component upon which it depends.</span></span>

<span data-ttu-id="2bd26-110">Depois de estabelecida, essa dependência informa ao solicitante que, durante qualquer operação de backup ou restauração, o componente dependente e os destinos de suas dependências devem participar.</span><span class="sxs-lookup"><span data-stu-id="2bd26-110">Once established, this dependency informs the requester that during any backup or restore operation both the dependent component and the targets of its dependencies must participate.</span></span>

<span data-ttu-id="2bd26-111">Um determinado componente pode ter várias dependências, o que exige que ele e todos os seus destinos dependentes participem do backup e da restauração juntos.</span><span class="sxs-lookup"><span data-stu-id="2bd26-111">A given component can have multiple dependencies, which requires that it and all its dependent targets participate in the backup and restore together.</span></span>

<span data-ttu-id="2bd26-112">O componente dependente e/ou os destinos de suas dependências podem ser incluídos de forma [*explícita*](vssgloss-e.md) ou [*implícita*](vssgloss-i.md) em operações de backup ou restauração.</span><span class="sxs-lookup"><span data-stu-id="2bd26-112">The dependent component and/or the target(s) of its dependencies can be included either [*explicitly*](vssgloss-e.md) or [*implicitly*](vssgloss-i.md) in a backup or restore operations.</span></span>

<span data-ttu-id="2bd26-113">O mecanismo de dependência do componente de gravador explícito não deve ser usado para criar uma dependência entre dois componentes no mesmo gravador.</span><span class="sxs-lookup"><span data-stu-id="2bd26-113">The explicit writer component dependency mechanism should not be used to create a dependency between two components on the same writer.</span></span> <span data-ttu-id="2bd26-114">As regras de seleção podem fornecer a mesma funcionalidade com mais eficiência, sem risco de dependências circulares.</span><span class="sxs-lookup"><span data-stu-id="2bd26-114">The selection rules can supply the same functionality more efficiently without risk of circular dependencies.</span></span>

<span data-ttu-id="2bd26-115">Por exemplo, [**IVssCreateWriterMetadata:: AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) poderia ser usado para definir a dependência do componente writerData (com o caminho lógico "") do gravador myWriter no componente internetData (com um caminho lógico de "conexões") de um gravador chamado InternetConnector com uma ID de classe de gravador X. (embora seja possível que vários gravadores com a mesma ID de classe estejam no sistema simultaneamente, a confusão será evitada porque a combinação de caminho lógico e nome do componente é exclusiva no sistema em VSS.)</span><span class="sxs-lookup"><span data-stu-id="2bd26-115">As an example, [**IVssCreateWriterMetadata::AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) could be used to define the dependency of the component writerData (with logical path "") of the writer MyWriter on component internetData (with a logical path of "Connections") of a writer named InternetConnector with a writer Class ID X. (While it is possible for multiple writers with the same class ID to be on the system simultaneously, confusion will be avoided because the combination of logical path and component name is unique on the system under VSS.)</span></span>

<span data-ttu-id="2bd26-116">Um gravador adiciona várias dependências a um determinado componente simplesmente chamando [**IVssCreateWriterMetadata:: AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) repetido com componentes diferentes de diferentes gravadores.</span><span class="sxs-lookup"><span data-stu-id="2bd26-116">A writer adds multiple dependencies to a given component simply by calling [**IVssCreateWriterMetadata::AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) repeated with different components from different writers.</span></span> <span data-ttu-id="2bd26-117">O número de outros componentes dos quais um determinado componente depende pode ser encontrado examinando o membro **cDependencies** da [**estrutura \_ COMPONENTINFO do VSS**](/windows/desktop/api/VsBackup/ns-vsbackup-vss_componentinfo) .</span><span class="sxs-lookup"><span data-stu-id="2bd26-117">The number of other components a given component depends on can be found by examining the **cDependencies** member of the [**VSS\_COMPONENTINFO**](/windows/desktop/api/VsBackup/ns-vsbackup-vss_componentinfo) structure.</span></span>

<span data-ttu-id="2bd26-118">Um gravador ou solicitante recupera instâncias da interface [**IVssWMDependency**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmdependency) com [**IVssWMComponent:: getdependency**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdependency).</span><span class="sxs-lookup"><span data-stu-id="2bd26-118">A writer or requester retrieves instances of the [**IVssWMDependency**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmdependency) interface with [**IVssWMComponent::GetDependency**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdependency).</span></span> <span data-ttu-id="2bd26-119">O **IVssWMDependency** retorna o nome do componente, o caminho lógico e a ID de classe do gravador que gerencia o componente que é o destino da dependência.</span><span class="sxs-lookup"><span data-stu-id="2bd26-119">The **IVssWMDependency** returns the component name, logical path, and class ID of the writer managing the component that is the target of the dependency.</span></span>

<span data-ttu-id="2bd26-120">O mecanismo de dependência não prescreve nenhuma ordem de preferência específica entre o componente dependente e os destinos de suas dependências.</span><span class="sxs-lookup"><span data-stu-id="2bd26-120">The dependency mechanism does not prescribe any particular order of preference between the dependent component and the targets of its dependencies.</span></span> <span data-ttu-id="2bd26-121">Conforme observado acima, toda a dependência indica que, sempre que um determinado componente é submetido a backup ou restauração, o componente ou os componentes dos quais ele depende também devem ser armazenados em backup ou restaurado.</span><span class="sxs-lookup"><span data-stu-id="2bd26-121">As noted above, all a dependency indicates is that whenever a given component is either backed up or restored, the component or components it depends on must be backed up or restored as well.</span></span> <span data-ttu-id="2bd26-122">A implementação exata da dependência é a critério do aplicativo de backup.</span><span class="sxs-lookup"><span data-stu-id="2bd26-122">The exact implementation of dependency is at the discretion of the backup application.</span></span>

<span data-ttu-id="2bd26-123">Por exemplo, no caso acima, o componente writerData (caminho lógico "") depende do componente InternetConnector ("conexões" do caminho lógico).</span><span class="sxs-lookup"><span data-stu-id="2bd26-123">For example, in the case above, the component writerData (logical path "") depends on component InternetConnector (logical path "Connections").</span></span> <span data-ttu-id="2bd26-124">Um solicitante é gratuito para interpretar isso de uma das seguintes maneiras:</span><span class="sxs-lookup"><span data-stu-id="2bd26-124">A requester is free to interpret this in either of the following ways:</span></span>

-   <span data-ttu-id="2bd26-125">Se o componente dependente, writerData, for selecionado (implicitamente ou explicitamente) para backup ou restauração, o solicitante deverá selecionar (implicitamente ou explicitamente) o destino de sua dependência, internetData</span><span class="sxs-lookup"><span data-stu-id="2bd26-125">If the dependent component, writerData, is selected (implicitly or explicitly) for backup or restore, the requester must select (either implicitly or explicitly) the target of its dependency, internetData</span></span>
-   <span data-ttu-id="2bd26-126">Se o destino de sua dependência, internetData, não for selecionado para backup, o componente dependente, writerData, não deverá ser selecionado.</span><span class="sxs-lookup"><span data-stu-id="2bd26-126">If the target of its dependency, internetData, is not selected for backup, then the dependent component, writerData, should not be selected.</span></span>

<span data-ttu-id="2bd26-127">No entanto, ao desenvolver suporte para dependências, os desenvolvedores de solicitantes devem estar cientes de que não há como um gravador pode determinar se um de seus componentes é um destino de uma dependência.</span><span class="sxs-lookup"><span data-stu-id="2bd26-127">However, when developing support for dependencies, requester developers should be aware that there is no way a writer can determine if one of its components is a target of a dependency.</span></span>

## <a name="declaring-remote-dependencies"></a><span data-ttu-id="2bd26-128">Declarando dependências remotas</span><span class="sxs-lookup"><span data-stu-id="2bd26-128">Declaring Remote Dependencies</span></span>

<span data-ttu-id="2bd26-129">Um aplicativo distribuído é um aplicativo que pode ser configurado para usar um ou mais computadores de cada vez.</span><span class="sxs-lookup"><span data-stu-id="2bd26-129">A distributed application is an application that can be configured to use one or more computers at a time.</span></span> <span data-ttu-id="2bd26-130">Normalmente, o aplicativo é executado em um ou mais computadores do servidor de aplicativos e se comunica com (mas pode ou não ser executado de fato em) um ou mais computadores do servidor de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="2bd26-130">Typically the application runs on one or more application server computers and communicates with (but may or may not actually run on) one or more database server computers.</span></span> <span data-ttu-id="2bd26-131">Essa configuração às vezes é chamada de implantação de vários sistemas.</span><span class="sxs-lookup"><span data-stu-id="2bd26-131">This configuration is sometimes referred to as a multi-system deployment.</span></span> <span data-ttu-id="2bd26-132">Geralmente, o mesmo aplicativo também pode ser configurado para ser executado em um único computador que executa um servidor de aplicativos e um servidor de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="2bd26-132">Often the same application can also be configured to run on a single computer that runs both an application server and a database server.</span></span> <span data-ttu-id="2bd26-133">Essa configuração é chamada de implantação de sistema único.</span><span class="sxs-lookup"><span data-stu-id="2bd26-133">Such a configuration is called a single-system deployment.</span></span> <span data-ttu-id="2bd26-134">Em ambas as configurações, o servidor de aplicativos e o servidor de banco de dados têm seus próprios gravadores VSS independentes.</span><span class="sxs-lookup"><span data-stu-id="2bd26-134">In both configurations, the application server and database server each have their own independent VSS writers.</span></span>

<span data-ttu-id="2bd26-135">Em uma implantação de vários sistemas, se um componente gerenciado pelo gravador do aplicativo depender de um componente remoto gerenciado pelo gravador do servidor de banco de dados, isso será chamado de dependência remota.</span><span class="sxs-lookup"><span data-stu-id="2bd26-135">In a multi-system deployment, if a component managed by the application's writer depends on a remote component managed by the database server's writer, this is called a remote dependency.</span></span> <span data-ttu-id="2bd26-136">(Uma implantação de sistema único, por outro lado, tem apenas dependências locais.)</span><span class="sxs-lookup"><span data-stu-id="2bd26-136">(A single-system deployment, in contrast, has only local dependencies.)</span></span>

<span data-ttu-id="2bd26-137">Como exemplo de uma implantação de vários sistemas, considere um servidor de aplicativos que usa um servidor de banco de dados SQL Server como um armazenamento de dados.</span><span class="sxs-lookup"><span data-stu-id="2bd26-137">As an example of a multi-system deployment, consider an application server that uses a SQL Server database server as a data store.</span></span> <span data-ttu-id="2bd26-138">Os dados específicos do aplicativo, que incluem as Web Parts, os arquivos de conteúdo da Web e a metabase do IIS, residem em um ou mais computadores, chamados de servidores Web front-end.</span><span class="sxs-lookup"><span data-stu-id="2bd26-138">The application-specific data, which includes the web parts, web content files, and the IIS metabase, resides on one or more computers, called front-end web servers.</span></span> <span data-ttu-id="2bd26-139">O armazenamento de dados SQL real, que inclui o banco de dado config e vários bancos de dados de conteúdo, reside em um ou mais computadores, chamados de servidores de banco de dados back-end.</span><span class="sxs-lookup"><span data-stu-id="2bd26-139">The actual SQL data store, which includes the Config database and multiple Content databases, resides on one or more other computers, called back-end database servers.</span></span> <span data-ttu-id="2bd26-140">Cada um dos servidores Web front-end contém o mesmo conteúdo e configuração específicos do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2bd26-140">Each of the front-end web servers contains the same application-specific content and configuration.</span></span> <span data-ttu-id="2bd26-141">Cada um dos servidores de banco de dados back-end pode hospedar qualquer um dos bancos de dados de conteúdo ou de configuração.</span><span class="sxs-lookup"><span data-stu-id="2bd26-141">Each of the back-end database servers can host any of the Content databases or the Config database.</span></span> <span data-ttu-id="2bd26-142">O software de aplicativo é executado somente nos servidores Web front-end, não nos servidores de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="2bd26-142">The application software runs only on the front-end web servers, not on the database servers.</span></span> <span data-ttu-id="2bd26-143">Nessa configuração, o gravador VSS do aplicativo tem dependências remotas nos componentes gerenciados pelo gravador do SQL.</span><span class="sxs-lookup"><span data-stu-id="2bd26-143">In this configuration, the application's VSS writer has remote dependencies on the components managed by the SQL writer.</span></span>

<span data-ttu-id="2bd26-144">Um gravador pode declarar uma dependência remota chamando o método [**AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) , predependendo de " \\ \\ *RemoteComputerName* \\ ", em que *RemoteComputerName* é o nome do computador onde reside o componente remoto, no caminho lógico no parâmetro *wszOnLogicalPath* .</span><span class="sxs-lookup"><span data-stu-id="2bd26-144">A writer can declare a remote dependency by calling the [**AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency) method, prepending "\\\\*RemoteComputerName*\\", where *RemoteComputerName* is the name of the computer where the remote component resides, to the logical path in the *wszOnLogicalPath* parameter.</span></span> <span data-ttu-id="2bd26-145">O valor de *RemoteComputerName* pode ser um endereço IP ou um nome de computador retornado pela função [**GetComputerNameEx devia**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getcomputernameexa) .</span><span class="sxs-lookup"><span data-stu-id="2bd26-145">The value of *RemoteComputerName* can be an IP address or a computer name returned by the [**GetComputerNameEx**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getcomputernameexa) function.</span></span>

<span data-ttu-id="2bd26-146">**Windows Server 2003:** Um gravador não pode declarar dependências remotas até o Windows Server 2003 com Service Pack 1 (SP1).</span><span class="sxs-lookup"><span data-stu-id="2bd26-146">**Windows Server 2003:** A writer cannot declare remote dependencies until Windows Server 2003 with Service Pack 1 (SP1).</span></span>

<span data-ttu-id="2bd26-147">Para identificar uma dependência, um solicitante chama os métodos [**Getwriterid**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmdependency-getwriterid), [**GetLogicalPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getlogicalpath)e [**GetComponentName**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmdependency-getcomponentname) da interface [**IVssWMDependency**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmdependency) .</span><span class="sxs-lookup"><span data-stu-id="2bd26-147">To identify a dependency, a requester calls the [**GetWriterId**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmdependency-getwriterid), [**GetLogicalPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getlogicalpath), and [**GetComponentName**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmdependency-getcomponentname) methods of the [**IVssWMDependency**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmdependency) interface.</span></span> <span data-ttu-id="2bd26-148">O solicitante deve examinar o nome do componente que **GetComponentName** retorna no parâmetro *pbstrComponentName* .</span><span class="sxs-lookup"><span data-stu-id="2bd26-148">The requester must examine the component name that **GetComponentName** returns in the *pbstrComponentName* parameter.</span></span> <span data-ttu-id="2bd26-149">Se o nome do componente começar com " \\ \\ ", o solicitante deverá presumir que ele especifica uma dependência remota e que o primeiro componente após " \\ \\ " é o *RemoteComputerName* que foi especificado quando o gravador chamou [**AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency).</span><span class="sxs-lookup"><span data-stu-id="2bd26-149">If the component name begins with "\\\\", the requester must assume that it specifies a remote dependency and that the first component following "\\\\" is the *RemoteComputerName* that was specified when the writer called [**AddComponentDependency**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponentdependency).</span></span> <span data-ttu-id="2bd26-150">Se o nome do componente não começar com " \\ \\ ", o solicitante deve assumir que ele especifica uma dependência local.</span><span class="sxs-lookup"><span data-stu-id="2bd26-150">If the component name does not begin with "\\\\", the requester should assume that it specifies a local dependency.</span></span>

<span data-ttu-id="2bd26-151">Se houver uma dependência remota, o solicitante deverá fazer backup do componente remoto quando fizer backup do componente local.</span><span class="sxs-lookup"><span data-stu-id="2bd26-151">If there is a remote dependency, the requester must back up the remote component when it backs up the local component.</span></span> <span data-ttu-id="2bd26-152">Para fazer backup do componente remoto, o solicitante deve ter um agente no computador remoto e deve iniciar o backup no computador remoto.</span><span class="sxs-lookup"><span data-stu-id="2bd26-152">To back up the remote component, the requester should have an agent on the remote computer and should initiate the backup on the remote computer.</span></span>

## <a name="structuring-remote-dependencies"></a><span data-ttu-id="2bd26-153">Estruturando dependências remotas</span><span class="sxs-lookup"><span data-stu-id="2bd26-153">Structuring Remote Dependencies</span></span>

<span data-ttu-id="2bd26-154">É importante entender que uma dependência não é um componente por si só.</span><span class="sxs-lookup"><span data-stu-id="2bd26-154">It is important to understand that a dependency is not a component in and of itself.</span></span> <span data-ttu-id="2bd26-155">Um componente é necessário para manter a dependência.</span><span class="sxs-lookup"><span data-stu-id="2bd26-155">A component is necessary to hold the dependency.</span></span>

<span data-ttu-id="2bd26-156">Os exemplos a seguir mostram duas maneiras de estruturar um conjunto de dependências.</span><span class="sxs-lookup"><span data-stu-id="2bd26-156">The following examples show two ways to structure a set of dependencies.</span></span>

``` syntax
Example 1:
    Writer 1
        Component A
            File A
            File B
            Dependency (SQL/MSDE Writer, Component X, "\")
            Dependency (SQL/MSDE Writer, Component Y, "\")

Example 2:
    Writer 2
        Component A
            File A
            File B
        Component B
            Dependency (SQL/MSDE Writer, Component X, "\")
            Dependency (SQL/MSDE Writer, Component Y, "\")
```

<span data-ttu-id="2bd26-157">No exemplo 1, as dependências são mantidas pelo componente A. Como somente os componentes podem ser selecionados, não arquivos individuais, estruturar dependências do componente A dessa maneira exigiria que todo o componente, tanto os arquivos quanto as dependências, sempre deva ser submetido a backup e restaurado juntos.</span><span class="sxs-lookup"><span data-stu-id="2bd26-157">In example 1, the dependencies are held by Component A. Because only components can be selected, not individual files, structuring Component A's dependencies this way would require that the entire component, both the files and the dependencies, must always be backed up and restored together.</span></span> <span data-ttu-id="2bd26-158">Eles não podem ser armazenados em backup ou restaurados individualmente.</span><span class="sxs-lookup"><span data-stu-id="2bd26-158">They cannot be backed up or restored individually.</span></span>

<span data-ttu-id="2bd26-159">No exemplo 2, componentes separados (componentes A e B) mantêm cada uma das dependências.</span><span class="sxs-lookup"><span data-stu-id="2bd26-159">In example 2, separate components (Components A and B) hold each of the dependencies.</span></span> <span data-ttu-id="2bd26-160">Nesse caso, os dois componentes podem ser selecionados de forma independente e, portanto, são armazenados em backup e restaurados de forma independente.</span><span class="sxs-lookup"><span data-stu-id="2bd26-160">In this case, the two components can be selected independently, and therefore backed up and restored independently.</span></span> <span data-ttu-id="2bd26-161">Estruturar as dependências dessa maneira dá a um aplicativo distribuído muito mais flexibilidade no gerenciamento de suas dependências remotas.</span><span class="sxs-lookup"><span data-stu-id="2bd26-161">Structuring the dependencies this way gives a distributed application much more flexibility in managing its remote dependencies.</span></span>

## <a name="supporting-remote-dependencies"></a><span data-ttu-id="2bd26-162">Suporte a dependências remotas</span><span class="sxs-lookup"><span data-stu-id="2bd26-162">Supporting Remote Dependencies</span></span>

<span data-ttu-id="2bd26-163">Um solicitante pode fornecer suporte total ou parcial para dependências remotas.</span><span class="sxs-lookup"><span data-stu-id="2bd26-163">A requester can provide full or partial support for remote dependencies.</span></span>

<span data-ttu-id="2bd26-164">Para fornecer suporte completo, o solicitante deve fazer o seguinte no momento do backup e da restauração.</span><span class="sxs-lookup"><span data-stu-id="2bd26-164">To provide full support, the requester should do the following at backup and restore time.</span></span>

<span data-ttu-id="2bd26-165">No momento do backup, o solicitante deve iniciar o backup no computador front-end (local), determinar as dependências que existem e spoolar trabalhos de backup adicionais para capturar os bancos de dados de back-end.</span><span class="sxs-lookup"><span data-stu-id="2bd26-165">At backup time, the requester must start the backup on the front-end (local) computer, determine the dependencies that exist, and spool additional backup jobs to capture the back-end databases.</span></span> <span data-ttu-id="2bd26-166">O solicitante deve aguardar até que os trabalhos de backup de back-end no computador remoto sejam concluídos antes de chamar os métodos [**IVssBackupComponents:: SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded) e [**IVssBackupComponents:: BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) .</span><span class="sxs-lookup"><span data-stu-id="2bd26-166">The requester must wait until after the back-end backup jobs on the remote computer have completed before calling the [**IVssBackupComponents::SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded) and [**IVssBackupComponents::BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) methods.</span></span> <span data-ttu-id="2bd26-167">Se o solicitante aguardar até que o backup de componentes de back-end seja concluído antes de chamar **BackupComplete**, isso produzirá um backup mais facilmente recuperável para um gravador que implementa aprimoramentos adicionais, como o bloqueio de topologia, por exemplo, durante o backup.</span><span class="sxs-lookup"><span data-stu-id="2bd26-167">If the requester waits until the backup of back-end components is complete before calling **BackupComplete**, this will produce a more easily recoverable backup for a writer that implements additional enhancements—such as topology locking, for example—during the backup.</span></span> <span data-ttu-id="2bd26-168">O procedimento a seguir descreve o que o solicitante deve fazer:</span><span class="sxs-lookup"><span data-stu-id="2bd26-168">The following procedure outlines what the requester should do:</span></span>

1.  <span data-ttu-id="2bd26-169">No computador local, o solicitante chama os métodos [**IVssBackupComponents:: InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup), [**IVssBackupComponents:: GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), [**IVssBackupComponents::P Repareforbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup)e [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) .</span><span class="sxs-lookup"><span data-stu-id="2bd26-169">On the local computer, the requester calls the [**IVssBackupComponents::InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup), [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), and [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) methods.</span></span>
2.  <span data-ttu-id="2bd26-170">Após a conclusão da cópia de sombra local, mas antes de o backup ser concluído, o solicitante coloca em spool os trabalhos de backup adicionais enviando uma solicitação para seu agente no computador remoto.</span><span class="sxs-lookup"><span data-stu-id="2bd26-170">After the local shadow copy is completed, but before the backup is completed, the requester spools additional backup jobs by sending a request to its agent on the remote computer.</span></span>
3.  <span data-ttu-id="2bd26-171">No computador remoto, o agente do solicitante executa a sequência de backup em spool chamando [**InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup), [**GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), [**DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset), [**SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded)e [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete).</span><span class="sxs-lookup"><span data-stu-id="2bd26-171">On the remote computer, the requester's agent performs the spooled backup sequence by calling [**InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup), [**GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), [**DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset), [**SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded), and [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete).</span></span>
4.  <span data-ttu-id="2bd26-172">Quando o agente do solicitante tiver concluído os trabalhos em spool no computador remoto, o solicitante concluirá a sequência de backup chamando [**SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded) e [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete).</span><span class="sxs-lookup"><span data-stu-id="2bd26-172">When the requester's agent has completed the spooled jobs on the remote computer, the requester completes the backup sequence by calling [**SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded) and [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete).</span></span>

<span data-ttu-id="2bd26-173">No momento da restauração, o solicitante deve iniciar a restauração que envolve o computador front-end (local), selecionar os componentes e suas dependências a serem restaurados e, em seguida, enviar o evento de [**Prerestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) chamando o método **rerestore IVssBackupComponents::P** .</span><span class="sxs-lookup"><span data-stu-id="2bd26-173">At restore time, the requester must start the restore involving the front-end (local) computer, select the components and their dependencies to be restored, and then send the [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) event by calling the **IVssBackupComponents::PreRestore** method.</span></span> <span data-ttu-id="2bd26-174">O solicitante deve então armazenar em spool os trabalhos de restauração de back-end no computador remoto e chamar o método [**IVssBackupComponents::P ostrestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) quando as restaurações de back-end forem concluídas.</span><span class="sxs-lookup"><span data-stu-id="2bd26-174">The requester should then spool the back-end restore jobs on the remote computer and call the [**IVssBackupComponents::PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) method when the back-end restores are complete.</span></span> <span data-ttu-id="2bd26-175">Esse requisito fornece ao gravador de front-end mais controle sobre a experiência de restauração e uma melhor experiência de usuário de administrador geral.</span><span class="sxs-lookup"><span data-stu-id="2bd26-175">This requirement gives the front-end writer more control over the restore experience and a better administrator user experience overall.</span></span> <span data-ttu-id="2bd26-176">Como os backups em cada um dos sistemas não ocorrem no mesmo ponto no tempo, o gravador de front-end precisará executar alguma limpeza dos dados de back-end.</span><span class="sxs-lookup"><span data-stu-id="2bd26-176">Because the backups across each of the systems do not occur at the same point in time, the front-end writer will need to perform some cleanup of the back-end data.</span></span> <span data-ttu-id="2bd26-177">No aplicativo de exemplo discutido no "declarando dependências remotas" anteriores, o gravador deve iniciar um remapeamento ou reindexação do site após a conclusão de uma restauração de um dos bancos de dados back-end.</span><span class="sxs-lookup"><span data-stu-id="2bd26-177">In the example application discussed in the preceding "Declaring Remote Dependencies", the writer should initiate a site remapping or reindexing after a restore of one of the back-end databases has completed.</span></span> <span data-ttu-id="2bd26-178">Para fazer isso, o gravador deve receber eventos no servidor front-end.</span><span class="sxs-lookup"><span data-stu-id="2bd26-178">To do this, the writer must receive events on the front-end server.</span></span> <span data-ttu-id="2bd26-179">O procedimento a seguir descreve o que o solicitante deve fazer:</span><span class="sxs-lookup"><span data-stu-id="2bd26-179">The following procedure outlines what the requester should do:</span></span>

1.  <span data-ttu-id="2bd26-180">No computador local, o solicitante chama [**IVssBackupComponents:: InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore), [**GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), [**IVssBackupComponents:: SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) (ou [**IVssBackupComponentsEx:: SetSelectedForRestoreEx**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex-setselectedforrestoreex)) e [**prerestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore).</span><span class="sxs-lookup"><span data-stu-id="2bd26-180">On the local computer, the requester calls [**IVssBackupComponents::InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore), [**GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), [**IVssBackupComponents::SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) (or [**IVssBackupComponentsEx::SetSelectedForRestoreEx**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex-setselectedforrestoreex)), and [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore).</span></span>
2.  <span data-ttu-id="2bd26-181">Após a fase de [**Prerestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) ser concluída, mas antes do início da fase de [**pós-restauração**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) , o solicitante armazena em spool os trabalhos de restauração adicionais enviando uma solicitação para seu agente no computador remoto.</span><span class="sxs-lookup"><span data-stu-id="2bd26-181">After the [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) phase is completed, but before the [**PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) phase begins, the requester spools additional restore jobs by sending a request to its agent on the remote computer.</span></span>
3.  <span data-ttu-id="2bd26-182">No computador remoto, o agente do solicitante executa os trabalhos de restauração em spool chamando [**InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore), [**GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), [**SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore), [**prerestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore), [**SetFileRestoreStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setfilerestorestatus) (ou [**SetSelectedForRestoreEx**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex-setselectedforrestoreex)) e [**createrestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore).</span><span class="sxs-lookup"><span data-stu-id="2bd26-182">On the remote computer, the requester's agent performs the spooled restore jobs by calling [**InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore), [**GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), [**SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore), [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore), [**SetFileRestoreStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setfilerestorestatus) (or [**SetSelectedForRestoreEx**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex-setselectedforrestoreex)), and [**PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore).</span></span>
4.  <span data-ttu-id="2bd26-183">Quando o agente do solicitante tiver concluído os trabalhos em spool no computador remoto, o solicitante concluirá a sequência de restauração chamando [**IVssBackupComponents:: SetFileRestoreStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setfilerestorestatus) e [**createrestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore).</span><span class="sxs-lookup"><span data-stu-id="2bd26-183">When the requester's agent has completed the spooled jobs on the remote computer, the requester completes the restore sequence by calling [**IVssBackupComponents::SetFileRestoreStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setfilerestorestatus) and [**PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore).</span></span>

<span data-ttu-id="2bd26-184">Para fornecer suporte parcial para dependências remotas, o solicitante deve seguir as dependências remotas e incluí-las como parte do backup, mas a ordenação de eventos em sistemas de front-end e back-end, conforme detalhado nos dois procedimentos anteriores, não seria necessária.</span><span class="sxs-lookup"><span data-stu-id="2bd26-184">To provide partial support for remote dependencies, the requester must follow remote dependencies and include them as part of the backup, but the ordering of events on front-end and back-end systems as detailed in the previous two procedures would not be required.</span></span> <span data-ttu-id="2bd26-185">Para um solicitante que implementa apenas suporte parcial, o solicitante deve consultar a documentação de backup/restauração do aplicativo gravador para entender quais cenários podem ser suportados.</span><span class="sxs-lookup"><span data-stu-id="2bd26-185">For a requester that implements only partial support, the requester should refer to the writer application's backup/restore documentation to understand what scenarios can be supported.</span></span>

 

 
