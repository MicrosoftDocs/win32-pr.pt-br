---
description: O mecanismo direcionado de destino permite que os gravadores remapeiem arquivos no momento da restauração.
ms.assetid: c0b4ab26-2bb6-4b0f-b837-01057983b49b
title: Trabalhando com destinos direcionados
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8bd2e15ec873b87030a2d01be69d2c3e5f95a193
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104010504"
---
# <a name="working-with-directed-targets"></a><span data-ttu-id="dbf36-103">Trabalhando com destinos direcionados</span><span class="sxs-lookup"><span data-stu-id="dbf36-103">Working with Directed Targets</span></span>

<span data-ttu-id="dbf36-104">O mecanismo [*direcionado de destino*](vssgloss-d.md) permite que os gravadores remapeiem arquivos no momento da restauração.</span><span class="sxs-lookup"><span data-stu-id="dbf36-104">The [*directed target*](vssgloss-d.md) mechanism allows writers to remap files at restore time.</span></span> <span data-ttu-id="dbf36-105">Isso permite que os gravadores façam o seguinte:</span><span class="sxs-lookup"><span data-stu-id="dbf36-105">This allows writers to do the following:</span></span>

-   <span data-ttu-id="dbf36-106">Especifique novos locais de destino (análogo ao [**IVssBackupComponents:: AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget)) de um solicitante.</span><span class="sxs-lookup"><span data-stu-id="dbf36-106">Specify new target locations (analogous to a requester's [**IVssBackupComponents::AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget)).</span></span>
-   <span data-ttu-id="dbf36-107">Recupere espaço em disco restaurando apenas as partes necessárias de um arquivo para o disco, especialmente quando foi feito o backup de um arquivo usando o mecanismo de [*arquivo parcial*](vssgloss-p.md) .</span><span class="sxs-lookup"><span data-stu-id="dbf36-107">Reclaim disk space by restoring only needed parts of a file to disk, particularly when a file was backed up using the [*partial file*](vssgloss-p.md) mechanism.</span></span>
-   <span data-ttu-id="dbf36-108">Altere o formato de arquivo para atender às necessidades atuais.</span><span class="sxs-lookup"><span data-stu-id="dbf36-108">Change the file format to meet current needs.</span></span>

<span data-ttu-id="dbf36-109">Qualquer arquivo a ser usado com uma operação direcionada de destino deve ter um [*destino de restauração*](vssgloss-r.md) do VSS \_ RT \_ direcionado.</span><span class="sxs-lookup"><span data-stu-id="dbf36-109">Any file to be used with a directed target operation must have a [*restore target*](vssgloss-r.md) of VSS\_RT\_DIRECTED.</span></span>

<span data-ttu-id="dbf36-110">Depois de estabelecer que um solicitante pode dar suporte a uma operação direcionada de destino, um gravador (ao manipular o evento de [**Prerestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) ) usa [**IVssComponent:: AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget) para a instância do [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) correspondente ao componente que gerencia o arquivo (ou o componente que define o conjunto de componentes que contém o arquivo) para definir como o arquivo deve ser remapeado na restauração.</span><span class="sxs-lookup"><span data-stu-id="dbf36-110">Once it has been established that a requester can support a directed target operation, a writer (while handling the [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) event) uses the [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget) for the instance of [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) corresponding to the component that manages the file (or the component that defines the component set that contains the file) to define how the file is to be remapped on restore.</span></span>

<span data-ttu-id="dbf36-111">Ao usar [**IVssComponent:: AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget), os gravadores especificam o nome do arquivo e o caminho usados para fazer backup do arquivo, o nome do arquivo e o caminho de seu destino de restauração (esses valores podem ser iguais aos do caminho e do nome do arquivo original) e os intervalos de arquivos de origem e de destino.</span><span class="sxs-lookup"><span data-stu-id="dbf36-111">In using [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget), writers specify the file name and path used to back up the file, the file name and path of its restore destination (these values can be the same as the original file name and path), and source and destination file ranges.</span></span>

<span data-ttu-id="dbf36-112">Assim como acontece com as operações de arquivo parcial, as listas de intervalos são pares de deslocamentos para o backup do arquivo (em bytes) e o comprimento da seção a ser restaurada (em bytes), o deslocamento e o comprimento que estão sendo separados por dois-pontos e cada par separado por uma vírgula: \*Offset1 \***:**_Length1_*_,_* \* Offset2 \***:**_Length2_.</span><span class="sxs-lookup"><span data-stu-id="dbf36-112">As with partial file operations, range lists are pairs of offsets into the file to be backed up (in bytes) and the length of the section to be restored (in bytes), the offset and length being separated by a colon, and each pair separated by a comma: *Offset1\***:**_Length1_*_,_\* \*Offset2\***:**_Length2_.</span></span> <span data-ttu-id="dbf36-113">Cada valor é um inteiro de 64 bits no formato hexadecimal ou Decimal.</span><span class="sxs-lookup"><span data-stu-id="dbf36-113">Each value is a 64-bit integer in either hexadecimal or decimal format.</span></span>

<span data-ttu-id="dbf36-114">Se um gravador precisar usar o mecanismo direcionado de destino para fazer com que o solicitante restaure um arquivo para um novo local, ele teria chamado [**IVssComponent:: AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget) com o nome e o caminho do arquivo original e o novo nome e caminho do arquivo e especifique os intervalos de destino de origem com um deslocamento zero e um comprimento igual ao de todo o tamanho do arquivo.</span><span class="sxs-lookup"><span data-stu-id="dbf36-114">If a writer needs to use the directed target mechanism to have the requester restore a file to a new location, it would have called [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget) with the original file name and path and the new file name and path, and specify source destination ranges with a zero offset and a length equal to that of the entire file size.</span></span>

<span data-ttu-id="dbf36-115">Por exemplo, se um gravador precisar ter um arquivo de 200 k, C: \\ WriterData \\ index. dat, restaurado como C: \\ WriterData \\ OldIndex. dat, a cadeia de caracteres de intervalo de origem e de destino seria "**0:204880**".</span><span class="sxs-lookup"><span data-stu-id="dbf36-115">For instance, if a writer needs to have a 200K file, C:\\WriterData\\Index.dat, restored as C:\\WriterData\\OldIndex.dat, the source and destination range string would be "**0:204880**."</span></span>

<span data-ttu-id="dbf36-116">Para remapear um arquivo de backup grande e parcialmente feito, o solicitante usará o intervalo de origem usado para fazer backup do arquivo e um intervalo de destino que reduzirá o tamanho do arquivo.</span><span class="sxs-lookup"><span data-stu-id="dbf36-116">To remap a large, partially backed-up file, the requester would use the source range used to back up the file and a destination range that will reduce the file size.</span></span> <span data-ttu-id="dbf36-117">As informações do intervalo de origem podem ser obtidas usando [**IVssComponent:: Getparcialfile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile) para a instância de [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) correspondente ao componente que gerencia o arquivo (ou o componente que define o conjunto de componentes que contém o arquivo).</span><span class="sxs-lookup"><span data-stu-id="dbf36-117">The source range information can be obtained by using [**IVssComponent::GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile) for the instance of [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) corresponding to the component that manages the file (or the component that defines the component set that contains the file).</span></span>

<span data-ttu-id="dbf36-118">Se o arquivo com backup parcial era inicialmente um arquivo grande cujo cabeçalho, bytes 64-512, contém uma contagem de registros e outras informações atualizadas com frequência e cujos dados mais recentes são encontrados nos últimos 65536 bytes do arquivo — bytes 0x1239E8577A a 0x1239E7577A, um gravador poderia especificar uma lista de intervalos de origem como a cadeia de caracteres "**64:448, 0x1239E8577A: 65536**."</span><span class="sxs-lookup"><span data-stu-id="dbf36-118">If the partially backed-up file was initially a large file whose header, bytes 64-512, contains a records count and other frequently updated information, and whose most recent data is to be found in the file's last 65536 bytes—bytes 0x1239E8577A to 0x1239E7577A, a writer could specify a source range list as the string "**64:448,0x1239E8577A:65536**."</span></span>

<span data-ttu-id="dbf36-119">Se o gravador quisesse remapear o arquivo restaurado para conter apenas o cabeçalho e os dados mais recentes, a lista de intervalos pode ser a cadeia de caracteres "**0:488488:65536**".</span><span class="sxs-lookup"><span data-stu-id="dbf36-119">If the writer wanted to remap the restored file to contain only the header and most recent data, the range list could be the string "**0:488,488:65536**."</span></span>

<span data-ttu-id="dbf36-120">Antes de realmente executar uma operação de restauração, um solicitante deve verificar se algum arquivo requer suporte direcionado a destino.</span><span class="sxs-lookup"><span data-stu-id="dbf36-120">Prior to actually performing a restore operation, a requester should check to see if any files require directed target support.</span></span>

<span data-ttu-id="dbf36-121">Para fazer isso, o solicitante primeiro itera sobre os gravadores com componentes armazenados em seu documento de componentes de backup usando [**IVssBackupComponents:: GetWriterComponentsCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponentscount) e [**IVssBackupComponents:: GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents).</span><span class="sxs-lookup"><span data-stu-id="dbf36-121">To do this, the requester first iterates over the writers with stored components in its Backup Components Document using [**IVssBackupComponents::GetWriterComponentsCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponentscount) and [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents).</span></span>

<span data-ttu-id="dbf36-122">Em seguida, a interface [**IVssBackupComponents:: GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents) é usada para retornar instâncias da interface [**IVssWriterComponentsExt**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) , que fornece os métodos [**IVssWriterComponentsExt:: GetComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponent) e [**IVssWriterComponentsExt:: GetComponentCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponentcount) que permitem que o solicitante obtenha as instâncias de [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) .</span><span class="sxs-lookup"><span data-stu-id="dbf36-122">The [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents) interface is then used to return instances of the [**IVssWriterComponentsExt**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) interface, which provides [**IVssWriterComponentsExt::GetComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponent) and [**IVssWriterComponentsExt::GetComponentCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponentcount) methods that allow the requester to obtain [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) instances.</span></span>

<span data-ttu-id="dbf36-123">Isso permite que um solicitante obtenha candidatos direcionados ao destino usando [**IVssComponent:: GetDirectedTargetCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtargetcount) e [**IVssComponent:: GetDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtarget) para a instância de [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) correspondente ao componente que gerencia o arquivo (ou o componente que define o conjunto de componentes que contém o arquivo).</span><span class="sxs-lookup"><span data-stu-id="dbf36-123">This allows a requester to obtain directed target candidates by using [**IVssComponent::GetDirectedTargetCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtargetcount) and [**IVssComponent::GetDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtarget) for the instance of [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) corresponding to the component that manages the file (or the component that defines the component set that contains the file).</span></span>

 

 
