---
description: 'Esse estágio do backup Inicializa o gravador e o solicitante, preenchendo suas estruturas de dados internas, especificando o backup e estabelece a comunicação do gravador/solicitante por meio da chamada necessária para IVssBackupComponents:: GatherWriterMetadata. Para obter mais informações, consulte Visão geral do processamento de um backup em VSS.'
ms.assetid: 1fc46062-c4a0-4aa2-ae05-3d7cded18584
title: Visão geral da inicialização do backup
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 53fb97b43cf19ca60e3e4601899700e35bdad3aa
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105784945"
---
# <a name="overview-of-backup-initialization"></a><span data-ttu-id="8f72d-104">Visão geral da inicialização do backup</span><span class="sxs-lookup"><span data-stu-id="8f72d-104">Overview of Backup Initialization</span></span>

<span data-ttu-id="8f72d-105">Esse estágio do backup Inicializa o gravador e o solicitante, preenchendo suas estruturas de dados internas, especificando o backup e estabelece a comunicação do gravador/solicitante por meio da chamada necessária para [**IVssBackupComponents:: GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span><span class="sxs-lookup"><span data-stu-id="8f72d-105">This stage of the backup initializes both the writer and the requester, filling in their internal data structures, specifying the backup and establishes writer/requester communication through the required call to [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span></span> <span data-ttu-id="8f72d-106">Para obter mais informações, consulte [visão geral do processamento de um backup em VSS](overview-of-processing-a-backup-under-vss.md).</span><span class="sxs-lookup"><span data-stu-id="8f72d-106">For more information, see [Overview of Processing a Backup Under VSS](overview-of-processing-a-backup-under-vss.md).</span></span>

<span data-ttu-id="8f72d-107">A tabela a seguir mostra a sequência de ações e eventos que são necessários para a inicialização do backup.</span><span class="sxs-lookup"><span data-stu-id="8f72d-107">The following table shows the sequence of actions and events that are required for backup initialization.</span></span>



| <span data-ttu-id="8f72d-108">Ação do solicitante</span><span class="sxs-lookup"><span data-stu-id="8f72d-108">Requester action</span></span>                                                                                                                                                                                                                                                                                                                            | <span data-ttu-id="8f72d-109">Evento</span><span class="sxs-lookup"><span data-stu-id="8f72d-109">Event</span></span>                                                     | <span data-ttu-id="8f72d-110">Ação do gravador</span><span class="sxs-lookup"><span data-stu-id="8f72d-110">Writer action</span></span>                                                                                                                                                                                                                                              |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="8f72d-111">Cria uma interface [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) e a inicializa para gerenciar um backup (consulte [**CreateVssBackupComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents), [**IVssBackupComponents:: InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup)) e, opcionalmente, habilitar ou desabilitar gravadores no sistema.</span><span class="sxs-lookup"><span data-stu-id="8f72d-111">Creates an [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface and initializes it to manage a backup (see [**CreateVssBackupComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents), [**IVssBackupComponents::InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup)) and optionally enable or disable writers on the system.</span></span> | <span data-ttu-id="8f72d-112">Nenhum</span><span class="sxs-lookup"><span data-stu-id="8f72d-112">None</span></span>                                                      | <span data-ttu-id="8f72d-113">Nenhum</span><span class="sxs-lookup"><span data-stu-id="8f72d-113">None</span></span>                                                                                                                                                                                                                                                       |
| <span data-ttu-id="8f72d-114">Opcionalmente, defina o contexto para operações de cópia de sombra e, opcionalmente, consulte o sistema sobre os provedores e as cópias de sombra com suporte (Confira [**IVssBackupComponents:: SetContext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext), [**IVssBackupComponents:: Query**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-query)).</span><span class="sxs-lookup"><span data-stu-id="8f72d-114">Optionally set the context for shadow copy operations and optionally query the system about the providers and shadow copies it supports (see [**IVssBackupComponents::SetContext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext), [**IVssBackupComponents::Query**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-query)).</span></span>                                               | <span data-ttu-id="8f72d-115">Nenhum</span><span class="sxs-lookup"><span data-stu-id="8f72d-115">None</span></span>                                                      | <span data-ttu-id="8f72d-116">Nenhum</span><span class="sxs-lookup"><span data-stu-id="8f72d-116">None</span></span>                                                                                                                                                                                                                                                       |
| <span data-ttu-id="8f72d-117">O solicitante pode fornecer informações adicionais sobre como lidar com operações de backup e restauração (consulte [**IVssBackupComponents:: Setbackupstate**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate))</span><span class="sxs-lookup"><span data-stu-id="8f72d-117">The requester can provide additional information on handling backup and restore operations (see [**IVssBackupComponents::SetBackupState**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate))</span></span>                                                                                                                                                        | <span data-ttu-id="8f72d-118">Nenhum</span><span class="sxs-lookup"><span data-stu-id="8f72d-118">None</span></span>                                                      | <span data-ttu-id="8f72d-119">Nenhum</span><span class="sxs-lookup"><span data-stu-id="8f72d-119">None</span></span>                                                                                                                                                                                                                                                       |
| <span data-ttu-id="8f72d-120">Inicia o contato assíncrono com gravadores (consulte [**IVssBackupComponents:: GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata))</span><span class="sxs-lookup"><span data-stu-id="8f72d-120">Initiates asynchronous contact with writers (see [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata))</span></span>                                                                                                                                                                                           | [<span data-ttu-id="8f72d-121">*Identificar*</span><span class="sxs-lookup"><span data-stu-id="8f72d-121">*Identify*</span></span>](vssgloss-i.md) | <span data-ttu-id="8f72d-122">Cria um documento de metadados do gravador (consulte [trabalhando com o documento de metadados do gravador](working-with-the-writer-metadata-document.md), [**CVssWriter:: onidentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify), [**IVssCreateWriterMetadata**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata))</span><span class="sxs-lookup"><span data-stu-id="8f72d-122">Creates a Writer Metadata Document (see [Working with the Writer Metadata Document](working-with-the-writer-metadata-document.md), [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify), [**IVssCreateWriterMetadata**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata))</span></span> |



 

## <a name="requester-actions-during-backup-initialization"></a><span data-ttu-id="8f72d-123">Ações do solicitante durante a inicialização do backup</span><span class="sxs-lookup"><span data-stu-id="8f72d-123">Requester Actions during Backup Initialization</span></span>

<span data-ttu-id="8f72d-124">Um objeto [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) pode ser usado somente para um backup.</span><span class="sxs-lookup"><span data-stu-id="8f72d-124">An [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) object can be used for only one backup.</span></span> <span data-ttu-id="8f72d-125">Portanto, um solicitante deve prosseguir até o final do backup, incluindo a liberação da interface **IVssBackupComponents** .</span><span class="sxs-lookup"><span data-stu-id="8f72d-125">Therefore, a requester must proceed through to the end of the backup, including releasing the **IVssBackupComponents** interface.</span></span> <span data-ttu-id="8f72d-126">Se o backup precisar ser encerrado prematuramente, o solicitante precisará chamar [**IVssBackupComponents:: AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup) e, em seguida, liberar o objeto **IVssBackupComponents** (consulte [anulando operações do VSS](aborting-vss-operations.md) para obter mais informações).</span><span class="sxs-lookup"><span data-stu-id="8f72d-126">If the backup needs to terminate prematurely, the requester needs to call [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup) and then release the **IVssBackupComponents** object (see [Aborting VSS Operations](aborting-vss-operations.md) for more information).</span></span> <span data-ttu-id="8f72d-127">Não tente retomar a interface **IVssBackupComponents** .</span><span class="sxs-lookup"><span data-stu-id="8f72d-127">Do not attempt to resume the **IVssBackupComponents** interface.</span></span>

<span data-ttu-id="8f72d-128">Normalmente, o documento de componentes de backup de um solicitante é inicializado como vazio.</span><span class="sxs-lookup"><span data-stu-id="8f72d-128">Typically, a requester's Backup Components Document is initialized as empty.</span></span> <span data-ttu-id="8f72d-129">Um documento de componentes de backup armazenados pode ser carregado quando [**IVssBackupComponents:: InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) é chamado, normalmente em suporte a volumes copiados de sombra transportável.</span><span class="sxs-lookup"><span data-stu-id="8f72d-129">A stored Backup Components Document can be loaded when [**IVssBackupComponents::InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) is called, typically in support of transportable shadow copied volumes.</span></span> <span data-ttu-id="8f72d-130">Nesse caso, a comunicação do gravador-solicitante será um pouco diferente do que está descrito abaixo.</span><span class="sxs-lookup"><span data-stu-id="8f72d-130">In this case, the writer-requester communication will be somewhat different than what is described below.</span></span> <span data-ttu-id="8f72d-131">(Consulte [importação de volumes copiados de sombra transportável](importing-transportable-shadow-copied-volumes.md) para obter mais informações.)</span><span class="sxs-lookup"><span data-stu-id="8f72d-131">(See [Importing Transportable Shadow Copied Volumes](importing-transportable-shadow-copied-volumes.md) for more information.)</span></span>

<span data-ttu-id="8f72d-132">Para adicionar volumes ao conjunto de cópias de sombra, um solicitante deve primeiro definir o contexto para a operação de cópia de sombra chamando [**IVssBackupComponents:: SetContext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext).</span><span class="sxs-lookup"><span data-stu-id="8f72d-132">To add volumes to the shadow copy set, a requester must first set the context for the shadow copy operation by calling [**IVssBackupComponents::SetContext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext).</span></span> <span data-ttu-id="8f72d-133">Se esse método não for chamado, o contexto padrão para cópias de sombra, \_ backup do VSS CTX \_ , será usado.</span><span class="sxs-lookup"><span data-stu-id="8f72d-133">If this method is not called, the default context for shadow copies, VSS\_CTX\_BACKUP, is used.</span></span> <span data-ttu-id="8f72d-134">Para obter informações sobre como definir o contexto de cópia de sombra, consulte [configurações de contexto de cópia de sombra](shadow-copy-context-configurations.md).</span><span class="sxs-lookup"><span data-stu-id="8f72d-134">For information about setting the shadow copy context, see [Shadow Copy Context Configurations](shadow-copy-context-configurations.md).</span></span>

<span data-ttu-id="8f72d-135">Para começar a conclusão de sua configuração antes do backup, um solicitante deve chamar [**IVssBackupComponents:: Setbackupstate**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate).</span><span class="sxs-lookup"><span data-stu-id="8f72d-135">To begin the completion of its setup prior to backup, a requester must call [**IVssBackupComponents::SetBackupState**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate).</span></span> <span data-ttu-id="8f72d-136">Ao fazer isso, um solicitante indica aos gravadores:</span><span class="sxs-lookup"><span data-stu-id="8f72d-136">By doing this, a requester indicates to the writers:</span></span>

-   <span data-ttu-id="8f72d-137">O tipo de backup (conforme definido no [**\_ \_ tipo de backup VSS**](/windows/desktop/api/Vss/ne-vss-vss_backup_type))</span><span class="sxs-lookup"><span data-stu-id="8f72d-137">The type of backup (as defined in [**VSS\_BACKUP\_TYPE**](/windows/desktop/api/Vss/ne-vss-vss_backup_type))</span></span>
-   <span data-ttu-id="8f72d-138">Se o backup inclui um estado de sistema inicializável</span><span class="sxs-lookup"><span data-stu-id="8f72d-138">Whether the backup includes a bootable system state</span></span>
-   <span data-ttu-id="8f72d-139">Se o solicitante dá suporte à seleção de componentes individuais ou faz backup de volumes inteiros.</span><span class="sxs-lookup"><span data-stu-id="8f72d-139">Whether the requester supports the selection of individual components or backs up entire volumes.</span></span>

<span data-ttu-id="8f72d-140">Todos os solicitantes que participam de operações de backup e restauração sempre devem chamar [**IVssBackupComponents:: GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span><span class="sxs-lookup"><span data-stu-id="8f72d-140">All requesters participating in backup and restore operations must always call [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span></span> <span data-ttu-id="8f72d-141">Esse método inicia a comunicação do gravador-solicitante gerando um evento de [*identificação*](vssgloss-i.md) do VSS, em resposta à qual um gravador cria seu documento de metadados.</span><span class="sxs-lookup"><span data-stu-id="8f72d-141">This method initiates writer-requester communication by generating a VSS [*Identify*](vssgloss-i.md) event, in response to which a writer creates its metadata document.</span></span>

<span data-ttu-id="8f72d-142">Antes de chamar [**IVssBackupComponents:: GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), um solicitante tem a oportunidade de habilitar ou desabilitar explicitamente certos gravadores e classes de gravador específicos usando [**IVssBackupComponents:: EnableWriterClasses**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-enablewriterclasses), [**IVssBackupComponents::D Isablewriterinstances**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-disablewriterinstances)e [**IVssBackupComponents::D isablewriterclasses**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-disablewriterclasses) (por padrão, todas as classes são habilitadas).</span><span class="sxs-lookup"><span data-stu-id="8f72d-142">Prior to calling [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), a requester has an opportunity to explicitly enable or disable certain specific writers and writer classes using [**IVssBackupComponents::EnableWriterClasses**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-enablewriterclasses), [**IVssBackupComponents::DisableWriterInstances**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-disablewriterinstances), and [**IVssBackupComponents::DisableWriterClasses**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-disablewriterclasses) (by default, all classes are enabled).</span></span> <span data-ttu-id="8f72d-143">Depois que **IVssBackupComponents:: GatherWriterMetadata** for chamado, essas chamadas não terão efeito.</span><span class="sxs-lookup"><span data-stu-id="8f72d-143">After **IVssBackupComponents::GatherWriterMetadata** is called, these calls have no effect.</span></span>

<span data-ttu-id="8f72d-144">Como não há nenhuma maneira de obter uma lista de gravadores no sistema antes de chamar [**IVssBackupComponents:: GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), os solicitantes podem considerar a criação e a exclusão de uma segunda instância de [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) para obter a lista.</span><span class="sxs-lookup"><span data-stu-id="8f72d-144">Because there is no way to obtain a list of writers on the system prior to calling [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), requesters may consider creating and then deleting a second instance of [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) to obtain the list.</span></span>

<span data-ttu-id="8f72d-145">Não é necessário chamar [**IVssBackupComponents:: GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) após a conclusão de [**IVssBackupComponents:: GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span><span class="sxs-lookup"><span data-stu-id="8f72d-145">It is not necessary to call [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) following the completion of [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span></span> <span data-ttu-id="8f72d-146">Os gravadores que não processarem o evento de [*identificação*](vssgloss-i.md) gerado pelas chamadas não serão parte da lista de gravadores que fornecem metadados encontrados por [**IVssBackupComponents:: GetWriterMetadataCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadatacount) e [**IVssBackupComponents:: GetWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadata) (consulte [determinando o status do gravador](determining-writer-status.md)).</span><span class="sxs-lookup"><span data-stu-id="8f72d-146">Writers that fail to process the [*Identify*](vssgloss-i.md) event generated by the calls will not be part of the list of writers providing metadata found by [**IVssBackupComponents::GetWriterMetadataCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadatacount) and [**IVssBackupComponents::GetWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadata) (see [Determining Writer Status](determining-writer-status.md)).</span></span>

## <a name="writer-actions-during-backup-initialization"></a><span data-ttu-id="8f72d-147">Ações do gravador durante a inicialização do backup</span><span class="sxs-lookup"><span data-stu-id="8f72d-147">Writer Actions during Backup Initialization</span></span>

<span data-ttu-id="8f72d-148">Em resposta ao evento de identificação, o VSS chama o método de manipulador virtual de cada gravador, [**CVssWriter:: onidentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify).</span><span class="sxs-lookup"><span data-stu-id="8f72d-148">In response to the Identify event, VSS calls each writer's virtual handler method, [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify).</span></span> <span data-ttu-id="8f72d-149">Um gravador cria seu documento de metadados do gravador substituindo a implementação padrão de **CVssWriter:: Onidentification** e usando a interface [**IVssCreateWriterMetadata**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata) .</span><span class="sxs-lookup"><span data-stu-id="8f72d-149">A writer creates its Writer Metadata Document by overriding the default implementation of **CVssWriter::OnIdentify** and using the [**IVssCreateWriterMetadata**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata) interface.</span></span>

<span data-ttu-id="8f72d-150">Observe que os aplicativos que não sejam o solicitante atual (por exemplo, aplicativos de sistema) podem gerar eventos de identificação que devem ser manipulados pelo gravador.</span><span class="sxs-lookup"><span data-stu-id="8f72d-150">Note that applications other than the current requester (for instance, system applications) can generate Identify events that must be handled by the writer.</span></span> <span data-ttu-id="8f72d-151">Além disso, não há nenhuma maneira de um gravador determinar de dentro de [**CVssWriter:: onidentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) qual aplicativo gerou o evento de identificação.</span><span class="sxs-lookup"><span data-stu-id="8f72d-151">In addition, there is no way for a writer to determine from within [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) which application has generated the Identify event.</span></span>

<span data-ttu-id="8f72d-152">Esse é o caso, uma vez que um gravador pode receber vários eventos de identificação durante o processamento de uma operação de backup, um gravador nunca deve definir informações de estado no manipulador [**CVssWriter:: onidentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) .</span><span class="sxs-lookup"><span data-stu-id="8f72d-152">This being the case, given that a writer may receive several Identify events while processing a backup operation, a writer should never set state information in the [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) handler.</span></span>

<span data-ttu-id="8f72d-153">Em vez disso, [**CVssWriter:: onidentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) deve executar um algoritmo consistente para criar o documento de metadados do gravador do gravador, particularmente porque depois que um gravador cria o documento, nem o solicitante nem o gravador pode modificá-lo.</span><span class="sxs-lookup"><span data-stu-id="8f72d-153">Instead, [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) should perform a consistent algorithm to create the writer's Writer Metadata Document, particularly because after a writer creates the document, neither the requester nor the writer can modify it.</span></span> <span data-ttu-id="8f72d-154">Deste ponto em diante, ele é um documento somente leitura.</span><span class="sxs-lookup"><span data-stu-id="8f72d-154">From this point forward, it is a read-only document.</span></span>

<span data-ttu-id="8f72d-155">Isso significa que o número e o tipo de [*componentes*](vssgloss-c.md) associados a um gravador, quais arquivos fazem parte de cada componente, e a exclusão explícita de arquivos de operações de backup ou restauração não pode ser alterada depois que um gravador retorna do processamento do evento de identificação.</span><span class="sxs-lookup"><span data-stu-id="8f72d-155">This means that the number and type of [*components*](vssgloss-c.md) associated with a writer, which files are part of each component, and the explicit exclusion of files from backup or restore operations cannot be changed after a writer returns from processing the Identify event.</span></span>

<span data-ttu-id="8f72d-156">Todos os gravadores que participam do VSS são necessários para fazer o seguinte:</span><span class="sxs-lookup"><span data-stu-id="8f72d-156">All writers participating with VSS are required to do the following:</span></span>

1.  <span data-ttu-id="8f72d-157">Indique um método de restauração para todos os componentes gerenciados pelo gravador usando [**IVssCreateWriterMetadata:: SetRestoreMethod**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setrestoremethod).</span><span class="sxs-lookup"><span data-stu-id="8f72d-157">Indicate a restore method for all components managed by the writer using [**IVssCreateWriterMetadata::SetRestoreMethod**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setrestoremethod).</span></span>
2.  <span data-ttu-id="8f72d-158">Adicione pelo menos um componente usando [**IVssCreateWriterMetadata:: addComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponent) (consulte [definição de componentes por gravadores](definition-of-components-by-writers.md) para obter mais informações sobre a especificação do componente).</span><span class="sxs-lookup"><span data-stu-id="8f72d-158">Add at least one component using [**IVssCreateWriterMetadata::AddComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponent) (see [Definition of Components by Writers](definition-of-components-by-writers.md) for more information on component specification).</span></span>

<span data-ttu-id="8f72d-159">Um gravador indica os arquivos para participar de uma operação de backup ou restauração adicionando [*conjuntos de arquivos*](vssgloss-f.md)— uma combinação de um caminho, uma especificação de arquivo e um sinalizador de recursão — a um determinado componente usando [**IVssCreateWriterMetadata:: AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup), [**IVssCreateWriterMetadata:: AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles)ou [**IVssCreateWriterMetadata:: AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles), dependendo do tipo (consulte [Adicionando arquivos aos componentes](definition-of-components-by-writers.md).)</span><span class="sxs-lookup"><span data-stu-id="8f72d-159">A writer indicates the files to participate in a backup or restore operation by adding [*file sets*](vssgloss-f.md)—a combination of a path, file specification, and a recursion flag—to a given component using [**IVssCreateWriterMetadata::AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup), [**IVssCreateWriterMetadata::AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), or [**IVssCreateWriterMetadata::AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles), depending on type (See [Adding Files to Components](definition-of-components-by-writers.md).)</span></span>

<span data-ttu-id="8f72d-160">Um gravador também pode ter um ou mais componentes vazios, componentes para os quais nenhum arquivo foi adicionado.</span><span class="sxs-lookup"><span data-stu-id="8f72d-160">A writer may also have one or more empty components, components to which no files have been added.</span></span> <span data-ttu-id="8f72d-161">Eles são muito úteis para organizar os componentes do gravador.</span><span class="sxs-lookup"><span data-stu-id="8f72d-161">These are very useful in organizing the writer's components.</span></span> <span data-ttu-id="8f72d-162">(Consulte o [caminho lógico dos componentes](logical-pathing-of-components.md).)</span><span class="sxs-lookup"><span data-stu-id="8f72d-162">(See [Logical Pathing of Components](logical-pathing-of-components.md).)</span></span>

<span data-ttu-id="8f72d-163">Um gravador usa [**IVssCreateWriterMetadata:: AddExcludeFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addexcludefiles) para impedir explicitamente que arquivos sejam incluídos no backup.</span><span class="sxs-lookup"><span data-stu-id="8f72d-163">A writer uses [**IVssCreateWriterMetadata::AddExcludeFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addexcludefiles) to explicitly prevent files from being included in the backup.</span></span> <span data-ttu-id="8f72d-164">Essa exclusão explícita é útil porque caracteres curinga podem ser usados para especificar arquivos para inclusão (consulte [excluir especificação de lista de arquivos](writer-metadata-document-contents.md)).</span><span class="sxs-lookup"><span data-stu-id="8f72d-164">This explicit exclusion is useful because wildcard characters can be used to specify files for inclusion (see [Exclude File List Specification](writer-metadata-document-contents.md)).</span></span> <span data-ttu-id="8f72d-165">Observe que a lista de arquivos de exclusão tem precedência sobre as listas de arquivos de componentes.</span><span class="sxs-lookup"><span data-stu-id="8f72d-165">Note that the exclude file list takes precedence over component files lists.</span></span>

<span data-ttu-id="8f72d-166">[**IVssCreateWriterMetadata:: AddAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addalternatelocationmapping) é usado para criar [*mapeamentos de local alternativos*](vssgloss-a.md) para os conjuntos de arquivos especificados que foram adicionados a um dos componentes do gravador.</span><span class="sxs-lookup"><span data-stu-id="8f72d-166">[**IVssCreateWriterMetadata::AddAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addalternatelocationmapping) is used to create [*alternate location mappings*](vssgloss-a.md) for specified file sets that have been added to one of the writer's components.</span></span> <span data-ttu-id="8f72d-167">Esses mapeamentos são usados durante a restauração do arquivo quando a restauração para o local original de um arquivo não é possível ou desejável.</span><span class="sxs-lookup"><span data-stu-id="8f72d-167">These mappings are used during file restore when restoring to a file's original location is not possible or desirable.</span></span> <span data-ttu-id="8f72d-168">(Consulte [visão geral de restauração de arquivo real](overview-of-actual-file-restoration.md) e [locais de backup e restauração não padrão](non-default-backup-and-restore-locations.md).)</span><span class="sxs-lookup"><span data-stu-id="8f72d-168">(See [Overview of Actual File Restoration](overview-of-actual-file-restoration.md) and [Non-Default Backup and Restore Locations](non-default-backup-and-restore-locations.md).)</span></span>

<span data-ttu-id="8f72d-169">Como o conjunto de arquivos de backup é especificado no documento de metadados do gravador, ele não pode ser modificado posteriormente.</span><span class="sxs-lookup"><span data-stu-id="8f72d-169">Because the backup file set is specified in the Writer Metadata Document, it cannot later be modified.</span></span> <span data-ttu-id="8f72d-170">Portanto, um gravador deve ser codificado para que a definição do conjunto de arquivos inclua todos os arquivos necessários no backup, seja pelo nome ou por caracteres curinga.</span><span class="sxs-lookup"><span data-stu-id="8f72d-170">Therefore, a writer should be coded so that the file set's definition will include all files needed in the backup, either by name or through wildcard characters.</span></span> <span data-ttu-id="8f72d-171">É muito provável que isso inclua alguns arquivos que podem ser criados após o evento de identificação.</span><span class="sxs-lookup"><span data-stu-id="8f72d-171">Conceivably, this may include some files that might be created after the Identify event.</span></span>

 

 



