---
description: Às vezes, é útil fazer backup e restaurar apenas seções de arquivos. O VSS fornece mecanismos de arquivo parciais, que, se os solicitantes oferecerem suporte a ele, permite que os gravadores especifiquem backups e restaurações parciais de arquivos.
ms.assetid: 02b74a4e-d69f-4eeb-866a-3399598b7035
title: Trabalhando com arquivos parciais
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7194f01df11f6c0e368941e17ef6ab1620b17f67
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105770542"
---
# <a name="working-with-partial-files"></a><span data-ttu-id="16d9e-104">Trabalhando com arquivos parciais</span><span class="sxs-lookup"><span data-stu-id="16d9e-104">Working with Partial Files</span></span>

<span data-ttu-id="16d9e-105">Às vezes, é útil fazer backup e restaurar apenas seções de arquivos.</span><span class="sxs-lookup"><span data-stu-id="16d9e-105">It is sometimes useful to back up and restore only sections of files.</span></span> <span data-ttu-id="16d9e-106">O VSS fornece mecanismos de [*arquivo parciais*](vssgloss-p.md) , que, se os solicitantes oferecerem suporte a ele, permite que os gravadores especifiquem backups e restaurações parciais de arquivos.</span><span class="sxs-lookup"><span data-stu-id="16d9e-106">VSS provides [*partial file*](vssgloss-p.md) mechanisms, which, if requesters support it, allows writers to specify partial file backups and restores.</span></span>

<span data-ttu-id="16d9e-107">As operações de arquivo parcial são frequentemente de maior uso para gravadores que mantêm arquivos muito grandes, apenas uma pequena fração da alteração entre as operações de backup.</span><span class="sxs-lookup"><span data-stu-id="16d9e-107">Partial file operations are frequently of greatest use to writers that maintain very large files, only a small fraction of which change between backup operations.</span></span> <span data-ttu-id="16d9e-108">Esse é o caso, geralmente é útil copiar apenas essa seção que foi alterada para mídia de backup.</span><span class="sxs-lookup"><span data-stu-id="16d9e-108">This being the case, it is frequently useful to copy only that section that changed to backup media.</span></span> <span data-ttu-id="16d9e-109">Por esse motivo, as operações de arquivo parcial são normalmente, mas não exclusivamente, usadas para dar suporte a operações incrementais de backup e restauração.</span><span class="sxs-lookup"><span data-stu-id="16d9e-109">For this reason, partial file operations are typically, but not exclusively, used to support incremental backup and restore operations.</span></span>

<span data-ttu-id="16d9e-110">Se um gravador quiser implementar uma operação de arquivo parcial, ele usará [**CVssWriter:: IsPartialFileSupportEnabled**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispartialfilesupportenabled) para determinar se o solicitante que está trabalhando oferece suporte à operação.</span><span class="sxs-lookup"><span data-stu-id="16d9e-110">If a writer wants to implement a partial file operation, it uses [**CVssWriter::IsPartialFileSupportEnabled**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispartialfilesupportenabled) to determine whether the requester it is working with supports the operation.</span></span>

<span data-ttu-id="16d9e-111">Se o solicitante oferecer suporte a operações de arquivo parciais e se ele adicionar o componente que gerencia o arquivo (ou o componente que define o conjunto de componentes que contém o arquivo) ao documento de componentes de backup, um gravador indicará quais seções do arquivo salvar (normalmente ao manipular um evento [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) ou [*pós-instantâneo*](vssgloss-p.md) ) chamando [**IVssComponent:: addparcialfile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile).</span><span class="sxs-lookup"><span data-stu-id="16d9e-111">If the requester supports partial file operations, and if it adds the component that manages the file (or the component that defines the component set that contains the file) to the Backup Components Document, a writer indicates which sections of the file to save (typically while handling a [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) or [*PostSnapshot*](vssgloss-p.md) event) by calling [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile).</span></span>

<span data-ttu-id="16d9e-112">Além de um caminho e nome de arquivo, o gravador fornece o intervalo, informações de metadados opcionais para [**IVssComponent:: Addparcialfile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile).</span><span class="sxs-lookup"><span data-stu-id="16d9e-112">In addition to a path and file name, the writer supplies the range, optional metadata information to [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile).</span></span>

<span data-ttu-id="16d9e-113">As informações do intervalo são fornecidas como uma cadeia de caracteres que contém um dos seguintes:</span><span class="sxs-lookup"><span data-stu-id="16d9e-113">The range information is provided as a string that contains either of the following:</span></span>

-   <span data-ttu-id="16d9e-114">Pares de deslocamentos no arquivo cujo backup será feito (em bytes) e o comprimento da seção de backup (em bytes), o deslocamento e o comprimento que estão sendo separados por dois-pontos e cada par separado por uma vírgula, por exemplo, \*Offset1 \***:**_Length1_*_,_* \* Offset2 \***:**_Length2_.</span><span class="sxs-lookup"><span data-stu-id="16d9e-114">Pairs of offsets into the file to be backed up (in bytes) and the length of the section to be backed up (in bytes), the offset and length being separated by a colon, and each pair separated by a comma, for example, *Offset1\***:**_Length1_*_,_\* \*Offset2\***:**_Length2_.</span></span>

    <span data-ttu-id="16d9e-115">Cada valor é um inteiro de 64 bits (em formato hexadecimal ou Decimal) que especifica um deslocamento de byte e um comprimento em bytes, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="16d9e-115">Each value is a 64-bit integer (in either hexadecimal or decimal format) specifying a byte offset and length in bytes, respectively.</span></span>

-   <span data-ttu-id="16d9e-116">O caminho completo, incluindo o nome do arquivo, no sistema atual de um arquivo de intervalos binários que contém o seguinte:</span><span class="sxs-lookup"><span data-stu-id="16d9e-116">The full path, including file name, on the current system of a binary ranges file containing the following:</span></span>
    -   <span data-ttu-id="16d9e-117">O número (expresso como um número inteiro de 64 bits) de intervalos de arquivos distintos contidos no arquivo</span><span class="sxs-lookup"><span data-stu-id="16d9e-117">The number (expressed as a 64-bit integer) of distinct file ranges contained in the file</span></span>
    -   <span data-ttu-id="16d9e-118">Cada intervalo expresso como um par de inteiros de 64 bits: o primeiro membro do par que está sendo o deslocamento para o arquivo que está sendo submetido a backup (em bytes) e o segundo membro que tem o tamanho de dados a ser submetido a backup (em bytes)</span><span class="sxs-lookup"><span data-stu-id="16d9e-118">Each range expressed as a pair of 64-bit integers: the first member of the pair being the offset into the file being backed up (in bytes), and the second member being the length of data to be backed up (in bytes)</span></span>

<span data-ttu-id="16d9e-119">Se um gravador usa um arquivo de intervalos para especificar uma operação de arquivo parcial, um solicitante deve garantir que o backup desse arquivo seja feito (mesmo que o arquivo não seja necessariamente parte do conjunto de backup padrão) ou que as informações de intervalos sejam preservadas na mídia de backup de alguma outra maneira.</span><span class="sxs-lookup"><span data-stu-id="16d9e-119">If a writer uses a ranges file to specify a partial file operation, a requester must guarantee that either this file is backed up (even if the file is not necessarily part of the default backup set) or that the ranges information is preserved on the backup media in some other way.</span></span> <span data-ttu-id="16d9e-120">Se não for feito backup das informações do arquivo de intervalos, a restauração do arquivo de backup parcial será impossível.</span><span class="sxs-lookup"><span data-stu-id="16d9e-120">If the ranges file's information is not backed up, restoring the partially backed up file will be impossible.</span></span>

<span data-ttu-id="16d9e-121">O gravador também pode adicionar uma cadeia de caracteres que contém metadados.</span><span class="sxs-lookup"><span data-stu-id="16d9e-121">The writer can also add a string containing metadata.</span></span> <span data-ttu-id="16d9e-122">Esses metadados podem estar em um formato específico do gravador, pois ele destina-se a permitir que o gravador valide quaisquer restaurações futuras.</span><span class="sxs-lookup"><span data-stu-id="16d9e-122">This metadata can be in a writer-specific format because it is intended to allow the writer to validate any future restores.</span></span>

<span data-ttu-id="16d9e-123">Com essas informações, um solicitante de suporte pode executar um backup de arquivo parcial.</span><span class="sxs-lookup"><span data-stu-id="16d9e-123">With this information, a supporting requester can perform a partial file backup.</span></span>

<span data-ttu-id="16d9e-124">Como exemplo, considere um arquivo grande cujo cabeçalho (bytes 64-512) contenha uma contagem de registros e outras informações atualizadas com frequência e cujos dados mais recentes sejam encontrados nos últimos 65536 bytes do arquivo — bytes 0x1239E8577A a 0x1239E7577A.</span><span class="sxs-lookup"><span data-stu-id="16d9e-124">As an example, consider a large file whose header (bytes 64-512) contains a record count and other frequently updated information, and whose most recent data is to be found in the file's last 65536 bytes—bytes 0x1239E8577A to 0x1239E7577A.</span></span>

<span data-ttu-id="16d9e-125">Um gravador poderia especificar uma lista de intervalos como a cadeia de caracteres "**64:448, 0x1239E8577A: 65536**."</span><span class="sxs-lookup"><span data-stu-id="16d9e-125">A writer could specify a range list as the string "**64:448,0x1239E8577A:65536**."</span></span>

<span data-ttu-id="16d9e-126">Na restauração, e antes de realmente executar uma operação de restauração, um solicitante deve verificar se algum arquivo requer suporte parcial a arquivos.</span><span class="sxs-lookup"><span data-stu-id="16d9e-126">On restore, and prior to actually performing a restore operation, a requester should check to see if any files require partial file support.</span></span>

<span data-ttu-id="16d9e-127">Para fazer isso, o solicitante primeiro itera sobre os gravadores com componentes armazenados em seu documento de componentes de backup usando [**IVssBackupComponents:: GetWriterComponentsCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponentscount) e [**IVssBackupComponents:: GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents).</span><span class="sxs-lookup"><span data-stu-id="16d9e-127">To do this, the requester first iterates over the writers with stored components in its Backup Components Document using [**IVssBackupComponents::GetWriterComponentsCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponentscount) and [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents).</span></span>

<span data-ttu-id="16d9e-128">A interface [**IVssBackupComponents:: GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents) é usada para retornar instâncias da interface [**IVssWriterComponentsExt**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) , que fornecem [**IVssWriterComponentsExt:: GetComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponent) e [**IVssWriterComponentsExt:: GetComponentCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponentcount), que permitem que o solicitante obtenha as instâncias de [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) .</span><span class="sxs-lookup"><span data-stu-id="16d9e-128">The [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents) interface is then used to return instances of the [**IVssWriterComponentsExt**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) interface, which provide [**IVssWriterComponentsExt::GetComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponent) and [**IVssWriterComponentsExt::GetComponentCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponentcount), that allow the requester to obtain [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) instances.</span></span>

<span data-ttu-id="16d9e-129">Isso permite que um solicitante obtenha informações sobre os arquivos com backup parcial para participar de uma restauração usando [**IVssComponent:: GetPartialFileCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfilecount) e [**IVssComponent:: getparcialfile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile) para a instância do [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) correspondente ao componente que gerencia o arquivo (ou o componente que define o conjunto de componentes que contém o arquivo).</span><span class="sxs-lookup"><span data-stu-id="16d9e-129">This allows a requester to obtain information about the partially backed up files to participate in a restore by using [**IVssComponent::GetPartialFileCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfilecount) and [**IVssComponent::GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile) for the instance of [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) corresponding to the component that manages the file (or the component that defines the component set that contains the file).</span></span>

<span data-ttu-id="16d9e-130">Se a operação de arquivo parcial tiver sido controlada por um arquivo de intervalos, esse arquivo deverá ser restaurado antes de os dados copiados de volta para o disco.</span><span class="sxs-lookup"><span data-stu-id="16d9e-130">If the partial file operation was controlled by a ranges file, that file should be restored prior to copied data back to disk.</span></span> <span data-ttu-id="16d9e-131">Pode acontecer que o solicitante precise copiar o arquivo de intervalos de volta para um novo local no disco.</span><span class="sxs-lookup"><span data-stu-id="16d9e-131">It may happen that the requester needed to copy the ranges file back to a new location on disk.</span></span> <span data-ttu-id="16d9e-132">Nesse caso, indica que isso foi feito por meio do [**IVssBackupComponents:: SetRangesFilePath**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrangesfilepath).</span><span class="sxs-lookup"><span data-stu-id="16d9e-132">In this case, it indicates that it has done so through the [**IVssBackupComponents::SetRangesFilePath**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrangesfilepath).</span></span>

<span data-ttu-id="16d9e-133">Em seguida, o solicitante continua copiando dados para os locais apropriados no disco de restauração de destino já existente.</span><span class="sxs-lookup"><span data-stu-id="16d9e-133">The requester then proceeds to copy data into the appropriate locations in the restore destination already on disk.</span></span>

<span data-ttu-id="16d9e-134">Um gravador (ao manipular um evento de [**pós-restauração**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) ), examinando [**IVssComponent:: GetFileRestoreStatus**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getfilerestorestatus) para os arquivos indicados por [**IVssComponent:: getpartialfile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile), determina se a operação de arquivo parcial foi bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="16d9e-134">A writer (while handling a [**PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) event), by examining [**IVssComponent::GetFileRestoreStatus**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getfilerestorestatus) for the files indicated by [**IVssComponent::GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile), determines if the partial file operation was successful.</span></span> <span data-ttu-id="16d9e-135">O gravador sempre deve tentar verificar a exatidão dessa restauração usando as informações de deslocamento e todos os metadados incluídos no documento de componentes de backup.</span><span class="sxs-lookup"><span data-stu-id="16d9e-135">The writer should always attempt to verify the correctness of this restore using the offset information and any metadata included in the Backup Components Document.</span></span>

<span data-ttu-id="16d9e-136">Se o solicitante teve de restaurar o arquivo de intervalos para um novo local, o VSS atualizará essas informações para que o caminho retornado por [**IVssComponent:: Getpartialfile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile) esteja correto.</span><span class="sxs-lookup"><span data-stu-id="16d9e-136">If the requester has had to restore the ranges file to a new location, VSS will update this information so that the path returned by [**IVssComponent::GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile) is correct.</span></span>

 

 
