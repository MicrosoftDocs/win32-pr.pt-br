---
description: Ao inicializar uma operação de restauração do VSS, um solicitante precisa recuperar o documento do componente de backup e cada documento de metadados do gravador relevante criado e salvo durante a operação de backup.
ms.assetid: 0a087125-c9d4-460a-8153-3e2e26633ac2
title: Visão geral da inicialização da restauração
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6eb62e5282a74e38cd53d36c8ba004f4b8069746
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104091431"
---
# <a name="overview-of-restore-initialization"></a><span data-ttu-id="b4f1e-103">Visão geral da inicialização da restauração</span><span class="sxs-lookup"><span data-stu-id="b4f1e-103">Overview of Restore Initialization</span></span>

<span data-ttu-id="b4f1e-104">Ao inicializar uma operação de restauração do VSS, um solicitante precisa recuperar o documento do componente de backup e cada documento de metadados do gravador relevante criado e salvo durante a operação de backup.</span><span class="sxs-lookup"><span data-stu-id="b4f1e-104">In initializing a VSS restore operation, a requester needs to retrieve the Backup Component Document and each relevant Writer Metadata Document created and saved during the backup operation.</span></span> <span data-ttu-id="b4f1e-105">O gravador terá seu estado atual consultado na manipulação do [*evento de identificação*](vssgloss-i.md) que o solicitante gera.</span><span class="sxs-lookup"><span data-stu-id="b4f1e-105">The writer will have its current state queried in handling the [*Identify event*](vssgloss-i.md) that the requester generates.</span></span> <span data-ttu-id="b4f1e-106">Para obter mais informações, consulte [visão geral do processamento de uma restauração no VSS](overview-of-processing-a-restore-under-vss.md).</span><span class="sxs-lookup"><span data-stu-id="b4f1e-106">For more information, see [Overview of Processing a Restore Under VSS](overview-of-processing-a-restore-under-vss.md).</span></span>

<span data-ttu-id="b4f1e-107">A tabela a seguir mostra a sequência de ações e eventos necessários para inicializar uma operação de restauração.</span><span class="sxs-lookup"><span data-stu-id="b4f1e-107">The following table shows the sequence of actions and events that are required to initialize a restore operation.</span></span>



| <span data-ttu-id="b4f1e-108">Ação do solicitante</span><span class="sxs-lookup"><span data-stu-id="b4f1e-108">Requester action</span></span>                                                                                                                                                                                                                                                                                                       | <span data-ttu-id="b4f1e-109">Evento</span><span class="sxs-lookup"><span data-stu-id="b4f1e-109">Event</span></span>                                                     | <span data-ttu-id="b4f1e-110">Ação do gravador</span><span class="sxs-lookup"><span data-stu-id="b4f1e-110">Writer action</span></span>                                                                                                                                                                                                                                                                                                             |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="b4f1e-111">Crie uma interface [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) , inicialize-a para gerenciar uma restauração e carregue os metadados do solicitante armazenado (consulte [**CreateVssBackupComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents), [**IVssBackupComponents:: InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore)).</span><span class="sxs-lookup"><span data-stu-id="b4f1e-111">Create an [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface, initialize it to manage a restore, and load stored requester metadata (see [**CreateVssBackupComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents), [**IVssBackupComponents::InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore)).</span></span> | <span data-ttu-id="b4f1e-112">Nenhum</span><span class="sxs-lookup"><span data-stu-id="b4f1e-112">None</span></span>                                                      | <span data-ttu-id="b4f1e-113">Nenhum</span><span class="sxs-lookup"><span data-stu-id="b4f1e-113">None</span></span>                                                                                                                                                                                                                                                                                                                      |
| <span data-ttu-id="b4f1e-114">Chame [**CreateVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssexaminewritermetadata) para criar interfaces [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) e carregá-las com metadados de gravador armazenados.</span><span class="sxs-lookup"><span data-stu-id="b4f1e-114">Call [**CreateVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssexaminewritermetadata) to create [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) interfaces and load them with stored writer metadata.</span></span>                                                                                                           | <span data-ttu-id="b4f1e-115">Nenhum</span><span class="sxs-lookup"><span data-stu-id="b4f1e-115">None</span></span>                                                      | <span data-ttu-id="b4f1e-116">Nenhum</span><span class="sxs-lookup"><span data-stu-id="b4f1e-116">None</span></span>                                                                                                                                                                                                                                                                                                                      |
| <span data-ttu-id="b4f1e-117">Inicie o contato assíncrono com gravadores (consulte [**IVssBackupComponents:: GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).)</span><span class="sxs-lookup"><span data-stu-id="b4f1e-117">Initiate asynchronous contact with writers (see [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).)</span></span>                                                                                                                                                                      | [<span data-ttu-id="b4f1e-118">*Identificar*</span><span class="sxs-lookup"><span data-stu-id="b4f1e-118">*Identify*</span></span>](vssgloss-i.md) | <span data-ttu-id="b4f1e-119">O gravador inicia o tratamento de eventos para dar suporte à restauração.</span><span class="sxs-lookup"><span data-stu-id="b4f1e-119">The writer begins event handling in support of the restore.</span></span> <span data-ttu-id="b4f1e-120">Cria o documento de metadados do gravador (consulte [trabalhando com o documento de metadados do gravador](working-with-the-writer-metadata-document.md), [**CVssWriter:: onidentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify), [**IVssCreateWriterMetadata**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata)).</span><span class="sxs-lookup"><span data-stu-id="b4f1e-120">Creates the Writer Metadata Document (see [Working with the Writer Metadata Document](working-with-the-writer-metadata-document.md), [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify), [**IVssCreateWriterMetadata**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata)).</span></span> |
| <span data-ttu-id="b4f1e-121">O solicitante aguarda que os gravadores sejam inicializados chamando [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync).</span><span class="sxs-lookup"><span data-stu-id="b4f1e-121">The requester waits for writers to initialize by calling [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync).</span></span>                                                                                                                                                                                                                               | <span data-ttu-id="b4f1e-122">Nenhum</span><span class="sxs-lookup"><span data-stu-id="b4f1e-122">None</span></span>                                                      | <span data-ttu-id="b4f1e-123">Nenhum</span><span class="sxs-lookup"><span data-stu-id="b4f1e-123">None</span></span>                                                                                                                                                                                                                                                                                                                      |



 

## <a name="requester-actions-during-restore-initialization"></a><span data-ttu-id="b4f1e-124">Ações do solicitante durante a inicialização da restauração</span><span class="sxs-lookup"><span data-stu-id="b4f1e-124">Requester Actions during Restore Initialization</span></span>

<span data-ttu-id="b4f1e-125">Durante a fase de inicialização de uma restauração, o solicitante precisa ter acesso ao documento de componentes de backup armazenados e a todos os documentos de metadados do gravador.</span><span class="sxs-lookup"><span data-stu-id="b4f1e-125">During the initialization phase of a restore, the requester needs to have access to the stored Backup Components Document and all the Writer Metadata Documents.</span></span>

<span data-ttu-id="b4f1e-126">Dependendo da implementação, isso significa que o solicitante exigirá que a mídia de backup seja montada e legível, ou que algum outro mecanismo para acessar os metadados armazenados esteja disponível.</span><span class="sxs-lookup"><span data-stu-id="b4f1e-126">Depending on the implementation, this will mean either that the requester will require that backup media be mounted and readable, or that some other mechanism for accessing the stored metadata be available.</span></span>

<span data-ttu-id="b4f1e-127">O solicitante usa o documento XML armazenado que contém o documento de componentes de backup do solicitante que realizou o backup para inicializar seu documento de componentes de backup usando [**IVssBackupComponents:: InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore) pode acessar as informações.</span><span class="sxs-lookup"><span data-stu-id="b4f1e-127">The requester uses the stored XML document containing the Backup Components Document of the requester that performed the backup to initialize its Backup Components Document using [**IVssBackupComponents::InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore) can access the information.</span></span>

<span data-ttu-id="b4f1e-128">Como foi o caso durante o backup, o documento de componentes de backup não tem informações suficientes para dar suporte a uma restauração; Portanto, o solicitante precisa acessar os documentos de metadados do gravador armazenados durante o backup (consulte [uso de componentes pelo solicitante](use-of-components-by-the-requestor.md)).</span><span class="sxs-lookup"><span data-stu-id="b4f1e-128">As was the case during the backup, the Backup Components Document has insufficient information to support a restore; therefore, the requester needs access to those Writer Metadata Documents stored during backup (see [Use of Components by the Requester](use-of-components-by-the-requestor.md)).</span></span>

<span data-ttu-id="b4f1e-129">O solicitante recupera os metadados do gravador armazenado chamando [**CreateVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssexaminewritermetadata) para cada gravador cujos dados foram armazenados em backup e agora deve ser restaurado.</span><span class="sxs-lookup"><span data-stu-id="b4f1e-129">The requester retrieves the stored writer metadata by calling [**CreateVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssexaminewritermetadata) for each writer whose data was backed up and now is to be restored.</span></span> <span data-ttu-id="b4f1e-130">Essa função cria um objeto [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) para cada gravador e carrega o documento de metadados do gravador do gravador no objeto.</span><span class="sxs-lookup"><span data-stu-id="b4f1e-130">This function creates an [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) object for each writer and loads the writer's Writer Metadata Document into the object.</span></span>

<span data-ttu-id="b4f1e-131">Como foi o caso durante o backup, para iniciar a cooperação entre si mesmo e os gravadores do sistema, um solicitante deve gerar um evento de [*identificação*](vssgloss-i.md) chamando [**IVssBackupComponents:: GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span><span class="sxs-lookup"><span data-stu-id="b4f1e-131">As was the case during the backup, to initiate cooperation between itself and the system's writers, a requester must generate an [*Identify*](vssgloss-i.md) event by calling [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span></span> <span data-ttu-id="b4f1e-132">Não é necessário chamar [**IVssBackupComponents:: GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) após a conclusão de [**GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span><span class="sxs-lookup"><span data-stu-id="b4f1e-132">It is not necessary to call [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) following the completion of [**GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).</span></span> <span data-ttu-id="b4f1e-133">Os gravadores que não processarem o evento de [*identificação*](vssgloss-i.md) não serão incluídos na lista de gravadores que fornecem os metadados a serem retornados por [**IVssBackupComponents:: GetWriterMetadataCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadatacount) e [**IVssBackupComponents:: GetWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadata) (consulte [determinando o status do gravador](determining-writer-status.md)).</span><span class="sxs-lookup"><span data-stu-id="b4f1e-133">Writers that fail to process the [*Identify*](vssgloss-i.md) event will not be included in the list of writers providing the metadata to be returned by [**IVssBackupComponents::GetWriterMetadataCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadatacount) and [**IVssBackupComponents::GetWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadata) (see [Determining Writer Status](determining-writer-status.md)).</span></span>

<span data-ttu-id="b4f1e-134">Assim como acontece com a operação de backup, um solicitante precisará consultar e analisar as informações no documento componentes de backup e compará-las aos dados nos documentos de metadados do gravador para determinar quais componentes foram armazenados em backup e escolher aqueles a serem restaurados (consulte [visão geral da preparação para a restauração](overview-of-preparing-for-restore.md)).</span><span class="sxs-lookup"><span data-stu-id="b4f1e-134">As with the backup operation, a requester will need to query and parse the information in the Backup Components Document and compare it to data in the Writer Metadata Documents to determine which components were backed up and to choose those to be restored (see [Overview of Preparing for Restore](overview-of-preparing-for-restore.md)).</span></span> <span data-ttu-id="b4f1e-135">Além disso, o solicitante precisará gerar uma lista detalhada contendo informações sobre os arquivos na mídia de backup selecionada para restauração, além de como e onde eles devem ser restaurados.</span><span class="sxs-lookup"><span data-stu-id="b4f1e-135">In addition, the requester will need to generate a detailed list containing information about the files on the backup media selected for restore, as well as how and where they are to be restored.</span></span> <span data-ttu-id="b4f1e-136">(Consulte [gerando um conjunto de restauração](generating-a-restore-set.md).)</span><span class="sxs-lookup"><span data-stu-id="b4f1e-136">(See [Generating a Restore Set](generating-a-restore-set.md).)</span></span>

<span data-ttu-id="b4f1e-137">Portanto, alguns aplicativos de backup podem achar útil armazenar na mídia de backup sua própria lista (em seu próprio formato otimizado) dos arquivos e suas informações de gravador, componente, procedimento de restauração e local associadas.</span><span class="sxs-lookup"><span data-stu-id="b4f1e-137">Therefore, some backup applications may find it useful to have stored on the backup media their own list (in their own optimized format) of the files and their associated writer, component, restore procedure, and location information.</span></span> <span data-ttu-id="b4f1e-138">Essa lista pode ser usada para minimizar a quantidade de análise e comparação de documentos de metadados do gravador e os documentos do componente de backup necessários para dar suporte a uma restauração.</span><span class="sxs-lookup"><span data-stu-id="b4f1e-138">This list can be used to minimize the amount of parsing and comparing of Writer Metadata Documents and the Backup Component Documents required to support a restore.</span></span>

## <a name="writer-actions-during-restore-initialization"></a><span data-ttu-id="b4f1e-139">Ações do gravador durante a inicialização da restauração</span><span class="sxs-lookup"><span data-stu-id="b4f1e-139">Writer Actions during Restore Initialization</span></span>

<span data-ttu-id="b4f1e-140">Assim como é feito durante uma operação de restauração, em resposta ao evento de identificação, o VSS chama o método de manipulador virtual de cada gravador [**CVssWriter:: onidentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify).</span><span class="sxs-lookup"><span data-stu-id="b4f1e-140">Just as is done during a restore operation, in response to the Identify event, VSS calls each writer's virtual handler method [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify).</span></span>

<span data-ttu-id="b4f1e-141">Observe que os aplicativos que não sejam o solicitante atual (por exemplo, aplicativos de sistema) podem gerar eventos de identificação, que devem ser manipulados pelo gravador.</span><span class="sxs-lookup"><span data-stu-id="b4f1e-141">Note that applications other than the current requester (for instance, system applications) can generate Identify events, which must be handled by the writer.</span></span> <span data-ttu-id="b4f1e-142">Além disso, não há nenhuma maneira de um gravador determinar de dentro de [**CVssWriter:: onidentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) qual aplicativo gerou o evento de identificação.</span><span class="sxs-lookup"><span data-stu-id="b4f1e-142">In addition, there is no way for a writer to determine from within [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) which application has generated the Identify event.</span></span>

<span data-ttu-id="b4f1e-143">Considerando que um gravador pode receber vários eventos de identificação durante o processamento de uma operação de restauração, os gravadores nunca devem definir informações de estado no manipulador [**CVssWriter:: onidentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) .</span><span class="sxs-lookup"><span data-stu-id="b4f1e-143">Given that a writer may receive several Identify events while processing a restore operation, writers should never set state information in the [**CVssWriter::OnIdentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) handler.</span></span> <span data-ttu-id="b4f1e-144">Em vez disso, eles devem usar o mesmo algoritmo para criar o documento de metadados do gravador como foi feito durante as operações de backup (consulte as [ações do gravador durante a inicialização do backup](overview-of-backup-initialization.md) para obter mais informações).</span><span class="sxs-lookup"><span data-stu-id="b4f1e-144">Instead, they must use the same algorithm for creating their Writer Metadata Document as was done during backup operations (see [Writer Actions during Backup Initialization](overview-of-backup-initialization.md) for more information).</span></span>

 

 



