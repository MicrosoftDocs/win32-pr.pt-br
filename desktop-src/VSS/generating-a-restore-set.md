---
description: Um conjunto de restauração é uma lista de todos os arquivos a serem restaurados e os locais para os quais eles serão restaurados.
ms.assetid: 3196c26c-3407-4c00-a800-c3497df583e5
title: Gerando um conjunto de restauração
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: db3447ba6d258a5f22fff958761abc7ac0e4f27f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105763963"
---
# <a name="generating-a-restore-set"></a><span data-ttu-id="0bb2a-103">Gerando um conjunto de restauração</span><span class="sxs-lookup"><span data-stu-id="0bb2a-103">Generating A Restore Set</span></span>

<span data-ttu-id="0bb2a-104">Um conjunto de restauração é uma lista de todos os arquivos a serem restaurados e os locais para os quais eles serão restaurados.</span><span class="sxs-lookup"><span data-stu-id="0bb2a-104">A restore set is a list of all files to be restored and the locations to which they will be restored.</span></span>

<span data-ttu-id="0bb2a-105">Como ao gerar a lista de arquivos de backup (consulte [gerando um conjunto de backup](generating-a-backup-set.md)), um algoritmo para determinar quais arquivos restaurar e onde restaurá-los deve continuar a [*instância do gravador*](vssgloss-w.md) por instância do gravador e em uma base componente por componente para cada instância do gravador.</span><span class="sxs-lookup"><span data-stu-id="0bb2a-105">As when generating the backup file list (see [Generating A Backup Set](generating-a-backup-set.md)), an algorithm for determining which files to restore and where to restore them must proceed [*writer instance*](vssgloss-w.md) by writer instance, and on a component-by-component basis for each writer instance.</span></span>

<span data-ttu-id="0bb2a-106">É necessário associar cada arquivo na mídia de backup com o componente que o gerenciava.</span><span class="sxs-lookup"><span data-stu-id="0bb2a-106">It is necessary to associate each file on the backup media with the component that managed it.</span></span> <span data-ttu-id="0bb2a-107">Também é necessário obter o [*método Restore*](vssgloss-r.md)do componente de gerenciamento e as informações de [*destino de restauração*](vssgloss-r.md) do arquivo e seus [*mapeamentos de local alternativos*](vssgloss-a.md) (se houver).</span><span class="sxs-lookup"><span data-stu-id="0bb2a-107">It is also necessary to obtain the managing component's [*restore method*](vssgloss-r.md), and the file's [*restore target*](vssgloss-r.md) information, and its [*alternate location mappings*](vssgloss-a.md) (if any).</span></span>

<span data-ttu-id="0bb2a-108">Alguns arquivos também podem exigir operações de [*arquivos parciais*](vssgloss-p.md) ou [*destinos direcionados*](vssgloss-d.md) para restauração.</span><span class="sxs-lookup"><span data-stu-id="0bb2a-108">Some files may also require [*partial files*](vssgloss-p.md) operations or [*directed targets*](vssgloss-d.md) for restore.</span></span>

<span data-ttu-id="0bb2a-109">Ao examinar a seleção dos componentes [*de backup*](vssgloss-s.md) e de [*caminhos lógicos*](vssgloss-l.md) (consulte [trabalhando com a seleção e os caminhos lógicos](working-with-selectability-and-logical-paths.md)), um solicitante é capaz de determinar a estrutura de componentes da operação de backup que ele vai restaurar.</span><span class="sxs-lookup"><span data-stu-id="0bb2a-109">By examining the components' [*selectability for backup*](vssgloss-s.md) and [*logical paths*](vssgloss-l.md) (see [Working with Selectability and Logical Paths](working-with-selectability-and-logical-paths.md)), a requester is able to determine the component structure of the backup operation it is going to restore.</span></span>

<span data-ttu-id="0bb2a-110">Com a estrutura de componente do backup estabelecida, o solicitante pode obter informações de cada componente do [*conjunto de arquivos*](vssgloss-f.md) (especificação de arquivo, caminho e sinalizador de recursão).</span><span class="sxs-lookup"><span data-stu-id="0bb2a-110">With the component structure of the backup established, the requester can get each component's [*file set*](vssgloss-f.md) information (file specification, path, and recursion flag).</span></span> <span data-ttu-id="0bb2a-111">Um solicitante pode gerar um conjunto de restauração.</span><span class="sxs-lookup"><span data-stu-id="0bb2a-111">A requester can then generate a restore set.</span></span>

<span data-ttu-id="0bb2a-112">Arquivos que exigem [*arquivos parciais*](vssgloss-p.md)ou [*destinos direcionados*](vssgloss-d.md) fornecem suas próprias instruções de restauração detalhadas (consulte [locais de backup e restauração não padrão](non-default-backup-and-restore-locations.md)), que podem ser adicionados ao conjunto de restauração.</span><span class="sxs-lookup"><span data-stu-id="0bb2a-112">Files requiring [*partial files*](vssgloss-p.md), or [*directed targets*](vssgloss-d.md) provide their own detailed restoration instructions (see [Non-Default Backup and Restore Locations](non-default-backup-and-restore-locations.md)), which can then be added to the restore set.</span></span>

<span data-ttu-id="0bb2a-113">Um mecanismo típico para gerar um conjunto de restauração para arquivos não envolvidos em operações de arquivos parciais ou [*destinos direcionados*](vssgloss-d.md) pode continuar fazendo o seguinte:</span><span class="sxs-lookup"><span data-stu-id="0bb2a-113">A typical mechanism for generating a restore set for files not involved with partial files operations, or [*directed targets*](vssgloss-d.md) might proceed by doing the following:</span></span>

1.  <span data-ttu-id="0bb2a-114">Obtenha uma lista de arquivos na mídia de backup, incluindo seus caminhos originais.</span><span class="sxs-lookup"><span data-stu-id="0bb2a-114">Obtain a list of files on the backup media, including their original paths.</span></span>

2.  <span data-ttu-id="0bb2a-115">Identifique a [*classe*](vssgloss-w.md) e o componente do gravador para cada arquivo na mídia de backup, fazendo o seguinte:</span><span class="sxs-lookup"><span data-stu-id="0bb2a-115">Identify the [*writer class*](vssgloss-w.md) and component for each file on the backup media by doing the following:</span></span>

    -   <span data-ttu-id="0bb2a-116">Para cada gravador, obtenha informações de componente ([**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent)) chamando [**IVssExamineWriterMetadata:: GetComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) em todos os seus componentes.</span><span class="sxs-lookup"><span data-stu-id="0bb2a-116">For each writer, obtain component information ([**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent)) by calling [**IVssExamineWriterMetadata::GetComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) on all its components.</span></span>
    -   <span data-ttu-id="0bb2a-117">Para cada componente, obtenha informações de descritor de arquivo ([**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc)) para cada conjunto de arquivos que o componente contém (dependendo dos tipos de dados que o componente contém chamando [**IVssWMComponent:: GetFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getfile), [**IVssWMComponent:: getdatabasefile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabasefile)e [**IVssWMComponent:: GetDatabaseLogFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabaselogfile).</span><span class="sxs-lookup"><span data-stu-id="0bb2a-117">For each component, obtain file descriptor ([**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc)) information for every set of files the component contains (depending on the types of data the component contains by calling [**IVssWMComponent::GetFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getfile), [**IVssWMComponent::GetDatabaseFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabasefile), and [**IVssWMComponent::GetDatabaseLogFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabaselogfile).</span></span>
    -   <span data-ttu-id="0bb2a-118">Compare as informações de nome e caminho do arquivo em relação às retornada pelas informações de caminho contidas no descritor de arquivo para cada conjunto de arquivos em um componente (retornado por [**IVssWMFiledesc:: GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath), [**IVssWMFiledesc:: getspec**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getfilespec)e [**IVssWMFiledesc:: GetRecursive**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getrecursive)) em relação a informações de caminho de arquivos armazenados para determinar se o arquivo faz parte do componente.</span><span class="sxs-lookup"><span data-stu-id="0bb2a-118">Compare the file's name and path information against that returned by the path information contained in the file descriptor for each set of files in a component (returned by [**IVssWMFiledesc::GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath), [**IVssWMFiledesc::GetFilespec**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getfilespec), and [**IVssWMFiledesc::GetRecursive**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getrecursive)) against stored files path information to determine whether the file is part of the component.</span></span>
        > [!Note]  
        > <span data-ttu-id="0bb2a-119">Você deve ignorar todas as informações de local alternativo no descritor de arquivo recuperado de um componente encontrado em um documento de metadados do gravador armazenado (ou seja, [**IVssWMFiledesc:: GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) não retorna **NULL**).</span><span class="sxs-lookup"><span data-stu-id="0bb2a-119">You should ignore any alternate location information in the file descriptor retrieved from a component found in a stored Writer Metadata Document (that is, [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) does not return **NULL**).</span></span> <span data-ttu-id="0bb2a-120">Esse local alternativo é o [*caminho alternativo*](vssgloss-a.md), que é usado somente durante o backup.</span><span class="sxs-lookup"><span data-stu-id="0bb2a-120">This alternate location is the [*alternate path*](vssgloss-a.md), which is used only during backup.</span></span>

         

3.  <span data-ttu-id="0bb2a-121">Obtenha informações de mapeamento alternativo para cada arquivo na mídia de backup:</span><span class="sxs-lookup"><span data-stu-id="0bb2a-121">Obtain alternate mapping information for each file on the backup media:</span></span>

    -   <span data-ttu-id="0bb2a-122">Mapeamentos de arquivo alternativos são armazenados no gravador, não no nível de componente, e são obtidos do objeto [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) retornado por [**IVssExamineWriterMetadata:: GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping).</span><span class="sxs-lookup"><span data-stu-id="0bb2a-122">Alternate file mappings are stored at the writer, not the component level, and are obtained from the object [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) returned by [**IVssExamineWriterMetadata::GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping).</span></span>
    -   <span data-ttu-id="0bb2a-123">Você pode determinar se um arquivo específico tem um mapeamento de local alternativo verificando o caminho e o nome do arquivo em relação ao caminho e à especificação de arquivo contida no mapeamento de local alternativo retornado por [**IVssExamineWriterMetadata:: GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping), via [**IVssWMFiledesc:: GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath), [**IVssWMFiledesc:: filespec**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getfilespec)e [**IVssWMFiledesc:: GetRecursive**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getrecursive).</span><span class="sxs-lookup"><span data-stu-id="0bb2a-123">You can determine if a particular file has an alternate location mapping by checking the file's path and name against the path and file specification contained in the alternate location mapping returned by [**IVssExamineWriterMetadata::GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping), via [**IVssWMFiledesc::GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath), [**IVssWMFiledesc::GetFilespec**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getfilespec), and [**IVssWMFiledesc::GetRecursive**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getrecursive).</span></span> <span data-ttu-id="0bb2a-124">(Se um caminho alternativo foi usado durante o backup, essas informações devem ser ignoradas durante essa verificação no processamento de uma restauração.)</span><span class="sxs-lookup"><span data-stu-id="0bb2a-124">(If an alternate path was used during backup, that information should be ignored during this check in processing a restore.)</span></span>
    -   <span data-ttu-id="0bb2a-125">Se um arquivo e um mapeamento alternativo de descritores de arquivo corresponderem, você usará o método [**IVssWMFiledesc:: GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) do objeto [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) retornado por [**IVssExamineWriterMetadata:: GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) para localizar o local alternativo no qual você pode restaurar o arquivo.</span><span class="sxs-lookup"><span data-stu-id="0bb2a-125">If a file and an alternate location mappings file descriptors match, you then use the [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) method of the [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) object returned by [**IVssExamineWriterMetadata::GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) to find the alternate location to which you can restore the file.</span></span>
    -   <span data-ttu-id="0bb2a-126">O mapeamento de local alternativo obtido dessa maneira não concordará necessariamente com o retornado do documento de componentes de backup de [**IVssComponent:: GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span><span class="sxs-lookup"><span data-stu-id="0bb2a-126">The alternate location mapping obtained in this way will not necessarily agree with that returned from the Backup Components Document by [**IVssComponent::GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span></span> <span data-ttu-id="0bb2a-127">O valor de [**IVssWMFiledesc:: GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) não estará em branco somente se o mapeamento de local alternativo for usado para um arquivo.</span><span class="sxs-lookup"><span data-stu-id="0bb2a-127">The [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) value is nonblank only if the alternate location mapping is used for a file.</span></span>

4.  <span data-ttu-id="0bb2a-128">Com essas informações de arquivo e componente, o documento de componentes de backup pode ser consultado para obter informações sobre destinos de restauração, opções e novos locais de restauração para cada arquivo.</span><span class="sxs-lookup"><span data-stu-id="0bb2a-128">With this file and component information, the Backup Components Document can be queried to obtain information about restore targets, options, and new restore locations for each file.</span></span> <span data-ttu-id="0bb2a-129">Essas informações podem ser combinadas com a lista de arquivos, componentes e locais alternativos.</span><span class="sxs-lookup"><span data-stu-id="0bb2a-129">This information can be combined with the list of files, components, and alternate locations.</span></span>

5.  <span data-ttu-id="0bb2a-130">Os arquivos não protegidos por gravadores podem ser selecionados de maneira consistente com as operações de restauração tradicionais.</span><span class="sxs-lookup"><span data-stu-id="0bb2a-130">Files not protected by writers can be selected in a manner consistent with traditional restore operations.</span></span>

<span data-ttu-id="0bb2a-131">Neste ponto, um solicitante deve ter uma lista de todos os arquivos que precisa restaurar, juntamente com instruções sobre como restaurá-los e pode começar a restaurar arquivos com base em:</span><span class="sxs-lookup"><span data-stu-id="0bb2a-131">At this point, a requester should have a list of all the files it needs to restore, along with instructions about how to restore them, and can begin restoring files on the basis of:</span></span>

-   <span data-ttu-id="0bb2a-132">Se os mapeamentos de local alternativos ou o local do arquivo original serão usados como o destino para a restauração dependerão da presença ou da ausência de um arquivo nesse local de destino e nas configurações de componente do [**\_ \_ destino de restauração do VSS**](/windows/desktop/api/VsWriter/ne-vswriter-vss_restore_target) e da [**\_ \_ enumeração do VSS RESTOREMETHOD**](/windows/desktop/api/VsWriter/ne-vswriter-vss_restoremethod_enum) (consulte [locais de backup e restauração não padrão](non-default-backup-and-restore-locations.md)).</span><span class="sxs-lookup"><span data-stu-id="0bb2a-132">Whether alternate location mappings, or the original file location is to be used as the target for the restore will depend on the presence or absence of a file at that target location and component settings of [**VSS\_RESTORE\_TARGET**](/windows/desktop/api/VsWriter/ne-vswriter-vss_restore_target) and [**VSS\_RESTOREMETHOD\_ENUM**](/windows/desktop/api/VsWriter/ne-vswriter-vss_restoremethod_enum) (see [Non-Default Backup and Restore Locations](non-default-backup-and-restore-locations.md)).</span></span>
-   <span data-ttu-id="0bb2a-133">Se uma tentativa na restauração for realizada com sucesso dependerá de problemas como as permissões de acesso do destino, se os arquivos de destino estiverem bloqueados e outros problemas convencionais envolvidos na restauração de arquivos.</span><span class="sxs-lookup"><span data-stu-id="0bb2a-133">Whether an attempt at restoration succeeds will depend on issues such as the access permissions of the target, if target files are locked, and other conventional issues involved in file restoration.</span></span>
-   <span data-ttu-id="0bb2a-134">O êxito ou a falha da restauração de um determinado componente para uma determinada instância do gravador deve ser preservado no documento componentes de backup chamando [**IVssBackupComponents:: SetFileRestoreStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setfilerestorestatus).</span><span class="sxs-lookup"><span data-stu-id="0bb2a-134">The success or failure of restoring a given component for a given writer instance should be preserved in the Backup Components Document by calling [**IVssBackupComponents::SetFileRestoreStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setfilerestorestatus).</span></span> <span data-ttu-id="0bb2a-135">Isso tornará as informações acessíveis aos gravadores quando eles processarem o evento de restauração.</span><span class="sxs-lookup"><span data-stu-id="0bb2a-135">This will make the information accessible to writers when they process the PostRestore event.</span></span>
-   <span data-ttu-id="0bb2a-136">Se um arquivo for restaurado para um mapeamento de local alternativo, o solicitante deverá chamar [**IVssBackupComponents:: AddAlternativeLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addalternativelocationmapping).</span><span class="sxs-lookup"><span data-stu-id="0bb2a-136">If a file is restored to an alternate location mapping, the requester must call [**IVssBackupComponents::AddAlternativeLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addalternativelocationmapping).</span></span> <span data-ttu-id="0bb2a-137">Isso permitirá que os gravadores determinem se seus arquivos foram restaurados em locais alternativos por meio de [**IVssComponent:: GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span><span class="sxs-lookup"><span data-stu-id="0bb2a-137">This will allow writers to determine whether their files have been restored to alternate locations through the [**IVssComponent::GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span></span>
-   <span data-ttu-id="0bb2a-138">Os solicitantes podem achar desejável restaurar arquivos para locais completamente novos.</span><span class="sxs-lookup"><span data-stu-id="0bb2a-138">Requesters may find it desirable to restore files to completely new locations.</span></span> <span data-ttu-id="0bb2a-139">Isso é aceitável, mas o solicitante deve indicar isso ao gravador usando o método [**IVssBackupComponents:: AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget) .</span><span class="sxs-lookup"><span data-stu-id="0bb2a-139">This is acceptable, but the requester must indicate this to the writer by using the [**IVssBackupComponents::AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget) method.</span></span>

 

 



