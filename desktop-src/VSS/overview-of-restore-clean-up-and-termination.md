---
description: Após uma restauração, os gravadores verificam o status da operação para que possam fazer uso dos dados restaurados e lidar com erros.
ms.assetid: f9def67a-c4ea-4014-929f-51fbd10d770a
title: Visão geral da limpeza e término da restauração
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 391e029cdb109589b42240b5482f6aba2ff43555
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104010852"
---
# <a name="overview-of-restore-clean-up-and-termination"></a><span data-ttu-id="73d39-103">Visão geral da limpeza e término da restauração</span><span class="sxs-lookup"><span data-stu-id="73d39-103">Overview of Restore Clean up and Termination</span></span>

<span data-ttu-id="73d39-104">Após uma restauração, os gravadores verificam o status da operação para que possam fazer uso dos dados restaurados e lidar com erros.</span><span class="sxs-lookup"><span data-stu-id="73d39-104">Following a restore, writers check the status of the operation so that they can make use of the restored data and deal with errors.</span></span> <span data-ttu-id="73d39-105">O solicitante deve aguardar a conclusão desta atividade.</span><span class="sxs-lookup"><span data-stu-id="73d39-105">The requester must wait for the completion of this activity.</span></span> <span data-ttu-id="73d39-106">Para obter mais informações, consulte [visão geral do processamento de uma restauração no VSS](overview-of-processing-a-restore-under-vss.md).</span><span class="sxs-lookup"><span data-stu-id="73d39-106">For more information, see [Overview of Processing a Restore Under VSS](overview-of-processing-a-restore-under-vss.md).</span></span>

<span data-ttu-id="73d39-107">A tabela a seguir mostra a sequência de ações e eventos que são necessários depois que uma operação de restauração ocorre.</span><span class="sxs-lookup"><span data-stu-id="73d39-107">The following table shows the sequence of actions and events that are required after a restore operation has taken place.</span></span>



| <span data-ttu-id="73d39-108">Ação do solicitante</span><span class="sxs-lookup"><span data-stu-id="73d39-108">Requester action</span></span>                                                                                                                                                                                                                                                                                                                                                              | <span data-ttu-id="73d39-109">Evento</span><span class="sxs-lookup"><span data-stu-id="73d39-109">Event</span></span>                                                           | <span data-ttu-id="73d39-110">Ação do gravador</span><span class="sxs-lookup"><span data-stu-id="73d39-110">Writer action</span></span>                                                                                                                                                                                                                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="73d39-111">O solicitante indica o fim da restauração (consulte [**IVssBackupComponents::P ostrestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore)).</span><span class="sxs-lookup"><span data-stu-id="73d39-111">The requester indicates the end of the restore (see [**IVssBackupComponents::PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore)).</span></span>                                                                                                                                                                                                                                           | [<span data-ttu-id="73d39-112">*Restauração*</span><span class="sxs-lookup"><span data-stu-id="73d39-112">*PostRestore*</span></span>](vssgloss-p.md) | <span data-ttu-id="73d39-113">O gravador realiza a limpeza após a restauração e lida com falhas de restauração e arquivos que foram restaurados em locais não padrão (consulte [**CVssWriter:: OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore), [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent)).</span><span class="sxs-lookup"><span data-stu-id="73d39-113">The writer conducts post-restore cleanup, and handles restoration failures and files that have been restored to nonstandard locations (see [**CVssWriter::OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore), [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent)).</span></span> |
| <span data-ttu-id="73d39-114">O solicitante aguarda os gravadores para manipular o evento de [**restauração**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) com [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync).</span><span class="sxs-lookup"><span data-stu-id="73d39-114">The requester waits on writers to handle the [**PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) event with [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync).</span></span> <span data-ttu-id="73d39-115">Ele também deve verificar o status do gravador (consulte [**IVssBackupComponents:: GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents:: GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)).</span><span class="sxs-lookup"><span data-stu-id="73d39-115">It should also verify writer status (see [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)).</span></span> | <span data-ttu-id="73d39-116">Nenhum</span><span class="sxs-lookup"><span data-stu-id="73d39-116">None</span></span>                                                            | <span data-ttu-id="73d39-117">Nenhum</span><span class="sxs-lookup"><span data-stu-id="73d39-117">None</span></span>                                                                                                                                                                                                                                               |
| <span data-ttu-id="73d39-118">O solicitante libera a interface [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) .</span><span class="sxs-lookup"><span data-stu-id="73d39-118">The requester releases the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface.</span></span>                                                                                                                                                                                                                                                                                    | <span data-ttu-id="73d39-119">Nenhum</span><span class="sxs-lookup"><span data-stu-id="73d39-119">None</span></span>                                                            | <span data-ttu-id="73d39-120">Nenhum</span><span class="sxs-lookup"><span data-stu-id="73d39-120">None</span></span>                                                                                                                                                                                                                                               |



 

## <a name="requester-actions-during-cleanup-and-termination"></a><span data-ttu-id="73d39-121">Ações do solicitante durante a limpeza e o encerramento</span><span class="sxs-lookup"><span data-stu-id="73d39-121">Requester Actions during Cleanup and Termination</span></span>

<span data-ttu-id="73d39-122">Neste ponto, um solicitante indica o final de suas atividades de restauração de arquivo gerando um evento de [*restauração*](vssgloss-p.md) chamando [**IVssBackupComponents::P ostrestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore).</span><span class="sxs-lookup"><span data-stu-id="73d39-122">At this point, a requester indicates the end of its file restoration activities by generating a [*PostRestore*](vssgloss-p.md) event by calling [**IVssBackupComponents::PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore).</span></span>

<span data-ttu-id="73d39-123">As ações do solicitante são limitadas à espera nos gravadores, que talvez precisem executar alguma limpeza final e manipular erros de restauração e liberar a interface [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) depois que todos os gravadores tiverem retornado de manipular o evento de [*restauração*](vssgloss-p.md) .</span><span class="sxs-lookup"><span data-stu-id="73d39-123">The requester's actions are limited to waiting on the writers, which may need to perform some final cleanup and handle restore errors, and releasing the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface after all writers have returned from handling the [*PostRestore*](vssgloss-p.md) event.</span></span>

## <a name="writer-actions-during-cleanup-and-termination"></a><span data-ttu-id="73d39-124">Ações do gravador durante a limpeza e o encerramento</span><span class="sxs-lookup"><span data-stu-id="73d39-124">Writer Actions during Cleanup and Termination</span></span>

<span data-ttu-id="73d39-125">O evento [*Createrestore*](vssgloss-p.md) é tratado pelo método virtual [**CVssWriter:: OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore).</span><span class="sxs-lookup"><span data-stu-id="73d39-125">The [*PostRestore*](vssgloss-p.md) event is handled by the virtual method [**CVssWriter::OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore).</span></span> <span data-ttu-id="73d39-126">A implementação padrão simplesmente retorna **true** sem realizar nenhuma ação.</span><span class="sxs-lookup"><span data-stu-id="73d39-126">The default implementation simply returns **true** without taking any action.</span></span> <span data-ttu-id="73d39-127">Se um gravador precisar exercer mais controle sobre a situação após a restauração, ele poderá substituir esse método.</span><span class="sxs-lookup"><span data-stu-id="73d39-127">If a writer needs to exercise more control of the post-restore situation, it can override this method.</span></span>

<span data-ttu-id="73d39-128">Além de qualquer limpeza normal (como a remoção de arquivos temporários) que um gravador pode executar em [**CVssWriter:: OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore), ele pode lidar com o êxito ou a falha das operações de restauração.</span><span class="sxs-lookup"><span data-stu-id="73d39-128">In addition to any normal cleanup (such as removing temporary files) that a writer might perform in [**CVssWriter::OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore), it can handle the success or failure of restore operations.</span></span>

<span data-ttu-id="73d39-129">Como ele lida com erros de restauração, arquivos restaurados em um local alternativo e a necessidade de restaurações futuras está completamente no critério do escritor.</span><span class="sxs-lookup"><span data-stu-id="73d39-129">How it handles restore errors, files restored to an alternate location, and the need for future restores are completely at the writer's discretion.</span></span> <span data-ttu-id="73d39-130">As ações típicas podem incluir a comparação de arquivos em locais alternativos ou novos com arquivos em uso no momento, mesclando dados de vários arquivos ou iniciando novas sessões conectadas aos novos arquivos de dados.</span><span class="sxs-lookup"><span data-stu-id="73d39-130">Typical actions might include comparing files in alternate or new locations with files currently in use, merging data from multiple files, or starting new sessions connected to the new data files.</span></span> <span data-ttu-id="73d39-131">O VSS fornece os seguintes mecanismos para dar suporte a isso em uma base componente por componente:</span><span class="sxs-lookup"><span data-stu-id="73d39-131">VSS provides the following mechanisms for supporting this on a component-by-component basis:</span></span>

-   <span data-ttu-id="73d39-132">O êxito ou a falha na restauração de qualquer componente pode ser encontrado com [**IVssComponent:: GetFileRestoreStatus**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getfilerestorestatus).</span><span class="sxs-lookup"><span data-stu-id="73d39-132">Success or failure in restoring any component can be found with [**IVssComponent::GetFileRestoreStatus**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getfilerestorestatus).</span></span>
-   <span data-ttu-id="73d39-133">O uso de mapeamentos de local alternativo na restauração de arquivos será indicado por [**IVssComponent:: GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span><span class="sxs-lookup"><span data-stu-id="73d39-133">The use of alternate location mappings in restoring files will be indicated by [**IVssComponent::GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span></span>
-   <span data-ttu-id="73d39-134">Determinar se uma restauração é incremental e exigir restaurações adicionais é feita chamando [**IVssComponent:: GetAdditionalRestores**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getadditionalrestores).</span><span class="sxs-lookup"><span data-stu-id="73d39-134">Determining if a restore is incremental and will require further restores is done by calling [**IVssComponent::GetAdditionalRestores**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getadditionalrestores).</span></span> <span data-ttu-id="73d39-135">Os gravadores que precisam de uma restauração completa de seus dados não devem ser reiniciados até que esse método retorne FALSE.</span><span class="sxs-lookup"><span data-stu-id="73d39-135">Writers that need a complete restoration of their data should not restart until this method returns false.</span></span>
-   <span data-ttu-id="73d39-136">Os gravadores podem determinar se o solicitante precisava restaurar arquivos para um local não especificado anteriormente usando [**IVssComponent:: GetNewTargetCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtargetcount) e [**IVssComponent:: GetNewTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtarget)</span><span class="sxs-lookup"><span data-stu-id="73d39-136">Writers can determine if the requester has needed to restore files to a previously unspecified location using [**IVssComponent::GetNewTargetCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtargetcount) and [**IVssComponent::GetNewTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtarget)</span></span>

<span data-ttu-id="73d39-137">(Para obter mais informações sobre como restaurar arquivos para locais não padrão, consulte [locais de backup e restauração não padrão](non-default-backup-and-restore-locations.md).)</span><span class="sxs-lookup"><span data-stu-id="73d39-137">(For more information on restoring files to non-default locations, see [Non-Default Backup and Restore Locations](non-default-backup-and-restore-locations.md).)</span></span>

<span data-ttu-id="73d39-138">Assim como ocorre com qualquer método [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) , as informações retornadas por uma determinada instância se aplicam a esses componentes [*explicitamente incluídos*](vssgloss-e.md) para backup e qualquer um de seus [*inclusos implicitamente*](vssgloss-i.md) para subcomponentes de backup, incluindo os subcomponentes explicitamente incluídos para restauração pelo solicitante usando [**IVssBackupComponents:: AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent) (consulte [trabalhando com a seleção para restauração e subcomponentes](working-with-selectability-for-restore-and-subcomponents.md) para obter detalhes).</span><span class="sxs-lookup"><span data-stu-id="73d39-138">As with any [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) method, the information returned by a given instance applies to those components [*explicitly included*](vssgloss-e.md) for backup and any of its [*implicitly included*](vssgloss-i.md) for backup subcomponents, including those subcomponents explicitly included for restore by the requester using [**IVssBackupComponents::AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent) (see [Working with Selectability For Restore and Subcomponents](working-with-selectability-for-restore-and-subcomponents.md) for details).</span></span>

<span data-ttu-id="73d39-139">Como os gravadores precisarão acessar o documento de componentes de backup, é importante que o solicitante não libere a interface [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) até que os gravadores tenham terminado o processamento.</span><span class="sxs-lookup"><span data-stu-id="73d39-139">Because the writers will require access to the Backup Components Document, it is important that the requester not release the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface until writers have finished processing.</span></span>

 

 



