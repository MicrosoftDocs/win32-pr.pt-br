---
description: Assim como acontece com todas as operações importantes no VSS, os backups incrementais e diferenciais exigem uma cooperação próxima entre os solicitantes e os gravadores.
ms.assetid: 3cf5dd1f-dc58-42bc-925f-fee7d34053c5
title: Função de gravador no backup de repositórios complexos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 80864256b9a19c25a2f0dce0d0c929ed19fd7269
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "104090430"
---
# <a name="writer-role-in-backing-up-complex-stores"></a><span data-ttu-id="dea57-103">Função de gravador no backup de repositórios complexos</span><span class="sxs-lookup"><span data-stu-id="dea57-103">Writer Role in Backing Up Complex Stores</span></span>

<span data-ttu-id="dea57-104">Assim como acontece com todas as operações importantes no VSS, os backups [*incrementais*](vssgloss-i.md) e [*diferenciais*](vssgloss-d.md) exigem uma cooperação próxima entre os solicitantes e os gravadores.</span><span class="sxs-lookup"><span data-stu-id="dea57-104">As with all important operations under VSS, [*incremental*](vssgloss-i.md) and [*differential*](vssgloss-d.md) backups require close cooperation between requesters and writers.</span></span>

## <a name="backup-types"></a><span data-ttu-id="dea57-105">Tipos de backup</span><span class="sxs-lookup"><span data-stu-id="dea57-105">Backup Types</span></span>

<span data-ttu-id="dea57-106">A infraestrutura fornece suporte especial para cinco tipos de backup.</span><span class="sxs-lookup"><span data-stu-id="dea57-106">The infrastructure provides special support for five types of backup.</span></span> <span data-ttu-id="dea57-107">Elas são descritas da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="dea57-107">They are described as follows:</span></span>

-   <span data-ttu-id="dea57-108">Completo (**VSS \_ BT \_ completa**).</span><span class="sxs-lookup"><span data-stu-id="dea57-108">Full (**VSS\_BT\_FULL**).</span></span> <span data-ttu-id="dea57-109">O backup dos arquivos será feito independentemente da data do último backup.</span><span class="sxs-lookup"><span data-stu-id="dea57-109">Files will be backed up regardless of their last backup date.</span></span> <span data-ttu-id="dea57-110">O histórico de backup de cada arquivo será atualizado e esse tipo de backup poderá ser usado como a base de um backup incremental ou diferencial.</span><span class="sxs-lookup"><span data-stu-id="dea57-110">The backup history of each file will be updated, and this type of backup can be used as the basis of an incremental or differential backup.</span></span> <span data-ttu-id="dea57-111">Se houver arquivos de log, eles poderão ser truncados como resultado desse backup.</span><span class="sxs-lookup"><span data-stu-id="dea57-111">If there are log files, they may be truncated as a result of this backup.</span></span>

    <span data-ttu-id="dea57-112">A restauração de um backup completo requer apenas uma única imagem de backup.</span><span class="sxs-lookup"><span data-stu-id="dea57-112">Restoring a full backup requires only a single backup image.</span></span>

-   <span data-ttu-id="dea57-113">Diferencial **( \_ \_ diferencial do VSS BT**).</span><span class="sxs-lookup"><span data-stu-id="dea57-113">Differential (**VSS\_BT\_DIFFERENTIAL**).</span></span> <span data-ttu-id="dea57-114">A API do VSS é usada para garantir que apenas os arquivos que foram alterados ou adicionados desde o último backup completo sejam copiados para um meio de armazenamento; todas as informações de backup intermediários são ignoradas.</span><span class="sxs-lookup"><span data-stu-id="dea57-114">The VSS API is used to ensure that only files that have been changed or added since the last full backup are to be copied to a storage medium; all intermediate backup information is ignored.</span></span> <span data-ttu-id="dea57-115">Isso pode incluir arquivos inteiros ou intervalos específicos em arquivos.</span><span class="sxs-lookup"><span data-stu-id="dea57-115">This may include entire files, or specific ranges within files.</span></span> <span data-ttu-id="dea57-116">Um backup diferencial é associado a um backup completo e geralmente não pode ser restaurado até que o backup completo tenha sido restaurado.</span><span class="sxs-lookup"><span data-stu-id="dea57-116">A differential backup is associated with a full backup, and generally cannot be restored until the full backup has been restored.</span></span> <span data-ttu-id="dea57-117">Se houver arquivos de log, eles normalmente não serão truncados como resultado desse backup.</span><span class="sxs-lookup"><span data-stu-id="dea57-117">If there are log files, they will usually not be truncated as a result of this backup.</span></span>

    <span data-ttu-id="dea57-118">A restauração de um backup diferencial requer a imagem de backup original e a imagem de backup diferencial mais recente feita desde o último backup completo.</span><span class="sxs-lookup"><span data-stu-id="dea57-118">Restoring a differential backup requires the original backup image and the most recent differential backup image made since the last full backup.</span></span>

-   <span data-ttu-id="dea57-119">Incremental (**VSS \_ BT \_ incremental**).</span><span class="sxs-lookup"><span data-stu-id="dea57-119">Incremental (**VSS\_BT\_INCREMENTAL**).</span></span> <span data-ttu-id="dea57-120">A API do VSS é usada para garantir que apenas os arquivos que foram alterados ou adicionados desde o último backup completo ou incremental sejam copiados para um meio de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="dea57-120">The VSS API is used to ensure that only files that have been changed or added since the last full or incremental backup are to be copied to a storage medium.</span></span> <span data-ttu-id="dea57-121">Isso pode incluir arquivos inteiros ou intervalos específicos em arquivos.</span><span class="sxs-lookup"><span data-stu-id="dea57-121">This may include entire files, or specific ranges within files.</span></span> <span data-ttu-id="dea57-122">Alguns gravadores não permitem que backups incrementais sejam misturados com backups diferenciais.</span><span class="sxs-lookup"><span data-stu-id="dea57-122">Some writers do not allow incremental backups to be mixed with differential backups.</span></span> <span data-ttu-id="dea57-123">Se houver arquivos de log, eles poderão ser truncados como resultado desse backup.</span><span class="sxs-lookup"><span data-stu-id="dea57-123">If there are log files, they may be truncated as a result of this backup.</span></span>

    <span data-ttu-id="dea57-124">A restauração de um backup incremental requer a imagem de backup original e todas as imagens de backup incremental feitas desde o backup inicial.</span><span class="sxs-lookup"><span data-stu-id="dea57-124">Restoring an incremental backup requires the original backup image and all incremental backup images made since the initial backup.</span></span>

-   <span data-ttu-id="dea57-125">Backup de log **( \_ \_ log de BT VSS**).</span><span class="sxs-lookup"><span data-stu-id="dea57-125">Log Backup (**VSS\_BT\_LOG**).</span></span> <span data-ttu-id="dea57-126">Somente os arquivos de log de um gravador (arquivos adicionados a um componente com o método [**IVssCreateWriterMetadata:: AddDataBaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles) e recuperados por uma chamada para [**IVssWMComponent:: GetDatabaseLogFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabaselogfile)) serão submetidos a backup.</span><span class="sxs-lookup"><span data-stu-id="dea57-126">Only a writer's log files (files added to a component with the [**IVssCreateWriterMetadata::AddDataBaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles) method, and retrieved by a call to [**IVssWMComponent::GetDatabaseLogFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabaselogfile)) will be backed up.</span></span> <span data-ttu-id="dea57-127">Esse tipo de backup é específico do VSS.</span><span class="sxs-lookup"><span data-stu-id="dea57-127">This backup type is specific to VSS.</span></span> <span data-ttu-id="dea57-128">Backups de log tendem a ser usados com muita frequência.</span><span class="sxs-lookup"><span data-stu-id="dea57-128">Log backups tend to be taken quite frequently.</span></span> <span data-ttu-id="dea57-129">Normalmente, o arquivo de log será truncado como resultado desse backup.</span><span class="sxs-lookup"><span data-stu-id="dea57-129">Typically, the log file will be truncated as a result of this backup.</span></span>
-   <span data-ttu-id="dea57-130">Copiar backup (**\_ \_ cópia do VSS BT**).</span><span class="sxs-lookup"><span data-stu-id="dea57-130">Copy Backup (**VSS\_BT\_COPY**).</span></span> <span data-ttu-id="dea57-131">Assim como o \_ tipo de backup completo do VSS BT \_ , será feito backup dos arquivos, independentemente da data do último backup.</span><span class="sxs-lookup"><span data-stu-id="dea57-131">Like the VSS\_BT\_FULL backup type, files will be backed up regardless of their last backup date.</span></span> <span data-ttu-id="dea57-132">No entanto, o histórico de backup de cada arquivo não será atualizado e esse tipo de backup não poderá ser usado como a base de um backup incremental ou diferencial.</span><span class="sxs-lookup"><span data-stu-id="dea57-132">However, the backup history of each file will not be updated, and this type of backup cannot be used as the basis of an incremental or differential backup.</span></span> <span data-ttu-id="dea57-133">Os arquivos de log nunca devem ser truncados como resultado de um backup de cópia.</span><span class="sxs-lookup"><span data-stu-id="dea57-133">Log files should never be truncated as a result of a copy backup.</span></span>

<dl> <dt>

<span data-ttu-id="dea57-134"><span id="Partial_File_Support"></span><span id="partial_file_support"></span><span id="PARTIAL_FILE_SUPPORT"></span>Suporte a arquivos parciais</span><span class="sxs-lookup"><span data-stu-id="dea57-134"><span id="Partial_File_Support"></span><span id="partial_file_support"></span><span id="PARTIAL_FILE_SUPPORT"></span>Partial File Support</span></span>
</dt> <dd>

<span data-ttu-id="dea57-135">Alguns gravadores dão suporte à restauração de arquivos por meio da substituição de partes dos arquivos que eles gerenciam.</span><span class="sxs-lookup"><span data-stu-id="dea57-135">Some writers support file restoration through the overwriting of parts of the files they manage.</span></span> <span data-ttu-id="dea57-136">Um solicitante pode ser projetado para tirar proveito disso e, se for, ele indicará isso definindo as informações em [**IVssBackupComponents:: Setbackupstate**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate).</span><span class="sxs-lookup"><span data-stu-id="dea57-136">A requester may be designed to take advantage of this, and if so it indicates this by setting the information in [**IVssBackupComponents::SetBackupState**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupstate).</span></span>

</dd> </dl>

<span data-ttu-id="dea57-137">Os gravadores indicam que tipo de backups têm suporte chamando [**IVssCreateWriterMetadata:: SetBackupSchema**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema) ao processar o evento de [*identificação*](vssgloss-i.md) .</span><span class="sxs-lookup"><span data-stu-id="dea57-137">The writers indicate what type of backups are supported by calling [**IVssCreateWriterMetadata::SetBackupSchema**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema) while processing the [*Identify*](vssgloss-i.md) event.</span></span> <span data-ttu-id="dea57-138">O parâmetro *dsSchemaMask* para o método **IVssCreateWriterMetadata:: SetBackupSchema** é uma máscara de bits que indica quais tipos de backup têm suporte.</span><span class="sxs-lookup"><span data-stu-id="dea57-138">The *dsSchemaMask* parameter to the **IVssCreateWriterMetadata::SetBackupSchema** method is a bit mask indicating what types of backup are supported.</span></span> <span data-ttu-id="dea57-139">Todos os gravadores devem oferecer suporte a backups completos.</span><span class="sxs-lookup"><span data-stu-id="dea57-139">All writers must support full backups.</span></span>

<dl> <dt>

<span data-ttu-id="dea57-140"><span id="VSS_BS_DIFFERENTIAL"></span><span id="vss_bs_differential"></span>**\_diferencial do VSS BS \_**</span><span class="sxs-lookup"><span data-stu-id="dea57-140"><span id="VSS_BS_DIFFERENTIAL"></span><span id="vss_bs_differential"></span>**VSS\_BS\_DIFFERENTIAL**</span></span>
</dt> <dd>

<span data-ttu-id="dea57-141">Indica suporte para backups diferenciais.</span><span class="sxs-lookup"><span data-stu-id="dea57-141">Indicates support for differential backups.</span></span>

</dd> <dt>

<span data-ttu-id="dea57-142"><span id="VSS_BS_INCREMENTAL"></span><span id="vss_bs_incremental"></span>**INCREMENTAL do VSS \_ BS \_**</span><span class="sxs-lookup"><span data-stu-id="dea57-142"><span id="VSS_BS_INCREMENTAL"></span><span id="vss_bs_incremental"></span>**VSS\_BS\_INCREMENTAL**</span></span>
</dt> <dd>

<span data-ttu-id="dea57-143">Indica suporte para backups incrementais.</span><span class="sxs-lookup"><span data-stu-id="dea57-143">Indicates support for incremental backups.</span></span>

</dd> <dt>

<span data-ttu-id="dea57-144"><span id="VSS_BS_LOG"></span><span id="vss_bs_log"></span>**\_log de BS do VSS \_**</span><span class="sxs-lookup"><span data-stu-id="dea57-144"><span id="VSS_BS_LOG"></span><span id="vss_bs_log"></span>**VSS\_BS\_LOG**</span></span>
</dt> <dd>

<span data-ttu-id="dea57-145">Indica suporte para backups de log.</span><span class="sxs-lookup"><span data-stu-id="dea57-145">Indicates support for log backups.</span></span>

</dd> <dt>

<span data-ttu-id="dea57-146"><span id="VSS_BS_COPY"></span><span id="vss_bs_copy"></span>**cópia do VSS \_ BS \_**</span><span class="sxs-lookup"><span data-stu-id="dea57-146"><span id="VSS_BS_COPY"></span><span id="vss_bs_copy"></span>**VSS\_BS\_COPY**</span></span>
</dt> <dd>

<span data-ttu-id="dea57-147">Indica suporte para backups de cópia.</span><span class="sxs-lookup"><span data-stu-id="dea57-147">Indicates support for copy backups.</span></span>

</dd> <dt>

<span data-ttu-id="dea57-148"><span id="VSS_BS_EXCLUSIVE_INCREMENTAL_DIFFERENTIAL"></span><span id="vss_bs_exclusive_incremental_differential"></span>**\_ \_ \_ diferencial incremental exclusivo do VSS BS \_**</span><span class="sxs-lookup"><span data-stu-id="dea57-148"><span id="VSS_BS_EXCLUSIVE_INCREMENTAL_DIFFERENTIAL"></span><span id="vss_bs_exclusive_incremental_differential"></span>**VSS\_BS\_EXCLUSIVE\_INCREMENTAL\_DIFFERENTIAL**</span></span>
</dt> <dd>

<span data-ttu-id="dea57-149">Indica que um gravador não dá suporte à combinação de backups incrementais com backups diferenciais.</span><span class="sxs-lookup"><span data-stu-id="dea57-149">Indicates that a writer does not support mixing incremental backups with differential backups.</span></span>

</dd> </dl>

<span data-ttu-id="dea57-150">O gravador pode determinar que tipo de backup está sendo executado chamando [**CVssWriter:: Getbackuptype**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-getbackuptype).</span><span class="sxs-lookup"><span data-stu-id="dea57-150">The writer can determine what type of backup is being performed by calling [**CVssWriter::GetBackupType**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-getbackuptype).</span></span> <span data-ttu-id="dea57-151">O ponto mais antigo quando isso pode ser executado é durante o processamento do evento PrepareForBackup.</span><span class="sxs-lookup"><span data-stu-id="dea57-151">The earliest point when this can be performed is while processing the PrepareForBackup event.</span></span> <span data-ttu-id="dea57-152">**CVssWriter:: Getbackuptype** retornará um membro da enumeração de [**\_ \_ tipo de backup do VSS**](/windows/desktop/api/Vss/ne-vss-vss_backup_type) .</span><span class="sxs-lookup"><span data-stu-id="dea57-152">**CVssWriter::GetBackupType** will return a member of the [**VSS\_BACKUP\_TYPE**](/windows/desktop/api/Vss/ne-vss-vss_backup_type) enumeration.</span></span> <span data-ttu-id="dea57-153">Se o gravador não oferecer suporte ao tipo de backup, o gravador deverá tratar o backup como um backup completo.</span><span class="sxs-lookup"><span data-stu-id="dea57-153">If the backup type is not supported by the writer, then the writer should treat the backup as a full backup.</span></span>

## <a name="backup-stamps"></a><span data-ttu-id="dea57-154">Carimbos de backup</span><span class="sxs-lookup"><span data-stu-id="dea57-154">Backup Stamps</span></span>

<span data-ttu-id="dea57-155">Backups incrementais e diferenciais sempre estão associados a um backup anterior.</span><span class="sxs-lookup"><span data-stu-id="dea57-155">Incremental and differential backups are always tied to a previous backup.</span></span> <span data-ttu-id="dea57-156">Há duas maneiras de unir os backups.</span><span class="sxs-lookup"><span data-stu-id="dea57-156">There are two ways to tie backups.</span></span> <span data-ttu-id="dea57-157">Para armazenamentos de dados simples, o solicitante pode controlar a correlação entre backups.</span><span class="sxs-lookup"><span data-stu-id="dea57-157">For simple data stores, the requester can keep track of the correlation between backups.</span></span> <span data-ttu-id="dea57-158">No entanto, para armazenamentos de dados mais complexos, o gravador precisará manter seu próprio carimbo de data/hora com o backup; esse carimbo de data/hora pode manter o controle da posição do log, das informações do ponto de verificação e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="dea57-158">However, for more complex data stores, the writer will need to maintain its own timestamp with the backup; this timestamp may keep track of log position, checkpoint information, and so on.</span></span> <span data-ttu-id="dea57-159">Um gravador indica que ele precisa de seus próprios carimbos de data/hora Configurando o bit de **\_ \_ marca** de e/ou/ou-ou-ou-ou-ou- [**IVssCreateWriterMetadata:: SetBackupSchema**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema)</span><span class="sxs-lookup"><span data-stu-id="dea57-159">A writer indicates that it needs its own timestamps by setting the **VSS\_BS\_TIMESTAMPED** bit when it calls [**IVssCreateWriterMetadata::SetBackupSchema**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema).</span></span>

<span data-ttu-id="dea57-160">Um gravador pode armazenar um carimbo de data/hora com cada componente que está sendo submetido a backup.</span><span class="sxs-lookup"><span data-stu-id="dea57-160">A writer can store a timestamp with each component that is being backed up.</span></span> <span data-ttu-id="dea57-161">O gravador armazena o carimbo de data/hora chamando [**IVssComponent:: SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp)e passando uma representação de cadeia de caracteres do carimbo para o parâmetro *wszBackupStamp* .</span><span class="sxs-lookup"><span data-stu-id="dea57-161">The writer stores the timestamp by calling [**IVssComponent::SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp), and passing in a string representation of the stamp for the *wszBackupStamp* parameter.</span></span> <span data-ttu-id="dea57-162">Em geral, um gravador chamará esse método durante o processamento do evento de [*instantâneo*](vssgloss-p.md) .</span><span class="sxs-lookup"><span data-stu-id="dea57-162">Generally, a writer will call this method while processing the [*PostSnapshot*](vssgloss-p.md) event.</span></span> <span data-ttu-id="dea57-163">No entanto, para backups que não envolvem uma cópia de sombra, o evento de pós-instantâneo não será enviado.</span><span class="sxs-lookup"><span data-stu-id="dea57-163">However, for backups that do not involve a shadow copy, the PostSnapshot event will not be sent.</span></span> <span data-ttu-id="dea57-164">Nesse caso, **IVssComponent:: SetBackupStamp** deve ser chamado durante o processamento do evento [*PrepareForBackup*](vssgloss-p.md) .</span><span class="sxs-lookup"><span data-stu-id="dea57-164">In this case, **IVssComponent::SetBackupStamp** must be called while processing the [*PrepareForBackup*](vssgloss-p.md) event.</span></span>

<span data-ttu-id="dea57-165">Quando um backup incremental ou diferencial estiver sendo executado, o solicitante indicará ao gravador o carimbo de backup do backup anterior que está servindo como base para esse backup.</span><span class="sxs-lookup"><span data-stu-id="dea57-165">When an incremental or differential backup is being performed, the requester will indicate to the writer the backup stamp of the previous backup that is serving as a base for this backup.</span></span> <span data-ttu-id="dea57-166">O gravador pode acessar este carimbo de backup anterior ao processar o evento PrepareForBackup ou pós-instantâneo, chamando [**IVssComponent:: GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp).</span><span class="sxs-lookup"><span data-stu-id="dea57-166">The writer can access this previous backup stamp while processing either the PrepareForBackup or PostSnapshot event, by calling [**IVssComponent::GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp).</span></span> <span data-ttu-id="dea57-167">O gravador pode usar o carimbo retornado para determinar o que precisa ser feito backup.</span><span class="sxs-lookup"><span data-stu-id="dea57-167">The writer can use the returned stamp to determine what needs to be backed up.</span></span>

## <a name="backup-strategies"></a><span data-ttu-id="dea57-168">Estratégias de backup</span><span class="sxs-lookup"><span data-stu-id="dea57-168">Backup Strategies</span></span>

### <a name="file-backup-files-strategies"></a><span data-ttu-id="dea57-169">Estratégias de arquivos de backup de arquivo</span><span class="sxs-lookup"><span data-stu-id="dea57-169">File Backup Files Strategies</span></span>

<span data-ttu-id="dea57-170">Geralmente, determinados arquivos relatados nos metadados do gravador precisam apenas de backup ao executar determinados tipos de backup.</span><span class="sxs-lookup"><span data-stu-id="dea57-170">Often, certain files reported in the writer metadata need only be backed up when performing certain types of backup.</span></span> <span data-ttu-id="dea57-171">Alguns arquivos só podem ser necessários ao executar um backup completo.</span><span class="sxs-lookup"><span data-stu-id="dea57-171">Some files may only be required when performing a full backup.</span></span> <span data-ttu-id="dea57-172">Outros arquivos só podem ser necessários ao executar um backup incremental ou diferencial.</span><span class="sxs-lookup"><span data-stu-id="dea57-172">Other files may only be required when performing an incremental or differential backup.</span></span> <span data-ttu-id="dea57-173">O VSS fornece um método para que os gravadores indiquem essas informações para o solicitante.</span><span class="sxs-lookup"><span data-stu-id="dea57-173">VSS provides a method for the writers to indicate this information to the requester.</span></span> <span data-ttu-id="dea57-174">Ao adicionar arquivos a componentes usando [**IVssCreateWriterMetadata:: AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**IVssCreateWriterMetadata:: AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles)ou [**IVssCreateWriterMetadata:: AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup), o parâmetro *dwBackupTypeMask* indica para quais tipos de backup esses arquivos devem ser submetidos a backup.</span><span class="sxs-lookup"><span data-stu-id="dea57-174">When adding files to components using [**IVssCreateWriterMetadata::AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**IVssCreateWriterMetadata::AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles), or [**IVssCreateWriterMetadata::AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup), the *dwBackupTypeMask* parameter indicates for which backup types these files must be backed up.</span></span> <span data-ttu-id="dea57-175">A máscara pode conter um ou mais dos seguintes valores:</span><span class="sxs-lookup"><span data-stu-id="dea57-175">The mask can contain one or more of the following values:</span></span>

<dl> <dt>

<span data-ttu-id="dea57-176"><span id="VSS_FSBT_FULL_BACKUP_REQUIRED"></span><span id="vss_fsbt_full_backup_required"></span>**\_backup completo do VSS FSBT \_ \_ \_ necessário**</span><span class="sxs-lookup"><span data-stu-id="dea57-176"><span id="VSS_FSBT_FULL_BACKUP_REQUIRED"></span><span id="vss_fsbt_full_backup_required"></span>**VSS\_FSBT\_FULL\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="dea57-177">Necessário para backups completos.</span><span class="sxs-lookup"><span data-stu-id="dea57-177">Required for full backups.</span></span>

</dd> <dt>

<span data-ttu-id="dea57-178"><span id="VSS_FSBT_DIFFERENTIAL_BACKUP_REQUIRED"></span><span id="vss_fsbt_differential_backup_required"></span>**\_ \_ backup diferencial do VSS FSBT \_ \_ necessário**</span><span class="sxs-lookup"><span data-stu-id="dea57-178"><span id="VSS_FSBT_DIFFERENTIAL_BACKUP_REQUIRED"></span><span id="vss_fsbt_differential_backup_required"></span>**VSS\_FSBT\_DIFFERENTIAL\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="dea57-179">Necessário para backups diferenciais.</span><span class="sxs-lookup"><span data-stu-id="dea57-179">Required for differential backups.</span></span>

</dd> <dt>

<span data-ttu-id="dea57-180"><span id="VSS_FSBT_INCREMENTAL_BACKUP_REQUIRED"></span><span id="vss_fsbt_incremental_backup_required"></span>**\_backup incremental do VSS FSBT \_ \_ \_ necessário**</span><span class="sxs-lookup"><span data-stu-id="dea57-180"><span id="VSS_FSBT_INCREMENTAL_BACKUP_REQUIRED"></span><span id="vss_fsbt_incremental_backup_required"></span>**VSS\_FSBT\_INCREMENTAL\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="dea57-181">Necessário para backups incrementais.</span><span class="sxs-lookup"><span data-stu-id="dea57-181">Required for incremental backups.</span></span>

</dd> <dt>

<span data-ttu-id="dea57-182"><span id="VSS_FSBT_LOG_BACKUP_REQUIRED"></span><span id="vss_fsbt_log_backup_required"></span>**\_backup de log FSBT do VSS \_ \_ \_ necessário**</span><span class="sxs-lookup"><span data-stu-id="dea57-182"><span id="VSS_FSBT_LOG_BACKUP_REQUIRED"></span><span id="vss_fsbt_log_backup_required"></span>**VSS\_FSBT\_LOG\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="dea57-183">Necessário para backups de log.</span><span class="sxs-lookup"><span data-stu-id="dea57-183">Required for log backups.</span></span>

</dd> <dt>

<span data-ttu-id="dea57-184"><span id="VSS_FSBT_ALL_BACKUP_REQUIRED"></span><span id="vss_fsbt_all_backup_required"></span>**BACKUP do VSS \_ FSBT \_ todo \_ \_ necessário**</span><span class="sxs-lookup"><span data-stu-id="dea57-184"><span id="VSS_FSBT_ALL_BACKUP_REQUIRED"></span><span id="vss_fsbt_all_backup_required"></span>**VSS\_FSBT\_ALL\_BACKUP\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="dea57-185">Necessário para todos os tipos de backup; Esse é o padrão.</span><span class="sxs-lookup"><span data-stu-id="dea57-185">Required for all backup types; this is the default.</span></span>

</dd> </dl>

<span data-ttu-id="dea57-186">Essa especificação substitui a especificação de seletividade do componente.</span><span class="sxs-lookup"><span data-stu-id="dea57-186">This specification overrides the component's selectivity specification.</span></span> <span data-ttu-id="dea57-187">Por exemplo, considere um componente cujos arquivos são todos marcados com **o \_ backup de log FSBT do VSS \_ \_ \_ necessário** , mas não com o **\_ backup completo do VSS FSBT \_ \_ \_ necessário**.</span><span class="sxs-lookup"><span data-stu-id="dea57-187">For example, consider a component whose files are all marked with **VSS\_FSBT\_LOG\_BACKUP\_REQUIRED** but not with **VSS\_FSBT\_FULL\_BACKUP\_REQUIRED**.</span></span> <span data-ttu-id="dea57-188">Suponha que esse componente não seja selecionável para backup (*bSelectable* foi falso quando [**IVssCreateWriterMetadata:: addComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponent) foi chamado).</span><span class="sxs-lookup"><span data-stu-id="dea57-188">Suppose this component is not selectable for backup (*bSelectable* was false when [**IVssCreateWriterMetadata::AddComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponent) was called).</span></span> <span data-ttu-id="dea57-189">No caso de um backup de log, isso significa que sempre é necessário fazer backup de todos os arquivos nesse componente.</span><span class="sxs-lookup"><span data-stu-id="dea57-189">In the case of a log backup, this means that all the files in this component must always be backed up.</span></span> <span data-ttu-id="dea57-190">No entanto, no caso de um backup completo, nenhum dos arquivos precisa ser submetido a backup, apesar do fato de que a seletividade do componente implica que deve ser feito o backup.</span><span class="sxs-lookup"><span data-stu-id="dea57-190">However, in the case of a full backup, none of the files need to be backed up, despite the fact that the component's selectivity implies it should be backed up.</span></span>

### <a name="backup-by-last-modify-time"></a><span data-ttu-id="dea57-191">Backup por hora da última modificação</span><span class="sxs-lookup"><span data-stu-id="dea57-191">Backup By Last Modify Time</span></span>

<span data-ttu-id="dea57-192">Uma maneira de um gravador indicar quais arquivos foram alterados é usando o mecanismo de arquivo diferenciado.</span><span class="sxs-lookup"><span data-stu-id="dea57-192">One way for a writer to indicate what files have changed is by using the differenced file mechanism.</span></span> <span data-ttu-id="dea57-193">Um gravador pode especificar que determinados arquivos em um componente só devem ser submetidos a backup se tiverem sido modificados desde um determinado momento.</span><span class="sxs-lookup"><span data-stu-id="dea57-193">A writer can specify that certain files in a component should only be backed up if they have been modified since a certain time.</span></span> <span data-ttu-id="dea57-194">O gravador chama [**IVssComponent:: AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) com uma especificação de arquivo e uma hora da última modificação.</span><span class="sxs-lookup"><span data-stu-id="dea57-194">The writer calls [**IVssComponent::AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) with a file specification and a last modify time.</span></span> <span data-ttu-id="dea57-195">**IVssComponent:: AddDifferencedFilesByLastModifyTime** normalmente é chamado durante o processamento do evento de pós-instantâneo, embora possa ser chamado durante o processamento do evento PrepareForBackup.</span><span class="sxs-lookup"><span data-stu-id="dea57-195">**IVssComponent::AddDifferencedFilesByLastModifyTime** is typically called while processing the PostSnapshot event, although it can be called while processing the PrepareForBackup event.</span></span> <span data-ttu-id="dea57-196">O solicitante deve fazer backup de todos os arquivos que correspondem à especificação de arquivo que foi alterada desde o tempo especificado.</span><span class="sxs-lookup"><span data-stu-id="dea57-196">The requester must then back up all files matching the file specification that have changed since the specified time.</span></span> <span data-ttu-id="dea57-197">Se o gravador estiver usando o mecanismo de carimbo de backup, essa última hora de modificação será determinada com base no carimbo de backup anterior no documento de backup.</span><span class="sxs-lookup"><span data-stu-id="dea57-197">If the writer is using the backup stamp mechanism, this last modify time will be determined based on the previous backup stamp in the backup document.</span></span> <span data-ttu-id="dea57-198">O gravador também pode passar zero para a hora da última modificação, o que indica que o solicitante é responsável por determinar o tempo do último backup e que os arquivos foram alterados desde o momento.</span><span class="sxs-lookup"><span data-stu-id="dea57-198">The writer can also pass in zero for the last modify time, which indicates that the requester is responsible for determining the time of the last backup and the files changed since that time.</span></span>

### <a name="partial-file-backup"></a><span data-ttu-id="dea57-199">Backup de arquivo parcial</span><span class="sxs-lookup"><span data-stu-id="dea57-199">Partial File Backup</span></span>

<span data-ttu-id="dea57-200">Outra maneira de um gravador indicar alterações no solicitante é usando o mecanismo de arquivo parcial.</span><span class="sxs-lookup"><span data-stu-id="dea57-200">Another way for a writer to indicate changes to the requester is by using the partial-file mechanism.</span></span> <span data-ttu-id="dea57-201">Um gravador pode especificar intervalos de bytes em arquivos de componentes que precisam ser copiados em backup; o gravador pode especificar esses intervalos de arquivos durante o processamento do evento de PrepareForBackup ou do instantâneo.</span><span class="sxs-lookup"><span data-stu-id="dea57-201">A writer can specify byte ranges within component files that need to be backed up; the writer may specify these file ranges while processing either the PostSnapshot or PrepareForBackup event.</span></span> <span data-ttu-id="dea57-202">O gravador chama [**IVssComponent:: Addparcialfile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) para adicionar especificações de arquivo parcial ao backup.</span><span class="sxs-lookup"><span data-stu-id="dea57-202">The writer calls [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) to add partial file specifications to the backup.</span></span> <span data-ttu-id="dea57-203">Uma especificação de arquivo parcial consiste em um caminho e um nome de arquivo juntamente com informações sobre quais intervalos no arquivo precisam ser copiados em backup.</span><span class="sxs-lookup"><span data-stu-id="dea57-203">A partial file specification consists of a path and file name together with information about what ranges in the file need to be backed up.</span></span>

### <a name="file-specification-rules"></a><span data-ttu-id="dea57-204">Regras de especificação de arquivo</span><span class="sxs-lookup"><span data-stu-id="dea57-204">File Specification Rules</span></span>

<span data-ttu-id="dea57-205">[**IVssComponent:: AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) ou [**IVssComponent:: addpartialfile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) pode ser usado para modificar as especificações de arquivo fornecidas durante o evento de identificação ou para adicionar arquivos completamente novos à especificação.</span><span class="sxs-lookup"><span data-stu-id="dea57-205">[**IVssComponent::AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) or [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) can both be used to modify file specifications given during the Identify event, or to add completely new files to the specification.</span></span> <span data-ttu-id="dea57-206">Se o gravador estiver modificando as informações definidas durante o evento de identificação usando **IVssComponent:: AddDifferencedFilesByLastModifyTime**, a especificação de arquivo deverá corresponder exatamente a uma das especificações de arquivo no componente atual.</span><span class="sxs-lookup"><span data-stu-id="dea57-206">If the writer is modifying information set during the Identify event using **IVssComponent::AddDifferencedFilesByLastModifyTime**, then the file specification must exactly match one of the file specifications in the current component.</span></span> <span data-ttu-id="dea57-207">A especificação do arquivo não deve sobrepor parcialmente os arquivos no componente atual e não deve corresponder a arquivos em nenhum outro componente.</span><span class="sxs-lookup"><span data-stu-id="dea57-207">The file specification must not partially overlap files in the current component, and it must not match files in any other components.</span></span> <span data-ttu-id="dea57-208">Os arquivos especificados usando **IVssComponent:: Addparcialfile** podem, no entanto, sobrepor parcialmente outra especificação de arquivo.</span><span class="sxs-lookup"><span data-stu-id="dea57-208">Files specified using **IVssComponent::AddPartialFile** can, however, partially overlap another file specification.</span></span> <span data-ttu-id="dea57-209">As informações definidas por **IVssComponent:: AddDifferencedFilesByLastModifyTime** ou **IVssComponent:: addpartialfile** substitui o conjunto de informações anteriormente usando a interface [**IVssCreateWriterMetadata**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata) em resposta ao evento de identificação.</span><span class="sxs-lookup"><span data-stu-id="dea57-209">Information set by **IVssComponent::AddDifferencedFilesByLastModifyTime** or **IVssComponent::AddPartialFile** overrides the information set earlier using the [**IVssCreateWriterMetadata**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata) interface in response to the Identify event.</span></span>

<span data-ttu-id="dea57-210">As especificações de arquivo geral podem ter um valor de local alternativo (definido pelo parâmetro *wszAlternateLocation* de [**IVssCreateWriterMetadata:: AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)) que indica um local alternativo para obter o arquivo no momento do backup.</span><span class="sxs-lookup"><span data-stu-id="dea57-210">General file specifications can have an alternate-location value (set by the *wszAlternateLocation* parameter of [**IVssCreateWriterMetadata::AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)) that indicates an alternate location to obtain the file from at backup time.</span></span> <span data-ttu-id="dea57-211">Se a especificação de arquivo definida por meio dos mecanismos diferenciados-arquivo ou arquivo parcial corresponder a uma especificação de arquivo existente que tenha um local alternativo, o aplicativo de backup obterá os dados desse local alternativo.</span><span class="sxs-lookup"><span data-stu-id="dea57-211">If the file specification set through the differenced-file or partial-file mechanisms matches an existing file specification that has an alternate location, the backup application will obtain the data from this alternate location.</span></span>

<span data-ttu-id="dea57-212">Se a especificação de arquivo definida em [**IVssComponent:: AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) ou em [**IVssComponent:: addpartialfile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) não corresponder e arquivos no componente que estão sendo submetidos a backup, todos os arquivos correspondentes agora serão adicionados ao backup.</span><span class="sxs-lookup"><span data-stu-id="dea57-212">If the file specification set in [**IVssComponent::AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) or in [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile) does not match and files in the component that are being backed up, then all matching files are now added to the backup.</span></span> <span data-ttu-id="dea57-213">Deve-se ter cuidado para que o gravador só adicione arquivos que existam em um volume que já esteja sendo copiado em sombra ao fazer isso; caso contrário, o solicitante pode falhar ao fazer backup desses arquivos.</span><span class="sxs-lookup"><span data-stu-id="dea57-213">Care must be taken that the writer only adds files that exist on a volume that is already being shadow copied while doing this; otherwise, the requester may fail to back up these files.</span></span> <span data-ttu-id="dea57-214">Se essas funções forem chamadas durante o processamento do evento de pós-instantâneo, isso poderá ser determinado usando o método [**CVssWriter:: IsPathAffected**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispathaffected) .</span><span class="sxs-lookup"><span data-stu-id="dea57-214">If these functions are called while processing the PostSnapshot event, this can be determined by using the [**CVssWriter::IsPathAffected**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispathaffected) method.</span></span> <span data-ttu-id="dea57-215">Se chamado ao manipular o evento PrepareForBackup, o gravador deve fazer essa determinação usando outro método.</span><span class="sxs-lookup"><span data-stu-id="dea57-215">If called while handling the PrepareForBackup event, the writer must make this determination using another method.</span></span>

### <a name="backup-without-a-shadow-copy"></a><span data-ttu-id="dea57-216">Backup sem uma cópia de sombra</span><span class="sxs-lookup"><span data-stu-id="dea57-216">Backup Without a Shadow Copy</span></span>

<span data-ttu-id="dea57-217">É possível que certos tipos de arquivos não precisem ser submetidos a backup de um volume de cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="dea57-217">Certain types of files may not need to be backed up off of a shadow copy volume.</span></span> <span data-ttu-id="dea57-218">Por exemplo, isso geralmente será verdadeiro para arquivos de log de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="dea57-218">For example, this will often be true of database log files.</span></span> <span data-ttu-id="dea57-219">Como os arquivos de log crescem de forma monotônico, e um gravador pode especificar exatamente quais partes do arquivo fazer backup usando arquivos parciais, muitas vezes será possível fazer backup do volume original.</span><span class="sxs-lookup"><span data-stu-id="dea57-219">Since log files grow monotonically, and a writer can specify exactly what portions of the file to back up using partial files, it will often be possible to back up the log off the original volume.</span></span> <span data-ttu-id="dea57-220">Como uma otimização, um gravador pode marcar quais arquivos exigem cópias de sombra para diferentes tipos de backup usando os sinalizadores definidos no parâmetro *dwBackupTypeMask* de [**IVssCreateWriterMetadata:: AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**IVssCreateWriterMetadata:: AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles)ou [**IVssCreateWriterMetadata:: AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup).</span><span class="sxs-lookup"><span data-stu-id="dea57-220">As an optimization, a writer can mark which files require shadow copies for different backup types using the flags set in the *dwBackupTypeMask* parameter of [**IVssCreateWriterMetadata::AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**IVssCreateWriterMetadata::AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles), or [**IVssCreateWriterMetadata::AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup).</span></span> <span data-ttu-id="dea57-221">Os sinalizadores com suporte incluem o seguinte:</span><span class="sxs-lookup"><span data-stu-id="dea57-221">Supported flags include the following:</span></span>

<dl> <dt>

<span data-ttu-id="dea57-222"><span id="VSS_FSBT_FULL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_full_snapshot_required"></span>**\_instantâneo completo do VSS FSBT \_ \_ \_ necessário**</span><span class="sxs-lookup"><span data-stu-id="dea57-222"><span id="VSS_FSBT_FULL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_full_snapshot_required"></span>**VSS\_FSBT\_FULL\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="dea57-223">Cópia de sombra necessária para backups completos.</span><span class="sxs-lookup"><span data-stu-id="dea57-223">Shadow copy required for full backups.</span></span>

</dd> <dt>

<span data-ttu-id="dea57-224"><span id="VSS_FSBT_DIFFERENTIAL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_differential_snapshot_required"></span>**\_ \_ instantâneo diferencial do VSS FSBT \_ \_ necessário**</span><span class="sxs-lookup"><span data-stu-id="dea57-224"><span id="VSS_FSBT_DIFFERENTIAL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_differential_snapshot_required"></span>**VSS\_FSBT\_DIFFERENTIAL\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="dea57-225">Cópia de sombra necessária para backups diferenciais.</span><span class="sxs-lookup"><span data-stu-id="dea57-225">Shadow copy required for differential backups.</span></span>

</dd> <dt>

<span data-ttu-id="dea57-226"><span id="VSS_FSBT_INCREMENTAL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_incremental_snapshot_required"></span>**\_instantâneo incremental do VSS FSBT \_ \_ \_ necessário**</span><span class="sxs-lookup"><span data-stu-id="dea57-226"><span id="VSS_FSBT_INCREMENTAL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_incremental_snapshot_required"></span>**VSS\_FSBT\_INCREMENTAL\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="dea57-227">Cópia de sombra necessária para backups incrementais.</span><span class="sxs-lookup"><span data-stu-id="dea57-227">Shadow copy required for incremental backups.</span></span>

</dd> <dt>

<span data-ttu-id="dea57-228"><span id="VSS_FSBT_LOG_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_log_snapshot_required"></span>**instantâneo de log de FSBT do VSS \_ \_ \_ \_ necessário**</span><span class="sxs-lookup"><span data-stu-id="dea57-228"><span id="VSS_FSBT_LOG_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_log_snapshot_required"></span>**VSS\_FSBT\_LOG\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="dea57-229">Cópia de sombra necessária para backups de log.</span><span class="sxs-lookup"><span data-stu-id="dea57-229">Shadow copy required for log backups.</span></span>

</dd> <dt>

<span data-ttu-id="dea57-230"><span id="VSS_FSBT_ALL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_all_snapshot_required"></span>**\_FSBT VSS \_ todos os \_ instantâneos \_ necessários**</span><span class="sxs-lookup"><span data-stu-id="dea57-230"><span id="VSS_FSBT_ALL_SNAPSHOT_REQUIRED"></span><span id="vss_fsbt_all_snapshot_required"></span>**VSS\_FSBT\_ALL\_SNAPSHOT\_REQUIRED**</span></span>
</dt> <dd>

<span data-ttu-id="dea57-231">Cópia de sombra necessária para todos os tipos de backup; Esse é o padrão.</span><span class="sxs-lookup"><span data-stu-id="dea57-231">Shadow copy required for all backup types; this is the default.</span></span>

</dd> </dl>

<span data-ttu-id="dea57-232">Se um volume específico contiver apenas componentes que não exigem uma cópia de sombra para esse backup, o solicitante poderá ignorar a etapa de criação de uma cópia de sombra para esse volume.</span><span class="sxs-lookup"><span data-stu-id="dea57-232">If a specific volume contains only components that do not require a shadow copy for this backup, the requester can skip the step of creating a shadow copy for this volume.</span></span> <span data-ttu-id="dea57-233">Todos os dados nesse volume podem ser copiados para a mídia de backup diretamente do volume original.</span><span class="sxs-lookup"><span data-stu-id="dea57-233">All the data on this volume can be copied to the backup media directly from the original volume.</span></span>

## <a name="backup-cleanup"></a><span data-ttu-id="dea57-234">Limpeza de backup</span><span class="sxs-lookup"><span data-stu-id="dea57-234">Backup Cleanup</span></span>

<span data-ttu-id="dea57-235">Se o gravador precisar executar truncamento de log ou outra limpeza posterior ao backup, o local apropriado para fazer isso é durante o processamento do evento [*BackupComplete*](vssgloss-b.md) .</span><span class="sxs-lookup"><span data-stu-id="dea57-235">If the writer needs to perform log truncation or other post-backup cleanup, the proper place to do this is while processing the [*BackupComplete*](vssgloss-b.md) event.</span></span> <span data-ttu-id="dea57-236">O evento [*BackupShutdown*](vssgloss-b.md) será enviado algum tempo após BackupComplete, portanto, algumas limpeza também podem ser feitas no manipulador de eventos BackupShutdown.</span><span class="sxs-lookup"><span data-stu-id="dea57-236">The [*BackupShutdown*](vssgloss-b.md) event will be sent some time after BackupComplete, so some cleanup may also be done in the BackupShutdown event handler.</span></span>

<span data-ttu-id="dea57-237">O evento BackupShutdown é sempre enviado após o encerramento de um backup.</span><span class="sxs-lookup"><span data-stu-id="dea57-237">The BackupShutdown event is always sent after termination of a backup.</span></span> <span data-ttu-id="dea57-238">Se o solicitante terminar de forma anormal durante a execução de um backup, o BackupShutdown será enviado imediatamente, sem primeiro enviar BackupComplete.</span><span class="sxs-lookup"><span data-stu-id="dea57-238">If the requester terminates abnormally while performing a backup, BackupShutdown will be sent immediately, without first sending BackupComplete.</span></span> <span data-ttu-id="dea57-239">Se o gravador precisar limpar qualquer Estado, isso pode ser feito aqui; no entanto, o truncamento de log não deve acontecer nesse evento porque o backup não foi concluído.</span><span class="sxs-lookup"><span data-stu-id="dea57-239">If the writer needs to clean up any state, that may be done here; however, log truncation should not happen in this event because the backup did not necessarily complete.</span></span>

## <a name="restore-strategies"></a><span data-ttu-id="dea57-240">Estratégias de restauração</span><span class="sxs-lookup"><span data-stu-id="dea57-240">Restore Strategies</span></span>

<span data-ttu-id="dea57-241">As tarefas básicas de gravadores na restauração são verificar se a restauração pode acontecer na manipulação do evento de prerestore e se a restauração aconteceu ao manipular o evento de restauração.</span><span class="sxs-lookup"><span data-stu-id="dea57-241">The basic tasks of writers at restore are to verify that the restore can happen in handling the PreRestore event, and that the restore has happened in handling the PostRestore event.</span></span> <span data-ttu-id="dea57-242">Armazenamentos mais complexos também executarão um processo de recuperação no manipulador de restauração.</span><span class="sxs-lookup"><span data-stu-id="dea57-242">More complex stores will also perform a recovery process in the PostRestore handler.</span></span> <span data-ttu-id="dea57-243">Se a restauração fizer parte de uma restauração incremental ou diferencial, o gravador geralmente desejará atrasar esse processo de recuperação até que todas as restaurações incrementais ou diferenciais tenham sido concluídas.</span><span class="sxs-lookup"><span data-stu-id="dea57-243">If the restore is part of an incremental or differential restore, the writer will generally want to delay this recovery process until all incremental or differential restores have been completed.</span></span> <span data-ttu-id="dea57-244">[**IVssComponent:: GetAdditionalRestores**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getadditionalrestores) indicará se esta é a restauração final deste componente ou se há mais restaurações a serem fornecidas.</span><span class="sxs-lookup"><span data-stu-id="dea57-244">[**IVssComponent::GetAdditionalRestores**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getadditionalrestores) will indicate whether this is the final restore of this component, or whether there are more restores to come.</span></span> <span data-ttu-id="dea57-245">Se **IVssComponent:: GetAdditionalRestores** retornar **true**, o gravador não deverá executar seu procedimento de recuperação nesse componente.</span><span class="sxs-lookup"><span data-stu-id="dea57-245">If **IVssComponent::GetAdditionalRestores** returns **true**, the writer should not perform its recovery procedure on that component.</span></span>

## <a name="new-targets"></a><span data-ttu-id="dea57-246">Novos destinos</span><span class="sxs-lookup"><span data-stu-id="dea57-246">New Targets</span></span>

<span data-ttu-id="dea57-247">Se houver suporte do gravador, o solicitante poderá restaurar arquivos de dados para um local diferente do local de tempo de backup original.</span><span class="sxs-lookup"><span data-stu-id="dea57-247">If supported by the writer, the requester can restore data files to a location other than the original backup-time location.</span></span> <span data-ttu-id="dea57-248">Um gravador indica suporte para esse modo de restauração, definindo que o **\_ gravador BS VSS \_ \_ dá suporte ao \_ novo \_** bit de destino no parâmetro *dsSchemaMask* ao chamar [**IVssCreateWriterMetadata:: SetBackupSchema**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema).</span><span class="sxs-lookup"><span data-stu-id="dea57-248">A writer indicates support for this restore mode by setting the **VSS\_BS\_WRITER\_SUPPORTS\_NEW\_TARGET** bit in the *dsSchemaMask* parameter when calling [**IVssCreateWriterMetadata::SetBackupSchema**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setbackupschema).</span></span> <span data-ttu-id="dea57-249">Um gravador Obtém os novos locais para os arquivos de componente no momento da restauração chamando [**IVssComponent:: GetNewTargetCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtargetcount) e [**IVssComponent:: GetNewTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtarget).</span><span class="sxs-lookup"><span data-stu-id="dea57-249">A writer obtains the new locations for component files at restore time by calling [**IVssComponent::GetNewTargetCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtargetcount) and [**IVssComponent::GetNewTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtarget).</span></span>

## <a name="directed-targets"></a><span data-ttu-id="dea57-250">Destinos direcionados</span><span class="sxs-lookup"><span data-stu-id="dea57-250">Directed Targets</span></span>

<span data-ttu-id="dea57-251">Para cenários de restauração complicadas, um gravador pode querer mapear intervalos de um arquivo de backup em diferentes intervalos do mesmo arquivo ou de outro.</span><span class="sxs-lookup"><span data-stu-id="dea57-251">For complicated restore scenarios, a writer may want to map ranges of a backed-up file onto different ranges of the same or a different file.</span></span> <span data-ttu-id="dea57-252">Isso pode ser feito usando o mecanismo de destino direcionado.</span><span class="sxs-lookup"><span data-stu-id="dea57-252">This can be done by using the directed-target mechanism.</span></span> <span data-ttu-id="dea57-253">Para fazer isso, um gravador deve primeiro indicar que isso está acontecendo chamando [**IVssComponent:: SetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget), passando o **VSS \_ RT \_ direcionado** para o parâmetro de *destino* .</span><span class="sxs-lookup"><span data-stu-id="dea57-253">To do this, a writer must first indicate this is happening by calling [**IVssComponent::SetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget), passing in **VSS\_RT\_DIRECTED** for the *target* parameter.</span></span> <span data-ttu-id="dea57-254">Em seguida, para cada mapeamento, o gravador chama [**IVssComponent:: AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget).</span><span class="sxs-lookup"><span data-stu-id="dea57-254">Then, for each mapping, the writer calls [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget).</span></span> <span data-ttu-id="dea57-255">Esse método usa um caminho completo para um arquivo de origem no backup e um caminho completo para um arquivo de destino que será restaurado para o.</span><span class="sxs-lookup"><span data-stu-id="dea57-255">This method takes a full path to a source file on the backup and a full path to a destination file that will be restored to.</span></span> <span data-ttu-id="dea57-256">Ele também usa uma lista de intervalos para cada um desses arquivos.</span><span class="sxs-lookup"><span data-stu-id="dea57-256">It also takes a ranges list for each of these files.</span></span> <span data-ttu-id="dea57-257">O gravador chama essas funções enquanto manipula o evento de prerestore, e o solicitante é responsável por restaurar os intervalos especificados no arquivo de origem para os intervalos mapeados no arquivo de destino.</span><span class="sxs-lookup"><span data-stu-id="dea57-257">The writer calls these functions while handling the PreRestore event, and the requester is then responsible for restoring the specified ranges in the source file to the mapped ranges in the destination file.</span></span> <span data-ttu-id="dea57-258">O formato da cadeia de caracteres de intervalos é o mesmo que em [ **IVssComponent:: addparcialfile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile)</span><span class="sxs-lookup"><span data-stu-id="dea57-258">The format of the ranges string is the same as in [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile)</span></span>

## <a name="private-writer-metadata"></a><span data-ttu-id="dea57-259">Metadados do gravador privado</span><span class="sxs-lookup"><span data-stu-id="dea57-259">Private Writer Metadata</span></span>

<span data-ttu-id="dea57-260">Geralmente, é útil que um gravador mantenha metadados privados com um backup para executar corretamente uma restauração incremental ou diferencial.</span><span class="sxs-lookup"><span data-stu-id="dea57-260">It is often useful for a writer to maintain private metadata with a backup to properly perform an incremental or differential restore.</span></span> <span data-ttu-id="dea57-261">Um gravador pode chamar [**IVssComponent:: SetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupmetadata) ao manipular o PrepareForBackup ou o pós-instantâneo para armazenar metadados.</span><span class="sxs-lookup"><span data-stu-id="dea57-261">A writer may call [**IVssComponent::SetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupmetadata) while handling either PrepareForBackup or PostSnapshot to store metadata.</span></span> <span data-ttu-id="dea57-262">Esses metadados podem ser acessados pelo gravador durante a prerestore ou a restauração chamando [**IVssComponent:: GetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupmetadata).</span><span class="sxs-lookup"><span data-stu-id="dea57-262">This metadata can be accessed by the writer during either PreRestore or PostRestore by calling [**IVssComponent::GetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupmetadata).</span></span> <span data-ttu-id="dea57-263">Os metadados também podem ser armazenados com a especificação de arquivo parcial usando o parâmetro *wszMetadata* de [**IVssComponent:: addparcialfile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile); esses metadados são acessados por meio do parâmetro *pbstrMetadata* de [**IVssComponent:: getparcialfile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile).</span><span class="sxs-lookup"><span data-stu-id="dea57-263">Metadata can also be stored with partial file specification by using the *wszMetadata* parameter of [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile); this metadata is accessed through the *pbstrMetadata* parameter of [**IVssComponent::GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile).</span></span> <span data-ttu-id="dea57-264">O gravador também pode passar metadados para si mesmo entre [**CVssWriter:: OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore) e [**CVssWriter:: OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore).</span><span class="sxs-lookup"><span data-stu-id="dea57-264">The writer can also pass metadata to itself between [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore) and [**CVssWriter::OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore).</span></span> <span data-ttu-id="dea57-265">Em **CVssWriter:: OnPreRestore**, os metadados são definidos chamando [**IVssComponent:: SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata).</span><span class="sxs-lookup"><span data-stu-id="dea57-265">In **CVssWriter::OnPreRestore**, the metadata is set by calling [**IVssComponent::SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata).</span></span> <span data-ttu-id="dea57-266">Em **CVssWriter:: OnPostRestore**, os metadados são recuperados chamando [**IVssComponent:: GetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoremetadata).</span><span class="sxs-lookup"><span data-stu-id="dea57-266">In **CVssWriter::OnPostRestore**, the metadata is retrieved by calling [**IVssComponent::GetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoremetadata).</span></span>

-   [<span data-ttu-id="dea57-267">Função de gravador em backups incrementais e diferenciais do VSS</span><span class="sxs-lookup"><span data-stu-id="dea57-267">Writer Role in VSS Incremental and Differential Backups</span></span>](writer-role-in-vss-incremental-and-differential-backups.md)
-   [<span data-ttu-id="dea57-268">Função de solicitante no VSS backups incrementais e diferenciais</span><span class="sxs-lookup"><span data-stu-id="dea57-268">Requester Role in VSS Incremental and Differential Backups</span></span>](requestor-role-in-vss-incremental-and-differential-backups.md)

 

 



