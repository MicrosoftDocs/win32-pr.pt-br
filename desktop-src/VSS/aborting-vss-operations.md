---
description: 'Eventos de anulação podem ser gerados durante uma operação de backup em qualquer um dos seguintes casos:'
ms.assetid: c2e39cdd-0ff8-4030-9bec-9e003b4d9520
title: Anulando operações do VSS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 35e4b82ba4227dfeb02e3da91c9bc1e77f10f492
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "105750571"
---
# <a name="aborting-vss-operations"></a><span data-ttu-id="02de3-103">Anulando operações do VSS</span><span class="sxs-lookup"><span data-stu-id="02de3-103">Aborting VSS Operations</span></span>

<span data-ttu-id="02de3-104">Eventos de [*anulação*](vssgloss-a.md) podem ser gerados durante uma operação de backup em qualquer um dos seguintes casos:</span><span class="sxs-lookup"><span data-stu-id="02de3-104">[*Abort*](vssgloss-a.md) events can be generated during a backup operation in any of the following cases:</span></span>

-   <span data-ttu-id="02de3-105">Um solicitante gera explicitamente um [*evento Abort*](vssgloss-a.md) chamando [**IVssBackupComponents:: AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup).</span><span class="sxs-lookup"><span data-stu-id="02de3-105">A requester explicitly generates an [*Abort event*](vssgloss-a.md) by calling [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup).</span></span>
-   <span data-ttu-id="02de3-106">Os manipuladores de eventos [*congelar*](vssgloss-f.md) e [*descongelar*](vssgloss-t.md) do gravador ([**CVssWriter:: OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) e [**CVssWriter:: descongelar**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)) retornam **false** ou não podem ser concluídos na janela de tempo especificada em [**CVssWriter:: Initialize**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-initialize).</span><span class="sxs-lookup"><span data-stu-id="02de3-106">A writer's [*Freeze*](vssgloss-f.md) and [*Thaw*](vssgloss-t.md) event handlers ([**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) and [**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)) return **false**, or cannot complete in the time window specified in [**CVssWriter::Initialize**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-initialize).</span></span>
-   <span data-ttu-id="02de3-107">Há qualquer falha do provedor ou VSS durante a criação de uma cópia de sombra após o evento [*PrepareForSnapshot*](vssgloss-p.md) .</span><span class="sxs-lookup"><span data-stu-id="02de3-107">There is any failure of the provider or VSS during the creation of a shadow copy following the [*PrepareForSnapshot*](vssgloss-p.md) event.</span></span>

<span data-ttu-id="02de3-108">Não há suporte para anulações em operações de restauração.</span><span class="sxs-lookup"><span data-stu-id="02de3-108">Aborts are not supported for restore operations.</span></span>

## <a name="requester-handling-and-creation-of-abort-events"></a><span data-ttu-id="02de3-109">Tratamento de solicitante e criação de eventos de anulação</span><span class="sxs-lookup"><span data-stu-id="02de3-109">Requester Handling and Creation of Abort Events</span></span>

<span data-ttu-id="02de3-110">Uma instância da interface [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) pode ser usada para apenas um backup, portanto, se ocorrer um erro ao processar um backup, geralmente é melhor liberar a instância atual e começar novamente.</span><span class="sxs-lookup"><span data-stu-id="02de3-110">An instance of the [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface can be used for only one backup, so if an error occurs in processing a backup it is generally best to release the current instance and start over.</span></span>

<span data-ttu-id="02de3-111">Um solicitante deve sinalizar explicitamente que está anulando uma operação de backup (usando [**IVssBackupComponents:: AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup)) somente após a preparação real para um backup, envolvendo gravadores ou a criação de uma cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="02de3-111">A requester should explicitly signal that it is aborting a backup operation (using [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup)) only after the actual preparation for a backup, involving writers, or the creation of a shadow copy has taken place.</span></span>

<span data-ttu-id="02de3-112">Efetivamente, isso significa que sempre que um solicitante precisar interromper uma operação de backup depois de gerar um evento [*PrepareForBackup*](vssgloss-p.md) chamando [**IVssBackupComponents::P repareforbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), ele deverá chamar [**IVssBackupComponents:: AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup) e esperar seu retorno antes de liberar a instância de [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) atual.</span><span class="sxs-lookup"><span data-stu-id="02de3-112">Effectively, this means that any time a requester needs to stop a backup operation after generating a [*PrepareForBackup*](vssgloss-p.md) event by calling [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), it should call [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup) and await its return prior to releasing the current [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) instance.</span></span>

<span data-ttu-id="02de3-113">Por exemplo, se um gravador vetasse uma operação de backup, um solicitante deve usar [**IVssBackupComponents:: AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup) para notificar todos os outros gravadores que a operação de backup não será concluída.</span><span class="sxs-lookup"><span data-stu-id="02de3-113">For example, if a writer vetoed a backup operation, a requester should use [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup) to notify all other writers that the backup operation will not be completed.</span></span>

<span data-ttu-id="02de3-114">Antes de chamar [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), ou se a chamada para **PrepareForBackup** falhar, um solicitante poderá liberar a instância atual da interface [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) sem a necessidade de gerar um evento Abort.</span><span class="sxs-lookup"><span data-stu-id="02de3-114">Prior to calling [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), or if the call to **PrepareForBackup** fails, a requester can release the current instance of the [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface without needing to generate an Abort event.</span></span>

<span data-ttu-id="02de3-115">Por exemplo, se a instância atual do [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) estiver sendo usada apenas para obter informações chamando [**IVSSBackupComponents:: GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) e gerando um evento de [*identificação*](vssgloss-i.md) , depois que as informações tiverem sido retornadas, a instância do **IVSSBackupComponents** poderá simplesmente ser liberada.</span><span class="sxs-lookup"><span data-stu-id="02de3-115">For example, if the current instance of [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) is being used merely to obtain information by calling [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) and generating an [*Identify*](vssgloss-i.md) event, once information has been returned the instance of **IVSSBackupComponents** can simply be released.</span></span>

<span data-ttu-id="02de3-116">Um solicitante gera um número de eventos ([*PrepareForSnapshot*](vssgloss-p.md), [*Freeze*](vssgloss-f.md), [*descongelar*](vssgloss-t.md)e [*pós-instantâneo*](vssgloss-p.md)) quando chama [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span><span class="sxs-lookup"><span data-stu-id="02de3-116">A requester generates a number of events ([*PrepareForSnapshot*](vssgloss-p.md), [*Freeze*](vssgloss-f.md), [*Thaw*](vssgloss-t.md), and [*PostSnapshot*](vssgloss-p.md)) when it calls [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span></span> <span data-ttu-id="02de3-117">Ao manipular os eventos Freeze e descongelar, um escritor pode falhar e gerar um evento de anulação por conta própria.</span><span class="sxs-lookup"><span data-stu-id="02de3-117">While handling the Freeze and Thaw events, a writer may fail and can generate an Abort event on its own.</span></span> <span data-ttu-id="02de3-118">Falha ao manipular eventos PrepareForSnapshot e pós-instantâneo não gera um evento Abort.</span><span class="sxs-lookup"><span data-stu-id="02de3-118">Failure to handle PrepareForSnapshot and PostSnapshot events does not generate an Abort event.</span></span>

<span data-ttu-id="02de3-119">Nem sempre é possível para um solicitante saber se um evento Abort foi gerado quando [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) indica falha.</span><span class="sxs-lookup"><span data-stu-id="02de3-119">It is not always possible for a requester to know if an Abort event was generated when [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) indicates failure.</span></span> <span data-ttu-id="02de3-120">Portanto, um solicitante precisa encerrar uma operação de backup porque o status de **IVssBackupComponents::D osnapshotset** indica que um problema ainda deve chamar [**IVssBackupComponents:: AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup).</span><span class="sxs-lookup"><span data-stu-id="02de3-120">Therefore, a requester that needs to terminate a backup operation because the status of **IVssBackupComponents::DoSnapshotSet** indicates a problem should still call [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup).</span></span>

<span data-ttu-id="02de3-121">Se um solicitante tiver chamado [**IVssBackupComponents:: AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup), não será necessário chamar [**IVssBackupComponents:: BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) antes de liberar uma instância de [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents).</span><span class="sxs-lookup"><span data-stu-id="02de3-121">If a requester has called [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup), it is not necessary to call [**IVssBackupComponents::BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) prior to releasing an instance of [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents).</span></span>

## <a name="writer-handling-and-creation-of-abort-events"></a><span data-ttu-id="02de3-122">Manipulação de gravador e criação de eventos de anulação</span><span class="sxs-lookup"><span data-stu-id="02de3-122">Writer Handling and Creation of Abort Events</span></span>

<span data-ttu-id="02de3-123">Conforme observado anteriormente, um gravador pode receber um evento de anulação de um solicitante ou o provedor pode disparar um próprio.</span><span class="sxs-lookup"><span data-stu-id="02de3-123">As noted previously, a writer can receive an Abort event from a requester, or the provider can trigger one itself.</span></span> <span data-ttu-id="02de3-124">Além disso, é possível que um gravador receba vários eventos de anulação em determinadas circunstâncias.</span><span class="sxs-lookup"><span data-stu-id="02de3-124">Also, it is possible for a writer to receive multiple Abort events under certain circumstances.</span></span> <span data-ttu-id="02de3-125">Os desenvolvedores de gravador devem codificar qualquer implementação de [**CVssWriter:: OnAbort**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onabort) com isso em mente.</span><span class="sxs-lookup"><span data-stu-id="02de3-125">Writer developers should code any implementation of [**CVssWriter::OnAbort**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onabort) with this in mind.</span></span>

<span data-ttu-id="02de3-126">Ao manipular um evento de anulação, um gravador deve tentar restaurar qualquer processo que fosse gerenciado para seu estado normal de execução, bem como executar qualquer manipulação de erros e registro em log.</span><span class="sxs-lookup"><span data-stu-id="02de3-126">In handling an Abort event, a writer should attempt to restore whatever process it managed to its normal running state, as well as perform any error handling and logging.</span></span>

<span data-ttu-id="02de3-127">Isso pode significar que uma implementação de [**CVssWriter:: OnAbort**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onabort) pode ter que executar muitas, se não todas, das mesmas tarefas que o manipulador de eventos descongelar ([**CVssWriter:: descongelar**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)) e o manipulador de eventos de pós-instantâneo ([**CVssWriter:: OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot)) e esses manipuladores podem ser chamados de dentro de **CVssWriter:: OnAbort**.</span><span class="sxs-lookup"><span data-stu-id="02de3-127">This may mean that an implementation of [**CVssWriter::OnAbort**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onabort) might have to perform many, if not all, of the same tasks as the Thaw event handler ([**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)) and the PostSnapshot event handler ([**CVssWriter::OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot)), and these handlers can be called from within **CVssWriter::OnAbort**.</span></span>

 

 



