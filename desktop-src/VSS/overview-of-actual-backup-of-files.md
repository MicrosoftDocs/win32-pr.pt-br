---
description: O VSS permite que um solicitante acesse a cópia de sombra de volumes contendo dados para backup e copie dados para mídia de backup.
ms.assetid: 187f26f2-f191-4703-9bde-3357f1ceef0c
title: Visão geral do backup real de arquivos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 98a504ff5a41725e33a2eb27792a3c6c89d00276
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105813417"
---
# <a name="overview-of-actual-backup-of-files"></a><span data-ttu-id="0b4a2-103">Visão geral do backup real de arquivos</span><span class="sxs-lookup"><span data-stu-id="0b4a2-103">Overview of Actual Backup Of Files</span></span>

<span data-ttu-id="0b4a2-104">O VSS permite que um solicitante acesse a cópia de sombra de volumes contendo dados para backup e copie dados para mídia de backup.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-104">VSS enables a requester to access the shadow copy of volumes containing data for backup and to copy data to backup media.</span></span> <span data-ttu-id="0b4a2-105">Os gravadores geralmente prosseguem com a operação normal durante esse processo.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-105">Writers generally proceed with normal operation during this process.</span></span> <span data-ttu-id="0b4a2-106">Para obter mais informações, consulte [visão geral do processamento de um backup em VSS](overview-of-processing-a-backup-under-vss.md).</span><span class="sxs-lookup"><span data-stu-id="0b4a2-106">For more information, see [Overview of Processing a Backup Under VSS](overview-of-processing-a-backup-under-vss.md).</span></span>

<span data-ttu-id="0b4a2-107">A tabela a seguir mostra a sequência de ações e eventos necessários para o backup dos arquivos.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-107">The following table shows the sequence of actions and events that are required for files to be backed up.</span></span>



<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th><span data-ttu-id="0b4a2-108">Ação do solicitante</span><span class="sxs-lookup"><span data-stu-id="0b4a2-108">Requester action</span></span></th>
<th><span data-ttu-id="0b4a2-109">Evento</span><span class="sxs-lookup"><span data-stu-id="0b4a2-109">Event</span></span></th>
<th><span data-ttu-id="0b4a2-110">Ação do gravador</span><span class="sxs-lookup"><span data-stu-id="0b4a2-110">Writer action</span></span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span data-ttu-id="0b4a2-111">Acessar arquivos no volume copiado por sombra (consulte <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getsnapshotproperties"><strong>IVssBackupComponents:: Getinstantâneoproperties</strong></a>, <a href="/windows/desktop/api/Vss/ns-vss-vss_snapshot_prop"><strong>VSS_SNAPSHOT_PROP</strong></a>)</span><span class="sxs-lookup"><span data-stu-id="0b4a2-111">Access files on the shadow-copied volume (see <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getsnapshotproperties"><strong>IVssBackupComponents::GetSnapshotProperties</strong></a>, <a href="/windows/desktop/api/Vss/ns-vss-vss_snapshot_prop"><strong>VSS_SNAPSHOT_PROP</strong></a>)</span></span></td>
<td><span data-ttu-id="0b4a2-112">Nenhum</span><span class="sxs-lookup"><span data-stu-id="0b4a2-112">None</span></span></td>
<td><span data-ttu-id="0b4a2-113">Nenhum</span><span class="sxs-lookup"><span data-stu-id="0b4a2-113">None</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="0b4a2-114">Gere a lista de arquivos para fazer backup e copie os dados de arquivo para mídia de backup.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-114">Generate the list of files to back up, and copy file data to backup media.</span></span></td>
<td><span data-ttu-id="0b4a2-115">Nenhum</span><span class="sxs-lookup"><span data-stu-id="0b4a2-115">None</span></span></td>
<td><span data-ttu-id="0b4a2-116">Nenhum</span><span class="sxs-lookup"><span data-stu-id="0b4a2-116">None</span></span></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="0b4a2-117">Indique o êxito ou a falha do backup com <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded"><strong>IVssBackupComponents:: SetBackupSucceeded</strong></a>.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-117">Indicate the success or failure of the backup with <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded"><strong>IVssBackupComponents::SetBackupSucceeded</strong></a>.</span></span></td>
<td><span data-ttu-id="0b4a2-118">Nenhum</span><span class="sxs-lookup"><span data-stu-id="0b4a2-118">None</span></span></td>
<td><span data-ttu-id="0b4a2-119">Nenhum</span><span class="sxs-lookup"><span data-stu-id="0b4a2-119">None</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="0b4a2-120">O solicitante indica que o backup foi concluído chamando <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete"><strong>IVssBackupComponents:: BackupComplete</strong></a>.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-120">The requester indicates that the backup has completed by calling <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete"><strong>IVssBackupComponents::BackupComplete</strong></a>.</span></span></td>
<td><span data-ttu-id="0b4a2-121"><a href="vssgloss-b.md"><em>BackupComplete</em></a></span><span class="sxs-lookup"><span data-stu-id="0b4a2-121"><a href="vssgloss-b.md"><em>BackupComplete</em></a></span></span></td>
<td><span data-ttu-id="0b4a2-122">Execute qualquer limpeza após o backup (consulte <a href="/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete"><strong>CVssWriter:: OnBackupComplete</strong></a>, <a href="/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents"><strong>IVssWriterComponents</strong></a>, <a href="/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent"><strong>IVssComponent</strong></a>).</span><span class="sxs-lookup"><span data-stu-id="0b4a2-122">Perform any post-backup cleanup (see <a href="/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete"><strong>CVssWriter::OnBackupComplete</strong></a>, <a href="/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents"><strong>IVssWriterComponents</strong></a>, <a href="/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent"><strong>IVssComponent</strong></a>).</span></span></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="0b4a2-123">O solicitante espera que todos os gravadores reconheçam o recebimento do evento <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete"><strong>IVssBackupComponents:: BackupComplete</strong></a> usando <a href="/windows/desktop/api/Vss/nn-vss-ivssasync"><strong>IVssAsync</strong></a>.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-123">The requester waits for all writers to acknowledge receipt of the <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete"><strong>IVssBackupComponents::BackupComplete</strong></a> event using <a href="/windows/desktop/api/Vss/nn-vss-ivssasync"><strong>IVssAsync</strong></a>.</span></span> <span data-ttu-id="0b4a2-124">Ele também deve verificar o status do gravador (consulte <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus"><strong>IVssBackupComponents:: GatherWriterStatus</strong></a>, <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus"><strong>IVssBackupComponents:: GetWriterStatus</strong></a>).</span><span class="sxs-lookup"><span data-stu-id="0b4a2-124">It should also verify writer status (see <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus"><strong>IVssBackupComponents::GatherWriterStatus</strong></a>, <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus"><strong>IVssBackupComponents::GetWriterStatus</strong></a>).</span></span> <span data-ttu-id="0b4a2-125">O solicitante deve chamar <strong>GatherWriterStatus</strong> no momento para fazer com que a sessão do gravador seja definida como um estado concluído.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-125">The requester must call <strong>GatherWriterStatus</strong> at this time to cause the writer session to be set to a completed state.</span></span>
<blockquote>
[!Note]<br />
<span data-ttu-id="0b4a2-126">Isso só é necessário no Windows Server 2008 com Service Pack 2 (SP2) e versões anteriores.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-126">This is only necessary on Windows Server 2008 with Service Pack 2 (SP2) and earlier.</span></span>
</blockquote>
<br/></td>
<td><span data-ttu-id="0b4a2-127">Nenhum</span><span class="sxs-lookup"><span data-stu-id="0b4a2-127">None</span></span></td>
<td><span data-ttu-id="0b4a2-128">Nenhum</span><span class="sxs-lookup"><span data-stu-id="0b4a2-128">None</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="0b4a2-129">Salve o documento componentes de backup e cada documento de metadados do gravador em documentos XML, que podem ser gravados na mídia de backup (consulte <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml"><strong>IVssBackupComponents:: SaveAsXML</strong></a> e <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-saveasxml"><strong>IVssExamineWriterMetadata:: SaveAsXML</strong></a>).</span><span class="sxs-lookup"><span data-stu-id="0b4a2-129">Save the Backup Components Document and each Writer Metadata Document to XML documents, which can be written to the backup media (see <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml"><strong>IVssBackupComponents::SaveAsXML</strong></a> and <a href="/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-saveasxml"><strong>IVssExamineWriterMetadata::SaveAsXML</strong></a>).</span></span></td>
<td><span data-ttu-id="0b4a2-130">Nenhum</span><span class="sxs-lookup"><span data-stu-id="0b4a2-130">None</span></span></td>
<td><span data-ttu-id="0b4a2-131">Nenhum</span><span class="sxs-lookup"><span data-stu-id="0b4a2-131">None</span></span></td>
</tr>
</tbody>
</table>



 

## <a name="writer-actions-during-backup-of-files"></a><span data-ttu-id="0b4a2-132">Ações do gravador durante o backup de arquivos</span><span class="sxs-lookup"><span data-stu-id="0b4a2-132">Writer Actions during Backup of Files</span></span>

<span data-ttu-id="0b4a2-133">Após a conclusão da cópia de sombra, todas as operações de e/s no sistema que estão sendo submetidas a backup devem ser capazes de retomar sem interromper a integridade do backup.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-133">After the shadow copy has been completed, all I/O operations on the system that is being backed up should be able to resume without disrupting the integrity of the backup.</span></span> <span data-ttu-id="0b4a2-134">Essa é uma das principais motivações para ter a funcionalidade de cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-134">This is one of the prime motivations for having the shadow copy functionality.</span></span>

<span data-ttu-id="0b4a2-135">Portanto, como na fase de descoberta (consulte [visão geral da fase de descoberta de backup](overview-of-the-backup-discovery-phase.md)), há poucas demandas colocadas nos gravadores enquanto os arquivos estão sendo realmente submetidos a backup.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-135">Therefore, as in the discovery phase (see [Overview of the Backup Discovery Phase](overview-of-the-backup-discovery-phase.md)), there are few demands placed on the writers while files are actually being backed up.</span></span>

<span data-ttu-id="0b4a2-136">Depois que um backup for concluído e um solicitante tiver gerado um evento [*BackupComplete*](vssgloss-b.md) , o VSS chamará o método [**CVssWriter:: OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) de cada gravador, um método virtual que, por padrão, simplesmente retorna **true**.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-136">After a backup has completed, and a requester has generated a [*BackupComplete*](vssgloss-b.md) event, VSS will call each writer's [**CVssWriter::OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) method, a virtual method that by default simply returns **TRUE**.</span></span> <span data-ttu-id="0b4a2-137">No entanto, os gravadores podem substituir a implementação padrão e tomar essas ações como remover arquivos temporários restantes ou usar a interface [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) com a qual ele é chamado para verificar o estado do backup de cada um de seus componentes [*explicitamente incluídos*](vssgloss-e.md) (e qualquer [*conjunto de componentes*](vssgloss-c.md) que possam definir) recuperando o objeto [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) correspondente.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-137">However, writers can override the default implementation and take such actions as removing remaining temporary files, or use the [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) interface it is called with to check the state of the backup of each of its [*included explicitly*](vssgloss-e.md) components (and any [*component set*](vssgloss-c.md) they might define) by retrieving the corresponding [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) object.</span></span> <span data-ttu-id="0b4a2-138">O gravador pode, então, determinar e agir, o êxito ou a falha do backup chamando [**IVssComponent: GetBackupSucceeded**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupsucceeded).</span><span class="sxs-lookup"><span data-stu-id="0b4a2-138">The writer can then determine, and act on, the success or failure of the backup by calling [**IVssComponent:GetBackupSucceeded**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupsucceeded).</span></span> <span data-ttu-id="0b4a2-139">O valor retornado por **IVssComponent: GetBackupSucceeded** será **true** somente se todos os arquivos explicitamente incluídos no componente e todos os seus [*Subcomponentes*](vssgloss-s.md) tiverem sido [*incluídos*](vssgloss-i.md) em backup com êxito.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-139">The value returned by **IVssComponent:GetBackupSucceeded** will be **TRUE** only if all explicitly included files in the component and all [*implicitly included*](vssgloss-i.md) of any of its [*subcomponents*](vssgloss-s.md) have been successfully backed up.</span></span>

<span data-ttu-id="0b4a2-140">Quando a chamada para [**CVssWriter:: OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) for concluída, o solicitante deverá chamar [**IVssBackupComponents:: GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) e [**IVssBackupComponents:: GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) (para cada gravador) uma última vez.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-140">When the call to [**CVssWriter::OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) has completed, the requester should call [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) and [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) (for each writer) one last time.</span></span> <span data-ttu-id="0b4a2-141">A memória de estado da sessão do gravador é um recurso limitado e os gravadores devem eventualmente reutilizar Estados de sessão.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-141">The writer session state memory is a limited resource and writers must eventually reuse session states.</span></span> <span data-ttu-id="0b4a2-142">Esta etapa marca o estado da sessão de backup do gravador como concluída e notifica o VSS de que esse slot de sessão de backup pode ser reutilizado por uma operação de backup subsequente.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-142">This step marks the writer’s backup session state as completed and notifies VSS that this backup session slot can be reused by a subsequent backup operation.</span></span>

## <a name="requester-actions-during-backup-of-files"></a><span data-ttu-id="0b4a2-143">Ações do solicitante durante o backup de arquivos</span><span class="sxs-lookup"><span data-stu-id="0b4a2-143">Requester Actions during Backup of Files</span></span>

<span data-ttu-id="0b4a2-144">Conforme observado em [visão geral da fase de descoberta de backup](overview-of-the-backup-discovery-phase.md), você não deve gerar a lista real de arquivos cujo backup será feito até que a cópia de sombra seja concluída.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-144">As noted in [Overview of the Backup Discovery Phase](overview-of-the-backup-discovery-phase.md), you should not generate the actual list of files to be backed up until the shadow copy has completed.</span></span>

<span data-ttu-id="0b4a2-145">O [*objeto de dispositivo*](vssgloss-d.md) correspondente à cópia de sombra de um determinado volume é usado para obter acesso aos arquivos no volume de sombra copiado após a conclusão da cópia de sombra.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-145">The [*device object*](vssgloss-d.md) corresponding to the shadow copy of a given volume is used to get access to files on the shadow copied volume once the shadow copy has completed.</span></span> <span data-ttu-id="0b4a2-146">O objeto de dispositivo é obtido do [**objeto \_ \_ prop do instantâneo do VSS**](/windows/desktop/api/Vss/ns-vss-vss_snapshot_prop) retornado por [**IVssBackupComponents:: getinstantâneoproperties**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getsnapshotproperties).</span><span class="sxs-lookup"><span data-stu-id="0b4a2-146">The device object is obtained from the [**VSS\_SNAPSHOT\_PROP**](/windows/desktop/api/Vss/ns-vss-vss_snapshot_prop) object returned by [**IVssBackupComponents::GetSnapshotProperties**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getsnapshotproperties).</span></span> <span data-ttu-id="0b4a2-147">Cada cópia de sombra de um conjunto de cópias de sombra terá seu próprio objeto de dispositivo.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-147">Each shadow copy of a shadow copy set will have its own device object.</span></span>

<span data-ttu-id="0b4a2-148">O objeto de dispositivo e os caminhos obtidos nas especificações do documento de metadados do gravador de componentes são então usados para selecionar arquivos para backup.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-148">The device object and the paths obtained from the Writer Metadata Document specifications of components are then used to select files for backup.</span></span> <span data-ttu-id="0b4a2-149">Consulte [acesso do solicitante para sombra de dados copiados](requestor-access-to-shadow-copied-data.md) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-149">See [Requester Access to Shadow Copied Data](requestor-access-to-shadow-copied-data.md) for more information.</span></span>

<span data-ttu-id="0b4a2-150">Quais arquivos serão incluídos na lista de backup depende da natureza do backup específico, na seleção de componentes [*para backup*](vssgloss-s.md)e na estrutura de caminho lógico do gravador (consulte [trabalhando com a seleção de backup](working-with-selectability-for-backup.md)).</span><span class="sxs-lookup"><span data-stu-id="0b4a2-150">Which files will be included in the backup list depends on the nature of the particular backup, upon component [*selectability for backup*](vssgloss-s.md), and the logical path structure of the writer (see [Working with Selectability for Backup](working-with-selectability-for-backup.md)).</span></span>

<span data-ttu-id="0b4a2-151">Além dos arquivos especificados nos componentes, um determinado gravador também pode ter arquivos explicitamente excluídos.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-151">In addition to files specified in the components, a given writer may also have explicitly excluded files.</span></span> <span data-ttu-id="0b4a2-152">A exclusão de arquivo sempre deve ser respeitada, independentemente dos componentes selecionados.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-152">File exclusion must always be respected, regardless of which components are selected.</span></span>

<span data-ttu-id="0b4a2-153">Além disso, conforme observado em [visão geral da fase de descoberta de backup](overview-of-the-backup-discovery-phase.md), uma pasta montada ou um ponto de nova análise pode aparecer em uma cópia de sombra e pode ser feito backup.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-153">Also as noted in [Overview of the Backup Discovery Phase](overview-of-the-backup-discovery-phase.md), a mounted folder or reparse point can appear in a shadow copy and can be backed up.</span></span> <span data-ttu-id="0b4a2-154">No entanto, uma pasta montada ou um ponto de nova análise não pode ser atravessado no volume copiado por sombra (consulte [trabalhando com pastas montadas e pontos de nova análise](working-with-reparse-and-mount-points.md)).</span><span class="sxs-lookup"><span data-stu-id="0b4a2-154">However, a mounted folder or reparse point cannot be traversed on the shadow-copied volume (see [Working with Mounted Folders and Reparse Points](working-with-reparse-and-mount-points.md)).</span></span>

<span data-ttu-id="0b4a2-155">O cuidado também deve ser feito durante uma operação de backup, se o [*caminho alternativo*](vssgloss-a.md) retornado por [**IVssWMFiledesc:: GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) não estiver em branco.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-155">Care should also be taken during a backup operation, if the [*alternate path*](vssgloss-a.md) returned by [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) is not blank.</span></span> <span data-ttu-id="0b4a2-156">Um caminho alternativo difere de um [*mapeamento de local alternativo*](vssgloss-a.md) , pois ele é usado somente durante os backups, enquanto um mapeamento de local alternativo é usado somente durante as restaurações.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-156">An alternate path differs from an [*alternate location mapping*](vssgloss-a.md) in that it is used only during backups, while an alternate location mapping is used only during restores.</span></span>

<span data-ttu-id="0b4a2-157">Nesse caso, os dados não serão submetidos a backup de seu local normal (indicado por [**IVssWMFiledesc:: GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath)), mas do local retornado por [**IVssWMFiledesc:: GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation).</span><span class="sxs-lookup"><span data-stu-id="0b4a2-157">In this case, the data is not to be backed up from its normal location (indicated by [**IVssWMFiledesc::GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath)), but from the location returned by [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation).</span></span> <span data-ttu-id="0b4a2-158">Na restauração, o arquivo deve ser retornado para seu local normal.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-158">On restore, the file should be returned to its normal location.</span></span> <span data-ttu-id="0b4a2-159">Consulte [locais de backup e restauração não padrão](non-default-backup-and-restore-locations.md) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-159">See [Non-Default Backup and Restore Locations](non-default-backup-and-restore-locations.md) for more information.</span></span>

<span data-ttu-id="0b4a2-160">O VSS não coloca nenhuma restrição no mecanismo real de backup de dados em um meio de armazenamento ou na escolha desse meio.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-160">VSS places no restrictions on the actual mechanism of backing up data to a storage medium or the choice of that medium.</span></span> <span data-ttu-id="0b4a2-161">No entanto, é recomendável que os arquivos de cada componente de cada [*instância do gravador*](vssgloss-w.md) sejam processados como uma unidade.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-161">However, it is recommended that the files of each component of each [*writer instance*](vssgloss-w.md) be processed as a unit.</span></span> <span data-ttu-id="0b4a2-162">Consulte [gerando um conjunto de backup](generating-a-backup-set.md) para uma discussão das práticas recomendadas na geração da lista de arquivos de backup.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-162">See [Generating A Backup Set](generating-a-backup-set.md) for a discussion of best practices in generating the backup file list.</span></span>

<span data-ttu-id="0b4a2-163">O êxito ou a falha de fazer backup de qualquer um dos arquivos gerenciados por um determinado componente e (se ele [*definir um conjunto de componentes*](vssgloss-c.md)) seus [*Subcomponentes*](vssgloss-s.md) para uma determinada instância do gravador devem ser preservados no documento componentes de backup chamando [**IVssBackupComponents:: SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded).</span><span class="sxs-lookup"><span data-stu-id="0b4a2-163">The success or failure of backing up any of the files managed by a given component and (if it defines a [*component set*](vssgloss-c.md)) its [*subcomponents*](vssgloss-s.md) for a given writer instance should be preserved in the Backup Components Document by calling [**IVssBackupComponents::SetBackupSucceeded**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupsucceeded).</span></span> <span data-ttu-id="0b4a2-164">Se algum arquivo gerenciado por um componente ou conjunto de componentes falhar no backup, o componente inteiro será considerado como falha.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-164">If any file managed by a component or component set fails to back up, the entire component is said to fail.</span></span> <span data-ttu-id="0b4a2-165">As informações exatas sobre o backup do arquivo que falhou devem ser sempre registradas.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-165">Exact information about which file failed to back up should always be logged.</span></span>

<span data-ttu-id="0b4a2-166">Os desenvolvedores podem achar útil armazenar um registro na mídia de backup de quais arquivos são armazenados em backup, os componentes e o conjunto de componentes dos quais eram membros, sua especificação e quais são seus caminhos originais.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-166">Developers may find it helpful to store a record on the backup media of which files are backed up, the components and component set they were a member of, their specification, and what their original paths were.</span></span> <span data-ttu-id="0b4a2-167">Também pode ser útil armazenar informações, como a definição de componente de cada gravador.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-167">It may also be useful to store information such as each writer's component definition.</span></span> <span data-ttu-id="0b4a2-168">Fazer isso pode tornar a operação de recuperação mais simples.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-168">Doing this may make the retrieval operation simpler.</span></span> <span data-ttu-id="0b4a2-169">No entanto, esses detalhes são deixados para o desenvolvedor solicitante.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-169">However, such details are left to the requester developer.</span></span>

<span data-ttu-id="0b4a2-170">Como os gravadores podem modificar o documento de componentes de backup ao manipular o evento de [**instantâneo**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) gerado pela chamada do solicitante para [**IVssBackupComponents::D Osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset), o documento de componentes de backup não deve ser salvo até que a chamada assíncrona seja concluída.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-170">Because writers can modify the Backup Components Document while handling the [**PostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) event generated by the requester's call to [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset), the Backup Components Document should not be saved until after that asynchronous call has completed.</span></span>

<span data-ttu-id="0b4a2-171">Embora possa ocorrer antes, esse também é um momento conveniente para salvar o documento de metadados do gravador.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-171">Although it may take place earlier, this is also a convenient time to save the Writer Metadata Document.</span></span>

<span data-ttu-id="0b4a2-172">É muito importante que o documento dos componentes de backup e os documentos de metadados do gravador sejam preservados usando [**IVssBackupComponents:: SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml) e [**IVssExamineWriterMetadata:: SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-saveasxml).</span><span class="sxs-lookup"><span data-stu-id="0b4a2-172">It is very important that both the Backup Components Document and the Writer Metadata Documents be preserved using [**IVssBackupComponents::SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml) and [**IVssExamineWriterMetadata::SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-saveasxml).</span></span> <span data-ttu-id="0b4a2-173">Se não forem, não será possível usar o VSS durante a restauração do arquivo.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-173">If they are not, it will not be possible to make use of VSS during file restoration.</span></span>

<span data-ttu-id="0b4a2-174">Além de armazenar os metadados originais, alguns aplicativos de backup podem achar útil salvar uma cópia de sua própria lista de arquivos (em seu próprio formato otimizado) — e seu gravador, componente, procedimento de restauração e informações de localização associados — à mídia de backup para recuperação posterior.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-174">In addition to storing the original metadata, some backup applications may find it useful to save a copy of their own list of the files (in their own optimized format)—and their associated writer, component, restore procedure, and location information—to the backup media for later retrieval.</span></span> <span data-ttu-id="0b4a2-175">Essa lista pode ser usada para evitar algumas das análises e comparações dos documentos de metadados do gravador e dos documentos do componente de backup durante a restauração.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-175">Such a list can be used to avoid some of the parsing and comparing of Writer Metadata Documents and the Backup Component Documents during restore.</span></span>

<span data-ttu-id="0b4a2-176">Os volumes cujo backup está sendo feito podem ter dados que não são gerenciados por gravadores VSS.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-176">Volumes being backed up may have data that is not managed by VSS writers.</span></span> <span data-ttu-id="0b4a2-177">Esses dados podem e devem ser submetidos a backup do volume copiado de sombra, onde estarão em um [*estado consistente com falhas*](vssgloss-c.md).</span><span class="sxs-lookup"><span data-stu-id="0b4a2-177">This data can and should be backed up from the shadow copied volume, where it will be in a [*crash-consistent state*](vssgloss-c.md).</span></span> <span data-ttu-id="0b4a2-178">Consulte [backups sem a participação do gravador](backups-without-writer-participation.md) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="0b4a2-178">See [Backups without Writer Participation](backups-without-writer-participation.md) for more information.</span></span>

 

 




