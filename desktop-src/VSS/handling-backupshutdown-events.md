---
description: É possível que um aplicativo de backup (solicitante) seja encerrado e não gere um evento BackupComplete.
ms.assetid: 8e6a1f4f-ba62-46ea-965e-b0c6526ece89
title: Manipulando eventos BackupShutdown
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 939e8e64ca9ee463b0b8331e607f8068c3325d5c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/07/2021
ms.locfileid: "105807138"
---
# <a name="handling-backupshutdown-events"></a><span data-ttu-id="b0e6b-103">Manipulando eventos BackupShutdown</span><span class="sxs-lookup"><span data-stu-id="b0e6b-103">Handling BackupShutdown Events</span></span>

<span data-ttu-id="b0e6b-104">É possível que um aplicativo de backup (solicitante) seja encerrado e não gere um evento [*BackupComplete*](vssgloss-b.md) .</span><span class="sxs-lookup"><span data-stu-id="b0e6b-104">It is possible for a backup application (requester) to terminate and not generate a [*BackupComplete*](vssgloss-b.md) event.</span></span> <span data-ttu-id="b0e6b-105">O aplicativo de backup pode falhar ou ser encerrado (do Gerenciador de tarefas, por exemplo) e não ser capaz de chamar [**IVssBackupComponents:: BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete).</span><span class="sxs-lookup"><span data-stu-id="b0e6b-105">The backup application could crash, or be terminated (from the Task Manager, for example) and not be able to call [**IVssBackupComponents::BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete).</span></span>

<span data-ttu-id="b0e6b-106">Portanto, a infraestrutura do VSS (em vez do solicitante) gera um evento [*BackupShutdown*](vssgloss-b.md) sempre que uma instância de [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) que participa de um backup é liberada, independentemente de ser liberada pelo solicitante ou pelo sistema.</span><span class="sxs-lookup"><span data-stu-id="b0e6b-106">Therefore, the VSS infrastructure (rather than the requester) generates a [*BackupShutdown*](vssgloss-b.md) event whenever an instance of [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) participating in a backup is released, whether it is released by the requester or by the system.</span></span>

<span data-ttu-id="b0e6b-107">Se um backup continuar corretamente, um gravador receberá um evento BackupComplete seguido de um evento BackupShutdown.</span><span class="sxs-lookup"><span data-stu-id="b0e6b-107">If a backup proceeds properly, a writer will receive a BackupComplete event followed by a BackupShutdown event.</span></span>

<span data-ttu-id="b0e6b-108">Se a operação for anulada (o solicitante gera um [*evento de anulação*](vssgloss-a.md) chamando [**IVssBackupComponents:: AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup)) ou falhar abruptamente, um gravador poderá receber apenas um evento BackupShutdown e não poderá receber outros eventos que executam operações de limpeza.</span><span class="sxs-lookup"><span data-stu-id="b0e6b-108">If the operation aborts (the requester generates an [*Abort event*](vssgloss-a.md) by calling [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup)) or fails abruptly, a writer may receive only a BackupShutdown event, and it may not receive other events that perform cleanup operations.</span></span> <span data-ttu-id="b0e6b-109">Cabe a um escritor determinar se um evento BackupShutdown segue uma sequência adequada de eventos ou representa uma falha inesperada das operações de backup.</span><span class="sxs-lookup"><span data-stu-id="b0e6b-109">It is up to a writer to determine whether a BackupShutdown event follows a proper sequence of events, or represents an unexpected failure of the backup operations.</span></span>

<span data-ttu-id="b0e6b-110">O manipulador de eventos BackupShutdown, [**CVssWriter:: OnBackupShutdown**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupshutdown), recebe a \_ ID do VSS (GUID) do conjunto de cópias de sombra da operação de backup que está sendo desligada.</span><span class="sxs-lookup"><span data-stu-id="b0e6b-110">The BackupShutdown event handler, [**CVssWriter::OnBackupShutdown**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupshutdown), receives the VSS\_ID (GUID) of the shadow copy set of the backup operation being shut down.</span></span> <span data-ttu-id="b0e6b-111">O gravador pode usar isso para determinar qual operação de backup está sendo desligada, se tiver armazenado a ID do conjunto de cópias de sombra durante sua sequência de backup (por exemplo, de dentro de [**CVssWriter:: OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze), [**CVssWriter:: descongelar**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)ou [**CVssWriter:: OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot)) usando [**CVssWriter:: GetCurrentSnapshotSetId**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-getcurrentsnapshotsetid).</span><span class="sxs-lookup"><span data-stu-id="b0e6b-111">The writer can use this to determine which backup operation is being shut down, if it has stored the shadow copy set ID during its backup sequence (for example, from within [**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze), [**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw), or [**CVssWriter::OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot)) by using [**CVssWriter::GetCurrentSnapshotSetId**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-getcurrentsnapshotsetid).</span></span>

<span data-ttu-id="b0e6b-112">No entanto, um gravador não deve chamar [**CVssWriter:: GetCurrentSnapshotSetId**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-getcurrentsnapshotsetid) de dentro de [**CVssWriter:: OnBackupShutdown**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupshutdown).</span><span class="sxs-lookup"><span data-stu-id="b0e6b-112">However, a writer should not call [**CVssWriter::GetCurrentSnapshotSetId**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-getcurrentsnapshotsetid) from within [**CVssWriter::OnBackupShutdown**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupshutdown).</span></span> <span data-ttu-id="b0e6b-113">Além disso, **CVssWriter:: GetCurrentSnapshotSetId** não pode ser chamado depois de [**CVssWriter:: OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) retornar.</span><span class="sxs-lookup"><span data-stu-id="b0e6b-113">Also, **CVssWriter::GetCurrentSnapshotSetId** cannot be called after [**CVssWriter::OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) returns.</span></span>

<span data-ttu-id="b0e6b-114">É possível que o gravador esteja envolvido em várias operações de backup e, se um evento BackupShutdown for chamado devido a um desligamento abrupta de um solicitante, a \_ ID do VSS retornada poderá ser a de outra operação de backup na qual o gravador estava participando.</span><span class="sxs-lookup"><span data-stu-id="b0e6b-114">It is possible for the writer to be involved in multiple backup operations, and if a BackupShutdown event is called because of an abrupt shutdown of a requester, the VSS\_ID returned could be that of another backup operation the writer was participating in.</span></span>

 

 



