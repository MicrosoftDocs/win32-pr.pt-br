---
title: Interação do protocolo de autenticação e ponto de acesso durante a autenticação
description: A função RasEapMakeMessage controla a maioria da interação entre o protocolo de autenticação e o AP (ponto de acesso).
ms.assetid: edc128e0-3104-4df9-80f4-b2aebcfe1087
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0e486e3a10e323f28bc2f6fef4c131acfc095b48
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/19/2020
ms.locfileid: "104007388"
---
# <a name="access-point-and-authentication-protocol-interaction-during-authentication"></a><span data-ttu-id="8a811-103">Interação do protocolo de autenticação e ponto de acesso durante a autenticação</span><span class="sxs-lookup"><span data-stu-id="8a811-103">Access Point and Authentication Protocol Interaction During Authentication</span></span>

<span data-ttu-id="8a811-104">A função [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) controla a maioria da interação entre o protocolo de autenticação e o AP (ponto de acesso).</span><span class="sxs-lookup"><span data-stu-id="8a811-104">The [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) function controls the majority of the interaction between the authentication protocol and the Access Point (AP).</span></span> <span data-ttu-id="8a811-105">O **RasEapMakeMessage** processa pacotes EAP de entrada e cria pacotes EAP para transmissão para o par remoto.</span><span class="sxs-lookup"><span data-stu-id="8a811-105">**RasEapMakeMessage** processes incoming EAP packets and creates EAP packets for transmission to the remote peer.</span></span> <span data-ttu-id="8a811-106">Ele também processa eventos como tempo limite e conclusão de autenticação.</span><span class="sxs-lookup"><span data-stu-id="8a811-106">It also processes events such as time outs and authentication completion.</span></span>

<span data-ttu-id="8a811-107">Se uma mensagem for recebida do ponto remoto, o serviço de autenticação AP chamará [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)), passando um ponteiro para a mensagem recebida no parâmetro *pReceivePacket* .</span><span class="sxs-lookup"><span data-stu-id="8a811-107">If a message is received from the remote peer, the AP authentication service calls [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)), passing a pointer to the received message in the *pReceivePacket* parameter.</span></span>

<span data-ttu-id="8a811-108">Se o serviço chamar [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) com *PReceivePacket* definido como **NULL**, o AP estará iniciando a caixa de diálogo com o protocolo de autenticação ou solicitando que o protocolo reenvie o último pacote.</span><span class="sxs-lookup"><span data-stu-id="8a811-108">If the service calls [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) with *pReceivePacket* set to **NULL**, the AP is either initiating the dialog with the authentication protocol, or requesting that the protocol resend the last packet.</span></span> <span data-ttu-id="8a811-109">O protocolo de autenticação deve determinar qual ação o serviço está assumindo com base em seu estado e no contexto da mensagem.</span><span class="sxs-lookup"><span data-stu-id="8a811-109">The authentication protocol should determine which action the service is taking based on its state and from the message context.</span></span>

<span data-ttu-id="8a811-110">No retorno de [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)), o valor do membro **Action** da estrutura de [**\_ \_ saída PPP EAP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output) indica qual ação, se houver, o serviço de autenticação usa.</span><span class="sxs-lookup"><span data-stu-id="8a811-110">On return from [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)), the value of the **Action** member of the [**PPP\_EAP\_OUTPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output) structure indicates what action, if any, the authentication service takes.</span></span> <span data-ttu-id="8a811-111">O membro de **ação** recebe valores do tipo enumerado da [**\_ \_ ação EAP do PPP**](/windows/desktop/api/Raseapif/ne-raseapif-ppp_eap_action) .</span><span class="sxs-lookup"><span data-stu-id="8a811-111">The **Action** member takes values from the [**PPP\_EAP\_ACTION**](/windows/desktop/api/Raseapif/ne-raseapif-ppp_eap_action) enumerated type.</span></span>

<span data-ttu-id="8a811-112">Se **Action** for **EAPACTION \_ Send**, **EAPACTION \_ SendAndDone**, **EAPACTION \_ SendWithTimeout** ou **EAPACTION \_ SendWithTimeoutInteractive**, o serviço transmitirá o pacote apontado pelo parâmetro *pSendPacket* para o par remoto.</span><span class="sxs-lookup"><span data-stu-id="8a811-112">If **Action** is **EAPACTION\_Send**, **EAPACTION\_SendAndDone**, **EAPACTION\_SendWithTimeout**, or **EAPACTION\_SendWithTimeoutInteractive**, the service transmits the packet that is pointed to by the *pSendPacket* parameter to the remote peer.</span></span>

<span data-ttu-id="8a811-113">O valor de **\_ SendWithTimeout de EAPACTION** permite um tempo limite, após o qual o serviço de autenticação assume que o link foi perdido e desconecta a sessão.</span><span class="sxs-lookup"><span data-stu-id="8a811-113">The **EAPACTION\_SendWithTimeout** value allows for a time out, after which time the authentication service assumes the link was lost, and disconnects the session.</span></span>

<span data-ttu-id="8a811-114">O valor de **\_ SendWithTimeoutInteractive EAPACTION** permite que uma quantidade infinita de tempo limite ocorra.</span><span class="sxs-lookup"><span data-stu-id="8a811-114">The **EAPACTION\_SendWithTimeoutInteractive** value allows an infinite amount of time out to occur.</span></span> <span data-ttu-id="8a811-115">O autenticador deve usar esse valor ao esperar a entrada do usuário no cliente.</span><span class="sxs-lookup"><span data-stu-id="8a811-115">The authenticator should use this value when expecting user input on the client.</span></span> <span data-ttu-id="8a811-116">Esse tempo limite permite que o usuário tenha um período de tempo não especificado para concluir a entrada necessária.</span><span class="sxs-lookup"><span data-stu-id="8a811-116">This time out allows the user an unspecified amount of time to complete the required input.</span></span>

<span data-ttu-id="8a811-117">Se **Action** for **EAPACTION \_ SendWithTimeout** ou **EAPACTION \_ SendWithTimeoutInteractive**, o protocolo de autenticação deverá definir o membro **dwIdExpected** da estrutura de [**saída do \_ EAP \_ do PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output) para o identificador do próximo pacote que é esperado do par remoto.</span><span class="sxs-lookup"><span data-stu-id="8a811-117">If **Action** is **EAPACTION\_SendWithTimeout** or **EAPACTION\_SendWithTimeoutInteractive**, the authentication protocol should set the **dwIdExpected** member of the [**PPP\_EAP\_OUTPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output) structure to the identifier of the next packet that is expected from the remote peer.</span></span> <span data-ttu-id="8a811-118">Independentemente se o próximo pacote recebido do par corresponde a esse valor, o serviço de autenticação passa o pacote para o protocolo de autenticação em uma chamada subsequente para [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="8a811-118">Regardless of whether the next packet received from the peer matches this value, the authentication service passes the packet to the authentication protocol in a subsequent call to [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)).</span></span> <span data-ttu-id="8a811-119">O protocolo de autenticação pode descartar silenciosamente o pacote simplesmente retornando o **erro \_ \_ \_ pacote de PPP inválido**.</span><span class="sxs-lookup"><span data-stu-id="8a811-119">The authentication protocol may silently discard the packet by simply returning **ERROR\_PPP\_INVALID\_PACKET**.</span></span> <span data-ttu-id="8a811-120">Se um pacote com o identificador esperado não for recebido dentro do período de tempo limite configurado, o serviço de autenticação ainda chamará **RasEapMakeMessage**.</span><span class="sxs-lookup"><span data-stu-id="8a811-120">If a packet with the expected identifier is not received within the configured time-out period, the authentication service still calls **RasEapMakeMessage**.</span></span> <span data-ttu-id="8a811-121">Nesse caso, a chamada é feita com o parâmetro *pReceivePacket* definido como **NULL**, para indicar que o pacote anterior precisa ser enviado novamente.</span><span class="sxs-lookup"><span data-stu-id="8a811-121">In this case, the call is made with the *pReceivePacket* parameter set to **NULL**, to indicate that the previous packet needs to be sent again.</span></span>

<span data-ttu-id="8a811-122">Se o membro de **ação** for **EAPACTION \_ concluído** ou **EAPACTION \_ SendAndDone**, o serviço de autenticação examinará o membro **dwAuthResultCode** da [**\_ \_ saída PPP EAP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output).</span><span class="sxs-lookup"><span data-stu-id="8a811-122">If the **Action** member is **EAPACTION\_Done** or **EAPACTION\_SendAndDone**, the authentication service examines the **dwAuthResultCode** member of [**PPP\_EAP\_OUTPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output).</span></span> <span data-ttu-id="8a811-123">Se **dwAuthResultCode** não for um \_ erro, a autenticação foi bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="8a811-123">If **dwAuthResultCode** is NO\_ERROR, the authentication succeeded.</span></span> <span data-ttu-id="8a811-124">Se **dwAuthResultCode** for um valor diferente de nenhum \_ erro, a autenticação falhará.</span><span class="sxs-lookup"><span data-stu-id="8a811-124">If **dwAuthResultCode** is a value other than NO\_ERROR, the authentication failed.</span></span> <span data-ttu-id="8a811-125">O código de erro retornado para o caso de falha deve vir de Raserror. h, Mprerror. h ou Winerror. h.</span><span class="sxs-lookup"><span data-stu-id="8a811-125">The error code returned for the failure case should come from Raserror.h, Mprerror.h, or Winerror.h.</span></span> <span data-ttu-id="8a811-126">Os códigos de retorno possíveis incluem, mas não se limitam a, o seguinte:</span><span class="sxs-lookup"><span data-stu-id="8a811-126">Possible return codes include, but are not limited to, the following:</span></span>

-   <span data-ttu-id="8a811-127">ERRO \_ sem \_ permissão de discagem \_</span><span class="sxs-lookup"><span data-stu-id="8a811-127">ERROR\_NO\_DIALIN\_PERMISSION</span></span>
-   <span data-ttu-id="8a811-128">ERRO \_ passwd \_ expirado</span><span class="sxs-lookup"><span data-stu-id="8a811-128">ERROR\_PASSWD\_EXPIRED</span></span>
-   <span data-ttu-id="8a811-129">ERRO de \_ Acct \_ desabilitado</span><span class="sxs-lookup"><span data-stu-id="8a811-129">ERROR\_ACCT\_DISABLED</span></span>
-   <span data-ttu-id="8a811-130">\_horário de \_ logon \_ restrito de erro</span><span class="sxs-lookup"><span data-stu-id="8a811-130">ERROR\_RESTRICTED\_LOGON\_HOURS</span></span>
-   <span data-ttu-id="8a811-131">ERRO \_ interno de autenticação \_</span><span class="sxs-lookup"><span data-stu-id="8a811-131">ERROR\_AUTH\_INTERNAL</span></span>

<span data-ttu-id="8a811-132">No caso em que **Action** é **EAPACTION \_ Done** ou **EAPACTION \_ SendAndDone**, o membro **pUserAttributes** deve apontar para atributos que substituem atributos do mesmo tipo que foram passados para o servidor na chamada para [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="8a811-132">In the case where **Action** is **EAPACTION\_Done** or **EAPACTION\_SendAndDone**, the **pUserAttributes** member should point to attributes that override attributes of the same type that were passed to the server in the call to [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)).</span></span>

<span data-ttu-id="8a811-133">O protocolo de autenticação no servidor pode solicitar que o serviço de autenticação invoque o provedor de autenticação atual retornando **EAPACTION \_ Authenticate** no membro de **ação** na [**\_ \_ saída PPP EAP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output).</span><span class="sxs-lookup"><span data-stu-id="8a811-133">The authentication protocol on the server can request that the authentication service invoke the current authentication provider by returning **EAPACTION\_Authenticate** in the **Action** member in [**PPP\_EAP\_OUTPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output).</span></span> <span data-ttu-id="8a811-134">Nesse caso, o ponteiro **pUserAttributes** na **saída PPP \_ EAP \_** aponta apenas para atributos que foram gerados pelo protocolo de autenticação no servidor.</span><span class="sxs-lookup"><span data-stu-id="8a811-134">In this case, the **pUserAttributes** pointer in **PPP\_EAP\_OUTPUT** points only to attributes that were generated by the authentication protocol on the server.</span></span> <span data-ttu-id="8a811-135">Ele não inclui nenhum dos atributos que foram passados para o servidor na chamada para [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="8a811-135">It does not include any of the attributes that were passed to the server in the call to [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)).</span></span> <span data-ttu-id="8a811-136">O provedor de autenticação não requer esses atributos iniciais porque as credenciais de autenticação estão dentro da mensagem EAP em si, não em um atributo RADIUS separado.</span><span class="sxs-lookup"><span data-stu-id="8a811-136">The authentication provider does not require these initial attributes because the authentication credentials are inside the EAP message itself, not in a separate RADIUS attribute.</span></span> <span data-ttu-id="8a811-137">Quando o serviço de autenticação responde à ação de autenticação **EAPACTION \_** , **pUserAttributes** na [**\_ \_ entrada EAP do PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input), aponta para todos os atributos gerados durante a autenticação.</span><span class="sxs-lookup"><span data-stu-id="8a811-137">When the authentication service responds to the **EAPACTION\_Authenticate** action, **pUserAttributes** in [**PPP\_EAP\_INPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input), points to all attributes generated during authentication.</span></span> <span data-ttu-id="8a811-138">Esses atributos são retornados para o protocolo de autenticação no cliente.</span><span class="sxs-lookup"><span data-stu-id="8a811-138">These attributes are returned to the authentication protocol on the client.</span></span>

<span data-ttu-id="8a811-139">Se o protocolo de autenticação usar **EAPACTION \_ autenticar**, o provedor de autenticação executará o PAP ou o MD5-CHAP.</span><span class="sxs-lookup"><span data-stu-id="8a811-139">If the authentication protocol uses **EAPACTION\_Authenticate**, the authentication provider performs either PAP or MD5-CHAP.</span></span> <span data-ttu-id="8a811-140">Esse método de autenticação pode ser usado somente com clientes Windows.</span><span class="sxs-lookup"><span data-stu-id="8a811-140">This authentication method can be used only with Windows clients.</span></span>

<span data-ttu-id="8a811-141">Se o protocolo de autenticação autenticar o usuário sem depender de um provedor de autenticação, não será necessário que o protocolo defina a **ação** como **EAPACTION \_ autenticar**.</span><span class="sxs-lookup"><span data-stu-id="8a811-141">If the authentication protocol authenticates the user without relying on an authentication provider, there is no need for the protocol to ever set **Action** to **EAPACTION\_Authenticate**.</span></span> <span data-ttu-id="8a811-142">Um exemplo desse caso é o TLS (segurança de camada) EAP-Transport.</span><span class="sxs-lookup"><span data-stu-id="8a811-142">An example of this case is EAP-Transport Layer Security (TLS).</span></span>

<span data-ttu-id="8a811-143">O pacote de êxito do EAP é um pacote não reconhecido.</span><span class="sxs-lookup"><span data-stu-id="8a811-143">The EAP success packet is a non-acknowledged packet.</span></span> <span data-ttu-id="8a811-144">Portanto, ele pode ser perdido e não enviado pelo servidor.</span><span class="sxs-lookup"><span data-stu-id="8a811-144">Therefore, it can be lost and not resent by the server.</span></span> <span data-ttu-id="8a811-145">Se o serviço de autenticação no cliente receber um pacote de protocolo de controle de rede (NCP), o serviço de autenticação do lado do servidor continuará como se a autenticação tivesse êxito.</span><span class="sxs-lookup"><span data-stu-id="8a811-145">If the authentication service on the client receives a Network Control Protocol (NCP) packet, the server-side authentication service proceeds as though the authentication was successful.</span></span> <span data-ttu-id="8a811-146">Isso ocorre porque o servidor passou para a fase NCP do PPP.</span><span class="sxs-lookup"><span data-stu-id="8a811-146">This is because the server has moved on to the NCP phase of PPP.</span></span> <span data-ttu-id="8a811-147">De acordo, o serviço de autenticação chama [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) com o membro **fSuccessPacketReceived** da estrutura de [**\_ \_ entrada PPP EAP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) definida como **true**.</span><span class="sxs-lookup"><span data-stu-id="8a811-147">Accordingly, the authentication service calls [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) with the **fSuccessPacketReceived** member of the [**PPP\_EAP\_INPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) structure set to **TRUE**.</span></span>

<span data-ttu-id="8a811-148">Durante o curso da sessão de autenticação, o protocolo de autenticação pode exigir a interação diretamente com o usuário no cliente.</span><span class="sxs-lookup"><span data-stu-id="8a811-148">During the course of the authentication session, the authentication protocol may require interaction directly with the user on the client.</span></span> <span data-ttu-id="8a811-149">O fornecedor do protocolo de autenticação pode fornecer uma interface do usuário interativa para essa finalidade.</span><span class="sxs-lookup"><span data-stu-id="8a811-149">The authentication protocol vendor can provide an interactive user interface for this purpose.</span></span> <span data-ttu-id="8a811-150">O protocolo de autenticação pode solicitar que o serviço exiba a interface do usuário interativa definindo os membros **fInvokeInteractiveUI**, **pUIContextData** e **dwSizeOfUIContextData** na estrutura de [**saída do \_ EAP \_ do PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output) .</span><span class="sxs-lookup"><span data-stu-id="8a811-150">The authentication protocol can request that the service display the interactive UI by setting the **fInvokeInteractiveUI**, **pUIContextData**, and **dwSizeOfUIContextData** members in the [**PPP\_EAP\_OUTPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output) structure.</span></span> <span data-ttu-id="8a811-151">Para obter mais informações sobre como usar uma interface do usuário interativa, consulte [Interactive user interface](interactive-user-interface.md).</span><span class="sxs-lookup"><span data-stu-id="8a811-151">For more information on using an interactive UI, see [Interactive User Interface](interactive-user-interface.md).</span></span>

<span data-ttu-id="8a811-152">O protocolo de autenticação deve exibir uma interface do usuário somente por meio do mecanismo descrito em [interface do usuário interativo](interactive-user-interface.md).</span><span class="sxs-lookup"><span data-stu-id="8a811-152">The authentication protocol should display a user interface only through the mechanism described under [Interactive User Interface](interactive-user-interface.md).</span></span> <span data-ttu-id="8a811-153">Se o próprio protocolo de autenticação exibir a interface do usuário, o thread PPP será bloqueado até que a interface do usuário seja ignorada.</span><span class="sxs-lookup"><span data-stu-id="8a811-153">If the authentication protocol itself displays the user interface, the PPP thread blocks until the user interface is dismissed.</span></span>

<span data-ttu-id="8a811-154">Se, durante o processo de autenticação, [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) retornar qualquer valor diferente de **sem \_ erro ou um** **pacote de erro \_ PPP \_ inválido \_**, a sessão será desconectada e o erro será registrado (no servidor) ou exibido para o usuário (no cliente).</span><span class="sxs-lookup"><span data-stu-id="8a811-154">If during the authentication process, [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) returns any value other than **NO\_ERROR** or **ERROR\_PPP\_INVALID\_PACKET**, the session is disconnected and the error is logged (on the server) or displayed to the user (on the client).</span></span>

 

 