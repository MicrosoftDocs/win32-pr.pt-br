---
title: Inicialização do protocolo de autenticação
description: A conexão EAP protegida é inicializada entre o cliente e o servidor de maneiras semelhantes para clientes RAS e sem fio (802.1 X).
ms.assetid: 1cd5bfc9-2ba3-477c-9bbb-73578a5623c2
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 856bd173ef617fb272460f874fa1d2087322c8b4
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/19/2020
ms.locfileid: "104365922"
---
# <a name="authentication-protocol-initialization"></a><span data-ttu-id="33465-103">Inicialização do protocolo de autenticação</span><span class="sxs-lookup"><span data-stu-id="33465-103">Authentication Protocol Initialization</span></span>

<span data-ttu-id="33465-104">A conexão EAP protegida é inicializada entre o cliente e o servidor de maneiras semelhantes para clientes RAS e sem fio (802.1 X).</span><span class="sxs-lookup"><span data-stu-id="33465-104">The EAP secured connection is initialized between the client and server in similar ways for RAS and wireless (802.1X) clients.</span></span>

## <a name="client"></a><span data-ttu-id="33465-105">Cliente</span><span class="sxs-lookup"><span data-stu-id="33465-105">Client</span></span>

<span data-ttu-id="33465-106">Quando o cliente tenta estabelecer a conexão, o serviço de autenticação Obtém [informações de identidade](obtaining-identity-information.md) para o usuário.</span><span class="sxs-lookup"><span data-stu-id="33465-106">When the client attempts to establish the connection, the authentication service obtains [identity information](obtaining-identity-information.md) for the user.</span></span> <span data-ttu-id="33465-107">Se o valor **RAS \_ EAP \_ valueName \_ Invoke \_ NAMEDLG** estiver presente no registro para esse protocolo de autenticação e esse valor for definido como zero, o serviço de autenticação chamará [**RasEapGetIdentity**](/previous-versions/windows/desktop/api/Raseapif/nf-raseapif-raseapgetidentity).</span><span class="sxs-lookup"><span data-stu-id="33465-107">If the **RAS\_EAP\_VALUENAME\_INVOKE\_NAMEDLG** value is present in the registry for this authentication protocol and this value is set to zero, the authentication service calls [**RasEapGetIdentity**](/previous-versions/windows/desktop/api/Raseapif/nf-raseapif-raseapgetidentity).</span></span> <span data-ttu-id="33465-108">Essa função normalmente exibe uma interface do usuário que permite que as informações de identidade sejam de um tipo específico para o protocolo de autenticação; por exemplo, um certificado ou uma ID numérica.</span><span class="sxs-lookup"><span data-stu-id="33465-108">This function typically displays a user interface that allows the identity information to be of a type specific to the authentication protocol; for example, a certificate or numeric ID.</span></span> <span data-ttu-id="33465-109">Se **RAS \_ EAP \_ valueName \_ Invoke \_ NAMEDLG** não estiver presente ou for definido como um, o serviço de autenticação exibirá a caixa de diálogo padrão do nome de usuário do sistema.</span><span class="sxs-lookup"><span data-stu-id="33465-109">If **RAS\_EAP\_VALUENAME\_INVOKE\_NAMEDLG** is not present, or is set to one, the authentication service displays the standard system user-name dialog.</span></span>

<span data-ttu-id="33465-110">Depois que o serviço de autenticação tiver obtido as informações de identidade para o usuário, ele chamará a implementação do protocolo de autenticação de [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="33465-110">Once the authentication service has obtained the identity information for the user, it calls the authentication protocol's implementation of [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)).</span></span> <span data-ttu-id="33465-111">Essa chamada permite que o protocolo de autenticação aloque e inicialize um buffer de trabalho que o serviço passa nas chamadas subsequentes para [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) e [**RasEapEnd**](/previous-versions/windows/desktop/legacy/aa363521(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="33465-111">This call allows the authentication protocol to allocate and initialize a work buffer that the service passes on subsequent calls to [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) and [**RasEapEnd**](/previous-versions/windows/desktop/legacy/aa363521(v=vs.85)).</span></span> <span data-ttu-id="33465-112">O buffer de trabalho é opaco para o serviço e nunca acessa o conteúdo do buffer de trabalho.</span><span class="sxs-lookup"><span data-stu-id="33465-112">The work buffer is opaque to the service and never accesses the contents of the work buffer.</span></span> <span data-ttu-id="33465-113">Se o protocolo de autenticação criar um buffer de trabalho distinto para cada sessão EAP, o buffer de trabalho será de sessão e thread seguro.</span><span class="sxs-lookup"><span data-stu-id="33465-113">If the authentication protocol creates a distinct work buffer for each EAP session, then the work buffer is session and thread safe.</span></span> <span data-ttu-id="33465-114">Como o protocolo de autenticação aloca a memória para o buffer de trabalho, o protocolo de autenticação também deve liberar essa memória usando a função [**RasEapFreeMemory**](/previous-versions/windows/desktop/api/Raseapif/nf-raseapif-raseapfreememory) .</span><span class="sxs-lookup"><span data-stu-id="33465-114">Because the authentication protocol allocates the memory for the work buffer, the authentication protocol should also free this memory using the [**RasEapFreeMemory**](/previous-versions/windows/desktop/api/Raseapif/nf-raseapif-raseapfreememory) function.</span></span>

<span data-ttu-id="33465-115">Na chamada de [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)), o serviço também passa uma estrutura [**de \_ \_ entrada PPP EAP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) que contém ponteiros para as informações de configuração para a conexão e as informações de identidade para o usuário.</span><span class="sxs-lookup"><span data-stu-id="33465-115">In the call to [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)), the service also passes a [**PPP\_EAP\_INPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) structure that contains pointers to the configuration information for the connection, and the identity information for the user.</span></span> <span data-ttu-id="33465-116">O serviço sempre passa um valor para o membro **pszIdentity** da **entrada PPP \_ EAP \_**.</span><span class="sxs-lookup"><span data-stu-id="33465-116">The service always passes in a value for the **pszIdentity** member of **PPP\_EAP\_INPUT**.</span></span> <span data-ttu-id="33465-117">No entanto, o membro **pszPassword** da [**\_ \_ entrada PPP EAP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) pode ser **nulo**.</span><span class="sxs-lookup"><span data-stu-id="33465-117">However, the **pszPassword** member of [**PPP\_EAP\_INPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) may be **NULL**.</span></span>

<span data-ttu-id="33465-118">Na estrutura [**de \_ \_ entrada do EAP do PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) , o membro **fAuthenticator** indica se o protocolo de autenticação está sendo invocado para ser autenticado (no cliente) ou como o autenticador (no servidor).</span><span class="sxs-lookup"><span data-stu-id="33465-118">Within the [**PPP\_EAP\_INPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) structure, the **fAuthenticator** member indicates whether the authentication protocol is being invoked to be authenticated (on the client) or as the authenticator (on the server).</span></span>

## <a name="server"></a><span data-ttu-id="33465-119">Servidor</span><span class="sxs-lookup"><span data-stu-id="33465-119">Server</span></span>

<span data-ttu-id="33465-120">No servidor, o membro **bInitialID** da [**entrada PPP \_ EAP \_**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) especifica a ID que o servidor usa para o primeiro pacote EAP.</span><span class="sxs-lookup"><span data-stu-id="33465-120">On the server, the **bInitialID** member of [**PPP\_EAP\_INPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) specifies the ID that the server uses for the first EAP packet.</span></span> <span data-ttu-id="33465-121">O servidor incrementa essa ID para pacotes subsequentes.</span><span class="sxs-lookup"><span data-stu-id="33465-121">The server increments this ID for subsequent packets.</span></span>

<span data-ttu-id="33465-122">Também no servidor, o ponteiro **pUserAttributes** na [**entrada PPP \_ EAP \_**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) aponta para uma matriz de atributos do tipo de [**\_ tipo de \_ atributo \_ RAS auth**](/windows/win32/api/raseapif/ne-raseapif-ras_auth_attribute_type) .</span><span class="sxs-lookup"><span data-stu-id="33465-122">Also on the server, the **pUserAttributes** pointer in [**PPP\_EAP\_INPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) points to an array of attributes of the [**RAS\_AUTH\_ATTRIBUTE\_TYPE**](/windows/win32/api/raseapif/ne-raseapif-ras_auth_attribute_type) type.</span></span> <span data-ttu-id="33465-123">Esses são os atributos para o usuário que foram obtidos do cliente.</span><span class="sxs-lookup"><span data-stu-id="33465-123">These are attributes for the user that were obtained from the client.</span></span>

<span data-ttu-id="33465-124">Se a chamada [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)) retornar qualquer valor diferente de **nenhum \_ erro**, a sessão será desconectada.</span><span class="sxs-lookup"><span data-stu-id="33465-124">If the [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)) call returns any value other than **NO\_ERROR**, the session is disconnected.</span></span> <span data-ttu-id="33465-125">O erro retornado é registrado (no servidor) ou exibido para o usuário (no cliente).</span><span class="sxs-lookup"><span data-stu-id="33465-125">The returned error is logged (on the server), or displayed to the user (on the client).</span></span>

 

 